import{f as L,s as c,r as f,j as e,a0 as M,m as C,a2 as V,ah as z,B as U,z as j,u as H,d as W,O as Y,al as Z,g as ee,o as te,M as O}from"./main-Cv3DLBs1.js";import{P as Q}from"./PremiumCard-C8PJt07T.js";import{P as re}from"./PremiumButton-DEtqLbhG.js";import{E as R}from"./EmptyState-BvWI2uN2.js";import{M as $}from"./megaphone-DFT6L8Pa.js";import{L as A}from"./link-1m3G8lM8.js";import{C as B}from"./circle-question-mark-BwWyIXMP.js";import{S as D}from"./send-BE4VkFZG.js";import{H as X}from"./heart-tkhtKPqz.js";import{f as G}from"./formatDistanceToNow-DKkltRxp.js";import{p as J}from"./pt-BR-CVz3wboC.js";import{E as se}from"./ellipsis-vertical-BxCbaUyk.js";import{T as ae}from"./trash-2-ChfOtETt.js";import{M as oe}from"./message-circle-Bu-Y95O-.js";import{A as ie}from"./arrow-left-Bz9GyE2M.js";import{P as ne}from"./plus-CHwJ6wYR.js";import{F as le}from"./funnel-DYY8KVY5.js";import"./constructNow-BUe0KqNa.js";import"./toDate-B_SDEMqy.js";import"./en-US-C1KUdeex.js";import"./endOfMonth-5f4-gZt5.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"m15 10 5 5-5 5",key:"qqa56n"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]],de=L("corner-down-right",ce);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M4.93 4.929a10 10 0 0 0-1.938 11.412 2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 0 0 11.302-1.989",key:"7il5tn"}],["path",{d:"M8.35 2.69A10 10 0 0 1 21.3 15.65",key:"1pfsoa"}]],ue=L("message-circle-off",me);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],he=L("paperclip",pe);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]],I=L("pin",xe),k={async getPosts(t,r={}){const{type:s=null,limit:a=50,offset:d=0,pinnedFirst:w=!0}=r;let u=c.from("class_posts").select(`
        *,
        author:profiles!class_posts_author_id_fkey(id, full_name, avatar_url),
        user_liked:post_likes!left(user_id),
        user_viewed:post_views!left(user_id)
      `).eq("class_id",t).not("published_at","is",null).range(d,d+a-1);s&&(u=u.eq("type",s)),w&&(u=u.order("is_pinned",{ascending:!1})),u=u.order("published_at",{ascending:!1});const{data:p,error:m}=await u;if(m)throw console.error("Erro ao buscar posts:",m),m;const g=(await c.auth.getUser()).data.user?.id;return(p||[]).map(h=>({...h,isLikedByUser:h.user_liked?.some(b=>b.user_id===g)||!1,isViewedByUser:h.user_viewed?.some(b=>b.user_id===g)||!1}))},async getPost(t){const{data:r,error:s}=await c.from("class_posts").select(`
        *,
        author:profiles!class_posts_author_id_fkey(id, full_name, avatar_url),
        comments:post_comments(
          *,
          author:profiles!post_comments_author_id_fkey(id, full_name, avatar_url)
        )
      `).eq("id",t).single();if(s)throw console.error("Erro ao buscar post:",s),s;return r},async createPost(t,r){const s=(await c.auth.getUser()).data.user;if(!s)throw new Error("UsuÃ¡rio nÃ£o autenticado");const{type:a,title:d,content:w,attachments:u=[],isPinned:p=!1,commentsEnabled:m=!0,scheduledFor:g=null}=r,h={class_id:t,author_id:s.id,type:a,title:d,content:w,attachments:u,is_pinned:p,comments_enabled:m,scheduled_for:g,published_at:g?null:new Date().toISOString()},{data:b,error:v}=await c.from("class_posts").insert([h]).select(`
        *,
        author:profiles!class_posts_author_id_fkey(id, full_name, avatar_url)
      `).single();if(v)throw console.error("Erro ao criar post:",v),v;return b},async updatePost(t,r){const{data:s,error:a}=await c.from("class_posts").update(r).eq("id",t).select(`
        *,
        author:profiles!class_posts_author_id_fkey(id, full_name, avatar_url)
      `).single();if(a)throw console.error("Erro ao atualizar post:",a),a;return s},async deletePost(t){const{error:r}=await c.from("class_posts").delete().eq("id",t);if(r)throw console.error("Erro ao deletar post:",r),r;return!0},async togglePin(t,r){return this.updatePost(t,{is_pinned:r})},async toggleComments(t,r){return this.updatePost(t,{comments_enabled:r})},async markAsViewed(t){const r=(await c.auth.getUser()).data.user;if(!r)return;const{error:s}=await c.from("post_views").insert([{post_id:t,user_id:r.id}]).select();s&&s.code!=="23505"&&console.error("Erro ao registrar visualizaÃ§Ã£o:",s),await c.rpc("increment_post_views",{post_id:t}).catch(()=>{})},async getViewers(t){const{data:r,error:s}=await c.from("post_views").select(`
        viewed_at,
        user:profiles!post_views_user_id_fkey(id, full_name, avatar_url)
      `).eq("post_id",t).order("viewed_at",{ascending:!1});if(s)throw console.error("Erro ao buscar visualizadores:",s),s;return r||[]},async toggleLike(t){const r=(await c.auth.getUser()).data.user;if(!r)throw new Error("UsuÃ¡rio nÃ£o autenticado");const{data:s}=await c.from("post_likes").select("*").eq("post_id",t).eq("user_id",r.id).maybeSingle();return s?(await c.from("post_likes").delete().eq("post_id",t).eq("user_id",r.id),!1):(await c.from("post_likes").insert([{post_id:t,user_id:r.id}]),!0)},async getComments(t){const{data:r,error:s}=await c.from("post_comments").select(`
        *,
        author:profiles!post_comments_author_id_fkey(id, full_name, avatar_url),
        replies:post_comments!parent_comment_id(
          *,
          author:profiles!post_comments_author_id_fkey(id, full_name, avatar_url)
        )
      `).eq("post_id",t).is("parent_comment_id",null).order("created_at",{ascending:!0});if(s)throw console.error("Erro ao buscar comentÃ¡rios:",s),s;return r||[]},async addComment(t,r,s=null){const a=(await c.auth.getUser()).data.user;if(!a)throw new Error("UsuÃ¡rio nÃ£o autenticado");const d={post_id:t,author_id:a.id,content:r,parent_comment_id:s},{data:w,error:u}=await c.from("post_comments").insert([d]).select(`
        *,
        author:profiles!post_comments_author_id_fkey(id, full_name, avatar_url)
      `).single();if(u)throw console.error("Erro ao adicionar comentÃ¡rio:",u),u;return w},async updateComment(t,r){const{data:s,error:a}=await c.from("post_comments").update({content:r}).eq("id",t).select(`
        *,
        author:profiles!post_comments_author_id_fkey(id, full_name, avatar_url)
      `).single();if(a)throw console.error("Erro ao editar comentÃ¡rio:",a),a;return s},async deleteComment(t){const{error:r}=await c.from("post_comments").delete().eq("id",t);if(r)throw console.error("Erro ao deletar comentÃ¡rio:",r),r;return!0},async toggleCommentLike(t){const r=(await c.auth.getUser()).data.user;if(!r)throw new Error("UsuÃ¡rio nÃ£o autenticado");const{data:s}=await c.from("comment_likes").select("*").eq("comment_id",t).eq("user_id",r.id).maybeSingle();return s?(await c.from("comment_likes").delete().eq("comment_id",t).eq("user_id",r.id),!1):(await c.from("comment_likes").insert([{comment_id:t,user_id:r.id}]),!0)},async getScheduledPosts(t){const{data:r,error:s}=await c.from("class_posts").select(`
        *,
        author:profiles!class_posts_author_id_fkey(id, full_name, avatar_url)
      `).eq("class_id",t).is("published_at",null).not("scheduled_for","is",null).order("scheduled_for",{ascending:!0});if(s)throw console.error("Erro ao buscar posts agendados:",s),s;return r||[]},async publishScheduledPost(t){return this.updatePost(t,{published_at:new Date().toISOString()})}},fe=({isOpen:t,onClose:r,onSubmit:s})=>{const[a,d]=f.useState({type:"announcement",title:"",content:"",attachments:[],isPinned:!1,commentsEnabled:!0,scheduledFor:null}),[w,u]=f.useState(""),[p,m]=f.useState(!1),g=[{value:"announcement",label:"AnÃºncio",icon:$,color:"text-red-500"},{value:"activity",label:"Atividade",icon:z,color:"text-blue-500"},{value:"material",label:"Material",icon:U,color:"text-green-500"},{value:"link",label:"Link",icon:A,color:"text-purple-500"},{value:"question",label:"Pergunta",icon:B,color:"text-orange-500"}],h=async i=>{if(i.preventDefault(),!a.content.trim()){j.error("O conteÃºdo nÃ£o pode estar vazio");return}m(!0);try{await s(a),d({type:"announcement",title:"",content:"",attachments:[],isPinned:!1,commentsEnabled:!0,scheduledFor:null})}catch(y){console.error("Erro ao criar post:",y)}finally{m(!1)}},b=()=>{if(!w.trim())return;const i={id:Date.now(),type:"link",url:w,name:w};d({...a,attachments:[...a.attachments,i]}),u("")},v=i=>{d({...a,attachments:a.attachments.filter(y=>y.id!==i)})};return t?e.jsx(M,{children:e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx(C.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:r}),e.jsxs(C.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative z-10 w-full max-w-2xl bg-white dark:bg-slate-900 rounded-2xl shadow-2xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Nova Postagem"}),e.jsx("button",{onClick:r,className:"p-2 rounded-lg hover:bg-muted transition-colors",children:e.jsx(V,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:h,className:"flex flex-col h-[calc(90vh-140px)]",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-3",children:"Tipo de Postagem"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-5 gap-2",children:g.map(i=>{const y=i.icon,x=a.type===i.value;return e.jsxs("button",{type:"button",onClick:()=>d({...a,type:i.value}),className:`whitespace-nowrap inline-flex flex-col items-center gap-2 p-3 rounded-xl border-2 transition-all ${x?"border-primary bg-primary/5":"border-border hover:border-primary/50 bg-white dark:bg-slate-800"}`,children:[e.jsx(y,{className:`w-6 h-6 ${x?"text-primary":i.color}`}),e.jsx("span",{className:"text-xs font-medium",children:i.label})]},i.value)})})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"title",className:"block text-sm font-medium mb-2",children:["TÃ­tulo ",e.jsx("span",{className:"text-muted-foreground",children:"(opcional)"})]}),e.jsx("input",{id:"title",type:"text",value:a.title,onChange:i=>d({...a,title:i.target.value}),placeholder:"Digite um tÃ­tulo para destacar...",className:"w-full px-4 py-2 rounded-lg border border-border bg-white dark:bg-slate-900 text-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"content",className:"block text-sm font-medium mb-2",children:"ConteÃºdo *"}),e.jsx("textarea",{id:"content",value:a.content,onChange:i=>d({...a,content:i.target.value}),placeholder:"O que vocÃª quer compartilhar com seus alunos?",rows:6,required:!0,className:"w-full px-4 py-3 rounded-lg border border-border bg-white dark:bg-slate-900 text-foreground focus:outline-none focus:ring-2 focus:ring-primary resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Anexos"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",value:w,onChange:i=>u(i.target.value),placeholder:"Cole um link (URL)...",className:"flex-1 px-4 py-2 rounded-lg border border-border bg-white dark:bg-slate-900 text-foreground focus:outline-none focus:ring-2 focus:ring-primary"}),e.jsxs("button",{type:"button",onClick:b,className:"whitespace-nowrap inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-white hover:bg-primary/90 transition-colors",children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx("span",{children:"Adicionar"})]})]}),a.attachments.length>0&&e.jsx("div",{className:"mt-3 space-y-2",children:a.attachments.map(i=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-border bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm truncate",children:i.name})]}),e.jsx("button",{type:"button",onClick:()=>v(i.id),className:"p-1 rounded hover:bg-destructive/10 text-destructive transition-colors",children:e.jsx(V,{className:"w-4 h-4"})})]},i.id))})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-border",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"pinned",className:"text-sm font-medium",children:"ðŸ“Œ Fixar no topo"}),e.jsx("input",{id:"pinned",type:"checkbox",checked:a.isPinned,onChange:i=>d({...a,isPinned:i.target.checked}),className:"w-5 h-5 rounded border-border text-primary focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"comments",className:"text-sm font-medium",children:"ðŸ’¬ Permitir comentÃ¡rios"}),e.jsx("input",{id:"comments",type:"checkbox",checked:a.commentsEnabled,onChange:i=>d({...a,commentsEnabled:i.target.checked}),className:"w-5 h-5 rounded border-border text-primary focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"schedule",className:"text-sm font-medium",children:"â° Agendar publicaÃ§Ã£o"}),e.jsx("input",{id:"schedule",type:"datetime-local",value:a.scheduledFor||"",onChange:i=>d({...a,scheduledFor:i.target.value||null}),className:"px-3 py-1.5 rounded-lg border border-border bg-white dark:bg-slate-900 text-foreground text-sm focus:outline-none focus:ring-2 focus:ring-primary"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-border bg-muted/30",children:[e.jsx("button",{type:"button",onClick:r,className:"whitespace-nowrap inline-flex items-center gap-2 px-6 py-2 rounded-lg border border-border bg-white dark:bg-slate-900 text-foreground hover:bg-muted transition-colors",children:e.jsx("span",{children:"Cancelar"})}),e.jsxs("button",{type:"submit",disabled:p,className:"whitespace-nowrap inline-flex items-center gap-2 px-6 py-2 rounded-lg bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(D,{className:"w-4 h-4"}),e.jsx("span",{children:p?"Publicando...":"Publicar"})]})]})]})]})]})}):null},ge=({postId:t,commentsCount:r,onUpdate:s})=>{const{user:a}=H(),[d,w]=f.useState([]),[u,p]=f.useState(!0),[m,g]=f.useState(""),[h,b]=f.useState(null),[v,i]=f.useState(!1);f.useEffect(()=>{y()},[t]);const y=async()=>{try{p(!0);const n=await k.getComments(t);w(n)}catch(n){console.error("Erro ao carregar comentÃ¡rios:",n),j.error("Erro ao carregar comentÃ¡rios")}finally{p(!1)}},x=async n=>{if(n.preventDefault(),!!m.trim()){i(!0);try{await k.addComment(t,m.trim(),h),g(""),b(null),await y(),s&&s(),j.success("ComentÃ¡rio adicionado")}catch(N){console.error("Erro ao adicionar comentÃ¡rio:",N),j.error("Erro ao adicionar comentÃ¡rio")}finally{i(!1)}}},P=async n=>{if(window.confirm("Tem certeza que deseja excluir este comentÃ¡rio?"))try{await k.deleteComment(n),await y(),s&&s(),j.success("ComentÃ¡rio excluÃ­do")}catch(N){console.error("Erro ao excluir comentÃ¡rio:",N),j.error("Erro ao excluir comentÃ¡rio")}},T=async n=>{try{await k.toggleCommentLike(n),await y()}catch(N){console.error("Erro ao curtir comentÃ¡rio:",N)}},F=n=>n?G(new Date(n),{addSuffix:!0,locale:J}):"",E=(n,N=!1)=>{const q=n.author_id===a?.id;return e.jsxs(C.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:`${N?"ml-12":""}`,children:[e.jsxs("div",{className:"flex gap-3 py-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-sm font-bold flex-shrink-0",children:n.author?.full_name?.charAt(0)||"U"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-sm",children:n.author?.full_name||"UsuÃ¡rio"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:F(n.created_at)}),q&&e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-primary/10 text-primary text-xs font-medium",children:"VocÃª"})]}),e.jsx("p",{className:"text-sm mb-2 whitespace-pre-wrap",children:n.content}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>T(n.id),className:"whitespace-nowrap inline-flex items-center gap-1 text-xs text-muted-foreground hover:text-red-500 transition-colors",children:[e.jsx(X,{className:"w-3.5 h-3.5"}),n.likes_count>0&&e.jsx("span",{className:"font-medium",children:n.likes_count})]}),!N&&e.jsx("button",{onClick:()=>b(n.id),className:"text-xs text-muted-foreground hover:text-primary transition-colors",children:"Responder"}),q&&e.jsx("button",{onClick:()=>P(n.id),className:"text-xs text-muted-foreground hover:text-destructive transition-colors",children:"Excluir"})]}),n.replies&&n.replies.length>0&&e.jsx("div",{className:"mt-2 space-y-2",children:n.replies.map(S=>E(S,!0))})]})]}),h===n.id&&e.jsx(C.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"ml-11 mb-3",children:e.jsxs("form",{onSubmit:x,className:"flex items-start gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-muted-foreground mt-2.5"}),e.jsx("input",{type:"text",value:m,onChange:S=>g(S.target.value),placeholder:"Digite sua resposta...",autoFocus:!0,className:"flex-1 px-3 py-2 rounded-lg border border-border bg-white dark:bg-slate-900 text-foreground text-sm focus:outline-none focus:ring-2 focus:ring-primary"}),e.jsx("button",{type:"submit",disabled:v||!m.trim(),className:"whitespace-nowrap inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-primary text-white text-sm disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(D,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>{b(null),g("")},className:"px-3 py-2 rounded-lg border border-border text-sm hover:bg-muted transition-colors",children:"Cancelar"})]})})]},n.id)};return u?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"})})}):e.jsxs("div",{className:"p-6",children:[e.jsx("form",{onSubmit:x,className:"mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-sm font-bold flex-shrink-0",children:a?.email?.charAt(0).toUpperCase()||"U"}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx("input",{type:"text",value:m,onChange:n=>g(n.target.value),placeholder:"Escreva um comentÃ¡rio...",disabled:v,className:"flex-1 px-4 py-2 rounded-lg border border-border bg-white dark:bg-slate-900 text-foreground focus:outline-none focus:ring-2 focus:ring-primary"}),e.jsxs("button",{type:"submit",disabled:v||!m.trim(),className:"whitespace-nowrap inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-white disabled:opacity-50 disabled:cursor-not-allowed hover:bg-primary/90 transition-colors",children:[e.jsx(D,{className:"w-4 h-4"}),e.jsx("span",{children:"Enviar"})]})]})]})}),e.jsx("div",{className:"space-y-1",children:e.jsx(M,{children:d.length===0?e.jsx(C.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-8 text-muted-foreground",children:"Nenhum comentÃ¡rio ainda. Seja o primeiro!"}):d.map(n=>E(n))})})]})},be=({post:t,isTeacher:r,onLike:s,onPin:a,onDelete:d,onToggleComments:w,onRefresh:u})=>{const[p,m]=f.useState(!1),[g,h]=f.useState(!1),v=(x=>{const P={announcement:{icon:$,label:"AnÃºncio",color:"text-red-500",bg:"bg-red-50 dark:bg-red-900/20"},activity:{icon:z,label:"Atividade",color:"text-blue-500",bg:"bg-blue-50 dark:bg-blue-900/20"},material:{icon:U,label:"Material",color:"text-green-500",bg:"bg-green-50 dark:bg-green-900/20"},link:{icon:A,label:"Link",color:"text-purple-500",bg:"bg-purple-50 dark:bg-purple-900/20"},question:{icon:B,label:"Pergunta",color:"text-orange-500",bg:"bg-orange-50 dark:bg-orange-900/20"}};return P[x]||P.announcement})(t.type),i=v.icon,y=x=>x?G(new Date(x),{addSuffix:!0,locale:J}):"";return e.jsx(C.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:e.jsxs(Q,{variant:"elevated",className:"relative",children:[t.is_pinned&&e.jsx("div",{className:"absolute top-4 right-4 z-10",children:e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full bg-primary text-white text-xs font-medium shadow-lg",children:[e.jsx(I,{className:"w-3 h-3"}),e.jsx("span",{children:"Fixado"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold flex-shrink-0",children:t.author?.full_name?.charAt(0)||"P"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h3",{className:"font-semibold",children:t.author?.full_name||"Professor"}),e.jsxs("div",{className:`whitespace-nowrap inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium ${v.bg} ${v.color}`,children:[e.jsx(i,{className:"w-3 h-3"}),e.jsx("span",{children:v.label})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:y(t.published_at||t.created_at)})]})]}),r&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>h(!g),className:"p-2 rounded-lg hover:bg-muted transition-colors",children:e.jsx(se,{className:"w-5 h-5"})}),g&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>h(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-1 w-48 bg-white dark:bg-slate-800 rounded-lg shadow-xl border border-border z-20 overflow-hidden",children:[e.jsxs("button",{onClick:()=>{a(),h(!1)},className:"w-full flex items-center gap-3 px-4 py-3 text-left hover:bg-muted transition-colors",children:[e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{children:t.is_pinned?"Desafixar":"Fixar no topo"})]}),e.jsxs("button",{onClick:()=>{w(),h(!1)},className:"w-full flex items-center gap-3 px-4 py-3 text-left hover:bg-muted transition-colors",children:[e.jsx(ue,{className:"w-4 h-4"}),e.jsxs("span",{children:[t.comments_enabled?"Desabilitar":"Habilitar"," comentÃ¡rios"]})]}),e.jsx("div",{className:"border-t border-border"}),e.jsxs("button",{onClick:()=>{d(),h(!1)},className:"w-full flex items-center gap-3 px-4 py-3 text-left hover:bg-destructive/10 text-destructive transition-colors",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{children:"Excluir"})]})]})]})]})]}),t.title&&e.jsx("h2",{className:"text-xl font-bold mb-3",children:t.title}),e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none mb-4",children:e.jsx("p",{className:"whitespace-pre-wrap",children:t.content})}),t.attachments&&t.attachments.length>0&&e.jsx("div",{className:"space-y-2 mb-4",children:t.attachments.map((x,P)=>e.jsxs("a",{href:x.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-3 rounded-lg border border-border hover:bg-muted transition-colors",children:[e.jsx(A,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-primary hover:underline truncate",children:x.name||x.url})]},P))}),t.scheduled_for&&!t.published_at&&e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-warning/10 border border-warning/20 text-warning mb-4",children:[e.jsx(W,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-medium",children:["Agendado para ",new Date(t.scheduled_for).toLocaleString("pt-BR")]})]}),e.jsxs("div",{className:"flex items-center gap-6 pt-4 border-t border-border",children:[e.jsxs("button",{onClick:s,className:"whitespace-nowrap inline-flex items-center gap-2 text-sm hover:text-primary transition-colors",children:[e.jsx(X,{className:`w-5 h-5 ${t.isLikedByUser?"fill-red-500 text-red-500":""}`}),e.jsx("span",{className:"font-medium",children:t.likes_count||0})]}),t.comments_enabled&&e.jsxs("button",{onClick:()=>m(!p),className:"whitespace-nowrap inline-flex items-center gap-2 text-sm hover:text-primary transition-colors",children:[e.jsx(oe,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:t.comments_count||0})]}),e.jsxs("div",{className:"whitespace-nowrap inline-flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Y,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:t.views_count||0})]})]})]}),p&&t.comments_enabled&&e.jsx("div",{className:"border-t border-border",children:e.jsx(ge,{postId:t.id,commentsCount:t.comments_count,onUpdate:u})})]})})},Be=()=>{const{classId:t}=Z(),r=ee(),{user:s}=H(),[a,d]=f.useState(!0),[w,u]=f.useState(null),[p,m]=f.useState([]),[g,h]=f.useState([]),[b,v]=f.useState(!1),[i,y]=f.useState(!1),[x,P]=f.useState("all"),T=[{value:"all",label:"Todos",icon:le},{value:"announcement",label:"AnÃºncios",icon:$},{value:"activity",label:"Atividades",icon:z},{value:"material",label:"Materiais",icon:U},{value:"link",label:"Links",icon:A},{value:"question",label:"Perguntas",icon:B}];f.useEffect(()=>{t&&s&&(F(),E())},[t,s]),f.useEffect(()=>{h(x==="all"?p:p.filter(o=>o.type===x))},[x,p]);const F=async()=>{try{const{data:o,error:l}=await c.from("classes").select("*").eq("id",t).single();if(l)throw l;u(o),v(o.created_by===s.id)}catch(o){console.error("Erro ao carregar turma:",o),j.error("Erro ao carregar dados da turma")}},E=async()=>{try{d(!0);const o=await k.getPosts(t,{pinnedFirst:!0});m(o),h(o)}catch(o){console.error("Erro ao carregar posts:",o),j.error("Erro ao carregar mural")}finally{d(!1)}},n=async o=>{try{const l=await k.createPost(t,o);m([l,...p]),y(!1),j.success("Post criado com sucesso!")}catch(l){console.error("Erro ao criar post:",l),j.error("Erro ao criar post")}},N=async o=>{try{const l=await k.toggleLike(o);m(p.map(_=>_.id===o?{..._,likes_count:l?_.likes_count+1:_.likes_count-1,isLikedByUser:l}:_))}catch(l){console.error("Erro ao curtir:",l),j.error("Erro ao curtir post")}},q=async(o,l)=>{try{await k.togglePin(o,!l),await E(),j.success(l?"Post desafixado":"Post fixado no topo")}catch(_){console.error("Erro ao fixar:",_),j.error("Erro ao fixar post")}},S=async o=>{if(window.confirm("Tem certeza que deseja excluir este post?"))try{await k.deletePost(o),m(p.filter(l=>l.id!==o)),j.success("Post excluÃ­do")}catch(l){console.error("Erro ao excluir:",l),j.error("Erro ao excluir post")}},K=async(o,l)=>{try{await k.toggleComments(o,!l),m(p.map(_=>_.id===o?{..._,comments_enabled:!l}:_)),j.success(l?"ComentÃ¡rios desabilitados":"ComentÃ¡rios habilitados")}catch(_){console.error("Erro ao alterar comentÃ¡rios:",_),j.error("Erro ao alterar comentÃ¡rios")}};return a?e.jsx(te,{message:"Carregando mural..."}):w?e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative overflow-hidden bg-gradient-to-br from-blue-600 via-purple-600 to-indigo-600 rounded-3xl p-8 text-white",children:[e.jsx("div",{className:"absolute inset-0 opacity-10",children:e.jsx("div",{className:"absolute inset-0",style:{backgroundImage:"radial-gradient(circle at 1px 1px, white 1px, transparent 0)",backgroundSize:"40px 40px"}})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("button",{onClick:()=>r(`/dashboard/classes/${t}`),className:"flex items-center gap-2 text-white/80 hover:text-white transition-colors mb-4",children:[e.jsx(ie,{className:"w-4 h-4"}),"Voltar para Turma"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:"ðŸ“° Mural"}),e.jsx("p",{className:"text-white/90 text-lg",children:w.name})]}),b&&e.jsx(re,{variant:"outline",leftIcon:ne,onClick:()=>y(!0),className:"whitespace-nowrap inline-flex items-center gap-2 bg-white/10 border-white/20 hover:bg-white/20 text-white",children:e.jsx("span",{children:"Nova Postagem"})})]})]})]}),e.jsx(Q,{variant:"elevated",children:e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto",children:T.map(o=>{const l=o.icon,_=x===o.value;return e.jsxs("button",{onClick:()=>P(o.value),className:`whitespace-nowrap inline-flex items-center gap-2 px-4 py-2 rounded-lg transition-all ${_?"bg-primary text-white shadow-lg":"bg-white dark:bg-slate-900 text-foreground border border-border hover:bg-muted"}`,children:[e.jsx(l,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:o.label}),o.value==="all"&&e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-white/20",children:p.length})]},o.value)})})})}),e.jsx("div",{className:"space-y-4",children:e.jsx(M,{mode:"popLayout",children:g.length===0?e.jsx(C.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},children:e.jsx(R,{icon:O,title:x==="all"?"Nenhuma postagem ainda":"Nenhum post deste tipo",description:b?"Crie a primeira postagem para seus alunos!":"Aguarde seu professor publicar algo.",actionLabel:b?"Criar Postagem":null,onAction:b?()=>y(!0):null})}):g.map((o,l)=>e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:l*.05},children:e.jsx(be,{post:o,isTeacher:b,onLike:()=>N(o.id),onPin:()=>q(o.id,o.is_pinned),onDelete:()=>S(o.id),onToggleComments:()=>K(o.id,o.comments_enabled),onRefresh:E})},o.id))})}),i&&e.jsx(fe,{isOpen:i,onClose:()=>y(!1),onSubmit:n})]}):e.jsx(R,{icon:O,title:"Turma nÃ£o encontrada",description:"NÃ£o foi possÃ­vel carregar o mural da turma",actionLabel:"Voltar",onAction:()=>r("/dashboard/classes")})};export{Be as default};
