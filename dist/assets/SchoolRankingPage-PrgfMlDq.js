import{u as J,r as n,s as d,j as e,L as K,x as i,y as o,U as Q,B as V,Z as C,F as A,H as R,I as W,m as f,an as p,ao as u,ap as j,A as Y}from"./main-BrBEgNdp.js";import{B as b}from"./badge-visb3evj.js";import{s as ee}from"./schoolService-BY_umBY5.js";import{T as P}from"./trophy-zpUL2ku0.js";import{F as T}from"./flame-0OP1skRj.js";import{T as X}from"./target-OgemXVCl.js";import{C as _}from"./crown-CG3W3WII.js";import{M as N}from"./medal-B-MPuGSG.js";const ce=()=>{const{user:w}=J(),[L,k]=n.useState(!0),[a,y]=n.useState([]),[q,B]=n.useState({}),[c,D]=n.useState("global"),[v,E]=n.useState([]),[m,I]=n.useState(null),[g,M]=n.useState({totalStudents:0,totalClasses:0,avgXP:0,topStreak:0});n.useEffect(()=>{w&&F()},[w]);const F=async()=>{k(!0);try{await $(),await G(),await U(),await Z()}catch(s){console.error("Erro ao carregar dados:",s)}finally{k(!1)}},$=async()=>{const s=await ee.getUserSchool(w.id);s&&I({id:s.id,name:s.name})},G=async()=>{if(!m?.id)return;const{data:s}=await d.from("school_classes").select(`
        class_id,
        classes:class_id (
          id,
          name,
          created_by
        )
      `).eq("school_id",m.id);if(s){const t=s.map(l=>l.classes).filter(Boolean);E(t);for(const l of t)await H(l.id)}},U=async()=>{if(!m?.id)return;const{data:s}=await d.from("school_classes").select("class_id").eq("school_id",m.id);if(!s||s.length===0){y([]);return}const t=s.map(h=>h.class_id),{data:l}=await d.from("class_members").select("user_id").in("class_id",t).eq("role","student");if(!l||l.length===0){y([]);return}const x=[...new Set(l.map(h=>h.user_id))],{data:r}=await d.from("gamification_profiles").select(`
        user_id,
        xp_total,
        level,
        current_streak,
        badges_earned,
        missions_completed,
        profiles:user_id (
          name,
          avatar_url
        )
      `).in("user_id",x).order("xp_total",{ascending:!1}).limit(100);y(r||[])},H=async s=>{const{data:t}=await d.from("class_members").select("user_id").eq("class_id",s).eq("role","student");if(!t||t.length===0)return;const l=t.map(r=>r.user_id),{data:x}=await d.from("gamification_profiles").select(`
        user_id,
        xp_total,
        level,
        current_streak,
        badges_earned,
        profiles:user_id (
          name,
          avatar_url
        )
      `).in("user_id",l).order("xp_total",{ascending:!1});B(r=>({...r,[s]:x||[]}))},Z=async()=>{if(a.length===0)return;const s=a.length,t=v.length,l=Math.round(a.reduce((r,h)=>r+h.xp_total,0)/s),x=Math.max(...a.map(r=>r.current_streak||0));M({totalStudents:s,totalClasses:t,avgXP:l,topStreak:x})},z=s=>{switch(s){case 1:return e.jsx(_,{className:"w-6 h-6 text-yellow-500"});case 2:return e.jsx(N,{className:"w-6 h-6 text-gray-400"});case 3:return e.jsx(N,{className:"w-6 h-6 text-amber-600"});default:return e.jsxs("span",{className:"text-lg font-bold text-muted-foreground",children:["#",s]})}},O=s=>s===1?e.jsx(b,{className:"bg-gradient-to-r from-yellow-400 to-amber-500 text-white",children:"üèÜ 1¬∫ Lugar"}):s===2?e.jsx(b,{className:"bg-gradient-to-r from-gray-300 to-gray-400 text-white",children:"ü•à 2¬∫ Lugar"}):s===3?e.jsx(b,{className:"bg-gradient-to-r from-amber-500 to-orange-600 text-white",children:"ü•â 3¬∫ Lugar"}):e.jsxs(b,{variant:"outline",children:[s,"¬∫"]}),S=c==="global"?a:q[c]||[];return L?e.jsx(K,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent flex items-center gap-3",children:[e.jsx(P,{className:"w-8 h-8 text-blue-600"}),"Ranking de Alunos - ",m?.name]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Desempenho de todos os alunos da institui√ß√£o"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(i,{children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total de Alunos"}),e.jsx("p",{className:"text-2xl font-bold",children:g.totalStudents})]}),e.jsx(Q,{className:"w-8 h-8 text-blue-500"})]})})}),e.jsx(i,{children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Turmas Ativas"}),e.jsx("p",{className:"text-2xl font-bold",children:g.totalClasses})]}),e.jsx(V,{className:"w-8 h-8 text-purple-500"})]})})}),e.jsx(i,{children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"XP M√©dio"}),e.jsx("p",{className:"text-2xl font-bold",children:g.avgXP})]}),e.jsx(C,{className:"w-8 h-8 text-yellow-500"})]})})}),e.jsx(i,{children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Maior Sequ√™ncia"}),e.jsxs("p",{className:"text-2xl font-bold",children:[g.topStreak," dias"]})]}),e.jsx(T,{className:"w-8 h-8 text-orange-500"})]})})})]}),e.jsx(i,{children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(X,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("label",{className:"text-sm font-medium",children:"Filtrar por Turma:"}),e.jsxs("select",{value:c,onChange:s=>D(s.target.value),className:"flex-1 md:flex-none md:w-64 px-4 py-2 border rounded-lg bg-white dark:bg-slate-900 text-foreground border-border",children:[e.jsx("option",{value:"global",children:"üåê Ranking Global da Escola"}),v.map(s=>e.jsxs("option",{value:s.id,children:["üìö ",s.name]},s.id))]})]})})}),e.jsxs(i,{children:[e.jsxs(A,{children:[e.jsx(R,{children:c==="global"?"Top Alunos da Escola":`Top Alunos - ${v.find(s=>s.id===c)?.name}`}),e.jsx(W,{children:"Classifica√ß√£o baseada em XP total"})]}),e.jsx(o,{children:S.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(P,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4 opacity-30"}),e.jsx("p",{className:"text-muted-foreground",children:"Nenhum aluno encontrado nesta visualiza√ß√£o"})]}):e.jsx("div",{className:"space-y-3",children:S.map((s,t)=>e.jsxs(f.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:t*.05},className:`flex items-center gap-4 p-4 rounded-xl border transition-all hover:shadow-lg ${t<3?"bg-gradient-to-r from-amber-50 via-yellow-50 to-orange-50 border-amber-200 shadow-md":"bg-card hover:bg-accent"}`,children:[e.jsx("div",{className:"flex-shrink-0 w-14 flex items-center justify-center",children:z(t+1)}),e.jsxs(p,{className:`${t<3?"w-14 h-14 ring-2 ring-amber-300":"w-12 h-12"}`,children:[e.jsx(u,{src:s.profiles?.avatar_url}),e.jsx(j,{className:"bg-gradient-to-br from-blue-500 to-indigo-500 text-white font-bold",children:s.profiles?.name?.charAt(0)||"?"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:`font-semibold truncate ${t<3?"text-lg":""}`,children:s.profiles?.name||"Aluno"}),O(t+1)]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(C,{className:"w-4 h-4 text-yellow-500"}),"N√≠vel ",s.level]}),s.current_streak>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4 text-orange-500"}),s.current_streak," dias"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Y,{className:"w-4 h-4 text-purple-500"}),s.badges_earned||0," badges"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"w-4 h-4 text-green-500"}),s.missions_completed||0," miss√µes"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:`font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent ${t<3?"text-3xl":"text-2xl"}`,children:s.xp_total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"XP Total"})]})]},s.user_id))})})]}),c==="global"&&a.length>=3&&e.jsxs(i,{className:"bg-gradient-to-br from-amber-50 to-orange-50",children:[e.jsx(A,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-6 h-6 text-yellow-500"}),"P√≥dio dos Campe√µes"]})}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-end justify-center gap-4 py-8",children:[a[1]&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"flex flex-col items-center",children:[e.jsxs(p,{className:"w-20 h-20 ring-4 ring-gray-300 mb-2",children:[e.jsx(u,{src:a[1].profiles?.avatar_url}),e.jsx(j,{className:"bg-gradient-to-br from-gray-400 to-gray-500 text-white text-xl",children:a[1].profiles?.name?.charAt(0)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-300 to-gray-400 text-white px-6 py-8 rounded-t-lg text-center min-w-[120px]",children:[e.jsx(N,{className:"w-8 h-8 mx-auto mb-2"}),e.jsx("p",{className:"font-bold text-sm mb-1",children:a[1].profiles?.name}),e.jsx("p",{className:"text-2xl font-bold",children:a[1].xp_total}),e.jsx("p",{className:"text-xs opacity-90",children:"XP"})]})]}),a[0]&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"flex flex-col items-center",children:[e.jsxs(p,{className:"w-24 h-24 ring-4 ring-yellow-400 mb-2",children:[e.jsx(u,{src:a[0].profiles?.avatar_url}),e.jsx(j,{className:"bg-gradient-to-br from-yellow-400 to-amber-500 text-white text-2xl",children:a[0].profiles?.name?.charAt(0)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-yellow-400 to-amber-500 text-white px-6 py-12 rounded-t-lg text-center min-w-[140px]",children:[e.jsx(_,{className:"w-10 h-10 mx-auto mb-2"}),e.jsx("p",{className:"font-bold mb-1",children:a[0].profiles?.name}),e.jsx("p",{className:"text-3xl font-bold",children:a[0].xp_total}),e.jsx("p",{className:"text-sm opacity-90",children:"XP"})]})]}),a[2]&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"flex flex-col items-center",children:[e.jsxs(p,{className:"w-18 h-18 ring-4 ring-amber-500 mb-2",children:[e.jsx(u,{src:a[2].profiles?.avatar_url}),e.jsx(j,{className:"bg-gradient-to-br from-amber-500 to-orange-600 text-white text-lg",children:a[2].profiles?.name?.charAt(0)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-500 to-orange-600 text-white px-6 py-6 rounded-t-lg text-center min-w-[110px]",children:[e.jsx(N,{className:"w-7 h-7 mx-auto mb-2"}),e.jsx("p",{className:"font-bold text-sm mb-1",children:a[2].profiles?.name}),e.jsx("p",{className:"text-xl font-bold",children:a[2].xp_total}),e.jsx("p",{className:"text-xs opacity-90",children:"XP"})]})]})]})})]})]})};export{ce as default};
