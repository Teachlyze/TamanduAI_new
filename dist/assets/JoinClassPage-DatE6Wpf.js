import{r as n,ak as D,g as T,al as z,j as e,s as F,x as m,F as x,a1 as L,H as u,I as h,y as f,i as l,t as $,D as v,am as H,an as G,ao as M,U as O,c as q,ap as w}from"./main-NgjJy_CG.js";import{u as B}from"./use-toast-GUBWlXfL.js";import{n as g}from"./roleNavigation-mm4rSh2G.js";import{A as b,a as I}from"./alert-CGDDrWKl.js";import{C as k}from"./classInviteService-De5A2lJT.js";import{G as A}from"./graduation-cap-AfoLybfB.js";import{U as J}from"./user-plus-DbpNqADK.js";function te(){const[X,K]=n.useState(!0),{invitationCode:c}=D(),t=T(),p=z(),{toast:N}=B(),[d,i]=n.useState("loading"),[a,P]=n.useState(null),[S,j]=n.useState(""),[o,U]=n.useState(null),[C,y]=n.useState(!1);n.useEffect(()=>{(async()=>{const{data:{user:r}}=await F.auth.getUser();U(r),!r&&c&&localStorage.setItem("pendingInvitation",c)})()},[c]),n.useEffect(()=>{c&&(async()=>{if(!c){i("error"),j("Código de convite inválido");return}try{i("loading");const r=await k.getInviteDetails(c);P(r),i(o?"preview":"not_authenticated")}catch(r){console.error("Error loading invite details:",r),i("error"),j(r.message||"Convite inválido ou expirado.")}})()},[c,o]);const _=async()=>{if(!o){t(`/login?redirect=${encodeURIComponent(p.pathname)}`);return}y(!0),i("confirming");try{const s=await k.acceptInvite(c,o.id);s.success&&(i("success"),localStorage.removeItem("pendingInvitation"),N({title:s.alreadyMember?"Você já está na turma!":"Inscrição realizada!",description:s.alreadyMember?"Você já é membro desta turma.":"Você foi adicionado à turma com sucesso!"}),setTimeout(()=>{if(s.classId)t(`/classes/${s.classId}`);else{const r=o.user_metadata?.role||"student";g(t,r)}},2e3))}catch(s){console.error("Error accepting invite:",s),i("error"),j(s.message||"Não foi possível aceitar o convite."),N({variant:"destructive",title:"Erro ao aceitar convite",description:s.message||"Ocorreu um erro. Tente novamente."})}finally{y(!1)}},E=()=>{t(`/login?redirect=${encodeURIComponent(p.pathname)}`)},R=()=>{t(`/register?redirect=${encodeURIComponent(p.pathname)}`)},V=()=>{switch(d){case"loading":return e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsx(v,{className:"h-12 w-12 animate-spin text-primary"}),e.jsx("p",{className:"text-lg font-medium",children:"Processando seu convite..."})]});case"not_authenticated":return e.jsxs(m,{className:"max-w-2xl mx-auto",children:[e.jsxs(x,{children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("div",{className:"p-3 rounded-full bg-primary/10",children:e.jsx(J,{className:"h-8 w-8 text-primary"})})}),e.jsx(u,{className:"text-center",children:"Você foi convidado para uma turma!"}),e.jsx(h,{className:"text-center",children:"Para aceitar o convite, você precisa fazer login ou criar uma conta."})]}),a&&e.jsx(f,{className:"space-y-4",children:e.jsxs(b,{children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx(I,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"font-medium",children:["Turma: ",a.class?.name]}),a.class?.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:a.class.description}),e.jsxs("p",{className:"text-sm",children:["Professor: ",a.class?.teacher?.full_name||"Professor"]})]})})]})}),e.jsxs(w,{className:"flex flex-col gap-3",children:[e.jsx(l,{onClick:E,className:"w-full",size:"lg",children:"Fazer Login"}),e.jsx(l,{onClick:R,variant:"outline",className:"bg-white dark:bg-slate-900 text-foreground border-border w-full",size:"lg",children:"Criar Conta"})]})]});case"preview":return e.jsxs(m,{className:"max-w-2xl mx-auto",children:[e.jsxs(x,{children:[e.jsx(u,{className:"text-center text-2xl",children:"Você foi convidado para esta turma"}),e.jsx(h,{className:"text-center",children:"Revise as informações abaixo e confirme se deseja entrar"})]}),e.jsxs(f,{className:"space-y-6",children:[e.jsxs("div",{className:"border rounded-lg p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-primary/10",children:e.jsx(A,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("h3",{className:"text-xl font-semibold",children:a?.class?.name}),a?.class?.description&&e.jsx("p",{className:"text-muted-foreground",children:a.class.description})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t",children:[e.jsxs(H,{children:[e.jsx(G,{src:a?.class?.teacher?.avatar_url}),e.jsx(M,{children:a?.class?.teacher?.full_name?.charAt(0)||"P"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Professor"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a?.class?.teacher?.full_name||"Professor"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(O,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Você entrará como: ",e.jsx("strong",{children:a?.role==="student"?"Aluno":"Professor"})]})]})]}),e.jsxs(b,{children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx(I,{children:"Ao confirmar, você será adicionado à turma e terá acesso a todos os materiais e atividades."})]})]}),e.jsxs(w,{className:"flex gap-3",children:[e.jsx(l,{variant:"outline",onClick:()=>t("/"),className:"flex-1",children:"Cancelar"}),e.jsx(l,{onClick:_,disabled:C,className:"flex-1",children:C?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"mr-2 h-4 w-4 animate-spin"}),"Confirmando..."]}):"Confirmar e Entrar"})]})]});case"confirming":return e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsx(v,{className:"h-12 w-12 animate-spin text-primary"}),e.jsx("p",{className:"text-lg font-medium",children:"Adicionando você à turma..."})]});case"success":return e.jsxs(m,{className:"max-w-md mx-auto",children:[e.jsxs(x,{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-green-100",children:e.jsx($,{className:"h-6 w-6 text-green-600"})}),e.jsx(u,{className:"mt-4",children:"Inscrição realizada com sucesso!"}),e.jsx(h,{children:"Você foi adicionado à turma. Redirecionando..."})]}),e.jsx(f,{className:"flex justify-center",children:e.jsx(l,{onClick:()=>{const s=o?.user_metadata?.role||"student";g(t,s)},children:"Ir para o painel agora"})})]});case"error":return e.jsxs(m,{className:"max-w-md mx-auto",children:[e.jsxs(x,{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-red-100",children:e.jsx(L,{className:"h-6 w-6 text-red-600"})}),e.jsx(u,{className:"mt-4",children:"Não foi possível processar o convite"}),e.jsx(h,{className:"text-red-600",children:S||"O link de convite é inválido ou expirou."})]}),e.jsxs(f,{className:"flex flex-col items-center space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Verifique se o link está correto ou peça um novo convite ao professor."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>t("/"),children:"Página inicial"}),e.jsx(l,{onClick:()=>{const s=o?.user_metadata?.role||"student";g(t,s)},children:"Ir para o painel"})]})]})]});default:return null}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-background to-muted/20",children:e.jsx("div",{className:"container max-w-4xl py-12 px-4",children:e.jsxs(PremiumCard,{variant:"elevated",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold tracking-tight",children:"Convite para Turma"}),e.jsx("p",{className:"text-muted-foreground mt-2 text-lg",children:d==="loading"?"Carregando informações do convite...":d==="not_authenticated"?"Faça login para aceitar o convite":d==="preview"?"Revise as informações da turma":d==="confirming"?"Processando sua inscrição...":d==="success"?"Você foi adicionado à turma com sucesso!":"Não foi possível processar o convite"})]}),e.jsx("div",{className:"flex justify-center",children:V()})]})})})}export{te as default};
