import{u as w,r as o,j as e,o as E,U as v,s as d,ac as u}from"./main-Bujpyeg-.js";import{P as b}from"./PremiumCard-BaDWg06v.js";import{P as N}from"./PremiumButton-skKgx_xy.js";import{E as S}from"./EmptyState-CpVlA95H.js";const B=()=>{const{user:s}=w(),[y,x]=o.useState(!0),[f,p]=o.useState([]),[g,i]=o.useState(""),[h,l]=o.useState(!1),[n,j]=o.useState("");return o.useEffect(()=>{if(!s?.id)return;(async()=>{x(!0),i("");try{const{data:r,error:t}=await d.from("class_members").select("class:classes(id, name, subject, color, created_by, is_active)").eq("user_id",s.id).eq("role","student").order("created_at",{ascending:!1});if(t)throw t;const c=(r||[]).map(m=>m.class).filter(Boolean);p(c)}catch(r){console.error("Erro ao carregar turmas do aluno:",r),i("Não foi possível carregar suas turmas.")}finally{x(!1)}})()},[s?.id]),y?e.jsx(E,{message:"Carregando suas turmas..."}):e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"bg-gradient-to-br from-emerald-600 to-teal-600 p-8 rounded-2xl text-white",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-3",children:[e.jsx(v,{className:"w-6 h-6"})," Minhas Turmas"]}),e.jsx("p",{className:"text-white/90",children:"Veja as turmas das quais você participa"})]}),e.jsx(b,{variant:"elevated",children:e.jsxs("div",{className:"p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Entrar em uma turma com código"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("input",{type:"text",placeholder:"Código da turma",value:n,onChange:a=>j(a.target.value.trim()),className:"flex-1 px-3 py-2 rounded-lg border border-border bg-background"}),e.jsx(N,{variant:"gradient",disabled:!n||h,onClick:async()=>{if(!(!s?.id||!n)){l(!0),i("");try{const{data:a,error:r}=await d.from("classes").select("id, name").eq("invite_code",n).maybeSingle();if(r)throw r;if(!a){u.error?.("Código inválido."),l(!1);return}const{error:t}=await d.from("class_members").insert({class_id:a.id,user_id:s.id,role:"student",joined_at:new Date().toISOString()});if(t&&t.code!=="23505")throw t;u.success?.(`Você entrou na turma ${a.name}.`),j("");const{data:c}=await d.from("class_members").select("class:classes(id, name, subject, color, created_by, is_active)").eq("user_id",s.id).eq("role","student").order("created_at",{ascending:!1}),m=(c||[]).map(_=>_.class).filter(Boolean);p(m)}catch(a){console.error("Erro ao entrar na turma:",a),i("Não foi possível entrar na turma."),u.error?.("Não foi possível entrar na turma.")}finally{l(!1)}}},children:h?"Entrando...":"Entrar"})]})]})}),g&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md text-sm",children:g}),f.length===0?e.jsx(S,{icon:v,title:"Você ainda não participa de nenhuma turma",description:"Peça ao seu professor um código de convite para entrar em uma turma.",action:e.jsx(N,{variant:"gradient",size:"sm",onClick:()=>window.location.assign("/join/"),children:"Entrar em uma turma"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:f.map(a=>e.jsx(b,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-bold",children:a.name}),e.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-emerald-100 text-emerald-700",children:a.is_active?"Ativa":"Inativa"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.subject||"Sem disciplina"})]})},a.id))})]})};export{B as default};
