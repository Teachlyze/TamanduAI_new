import{f as G,u as E,g as O,r as d,s as N,$ as Q,U,a0 as D,k as M,d as F,j as e,m as a,W as C,B,l as L,Z as A,S as K,bG as X,X as Z,a5 as V,C as W,a2 as J,z as Y,a7 as ee,bH as te}from"./main-Bujpyeg-.js";import{B as j}from"./badge-BFkPUQ-P.js";import{T as se}from"./trophy-BvMu_Ocx.js";import{B as I}from"./bell-Cp3o7t82.js";import{T as ae}from"./target-BbDyQUob.js";import{C as $}from"./chevron-left-v67NpT9C.js";import{U as S}from"./user-CNukLUU_.js";import{P as re}from"./PremiumButton-skKgx_xy.js";import{B as w}from"./bot-W1aPrpb0.js";import{S as ie}from"./sparkles-BvEmMhAS.js";import{L as ne}from"./lightbulb-CxR16eTw.js";import{S as le}from"./send-D6bioMOQ.js";import{M as oe}from"./message-circle-BwRBSWf9.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],ce=G("circle-question-mark",de),me=({collapsed:s,setCollapsed:b})=>{const{user:n,signOut:x}=E(),l=O(),[i,h]=d.useState({xp:0,level:1,streak:0}),[o,g]=d.useState(0);d.useEffect(()=>{n&&(u(),v())},[n]);const u=async()=>{try{const{data:r}=await N.from("gamification_profiles").select("xp_total, level, current_streak").eq("user_id",n.id).single();r&&h({xp:r.xp_total||0,level:r.level||1,streak:r.current_streak||0})}catch(r){console.error("Erro ao carregar gamificaÃ§Ã£o:",r)}},v=async()=>{try{const{count:r}=await N.from("notifications").select("*",{count:"exact",head:!0}).eq("user_id",n.id).eq("read",!1);g(r||0)}catch(r){console.error("Erro ao carregar notificaÃ§Ãµes:",r)}},T=[{label:"Dashboard",icon:Q,path:"/students",tourId:"nav-student-dashboard",gradient:"from-blue-500 to-cyan-500"},{label:"Minhas Turmas",icon:U,path:"/students/classes",tourId:"nav-student-classes",gradient:"from-teal-500 to-emerald-500"},{label:"Minhas Atividades",icon:D,path:"/students/activities",tourId:"nav-student-activities",gradient:"from-purple-500 to-pink-500"},{label:"GamificaÃ§Ã£o",icon:se,path:"/students/gamification",tourId:"nav-student-gamification",gradient:"from-yellow-500 to-orange-500",badge:i.level},{label:"Meu Desempenho",icon:M,path:"/students/performance",tourId:"nav-student-performance",gradient:"from-rose-500 to-pink-500"},{label:"NotificaÃ§Ãµes",icon:I,path:"/students/notifications",tourId:"nav-student-notifications",gradient:"from-orange-500 to-red-500",badge:o>0?o:null},{label:"Agenda",icon:F,path:"/students/calendar",tourId:"nav-student-calendar",gradient:"from-green-500 to-emerald-500"},{label:"Ranking",icon:M,path:"/students/ranking",tourId:"nav-student-ranking",gradient:"from-amber-500 to-yellow-500"},{label:"MissÃµes",icon:ae,path:"/students/missions",tourId:"nav-student-missions",gradient:"from-orange-500 to-red-500"},{label:"HistÃ³rico",icon:D,path:"/students/history",tourId:"nav-student-history",gradient:"from-slate-500 to-gray-600"}],H=async()=>{await x(),l("/login")};return e.jsx(a.aside,{initial:{x:-300},animate:{x:0,width:s?80:280},transition:{type:"spring",damping:20},className:"fixed left-0 top-0 h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 dark:from-blue-900/30 dark:via-purple-900/30 dark:to-pink-900/30 border-r border-blue-200/50 dark:border-blue-700/50 backdrop-blur-xl z-40 overflow-hidden shadow-2xl",children:e.jsxs("div",{className:"flex flex-col h-full p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx(C,{mode:"wait",children:!s&&e.jsxs(a.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 via-purple-500 to-pink-500 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(B,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"TamanduAI"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Aluno"})]})]})}),e.jsx(a.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>b(!s),className:"p-2 rounded-lg hover:bg-muted transition-colors",children:s?e.jsx(L,{className:"w-5 h-5"}):e.jsx($,{className:"w-5 h-5"})})]}),!s&&e.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-6 p-4 rounded-2xl bg-gradient-to-br from-blue-500 via-purple-500 to-pink-500 text-white relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-10",children:e.jsx("div",{className:"absolute inset-0",style:{backgroundImage:"radial-gradient(circle at 2px 2px, white 1px, transparent 0)",backgroundSize:"24px 24px"}})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center",children:e.jsx(S,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm truncate",children:n?.user_metadata?.name?.split(" ")[0]||"Estudante"}),e.jsx("p",{className:"text-xs text-white/80 truncate",children:n?.email})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(j,{className:"bg-white/20 backdrop-blur-sm border-white/30 text-white text-xs",children:[e.jsx(A,{className:"w-3 h-3 mr-1"}),"NÃ­vel ",i.level]}),i.streak>0&&e.jsxs(j,{className:"bg-white/20 backdrop-blur-sm border-white/30 text-white text-xs",children:["ðŸ”¥ ",i.streak,"d"]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[e.jsxs("span",{className:"text-white/90 flex items-center gap-1",children:[e.jsx(K,{className:"w-3 h-3"}),"XP"]}),e.jsxs("span",{className:"font-bold",children:[i.xp%100,"/100"]})]}),e.jsx("div",{className:"w-full bg-white/20 rounded-full h-2 overflow-hidden relative",children:e.jsx(a.div,{initial:{width:0},animate:{width:`${i.xp%100}%`},transition:{duration:1,type:"spring"},className:"h-full bg-gradient-to-r from-yellow-300 via-yellow-200 to-white rounded-full shadow-lg"})}),e.jsxs("p",{className:"text-xs text-white/70 mt-1 text-center",children:[100-i.xp%100," XP para prÃ³ximo nÃ­vel"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-3",children:[e.jsxs(a.div,{whileHover:{scale:1.05},className:"text-center p-1.5 rounded-lg bg-white/10 backdrop-blur-sm",children:[e.jsx("div",{className:"text-sm font-bold text-yellow-300",children:i.badges||0}),e.jsx("div",{className:"text-xs text-white/80",children:"Badges"})]}),e.jsxs(a.div,{whileHover:{scale:1.05},className:"text-center p-1.5 rounded-lg bg-white/10 backdrop-blur-sm",children:[e.jsx("div",{className:"text-sm font-bold text-green-300",children:i.completed||0}),e.jsx("div",{className:"text-xs text-white/80",children:"ConcluÃ­das"})]}),e.jsxs(a.div,{whileHover:{scale:1.05},className:"text-center p-1.5 rounded-lg bg-white/10 backdrop-blur-sm",children:[e.jsx("div",{className:"text-sm font-bold text-blue-300",children:i.rank||"-"}),e.jsx("div",{className:"text-xs text-white/80",children:"Ranking"})]})]})]})]}),e.jsx("nav",{className:"flex-1 space-y-1 overflow-y-auto scrollbar-thin scrollbar-thumb-muted",children:T.map((r,_)=>{const y=r.icon;return e.jsx(X,{to:r.path,"data-tour-id":r.tourId||void 0,className:({isActive:f})=>`group flex items-center gap-3 px-3 py-3 rounded-xl transition-all duration-200 ${f?"bg-gradient-to-r "+r.gradient+" text-white shadow-lg scale-105":"hover:bg-muted text-muted-foreground hover:text-foreground"}`,children:({isActive:f})=>e.jsxs(e.Fragment,{children:[e.jsx(a.div,{whileHover:{scale:1.1,rotate:5},whileTap:{scale:.95},className:`p-2 rounded-lg ${f?"bg-white/20":"bg-muted"}`,children:e.jsx(y,{className:"w-5 h-5"})}),e.jsx(C,{mode:"wait",children:!s&&e.jsxs(a.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},className:"flex-1 flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:r.label}),r.badge&&e.jsx(j,{className:`${f?"bg-white/20 text-white":"bg-primary/10 text-primary"} text-xs`,children:r.badge})]})})]})},r.path)})}),e.jsxs("div",{className:"space-y-2 pt-4 border-t border-border/50",children:[e.jsxs(a.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>l("/students/notifications"),className:`w-full flex items-center gap-3 px-3 py-3 rounded-xl hover:bg-muted text-muted-foreground hover:text-foreground transition-all relative ${s?"justify-center":""}`,children:[e.jsxs("div",{className:"p-2 rounded-lg bg-muted relative",children:[e.jsx(I,{className:"w-5 h-5"}),o>0&&e.jsx(a.div,{initial:{scale:0},animate:{scale:1},className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:o})]}),!s&&e.jsx("span",{className:"font-medium",children:"NotificaÃ§Ãµes"})]}),e.jsxs(a.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>l("/students/settings"),className:`w-full flex items-center gap-3 px-3 py-3 rounded-xl hover:bg-muted text-muted-foreground hover:text-foreground transition-all ${s?"justify-center":""}`,children:[e.jsx("div",{className:"p-2 rounded-lg bg-muted",children:e.jsx(Z,{className:"w-5 h-5"})}),!s&&e.jsx("span",{className:"font-medium",children:"ConfiguraÃ§Ãµes"})]}),e.jsxs(a.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>l("/profile/edit"),className:`w-full flex items-center gap-3 px-3 py-3 rounded-xl hover:bg-muted text-muted-foreground hover:text-foreground transition-all ${s?"justify-center":""}`,children:[e.jsx("div",{className:"p-2 rounded-lg bg-muted",children:e.jsx(S,{className:"w-5 h-5"})}),!s&&e.jsx("span",{className:"font-medium",children:"Editar Perfil"})]}),e.jsxs(a.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:H,className:`w-full flex items-center gap-3 px-3 py-3 rounded-xl hover:bg-red-50 dark:hover:bg-red-900/20 text-muted-foreground hover:text-red-600 transition-all ${s?"justify-center":""}`,children:[e.jsx("div",{className:"p-2 rounded-lg bg-muted",children:e.jsx(V,{className:"w-5 h-5"})}),!s&&e.jsx("span",{className:"font-medium",children:"Sair"})]})]})]})})},xe=({collapsed:s,setCollapsed:b,classId:n=null,activityId:x=null})=>{const{user:l}=E(),[i,h]=d.useState([]),[o,g]=d.useState(""),[u,v]=d.useState(!1),[T,H]=d.useState([]),r=d.useRef(null);d.useEffect(()=>{l&&(n||x)&&y()},[l,n,x]),d.useEffect(()=>{_()},[i]);const _=()=>{r.current?.scrollIntoView({behavior:"smooth"})},y=async()=>{try{const{data:t,error:p}=await N.from("chatbot_conversations").select("*").eq("user_id",l.id).eq("class_id",n||"general").order("created_at",{ascending:!0}).limit(50);if(p)throw p;const c=t?.map(m=>({id:m.id,content:m.message,role:m.role,timestamp:new Date(m.created_at),sources:m.metadata?.sources||[]}))||[];h(c)}catch(t){console.error("Erro ao carregar histÃ³rico:",t)}},f=async()=>{if(!o.trim()||u)return;const t=o.trim(),p={id:Date.now(),content:t,role:"user",timestamp:new Date};h(c=>[...c,p]),g(""),v(!0);try{const{data:c,error:m}=await N.functions.invoke("chatbot-rag",{body:{class_id:n||"general",activity_id:x,user_id:l.id,message:t,context:{isStudent:!0,currentPage:window.location.pathname}}});if(m)throw m;const k={id:Date.now()+1,content:c?.answer||"Desculpe, nÃ£o consegui processar sua pergunta no momento.",role:"assistant",timestamp:new Date,sources:c?.sources||[]};h(q=>[...q,k])}catch(c){console.error("Erro ao enviar mensagem:",c);const m={id:Date.now()+1,content:"Desculpe, estou temporariamente indisponÃ­vel. Tente novamente em alguns minutos.",role:"assistant",timestamp:new Date,sources:[]};h(k=>[...k,m]),Y.error("Erro ao conectar com o assistente IA")}finally{v(!1)}},z=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),f())},P=[{icon:ce,text:"Como fazer esta atividade?",category:"ajuda"},{icon:B,text:"Explique este conceito",category:"conceito"},{icon:ne,text:"DÃª uma dica",category:"dica"},{icon:W,text:"Quando Ã© o prazo?",category:"prazo"}],R=t=>{g(t)};return e.jsx(a.aside,{initial:{x:400},animate:{x:0,width:s?60:380},transition:{type:"spring",damping:20},className:"fixed right-0 top-0 h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-blue-900/20 dark:via-indigo-900/20 dark:to-purple-900/20 border-l border-border/50 backdrop-blur-xl z-30 overflow-hidden",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border/50",children:[e.jsx(C,{mode:"wait",children:!s&&e.jsxs(a.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 via-indigo-500 to-purple-500 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(w,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Assistente IA"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n?"Contextual da turma":"Geral"})]})]})}),e.jsx(a.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>b(!s),className:"p-2 rounded-lg hover:bg-muted transition-colors",children:s?e.jsx($,{className:"w-5 h-5"}):e.jsx(L,{className:"w-5 h-5"})})]}),!s&&e.jsxs("div",{className:"flex-1 flex flex-col",children:[(n||x)&&e.jsx("div",{className:"p-3 bg-gradient-to-r from-blue-500/10 to-purple-500/10 border-b border-border/30",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ie,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-muted-foreground",children:x?"Contexto: Atividade atual":"Contexto: Turma atual"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 scrollbar-thin scrollbar-thumb-muted",children:[i.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(w,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"OlÃ¡! Sou seu assistente IA. Como posso ajudar?"})]}),i.map(t=>e.jsxs(a.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex gap-3 ${t.role==="user"?"justify-end":"justify-start"}`,children:[t.role==="assistant"&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center flex-shrink-0",children:e.jsx(w,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:`max-w-[280px] rounded-2xl p-3 ${t.role==="user"?"bg-gradient-to-r from-blue-500 to-purple-500 text-white":"bg-white dark:bg-gray-800 border border-border shadow-sm"}`,children:[e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.content}),t.sources&&t.sources.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-border/30",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Fontes:"}),t.sources.map((p,c)=>e.jsx(j,{variant:"outline",className:"text-xs mr-1",children:p},c))]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:t.timestamp.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})})]}),t.role==="user"&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-green-500 to-teal-500 flex items-center justify-center flex-shrink-0",children:e.jsx(S,{className:"w-4 h-4 text-white"})})]},t.id)),u&&e.jsxs(a.div,{initial:{opacity:0},animate:{opacity:1},className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center",children:e.jsx(w,{className:"w-4 h-4 text-white"})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 border border-border rounded-2xl p-3",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})]}),e.jsx("div",{ref:r})]}),i.length===0&&e.jsxs("div",{className:"p-4 border-t border-border/30",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:"Perguntas rÃ¡pidas:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:P.map((t,p)=>e.jsx(a.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>R(t.text),className:"p-2 text-xs bg-white dark:bg-gray-800 border border-border rounded-lg hover:bg-muted transition-colors text-left",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t.icon,{className:"w-3 h-3 text-blue-500"}),e.jsx("span",{className:"truncate",children:t.text})]})},p))})]}),e.jsx("div",{className:"p-4 border-t border-border/50",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(J,{value:o,onChange:t=>g(t.target.value),onKeyPress:z,placeholder:"Digite sua pergunta...",className:"flex-1 text-sm",disabled:u}),e.jsx(re,{onClick:f,disabled:!o.trim()||u,size:"sm",className:"px-3",children:u?e.jsx(A,{className:"w-4 h-4 animate-pulse"}):e.jsx(le,{className:"w-4 h-4"})})]})})]}),s&&e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-2",children:[e.jsx(a.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>b(!1),className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-500 rounded-xl flex items-center justify-center text-white shadow-lg mb-4",children:e.jsx(oe,{className:"w-6 h-6"})}),i.length>0&&e.jsx(j,{className:"bg-red-500 text-white text-xs",children:i.filter(t=>t.role==="assistant"&&!t.read).length||""})]})]})})},Se=()=>{const[s,b]=d.useState(!1),[n,x]=d.useState(!0),l=ee(),i=l.pathname.includes("/classes/"),h=l.pathname.includes("/activities/"),o=i||h,g=l.pathname.match(/\/classes\/([^\/]+)/)?.[1],u=l.pathname.match(/\/activities\/([^\/]+)/)?.[1];return e.jsxs("div",{className:"flex h-screen overflow-hidden bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 dark:from-blue-900/20 dark:via-purple-900/20 dark:to-pink-900/20",children:[e.jsx(me,{collapsed:s,setCollapsed:b}),e.jsx(a.main,{animate:{marginLeft:s?0:280,marginRight:o?n?60:380:0},transition:{type:"spring",damping:20},className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"min-h-full p-6",children:e.jsx(te,{})})}),o&&e.jsx(xe,{collapsed:n,setCollapsed:x,classId:g,activityId:u})]})};export{Se as default};
