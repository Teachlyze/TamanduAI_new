import{u as B,r as l,s as o,z as T,U as c,B as w,C as p,j as e,m as I,A as L,b as x,c as y,d as b,V as O,e as V,M as F}from"./main-NgjJy_CG.js";import{S as H,P as v,F as U}from"./PremiumCard-BGO_It48.js";import{E as S}from"./EmptyState-Cb7n_MKP.js";import{B as k}from"./bell-CBDdgVV_.js";import"./PremiumButton-DDGOGflQ.js";const X=()=>{const{user:n}=B(),[C,f]=l.useState(!0),[t,_]=l.useState({classes:[],activities:[],students:[],meetings:[],pendingActivities:[],recentNotifications:[]});l.useEffect(()=>{n&&A()},[n]);const A=async()=>{try{f(!0),console.log("🔄 Carregando dados do dashboard...");const{data:s,error:a}=await o.from("classes").select("id").eq("created_by",n.id);if(a)throw a;const r=s?.map(i=>i.id)||[],[m,d,u,g]=await Promise.all([o.from("classes").select("*").eq("created_by",n.id),o.from("activities").select("id, title, created_at, due_date, status").eq("created_by",n.id).order("created_at",{ascending:!1}).limit(10),r.length>0?o.from("class_members").select("user_id").in("class_id",r).eq("role","student"):{data:[],error:null},o.from("submissions").select("id, activity_id, submitted_at, student_id").is("grade",null).order("submitted_at",{ascending:!1}).limit(100)]);if(m.error)throw m.error;if(d.error)throw d.error;if(u.error)throw u.error;if(g.error)throw g.error;const P=d.data?.map(i=>i.id)||[],R=g.data?.filter(i=>P.includes(i.activity_id))||[],q=await Promise.all(R.slice(0,5).map(async i=>{const h=d.data?.find(M=>M.id===i.activity_id);return{...i,activities:h?{title:h.title,due_date:h.due_date}:null}})),z=new Set(u.data?.map(i=>i.user_id)||[]);_({classes:m.data||[],activities:d.data||[],studentsCount:z.size,pendingSubmissions:q})}catch(s){console.error("❌ Erro ao carregar dashboard:",s),T.error(`Erro ao carregar dashboard: ${s.message||"Tente novamente"}`)}finally{f(!1)}},j=[],N=l.useMemo(()=>{if(!t.pendingSubmissions||t.pendingSubmissions.length===0)return[];const s={};return t.pendingSubmissions.forEach(a=>{const r=a.activity_id;s[r]||(s[r]={id:r,title:a.activities?.title||"Atividade sem título",dueDate:a.activities?.due_date?new Date(a.activities.due_date).toLocaleDateString("pt-BR"):"Sem prazo",pending:0,submissions:[]}),s[r].pending++,s[r].submissions.push(a)}),Object.values(s).slice(0,5)},[t.pendingSubmissions]),$=l.useMemo(()=>{const s=[];if(t.pendingSubmissions&&t.pendingSubmissions.length>0&&s.push({id:1,type:"warning",message:`${t.pendingSubmissions.length} submiss${t.pendingSubmissions.length>1?"ões pendentes":"ão pendente"} de correção`}),t.activities&&t.activities.length>0){const a=t.activities[0];s.push({id:2,type:"info",message:`Atividade "${a.title||"Nova atividade"}" criada recentemente`})}return t.classes&&t.classes.length===0&&s.push({id:3,type:"info",message:"Crie sua primeira turma para começar!"}),s.slice(0,3)},[t]),D=[{title:"Turmas Ativas",value:String(t.classes?.length||0),change:t.classes?.length>0?`${t.classes.length} turma${t.classes.length>1?"s":""}`:"Crie sua primeira",trend:t.classes?.length>0?"up":"neutral",icon:c,link:"/dashboard/classes"},{title:"Atividades",value:String(t.activities?.length||0),change:t.activities?.length>0?`${t.activities.length} criada${t.activities.length>1?"s":""}`:"Nenhuma ainda",trend:t.activities?.length>0?"up":"neutral",icon:w,link:"/dashboard/activities"},{title:"Entregas Pendentes",value:String(t.pendingSubmissions?.length||0),change:t.pendingSubmissions?.length>0?"Revisar agora":"Tudo em dia",trend:t.pendingSubmissions?.length>0?"warning":"neutral",icon:p,link:"/dashboard/activities"},{title:"Total de Alunos",value:String(t.studentsCount||0),change:t.studentsCount>0?`${t.studentsCount} aluno${t.studentsCount>1?"s":""}`:"Convide alunos",trend:t.studentsCount>0?"up":"neutral",icon:c,link:"/dashboard/students"}],E=[{title:"Criar Turma",description:"Organize seus alunos em turmas",icon:c,link:"/dashboard/classes",gradient:"from-blue-500 to-blue-600"},{title:"Nova Atividade",description:"Crie atividades para suas turmas",icon:w,link:"/dashboard/activities/new",gradient:"from-purple-500 to-purple-600"},{title:"Ver Agenda",description:"Confira seus compromissos",icon:b,link:"/dashboard/calendar",gradient:"from-green-500 to-green-600"},{title:"Chatbot IA",description:"Assistente inteligente",icon:F,link:"/dashboard/chatbot",gradient:"from-orange-500 to-orange-600"}];return C?e.jsxs("div",{className:"animate-fade-in-up space-y-8",children:[e.jsx("div",{className:"skeleton h-48 w-full rounded-2xl"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(s=>e.jsx("div",{className:"skeleton h-32 rounded-xl"},s))})]}):e.jsxs("div",{className:"space-y-8 animate-fade-in-up",children:[e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-primary rounded-2xl p-8 text-white shadow-themed-lg relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-10",children:e.jsx("div",{className:"absolute inset-0",style:{backgroundImage:"radial-gradient(circle at 1px 1px, white 1px, transparent 0)",backgroundSize:"40px 40px"}})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold mb-2",children:["Bem-vindo de volta, ",n?.email?.split("@")[0]||"Professor","! 👋"]}),e.jsx("p",{className:"text-blue-100 text-lg",children:"Pronto para transformar a educação hoje?"})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(L,{className:"w-24 h-24 opacity-20"})})]})]}),e.jsx("div",{className:"stagger-children grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:D.map(s=>e.jsx(x,{to:s.link,children:e.jsx(H,{title:s.title,value:s.value,change:s.change,trend:s.trend,icon:s.icon,className:"hover-lift cursor-pointer"})},s.title))}),e.jsx(v,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-foreground mb-4 flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-primary"}),"Notificações Recentes"]}),e.jsx("div",{className:"space-y-2",children:$.map(s=>e.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-lg ${s.type==="warning"?"bg-warning/10 border border-warning/20":"bg-info/10 border border-info/20"}`,children:[s.type==="warning"?e.jsx(y,{className:"w-5 h-5 text-warning flex-shrink-0 mt-0.5"}):e.jsx(k,{className:"w-5 h-5 text-info flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm",children:s.message})]},s.id))})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(v,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-foreground mb-4 flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5 text-primary"}),"Agenda de Hoje"]}),j.length===0?e.jsx(S,{icon:b,title:"Nenhum compromisso hoje",description:"Aproveite o dia livre!"}):e.jsx("div",{className:"space-y-3",children:j.map(s=>e.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-lg border border-border hover:bg-muted/50 transition-colors",children:[e.jsx("div",{className:`p-2 rounded-lg ${s.type==="meeting"?"bg-purple-100 dark:bg-purple-900/30":"bg-blue-100 dark:bg-muted/50"}`,children:s.type==="meeting"?e.jsx(c,{className:"w-4 h-4 text-purple-600 dark:text-purple-400"}):e.jsx(O,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:s.title}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(p,{className:"w-3 h-3"}),s.time]})]})]},s.id))})]})}),e.jsx(v,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-foreground mb-4 flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5 text-warning"}),"Correções Pendentes"]}),N.length===0?e.jsx(S,{icon:V,title:"Tudo em dia!",description:"Não há submissões aguardando correção"}):e.jsx("div",{className:"space-y-3",children:N.map(s=>e.jsxs(x,{to:`/dashboard/activities/${s.id}`,className:"block p-4 rounded-lg border border-border hover:bg-muted/50 hover:border-primary/50 transition-all cursor-pointer",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium line-clamp-1",children:s.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Prazo: ",s.dueDate]})]}),e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-medium bg-warning/10 text-warning border border-warning/20 ml-2",children:[s.pending," ",s.pending===1?"pendente":"pendentes"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsx("div",{className:"flex-1 bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 h-2 rounded-full transition-all",style:{width:`${Math.min(s.pending*10,100)}%`}})}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Clique para corrigir"})]})]},s.id))})]})})]}),e.jsxs("div",{className:"bg-card rounded-xl p-6 shadow-themed border border-border",children:[e.jsxs("h2",{className:"text-xl font-bold text-foreground mb-6 flex items-center",children:[e.jsx(p,{className:"w-6 h-6 mr-2 text-primary"}),"Ações Rápidas"]}),e.jsx("div",{className:"stagger-children grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:E.map(s=>e.jsx(x,{to:s.link,children:e.jsx(U,{title:s.title,description:s.description,icon:s.icon,gradient:s.gradient,className:"h-full"})},s.title))})]})]})};export{X as default};
