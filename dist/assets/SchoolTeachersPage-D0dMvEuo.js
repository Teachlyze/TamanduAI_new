import{g as q,u as W,r,s as u,z as D,j as e,o as G,m as o,U as b,B as M,T as O,ah as S,K as Q,$ as K,am as R,an as V,ao as H,O as J}from"./main-NgjJy_CG.js";import{P as N}from"./PremiumCard-BGO_It48.js";import{P as h}from"./PremiumButton-DDGOGflQ.js";import{E as P}from"./EmptyState-Cb7n_MKP.js";import{B as X}from"./badge-DS8upoqS.js";import{s as k}from"./schoolService-0kUg_1__.js";import{U as T}from"./user-check-C-AAn5f8.js";import{U as Y}from"./user-plus-DbpNqADK.js";import{F as Z}from"./funnel-CchVKkoO.js";import{M as E}from"./mail-DQtjMnR0.js";const me=()=>{const d=q(),{user:p}=W(),[I,y]=r.useState(!0),[i,w]=r.useState([]),[C,v]=r.useState([]),[n,_]=r.useState(""),[m,U]=r.useState("all");r.useEffect(()=>{p&&z()},[p]),r.useEffect(()=>{let s=i;n&&(s=s.filter(t=>t.name?.toLowerCase().includes(n.toLowerCase())||t.email?.toLowerCase().includes(n.toLowerCase()))),m!=="all"&&(s=s.filter(t=>m==="active"?t.isActive:!t.isActive)),v(s)},[n,m,i]);const z=async()=>{try{y(!0);const s=new Promise((g,f)=>setTimeout(()=>f(new Error("Timeout ao carregar professores")),15e3)),t=(async()=>{const g=await k.getUserSchool(p.id);if(!g?.id)throw new Error("Nenhuma escola associada ao usuário");const f=await k.getTeachers(g.id);return await Promise.all((f||[]).map(async a=>{try{const{count:x}=await u.from("classes").select("*",{count:"exact",head:!0}).eq("created_by",a.id),{data:j}=await u.from("classes").select("id").eq("created_by",a.id);let A=0;if(j&&j.length>0){const L=j.map(F=>F.id),{count:$}=await u.from("class_members").select("*",{count:"exact",head:!0}).in("class_id",L).eq("role","student");A=$||0}const{count:B}=await u.from("activities").select("*",{count:"exact",head:!0}).eq("created_by",a.id);return{id:a.id,name:a.name,email:a.email,avatar_url:a.avatar,classesCount:x||0,studentsCount:A,activitiesCount:B||0,isActive:(x||0)>0}}catch(x){return console.warn("[SchoolTeachersPage] Erro ao carregar stats do professor:",a.id,x),{id:a.id,name:a.name,email:a.email,avatar_url:a.avatar,classesCount:0,studentsCount:0,activitiesCount:0,isActive:!1}}}))})(),l=await Promise.race([t,s]);w(l),v(l)}catch(s){console.error("[SchoolTeachersPage] Erro ao carregar professores:",s),D.error(s.message||"Erro ao carregar professores"),w([]),v([])}finally{y(!1)}};if(I)return e.jsx(G,{message:"Carregando professores..."});const c={total:i.length,active:i.filter(s=>s.isActive).length,inactive:i.filter(s=>!s.isActive).length,totalClasses:i.reduce((s,t)=>s+t.classesCount,0),totalStudents:i.reduce((s,t)=>s+t.studentsCount,0)};return e.jsxs("div",{className:"space-y-6 pb-8",children:[e.jsxs(o.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-blue-600 via-indigo-700 to-blue-800 p-8 text-white",children:[e.jsx("div",{className:"absolute inset-0 opacity-10",children:e.jsx("div",{className:"absolute inset-0",style:{backgroundImage:"radial-gradient(circle at 2px 2px, white 1px, transparent 0)",backgroundSize:"32px 32px"}})}),e.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(o.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",delay:.2},className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm rounded-full px-4 py-2 mb-4",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Gestão de Professores"})]}),e.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Corpo Docente 👨‍🏫"}),e.jsx("p",{className:"text-white/90 text-lg",children:"Gerencie todos os professores da instituição"})]}),e.jsx(o.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",delay:.3},children:e.jsx(h,{leftIcon:Y,onClick:()=>d("/school/teachers/new"),className:"bg-white text-blue-600 hover:bg-white/90 shadow-lg whitespace-nowrap inline-flex items-center gap-2 font-semibold",children:"Novo Professor"})})]}),e.jsx(o.div,{animate:{y:[0,-15,0],rotate:[0,5,0]},transition:{duration:4,repeat:1/0},className:"absolute top-10 right-20 text-6xl opacity-20",children:"👨‍🏫"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[{title:"Total",value:c.total,icon:b,gradient:"from-blue-600 to-indigo-700"},{title:"Ativos",value:c.active,icon:T,gradient:"from-green-600 to-emerald-700"},{title:"Inativos",value:c.inactive,icon:b,gradient:"from-gray-500 to-slate-600"},{title:"Turmas Total",value:c.totalClasses,icon:M,gradient:"from-purple-600 to-indigo-700"},{title:"Alunos Total",value:c.totalStudents,icon:O,gradient:"from-orange-600 to-red-700"}].map((s,t)=>e.jsx(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.1},children:e.jsxs(N,{variant:"elevated",className:"relative overflow-hidden group hover:scale-105 transition-transform",children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${s.gradient} opacity-5 group-hover:opacity-10 transition-opacity`}),e.jsxs("div",{className:"relative p-6",children:[e.jsx("div",{className:`p-3 rounded-xl bg-gradient-to-br ${s.gradient} text-white mb-2`,children:e.jsx(s.icon,{className:"w-6 h-6"})}),e.jsx("div",{className:"text-3xl font-bold mb-1",children:s.value}),e.jsx("div",{className:"text-sm text-slate-700 dark:text-slate-300",children:s.title})]})]})},s.title))}),e.jsx(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsx(N,{variant:"elevated",className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(S,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-700 dark:text-slate-300"}),e.jsx(Q,{placeholder:"Buscar professores por nome ou email...",value:n,onChange:s=>_(s.target.value),className:"pl-10"})]}),e.jsx("div",{className:"flex gap-2",children:["all","active","inactive"].map(s=>e.jsx(h,{variant:m===s?"default":"outline",size:"sm",onClick:()=>U(s),leftIcon:Z,className:"whitespace-nowrap inline-flex items-center gap-2 bg-white dark:bg-slate-900 text-foreground border-border",children:s==="all"?"Todos":s==="active"?"Ativos":"Inativos"},s))})]})})}),C.length===0?i.length===0?e.jsx(P,{icon:b,title:"Nenhum professor cadastrado",description:"Adicione o primeiro professor à sua instituição",action:{label:"Adicionar Professor",onClick:()=>d("/school/teachers/new")}}):e.jsx(P,{icon:S,title:"Nenhum professor encontrado",description:"Tente ajustar sua busca ou filtros"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.jsx(K,{children:C.map((s,t)=>e.jsx(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.9},transition:{delay:t*.05},layout:!0,children:e.jsx(N,{variant:"elevated",className:"group relative overflow-hidden hover:scale-105 transition-all cursor-pointer",onClick:()=>d(`/school/teachers/${s.id}`),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsxs(R,{className:"w-16 h-16",children:[e.jsx(V,{src:s.avatar_url}),e.jsx(H,{className:"bg-gradient-to-br from-blue-600 to-indigo-700 text-white text-lg font-bold",children:s.name?.charAt(0)||"P"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-lg truncate group-hover:text-primary transition-colors",children:s.name}),e.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300 truncate",children:s.email}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsx(X,{className:s.isActive?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700",children:s.isActive?"Ativo":"Inativo"})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 pt-4 border-t border-border",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:s.classesCount}),e.jsx("div",{className:"text-xs text-slate-700 dark:text-slate-300",children:"Turmas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:s.studentsCount}),e.jsx("div",{className:"text-xs text-slate-700 dark:text-slate-300",children:"Alunos"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-purple-600",children:s.activitiesCount}),e.jsx("div",{className:"text-xs text-slate-700 dark:text-slate-300",children:"Atividades"})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(h,{size:"sm",variant:"outline",leftIcon:J,onClick:l=>{l.stopPropagation(),d(`/school/teachers/${s.id}`)},className:"flex-1",children:"Ver Perfil"}),e.jsx(h,{size:"sm",variant:"outline",leftIcon:E,onClick:l=>{l.stopPropagation(),window.location.href=`mailto:${s.email}`},children:e.jsx(E,{className:"w-4 h-4"})})]})]})})},s.id))})})]})};export{me as default};
