import{u as z,g as W,r,s as k,U as V,B as M,ah as X,C as ne,j as e,m as l,x as c,y as o,H as u,I as ue,i as g,F as N,c as J,as as K,d as q,T as fe,S as be,A as Ne,a1 as se,k as ve,G as ye,at as we,au as U}from"./main-BBAlbGLj.js";import{A as ae,a as te}from"./alert-CB1jxfn1.js";import{B as v}from"./badge-Dxkfeepr.js";import{t as ie}from"./teacherSubscriptionService-ebegB__F.js";import{B as Ce}from"./bell-CENTEph2.js";import{A as _}from"./arrow-right-DKnjkfBW.js";import{P as H}from"./plus-CFMNmEOP.js";import{B as Se}from"./bot-B0G_9z0K.js";import{T as Ae}from"./triangle-alert-BOfKVf7j.js";import{f as L}from"./format-BmB7BMvl.js";import{T as I}from"./trophy-DEhtpDSd.js";import{T as ce}from"./target-DlA9JK4k.js";import{F as re}from"./flame-Dh_69keb.js";import{B as ke}from"./brain-DI03e7uS.js";import{C as G}from"./circle-check-big-9PMWtYp0.js";import{M as _e}from"./message-circle-BiQT7iX8.js";import{s as F}from"./schoolService-BvouIyFd.js";import{G as Q}from"./graduation-cap-C5vg-5On.js";import{S as De}from"./school-B6iEPBKG.js";import{S as le}from"./shield-CUW9xbMY.js";import"./en-US-C1KUdeex.js";import"./toDate-B_SDEMqy.js";const Te=()=>{const{user:n}=z(),t=W(),[h,y]=r.useState({classes:0,students:0,activities:0,pendingCorrections:0}),[m,D]=r.useState(null),[x,T]=r.useState(null),[w,j]=r.useState([]),[C,P]=r.useState([]),[f,E]=r.useState(!0),[R,a]=r.useState([]),[d,$]=r.useState([]),[B,O]=r.useState([]);r.useEffect(()=>{i()},[n]);const i=async()=>{if(n)try{E(!0);const{data:s}=await k.from("classes").select("*").eq("created_by",n.id),b=s?s.map(p=>p.id):[];y(p=>({...p,classes:s?.length||0}));const{count:oe}=await k.from("class_members").select("id",{count:"exact",head:!1}).in("class_id",b).eq("role","student");await k.from("class_members").select("id").in("class_id",b).eq("role","student").limit(0),y(p=>({...p,students:oe||0}));const{count:de}=await k.from("activities").select("id",{count:"exact",head:!1}).eq("created_by",n.id).limit(0);y(p=>({...p,activities:de||0}));const{count:me}=await k.from("submissions").select("id",{count:"exact",head:!1}).in("activities.activity_class_assignments.class_id",b).eq("status","submitted").limit(0);y(p=>({...p,pendingCorrections:me||0}));const{data:xe}=await k.from("classes").select("*").eq("teacher_id",n.id).order("created_at",{ascending:!1}).limit(6);j(xe||[]);const he=await ie.getTeacherSubscription(n.id);D(he);const ge=await ie.getUsageStats(n.id);T(ge),P([]);const Y=L(new Date,"yyyy-MM-dd"),{data:pe}=await k.from("events").select("*").eq("created_by",n.id).gte("date",Y).lte("date",Y).order("start_time",{ascending:!0});a(pe||[]),$([]);const{data:je}=await k.from("activities").select("id").eq("created_by",n.id),Z=(je||[]).map(p=>p.id);let ee=[];if(Z.length>0){const{data:p}=await k.from("submissions").select("*, activities(*), profiles:student_id(*)").in("activity_id",Z).eq("status","submitted").order("submitted_at",{ascending:!1});ee=p||[]}O(ee||[])}catch(s){console.error("Erro ao carregar dados do dashboard:",s)}finally{E(!1)}},S=[{title:"Alunos",value:h.students,subtitle:"Total de alunos",icon:V,gradient:"from-blue-500 to-blue-700"},{title:"Turmas",value:h.classes,subtitle:"Turmas ativas",icon:M,gradient:"from-green-500 to-green-700"},{title:"Atividades",value:h.activities,subtitle:"Atividades criadas",icon:X,gradient:"from-purple-500 to-purple-700"},{title:"Pendentes",value:h.pendingCorrections,subtitle:"Aguardando corre√ß√£o",icon:ne,alert:h.pendingCorrections>0,gradient:"from-amber-500 to-amber-700"}],A=[{title:"Nova Turma",description:"Criar uma nova turma",icon:H,path:"/dashboard/classes/new",gradient:"from-blue-500 to-blue-700"},{title:"Nova Atividade",description:"Criar uma nova atividade",icon:X,path:"/dashboard/activities/new",gradient:"from-purple-500 to-purple-700"},{title:"Agendar",description:"Agendar um novo evento",icon:q,path:"/dashboard/calendar",gradient:"from-amber-500 to-amber-700"}];return f?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando seu dashboard..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6 space-y-6",children:[e.jsxs(l.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent",children:"Ol√°, Professor! üëã"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Bem-vindo ao seu painel de controle"})]}),m&&e.jsx(v,{className:"bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-3 py-1 text-sm",children:m.plan_name})]}),C.length>0&&e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsx(c,{className:"border-l-4 border-l-amber-500",children:e.jsxs(o,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ce,{className:"h-5 w-5 text-amber-500 mr-2"}),e.jsxs(u,{className:"text-sm font-medium",children:["Voc√™ tem ",C.length," notifica√ß√µes"]})]}),e.jsx(ue,{className:"mt-2",children:C[0].message}),e.jsx(g,{variant:"link",className:"p-0 mt-2 text-amber-600",onClick:()=>t("/dashboard/notifications"),children:"Ver todas"})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:S.map((s,b)=>e.jsx(l.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:b*.1},children:e.jsxs(c,{className:"relative overflow-hidden hover:shadow-xl transition-shadow duration-300",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 bg-gradient-to-br ${s.gradient} opacity-10 rounded-full -mr-16 -mt-16`}),e.jsxs(N,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(u,{className:"text-sm font-medium text-gray-600",children:s.title}),e.jsx("div",{className:`p-3 rounded-lg bg-gradient-to-br ${s.gradient} flex items-center justify-center`,children:e.jsx(s.icon,{className:"h-5 w-5 text-white"})})]}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-3xl font-bold text-gray-900",children:[s.value,s.alert&&e.jsx(J,{className:"inline ml-2 h-5 w-5 text-orange-500"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.subtitle}),s.progress!==void 0&&s.progress>0&&e.jsx(K,{value:s.progress,className:"mt-3 h-2"})]})]})},b))}),e.jsx("div",{className:"mt-2",children:e.jsx(c,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Atividades aguardando corre√ß√£o"}),e.jsx("p",{className:"text-4xl font-bold text-gray-900 mt-1",children:h.pendingCorrections})]}),e.jsxs(g,{variant:"ghost",onClick:()=>t("/dashboard/activities/pending"),className:"text-indigo-600 hover:text-indigo-700 flex items-center whitespace-nowrap shrink-0",children:["Ver pendentes",e.jsx(_,{className:"ml-2 h-4 w-4"})]})]})})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-900",children:"A√ß√µes R√°pidas"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:A.map((s,b)=>e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2+b*.1},whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(c,{className:"cursor-pointer h-full hover:shadow-lg transition-shadow duration-300",onClick:()=>t(s.path),children:e.jsx(o,{className:"p-6 pt-7",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:`p-3 inline-flex rounded-lg bg-gradient-to-br ${s.gradient} flex items-center justify-center shadow-sm`,children:e.jsx(s.icon,{className:"h-5 w-5 text-white"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.title}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s.description})]}),s.indicator&&e.jsx("div",{className:"mt-4 flex items-center",children:e.jsx(v,{variant:"outline",className:"bg-gray-100",children:s.indicator})})]})})})},b))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Turmas Recentes"}),e.jsxs(g,{variant:"ghost",onClick:()=>t("/dashboard/classes"),className:"text-indigo-600 hover:text-indigo-700 flex items-center whitespace-nowrap",children:[e.jsx("span",{children:"Ver todas"}),e.jsx(_,{className:"ml-2 h-4 w-4"})]})]}),w.length===0?e.jsx(c,{className:"border-dashed border-2 md:p-12 align-middle",children:e.jsxs(o,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(M,{className:"h-12 w-14 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Voc√™ ainda n√£o tem turmas"}),e.jsxs(g,{className:"bg-gradient-to-r from-indigo-600 to-purple-600 text-white",onClick:()=>t("/dashboard/classes/new"),children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"Criar primeira turma"]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:w.map((s,b)=>e.jsx(l.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:b*.1},children:e.jsx(c,{className:"cursor-pointer hover:shadow-lg transition-shadow duration-300",onClick:()=>t(`/dashboard/classes/${s.id}`),children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-2 h-12 rounded-full ${s.color||"bg-indigo-500"} mr-4`}),e.jsxs("div",{children:[s.has_chatbot&&e.jsxs(v,{className:"bg-blue-100 text-blue-800 mb-1 flex items-center w-fit",children:[e.jsx(Se,{className:"h-3 w-3 mr-1"}),"Chatbot"]}),e.jsx("h3",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Criada em ",L(new Date(s.created_at),"dd/MM/yyyy")]})]})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("div",{className:"flex items-center text-gray-500 text-sm",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),s.student_count||0]}),e.jsx(_,{className:"h-4 w-4 text-gray-400 mt-2"})]})]})})})},s.id))})]}),e.jsxs("div",{className:"mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(c,{children:[e.jsx(N,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{className:"text-lg font-semibold",children:"Eventos de Hoje"}),e.jsxs(g,{variant:"ghost",onClick:()=>t("/dashboard/calendar"),className:"text-indigo-600 hover:text-indigo-700 flex items-center whitespace-nowrap shrink-0",children:[e.jsx("span",{children:"Ver calend√°rio"}),e.jsx(_,{className:"ml-2 h-4 w-4"})]})]})}),e.jsx(o,{children:R.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(q,{className:"h-10 w-10 text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Nenhum evento programado para hoje"})]}):e.jsx("div",{className:"space-y-3",children:R.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(q,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium leading-5",children:s.title}),e.jsxs("p",{className:"text-xs text-gray-500",children:[L(new Date(`${s.date}T${s.start_time}`),"HH:mm")," - ",L(new Date(`${s.date}T${s.end_time}`),"HH:mm")]})]})]}),e.jsx(v,{variant:"outline",className:"bg-blue-50 shrink-0",children:s.type})]},s.id))})})]}),e.jsxs(c,{children:[e.jsx(N,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{className:"text-lg font-semibold",children:"Alunos que precisam de aten√ß√£o"}),e.jsxs(g,{variant:"ghost",onClick:()=>t("/dashboard/analytics/students"),className:"text-indigo-600 hover:text-indigo-700 flex items-center whitespace-nowrap shrink-0",children:[e.jsx("span",{children:"Ver an√°lise"}),e.jsx(_,{className:"ml-2 h-4 w-4"})]})]})}),e.jsx(o,{children:d.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(V,{className:"h-10 w-10 text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Todos os alunos est√£o com bom engajamento"})]}):e.jsx("div",{className:"space-y-3",children:d.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 rounded-lg bg-orange-100 flex items-center justify-center",children:e.jsx(Ae,{className:"h-5 w-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium leading-5",children:s.profiles.full_name}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(K,{value:s.engagement_score,className:"h-2 w-24 mr-2"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[s.engagement_score,"% engajamento"]})]})]})]}),e.jsx(g,{size:"sm",variant:"outline",className:"shrink-0",onClick:()=>t(`/dashboard/students/${s.profiles.id}`),children:"Ver perfil"})]},s.id))})})]})]})]})},Pe=()=>{const{user:n}=z(),t=W(),[h,y]=r.useState(null),[m,D]=r.useState({classes:0,activities:0,pending:0,completed:0,avgGrade:0}),[x,T]=r.useState({xp:0,level:1,streak:0,badges:[],rankPosition:0}),[w,j]=r.useState([]),[C,P]=r.useState([]),[f,E]=r.useState(null),[R,a]=r.useState(!0);r.useEffect(()=>{d()},[n]);const d=async()=>{if(n)try{a(!0),D({classes:3,activities:12,pending:4,completed:8,avgGrade:8.5}),T({xp:1250,level:5,streak:7,badges:[],rankPosition:12}),j([{id:"1",title:"Exerc√≠cios de Matem√°tica",due_date:new Date(Date.now()+2*24*60*60*1e3).toISOString(),class_name:"Matem√°tica 9¬∫ Ano"},{id:"2",title:"Reda√ß√£o sobre Literatura",due_date:new Date(Date.now()+5*24*60*60*1e3).toISOString(),class_name:"Portugu√™s"},{id:"3",title:"Projeto de Ci√™ncias",due_date:new Date(Date.now()+7*24*60*60*1e3).toISOString(),class_name:"Ci√™ncias"}]),P([{id:"1",grade:9.5,activities:{title:"Quiz de Hist√≥ria"}},{id:"2",grade:8,activities:{title:"Trabalho de Geografia"}},{id:"3",grade:9,activities:{title:"Prova de Matem√°tica"}}]),E({success:!0,prediction:{nextGrade:8.7,trend:"improving",approvalProbability:92},status:{isAtRisk:!1},confidence:85,recommendations:["Continue praticando exerc√≠cios de matem√°tica","Revise os conceitos de literatura","Participe mais das discuss√µes em sala"]})}catch(i){console.error("Erro ao carregar dashboard:",i)}finally{a(!1)}},$=x.level*100,B=x.xp%100/$*100,O=[{icon:I,title:"N√≠vel",value:x.level,subtitle:`${x.xp} XP total`,gradient:"from-yellow-500 to-orange-500",progress:B},{icon:ce,title:"M√©dia Geral",value:m.avgGrade.toFixed(1),subtitle:"de 10.0",gradient:"from-green-500 to-teal-500",trend:f?.prediction?.trend},{icon:M,title:"Atividades",value:m.pending,subtitle:"Pendentes",gradient:"from-blue-500 to-cyan-500",alert:m.pending>5},{icon:re,title:"Sequ√™ncia",value:x.streak,subtitle:"Dias consecutivos",gradient:"from-red-500 to-pink-500"}];return R?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6 space-y-6",children:[e.jsxs(l.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent",children:"Ol√°, Estudante! üéì"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Continue aprendendo e alcan√ßando suas metas"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(v,{className:"bg-gradient-to-r from-yellow-500 to-orange-500 text-white px-4 py-2",children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),"N√≠vel ",x.level]}),x.streak>0&&e.jsxs(v,{className:"bg-gradient-to-r from-red-500 to-pink-500 text-white px-4 py-2",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),x.streak," dias"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:O.map((i,S)=>e.jsx(l.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:S*.1},children:e.jsxs(c,{className:"relative overflow-hidden hover:shadow-xl transition-shadow duration-300",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 bg-gradient-to-br ${i.gradient} opacity-10 rounded-full -mr-16 -mt-16`}),e.jsxs(N,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(u,{className:"text-sm font-medium text-gray-600",children:i.title}),e.jsx("div",{className:`p-2 rounded-lg bg-gradient-to-br ${i.gradient}`,children:e.jsx(i.icon,{className:"h-4 w-4 text-white"})})]}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[i.value,i.trend==="improving"&&e.jsx(fe,{className:"h-5 w-5 text-green-500"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:i.subtitle}),i.progress!==void 0&&i.progress>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx(K,{value:i.progress,className:"h-2"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[Math.round(i.progress),"% para o pr√≥ximo n√≠vel"]})]})]})]})},S))}),f&&e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:e.jsx(c,{className:"bg-gradient-to-r from-indigo-600 to-purple-600 text-white border-none",children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ke,{className:"h-6 w-6"}),e.jsx("h3",{className:"text-xl font-bold",children:"Previs√£o de IA"}),e.jsx(v,{className:"bg-white/20 text-white border-none",children:"Machine Learning"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-indigo-200 text-sm mb-1",children:"Pr√≥xima Nota"}),e.jsx("p",{className:"text-3xl font-bold",children:f.prediction.nextGrade})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-indigo-200 text-sm mb-1",children:"Tend√™ncia"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("p",{className:"text-2xl font-bold capitalize",children:f.prediction.trend==="improving"?"üìà Melhorando":f.prediction.trend==="declining"?"üìâ Caindo":"‚û°Ô∏è Est√°vel"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-indigo-200 text-sm mb-1",children:"Chance de Aprova√ß√£o"}),e.jsxs("p",{className:"text-3xl font-bold",children:[f.prediction.approvalProbability,"%"]})]})]}),f.status.isAtRisk&&e.jsxs("div",{className:"mt-4 bg-red-500/20 border border-red-300 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"‚ö†Ô∏è Aten√ß√£o: Voc√™ est√° em risco de reprova√ß√£o"}),e.jsx("p",{className:"text-xs mt-1 text-indigo-100",children:"Recomendamos revisar os materiais e pedir ajuda ao professor"})]})]}),e.jsxs(g,{className:"bg-white text-indigo-600 hover:bg-gray-100",onClick:()=>t("/students/activities"),children:["Ver Detalhes",e.jsx(_,{className:"ml-2 h-4 w-4"})]})]})})})}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsx(l.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.5},children:e.jsxs(c,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5 text-indigo-600"}),"Pr√≥ximas Atividades"]}),e.jsxs(g,{variant:"ghost",size:"sm",onClick:()=>t("/students/activities"),children:["Ver todas",e.jsx(_,{className:"ml-2 h-4 w-4"})]})]})}),e.jsx(o,{className:"space-y-3",children:w.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(G,{className:"h-12 w-12 mx-auto mb-2 text-green-500"}),e.jsx("p",{children:"Tudo em dia! üéâ"})]}):w.map((i,S)=>{const A=Math.ceil((new Date(i.due_date)-new Date)/864e5),s=A<=2;return e.jsx(l.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:S*.1},className:`p-4 rounded-lg border-2 cursor-pointer hover:shadow-md transition-all ${s?"border-red-300 bg-red-50":"border-gray-200 bg-gray-50"}`,onClick:()=>t(`/dashboard/activities/${i.id}`),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:i.title}),e.jsx("p",{className:"text-sm text-gray-600",children:i.classes.name})]}),e.jsxs(v,{className:s?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700",children:[e.jsx(ne,{className:"h-3 w-3 mr-1"}),A," ",A===1?"dia":"dias"]})]})},i.id)})})]})}),e.jsx(l.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.6},children:e.jsxs(c,{children:[e.jsx(N,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5 text-yellow-600"}),"Notas Recentes"]})}),e.jsx(o,{className:"space-y-3",children:C.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(X,{className:"h-12 w-12 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"Nenhuma nota ainda"})]}):C.map((i,S)=>{const A=parseFloat(i.grade),s=A>=9?"text-green-600 bg-green-100":A>=7?"text-blue-600 bg-blue-100":A>=5?"text-yellow-600 bg-yellow-100":"text-red-600 bg-red-100";return e.jsx(l.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:S*.1},className:"p-4 rounded-lg border-2 border-gray-200 bg-gray-50 hover:shadow-md transition-all cursor-pointer",onClick:()=>t(`/dashboard/activities/${i.activity_id}`),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:i.activities.title}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(i.submitted_at).toLocaleDateString("pt-BR")})]}),e.jsx("div",{className:`text-2xl font-bold px-4 py-2 rounded-lg ${s}`,children:A.toFixed(1)})]})},i.id)})})]})})]}),x.badges.length>0&&e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},children:e.jsxs(c,{children:[e.jsx(N,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-purple-600"}),"Suas Conquistas (",x.badges.length,")"]})}),e.jsx(o,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:x.badges.map((i,S)=>e.jsxs(l.div,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{delay:S*.05},className:"flex flex-col items-center p-4 bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl hover:shadow-lg transition-all cursor-pointer",children:[e.jsx("div",{className:"text-4xl mb-2",children:i.badges_catalog.icon||"üèÜ"}),e.jsx("p",{className:"text-xs font-semibold text-center text-gray-900",children:i.badges_catalog.name})]},i.badge_id))})})]})}),e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8},children:e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsx(c,{className:"cursor-pointer hover:shadow-xl transition-all border-2 border-transparent hover:border-purple-200",onClick:()=>t("/dashboard/chatbot"),children:e.jsxs(o,{className:"p-6 text-center",children:[e.jsx(_e,{className:"h-12 w-12 mx-auto mb-3 text-purple-600"}),e.jsx("h3",{className:"font-bold text-lg mb-1",children:"Tirar D√∫vidas"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Chatbot 24/7 com IA"})]})}),e.jsx(c,{className:"cursor-pointer hover:shadow-xl transition-all border-2 border-transparent hover:border-green-200",onClick:()=>t("/dashboard/calendar"),children:e.jsxs(o,{className:"p-6 text-center",children:[e.jsx(q,{className:"h-12 w-12 mx-auto mb-3 text-green-600"}),e.jsx("h3",{className:"font-bold text-lg mb-1",children:"Minha Agenda"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Ver prazos e eventos"})]})}),e.jsx(c,{className:"cursor-pointer hover:shadow-xl transition-all border-2 border-transparent hover:border-indigo-200",onClick:()=>t("/students/gamification"),children:e.jsxs(o,{className:"p-6 text-center",children:[e.jsx(I,{className:"h-12 w-12 mx-auto mb-3 text-yellow-600"}),e.jsx("h3",{className:"font-bold text-lg mb-1",children:"Rankings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Ver sua posi√ß√£o"})]})})]})})]})},Ee=()=>{const{user:n}=z(),t=W(),[h,y]=r.useState(null),[m,D]=r.useState({teachers:0,students:0,classes:0,activities:0,avgPerformance:0}),[x,T]=r.useState([]),[w,j]=r.useState([]),[C,P]=r.useState(!0);r.useEffect(()=>{f()},[n]);const f=async()=>{if(n)try{P(!0);const a=await F.getUserSchool(n.id);if(!a){console.log("Nenhuma escola encontrada para o usu√°rio"),P(!1);return}y(a);try{const d=await F.getDashboardStats(a.id);D({teachers:d.totalTeachers||0,students:d.totalStudents||0,classes:d.totalClasses||0,activities:d.submissionsLast30Days||0,avgPerformance:parseFloat(d.averageGrade)||0});const $=await F.getTeachers(a.id);T($.slice(0,5)||[]);const B=await F.getClasses(a.id);j(B.slice(0,5)||[])}catch(d){console.warn("Erro ao carregar estat√≠sticas detalhadas:",d),D({teachers:0,students:0,classes:0,activities:0,avgPerformance:0}),T([]),j([])}}catch(a){console.error("Erro ao carregar dashboard:",a),y({id:"temp-school",name:"Minha Escola",logo_url:null,settings:null})}finally{P(!1)}},E=[{icon:Q,title:"Professores",value:m.teachers,subtitle:"Vinculados",gradient:"from-indigo-600 to-purple-600"},{icon:V,title:"Alunos",value:m.students,subtitle:"Total na rede",gradient:"from-blue-600 to-cyan-600"},{icon:M,title:"Turmas",value:m.classes,subtitle:"Ativas",gradient:"from-green-600 to-teal-600"},{icon:ce,title:"Desempenho",value:m.avgPerformance.toFixed(1),subtitle:"M√©dia geral",gradient:"from-orange-600 to-amber-600"}],R=[{icon:H,title:"Convidar Professor",description:"Adicionar novo professor",action:()=>t("/school/teachers"),gradient:"from-indigo-600 to-purple-600"},{icon:ve,title:"Relat√≥rios",description:"Analytics consolidado",action:()=>t("/school/reports"),gradient:"from-green-600 to-teal-600"},{icon:se,title:"Configura√ß√µes",description:"Gerenciar escola",action:()=>t("/school/settings"),gradient:"from-orange-600 to-red-600"},{icon:ye,title:"Comunica√ß√£o",description:"Enviar avisos",action:()=>t("/school/comms"),gradient:"from-pink-600 to-rose-600"}];return C?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-600"})}):h?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6 space-y-6",children:[e.jsxs(l.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent",children:h.name}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Painel de Gest√£o Escolar"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(v,{className:"bg-gradient-to-r from-orange-600 to-red-600 text-white px-4 py-2",children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Enterprise"]}),e.jsxs(g,{variant:"outline",onClick:()=>t("/school/settings"),children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Configura√ß√µes"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:E.map((a,d)=>e.jsx(l.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:d*.1},children:e.jsxs(c,{className:"relative overflow-hidden hover:shadow-xl transition-shadow duration-300",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 bg-gradient-to-br ${a.gradient} opacity-10 rounded-full -mr-16 -mt-16`}),e.jsxs(N,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(u,{className:"text-sm font-medium text-gray-600",children:a.title}),e.jsx("div",{className:`p-2 rounded-lg bg-gradient-to-br ${a.gradient}`,children:e.jsx(a.icon,{className:"h-4 w-4 text-white"})})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:a.value}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:a.subtitle})]})]})},d))}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-900",children:"A√ß√µes R√°pidas"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:R.map((a,d)=>e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2+d*.1},whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(c,{className:"cursor-pointer hover:shadow-2xl transition-all duration-300 border-2 border-transparent hover:border-orange-200",onClick:a.action,children:e.jsxs(o,{className:"p-6",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl bg-gradient-to-r ${a.gradient} flex items-center justify-center mb-4`,children:e.jsx(a.icon,{className:"h-6 w-6 text-white"})}),e.jsx("h3",{className:"font-bold text-lg mb-1",children:a.title}),e.jsx("p",{className:"text-sm text-gray-600",children:a.description})]})})},d))})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsx(l.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},children:e.jsxs(c,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5 text-indigo-600"}),"Professores Recentes"]}),e.jsxs(g,{variant:"ghost",size:"sm",onClick:()=>t("/school/teachers"),children:["Ver todos",e.jsx(_,{className:"ml-2 h-4 w-4"})]})]})}),e.jsx(o,{className:"space-y-3",children:x.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Q,{className:"h-12 w-12 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"Nenhum professor vinculado ainda"})]}):x.map((a,d)=>e.jsx(l.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:d*.1},className:"p-4 rounded-lg border-2 border-gray-200 bg-gray-50 hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:a.name||"Sem nome"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.email})]}),e.jsxs(v,{className:a.status==="active"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700",children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),a.status==="active"?"Ativo":"Inativo"]})]})},a.id))})]})}),e.jsx(l.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.5},children:e.jsxs(c,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5 text-green-600"}),"Turmas Mais Populares"]}),e.jsxs(g,{variant:"ghost",size:"sm",onClick:()=>t("/school/classes"),children:["Ver todas",e.jsx(_,{className:"ml-2 h-4 w-4"})]})]})}),e.jsx(o,{className:"space-y-3",children:w.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(M,{className:"h-12 w-12 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"Nenhuma turma criada ainda"})]}):w.map((a,d)=>e.jsx(l.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:d*.1},className:"p-4 rounded-lg border-2 border-gray-200 bg-gray-50 hover:shadow-md transition-all cursor-pointer",onClick:()=>t(`/dashboard/classes/${a.id}`),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:a.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(V,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[a.studentCount," alunos"]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["‚Ä¢ ",a.teacherName]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx(v,{className:"bg-blue-100 text-blue-700",children:a.subject||"Geral"})})]})},a.id))})]})})]}),e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},children:e.jsx(c,{className:"bg-gradient-to-r from-orange-600 to-red-600 text-white border-none",children:e.jsx(o,{className:"p-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold mb-2",children:"Resumo do M√™s"}),e.jsx("p",{className:"text-orange-100 mb-4",children:"Sua escola est√° crescendo! Continue assim."}),e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-200 text-sm mb-1",children:"Novos Alunos"}),e.jsxs("p",{className:"text-3xl font-bold",children:["+",Math.floor(m.students*.1)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-200 text-sm mb-1",children:"Atividades"}),e.jsx("p",{className:"text-3xl font-bold",children:m.activities})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-200 text-sm mb-1",children:"Engajamento"}),e.jsx("p",{className:"text-3xl font-bold",children:m.avgPerformance>=7?"85%":"70%"})]})]})]}),e.jsxs(g,{className:"bg-white text-orange-600 hover:bg-gray-100",onClick:()=>t("/school/reports"),children:["Ver Relat√≥rio Completo",e.jsx(_,{className:"ml-2 h-4 w-4"})]})]})})})}),e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},children:e.jsxs(c,{children:[e.jsx(N,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5 text-purple-600"}),"Recursos Enterprise Ativos"]})}),e.jsx(o,{children:e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-green-50 rounded-lg",children:[e.jsx(G,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Chatbot Ilimitado"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Sem limite de mensagens"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 rounded-lg",children:[e.jsx(G,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Analytics Avan√ßado"}),e.jsx("p",{className:"text-xs text-gray-600",children:"ML e relat√≥rios consolidados"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-purple-50 rounded-lg",children:[e.jsx(G,{className:"h-8 w-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Suporte Priorit√°rio"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Atendimento 24/7"})]})]})]})})]})})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6",children:e.jsx(c,{className:"max-w-2xl mx-auto",children:e.jsxs(o,{className:"p-12 text-center",children:[e.jsx(De,{className:"h-16 w-16 mx-auto mb-4 text-gray-400"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Nenhuma escola encontrada"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Voc√™ ainda n√£o possui uma escola cadastrada."}),e.jsxs(g,{className:"bg-gradient-to-r from-orange-600 to-red-600 text-white",onClick:()=>t("/school/settings"),children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"Cadastrar Escola"]})]})})})},as=()=>{const{user:n}=z(),[t,h]=r.useState(null),[y,m]=r.useState(!0),[D,x]=r.useState(null);return r.useEffect(()=>{const T=async()=>{if(!n?.id){m(!1);return}try{if(m(!0),x(null),n.user_metadata?.role){h(n.user_metadata.role),U.info("User role from metadata:",n.user_metadata.role),m(!1);return}const{data:j,error:C}=await k.from("profiles").select("role").eq("id",n.id).maybeSingle();j&&!C?(h(j.role||"teacher"),U.info("User role from profiles:",j.role)):(h("teacher"),U.warn("Could not determine user role, defaulting to teacher"))}catch(j){U.error("Error in fetchUserRole:",j),x("Erro ao carregar as informa√ß√µes do usu√°rio"),h("teacher")}finally{m(!1)}},w=setTimeout(()=>{T()},300);return()=>clearTimeout(w)},[n?.id]),y?e.jsx(l.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:e.jsx(we,{})}):D?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs(ae,{className:"max-w-md",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx(te,{children:D})]})}):e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:t==="teacher"?e.jsx(Te,{}):t==="student"?e.jsx(Pe,{}):t==="school"?e.jsx(Ee,{}):e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs(ae,{className:"max-w-md",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx(te,{children:"Role n√£o reconhecido. Entre em contato com o administrador."})]})})})};export{as as default};
