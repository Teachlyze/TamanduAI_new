import{u as z,r as l,s as n,j as e,L as G,x as i,y as o,U as J,Z as b,W as K,X as O,Y as S,A as T,$ as A,F as R,H as q,I as M,m as P,an as I,ao as X,ap as L}from"./main-Cv3DLBs1.js";import{B as g}from"./badge-CS76XO47.js";import{T as ee}from"./trophy-JDAK_dof.js";import{F as v}from"./flame-BLe9Dg-q.js";import{T as se}from"./target-BazIADWF.js";import{M as E}from"./medal-CQR2oFWm.js";import{C as ae}from"./crown-DSJ6iA6o.js";const de=()=>{const{user:d}=z(),[F,w]=l.useState(!0),[p,j]=l.useState([]),[_,f]=l.useState([]),[m,B]=l.useState("all"),[y,D]=l.useState([]),[x,$]=l.useState([]),[N,H]=l.useState({totalStudents:0,avgXP:0,topStreak:0});l.useEffect(()=>{d&&U()},[d,m]);const U=async()=>{w(!0);try{await Promise.all([Z(),Q(),V(),W(),Y()])}catch(s){console.error("Erro ao carregar dados:",s)}finally{w(!1)}},Z=async()=>{const{data:s}=await n.from("classes").select("id, name").eq("created_by",d.id).eq("is_active",!0).order("name");D(s||[])},Q=async()=>{const{data:s}=await n.from("school_teachers").select(`
        school_id,
        schools:school_id (
          id,
          name
        )
      `).eq("user_id",d.id).eq("status","active");s&&$(s.map(a=>a.schools).filter(Boolean))},V=async()=>{const s=n.from("classes").select("id").eq("created_by",d.id).eq("is_active",!0);m!=="all"&&s.eq("id",m);const{data:a}=await s;if(!a||a.length===0){j([]);return}const h=a.map(r=>r.id),{data:t}=await n.from("class_members").select("user_id").in("class_id",h).eq("role","student");if(!t||t.length===0){j([]);return}const c=t.map(r=>r.user_id),{data:u}=await n.from("gamification_profiles").select(`
        user_id,
        xp_total,
        level,
        current_streak,
        badges_earned,
        missions_completed,
        profiles:user_id (
          name,
          avatar_url
        )
      `).in("user_id",c).order("xp_total",{ascending:!1}).limit(100);j(u||[])},W=async()=>{if(x.length===0){f([]);return}const s=x.map(r=>r.id),{data:a}=await n.from("school_classes").select("class_id").in("school_id",s);if(!a||a.length===0){f([]);return}const h=a.map(r=>r.class_id),{data:t}=await n.from("class_members").select("user_id").in("class_id",h).eq("role","student");if(!t||t.length===0){f([]);return}const c=t.map(r=>r.user_id),{data:u}=await n.from("gamification_profiles").select(`
        user_id,
        xp_total,
        level,
        current_streak,
        badges_earned,
        missions_completed,
        profiles:user_id (
          name,
          avatar_url
        )
      `).in("user_id",c).order("xp_total",{ascending:!1}).limit(100);f(u||[])},Y=async()=>{const s=p;if(s.length===0)return;const a=s.length,h=Math.round(s.reduce((c,u)=>c+u.xp_total,0)/a),t=Math.max(...s.map(c=>c.current_streak||0));H({totalStudents:a,avgXP:h,topStreak:t})},k=s=>{switch(s){case 1:return e.jsx(ae,{className:"w-6 h-6 text-yellow-500"});case 2:return e.jsx(E,{className:"w-6 h-6 text-gray-400"});case 3:return e.jsx(E,{className:"w-6 h-6 text-amber-600"});default:return e.jsxs("span",{className:"text-lg font-bold text-muted-foreground",children:["#",s]})}},C=s=>s===1?e.jsx(g,{className:"bg-gradient-to-r from-yellow-400 to-amber-500 text-white",children:"🏆 1º Lugar"}):s===2?e.jsx(g,{className:"bg-gradient-to-r from-gray-300 to-gray-400 text-white",children:"🥈 2º Lugar"}):s===3?e.jsx(g,{className:"bg-gradient-to-r from-amber-500 to-orange-600 text-white",children:"🥉 3º Lugar"}):e.jsxs(g,{variant:"outline",children:[s,"º"]});return F?e.jsx(G,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent flex items-center gap-3",children:[e.jsx(ee,{className:"w-8 h-8 text-purple-600"}),"Ranking de Alunos"]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Acompanhe o desempenho e evolução dos seus alunos"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(i,{children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total de Alunos"}),e.jsx("p",{className:"text-2xl font-bold",children:N.totalStudents})]}),e.jsx(J,{className:"w-8 h-8 text-blue-500"})]})})}),e.jsx(i,{children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"XP Médio"}),e.jsx("p",{className:"text-2xl font-bold",children:N.avgXP})]}),e.jsx(b,{className:"w-8 h-8 text-yellow-500"})]})})}),e.jsx(i,{children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Maior Sequência"}),e.jsxs("p",{className:"text-2xl font-bold",children:[N.topStreak," dias"]})]}),e.jsx(v,{className:"w-8 h-8 text-orange-500"})]})})})]}),e.jsxs(K,{defaultValue:"myClasses",className:"w-full",children:[e.jsxs(O,{className:"grid w-full md:w-auto grid-cols-2",children:[e.jsxs(S,{value:"myClasses",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Minhas Turmas"]}),e.jsxs(S,{value:"school",disabled:x.length===0,children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Escola",x.length>0&&e.jsx(g,{className:"ml-2",variant:"secondary",children:x.length})]})]}),e.jsxs(A,{value:"myClasses",className:"space-y-4",children:[y.length>1&&e.jsx(i,{children:e.jsxs(o,{className:"pt-6",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Filtrar por Turma:"}),e.jsxs("select",{value:m,onChange:s=>B(s.target.value),className:"w-full md:w-auto px-4 py-2 border rounded-lg bg-white dark:bg-slate-900 text-foreground border-border",children:[e.jsx("option",{value:"all",children:"Todas as Turmas"}),y.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})}),e.jsxs(i,{children:[e.jsxs(R,{children:[e.jsx(q,{children:"Top Alunos"}),e.jsx(M,{children:"Classificação baseada em XP total"})]}),e.jsx(o,{children:p.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Nenhum aluno encontrado"}):e.jsx("div",{className:"space-y-3",children:p.map((s,a)=>e.jsxs(P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:a*.05},className:`flex items-center gap-4 p-4 rounded-xl border transition-all hover:shadow-md ${a<3?"bg-gradient-to-r from-amber-50 to-orange-50 border-amber-200":"bg-card"}`,children:[e.jsx("div",{className:"flex-shrink-0 w-12 flex items-center justify-center",children:k(a+1)}),e.jsxs(I,{className:"w-12 h-12",children:[e.jsx(X,{src:s.profiles?.avatar_url}),e.jsx(L,{className:"bg-gradient-to-br from-purple-500 to-pink-500 text-white",children:s.profiles?.name?.charAt(0)||"?"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"font-semibold truncate",children:s.profiles?.name||"Aluno"}),C(a+1)]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"w-4 h-4 text-yellow-500"}),"Nível ",s.level]}),s.current_streak>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(v,{className:"w-4 h-4 text-orange-500"}),s.current_streak," dias"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4 text-purple-500"}),s.badges_earned||0," badges"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:s.xp_total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"XP Total"})]})]},s.user_id))})})]})]}),e.jsx(A,{value:"school",className:"space-y-4",children:e.jsxs(i,{children:[e.jsxs(R,{children:[e.jsx(q,{children:"Ranking da Escola"}),e.jsx(M,{children:"Alunos de todas as turmas das escolas onde você trabalha"})]}),e.jsx(o,{children:_.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Nenhum aluno encontrado nas escolas"}):e.jsx("div",{className:"space-y-3",children:_.map((s,a)=>e.jsxs(P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:a*.05},className:`flex items-center gap-4 p-4 rounded-xl border transition-all hover:shadow-md ${a<3?"bg-gradient-to-r from-amber-50 to-orange-50 border-amber-200":"bg-card"}`,children:[e.jsx("div",{className:"flex-shrink-0 w-12 flex items-center justify-center",children:k(a+1)}),e.jsxs(I,{className:"w-12 h-12",children:[e.jsx(X,{src:s.profiles?.avatar_url}),e.jsx(L,{className:"bg-gradient-to-br from-blue-500 to-indigo-500 text-white",children:s.profiles?.name?.charAt(0)||"?"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"font-semibold truncate",children:s.profiles?.name||"Aluno"}),C(a+1)]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"w-4 h-4 text-yellow-500"}),"Nível ",s.level]}),s.current_streak>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(v,{className:"w-4 h-4 text-orange-500"}),s.current_streak," dias"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:s.xp_total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"XP Total"})]})]},s.user_id))})})]})})]})]})};export{de as default};
