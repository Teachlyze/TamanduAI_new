import{u as $,ak as U,g as K,r as c,s as N,z as o,j as e,o as X,a1 as H,m as p,ag as J,K as m,aO as D,aP as _,aQ as E,aR as I,aS as d,bE as y,br as w,B as W,bI as Y,U as Z,C as ee}from"./main-NgjJy_CG.js";import{P as f}from"./PremiumCard-BGO_It48.js";import{P as u}from"./PremiumButton-DDGOGflQ.js";import{B as se}from"./badge-DS8upoqS.js";import{A as te}from"./arrow-left-MOSQdYvL.js";import{S as ae}from"./save-CY3ziv22.js";import{C as B}from"./circle-check-big-dDW7KbJv.js";import{T as re}from"./trash-2-Bhwmq7t6.js";import{P as ie}from"./plus-BItzgCLM.js";const ge=()=>{const{user:x,loading:C}=$(),{classId:k}=U(),b=K(),[T,P]=c.useState(!0),[Q,S]=c.useState(!1),[A,z]=c.useState([]),[t,h]=c.useState({title:"",description:"",instructions:"",dueDate:"",maxGrade:100,type:"assignment",isPublished:!1,selectedClasses:k?[k]:[],questions:[],enablePlagiarismCheck:!1,allowBatchGrading:!1}),[i,j]=c.useState({type:"multiple_choice",question:"",options:["","","",""],correctAnswer:0,points:1});c.useEffect(()=>{!C&&x&&G()},[C,x]);const G=async()=>{try{P(!0);const{data:s,error:a}=await N.from("classes").select("id, name, subject").eq("created_by",x.id).eq("is_active",!0);if(a)throw a;z(s||[])}catch(s){console.error("Erro ao carregar turmas:",s),o.error("Erro ao carregar turmas")}finally{P(!1)}},l=(s,a)=>{h(r=>({...r,[s]:a}))},O=s=>{h(a=>({...a,selectedClasses:a.selectedClasses.includes(s)?a.selectedClasses.filter(r=>r!==s):[...a.selectedClasses,s]}))},g=(s,a)=>{j(r=>({...r,[s]:a}))},R=(s,a)=>{j(r=>({...r,options:r.options.map((n,v)=>v===s?a:n)}))},V=()=>{if(!i.question.trim()){o.error("Digite a pergunta");return}if(i.type==="multiple_choice"&&i.options.some(s=>!s.trim())){o.error("Preencha todas as opções");return}h(s=>({...s,questions:[...s.questions,{...i,id:Date.now()}]})),j({type:"multiple_choice",question:"",options:["","","",""],correctAnswer:0,points:1})},L=s=>{h(a=>({...a,questions:a.questions.filter(r=>r.id!==s)}))},F=async()=>{if(!t.title.trim()){o.error("Título é obrigatório");return}const s=t.selectedClasses.length===0||!t.isPublished;s?console.log("[CreateActivity] Salvando como rascunho (sem turma ou não publicado)"):console.log("[CreateActivity] Publicando atividade em",t.selectedClasses.length,"turma(s)"),S(!0);try{const a={title:t.title,description:t.description,content:{instructions:t.instructions,questions:t.questions,enablePlagiarismCheck:t.enablePlagiarismCheck,allowBatchGrading:t.allowBatchGrading},type:t.type,max_grade:t.maxGrade,due_date:t.dueDate||null,created_by:x.id,status:s?"draft":"published",is_published:!s,published_at:s?null:new Date().toISOString()},{data:r,error:n}=await N.from("activities").insert(a).select().single();if(n)throw n;if(t.selectedClasses.length>0&&!s){const v=t.selectedClasses.map(M=>({activity_id:r.id,class_id:M,assigned_at:new Date().toISOString()})),{error:q}=await N.from("activity_class_assignments").insert(v);if(q)throw q;o.success(`Atividade publicada em ${t.selectedClasses.length} turma(s)!`)}else o.success("Rascunho salvo com sucesso!");b("/dashboard/activities")}catch(a){console.error("Erro ao criar atividade:",a),o.error("Erro ao criar atividade")}finally{S(!1)}};return T?e.jsx(X,{message:"Carregando turmas..."}):e.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(u,{variant:"outline",size:"sm",leftIcon:te,onClick:()=>b("/dashboard/activities"),className:"whitespace-nowrap inline-flex items-center gap-2 min-w-fit px-4 py-2",children:"Voltar"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Nova Atividade"}),e.jsx("p",{className:"text-muted-foreground",children:"Crie uma nova atividade para seus alunos"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(u,{variant:"outline",leftIcon:H,onClick:()=>b("/dashboard/activities"),className:"whitespace-nowrap inline-flex items-center gap-2 min-w-fit px-6 py-2.5",children:"Cancelar"}),e.jsx(u,{leftIcon:ae,onClick:F,loading:Q,className:"bg-gradient-to-r from-blue-600 to-purple-600 whitespace-nowrap inline-flex items-center gap-2 min-w-fit px-6 py-2.5",children:"Criar Atividade"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs(f,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-xl flex items-center justify-center",children:e.jsx(J,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-foreground",children:"Informações Básicas"}),e.jsx("p",{className:"text-muted-foreground",children:"Configure os detalhes principais da atividade"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Título da Atividade *"}),e.jsx(m,{value:t.title,onChange:s=>l("title",s.target.value),placeholder:"Ex: Exercícios de Matemática - Capítulo 5",className:"w-full bg-background text-foreground"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Tipo de Atividade"}),e.jsxs(D,{value:t.type,onValueChange:s=>l("type",s),children:[e.jsx(_,{className:"bg-background text-foreground",children:e.jsx(E,{})}),e.jsxs(I,{children:[e.jsx(d,{value:"assignment",children:"Tarefa"}),e.jsx(d,{value:"quiz",children:"Quiz"}),e.jsx(d,{value:"project",children:"Projeto"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Descrição"}),e.jsx(y,{value:t.description,onChange:s=>l("description",s.target.value),placeholder:"Descreva brevemente o objetivo da atividade...",className:"w-full min-h-[100px] bg-background text-foreground"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Instruções Detalhadas"}),e.jsx(y,{value:t.instructions,onChange:s=>l("instructions",s.target.value),placeholder:"Instruções detalhadas para os alunos...",className:"w-full min-h-[120px] bg-background text-foreground"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Data de Entrega"}),e.jsx(m,{type:"datetime-local",value:t.dueDate,onChange:s=>l("dueDate",s.target.value),className:"w-full bg-background text-foreground"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Pontuação Máxima"}),e.jsx(m,{type:"number",min:"1",max:"1000",value:t.maxGrade,onChange:s=>l("maxGrade",parseInt(s.target.value)||100),className:"w-full bg-background text-foreground"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border border-border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Publicar Imediatamente"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"A atividade ficará visível para os alunos"})]}),e.jsx(w,{checked:t.isPublished,onCheckedChange:s=>l("isPublished",s)})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border border-border rounded-lg bg-blue-50 dark:bg-blue-950/20",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground flex items-center gap-2",children:"🔍 Verificação de Plágio"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ativar detecção automática de plágio nas submissões"})]}),e.jsx(w,{checked:t.enablePlagiarismCheck,onCheckedChange:s=>l("enablePlagiarismCheck",s)})]}),t.type==="quiz"&&t.questions.length>0&&e.jsxs("div",{className:"flex items-center justify-between p-4 border border-border rounded-lg bg-purple-50 dark:bg-purple-950/20",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground flex items-center gap-2",children:"⚡ Correção Automática"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Permitir correção em lote com base no gabarito"})]}),e.jsx(w,{checked:t.allowBatchGrading,onCheckedChange:s=>l("allowBatchGrading",s)})]})]})]})}),t.type==="quiz"&&e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs(f,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-teal-500 rounded-xl flex items-center justify-center",children:e.jsx(W,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-foreground",children:"Questões do Quiz"}),e.jsx("p",{className:"text-muted-foreground",children:"Adicione questões para o quiz"})]})]}),t.questions.length>0&&e.jsx("div",{className:"space-y-4 mb-6",children:t.questions.map((s,a)=>e.jsx("div",{className:"p-4 border border-border rounded-lg bg-muted/50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-medium text-foreground",children:[a+1,". ",s.question]}),s.type==="multiple_choice"&&e.jsx("div",{className:"mt-2 space-y-1",children:s.options.map((r,n)=>e.jsxs("div",{className:"flex items-center gap-2",children:[n===s.correctAnswer?e.jsx(B,{className:"w-4 h-4 text-green-500"}):e.jsx(Y,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-foreground",children:r})]},n))}),e.jsxs(se,{variant:"secondary",className:"mt-2",children:[s.points," ponto",s.points!==1?"s":""]})]}),e.jsx(u,{variant:"outline",size:"sm",leftIcon:re,onClick:()=>L(s.id),className:"text-red-500 hover:text-red-600 whitespace-nowrap inline-flex items-center gap-2 min-w-fit px-4 py-2",children:"Remover"})]})},s.id))}),e.jsxs("div",{className:"space-y-4 p-4 border border-dashed border-border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Tipo de Questão"}),e.jsxs(D,{value:i.type,onValueChange:s=>g("type",s),children:[e.jsx(_,{className:"bg-background text-foreground",children:e.jsx(E,{})}),e.jsxs(I,{children:[e.jsx(d,{value:"multiple_choice",children:"Múltipla Escolha"}),e.jsx(d,{value:"open",children:"Questão Aberta"}),e.jsx(d,{value:"true_false",children:"Verdadeiro/Falso"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Pergunta"}),e.jsx(y,{value:i.question,onChange:s=>g("question",s.target.value),placeholder:"Digite a pergunta...",className:"w-full bg-background text-foreground"})]}),i.type==="multiple_choice"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Opções de Resposta"}),e.jsx("div",{className:"space-y-2",children:i.options.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"correctAnswer",checked:i.correctAnswer===a,onChange:()=>g("correctAnswer",a),className:"text-blue-600"}),e.jsx(m,{value:s,onChange:r=>R(a,r.target.value),placeholder:`Opção ${a+1}`,className:"flex-1 bg-background text-foreground"})]},a))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Selecione a opção correta marcando o círculo"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Pontos"}),e.jsx(m,{type:"number",min:"1",max:"10",value:i.points,onChange:s=>g("points",parseInt(s.target.value)||1),className:"w-20 bg-background text-foreground"})]}),e.jsx(u,{leftIcon:ie,onClick:V,className:"bg-gradient-to-r from-green-500 to-teal-500 whitespace-nowrap inline-flex items-center gap-2 min-w-fit px-6 py-2.5",children:"Adicionar Questão"})]})]})]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(p.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.2},children:e.jsxs(f,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Z,{className:"w-5 h-5 text-blue-500"}),e.jsx("h3",{className:"font-bold text-foreground",children:"Turmas"})]}),A.length===0?e.jsx("p",{className:"text-muted-foreground text-sm",children:"Nenhuma turma encontrada"}):e.jsx("div",{className:"space-y-2",children:A.map(s=>e.jsx("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${t.selectedClasses.includes(s.id)?"border-blue-500 bg-blue-50 dark:bg-blue-950":"border-border hover:border-blue-300"}`,onClick:()=>O(s.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.subject})]}),t.selectedClasses.includes(s.id)&&e.jsx(B,{className:"w-5 h-5 text-blue-500"})]})},s.id))})]})}),e.jsx(p.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.3},children:e.jsxs(f,{className:"p-6",children:[e.jsx("h3",{className:"font-bold mb-4 text-foreground",children:"Preview"}),e.jsxs("div",{className:"border border-border rounded-lg p-4 bg-muted/30",children:[e.jsx("h4",{className:"font-bold text-lg mb-2 text-foreground",children:t.title||"Título da Atividade"}),t.description&&e.jsx("p",{className:"text-muted-foreground mb-3",children:t.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"w-4 h-4"}),t.dueDate?new Date(t.dueDate).toLocaleString("pt-BR"):"Sem prazo"]}),e.jsxs("span",{children:["🎯 ",t.maxGrade," pts"]})]}),t.questions.length>0&&e.jsx("div",{className:"mt-3 pt-3 border-t border-border",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.questions.length," questão",t.questions.length!==1?"ões":""]})})]})]})})]})]})]})};export{ge as default};
