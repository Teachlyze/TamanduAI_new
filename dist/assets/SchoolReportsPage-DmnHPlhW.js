import{u as D,r as x,s as u,j as e,U as k,A as R,C as E,k as I,T as M}from"./main-NgjJy_CG.js";import{s as N}from"./schoolService-0kUg_1__.js";import{T as U}from"./trending-down-BrWkQQvc.js";const j=({icon:n,label:c,value:o,trend:s,color:l="blue"})=>e.jsx("div",{className:`rounded-xl border border-border/50 bg-gradient-to-br from-${l}-50 to-${l}-100/50 p-4`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`rounded-lg bg-${l}-500/10 p-2`,children:e.jsx(n,{className:`h-5 w-5 text-${l}-600`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-slate-700 dark:text-slate-300",children:c}),e.jsx("div",{className:"mt-1 text-2xl font-bold",children:o}),s&&e.jsxs("div",{className:`mt-1 flex items-center gap-1 text-xs ${s>0?"text-green-600":"text-red-600"}`,children:[s>0?e.jsx(M,{className:"h-3 w-3"}):e.jsx(U,{className:"h-3 w-3"}),Math.abs(s),"% vs mÃªs anterior"]})]})]})}),P=({subject:n,avgGrade:c,submissions:o,studentCount:s})=>{const l=i=>i>=9?"text-green-600 bg-green-100":i>=7?"text-yellow-600 bg-yellow-100":i>=5?"text-orange-600 bg-orange-100":"text-red-600 bg-red-100";return e.jsxs("div",{className:"flex items-center gap-4 rounded-lg border border-border/50 bg-card p-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:n||"Sem disciplina"}),e.jsxs("div",{className:"mt-1 text-xs text-slate-700 dark:text-slate-300",children:[s," alunos â€¢ ",o," entregas"]})]}),e.jsx("div",{className:`rounded-full px-3 py-1.5 text-sm font-bold ${l(c)}`,children:c?.toFixed(1)||"-"})]})},z=()=>{const{user:n}=D(),[c,o]=x.useState(null),[s,l]=x.useState(null),[i,y]=x.useState([]),[w,f]=x.useState(!0);x.useEffect(()=>{S()},[n?.id]);const S=async()=>{if(n?.id)try{f(!0);const r=await N.getUserSchool(n.id);if(o(r),r?.id){const d=await N.getDashboardStats(r.id);l(d),await C(r.id,d.classIds)}}catch(r){console.error("Error loading reports:",r)}finally{f(!1)}},C=async(r,d)=>{if(!(!d||d.length===0))try{const{data:g}=await u.from("classes").select("id, subject").in("id",d),m=new Map;for(const a of g||[]){const t=a.subject||"Sem disciplina";m.has(t)||m.set(t,{subject:t,classIds:[],studentCount:0,submissions:0,totalGrade:0,gradeCount:0}),m.get(t).classIds.push(a.id)}for(const[a,t]of m.entries()){const{count:T}=await u.from("class_members").select("user_id",{count:"exact",head:!0}).in("class_id",t.classIds).eq("role","student");t.studentCount=T||0;const{data:$}=await u.from("activity_class_assignments").select("activity_id").in("class_id",t.classIds),p=$?.map(b=>b.activity_id)||[];if(p.length>0){const{count:b}=await u.from("submissions").select("id",{count:"exact",head:!0}).in("activity_id",p).eq("status","submitted");t.submissions=b||0;const{data:h}=await u.from("submissions").select("grade").in("activity_id",p).not("grade","is",null);if(h&&h.length>0){const G=h.reduce((_,A)=>_+(A.grade||0),0);t.totalGrade=G,t.gradeCount=h.length}}}const v=Array.from(m.values()).map(a=>({subject:a.subject,avgGrade:a.gradeCount>0?a.totalGrade/a.gradeCount:null,submissions:a.submissions,studentCount:a.studentCount}));v.sort((a,t)=>(t.avgGrade||0)-(a.avgGrade||0)),y(v)}catch(g){console.error("Error loading subject stats:",g)}};return w?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(r=>e.jsx("div",{className:"h-32 animate-pulse rounded-lg bg-muted"},r))}):c?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"RelatÃ³rios e Analytics"}),e.jsxs("p",{className:"text-sm text-slate-700 dark:text-slate-300",children:["AnÃ¡lise detalhada do desempenho de ",c.name]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsx(j,{icon:k,label:"Total de Alunos",value:s?.totalStudents||0,color:"blue"}),e.jsx(j,{icon:R,label:"MÃ©dia Geral",value:s?.averageGrade||"-",color:"green"}),e.jsx(j,{icon:E,label:"Taxa de Pontualidade",value:`${s?.onTimeRate||0}%`,color:"purple"})]}),e.jsxs("div",{className:"rounded-2xl border border-border/50 bg-card p-6",children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Desempenho por Disciplina"})]}),i.length===0?e.jsx("div",{className:"py-8 text-center text-slate-700 dark:text-slate-300",children:"Nenhum dado disponÃ­vel ainda."}):e.jsx("div",{className:"space-y-3",children:i.map((r,d)=>e.jsx(P,{...r},d))})]}),e.jsxs("div",{className:"rounded-2xl border border-border/50 bg-gradient-to-r text-white hover:opacity-90 whitespace-nowrap inline-flex items-center gap-2 min-w-fit from-blue-50 to-purple-50 p-6",children:[e.jsx("h3",{className:"mb-3 text-lg font-semibold",children:"ğŸ’¡ Insights"}),e.jsxs("ul",{className:"space-y-2 text-sm",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-600",children:"âœ“"}),e.jsx("span",{children:s?.onTimeRate>=70?`Taxa de pontualidade de ${s.onTimeRate}% estÃ¡ acima da meta (70%).`:`Taxa de pontualidade de ${s?.onTimeRate||0}% estÃ¡ abaixo da meta. Considere incentivar entregas antecipadas.`})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600",children:"â„¹"}),e.jsx("span",{children:i.length>0&&i[0].avgGrade?`Melhor desempenho em ${i[0].subject} (mÃ©dia ${i[0].avgGrade.toFixed(1)}).`:"Ainda nÃ£o hÃ¡ dados suficientes para anÃ¡lise por disciplina."})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-purple-600",children:"ğŸ“Š"}),e.jsxs("span",{children:["Total de ",s?.submissionsLast30Days||0," entregas nos Ãºltimos 30 dias."]})]})]})]})]}):e.jsx("div",{className:"rounded-2xl border border-border/50 bg-card p-8 text-center",children:e.jsx("p",{className:"text-slate-700 dark:text-slate-300",children:"Escola nÃ£o encontrada."})})};export{z as default};
