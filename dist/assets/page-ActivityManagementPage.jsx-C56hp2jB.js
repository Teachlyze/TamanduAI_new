import{R as N,j as e,X as U,r as o,P as S,Q as W,an as Y,ao as J,T as K,B as Z}from"./react-vendor-C2HUFn5N.js";import{c as m,a as ee,u as se,s as v,B as n,I as b,S as ae,f as te,g as ie,h as le,i as y,C as re,b as ce,d as oe,e as ne,j as x}from"./lazy-CreateActivityPage.jsx-DYBofU2F.js";import{N as de,O as me,Q as E,U as ue,W as z,X as A,Y as F}from"./ui-vendor-Dv2DrOQv.js";import{c as xe}from"./utils-small-jbG8BFt3.js";import{u as he}from"./vendor-react-router-B4Bn0PSh.js";const pe=de,ge=me,O=N.forwardRef(({className:t,...a},l)=>e.jsx(A,{ref:l,className:m("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...a}));O.displayName=A.displayName;const R=N.forwardRef(({className:t,children:a,...l},h)=>e.jsxs(ge,{children:[e.jsx(O,{}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs(E,{ref:h,className:m("z-50 grid w-full max-w-lg gap-4 border bg-white dark:bg-gray-900 p-6 shadow-lg duration-200 rounded-lg","data-[state=open]:animate-in data-[state=open]:fade-in-0 data-[state=open]:zoom-in-95","data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95","data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%]","data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]","max-h-[90vh] overflow-y-auto",t),...l,children:[a,e.jsxs(ue,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Fechar"})]})]})})]}));R.displayName=E.displayName;const B=({className:t,...a})=>e.jsx("div",{className:m("flex flex-col space-y-1.5 text-center sm:text-left",t),...a});B.displayName="DialogHeader";const fe=({className:t,...a})=>e.jsx("div",{className:m("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a});fe.displayName="DialogFooter";const L=N.forwardRef(({className:t,...a},l)=>e.jsx(z,{ref:l,className:m("text-lg font-semibold leading-none tracking-tight",t),...a}));L.displayName=z.displayName;const je=N.forwardRef(({className:t,...a},l)=>e.jsx(F,{ref:l,className:m("text-sm text-muted-foreground",t),...a}));je.displayName=F.displayName;const P={default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"};function k({className:t,variant:a="default",...l}){return e.jsx("div",{className:xe("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",P[a]||P.default,t),...l})}const ve=()=>{const{user:t}=ee(),{toast:a}=se(),l=he(),[h,w]=o.useState([]),[q,$]=o.useState([]),[M,C]=o.useState(!0),[p,H]=o.useState(""),[u,Q]=o.useState("all"),[V,g]=o.useState(!1),[f,D]=o.useState(null),[r,d]=o.useState({selectedClasses:[],customTitle:"",customDescription:"",customInstructions:"",dueDate:"",maxPoints:100});o.useEffect(()=>{T()},[]);const T=async()=>{try{C(!0);const{data:s,error:i}=await v.from("activity_templates").select("*").eq("created_by",t.id).order("created_at",{ascending:!1});if(i)throw i;w(s||[]);const{data:c,error:j}=await v.from("classes").select("*").eq("teacher_id",t.id);if(j)throw j;$(c||[])}catch(s){console.error("Error loading data:",s),a({title:"Erro ao carregar dados",description:"Não foi possível carregar as atividades e turmas.",variant:"destructive"})}finally{C(!1)}},X=async s=>{if(confirm("Tem certeza que deseja excluir este template?"))try{const{error:i}=await v.from("activity_templates").delete().eq("id",s).eq("created_by",t.id);if(i)throw i;w(h.filter(c=>c.id!==s)),a({title:"Template excluído",description:"O template foi excluído com sucesso."})}catch(i){console.error("Error deleting template:",i),a({title:"Erro ao excluir",description:"Não foi possível excluir o template.",variant:"destructive"})}},G=async()=>{if(r.selectedClasses.length===0){a({title:"Selecione turmas",description:"Selecione pelo menos uma turma para publicar a atividade.",variant:"destructive"});return}try{const{error:s}=await v.rpc("publish_activity_template",{template_id_param:f.id,class_ids:r.selectedClasses,custom_title:r.customTitle||null,custom_description:r.customDescription||null,custom_instructions:r.customInstructions||null,custom_due_date:r.dueDate||null,custom_max_points:r.maxPoints});if(s)throw s;a({title:"Atividade publicada!",description:`A atividade foi publicada em ${r.selectedClasses.length} turma(s).`}),g(!1),D(null),d({selectedClasses:[],customTitle:"",customDescription:"",customInstructions:"",dueDate:"",maxPoints:100}),T()}catch(s){console.error("Error publishing template:",s),a({title:"Erro ao publicar",description:"Não foi possível publicar a atividade.",variant:"destructive"})}},I=s=>{D(s),g(!0)},_=h.filter(s=>{const i=s.title.toLowerCase().includes(p.toLowerCase())||s.description?.toLowerCase().includes(p.toLowerCase()),c=u==="all"||u==="published"&&s.is_public||u==="drafts"&&!s.is_public;return i&&c});return M?e.jsx("div",{className:"min-h-screen bg-gray-50 flex justify-center items-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando atividades..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("nav",{className:"bg-white shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between h-16",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"TamanduAI"})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(n,{onClick:()=>l("/dashboard/activities/create"),children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Nova Atividade"]}),e.jsx(n,{variant:"outline",onClick:()=>l("/dashboard"),children:"Dashboard"})]})]})})}),e.jsx("main",{className:"py-6 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Minhas Atividades"}),e.jsx("p",{className:"text-gray-600",children:"Gerencie seus templates de atividades e publique-os nas turmas"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(b,{placeholder:"Buscar atividades...",value:p,onChange:s=>H(s.target.value),className:"pl-10"})]})}),e.jsxs(ae,{value:u,onValueChange:Q,children:[e.jsx(te,{className:"w-full sm:w-48",children:e.jsx(ie,{placeholder:"Filtrar por..."})}),e.jsxs(le,{children:[e.jsx(y,{value:"all",children:"Todas"}),e.jsx(y,{value:"published",children:"Publicadas"}),e.jsx(y,{value:"drafts",children:"Rascunhos"})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:_.map(s=>e.jsxs(re,{className:"hover:shadow-md transition-shadow",children:[e.jsx(ce,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(oe,{className:"text-lg line-clamp-2",children:s.title}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>l(`/dashboard/activities/edit/${s.id}`),title:"Editar",children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>I(s),title:"Publicar",children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>X(s.id),title:"Excluir",className:"text-red-600 hover:text-red-700",children:e.jsx(K,{className:"h-4 w-4"})})]})]})}),e.jsx(ne,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600 line-clamp-3",children:s.description||"Sem descrição"}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{variant:s.is_public?"default":"secondary",children:s.is_public?"Público":"Rascunho"}),s.tags&&s.tags.length>0&&e.jsxs(k,{variant:"outline",children:[s.tags.length," tag(s)"]})]})}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Criado em ",new Date(s.created_at).toLocaleDateString()]})]})})]},s.id))}),_.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Z,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Nenhuma atividade encontrada"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:p||u!=="all"?"Tente ajustar os filtros de busca.":"Comece criando sua primeira atividade."}),e.jsx("div",{className:"mt-6",children:e.jsxs(n,{onClick:()=>l("/dashboard/activities/create"),children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Criar Nova Atividade"]})})]})]})}),e.jsx(pe,{open:V,onOpenChange:g,children:e.jsxs(R,{className:"sm:max-w-[500px]",children:[e.jsx(B,{children:e.jsx(L,{children:"Publicar Atividade"})}),f&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:f.title}),e.jsx("p",{className:"text-sm text-gray-600",children:"Selecione as turmas onde deseja publicar esta atividade"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"classes",children:"Turmas"}),e.jsx("div",{className:"mt-2 space-y-2 max-h-40 overflow-y-auto",children:q.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:`class-${s.id}`,checked:r.selectedClasses.includes(s.id),onChange:i=>{i.target.checked?d(c=>({...c,selectedClasses:[...c.selectedClasses,s.id]})):d(c=>({...c,selectedClasses:c.selectedClasses.filter(j=>j!==s.id)}))},className:"rounded border-gray-300"}),e.jsx(x,{htmlFor:`class-${s.id}`,className:"text-sm",children:s.name})]},s.id))})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"customTitle",children:"Título personalizado (opcional)"}),e.jsx(b,{id:"customTitle",value:r.customTitle,onChange:s=>d(i=>({...i,customTitle:s.target.value})),placeholder:f.title})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"maxPoints",children:"Pontuação máxima"}),e.jsx(b,{id:"maxPoints",type:"number",min:"1",max:"1000",value:r.maxPoints,onChange:s=>d(i=>({...i,maxPoints:parseInt(s.target.value)||100}))})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"dueDate",children:"Data de entrega (opcional)"}),e.jsx(b,{id:"dueDate",type:"datetime-local",value:r.dueDate,onChange:s=>d(i=>({...i,dueDate:s.target.value}))})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(n,{variant:"outline",onClick:()=>g(!1),children:"Cancelar"}),e.jsxs(n,{onClick:G,children:["Publicar (",r.selectedClasses.length," turma",r.selectedClasses.length!==1?"s":"",")"]})]})]})]})})]})},De=Object.freeze(Object.defineProperty({__proto__:null,default:ve},Symbol.toStringTag,{value:"Module"}));export{De as A,k as B,pe as D,R as a,B as b,L as c,fe as d};
