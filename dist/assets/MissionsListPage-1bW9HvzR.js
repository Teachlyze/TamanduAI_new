import{u as k,g as X,r as o,s as N,ar as L,j as e,o as K,U as b,T as U,A as w,d as $,C as F,n as I}from"./main-Cv3DLBs1.js";import{B as y}from"./badge-CS76XO47.js";import{P as d}from"./PremiumCard-C8PJt07T.js";import{P as C}from"./PremiumButton-DEtqLbhG.js";import{E as j}from"./EmptyState-BvWI2uN2.js";import{P as Y}from"./plus-CHwJ6wYR.js";import{T as h}from"./target-BazIADWF.js";import{C as P}from"./circle-check-big-Ca-JuLlv.js";import{R as M,T as _}from"./CategoricalChart-DFdgY7Cg.js";import{P as q,a as G,C as z}from"./PieChart-Ce5PFbXV.js";import{L as S}from"./Legend-BjtKW1bg.js";import{B as H,a as J}from"./BarChart-eYZo2K9K.js";import{C as O,X as Q,Y as V}from"./CartesianChart-CR27bgd1.js";import"./index-D_P3mdcN.js";const xe=()=>{const{user:f}=k(),g=X(),[A,E]=o.useState(!0),[n,D]=o.useState([]),[i,R]=o.useState([]);o.useEffect(()=>{T()},[f?.id]);const T=async()=>{try{const{data:s,error:t}=await N.from("missions").select("*").eq("created_by",f.id).order("created_at",{ascending:!1});if(t)throw t;if(D(s||[]),s&&s.length>0){const l=s.map(x=>x.id),{data:a}=await N.from("user_missions").select("*, profiles(full_name, email)").in("mission_id",l);R(a||[])}}catch(s){console.error("Erro ao carregar missões:",s),L({title:"Erro",description:"Não foi possível carregar as missões.",variant:"destructive"})}finally{E(!1)}},u=s=>{const t=i.filter(r=>r.mission_id===s),l=t.length,a=t.filter(r=>r.status==="completed").length,x=t.filter(r=>r.status==="in_progress").length,c=t.filter(r=>r.status==="pending").length;return{total:l,completed:a,inProgress:x,pending:c,completionRate:l>0?(a/l*100).toFixed(1):0}},m=o.useMemo(()=>{const s=n.length,t=n.filter(c=>c.is_active).length,l=i.length,a=i.filter(c=>c.status==="completed").length,x=n.reduce((c,r)=>{const B=i.filter(v=>v.mission_id===r.id&&v.status==="completed").length;return c+B*r.xp_reward},0);return{total:s,active:t,totalStudents:l,completedMissions:a,totalXpAwarded:x}},[n,i]),p=o.useMemo(()=>{const s=i.filter(a=>a.status==="completed").length,t=i.filter(a=>a.status==="in_progress").length,l=i.filter(a=>a.status==="pending").length;return[{name:"Concluídas",value:s,color:"#10b981"},{name:"Em Andamento",value:t,color:"#f59e0b"},{name:"Pendentes",value:l,color:"#6b7280"}]},[i]);return A?e.jsx(K,{message:"Carregando missões..."}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent",children:"Missões"}),e.jsx("p",{className:"text-muted-foreground",children:"Crie e acompanhe desafios para seus alunos"})]}),e.jsxs(C,{onClick:()=>g("/dashboard/missions/create"),className:"bg-gradient-to-r from-orange-600 to-red-600 text-white whitespace-nowrap inline-flex items-center gap-2 shadow-lg font-semibold rounded-xl",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{children:"Nova Missão"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(d,{variant:"elevated",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-orange-500 to-red-500 rounded-lg flex items-center justify-center",children:e.jsx(h,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Missões"}),e.jsx("div",{className:"text-2xl font-bold",children:m.total})]})]})})}),e.jsx(d,{variant:"elevated",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-500 rounded-lg flex items-center justify-center",children:e.jsx(P,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Ativas"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:m.active})]})]})})}),e.jsx(d,{variant:"elevated",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-lg flex items-center justify-center",children:e.jsx(b,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Participantes"}),e.jsx("div",{className:"text-2xl font-bold",children:m.totalStudents})]})]})})}),e.jsx(d,{variant:"elevated",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg flex items-center justify-center",children:e.jsx(U,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Concluídas"}),e.jsx("div",{className:"text-2xl font-bold",children:m.completedMissions})]})]})})}),e.jsx(d,{variant:"elevated",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-yellow-500 to-orange-500 rounded-lg flex items-center justify-center",children:e.jsx(w,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"XP Distribuído"}),e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:m.totalXpAwarded})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(d,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Distribuição de Status"}),p.every(s=>s.value===0)?e.jsx(j,{icon:h,title:"Sem dados",description:"Crie missões para ver estatísticas."}):e.jsx(M,{width:"100%",height:250,children:e.jsxs(q,{children:[e.jsx(G,{data:p,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:80,label:!0,children:p.map((s,t)=>e.jsx(z,{fill:s.color},`cell-${t}`))}),e.jsx(_,{}),e.jsx(S,{})]})})]})}),e.jsx(d,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Taxa de Conclusão por Missão"}),n.length===0?e.jsx(j,{icon:h,title:"Sem missões"}):e.jsx(M,{width:"100%",height:250,children:e.jsxs(H,{data:n.slice(0,5).map(s=>({name:s.title.substring(0,20),rate:parseFloat(u(s.id).completionRate)})),children:[e.jsx(O,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"name",angle:-45,textAnchor:"end",height:100}),e.jsx(V,{domain:[0,100]}),e.jsx(_,{}),e.jsx(S,{}),e.jsx(J,{dataKey:"rate",fill:"#f59e0b",name:"Taxa de Conclusão (%)"})]})})]})})]}),e.jsx(d,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Missões Criadas"}),n.length===0?e.jsx(j,{icon:h,title:"Nenhuma missão criada",description:"Crie sua primeira missão para engajar os alunos!",action:e.jsx(C,{onClick:()=>g("/dashboard/missions/create"),className:"whitespace-nowrap inline-flex items-center gap-2 rounded-lg",children:"Criar Missão"})}):e.jsx("div",{className:"space-y-4",children:n.map(s=>{const t=u(s.id);return e.jsxs("div",{className:"p-4 border border-border rounded-xl hover:shadow-md transition-shadow cursor-pointer",onClick:()=>g(`/dashboard/missions/${s.id}`),children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-bold",children:s.title}),s.is_active?e.jsx(y,{className:"bg-green-500/20 text-green-700",children:"Ativa"}):e.jsx(y,{variant:"secondary",children:"Inativa"})]}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"w-4 h-4"}),s.classes?.name]}),s.end_date&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($,{className:"w-4 h-4"}),new Date(s.end_date).toLocaleDateString("pt-BR")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"w-4 h-4 text-yellow-500"}),s.xp_reward," XP"]})]})]})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progresso"}),e.jsxs("span",{className:"font-semibold",children:[t.completionRate,"%"]})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-emerald-500 transition-all",style:{width:`${t.completionRate}%`}})}),e.jsxs("div",{className:"flex items-center gap-6 mt-3 text-xs",children:[e.jsxs("span",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(P,{className:"w-3 h-3"}),t.completed," Concluídas"]}),e.jsxs("span",{className:"flex items-center gap-1 text-orange-600",children:[e.jsx(F,{className:"w-3 h-3"}),t.inProgress," Em Andamento"]}),e.jsxs("span",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(I,{className:"w-3 h-3"}),t.pending," Pendentes"]})]})]})]},s.id)})})]})})]})};export{xe as default};
