import{f as z,u as $,r as d,j as e,a2 as Q,i as p,aZ as u,D as Z,F as G,H as C,aS as M,I as T,bz as X,aP as Y,Y as J,t as K,d as U,C as W}from"./main-Bujpyeg-.js";import{u as ee}from"./use-toast-9Xc4qRbM.js";import{P as ae}from"./PageHeader-CCEdZZFz.js";import{B as se}from"./bell-Cp3o7t82.js";import{F as E}from"./funnel-BoelNdGr.js";import{T as te}from"./trash-2-DLTKevMB.js";import{p as L}from"./parseISO-CUV0sbTS.js";import{C as re}from"./circle-check-big-CPiXxACV.js";import{T as ie}from"./triangle-alert-Cw-mO2fL.js";import{f as le}from"./formatDistanceToNow-w4ORaTbG.js";import{f as ce}from"./format-C6ZKAeCj.js";import{p as F}from"./pt-BR-CrTIlDyR.js";import"./toDate-B_SDEMqy.js";import"./constructNow-BUe0KqNa.js";import"./endOfMonth-5f4-gZt5.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]],ne=z("bell-off",oe);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M22 13V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h8",key:"12jkf8"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}],["path",{d:"m16 19 2 2 4-4",key:"1b14m6"}]],me=z("mail-check",de);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M21.2 8.4c.5.38.8.97.8 1.6v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V10a2 2 0 0 1 .8-1.6l8-6a2 2 0 0 1 2.4 0l8 6Z",key:"1jhwl8"}],["path",{d:"m22 10-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 10",key:"1qfld7"}]],I=z("mail-open",xe),_e=()=>{const{user:c}=$(),{toast:o}=ee(),[m,l]=d.useState([]),[n,v]=d.useState([]),[g,r]=d.useState(!0),[i,x]=d.useState(new Set),[N,R]=d.useState(""),[y,B]=d.useState("all"),[h,D]=d.useState({info:!0,reminder:!0,alert:!0,event:!0}),k=d.useCallback(async()=>{if(c)try{r(!0);const{data:a}=await NotificationService.getNotifications({limit:100,orderBy:"created_at",orderDir:"desc"});l(a||[]),v(a||[])}catch(a){console.error("Error fetching notifications:",a),o({variant:"destructive",title:"Erro ao carregar notificações",description:"Não foi possível carregar as notificações. Tente novamente mais tarde."})}finally{r(!1)}},[o,c]);d.useEffect(()=>{let a=[...m];y==="unread"?a=a.filter(t=>!t.is_read):y==="read"&&(a=a.filter(t=>t.is_read));const s=Object.entries(h).filter(([,t])=>t).map(([t])=>t);if(s.length>0&&(a=a.filter(t=>s.includes(t.type))),N.trim()){const t=N.toLowerCase();a=a.filter(f=>f.title.toLowerCase().includes(t)||f.message.toLowerCase().includes(t))}v(a)},[m,y,h,N]);const w=a=>{const s=new Set(i);s.has(a)?s.delete(a):s.add(a),x(s)},q=a=>{x(a?new Set(n.map(s=>s.id)):new Set)},O=async()=>{if(i.size!==0)try{await NotificationService.markAsRead(Array.from(i),{userId:c?.id}),l(a=>a.map(s=>i.has(s.id)?{...s,read_at:new Date().toISOString()}:s)),x(new Set),o({title:"Notificações marcadas como lidas",description:`${i.size} notificação(s) marcada(s) como lida(s)`})}catch(a){console.error("Error marking notifications as read:",a),o({title:"Erro",description:"Não foi possível marcar as notificações como lidas",variant:"destructive"})}},H=async()=>{if(i.size!==0)try{await NotificationService.deleteNotification(Array.from(i),{userId:c?.id}),l(a=>a.filter(s=>!i.has(s.id))),x(new Set),o({title:"Notificações excluídas",description:`${i.size} notificação(s) excluída(s) com sucesso`})}catch(a){console.error("Error deleting notifications:",a),o({title:"Erro",description:"Não foi possível excluir as notificações selecionadas",variant:"destructive"})}},P=async()=>{try{const a=m.filter(s=>!s.read_at);a.length>0&&await NotificationService.markAsRead(a.map(s=>s.id),{userId:c?.id}),l(s=>s.map(t=>({...t,read_at:t.read_at||new Date().toISOString()}))),x(new Set),o({title:"Todas as notificações marcadas como lidas",description:"Suas notificações foram marcadas como lidas"})}catch(a){console.error("Error marking all as read:",a),o({title:"Erro",description:"Não foi possível marcar todas as notificações como lidas",variant:"destructive"})}},j=a=>{D(s=>({...s,[a]:!s[a]}))},S=a=>{switch(a){case"reminder":return e.jsx(W,{className:"h-4 w-4 text-amber-500"});case"alert":return e.jsx(ie,{className:"h-4 w-4 text-red-500"});case"event":return e.jsx(U,{className:"h-4 w-4 text-blue-500"});default:return e.jsx(re,{className:"h-4 w-4 text-green-500"})}};d.useEffect(()=>{if(!c)return;const a=NotificationService.subscribeToNotifications(s=>{console.log("Notification update received:",s),k()});return k(),()=>{a&&typeof a.unsubscribe=="function"&&a.unsubscribe()}},[k,c]);const b=m.filter(a=>!a.is_read).length,A=n.length>0&&n.every(a=>i.has(a.id)),V=n.some(a=>i.has(a.id));return e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsx(ae,{title:"Central de Notificações",description:"Gerencie suas notificações",icon:se}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx("div",{className:"flex-1 w-full sm:w-auto",children:e.jsxs("div",{className:"relative",children:[e.jsx(Q,{placeholder:"Buscar notificações...",value:N,onChange:a=>R(a.target.value),className:"pl-10 w-full sm:w-80"}),e.jsx(E,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"})]})}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto justify-between sm:justify-end",children:[e.jsxs(p,{variant:"outline",size:"sm",onClick:P,disabled:b===0,children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Marcar todas como lidas"]}),e.jsxs("div",{className:"relative group",children:[e.jsxs(p,{variant:"outline",size:"sm",children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Filtrar"]}),e.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 p-2 z-10 hidden group-hover:block",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:[e.jsx(u,{id:"filter-info",checked:h.info,onCheckedChange:()=>j("info")}),e.jsx("label",{htmlFor:"filter-info",className:"text-sm font-medium leading-none",children:"Informações"})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:[e.jsx(u,{id:"filter-reminder",checked:h.reminder,onCheckedChange:()=>j("reminder")}),e.jsx("label",{htmlFor:"filter-reminder",className:"text-sm font-medium leading-none",children:"Lembretes"})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:[e.jsx(u,{id:"filter-alert",checked:h.alert,onCheckedChange:()=>j("alert")}),e.jsx("label",{htmlFor:"filter-alert",className:"text-sm font-medium leading-none",children:"Alertas"})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:[e.jsx(u,{id:"filter-event",checked:h.event,onCheckedChange:()=>j("event")}),e.jsx("label",{htmlFor:"filter-event",className:"text-sm font-medium leading-none",children:"Eventos"})]})]})})]})]})]}),e.jsxs(Z,{defaultValue:"all",className:"w-full",onValueChange:B,children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsxs(G,{className:"bg-transparent p-0 h-auto rounded-none w-full justify-start",children:[e.jsx(C,{value:"all",className:"relative py-3 px-4 data-[state=active]:shadow-none",children:"Todas"}),e.jsxs(C,{value:"unread",className:"relative py-3 px-4 data-[state=active]:shadow-none",children:[e.jsx("span",{children:"Não lidas"}),b>0&&e.jsx("span",{className:"ml-2 bg-blue-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:b>9?"9+":b})]}),e.jsx(C,{value:"read",className:"relative py-3 px-4 data-[state=active]:shadow-none",children:"Lidas"})]})}),e.jsx("div",{className:M("px-4 py-2 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 transition-all duration-200 overflow-hidden",i.size===0?"max-h-0 p-0 border-0":"max-h-16"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{id:"select-all",checked:A,onCheckedChange:q,ref:a=>{a&&(a.indeterminate=V&&!A)}}),e.jsxs("label",{htmlFor:"select-all",className:"text-sm font-medium leading-none",children:[i.size," selecionada(s)"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(p,{variant:"ghost",size:"sm",className:"text-sm",onClick:O,disabled:i.size===0,children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Marcar como lida(s)"]}),e.jsxs(p,{variant:"ghost",size:"sm",className:"text-red-600 hover:bg-red-50 hover:text-red-700 dark:text-red-400 dark:hover:bg-red-900/30 dark:hover:text-red-300",onClick:H,disabled:i.size===0,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Excluir"]})]})]})}),e.jsx(T,{value:"all",className:"m-0",children:e.jsx(_,{notifications:n,isLoading:g,selectedNotifications:i,onToggleSelect:w,onMarkAsRead:a=>{const s=m.find(t=>t.id===a);s&&!s.is_read&&(NotificationService.markAsRead(a),l(t=>t.map(f=>f.id===a?{...f,is_read:!0}:f)))},onDelete:a=>{window.confirm("Tem certeza que deseja excluir esta notificação?")&&(NotificationService.deleteNotifications([a]),l(s=>s.filter(t=>t.id!==a)))},getNotificationIcon:S})}),e.jsx(T,{value:"unread",className:"m-0",children:e.jsx(_,{notifications:n,isLoading:g,selectedNotifications:i,onToggleSelect:w,onMarkAsRead:a=>{NotificationService.markAsRead(a),l(s=>s.map(t=>t.id===a?{...t,is_read:!0}:t))},onDelete:a=>{window.confirm("Tem certeza que deseja excluir esta notificação?")&&(NotificationService.deleteNotifications([a]),l(s=>s.filter(t=>t.id!==a)))},getNotificationIcon:S})}),e.jsx(T,{value:"read",className:"m-0",children:e.jsx(_,{notifications:n,isLoading:g,selectedNotifications:i,onToggleSelect:w,onMarkAsRead:null,onDelete:a=>{window.confirm("Tem certeza que deseja excluir esta notificação?")&&(NotificationService.deleteNotifications([a]),l(s=>s.filter(t=>t.id!==a)))},getNotificationIcon:S})})]})]})]})},_=({notifications:c,isLoading:o,selectedNotifications:m,onToggleSelect:l,onMarkAsRead:n,onDelete:v,getNotificationIcon:g})=>o?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8",children:[e.jsx(X,{className:"h-8 w-8 text-blue-500"}),e.jsx("p",{className:"mt-4 text-sm text-gray-500",children:"Carregando notificações..."})]}):c.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(ne,{className:"h-12 w-12 text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Nenhuma notificação encontrada"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Quando você tiver notificações, elas aparecerão aqui."})]}):e.jsx(Y,{className:"h-[calc(100vh-320px)]",children:e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:c.map(r=>e.jsx("div",{className:M("p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",!r.is_read&&"bg-blue-50 dark:bg-blue-900/10",m.has(r.id)&&"bg-blue-100 dark:bg-gray-100 dark:bg-gray-800"),children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 pt-1",children:e.jsx(u,{id:`select-${r.id}`,checked:m.has(r.id),onCheckedChange:()=>l(r.id),className:"mt-1"})}),e.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[g(r.type),e.jsx("h3",{className:"ml-2 text-sm font-medium text-gray-900 dark:text-white",children:r.title})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs text-gray-400",children:le(L(r.created_at),{addSuffix:!0,locale:F})}),e.jsxs("div",{className:"flex items-center space-x-1",children:[n&&!r.is_read&&e.jsx("button",{onClick:()=>n(r.id),className:"p-1 text-gray-400 hover:text-blue-500 dark:text-gray-500 dark:hover:text-blue-400",title:"Marcar como lida",children:e.jsx(I,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>v(r.id),className:"p-1 text-gray-400 hover:text-red-500 dark:text-gray-500 dark:hover:text-red-400",title:"Excluir notificação",children:e.jsx(J,{className:"h-4 w-4"})})]})]})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-300",children:r.message}),r.link&&e.jsx("div",{className:"mt-2",children:e.jsx(p,{variant:"link",size:"sm",className:"h-auto p-0 text-sm",onClick:()=>window.location.href=r.link,children:"Ver detalhes"})}),e.jsxs("div",{className:"mt-2 flex items-center text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"inline-flex items-center",children:r.is_read?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-3 w-3 text-green-500 mr-1"}),"Lida"]}):e.jsx("span",{className:"h-2 w-2 rounded-full bg-blue-500 mr-1"})}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsx("span",{children:ce(L(r.created_at),"PPpp",{locale:F})})]})]})]})},r.id))})});export{_e as default};
