const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-32gA9Cdv.js","assets/main-Bujpyeg-.js","assets/main-By6hUV15.css","assets/typeof-CPR7xHyo.js"])))=>i.map(i=>d[i]);
import{f as V,u as ne,r as i,s as ce,j as e,m as r,U as P,B as A,k as _,Z as B,A as oe,_ as E}from"./main-Bujpyeg-.js";import{P as p}from"./PremiumCard-BaDWg06v.js";import{B as x}from"./badge-BFkPUQ-P.js";import{P as R}from"./PremiumButton-skKgx_xy.js";import{a as C}from"./analyticsMLService-e_p8jAn1.js";import{B as xe}from"./brain-vNXhM8pG.js";import{T as me}from"./trophy-BvMu_Ocx.js";import{R as u,T as N,L as S}from"./CategoricalChart-CY_EmT4u.js";import{P as F,a as L}from"./PieChart-ERxWODQw.js";import{C as O}from"./PolarChart-BRCObcKw.js";import{B as X,a as f}from"./BarChart-8V15VaNt.js";import{C as G,X as K,Y as H}from"./CartesianChart-BIfIJjYb.js";import{S as $}from"./sparkles-BvEmMhAS.js";import{T as U}from"./target-BbDyQUob.js";import"./index-D_P3mdcN.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],ge=V("arrow-down",he);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],pe=V("arrow-up",je);function Be(){const{user:b}=ne(),[ue,v]=i.useState(!0),[l,q]=i.useState([]),[o,z]=i.useState([]),[Ne,W]=i.useState(null),[d,Y]=i.useState(null),[Z,D]=i.useState(!1),I=i.useRef(null);i.useEffect(()=>{b&&J()},[b]);const J=async()=>{v(!0);const{data:s}=await ce.from("schools").select("id").eq("owner_id",b.id).single();if(!s){v(!1);return}const[a,t]=await Promise.all([C.compareTeachers(s.id),C.compareClasses(s.id)]);q(a||[]),z(t||[]),v(!1)},Q=async s=>{W(s),D(!0);const a=l.find(t=>t.teacherId===s);if(a){const t=await C.generateAIInsights(a,"teacher");Y(t)}D(!1)},ee=s=>s==="high"?"text-green-600 bg-green-100":s==="medium"?"text-yellow-600 bg-yellow-100":"text-red-600 bg-red-100",se=s=>s==="improving"?e.jsx(pe,{className:"w-5 h-5 text-green-600"}):s==="declining"?e.jsx(ge,{className:"w-5 h-5 text-red-600"}):e.jsx(U,{className:"w-5 h-5 text-blue-600"}),ae=async()=>{try{const[{default:s},a]=await Promise.all([E(()=>import("./html2canvas.esm-BgurttRc.js"),[]),E(()=>import("./jspdf.es.min-32gA9Cdv.js"),__vite__mapDeps([0,1,2,3]))]),t=a.jsPDF||a.default||a,n=I.current;if(!n)return;const y=await s(n,{scale:2,useCORS:!0,backgroundColor:"#ffffff"}),M=y.toDataURL("image/png"),c=new t("p","mm","a4"),ie=c.internal.pageSize.getWidth(),T=c.internal.pageSize.getHeight(),w=ie,g=y.height*w/y.width;let k=0,j=g;for(c.addImage(M,"PNG",0,k,w,g),j-=T;j>0;)c.addPage(),k=-(g-j),c.addImage(M,"PNG",0,k,w,g),j-=T;const de=`tamanduai-analytics-ml-escola-${new Date().toISOString().slice(0,10)}.pdf`;c.save(de)}catch(s){console.error("Falha ao exportar PDF:",s),alert("Para exportar o PDF, instale as dependências: npm i jspdf html2canvas")}},te=l.slice(0,5).map(s=>({name:s.name?.split(" ")[0]||"Professor","Média Notas":s.avgGrade,"XP Total":Math.round(s.totalXP/100),Atividades:s.totalActivities})),re=o.slice(0,8).map(s=>({name:s.className?.substring(0,15)||"Turma",Média:s.avgGrade,"Média Ajustada":s.adjustedAvg,Alunos:s.totalStudents})),le=o.reduce((s,a)=>{const t=a.gradeBuckets||{};return Object.keys(t).forEach(n=>{s[n]=(s[n]||0)+t[n]}),s},{"0-49":0,"50-69":0,"70-84":0,"85-100":0}),m=Object.entries(le).map(([s,a])=>({name:s,value:a})),h=["#ef4444","#f59e0b","#3b82f6","#10b981"];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900",children:[e.jsx(r.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-8 shadow-xl",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-4",children:[e.jsx("div",{className:"p-3 bg-white/10 rounded-xl backdrop-blur-sm",children:e.jsx(xe,{className:"w-8 h-8"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Analytics ML - Escola"}),e.jsx("p",{className:"text-blue-100",children:"Inteligência Artificial para insights institucionais"})]}),e.jsx(R,{onClick:ae,className:"bg-white text-indigo-700 hover:bg-indigo-50",children:"Exportar PDF"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[e.jsxs(r.div,{whileHover:{scale:1.05},className:"bg-white/10 backdrop-blur-sm rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(P,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm text-blue-100",children:"Professores"})]}),e.jsx("div",{className:"text-2xl font-bold",children:l.length})]}),e.jsxs(r.div,{whileHover:{scale:1.05},className:"bg-white/10 backdrop-blur-sm rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(A,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm text-blue-100",children:"Turmas"})]}),e.jsx("div",{className:"text-2xl font-bold",children:o.length})]}),e.jsxs(r.div,{whileHover:{scale:1.05},className:"bg-white/10 backdrop-blur-sm rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(_,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm text-blue-100",children:"Média Geral"})]}),e.jsx("div",{className:"text-2xl font-bold",children:l.length>0?Math.round(l.reduce((s,a)=>s+a.avgGrade,0)/l.length*10)/10:0})]}),e.jsxs(r.div,{whileHover:{scale:1.05},className:"bg-gradient-to-br from-yellow-400 to-orange-500 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(me,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm text-white",children:"XP Total"})]}),e.jsxs("div",{className:"text-2xl font-bold",children:[Math.round(l.reduce((s,a)=>s+a.totalXP,0)/1e3),"k"]})]})]})]})}),e.jsx("div",{ref:I,className:"max-w-7xl mx-auto p-6",children:e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05},className:"lg:col-span-2",children:e.jsx(p,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(_,{className:"w-6 h-6 text-emerald-600"}),e.jsx("h2",{className:"text-xl font-bold",children:"Distribuição de Notas (Escola)"})]}),m.reduce((s,a)=>s+a.value,0)===0?e.jsx("div",{className:"text-center py-6 text-gray-500",children:"Sem dados suficientes"}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 items-center",children:[e.jsx(u,{width:"100%",height:260,children:e.jsxs(F,{children:[e.jsx(L,{data:m,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:90,label:({name:s,percent:a})=>`${s}: ${(a*100).toFixed(0)}%`,children:m.map((s,a)=>e.jsx(O,{fill:h[a%h.length]},`cell-${a}`))}),e.jsx(N,{}),e.jsx(S,{})]})}),e.jsx("div",{className:"space-y-2",children:m.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-block w-3 h-3 rounded-sm",style:{backgroundColor:h[a%h.length]}}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:s.name})]}),e.jsx("span",{className:"text-sm font-medium",children:s.value})]},s.name))})]})]})})}),e.jsx(r.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1},children:e.jsx(p,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(P,{className:"w-6 h-6 text-purple-600"}),e.jsx("h2",{className:"text-xl font-bold",children:"Desempenho por Professor"})]}),l.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(P,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Nenhum professor analisado"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsx(u,{width:"100%",height:250,children:e.jsxs(X,{data:te,children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"name"}),e.jsx(H,{}),e.jsx(N,{}),e.jsx(S,{}),e.jsx(f,{dataKey:"Média Notas",fill:"#8b5cf6"}),e.jsx(f,{dataKey:"XP Total",fill:"#3b82f6"})]})})}),e.jsx("div",{className:"space-y-3",children:l.map((s,a)=>e.jsxs(r.div,{whileHover:{scale:1.02},className:"p-4 rounded-xl bg-gradient-to-r from-slate-50 to-white dark:from-slate-800 dark:to-slate-700 border border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold text-white ${a===0?"bg-yellow-500":a===1?"bg-gray-400":a===2?"bg-orange-600":"bg-blue-500"}`,children:a+1}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[s.totalClasses," turma",s.totalClasses!==1?"s":""," • ",s.totalStudents," alunos"]})]})]}),e.jsxs(x,{className:"bg-purple-100 text-purple-700",children:["Média: ",s.avgGrade]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Atividades"}),e.jsx("p",{className:"text-lg font-bold",children:s.totalActivities})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"XP Gerado"}),e.jsxs("p",{className:"text-lg font-bold",children:[Math.round(s.totalXP/1e3),"k"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Engajamento"}),e.jsx("p",{className:"text-lg font-bold",children:Math.round(s.engagementScore)})]})]}),e.jsxs(R,{size:"sm",variant:"outline",onClick:()=>Q(s.teacherId),className:"w-full",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Ver Insights IA"]})]},s.teacherId))})]})]})})}),e.jsx(r.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.2},children:e.jsx(p,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(A,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold",children:"Desempenho por Turma"})]}),o.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(A,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Nenhuma turma analisada"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsx(u,{width:"100%",height:250,children:e.jsxs(X,{data:re,children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"name",angle:-45,textAnchor:"end",height:80}),e.jsx(H,{}),e.jsx(N,{}),e.jsx(S,{}),e.jsx(f,{dataKey:"Média",fill:"#3b82f6"}),e.jsx(f,{dataKey:"Média Ajustada",fill:"#8b5cf6"})]})})}),e.jsx("div",{className:"space-y-3 max-h-[400px] overflow-y-auto",children:o.map(s=>e.jsxs("div",{className:"p-4 rounded-xl border border-gray-200 dark:border-gray-600 bg-white dark:bg-slate-800",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:s.className}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Prof. ",s.teacherName]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[se(s.trend),e.jsxs(x,{className:"text-xs",children:["Média: ",s.avgGrade]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Alunos"}),e.jsx("p",{className:"font-bold",children:s.totalStudents})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"XP"}),e.jsxs("p",{className:"font-bold",children:[Math.round(s.totalXP/1e3),"k"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Consist."}),e.jsx(x,{className:"text-xs",variant:"outline",children:s.consistency==="high"?"Alta":s.consistency==="medium"?"Média":"Baixa"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Eng."}),e.jsx(x,{className:`text-xs ${ee(s.engagement)}`,children:s.engagement==="high"?"Alto":s.engagement==="medium"?"Médio":"Baixo"})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 p-2 text-center",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Dias médios entre submissões"}),e.jsx("p",{className:"text-sm font-semibold",children:s.avgDaysBetweenSubmissions??"N/D"})]}),e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 p-2 text-center",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Submissões por aluno (média)"}),e.jsx("p",{className:"text-sm font-semibold",children:s.submissionsPerStudentAvg??"N/D"})]})]}),s.xpSources&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-600",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Fontes de XP:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(s.xpSources).slice(0,3).map(([a,t])=>e.jsxs(x,{variant:"outline",className:"text-xs",children:[a,": ",t]},a))})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-600",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Distribuição de Notas"}),s.gradeBuckets?e.jsx("div",{className:"w-full md:w-1/2",children:e.jsx(u,{width:"100%",height:140,children:e.jsxs(F,{children:[e.jsx(L,{data:Object.entries(s.gradeBuckets).map(([a,t])=>({name:a,value:t})),dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:55,children:Object.entries(s.gradeBuckets).map((a,t)=>e.jsx(O,{fill:["#ef4444","#f59e0b","#3b82f6","#10b981"][t%4]},`cls-cell-${s.classId}-${t}`))}),e.jsx(N,{})]})})}):e.jsx("p",{className:"text-xs text-gray-500",children:"Sem dados"})]})]},s.classId))})]})]})})}),d&&e.jsx(r.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"lg:col-span-2",children:e.jsx(p,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx($,{className:"w-6 h-6 text-yellow-600"}),e.jsx("h2",{className:"text-xl font-bold",children:"Insights Gerados por IA"})]}),Z?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(r.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"inline-block",children:e.jsx(B,{className:"w-12 h-12 text-purple-600"})}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Analisando com IA..."})]}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-green-600 mb-3 flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5"}),"Pontos Fortes"]}),e.jsx("ul",{className:"space-y-2",children:d.strengths?.map((s,a)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 mt-2"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:s})]},a))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-orange-600 mb-3 flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5"}),"Áreas de Melhoria"]}),e.jsx("ul",{className:"space-y-2",children:d.improvements?.map((s,a)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-orange-500 mt-2"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:s})]},a))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("h3",{className:"font-semibold text-blue-600 mb-3 flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),"Recomendações"]}),e.jsx("ul",{className:"space-y-2",children:d.recommendations?.map((s,a)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500 mt-2"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:s})]},a))})]}),d.recognition&&e.jsx("div",{className:"md:col-span-2 p-4 rounded-xl bg-gradient-to-r from-purple-100 to-pink-100 dark:from-purple-900 dark:to-pink-900",children:e.jsxs("p",{className:"text-center text-gray-800 dark:text-gray-200 italic",children:['"',d.recognition,'"']})})]})]})})})]})})]})}export{Be as default};
