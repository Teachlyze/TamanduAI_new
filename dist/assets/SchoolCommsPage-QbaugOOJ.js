import{u as O,r as t,s as p,j as e,M as P,K as q,bE as z,U as h,d as F}from"./main-Cv3DLBs1.js";import{s as B}from"./schoolService-wSgqT6WY.js";import{P as f}from"./PremiumCard-C8PJt07T.js";import{P as M}from"./PremiumButton-DEtqLbhG.js";import{S as G}from"./send-BE4VkFZG.js";const I=({announcement:l})=>{const d=()=>{const n=l.audience||{};return n.all?"Todos":n.teachers?"Professores":n.classes&&n.classes.length>0?`${n.classes.length} turma${n.classes.length>1?"s":""}`:"Não especificado"};return e.jsxs("div",{className:"rounded-lg border border-border/50 bg-card p-4",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:l.title}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:l.body})]})}),e.jsxs("div",{className:"mt-3 flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(h,{className:"h-3 w-3"}),d()]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"h-3 w-3"}),new Date(l.created_at).toLocaleDateString("pt-BR")]})]})]})},Y=()=>{const{user:l}=O(),[d,n]=t.useState(null),[j,R]=t.useState([]),[N,U]=t.useState([]),[L,v]=t.useState(!0),[i,w]=t.useState(!1),[y,x]=t.useState(null),[S,k]=t.useState(null),[c,C]=t.useState(""),[m,E]=t.useState(""),[o,u]=t.useState("all"),[_,D]=t.useState([]),[g,T]=t.useState("");t.useEffect(()=>{A()},[l?.id]);const A=async()=>{if(l?.id)try{v(!0);const s=await B.getUserSchool(l.id);if(n(s),s?.id){const{data:a,error:r}=await p.from("school_announcements").select("*").eq("school_id",s.id).order("created_at",{ascending:!1});if(r)throw r;R(a||[]);const b=await B.getClasses(s.id);U(b)}}catch(s){console.error("Error loading data:",s),x("Erro ao carregar dados")}finally{v(!1)}},$=async s=>{if(s.preventDefault(),!(!d?.id||!c.trim()||!m.trim()))try{w(!0),x(null),k(null);const a={};o==="all"?a.all=!0:o==="teachers"?a.teachers=!0:o==="classes"&&(a.classes=_);let r=null;const{error:b}=await p.from("school_announcements").insert({school_id:d.id,title:c.trim(),body:m.trim(),audience:a,created_by:l.id,publish_at:g?new Date(g).toISOString():null});if(r=b,r&&/publish_at/.test(r.message||"")){const{error:K}=await p.from("school_announcements").insert({school_id:d.id,title:c.trim(),body:m.trim(),audience:a,created_by:l.id});r=K}if(r)throw r;k("Comunicado enviado com sucesso!"),C(""),E(""),u("all"),D([]),T(""),await A()}catch(a){x(a.message||"Erro ao enviar comunicado")}finally{w(!1)}},H=s=>{D(a=>a.includes(s)?a.filter(r=>r!==s):[...a,s])};return L?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-32 animate-pulse rounded-lg bg-muted"},s))}):d?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 p-8 rounded-2xl text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-full flex items-center justify-center backdrop-blur",children:e.jsx(P,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Comunicados"}),e.jsxs("p",{className:"text-white/90 mt-1",children:["Envie comunicados para professores e turmas de ",d.name]})]})]}),e.jsx(M,{className:"bg-white text-indigo-700 hover:bg-white/90 whitespace-nowrap",children:"Novo Comunicado"})]})}),e.jsx(f,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Novo Comunicado"})]}),e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Título"}),e.jsx(q,{type:"text",value:c,onChange:s=>C(s.target.value),placeholder:"Ex: Reunião de Pais",disabled:i,required:!0,className:"bg-white dark:bg-slate-900"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Mensagem"}),e.jsx(z,{value:m,onChange:s=>E(s.target.value),placeholder:"Digite a mensagem do comunicado...",rows:4,disabled:i,required:!0,className:"bg-white dark:bg-slate-900"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Data e hora de publicação (opcional)"}),e.jsx(q,{type:"datetime-local",value:g,onChange:s=>T(s.target.value),className:"bg-white dark:bg-slate-900"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-3 block text-sm font-medium",children:"Destinatários"}),e.jsxs("div",{className:"space-y-3 bg-slate-50 dark:bg-slate-900 p-4 rounded-lg border border-border",children:[e.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-lg border border-border bg-white dark:bg-slate-800 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:[e.jsx("input",{type:"radio",name:"audience",value:"all",checked:o==="all",onChange:s=>u(s.target.value),disabled:i,className:"w-4 h-4 text-indigo-600"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4 text-indigo-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Todos (professores e alunos)"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-lg border border-border bg-white dark:bg-slate-800 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:[e.jsx("input",{type:"radio",name:"audience",value:"teachers",checked:o==="teachers",onChange:s=>u(s.target.value),disabled:i,className:"w-4 h-4 text-indigo-600"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Apenas professores"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-lg border border-border bg-white dark:bg-slate-800 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:[e.jsx("input",{type:"radio",name:"audience",value:"classes",checked:o==="classes",onChange:s=>u(s.target.value),disabled:i,className:"w-4 h-4 text-indigo-600"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Turmas específicas"})]})]})]}),o==="classes"&&e.jsxs("div",{className:"mt-4 space-y-2 rounded-lg border border-border p-4 bg-white dark:bg-slate-800",children:[e.jsx("div",{className:"text-sm font-semibold mb-3",children:"Selecione as turmas:"}),N.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhuma turma vinculada."}):e.jsx("div",{className:"space-y-2",children:N.map(s=>e.jsxs("label",{className:"flex items-center gap-3 p-2 rounded hover:bg-slate-50 dark:hover:bg-slate-700 cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:_.includes(s.id),onChange:()=>H(s.id),disabled:i,className:"w-4 h-4 text-indigo-600 rounded"}),e.jsx("span",{className:"text-sm font-medium",children:s.name})]},s.id))})]})]}),y&&e.jsx("div",{className:"rounded-lg bg-red-50 p-3 text-sm text-red-600",children:y}),S&&e.jsx("div",{className:"rounded-lg bg-green-50 p-3 text-sm text-green-600",children:S}),e.jsx(M,{type:"submit",disabled:i||!c.trim()||!m.trim(),className:"w-full bg-gradient-to-r from-indigo-600 to-blue-600 text-white whitespace-nowrap",loading:i,children:i?"Enviando...":"Enviar Comunicado"})]})]})}),e.jsx(f,{children:e.jsxs("div",{className:"p-6 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Histórico de Comunicados"})]}),j.length===0?e.jsx("div",{className:"rounded-lg border border-border/50 bg-card p-8 text-center text-muted-foreground",children:"Nenhum comunicado enviado ainda."}):j.map(s=>e.jsx(I,{announcement:s},s.id))]})})]}):e.jsx(f,{className:"p-8 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Escola não encontrada."})})};export{Y as default};
