import{bg as kD,bK as Xf,bU as d7,bh as u7,al as l7,r as qi,j as jr,D as ND,b as PD,x as h7,i as eu,V as p7,s as qf}from"./main-BrBEgNdp.js";import{A as f7}from"./arrow-left-C3YmVj01.js";var LD={exports:{}};(function(Ka,Bn){(function(Yi,xn){Ka.exports=xn()})(d7,function(){function Yi(t,e){return e.forEach(function(r){r&&typeof r!="string"&&!Array.isArray(r)&&Object.keys(r).forEach(function(n){if(n!=="default"&&!(n in t)){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}})}),Object.freeze(t)}var xn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function ke(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var on=function(t){try{return!!t()}catch{return!0}},O=!on(function(){var t=function(){}.bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),H=O,a=Function.prototype,f=a.call,h=H&&a.bind.bind(f,f),g=H?h:function(t){return function(){return f.apply(t,arguments)}},_=g({}.isPrototypeOf),E=function(t){return t&&t.Math===Math&&t},m=E(typeof globalThis=="object"&&globalThis)||E(typeof window=="object"&&window)||E(typeof self=="object"&&self)||E(typeof xn=="object"&&xn)||E(typeof xn=="object"&&xn)||function(){return this}()||Function("return this")(),p=O,A=Function.prototype,R=A.apply,D=A.call,P=typeof Reflect=="object"&&Reflect.apply||(p?D.bind(R):function(){return D.apply(R,arguments)}),k=g,b=k({}.toString),j=k("".slice),z=function(t){return j(b(t),8,-1)},S=z,F=g,M=function(t){if(S(t)==="Function")return F(t)},Z=typeof document=="object"&&document.all,U=Z===void 0&&Z!==void 0?function(t){return typeof t=="function"||t===Z}:function(t){return typeof t=="function"},Y={},q=!on(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),V=O,it=Function.prototype.call,mt=V?it.bind(it):function(){return it.apply(it,arguments)},wt={},yt={}.propertyIsEnumerable,Ht=Object.getOwnPropertyDescriptor,Yt=Ht&&!yt.call({1:2},1);wt.f=Yt?function(t){var e=Ht(this,t);return!!e&&e.enumerable}:yt;var At,Lt,zt=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},re=on,de=z,ft=Object,gt=g("".split),Zt=re(function(){return!ft("z").propertyIsEnumerable(0)})?function(t){return de(t)==="String"?gt(t,""):ft(t)}:ft,Pt=function(t){return t==null},Wt=Pt,oe=TypeError,fe=function(t){if(Wt(t))throw new oe("Can't call method on "+t);return t},le=Zt,Ie=fe,me=function(t){return le(Ie(t))},Oe=U,je=function(t){return typeof t=="object"?t!==null:Oe(t)},xe={},ir=xe,He=m,ae=U,Ne=function(t){return ae(t)?t:void 0},Ze=function(t,e){return arguments.length<2?Ne(ir[t])||Ne(He[t]):ir[t]&&ir[t][e]||He[t]&&He[t][e]},ee=m.navigator,be=ee&&ee.userAgent,We=be?String(be):"",Pe=m,Ee=We,te=Pe.process,Ae=Pe.Deno,Xe=te&&te.versions||Ae&&Ae.version,Be=Xe&&Xe.v8;Be&&(Lt=(At=Be.split("."))[0]>0&&At[0]<4?1:+(At[0]+At[1])),!Lt&&Ee&&(!(At=Ee.match(/Edge\/(\d+)/))||At[1]>=74)&&(At=Ee.match(/Chrome\/(\d+)/))&&(Lt=+At[1]);var ze=Lt,ot=ze,Et=on,nt=m.String,Dt=!!Object.getOwnPropertySymbols&&!Et(function(){var t=Symbol("symbol detection");return!nt(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&ot&&ot<41}),B=Dt&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Ft=Ze,St=U,Nt=_,Ut=Object,Xt=B?function(t){return typeof t=="symbol"}:function(t){var e=Ft("Symbol");return St(e)&&Nt(e.prototype,Ut(t))},Gt=String,ne=function(t){try{return Gt(t)}catch{return"Object"}},Re=U,pe=ne,Je=TypeError,I=function(t){if(Re(t))return t;throw new Je(pe(t)+" is not a function")},X=I,_t=Pt,K=function(t,e){var r=t[e];return _t(r)?void 0:X(r)},dt=mt,bt=U,rt=je,Vt=TypeError,ut={exports:{}},Kt=m,jt=Object.defineProperty,ge=m,W=function(t,e){try{jt(Kt,t,{value:e,configurable:!0,writable:!0})}catch{Kt[t]=e}return e},lt="__core-js_shared__",ct=ut.exports=ge[lt]||W(lt,{});(ct.versions||(ct.versions=[])).push({version:"3.42.0",mode:"pure",copyright:"Â© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var It=ut.exports,Ct=It,Ot=function(t,e){return Ct[t]||(Ct[t]=e||{})},Mt=fe,qt=Object,he=function(t){return qt(Mt(t))},Jt=he,Ve=g({}.hasOwnProperty),Ye=Object.hasOwn||function(t,e){return Ve(Jt(t),e)},or=g,ue=0,tr=Math.random(),Pr=or(1 .toString),_r=function(t){return"Symbol("+(t===void 0?"":t)+")_"+Pr(++ue+tr,36)},en=Ot,tn=Ye,Kn=_r,Ln=Dt,ln=B,hi=m.Symbol,Xi=en("wks"),Vs=ln?hi.for||hi:hi&&hi.withoutSetter||Kn,sn=function(t){return tn(Xi,t)||(Xi[t]=Ln&&tn(hi,t)?hi[t]:Vs("Symbol."+t)),Xi[t]},za=mt,Yo=je,Xo=Xt,js=K,_s=function(t,e){var r,n;if(bt(r=t.toString)&&!rt(n=dt(r,t))||bt(r=t.valueOf)&&!rt(n=dt(r,t)))return n;throw new Vt("Can't convert object to primitive value")},ia=TypeError,Es=sn("toPrimitive"),oa=function(t,e){if(!Yo(t)||Xo(t))return t;var r,n=js(t,Es);if(n){if(r=za(n,t,e),!Yo(r)||Xo(r))return r;throw new ia("Can't convert object to primitive value")}return _s(t)},Qe=Xt,an=function(t){var e=oa(t,"string");return Qe(e)?e:e+""},Le=je,sa=m.document,qa=Le(sa)&&Le(sa.createElement),Ya=function(t){return qa?sa.createElement(t):{}},nu=Ya,aa=!q&&!on(function(){return Object.defineProperty(nu("div"),"a",{get:function(){return 7}}).a!==7}),iu=q,ou=mt,ca=wt,Mc=zt,jl=me,Bl=an,Fl=Ye,da=aa,su=Object.getOwnPropertyDescriptor;Y.f=iu?su:function(t,e){if(t=jl(t),e=Bl(e),da)try{return su(t,e)}catch{}if(Fl(t,e))return Mc(!ou(ca.f,t,e),t[e])};var Gl=on,Hl=U,Wl=/#|\.prototype\./,ua=function(t,e){var r=Uc[Kl(t)];return r===au||r!==Bs&&(Hl(e)?Gl(e):!!e)},Kl=ua.normalize=function(t){return String(t).replace(Wl,".").toLowerCase()},Uc=ua.data={},Bs=ua.NATIVE="N",au=ua.POLYFILL="P",cu=ua,zl=I,ql=O,du=M(M.bind),ji=function(t,e){return zl(t),e===void 0?t:ql?du(t,e):function(){return t.apply(e,arguments)}},Bi={},hn=q&&on(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),xc=je,uu=String,la=TypeError,Qn=function(t){if(xc(t))return t;throw new la(uu(t)+" is not an object")},Fn=q,pi=aa,Vc=hn,ha=Qn,jc=an,lu=TypeError,Io=Object.defineProperty,Jf=Object.getOwnPropertyDescriptor,$n="enumerable",ti="configurable",Fi="writable";Bi.f=Fn?Vc?function(t,e,r){if(ha(t),e=jc(e),ha(r),typeof t=="function"&&e==="prototype"&&"value"in r&&Fi in r&&!r[Fi]){var n=Jf(t,e);n&&n[Fi]&&(t[e]=r.value,r={configurable:ti in r?r[ti]:n[ti],enumerable:$n in r?r[$n]:n[$n],writable:!1})}return Io(t,e,r)}:Io:function(t,e,r){if(ha(t),e=jc(e),ha(r),pi)try{return Io(t,e,r)}catch{}if("get"in r||"set"in r)throw new lu("Accessors not supported");return"value"in r&&(t[e]=r.value),t};var hu=Bi,VD=zt,Xa=q?function(t,e,r){return hu.f(t,e,VD(1,r))}:function(t,e,r){return t[e]=r,t},pu=m,jD=P,BD=M,FD=U,GD=Y.f,HD=cu,Bc=xe,WD=ji,Fc=Xa,zT=Ye,KD=function(t){var e=function(r,n,i){if(this instanceof e){switch(arguments.length){case 0:return new t;case 1:return new t(r);case 2:return new t(r,n)}return new t(r,n,i)}return jD(t,this,arguments)};return e.prototype=t.prototype,e},xr=function(t,e){var r,n,i,o,s,c,d,u,l,T=t.target,v=t.global,y=t.stat,x=t.proto,N=v?pu:y?pu[T]:pu[T]&&pu[T].prototype,L=v?Bc:Bc[T]||Fc(Bc,T,{})[T],Q=L.prototype;for(o in e)n=!(r=HD(v?o:T+(y?".":"#")+o,t.forced))&&N&&zT(N,o),c=L[o],n&&(d=t.dontCallGetSet?(l=GD(N,o))&&l.value:N[o]),s=n&&d?d:e[o],(r||x||typeof c!=typeof s)&&(u=t.bind&&n?WD(s,pu):t.wrap&&n?KD(s):x&&FD(s)?BD(s):s,(t.sham||s&&s.sham||c&&c.sham)&&Fc(u,"sham",!0),Fc(L,o,u),x&&(zT(Bc,i=T+"Prototype")||Fc(Bc,i,{}),Fc(Bc[i],o,s),t.real&&Q&&(r||!Q[o])&&Fc(Q,o,s)))},zD=Math.ceil,qD=Math.floor,YD=Math.trunc||function(t){var e=+t;return(e>0?qD:zD)(e)},XD=YD,Zf=function(t){var e=+t;return e!=e||e===0?0:XD(e)},JD=Zf,ZD=Math.max,QD=Math.min,Qf=function(t,e){var r=JD(t);return r<0?ZD(r+e,0):QD(r,e)},$D=Zf,tk=Math.min,qT=function(t){var e=$D(t);return e>0?tk(e,9007199254740991):0},ek=qT,pa=function(t){return ek(t.length)},rk=me,nk=Qf,ik=pa,YT=function(t){return function(e,r,n){var i=rk(e),o=ik(i);if(o===0)return!t&&-1;var s,c=nk(n,o);if(t&&r!=r){for(;o>c;)if((s=i[c++])!=s)return!0}else for(;o>c;c++)if((t||c in i)&&i[c]===r)return t||c||0;return!t&&-1}},$f={includes:YT(!0),indexOf:YT(!1)},ok=$f.includes;xr({target:"Array",proto:!0,forced:on(function(){return!Array(1).includes()})},{includes:function(t){return ok(this,t,arguments.length>1?arguments[1]:void 0)}});var sk=m,ak=xe,Co=function(t,e){var r=ak[t+"Prototype"],n=r&&r[e];if(n)return n;var i=sk[t],o=i&&i.prototype;return o&&o[e]},ck=Co("Array","includes"),dk=je,uk=z,lk=sn("match"),XT=function(t){var e;return dk(t)&&((e=t[lk])!==void 0?!!e:uk(t)==="RegExp")},hk=XT,pk=TypeError,JT={};JT[sn("toStringTag")]="z";var tm=String(JT)==="[object z]",fk=tm,mk=U,Yl=z,_k=sn("toStringTag"),Ek=Object,gk=Yl(function(){return arguments}())==="Arguments",fa=fk?Yl:function(t){var e,r,n;return t===void 0?"Undefined":t===null?"Null":typeof(r=function(i,o){try{return i[o]}catch{}}(e=Ek(t),_k))=="string"?r:gk?Yl(e):(n=Yl(e))==="Object"&&mk(e.callee)?"Arguments":n},Tk=fa,vk=String,Ji=function(t){if(Tk(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return vk(t)},yk=sn("match"),Sk=xr,Rk=function(t){if(hk(t))throw new pk("The method doesn't accept regular expressions");return t},Ik=fe,ZT=Ji,Ck=function(t){var e=/./;try{"/./"[t](e)}catch{try{return e[yk]=!1,"/./"[t](e)}catch{}}return!1},Ak=g("".indexOf);Sk({target:"String",proto:!0,forced:!Ck("includes")},{includes:function(t){return!!~Ak(ZT(Ik(this)),ZT(Rk(t)),arguments.length>1?arguments[1]:void 0)}});var bk=Co("String","includes"),QT=_,Ok=ck,wk=bk,em=Array.prototype,rm=String.prototype,Nk=function(t){var e=t.includes;return t===em||QT(em,t)&&e===em.includes?Ok:typeof t=="string"||t===rm||QT(rm,t)&&e===rm.includes?wk:e},Ce=ke(Nk),Pk=I,Dk=he,kk=Zt,Lk=pa,$T=TypeError,tv="Reduce of empty array with no initial value",Mk=function(t){return function(e,r,n,i){var o=Dk(e),s=kk(o),c=Lk(o);if(Pk(r),c===0&&n<2)throw new $T(tv);var d=t?c-1:0,u=t?-1:1;if(n<2)for(;;){if(d in s){i=s[d],d+=u;break}if(d+=u,t?d<0:c<=d)throw new $T(tv)}for(;t?d>=0:c>d;d+=u)d in s&&(i=r(i,s[d],d,o));return i}},Uk={left:Mk(!1)},xk=on,Xl=function(t,e){var r=[][t];return!!r&&xk(function(){r.call(null,e||function(){return 1},1)})},fu=m,Vk=We,jk=z,Jl=function(t){return Vk.slice(0,t.length)===t},nm=Jl("Bun/")?"BUN":Jl("Cloudflare-Workers")?"CLOUDFLARE":Jl("Deno/")?"DENO":Jl("Node.js/")?"NODE":fu.Bun&&typeof Bun.version=="string"?"BUN":fu.Deno&&typeof Deno.version=="object"?"DENO":jk(fu.process)==="process"?"NODE":fu.window&&fu.document?"BROWSER":"REST",Zl=nm==="NODE",Bk=Uk.left;xr({target:"Array",proto:!0,forced:!Zl&&ze>79&&ze<83||!Xl("reduce")},{reduce:function(t){var e=arguments.length;return Bk(this,t,e,e>1?arguments[1]:void 0)}});var Fk=Co("Array","reduce"),Gk=_,Hk=Fk,im=Array.prototype,Wk=function(t){var e=t.reduce;return t===im||Gk(im,t)&&e===im.reduce?Hk:e},ev=Wk,Ao=ke(ev),Kk=z,mu=Array.isArray||function(t){return Kk(t)==="Array"},zk=xr,qk=mu,Yk=g([].reverse),rv=[1,2];zk({target:"Array",proto:!0,forced:String(rv)===String(rv.reverse())},{reverse:function(){return qk(this)&&(this.length=this.length),Yk(this)}});var Xk=Co("Array","reverse"),Jk=_,Zk=Xk,om=Array.prototype,Qk=function(t){var e=t.reverse;return t===om||Jk(om,t)&&e===om.reverse?Zk:e},nv=Qk,iv=ke(nv),$k=_r,ov=Ot("keys"),Ql=function(t){return ov[t]||(ov[t]=$k(t))},t1=!on(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),e1=Ye,r1=U,n1=he,i1=t1,sv=Ql("IE_PROTO"),sm=Object,o1=sm.prototype,am=i1?sm.getPrototypeOf:function(t){var e=n1(t);if(e1(e,sv))return e[sv];var r=e.constructor;return r1(r)&&e instanceof r?r.prototype:e instanceof sm?o1:null},s1=g,a1=I,c1=je,d1=function(t){return c1(t)||t===null},u1=String,l1=TypeError,h1=function(t,e,r){try{return s1(a1(Object.getOwnPropertyDescriptor(t,e)[r]))}catch{}},p1=je,f1=fe,m1=function(t){if(d1(t))return t;throw new l1("Can't set "+u1(t)+" as a prototype")},_1=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=h1(Object.prototype,"__proto__","set"))(r,[]),e=r instanceof Array}catch{}return function(n,i){return f1(n),m1(i),p1(n)&&(e?t(n,i):n.__proto__=i),n}}():void 0),$l={},th={},cm=Ye,E1=me,g1=$f.indexOf,T1=th,av=g([].push),cv=function(t,e){var r,n=E1(t),i=0,o=[];for(r in n)!cm(T1,r)&&cm(n,r)&&av(o,r);for(;e.length>i;)cm(n,r=e[i++])&&(~g1(o,r)||av(o,r));return o},dm=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],v1=cv,y1=dm.concat("length","prototype");$l.f=Object.getOwnPropertyNames||function(t){return v1(t,y1)};var _u={};_u.f=Object.getOwnPropertySymbols;var S1=Ze,R1=$l,I1=_u,C1=Qn,A1=g([].concat),b1=S1("Reflect","ownKeys")||function(t){var e=R1.f(C1(t)),r=I1.f;return r?A1(e,r(t)):e},dv=Ye,O1=b1,w1=Y,N1=Bi,um={},P1=cv,D1=dm,eh=Object.keys||function(t){return P1(t,D1)},k1=q,L1=hn,M1=Bi,U1=Qn,x1=me,V1=eh;um.f=k1&&!L1?Object.defineProperties:function(t,e){U1(t);for(var r,n=x1(e),i=V1(e),o=i.length,s=0;o>s;)M1.f(t,r=i[s++],n[r]);return t};var rh,uv=Ze("document","documentElement"),j1=Qn,B1=um,lv=dm,F1=th,G1=uv,H1=Ya,lm="prototype",hm="script",hv=Ql("IE_PROTO"),pm=function(){},pv=function(t){return"<"+hm+">"+t+"</"+hm+">"},fv=function(t){t.write(pv("")),t.close();var e=t.parentWindow.Object;return t=null,e},nh=function(){try{rh=new ActiveXObject("htmlfile")}catch{}var t,e,r;nh=typeof document<"u"?document.domain&&rh?fv(rh):(e=H1("iframe"),r="java"+hm+":",e.style.display="none",G1.appendChild(e),e.src=String(r),(t=e.contentWindow.document).open(),t.write(pv("document.F=Object")),t.close(),t.F):fv(rh);for(var n=lv.length;n--;)delete nh[lm][lv[n]];return nh()};F1[hv]=!0;var Eu=Object.create||function(t,e){var r;return t!==null?(pm[lm]=j1(t),r=new pm,pm[lm]=null,r[hv]=t):r=nh(),e===void 0?r:B1.f(r,e)},W1=je,K1=Xa,mv=Error,z1=g("".replace),q1=String(new mv("zxcasd").stack),_v=/\n\s*at [^:]*:[^\n]*/,Y1=_v.test(q1),X1=zt,J1=!on(function(){var t=new Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",X1(1,7)),t.stack!==7)}),Z1=Xa,Q1=function(t,e){if(Y1&&typeof t=="string"&&!mv.prepareStackTrace)for(;e--;)t=z1(t,_v,"");return t},$1=J1,Ev=Error.captureStackTrace,Gc={},tL=Gc,eL=sn("iterator"),rL=Array.prototype,gv=function(t){return t!==void 0&&(tL.Array===t||rL[eL]===t)},nL=fa,Tv=K,iL=Pt,oL=Gc,sL=sn("iterator"),ih=function(t){if(!iL(t))return Tv(t,sL)||Tv(t,"@@iterator")||oL[nL(t)]},aL=mt,cL=I,dL=Qn,uL=ne,lL=ih,hL=TypeError,fm=function(t,e){var r=arguments.length<2?lL(t):e;if(cL(r))return dL(aL(r,t));throw new hL(uL(t)+" is not iterable")},pL=mt,vv=Qn,fL=K,yv=function(t,e,r){var n,i;vv(t);try{if(!(n=fL(t,"return"))){if(e==="throw")throw r;return r}n=pL(n,t)}catch(o){i=!0,n=o}if(e==="throw")throw r;if(i)throw n;return vv(n),r},mL=ji,_L=mt,EL=Qn,gL=ne,TL=gv,vL=pa,Sv=_,yL=fm,SL=ih,Rv=yv,RL=TypeError,oh=function(t,e){this.stopped=t,this.result=e},Iv=oh.prototype,gu=function(t,e,r){var n,i,o,s,c,d,u,l=r&&r.that,T=!(!r||!r.AS_ENTRIES),v=!(!r||!r.IS_RECORD),y=!(!r||!r.IS_ITERATOR),x=!(!r||!r.INTERRUPTED),N=mL(e,l),L=function(J){return n&&Rv(n,"normal",J),new oh(!0,J)},Q=function(J){return T?(EL(J),x?N(J[0],J[1],L):N(J[0],J[1])):x?N(J,L):N(J)};if(v)n=t.iterator;else if(y)n=t;else{if(!(i=SL(t)))throw new RL(gL(t)+" is not iterable");if(TL(i)){for(o=0,s=vL(t);s>o;o++)if((c=Q(t[o]))&&Sv(Iv,c))return c;return new oh(!1)}n=yL(t,i)}for(d=v?t.next:n.next;!(u=_L(d,n)).done;){try{c=Q(u.value)}catch(J){Rv(n,"throw",J)}if(typeof c=="object"&&c&&Sv(Iv,c))return c}return new oh(!1)},IL=Ji,CL=xr,AL=_,bL=am,sh=_1,OL=function(t,e,r){for(var n=O1(e),i=N1.f,o=w1.f,s=0;s<n.length;s++){var c=n[s];dv(t,c)||r&&dv(r,c)||i(t,c,o(e,c))}},Cv=Eu,mm=Xa,_m=zt,wL=function(t,e){W1(e)&&"cause"in e&&K1(t,"cause",e.cause)},NL=function(t,e,r,n){$1&&(Ev?Ev(t,e):Z1(t,"stack",Q1(r,n)))},PL=gu,DL=function(t,e){return t===void 0?arguments.length<2?"":e:IL(t)},kL=sn("toStringTag"),ah=Error,LL=[].push,Hc=function(t,e){var r,n=AL(Em,this);sh?r=sh(new ah,n?bL(this):Em):(r=n?this:Cv(Em),mm(r,kL,"Error")),e!==void 0&&mm(r,"message",DL(e)),NL(r,Hc,r.stack,1),arguments.length>2&&wL(r,arguments[2]);var i=[];return PL(t,LL,{that:i}),mm(r,"errors",i),r};sh?sh(Hc,ah):OL(Hc,ah,{name:!0});var Em=Hc.prototype=Cv(ah.prototype,{constructor:_m(1,Hc),message:_m(1,""),name:_m(1,"AggregateError")});CL({global:!0},{AggregateError:Hc});var ch,Tu,dh,ML=U,Av=m.WeakMap,UL=ML(Av)&&/native code/.test(String(Av)),bv=m,xL=je,VL=Xa,gm=Ye,Tm=It,jL=Ql,BL=th,Ov="Object already initialized",vm=bv.TypeError,FL=bv.WeakMap;if(UL||Tm.state){var gs=Tm.state||(Tm.state=new FL);gs.get=gs.get,gs.has=gs.has,gs.set=gs.set,ch=function(t,e){if(gs.has(t))throw new vm(Ov);return e.facade=t,gs.set(t,e),e},Tu=function(t){return gs.get(t)||{}},dh=function(t){return gs.has(t)}}else{var Wc=jL("state");BL[Wc]=!0,ch=function(t,e){if(gm(t,Wc))throw new vm(Ov);return e.facade=t,VL(t,Wc,e),e},Tu=function(t){return gm(t,Wc)?t[Wc]:{}},dh=function(t){return gm(t,Wc)}}var Ja,wv,Nv,Za={set:ch,get:Tu,has:dh,enforce:function(t){return dh(t)?Tu(t):ch(t,{})},getterFor:function(t){return function(e){var r;if(!xL(e)||(r=Tu(e)).type!==t)throw new vm("Incompatible receiver, "+t+" required");return r}}},ym=q,GL=Ye,Pv=Function.prototype,HL=ym&&Object.getOwnPropertyDescriptor,Dv=GL(Pv,"name"),kv={PROPER:Dv&&function(){}.name==="something",CONFIGURABLE:Dv&&(!ym||ym&&HL(Pv,"name").configurable)},WL=Xa,ma=function(t,e,r,n){return n&&n.enumerable?t[e]=r:WL(t,e,r),t},KL=on,zL=U,qL=je,YL=Eu,Lv=am,XL=ma,Sm=sn("iterator"),Mv=!1;[].keys&&("next"in(Nv=[].keys())?(wv=Lv(Lv(Nv)))!==Object.prototype&&(Ja=wv):Mv=!0);var JL=!qL(Ja)||KL(function(){var t={};return Ja[Sm].call(t)!==t});zL((Ja=JL?{}:YL(Ja))[Sm])||XL(Ja,Sm,function(){return this});var Uv={IteratorPrototype:Ja,BUGGY_SAFARI_ITERATORS:Mv},ZL=fa,QL=tm?{}.toString:function(){return"[object "+ZL(this)+"]"},$L=tm,tM=Bi.f,eM=Xa,rM=Ye,nM=QL,xv=sn("toStringTag"),Fs=function(t,e,r,n){var i=r?t:t&&t.prototype;i&&(rM(i,xv)||tM(i,xv,{configurable:!0,value:e}),n&&!$L&&eM(i,"toString",nM))},iM=Uv.IteratorPrototype,oM=Eu,sM=zt,aM=Fs,cM=Gc,dM=function(){return this},Rm=function(t,e,r,n){var i=e+" Iterator";return t.prototype=oM(iM,{next:sM(+!n,r)}),aM(t,i,!1,!0),cM[i]=dM,t},uM=xr,lM=mt,hM=kv,pM=Rm,fM=am,mM=Fs,Vv=ma,jv=Gc,_M=Uv,EM=hM.PROPER,uh=_M.BUGGY_SAFARI_ITERATORS,Im=sn("iterator"),Bv="keys",lh="values",Fv="entries",gM=function(){return this},Gv=function(t,e,r,n,i,o,s){pM(r,e,n);var c,d,u,l=function(Q){if(Q===i&&N)return N;if(!uh&&Q&&Q in y)return y[Q];switch(Q){case Bv:case lh:case Fv:return function(){return new r(this,Q)}}return function(){return new r(this)}},T=e+" Iterator",v=!1,y=t.prototype,x=y[Im]||y["@@iterator"]||i&&y[i],N=!uh&&x||l(i),L=e==="Array"&&y.entries||x;if(L&&(c=fM(L.call(new t)))!==Object.prototype&&c.next&&(mM(c,T,!0,!0),jv[T]=gM),EM&&i===lh&&x&&x.name!==lh&&(v=!0,N=function(){return lM(x,this)}),i)if(d={values:l(lh),keys:o?N:l(Bv),entries:l(Fv)},s)for(u in d)(uh||v||!(u in y))&&Vv(y,u,d[u]);else uM({target:e,proto:!0,forced:uh||v},d);return s&&y[Im]!==N&&Vv(y,Im,N,{}),jv[e]=N,d},hh=function(t,e){return{value:t,done:e}},TM=me,Hv=Gc,Wv=Za;Bi.f;var vM=Gv,ph=hh,Kv="Array Iterator",yM=Wv.set,SM=Wv.getterFor(Kv);vM(Array,"Array",function(t,e){yM(this,{type:Kv,target:TM(t),index:0,kind:e})},function(){var t=SM(this),e=t.target,r=t.index++;if(!e||r>=e.length)return t.target=null,ph(void 0,!0);switch(t.kind){case"keys":return ph(r,!1);case"values":return ph(e[r],!1)}return ph([r,e[r]],!1)},"values"),Hv.Arguments=Hv.Array;var RM=Bi,fh=function(t,e,r){return RM.f(t,e,r)},IM=Ze,CM=fh,AM=q,zv=sn("species"),bM=_,OM=TypeError,Cm=function(t,e){if(bM(e,t))return t;throw new OM("Incorrect invocation")},wM=U,Am=It,NM=g(Function.toString);wM(Am.inspectSource)||(Am.inspectSource=function(t){return NM(t)});var qv=Am.inspectSource,PM=g,DM=on,Yv=U,kM=fa,LM=qv,Xv=function(){},Jv=Ze("Reflect","construct"),bm=/^\s*(?:class|function)\b/,MM=PM(bm.exec),UM=!bm.test(Xv),vu=function(t){if(!Yv(t))return!1;try{return Jv(Xv,[],t),!0}catch{return!1}},Zv=function(t){if(!Yv(t))return!1;switch(kM(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return UM||!!MM(bm,LM(t))}catch{return!0}};Zv.sham=!0;var yu,Kc,Qv,Om,mh=!Jv||DM(function(){var t;return vu(vu.call)||!vu(Object)||!vu(function(){t=!0})||t})?Zv:vu,xM=mh,VM=ne,jM=TypeError,$v=Qn,BM=function(t){if(xM(t))return t;throw new jM(VM(t)+" is not a constructor")},FM=Pt,GM=sn("species"),wm=function(t,e){var r,n=$v(t).constructor;return n===void 0||FM(r=$v(n)[GM])?e:BM(r)},_a=g([].slice),HM=TypeError,Qa=function(t,e){if(t<e)throw new HM("Not enough arguments");return t},ty=/(?:ipad|iphone|ipod).*applewebkit/i.test(We),lo=m,WM=P,KM=ji,ey=U,zM=Ye,ry=on,ny=uv,qM=_a,iy=Ya,YM=Qa,XM=ty,JM=Zl,Nm=lo.setImmediate,Pm=lo.clearImmediate,ZM=lo.process,Dm=lo.Dispatch,QM=lo.Function,oy=lo.MessageChannel,$M=lo.String,km=0,Su={},sy="onreadystatechange";ry(function(){yu=lo.location});var Lm=function(t){if(zM(Su,t)){var e=Su[t];delete Su[t],e()}},Mm=function(t){return function(){Lm(t)}},ay=function(t){Lm(t.data)},cy=function(t){lo.postMessage($M(t),yu.protocol+"//"+yu.host)};Nm&&Pm||(Nm=function(t){YM(arguments.length,1);var e=ey(t)?t:QM(t),r=qM(arguments,1);return Su[++km]=function(){WM(e,void 0,r)},Kc(km),km},Pm=function(t){delete Su[t]},JM?Kc=function(t){ZM.nextTick(Mm(t))}:Dm&&Dm.now?Kc=function(t){Dm.now(Mm(t))}:oy&&!XM?(Om=(Qv=new oy).port2,Qv.port1.onmessage=ay,Kc=KM(Om.postMessage,Om)):lo.addEventListener&&ey(lo.postMessage)&&!lo.importScripts&&yu&&yu.protocol!=="file:"&&!ry(cy)?(Kc=cy,lo.addEventListener("message",ay,!1)):Kc=sy in iy("script")?function(t){ny.appendChild(iy("script"))[sy]=function(){ny.removeChild(this),Lm(t)}}:function(t){setTimeout(Mm(t),0)});var _h={set:Nm,clear:Pm},dy=m,tU=q,eU=Object.getOwnPropertyDescriptor,uy=function(t){if(!tU)return dy[t];var e=eU(dy,t);return e&&e.value},ly=function(){this.head=null,this.tail=null};ly.prototype={add:function(t){var e={item:t,next:null},r=this.tail;r?r.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var zc,Um,xm,Vm,hy,py=ly,rU=/ipad|iphone|ipod/i.test(We)&&typeof Pebble<"u",nU=/web0s(?!.*chrome)/i.test(We),qc=m,iU=uy,fy=ji,jm=_h.set,oU=py,sU=ty,aU=rU,cU=nU,Bm=Zl,_y=qc.MutationObserver||qc.WebKitMutationObserver,Ey=qc.document,gy=qc.process,Eh=qc.Promise,Fm=iU("queueMicrotask");if(!Fm){var gh=new oU,Th=function(){var t,e;for(Bm&&(t=gy.domain)&&t.exit();e=gh.get();)try{e()}catch(r){throw gh.head&&zc(),r}t&&t.enter()};sU||Bm||cU||!_y||!Ey?!aU&&Eh&&Eh.resolve?((Vm=Eh.resolve(void 0)).constructor=Eh,hy=fy(Vm.then,Vm),zc=function(){hy(Th)}):Bm?zc=function(){gy.nextTick(Th)}:(jm=fy(jm,qc),zc=function(){jm(Th)}):(Um=!0,xm=Ey.createTextNode(""),new _y(Th).observe(xm,{characterData:!0}),zc=function(){xm.data=Um=!Um}),Fm=function(t){gh.head||zc(),gh.add(t)}}var Ty=Fm,Yc=function(t){try{return{error:!1,value:t()}}catch(e){return{error:!0,value:e}}},$a=m.Promise,dU=m,Ru=$a,uU=U,lU=cu,hU=qv,pU=sn,vy=nm,Gm=ze,yy=Ru&&Ru.prototype,fU=pU("species"),Sy=uU(dU.PromiseRejectionEvent),mU=lU("Promise",function(){var t=hU(Ru),e=t!==String(Ru);if(!e&&Gm===66||!yy.catch||!yy.finally)return!0;if(!Gm||Gm<51||!/native code/.test(t)){var r=new Ru(function(i){i(1)}),n=function(i){i(function(){},function(){})};if((r.constructor={})[fU]=n,!(r.then(function(){})instanceof n))return!0}return!(e||vy!=="BROWSER"&&vy!=="DENO"||Sy)}),Iu={CONSTRUCTOR:mU,REJECTION_EVENT:Sy},Ts={},Ry=I,_U=TypeError,EU=function(t){var e,r;this.promise=new t(function(n,i){if(e!==void 0||r!==void 0)throw new _U("Bad Promise constructor");e=n,r=i}),this.resolve=Ry(e),this.reject=Ry(r)};Ts.f=function(t){return new EU(t)};var Hm,Iy,gU=xr,vh=Zl,Ea=m,Cu=mt,TU=ma,vU=Fs,yU=function(t){var e=IM(t);AM&&e&&!e[zv]&&CM(e,zv,{configurable:!0,get:function(){return this}})},SU=I,Wm=U,RU=je,IU=Cm,CU=wm,Cy=_h.set,Km=Ty,AU=function(t,e){try{arguments.length===1?console.error(t):console.error(t,e)}catch{}},bU=Yc,OU=py,Ay=Za,zm=$a,by=Iu,Oy=Ts,yh="Promise",wy=by.CONSTRUCTOR,wU=by.REJECTION_EVENT,qm=Ay.getterFor(yh),NU=Ay.set,PU=zm&&zm.prototype,Au=zm,Ym=PU,Ny=Ea.TypeError,Xm=Ea.document,Jm=Ea.process,Zm=Oy.f,DU=Zm,kU=!!(Xm&&Xm.createEvent&&Ea.dispatchEvent),Py="unhandledrejection",Dy=function(t){var e;return!(!RU(t)||!Wm(e=t.then))&&e},ky=function(t,e){var r,n,i,o=e.value,s=e.state===1,c=s?t.ok:t.fail,d=t.resolve,u=t.reject,l=t.domain;try{c?(s||(e.rejection===2&&MU(e),e.rejection=1),c===!0?r=o:(l&&l.enter(),r=c(o),l&&(l.exit(),i=!0)),r===t.promise?u(new Ny("Promise-chain cycle")):(n=Dy(r))?Cu(n,r,d,u):d(r)):u(o)}catch(T){l&&!i&&l.exit(),u(T)}},Ly=function(t,e){t.notified||(t.notified=!0,Km(function(){for(var r,n=t.reactions;r=n.get();)ky(r,t);t.notified=!1,e&&!t.rejection&&LU(t)}))},My=function(t,e,r){var n,i;kU?((n=Xm.createEvent("Event")).promise=e,n.reason=r,n.initEvent(t,!1,!0),Ea.dispatchEvent(n)):n={promise:e,reason:r},!wU&&(i=Ea["on"+t])?i(n):t===Py&&AU("Unhandled promise rejection",r)},LU=function(t){Cu(Cy,Ea,function(){var e,r=t.facade,n=t.value;if(Uy(t)&&(e=bU(function(){vh?Jm.emit("unhandledRejection",n,r):My(Py,r,n)}),t.rejection=vh||Uy(t)?2:1,e.error))throw e.value})},Uy=function(t){return t.rejection!==1&&!t.parent},MU=function(t){Cu(Cy,Ea,function(){var e=t.facade;vh?Jm.emit("rejectionHandled",e):My("rejectionhandled",e,t.value)})},Xc=function(t,e,r){return function(n){t(e,n,r)}},Jc=function(t,e,r){t.done||(t.done=!0,r&&(t=r),t.value=e,t.state=2,Ly(t,!0))},Qm=function(t,e,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===e)throw new Ny("Promise can't be resolved itself");var n=Dy(e);n?Km(function(){var i={done:!1};try{Cu(n,e,Xc(Qm,i,t),Xc(Jc,i,t))}catch(o){Jc(i,o,t)}}):(t.value=e,t.state=1,Ly(t,!1))}catch(i){Jc({done:!1},i,t)}}};wy&&(Ym=(Au=function(t){IU(this,Ym),SU(t),Cu(Hm,this);var e=qm(this);try{t(Xc(Qm,e),Xc(Jc,e))}catch(r){Jc(e,r)}}).prototype,(Hm=function(t){NU(this,{type:yh,done:!1,notified:!1,parent:!1,reactions:new OU,rejection:!1,state:0,value:null})}).prototype=TU(Ym,"then",function(t,e){var r=qm(this),n=Zm(CU(this,Au));return r.parent=!0,n.ok=!Wm(t)||t,n.fail=Wm(e)&&e,n.domain=vh?Jm.domain:void 0,r.state===0?r.reactions.add(n):Km(function(){ky(n,r)}),n.promise}),Iy=function(){var t=new Hm,e=qm(t);this.promise=t,this.resolve=Xc(Qm,e),this.reject=Xc(Jc,e)},Oy.f=Zm=function(t){return t===Au||t===void 0?new Iy(t):DU(t)}),gU({global:!0,wrap:!0,forced:wy},{Promise:Au}),vU(Au,yh,!1,!0),yU(yh);var xy=sn("iterator"),Vy=!1;try{var UU=0,jy={next:function(){return{done:!!UU++}},return:function(){Vy=!0}};jy[xy]=function(){return this},Array.from(jy,function(){throw 2})}catch{}var xU=$a,VU=function(t,e){try{if(!e&&!Vy)return!1}catch{return!1}var r=!1;try{var n={};n[xy]=function(){return{next:function(){return{done:r=!0}}}},t(n)}catch{}return r},Sh=Iu.CONSTRUCTOR||!VU(function(t){xU.all(t).then(void 0,function(){})}),jU=mt,BU=I,FU=Ts,GU=Yc,HU=gu;xr({target:"Promise",stat:!0,forced:Sh},{all:function(t){var e=this,r=FU.f(e),n=r.resolve,i=r.reject,o=GU(function(){var s=BU(e.resolve),c=[],d=0,u=1;HU(t,function(l){var T=d++,v=!1;u++,jU(s,e,l).then(function(y){v||(v=!0,c[T]=y,--u||n(c))},i)}),--u||n(c)});return o.error&&i(o.value),r.promise}});var WU=xr,KU=Iu.CONSTRUCTOR;$a&&$a.prototype,WU({target:"Promise",proto:!0,forced:KU,real:!0},{catch:function(t){return this.then(void 0,t)}});var zU=mt,qU=I,YU=Ts,XU=Yc,JU=gu;xr({target:"Promise",stat:!0,forced:Sh},{race:function(t){var e=this,r=YU.f(e),n=r.reject,i=XU(function(){var o=qU(e.resolve);JU(t,function(s){zU(o,e,s).then(r.resolve,n)})});return i.error&&n(i.value),r.promise}});var ZU=Ts;xr({target:"Promise",stat:!0,forced:Iu.CONSTRUCTOR},{reject:function(t){var e=ZU.f(this);return(0,e.reject)(t),e.promise}});var QU=Qn,$U=je,tx=Ts,By=function(t,e){if(QU(t),$U(e)&&e.constructor===t)return e;var r=tx.f(t);return(0,r.resolve)(e),r.promise},ex=xr,rx=$a,nx=Iu.CONSTRUCTOR,ix=By,ox=Ze("Promise"),sx=!nx;ex({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return ix(sx&&this===ox?rx:this,t)}});var ax=mt,cx=I,dx=Ts,ux=Yc,lx=gu;xr({target:"Promise",stat:!0,forced:Sh},{allSettled:function(t){var e=this,r=dx.f(e),n=r.resolve,i=r.reject,o=ux(function(){var s=cx(e.resolve),c=[],d=0,u=1;lx(t,function(l){var T=d++,v=!1;u++,ax(s,e,l).then(function(y){v||(v=!0,c[T]={status:"fulfilled",value:y},--u||n(c))},function(y){v||(v=!0,c[T]={status:"rejected",reason:y},--u||n(c))})}),--u||n(c)});return o.error&&i(o.value),r.promise}});var hx=mt,px=I,fx=Ze,mx=Ts,_x=Yc,Ex=gu,Fy="No one promise resolved";xr({target:"Promise",stat:!0,forced:Sh},{any:function(t){var e=this,r=fx("AggregateError"),n=mx.f(e),i=n.resolve,o=n.reject,s=_x(function(){var c=px(e.resolve),d=[],u=0,l=1,T=!1;Ex(t,function(v){var y=u++,x=!1;l++,hx(c,e,v).then(function(N){x||T||(T=!0,i(N))},function(N){x||T||(x=!0,d[y]=N,--l||o(new r(d,Fy)))})}),--l||o(new r(d,Fy))});return s.error&&o(s.value),n.promise}});var gx=xr,Tx=P,vx=_a,yx=Ts,Sx=I,Gy=Yc,$m=m.Promise,Hy=!1;gx({target:"Promise",stat:!0,forced:!$m||!$m.try||Gy(function(){$m.try(function(t){Hy=t===8},8)}).error||!Hy},{try:function(t){var e=arguments.length>1?vx(arguments,1):[],r=yx.f(this),n=Gy(function(){return Tx(Sx(t),void 0,e)});return(n.error?r.reject:r.resolve)(n.value),r.promise}});var Rx=Ts;xr({target:"Promise",stat:!0},{withResolvers:function(){var t=Rx.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var Ix=xr,t_=$a,Cx=on,Ax=Ze,bx=U,Ox=wm,Wy=By,Nx=t_&&t_.prototype;Ix({target:"Promise",proto:!0,real:!0,forced:!!t_&&Cx(function(){Nx.finally.call({then:function(){}},function(){})})},{finally:function(t){var e=Ox(this,Ax("Promise")),r=bx(t);return this.then(r?function(n){return Wy(e,t()).then(function(){return n})}:t,r?function(n){return Wy(e,t()).then(function(){throw n})}:t)}});var e_=g,Px=Zf,Dx=Ji,kx=fe,Lx=e_("".charAt),Ky=e_("".charCodeAt),Mx=e_("".slice),zy=function(t){return function(e,r){var n,i,o=Dx(kx(e)),s=Px(r),c=o.length;return s<0||s>=c?t?"":void 0:(n=Ky(o,s))<55296||n>56319||s+1===c||(i=Ky(o,s+1))<56320||i>57343?t?Lx(o,s):n:t?Mx(o,s,s+2):i-56320+(n-55296<<10)+65536}},r_={codeAt:zy(!1),charAt:zy(!0)},Ux=r_.charAt,xx=Ji,qy=Za,Vx=Gv,Yy=hh,Xy="String Iterator",jx=qy.set,Bx=qy.getterFor(Xy);Vx(String,"String",function(t){jx(this,{type:Xy,string:xx(t),index:0})},function(){var t,e=Bx(this),r=e.string,n=e.index;return n>=r.length?Yy(void 0,!0):(t=Ux(r,n),e.index+=t.length,Yy(t,!1))});var Fx=xe.Promise,Gx={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Hx=m,Wx=Fs,Jy=Gc;for(var n_ in Gx)Wx(Hx[n_],n_),Jy[n_]=Jy.Array;var Zy=Fx,De=ke(Zy),Kx=Co("Array","values"),zx=fa,qx=Ye,Yx=_,Xx=Kx,i_=Array.prototype,Jx={DOMTokenList:!0,NodeList:!0},Zx=function(t){var e=t.values;return t===i_||Yx(i_,t)&&e===i_.values||qx(Jx,zx(t))?Xx:e},Gi=ke(Zx),Qy=ne,Qx=TypeError,$y=_a,$x=Math.floor,o_=function(t,e){var r=t.length;if(r<8)for(var n,i,o=1;o<r;){for(i=o,n=t[o];i&&e(t[i-1],n)>0;)t[i]=t[--i];i!==o++&&(t[i]=n)}else for(var s=$x(r/2),c=o_($y(t,0,s),e),d=o_($y(t,s),e),u=c.length,l=d.length,T=0,v=0;T<u||v<l;)t[T+v]=T<u&&v<l?e(c[T],d[v])<=0?c[T++]:d[v++]:T<u?c[T++]:d[v++];return t},tS=o_,eS=We.match(/firefox\/(\d+)/i),tV=!!eS&&+eS[1],eV=/MSIE|Trident/.test(We),rS=We.match(/AppleWebKit\/(\d+)\./),rV=!!rS&&+rS[1],nV=xr,nS=g,iV=I,oV=he,iS=pa,sV=function(t,e){if(!delete t[e])throw new Qx("Cannot delete property "+Qy(e)+" of "+Qy(t))},oS=Ji,s_=on,aV=tS,cV=Xl,sS=tV,dV=eV,aS=ze,cS=rV,ga=[],dS=nS(ga.sort),uV=nS(ga.push),lV=s_(function(){ga.sort(void 0)}),hV=s_(function(){ga.sort(null)}),pV=cV("sort"),uS=!s_(function(){if(aS)return aS<70;if(!(sS&&sS>3)){if(dV)return!0;if(cS)return cS<603;var t,e,r,n,i="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(n=0;n<47;n++)ga.push({k:e+n,v:r})}for(ga.sort(function(o,s){return s.v-o.v}),n=0;n<ga.length;n++)e=ga[n].k.charAt(0),i.charAt(i.length-1)!==e&&(i+=e);return i!=="DGBEFHACIJK"}});nV({target:"Array",proto:!0,forced:lV||!hV||!pV||!uS},{sort:function(t){t!==void 0&&iV(t);var e=oV(this);if(uS)return t===void 0?dS(e):dS(e,t);var r,n,i=[],o=iS(e);for(n=0;n<o;n++)n in e&&uV(i,e[n]);for(aV(i,function(s){return function(c,d){return d===void 0?-1:c===void 0?1:s!==void 0?+s(c,d)||0:oS(c)>oS(d)?1:-1}}(t)),r=iS(i),n=0;n<r;)e[n]=i[n++];for(;n<o;)sV(e,n++);return e}});var fV=Co("Array","sort"),mV=_,_V=fV,a_=Array.prototype,EV=function(t){var e=t.sort;return t===a_||mV(a_,t)&&e===a_.sort?_V:e},tc=ke(EV),gV=xr,TV=g,vV=Qf,yV=RangeError,lS=String.fromCharCode,hS=String.fromCodePoint,SV=TV([].join);gV({target:"String",stat:!0,forced:!!hS&&hS.length!==1},{fromCodePoint:function(t){for(var e,r=[],n=arguments.length,i=0;n>i;){if(e=+arguments[i++],vV(e,1114111)!==e)throw new yV(e+" is not a valid code point");r[i]=e<65536?lS(e):lS(55296+((e-=65536)>>10),e%1024+56320)}return SV(r,"")}});var RV=on,IV=sn("iterator"),Rh=!RV(function(){var t=new URL("b?a=1&b=2&c=3","https://a"),e=t.searchParams,r=new URLSearchParams("a=1&a=2&b=3"),n="";return t.pathname="c%20d",e.forEach(function(i,o){e.delete("b"),n+=o+i}),r.delete("a",2),r.delete("b",void 0),!t.toJSON||!r.has("a",1)||r.has("a",2)||!r.has("a",void 0)||r.has("b")||!e.size&&!0||!e.sort||t.href!=="https://a/c%20d?a=1&c=3"||e.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!e[IV]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://ÑÐµÑÑ").host!=="xn--e1aybc"||new URL("https://a#Ð±").hash!=="#%D0%B1"||n!=="a1c3"||new URL("https://x",void 0).host!=="x"}),CV=ma,c_=xr,pS=m,d_=uy,AV=Ze,Ih=mt,Jo=g,bu=q,fS=Rh,mS=ma,bV=fh,OV=function(t,e,r){for(var n in e)r&&r.unsafe&&t[n]?t[n]=e[n]:CV(t,n,e[n],r);return t},wV=Fs,NV=Rm,u_=Za,_S=Cm,l_=U,PV=Ye,DV=ji,kV=fa,LV=Qn,ES=je,Hi=Ji,MV=Eu,gS=zt,TS=fm,UV=ih,Ch=hh,Zc=Qa,xV=tS,VV=sn("iterator"),Qc="URLSearchParams",vS=Qc+"Iterator",yS=u_.set,bo=u_.getterFor(Qc),jV=u_.getterFor(vS),SS=d_("fetch"),Ah=d_("Request"),Ou=d_("Headers"),h_=Ah&&Ah.prototype,RS=Ou&&Ou.prototype,BV=pS.TypeError,FV=pS.encodeURIComponent,GV=String.fromCharCode,HV=AV("String","fromCodePoint"),WV=parseInt,bh=Jo("".charAt),IS=Jo([].join),Ta=Jo([].push),CS=Jo("".replace),KV=Jo([].shift),AS=Jo([].splice),bS=Jo("".split),OS=Jo("".slice),zV=Jo(/./.exec),qV=/\+/g,YV=/^[0-9a-f]+$/i,wS=function(t,e){var r=OS(t,e,e+2);return zV(YV,r)?WV(r,16):NaN},XV=function(t){for(var e=0,r=128;r>0&&t&r;r>>=1)e++;return e},JV=function(t){var e=null;switch(t.length){case 1:e=t[0];break;case 2:e=(31&t[0])<<6|63&t[1];break;case 3:e=(15&t[0])<<12|(63&t[1])<<6|63&t[2];break;case 4:e=(7&t[0])<<18|(63&t[1])<<12|(63&t[2])<<6|63&t[3]}return e>1114111?null:e},NS=function(t){for(var e=(t=CS(t,qV," ")).length,r="",n=0;n<e;){var i=bh(t,n);if(i==="%"){if(bh(t,n+1)==="%"||n+3>e){r+="%",n++;continue}var o=wS(t,n+1);if(o!=o){r+=i,n++;continue}n+=2;var s=XV(o);if(s===0)i=GV(o);else{if(s===1||s>4){r+="ï¿½",n++;continue}for(var c=[o],d=1;d<s&&!(++n+3>e||bh(t,n)!=="%");){var u=wS(t,n+1);if(u!=u){n+=3;break}if(u>191||u<128)break;Ta(c,u),n+=2,d++}if(c.length!==s){r+="ï¿½";continue}var l=JV(c);l===null?r+="ï¿½":i=HV(l)}}r+=i,n++}return r},ZV=/[!'()~]|%20/g,QV={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},$V=function(t){return QV[t]},PS=function(t){return CS(FV(t),ZV,$V)},p_=NV(function(t,e){yS(this,{type:vS,target:bo(t).entries,index:0,kind:e})},Qc,function(){var t=jV(this),e=t.target,r=t.index++;if(!e||r>=e.length)return t.target=null,Ch(void 0,!0);var n=e[r];switch(t.kind){case"keys":return Ch(n.key,!1);case"values":return Ch(n.value,!1)}return Ch([n.key,n.value],!1)},!0),DS=function(t){this.entries=[],this.url=null,t!==void 0&&(ES(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?bh(t,0)==="?"?OS(t,1):t:Hi(t)))};DS.prototype={type:Qc,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var e,r,n,i,o,s,c,d=this.entries,u=UV(t);if(u)for(r=(e=TS(t,u)).next;!(n=Ih(r,e)).done;){if(o=(i=TS(LV(n.value))).next,(s=Ih(o,i)).done||(c=Ih(o,i)).done||!Ih(o,i).done)throw new BV("Expected sequence with length 2");Ta(d,{key:Hi(s.value),value:Hi(c.value)})}else for(var l in t)PV(t,l)&&Ta(d,{key:l,value:Hi(t[l])})},parseQuery:function(t){if(t)for(var e,r,n=this.entries,i=bS(t,"&"),o=0;o<i.length;)(e=i[o++]).length&&(r=bS(e,"="),Ta(n,{key:NS(KV(r)),value:NS(IS(r,"="))}))},serialize:function(){for(var t,e=this.entries,r=[],n=0;n<e.length;)t=e[n++],Ta(r,PS(t.key)+"="+PS(t.value));return IS(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Oh=function(){_S(this,$c);var t=yS(this,new DS(arguments.length>0?arguments[0]:void 0));bu||(this.size=t.entries.length)},$c=Oh.prototype;if(OV($c,{append:function(t,e){var r=bo(this);Zc(arguments.length,2),Ta(r.entries,{key:Hi(t),value:Hi(e)}),bu||this.length++,r.updateURL()},delete:function(t){for(var e=bo(this),r=Zc(arguments.length,1),n=e.entries,i=Hi(t),o=r<2?void 0:arguments[1],s=o===void 0?o:Hi(o),c=0;c<n.length;){var d=n[c];if(d.key!==i||s!==void 0&&d.value!==s)c++;else if(AS(n,c,1),s!==void 0)break}bu||(this.size=n.length),e.updateURL()},get:function(t){var e=bo(this).entries;Zc(arguments.length,1);for(var r=Hi(t),n=0;n<e.length;n++)if(e[n].key===r)return e[n].value;return null},getAll:function(t){var e=bo(this).entries;Zc(arguments.length,1);for(var r=Hi(t),n=[],i=0;i<e.length;i++)e[i].key===r&&Ta(n,e[i].value);return n},has:function(t){for(var e=bo(this).entries,r=Zc(arguments.length,1),n=Hi(t),i=r<2?void 0:arguments[1],o=i===void 0?i:Hi(i),s=0;s<e.length;){var c=e[s++];if(c.key===n&&(o===void 0||c.value===o))return!0}return!1},set:function(t,e){var r=bo(this);Zc(arguments.length,1);for(var n,i=r.entries,o=!1,s=Hi(t),c=Hi(e),d=0;d<i.length;d++)(n=i[d]).key===s&&(o?AS(i,d--,1):(o=!0,n.value=c));o||Ta(i,{key:s,value:c}),bu||(this.size=i.length),r.updateURL()},sort:function(){var t=bo(this);xV(t.entries,function(e,r){return e.key>r.key?1:-1}),t.updateURL()},forEach:function(t){for(var e,r=bo(this).entries,n=DV(t,arguments.length>1?arguments[1]:void 0),i=0;i<r.length;)n((e=r[i++]).value,e.key,this)},keys:function(){return new p_(this,"keys")},values:function(){return new p_(this,"values")},entries:function(){return new p_(this,"entries")}},{enumerable:!0}),mS($c,VV,$c.entries,{}),mS($c,"toString",function(){return bo(this).serialize()},{enumerable:!0}),bu&&bV($c,"size",{get:function(){return bo(this).entries.length},configurable:!0,enumerable:!0}),wV(Oh,Qc),c_({global:!0,forced:!fS},{URLSearchParams:Oh}),!fS&&l_(Ou)){var tj=Jo(RS.has),ej=Jo(RS.set),kS=function(t){if(ES(t)){var e,r=t.body;if(kV(r)===Qc)return e=t.headers?new Ou(t.headers):new Ou,tj(e,"content-type")||ej(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),MV(t,{body:gS(0,Hi(r)),headers:gS(0,e)})}return t};if(l_(SS)&&c_({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return SS(t,arguments.length>1?kS(arguments[1]):{})}}),l_(Ah)){var f_=function(t){return _S(this,h_),new Ah(t,arguments.length>1?kS(arguments[1]):{})};h_.constructor=f_,f_.prototype=h_,c_({global:!0,dontCallGetSet:!0,forced:!0},{Request:f_})}}var Oo,rj={URLSearchParams:Oh,getState:bo},nj=xe.URLSearchParams,LS=q,ij=g,oj=mt,sj=on,m_=eh,aj=_u,cj=wt,dj=he,uj=Zt,td=Object.assign,MS=Object.defineProperty,lj=ij([].concat),hj=!td||sj(function(){if(LS&&td({b:1},td(MS({},"a",{enumerable:!0,get:function(){MS(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},e={},r=Symbol("assign detection"),n="abcdefghijklmnopqrst";return t[r]=7,n.split("").forEach(function(i){e[i]=i}),td({},t)[r]!==7||m_(td({},e)).join("")!==n})?function(t,e){for(var r=dj(t),n=arguments.length,i=1,o=aj.f,s=cj.f;n>i;)for(var c,d=uj(arguments[i++]),u=o?lj(m_(d),o(d)):m_(d),l=u.length,T=0;l>T;)c=u[T++],LS&&!oj(s,d,c)||(r[c]=d[c]);return r}:td,pj=Qn,fj=yv,mj=q,_j=Bi,Ej=zt,__=function(t,e,r){mj?_j.f(t,e,Ej(0,r)):t[e]=r},gj=ji,Tj=mt,vj=he,yj=function(t,e,r,n){try{return n?e(pj(r)[0],r[1]):e(r)}catch(i){fj(t,"throw",i)}},Sj=gv,Rj=mh,Ij=pa,US=__,Cj=fm,Aj=ih,xS=Array,ec=g,E_=2147483647,bj=/[^\0-\u007E]/,VS=/[.\u3002\uFF0E\uFF61]/g,jS="Overflow: input needs wider integers to process",BS=RangeError,Oj=ec(VS.exec),ed=Math.floor,g_=String.fromCharCode,FS=ec("".charCodeAt),GS=ec([].join),va=ec([].push),wj=ec("".replace),Nj=ec("".split),Pj=ec("".toLowerCase),HS=function(t){return t+22+75*(t<26)},Dj=function(t,e,r){var n=0;for(t=r?ed(t/700):t>>1,t+=ed(t/e);t>455;)t=ed(t/35),n+=36;return ed(n+36*t/(t+38))},kj=function(t){var e=[];t=function(Q){for(var J=[],at=0,Rt=Q.length;at<Rt;){var vt=FS(Q,at++);if(vt>=55296&&vt<=56319&&at<Rt){var pt=FS(Q,at++);(64512&pt)==56320?va(J,((1023&vt)<<10)+(1023&pt)+65536):(va(J,vt),at--)}else va(J,vt)}return J}(t);var r,n,i=t.length,o=128,s=0,c=72;for(r=0;r<t.length;r++)(n=t[r])<128&&va(e,g_(n));var d=e.length,u=d;for(d&&va(e,"-");u<i;){var l=E_;for(r=0;r<t.length;r++)(n=t[r])>=o&&n<l&&(l=n);var T=u+1;if(l-o>ed((E_-s)/T))throw new BS(jS);for(s+=(l-o)*T,o=l,r=0;r<t.length;r++){if((n=t[r])<o&&++s>E_)throw new BS(jS);if(n===o){for(var v=s,y=36;;){var x=y<=c?1:y>=c+26?26:y-c;if(v<x)break;var N=v-x,L=36-x;va(e,g_(HS(x+N%L))),v=ed(N/L),y+=36}va(e,g_(HS(v))),c=Dj(s,T,u===d),s=0,u++}}s++,o++}return GS(e,"")},Lj=xr,T_=q,Mj=Rh,v_=m,WS=ji,wo=g,wh=ma,No=fh,Uj=Cm,y_=Ye,S_=hj,rd=function(t){var e=vj(t),r=Rj(this),n=arguments.length,i=n>1?arguments[1]:void 0,o=i!==void 0;o&&(i=gj(i,n>2?arguments[2]:void 0));var s,c,d,u,l,T,v=Aj(e),y=0;if(!v||this===xS&&Sj(v))for(s=Ij(e),c=r?new this(s):xS(s);s>y;y++)T=o?i(e[y],y):e[y],US(c,y,T);else for(c=r?new this:[],l=(u=Cj(e,v)).next;!(d=Tj(l,u)).done;y++)T=o?yj(u,i,[d.value,y],!0):d.value,US(c,y,T);return c.length=y,c},Zo=_a,xj=r_.codeAt,Vj=function(t){var e,r,n=[],i=Nj(wj(Pj(t),VS,"."),".");for(e=0;e<i.length;e++)r=i[e],va(n,Oj(bj,r)?"xn--"+kj(r):r);return GS(n,".")},Gs=Ji,jj=Fs,Bj=Qa,KS=rj,zS=Za,Fj=zS.set,Nh=zS.getterFor("URL"),Gj=KS.URLSearchParams,Hj=KS.getState,wu=v_.URL,R_=v_.TypeError,Ph=v_.parseInt,Wj=Math.floor,qS=Math.pow,Po=wo("".charAt),Qo=wo(/./.exec),Nu=wo([].join),Kj=wo(1 .toString),zj=wo([].pop),nd=wo([].push),I_=wo("".replace),qj=wo([].shift),Yj=wo("".split),Pu=wo("".slice),Dh=wo("".toLowerCase),Xj=wo([].unshift),C_="Invalid scheme",rc="Invalid host",YS="Invalid port",XS=/[a-z]/i,Jj=/[\d+-.a-z]/i,A_=/\d/,Zj=/^0x/i,Qj=/^[0-7]+$/,$j=/^\d+$/,JS=/^[\da-f]+$/i,tB=/[\0\t\n\r #%/:<>?@[\\\]^|]/,eB=/[\0\t\n\r #/:<>?@[\\\]^|]/,rB=/^[\u0000-\u0020]+/,nB=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,iB=/[\t\n\r]/g,Du=function(t){var e,r,n,i;if(typeof t=="number"){for(e=[],r=0;r<4;r++)Xj(e,t%256),t=Wj(t/256);return Nu(e,".")}if(typeof t=="object"){for(e="",n=function(o){for(var s=null,c=1,d=null,u=0,l=0;l<8;l++)o[l]!==0?(u>c&&(s=d,c=u),d=null,u=0):(d===null&&(d=l),++u);return u>c?d:s}(t),r=0;r<8;r++)i&&t[r]===0||(i&&(i=!1),n===r?(e+=r?":":"::",i=!0):(e+=Kj(t[r],16),r<7&&(e+=":")));return"["+e+"]"}return t},kh={},ZS=S_({},kh,{" ":1,'"':1,"<":1,">":1,"`":1}),QS=S_({},ZS,{"#":1,"?":1,"{":1,"}":1}),b_=S_({},QS,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),ya=function(t,e){var r=xj(t,0);return r>32&&r<127&&!y_(e,t)?t:encodeURIComponent(t)},Lh={ftp:21,file:null,http:80,https:443,ws:80,wss:443},ku=function(t,e){var r;return t.length===2&&Qo(XS,Po(t,0))&&((r=Po(t,1))===":"||!e&&r==="|")},$S=function(t){var e;return t.length>1&&ku(Pu(t,0,2))&&(t.length===2||(e=Po(t,2))==="/"||e==="\\"||e==="?"||e==="#")},oB=function(t){return t==="."||Dh(t)==="%2e"},O_={},tR={},w_={},eR={},rR={},N_={},nR={},iR={},Mh={},Uh={},P_={},D_={},k_={},L_={},oR={},M_={},id={},vs={},sR={},nc={},Hs={},U_=function(t,e,r){var n,i,o,s=Gs(t);if(e){if(i=this.parse(s))throw new R_(i);this.searchParams=null}else{if(r!==void 0&&(n=new U_(r,!0)),i=this.parse(s,null,n))throw new R_(i);(o=Hj(new Gj)).bindURL(this),this.searchParams=o}};U_.prototype={type:"URL",parse:function(t,e,r){var n,i,o,s,c,d=this,u=e||O_,l=0,T="",v=!1,y=!1,x=!1;for(t=Gs(t),e||(d.scheme="",d.username="",d.password="",d.host=null,d.port=null,d.path=[],d.query=null,d.fragment=null,d.cannotBeABaseURL=!1,t=I_(t,rB,""),t=I_(t,nB,"$1")),t=I_(t,iB,""),n=rd(t);l<=n.length;){switch(i=n[l],u){case O_:if(!i||!Qo(XS,i)){if(e)return C_;u=w_;continue}T+=Dh(i),u=tR;break;case tR:if(i&&(Qo(Jj,i)||i==="+"||i==="-"||i==="."))T+=Dh(i);else{if(i!==":"){if(e)return C_;T="",u=w_,l=0;continue}if(e&&(d.isSpecial()!==y_(Lh,T)||T==="file"&&(d.includesCredentials()||d.port!==null)||d.scheme==="file"&&!d.host))return;if(d.scheme=T,e)return void(d.isSpecial()&&Lh[d.scheme]===d.port&&(d.port=null));T="",d.scheme==="file"?u=L_:d.isSpecial()&&r&&r.scheme===d.scheme?u=eR:d.isSpecial()?u=iR:n[l+1]==="/"?(u=rR,l++):(d.cannotBeABaseURL=!0,nd(d.path,""),u=sR)}break;case w_:if(!r||r.cannotBeABaseURL&&i!=="#")return C_;if(r.cannotBeABaseURL&&i==="#"){d.scheme=r.scheme,d.path=Zo(r.path),d.query=r.query,d.fragment="",d.cannotBeABaseURL=!0,u=Hs;break}u=r.scheme==="file"?L_:N_;continue;case eR:if(i!=="/"||n[l+1]!=="/"){u=N_;continue}u=Mh,l++;break;case rR:if(i==="/"){u=Uh;break}u=vs;continue;case N_:if(d.scheme=r.scheme,i===Oo)d.username=r.username,d.password=r.password,d.host=r.host,d.port=r.port,d.path=Zo(r.path),d.query=r.query;else if(i==="/"||i==="\\"&&d.isSpecial())u=nR;else if(i==="?")d.username=r.username,d.password=r.password,d.host=r.host,d.port=r.port,d.path=Zo(r.path),d.query="",u=nc;else{if(i!=="#"){d.username=r.username,d.password=r.password,d.host=r.host,d.port=r.port,d.path=Zo(r.path),d.path.length--,u=vs;continue}d.username=r.username,d.password=r.password,d.host=r.host,d.port=r.port,d.path=Zo(r.path),d.query=r.query,d.fragment="",u=Hs}break;case nR:if(!d.isSpecial()||i!=="/"&&i!=="\\"){if(i!=="/"){d.username=r.username,d.password=r.password,d.host=r.host,d.port=r.port,u=vs;continue}u=Uh}else u=Mh;break;case iR:if(u=Mh,i!=="/"||Po(T,l+1)!=="/")continue;l++;break;case Mh:if(i!=="/"&&i!=="\\"){u=Uh;continue}break;case Uh:if(i==="@"){v&&(T="%40"+T),v=!0,o=rd(T);for(var N=0;N<o.length;N++){var L=o[N];if(L!==":"||x){var Q=ya(L,b_);x?d.password+=Q:d.username+=Q}else x=!0}T=""}else if(i===Oo||i==="/"||i==="?"||i==="#"||i==="\\"&&d.isSpecial()){if(v&&T==="")return"Invalid authority";l-=rd(T).length+1,T="",u=P_}else T+=i;break;case P_:case D_:if(e&&d.scheme==="file"){u=M_;continue}if(i!==":"||y){if(i===Oo||i==="/"||i==="?"||i==="#"||i==="\\"&&d.isSpecial()){if(d.isSpecial()&&T==="")return rc;if(e&&T===""&&(d.includesCredentials()||d.port!==null))return;if(s=d.parseHost(T))return s;if(T="",u=id,e)return;continue}i==="["?y=!0:i==="]"&&(y=!1),T+=i}else{if(T==="")return rc;if(s=d.parseHost(T))return s;if(T="",u=k_,e===D_)return}break;case k_:if(!Qo(A_,i)){if(i===Oo||i==="/"||i==="?"||i==="#"||i==="\\"&&d.isSpecial()||e){if(T!==""){var J=Ph(T,10);if(J>65535)return YS;d.port=d.isSpecial()&&J===Lh[d.scheme]?null:J,T=""}if(e)return;u=id;continue}return YS}T+=i;break;case L_:if(d.scheme="file",i==="/"||i==="\\")u=oR;else{if(!r||r.scheme!=="file"){u=vs;continue}switch(i){case Oo:d.host=r.host,d.path=Zo(r.path),d.query=r.query;break;case"?":d.host=r.host,d.path=Zo(r.path),d.query="",u=nc;break;case"#":d.host=r.host,d.path=Zo(r.path),d.query=r.query,d.fragment="",u=Hs;break;default:$S(Nu(Zo(n,l),""))||(d.host=r.host,d.path=Zo(r.path),d.shortenPath()),u=vs;continue}}break;case oR:if(i==="/"||i==="\\"){u=M_;break}r&&r.scheme==="file"&&!$S(Nu(Zo(n,l),""))&&(ku(r.path[0],!0)?nd(d.path,r.path[0]):d.host=r.host),u=vs;continue;case M_:if(i===Oo||i==="/"||i==="\\"||i==="?"||i==="#"){if(!e&&ku(T))u=vs;else if(T===""){if(d.host="",e)return;u=id}else{if(s=d.parseHost(T))return s;if(d.host==="localhost"&&(d.host=""),e)return;T="",u=id}continue}T+=i;break;case id:if(d.isSpecial()){if(u=vs,i!=="/"&&i!=="\\")continue}else if(e||i!=="?")if(e||i!=="#"){if(i!==Oo&&(u=vs,i!=="/"))continue}else d.fragment="",u=Hs;else d.query="",u=nc;break;case vs:if(i===Oo||i==="/"||i==="\\"&&d.isSpecial()||!e&&(i==="?"||i==="#")){if((c=Dh(c=T))===".."||c==="%2e."||c===".%2e"||c==="%2e%2e"?(d.shortenPath(),i==="/"||i==="\\"&&d.isSpecial()||nd(d.path,"")):oB(T)?i==="/"||i==="\\"&&d.isSpecial()||nd(d.path,""):(d.scheme==="file"&&!d.path.length&&ku(T)&&(d.host&&(d.host=""),T=Po(T,0)+":"),nd(d.path,T)),T="",d.scheme==="file"&&(i===Oo||i==="?"||i==="#"))for(;d.path.length>1&&d.path[0]==="";)qj(d.path);i==="?"?(d.query="",u=nc):i==="#"&&(d.fragment="",u=Hs)}else T+=ya(i,QS);break;case sR:i==="?"?(d.query="",u=nc):i==="#"?(d.fragment="",u=Hs):i!==Oo&&(d.path[0]+=ya(i,kh));break;case nc:e||i!=="#"?i!==Oo&&(i==="'"&&d.isSpecial()?d.query+="%27":d.query+=i==="#"?"%23":ya(i,kh)):(d.fragment="",u=Hs);break;case Hs:i!==Oo&&(d.fragment+=ya(i,ZS))}l++}},parseHost:function(t){var e,r,n;if(Po(t,0)==="["){if(Po(t,t.length-1)!=="]"||(e=function(i){var o,s,c,d,u,l,T,v=[0,0,0,0,0,0,0,0],y=0,x=null,N=0,L=function(){return Po(i,N)};if(L()===":"){if(Po(i,1)!==":")return;N+=2,x=++y}for(;L();){if(y===8)return;if(L()!==":"){for(o=s=0;s<4&&Qo(JS,L());)o=16*o+Ph(L(),16),N++,s++;if(L()==="."){if(s===0||(N-=s,y>6))return;for(c=0;L();){if(d=null,c>0){if(!(L()==="."&&c<4))return;N++}if(!Qo(A_,L()))return;for(;Qo(A_,L());){if(u=Ph(L(),10),d===null)d=u;else{if(d===0)return;d=10*d+u}if(d>255)return;N++}v[y]=256*v[y]+d,++c!=2&&c!==4||y++}if(c!==4)return;break}if(L()===":"){if(N++,!L())return}else if(L())return;v[y++]=o}else{if(x!==null)return;N++,x=++y}}if(x!==null)for(l=y-x,y=7;y!==0&&l>0;)T=v[y],v[y--]=v[x+l-1],v[x+--l]=T;else if(y!==8)return;return v}(Pu(t,1,-1)),!e))return rc;this.host=e}else if(this.isSpecial()){if(t=Vj(t),Qo(tB,t)||(e=function(i){var o,s,c,d,u,l,T,v=Yj(i,".");if(v.length&&v[v.length-1]===""&&v.length--,(o=v.length)>4)return i;for(s=[],c=0;c<o;c++){if((d=v[c])==="")return i;if(u=10,d.length>1&&Po(d,0)==="0"&&(u=Qo(Zj,d)?16:8,d=Pu(d,u===8?1:2)),d==="")l=0;else{if(!Qo(u===10?$j:u===8?Qj:JS,d))return i;l=Ph(d,u)}nd(s,l)}for(c=0;c<o;c++)if(l=s[c],c===o-1){if(l>=qS(256,5-o))return null}else if(l>255)return null;for(T=zj(s),c=0;c<s.length;c++)T+=s[c]*qS(256,3-c);return T}(t),e===null))return rc;this.host=e}else{if(Qo(eB,t))return rc;for(e="",r=rd(t),n=0;n<r.length;n++)e+=ya(r[n],kh);this.host=e}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return y_(Lh,this.scheme)},shortenPath:function(){var t=this.path,e=t.length;!e||this.scheme==="file"&&e===1&&ku(t[0],!0)||t.length--},serialize:function(){var t=this,e=t.scheme,r=t.username,n=t.password,i=t.host,o=t.port,s=t.path,c=t.query,d=t.fragment,u=e+":";return i!==null?(u+="//",t.includesCredentials()&&(u+=r+(n?":"+n:"")+"@"),u+=Du(i),o!==null&&(u+=":"+o)):e==="file"&&(u+="//"),u+=t.cannotBeABaseURL?s[0]:s.length?"/"+Nu(s,"/"):"",c!==null&&(u+="?"+c),d!==null&&(u+="#"+d),u},setHref:function(t){var e=this.parse(t);if(e)throw new R_(e);this.searchParams.update()},getOrigin:function(){var t=this.scheme,e=this.port;if(t==="blob")try{return new od(t.path[0]).origin}catch{return"null"}return t!=="file"&&this.isSpecial()?t+"://"+Du(this.host)+(e!==null?":"+e:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(Gs(t)+":",O_)},getUsername:function(){return this.username},setUsername:function(t){var e=rd(Gs(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<e.length;r++)this.username+=ya(e[r],b_)}},getPassword:function(){return this.password},setPassword:function(t){var e=rd(Gs(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<e.length;r++)this.password+=ya(e[r],b_)}},getHost:function(){var t=this.host,e=this.port;return t===null?"":e===null?Du(t):Du(t)+":"+e},setHost:function(t){this.cannotBeABaseURL||this.parse(t,P_)},getHostname:function(){var t=this.host;return t===null?"":Du(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,D_)},getPort:function(){var t=this.port;return t===null?"":Gs(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=Gs(t))===""?this.port=null:this.parse(t,k_))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+Nu(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,id))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=Gs(t))===""?this.query=null:(Po(t,0)==="?"&&(t=Pu(t,1)),this.query="",this.parse(t,nc)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=Gs(t))!==""?(Po(t,0)==="#"&&(t=Pu(t,1)),this.fragment="",this.parse(t,Hs)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var od=function(t){var e=Uj(this,Wi),r=Bj(arguments.length,1)>1?arguments[1]:void 0,n=Fj(e,new U_(t,!1,r));T_||(e.href=n.serialize(),e.origin=n.getOrigin(),e.protocol=n.getProtocol(),e.username=n.getUsername(),e.password=n.getPassword(),e.host=n.getHost(),e.hostname=n.getHostname(),e.port=n.getPort(),e.pathname=n.getPathname(),e.search=n.getSearch(),e.searchParams=n.getSearchParams(),e.hash=n.getHash())},Wi=od.prototype,Do=function(t,e){return{get:function(){return Nh(this)[t]()},set:e&&function(r){return Nh(this)[e](r)},configurable:!0,enumerable:!0}};if(T_&&(No(Wi,"href",Do("serialize","setHref")),No(Wi,"origin",Do("getOrigin")),No(Wi,"protocol",Do("getProtocol","setProtocol")),No(Wi,"username",Do("getUsername","setUsername")),No(Wi,"password",Do("getPassword","setPassword")),No(Wi,"host",Do("getHost","setHost")),No(Wi,"hostname",Do("getHostname","setHostname")),No(Wi,"port",Do("getPort","setPort")),No(Wi,"pathname",Do("getPathname","setPathname")),No(Wi,"search",Do("getSearch","setSearch")),No(Wi,"searchParams",Do("getSearchParams")),No(Wi,"hash",Do("getHash","setHash"))),wh(Wi,"toJSON",function(){return Nh(this).serialize()},{enumerable:!0}),wh(Wi,"toString",function(){return Nh(this).serialize()},{enumerable:!0}),wu){var aR=wu.createObjectURL,cR=wu.revokeObjectURL;aR&&wh(od,"createObjectURL",WS(aR,wu)),cR&&wh(od,"revokeObjectURL",WS(cR,wu))}jj(od,"URL"),Lj({global:!0,forced:!Mj,sham:!T_},{URL:od});var sB=xr,dR=on,aB=Qa,uR=Ji,cB=Rh,x_=Ze("URL"),dB=cB&&dR(function(){x_.canParse()}),uB=dR(function(){return x_.canParse.length!==1});sB({target:"URL",stat:!0,forced:!dB||uB},{canParse:function(t){var e=aB(arguments.length,1),r=uR(t),n=e<2||arguments[1]===void 0?void 0:uR(arguments[1]);try{return!!new x_(r,n)}catch{return!1}}});var lB=xr,hB=Qa,lR=Ji,pB=Rh,fB=Ze("URL");lB({target:"URL",stat:!0,forced:!pB},{parse:function(t){var e=hB(arguments.length,1),r=lR(t),n=e<2||arguments[1]===void 0?void 0:lR(arguments[1]);try{return new fB(r,n)}catch{return null}}});var xh=ke(xe.URL);let hR=!0,pR=!0;function Vh(t,e,r){const n=t.match(e);return n&&n.length>=r&&parseInt(n[r],10)}function ic(t,e,r){if(!t.RTCPeerConnection)return;const n=t.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(s,c){if(s!==e)return i.apply(this,arguments);const d=u=>{const l=r(u);l&&(c.handleEvent?c.handleEvent(l):c(l))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(c,d),i.apply(this,[s,d])};const o=n.removeEventListener;n.removeEventListener=function(s,c){if(s!==e||!this._eventMap||!this._eventMap[e])return o.apply(this,arguments);if(!this._eventMap[e].has(c))return o.apply(this,arguments);const d=this._eventMap[e].get(c);return this._eventMap[e].delete(c),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[s,d])},Object.defineProperty(n,"on"+e,{get(){return this["_on"+e]},set(s){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),s&&this.addEventListener(e,this["_on"+e]=s)},enumerable:!0,configurable:!0})}function mB(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(hR=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function _B(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(pR=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function fR(){if(typeof window=="object"){if(hR)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function V_(t,e){pR&&console.warn(t+" is deprecated, please use "+e+" instead.")}function mR(t){return Object.prototype.toString.call(t)==="[object Object]"}function _R(t){var e;return mR(t)?Ao(e=Object.keys(t)).call(e,function(r,n){const i=mR(t[n]),o=i?_R(t[n]):t[n],s=i&&!Object.keys(o).length;return o===void 0||s?r:Object.assign(r,{[n]:o})},{}):t}function j_(t,e,r){e&&!r.has(e.id)&&(r.set(e.id,e),Object.keys(e).forEach(n=>{n.endsWith("Id")?j_(t,t.get(e[n]),r):n.endsWith("Ids")&&e[n].forEach(i=>{j_(t,t.get(i),r)})}))}function ER(t,e,r){const n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;const o=[];return t.forEach(s=>{s.type==="track"&&s.trackIdentifier===e.id&&o.push(s)}),o.forEach(s=>{t.forEach(c=>{c.type===n&&c.trackId===s.id&&j_(t,c,i)})}),i}const gR=fR;function TR(t,e){const r=t&&t.navigator;if(!r.mediaDevices)return;const n=function(s){if(typeof s!="object"||s.mandatory||s.optional)return s;const c={};return Object.keys(s).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const u=typeof s[d]=="object"?s[d]:{ideal:s[d]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const l=function(T,v){return T?T+v.charAt(0).toUpperCase()+v.slice(1):v==="deviceId"?"sourceId":v};if(u.ideal!==void 0){c.optional=c.optional||[];let T={};typeof u.ideal=="number"?(T[l("min",d)]=u.ideal,c.optional.push(T),T={},T[l("max",d)]=u.ideal,c.optional.push(T)):(T[l("",d)]=u.ideal,c.optional.push(T))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[l("",d)]=u.exact):["min","max"].forEach(T=>{u[T]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[l(T,d)]=u[T])})}),s.advanced&&(c.optional=(c.optional||[]).concat(s.advanced)),c},i=function(s,c){if(e.version>=61)return c(s);if((s=JSON.parse(JSON.stringify(s)))&&typeof s.audio=="object"){const d=function(u,l,T){l in u&&!(T in u)&&(u[T]=u[l],delete u[l])};d((s=JSON.parse(JSON.stringify(s))).audio,"autoGainControl","googAutoGainControl"),d(s.audio,"noiseSuppression","googNoiseSuppression"),s.audio=n(s.audio)}if(s&&typeof s.video=="object"){let d=s.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const u=e.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||u)){let l;if(delete s.video.facingMode,d.exact==="environment"||d.ideal==="environment"?l=["back","rear"]:d.exact!=="user"&&d.ideal!=="user"||(l=["front"]),l)return r.mediaDevices.enumerateDevices().then(T=>{T=T.filter(y=>y.kind==="videoinput");let v=T.find(y=>l.some(x=>{var N;return Ce(N=y.label.toLowerCase()).call(N,x)}));return!v&&T.length&&Ce(l).call(l,"back")&&(v=T[T.length-1]),v&&(s.video.deviceId=d.exact?{exact:v.deviceId}:{ideal:v.deviceId}),s.video=n(s.video),gR("chrome: "+JSON.stringify(s)),c(s)})}s.video=n(s.video)}return gR("chrome: "+JSON.stringify(s)),c(s)},o=function(s){return e.version>=64?s:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[s.name]||s.name,message:s.message,constraint:s.constraint||s.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=function(s,c,d){i(s,u=>{r.webkitGetUserMedia(u,c,l=>{d&&d(o(l))})})}.bind(r),r.mediaDevices.getUserMedia){const s=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(c){return i(c,d=>s(d).then(u=>{if(d.audio&&!u.getAudioTracks().length||d.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(l=>{l.stop()}),new DOMException("","NotFoundError");return u},u=>De.reject(o(u))))}}}function vR(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function yR(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",n=>{let i;i=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(s=>s.track&&s.track.id===n.track.id):{track:n.track};const o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(n=>{let i;i=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(s=>s.track&&s.track.id===n.id):{track:n};const o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else ic(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function SR(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(i,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=i.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:i}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(s,c){let d=i.apply(this,arguments);return d||(d=e(this,s),this._senders.push(d)),d};const o=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(s){o.apply(this,arguments);const c=this._senders.indexOf(s);c!==-1&&this._senders.splice(c,1)}}const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const n=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(o=>{const s=this._senders.find(c=>c.track===o);s&&this._senders.splice(this._senders.indexOf(s),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(n=>n._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function RR(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[r,n,i]=arguments;if(arguments.length>0&&typeof r=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof r!="function"))return e.apply(this,[]);const o=function(c){const d={};return c.result().forEach(u=>{const l={id:u.id,timestamp:u.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[u.type]||u.type};u.names().forEach(T=>{l[T]=u.stat(T)}),d[l.id]=l}),d},s=function(c){return new Map(Object.keys(c).map(d=>[d,c[d]]))};if(arguments.length>=2){const c=function(d){n(s(o(d)))};return e.apply(this,[c,r])}return new De((c,d)=>{e.apply(this,[function(u){c(s(o(u)))},d])}).then(n,i)}}function IR(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=r.apply(this,[]);return i.forEach(o=>o._pc=this),i});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>ER(o,i.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=r.apply(this,[]);return n.forEach(i=>i._pc=this),n}),ic(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){const n=this;return this._pc.getStats().then(i=>ER(i,n.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let n,i,o;return this.getSenders().forEach(s=>{s.track===r&&(n?o=!0:n=s)}),this.getReceivers().forEach(s=>(s.track===r&&(i?o=!0:i=s),s.track===r)),o||n&&i?De.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():i?i.getStats():De.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function CR(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,s){if(!s)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[s.id]?this._shimmedLocalStreams[s.id].indexOf(c)===-1&&this._shimmedLocalStreams[s.id].push(c):this._shimmedLocalStreams[s.id]=[s,c],c};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(d=>{if(this.getSenders().find(l=>l.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const s=this.getSenders();r.apply(this,arguments);const c=this.getSenders().filter(d=>s.indexOf(d)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const n=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],n.apply(this,arguments)};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(s=>{const c=this._shimmedLocalStreams[s].indexOf(o);c!==-1&&this._shimmedLocalStreams[s].splice(c,1),this._shimmedLocalStreams[s].length===1&&delete this._shimmedLocalStreams[s]}),i.apply(this,arguments)}}function AR(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return CR(t);const r=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const d=r.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(u=>this._reverseStreams[u.id])};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(u=>{if(this.getSenders().find(T=>T.track===u))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){const u=new t.MediaStream(d.getTracks());this._streams[d.id]=u,this._reverseStreams[u.id]=d,d=u}n.apply(this,[d])};const i=t.RTCPeerConnection.prototype.removeStream;function o(d,u){let l=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(T=>{const v=d._reverseStreams[T],y=d._streams[v.id];l=l.replace(new RegExp(y.id,"g"),v.id)}),new RTCSessionDescription({type:u.type,sdp:l})}t.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},t.RTCPeerConnection.prototype.addTrack=function(d,u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const l=[].slice.call(arguments,1);if(l.length!==1||!l[0].getTracks().find(y=>y===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(y=>y.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const v=this._streams[u.id];if(v)v.addTrack(d),De.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const y=new t.MediaStream([d]);this._streams[u.id]=y,this._reverseStreams[y.id]=u,this.addStream(y)}return this.getSenders().find(y=>y.track===d)},["createOffer","createAnswer"].forEach(function(d){const u=t.RTCPeerConnection.prototype[d],l={[d](){const T=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[v=>{const y=o(this,v);T[0].apply(null,[y])},v=>{T[1]&&T[1].apply(null,v)},arguments[2]]):u.apply(this,arguments).then(v=>o(this,v))}};t.RTCPeerConnection.prototype[d]=l[d]});const s=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(d,u){let l=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(T=>{const v=d._reverseStreams[T],y=d._streams[v.id];l=l.replace(new RegExp(v.id,"g"),y.id)}),new RTCSessionDescription({type:u.type,sdp:l})}(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const d=c.get.apply(this);return d.type===""?d:o(this,d)}}),t.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(d._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let u;this._streams=this._streams||{},Object.keys(this._streams).forEach(l=>{this._streams[l].getTracks().find(T=>d.track===T)&&(u=this._streams[l])}),u&&(u.getTracks().length===1?this.removeStream(this._reverseStreams[u.id]):u.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function B_(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const n=t.RTCPeerConnection.prototype[r],i={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=i[r]})}function bR(t,e){ic(t,"negotiationneeded",r=>{const n=r.target;if(!(e.version<72||n.getConfiguration&&n.getConfiguration().sdpSemantics==="plan-b")||n.signalingState==="stable")return r})}var OR=Object.freeze({__proto__:null,fixNegotiationNeeded:bR,shimAddTrackRemoveTrack:AR,shimAddTrackRemoveTrackWithNative:CR,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof e=="function"?t.navigator.mediaDevices.getDisplayMedia=function(r){return e(r).then(n=>{const i=r.video&&r.video.width,o=r.video&&r.video.height,s=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxFrameRate:s||3}},i&&(r.video.mandatory.maxWidth=i),o&&(r.video.mandatory.maxHeight=o),t.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:SR,shimGetStats:RR,shimGetUserMedia:TR,shimMediaStream:vR,shimOnTrack:yR,shimPeerConnection:B_,shimSenderReceiverGetStats:IR});function wR(t,e){const r=t&&t.navigator,n=t&&t.MediaStreamTrack;if(r.getUserMedia=function(i,o,s){V_("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(i).then(o,s)},!(e.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const i=function(s,c,d){c in s&&!(d in s)&&(s[d]=s[c],delete s[c])},o=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(s){return typeof s=="object"&&typeof s.audio=="object"&&(s=JSON.parse(JSON.stringify(s)),i(s.audio,"autoGainControl","mozAutoGainControl"),i(s.audio,"noiseSuppression","mozNoiseSuppression")),o(s)},n&&n.prototype.getSettings){const s=n.prototype.getSettings;n.prototype.getSettings=function(){const c=s.apply(this,arguments);return i(c,"mozAutoGainControl","autoGainControl"),i(c,"mozNoiseSuppression","noiseSuppression"),c}}if(n&&n.prototype.applyConstraints){const s=n.prototype.applyConstraints;n.prototype.applyConstraints=function(c){return this.kind==="audio"&&typeof c=="object"&&(c=JSON.parse(JSON.stringify(c)),i(c,"autoGainControl","mozAutoGainControl"),i(c,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[c])}}}}function NR(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function F_(t,e){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const o=t.RTCPeerConnection.prototype[i],s={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=s[i]});const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,o,s]=arguments;return n.apply(this,[i||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(d=>{d.type=r[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;c.forEach((u,l)=>{c.set(l,Object.assign({},u,{type:r[u.type]||u.type}))})}return c}).then(o,s)}}function PR(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const n=r.apply(this,arguments);return n._pc=this,n}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):De.resolve(new Map)}}function DR(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(n=>n._pc=this),r}),ic(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function kR(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(e){V_("removeStream","removeTrack"),this.getSenders().forEach(r=>{var n;r.track&&Ce(n=e.getTracks()).call(n,r.track)&&this.removeTrack(r)})})}function LR(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function MR(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const n=r.length>0;n&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=e.apply(this,arguments);if(n){const{sender:o}=i,s=o.getParameters();(!("encodings"in s)||s.encodings.length===1&&Object.keys(s.encodings[0]).length===0)&&(s.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(s).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return i})}function UR(t){if(typeof t!="object"||!t.RTCRtpSender)return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function xR(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?De.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function VR(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?De.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var jR=Object.freeze({__proto__:null,shimAddTransceiver:MR,shimCreateAnswer:VR,shimCreateOffer:xR,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,De.reject(n)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(r)})},shimGetParameters:UR,shimGetUserMedia:wR,shimOnTrack:NR,shimPeerConnection:F_,shimRTCDataChannel:LR,shimReceiverGetStats:DR,shimRemoveStream:kR,shimSenderGetStats:PR});function BR(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){var n;this._localStreams||(this._localStreams=[]),Ce(n=this._localStreams).call(n,r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>e.call(this,i,r)),r.getVideoTracks().forEach(i=>e.call(this,i,r))},t.RTCPeerConnection.prototype.addTrack=function(r){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return i&&i.forEach(s=>{var c;this._localStreams?Ce(c=this._localStreams).call(c,s)||this._localStreams.push(s):this._localStreams=[s]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(e);if(r===-1)return;this._localStreams.splice(r,1);const n=e.getTracks();this.getSenders().forEach(i=>{Ce(n).call(n,i.track)&&this.removeTrack(i)})})}}function FR(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=n=>{n.streams.forEach(i=>{var o;if(this._remoteStreams||(this._remoteStreams=[]),Ce(o=this._remoteStreams).call(o,i))return;this._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(i=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(i)>=0)return;r._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function GR(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,r=e.createOffer,n=e.createAnswer,i=e.setLocalDescription,o=e.setRemoteDescription,s=e.addIceCandidate;e.createOffer=function(d,u){const l=arguments.length>=2?arguments[2]:arguments[0],T=r.apply(this,[l]);return u?(T.then(d,u),De.resolve()):T},e.createAnswer=function(d,u){const l=arguments.length>=2?arguments[2]:arguments[0],T=n.apply(this,[l]);return u?(T.then(d,u),De.resolve()):T};let c=function(d,u,l){const T=i.apply(this,[d]);return l?(T.then(u,l),De.resolve()):T};e.setLocalDescription=c,c=function(d,u,l){const T=o.apply(this,[d]);return l?(T.then(u,l),De.resolve()):T},e.setRemoteDescription=c,c=function(d,u,l){const T=s.apply(this,[d]);return l?(T.then(u,l),De.resolve()):T},e.addIceCandidate=c}function HR(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const r=e.mediaDevices,n=r.getUserMedia.bind(r);e.mediaDevices.getUserMedia=i=>n(WR(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=function(r,n,i){e.mediaDevices.getUserMedia(r).then(n,i)}.bind(e))}function WR(t){return t&&t.video!==void 0?Object.assign({},t,{video:_R(t.video)}):t}function KR(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(r,n){if(r&&r.iceServers){const i=[];for(let o=0;o<r.iceServers.length;o++){let s=r.iceServers[o];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(V_("RTCIceServer.url","RTCIceServer.urls"),s=JSON.parse(JSON.stringify(s)),s.urls=s.url,delete s.url,i.push(s)):i.push(r.iceServers[o])}r.iceServers=i}return new e(r,n)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function zR(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function qR(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){r.offerToReceiveAudio!==void 0&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const n=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):r.offerToReceiveAudio!==!0||n||this.addTransceiver("audio",{direction:"recvonly"}),r.offerToReceiveVideo!==void 0&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveVideo!==!0||i||this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function YR(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var XR=Object.freeze({__proto__:null,shimAudioContext:YR,shimCallbacksAPI:GR,shimConstraints:WR,shimCreateOfferLegacy:qR,shimGetUserMedia:HR,shimLocalStreamsAPI:BR,shimRTCIceServerUrls:KR,shimRemoteStreamsAPI:FR,shimTrackEventTransceiver:zR}),JR=`	
\v\f\r Â áââââââââââââ¯âã\u2028\u2029\uFEFF`,EB=fe,gB=Ji,G_=JR,ZR=g("".replace),TB=RegExp("^["+G_+"]+"),vB=RegExp("(^|[^"+G_+"])["+G_+"]+$"),yB=function(t){return function(e){var r=gB(EB(e));return 1&t&&(r=ZR(r,TB,"")),2&t&&(r=ZR(r,vB,"$1")),r}},SB={trim:yB(3)},RB=kv.PROPER,IB=on,QR=JR,CB=SB.trim;xr({target:"String",proto:!0,forced:function(t){return IB(function(){return!!QR[t]()||"âÂá "[t]()!=="âÂá "||RB&&QR[t].name!==t})}("trim")},{trim:function(){return CB(this)}});var AB=Co("String","trim"),bB=_,OB=AB,H_=String.prototype,wB=function(t){var e=t.trim;return typeof t=="string"||t===H_||bB(H_,t)&&e===H_.trim?OB:e},Ei=ke(wB),$R={exports:{}};(function(t){const e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(r){return r.trim().split(`
`).map(n=>n.trim())},e.splitSections=function(r){return r.split(`
m=`).map((n,i)=>(i>0?"m="+n:n).trim()+`\r
`)},e.getDescription=function(r){const n=e.splitSections(r);return n&&n[0]},e.getMediaSections=function(r){const n=e.splitSections(r);return n.shift(),n},e.matchPrefix=function(r,n){return e.splitLines(r).filter(i=>i.indexOf(n)===0)},e.parseCandidate=function(r){let n;n=r.indexOf("a=candidate:")===0?r.substring(12).split(" "):r.substring(10).split(" ");const i={foundation:n[0],component:{1:"rtp",2:"rtcp"}[n[1]]||n[1],protocol:n[2].toLowerCase(),priority:parseInt(n[3],10),ip:n[4],address:n[4],port:parseInt(n[5],10),type:n[7]};for(let o=8;o<n.length;o+=2)switch(n[o]){case"raddr":i.relatedAddress=n[o+1];break;case"rport":i.relatedPort=parseInt(n[o+1],10);break;case"tcptype":i.tcpType=n[o+1];break;case"ufrag":i.ufrag=n[o+1],i.usernameFragment=n[o+1];break;default:i[n[o]]===void 0&&(i[n[o]]=n[o+1])}return i},e.writeCandidate=function(r){const n=[];n.push(r.foundation);const i=r.component;i==="rtp"?n.push(1):i==="rtcp"?n.push(2):n.push(i),n.push(r.protocol.toUpperCase()),n.push(r.priority),n.push(r.address||r.ip),n.push(r.port);const o=r.type;return n.push("typ"),n.push(o),o!=="host"&&r.relatedAddress&&r.relatedPort&&(n.push("raddr"),n.push(r.relatedAddress),n.push("rport"),n.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(n.push("tcptype"),n.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(n.push("ufrag"),n.push(r.usernameFragment||r.ufrag)),"candidate:"+n.join(" ")},e.parseIceOptions=function(r){return r.substring(14).split(" ")},e.parseRtpMap=function(r){let n=r.substring(9).split(" ");const i={payloadType:parseInt(n.shift(),10)};return n=n[0].split("/"),i.name=n[0],i.clockRate=parseInt(n[1],10),i.channels=n.length===3?parseInt(n[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(r){let n=r.payloadType;r.preferredPayloadType!==void 0&&(n=r.preferredPayloadType);const i=r.channels||r.numChannels||1;return"a=rtpmap:"+n+" "+r.name+"/"+r.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(r){const n=r.substring(9).split(" ");return{id:parseInt(n[0],10),direction:n[0].indexOf("/")>0?n[0].split("/")[1]:"sendrecv",uri:n[1],attributes:n.slice(2).join(" ")}},e.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+`\r
`},e.parseFmtp=function(r){const n={};let i;const o=r.substring(r.indexOf(" ")+1).split(";");for(let s=0;s<o.length;s++)i=o[s].trim().split("="),n[i[0].trim()]=i[1];return n},e.writeFmtp=function(r){let n="",i=r.payloadType;if(r.preferredPayloadType!==void 0&&(i=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){const o=[];Object.keys(r.parameters).forEach(s=>{r.parameters[s]!==void 0?o.push(s+"="+r.parameters[s]):o.push(s)}),n+="a=fmtp:"+i+" "+o.join(";")+`\r
`}return n},e.parseRtcpFb=function(r){const n=r.substring(r.indexOf(" ")+1).split(" ");return{type:n.shift(),parameter:n.join(" ")}},e.writeRtcpFb=function(r){let n="",i=r.payloadType;return r.preferredPayloadType!==void 0&&(i=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(o=>{n+="a=rtcp-fb:"+i+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),n},e.parseSsrcMedia=function(r){const n=r.indexOf(" "),i={ssrc:parseInt(r.substring(7,n),10)},o=r.indexOf(":",n);return o>-1?(i.attribute=r.substring(n+1,o),i.value=r.substring(o+1)):i.attribute=r.substring(n+1),i},e.parseSsrcGroup=function(r){const n=r.substring(13).split(" ");return{semantics:n.shift(),ssrcs:n.map(i=>parseInt(i,10))}},e.getMid=function(r){const n=e.matchPrefix(r,"a=mid:")[0];if(n)return n.substring(6)},e.parseFingerprint=function(r){const n=r.substring(14).split(" ");return{algorithm:n[0].toLowerCase(),value:n[1].toUpperCase()}},e.getDtlsParameters=function(r,n){return{role:"auto",fingerprints:e.matchPrefix(r+n,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(r,n){let i="a=setup:"+n+`\r
`;return r.fingerprints.forEach(o=>{i+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),i},e.parseCryptoLine=function(r){const n=r.substring(9).split(" ");return{tag:parseInt(n[0],10),cryptoSuite:n[1],keyParams:n[2],sessionParams:n.slice(3)}},e.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+(typeof r.keyParams=="object"?e.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(r){if(r.indexOf("inline:")!==0)return null;const n=r.substring(7).split("|");return{keyMethod:"inline",keySalt:n[0],lifeTime:n[1],mkiValue:n[2]?n[2].split(":")[0]:void 0,mkiLength:n[2]?n[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},e.getCryptoParameters=function(r,n){return e.matchPrefix(r+n,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(r,n){const i=e.matchPrefix(r+n,"a=ice-ufrag:")[0],o=e.matchPrefix(r+n,"a=ice-pwd:")[0];return i&&o?{usernameFragment:i.substring(12),password:o.substring(10)}:null},e.writeIceParameters=function(r){let n="a=ice-ufrag:"+r.usernameFragment+`\r
a=ice-pwd:`+r.password+`\r
`;return r.iceLite&&(n+=`a=ice-lite\r
`),n},e.parseRtpParameters=function(r){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(r)[0].split(" ");n.profile=i[2];for(let s=3;s<i.length;s++){const c=i[s],d=e.matchPrefix(r,"a=rtpmap:"+c+" ")[0];if(d){const u=e.parseRtpMap(d),l=e.matchPrefix(r,"a=fmtp:"+c+" ");switch(u.parameters=l.length?e.parseFmtp(l[0]):{},u.rtcpFeedback=e.matchPrefix(r,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),n.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(u.name.toUpperCase())}}}e.matchPrefix(r,"a=extmap:").forEach(s=>{n.headerExtensions.push(e.parseExtmap(s))});const o=e.matchPrefix(r,"a=rtcp-fb:* ").map(e.parseRtcpFb);return n.codecs.forEach(s=>{o.forEach(c=>{s.rtcpFeedback.find(d=>d.type===c.type&&d.parameter===c.parameter)||s.rtcpFeedback.push(c)})}),n},e.writeRtpDescription=function(r,n){let i="";i+="m="+r+" ",i+=n.codecs.length>0?"9":"0",i+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=n.codecs.map(s=>s.preferredPayloadType!==void 0?s.preferredPayloadType:s.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,n.codecs.forEach(s=>{i+=e.writeRtpMap(s),i+=e.writeFmtp(s),i+=e.writeRtcpFb(s)});let o=0;return n.codecs.forEach(s=>{s.maxptime>o&&(o=s.maxptime)}),o>0&&(i+="a=maxptime:"+o+`\r
`),n.headerExtensions&&n.headerExtensions.forEach(s=>{i+=e.writeExtmap(s)}),i},e.parseRtpEncodingParameters=function(r){const n=[],i=e.parseRtpParameters(r),o=i.fecMechanisms.indexOf("RED")!==-1,s=i.fecMechanisms.indexOf("ULPFEC")!==-1,c=e.matchPrefix(r,"a=ssrc:").map(v=>e.parseSsrcMedia(v)).filter(v=>v.attribute==="cname"),d=c.length>0&&c[0].ssrc;let u;const l=e.matchPrefix(r,"a=ssrc-group:FID").map(v=>v.substring(17).split(" ").map(y=>parseInt(y,10)));l.length>0&&l[0].length>1&&l[0][0]===d&&(u=l[0][1]),i.codecs.forEach(v=>{if(v.name.toUpperCase()==="RTX"&&v.parameters.apt){let y={ssrc:d,codecPayloadType:parseInt(v.parameters.apt,10)};d&&u&&(y.rtx={ssrc:u}),n.push(y),o&&(y=JSON.parse(JSON.stringify(y)),y.fec={ssrc:d,mechanism:s?"red+ulpfec":"red"},n.push(y))}}),n.length===0&&d&&n.push({ssrc:d});let T=e.matchPrefix(r,"b=");return T.length&&(T=T[0].indexOf("b=TIAS:")===0?parseInt(T[0].substring(7),10):T[0].indexOf("b=AS:")===0?1e3*parseInt(T[0].substring(5),10)*.95-16e3:void 0,n.forEach(v=>{v.maxBitrate=T})),n},e.parseRtcpParameters=function(r){const n={},i=e.matchPrefix(r,"a=ssrc:").map(c=>e.parseSsrcMedia(c)).filter(c=>c.attribute==="cname")[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);const o=e.matchPrefix(r,"a=rtcp-rsize");n.reducedSize=o.length>0,n.compound=o.length===0;const s=e.matchPrefix(r,"a=rtcp-mux");return n.mux=s.length>0,n},e.writeRtcpParameters=function(r){let n="";return r.reducedSize&&(n+=`a=rtcp-rsize\r
`),r.mux&&(n+=`a=rtcp-mux\r
`),r.ssrc!==void 0&&r.cname&&(n+="a=ssrc:"+r.ssrc+" cname:"+r.cname+`\r
`),n},e.parseMsid=function(r){let n;const i=e.matchPrefix(r,"a=msid:");if(i.length===1)return n=i[0].substring(7).split(" "),{stream:n[0],track:n[1]};const o=e.matchPrefix(r,"a=ssrc:").map(s=>e.parseSsrcMedia(s)).filter(s=>s.attribute==="msid");return o.length>0?(n=o[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},e.parseSctpDescription=function(r){const n=e.parseMLine(r),i=e.matchPrefix(r,"a=max-message-size:");let o;i.length>0&&(o=parseInt(i[0].substring(19),10)),isNaN(o)&&(o=65536);const s=e.matchPrefix(r,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substring(12),10),protocol:n.fmt,maxMessageSize:o};const c=e.matchPrefix(r,"a=sctpmap:");if(c.length>0){const d=c[0].substring(10).split(" ");return{port:parseInt(d[0],10),protocol:d[1],maxMessageSize:o}}},e.writeSctpDescription=function(r,n){let i=[];return i=r.protocol!=="DTLS/SCTP"?["m="+r.kind+" 9 "+r.protocol+" "+n.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+n.port+`\r
`]:["m="+r.kind+" 9 "+r.protocol+" "+n.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+n.port+" "+n.protocol+` 65535\r
`],n.maxMessageSize!==void 0&&i.push("a=max-message-size:"+n.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(r,n,i){let o;const s=n!==void 0?n:2;return o=r||e.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+o+" "+s+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(r,n){const i=e.splitLines(r);for(let o=0;o<i.length;o++)switch(i[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[o].substring(2)}return n?e.getDirection(n):"sendrecv"},e.getKind=function(r){return e.splitLines(r)[0].split(" ")[0].substring(2)},e.isRejected=function(r){return r.split(" ",2)[1]==="0"},e.parseMLine=function(r){const n=e.splitLines(r)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},e.parseOLine=function(r){const n=e.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},e.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;const n=e.splitLines(r);for(let i=0;i<n.length;i++)if(n[i].length<2||n[i].charAt(1)!=="=")return!1;return!0},t.exports=e})($R);var tI=$R.exports,sd=ke(tI),NB=Yi({__proto__:null,default:sd},[tI]);function jh(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&((r=JSON.parse(JSON.stringify(r))).candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){const n=new e(r),i=sd.parseCandidate(r.candidate),o=Object.assign(n,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new e(r)},t.RTCIceCandidate.prototype=e.prototype,ic(t,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new t.RTCIceCandidate(r.candidate),writable:"false"}),r))}function W_(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||ic(t,"icecandidate",e=>{if(e.candidate){const r=sd.parseCandidate(e.candidate.candidate);r.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return e})}function Bh(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const r=function(c){if(!c||!c.sdp)return!1;const d=sd.splitSections(c.sdp);return d.shift(),d.some(u=>{const l=sd.parseMLine(u);return l&&l.kind==="application"&&l.protocol.indexOf("SCTP")!==-1})},n=function(c){const d=c.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(d===null||d.length<2)return-1;const u=parseInt(d[1],10);return u!=u?-1:u},i=function(c){let d=65536;return e.browser==="firefox"&&(d=e.version<57?c===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),d},o=function(c,d){let u=65536;e.browser==="firefox"&&e.version===57&&(u=65535);const l=sd.matchPrefix(c.sdp,"a=max-message-size:");return l.length>0?u=parseInt(l[0].substr(19),10):e.browser==="firefox"&&d!==-1&&(u=2147483637),u},s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const c=n(arguments[0]),d=i(c),u=o(arguments[0],c);let l;l=d===0&&u===0?Number.POSITIVE_INFINITY:d===0||u===0?Math.max(d,u):Math.min(d,u);const T={};Object.defineProperty(T,"maxMessageSize",{get:()=>l}),this._sctp=T}return s.apply(this,arguments)}}function Fh(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function e(n,i){const o=n.send;n.send=function(){const s=arguments[0],c=s.length||s.size||s.byteLength;if(n.readyState==="open"&&i.sctp&&c>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return o.apply(n,arguments)}}const r=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const n=r.apply(this,arguments);return e(n,this),n},ic(t,"datachannel",n=>(e(n.channel,n.target),n))}function K_(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{const n=e[r];e[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const o=i.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const s=new Event("connectionstatechange",i);o.dispatchEvent(s)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function z_(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=n.sdp.split(`
`).filter(o=>Ei(o).call(o)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&n instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:n.type,sdp:i}):n.sdp=i}return r.apply(this,arguments)}}function Gh(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const r=t.RTCPeerConnection.prototype.addIceCandidate;r&&r.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?De.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),De.resolve())})}function Hh(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const r=t.RTCPeerConnection.prototype.setLocalDescription;r&&r.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let n=arguments[0]||{};if(typeof n!="object"||n.type&&n.sdp)return r.apply(this,arguments);if(n={type:n.type,sdp:n.sdp},!n.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":n.type="offer";break;default:n.type="answer"}return n.sdp||n.type!=="offer"&&n.type!=="answer"?r.apply(this,[n]):(n.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(i=>r.apply(this,[i]))})}var PB=Object.freeze({__proto__:null,removeExtmapAllowMixed:z_,shimAddIceCandidateNullOrEmpty:Gh,shimConnectionState:K_,shimMaxMessageSize:Bh,shimParameterlessSetLocalDescription:Hh,shimRTCIceCandidate:jh,shimRTCIceCandidateRelayProtocol:W_,shimSendThrowTypeError:Fh});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const r=fR,n=function(o){const s={browser:null,version:null};if(o===void 0||!o.navigator)return s.browser="Not a browser.",s;const{navigator:c}=o;if(c.mozGetUserMedia)s.browser="firefox",s.version=Vh(c.userAgent,/Firefox\/(\d+)\./,1);else if(c.webkitGetUserMedia||o.isSecureContext===!1&&o.webkitRTCPeerConnection)s.browser="chrome",s.version=Vh(c.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!o.RTCPeerConnection||!c.userAgent.match(/AppleWebKit\/(\d+)\./))return s.browser="Not a supported browser.",s;s.browser="safari",s.version=Vh(c.userAgent,/AppleWebKit\/(\d+)\./,1),s.supportsUnifiedPlan=o.RTCRtpTransceiver&&"currentDirection"in o.RTCRtpTransceiver.prototype}return s}(t),i={browserDetails:n,commonShim:PB,extractVersion:Vh,disableLog:mB,disableWarnings:_B,sdp:NB};switch(n.browser){case"chrome":if(!OR||!B_||!e.shimChrome)return r("Chrome shim is not included in this adapter release."),i;if(n.version===null)return r("Chrome shim can not determine version, not shimming."),i;r("adapter.js shimming chrome."),i.browserShim=OR,Gh(t,n),Hh(t),TR(t,n),vR(t),B_(t,n),yR(t),AR(t,n),SR(t),RR(t),IR(t),bR(t,n),jh(t),W_(t),K_(t),Bh(t,n),Fh(t),z_(t,n);break;case"firefox":if(!jR||!F_||!e.shimFirefox)return r("Firefox shim is not included in this adapter release."),i;r("adapter.js shimming firefox."),i.browserShim=jR,Gh(t,n),Hh(t),wR(t,n),F_(t,n),NR(t),kR(t),PR(t),DR(t),LR(t),MR(t),UR(t),xR(t),VR(t),jh(t),K_(t),Bh(t,n),Fh(t);break;case"safari":if(!XR||!e.shimSafari)return r("Safari shim is not included in this adapter release."),i;r("adapter.js shimming safari."),i.browserShim=XR,Gh(t,n),Hh(t),KR(t),qR(t),GR(t),BR(t),FR(t),zR(t),HR(t),YR(t),jh(t),W_(t),Bh(t,n),Fh(t),z_(t,n);break;default:r("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var q_=m;xr({global:!0,forced:q_.globalThis!==q_},{globalThis:q_});var eI=ke(m),Y_={exports:{}};(function(t,e){(function(r,n){var i="function",o="undefined",s="object",c="string",d="major",u="model",l="name",T="type",v="vendor",y="version",x="architecture",N="console",L="mobile",Q="tablet",J="smarttv",at="wearable",Rt="embedded",vt="Amazon",pt="Apple",kt="ASUS",$t="BlackBerry",se="Browser",Te="Chrome",mr="Firefox",Er="Google",ar="Huawei",kr="LG",Nr="Microsoft",li="Motorola",ie="Opera",Se="Samsung",Fe="Sharp",ce="Sony",w="Xiaomi",ht="Zebra",Tt="Facebook",ye="Chromium OS",hr="Mac OS",Yr=" Browser",Dn=function(wn){for(var kn={},$r=0;$r<wn.length;$r++)kn[wn[$r].toUpperCase()]=wn[$r];return kn},So=function(wn,kn){return typeof wn===c&&zo(kn).indexOf(zo(wn))!==-1},zo=function(wn){return wn.toLowerCase()},xl=function(wn,kn){if(typeof wn===c)return wn=wn.replace(/^\s\s*/,""),typeof kn===o?wn:wn.substring(0,500)},Dc=function(wn,kn){for(var $r,Vi,fs,Rn,na,Cr,ms=0;ms<kn.length&&!na;){var kc=kn[ms],xs=kn[ms+1];for($r=Vi=0;$r<kc.length&&!na&&kc[$r];)if(na=kc[$r++].exec(wn))for(fs=0;fs<xs.length;fs++)Cr=na[++Vi],typeof(Rn=xs[fs])===s&&Rn.length>0?Rn.length===2?typeof Rn[1]==i?this[Rn[0]]=Rn[1].call(this,Cr):this[Rn[0]]=Rn[1]:Rn.length===3?typeof Rn[1]!==i||Rn[1].exec&&Rn[1].test?this[Rn[0]]=Cr?Cr.replace(Rn[1],Rn[2]):n:this[Rn[0]]=Cr?Rn[1].call(this,Cr,Rn[2]):n:Rn.length===4&&(this[Rn[0]]=Cr?Rn[3].call(this,Cr.replace(Rn[1],Rn[2])):n):this[Rn]=Cr||n;ms+=2}},tu=function(wn,kn){for(var $r in kn)if(typeof kn[$r]===s&&kn[$r].length>0){for(var Vi=0;Vi<kn[$r].length;Vi++)if(So(kn[$r][Vi],wn))return $r==="?"?n:$r}else if(So(kn[$r],wn))return $r==="?"?n:$r;return kn.hasOwnProperty("*")?kn["*"]:wn},Wf={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Kf={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[y,[l,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[y,[l,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[l,y],[/opios[\/ ]+([\w\.]+)/i],[y,[l,ie+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[y,[l,ie+" GX"]],[/\bopr\/([\w\.]+)/i],[y,[l,ie]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[y,[l,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[y,[l,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[l,y],[/quark(?:pc)?\/([-\w\.]+)/i],[y,[l,"Quark"]],[/\bddg\/([\w\.]+)/i],[y,[l,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[y,[l,"UC"+se]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[y,[l,"WeChat"]],[/konqueror\/([\w\.]+)/i],[y,[l,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[y,[l,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[y,[l,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[y,[l,"Smart Lenovo "+se]],[/(avast|avg)\/([\w\.]+)/i],[[l,/(.+)/,"$1 Secure "+se],y],[/\bfocus\/([\w\.]+)/i],[y,[l,mr+" Focus"]],[/\bopt\/([\w\.]+)/i],[y,[l,ie+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[y,[l,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[y,[l,"Dolphin"]],[/coast\/([\w\.]+)/i],[y,[l,ie+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[y,[l,"MIUI"+Yr]],[/fxios\/([\w\.-]+)/i],[y,[l,mr]],[/\bqihoobrowser\/?([\w\.]*)/i],[y,[l,"360"]],[/\b(qq)\/([\w\.]+)/i],[[l,/(.+)/,"$1Browser"],y],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[l,/(.+)/,"$1"+Yr],y],[/samsungbrowser\/([\w\.]+)/i],[y,[l,Se+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[y,[l,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[l,"Sogou Mobile"],y],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[l,y],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[l],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[y,l],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[l,Tt],y],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[l,y],[/\bgsa\/([\w\.]+) .*safari\//i],[y,[l,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[y,[l,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[y,[l,Te+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[l,Te+" WebView"],y],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[y,[l,"Android "+se]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[l,y],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[y,[l,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[y,l],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[l,[y,tu,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[l,y],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[l,"Netscape"],y],[/(wolvic|librewolf)\/([\w\.]+)/i],[l,y],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[y,[l,mr+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[l,[y,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[l,[y,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[x,"amd64"]],[/(ia32(?=;))/i],[[x,zo]],[/((?:i[346]|x)86)[;\)]/i],[[x,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[x,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[x,"armhf"]],[/windows (ce|mobile); ppc;/i],[[x,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[x,/ower/,"",zo]],[/(sun4\w)[;\)]/i],[[x,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[x,zo]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[u,[v,Se],[T,Q]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[u,[v,Se],[T,L]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[u,[v,pt],[T,L]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[u,[v,pt],[T,Q]],[/(macintosh);/i],[u,[v,pt]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[u,[v,Fe],[T,L]],[/(?:honor)([-\w ]+)[;\)]/i],[u,[v,"Honor"],[T,L]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[u,[v,ar],[T,Q]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[u,[v,ar],[T,L]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[u,/_/g," "],[v,w],[T,L]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[u,/_/g," "],[v,w],[T,Q]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[u,[v,"OPPO"],[T,L]],[/\b(opd2\d{3}a?) bui/i],[u,[v,"OPPO"],[T,Q]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[u,[v,"Vivo"],[T,L]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[u,[v,"Realme"],[T,L]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[u,[v,li],[T,L]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[u,[v,li],[T,Q]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[u,[v,kr],[T,Q]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[u,[v,kr],[T,L]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[u,[v,"Lenovo"],[T,Q]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[u,/_/g," "],[v,"Nokia"],[T,L]],[/(pixel c)\b/i],[u,[v,Er],[T,Q]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[u,[v,Er],[T,L]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[u,[v,ce],[T,L]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[u,"Xperia Tablet"],[v,ce],[T,Q]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[u,[v,"OnePlus"],[T,L]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[u,[v,vt],[T,Q]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[u,/(.+)/g,"Fire Phone $1"],[v,vt],[T,L]],[/(playbook);[-\w\),; ]+(rim)/i],[u,v,[T,Q]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[u,[v,$t],[T,L]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[u,[v,kt],[T,Q]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[u,[v,kt],[T,L]],[/(nexus 9)/i],[u,[v,"HTC"],[T,Q]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[v,[u,/_/g," "],[T,L]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[u,[v,"TCL"],[T,Q]],[/(itel) ((\w+))/i],[[v,zo],u,[T,tu,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[u,[v,"Acer"],[T,Q]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[u,[v,"Meizu"],[T,L]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[u,[v,"Ulefone"],[T,L]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[u,[v,"Energizer"],[T,L]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[u,[v,"Cat"],[T,L]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[u,[v,"Smartfren"],[T,L]],[/droid.+; (a(?:015|06[35]|142p?))/i],[u,[v,"Nothing"],[T,L]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[v,u,[T,L]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[v,u,[T,Q]],[/(surface duo)/i],[u,[v,Nr],[T,Q]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[u,[v,"Fairphone"],[T,L]],[/(u304aa)/i],[u,[v,"AT&T"],[T,L]],[/\bsie-(\w*)/i],[u,[v,"Siemens"],[T,L]],[/\b(rct\w+) b/i],[u,[v,"RCA"],[T,Q]],[/\b(venue[\d ]{2,7}) b/i],[u,[v,"Dell"],[T,Q]],[/\b(q(?:mv|ta)\w+) b/i],[u,[v,"Verizon"],[T,Q]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[u,[v,"Barnes & Noble"],[T,Q]],[/\b(tm\d{3}\w+) b/i],[u,[v,"NuVision"],[T,Q]],[/\b(k88) b/i],[u,[v,"ZTE"],[T,Q]],[/\b(nx\d{3}j) b/i],[u,[v,"ZTE"],[T,L]],[/\b(gen\d{3}) b.+49h/i],[u,[v,"Swiss"],[T,L]],[/\b(zur\d{3}) b/i],[u,[v,"Swiss"],[T,Q]],[/\b((zeki)?tb.*\b) b/i],[u,[v,"Zeki"],[T,Q]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[v,"Dragon Touch"],u,[T,Q]],[/\b(ns-?\w{0,9}) b/i],[u,[v,"Insignia"],[T,Q]],[/\b((nxa|next)-?\w{0,9}) b/i],[u,[v,"NextBook"],[T,Q]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[v,"Voice"],u,[T,L]],[/\b(lvtel\-)?(v1[12]) b/i],[[v,"LvTel"],u,[T,L]],[/\b(ph-1) /i],[u,[v,"Essential"],[T,L]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[u,[v,"Envizen"],[T,Q]],[/\b(trio[-\w\. ]+) b/i],[u,[v,"MachSpeed"],[T,Q]],[/\btu_(1491) b/i],[u,[v,"Rotor"],[T,Q]],[/(shield[\w ]+) b/i],[u,[v,"Nvidia"],[T,Q]],[/(sprint) (\w+)/i],[v,u,[T,L]],[/(kin\.[onetw]{3})/i],[[u,/\./g," "],[v,Nr],[T,L]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[u,[v,ht],[T,Q]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[u,[v,ht],[T,L]],[/smart-tv.+(samsung)/i],[v,[T,J]],[/hbbtv.+maple;(\d+)/i],[[u,/^/,"SmartTV"],[v,Se],[T,J]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[v,kr],[T,J]],[/(apple) ?tv/i],[v,[u,pt+" TV"],[T,J]],[/crkey/i],[[u,Te+"cast"],[v,Er],[T,J]],[/droid.+aft(\w+)( bui|\))/i],[u,[v,vt],[T,J]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[u,[v,Fe],[T,J]],[/(bravia[\w ]+)( bui|\))/i],[u,[v,ce],[T,J]],[/(mitv-\w{5}) bui/i],[u,[v,w],[T,J]],[/Hbbtv.*(technisat) (.*);/i],[v,u,[T,J]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[v,xl],[u,xl],[T,J]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[T,J]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[v,u,[T,N]],[/droid.+; (shield) bui/i],[u,[v,"Nvidia"],[T,N]],[/(playstation [345portablevi]+)/i],[u,[v,ce],[T,N]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[u,[v,Nr],[T,N]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[u,[v,Se],[T,at]],[/((pebble))app/i],[v,u,[T,at]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[u,[v,pt],[T,at]],[/droid.+; (glass) \d/i],[u,[v,Er],[T,at]],[/droid.+; (wt63?0{2,3})\)/i],[u,[v,ht],[T,at]],[/droid.+; (glass) \d/i],[u,[v,Er],[T,at]],[/(pico) (4|neo3(?: link|pro)?)/i],[v,u,[T,at]],[/; (quest( \d| pro)?)/i],[u,[v,Tt],[T,at]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[v,[T,Rt]],[/(aeobc)\b/i],[u,[v,vt],[T,Rt]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[u,[T,L]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[u,[T,Q]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[T,Q]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[T,L]],[/(android[-\w\. ]{0,9});.+buil/i],[u,[v,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[y,[l,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[l,y],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[y,[l,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[l,y],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[y,l]],os:[[/microsoft (windows) (vista|xp)/i],[l,y],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[l,[y,tu,Wf]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[y,tu,Wf],[l,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[y,/_/g,"."],[l,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[l,hr],[y,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[y,l],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[l,y],[/\(bb(10);/i],[y,[l,$t]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[y,[l,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[y,[l,mr+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[y,[l,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[y,[l,"watchOS"]],[/crkey\/([\d\.]+)/i],[y,[l,Te+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[l,ye],y],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[l,y],[/(sunos) ?([\w\.\d]*)/i],[[l,"Solaris"],y],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[l,y]]},Ro=function(wn,kn){if(typeof wn===s&&(kn=wn,wn=n),!(this instanceof Ro))return new Ro(wn,kn).getResult();var $r=typeof r!==o&&r.navigator?r.navigator:n,Vi=wn||($r&&$r.userAgent?$r.userAgent:""),fs=$r&&$r.userAgentData?$r.userAgentData:n,Rn=kn?function(Cr,ms){var kc={};for(var xs in Cr)ms[xs]&&ms[xs].length%2==0?kc[xs]=ms[xs].concat(Cr[xs]):kc[xs]=Cr[xs];return kc}(Kf,kn):Kf,na=$r&&$r.userAgent==Vi;return this.getBrowser=function(){var Cr={};return Cr[l]=n,Cr[y]=n,Dc.call(Cr,Vi,Rn.browser),Cr[d]=function(ms){return typeof ms===c?ms.replace(/[^\d\.]/g,"").split(".")[0]:n}(Cr[y]),na&&$r&&$r.brave&&typeof $r.brave.isBrave==i&&(Cr[l]="Brave"),Cr},this.getCPU=function(){var Cr={};return Cr[x]=n,Dc.call(Cr,Vi,Rn.cpu),Cr},this.getDevice=function(){var Cr={};return Cr[v]=n,Cr[u]=n,Cr[T]=n,Dc.call(Cr,Vi,Rn.device),na&&!Cr[T]&&fs&&fs.mobile&&(Cr[T]=L),na&&Cr[u]=="Macintosh"&&$r&&typeof $r.standalone!==o&&$r.maxTouchPoints&&$r.maxTouchPoints>2&&(Cr[u]="iPad",Cr[T]=Q),Cr},this.getEngine=function(){var Cr={};return Cr[l]=n,Cr[y]=n,Dc.call(Cr,Vi,Rn.engine),Cr},this.getOS=function(){var Cr={};return Cr[l]=n,Cr[y]=n,Dc.call(Cr,Vi,Rn.os),na&&!Cr[l]&&fs&&fs.platform&&fs.platform!="Unknown"&&(Cr[l]=fs.platform.replace(/chrome os/i,ye).replace(/macos/i,hr)),Cr},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Vi},this.setUA=function(Cr){return Vi=typeof Cr===c&&Cr.length>500?xl(Cr,500):Cr,this},this.setUA(Vi),this};Ro.VERSION="0.7.40",Ro.BROWSER=Dn([l,y,d]),Ro.CPU=Dn([x]),Ro.DEVICE=Dn([u,v,T,N,L,J,Q,at,Rt]),Ro.ENGINE=Ro.OS=Dn([l,y]),t.exports&&(e=t.exports=Ro),e.UAParser=Ro;var ra=typeof r!==o&&(r.jQuery||r.Zepto);if(ra&&!ra.ua){var zf=new Ro;ra.ua=zf.getResult(),ra.ua.get=function(){return zf.getUA()},ra.ua.set=function(wn){zf.setUA(wn);var kn=zf.getResult();for(var $r in kn)ra.ua[$r]=kn[$r]}}})(typeof window=="object"?window:xn)})(Y_,Y_.exports);var DB=ke(Y_.exports),rI=_h.clear;xr({global:!0,bind:!0,forced:m.clearImmediate!==rI},{clearImmediate:rI});var nI=m,kB=P,LB=U,MB=nm,UB=We,xB=_a,VB=Qa,jB=nI.Function,BB=/MSIE .\./.test(UB)||MB==="BUN"&&function(){var t=nI.Bun.version.split(".");return t.length<3||t[0]==="0"&&(t[1]<3||t[1]==="3"&&t[2]==="0")}(),FB=xr,iI=m,oI=_h.set,GB=function(t,e){var r=1;return BB?function(n,i){var o=VB(arguments.length,1)>r,s=LB(n)?n:jB(n),c=o?xB(arguments,r):[],d=o?function(){kB(s,this,c)}:s;return t(d)}:t},sI=iI.setImmediate?GB(oI):oI;FB({global:!0,bind:!0,forced:iI.setImmediate!==sI},{setImmediate:sI});var aI=ke(xe.setImmediate),HB=m,WB=Ty,KB=I,zB=Qa,qB=q;xr({global:!0,dontCallGetSet:!0,forced:on(function(){return qB&&Object.getOwnPropertyDescriptor(HB,"queueMicrotask").value.length!==1})},{queueMicrotask:function(t){zB(arguments.length,1),WB(KB(t))}});var cI=ke(xe.queueMicrotask);function dI(t,e){return function(){return t.apply(e,arguments)}}const{toString:YB}=Object.prototype,{getPrototypeOf:X_}=Object,{iterator:Wh,toStringTag:uI}=Symbol,Kh=(J_=Object.create(null),t=>{const e=YB.call(t);return J_[e]||(J_[e]=e.slice(8,-1).toLowerCase())});var J_;const $o=t=>(t=t.toLowerCase(),e=>Kh(e)===t),zh=t=>e=>typeof e===t,{isArray:ad}=Array,Lu=zh("undefined"),lI=$o("ArrayBuffer"),XB=zh("string"),Zi=zh("function"),hI=zh("number"),qh=t=>t!==null&&typeof t=="object",Yh=t=>{if(Kh(t)!=="object")return!1;const e=X_(t);return!(e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null||uI in t||Wh in t)},JB=$o("Date"),ZB=$o("File"),QB=$o("Blob"),$B=$o("FileList"),tF=$o("URLSearchParams"),[eF,rF,nF,iF]=["ReadableStream","Request","Response","Headers"].map($o);function Mu(t,e){let r,n,{allOwnKeys:i=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),ad(t))for(r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else{const o=i?Object.getOwnPropertyNames(t):Object.keys(t),s=o.length;let c;for(r=0;r<s;r++)c=o[r],e.call(null,t[c],c,t)}}function pI(t,e){e=e.toLowerCase();const r=Object.keys(t);let n,i=r.length;for(;i-- >0;)if(n=r[i],e===n.toLowerCase())return n;return null}const oc=eI!==void 0?eI:typeof self<"u"?self:typeof window<"u"?window:globalThis,fI=t=>!Lu(t)&&t!==oc,oF=(Z_=typeof Uint8Array<"u"&&X_(Uint8Array),t=>Z_&&t instanceof Z_);var Z_;const sF=$o("HTMLFormElement"),mI=(t=>{let{hasOwnProperty:e}=t;return(r,n)=>e.call(r,n)})(Object.prototype),aF=$o("RegExp"),_I=(t,e)=>{const r=Object.getOwnPropertyDescriptors(t),n={};Mu(r,(i,o)=>{let s;(s=e(i,o,t))!==!1&&(n[o]=s||i)}),Object.defineProperties(t,n)},cF=$o("AsyncFunction"),EI=(gI=typeof aI=="function",TI=Zi(oc.postMessage),gI?aI:TI?(Q_="axios@".concat(Math.random()),Xh=[],oc.addEventListener("message",t=>{let{source:e,data:r}=t;e===oc&&r===Q_&&Xh.length&&Xh.shift()()},!1),t=>{Xh.push(t),oc.postMessage(Q_,"*")}):t=>setTimeout(t));var gI,TI,Q_,Xh;const dF=cI!==void 0?cI.bind(oc):typeof Xf<"u"&&Xf.nextTick||EI;var we={isArray:ad,isArrayBuffer:lI,isBuffer:function(t){return t!==null&&!Lu(t)&&t.constructor!==null&&!Lu(t.constructor)&&Zi(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Zi(t.append)&&((e=Kh(t))==="formdata"||e==="object"&&Zi(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let e;return e=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&lI(t.buffer),e},isString:XB,isNumber:hI,isBoolean:t=>t===!0||t===!1,isObject:qh,isPlainObject:Yh,isReadableStream:eF,isRequest:rF,isResponse:nF,isHeaders:iF,isUndefined:Lu,isDate:JB,isFile:ZB,isBlob:QB,isRegExp:aF,isFunction:Zi,isStream:t=>qh(t)&&Zi(t.pipe),isURLSearchParams:tF,isTypedArray:oF,isFileList:$B,forEach:Mu,merge:function t(){const{caseless:e}=fI(this)&&this||{},r={},n=(i,o)=>{const s=e&&pI(r,o)||o;Yh(r[s])&&Yh(i)?r[s]=t(r[s],i):Yh(i)?r[s]=t({},i):ad(i)?r[s]=i.slice():r[s]=i};for(let i=0,o=arguments.length;i<o;i++)arguments[i]&&Mu(arguments[i],n);return r},extend:function(t,e,r){let{allOwnKeys:n}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Mu(e,(i,o)=>{r&&Zi(i)?t[o]=dI(i,r):t[o]=i},{allOwnKeys:n}),t},trim:t=>Ei(t)?Ei(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,e,r,n)=>{t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),r&&Object.assign(t.prototype,r)},toFlatObject:(t,e,r,n)=>{let i,o,s;const c={};if(e=e||{},t==null)return e;do{for(i=Object.getOwnPropertyNames(t),o=i.length;o-- >0;)s=i[o],n&&!n(s,t,e)||c[s]||(e[s]=t[s],c[s]=!0);t=r!==!1&&X_(t)}while(t&&(!r||r(t,e))&&t!==Object.prototype);return e},kindOf:Kh,kindOfTest:$o,endsWith:(t,e,r)=>{t=String(t),(r===void 0||r>t.length)&&(r=t.length),r-=e.length;const n=t.indexOf(e,r);return n!==-1&&n===r},toArray:t=>{if(!t)return null;if(ad(t))return t;let e=t.length;if(!hI(e))return null;const r=new Array(e);for(;e-- >0;)r[e]=t[e];return r},forEachEntry:(t,e)=>{const r=(t&&t[Wh]).call(t);let n;for(;(n=r.next())&&!n.done;){const i=n.value;e.call(t,i[0],i[1])}},matchAll:(t,e)=>{let r;const n=[];for(;(r=t.exec(e))!==null;)n.push(r);return n},isHTMLForm:sF,hasOwnProperty:mI,hasOwnProp:mI,reduceDescriptors:_I,freezeMethods:t=>{_I(t,(e,r)=>{if(Zi(t)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const n=t[r];Zi(n)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))})},toObjectSet:(t,e)=>{const r={},n=i=>{i.forEach(o=>{r[o]=!0})};return ad(t)?n(t):n(String(t).split(e)),r},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,r,n){return r.toUpperCase()+n}),noop:()=>{},toFiniteNumber:(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,findKey:pI,global:oc,isContextDefined:fI,isSpecCompliantForm:function(t){return!!(t&&Zi(t.append)&&t[uI]==="FormData"&&t[Wh])},toJSONObject:t=>{const e=new Array(10),r=(n,i)=>{if(qh(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[i]=n;const o=ad(n)?[]:{};return Mu(n,(s,c)=>{const d=r(s,i+1);!Lu(d)&&(o[c]=d)}),e[i]=void 0,o}}return n};return r(t,0)},isAsyncFn:cF,isThenable:t=>t&&(qh(t)||Zi(t))&&Zi(t.then)&&Zi(t.catch),setImmediate:EI,asap:dF,isIterable:t=>t!=null&&Zi(t[Wh])};function Gr(t,e,r,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}we.inherits(Gr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:we.toJSONObject(this.config),code:this.code,status:this.status}}});const vI=Gr.prototype,yI={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{yI[t]={value:t}}),Object.defineProperties(Gr,yI),Object.defineProperty(vI,"isAxiosError",{value:!0}),Gr.from=(t,e,r,n,i,o)=>{const s=Object.create(vI);return we.toFlatObject(t,s,function(c){return c!==Error.prototype},c=>c!=="isAxiosError"),Gr.call(s,t.message,e,r,n,i),s.cause=t,s.name=t.name,o&&Object.assign(s,o),s};function $_(t){return we.isPlainObject(t)||we.isArray(t)}function SI(t){return we.endsWith(t,"[]")?t.slice(0,-2):t}function RI(t,e,r){return t?t.concat(e).map(function(n,i){return n=SI(n),!r&&i?"["+n+"]":n}).join(r?".":""):e}const uF=we.toFlatObject(we,{},null,function(t){return/^is[A-Z]/.test(t)});function Jh(t,e,r){if(!we.isObject(t))throw new TypeError("target must be an object");e=e||new FormData;const n=(r=we.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(v,y){return!we.isUndefined(y[v])})).metaTokens,i=r.visitor||u,o=r.dots,s=r.indexes,c=(r.Blob||typeof Blob<"u"&&Blob)&&we.isSpecCompliantForm(e);if(!we.isFunction(i))throw new TypeError("visitor must be a function");function d(v){if(v===null)return"";if(we.isDate(v))return v.toISOString();if(!c&&we.isBlob(v))throw new Gr("Blob is not supported. Use a Buffer instead.");return we.isArrayBuffer(v)||we.isTypedArray(v)?c&&typeof Blob=="function"?new Blob([v]):u7.from(v):v}function u(v,y,x){let N=v;if(v&&!x&&typeof v=="object"){if(we.endsWith(y,"{}"))y=n?y:y.slice(0,-2),v=JSON.stringify(v);else if(we.isArray(v)&&function(L){return we.isArray(L)&&!L.some($_)}(v)||(we.isFileList(v)||we.endsWith(y,"[]"))&&(N=we.toArray(v)))return y=SI(y),N.forEach(function(L,Q){!we.isUndefined(L)&&L!==null&&e.append(s===!0?RI([y],Q,o):s===null?y:y+"[]",d(L))}),!1}return!!$_(v)||(e.append(RI(x,y,o),d(v)),!1)}const l=[],T=Object.assign(uF,{defaultVisitor:u,convertValue:d,isVisitable:$_});if(!we.isObject(t))throw new TypeError("data must be an object");return function v(y,x){if(!we.isUndefined(y)){if(l.indexOf(y)!==-1)throw Error("Circular reference detected in "+x.join("."));l.push(y),we.forEach(y,function(N,L){(!(we.isUndefined(N)||N===null)&&i.call(e,N,we.isString(L)?Ei(L).call(L):L,x,T))===!0&&v(N,x?x.concat(L):[L])}),l.pop()}}(t),e}function II(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function tE(t,e){this._pairs=[],t&&Jh(t,this,e)}const CI=tE.prototype;function lF(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function AI(t,e,r){if(!e)return t;const n=r&&r.encode||lF;we.isFunction(r)&&(r={serialize:r});const i=r&&r.serialize;let o;if(o=i?i(e,r):we.isURLSearchParams(e)?e.toString():new tE(e,r).toString(n),o){const s=t.indexOf("#");s!==-1&&(t=t.slice(0,s)),t+=(t.indexOf("?")===-1?"?":"&")+o}return t}CI.append=function(t,e){this._pairs.push([t,e])},CI.toString=function(t){const e=t?function(r){return t.call(this,r,II)}:II;return this._pairs.map(function(r){return e(r[0])+"="+e(r[1])},"").join("&")};var bI=class{constructor(){this.handlers=[]}use(t,e,r){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){we.forEach(this.handlers,function(e){e!==null&&t(e)})}},OI={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},wI={exports:{}},hF=xr,pF=q,NI=Bi.f;hF({target:"Object",stat:!0,forced:Object.defineProperty!==NI,sham:!pF},{defineProperty:NI});var PI=xe.Object,fF=wI.exports=function(t,e,r){return PI.defineProperty(t,e,r)};PI.defineProperty.sham&&(fF.sham=!0);var DI=ke(wI.exports),mF=TypeError,kI=mu,_F=mh,EF=je,gF=sn("species"),LI=Array,TF=function(t){var e;return kI(t)&&(e=t.constructor,(_F(e)&&(e===LI||kI(e.prototype))||EF(e)&&(e=e[gF])===null)&&(e=void 0)),e===void 0?LI:e},MI=function(t,e){return new(TF(t))(e===0?0:e)},vF=on,yF=ze,SF=sn("species"),UI=function(t){return yF>=51||!vF(function(){var e=[];return(e.constructor={})[SF]=function(){return{foo:1}},e[t](Boolean).foo!==1})},RF=xr,IF=on,CF=mu,AF=je,bF=he,OF=pa,xI=function(t){if(t>9007199254740991)throw mF("Maximum allowed index exceeded");return t},VI=__,wF=MI,NF=UI,PF=ze,jI=sn("isConcatSpreadable"),DF=PF>=51||!IF(function(){var t=[];return t[jI]=!1,t.concat()[0]!==t}),kF=function(t){if(!AF(t))return!1;var e=t[jI];return e!==void 0?!!e:CF(t)};RF({target:"Array",proto:!0,forced:!DF||!NF("concat")},{concat:function(t){var e,r,n,i,o,s=bF(this),c=wF(s,0),d=0;for(e=-1,n=arguments.length;e<n;e++)if(kF(o=e===-1?s:arguments[e]))for(i=OF(o),xI(d+i),r=0;r<i;r++,d++)r in o&&VI(c,d,o[r]);else xI(d+1),VI(c,d++,o);return c.length=d,c}});var BI={},LF=z,MF=me,FI=$l.f,UF=_a,GI=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];BI.f=function(t){return GI&&LF(t)==="Window"?function(e){try{return FI(e)}catch{return UF(GI)}}(t):FI(MF(t))};var cd={},xF=sn;cd.f=xF;var HI=xe,VF=Ye,jF=cd,BF=Bi.f,zn=function(t){var e=HI.Symbol||(HI.Symbol={});VF(e,t)||BF(e,t,{value:jF.f(t)})},FF=mt,GF=Ze,HF=sn,WF=ma,WI=function(){var t=GF("Symbol"),e=t&&t.prototype,r=e&&e.valueOf,n=HF("toPrimitive");e&&!e[n]&&WF(e,n,function(i){return FF(r,this)},{})},KF=ji,zF=Zt,qF=he,YF=pa,XF=MI,KI=g([].push),JF=function(t){var e=t===1,r=t===2,n=t===3,i=t===4,o=t===6,s=t===7,c=t===5||o;return function(d,u,l,T){for(var v,y,x=qF(d),N=zF(x),L=YF(N),Q=KF(u,l),J=0,at=T||XF,Rt=e?at(d,L):r||s?at(d,0):void 0;L>J;J++)if((c||J in N)&&(y=Q(v=N[J],J,x),t))if(e)Rt[J]=y;else if(y)switch(t){case 3:return!0;case 5:return v;case 6:return J;case 2:KI(Rt,v)}else switch(t){case 4:return!1;case 7:KI(Rt,v)}return o?-1:n||i?i:Rt}},zI={forEach:JF(0)},Zh=xr,Uu=m,eE=mt,ZF=g,ud=q,ld=Dt,QF=on,yi=Ye,$F=_,rE=Qn,Qh=me,nE=an,t5=Ji,iE=zt,hd=Eu,qI=eh,e5=$l,YI=BI,r5=_u,XI=Y,JI=Bi,n5=um,ZI=wt,QI=ma,i5=fh,oE=Ot,$I=th,tC=_r,o5=sn,s5=cd,a5=zn,c5=WI,d5=Fs,eC=Za,$h=zI.forEach,Qi=Ql("hidden"),tp="Symbol",xu="prototype",u5=eC.set,rC=eC.getterFor(tp),ts=Object[xu],sc=Uu.Symbol,ep=sc&&sc[xu],l5=Uu.RangeError,h5=Uu.TypeError,sE=Uu.QObject,nC=XI.f,ac=JI.f,iC=YI.f,p5=ZI.f,oC=ZF([].push),Ws=oE("symbols"),Vu=oE("op-symbols"),f5=oE("wks"),aE=!sE||!sE[xu]||!sE[xu].findChild,sC=function(t,e,r){var n=nC(ts,e);n&&delete ts[e],ac(t,e,r),n&&t!==ts&&ac(ts,e,n)},cE=ud&&QF(function(){return hd(ac({},"a",{get:function(){return ac(this,"a",{value:7}).a}})).a!==7})?sC:ac,dE=function(t,e){var r=Ws[t]=hd(ep);return u5(r,{type:tp,tag:t,description:e}),ud||(r.description=e),r},rp=function(t,e,r){t===ts&&rp(Vu,e,r),rE(t);var n=nE(e);return rE(r),yi(Ws,n)?(r.enumerable?(yi(t,Qi)&&t[Qi][n]&&(t[Qi][n]=!1),r=hd(r,{enumerable:iE(0,!1)})):(yi(t,Qi)||ac(t,Qi,iE(1,hd(null))),t[Qi][n]=!0),cE(t,n,r)):ac(t,n,r)},uE=function(t,e){rE(t);var r=Qh(e),n=qI(r).concat(uC(r));return $h(n,function(i){ud&&!eE(aC,r,i)||rp(t,i,r[i])}),t},aC=function(t){var e=nE(t),r=eE(p5,this,e);return!(this===ts&&yi(Ws,e)&&!yi(Vu,e))&&(!(r||!yi(this,e)||!yi(Ws,e)||yi(this,Qi)&&this[Qi][e])||r)},cC=function(t,e){var r=Qh(t),n=nE(e);if(r!==ts||!yi(Ws,n)||yi(Vu,n)){var i=nC(r,n);return!i||!yi(Ws,n)||yi(r,Qi)&&r[Qi][n]||(i.enumerable=!0),i}},dC=function(t){var e=iC(Qh(t)),r=[];return $h(e,function(n){yi(Ws,n)||yi($I,n)||oC(r,n)}),r},uC=function(t){var e=t===ts,r=iC(e?Vu:Qh(t)),n=[];return $h(r,function(i){!yi(Ws,i)||e&&!yi(ts,i)||oC(n,Ws[i])}),n};ld||(sc=function(){if($F(ep,this))throw new h5("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?t5(arguments[0]):void 0,e=tC(t),r=function(n){var i=this===void 0?Uu:this;i===ts&&eE(r,Vu,n),yi(i,Qi)&&yi(i[Qi],e)&&(i[Qi][e]=!1);var o=iE(1,n);try{cE(i,e,o)}catch(s){if(!(s instanceof l5))throw s;sC(i,e,o)}};return ud&&aE&&cE(ts,e,{configurable:!0,set:r}),dE(e,t)},QI(ep=sc[xu],"toString",function(){return rC(this).tag}),QI(sc,"withoutSetter",function(t){return dE(tC(t),t)}),ZI.f=aC,JI.f=rp,n5.f=uE,XI.f=cC,e5.f=YI.f=dC,r5.f=uC,s5.f=function(t){return dE(o5(t),t)},ud&&i5(ep,"description",{configurable:!0,get:function(){return rC(this).description}})),Zh({global:!0,wrap:!0,forced:!ld,sham:!ld},{Symbol:sc}),$h(qI(f5),function(t){a5(t)}),Zh({target:tp,stat:!0,forced:!ld},{useSetter:function(){aE=!0},useSimple:function(){aE=!1}}),Zh({target:"Object",stat:!0,forced:!ld,sham:!ud},{create:function(t,e){return e===void 0?hd(t):uE(hd(t),e)},defineProperty:rp,defineProperties:uE,getOwnPropertyDescriptor:cC}),Zh({target:"Object",stat:!0,forced:!ld},{getOwnPropertyNames:dC}),c5(),d5(sc,tp),$I[Qi]=!0;var lC=Dt&&!!Symbol.for&&!!Symbol.keyFor,m5=xr,_5=Ze,E5=Ye,g5=Ji,hC=Ot,T5=lC,lE=hC("string-to-symbol-registry"),v5=hC("symbol-to-string-registry");m5({target:"Symbol",stat:!0,forced:!T5},{for:function(t){var e=g5(t);if(E5(lE,e))return lE[e];var r=_5("Symbol")(e);return lE[e]=r,v5[r]=e,r}});var y5=xr,S5=Ye,R5=Xt,I5=ne,C5=lC,pC=Ot("symbol-to-string-registry");y5({target:"Symbol",stat:!0,forced:!C5},{keyFor:function(t){if(!R5(t))throw new TypeError(I5(t)+" is not a symbol");if(S5(pC,t))return pC[t]}});var fC=mu,A5=U,mC=z,b5=Ji,_C=g([].push),O5=xr,EC=Ze,gC=P,w5=mt,ju=g,TC=on,vC=U,yC=Xt,SC=_a,N5=function(t){if(A5(t))return t;if(fC(t)){for(var e=t.length,r=[],n=0;n<e;n++){var i=t[n];typeof i=="string"?_C(r,i):typeof i!="number"&&mC(i)!=="Number"&&mC(i)!=="String"||_C(r,b5(i))}var o=r.length,s=!0;return function(c,d){if(s)return s=!1,d;if(fC(this))return d;for(var u=0;u<o;u++)if(r[u]===c)return d}}},P5=Dt,D5=String,Sa=EC("JSON","stringify"),np=ju(/./.exec),RC=ju("".charAt),k5=ju("".charCodeAt),L5=ju("".replace),M5=ju(1 .toString),U5=/[\uD800-\uDFFF]/g,IC=/^[\uD800-\uDBFF]$/,CC=/^[\uDC00-\uDFFF]$/,AC=!P5||TC(function(){var t=EC("Symbol")("stringify detection");return Sa([t])!=="[null]"||Sa({a:t})!=="{}"||Sa(Object(t))!=="{}"}),bC=TC(function(){return Sa("\uDF06\uD834")!=='"\\udf06\\ud834"'||Sa("\uDEAD")!=='"\\udead"'}),x5=function(t,e){var r=SC(arguments),n=N5(e);if(vC(n)||t!==void 0&&!yC(t))return r[1]=function(i,o){if(vC(n)&&(o=w5(n,this,D5(i),o)),!yC(o))return o},gC(Sa,null,r)},V5=function(t,e,r){var n=RC(r,e-1),i=RC(r,e+1);return np(IC,t)&&!np(CC,i)||np(CC,t)&&!np(IC,n)?"\\u"+M5(k5(t,0),16):t};Sa&&O5({target:"JSON",stat:!0,forced:AC||bC},{stringify:function(t,e,r){var n=SC(arguments),i=gC(AC?x5:Sa,null,n);return bC&&typeof i=="string"?L5(i,U5,V5):i}});var OC=_u,j5=he;xr({target:"Object",stat:!0,forced:!Dt||on(function(){OC.f(1)})},{getOwnPropertySymbols:function(t){var e=OC.f;return e?e(j5(t)):[]}}),zn("asyncIterator"),zn("hasInstance"),zn("isConcatSpreadable"),zn("iterator"),zn("match"),zn("matchAll"),zn("replace"),zn("search"),zn("species"),zn("split");var B5=WI;zn("toPrimitive"),B5();var F5=Ze,G5=Fs;zn("toStringTag"),G5(F5("Symbol"),"Symbol"),zn("unscopables"),Fs(m.JSON,"JSON",!0);var H5=xe.Symbol,W5=sn,K5=Bi.f,wC=W5("metadata"),NC=Function.prototype;NC[wC]===void 0&&K5(NC,wC,{value:null}),zn("asyncDispose"),zn("dispose"),zn("metadata");var z5=H5,q5=g,hE=Ze("Symbol"),Y5=hE.keyFor,X5=q5(hE.prototype.valueOf),PC=hE.isRegisteredSymbol||function(t){try{return Y5(X5(t))!==void 0}catch{return!1}};xr({target:"Symbol",stat:!0},{isRegisteredSymbol:PC});for(var J5=Ot,DC=Ze,Z5=g,Q5=Xt,$5=sn,ip=DC("Symbol"),kC=ip.isWellKnownSymbol,LC=DC("Object","getOwnPropertyNames"),tG=Z5(ip.prototype.valueOf),MC=J5("wks"),pE=0,UC=LC(ip),eG=UC.length;pE<eG;pE++)try{var xC=UC[pE];Q5(ip[xC])&&$5(xC)}catch{}var VC=function(t){if(kC&&kC(t))return!0;try{for(var e=tG(t),r=0,n=LC(MC),i=n.length;r<i;r++)if(MC[n[r]]==e)return!0}catch{}return!1};xr({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:VC}),zn("customMatcher"),zn("observable"),xr({target:"Symbol",stat:!0},{isRegistered:PC}),xr({target:"Symbol",stat:!0,forced:!0},{isWellKnown:VC}),zn("matcher"),zn("metadataKey"),zn("patternMatch"),zn("replaceAll");var pd=ke(z5),jC=ke(cd.f("iterator"));function Bu(t){return Bu=typeof pd=="function"&&typeof jC=="symbol"?function(e){return typeof e}:function(e){return e&&typeof pd=="function"&&e.constructor===pd&&e!==pd.prototype?"symbol":typeof e},Bu(t)}var rG=ke(cd.f("toPrimitive"));function nG(t){var e=function(r,n){if(Bu(r)!="object"||!r)return r;var i=r[rG];if(i!==void 0){var o=i.call(r,n);if(Bu(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}(t,"string");return Bu(e)=="symbol"?e:e+""}function G(t,e,r){return(e=nG(e))in t?DI(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var BC=ke(nj),iG={isBrowser:!0,classes:{URLSearchParams:BC!==void 0?BC:tE,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const fE=typeof window<"u"&&typeof document<"u",mE=typeof navigator=="object"&&navigator||void 0,oG=fE&&(!mE||["ReactNative","NativeScript","NS"].indexOf(mE.product)<0),sG=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",aG=fE&&window.location.href||"http://localhost";function FC(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function GC(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?FC(Object(r),!0).forEach(function(n){G(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):FC(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Di=GC(GC({},Object.freeze({__proto__:null,hasBrowserEnv:fE,hasStandardBrowserEnv:oG,hasStandardBrowserWebWorkerEnv:sG,navigator:mE,origin:aG})),iG),cG=Qn,dG=mt,uG=Ye,lG=_,hG=function(){var t=cG(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},HC=RegExp.prototype,WC=function(t){var e=t.flags;return e!==void 0||"flags"in HC||uG(t,"flags")||!lG(HC,t)?e:dG(hG,t)},pG=r_.charAt,KC=mt,fG=Qn,mG=U,_G=z,EG=/./.exec,gG=TypeError,TG=xr,zC=mt,qC=M,vG=Rm,op=hh,YC=fe,XC=qT,Fu=Ji,yG=Qn,SG=je,RG=z,IG=XT,JC=WC,CG=K,AG=on,bG=wm,OG=function(t,e,r){return e+(r?pG(t,e).length:1)},wG=function(t,e){var r=t.exec;if(mG(r)){var n=KC(r,t,e);return n!==null&&fG(n),n}if(_G(t)==="RegExp")return KC(EG,t,e);throw new gG("RegExp#exec called on incompatible receiver")},ZC=Za,NG=sn("matchAll"),QC="RegExp String",$C=QC+" Iterator",PG=ZC.set,DG=ZC.getterFor($C),kG=TypeError,_E=qC("".indexOf),sp=qC("".matchAll),EE=!!sp&&!AG(function(){sp("a",/./)}),LG=vG(function(t,e,r,n){PG(this,{type:$C,regexp:t,string:e,global:r,unicode:n,done:!1})},QC,function(){var t=DG(this);if(t.done)return op(void 0,!0);var e=t.regexp,r=t.string,n=wG(e,r);return n===null?(t.done=!0,op(void 0,!0)):t.global?(Fu(n[0])===""&&(e.lastIndex=OG(r,XC(e.lastIndex),t.unicode)),op(n,!1)):(t.done=!0,op(n,!1))}),t0=function(t){var e,r,n,i=yG(this),o=Fu(t),s=bG(i,RegExp),c=Fu(JC(i));return e=new s(s===RegExp?i.source:i,c),r=!!~_E(c,"g"),n=!!~_E(c,"u"),e.lastIndex=XC(i.lastIndex),new LG(e,o,r,n)};TG({target:"String",proto:!0,forced:EE},{matchAll:function(t){var e,r,n,i,o=YC(this);if(SG(t)){if(IG(t)&&(e=Fu(YC(JC(t))),!~_E(e,"g")))throw new kG("`.matchAll` does not allow non-global regexes");if(EE)return sp(o,t);if((n=CG(t,NG))===void 0&&RG(t)==="RegExp"&&(n=t0),n)return zC(n,t,o)}else if(EE)return sp(o,t);return r=Fu(o),i=new RegExp(t,"g"),zC(t0,i,r)}});var MG=Co("String","matchAll"),UG=_,xG=MG,gE=String.prototype,VG=function(t){var e=t.matchAll;return typeof t=="string"||t===gE||UG(gE,t)&&e===gE.matchAll?xG:e},jG=ke(VG);function e0(t){function e(r,n,i,o){let s=r[o++];if(s==="__proto__")return!0;const c=Number.isFinite(+s),d=o>=r.length;return s=!s&&we.isArray(i)?i.length:s,d?(we.hasOwnProp(i,s)?i[s]=[i[s],n]:i[s]=n,!c):(i[s]&&we.isObject(i[s])||(i[s]=[]),e(r,n,i[s],o)&&we.isArray(i[s])&&(i[s]=function(u){const l={},T=Object.keys(u);let v;const y=T.length;let x;for(v=0;v<y;v++)x=T[v],l[x]=u[x];return l}(i[s])),!c)}if(we.isFormData(t)&&we.isFunction(t.entries)){const r={};return we.forEachEntry(t,(n,i)=>{e(function(o){return jG(we).call(we,/\w+|\[(\w*)]/g,o).map(s=>s[0]==="[]"?"":s[1]||s[0])}(n),i,r,0)}),r}return null}const TE={transitional:OI,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const r=e.getContentType()||"",n=r.indexOf("application/json")>-1,i=we.isObject(t);if(i&&we.isHTMLForm(t)&&(t=new FormData(t)),we.isFormData(t))return n?JSON.stringify(e0(t)):t;if(we.isArrayBuffer(t)||we.isBuffer(t)||we.isStream(t)||we.isFile(t)||we.isBlob(t)||we.isReadableStream(t))return t;if(we.isArrayBufferView(t))return t.buffer;if(we.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let o;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(s,c){return Jh(s,new Di.classes.URLSearchParams,Object.assign({visitor:function(d,u,l,T){return Di.isNode&&we.isBuffer(d)?(this.append(u,d.toString("base64")),!1):T.defaultVisitor.apply(this,arguments)}},c))}(t,this.formSerializer).toString();if((o=we.isFileList(t))||r.indexOf("multipart/form-data")>-1){const s=this.env&&this.env.FormData;return Jh(o?{"files[]":t}:t,s&&new s,this.formSerializer)}}return i||n?(e.setContentType("application/json",!1),function(s,c,d){if(we.isString(s))try{return(c||JSON.parse)(s),Ei(we).call(we,s)}catch(u){if(u.name!=="SyntaxError")throw u}return(d||JSON.stringify)(s)}(t)):t}],transformResponse:[function(t){const e=this.transitional||TE.transitional,r=e&&e.forcedJSONParsing,n=this.responseType==="json";if(we.isResponse(t)||we.isReadableStream(t))return t;if(t&&we.isString(t)&&(r&&!this.responseType||n)){const i=!(e&&e.silentJSONParsing)&&n;try{return JSON.parse(t)}catch(o){if(i)throw o.name==="SyntaxError"?Gr.from(o,Gr.ERR_BAD_RESPONSE,this,null,this.response):o}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Di.classes.FormData,Blob:Di.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};we.forEach(["delete","get","head","post","put","patch"],t=>{TE.headers[t]={}});var vE=TE;const BG=we.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),r0=Symbol("internals");function Gu(t){var e;return t&&Ei(e=String(t)).call(e).toLowerCase()}function ap(t){return t===!1||t==null?t:we.isArray(t)?t.map(ap):String(t)}function yE(t,e,r,n,i){return we.isFunction(n)?n.call(this,e,r):(i&&(e=r),we.isString(e)?we.isString(n)?e.indexOf(n)!==-1:we.isRegExp(n)?n.test(e):void 0:void 0)}class cp{constructor(e){e&&this.set(e)}set(e,r,n){const i=this;function o(d,u,l){const T=Gu(u);if(!T)throw new Error("header name must be a non-empty string");const v=we.findKey(i,T);(!v||i[v]===void 0||l===!0||l===void 0&&i[v]!==!1)&&(i[v||u]=ap(d))}const s=(d,u)=>we.forEach(d,(l,T)=>o(l,T,u));if(we.isPlainObject(e)||e instanceof this.constructor)s(e,r);else if(we.isString(e)&&(e=Ei(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Ei(c=e).call(c)))s((d=>{const u={};let l,T,v;return d&&d.split(`
`).forEach(function(y){var x,N;v=y.indexOf(":"),l=Ei(x=y.substring(0,v)).call(x).toLowerCase(),T=Ei(N=y.substring(v+1)).call(N),!l||u[l]&&BG[l]||(l==="set-cookie"?u[l]?u[l].push(T):u[l]=[T]:u[l]=u[l]?u[l]+", "+T:T)}),u})(e),r);else if(we.isObject(e)&&we.isIterable(e)){let d,u,l={};for(const T of e){if(!we.isArray(T))throw TypeError("Object iterator must return a key-value pair");l[u=T[0]]=(d=l[u])?we.isArray(d)?[...d,T[1]]:[d,T[1]]:T[1]}s(l,r)}else e!=null&&o(r,e,n);var c;return this}get(e,r){if(e=Gu(e)){const n=we.findKey(this,e);if(n){const i=this[n];if(!r)return i;if(r===!0)return function(o){const s=Object.create(null),c=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let d;for(;d=c.exec(o);)s[d[1]]=d[2];return s}(i);if(we.isFunction(r))return r.call(this,i,n);if(we.isRegExp(r))return r.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,r){if(e=Gu(e)){const n=we.findKey(this,e);return!(!n||this[n]===void 0||r&&!yE(0,this[n],n,r))}return!1}delete(e,r){const n=this;let i=!1;function o(s){if(s=Gu(s)){const c=we.findKey(n,s);!c||r&&!yE(0,n[c],c,r)||(delete n[c],i=!0)}}return we.isArray(e)?e.forEach(o):o(e),i}clear(e){const r=Object.keys(this);let n=r.length,i=!1;for(;n--;){const o=r[n];e&&!yE(0,this[o],o,e,!0)||(delete this[o],i=!0)}return i}normalize(e){const r=this,n={};return we.forEach(this,(i,o)=>{var s;const c=we.findKey(n,o);if(c)return r[c]=ap(i),void delete r[o];const d=e?function(u){return Ei(u).call(u).toLowerCase().replace(/([a-z\d])(\w*)/g,(l,T,v)=>T.toUpperCase()+v)}(o):Ei(s=String(o)).call(s);d!==o&&delete r[o],r[d]=ap(i),n[d]=!0}),this}concat(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return this.constructor.concat(this,...r)}toJSON(e){const r=Object.create(null);return we.forEach(this,(n,i)=>{n!=null&&n!==!1&&(r[i]=e&&we.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[r,n]=e;return r+": "+n}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const r=new this(e);for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return i.forEach(s=>r.set(s)),r}static accessor(e){const r=(this[r0]=this[r0]={accessors:{}}).accessors,n=this.prototype;function i(o){const s=Gu(o);r[s]||(function(c,d){const u=we.toCamelCase(" "+d);["get","set","has"].forEach(l=>{Object.defineProperty(c,l+u,{value:function(T,v,y){return this[l].call(this,d,T,v,y)},configurable:!0})})}(n,o),r[s]=!0)}return we.isArray(e)?e.forEach(i):i(e),this}}cp.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),we.reduceDescriptors(cp.prototype,(t,e)=>{let{value:r}=t,n=e[0].toUpperCase()+e.slice(1);return{get:()=>r,set(i){this[n]=i}}}),we.freezeMethods(cp);var es=cp;function SE(t,e){const r=this||vE,n=e||r,i=es.from(n.headers);let o=n.data;return we.forEach(t,function(s){o=s.call(r,o,i.normalize(),e?e.status:void 0)}),i.normalize(),o}function n0(t){return!(!t||!t.__CANCEL__)}function fd(t,e,r){Gr.call(this,t??"canceled",Gr.ERR_CANCELED,e,r),this.name="CanceledError"}function i0(t,e,r){const n=r.config.validateStatus;r.status&&n&&!n(r.status)?e(new Gr("Request failed with status code "+r.status,[Gr.ERR_BAD_REQUEST,Gr.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):t(r)}we.inherits(fd,Gr,{__CANCEL__:!0});const dp=function(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=0;const i=function(o,s){o=o||10;const c=new Array(o),d=new Array(o);let u,l=0,T=0;return s=s!==void 0?s:1e3,function(v){const y=Date.now(),x=d[T];u||(u=y),c[l]=v,d[l]=y;let N=T,L=0;for(;N!==l;)L+=c[N++],N%=o;if(l=(l+1)%o,l===T&&(T=(T+1)%o),y-u<s)return;const Q=x&&y-x;return Q?Math.round(1e3*L/Q):void 0}}(50,250);return function(o,s){let c,d,u=0,l=1e3/s;const T=function(v){u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),c=null,d&&(clearTimeout(d),d=null),o.apply(null,v)};return[function(){const v=Date.now(),y=v-u;for(var x=arguments.length,N=new Array(x),L=0;L<x;L++)N[L]=arguments[L];y>=l?T(N,v):(c=N,d||(d=setTimeout(()=>{d=null,T(c)},l-y)))},()=>c&&T(c)]}(o=>{const s=o.loaded,c=o.lengthComputable?o.total:void 0,d=s-n,u=i(d);n=s,t({loaded:s,total:c,progress:c?s/c:void 0,bytes:d,rate:u||void 0,estimated:u&&c&&s<=c?(c-s)/u:void 0,event:o,lengthComputable:c!=null,[e?"download":"upload"]:!0})},r)},o0=(t,e)=>{const r=t!=null;return[n=>e[0]({lengthComputable:r,total:t,loaded:n}),e[1]]},s0=t=>function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return we.asap(()=>t(...r))};var FG=Di.hasStandardBrowserEnv?((t,e)=>r=>(r=new xh(r,Di.origin),t.protocol===r.protocol&&t.host===r.host&&(e||t.port===r.port)))(new xh(Di.origin),Di.navigator&&/(msie|trident)/i.test(Di.navigator.userAgent)):()=>!0,GG=Di.hasStandardBrowserEnv?{write(t,e,r,n,i,o){const s=[t+"="+encodeURIComponent(e)];we.isNumber(r)&&s.push("expires="+new Date(r).toGMTString()),we.isString(n)&&s.push("path="+n),we.isString(i)&&s.push("domain="+i),o===!0&&s.push("secure"),document.cookie=s.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function a0(t,e,r){let n=!function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}(e);return t&&(n||r==0)?function(i,o){return o?i.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):i}(t,e):e}function c0(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}const d0=t=>t instanceof es?function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r]!=null?arguments[r]:{};r%2?c0(Object(n),!0).forEach(function(i){G(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c0(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}({},t):t;function cc(t,e){e=e||{};const r={};function n(u,l,T,v){return we.isPlainObject(u)&&we.isPlainObject(l)?we.merge.call({caseless:v},u,l):we.isPlainObject(l)?we.merge({},l):we.isArray(l)?l.slice():l}function i(u,l,T,v){return we.isUndefined(l)?we.isUndefined(u)?void 0:n(void 0,u,0,v):n(u,l,0,v)}function o(u,l){if(!we.isUndefined(l))return n(void 0,l)}function s(u,l){return we.isUndefined(l)?we.isUndefined(u)?void 0:n(void 0,u):n(void 0,l)}function c(u,l,T){return T in e?n(u,l):T in t?n(void 0,u):void 0}const d={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:c,headers:(u,l,T)=>i(d0(u),d0(l),0,!0)};return we.forEach(Object.keys(Object.assign({},t,e)),function(u){const l=d[u]||i,T=l(t[u],e[u],u);we.isUndefined(T)&&l!==c||(r[u]=T)}),r}var u0=t=>{const e=cc({},t);let r,{data:n,withXSRFToken:i,xsrfHeaderName:o,xsrfCookieName:s,headers:c,auth:d}=e;if(e.headers=c=es.from(c),e.url=AI(a0(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),d&&c.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):""))),we.isFormData(n)){if(Di.hasStandardBrowserEnv||Di.hasStandardBrowserWebWorkerEnv)c.setContentType(void 0);else if((r=c.getContentType())!==!1){const[u,...l]=r?r.split(";").map(T=>Ei(T).call(T)).filter(Boolean):[];c.setContentType([u||"multipart/form-data",...l].join("; "))}}if(Di.hasStandardBrowserEnv&&(i&&we.isFunction(i)&&(i=i(e)),i||i!==!1&&FG(e.url))){const u=o&&s&&GG.read(s);u&&c.set(o,u)}return e},HG=typeof XMLHttpRequest<"u"&&function(t){return new De(function(e,r){const n=u0(t);let i=n.data;const o=es.from(n.headers).normalize();let s,c,d,u,l,{responseType:T,onUploadProgress:v,onDownloadProgress:y}=n;function x(){u&&u(),l&&l(),n.cancelToken&&n.cancelToken.unsubscribe(s),n.signal&&n.signal.removeEventListener("abort",s)}let N=new XMLHttpRequest;function L(){if(!N)return;const J=es.from("getAllResponseHeaders"in N&&N.getAllResponseHeaders());i0(function(at){e(at),x()},function(at){r(at),x()},{data:T&&T!=="text"&&T!=="json"?N.response:N.responseText,status:N.status,statusText:N.statusText,headers:J,config:t,request:N}),N=null}N.open(n.method.toUpperCase(),n.url,!0),N.timeout=n.timeout,"onloadend"in N?N.onloadend=L:N.onreadystatechange=function(){N&&N.readyState===4&&(N.status!==0||N.responseURL&&N.responseURL.indexOf("file:")===0)&&setTimeout(L)},N.onabort=function(){N&&(r(new Gr("Request aborted",Gr.ECONNABORTED,t,N)),N=null)},N.onerror=function(){r(new Gr("Network Error",Gr.ERR_NETWORK,t,N)),N=null},N.ontimeout=function(){let J=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const at=n.transitional||OI;n.timeoutErrorMessage&&(J=n.timeoutErrorMessage),r(new Gr(J,at.clarifyTimeoutError?Gr.ETIMEDOUT:Gr.ECONNABORTED,t,N)),N=null},i===void 0&&o.setContentType(null),"setRequestHeader"in N&&we.forEach(o.toJSON(),function(J,at){N.setRequestHeader(at,J)}),we.isUndefined(n.withCredentials)||(N.withCredentials=!!n.withCredentials),T&&T!=="json"&&(N.responseType=n.responseType),y&&([d,l]=dp(y,!0),N.addEventListener("progress",d)),v&&N.upload&&([c,u]=dp(v),N.upload.addEventListener("progress",c),N.upload.addEventListener("loadend",u)),(n.cancelToken||n.signal)&&(s=J=>{N&&(r(!J||J.type?new fd(null,t,N):J),N.abort(),N=null)},n.cancelToken&&n.cancelToken.subscribe(s),n.signal&&(n.signal.aborted?s():n.signal.addEventListener("abort",s)));const Q=function(J){const at=/^([-+\w]{1,25})(:?\/\/|:)/.exec(J);return at&&at[1]||""}(n.url);Q&&Di.protocols.indexOf(Q)===-1?r(new Gr("Unsupported protocol "+Q+":",Gr.ERR_BAD_REQUEST,t)):N.send(i||null)})},WG=(t,e)=>{const{length:r}=t=t?t.filter(Boolean):[];if(e||r){let n,i=new AbortController;const o=function(u){if(!n){n=!0,c();const l=u instanceof Error?u:this.reason;i.abort(l instanceof Gr?l:new fd(l instanceof Error?l.message:l))}};let s=e&&setTimeout(()=>{s=null,o(new Gr("timeout ".concat(e," of ms exceeded"),Gr.ETIMEDOUT))},e);const c=()=>{t&&(s&&clearTimeout(s),s=null,t.forEach(u=>{u.unsubscribe?u.unsubscribe(o):u.removeEventListener("abort",o)}),t=null)};t.forEach(u=>u.addEventListener("abort",o));const{signal:d}=i;return d.unsubscribe=()=>we.asap(c),d}},RE=ke(Zy),l0=cd.f("asyncIterator"),KG=ke(l0);function IE(t,e){this.v=t,this.k=e}function ho(t){return function(){return new Hu(t.apply(this,arguments))}}function Hu(t){var e,r;function n(o,s){try{var c=t[o](s),d=c.value,u=d instanceof IE;RE.resolve(u?d.v:d).then(function(l){if(u){var T=o==="return"?"return":"next";if(!d.k||l.done)return n(T,l);l=t[T](l).value}i(c.done?"return":"normal",l)},function(l){n("throw",l)})}catch(l){i("throw",l)}}function i(o,s){switch(o){case"return":e.resolve({value:s,done:!0});break;case"throw":e.reject(s);break;default:e.resolve({value:s,done:!1})}(e=e.next)?n(e.key,e.arg):r=null}this._invoke=function(o,s){return new RE(function(c,d){var u={key:o,arg:s,resolve:c,reject:d,next:null};r?r=r.next=u:(e=r=u,n(o,s))})},typeof t.return!="function"&&(this.return=void 0)}function Ar(t){return new IE(t,0)}function up(t){var e={},r=!1;function n(i,o){return r=!0,o=new RE(function(s){s(t[i](o))}),{done:!1,value:new IE(o,1)}}return e[pd!==void 0&&jC||"@@iterator"]=function(){return this},e.next=function(i){return r?(r=!1,i):n("next",i)},typeof t.throw=="function"&&(e.throw=function(i){if(r)throw r=!1,i;return n("throw",i)}),typeof t.return=="function"&&(e.return=function(i){return r?(r=!1,i):n("return",i)}),e}Hu.prototype[typeof pd=="function"&&KG||"@@asyncIterator"]=function(){return this},Hu.prototype.next=function(t){return this._invoke("next",t)},Hu.prototype.throw=function(t){return this._invoke("throw",t)},Hu.prototype.return=function(t){return this._invoke("return",t)};var CE=ke(l0);function AE(t){var e,r,n,i=2;for(typeof Symbol<"u"&&(r=CE,n=Symbol.iterator);i--;){if(r&&(e=t[r])!=null)return e.call(t);if(n&&(e=t[n])!=null)return new lp(e.call(t));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function lp(t){function e(r){if(Object(r)!==r)return De.reject(new TypeError(r+" is not an object."));var n=r.done;return De.resolve(r.value).then(function(i){return{value:i,done:n}})}return lp=function(r){this.s=r,this.n=r.next},lp.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(r){var n=this.s.return;return n===void 0?De.resolve({value:r,done:!0}):e(n.apply(this.s,arguments))},throw:function(r){var n=this.s.return;return n===void 0?De.reject(r):e(n.apply(this.s,arguments))}},new lp(t)}const zG=function*(t,e){let r=t.byteLength;if(!e||r<e)return void(yield t);let n,i=0;for(;i<r;)n=i+e,yield t.slice(i,n),i=n},qG=function(){var t=ho(function*(e,r){var n,i=!1,o=!1;try{for(var s,c=AE(YG(e));i=!(s=yield Ar(c.next())).done;i=!1){const d=s.value;yield*up(AE(zG(d,r)))}}catch(d){o=!0,n=d}finally{try{i&&c.return!=null&&(yield Ar(c.return()))}finally{if(o)throw n}}});return function(e,r){return t.apply(this,arguments)}}(),YG=function(){var t=ho(function*(e){if(e[CE])return void(yield*up(AE(e)));const r=e.getReader();try{for(;;){const{done:n,value:i}=yield Ar(r.read());if(n)break;yield i}}finally{yield Ar(r.cancel())}});return function(e){return t.apply(this,arguments)}}(),h0=(t,e,r,n)=>{const i=qG(t,e);let o,s=0,c=d=>{o||(o=!0,n&&n(d))};return new ReadableStream({async pull(d){try{const{done:u,value:l}=await i.next();if(u)return c(),void d.close();let T=l.byteLength;if(r){let v=s+=T;r(v)}d.enqueue(new Uint8Array(l))}catch(u){throw c(u),u}},cancel:d=>(c(d),i.return())},{highWaterMark:2})};function p0(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function f0(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?p0(Object(r),!0).forEach(function(n){G(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):p0(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}const hp=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",m0=hp&&typeof ReadableStream=="function",XG=hp&&(typeof TextEncoder=="function"?(_0=new TextEncoder,t=>_0.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var _0;const E0=function(t){try{for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return!!t(...r)}catch{return!1}},JG=m0&&E0(()=>{let t=!1;const e=new Request(Di.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),bE=m0&&E0(()=>we.isReadableStream(new Response("").body)),pp={stream:bE&&(t=>t.body)};var g0;hp&&(g0=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!pp[t]&&(pp[t]=we.isFunction(g0[t])?e=>e[t]():(e,r)=>{throw new Gr("Response type '".concat(t,"' is not supported"),Gr.ERR_NOT_SUPPORT,r)})}));const ZG=async(t,e)=>{const r=we.toFiniteNumber(t.getContentLength());return r??(async n=>n==null?0:we.isBlob(n)?n.size:we.isSpecCompliantForm(n)?(await new Request(Di.origin,{method:"POST",body:n}).arrayBuffer()).byteLength:we.isArrayBufferView(n)||we.isArrayBuffer(n)?n.byteLength:(we.isURLSearchParams(n)&&(n+=""),we.isString(n)?(await XG(n)).byteLength:void 0))(e)};var QG=hp&&(async t=>{let{url:e,method:r,data:n,signal:i,cancelToken:o,timeout:s,onDownloadProgress:c,onUploadProgress:d,responseType:u,headers:l,withCredentials:T="same-origin",fetchOptions:v}=u0(t);u=u?(u+"").toLowerCase():"text";let y,x=WG([i,o&&o.toAbortSignal()],s);const N=x&&x.unsubscribe&&(()=>{x.unsubscribe()});let L;try{if(d&&JG&&r!=="get"&&r!=="head"&&(L=await ZG(l,n))!==0){let vt,pt=new Request(e,{method:"POST",body:n,duplex:"half"});if(we.isFormData(n)&&(vt=pt.headers.get("content-type"))&&l.setContentType(vt),pt.body){const[kt,$t]=o0(L,dp(s0(d)));n=h0(pt.body,65536,kt,$t)}}we.isString(T)||(T=T?"include":"omit");const Q="credentials"in Request.prototype;y=new Request(e,f0(f0({},v),{},{signal:x,method:r.toUpperCase(),headers:l.normalize().toJSON(),body:n,duplex:"half",credentials:Q?T:void 0}));let J=await fetch(y);const at=bE&&(u==="stream"||u==="response");if(bE&&(c||at&&N)){const vt={};["status","statusText","headers"].forEach(se=>{vt[se]=J[se]});const pt=we.toFiniteNumber(J.headers.get("content-length")),[kt,$t]=c&&o0(pt,dp(s0(c),!0))||[];J=new Response(h0(J.body,65536,kt,()=>{$t&&$t(),N&&N()}),vt)}u=u||"text";let Rt=await pp[we.findKey(pp,u)||"text"](J,t);return!at&&N&&N(),await new De((vt,pt)=>{i0(vt,pt,{data:Rt,headers:es.from(J.headers),status:J.status,statusText:J.statusText,config:t,request:y})})}catch(Q){throw N&&N(),Q&&Q.name==="TypeError"&&/Load failed|fetch/i.test(Q.message)?Object.assign(new Gr("Network Error",Gr.ERR_NETWORK,t,y),{cause:Q.cause||Q}):Gr.from(Q,Q&&Q.code,t,y)}});const OE={http:null,xhr:HG,fetch:QG};we.forEach(OE,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const T0=t=>"- ".concat(t),$G=t=>we.isFunction(t)||t===null||t===!1;var v0={getAdapter:t=>{t=we.isArray(t)?t:[t];const{length:e}=t;let r,n;const i={};for(let o=0;o<e;o++){let s;if(r=t[o],n=r,!$G(r)&&(n=OE[(s=String(r)).toLowerCase()],n===void 0))throw new Gr("Unknown adapter '".concat(s,"'"));if(n)break;i[s||"#"+o]=n}if(!n){const o=Object.entries(i).map(s=>{let[c,d]=s;return"adapter ".concat(c," ")+(d===!1?"is not supported by the environment":"is not available in the build")});throw new Gr("There is no suitable adapter to dispatch the request "+(e?o.length>1?`since :
`+o.map(T0).join(`
`):" "+T0(o[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n},adapters:OE};function wE(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new fd(null,t)}function y0(t){return wE(t),t.headers=es.from(t.headers),t.data=SE.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),v0.getAdapter(t.adapter||vE.adapter)(t).then(function(e){return wE(t),e.data=SE.call(t,t.transformResponse,e),e.headers=es.from(e.headers),e},function(e){return n0(e)||(wE(t),e&&e.response&&(e.response.data=SE.call(t,t.transformResponse,e.response),e.response.headers=es.from(e.response.headers))),De.reject(e)})}const S0="1.9.0",fp={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{fp[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});const R0={};fp.transitional=function(t,e,r){function n(i,o){return"[Axios v"+S0+"] Transitional option '"+i+"'"+o+(r?". "+r:"")}return(i,o,s)=>{if(t===!1)throw new Gr(n(o," has been removed"+(e?" in "+e:"")),Gr.ERR_DEPRECATED);return e&&!R0[o]&&(R0[o]=!0,console.warn(n(o," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(i,o,s)}},fp.spelling=function(t){return(e,r)=>(console.warn("".concat(r," is likely a misspelling of ").concat(t)),!0)};var mp={assertOptions:function(t,e,r){if(typeof t!="object")throw new Gr("options must be an object",Gr.ERR_BAD_OPTION_VALUE);const n=Object.keys(t);let i=n.length;for(;i-- >0;){const o=n[i],s=e[o];if(s){const c=t[o],d=c===void 0||s(c,o,t);if(d!==!0)throw new Gr("option "+o+" must be "+d,Gr.ERR_BAD_OPTION_VALUE)}else if(r!==!0)throw new Gr("Unknown option "+o,Gr.ERR_BAD_OPTION)}},validators:fp};const ys=mp.validators;let _p=class{constructor(t){this.defaults=t||{},this.interceptors={request:new bI,response:new bI}}async request(t,e){try{return await this._request(t,e)}catch(r){if(r instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const i=n.stack?n.stack.replace(/^.+\n/,""):"";try{r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+i):r.stack=i}catch{}}throw r}}_request(t,e){typeof t=="string"?(e=e||{}).url=t:e=t||{},e=cc(this.defaults,e);const{transitional:r,paramsSerializer:n,headers:i}=e;r!==void 0&&mp.assertOptions(r,{silentJSONParsing:ys.transitional(ys.boolean),forcedJSONParsing:ys.transitional(ys.boolean),clarifyTimeoutError:ys.transitional(ys.boolean)},!1),n!=null&&(we.isFunction(n)?e.paramsSerializer={serialize:n}:mp.assertOptions(n,{encode:ys.function,serialize:ys.function},!0)),e.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),mp.assertOptions(e,{baseUrl:ys.spelling("baseURL"),withXsrfToken:ys.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let o=i&&we.merge(i.common,i[e.method]);i&&we.forEach(["delete","get","head","post","put","patch","common"],y=>{delete i[y]}),e.headers=es.concat(o,i);const s=[];let c=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(e)===!1||(c=c&&y.synchronous,s.unshift(y.fulfilled,y.rejected))});const d=[];let u;this.interceptors.response.forEach(function(y){d.push(y.fulfilled,y.rejected)});let l,T=0;if(!c){const y=[y0.bind(this),void 0];for(y.unshift.apply(y,s),y.push.apply(y,d),l=y.length,u=De.resolve(e);T<l;)u=u.then(y[T++],y[T++]);return u}l=s.length;let v=e;for(T=0;T<l;){const y=s[T++],x=s[T++];try{v=y(v)}catch(N){x.call(this,N);break}}try{u=y0.call(this,v)}catch(y){return De.reject(y)}for(T=0,l=d.length;T<l;)u=u.then(d[T++],d[T++]);return u}getUri(t){return AI(a0((t=cc(this.defaults,t)).baseURL,t.url,t.allowAbsoluteUrls),t.params,t.paramsSerializer)}};we.forEach(["delete","get","head","options"],function(t){_p.prototype[t]=function(e,r){return this.request(cc(r||{},{method:t,url:e,data:(r||{}).data}))}}),we.forEach(["post","put","patch"],function(t){function e(r){return function(n,i,o){return this.request(cc(o||{},{method:t,headers:r?{"Content-Type":"multipart/form-data"}:{},url:n,data:i}))}}_p.prototype[t]=e(),_p.prototype[t+"Form"]=e(!0)});var Ep=_p;class NE{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let r;this.promise=new De(function(i){r=i});const n=this;this.promise.then(i=>{if(!n._listeners)return;let o=n._listeners.length;for(;o-- >0;)n._listeners[o](i);n._listeners=null}),this.promise.then=i=>{let o;const s=new De(c=>{n.subscribe(c),o=c}).then(i);return s.cancel=function(){n.unsubscribe(o)},s},e(function(i,o,s){n.reason||(n.reason=new fd(i,o,s),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const r=this._listeners.indexOf(e);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const e=new AbortController,r=n=>{e.abort(n)};return this.subscribe(r),e.signal.unsubscribe=()=>this.unsubscribe(r),e.signal}static source(){let e;return{token:new NE(function(n){e=n}),cancel:e}}}var t6=NE;const PE={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(PE).forEach(t=>{let[e,r]=t;PE[r]=e});var e6=PE;const fi=function t(e){const r=new Ep(e),n=dI(Ep.prototype.request,r);return we.extend(n,Ep.prototype,r,{allOwnKeys:!0}),we.extend(n,r,null,{allOwnKeys:!0}),n.create=function(i){return t(cc(e,i))},n}(vE);fi.Axios=Ep,fi.CanceledError=fd,fi.CancelToken=t6,fi.isCancel=n0,fi.VERSION=S0,fi.toFormData=Jh,fi.AxiosError=Gr,fi.Cancel=fi.CanceledError,fi.all=function(t){return De.all(t)},fi.spread=function(t){return function(e){return t.apply(null,e)}},fi.isAxiosError=function(t){return we.isObject(t)&&t.isAxiosError===!0},fi.mergeConfig=cc,fi.AxiosHeaders=es,fi.formToJSON=t=>e0(we.isHTMLForm(t)?new FormData(t):t),fi.getAdapter=v0.getAdapter,fi.HttpStatusCode=e6,fi.default=fi;var bi=fi;const r6=()=>{};function Wu(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:r6};return t.promise=new De((e,r)=>{t.resolve=n=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,e(n),t.value=n)},t.reject=n=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,r(n))}}),t}const gp=new Map,Tp=new Map,Ss=new Map;let Vn=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),wr=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const I0=new DB;let rs=I0.getResult(),DE=null;function Rr(t){if(!DE){rs=I0.getResult();const e=function(c){if(c.engine.name==="Blink"&&c.browser.name!=="WeChat")return wr.CHROME;switch(c.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return wr.CHROME;case"Safari":case"Mobile Safari":return wr.SAFARI;case"Edge":return wr.EDGE;case"Firefox":return wr.FIREFOX;case"QQ":case"QQBrowser":return wr.QQ;case"Opera":return wr.OPERA;case"WeChat":return wr.WECHAT;default:return c.browser.name||""}}(rs),r=C0(rs),n=function(c){return c.os.name==="Windows"?c.os.version?c.os.name+" "+c.os.version:c.os.name:c.os.name||""}(rs),i=rs.os.version,o=C0(rs,!1),s=rs.device.type;if(!(e&&r&&n&&i))return{name:e,version:r,os:n,osVersion:i,browserVersion:o,deviceType:s};DE={name:e,version:r,os:n,osVersion:i,browserVersion:o,deviceType:s}}return DE}function C0(t){let e,r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return e=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",r?e.split(".")[0]:e}function vp(){return Rr().os}function A0(){const t=Rr();return"".concat(t.os," ").concat(t.osVersion)}function yp(){const t=Rr();return!!(rs.engine.name==="WebKit"&&t.os===Vn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==wr.SAFARI||mi()&&t.name!==wr.SAFARI)}function Ks(){return Rr().name===wr.CHROME}function ei(){return Rr().name===wr.SAFARI}function b0(){const t=Rr();if(t.name!==wr.SAFARI||!t.browserVersion)return!1;const e=t.browserVersion.split(".");return Number(e[0])>15||Number(e[0])===15&&Number(e[1])>=4}function O0(){return Rr().name===wr.EDGE}function mn(){return Rr().name===wr.FIREFOX}function mi(){return Rr().os===Vn.IOS}function md(t){const e=Rr();return!(e.name!==wr.CHROME||!e.osVersion)&&Number(e.version)>=t}function w0(t){const e=Rr();return!(e.name!==wr.CHROME||!e.osVersion)&&Number(e.version)<t}function kE(t,e,r){const n=Rr();return!(n.name!==t||!n.osVersion)&&(r?Number(n.version)>=e&&Number(n.version)<=r:Number(n.version)===e)}function LE(t){const e=Rr();return!(e.name!==wr.EDGE||!e.osVersion)&&Number(e.version)>=t}function ME(t){const e=Rr();return!(e.name!==wr.FIREFOX||!e.osVersion)&&Number(e.version)>=t}function N0(t){const e=Rr();return!(e.name!==wr.SAFARI||!e.osVersion)&&Number(e.version)>=t}function P0(t,e,r){const n=Rr();if(n.os!==Vn.IOS||!n.osVersion)return!1;const i=n.osVersion.split(".");return r?e&&Number(i[0])===t&&Number(i[1])>e||Number(i[0])>t:e?Number(i[0])===t&&Number(i[1])>=e||Number(i[0])>t:Number(i[0])>=t}function D0(t,e,r){const n=Rr();if(n.os!==Vn.IOS||!n.osVersion)return!1;const i=n.osVersion.split(".");return e&&Number(i[0])===t&&Number(i[1])<e||Number(i[0])<t}function UE(t,e,r){const n=Rr();if(n.name!==wr.SAFARI||!n.osVersion||!n.browserVersion)return!1;const i=n.browserVersion.split(".");return r?e&&Number(i[0])===t&&Number(i[1])<e||Number(i[0])<t:e?Number(i[0])===t&&Number(i[1])<=e||Number(i[0])<t:Number(i[0])<=t}function xE(t){const e=Rr();return!(e.name!==wr.OPERA||!e.osVersion)&&Number(e.version)>=t}function k0(){const t=Rr();if(t.os!==Vn.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])<14||Number(e[0])===14&&Number(e[1])<=6}function _d(){const t=Rr();if(t.os!==Vn.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15}function VE(){const t=Rr();if(t.os!==Vn.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===16}function L0(){const t=Rr();if(t.os!==Vn.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15&&Number(e[1])>=1}function ko(){return ei()&&navigator.maxTouchPoints>0}function M0(){return Rr().name===wr.WECHAT}function U0(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function jE(){const t=vp();return function(){const{deviceType:e}=Rr();return e==="mobile"||e==="tablet"}()||t===Vn.ANDROID||t===Vn.IOS||t===Vn.HARMONY_OS}function zs(){const t=Rr();return t.name!==wr.EDGE&&t.name!==wr.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Sp(){return vp()===Vn.ANDROID}function Ku(){const t=Rr();return Sp()&&(t.name===wr.CHROME||t.name===wr.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function dr(t,e,r){return(e=function(n){var i=function(o,s){if(typeof o!="object"||!o)return o;var c=o[Symbol.toPrimitive];if(c!==void 0){var d=c.call(o,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(n);return typeof i=="symbol"?i:i+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function x0(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function ve(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?x0(Object(r),!0).forEach(function(n){dr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):x0(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}let et=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),Qt=class extends Error{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(e),dr(this,"code",void 0),dr(this,"message",void 0),dr(this,"data",void 0),dr(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(e),this.data=r}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",e=arguments.length>1?arguments[1]:void 0;return t==="error"&&(e||console).error(this.toString()),t==="warning"&&(e||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function ns(t,e){if(typeof t!="boolean")throw new Qt(et.INVALID_PARAMS,"Invalid ".concat(e,": The value is of the boolean type."))}function Mn(t,e,r){if(!Ce(r).call(r,t))throw new Qt(et.INVALID_PARAMS,"".concat(e," can only be set as ").concat(JSON.stringify(r)))}function Hr(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<r||t>n||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(i){return typeof i=="number"&&i%1==0}(t))throw new Qt(et.INVALID_PARAMS,"invalid ".concat(e,": the value range is [").concat(r,", ").concat(n,"]. integer only"))}function BE(t,e){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new Qt(et.INVALID_PARAMS,"".concat(e," is not a valid ConstrainLong"));t.min!==void 0&&Hr(t.min,"".concat(e,".min"),0,1/0),t.max!==void 0&&Hr(t.max,"".concat(e,".max"),1,1/0),t.exact!==void 0&&Hr(t.exact,"".concat(e,".exact"),1,1/0),t.ideal!==void 0&&Hr(t.ideal,"".concat(e,".ideal"),1,1/0)}else Hr(t,e,1,1/0)}function qn(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new Qt(et.INVALID_PARAMS,"".concat(e||"param"," cannot be empty"));if(!V0(t,r,n,i))throw new Qt(et.INVALID_PARAMS,"Invalid ".concat(e||"string param",": Length of the string: [").concat(r,",").concat(n,"].").concat(i?" ASCII characters only.":""))}function qs(t,e){if(!Array.isArray(t))throw new Qt(et.INVALID_PARAMS,"".concat(e," should be an array"))}function _n(t){return t==null}function V0(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,n=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=r&&t.length>=e&&(!n||function(i){if(typeof i!="string")return!1;for(let o=0;o<i.length;o+=1){const s=i.charCodeAt(o);if(s<0||s>255)return!1}return!0}(t))}var zu=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(zu||{}),FE=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(FE||{});const j0=new class{constructor(){dr(this,"_clientSize",null),dr(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),dr(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),dr(this,"getStyle",t=>window.getComputedStyle(t,null)),dr(this,"checkCssVisibleProperty",t=>{var e;let r=!0;const n=this.getStyle(t),{display:i,visibility:o,opacity:s,filter:c}=n;return(i==="none"||Ce(e=["hidden","collapse"]).call(e,o)||Number(s)<.1)&&(r=!1),!!r&&(c&&c.split(" ").filter(d=>{var u;const l=d.split("(")[0];return Ce(u=["brightness","blur","opacity"]).call(u,l)}).map(d=>{const[u,l]=d.split(/\(|\)/);return[u,Number(l.match(/^[0-9\.]+/))]}).forEach(d=>{const[u,l]=d;switch(u){case"brightness":(l<.1||l>3)&&(r=!1);break;case"blur":l>3&&(r=!1);break;case"opacity":l<.1&&(r=!1)}}),r)}),dr(this,"checkPropertyUpToAllParentNodes",(t,e)=>{let r=!0,n=!0;const i=s=>e(s);let o=t;for(;o&&n;)i(o)||(r=!1,n=!1),o=o.parentElement,o||(n=!1);return r}),dr(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),dr(this,"getSizeAboutClient",t=>{const{width:e,height:r,left:n,right:i,top:o,bottom:s}=t.getBoundingClientRect(),c=this.getClientWidth(),d=this.getClientHeight();return{width:e,height:r,left:n,right:i,top:o,bottom:s,clientWidth:c,clientHeight:d,clientMin:Math.min(c,d)}}),dr(this,"checkActualSize",()=>{const{width:t,height:e,clientMin:r}=this._clientSize;return this.checkSizeIsVisible(t,e,r)}),dr(this,"elementFromPoint",(t,e)=>document.elementFromPoint?document.elementFromPoint(t,e):null),dr(this,"checkCoverForAPoint",(t,e,r)=>{const n=this.elementFromPoint(t,e);return n!==null&&n!==r}),dr(this,"getPointPositionList",()=>{const{width:t,height:e,left:r,top:n}=this._clientSize,i=t/6,o=e/6,s=[],c=10**6;for(let d=0;d<5;d++)for(let u=0;u<5;u++){const l=(r*c+(d===0?.1:d===4?(i*d*c-1e5)/c:i*d)*c)/c,T=(n*c+(u===0?.1:u===4?(o*u*c-1e5)/c:o*u)*c)/c;s.push({x:l,y:T})}return[...s]}),dr(this,"checkElementCover",t=>this.getPointPositionList().map(e=>this.checkCoverForAPoint(e.x,e.y,t)).filter(e=>!!e).length>6),dr(this,"checkSizeIsVisible",(t,e,r)=>(t>50||r/t<=10)&&(e>50||r/e<=10)),dr(this,"checkSizeOfPartInClient",()=>{const{left:t,right:e,top:r,bottom:n,clientHeight:i,clientWidth:o,clientMin:s}=this._clientSize;let c,d,u,l;if(t<0)c=0;else{if(!(t<o))return!1;c=t}if(e<0)return!1;if(d=e<o?e:o,r<0)u=0;else{if(!(r<i))return!1;u=r}if(n<0)return!1;l=n<i?n:i;const T=d-c,v=l-u;return this.checkSizeIsVisible(T,v,s)}),dr(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),dr(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(zu.COVERED);{const e=this.checkActualSize(),r=this.checkSizeOfPartInClient();return e&&!r?this.returnHiddenResult(zu.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(zu.SIZE)}}return this.returnHiddenResult(zu.STYLE)}return this.returnHiddenResult(FE.UNMOUNTED)}return this.returnHiddenResult(FE.INVALID_HTML_ELEMENT)}),dr(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,e=>e.nodeName.toUpperCase()!=="HTML"?e.parentElement!==null:!!document.documentElement))}};function GE(t){return new TextEncoder().encode(t)}const B0=function(t,e){const r=new Uint8Array(t.byteLength+e.byteLength);return r.set(new Uint8Array(t),0),r.set(new Uint8Array(e),t.byteLength),r},HE=async t=>function(e,r){let n="";return new Uint8Array(e).forEach(i=>{n+=i.toString(r).padStart(2,"0")}),n}(await crypto.subtle.digest("SHA-256",GE(t)),16);class pn{constructor(){dr(this,"_events",{}),dr(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(r=>r.listener):[]}on(e,r){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,r)===-1&&n.push({listener:r,once:!1})}once(e,r){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,r)===-1&&n.push({listener:r,once:!0})}off(e,r){if(!this._events[e])return;const n=this._events[e],i=this._indexOfListener(n,r);i!==-1&&n.splice(i,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const r=this._events[e].map(s=>s);for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];for(let s=0;s<r.length;s+=1){const c=r[s];c.once&&this.off(e,c.listener),c.listener.apply(this,i||[])}}safeEmit(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];[...this._events[e]||[]].forEach(o=>{o.once&&this.off(e,o.listener);try{o.listener.apply(this,n)}catch(s){console.error("safeEmit event:".concat(e," error ").concat(s?.toString()))}})}_indexOfListener(e,r){let n=e.length;for(;n--;)if(e[n].listener===r)return n;return-1}}let qu=null;function F0(){if(qu)return qu;if(window.electron)return qu=window.electron;if(!window.require)return null;try{return qu=window.require("electron"),qu}catch{return null}}let vn=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t.PRELOAD_MEDIA_FAILED="preloadMediaFailed",t.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",t}({}),cn=function(t){return t.TRACER="tracer",t}({});function G0(t){return Hr(t.timeout,"config.timeout",0,1e5),Hr(t.timeoutFactor,"config.timeoutFactor",0,100,!1),Hr(t.maxRetryCount,"config.maxRetryConfig",0,1/0),Hr(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let n6=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),Lr=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function Yu(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(e=>{if(!e.urls)throw Error()})}catch{return!1}return!0}function H0(t){return qn(t.turnServerURL,"turnServerURL"),qn(t.username,"username"),qn(t.password,"password"),t.udpport&&Hr(t.udpport,"udpport",1,99999,!0),t.forceturn&&ns(t.forceturn,"forceturn"),t.security&&ns(t.security,"security"),t.tcpport&&Hr(t.tcpport,"tcpport",1,99999,!0),!0}function WE(t){return t.level!==void 0&&Mn(t.level,"level",[1,2,3]),t.delay!==void 0&&Hr(t.delay,"delay",0,3e3,!0),!0}let vr=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.AUDIO_PTS="audio-pts",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),ri=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),Ki=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),Ed=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function ni(t,e){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return t.getListeners(e).length===0?De.reject(new Qt(et.UNEXPECTED_ERROR,"can not emit promise")):new De((o,s)=>{t.emit(e,...n,o,s)})}function Kr(t,e){if(t.getListeners(e).length===0)return De.resolve();for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return ni(t,e,...n)}function $i(t,e){if(t.getListeners(e).length===0)return null;for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return Xu(t,e,...n)}function Xu(t,e){let r=null,n=null;for(var i=arguments.length,o=new Array(i>2?i-2:0),s=2;s<i;s++)o[s-2]=arguments[s];if(t.emit(e,...o,c=>{r=c},c=>{n=c}),n!==null)throw n;if(r===null)throw new Qt(et.UNEXPECTED_ERROR,"handler is not sync");return r}const In=new class extends pn{set networkState(t){this.emit(Ed.NETWORK_STATE_CHANGE,t,this._networkState),t===Ki.ONLINE?this.emit(Ed.ONLINE):t===Ki.OFFLINE&&(this.onlineWaiter=new De(e=>{this.once(Ed.ONLINE,()=>{this.onlineWaiter=void 0,e(Ki.ONLINE)})}),this.emit(Ed.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===Ki.ONLINE}constructor(){super(),dr(this,"_moduleName","network-indicator"),dr(this,"_networkState",Ki.ONLINE),dr(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Ki.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Ki.OFFLINE})}};function Rp(t,e){const r=t.indexOf(e);r!==-1&&t.splice(r,1)}function gd(t){const e=[];return t.forEach(r=>{e.indexOf(r)===-1&&e.push(r)}),e}function Ip(t){De!==void 0?De.resolve().then(t):setTimeout(t,0)}function dn(t){return JSON.parse(JSON.stringify(t))}function dc(t){try{return dn(t)}catch{return t}}const W0={};function Ra(t,e){W0[e]||(W0[e]=!0,t())}function uc(t){const e=window.atob(t),r=new Uint8Array(new ArrayBuffer(e.length));for(let n=0;n<e.length;n+=1)r[n]=e.charCodeAt(n);return r}function Ia(t){let e="";for(let r=0;r<t.length;r+=1)e+=String.fromCharCode(t[r]);return window.btoa(e)}function K0(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,r=new TextEncoder().encode(t);if(r.length>e)r=r.slice(0,e);else if(r.length<e){const n=new Uint8Array(e);n.set(r),r=n}return r}function z0(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];const n=Ao(e).call(e,(s,c)=>s+c.length,0),i=new Uint8Array(new ArrayBuffer(n));let o=0;return e.forEach(s=>{i.set(s,o),o+=s.length}),i}function Rs(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function q0(t){let e=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(r=>{e+=typeof r=="string"?Rs(r):r.size}),e+138}function i6(t){const e=new Qt(et.TIMEOUT,"timeout");return new De((r,n)=>{window.setTimeout(()=>n(e),t)})}function Yn(t){return new De(e=>{window.setTimeout(e,t)})}function zr(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,e=arguments.length>1?arguments[1]:void 0;const r=Math.random().toString(16).substr(2,t).toLowerCase();return r.length===t?"".concat(e).concat(r):"".concat(e).concat(r)+zr(t-r.length,"")}function lc(){return zr(32,"").toUpperCase()}const Cp=()=>{},Y0=new class{constructor(){dr(this,"fnMap",new Map)}throttleByKey(t,e,r,n){for(var i=arguments.length,o=new Array(i>4?i-4:0),s=4;s<i;s++)o[s-4]=arguments[s];if(this.fnMap.has(e)){const c=this.fnMap.get(e);if(c.threshold!==r){c.fn(...c.args),clearTimeout(c.timer);const d=window.setTimeout(()=>{const u=this.fnMap.get(e);u&&u.fn(...u.args),this.fnMap.delete(e)},r);this.fnMap.set(e,{fn:t,threshold:r,timer:d,args:o,skipFn:n})}else c.skipFn&&c.skipFn(...c.args),this.fnMap.set(e,ve(ve({},c),{},{fn:t,args:o,skipFn:n}))}else{const c=window.setTimeout(()=>{const d=this.fnMap.get(e);d&&d.fn(...d.args),this.fnMap.delete(e)},r);this.fnMap.set(e,{fn:t,threshold:r,timer:c,args:o,skipFn:n})}}},X0=Y0.throttleByKey.bind(Y0);function J0(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function KE(t,e){if(!J0(t)||!J0(e)||Array.isArray(t)&&!Array.isArray(e)||!Array.isArray(t)&&Array.isArray(e))return e;if(Array.isArray(e)&&Array.isArray(t)){const r=[...t];for(let n=0;n<e.length;n++)r[n]=KE(t[n],e[n]);return r}{const r=ve({},t);for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(Object.prototype.hasOwnProperty.call(t,n)?r[n]=KE(t[n],e[n]):r[n]=e[n]);return r}}function Z0(t,e){let r=[0];if(r=new Array(e).fill(0),t===0)return r;let n=0;for(;t>0&&(r[n]=255&t,t>>=8,n++,n!==e););return r}function Td(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function zE(t){return Ao(t).call(t,(e,r)=>e+r,0)}function Q0(t){const e="0123456789abcdef";function r(at){let Rt,vt="";for(Rt=0;Rt<=3;Rt++)vt+=e.charAt(at>>8*Rt+4&15)+e.charAt(at>>8*Rt&15);return vt}function n(at,Rt){const vt=(65535&at)+(65535&Rt);return(at>>16)+(Rt>>16)+(vt>>16)<<16|65535&vt}function i(at,Rt,vt,pt,kt,$t){return n(function(se,Te){return se<<Te|se>>>32-Te}(n(n(Rt,at),n(pt,$t)),kt),vt)}function o(at,Rt,vt,pt,kt,$t,se){return i(Rt&vt|~Rt&pt,at,Rt,kt,$t,se)}function s(at,Rt,vt,pt,kt,$t,se){return i(Rt&pt|vt&~pt,at,Rt,kt,$t,se)}function c(at,Rt,vt,pt,kt,$t,se){return i(Rt^vt^pt,at,Rt,kt,$t,se)}function d(at,Rt,vt,pt,kt,$t,se){return i(vt^(Rt|~pt),at,Rt,kt,$t,se)}const u=function(at){let Rt;const vt=1+(at.length+8>>6),pt=new Array(16*vt);for(Rt=0;Rt<16*vt;Rt++)pt[Rt]=0;for(Rt=0;Rt<at.length;Rt++)pt[Rt>>2]|=at.charCodeAt(Rt)<<Rt%4*8;return pt[Rt>>2]|=128<<Rt%4*8,pt[16*vt-2]=8*at.length,pt}(t);let l,T,v,y,x,N=1732584193,L=-271733879,Q=-1732584194,J=271733878;for(l=0;l<u.length;l+=16)T=N,v=L,y=Q,x=J,N=o(N,L,Q,J,u[l+0],7,-680876936),J=o(J,N,L,Q,u[l+1],12,-389564586),Q=o(Q,J,N,L,u[l+2],17,606105819),L=o(L,Q,J,N,u[l+3],22,-1044525330),N=o(N,L,Q,J,u[l+4],7,-176418897),J=o(J,N,L,Q,u[l+5],12,1200080426),Q=o(Q,J,N,L,u[l+6],17,-1473231341),L=o(L,Q,J,N,u[l+7],22,-45705983),N=o(N,L,Q,J,u[l+8],7,1770035416),J=o(J,N,L,Q,u[l+9],12,-1958414417),Q=o(Q,J,N,L,u[l+10],17,-42063),L=o(L,Q,J,N,u[l+11],22,-1990404162),N=o(N,L,Q,J,u[l+12],7,1804603682),J=o(J,N,L,Q,u[l+13],12,-40341101),Q=o(Q,J,N,L,u[l+14],17,-1502002290),L=o(L,Q,J,N,u[l+15],22,1236535329),N=s(N,L,Q,J,u[l+1],5,-165796510),J=s(J,N,L,Q,u[l+6],9,-1069501632),Q=s(Q,J,N,L,u[l+11],14,643717713),L=s(L,Q,J,N,u[l+0],20,-373897302),N=s(N,L,Q,J,u[l+5],5,-701558691),J=s(J,N,L,Q,u[l+10],9,38016083),Q=s(Q,J,N,L,u[l+15],14,-660478335),L=s(L,Q,J,N,u[l+4],20,-405537848),N=s(N,L,Q,J,u[l+9],5,568446438),J=s(J,N,L,Q,u[l+14],9,-1019803690),Q=s(Q,J,N,L,u[l+3],14,-187363961),L=s(L,Q,J,N,u[l+8],20,1163531501),N=s(N,L,Q,J,u[l+13],5,-1444681467),J=s(J,N,L,Q,u[l+2],9,-51403784),Q=s(Q,J,N,L,u[l+7],14,1735328473),L=s(L,Q,J,N,u[l+12],20,-1926607734),N=c(N,L,Q,J,u[l+5],4,-378558),J=c(J,N,L,Q,u[l+8],11,-2022574463),Q=c(Q,J,N,L,u[l+11],16,1839030562),L=c(L,Q,J,N,u[l+14],23,-35309556),N=c(N,L,Q,J,u[l+1],4,-1530992060),J=c(J,N,L,Q,u[l+4],11,1272893353),Q=c(Q,J,N,L,u[l+7],16,-155497632),L=c(L,Q,J,N,u[l+10],23,-1094730640),N=c(N,L,Q,J,u[l+13],4,681279174),J=c(J,N,L,Q,u[l+0],11,-358537222),Q=c(Q,J,N,L,u[l+3],16,-722521979),L=c(L,Q,J,N,u[l+6],23,76029189),N=c(N,L,Q,J,u[l+9],4,-640364487),J=c(J,N,L,Q,u[l+12],11,-421815835),Q=c(Q,J,N,L,u[l+15],16,530742520),L=c(L,Q,J,N,u[l+2],23,-995338651),N=d(N,L,Q,J,u[l+0],6,-198630844),J=d(J,N,L,Q,u[l+7],10,1126891415),Q=d(Q,J,N,L,u[l+14],15,-1416354905),L=d(L,Q,J,N,u[l+5],21,-57434055),N=d(N,L,Q,J,u[l+12],6,1700485571),J=d(J,N,L,Q,u[l+3],10,-1894986606),Q=d(Q,J,N,L,u[l+10],15,-1051523),L=d(L,Q,J,N,u[l+1],21,-2054922799),N=d(N,L,Q,J,u[l+8],6,1873313359),J=d(J,N,L,Q,u[l+15],10,-30611744),Q=d(Q,J,N,L,u[l+6],15,-1560198380),L=d(L,Q,J,N,u[l+13],21,1309151649),N=d(N,L,Q,J,u[l+4],6,-145523070),J=d(J,N,L,Q,u[l+11],10,-1120210379),Q=d(Q,J,N,L,u[l+2],15,718787259),L=d(L,Q,J,N,u[l+9],21,-343485551),N=n(N,T),L=n(L,v),Q=n(Q,y),J=n(J,x);return r(N)+r(L)+r(Q)+r(J)}let o6=1,$0=console,si=class{static setLogger(t){$0=t}constructor(t,e){dr(this,"id",void 0),dr(this,"lockingPromise",De.resolve()),dr(this,"locks",0),dr(this,"name",""),dr(this,"lockId",void 0),this.lockId=o6++,t&&(this.name=t),e&&(this.id=e),this.logger("created")}logger(t,e){const r=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),n=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(e??"");$0.debug("".concat(r," ").concat(n))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let e;this.locks+=1,this.logger("locked",t);const r=new De(i=>{e=()=>{this.locks-=1,this.logger("unlocked",t),i()}}),n=this.lockingPromise.then(()=>e);return this.lockingPromise=this.lockingPromise.then(()=>r),n}};function vd(t,e){return function(r,n,i){const o=i.value;if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const s=this[e];if(!s)throw new Error("mutex property key ".concat(e," doesn't exist on ").concat(t));const c=await s.lock("From ".concat(t,".").concat(n));try{for(var d=arguments.length,u=new Array(d),l=0;l<d;l++)u[l]=arguments[l];return await o.apply(this,u)}finally{c()}},i}}const bn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function qE(t,e){const r=Math.floor(e.timeout*Math.pow(e.timeoutFactor,t));return Math.min(e.maxRetryTimeout,r)}function is(t,e,r,n){const i=Object.assign({},bn,n);let o=i.timeout;const s=async()=>{await function(u){return new De(l=>{window.setTimeout(l,u)})}(o),o*=i.timeoutFactor,o=Math.min(i.maxRetryTimeout,o)};let c=!1;const d=new De(async(u,l)=>{e=e||(()=>!1),r=r||(()=>!0);for(let T=0;T<i.maxRetryCount;T+=1){if(c)return l(new Qt(et.OPERATION_ABORTED));try{const v=await t();if(!e(v,T)||T+1===i.maxRetryCount)return u(v);await s()}catch(v){if(!r(v,T)||T+1===i.maxRetryCount)return l(v);await s()}}});return d.cancel=()=>c=!0,d}let Ap,tA=class{constructor(t){dr(this,"input",[]),dr(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:Ao(t=this.input).call(t,(e,r)=>e+r)/this.input.length}},bp=0,YE=0;function XE(t,e,r,n){return new De((i,o)=>{e.responseType=e.responseType||"json",e.data&&!r?(e.data=JSON.stringify(e.data),bp+=Rs(e.data)):r&&(e.data.size?bp+=e.data.size:e.data instanceof FormData?bp+=q0(e.data):bp+=Rs(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,bi.request(e).then(s=>{typeof s.data=="string"?YE+=Rs(s.data):s.data instanceof ArrayBuffer||s.data instanceof Uint8Array?YE+=s.data.byteLength:YE+=Rs(JSON.stringify(s.data)),i(s.data)}).catch(s=>{bi.isCancel(s)?o(new Qt(et.OPERATION_ABORTED,"cancel token canceled")):s.code==="ECONNABORTED"?o(new Qt(et.NETWORK_TIMEOUT,s.message)):s.response?o(new Qt(et.NETWORK_RESPONSE_ERROR,s.response.status)):o(new Qt(et.NETWORK_ERROR,s.message))})})}async function s6(t,e){const r=new Blob([e.data],{type:"buffer"});return await XE(t,ve(ve({},e),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}const eA=()=>window.isSecureContext!==void 0;function Lo(t){if(Array.isArray(t))return t.map(r=>r);if(!rA(t))return t;const e={};for(const r in t){const n=t[r];rA(n)||Array.isArray(n)?e[r]=Lo(n):e[r]=n}return e}function rA(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let JE=class{constructor(t){dr(this,"input",[]),dr(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Is={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Ju={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Is,remoteCandidate:Is},updateInterval:0},nA={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},iA={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},oA={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},sA={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let ZE=class{constructor(t,e){dr(this,"onFirstVideoReceived",void 0),dr(this,"onFirstVideoDecoded",void 0),dr(this,"onFirstAudioReceived",void 0),dr(this,"onFirstVideoDecodedTimeout",void 0),dr(this,"onFirstAudioDecoded",void 0),dr(this,"onSelectedLocalCandidateChanged",void 0),dr(this,"onSelectedRemoteCandidateChanged",void 0),dr(this,"videoIsReady",!1),dr(this,"videoIsReady2",{}),dr(this,"pc",void 0),dr(this,"options",void 0),dr(this,"intervalTimer",void 0),dr(this,"stats",Lo(Ju)),dr(this,"isFirstVideoReceived",{}),dr(this,"isFirstVideoDecoded",{}),dr(this,"isFirstAudioReceived",{}),dr(this,"isFirstAudioDecoded",{}),dr(this,"isFirstVideoDecodedTimeout",{}),dr(this,"lossRateWindowStats",[]),this.pc=t,this.options=e,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new De(t=>{t({local:ve({},Is),remote:ve({},Is)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,e){this.videoIsReady2[t]=e}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const e=this.lossRateWindowStats.length,r=["videoSend","audioSend","videoRecv","audioRecv"];let n=0,i=0,o=0,s=0;for(const c of r)t[c].forEach((d,u)=>{if(!this.lossRateWindowStats[e-1][c][u]||!this.lossRateWindowStats[0][c][u])return;const l=this.lossRateWindowStats[e-1][c][u].packets-this.lossRateWindowStats[0][c][u].packets,T=this.lossRateWindowStats[e-1][c][u].packetsLost-this.lossRateWindowStats[0][c][u].packetsLost;c==="videoSend"||c==="audioSend"?(n+=l,o+=T):(i+=l,s+=T),Number.isNaN(l)||Number.isNaN(l)?d.packetLostRate=0:d.packetLostRate=l<=0||T<=0?0:T/(l+T)});t.sendPacketLossRate=n<=0||o<=0?0:o/(n+o),t.recvPacketLossRate=i<=0||s<=0?0:s/(i+s)}},a6=class extends ZE{constructor(){super(...arguments),dr(this,"_stats",Ju),dr(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),e=this.statsResponsesToObjects(t);this._stats=Lo(Ju);const r=e.filter(i=>i.type==="ssrc");this.processSSRCStats(r);const n=e.find(i=>i.type==="VideoBwe");n&&this.processBandwidthStats(n),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(e=>{var r;const n=Ce(r=e.id).call(r,"send");switch("".concat(e.mediaType,"_").concat(n?"send":"recv")){case"video_send":{const i=Lo(iA);i.codec=e.googCodecName,i.adaptionChangeReason="none",e.googCpuLimitedResolution&&(i.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(i.adaptionChangeReason="bandwidth"),i.avgEncodeMs=Number(e.googAvgEncodeMs),i.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},i.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},i.firsCount=Number(e.googFirReceived),i.nacksCount=Number(e.googNacksReceived),i.plisCount=Number(e.googPlisReceived),i.frameCount=Number(e.framesEncoded),i.bytes=Number(e.bytesSent),i.packets=Number(e.packetsSent),i.packetsLost=Number(e.packetsLost),i.ssrc=Number(e.ssrc),i.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(i),this._stats.rtt=i.rttMs;break}case"video_recv":{const i=Lo(nA),o=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(i.codec=e.googCodecName,i.targetDelayMs=Number(e.googTargetDelayMs),i.renderDelayMs=Number(e.googRenderDelayMs),i.currentDelayMs=Number(e.googCurrentDelayMs),i.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),i.decodeMs=Number(e.googDecodeMs),i.maxDecodeMs=Number(e.googMaxDecodeMs),i.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},i.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},i.decodeFrameRate=Number(e.googFrameRateDecoded),i.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},i.jitterBufferMs=Number(e.googJitterBufferMs),i.firsCount=Number(e.googFirsSent),i.nacksCount=Number(e.googNacksSent),i.plisCount=Number(e.googPlisSent),i.framesDecodeCount=Number(e.framesDecoded),i.bytes=Number(e.bytesReceived),i.packets=Number(e.packetsReceived),i.packetsLost=Number(e.packetsLost),i.ssrc=Number(e.ssrc),i.packets>0&&!this.isFirstVideoReceived[i.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(i.ssrc),this.isFirstVideoReceived[i.ssrc]=!0),i.framesDecodeCount>0&&!this.isFirstVideoDecoded[i.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(i.ssrc,i.decodedFrame.width,i.decodedFrame.height),this.isFirstVideoDecoded[i.ssrc]=!0),o){const s=o.stats,c=Date.now()-o.lts;i.framesDecodeFreezeTime=s.framesDecodeFreezeTime,i.framesDecodeInterval=s.framesDecodeInterval,i.framesDecodeCount>s.framesDecodeCount&&this.isFirstVideoDecoded[i.ssrc]?(o.lts=Date.now(),i.framesDecodeInterval=c,i.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?i.framesDecodeFreezeTime+=i.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):i.framesDecodeCount<o.stats.framesDecodeCount&&(i.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(i.ssrc,{stats:ve({},i),lts:Date.now()}),this._stats.videoRecv.push(i);break}case"audio_recv":{const i=Lo(sA);i.codec=e.googCodecName,i.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,i.decodingCNG=Number(e.googDecodingCNG),i.decodingCTN=Number(e.googDecodingCTN),i.decodingCTSG=Number(e.googDecodingCTSG),i.decodingNormal=Number(e.googDecodingNormal),i.decodingPLC=Number(e.googDecodingPLC),i.decodingPLCCNG=Number(e.googDecodingPLCCNG),i.expandRate=Number(e.googExpandRate),i.accelerateRate=Number(e.googAccelerateRate),i.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),i.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),i.speechExpandRate=Number(e.googSpeechExpandRate),i.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),i.jitterBufferMs=Number(e.googJitterBufferMs),i.jitterMs=Number(e.googJitterReceived),i.bytes=Number(e.bytesReceived),i.packets=Number(e.packetsReceived),i.packetsLost=Number(e.packetsLost),i.ssrc=Number(e.ssrc),i.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),i.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),i.receivedFrames>0&&!this.isFirstAudioReceived[i.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(i.ssrc),this.isFirstAudioReceived[i.ssrc]=!0),i.decodingNormal>0&&!this.isFirstAudioDecoded[i.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(i.ssrc),this.isFirstAudioDecoded[i.ssrc]=!0),this._stats.audioRecv.push(i);break}case"audio_send":{const i=Lo(oA);i.codec=e.googCodecName,i.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,i.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),i.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),i.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),i.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),i.bytes=Number(e.bytesSent),i.packets=Number(e.packetsSent),i.packetsLost=Number(e.packetsLost),i.ssrc=Number(e.ssrc),i.rttMs=Number(e.googRtt||0),this._stats.rtt=i.rttMs,this._stats.audioSend.push(i);break}}})}_getStats(){return new De((t,e)=>{this.pc.getStats(t,e)})}statsResponsesToObjects(t){const e=[];return t.result().forEach(r=>{const n={id:r.id,timestamp:r.timestamp.valueOf().toString(),type:r.type};r.names().forEach(i=>{n[i]=r.stat(i)}),e.push(n)}),e}},Zu=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),Op=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),QE=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),to=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var yd=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(yd||{});function Qu(t,e,r,n){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:yd.kNone;if(!e)return;const o=Number(e[r]);if(typeof o!="number")return;const s=Number(e[n]);if(typeof s!="number")return;if(!t)return s?o/s*i:void 0;const c=Number(t[r]);if(typeof c!="number")return;const d=Number(t[n]);if(typeof d!="number")return;const u=s-d;return u?(o-c)/u*i:void 0}let aA=class extends ZE{constructor(){super(...arguments),dr(this,"_stats",Ju),dr(this,"report",void 0),dr(this,"lastDecodeVideoReceiverStats",new Map),dr(this,"lastVideoFramesRecv",new Map),dr(this,"lastVideoFramesSent",new Map),dr(this,"lastVideoFramesDecode",new Map),dr(this,"lastVideoFramesOutput",new Map),dr(this,"lastVideoJBDelay",new Map),dr(this,"lastAudioJBDelay",new Map),dr(this,"mediaBytesSent",new Map),dr(this,"mediaBytesRetransmit",new Map),dr(this,"mediaBytesTargetEncode",new Map),dr(this,"lastDecodeAudioReceiverStats",new Map),dr(this,"lastAudioConcealment",new Map),dr(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Lo(Ju),this.report.forEach(t=>{switch(t.type){case to.OUTBOUND:case to.INBOUND:{const e=t.mediaType||t.kind,r=!e&&"frameWidth"in t,n=!e&&!("frameWidth"in t);t.type===to.OUTBOUND?e==="audio"||n?this.processAudioOutboundStats(t):(e==="video"||r)&&this.processVideoOutboundStats(t):t.type===to.INBOUND&&(e==="audio"||n?this.processAudioInboundStats(t):(e==="video"||r)&&this.processVideoInboundStats(t));break}case to.TRANSPORT:{const e=this.report.get(t.selectedCandidatePairId);e&&this.processCandidatePairStats(e);break}case to.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),e={local:ve({},Is),remote:ve({},Is)};return t.forEach(r=>{let n;if(r.type===to.TRANSPORT&&(n=t.get(r.selectedCandidatePairId)),r.type===to.CANDIDATE_PAIR&&r.selected&&(n=r),n){const i=(o,s)=>{o.type=s.type,o.id=s.id,s.address&&(o.address=s.address),s.candidateType&&(o.candidateType=s.candidateType),s.port&&(o.port=s.port),s.priority&&(o.priority=s.priority),s.protocol&&(o.protocol=s.protocol),s.relayProtocol&&(o.relayProtocol=s.relayProtocol)};if(n.localCandidateId){const o=t.get(n.localCandidateId);o&&i(e.local,o)}if(n.remoteCandidateId){const o=t.get(n.remoteCandidateId);o&&i(e.remote,o)}}}),e}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const e=this.report.get(t.localCandidateId);e&&this.processCandidateStats(e)}if(t.remoteCandidateId){const e=this.report.get(t.remoteCandidateId);e&&this.processCandidateStats(e)}}processCandidateStats(t){let e;t.type===to.LOCAL_CANDIDATE&&(e=this._stats.selectedCandidatePair.localCandidate),t.type===to.REMOTE_CANDIDATE&&(e=this._stats.selectedCandidatePair.remoteCandidate),e&&(e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol),t.type===to.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==e.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(ve({},e),ve({},this.stats.selectedCandidatePair.localCandidate)),t.type===to.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==e.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(ve({},e),ve({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let e=this._stats.audioRecv.find(n=>n.ssrc===t.ssrc);e||(e=Lo(sA),this._stats.audioRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.packetsDiscarded=t.packetsDiscarded,e.bytes=t.bytesReceived,e.jitterMs=1e3*t.jitter,e.retransmittedBytesReceived=t.retransmittedBytesReceived,e.retransmittedPacketsReceived=t.retransmittedPacketsReceived,e.totalProcessingDelay=t.totalProcessingDelay,e.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const r=this.lastDecodeAudioReceiverStats.get(e.ssrc);e.avgProcessingDelayMs=Qu(r,e,"totalProcessingDelay","jitterBufferEmittedCount",yd.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,e),this.calculateAudioFreeze(e,r,t),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),e.receivedFrames||(e.receivedFrames=t.packetsReceived),e.droppedFrames||(e.droppedFrames=t.packetsLost),e.receivedFrames>0&&!this.isFirstAudioReceived[e.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(e.ssrc),this.isFirstAudioReceived[e.ssrc]=!0),e.outputLevel&&e.outputLevel>0&&!this.isFirstAudioDecoded[e.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(e.ssrc),this.isFirstAudioDecoded[e.ssrc]=!0),typeof t.concealedSamples=="number"&&(e.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(e.ssrc,ve({},e))}calculateAudioFreeze(t,e,r){const n=this.lastAudioConcealment.get(t.ssrc);if(e!=null&&n!=null){const i=n.lts,o=r.timestamp,s=o-i;if(s<=0)return;const c=t.concealedSamples-e.concealedSamples-0,d=n.nonSilent+c,u=t.totalSamplesReceived-e.totalSamplesReceived;if(u<=0)return;const l=80*u/s,T=200*u/s,v=s/u;let y=0;t.freezeSamples80=e.freezeSamples80,t.freezeMs80=e.freezeMs80,d>l&&(n.plc80>0?(t.freezeSamples80+=c,t.freezeMs80+=Math.round(c*v)):(t.freezeSamples80+=d,t.freezeMs80+=Math.round(d*v)),y=n.plc80+1);let x=0;t.freezeSamples200=e.freezeSamples200,t.freezeMs200=e.freezeMs200,d>T&&(n.plc200>0?(t.freezeSamples200+=c,t.freezeMs200+=Math.round(c*v)):(t.freezeSamples200+=d,t.freezeMs200+=Math.round(d*v)),x=n.plc200+1),this.lastAudioConcealment.set(t.ssrc,{nonSilent:c,lts:o,plc80:y,plc200:x})}else t.freezeSamples80=0,t.freezeSamples200=0,t.freezeMs80=0,t.freezeMs200=0,this.lastAudioConcealment.set(t.ssrc,{nonSilent:0,lts:r.timestamp,plc80:0,plc200:0})}processVideoInboundStats(t){let e=this._stats.videoRecv.find(s=>s.ssrc===t.ssrc);e||(e=Lo(nA),this._stats.videoRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.bytes=t.bytesReceived,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.framesDecodeCount=t.framesDecoded,e.framesDroppedCount=t.framesDropped,e.totalInterFrameDelay=t.totalInterFrameDelay,e.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,e.totalFreezesDuration=t.totalFreezesDuration,e.totalProcessingDelay=t.totalProcessingDelay,e.packetsDiscarded=t.packetsDiscarded,e.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,e.totalAssemblyTime=t.totalAssemblyTime,e.keyFramesDecoded=t.keyFramesDecoded,e.retransmittedBytesReceived=t.retransmittedBytesReceived,e.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const r=this.lastDecodeVideoReceiverStats.get(e.ssrc),n=this.lastVideoFramesDecode.get(e.ssrc),i=this.lastVideoFramesOutput.get(e.ssrc),o=Date.now();if(e.framesDecodeCount>0&&!this.isFirstVideoDecoded[e.ssrc]){const s=e.decodedFrame?e.decodedFrame.width:0,c=e.decodedFrame?e.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(e.ssrc,s,c),this.isFirstVideoDecoded[e.ssrc]=!0}if(r){const s=r.stats,c=o-r.lts;e.framesDecodeFreezeTime=s.framesDecodeFreezeTime,e.framesDecodeInterval=s.framesDecodeInterval,!this.isFirstVideoDecoded[e.ssrc]&&c>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[e.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(e.ssrc),this.isFirstVideoDecodedTimeout[e.ssrc]=!0),e.framesDecodeCount>s.framesDecodeCount&&this.isFirstVideoDecoded[e.ssrc]?(r.lts=Date.now(),e.framesDecodeInterval=c,e.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?e.framesDecodeFreezeTime+=e.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):e.framesDecodeCount<s.framesDecodeCount&&(e.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(r.stats.framesDecodeCount>t.framesDecoded?e.qpSumPerFrame=t.qpSum/t.framesDecoded:e.qpSumPerFrame=(t.qpSum-r.qpSum)/(t.framesDecoded-r.stats.framesDecodeCount))}t.totalDecodeTime&&(e.decodeMs=1e3*t.totalDecodeTime,e.avgDecodeMs=Qu(r?.stats,e,"decodeMs","framesDecodeCount")),e.avgProcessingDelayMs=Qu(r?.stats,e,"totalProcessingDelay","framesDecodeCount",yd.kMillisecondsFromSeconds),e.avgFramesAssembledFromMultiplePacketsMs=Qu(r?.stats,e,"totalAssemblyTime","framesAssembledFromMultiplePackets",yd.kMillisecondsFromSeconds),e.avgInterFrameDelayMs=Qu(r?.stats,e,"totalInterFrameDelay","framesDecodeCount",yd.kMillisecondsFromSeconds),n&&o-n.lts>=800?(e.decodeFrameRate=Math.round((e.framesDecodeCount-n.count)/((o-n.lts)/1e3)),this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:o,rate:e.decodeFrameRate})):n?e.decodeFrameRate=n.rate:this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:o,rate:0}),e.framesDroppedCount&&t.framesReceived&&(i&&o-i.lts>=800?(e.outputFrameRate=Math.round((t.framesReceived-e.framesDroppedCount-i.count)/((o-i.lts)/1e3)),this.lastVideoFramesOutput.set(e.ssrc,{count:t.framesReceived-e.framesDroppedCount,lts:o,rate:Math.max(e.outputFrameRate,0)})):i?e.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(e.ssrc,{count:t.framesReceived-e.framesDroppedCount,lts:o,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(e.framesRateFirefox=t.framerateMean),e.packets>0&&!this.isFirstVideoReceived[e.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(e.ssrc),this.isFirstVideoReceived[e.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(e.ssrc,{stats:ve({},e),lts:r?r.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let e=this._stats.videoSend.find(n=>n.ssrc===t.ssrc);e||(e=Lo(iA),this._stats.videoSend.push(e));const r=this.mediaBytesSent.get(t.ssrc);if(r)r.add(t.bytesSent);else{const n=new JE(10);n.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,n)}if(t.retransmittedBytesSent!==void 0){const n=this.mediaBytesRetransmit.get(t.ssrc);if(n)n.add(t.retransmittedBytesSent);else{const i=new JE(10);i.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,i)}}if(t.totalEncodedBytesTarget){const n=this.mediaBytesTargetEncode.get(t.ssrc);if(n)n.add(t.totalEncodedBytesTarget);else{const i=new JE(10);i.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,i)}}if(e.ssrc=t.ssrc,e.bytes=t.bytesSent,e.packets=t.packetsSent,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.frameCount=t.framesEncoded,e.adaptionChangeReason=t.qualityLimitationReason,e.scalabilityMode=t.scalabilityMode,e.retransmittedBytesSent=t.retransmittedBytesSent,e.retransmittedPacketsSent=t.retransmittedPacketsSent,e.hugeFramesSent=t.hugeFramesSent,e.keyFramesEncoded=t.keyFramesEncoded,e.targetBitrate=t.targetBitrate,t.totalEncodeTime&&t.framesEncoded){const n=this.lastEncoderMs.get(t.ssrc);if(!n||n.lastFrameCount>t.framesEncoded)e.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const i=t.framesEncoded-n.lastFrameCount,o=t.totalEncodeTime-n.lastEncoderTime;e.avgEncodeMs=1e3*o/i}}if(t.framesEncoded&&t.qpSum){const n=this.lastEncoderMs.get(t.ssrc);!n||n.lastFrameCount>t.framesEncoded?e.qpSumPerFrame=t.qpSum/t.framesEncoded:e.qpSumPerFrame=(t.qpSum-n.lastQpSum)/(t.framesEncoded-n.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,e),this.processVideoTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const n=this.findRemoteStatsId(t.ssrc,to.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,e)}}processAudioOutboundStats(t){let e=this._stats.audioSend.find(r=>r.ssrc===t.ssrc);if(e||(e=Lo(oA),this._stats.audioSend.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsSent,e.bytes=t.bytesSent,e.retransmittedBytesSent=t.retransmittedBytesSent,e.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const r=this.findRemoteStatsId(t.ssrc,to.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,e)}}findRemoteStatsId(t,e){var r;const n=Array.from(Gi(r=this.report).call(r)).find(i=>i.type===e&&i.ssrc===t);return n?n.id:null}processVideoMediaSource(t,e){const r=this.report.get(t);r&&r.width&&r.height&&r.framesPerSecond&&(e.inputFrame={width:r.width,height:r.height,frameRate:r.framesPerSecond})}processAudioMediaSource(t,e){const r=this.report.get(t);r&&(e.inputLevel=r.audioLevel)}processVideoTrackSenderStats(t,e,r){var n,i,o,s;const c=e?this.report.get(e):void 0,d=(n=c?.framesSent)!==null&&n!==void 0?n:t.framesSent;if(typeof d!="number")return;let u=(i=c?.frameWidth)!==null&&i!==void 0?i:t.frameWidth,l=(o=c?.frameHeight)!==null&&o!==void 0?o:t.frameHeight,T=(s=c?.framesPerSecond)!==null&&s!==void 0?s:t.framesPerSecond;if(typeof u=="number"&&typeof l=="number"||(u=0,l=0),T==null){const v=Date.now(),y=this.lastVideoFramesSent.get(r.ssrc);y&&v-y.lts>=800?(T=Math.round((d-y.count)/((v-y.lts)/1e3)),this.lastVideoFramesSent.set(r.ssrc,{count:d,lts:v,rate:T})):y?T=y.rate:this.lastVideoFramesSent.set(r.ssrc,{count:d,lts:v,rate:0})}r.sentFrame={width:u,height:l,frameRate:Math.max(0,T)}}processVideoTrackReceiverStats(t,e,r){var n,i,o,s,c;const d=e?this.report.get(e):void 0,u=(n=d?.framesReceived)!==null&&n!==void 0?n:t.framesReceived,l=(i=d?.frameWidth)!==null&&i!==void 0?i:t.frameWidth,T=(o=d?.frameHeight)!==null&&o!==void 0?o:t.frameHeight,v=(s=d?.jitterBufferDelay)!==null&&s!==void 0?s:t.jitterBufferDelay,y=(c=d?.jitterBufferEmittedCount)!==null&&c!==void 0?c:t.jitterBufferEmittedCount;if(typeof u=="number"){const x=this.lastVideoFramesRecv.get(r.ssrc),N=Date.now();r.framesReceivedCount=u;let L=0;x&&N-x.lts>=800?(L=Math.round((u-x.count)/((N-x.lts)/1e3)),this.lastVideoFramesRecv.set(r.ssrc,{count:u,lts:N,rate:L})):x?L=x.rate:this.lastVideoFramesRecv.set(r.ssrc,{count:u,lts:N,rate:0}),r.receivedFrame={width:l||0,height:T||0,frameRate:L||0},r.decodedFrame={width:l||0,height:T||0,frameRate:r.decodeFrameRate||0},r.outputFrame={width:l||0,height:T||0,frameRate:r.outputFrameRate||r.decodeFrameRate||0}}if(v&&y){const x=this.lastVideoJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let N=x.jitterBufferMs;const L=y-x.jitterBufferEmittedCount;L>0&&(N=1e3*(v-x.jitterBufferDelay)/L),r.jitterBufferMs=N,r.currentDelayMs=Math.round(N),this.lastVideoJBDelay.set(r.ssrc,{jitterBufferDelay:v,jitterBufferEmittedCount:y,jitterBufferMs:r.currentDelayMs})}}processAudioTrackSenderStats(t,e,r){var n,i,o,s;const c=e?this.report.get(e):void 0,d=(n=(i=c?.echoReturnLoss)!==null&&i!==void 0?i:t.echoReturnLoss)!==null&&n!==void 0?n:0,u=(o=(s=c?.echoReturnLossEnhancement)!==null&&s!==void 0?s:t.echoReturnLossEnhancement)!==null&&o!==void 0?o:0;r.aecReturnLoss=d,r.aecReturnLossEnhancement=u}processAudioTrackReceiverStats(t,e,r){var n,i,o,s,c,d,u,l,T;const v=e?this.report.get(e):void 0,y=(n=v?.removedSamplesForAcceleration)!==null&&n!==void 0?n:t.removedSamplesForAcceleration,x=(i=v?.totalSamplesReceived)!==null&&i!==void 0?i:t.totalSamplesReceived,N=(o=v?.jitterBufferDelay)!==null&&o!==void 0?o:t.jitterBufferDelay,L=(s=v?.jitterBufferEmittedCount)!==null&&s!==void 0?s:t.jitterBufferEmittedCount,Q=(c=v?.audioLevel)!==null&&c!==void 0?c:t?.audioLevel,J=(d=v?.totalSamplesDuration)!==null&&d!==void 0?d:t?.totalSamplesDuration,at=(u=v?.concealedSamples)!==null&&u!==void 0?u:t.concealedSamples,Rt=(l=v?.silentConcealedSamples)!==null&&l!==void 0?l:t.silentConcealedSamples,vt=(T=v?.concealmentEvents)!==null&&T!==void 0?T:t.concealmentEvents;if(typeof x=="number"&&(r.totalSamplesReceived=x),typeof Rt=="number"&&(r.silentConcealedSamples=Rt),typeof vt=="number"&&(r.concealmentEvents=vt),typeof at=="number"&&(r.concealedSamples=at),y&&x&&(r.accelerateRate=y/x),N&&L){const kt=this.lastAudioJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let $t=kt.jitterBufferMs;const se=L-kt.jitterBufferEmittedCount;se>0&&($t=1e3*(N-kt.jitterBufferDelay)/se),r.jitterBufferMs=Math.round($t),this.lastAudioJBDelay.set(r.ssrc,{jitterBufferDelay:N,jitterBufferEmittedCount:L,jitterBufferMs:r.jitterBufferMs})}r.outputLevel=Q;let pt=1920;J&&x&&(pt=x/J/50,r.receivedFrames=Math.round(x/pt)),at&&(r.droppedFrames=Math.round(at/pt))}processRemoteInboundStats(t,e){const r=this.report.get(t);r&&(e.packetsLost=r.packetsLost,r.roundTripTime&&(e.rttMs=1e3*r.roundTripTime),r.jitter&&(e.jitterMs=1e3*r.jitter),r.timestamp&&(e.timestamp=r.timestamp))}getCodecFromCodecStats(t){const e=this.report.get(t);if(!e)return"";const r=e.mimeType.match(/\/(.*)$/);return r&&r[1]?r[1]:""}updateSendBitrate(){let t=0,e=null,r=null;this.mediaBytesSent.forEach(i=>{t+=i.diffMean()}),this.mediaBytesRetransmit.forEach(i=>{e=e===null?i.diffMean():e+i.diffMean()}),this.mediaBytesTargetEncode.forEach(i=>{r=r===null?i.diffMean():r+i.diffMean()});const n=e!==null?t-e:t;this._stats.bitrate={actualEncoded:8*n/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},e!==null&&(this._stats.bitrate.retransmit=8*e/(this.options.updateInterval/1e3)),r!==null&&(this._stats.bitrate.targetEncoded=8*r/(this.options.updateInterval/1e3))}},c6=class extends ZE{updateStats(){return De.resolve()}};function $E(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const o=function(){const s=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return s&&s[0]?Number(s[0].split("/")[1]):null}();return o?o<76?new a6(t,{updateInterval:e,lossRateInterval:r,freezeRateLimit:n,firstVideoDecodedTimeout:i}):new aA(t,{updateInterval:e,lossRateInterval:r,freezeRateLimit:n,firstVideoDecodedTimeout:i}):function(s){if(!window.RTCStatsReport)return!1;const c=s.getStats();return!!(c instanceof De||function(d){return!!d&&(typeof d=="object"||typeof d=="function")&&typeof d.then=="function"}(c))}(t)?new aA(t,{updateInterval:e,lossRateInterval:r,freezeRateLimit:n,firstVideoDecodedTimeout:i}):new c6(t,{updateInterval:e,lossRateInterval:r,freezeRateLimit:n,firstVideoDecodedTimeout:i})}const cA="websdk_ng_install_id";function tg(){try{if(st("INSTALL_ID"))return st("INSTALL_ID");let t=window.localStorage.getItem(cA);return t||(t=lc(),window.localStorage.setItem(cA,t)),Br("INSTALL_ID",t),t}catch{return}}const po=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const e=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(e&&e[1]&&e[2]){const r=e[1],n=e[2];return"".concat(r,".").concat(n)}return"4.0.0.999"}("4.24.0"),eg=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let hc=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const ii=function(){const t="us".concat("erna","me"),e="pa".concat("sswo","rd"),r=["t","s","t"];r.splice(1,0,"e");const n=r.join(""),i=[];for(let c=0;c<6;c++)i.push("1");const o=i.join(""),s={};return s[t]=n,s[e]=o,Object.assign(s,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=ii;const wp={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},rg={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},ng="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",ig={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},rn=ve(ve(ve(ve({},ig),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:rg,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},wp),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function Br(t,e,r){var n,i,o;Ce(n=Object.keys(rn)).call(n,t)&&(!r&&Ce(i=Object.keys(os)).call(i,t)||(rn[t]=e,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS"||e!==!0||(rn.ENABLE_ENCODED_TRANSFORM=!0),t==="USE_NEW_NETWORK_CONFIG"&&e&&(o=!!e,rn.USE_NEW_NETWORK_CONFIG=o,o&&(rn.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],rn.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],rn.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],rn.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],rn.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",rn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",rn.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&e&&(rn.ENABLE_INSTANT_VIDEO=!0,rn.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&e&&(rn.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&e&&(rn.NEW_TURN_MODE||(rn.NEW_TURN_MODE=4))))}function st(t){return rn[t]}eg||(rn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],rn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],rn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],rn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],rn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],rn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],rn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",rn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",rn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",rn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",rn.AREAS=["NORTH_AMERICA","OVERSEA"]);let dA=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const os={};var ur=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",t.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",t.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",t.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",t.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",t.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",t.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(ur||{});let $u=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const uA=128,d6=96,lA=1e3,Sd=10;let u6=0;var hA=(()=>{var t={8:(n,i,o)=>{o.r(i),o.d(i,{Parser:()=>se,Printer:()=>kr,parse:()=>Se,print:()=>Fe});const s=`
`,c="".concat("\r").concat(s),d=" ";let u;function l(ce){return ce>="0"&&ce<="9"}function T(ce){return ce>="!"&&ce<="~"}function v(ce){return T(ce)||ce>="Â"&&ce<="Ã¿"}function y(ce){return ce==="!"||ce>="#"&&ce<="'"||ce>="*"&&ce<="+"||ce>="-"&&ce<="."||ce>="0"&&ce<="9"||ce>="A"&&ce<="Z"||ce>="^"&&ce<="~"}function x(ce){return ce>="1"&&ce<="9"}function N(ce){return ce>="A"&&ce<="Z"||ce>="a"&&ce<="z"}function L(ce){return ce==="d"||ce==="h"||ce==="m"||ce==="s"}function Q(ce){return ce>""&&ce<"	"||ce>"\v"&&ce<"\f"||ce>""&&ce<"Ã¿"}function J(ce){return N(ce)||l(ce)||ce==="+"||ce==="/"}function at(ce){return l(ce)||N(ce)||ce==="+"||ce==="/"||ce==="-"||ce==="_"}function Rt(ce){return N(ce)||l(ce)||ce==="+"||ce==="/"}function vt(ce,w){var ht=Object.keys(ce);if(Object.getOwnPropertySymbols){var Tt=Object.getOwnPropertySymbols(ce);w&&(Tt=Tt.filter(function(ye){return Object.getOwnPropertyDescriptor(ce,ye).enumerable})),ht.push.apply(ht,Tt)}return ht}function pt(ce){for(var w=1;w<arguments.length;w++){var ht=arguments[w]!=null?arguments[w]:{};w%2?vt(Object(ht),!0).forEach(function(Tt){kt(ce,Tt,ht[Tt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ce,Object.getOwnPropertyDescriptors(ht)):vt(Object(ht)).forEach(function(Tt){Object.defineProperty(ce,Tt,Object.getOwnPropertyDescriptor(ht,Tt))})}return ce}function kt(ce,w,ht){return w in ce?Object.defineProperty(ce,w,{value:ht,enumerable:!0,configurable:!0,writable:!0}):ce[w]=ht,ce}(function(ce){ce.VERSION="v",ce.ORIGIN="o",ce.SESSION_NAME="s",ce.INFORMATION="i",ce.URI="u",ce.EMAIL="e",ce.PHONE="p",ce.CONNECTION="c",ce.BANDWIDTH="b",ce.TIME="t",ce.REPEAT="r",ce.ZONE_ADJUSTMENTS="z",ce.KEY="k",ce.ATTRIBUTE="a",ce.MEDIA="m"})(u||(u={}));class $t{consumeText(w,ht){let Tt=ht;for(;Tt<w.length;){const ye=w[Tt];if(ye==="\0"||ye==="\r"||ye===s)break;Tt+=1}if(Tt-ht==0)throw new Error("Invalid text, at ".concat(w));return Tt}consumeUnicastAddress(w,ht,Tt){return this.consumeTill(w,ht,d)}consumeOneOrMore(w,ht,Tt){let ye=ht;for(;Tt(w[ye]);)ye++;if(ye-ht==0)throw new Error("Invalid rule at ".concat(ht,"."));return ye}consumeSpace(w,ht){if(w[ht]===d)return ht+1;throw new Error("Invalid space at ".concat(ht,"."))}consumeIP4Address(w,ht){let Tt=ht;for(let ye=0;ye<4;ye++)if(Tt=this.consumeDecimalUChar(w,Tt),ye!==3){if(w[Tt]!==".")throw new Error("Invalid IP4 address.");Tt++}return Tt}consumeDecimalUChar(w,ht){let Tt=ht;for(let hr=0;hr<3&&l(w[Tt]);hr++,Tt++);if(Tt-ht==0)throw new Error("Invalid decimal uchar.");const ye=parseInt(w.slice(ht,Tt));if(ye>=0&&ye<=255)return Tt;throw new Error("Invalid decimal uchar")}consumeIP6Address(w,ht){let Tt=this.consumeHexpart(w,ht);return w[Tt]===":"&&(Tt+=1,Tt=this.consumeIP4Address(w,Tt)),Tt}consumeHexpart(w,ht){let Tt=ht;if(w[Tt]===":"&&w[Tt+1]===":"){Tt+=2;try{Tt=this.consumeHexseq(w,Tt)}catch{}return Tt}if(Tt=this.consumeHexseq(w,Tt),w[Tt]===":"&&w[Tt+1]===":"){Tt+=2;try{Tt=this.consumeHexseq(w,Tt)}catch{}return Tt}return Tt}consumeHexseq(w,ht){let Tt=ht;for(;Tt=this.consumeHex4(w,Tt),w[Tt]===":"&&w[Tt+1]!==":";)Tt+=1;return Tt}consumeHex4(w,ht){let Tt=0;for(;Tt<4;Tt++)if(!((ye=w[ht+Tt])>="0"&&ye<="9"||ye>="a"&&ye<="f"||ye>="A"&&ye<="F")){if(Tt===0)throw new Error("Invalid hex 4");break}var ye;return ht+Tt}consumeFQDN(w,ht){let Tt=ht;for(;l(w[Tt])||N(w[Tt])||w[Tt]==="-"||w[Tt]===".";)Tt+=1;if(Tt-ht<4)throw new Error("Invalid FQDN");return Tt}consumeExtnAddr(w,ht){return this.consumeOneOrMore(w,ht,v)}consumeMulticastAddress(w,ht,Tt){switch(Tt){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(w,ht);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(w,ht);default:try{return this.consumeFQDN(w,ht)}catch{return this.consumeExtnAddr(w,ht)}}}consumeIP6MulticastAddress(w,ht){const Tt=this.consumeHexpart(w,ht);return w[Tt]==="/"?this.consumeInteger(w,Tt+1):Tt}consumeIP4MulticastAddress(w,ht){let Tt=ht+3;const ye=w.slice(ht,Tt),hr=parseInt(ye);if(hr<224||hr>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Yr=0;Yr<3;Yr++){if(w[Tt]!==".")throw new Error("Invalid IP4 multicast address.");Tt+=1,Tt=this.consumeDecimalUChar(w,Tt)}return w[Tt]==="/"&&(Tt+=1),Tt=this.consumeTTL(w,Tt),w[Tt]==="/"&&(Tt=this.consumeInteger(w,Tt)),Tt}consumeInteger(w,ht){if(!x(w[ht]))throw new Error("Invalid integer.");for(ht+=1;l(w[ht]);)ht+=1;return ht}consumeTTL(w,ht){if(w[ht]==="0")return ht+1;if(!x(w[ht]))throw new Error("Invalid TTL.");ht+=1;for(let Tt=0;Tt<2&&l(w[ht]);Tt++)ht+=1;return ht}consumeToken(w,ht){return this.consumeOneOrMore(w,ht,y)}consumeTime(w,ht){let Tt=ht;if(w[Tt]==="0")return Tt+1;for(x(w[Tt])&&(Tt+=1);l(w[Tt]);)Tt++;if(Tt-ht<10)throw new Error("Invalid time");return Tt}consumeAddress(w,ht){return this.consumeTill(w,ht,d)}consumeTypedTime(w,ht){let Tt=ht;return Tt=this.consumeOneOrMore(w,Tt,l),L(w[Tt])?Tt+1:Tt}consumeRepeatInterval(w,ht){if(!x(w[ht]))throw new Error("Invalid repeat interval");for(ht+=1;l(w[ht]);)ht+=1;return L(w[ht])&&(ht+=1),ht}consumePort(w,ht){return this.consumeOneOrMore(w,ht,l)}consume(w,ht,Tt){for(let ye=0;ye<Tt.length;ye++){if(ht+ye>=w.length)throw new Error("consume exceeding value length");if(w[ht+ye]!==Tt[ye])throw new Error("consume ".concat(Tt," failed at ").concat(ye))}return ht+Tt.length}consumeTill(w,ht,Tt){let ye=ht;for(;ye<w.length&&(typeof Tt!="string"||w[ye]!==Tt)&&(typeof Tt!="function"||!Tt(w[ye]));)ye++;return ye}}class se extends $t{constructor(){super(),kt(this,"records",[]),kt(this,"currentLine",0)}parse(w){const ht=this.probeEOL(w);this.records=w.split(ht).filter(ra=>!!Ei(ra).call(ra)).map(this.parseLine),this.currentLine=0;const Tt=this.parseVersion(),ye=this.parseOrigin(),hr=this.parseSessionName(),Yr=this.parseInformation(),Dn=this.parseUri(),So=this.parseEmail(),zo=this.parsePhone(),xl=this.parseConnection(),Dc=this.parseBandWidth(),tu=this.parseTimeFields(),Wf=this.parseKey(),Kf=this.parseSessionAttribute(),Ro=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:Tt,origin:ye,sessionName:hr,information:Yr,uri:Dn,emails:So,phones:zo,connection:xl,bandwidths:Dc,timeFields:tu,key:Wf,attributes:Kf,mediaDescriptions:Ro}}getCurrentRecord(){const w=this.records[this.currentLine];if(!w)throw new Error("Record doesn't exit.");return w}probeEOL(w){for(let ht=0;ht<w.length;ht++)if(w[ht]===s)return w[ht-1]==="\r"?c:s;throw new Error("Invalid newline character.")}parseLine(w,ht){if(w.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const Tt=w[0];if(w[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:Tt,value:w.slice(2),line:ht,cur:0}}parseSessionAttribute(){const w=new mr;for(;this.currentLine<this.records.length;){const ht=this.getCurrentRecord();if(ht.type!==u.ATTRIBUTE)break;const Tt={attField:this.extractOneOrMore(ht,ye=>y(ye)&&ye!==":"),_cur:0};ht.value[ht.cur]===":"&&(ht.cur+=1,Tt.attValue=this.extractOneOrMore(ht,Q)),w.parse(Tt),this.currentLine++}return w.digest()}parseMediaAttributes(w){const ht=new Er(w);for(;this.currentLine<this.records.length;){const Tt=this.getCurrentRecord();if(Tt.type!==u.ATTRIBUTE)break;const ye={attField:this.extractOneOrMore(Tt,hr=>y(hr)&&hr!==":"),_cur:0};Tt.value[Tt.cur]===":"&&(Tt.cur+=1,ye.attValue=this.extractOneOrMore(Tt,Q)),ht.parse(ye),this.currentLine++}return ht.digest()}parseKey(){const w=this.getCurrentRecord();if(w.type===u.KEY){if(w.value==="prompt"||w.value==="clear:"||w.value==="base64:"||w.value==="uri:")return w.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const w=this.getCurrentRecord();if(w.type===u.ZONE_ADJUSTMENTS){const ht=[];for(;;)try{const Tt=this.extract(w,this.consumeTime);this.consumeSpaceForRecord(w);let ye=!1;w.value[w.cur]==="-"&&(ye=!0,w.cur+=1);const hr=this.extract(w,this.consumeTypedTime);ht.push({time:Tt,typedTime:hr,back:ye})}catch{break}if(ht.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ht}return[]}parseRepeat(){const w=[];for(;;){const ht=this.getCurrentRecord();if(ht.type!==u.REPEAT)break;{const Tt=this.extract(ht,this.consumeRepeatInterval),ye=this.parseTypedTime(ht);w.push({repeatInterval:Tt,typedTimes:ye}),this.currentLine++}}return w}parseTypedTime(w){const ht=[];for(;;)try{this.consumeSpaceForRecord(w),ht.push(this.extract(w,this.consumeTypedTime))}catch{break}if(ht.length===0)throw new Error("Invalid typed time.");return ht}parseTime(){const w=this.getCurrentRecord(),ht=this.extract(w,this.consumeTime);this.consumeSpaceForRecord(w);const Tt=this.extract(w,this.consumeTime);return this.currentLine++,{startTime:ht,stopTime:Tt}}parseBandWidth(){const w=[];for(;this.currentLine<this.records.length;){const ht=this.getCurrentRecord();if(ht.type!==u.BANDWIDTH)break;{const Tt=this.extractOneOrMore(ht,y);if(ht.value[ht.cur]!==":")throw new Error("Invalid bandwidth field.");ht.cur++;const ye=this.extractOneOrMore(ht,l);w.push({bwtype:Tt,bandwidth:ye}),this.currentLine++}}return w}parseVersion(){const w=this.getCurrentRecord();if(w.type!==u.VERSION)throw new Error("first sdp record must be version");const ht=w.value.slice(0,this.consumeOneOrMore(w.value,0,l));if(ht.length!==w.value.length)throw new Error('invalid proto version, "v='.concat(w.value,'"'));return this.currentLine++,ht}parseOrigin(){const w=this.getCurrentRecord();if(w.type!==u.ORIGIN)throw new Error("second line of sdp must be origin");const ht=this.extractOneOrMore(w,v);this.consumeSpaceForRecord(w);const Tt=this.extractOneOrMore(w,l);this.consumeSpaceForRecord(w);const ye=this.extractOneOrMore(w,l);this.consumeSpaceForRecord(w);const hr=this.extractOneOrMore(w,y);this.consumeSpaceForRecord(w);const Yr=this.extractOneOrMore(w,y);this.consumeSpaceForRecord(w);const Dn=this.extract(w,this.consumeUnicastAddress);return this.currentLine++,{username:ht,sessId:Tt,sessVersion:ye,nettype:hr,addrtype:Yr,unicastAddress:Dn}}parseSessionName(){const w=this.getCurrentRecord();if(w.type===u.SESSION_NAME){const ht=this.extract(w,this.consumeText);return this.currentLine++,ht}}parseInformation(){const w=this.getCurrentRecord();if(w.type!==u.INFORMATION)return;const ht=this.extract(w,this.consumeText);return this.currentLine++,ht}parseUri(){const w=this.getCurrentRecord();if(w.type===u.URI)return this.currentLine++,w.value}parseEmail(){const w=[];for(;;){const ht=this.getCurrentRecord();if(ht.type!==u.EMAIL)break;w.push(ht.value),this.currentLine++}return w}parsePhone(){const w=[];for(;;){const ht=this.getCurrentRecord();if(ht.type!==u.PHONE)break;w.push(ht.value),this.currentLine++}return w}parseConnection(){const w=this.getCurrentRecord();if(w.type===u.CONNECTION){const ht=this.extractOneOrMore(w,y);this.consumeSpaceForRecord(w);const Tt=this.extractOneOrMore(w,y);this.consumeSpaceForRecord(w);const ye=this.extract(w,this.consumeAddress);return this.currentLine++,{nettype:ht,addrtype:Tt,address:ye}}}parseMedia(){const w=this.getCurrentRecord(),ht=this.extract(w,this.consumeToken);this.consumeSpaceForRecord(w);let Tt=this.extract(w,this.consumePort);w.value[w.cur]==="/"&&(w.cur+=1,Tt+=this.extract(w,this.consumeInteger)),this.consumeSpaceForRecord(w);const ye=[];for(ye.push(this.extract(w,this.consumeToken));w.value[w.cur]==="/";)w.cur+=1,ye.push(this.extract(w,this.consumeToken));if(ye.length===0)throw new Error("Invalid proto");const hr=this.parseFmt(w);return this.currentLine++,{mediaType:ht,port:Tt,protos:ye,fmts:hr}}parseTimeFields(){const w=[];for(;this.getCurrentRecord().type===u.TIME;){const ht=this.parseTime(),Tt=this.parseRepeat(),ye=this.parseZone();w.push({time:ht,repeats:Tt,zones:ye})}return w}parseMediaDescription(){const w=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===u.MEDIA;){const ht=this.parseMedia(),Tt=this.parseInformation(),ye=this.parseConnections(),hr=this.parseBandWidth(),Yr=this.parseKey(),Dn=this.parseMediaAttributes(ht);w.push({media:ht,information:Tt,connections:ye,bandwidths:hr,key:Yr,attributes:Dn})}return w}parseConnections(){const w=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===u.CONNECTION;)w.push(this.parseConnection());return w}parseFmt(w){const ht=[];for(;;)try{this.consumeSpaceForRecord(w),ht.push(this.extract(w,this.consumeToken))}catch{break}if(ht.length===0)throw new Error("Invalid fmts");return ht}extract(w,ht){for(var Tt=arguments.length,ye=new Array(Tt>2?Tt-2:0),hr=2;hr<Tt;hr++)ye[hr-2]=arguments[hr];const Yr=ht.call(this,w.value,w.cur,...ye),Dn=w.value.slice(w.cur,Yr);return w.cur=Yr,Dn}extractOneOrMore(w,ht){const Tt=this.consumeOneOrMore(w.value,w.cur,ht),ye=w.value.slice(w.cur,Tt);return w.cur=Tt,ye}consumeSpaceForRecord(w){if(w.value[w.cur]!==d)throw new Error("Invalid space at ".concat(w.cur,"."));w.cur+=1}}class Te extends $t{constructor(){super(...arguments),kt(this,"attributes",void 0),kt(this,"digested",!1)}extractOneOrMore(w,ht,Tt){const ye=this.consumeOneOrMore(w.attValue,w._cur,ht),hr=w.attValue.slice(w._cur,ye),[Yr,Dn]=Tt||[];if(typeof Yr=="number"&&hr.length<Yr)throw new Error("error in length, should be more or equal than ".concat(Yr," characters."));if(typeof Dn=="number"&&hr.length>Dn)throw new Error("error in length, should be less or equal than ".concat(Dn," characters."));return w._cur=ye,hr}consumeAttributeSpace(w){if(w.attValue[w._cur]!==d)throw new Error("Invalid space at ".concat(w._cur,"."));w._cur+=1}extract(w,ht){if(!w.attValue)throw new Error("Nothing to extract from attValue.");for(var Tt=arguments.length,ye=new Array(Tt>2?Tt-2:0),hr=2;hr<Tt;hr++)ye[hr-2]=arguments[hr];const Yr=ht.call(this,w.attValue,w._cur,...ye),Dn=w.attValue.slice(w._cur,Yr);return w._cur=Yr,Dn}atEnd(w){if(!w.attValue)throw new Error;return w._cur>=w.attValue.length}peekChar(w){if(!w.attValue)throw new Error;return w.attValue[w._cur]}peek(w,ht){if(!w.attValue)throw new Error;for(let Tt=0;Tt<ht.length;Tt++)if(ht[Tt]!==w.attValue[w._cur+Tt])return!1;return!0}parseIceUfrag(w){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(w,J,[4,256])}parseIcePwd(w){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(w,J,[22,256])}parseIceOptions(w){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ht=[];for(;!this.atEnd(w);){ht.push(this.extractOneOrMore(w,J));try{this.consumeAttributeSpace(w)}catch(Tt){if(this.atEnd(w))break;throw Tt}}this.attributes.iceOptions=ht}parseFingerprint(w){const ht=this.extract(w,this.consumeToken);this.consumeAttributeSpace(w);const Tt=this.extract(w,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ht,fingerprint:Tt})}parseExtmap(w){const ht=this.extractOneOrMore(w,l);let Tt;this.peekChar(w)==="/"&&(this.extract(w,this.consume,"/"),Tt=this.extract(w,this.consumeToken)),this.consumeAttributeSpace(w);const ye=this.extract(w,this.consumeTill,d),hr=pt(pt({entry:parseInt(ht,10)},Tt&&{direction:Tt}),{},{extensionName:ye});this.peekChar(w)===d&&(this.consumeAttributeSpace(w),hr.extensionAttributes=this.extract(w,this.consumeTill)),this.attributes.extmaps.push(hr)}parseSetup(w){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ht=this.extract(w,this.consumeTill);if(ht!=="active"&&ht!=="passive"&&ht!=="actpass"&&ht!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ht}}class mr extends Te{constructor(){super(...arguments),kt(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(w){if(this.digested)throw new Error("already digested");try{switch(w.attField){case"group":this.parseGroup(w);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(w);break;case"ice-pwd":this.parseIcePwd(w);break;case"ice-options":this.parseIceOptions(w);break;case"fingerprint":this.parseFingerprint(w);break;case"setup":this.parseSetup(w);break;case"tls-id":this.parseTlsId(w);break;case"identity":this.parseIdentity(w);break;case"extmap":this.parseExtmap(w);break;case"msid-semantic":this.parseMsidSemantic(w);break;default:w.ignored=!0,this.attributes.unrecognized.push(w)}}catch(ht){throw console.error("parsing session attribute ".concat(w.attField,' error, "a=').concat(w.attField,":").concat(w.attValue,'"')),ht}if(!w.ignored&&w.attValue&&!this.atEnd(w))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(w){const ht=this.extract(w,this.consumeToken),Tt=[];for(;!this.atEnd(w)&&this.peekChar(w)===d;)this.consumeAttributeSpace(w),Tt.push(this.extract(w,this.consumeToken));this.attributes.groups.push({semantic:ht,identificationTag:Tt})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(w){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(w,at)}parseIdentity(w){const ht=this.extractOneOrMore(w,Rt),Tt=[];for(;!this.atEnd(w)&&this.peekChar(w)===d;){this.consumeAttributeSpace(w);const ye=this.extract(w,this.consumeToken);this.extract(w,this.consume,"=");const hr=this.extractOneOrMore(w,Yr=>Yr!==d&&Q(Yr));Tt.push({name:ye,value:hr})}this.attributes.identities.push({assertionValue:ht,extensions:Tt})}parseMsidSemantic(w){this.peekChar(w)===d&&this.consumeAttributeSpace(w);const ht={semantic:this.extract(w,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(w)}catch{break}if(this.peekChar(w)==="*"){this.extract(w,this.consume,"*"),ht.applyForAll=!0;break}{const Tt=this.extract(w,this.consumeTill,d);ht.identifierList.push(Tt)}}this.attributes.msidSemantic=ht}}class Er extends Te{constructor(w){super(),kt(this,"attributes",void 0),w.protos.indexOf("RTP")!==-1||w.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(w){if(this.digested)throw new Error("already digested");try{switch(w.attField){case"extmap":this.parseExtmap(w);break;case"setup":this.parseSetup(w);break;case"ice-ufrag":this.parseIceUfrag(w);break;case"ice-pwd":this.parseIcePwd(w);break;case"ice-options":this.parseIceOptions(w);break;case"candidate":this.parseCandidate(w);break;case"remote-candidate":this.parseRemoteCandidate(w);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(w);break;case"rtpmap":this.parseRtpmap(w);break;case"ptime":this.parsePtime(w);break;case"maxptime":this.parseMaxPtime(w);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(w);break;case"ssrc":this.parseSSRC(w);break;case"fmtp":this.parseFmtp(w);break;case"rtcp-fb":this.parseRtcpFb(w);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(w);break;case"mid":this.parseMid(w);break;case"msid":this.parseMsid(w);break;case"imageattr":this.parseImageAttr(w);break;case"rid":this.parseRid(w);break;case"simulcast":this.parseSimulcast(w);break;case"sctp-port":this.parseSctpPort(w);break;case"max-message-size":this.parseMaxMessageSize(w);break;case"ssrc-group":this.parseSSRCGroup(w);break;default:w.ignored=!0,this.attributes.unrecognized.push(w)}}catch(ht){throw console.error("parsing media attribute ".concat(w.attField,' error, "a=').concat(w.attField,":").concat(w.attValue,'"')),ht}if(!w.ignored&&w.attValue&&!this.atEnd(w))throw new Error("attribute parsing error")}parseCandidate(w){const ht=this.extractOneOrMore(w,J,[1,32]);this.consumeAttributeSpace(w);const Tt=this.extractOneOrMore(w,l,[1,5]);this.consumeAttributeSpace(w);const ye=this.extract(w,this.consumeToken);this.consumeAttributeSpace(w);const hr=this.extractOneOrMore(w,l,[1,10]);this.consumeAttributeSpace(w);const Yr=this.extract(w,this.consumeAddress);this.consumeAttributeSpace(w);const Dn=this.extract(w,this.consumePort);this.consumeAttributeSpace(w),this.extract(w,this.consume,"typ"),this.consumeAttributeSpace(w);const So={foundation:ht,componentId:Tt,transport:ye,priority:hr,connectionAddress:Yr,port:Dn,type:this.extract(w,this.consumeToken),extension:{}};for(this.peek(w," raddr")&&(this.extract(w,this.consume," raddr"),this.consumeAttributeSpace(w),So.relAddr=this.extract(w,this.consumeAddress)),this.peek(w," rport")&&(this.extract(w,this.consume," rport"),this.consumeAttributeSpace(w),So.relPort=this.extract(w,this.consumePort));this.peekChar(w)===d;){this.consumeAttributeSpace(w);const zo=this.extract(w,this.consumeToken);this.consumeAttributeSpace(w),So.extension[zo]=this.extractOneOrMore(w,T)}this.attributes.candidates.push(So)}parseRemoteCandidate(w){const ht=[];for(;;){const Tt=this.extractOneOrMore(w,l,[1,5]);this.consumeAttributeSpace(w);const ye=this.extract(w,this.consumeAddress);this.consumeAttributeSpace(w);const hr=this.extract(w,this.consumePort);ht.push({componentId:Tt,connectionAddress:ye,port:hr});try{this.consumeAttributeSpace(w)}catch{break}}this.attributes.remoteCandidatesList.push(ht)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(w){const ht=this.extract(w,this.consumeToken);this.consumeAttributeSpace(w);const Tt=this.extract(w,this.consumeTill,"/");this.extract(w,this.consume,"/");const ye={encodingName:Tt,clockRate:this.extractOneOrMore(w,l)};this.atEnd(w)||this.peekChar(w)!=="/"||(this.extract(w,this.consume,"/"),ye.encodingParameters=parseInt(this.extract(w,this.consumeTill),10));const hr=this.attributes.payloads.find(Yr=>Yr.payloadType===parseInt(ht,10));hr?hr.rtpMap=ye:this.attributes.payloads.push({payloadType:parseInt(ht,10),rtpMap:ye,rtcpFeedbacks:[]})}parsePtime(w){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(w,this.consumeTill)}parseMaxPtime(w){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(w,this.consumeTill)}parseDirection(w){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=w.attField}parseSSRC(w){const ht=this.extractOneOrMore(w,l);this.consumeAttributeSpace(w);const Tt=this.extract(w,this.consumeTill,":");let ye;this.peekChar(w)===":"&&(this.extract(w,this.consume,":"),ye=this.extract(w,this.consumeTill));const hr=this.attributes.ssrcs.find(Yr=>Yr.ssrcId===parseInt(ht,10));hr?hr.attributes[Tt]=ye:this.attributes.ssrcs.push({ssrcId:parseInt(ht,10),attributes:{[Tt]:ye}})}parseFmtp(w){const ht=this.extract(w,this.consumeTill,d);this.consumeAttributeSpace(w);const Tt=this.extract(w,this.consumeTill),ye={};Tt.split(";").forEach(Yr=>{let[Dn,So]=Yr.split("=");Dn=Ei(Dn).call(Dn);const zo=typeof So=="string"?Ei(So).call(So):null;typeof Dn=="string"&&Dn.length>0&&(ye[Dn]=zo)});const hr=this.attributes.payloads.find(Yr=>Yr.payloadType===parseInt(ht,10));hr?hr.fmtp={parameters:ye}:this.attributes.payloads.push({payloadType:parseInt(ht,10),rtcpFeedbacks:[],fmtp:{parameters:ye}})}parseFmtParameters(w){const ht={},Tt=this.extract(w,this.consumeTill,"=");w._cur++;const ye=this.extract(w,this.consumeTill,";");for(ht[Tt]=ye;w.attValue[w._cur]===";";){const hr=this.extract(w,this.consumeTill,"=");w._cur++;const Yr=this.extract(w,this.consumeTill,";");ht[hr]=Yr}return ht}parseRtcpFb(w){let ht="";ht=this.peekChar(w)==="*"?this.extract(w,this.consume,"*"):this.extract(w,this.consumeTill,d),this.consumeAttributeSpace(w);const Tt=this.extract(w,this.consumeTill,d);let ye;if(Tt==="trr-int")ye={type:Tt,interval:this.extract(w,this.consumeTill)};else{const hr={type:Tt};this.peekChar(w)===d&&(this.consumeAttributeSpace(w),hr.parameter=this.extract(w,this.consumeToken),this.peekChar(w)===d&&(hr.additional=this.extract(w,this.consumeTill))),ye=hr}if(ht==="*")this.attributes.rtcpFeedbackWildcards.push(ye);else{const hr=this.attributes.payloads.find(Yr=>Yr.payloadType===parseInt(ht,10));hr?hr.rtcpFeedbacks.push(ye):this.attributes.payloads.push({payloadType:parseInt(ht,10),rtcpFeedbacks:[ye]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(w){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ht={port:this.extract(w,this.consumePort)};this.peekChar(w)===d&&(this.consumeAttributeSpace(w),ht.netType=this.extractOneOrMore(w,y),this.consumeAttributeSpace(w),ht.addressType=this.extractOneOrMore(w,y),this.consumeAttributeSpace(w),ht.address=this.extract(w,this.consumeAddress)),this.attributes.rtcp=ht}parseMsid(w){const ht={id:this.extractOneOrMore(w,y,[1,64])};this.peekChar(w)===d&&(this.consumeAttributeSpace(w),ht.appdata=this.extractOneOrMore(w,y,[1,64])),this.attributes.msids.push(ht)}parseImageAttr(w){this.attributes.imageattr.push(w.attValue)}parseRid(w){const ht=this.extractOneOrMore(w,ye=>N(ye)||l(ye)||ye==="_"||ye==="-");this.consumeAttributeSpace(w);const Tt={id:ht,direction:this.extract(w,this.consumeToken),params:[]};if(this.peekChar(w)===d){if(this.consumeAttributeSpace(w),this.peek(w,"pt=")){this.extract(w,this.consume,"pt=");const ye=[];for(;;){const hr=this.extract(w,this.consumeToken);ye.push(hr);try{this.extract(w,this.consume,",")}catch{break}}Tt.payloads=ye,this.peekChar(w)===d&&this.extract(w,this.consume,d)}for(;;){const ye=this.extract(w,this.consumeToken);switch(ye){case"depend":{const hr={type:ye,rids:this.extract(w,this.consume,"=").split(",")};Tt.params.push(hr);break}default:{const hr={type:ye};this.peekChar(w)==="="&&(this.extract(w,this.consume,"="),hr.val=this.extract(w,this.consumeTill,";")),Tt.params.push(hr)}}try{this.extract(w,this.consume,";")}catch{break}}}this.attributes.rids.push(Tt)}parseSimulcast(w){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=w.attValue,this.extract(w,this.consumeTill)}parseSctpPort(w){this.attributes.sctpPort=this.extractOneOrMore(w,l,[1,5])}parseMaxMessageSize(w){this.attributes.maxMessageSize=this.extractOneOrMore(w,l,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(w){this.attributes.mid=this.extract(w,this.consumeToken)}parseSSRCGroup(w){const ht=this.extract(w,this.consumeToken),Tt=[];for(;;)try{this.consumeAttributeSpace(w);const ye=this.extract(w,this.consumeInteger);Tt.push(parseInt(ye,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ht,ssrcIds:Tt})}}function ar(ce,w,ht){return w in ce?Object.defineProperty(ce,w,{value:ht,enumerable:!0,configurable:!0,writable:!0}):ce[w]=ht,ce}class kr{constructor(){ar(this,"eol",c)}print(w,ht){let Tt="";return ht&&(this.eol=ht),Tt+=this.printVersion(w.version),Tt+=this.printOrigin(w.origin),Tt+=this.printSessionName(w.sessionName),Tt+=this.printInformation(w.information),Tt+=this.printUri(w.uri),Tt+=this.printEmail(w.emails),Tt+=this.printPhone(w.phones),Tt+=this.printConnection(w.connection),Tt+=this.printBandwidth(w.bandwidths),Tt+=this.printTimeFields(w.timeFields),Tt+=this.printKey(w.key),Tt+=this.printSessionAttributes(w.attributes),Tt+=this.printMediaDescription(w.mediaDescriptions),Tt}printVersion(w){return"v=".concat(w).concat(this.eol)}printOrigin(w){return"o=".concat(w.username," ").concat(w.sessId," ").concat(w.sessVersion," ").concat(w.nettype," ").concat(w.addrtype," ").concat(w.unicastAddress).concat(this.eol)}printSessionName(w){return w?"s=".concat(w).concat(this.eol):""}printInformation(w){return w?"i=".concat(w).concat(this.eol):""}printUri(w){return w?"u=".concat(w).concat(this.eol):""}printEmail(w){let ht="";for(const Tt of w)ht+="e=".concat(Tt).concat(this.eol);return ht}printPhone(w){let ht="";for(const Tt of w)ht+="e=".concat(Tt).concat(this.eol);return ht}printConnection(w){return w?"c=".concat(w.nettype," ").concat(w.addrtype," ").concat(w.address).concat(this.eol):""}printBandwidth(w){let ht="";for(const Tt of w)ht+="b=".concat(Tt.bwtype,":").concat(Tt.bandwidth).concat(this.eol);return ht}printTimeFields(w){let ht="";for(const Tt of w){ht+="t=".concat(Tt.time.startTime," ").concat(Tt.time.startTime).concat(this.eol);for(const ye of Tt.repeats)ht+="r=".concat(ye.repeatInterval," ").concat(ye.typedTimes.join(" ")).concat(this.eol);Tt.zoneAdjustments&&(ht+="z=",ht+="z=".concat(Tt.zoneAdjustments.map(ye=>"".concat(ye.time," ").concat(ye.back?"-":""," ").concat(ye.typedTime)).join(" ")).concat(this.eol),ht+=this.eol)}return ht}printKey(w){return w?"k=".concat(w).concat(this.eol):""}printAttributes(w){let ht="";for(const Tt of w)ht+="a=".concat(Tt.attField).concat(Tt.attValue?":".concat(Tt.attValue):"").concat(this.eol);return ht}printMediaDescription(w){let ht="";for(const Tt of w)ht+=this.printMedia(Tt.media),ht+=this.printInformation(Tt.information),ht+=this.printConnections(Tt.connections),ht+=this.printBandwidth(Tt.bandwidths),ht+=this.printKey(Tt.key),ht+=this.printMediaAttributes(Tt);return ht}printConnections(w){let ht="";for(const Tt of w)ht+=this.printConnection(Tt);return ht}printMedia(w){return"m=".concat(w.mediaType," ").concat(w.port," ").concat(w.protos.join("/")," ").concat(w.fmts.join(" ")).concat(this.eol)}printSessionAttributes(w){return new li(this.eol).print(w)}printMediaAttributes(w){return new ie(this.eol).print(w)}}class Nr{constructor(w){ar(this,"eol",void 0),this.eol=w}printIceUfrag(w){return w===void 0?"":"a=ice-ufrag:".concat(w).concat(this.eol)}printIcePwd(w){return w===void 0?"":"a=ice-pwd:".concat(w).concat(this.eol)}printIceOptions(w){return w===void 0?"":"a=ice-options:".concat(w.join(d)).concat(this.eol)}printFingerprints(w){return w.length>0?w.map(ht=>"a=fingerprint:".concat(ht.hashFunction).concat(d).concat(ht.fingerprint)).join(this.eol)+this.eol:""}printExtmap(w){return w.map(ht=>"a=extmap:".concat(ht.entry).concat(ht.direction?"/".concat(ht.direction):"").concat(d).concat(ht.extensionName).concat(ht.extensionAttributes?"".concat(d).concat(ht.extensionAttributes):"").concat(this.eol)).join("")}printSetup(w){return w===void 0?"":"a=setup:".concat(w).concat(this.eol)}printUnrecognized(w){return w.map(ht=>"a=".concat(ht.attField).concat(ht.attValue?":".concat(ht.attValue):"").concat(this.eol)).join("")}}class li extends Nr{print(w){let ht="";return ht+=this.printGroups(w.groups),ht+=this.printMsidSemantic(w.msidSemantic),ht+=this.printIceLite(w.iceLite),ht+=this.printIceUfrag(w.iceUfrag),ht+=this.printIcePwd(w.icePwd),ht+=this.printIceOptions(w.iceOptions),ht+=this.printFingerprints(w.fingerprints),ht+=this.printSetup(w.setup),ht+=this.printTlsId(w.tlsId),ht+=this.printIdentity(w.identities),ht+=this.printExtmap(w.extmaps),ht+=this.printUnrecognized(w.unrecognized),ht}printGroups(w){let ht="";return w.length>0&&(ht+=w.map(Tt=>"a=group:".concat(Tt.semantic).concat(Tt.identificationTag.map(ye=>"".concat(d).concat(ye)).join("")).concat(this.eol)).join("")),ht}printIceLite(w){return w===void 0?"":"a=ice-lite"+this.eol}printTlsId(w){return w?"a=tls-id:".concat(w).concat(this.eol):""}printIdentity(w){return w.length===0?"":w.map(ht=>"a=identity:".concat(ht.assertionValue).concat(ht.extensions.map(Tt=>"".concat(d).concat(Tt.name).concat(Tt.value?"=".concat(Tt.value):"")))).join(this.eol)+this.eol}printMsidSemantic(w){if(!w)return"";let ht="a=msid-semantic:".concat(w.semantic);return w.applyForAll?ht+="".concat(d,"*"):w.identifierList.length>0&&(ht+=w.identifierList.map(Tt=>"".concat(d).concat(Tt))),ht+this.eol}}class ie extends Nr{print(w){const ht=w.attributes;let Tt="";return Tt+=this.printRTCP(ht.rtcp),Tt+=this.printIceUfrag(ht.iceUfrag),Tt+=this.printIcePwd(ht.icePwd),Tt+=this.printIceOptions(ht.iceOptions),Tt+=this.printCandidates(ht.candidates),Tt+=this.printRemoteCandidatesList(ht.remoteCandidatesList),Tt+=this.printEndOfCandidates(ht.endOfCandidates),Tt+=this.printFingerprints(ht.fingerprints),Tt+=this.printSetup(ht.setup),Tt+=this.printMid(ht.mid),Tt+=this.printExtmap(ht.extmaps),Tt+=this.printRTPRelated(ht),Tt+=this.printPtime(ht.ptime),Tt+=this.printMaxPtime(ht.maxPtime),Tt+=this.printDirection(ht.direction),Tt+=this.printSSRCGroups(ht.ssrcGroups),Tt+=this.printSSRC(ht.ssrcs),Tt+=this.printRTCPMux(ht.rtcpMux),Tt+=this.printRTCPMuxOnly(ht.rtcpMuxOnly),Tt+=this.printRTCPRsize(ht.rtcpRsize),Tt+=this.printMSId(ht.msids),Tt+=this.printImageattr(ht.imageattr),Tt+=this.printRid(ht.rids),Tt+=this.printSimulcast(ht.simulcast),Tt+=this.printSCTPPort(ht.sctpPort),Tt+=this.printMaxMessageSize(ht.maxMessageSize),Tt+=this.printUnrecognized(ht.unrecognized),Tt}printCandidates(w){return w.map(ht=>"a=candidate:".concat(ht.foundation).concat(d).concat(ht.componentId).concat(d).concat(ht.transport).concat(d).concat(ht.priority).concat(d).concat(ht.connectionAddress).concat(d).concat(ht.port).concat(d,"typ").concat(d).concat(ht.type).concat(ht.relAddr?"".concat(d,"raddr").concat(d).concat(ht.relAddr):"").concat(ht.relPort?"".concat(d,"rport").concat(d).concat(ht.relPort):"").concat(Object.keys(ht.extension).map(Tt=>"".concat(d).concat(Tt).concat(d).concat(ht.extension[Tt])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(w){return w.map(ht=>"a=remote-candidates:".concat(ht.join(d)).concat(this.eol)).join("")}printEndOfCandidates(w){return w===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(w){if(!w.payloads)return"";const ht=w.payloads;let Tt="";Tt+=w.rtcpFeedbackWildcards.map(ye=>this.printRTCPFeedback("*",ye)).join("");for(const ye of ht)Tt+=this.printRtpMap(ye.payloadType,ye.rtpMap),Tt+=this.printFmtp(ye.payloadType,ye.fmtp),Tt+=ye.rtcpFeedbacks.map(hr=>this.printRTCPFeedback(ye.payloadType,hr)).join("");return Tt}printFmtp(w,ht){if(!ht)return"";const Tt=Object.keys(ht.parameters);return Tt.length===1&&ht.parameters[Tt[0]]===null?"a=fmtp:".concat(w).concat(d).concat(Tt[0]).concat(this.eol):"a=fmtp:".concat(w).concat(d).concat(Object.keys(ht.parameters).map(ye=>"".concat(ye,"=").concat(ht.parameters[ye])).join(";")).concat(this.eol)}printRtpMap(w,ht){return ht?"a=rtpmap:".concat(w).concat(d).concat(ht.encodingName,"/").concat(ht.clockRate).concat(ht.encodingParameters?"/".concat(ht.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(w,ht){let Tt="a=rtcp-fb:".concat(w).concat(d),ye=ht;return ye.type==="trr-int"?Tt+="ttr-int".concat(d).concat(ye.interval):(Tt+="".concat(ye.type),ye.parameter&&(Tt+="".concat(d).concat(ye.parameter),ye.additional&&(Tt+="".concat(d).concat(ye.additional)))),Tt+this.eol}printPtime(w){return w===void 0?"":"a=ptime:".concat(w).concat(this.eol)}printMaxPtime(w){return w===void 0?"":"a=maxptime:".concat(w).concat(this.eol)}printDirection(w){return w===void 0?"":"a=".concat(w).concat(this.eol)}printSSRC(w){return w.map(ht=>Object.keys(ht.attributes).map(Tt=>"a=ssrc:".concat(ht.ssrcId.toString(10)).concat(d).concat(Tt).concat(ht.attributes[Tt]?":".concat(ht.attributes[Tt]):"").concat(this.eol)).join("")).join("")}printRTCPMux(w){return w===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(w){return w===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(w){return w===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(w){if(w===void 0)return"";let ht="a=rtcp:".concat(w.port);return w.netType&&(ht+="".concat(d).concat(w.netType)),w.addressType&&(ht+="".concat(d).concat(w.addressType)),w.address&&(ht+="".concat(d).concat(w.address)),ht+this.eol}printMSId(w){return w.map(ht=>"a=msid:".concat(ht.id).concat(ht.appdata?"".concat(d).concat(ht.appdata):"").concat(this.eol)).join("")}printImageattr(w){return w.map(ht=>"a=imageattr:".concat(ht).concat(this.eol)).join("")}printRid(w){return w.map(ht=>{let Tt="a=rid:".concat(ht.id).concat(d).concat(ht.direction);return ht.payloads&&(Tt+="".concat(d,"pt=").concat(ht.payloads.join(","))),ht.params.length>0&&(Tt+="".concat(d).concat(ht.params.map(ye=>ye.type==="depend"?"depend=".concat(ye.rids.join(",")):"".concat(ye.type,"=").concat(ye.val)).join(";"))),Tt+this.eol}).join("")}printSimulcast(w){return w===void 0?"":"a=simulcast:".concat(w).concat(this.eol)}printSCTPPort(w){return w===void 0?"":"a=sctp-port:".concat(w).concat(this.eol)}printMaxMessageSize(w){return w===void 0?"":"a=max-message-size:".concat(w).concat(this.eol)}printMid(w){return w===void 0?"":"a=mid:".concat(w).concat(this.eol)}printSSRCGroups(w){return w.map(ht=>"a=ssrc-group:".concat(ht.semantic).concat(ht.ssrcIds.map(Tt=>"".concat(d).concat(Tt.toString(10))).join("")).concat(this.eol)).join("")}}function Se(ce){return new se().parse(ce)}function Fe(ce,w){return new kr().print(ce,w)}}},e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}return r.d=(n,i)=>{for(var o in i)r.o(i,o)&&!r.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:i[o]})},r.o=(n,i)=>Object.prototype.hasOwnProperty.call(n,i),r.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},r(8)})();function ki(t){return hA.parse(t)}function Ca(t,e){return hA.print(t,e)}var l6=Co("Array","keys"),h6=fa,p6=Ye,f6=_,m6=l6,og=Array.prototype,_6={DOMTokenList:!0,NodeList:!0},E6=function(t){var e=t.keys;return t===og||f6(og,t)&&e===og.keys||p6(_6,h6(t))?m6:e},Li=ke(E6);function En(t,e,r){return(e=function(n){var i=function(o,s){if(typeof o!="object"||!o)return o;var c=o[Symbol.toPrimitive];if(c!==void 0){var d=c.call(o,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(n);return typeof i=="symbol"?i:i+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function pA(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function fr(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?pA(Object(r),!0).forEach(function(n){En(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):pA(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}const fA=new class extends pn{constructor(){super(...arguments),En(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:e}=t;e[e.length-1]&&e[e.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=e[e.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class g6{constructor(e){En(this,"logger",void 0),En(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];this.logger.debug(...this.prefixLists,...r)}info(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];this.logger.info(...this.prefixLists,...r)}warning(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];this.logger.warning(...this.prefixLists,...r)}error(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];this.logger.error(...this.prefixLists,...r)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function sg(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function mA(){const t=new Date,e=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return e?e?.[0]+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const fo={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Np=Date.now(),tl=t=>{for(const e in fo)if(Object.prototype.hasOwnProperty.call(fo,e)&&fo[e]===t)return e;return"DEFAULT"},C=new class{constructor(){En(this,"proxyServerURL",void 0),En(this,"logLevel",fo.DEBUG),En(this,"uploadState","collecting"),En(this,"uploadLogWaitingList",[]),En(this,"uploadLogUploadingList",[]),En(this,"uploadErrorCount",0),En(this,"currentLogID",0),En(this,"url",void 0),En(this,"extLog",(t,e)=>{this.appendLogToWaitingList(t,...e)})}debug(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];const n=[fo.DEBUG].concat(e);this.log.apply(this,n)}info(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];const n=[fo.INFO].concat(e);this.log.apply(this,n)}warning(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];const n=[fo.WARNING].concat(e);this.log.apply(this,n)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];const n=[fo.ERROR].concat(e);this.log.apply(this,n)}upload(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];const n=[fo.DEBUG].concat(e);this.uploadLog.apply(this,n)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){Br("UPLOAD_LOG",!0)}disableLogUpload(){Br("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new g6(this).prefix(t)}log(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];if(Date.now()-Np<100)return void setTimeout(()=>{this.log(...e)},Date.now()-Np);const n=Math.max(0,Math.min(4,e[0]));if(e[0]=sg()+" Agora-SDK [".concat(tl(n),"]:"),this.appendLogToWaitingList(n,...e),n<this.logLevel)return;const i=sg()+" %cAgora-SDK [".concat(tl(n),"]:");let o=[];if(!st("USE_NEW_LOG"))switch(n){case fo.DEBUG:o=[i,"color: #64B5F6;"].concat(e.slice(1)),console.log.apply(console,o);break;case fo.INFO:o=[i,"color: #1E88E5; font-weight: bold;"].concat(e.slice(1)),console.log.apply(console,o);break;case fo.WARNING:o=[i,"color: #FB8C00; font-weight: bold;"].concat(e.slice(1)),console.warn.apply(console,o);break;case fo.ERROR:o=[i,"color: #B00020; font-weight: bold;"].concat(e.slice(1)),console.error.apply(console,o)}}uploadLog(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];if(Date.now()-Np<100)return void setTimeout(()=>{this.uploadLog(...e)},Date.now()-Np);const n=Math.max(0,Math.min(4,e[0]));e[0]=sg()+" Agora-SDK [".concat(tl(n),"]:"),this.appendLogToWaitingList(n,...e)}appendLogToWaitingList(t){if(!st("UPLOAD_LOG"))return;for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];Array.isArray(r[0])?r[0][0]=mA()+" Agora-SDK [".concat(tl(t),"]:"):r[0]=mA()+" Agora-SDK [".concat(tl(t),"]:");let i="";r.forEach(o=>{typeof o=="object"&&(o=JSON.stringify(o)),i+="".concat(o," ")}),this.uploadLogWaitingList.push({payload_str:i,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,e={sdk_version:po,process_id:st("PROCESS_ID"),payload:JSON.stringify(t)};return is(async()=>{const r=await bi.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(st("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(st("LOG_UPLOAD_SERVER"),"/upload/v1")),e,{responseType:"text"});if(r.data!=="OK"){const n=new Error("unexpected upload log response");throw n.response=r,n}},()=>(this.uploadLogUploadingList=[],!1),r=>{const n={status:-1,message:r.message,errorRange:t.map(i=>i.log_item_id)};return r.response?(n.status=r.response.status,n.data=r.response.data,n.headers=r.response.headers):r.request&&(n.status=r.request.status),fA.reportLogUploadError(n),!0},{timeout:st("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:st("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,st("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),st("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),st("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),st("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var _A;function T6(t){return qn(t.reportId,"params.reportId",0,100,!1),qn(t.category,"params.category",0,100,!1),qn(t.event,"params.event",0,100,!1),qn(t.label,"params.label",0,100,!1),Hr(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(_A={}).FREE="free",_A.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const v6={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Un=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),nn=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let y6=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function nr(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(e,r,n){const i=n.value;if(typeof i=="function"){const o=t.className||e.__className__||(e.constructor.name==="AgoraRTCClient"?"Client":e.constructor.name);n.value=function(){for(var s,c=arguments.length,d=new Array(c),u=0;u<c;u++)d[u]=arguments[u];let l=d;if(t.argsMap)try{l=t.argsMap(this,...d)}catch(v){C.warning(v),l=[]}try{JSON.stringify(l)}catch{C.warning("arguments for method ".concat(o,".").concat(String(r)," not serializable for apiInvoke.")),l=[]}const T=(t.report||qe).reportApiInvoke(this._sessionId||null,{id:this._clientId||((s=this.store)===null||s===void 0?void 0:s.clientId)||this._ID,name:"".concat(o,".").concat(String(r)),options:l,tag:cn.TRACER,reportResult:t.reportResult},t.throttleTime);try{const v=i.apply(this,d);return v instanceof De?v.then(y=>(T.onSuccess(t.reportResult&&y),y)).catch(y=>{throw T.onError(y),y}):(T.onSuccess(t.reportResult&&v),v)}catch(v){throw T.onError(v),v}}}return n}}const qe=new class{constructor(){En(this,"baseInfoMap",new Map),En(this,"proxyServer",void 0),En(this,"eventUploadTimer",void 0),En(this,"setSessionIdTimer",void 0),En(this,"url",void 0),En(this,"sids",new Set),En(this,"backupUrl",void 0),En(this,"_appId",void 0),En(this,"_aid",0),En(this,"keyEventUploadPendingItems",[]),En(this,"normalEventUploadPendingItems",[]),En(this,"apiInvokeUploadPendingItems",[]),En(this,"apiInvokeCount",0),En(this,"apiInvokeLoggedCount",0),En(this,"ltsList",[]),En(this,"lastSendNormalEventTime",Date.now()),En(this,"customReportCounterTimer",void 0),En(this,"customReportCount",0),En(this,"extApiInvoke",async t=>{for(const e of t){const r=fr(fr({},e),{},{sid:null,invokeId:++this.apiInvokeCount,tag:cn.TRACER});this.sendApiInvoke(r)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),st("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),st("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,e=>{let[r,n]=e;return r+n}),16)||0}reportApiInvoke(t,e,r){e.timeout=e.timeout||6e4,e.reportResult=e.reportResult===void 0||e.reportResult;const n=Date.now();this.apiInvokeCount+=1;const i=this.apiInvokeCount,o=!!st("SHOW_REPORT_INVOKER_LOG"),s=!!st("SHOW_REPORT_USER_INVOKER_LOG"),c=o||s&&e.id;c&&(this.apiInvokeLoggedCount+=1);const d=this.apiInvokeLoggedCount;function u(y,x){if(c){let N="[apiInvoke-".concat(d,"]");if(e.id&&(N+="[".concat(e.id,"]")),e.name&&(N+="[".concat(e.name,"]"),e.name===vn.JOIN))return C.info("".concat(N," ").concat(y));C.info("".concat(N," ").concat(y),y==="start"?e.options:x||"")}}const l=()=>({tag:e.tag,invokeId:i,sid:t,name:e.name,apiInvokeTime:n,options:e.options,states:e.states||null});u("start");let T=!1;Yn(e.timeout).then(()=>{T||(this.sendApiInvoke(fr(fr({},l()),{},{error:et.API_INVOKE_TIMEOUT,success:!1})),u("timeout"))});const v=new Qt(et.UNEXPECTED_ERROR,"".concat(e.name,": this api invoke is end"));return{onSuccess:y=>{const x=()=>{if(T)throw v;return T=!0,this.sendApiInvoke(fr(fr({},l()),{},{success:!0},e.reportResult&&{result:y})),u("onSuccess"),y};return r?X0(x,e.name+"Success",r,()=>T=!0):x()},onError:y=>{const x=()=>{if(T)throw y;T=!0,this.sendApiInvoke(fr(fr({},l()),{},{success:!1,error:y})),u("onFailure",y.toString())};return r?X0(x,e.name+"Error",r,()=>T=!0):x()}}}sessionInit(t,e){if(this.baseInfoMap.has(t))return;const r=Date.now(),n=this.createBaseInfo(t,r);n.cname=e.cname;const i=Object.assign({},{willUploadConsoleLog:st("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:eg?"global":"oversea",areas:st("AREAS")&&st("AREAS").join(",")},e.extend),{stringUid:o,channelProfile:s,channelMode:c,isABTestSuccess:d,lsid:u,clientRole:l}=e,T=Date.now(),v=fr(fr({},n),{},{eventType:Un.SESSION_INIT,appid:e.appid,browser:navigator.userAgent,buildFormat:e.buildFormat,build:ng,lts:T,elapse:T-r,extend:JSON.stringify(i),mode:e.mode,process:st("PROCESS_ID"),appType:st("APP_TYPE"),success:!0,version:po,stringUid:o,channelProfile:s,channelMode:c,isABTestSuccess:d,lsid:u,clientType:Ce(y=window.navigator.userAgent).call(y,"AgoraWebView")?42:20,clientRole:l,serviceId:st("PROCESS_ID"),extensionID:st("PLUGIN_INFO").join(",")||""});var y;this.send({type:nn.SESSION,data:v},!0)}joinChooseServer(t,e){const r=this.baseInfoMap.get(t);if(!r)return;const n=r.info,i=Date.now(),o=fr(fr({},n),{},{role:e.role,eventType:Un.JOIN_CHOOSE_SERVER,lts:i,eventElapse:e.elapse||i-e.lts,chooseServerAddr:e.csAddr,errorCode:e.ec,elapse:i-r.startTime,success:e.succ,chooseServerAddrList:JSON.stringify(e.serverList),uid:e.uid?parseInt(e.uid):null,cid:e.cid?parseInt(e.cid):null,chooseServerIp:e.csIp||"",opid:e.opid,unilbsServerIds:e.unilbsServerIds,extend:e.extend||void 0,isHttp3:e.isHttp3,corssRegionTagReq:e.corssRegionTagReq||void 0,corssRegionTagRes:e.corssRegionTagRes||void 0,resourceTimingInfo:e.resourceTimingInfo||void 0});this.send({type:nn.JOIN_CHOOSE_SERVER,data:o},!0)}reqUserAccount(t,e){const r=this.baseInfoMap.get(t);if(!r)return;const n=r.info,i=Date.now(),o=fr(fr({},n),{},{eventType:Un.REQ_USER_ACCOUNT,lts:i,success:e.success,serverAddress:e.serverAddr,stringUid:e.stringUid,uid:e.uid,errorCode:e.errorCode,elapse:e.elapse||i-r.startTime,eventElapse:i-e.lts,extend:JSON.stringify(e.extend)});this.send({type:nn.REQ_USER_ACCOUNT,data:o},!0)}joinGateway(t,e){const r=this.baseInfoMap.get(t);if(!r)return;const n=r.info;e.vid&&(n.vid=e.vid),n.uid=e.uid,n.cid=e.cid;const i=Date.now(),{firstSuccess:o,addr:s,isProxy:c}=e,d=i-r.startTime,u=fr(fr({},n),{},{eventType:Un.JOIN_GATEWAY,lts:i,gatewayAddr:e.addr,success:e.succ,errorCode:e.ec,errorMsg:e.errorMsg||"",elapse:d,eventElapse:i-e.lts,firstSuccess:o,signalChannel:e.signalChannel,preload:e.preload?1:0,installId:tg(),isABTestSuccess:e.isABTestSuccess?1:0}),l=u.success?1:0;if(e.succ&&(r.lastJoinSuccessTime=i),o)this.send({type:nn.JOIN_GATEWAY,data:u},!0);else{let T;if(s)if(c){const y=s.match(/h=(\d{1,3}-){3}\d{1,3}/g),x=s.match(/p=[0-9]{1,6}/g);T={isSuccess:l,gatewayIp:y&&y.length?y[0].split("=")[1].replace(/-/g,"."):"",port:x&&x.length?x[0].split("=")[1]:"",isProxy:c?1:0}}else{const y=s.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),x=s.match(/(:|p=)[0-9]{1,6}/g);T={isSuccess:l,gatewayIp:y&&y.length?y[0].split("//")[1].replace(/-/g,"."):"",port:x&&x.length?x[0].split(/:|p=/g)[1]:"",isProxy:c?1:0}}else T={isSuccess:l,gatewayIp:"",port:"",isProxy:c?1:0};delete u.success,delete u.eventType,delete u.firstSuccess,u.vid=Number(u.vid);const v=Object.assign({},u,T,{eventType:Un.REJOIN_GATEWAY});this.send({type:nn.RE_JOIN_GATEWAY,data:v},!0)}}joinChannelTimeout(t,e){const r=this.baseInfoMap.get(t);if(!r)return;const n=Date.now(),i=fr(fr({},r.info),{},{lts:n,timeout:e,elapse:n-r.startTime});this.send({type:nn.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(t,e){const r=this.baseInfoMap.get(t);if(!r)return;const n=r.info,i=Date.now(),o=fr(fr({},n),{},{eventType:Un.PUBLISH,lts:i,eventElapse:e.eventElapse,elapse:i-r.startTime,success:e.succ,errorCode:e.ec,videoName:e.videoName,audioName:e.audioName,screenName:e.screenName,screenshare:e.screenshare,audio:e.audio,video:e.video,p2pid:e.p2pid,publishRequestid:e.publishRequestid});this.send({type:nn.PUBLISH,data:o},!0)}subscribe(t,e,r){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,o=Date.now(),s=fr(fr({},i),{},{eventType:Un.SUBSCRIBE,lts:o,eventElapse:e.eventElapse,elapse:o-n.startTime,success:e.succ,errorCode:e.ec,video:e.video,audio:e.audio,subscribeRequestid:e.subscribeRequestid,p2pid:e.p2pid,preSsrc:e.preSsrc?1:0},r&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof e.peerid=="string"?s.peerSuid=e.peerid:s.peer=e.peerid,this.send({type:nn.SUBSCRIBE,data:s},!0)}wsCompressorInit(t){var e;const r=[...Li(e=this.baseInfoMap).call(e)],n=r.length?r[0]:"UnableToGetSid",i=this.baseInfoMap.get(n);if(!i)return;const o=i.info,s=Date.now(),c=fr(fr({},o),{},{eventType:Un.WS_COMPRESSOR_INIT,lts:s,eventElapse:t.eventElapse,elapse:s-i.startTime,status:t.status?1:2});this.send({type:nn.WS_COMPRESSOR_INIT,data:c},!0)}firstXLAPeerFirstVideoFrame(t,e){const r=this.baseInfoMap.get(t);if(!r)return;const n=r.info,i=Date.now(),o=e.peerPubStatusMs-(r.lastJoinSuccessTime||i),s=fr(fr({},n),{},{elapse:i-r.startTime,eventType:Un.XLA_PEER_FIRST_VIDEO_FRAME,lts:i,peer:e.peer,width:e.width,height:e.height,ssrc:e.ssrc,p2pid:e.p2pid,peerPublishDuration:e.peerPublishDuration,joinChannelSuccessElapse:o,peerPubStatusMs:e.peerPubStatusMs-e.joinChannelStart,availablePublish:e.peerPublishDuration>o?1:0,preloadStart:Math.max(e.preloadStart-e.joinChannelStart,0),preloadEnd:Math.max(e.preloadEnd-e.joinChannelStart,0),encrypt:Math.max(e.apStart-e.joinChannelStart,0),ap:Math.max(e.apEnd-e.joinChannelStart,0),sua:Math.max(e.suaEnd-e.joinChannelStart,0),beforeConnect:Math.max(e.beforeConnect-e.joinChannelStart,0),peerRecevier:Math.max(e.peerReceiver-e.joinChannelStart,0),ice:Math.max(e.ice-e.joinChannelStart,0),pc:Math.max(e.pc-e.joinChannelStart,0),signalConnected:Math.max(e.signalConnected-e.joinChannelStart,0),joinReq:Math.max(e.joinReq-e.joinChannelStart,0),joinRes:Math.max(e.joinRes-e.joinChannelStart,0),userJoinNotify:Math.max(e.userJoinNotify-e.joinChannelStart,0),videoSsrcNotify:Math.max(e.videoAddNotify-e.joinChannelStart,0),subscribeDelayMs:Math.max(e.subscribeStart-e.videoAddNotify,0),subscribeStart:Math.max(e.subscribeStart-e.joinChannelStart,0),subscribeEnd:Math.max(e.subscribeEnd-e.joinChannelStart,0),firstReceived:Math.max(e.firstReceived-e.joinChannelStart,0),firstDecoded:Math.max(e.firstDecoded-e.joinChannelStart,0),firstPreRender:Math.max(e.firstPreRender-e.joinChannelStart,0),firstRender:Math.max(e.firstRender-e.joinChannelStart,0),playDelayMs:Math.max(e.playStart-e.subscribeEnd,0),playStart:Math.max(e.playStart-e.joinChannelStart,0),playEnd:Math.max(e.playEnd-e.joinChannelStart,0),isPreSub:e.isPreSub?1:0,isPrePc:e.isPrePc?1:0,isPreInstantVideo:e.isPreInstantVideo?1:0});this.send({type:nn.XLA_PEER_FIRST_VIDEO_FRAME,data:s},!0)}firstRemoteVideoDecode(t,e,r,n){const i=this.baseInfoMap.get(t);if(!i)return;const o=i.info,s=Date.now(),c=fr(fr(fr({},o),n),{},{elapse:s-i.startTime,eventType:e,lts:s,firstDecodeFrame:Math.max((n.firstFrame||s)-i.startTime,0),apEnd:Math.max(n.apEnd-i.startTime,0),apStart:Math.max(n.apStart-i.startTime,0),joinGwEnd:Math.max(n.joinGwEnd-i.startTime,0),joinGwStart:Math.max(n.joinGwStart-i.startTime,0),pcEnd:Math.max(n.pcEnd-i.startTime,0),pcStart:Math.max(n.pcStart-i.startTime,0),subscriberEnd:Math.max(n.subscriberEnd-i.startTime,0),subscriberStart:Math.max(n.subscriberStart-i.startTime,0),videoAddNotify:Math.max(n.videoAddNotify-i.startTime,0)});this.send({type:r,data:c},!0)}firstRemoteFrame(t,e,r,n){const i=this.baseInfoMap.get(t);if(!i)return;const o=i.info,s=Date.now(),c=fr(fr(fr({},o),n),{},{elapse:s-i.startTime,eventType:e,lts:s});this.send({type:r,data:c},!0)}abTest(t,e){const r=this.baseInfoMap.get(t);if(!r)return;const n=r.info,i=Date.now(),o=fr(fr(fr({},n),e),{},{vid:n.vid===void 0?0:Number(n.vid),elapse:i-r.startTime,eventType:Un.AB_TEST,lts:i});this.send({type:nn.AB_TEST,data:o},!0)}pcStats(t,e){const r=this.baseInfoMap.get(t);if(!r)return;const n=r.info,i=Date.now(),o=fr(fr(fr({},n),e),{},{vid:n.vid===void 0?0:Number(n.vid),elapse:i-r.startTime,eventType:Un.PC_STATS,lts:i,preallocation:e.preallocation?1:0});this.send({type:nn.PC_STATS,data:o},!0)}updateRemoteRTPCapabilities(t,e){if(t){const r=this.baseInfoMap.get(t);if(!r)return;const n=r.info,i=Date.now(),o=fr(fr(fr({},n),e),{},{vid:n.vid===void 0?0:Number(n.vid),eventType:Un.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:nn.UPDATE_REMOTE_RTPCAPABILITIES,data:o},!0)}}onGatewayStream(t,e,r,n){const i=this.baseInfoMap.get(t);if(!i)return;const o=i.info,s=Date.now(),c=fr(fr(fr({},o),n),{},{eventType:e,lts:s});this.send({type:r,data:c},!0)}streamSwitch(t,e){const r=this.baseInfoMap.get(t);if(!r)return;const n=r.info,i=Date.now(),o=fr(fr({},n),{},{eventType:Un.STREAM_SWITCH,lts:i,isDual:e.isdual,elapse:i-r.startTime,success:e.succ});this.send({type:nn.STREAM_SWITCH,data:o},!0)}requestProxyAppCenter(t,e){const r=this.baseInfoMap.get(t);if(!r)return;const n=r.info,i=Date.now(),o=fr(fr({},n),{},{eventType:Un.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-e.lts,elapse:i-r.startTime,APAddr:e.APAddr,workerManagerList:e.workerManagerList,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:nn.REQUEST_PROXY_APPCENTER,data:o},!0)}requestProxyWorkerManager(t,e){const r=this.baseInfoMap.get(t);if(!r)return;const n=r.info,i=Date.now(),o=fr(fr({},n),{},{eventType:Un.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-e.lts,elapse:i-r.startTime,workerManagerAddr:e.workerManagerAddr,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:nn.REQUEST_PROXY_WORKER_MANAGER,data:o},!0)}setProxyServer(t){this.proxyServer=t,t?C.debug("reportProxyServerurl: ".concat(t)):C.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,e){const r=this.baseInfoMap.get(t);if(!r)return;const n=r.info,i=Date.now(),o=fr(fr({},n),{},{subscribeElapse:e.subscribeElapse,peer:e.peer,peerPublishDuration:Math.max(e.audioPublishDuration,e.videoPublishDuration),audiotag:e.audioPublishDuration>0?1:-1,videotag:e.videoPublishDuration>0?1:-1,lts:i,elapse:i-r.startTime,joinChannelSuccessElapse:i-(r.lastJoinSuccessTime||i),peerPublishDurationVideo:e.videoPublishDuration,peerPublishDurationAudio:e.audioPublishDuration});this.send({type:nn.PEER_PUBLISH_STATUS,data:o},!0)}workerEvent(t,e){const r=this.baseInfoMap.get(t);if(!r)return;const n=r.info,i=Date.now();(function(o,s,c){const d=o[s];if(!d||typeof d!="string")return[o];o[s]="";const u=Rs(JSON.stringify(o));let l=0;const T=[];let v=0;for(let y=0;y<d.length;y++)v+=d.charCodeAt(y)<=127?1:3,v<=c-u||(T[T.length]=ve(ve({},o),{},{[s]:d.substring(l,y)}),l=y,v=d.charCodeAt(y)<=127?1:3);return l!==d.length-1&&(T[T.length]=ve(ve({},o),{},{[s]:d.substring(l)})),T})(fr(fr(fr({},n),e),{},{elapse:i-r.startTime,lts:i,productType:"WebRTC"}),"payload",1300).forEach(o=>this.send({type:nn.WORKER_EVENT,data:o},!0))}apworkerEvent(t,e){const r=this.baseInfoMap.get(t);if(!r)return;const n=r.info,i=Date.now(),o=fr(fr(fr({},n),e),{},{elapse:i-r.startTime,lts:i});this.send({type:nn.AP_WORKER_EVENT,data:o},!0)}joinWebProxyAP(t,e){const r=this.baseInfoMap.get(t);if(!r)return;const n=r.info,i=Date.now(),o=fr(fr(fr({},n),e),{},{elapse:i-r.startTime,lts:i,extend:e.extend||void 0});this.send({type:nn.JOIN_WEB_PROXY_AP,data:o},!0)}WebSocketQuit(t,e){const r=this.baseInfoMap.get(t);if(!r)return;const n=r.info,i=Date.now(),o=fr(fr(fr({},n),e),{},{elapse:i-r.startTime,lts:i});this.send({type:nn.WEBSOCKET_QUIT,data:o},!0)}async sendCustomReportMessage(t,e){if(this.customReportCount+=e.length,this.customReportCount>st("CUSTOM_REPORT_LIMIT"))throw new Qt(et.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const r=Date.now(),n=e.map(i=>({type:nn.USER_ANALYTICS,data:fr(fr({sid:t},i),{},{lts:r})}));try{st("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(n):await this.postDataToStatsCollector(n)}catch(i){throw C.error("send custom report message failed",i.toString()),new Qt(et.CUSTOM_REPORT_SEND_FAILED,i.message)}}sendApiInvoke(t){const e=st("NOT_REPORT_EVENT");if(t.tag&&Ce(e)&&Ce(e).call(e,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const r=this.baseInfoMap.get(t.sid);if(!r)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:n,uid:i,cid:o}=r.info;let s;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof Qt){const{code:d,message:u}=t.error;s=d||u||t.error.toString()}else s=t.error.toString();const c={invokeId:t.invokeId,sid:t.sid,cname:n,cid:o,uid:i,lts:t.lts,success:t.success,elapse:t.lts-r.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?s:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:nn.API_INVOKE,data:c},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const e=Array.from(this.sids).find(r=>r!==null);e&&t.forEach(r=>{r&&(r.sid=e,this.sendApiInvoke(Object.assign({},r)))}),t.length=0}send(t,e){if(e)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>st("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,e){const r=[],n=[];for(;t.length;){const o=t.shift();r.length<20?r.push(o):n.push(o)}t.push(...n);for(const o of[...r]){var i;this.ltsList.indexOf(o.data.lts)!==-1?(o.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(o.data.lts)):(this.ltsList.push(o.data.lts),tc(i=this.ltsList).call(i,(s,c)=>s-c))}return e||(this.lastSendNormalEventTime=Date.now()),st("ENABLE_EVENT_REPORT")&&r.length&&(st("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(r):this.postDataToStatsCollector(r)).catch((o=>s=>{st("EVENT_REPORT_RETRY")&&(e?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(o):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(o),this.normalEventUploadPendingItems.length>st("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-st("NORMAL_EVENT_QUEUE_CAPACITY")),C.warning("report: drop normal events"))))})(r)),t}async postDataToStatsCollector2(t){In.networkState===Ki.OFFLINE&&await De.race([In.onlineWaiter,Yn(2*bn.maxRetryTimeout)]);const e=i=>{let o=new Uint8Array;return i.forEach(s=>{const c=GE(JSON.stringify(s.data)),d=new ArrayBuffer(5),u=(T=>{let v=0;return Object.entries(nn).forEach(y=>{let[x,N]=y;N===T.type&&(v=y6[x])}),v})(s),l=new DataView(d);l.setUint16(0,c.byteLength,!0),l.setUint8(2,255&u),l.setUint8(3,u>>>8&255),l.setUint8(4,u>>>16&255),o=B0(o,new Uint8Array(d)),o=B0(o,c)}),o},r="event";let n=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(st("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(r):"https://".concat(st("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(r);for(let i=0;i<2;i+=1){i===1&&(n=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(st("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(r):"https://".concat(st("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(r));try{await XE(n,{timeout:1e4,data:e(t),headers:fr(fr({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(o){if(i===1)throw o;continue}return}}async postDataToStatsCollector(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=(c=>{const d=c&&c.data.sid&&this.baseInfoMap.get(c.data.sid);return d&&d.info.vid&&+d.info.vid||0})(t[0]),n=r?void 0:this._aid,i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(c=>JSON.stringify(c)),vid:r,aid:n};In.networkState===Ki.OFFLINE&&await De.race([In.onlineWaiter,Yn(2*bn.maxRetryTimeout)]);const o=e?"/events/proto-raws":"/events/messages";let s=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(st("EVENT_REPORT_DOMAIN"),"&p=").concat(st("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(st("EVENT_REPORT_DOMAIN"),":").concat(st("STATS_COLLECTOR_PORT")).concat(o));for(let c=0;c<2;c+=1){c===1&&(s=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(st("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(st("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(st("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(st("STATS_COLLECTOR_PORT")).concat(o)));try{e?await s6(s,{timeout:1e4,data:i}):await XE(s,{timeout:1e4,data:i})}catch(d){if(c===1)throw d;continue}return}}createBaseInfo(t,e){const r=Object.assign({},v6);return r.sid=t,this.baseInfoMap.set(t,{info:r,startTime:e}),r}reportResourceTiming(t,e){const r=performance.getEntriesByName(t),n=r[r.length-1];n&&this.reportApiInvoke(e,{name:"Client.resourceTiming",options:n,tag:cn.TRACER}).onSuccess()}};fA.on("REPORT_LOG_UPLOAD",t=>{t.networkState=In.networkState,qe.reportApiInvoke(null,{name:"logUploadError",options:t,tag:cn.TRACER}).onSuccess("logUploadError")});class Bt extends Qt{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),En(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,C)}throw(){super.throw(C)}}const Xn={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function br(){return Xn}function EA(){return"setSinkId"in HTMLAudioElement.prototype&&(!st("RESTRICTION_SET_PLAYBACK_DEVICE")||(Ks()||O0())&&!jE())}function Pp(){return!Xn.supportUnifiedPlan||st("CHROME_FORCE_PLAN_B")&&zs()}function ag(t){return!(mn()||w0(87)||Pp()||!st("ENABLE_PRE_SUB")&&(t==null||!t.autoSubscribe||st("FORCE_DISABLE_AUTO_SUB")))}function gA(t){return!!st("ENABLE_INSTANT_VIDEO")||!(t==null||!t.autoSubscribe||st("FORCE_DISABLE_AUTO_SUB"))}let Jn=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function Rd(t,e,r){return{sampleRate:t,stereo:e,bitrate:r}}function Or(t,e,r,n,i){return{width:t,height:e,frameRate:r,bitrateMin:n,bitrateMax:i}}function Mo(t,e,r,n,i){return{width:{max:t},height:{max:e},frameRate:r,bitrateMin:n,bitrateMax:i}}function cg(t,e){return{numSpatialLayers:t,numTemporalLayers:e}}const S6={"90p":Or(160,90),"90p_1":Or(160,90),"120p":Or(160,120,15,30,65),"120p_1":Or(160,120,15,30,65),"120p_3":Or(120,120,15,30,50),"120p_4":Or(212,120),"180p":Or(320,180,15,30,140),"180p_1":Or(320,180,15,30,140),"180p_3":Or(180,180,15,30,100),"180p_4":Or(240,180,15,30,120),"240p":Or(320,240,15,40,200),"240p_1":Or(320,240,15,40,200),"240p_3":Or(240,240,15,40,140),"240p_4":Or(424,240,15,40,220),"360p":Or(640,360,15,80,400),"360p_1":Or(640,360,15,80,400),"360p_3":Or(360,360,15,80,260),"360p_4":Or(640,360,30,80,600),"360p_6":Or(360,360,30,80,400),"360p_7":Or(480,360,15,80,320),"360p_8":Or(480,360,30,80,490),"360p_9":Or(640,360,15,80,800),"360p_10":Or(640,360,24,80,800),"360p_11":Or(640,360,24,80,1e3),"480p":Or(640,480,15,100,500),"480p_1":Or(640,480,15,100,500),"480p_2":Or(640,480,30,100,1e3),"480p_3":Or(480,480,15,100,400),"480p_4":Or(640,480,30,100,750),"480p_6":Or(480,480,30,100,600),"480p_8":Or(848,480,15,100,610),"480p_9":Or(848,480,30,100,930),"480p_10":Or(640,480,10,100,400),"720p":Or(1280,720,15,120,1130),"720p_auto":Or(1280,720,30,900,3e3),"720p_1":Or(1280,720,15,120,1130),"720p_2":Or(1280,720,30,120,2e3),"720p_3":Or(1280,720,30,120,1710),"720p_5":Or(960,720,15,120,910),"720p_6":Or(960,720,30,120,1380),"1080p":Or(1920,1080,15,120,2080),"1080p_1":Or(1920,1080,15,120,2080),"1080p_2":Or(1920,1080,30,120,3e3),"1080p_3":Or(1920,1080,30,120,3150),"1080p_5":Or(1920,1080,60,120,4780),"1440p":Or(2560,1440,30,120,4850),"1440p_1":Or(2560,1440,30,120,4850),"1440p_2":Or(2560,1440,60,120,7350),"4k":Or(3840,2160,30,120,8910),"4k_1":Or(3840,2160,30,120,8910),"4k_3":Or(3840,2160,60,120,13500)},R6={"480p":Mo(640,480,5),"480p_1":Mo(640,480,5),"480p_2":Mo(640,480,30),"480p_3":Mo(640,480,15),"720p":Mo(1280,720,5),"720p_auto":Or(1280,720,30,900,3e3),"720p_1":Mo(1280,720,5),"720p_2":Mo(1280,720,30),"720p_3":Mo(1280,720,15),"1080p":Mo(1920,1080,5),"1080p_1":Mo(1920,1080,5),"1080p_2":Mo(1920,1080,30),"1080p_3":Mo(1920,1080,15)},I6={"1SL1TL":cg(1,1),"3SL3TL":cg(3,3),"2SL3TL":cg(2,3)};function Uo(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},S6[t]):t}function dg(t){return typeof t=="string"?Object.assign({},R6[t]):t}function Dp(t){return typeof t=="string"?Object.assign({},I6[t]):t}const C6={speech_low_quality:Rd(16e3,!1),speech_standard:Rd(32e3,!1,18),music_standard:Rd(48e3,!1),standard_stereo:Rd(48e3,!0,56),high_quality:Rd(48e3,!1,128),high_quality_stereo:Rd(48e3,!0,192)};function kp(t){return typeof t=="string"?Object.assign({},C6[t]):t}const Id=[];function TA(t){return Mn(t,"mediaSource",["screen","window","application"]),!0}let Ge=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),Wr=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),Cd=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),A6=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),b6=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),pc=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),Ad=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),mo=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t.PLAY_START="play-start",t.PLAY_END="play-end",t.FIRST_FRAME_RENDER="first-frame-render",t}({}),bd=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),eo=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const ug={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},lg={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},vA={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},O6={uplinkNetworkQuality:0,downlinkNetworkQuality:0},yA={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Si=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),ro=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),el=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),fc=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),ai=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),Cs=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const hg={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let Lp=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function Sr(t,e,r,n,i){var o,s,c={};return Object.keys(n).forEach(function(d){c[d]=n[d]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=Ao(o=iv(s=r.slice()).call(s)).call(o,function(d,u){return u(t,e,d)||d},c),i&&c.initializer!==void 0&&(c.value=c.initializer?c.initializer.call(i):void 0,c.initializer=void 0),c.initializer===void 0?(Object.defineProperty(t,e,c),null):c}function xt(t,e,r){return(e=function(n){var i=function(o,s){if(typeof o!="object"||!o)return o;var c=o[Symbol.toPrimitive];if(c!==void 0){var d=c.call(o,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(n);return typeof i=="symbol"?i:i+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function SA(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Xr(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?SA(Object(r),!0).forEach(function(n){xt(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):SA(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}class RA extends pn{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(pc.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,r){super(),xt(this,"trackMediaType",void 0),xt(this,"_ID",void 0),xt(this,"_rtpTransceiver",void 0),xt(this,"_lowRtpTransceiver",void 0),xt(this,"_hints",[]),xt(this,"_isClosed",!1),xt(this,"_originMediaStreamTrack",void 0),xt(this,"mediaStreamTrack",void 0),xt(this,"_external",{}),this._ID=r||zr(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(n){Ce(Id).call(Id,n)||Id.push(n)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||Ra(()=>{var r;qe.reportApiInvoke(null,{name:vn.GET_MEDIA_STREAM_TRACK,options:[],tag:cn.TRACER}).onSuccess(((r=this._mediaStreamTrack)===null||r===void 0?void 0:r.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===Cd.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const r=Id.indexOf(e);r!==-1&&Id.splice(r,1)}(this),this.emit(Ad.CLOSED),this.removeAllListeners(pc.SEI_RECEIVED)}_updateRtpTransceiver(e,r){if(r===Cd.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(pc.TRANSCEIVER_UPDATED,e,r)}}class Od extends RA{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,r){super(e,r),xt(this,"_enabled",!0),xt(this,"_muted",!1),xt(this,"_isExternalTrack",!1),xt(this,"_isClosed",!1),xt(this,"_enabledMutex",void 0),xt(this,"processor",void 0),xt(this,"_processorContext",void 0),xt(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new si("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,r;return(e=(r=this._originMediaStreamTrack)===null||r===void 0?void 0:r.label)!==null&&e!==void 0?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,C.debug("[".concat(this.getTrackId(),"] close")),this.emit(Ge.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,r){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=n,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Kr(this,Ge.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){C.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Ad.TRACK_ENDED)}stateCheck(e,r){if(C.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(r,"]")),ns(r,e),this._enabled&&this._muted&&e==="enabled"&&r===!1)throw new Qt(et.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",C);if(!this._enabled&&!this._muted&&e==="muted"&&r===!0)throw new Qt(et.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",C)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():De.resolve([])}}const IA=window.AudioContext||window.webkitAudioContext;let no=null;const Fr=new class extends pn{constructor(){super(...arguments),xt(this,"prevState",void 0),xt(this,"curState",void 0),xt(this,"currentTime",void 0),xt(this,"currentTimeStuckAt",void 0),xt(this,"interruptDetectorTrack",void 0),xt(this,"onLocalAudioTrackMute",()=>{C.info("ios15-interruption-start"),this.emit(Jn.IOS_15_16_INTERRUPTION_START)}),xt(this,"onLocalAudioTrackUnmute",async()=>{C.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?C.info("ios15-interruption-end-canceled"):(no&&await no.suspend(),this.emit(Jn.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){C.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){C.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function wd(){if(!no){if(function(){if(!IA)return void C.error("your browser is not support web audio");C.info("create audio context");const t=Xr({},st("WEBAUDIO_INIT_OPTIONS"));C.debug("audio context init option:",JSON.stringify(t)),no=new IA(t),Fr.curState=no.state,no.onstatechange=()=>{Fr.prevState=Fr.curState,Fr.curState=no?no.state:void 0;const{prevState:e,curState:r}=Fr,n=r==="running",i=r==="interrupted",o=e==="running",s=e==="suspended",c=e==="interrupted",d=Rr().osVersion;(mi()||ko())&&o&&i&&(C.info("ios".concat(d,"-interruption-start")),Fr.emit(Jn.IOS_INTERRUPTION_START)),(mi()||ko())&&(s||c)&&n&&(C.info("ios".concat(d,"-interruption-end")),Fr.emit(Jn.IOS_INTERRUPTION_END)),e!==r&&Fr.emit(Jn.STATE_CHANGE,r,e)},setInterval(()=>{var e;const r=(e=no)===null||e===void 0?void 0:e.currentTime;Fr.currentTime!==r?(Fr.currentTimeStuckAt&&(C.debug("AudioContext current time resume at ".concat(r)),Fr.currentTimeStuckAt=void 0),Fr.currentTime=r):(r!==Fr.currentTimeStuckAt&&(qe.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:r},tag:cn.TRACER}).onSuccess(),C.warning("AudioContext current time stuck at ".concat(r))),Fr.currentTimeStuckAt=r)},5e3),async function(e){const r=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let n,i=!1,o=!1,s=!1;function c(N){e.state==="running"?d(!1):mi()||ko()?e.state==="suspended"&&(d(!0),N&&e.resume().then(u,u)):e.state!=="closed"&&(d(!0),N&&e.resume().then(u,u))}function d(N){if(i!==N){i=N;for(let L=0,Q=r;L<Q.length;L+=1){const J=Q[L];N?window.addEventListener(J,l,{capture:!0,passive:!0}):window.removeEventListener(J,l,{capture:!0,passive:!0})}}}function u(){c(!1)}function l(){c(!0)}function T(N){if(!s)if(n.paused)if(N){let L;v(!1),s=!0;try{L=n.play(),L?L.then(y,y):(n.addEventListener("playing",y),n.addEventListener("abort",y),n.addEventListener("error",y))}catch{y()}}else v(!0);else v(!1)}function v(N){if(o!==N){o=N;for(let L=0,Q=r;L<Q.length;L++){const J=Q[L];N?window.addEventListener(J,x,{capture:!0,passive:!0}):window.removeEventListener(J,x,{capture:!0,passive:!0})}}}function y(){n.removeEventListener("playing",y),n.removeEventListener("abort",y),n.removeEventListener("error",y),s=!1,T(!1)}function x(){T(!0)}if(mi()){const N=e.createMediaStreamDestination(),L=document.createElement("div");L.innerHTML="<audio x-webkit-airplay='deny'></audio>",n=L.children.item(0),n.controls=!1,n.disableRemotePlayback=!0,n.preload="auto",n.srcObject=N.stream,T(!0)}Fr.on(Jn.STATE_CHANGE,function(){c(!0)}),c(!1)}(no)}(),!no)throw new Qt(et.NOT_SUPPORTED,"can not create audio context");return no}return no}function mc(t){if(function(){if(pg!==null)return pg;const n=wd(),i=n.createBufferSource(),o=n.createGain(),s=n.createGain();i.connect(o),i.connect(s),i.disconnect(o);let c=!1;try{i.disconnect(o)}catch{c=!0}return i.disconnect(),pg=c,c}())return;const e=t.connect,r=t.disconnect;t.connect=(n,i,o)=>{var s;return t._inputNodes||(t._inputNodes=[]),Ce(s=t._inputNodes).call(s,n)||(n instanceof AudioNode?(t._inputNodes.push(n),e.call(t,n,i,o)):e.call(t,n,i)),t},t.disconnect=(n,i,o)=>{r.call(t),n?Rp(t._inputNodes,n):t._inputNodes=[];for(const s of t._inputNodes)e.call(t,s)}}let pg=null;function fg(t,e){let r=!1;const n=1/e;if(st("DISABLE_WEBAUDIO")){const i=window.setInterval(()=>{r?window.clearInterval(i):t(performance.now()/1e3)},1e3*n)}else{const i=wd();let o=i.createGain();o.gain.value=0,o.connect(i.destination);const s=()=>{if(r)return void(o=null);const c=i.createOscillator();c.onended=s,c.connect(o),c.start(0),c.stop(i.currentTime+n),t(i.currentTime)};s()}return()=>{r=!0}}class CA{constructor(){xt(this,"context",void 0),xt(this,"analyserNode",void 0),xt(this,"sourceNode",void 0),this.context=wd(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,e?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||mi()||ko()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const n=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(n);for(let i=0;i<e.length;++i)e[i]=n[i]/128-1}const r=Ao(e).call(e,(n,i)=>n+i*i,0)/e.length;return Math.max(10*Math.log10(r)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,r;(e=this.sourceNode)===null||e===void 0||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(r=this.sourceNode)===null||r===void 0||r.connect(this.analyserNode)}catch{C.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class AA extends pn{get processSourceNode(){return this.sourceNode}set processedNode(e){var r;if(!this.isDestroyed&&this._processedNode!==e){try{var n;(n=this.sourceNode)===null||n===void 0||n.disconnect(this.outputNode)}catch{}(r=this._processedNode)===null||r===void 0||r.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),xt(this,"outputNode",void 0),xt(this,"outputTrack",void 0),xt(this,"isPlayed",!1),xt(this,"sourceNode",void 0),xt(this,"context",void 0),xt(this,"audioBufferNode",void 0),xt(this,"destNode",void 0),xt(this,"audioOutputLevel",0),xt(this,"volumeLevelAnalyser",void 0),xt(this,"_processedNode",void 0),xt(this,"playNode",void 0),xt(this,"isDestroyed",!1),xt(this,"onNoAudioInput",void 0),xt(this,"isNoAudioInput",!1),xt(this,"_noAudioInputCount",0),this.context=wd(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),mc(this.outputNode),this.volumeLevelAnalyser=new CA}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=r=>{this.emit(eo.ON_AUDIO_BUFFER,function(n){for(let i=0;i<n.outputBuffer.numberOfChannels;i+=1){const o=n.outputBuffer.getChannelData(i);for(let s=0;s<o.length;s+=1)o[s]=0}return n.inputBuffer}(r))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!br().webAudioMediaStreamDest)throw new Qt(et.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&Ip(()=>{Fr.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;mi()||ko()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const r=this.volumeLevelAnalyser.getAnalyserNode();let n;r.getFloatTimeDomainData?(n=new Float32Array(r.fftSize),r.getFloatTimeDomainData(n)):(n=new Uint8Array(r.fftSize),r.getByteTimeDomainData(n));let i=!1;for(let o=0;o<n.length;o++)n[o]!==0&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(await Yn(200),await this.checkHasAudioInput(e?e+1:1)&&i)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,r;(e=this.processedNode)===null||e===void 0||e.disconnect(),(r=this.sourceNode)===null||r===void 0||r.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?(e=this.processedNode)===null||e===void 0||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class bA extends AA{get isFreeze(){return!1}constructor(e,r,n){var i;if(super(),xt(this,"sourceNode",void 0),xt(this,"track",void 0),xt(this,"clonedTrack",void 0),xt(this,"audioElement",void 0),xt(this,"isCurrentTrackCloned",!1),xt(this,"isRemoteTrack",!1),xt(this,"originVolumeLevelAnalyser",void 0),xt(this,"rebuildWebAudio",async()=>{if(C.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void C.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>C.info("resume success")),C.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const c=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?c.stop():this.isCurrentTrackCloned=!0;const d=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(d),mc(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const u=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(u,this.context.currentTime),mc(this.outputNode),this.emit(eo.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=d,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e.kind!=="audio")throw new Qt(et.UNEXPECTED_ERROR);this.track=e;const o=new MediaStream([this.track]);if(this.isRemoteTrack=!!r,this.sourceNode=this.context.createMediaStreamSource(o),mc(this.sourceNode),n){const c=n.clone();c.enabled=!0,this.clonedTrack=c,C.debug("create an unmuted track ".concat(c.id," from the original track ").concat(n.id," to get the volume"));const d=this.context.createMediaStreamSource(new MediaStream([c]));mc(d),this.originVolumeLevelAnalyser=new CA,this.originVolumeLevelAnalyser.updateSource(d)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=o;const s=Rr();r&&s.os===Vn.IOS&&Number((i=s.osVersion)===null||i===void 0?void 0:i.split(".")[0])<15&&(Fr.on(Jn.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(c=>{c||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const r=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(r),mc(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(eo.UPDATE_SOURCE),this.audioElement.srcObject=r}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),Fr.off("state-change",this.rebuildWebAudio),(e=this.originVolumeLevelAnalyser)===null||e===void 0||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const r=e.clone();r.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=r),C.debug("create an unmuted track ".concat(r.id," from the original track ").concat(e.id," to get the volume"));const n=this.context.createMediaStreamSource(new MediaStream([r]));mc(n),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(n)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function OA(t,e,r){const n=(o,s)=>o?typeof o!="number"?o.max||o.exact||o.ideal||o.min||s:o:s,i={audio:!!r&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:n(e.height,1080),maxWidth:n(e.width,1920)}}};return e.frameRate&&typeof e.frameRate!="number"?(i.video.mandatory.maxFrameRate=e.frameRate.max,i.video.mandatory.minFrameRate=e.frameRate.min):typeof e.frameRate=="number"&&(i.video.mandatory.maxFrameRate=e.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function w6(t,e){const r=await wA(t.mediaSource),{sourceId:n,audio:i}=await function(o){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new De((c,d)=>{const u=document.createElement("div");u.innerText="share screen",u.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const l=document.createElement("div");l.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const T=document.createElement("div");T.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",T.setAttribute("style","height: 12%;");const v=document.createElement("div");v.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const y=document.createElement("div");y.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const x=document.createElement("button");x.innerHTML="cancel",x.setAttribute("style","width: 85px;"),x.onclick=()=>{document.body.removeChild(Q);const J=new Error("NotAllowedError");J.name="NotAllowedError",d(J)};let N=s;const L=document.createElement("div");if(s){const J=document.createElement("input");J.setAttribute("type","checkbox");const at=document.createElement("span");J.setAttribute("style","margin-right: 6px;"),at.innerText="Share audio",J.checked=N,J.onchange=()=>{N=J.checked},L.appendChild(J),L.appendChild(at)}y.appendChild(L),y.appendChild(x),l.appendChild(T),l.appendChild(v),l.appendChild(y);const Q=document.createElement("div");Q.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),Q.appendChild(u),Q.appendChild(l),document.body.appendChild(Q),o.map(J=>{if(J.id){const at=document.createElement("div");at.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Rt=J.thumbnail;try{const{width:vt}=Rt.getSize();vt>1920&&(Rt=Rt.resize({width:1920}))}catch(vt){throw vt&&vt.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),vt}at.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Rt.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+J.name.replace(/[\u00A0-\u9999<>\&]/g,function(vt){return"&#"+vt.charCodeAt(0)+";"})+"</span>",at.onclick=()=>{document.body.removeChild(Q),c({sourceId:J.id,audio:N})},v.appendChild(at)}})})}(r,e);return await OA(n,t,i)}async function wA(t){let e=["window","screen"];t!=="application"&&t!=="window"||(e=["window"]),t==="screen"&&(e=["screen"]);const r=F0();if(!r)throw console.error("failed to fetch electron, please mount it to window"),new Qt(et.ELECTRON_IS_NULL);let n=null;try{var i;n=((i=r.desktopCapturer)===null||i===void 0?void 0:i.getSources({types:e}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:e})}catch{n=null}n&&n.then||(n=new De((o,s)=>{r.desktopCapturer.getSources({types:e},(c,d)=>{c?s(c):o(d)})}));try{return await n}catch(o){throw new Qt(et.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,o.toString())}}const mg=new si("safari");let NA=!1,PA=!1;async function io(t,e){let r=0,n=null;for(;r<2;)try{n=await N6(t,e,r>0);break}catch(i){if(i instanceof Qt)throw C.error("[".concat(e,"] ").concat(i.toString())),i;const o=Mp(i.name||i.code||i,i.message);if(o.code===et.MEDIA_OPTION_INVALID){C.debug("[".concat(e,"] detect media option invalid, retry")),r+=1,await Yn(500);continue}throw C.error("[".concat(e,"] ").concat(o.toString())),o}if(!n)throw new Qt(et.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return n}async function N6(t,e,r){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Qt(et.NOT_SUPPORTED,"can not find getUserMedia");r&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const n=br(),i=new MediaStream;if(t.audioSource&&i.addTrack(t.audioSource),t.videoSource&&i.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return C.debug("Using Video Source/ Audio Source"),i;if(t.screen)if(F0())t.screen.sourceId?Nd(i,await OA(t.screen.sourceId,t.screen,!!t.screenAudio)):Nd(i,await w6(t.screen,!!t.screenAudio));else if(Ks()&&t.screen.extensionId&&t.screen.mandatory){if(!n.getStreamFromExtension)throw new Qt(et.NOT_SUPPORTED,"This browser does not support screen sharing");C.debug("[".concat(e,'] Screen access on chrome stable, looking for extension"'));const v=await(s=t.screen.extensionId,c=e,new De((y,x)=>{try{chrome.runtime.sendMessage(s,{getStream:!0},N=>{if(!N||!N.streamId)return C.error("[".concat(c,"] No response from Chrome Plugin. Plugin not installed properly"),N),void x(new Qt(et.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));y(N.streamId)})}catch(N){C.error("[".concat(c,"] AgoraRTC screensharing plugin is not accessible(").concat(s,")"),N.toString()),x(new Qt(et.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=v,Nd(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(n.getDisplayMedia){var o;t.screen.mediaSource&&TA(t.screen.mediaSource);const v={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(o=t.screen.displaySurface)!==null&&o!==void 0?o:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:y,surfaceSwitching:x,systemAudio:N,preferCurrentTab:L}=t.screen,Q={selfBrowserSurface:y,surfaceSwitching:x,systemAudio:N,preferCurrentTab:L};!y&&delete Q.selfBrowserSurface,!x&&delete Q.surfaceSwitching,!N&&delete Q.systemAudio,!L&&delete Q.preferCurrentTab,C.debug("[".concat(e,"] getDisplayMedia:"),JSON.stringify({video:v,audio:t.screenAudio,controls:Q})),Nd(i,await navigator.mediaDevices.getDisplayMedia(Xr({video:v,audio:t.screenAudio},Q)))}else{if(!mn())throw C.error("[".concat(e,"] This browser does not support screenSharing")),new Qt(et.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&TA(t.screen.mediaSource);const v={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};C.debug("[".concat(e,"] getUserMedia: ").concat(JSON.stringify(v))),Nd(i,await navigator.mediaDevices.getUserMedia(v))}}var s,c;if(!t.video&&!t.audio)return i;let d={video:t.video,audio:t.audio},u=st("MEDIA_DEVICE_CONSTRAINTS");if(u)try{typeof u=="string"&&(u=JSON.parse(u)),d=KE(d,u)}catch{}C.debug("[".concat(e,"] GetUserMedia"),JSON.stringify(d)),Rr();let l,T=null;(ei()||mi()||yp())&&(T=await mg.lock());try{l=await navigator.mediaDevices.getUserMedia(d)}catch(v){throw T&&T(),v}return d.audio&&(NA=!0),d.video&&(PA=!0),Nd(i,l),T&&T(),i}function Mp(t,e){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Qt(et.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(e));case"NotFoundError":case"DevicesNotFoundError":return new Qt(et.DEVICE_NOT_FOUND,"".concat(t,": ").concat(e));case"NotSupportedError":return new Qt(et.NOT_SUPPORTED,"".concat(t,": ").concat(e));case"NotReadableError":return new Qt(et.NOT_READABLE,"".concat(t,": ").concat(e));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Qt(et.PERMISSION_DENIED,"".concat(t,": ").concat(e));case"ConstraintNotSatisfiedError":return new Qt(et.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(e));default:return C.error("getUserMedia unexpected error",t),new Qt(et.UNEXPECTED_ERROR,"".concat(t,": ").concat(e))}}function Nd(t,e){const r=t.getVideoTracks()[0],n=t.getAudioTracks()[0],i=e.getVideoTracks()[0],o=e.getAudioTracks()[0];o&&(n&&t.removeTrack(n),t.addTrack(o)),i&&(r&&t.removeTrack(r),t.addTrack(i))}const oo=new class extends pn{get state(){return this._state}set state(t){t!==this._state&&(this.emit(fc.STATE_CHANGE,t),this._state=t)}constructor(){super(),xt(this,"_state",el.IDLE),xt(this,"isAccessMicrophonePermission",!1),xt(this,"isAccessCameraPermission",!1),xt(this,"lastAccessMicrophonePermission",!1),xt(this,"lastAccessCameraPermission",!1),xt(this,"checkdeviceMatched",!1),xt(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(st("ENUMERATE_DEVICES_INTERVAL")||(Sp()||vp()===Vn.HARMONY_OS)&&zs())&&this.updateDevicesInfo()},st("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>C.error(t.toString()))}async enumerateDevices(t,e){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Qt(et.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const n=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(n);let o=!this.isAccessMicrophonePermission&&t,s=!this.isAccessCameraPermission&&e;i.audio&&(o=!1),i.video&&(s=!1);let c=null,d=null,u=null;if(!r&&(o||s)){if(mg.isLocked&&(C.debug("[device manager] wait GUM lock"),(await mg.lock())(),C.debug("[device manager] GUM unlock")),NA&&(o=!1,this.isAccessMicrophonePermission=!0),PA&&(s=!1,this.isAccessCameraPermission=!0),C.debug("[device manager] check media device permissions",t,e,o,s),o&&s){try{u=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(l){const T=Mp(l.name||l.code||l,l.message);if(T.code===et.PERMISSION_DENIED)throw T;C.warning("getUserMedia failed in getDevices",T)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(o){try{c=await navigator.mediaDevices.getUserMedia({audio:t})}catch(l){const T=Mp(l.name||l.code||l,l.message);if(T.code===et.PERMISSION_DENIED)throw T;C.warning("getUserMedia failed in getDevices",T)}this.isAccessMicrophonePermission=!0}else if(s){try{d=await navigator.mediaDevices.getUserMedia({video:e})}catch(l){const T=Mp(l.name||l.code||l,l.message);if(T.code===et.PERMISSION_DENIED)throw T;C.warning("getUserMedia failed in getDevices",T)}this.isAccessCameraPermission=!0}C.debug("[device manager] mic permission",t,"cam permission",e)}try{const l=await navigator.mediaDevices.enumerateDevices();return c&&c.getTracks().forEach(T=>T.stop()),d&&d.getTracks().forEach(T=>T.stop()),u&&u.getTracks().forEach(T=>T.stop()),c=null,d=null,u=null,l}catch(l){return c&&c.getTracks().forEach(T=>T.stop()),d&&d.getTracks().forEach(T=>T.stop()),u&&u.getTracks().forEach(T=>T.stop()),c=null,d=null,u=null,new Qt(et.ENUMERATE_DEVICES_FAILED,l.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(e=>e.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audiooutput")}searchDeviceIdByName(t){let e=null;return this.deviceInfoMap.forEach(r=>{r.device.label===t&&(e=r.device.deviceId)}),e}async getDeviceById(t){const e=(await this.enumerateDevices(!0,!0,!0)).find(r=>r.deviceId===t);if(!e)throw new Qt(et.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return e}async init(){this.state=el.INITING;try{await this.updateDevicesInfo(),this.state=el.INITEND}catch(t){throw C.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=el.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Qt(et.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),e=Date.now(),r=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const i=t.find(s=>s.kind==="audioinput"&&s.deviceId==="default"),o=t.find(s=>s.kind==="audiooutput"&&s.deviceId==="default");i&&o?o.groupId===i.groupId?C.debug("[device-check] default input ".concat(i.label," and output ").concat(o.label," is the same group")):C.debug("[device-check] default input ".concat(i.label," and output ").concat(o.label," is not the same group")):C.debug("[device-check] default input or output not found")}const n=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(i=>{if(!i.deviceId)return;const o=this.deviceInfoMap.get("".concat(i.kind,"_").concat(i.deviceId));if((o?o.state:"INACTIVE")!=="ACTIVE"){const s={initAt:e,updateAt:e,device:i,state:"ACTIVE"};this.deviceInfoMap.set("".concat(i.kind,"_").concat(i.deviceId),s),r.push(s)}o&&(o.updateAt=e)}),this.deviceInfoMap.forEach((i,o)=>{i.state==="ACTIVE"&&i.updateAt!==e&&(i.state="INACTIVE",r.push(i))}),this.state!==el.INITEND)return n.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(n.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));r.forEach(i=>{switch(i.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(fc.RECORDING_DEVICE_CHANGED,i);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(fc.CAMERA_DEVICE_CHANGED,i);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(fc.PLAYOUT_DEVICE_CHANGED,i)}}),n.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),n.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const e=t.filter(i=>i.kind==="audioinput"),r=t.filter(i=>i.kind==="videoinput"),n={audio:!1,video:!1};for(const i of e)if(i.label&&i.deviceId){n.audio=!0;break}for(const i of r)if(i.label&&i.deviceId){n.video=!0;break}return n}};let _g=!1;const so=new class extends pn{constructor(){super(...arguments),xt(this,"onAutoplayFailed",void 0),xt(this,"onAudioAutoplayFailed",void 0)}};function DA(){if(Rr(),!_g){const t=e=>{e.preventDefault(),_g=!1,Ku()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};_g=!0,Ku()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),C.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),so.onAutoplayFailed?so.onAutoplayFailed():so.onAudioAutoplayFailed?C.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):C.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),so.emit("autoplay-failed")}}function kA(t,e,r,n){if(!t)return;const i=qe.getBaseInfoBySessionId(t);if(!i)return;const o=i.info,s=Date.now(),c=Xr(Xr({},o),{},{vid:o.vid===void 0?0:Number(o.vid),lts:s,elapse:s-i.startTime,cbRegistered:so.onAutoplayFailed||so.onAudioAutoplayFailed?1:-1,errorMsg:r,mediaType:e,trackId:n,extend:void 0});qe.send({type:nn.AUTOPLAY_FAILED,data:c},!0)}const P6=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Oi=new class{constructor(){xt(this,"onAutoplayFailed",void 0),xt(this,"elementMap",new Map),xt(this,"elementStateMap",new Map),xt(this,"elementsNeedToResume",[]),xt(this,"sinkIdMap",new Map),xt(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(e=>{let[r,n]=e;const i=this.elementStateMap.get(r),o=n.srcObject.getAudioTracks()[0],s=o&&o.readyState;if(C.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(s," ").concat(t)),s==="live"){if(t)return n.pause(),void n.play();if(Fr.curState==="running")return _d()?(n.pause(),void n.play()):void(i&&i==="paused"&&n.play())}})}),xt(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[e,r]=t;const n=r.srcObject.getAudioTracks()[0];n&&n.readyState==="live"&&(C.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),r.pause(),r.play())})}),this.autoResumeAudioElement(),Fr.on(Jn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Fr.on(Jn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Fr.on(Jn.STATE_CHANGE,()=>{mi()&&Fr.prevState==="suspended"&&Fr.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,e){const r=this.elementMap.get(t);if(this.sinkIdMap.set(t,e),r)try{await r.setSinkId(e)}catch(n){throw new Qt(et.PERMISSION_DENIED,"can not set sink id: "+n.toString())}}play(t,e,r,n){if(this.elementMap.has(e))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([t]),this.bindAudioElementEvents(e,i),this.elementMap.set(e,i),this.elementStateMap.set(e,ai.INIT),this.setVolume(e,r);const o=this.sinkIdMap.get(e);if(o)try{i.setSinkId(o).catch(c=>{C.warning("[".concat(e,"] set sink id failed"),c.toString())})}catch(c){C.warning("[".concat(e,"] set sink id failed"),c.toString())}const s=i.play();s&&s.then&&s.catch(c=>{n&&kA(n,"audio",c.message,e),C.warning("audio element play warning",c.toString()),this.elementMap.has(e)&&c.name==="NotAllowedError"&&(C.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),Ip(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),DA()}))})}updateTrack(t,e){const r=this.elementMap.get(t);r&&(r.srcObject=new MediaStream([e]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,e){const r=this.elementMap.get(t);r&&(e=Math.max(0,Math.min(100,e)),r.volume=e/100)}stop(t){const e=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!e)return;const r=this.elementsNeedToResume.indexOf(e);this.elementsNeedToResume.splice(r,1),e.srcObject=null,e.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,e){P6.forEach(r=>{e.addEventListener(r,n=>{const i=this.elementStateMap.get(t),o=n.type==="pause"?"paused":n.type;if(C.debug("[".concat(t,"] audio-element-status change ").concat(i," => ").concat(o)),n.type==="error"){const s=e?.error;s&&C.error("[".concat(t,"] media error, code: ").concat(s.code,", message: ").concat(s.message))}this.elementStateMap.set(t,o)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(r=>{C.debug("Auto resume audio element success")}).catch(r=>{C.warning("Auto resume audio element failed!",r)})}),this.elementsNeedToResume=[]};new De(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{Ku()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function gn(){return function(t,e,r){const n=r.value;return typeof n=="function"&&(r.value=function(){this._isClosed&&new Qt(et.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",C);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];const c=n.apply(this,o);return c instanceof De?new De((d,u)=>{c.then(d).catch(u)}):c}),r}}class LA extends pn{constructor(e){super(),xt(this,"name","VideoProcessorDestination"),xt(this,"ID","0"),xt(this,"_source",void 0),xt(this,"videoContext",void 0),xt(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Qt(et.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Qt(et.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(Si.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Si.ON_TRACK,void 0)}}class MA extends pn{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,r){super(),xt(this,"constraintsMap",new Map),xt(this,"statsRegistry",[]),xt(this,"usageRegistry",[]),xt(this,"trackId",void 0),xt(this,"direction",void 0),xt(this,"_chained",!1),this.trackId=e,this.direction=r}async getConstraints(){return await ni(this,ro.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,r){var n;return C.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(r,e),Kr(this,ro.REQUEST_UPDATE_CONSTRAINTS,Array.from(Gi(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var r;if(this.constraintsMap.has(e))return C.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),Kr(this,ro.REQUEST_UPDATE_CONSTRAINTS,Array.from(Gi(r=this.constraintsMap).call(r)))}registerStats(e,r,n){this.statsRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name&&i.type===r)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:r,cb:n})}unregisterStats(e,r){const n=this.statsRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name&&i.type===r);n!==-1&&this.statsRegistry.splice(n,1)}gatherStats(){const e=[];for(const{processorID:r,processorName:n,type:i,cb:o}of this.statsRegistry)try{const s=o();e.push({processorID:r,processorName:n,type:i,stats:s})}catch(s){C.error(new Qt(et.UNEXPECTED_ERROR,s.message))}return e}registerUsage(e,r){this.usageRegistry.find(n=>n.processorID===e.ID&&n.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:r})}unregisterUsage(e){const r=this.usageRegistry.findIndex(n=>n.processorID===e.ID&&n.processorName===e.name);r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:r}of this.usageRegistry)try{let n=r();n instanceof De&&(n=await n),e.push(Xr(Xr({},n),{},{direction:this.direction}))}catch(n){C.error("gather extension usage error",n)}return e}getDirection(){return this.direction}}class UA extends pn{constructor(e){super(),xt(this,"name","AudioProcessorDestination"),xt(this,"ID","0"),xt(this,"inputTrack",void 0),xt(this,"inputNode",void 0),xt(this,"audioProcessorContext",void 0),xt(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Qt(et.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Qt(et.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Si.ON_TRACK,void 0),this.emit(Si.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(Si.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(Si.ON_NODE,this.inputNode))}}class xA extends pn{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,r,n){super(),xt(this,"constraintsMap",new Map),xt(this,"statsRegistry",[]),xt(this,"audioContext",void 0),xt(this,"trackId",void 0),xt(this,"direction",void 0),xt(this,"usageRegistry",[]),xt(this,"_chained",!1),this.audioContext=e,this.trackId=r,this.direction=n}async getConstraints(){return ni(this,ro.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,r){var n;return C.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(r,e),Kr(this,ro.REQUEST_UPDATE_CONSTRAINTS,Array.from(Gi(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var r;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),Kr(this,ro.REQUEST_UPDATE_CONSTRAINTS,Array.from(Gi(r=this.constraintsMap).call(r)))}registerStats(e,r,n){this.statsRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name&&i.type===r)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:r,cb:n})}unregisterStats(e,r){const n=this.statsRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name&&i.type===r);n!==-1&&this.statsRegistry.splice(n,1)}gatherStats(){const e=[];for(const{processorID:r,processorName:n,type:i,cb:o}of this.statsRegistry)try{const s=o();e.push({processorID:r,processorName:n,type:i,stats:s})}catch(s){C.error(new Qt(et.UNEXPECTED_ERROR,s.message))}return e}registerUsage(e,r){this.usageRegistry.find(n=>n.processorID===e.ID&&n.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:r})}unregisterUsage(e){const r=this.usageRegistry.findIndex(n=>n.processorID===e.ID&&n.processorName===e.name);r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:r}of this.usageRegistry)try{let n=r();n instanceof De&&(n=await n),e.push(Xr(Xr({},n),{},{direction:this.direction}))}catch(n){C.error("gather extension usage error",n)}return e}getDirection(){return this.direction}}class Eg extends pn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),xt(this,"context",void 0),xt(this,"processSourceNode",void 0),xt(this,"outputTrack",void 0),xt(this,"processedNode",void 0),xt(this,"clonedTrack",void 0),xt(this,"outputNode",void 0),this.outputNode=new D6}setVolume(){}createOutputTrack(){throw new Qt(et.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class D6{disconnect(){}connect(){}}function VA(t){return new De((e,r)=>{let n=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const o=mi()?"canplay":"playing";i.addEventListener(o,()=>{const s=i.videoWidth,c=i.videoHeight;!s&&mn()||(n=!0,i.srcObject=null,i.remove(),e([s,c]))}),i.srcObject=new MediaStream([t]),i.play().catch(Cp),setTimeout(()=>{n||(i.srcObject=null,i.remove(),e([i.videoWidth,i.videoHeight]))},4e3)})}function Up(t){const e={};t.facingMode&&(e.facingMode=t.facingMode),t.cameraId&&(e.deviceId={exact:t.cameraId});const r=Uo(t.encoderConfig);return r.width!=null&&(e.width=r.width),r.height!=null&&(e.height=r.height),!U0()&&r.frameRate&&(e.frameRate=r.frameRate),O0()&&typeof e.frameRate=="object"&&(e.frameRate.max=60),mn()&&(e.frameRate={ideal:30,max:30}),e}function jA(t){const e={};return U0()||(t.AGC!==void 0&&(e.autoGainControl=t.AGC),t.AEC!==void 0&&(e.echoCancellation=t.AEC),t.ANS!==void 0&&(e.noiseSuppression=t.ANS,Ks()&&t.ANS&&(e.googHighpassFilter=t.ANS))),e}function BA(t){const e=jA(t);if(t.encoderConfig){const r=kp(t.encoderConfig);e.channelCount=r.stereo?2:1,e.sampleRate=r.sampleRate,e.sampleSize=r.sampleSize}return t.microphoneId&&(e.deviceId={exact:t.microphoneId}),Sp()&&(e.sampleRate=void 0),e}const k6=t=>{const e=t._encoderConfig;if(!e)return;const{frameRate:r,width:n,height:i}=t.getMediaStreamTrackSettings();let{frameRate:o=r,width:s=n,height:c=i}=e;if(!o||!s||!c)return;s=Td(s),c=Td(c),o=Td(o);const{max:d,min:u}=function(y,x,N){const L=200*Math.pow(N/15,.6)*Math.pow(y*x/640/360,.75);return{min:Math.floor(L),max:Math.floor(4*L)}}(s,c,o),{bitrateMax:l,bitrateMin:T}=e||{};l||C.debug("calculate bitrate: [w: ".concat(s,", h: ").concat(c,", fps: ").concat(o,"] => [brMax: ").concat(l,", brMin: ").concat(T,"]"));const{maxFramerate:v}=st("ENCODER_CONFIG_LIMIT");return v&&typeof v=="number"&&(o=Math.min(o,v)),{frameRate:o,bitrateMax:l||d,bitrateMin:T||u,scaleResolutionDownBy:1,scale:0}},FA=async(t,e,r)=>await(async(n,i,o)=>{const s=function(u){const l=[];for(let T=0;T<u.length;T+=2)l.push(parseInt(u.slice(T,T+2),16));return Uint8Array.from(l)}(Q0(""+i+o)).slice(0,16),c=s.slice(0,12),d=await window.crypto.subtle.importKey("raw",s,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c},d,n))})(t.buffer,e,r),gg=t=>{const e=document.createElement("canvas");return e.width=2,e.height=2,new De((r,n)=>{e.toBlob(async i=>{if(e.remove(),i){const o=await GA(i);r({buffer:o,width:e.width,height:e.height})}else n(new Qt(et.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},GA=async t=>{const e=await t.arrayBuffer();return new Uint8Array(e)};var HA,WA,KA,zA,qA,YA,XA,JA,ZA,QA,$A,tb,eb,rb,nb,ib,ob,sb,fn,ab,cb,db,ub,lb,hb,As,pb,fb,mb,_b,Eb,gb,Tb,vb,yb,Sb,Rb,Ib,Cb,oi;let Tn=(HA=nr({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),WA=nr({argsMap:(t,e)=>[t.getTrackId(),e]}),KA=gn(),zA=vd("LocalAudioTrack","_enabledMutex"),qA=nr({argsMap:(t,e)=>[t.getTrackId(),e]}),YA=gn(),XA=vd("LocalAudioTrack","_enabledMutex"),JA=nr({argsMap:(t,e)=>[t.getTrackId(),e]}),ZA=gn(),QA=gn(),$A=gn(),tb=nr({argsMap:t=>[t.getTrackId()]}),eb=gn(),rb=nr({argsMap:t=>[t.getTrackId()]}),nb=gn(),ib=nr({argsMap:t=>[t.getTrackId()]}),ob=nr({argsMap:(t,e)=>[t.getTrackId(),e.name]}),sb=nr({argsMap:t=>[t.getTrackId()]}),Sr((fn=class extends Od{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Oi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,e,r,n){super(t,r),xt(this,"trackMediaType",bd.AUDIO),xt(this,"_encoderConfig",void 0),xt(this,"_trackSource",void 0),xt(this,"metadata",[]),xt(this,"_enabled",!0),xt(this,"_volume",100),xt(this,"_useAudioElement",!0),xt(this,"_bypassWebAudio",!1),xt(this,"processor",void 0),xt(this,"_processorContext",void 0),xt(this,"_processorDestination",void 0),xt(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=e,this._getOriginVolumeLevel=!!n,this._trackSource=new Eg,st("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),st("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),ei()&&!no?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){Hr(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&Oi.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void C.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,Kr(this,Ge.NEED_REPLACE_TRACK,this).then(()=>{C.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(r=>{C.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),r)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!EA())throw new Qt(et.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Oi.setSinkID(this.getTrackId(),t)}async setEnabled(t,e,r){return this._setEnabled(t,e,r)}async _setEnabled(t,e,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(C.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{r||(this._enabled=!0),await Kr(this,Ge.NEED_ENABLE_TRACK,this),C.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(n){throw r||(this._enabled=!1),C.error("[".concat(this.getTrackId(),"] setEnabled to true error"),n.toString()),n}}else{this._originMediaStreamTrack.enabled=!1,r||(this._enabled=!1);try{await Kr(this,Ge.NEED_DISABLE_TRACK,this)}catch(n){throw r||(this._enabled=!0),C.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,C.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Kr(this,Ge.NEED_MUTE_TRACK,this):await Kr(this,Ge.NEED_UNMUTE_TRACK,this))}getStats(){return Ra(()=>{C.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),$i(this,Ge.GET_STATS)||Xr({},ug)}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(eo.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(eo.ON_AUDIO_BUFFER),this._source.on(eo.ON_AUDIO_BUFFER,r=>t(r))}play(){C.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(C.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Oi.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){C.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Oi.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];C.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Oi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,e){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Kr(this,Ge.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return De.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new Qt(et.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new Qt(et.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(t){t.on(Si.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await Kr(this,Ge.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Kr(this,Ge.NEED_REPLACE_TRACK,this))}),t.on(Si.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(t){t.removeAllListeners(Si.ON_TRACK),t.removeAllListeners(Si.ON_NODE)}bindProcessorContextEvents(t){t.on(ro.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(ro.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Eg&&(this._trackSource=new bA(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new xA(this._source.context,this.getTrackId(),"local"),e=new UA(t);return this._processorContext=t,this._processorDestination=e,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(e),this._source.on(eo.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Oi.stop(this.getTrackId()),this._source.play()),Kr(this,Ge.NEED_REPLACE_MIXING_TRACK,this).then(()=>{C.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(r=>{C.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),r)})),{processorContext:t,processorDestination:e}}}).prototype,"setVolume",[HA],Object.getOwnPropertyDescriptor(fn.prototype,"setVolume"),fn.prototype),Sr(fn.prototype,"setPlaybackDevice",[WA,KA],Object.getOwnPropertyDescriptor(fn.prototype,"setPlaybackDevice"),fn.prototype),Sr(fn.prototype,"setEnabled",[zA,qA,YA],Object.getOwnPropertyDescriptor(fn.prototype,"setEnabled"),fn.prototype),Sr(fn.prototype,"setMuted",[XA,JA,ZA],Object.getOwnPropertyDescriptor(fn.prototype,"setMuted"),fn.prototype),Sr(fn.prototype,"getStats",[QA],Object.getOwnPropertyDescriptor(fn.prototype,"getStats"),fn.prototype),Sr(fn.prototype,"setAudioFrameCallback",[$A],Object.getOwnPropertyDescriptor(fn.prototype,"setAudioFrameCallback"),fn.prototype),Sr(fn.prototype,"play",[tb,eb],Object.getOwnPropertyDescriptor(fn.prototype,"play"),fn.prototype),Sr(fn.prototype,"stop",[rb,nb],Object.getOwnPropertyDescriptor(fn.prototype,"stop"),fn.prototype),Sr(fn.prototype,"close",[ib],Object.getOwnPropertyDescriptor(fn.prototype,"close"),fn.prototype),Sr(fn.prototype,"pipe",[ob],Object.getOwnPropertyDescriptor(fn.prototype,"pipe"),fn.prototype),Sr(fn.prototype,"unpipe",[sb],Object.getOwnPropertyDescriptor(fn.prototype,"unpipe"),fn.prototype),fn),rl=(ab=nr({argsMap:(t,e)=>[t.getTrackId(),e]}),cb=gn(),db=vd("MicrophoneAudioTrack","_enabledMutex"),ub=nr({argsMap:(t,e,r)=>[t.getTrackId(),e,r]}),lb=gn(),hb=nr({argsMap:t=>[t.getTrackId()]}),Sr((As=class extends Tn{get __className__(){return"MicrophoneAudioTrack"}constructor(t,e,r,n){super(t,e.encoderConfig?kp(e.encoderConfig):{},n,st("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),xt(this,"_config",void 0),xt(this,"_deviceName","default"),xt(this,"_constraints",void 0),xt(this,"_originalConstraints",void 0),xt(this,"_enabled",!0),this._config=e,this._constraints=r,this._originalConstraints=r,this._deviceName=t.label,typeof e.bypassWebAudio=="boolean"&&(this._bypassWebAudio=e.bypassWebAudio),(_d()||VE())&&Fr.bindInterruptDetectorTrack(this)}async setDevice(t){if(C.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const e=await oo.getDeviceById(t),r={};r.audio=Xr({},this._constraints),r.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let n=null;try{n=await io(r,this.getTrackId())}catch(i){throw C.error("[".concat(this.getTrackId(),"] setDevice failed"),i.toString()),n=await io({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n.getAudioTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(n.getAudioTracks()[0],!1),this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw C.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const e=await oo.getDeviceById(t);this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw C.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}C.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,e,r){if(e)return C.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(C.info("[".concat(this.getTrackId(),"] start setEnabled"),t),st("AUTO_RESET_AUDIO_ROUTE")&&(mi()||ko())){const s=navigator.audioSession;s&&(t||(s.type="playback"),s.type="auto")}if(!t){var n;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(n=this._source.clonedTrack)===null||n===void 0||n.stop(),r||(this._enabled=!1);try{await Kr(this,Ge.NEED_DISABLE_TRACK,this)}catch(s){throw C.error("[".concat(this.getTrackId(),"] setEnabled false failed"),s.toString()),s}return}const i=Xr({},this._constraints),o=oo.searchDeviceIdByName(this._deviceName);o&&!i.deviceId&&(i.deviceId=o);try{r||(this._enabled=!0);const s=await io({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),await Kr(this,Ge.NEED_ENABLE_TRACK,this)}catch(s){throw r||(this._enabled=!1),C.error("[".concat(this.getTrackId(),"] setEnabled true failed"),s.toString()),s}C.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(_d()||VE())&&Fr.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((mi()||ko())&&this._enabled&&!this._isClosed&&Fr.duringInterruption){const t=async()=>{Fr.off(Jn.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(C.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Fr.on(Jn.IOS_INTERRUPTION_END,t)}else C.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Ad.TRACK_ENDED)}async renewMediaStreamTrack(t){const e=t||this._constraints,r=oo.searchDeviceIdByName(this._deviceName);if(r&&!e.deviceId&&(e.deviceId=r),this._constraints=e,this._enabled){this._originMediaStreamTrack.stop();const n=await io({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(n.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(ro.REQUEST_UPDATE_CONSTRAINTS,async(e,r,n)=>{try{const i=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(i),r()}catch(i){n(i)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(ro.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[ab,cb],Object.getOwnPropertyDescriptor(As.prototype,"setDevice"),As.prototype),Sr(As.prototype,"setEnabled",[db,ub,lb],Object.getOwnPropertyDescriptor(As.prototype,"setEnabled"),As.prototype),Sr(As.prototype,"close",[hb],Object.getOwnPropertyDescriptor(As.prototype,"close"),As.prototype),As),L6=(pb=nr({argsMap:(t,e)=>[t.getTrackId(),e,t.duration]}),fb=gn(),mb=nr({argsMap:t=>[t.getTrackId()]}),_b=gn(),Eb=nr({argsMap:t=>[t.getTrackId()]}),gb=gn(),Tb=nr({argsMap:t=>[t.getTrackId()]}),vb=gn(),yb=nr({argsMap:t=>[t.getTrackId()]}),Sb=gn(),Rb=nr({argsMap:t=>[t.getTrackId()]}),Ib=nr({argsMap:t=>[t.getTrackId()]}),Cb=gn(),Sr((oi=class extends Tn{get __className__(){return"BufferSourceAudioTrack"}constructor(t,e,r,n){super(e.createOutputTrack(),r,n),xt(this,"source",void 0),xt(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=e,this._bufferSource.on(eo.AUDIO_SOURCE_STATE_CHANGE,i=>{this.safeEmit(Ad.SOURCE_STATE_CHANGE,i)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){Hr(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[pb,fb],Object.getOwnPropertyDescriptor(oi.prototype,"startProcessAudioBuffer"),oi.prototype),Sr(oi.prototype,"pauseProcessAudioBuffer",[mb,_b],Object.getOwnPropertyDescriptor(oi.prototype,"pauseProcessAudioBuffer"),oi.prototype),Sr(oi.prototype,"seekAudioBuffer",[Eb,gb],Object.getOwnPropertyDescriptor(oi.prototype,"seekAudioBuffer"),oi.prototype),Sr(oi.prototype,"resumeProcessAudioBuffer",[Tb,vb],Object.getOwnPropertyDescriptor(oi.prototype,"resumeProcessAudioBuffer"),oi.prototype),Sr(oi.prototype,"stopProcessAudioBuffer",[yb,Sb],Object.getOwnPropertyDescriptor(oi.prototype,"stopProcessAudioBuffer"),oi.prototype),Sr(oi.prototype,"close",[Rb],Object.getOwnPropertyDescriptor(oi.prototype,"close"),oi.prototype),Sr(oi.prototype,"setAudioBufferPlaybackSpeed",[Ib,Cb],Object.getOwnPropertyDescriptor(oi.prototype,"setAudioBufferPlaybackSpeed"),oi.prototype),oi);class Nn extends Tn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=wd().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,zr(8,"track-mix-")),xt(this,"trackList",void 0),xt(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return this.trackList.indexOf(e)!==-1}addAudioTrack(e){this.trackList.indexOf(e)===-1?(C.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):C.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(this.trackList.indexOf(e)!==-1){C.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch{}Rp(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach(r=>{r._encoderConfig&&((r._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=r._encoderConfig.bitrate),(r._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=r._encoderConfig.sampleRate),(r._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=r._encoderConfig.sampleSize),r._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(r=>{r instanceof Nn?r.emit(pc.TRANSCEIVER_UPDATED,e):r._updateRtpTransceiver(e)}))}}class M6 extends AA{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(eo.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),xt(this,"audioBuffer",void 0),xt(this,"sourceNode",void 0),xt(this,"startPlayTime",0),xt(this,"startPlayOffset",0),xt(this,"pausePlayTime",0),xt(this,"options",void 0),xt(this,"currentLoopCount",0),xt(this,"currentPlaybackSpeed",100),xt(this,"_currentState","stopped"),this.audioBuffer=e,this.options=r,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):C.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const Ab=new Map;function bb(t,e){if(t.length===0||e.length===0)return 1/0;const r=zE(t),n=zE(e);return Math.floor(n/r)}class Tg{get rendFrameRate(){const e=Math.max(1,bb(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/e)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:ai.DESTROYED}set videoElementStatus(e){e!==this._videoElementStatus&&(C.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var r;e!==this._videoState&&(this._videoState=e,(r=this.onVideoStateChanged)===null||r===void 0||r.call(this,this.videoState))}constructor(e){xt(this,"trackId",void 0),xt(this,"config",void 0),xt(this,"onFirstVideoFrameDecoded",void 0),xt(this,"onFirstVideoFrameRender",void 0),xt(this,"onVideoStateChanged",void 0),xt(this,"freezeTimeCounterList",[]),xt(this,"renderFreezeAccTime",0),xt(this,"renderFreezeAccTime2",0),xt(this,"isKeepLastFrame",!1),xt(this,"isDestroyed",!1),xt(this,"timeUpdatedCount",0),xt(this,"freezeTime",0),xt(this,"playbackTime",0),xt(this,"lastTimeUpdatedTime",0),xt(this,"autoplayFailed",!1),xt(this,"videoTrack",void 0),xt(this,"videoElement",void 0),xt(this,"cacheVideoElement",void 0),xt(this,"internal",!1),xt(this,"_render_interframe_delays",[]),xt(this,"_render_interframe_delays_sizes",[]),xt(this,"_videoState",Cs.VideoStateStopped),xt(this,"videoElementCheckInterval",void 0),xt(this,"videoElementFreezeTimeout",void 0),xt(this,"_videoElementStatus",ai.NONE),xt(this,"_isInPage",!0),xt(this,"isGettingVideoDimensions",!1),xt(this,"startGetVideoDimensions",()=>{const r=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return C.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(r,500)};!this.isGettingVideoDimensions&&r()}),xt(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Fr.curState==="running"&&(C.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(A0())),L0()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),xt(this,"handleVideoEvents",r=>{switch(r.type){case"play":case"playing":r.type==="play"&&C.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=ai.PLAYING;break;case"loadeddata":if(this.videoState=Cs.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=ai.CANPLAY;break;case"stalled":this.videoElementStatus=ai.STALLED;break;case"suspend":this.videoElementStatus=ai.SUSPEND;break;case"pause":this.videoElementStatus=ai.PAUSED,mi()||ko()||ei()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(C.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=ai.WAITING;break;case"abort":this.videoElementStatus=ai.ABORT;break;case"ended":this.videoElementStatus=ai.ENDED;break;case"emptied":this.videoElementStatus=ai.EMPTIED;break;case"error":{const n=this.videoElement.error;n&&(this.videoElementStatus=ai.ERROR,C.error("[".concat(this.trackId,"] media error: ").concat(n.message," (").concat(n.code,")")));break}case"timeupdate":{const n=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=n);const i=n-this.lastTimeUpdatedTime,o=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=n,bs.lastVisibleTime<bs.lastHiddenTime||o<bs.lastHiddenTime||o<bs.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(i>st("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=i),this.playbackTime+=i;this.playbackTime>=6e3;){this.playbackTime-=6e3;const s=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(s),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),xt(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(C.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(A0())),L0()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),Fr.on(Jn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Fr.on(Jn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return(e=this.videoElement.parentElement)!==null&&e!==void 0?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const r=this.videoElement.play();r&&r.catch&&r.catch(i=>{e&&kA(e,"video",i.message,this.trackId),i.name==="NotAllowedError"?(C.warning("detected video element autoplay failed",i),this.autoplayFailed=!0,this.handleAutoPlayFailed()):C.warning("[".concat(this.trackId,"] play warning: "),i)});const n=Rr();if((n.name==="Safari"&&Number(n.version)===15||_d())&&r&&r.then){const i=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};r.then(i).catch(i)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const r=e.getContext("2d");if(!r)return C.error("create canvas context failed!"),new ImageData(2,2);r.drawImage(this.videoElement,0,0,e.width,e.height);const n=r.getImageData(0,0,e.width,e.height);return e.remove(),n}async getCurrentFrameToUint8Array(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;const i=n.getContext("2d");return i?(i.drawImage(this.videoElement,0,0,n.width,n.height),new De((o,s)=>{n.toBlob(async c=>{if(n.remove(),c){const d=await GA(c);o({buffer:d,width:n.width,height:n.height})}else s(new Qt(et.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,r<0?.1:r>1?1:r)})):await gg(e)}destroy(){this.isDestroyed=!0,Fr.off(Jn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Fr.off(Jn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Cs.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=ai.INIT,!this.videoElementCheckInterval&&(Ob.forEach(o=>{this.videoElement.addEventListener(o,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(o){return o!==document.body&&document.body.contains(o)}(this.videoElement)},1e3),st("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,r;let o;const s=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",s),this.videoElementFreezeTimeout=window.setTimeout(c,st("VIDEO_FREEZE_DURATION")))},c=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Cs.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Cs.VideoStateFrozen:document.addEventListener("visibilitychange",s))},d=(u,l)=>{if(this.videoElementStatus===ai.PLAYING){if(o){const y=l.presentationTime-o.presentationTime,x=l.presentedFrames-o.presentedFrames;this._render_interframe_delays_sizes.push(x),this._render_interframe_delays.push(y);const N=zE(this._render_interframe_delays_sizes),L=N-this._render_interframe_delays_sizes[0];if(N>30&&L>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===Cs.VideoStateStarting&&(this.videoState=Cs.VideoStateDecoding),this.videoState===Cs.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(c,st("VIDEO_FREEZE_DURATION"))),y<st("VIDEO_FREEZE_DURATION")&&this.videoState===Cs.VideoStateFrozen&&(this.videoState=Cs.VideoStateDecoding),y>st("VIDEO_FREEZE_DURATION")&&bs.lastVisibleTime>=bs.lastHiddenTime&&o.timestamp>bs.lastVisibleTime&&o.timestamp>bs.lastHiddenTime){const Q=Math.min(66,bb(this._render_interframe_delays_sizes,this._render_interframe_delays)),J=Math.max(0,y-(x-1)*Q);this.renderFreezeAccTime2+=J>Q?J:0,this.renderFreezeAccTime+=y}}o=Xr(Xr({},l),{},{timestamp:u})}else this.isSkipCalcRenderFreezeTime()&&(o=Xr(Xr({},l),{},{timestamp:u}));var T,v;st("ENABLE_VIDEO_FRAME_CALLBACK")&&((T=(v=this.videoElement).requestVideoFrameCallback)===null||T===void 0||T.call(v,d))};(e=(r=this.videoElement).requestVideoFrameCallback)===null||e===void 0||e.call(r,d)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Sp()&&!st("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const n=Rr();n.name==="Safari"&&Number(n.version)===15||_d()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,mn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,mn()&&this.videoElement.load());const i=this.videoElement.play();i!==void 0&&i.catch(o=>{C.debug("[".concat(this.trackId,"] playback interrupted"),o.toString())})}resetVideoElement(){Ob.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=ai.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===ai.DESTROYED||this.internal}handleAutoPlayFailed(){const e=r=>{r.preventDefault(),this.videoElement.play().then(()=>{C.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(n=>{C.error(n)}),this.autoplayFailed=!1,Ku()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Ku()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),DA()}}const Ob=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class vg extends Tg{constructor(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(e),xt(this,"container",void 0),xt(this,"slot",void 0),this.slot=e.element,this.internal=r,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const r=e.element;var n;!this.internal||this.slot?(r!==this.slot&&(this.destroy(),this.slot=r),this.createElements()):(this.slot=r,r&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(n=this.slot)===null||n===void 0||n.appendChild(this.container)):this.createElements())}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var r;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,n):await gg(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var e;this.container.remove(),(e=this.slot)===null||e===void 0||e.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var e;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",st("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(e=this.slot)===null||e===void 0||e.appendChild(this.container)}mountedVideoElement(){var e;!this.container||(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if((e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var wb,Nb,Pb,Db,kb,Lb,Mb,Ub,xb,Vb,jb,Bb,Fb,Gb,Hb,Wb,Kb,zb,qb,Yb,Xb,Jb,Zb,Qb,$b,tO,eO,rO,gr,nO,iO,oO,sO,aO,cO,dO,uO,ao;let Zr=(wb=nr({argsMap:(t,e,r)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),Nb=gn(),Pb=nr({argsMap:t=>[t.getTrackId()]}),Db=vd("LocalVideoTrack","_enabledMutex"),kb=nr({argsMap:(t,e)=>[t.getTrackId(),e]}),Lb=gn(),Mb=vd("LocalVideoTrack","_enabledMutex"),Ub=nr({argsMap:(t,e)=>[t.getTrackId(),e]}),xb=gn(),Vb=nr({argsMap:(t,e)=>[t.getTrackId(),e,t._saveEncodeBitrateRatio]}),jb=gn(),Bb=nr({argsMap:(t,e)=>[t.getTrackId(),e]}),Fb=gn(),Gb=gn(),Hb=nr({argsMap:(t,e,r)=>[t.getTrackId(),e,r]}),Wb=gn(),Kb=gn(),zb=gn(),qb=nr({argsMap:t=>[t.getTrackId()]}),Yb=gn(),Xb=gn(),Jb=gn(),Zb=gn(),Qb=gn(),$b=nr({argsMap:(t,e)=>[t.getTrackId(),e.name]}),tO=nr({argsMap:t=>[t.getTrackId()]}),eO=nr({argsMap:t=>[t.getTrackId()]}),rO=nr({argsMap:(t,e,r)=>[t.getTrackId(),e.label,r]}),gr=class MD extends Od{get videoHeight(){if(ei()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if(ei()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ai.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,r,n,i,o,s){if(super(e,o),xt(this,"trackMediaType",bd.VIDEO),xt(this,"_player",void 0),xt(this,"isUseScaleResolutionDownBy",!1),xt(this,"_videoVisibleTimer",null),xt(this,"_previousVideoVisibleStatus",void 0),xt(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),xt(this,"_encoderConfig",void 0),xt(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),xt(this,"_optimizationMode",void 0),xt(this,"_saveEncodeBitrateRatio",1),xt(this,"_videoHeight",void 0),xt(this,"_videoWidth",void 0),xt(this,"_forceBitrateLimit",void 0),xt(this,"_enabled",!0),xt(this,"_processorDestination",void 0),xt(this,"_processorContext",void 0),ei()){const{width:c,height:d}=e.getSettings();this._videoWidth=c,this._videoHeight=d}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=n,this._optimizationMode=i,this._hints=s||[],r&&this._hints.indexOf(Wr.CUSTOM_TRACK)!==-1?this._encoderConfig=dn(r):this._encoderConfig=r,this._hints.indexOf(Wr.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(kE(wr.CHROME,115)&&vp().indexOf("Windows")!==-1){const c=function(d,u){if("VideoFrame"in window&&"TransformStream"in window&&br().supportWebRTCInsertableStream){const l=new MediaStreamTrackProcessor(d),T=new MediaStreamTrackGenerator({kind:"video"});let v,y,x=Date.now();const N=()=>{L&&(clearInterval(L),L=void 0),v&&(v.close(),v=void 0),d.stop(),y=void 0,T.removeEventListener("ended",N)};let L=window.setInterval(()=>{if(y&&v&&Date.now()-x>1e3)try{T.readyState==="live"?y.enqueue(v.clone()):N()}catch{N()}},1e3);const Q=new TransformStream({transform:(J,at)=>{T.readyState==="live"?(y=at,x=Date.now(),v===void 0?(v=J,at.enqueue(J.clone())):(at.enqueue(v),v=J)):J.close()}});return T.addEventListener("ended",N),l.readable.pipeThrough(Q).pipeTo(T.writable),T}}(e);c&&(C.info("local screen video track begin to inject frame"),this._mediaStreamTrack=c)}r&&this._hints.indexOf(Wr.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(r),this._processorContext=new MA(this.getTrackId(),"local"),this._processorDestination=new LA(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const i=document.getElementById(e);i?e=i:(C.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}C.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const n=Xr(Xr(Xr({},this._getDefaultPlayerConfig()),r),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new Tg(n):this._player=new vg(n),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(Ad.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},st("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,C.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,r){if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(C.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await Kr(this,Ge.NEED_DISABLE_TRACK,this)}catch(n){throw C.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}return r||(this._enabled=!1),void C.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Kr(this,Ge.NEED_ENABLE_TRACK,this)}catch(n){throw C.error("[".concat(this.getTrackId(),"] setEnabled to true error"),n.toString()),n}C.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,C.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Kr(this,Ge.NEED_MUTE_TRACK,this):await Kr(this,Ge.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*e),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*e),C.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(e)),this._saveEncodeBitrateRatio=1;try{await Kr(this,Ge.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(C)}}}async setEncoderConfiguration(e,r){if(!this._enabled)throw new Qt(et.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=Uo(e),st("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const n=Up({encoderConfig:e});(ei()||mi()||ko())&&(n.deviceId=void 0),C.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(n));try{await this._originMediaStreamTrack.applyConstraints(n),this.updateMediaStreamTrackResolution()}catch(i){const o=new Qt(et.UNEXPECTED_ERROR,i.toString());throw C.error("[".concat(this.getTrackId(),"] applyConstraints error"),o.toString()),o}}this._encoderConfig=e,this._hints.indexOf(Wr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Kr(this,Ge.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(C)}}getStats(){return Ra(()=>{C.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),$i(this,Ge.GET_STATS)||Xr({},lg)}async setBeautyEffect(e){C.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,r):await gg(e)}async findClosestProfile(){const{width:e,height:r,frameRate:n}=this.getMediaStreamTrackSettings(),{width:i,height:o,frameRate:s}=this._encoderConfig||{},c=Td(this._videoWidth||e||i||0),d=Td(this._videoHeight||r||o||0),u=function(l,T,v){if(!Array.isArray(st("VIDEO_ENCODER_CONFIG_LIST"))||st("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const y=Math.min(l,T);return!(y>=480)&&Xr(Xr({},st("VIDEO_ENCODER_CONFIG_LIST").find(x=>x.height>y)),{},{frameRate:v})}(c,d,Td(n||s||15));if(u)return C.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(c,"x").concat(d," => ").concat(JSON.stringify(u))),this.setEncoderConfiguration(u)}async setBitrateLimit(e){C.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e&&(this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate))}async setOptimizationMode(e){if(e!=="motion"&&e!=="detail"&&e!=="balanced")return void C.error(et.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const r=this._optimizationMode;try{this._optimizationMode=e,await Kr(this,Ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(n){throw this._optimizationMode=r,C.error("[".concat(this.getTrackId(),"] set optimization mode failed"),n.toString()),n}C.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(e.numSpatialLayers===1&&e.numTemporalLayers!==1)return C.error(et.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,C.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){VA(this._originMediaStreamTrack).then(e=>{let[r,n]=e;this._videoHeight=n,this._videoWidth=r}).catch(Cp)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new Qt(et.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");C.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=Uo(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,this._hints.indexOf(Wr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Kr(this,Ge.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(C)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:r,frameRate:n}=this.getMediaStreamTrackSettings();if(!e||!r||!n)return;const{bitrateMax:i,bitrateMin:o}=this._encoderConfig;if(o==null||i==null){const{max:s,min:c}=function(d,u,l,T,v){const y=st("BITRATE_ADAPTER_TYPE");if(y==="DEFAULT_BITRATE")return{min:T,max:v};if(v===void 0){const x=Math.floor(200*Math.pow(l/15,.6)*Math.pow(d*u/640/360,.75));v=y==="STANDARD_BITRATE"?4*x:2*x,T=T??x}else T=T??Math.floor(v/10);return{min:T,max:v}}(e,r,n,o,i);if(this._encoderConfig.bitrateMin=c,this._encoderConfig.bitrateMax=s,st("VIDEO_STANDARD_BITRATE_VERSION")&&o==null&&i==null){const[d,u]=function(l,T,v){const y=4*Math.floor(2e5*Math.pow(v/15,.6)*Math.pow(l*T/230400,.75)),x=l*T,N=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),L=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let Q=Gi(N).call(N).next().value,J=1;if(N.has(x))Q=N.get(x);else{var at;const Te=tc(at=Array.from(N.entries())).call(at,(Er,ar)=>{let[kr]=Er,[Nr]=ar;return kr-Nr}),mr=Te.find(Er=>{let[ar]=Er;return ar>x});if(mr){const Er=Te.indexOf(mr);if(Er>0){const ar=Te[Er-1],kr=(x-ar[0])/(mr[0]-ar[0]);Q=ar[1]+kr*(mr[1]-ar[1])}else Q=mr[1]}else Q=Te[Te.length-1][1]}if(L.has(x))J=L.get(x);else{var Rt;const Te=tc(Rt=Array.from(L.entries())).call(Rt,(Er,ar)=>{let[kr]=Er,[Nr]=ar;return kr-Nr}),mr=Te.find(Er=>{let[ar]=Er;return ar>x});if(mr){const Er=Te.indexOf(mr);if(Er>0){const ar=Te[Er-1],kr=(x-ar[0])/(mr[0]-ar[0]);J=ar[1]+kr*(mr[1]-ar[1])}else J=mr[1]}else J=Te[Te.length-1][1]}const vt=st("VIDEO_NEW_BITRATE_RATIO");vt&&vt>0&&(Q=vt/100);const pt=Math.floor(y*Q),kt=Math.floor(65e4*Math.pow(l*T/230400,.5)*Math.pow(v/15,.69));let $t=pt;const se=st("VIDEO_STANDARD_BITRATE_VERSION");return se&&se>0&&(se===1?$t=y:se===2?$t=pt:se===3&&($t=kt)),[Math.floor($t/1e3),J]}(e,r,n);this._encoderConfig.bitrateMax=d,this._encoderConfig.bitrateMin=c?Math.min(c,d):d,this._saveEncodeBitrateRatio=u,C.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(e,", h: ").concat(r,", fps: ").concat(n,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else C.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(r,", fps: ").concat(n,"] => [brMax: ").concat(s,", brMin: ").concat(c,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var e,r;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),i={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:n?.parentElement},{element:o,slot:s}=i;if(this.isPlaying&&o instanceof HTMLVideoElement&&s instanceof HTMLElement){const c=j0.checkOneElementVisible(o),d=Object.assign({},c);if(d.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=d.visible;const u=qe.reportApiInvoke(null,{tag:cn.TRACER,name:vn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});d.visible?u.onSuccess("Video is visible"):u.onSuccess("Invisible because of ".concat(d.reason))}return d}return}catch(n){throw new Qt(et.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new Qt(et.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(e){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],n=this._encoderConfig;e&&(n=Xr(Xr({},n),Uo(e))),n=dc(n);const i=zr(8,"track-video-cloned-"),o=new MD(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,n,dc(this._scalabilityMode),this._optimizationMode,i,dc(this._hints));return e&&n&&o.setEncoderConfiguration(n),C.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(r)),o}async replaceTrack(e,r){if(!(e instanceof MediaStreamTrack))throw new Qt(et.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(e.kind!=="video")throw new Qt(et.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,r,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(Ra(()=>{qe.reportApiInvoke(null,{name:vn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:cn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!st("ENABLE_VIDEO_SEI")||!st("ENABLE_ENCODED_TRANSFORM"))return void C.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new Qt(et.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const r=this.getRTCRtpTransceiver();if(!r)return void C.warning("Video track is not published, SEI can not be send");const n=r.sender.getParameters();if(n.codecs.length===0)return;const i=n.codecs[0].mimeType.toLocaleLowerCase();i==="video/h264"||i==="video/h265"?this.safeEmit("sei-to-send",e):C.warning("SEI is not supported by ".concat(i))}bindProcessorDestinationEvents(){this.processorDestination.on(Si.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await Kr(this,Ge.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Kr(this,Ge.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Si.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(ro.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(ro.REQUEST_CONSTRAINTS)}},Sr(gr.prototype,"play",[wb,Nb],Object.getOwnPropertyDescriptor(gr.prototype,"play"),gr.prototype),Sr(gr.prototype,"stop",[Pb],Object.getOwnPropertyDescriptor(gr.prototype,"stop"),gr.prototype),Sr(gr.prototype,"setEnabled",[Db,kb,Lb],Object.getOwnPropertyDescriptor(gr.prototype,"setEnabled"),gr.prototype),Sr(gr.prototype,"setMuted",[Mb,Ub,xb],Object.getOwnPropertyDescriptor(gr.prototype,"setMuted"),gr.prototype),Sr(gr.prototype,"setSaveEncodeBitrateRatio",[Vb,jb],Object.getOwnPropertyDescriptor(gr.prototype,"setSaveEncodeBitrateRatio"),gr.prototype),Sr(gr.prototype,"setEncoderConfiguration",[Bb,Fb],Object.getOwnPropertyDescriptor(gr.prototype,"setEncoderConfiguration"),gr.prototype),Sr(gr.prototype,"getStats",[Gb],Object.getOwnPropertyDescriptor(gr.prototype,"getStats"),gr.prototype),Sr(gr.prototype,"setBeautyEffect",[Hb,Wb],Object.getOwnPropertyDescriptor(gr.prototype,"setBeautyEffect"),gr.prototype),Sr(gr.prototype,"getCurrentFrameData",[Kb],Object.getOwnPropertyDescriptor(gr.prototype,"getCurrentFrameData"),gr.prototype),Sr(gr.prototype,"getCurrentFrameImage",[zb],Object.getOwnPropertyDescriptor(gr.prototype,"getCurrentFrameImage"),gr.prototype),Sr(gr.prototype,"findClosestProfile",[qb,Yb],Object.getOwnPropertyDescriptor(gr.prototype,"findClosestProfile"),gr.prototype),Sr(gr.prototype,"setBitrateLimit",[Xb],Object.getOwnPropertyDescriptor(gr.prototype,"setBitrateLimit"),gr.prototype),Sr(gr.prototype,"setOptimizationMode",[Jb],Object.getOwnPropertyDescriptor(gr.prototype,"setOptimizationMode"),gr.prototype),Sr(gr.prototype,"setScalabiltyMode",[Zb],Object.getOwnPropertyDescriptor(gr.prototype,"setScalabiltyMode"),gr.prototype),Sr(gr.prototype,"updateMediaStreamTrackResolution",[Qb],Object.getOwnPropertyDescriptor(gr.prototype,"updateMediaStreamTrackResolution"),gr.prototype),Sr(gr.prototype,"pipe",[$b],Object.getOwnPropertyDescriptor(gr.prototype,"pipe"),gr.prototype),Sr(gr.prototype,"unpipe",[tO],Object.getOwnPropertyDescriptor(gr.prototype,"unpipe"),gr.prototype),Sr(gr.prototype,"close",[eO],Object.getOwnPropertyDescriptor(gr.prototype,"close"),gr.prototype),Sr(gr.prototype,"replaceTrack",[rO],Object.getOwnPropertyDescriptor(gr.prototype,"replaceTrack"),gr.prototype),gr),xp=(nO=nr({argsMap:(t,e)=>[t.getTrackId(),e]}),iO=gn(),oO=vd("CameraVideoTrack","_enabledMutex"),sO=nr({argsMap:(t,e)=>[t.getTrackId(),e]}),aO=gn(),cO=nr({argsMap:(t,e)=>[t.getTrackId(),e]}),dO=gn(),uO=nr({argsMap:t=>[t.getTrackId()]}),ao=class UD extends Zr{get __className__(){return"CameraVideoTrack"}constructor(e,r,n,i,o,s){super(e,Uo(r.encoderConfig),i,o,s),xt(this,"_config",void 0),xt(this,"_originalConstraints",void 0),xt(this,"_constraints",void 0),xt(this,"_enabled",!0),xt(this,"_deviceName","default"),xt(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(_d()||VE())&&!function(){const c=Rr();if(c.os!==Vn.IOS||!c.osVersion)return!1;const d=c.osVersion.split(".");return Number(d[0])===15&&Number(d[1])>=2}()&&M0()&&this._enabled&&!this._isClosed&&(C.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=r,this._originalConstraints=n,this._constraints=n,this._deviceName=e.label,this._encoderConfig=Uo(this._config.encoderConfig),Fr.on(Jn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Fr.on(Jn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return typeof e=="string"?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(C.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const r=await oo.getDeviceById(e),n={};n.video=Xr({},this._constraints),n.video.deviceId={exact:e},n.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await io(n,this.getTrackId())}catch(o){throw C.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),i=await io({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=r.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(r){throw C.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await oo.getDeviceById(e);this._deviceName=r.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(r){throw C.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}C.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){C.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const r={video:Xr(Xr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let n=null;try{n=await io(r,this.getTrackId())}catch(i){throw C.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),i.toString()),n=await io({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=Xr({},r.video),C.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,r){if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(C.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const n=await io({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1)}await Kr(this,Ge.NEED_ENABLE_TRACK,this)}catch(n){throw C.error("[".concat(this.getTrackId(),"] setEnabled true error"),n.toString()),n}this.updateMediaStreamTrackResolution(),C.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),r||(this._enabled=!1);try{await Kr(this,Ge.NEED_DISABLE_TRACK,this)}catch(n){throw C.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}C.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,r){if(!this._enabled)throw new Qt(et.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=Uo(e),st("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const n=dn(this._config);n.encoderConfig=e;const i=Up(n);(ei()||mi()||ko())&&(i.deviceId=void 0),C.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(o){const s=new Qt(et.UNEXPECTED_ERROR,o.toString());throw C.error("[".concat(this.getTrackId(),"] applyConstraints error"),s.toString()),s}this._config=n,this._constraints=i,this._originalConstraints=i,this._encoderConfig=e,this._hints.indexOf(Wr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Kr(this,Ge.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(C)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((mi()||ko())&&this._enabled&&!this._isClosed&&Fr.duringInterruption){const e=async()=>{Fr.off(Jn.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(C.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Fr.on(Jn.IOS_INTERRUPTION_END,e)}else C.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Ad.TRACK_ENDED)}async renewMediaStreamTrack(e){const r=e||this._constraints,n=oo.searchDeviceIdByName(this._deviceName);if(n&&!r.deviceId&&(r.deviceId={exact:n}),this._enabled){const i=await io({video:r},this.getTrackId());this._constraints=r,await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Fr.off(Jn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Fr.off(Jn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(e){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],n=this._encoderConfig;e&&(n=Xr(Xr({},n),Uo(e))),n=dc(n);const i=zr(8,"track-cam-cloned-"),o=new UD(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,dc(Xr(Xr({},this._config),{},{encoderConfig:n})),dc(this._constraints),dc(this._scalabilityMode),this._optimizationMode,i);return e&&n&&o.setEncoderConfiguration(n),C.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(r)),o}bindProcessorContextEvents(){this.processorContext.on(ro.REQUEST_UPDATE_CONSTRAINTS,async(e,r,n)=>{try{const i=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(i),r()}catch(i){n(i)}}),this.processorContext.on(ro.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}},Sr(ao.prototype,"setDevice",[nO,iO],Object.getOwnPropertyDescriptor(ao.prototype,"setDevice"),ao.prototype),Sr(ao.prototype,"setEnabled",[oO,sO,aO],Object.getOwnPropertyDescriptor(ao.prototype,"setEnabled"),ao.prototype),Sr(ao.prototype,"setEncoderConfiguration",[cO,dO],Object.getOwnPropertyDescriptor(ao.prototype,"setEncoderConfiguration"),ao.prototype),Sr(ao.prototype,"close",[uO],Object.getOwnPropertyDescriptor(ao.prototype,"close"),ao.prototype),ao);function yg(t,e,r,n){r.optimizationMode&&(n&&n.width&&n.height?(r.encoderConfig=Xr(Xr({},n),{},{bitrateMin:n.bitrateMin,bitrateMax:n.bitrateMax}),r.optimizationMode!=="motion"&&r.optimizationMode!=="detail"||(e.contentHint=r.optimizationMode,e.contentHint===r.optimizationMode?C.debug("[".concat(t,"] set content hint to"),r.optimizationMode):C.debug("[".concat(t,"] set content hint failed")))):C.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var lO,hO,pO,fO,_o,mO,_O,EO,gO,TO,vO,gi;class yO extends RA{getUserId(){return this._userId}constructor(e,r,n,i){super(e,"track-".concat(e.kind,"-").concat(r,"-").concat(i.clientId,"_").concat(zr(5,""))),xt(this,"_userId",void 0),xt(this,"_uintId",void 0),xt(this,"_isDestroyed",!1),xt(this,"store",void 0),xt(this,"processor",void 0),xt(this,"processorContext",void 0),this._userId=r,this._uintId=n,this.store=i}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,C.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Pd=(lO=nr({argsMap:(t,e,r)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),hO=nr({argsMap:t=>[t.getTrackId()]}),pO=nr({argsMap:(t,e)=>[t.getTrackId(),e.name]}),fO=nr({argsMap:t=>[t.getTrackId()]}),Sr((_o=class extends yO{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ai.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,e,r,n,i){super(t,e,r,n),xt(this,"_videoVisibleTimer",null),xt(this,"_previousVideoVisibleStatus",void 0),xt(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),xt(this,"trackMediaType",bd.VIDEO),xt(this,"_videoWidth",void 0),xt(this,"_videoHeight",void 0),xt(this,"_player",void 0),xt(this,"_prePlayer",void 0),xt(this,"processorDestination",void 0),xt(this,"processorContext",void 0),this._prePlayer=i,this.updateMediaStreamTrackResolution(),this.processorContext=new MA(this.getTrackId(),"remote"),this.processorDestination=new LA(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Ra(()=>{C.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),$i(this,Ge.GET_STATS)||Xr({},yA)}play(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(mo.PLAY_START),typeof t=="string"){const n=document.getElementById(t);n?t=n:(C.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}C.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));const r=Xr(Xr({fit:"cover"},e),{},{trackId:this.getTrackId(),element:t});if(this._player)this._player.updateConfig(r);else{let n=!1,i=!1;t instanceof HTMLVideoElement?(this._player=new Tg(r),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,i=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,n=this._player.videoState>0,this._player.updateConfig(r)):this._player=new vg(r),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(mo.FIRST_FRAME_DECODED),i&&this.safeEmit(mo.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=o=>{this.safeEmit(mo.VIDEO_STATE_CHANGED,o)},n&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const n=this.getVideoElementVisibleStatus();this.safeEmit(mo.VIDEO_ELEMENT_VISIBLE_STATUS,n)}catch{}},st("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(mo.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,C.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){VA(this._originMediaStreamTrack).then(t=>{let[e,r]=t;this._videoHeight=r,this._videoWidth=e}).catch(Cp)}_updatePlayerSource(){C.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,e;const r=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),n={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:r?.parentElement},{element:i,slot:o}=n;if(this.isPlaying&&i instanceof HTMLVideoElement&&o instanceof HTMLElement){const s=j0.checkOneElementVisible(i),c=Object.assign({},s);if(c.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=c.visible;const d=qe.reportApiInvoke(null,{tag:cn.TRACER,name:vn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});c.visible?d.onSuccess("Video is visible"):d.onSuccess("Invisible because of ".concat(c.reason))}return c}return}catch(r){throw new Qt(et.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new Qt(et.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Si.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Si.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(pc.SEI_RECEIVED,t)}}).prototype,"play",[lO],Object.getOwnPropertyDescriptor(_o.prototype,"play"),_o.prototype),Sr(_o.prototype,"stop",[hO],Object.getOwnPropertyDescriptor(_o.prototype,"stop"),_o.prototype),Sr(_o.prototype,"pipe",[pO],Object.getOwnPropertyDescriptor(_o.prototype,"pipe"),_o.prototype),Sr(_o.prototype,"unpipe",[fO],Object.getOwnPropertyDescriptor(_o.prototype,"unpipe"),_o.prototype),_o),Dd=(mO=nr({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),_O=nr({argsMap:(t,e)=>[t.getTrackId(),e]}),EO=nr({argsMap:t=>[t.getTrackId()]}),gO=nr({argsMap:t=>[t.getTrackId()]}),TO=nr({argsMap:(t,e)=>[t.getTrackId(),e.name]}),vO=nr({argsMap:t=>[t.getTrackId()]}),Sr((gi=class extends yO{get isPlaying(){return this._useAudioElement?Oi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,e,r,n){super(t,e,r,n),xt(this,"trackMediaType",bd.AUDIO),xt(this,"_source",void 0),xt(this,"_useAudioElement",!0),xt(this,"_volume",100),xt(this,"processorContext",void 0),xt(this,"processorDestination",void 0),xt(this,"_played",!1),xt(this,"_bypassWebAudio",!1),st("DISABLE_WEBAUDIO")?(this._source=new Eg,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new bA(t,!0),st("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(eo.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(mo.FIRST_FRAME_DECODED)}),this.processorContext=new xA(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new UA(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(eo.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(eo.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(eo.ON_AUDIO_BUFFER),this._source.on(eo.ON_AUDIO_BUFFER,r=>t(r))}setVolume(t){this._volume=t,this._useAudioElement?Oi.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!EA())throw new Qt(et.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Oi.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Ra(()=>{C.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),$i(this,Ge.GET_STATS)||Xr({},vA)}play(){C.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(C.debug("[".concat(this.getTrackId(),"] use audio element to play")),Oi.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){C.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Oi.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];C.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Oi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new Qt(et.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new Qt(et.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new Qt(et.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Si.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Si.ON_NODE,t=>{this._source.processedNode=t;const e=!t;this._useAudioElement!==e&&(this._played?(this.stop(),this._useAudioElement=e,this.play()):this._useAudioElement=e)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Si.ON_TRACK),this.processorDestination.removeAllListeners(Si.ON_NODE)}}).prototype,"setVolume",[mO],Object.getOwnPropertyDescriptor(gi.prototype,"setVolume"),gi.prototype),Sr(gi.prototype,"setPlaybackDevice",[_O],Object.getOwnPropertyDescriptor(gi.prototype,"setPlaybackDevice"),gi.prototype),Sr(gi.prototype,"play",[EO],Object.getOwnPropertyDescriptor(gi.prototype,"play"),gi.prototype),Sr(gi.prototype,"stop",[gO],Object.getOwnPropertyDescriptor(gi.prototype,"stop"),gi.prototype),Sr(gi.prototype,"pipe",[TO],Object.getOwnPropertyDescriptor(gi.prototype,"pipe"),gi.prototype),Sr(gi.prototype,"unpipe",[vO],Object.getOwnPropertyDescriptor(gi.prototype,"unpipe"),gi.prototype),gi);const bs=new class extends pn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),xt(this,"_lastHiddenTime",0),xt(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),C.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class SO extends pn{constructor(e,r){super(),xt(this,"trackMediaType",bd.DATA),xt(this,"_version",1),xt(this,"_type",3),xt(this,"_config",void 0),xt(this,"_originDataChannel",void 0),xt(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),xt(this,"_dataStreamPacketHandler",{serialize:n=>n,deserialize:n=>n}),xt(this,"_datachannelEventMap",new Map),this._config=e,r&&(this._originDataChannel=r,this._bandDataChannelEvents(r)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return st("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,r;return(e=(r=this._originDataChannel)===null||r===void 0?void 0:r.readyState)!==null&&e!==void 0?e:"connecting"}get _originDataChannelId(){var e,r;return(e=(r=this._originDataChannel)===null||r===void 0?void 0:r.id)!==null&&e!==void 0?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new De((e,r)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e();const n=setTimeout(()=>{var i;r(new Qt(et.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((i=this._originDataChannel)===null||i===void 0?void 0:i.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(n),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(n),new Qt(et.DATACHANNEL_CONNECTION_TIMEOUT)}}else r(new Qt(et.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[Lp.OPEN,Lp.CLOSE,Lp.ERROR].forEach(r=>{const n=()=>{this.emit(r)};this._datachannelEventMap.set(r,n),e.addEventListener(r,n)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(r=>{let[n,i]=r;e.removeEventListener(n,i)}),this._datachannelEventMap.clear()}}class U6 extends SO{constructor(e){super(e),xt(this,"_messageListener",void 0),this._messageListener=r=>{if(r.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const n=r.data.slice(0,this._dataStreamPacketHeader.byteLength),i=new DataView(n).getUint8(3);if(i!==this.id)return void(st("SHOW_DATASTREAM2_LOG")&&C.debug("invalid datachannel id: ".concat(i," !== ").concat(this.id)));let o=r.data.slice(this._dataStreamPacketHeader.byteLength);o=this._dataStreamPacketHandler.deserialize(o),this.emit(Lp.MESSAGE,o)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class x6 extends SO{send(e){if(this._originDataChannel){let r=e;r=this._dataStreamPacketHandler.serialize(e);const n=new Uint8Array(this._dataStreamPacketHeader.byteLength+r.byteLength);n.set(new Uint8Array(this._dataStreamPacketHeader),0),n.set(new Uint8Array(r),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(n.buffer)}}}function Vp(){const t=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>xh.revokeObjectURL(t),0),new Worker(xh.createObjectURL(t))}const RO=71,Sg=1,Rg=2,Ig=1,IO=2;var Aa=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}(Aa||{});function Cg(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=t.getUint8(0);if(r!==RO)return;const n=t.getUint16(1),i=Sg+Rg+n,o=new Uint8Array(t.byteLength-i);o.set(new Uint8Array(t.buffer,i,t.byteLength-i));const s={m:r,tlvLen:n,tlv:[],frame:o};let c=Sg+Rg;for(;c<i;){const d=t.getUint8(c),u=t.getUint16(c+Ig),l=Ig+IO;if(d===Aa.AUDIO_LEVEL){let T=t.getUint8(c+l);for(let v=1;v<u;v++)T=T<<8|t.getUint8(c+l+v);s.tlv.push({tag:d,length:u,value:e?127^T>>1:127&T})}else if(d===Aa.METADATA||d===Aa.AUDIO_64_BIT_PTS){const T=new Uint8Array(u);for(let v=0;v<u;v++)T[v]=t.getUint8(c+l+v);s.tlv.push({tag:d,length:u,value:T})}c+=l+u}return s}const jp=new Map,Bp=127,_c=1e-10,Ag=139/13,Fp=new Map;function bg(t,e,r){const n="".concat(t,"-").concat(e,"-").concat(r);let i=0;return Fp.has(n)?i=Fp.get(n):(i=Math.log(function(s,c){const d=s-c;c<d&&(c=d);let u=1;for(let l=s,T=1;l>c;l--,T++)u=u*l/T;return u}(e,t))+t*Math.log(.5)+(e-t)*Math.log(1-.5)-Math.log(r)+r*t,Fp.set(n,i)),i<_c&&(i=_c),i}function CO(t,e,r){const n=e.length,i=t.length/n;let o=!1;for(let s=0,c=0;s<n;s++){let d=0;for(let u=c+i;c<u;c++)t[c]>r&&d++;e[s]!==d&&(e[s]=d,o=!0)}return o}window.cache=Fp;let V6=0;class AO{constructor(e){xt(this,"id",void 0),xt(this,"immediates",[]),xt(this,"lastNonSilence",-1),xt(this,"immediateSpeechActivityScore",_c),xt(this,"lastLevelChangedTime",Date.now()),xt(this,"levels",[]),xt(this,"longs",[]),xt(this,"longSpeechActivityScore",_c),xt(this,"mediums",[]),xt(this,"mediumSpeechActivityScore",_c),xt(this,"minLevel",0),xt(this,"nextMinLevel",0),xt(this,"nextMinLevelWindowLength",0),xt(this,"energyScore",0),this.id=e||"".concat(V6++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const e=this.immediates,r=this.levels,n=this.minLevel+Ag;let i=!1;for(let o=0;o<e.length;++o){let s=r[o];s<n&&(s=0);const c=Math.floor(s/Ag);e[o]!==c&&(e[o]=c,i=!0)}return i}computeLongs(){return CO(this.mediums,this.longs,4)}computeMediums(){return CO(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=bg(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(e){this.longSpeechActivityScore=bg(this.longs[0],10,47),this.longSpeechActivityScore>_c&&(this.lastNonSilence=e)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=bg(this.mediums[0],5,24)}evaluateSpeechActivityScores(e){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(e)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var e;return"[".concat(iv(e=[...this.levels]).call(e).join(),"]")}getSpeechActivityScore(e){switch(e){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+e)}}levelChanged(e,r){if(this.lastLevelChangedTime<=r){this.lastLevelChangedTime=r;let n=e;return e<0&&(n=0),e>Bp&&(n=Bp),this.levels.unshift(n),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(n),n>=this.minLevel+Ag?n:n/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(e){if(e!==0){if(this.minLevel===0||this.minLevel>e)return this.minLevel=e,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=e,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>e&&(this.nextMinLevel=e),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let r=Math.sqrt(this.minLevel*this.nextMinLevel);r<0?r=0:r>Bp&&(r=Bp),this.minLevel=r,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class j6{constructor(e){xt(this,"algorithm",void 0),this.algorithm=e}execute(){let e=!this.algorithm;if(!e)try{const r=this.algorithm.runInDecisionMaker(this);r<=0?e=!0:setTimeout(this.execute.bind(this),r)}catch{e=!0}e&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class Og{constructor(e,r,n){xt(this,"isDominant",void 0),xt(this,"energyRanking",void 0),xt(this,"energyScore",void 0),this.isDominant=e,this.energyRanking=r,this.energyScore=n}}class B6 extends pn{constructor(e){super(),xt(this,"dominantId",null),xt(this,"lastDecisionTime",0),xt(this,"lastLevelChangedTime",0),xt(this,"lastLevelIdleTime",0),xt(this,"relativeSpeechActivities",[]),xt(this,"speakers",new Map),xt(this,"enableSilence",!1),xt(this,"timeoutToSilenceInterval",0),xt(this,"decisionMaker",null),xt(this,"loudest",[]),xt(this,"numLoudestToTrack",3),xt(this,"energyExpireTimeMs",250),xt(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=e,this.enableSilence=e>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,r=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=e,r!=null&&(this.energyExpireTimeMs=r),n!=null&&(this.energyAlphaPct=n),this.loudest.length>e&&this.loudest.splice(e)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(e){return this.loudest.some(r=>r.id===e)}levelChanged(e,r){const n=Date.now(),i=this.getOrCreateSpeaker(e);this.lastLevelChangedTime<n&&(this.lastLevelChangedTime=n,this.maybeStartDecisionMaker());const o=i.levelChanged(r,n);return this.updateLoudestList(i,o,n)}runInDecisionMaker(e){return this.decisionMaker!==e||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(e){this.decisionMaker===e&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(e){e.forEach(r=>{this.speakers.has(r.id)||this.speakers.set(r.id,r)})}removeSpeakers(e){e.forEach(r=>{this.speakers.delete(r.id)})}getOrCreateSpeaker(e){let r=this.speakers.get(e);return r||(r=new AO(e),this.speakers.set(e,r),this.maybeStartDecisionMaker()),r}updateLoudestList(e,r,n){const i=e.id===this.dominantId;if(r<0){let d=0;for(;d<this.loudest.length&&this.loudest[d]!==e;)++d;return new Og(i,d,e.energyScore)}if(e.energyScore=Math.floor((this.energyAlphaPct*r+(100-this.energyAlphaPct)*e.energyScore+50)/100),this.numLoudestToTrack===0)return new Og(i,0,e.energyScore);const o=n-this.energyExpireTimeMs;let s=0;for(;s<this.loudest.length;){const d=this.loudest[s];if(d.getLastLevelChangedTime()<o&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(s,1);else if(d.id!==e.id)++s;else if(this.loudest.splice(s,1),this.loudest.length<this.numLoudestToTrack)break}let c=0;for(;c<this.loudest.length&&!(this.loudest[c].energyScore<e.energyScore);)++c;return c<this.numLoudestToTrack&&(this.loudest.splice(c,0,e),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new Og(i,c,e.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new j6(this),this.decisionMaker.execute())}makeDecision(e){let r=null,n=null;const i=this.speakers.size;let o=null;if(i===0)o=null;else if(i===1){var s;const c=Gi(s=this.speakers).call(s).next().value;this.enableSilence&&c&&(o=c.id,c.evaluateSpeechActivityScores(e),e-c.lastNonSilence>this.timeoutToSilenceInterval&&(o=null))}else{let c=this.dominantId==null?null:this.speakers.get(this.dominantId);if(c==null){const l=this.speakers.entries().next();l.value&&(o=l.value[0],c=l.value[1])}else o=c.id;c?.evaluateSpeechActivityScores(e);const d=this.relativeSpeechActivities;let u=2;for(const l of this.speakers.entries()){const[T,v]=l;if(v===c)continue;v.evaluateSpeechActivityScores(e);for(let L=0;L<d.length;++L){const Q=c==null?_c:c.getSpeechActivityScore(L);d[L]=Math.log(v.getSpeechActivityScore(L)/Q)}const y=d[0],x=d[1],N=d[2];y>3&&x>2&&N>0&&x>u&&(u=x,o=T)}this.enableSilence&&c!=null&&o===c.id&&e-c.lastNonSilence>this.timeoutToSilenceInterval&&(o=null)}o==null&&!this.enableSilence||o===this.dominantId||(r=this.dominantId,this.dominantId=o,n=this.dominantId),n==null&&!this.enableSilence||n===r||this.emit("ActiveSpeakerChanged",n)}_runInDecisionMaker(){const e=Date.now(),r=300-(e-this.lastLevelIdleTime);let n=0;r<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(e),this.lastLevelIdleTime=e):n=r;let i=300-(e-this.lastDecisionTime);return i<=0&&(this.lastDecisionTime=e,this.makeDecision(e),i=300-(Date.now()-e)),i>0&&n>i&&(n=i),n}timeoutIdleLevels(e){const r=[];for(const i of Gi(n=this.speakers).call(n)){var n;const o=e-i.getLastLevelChangedTime();36e5<o&&(this.dominantId==null||i.id!==this.dominantId)?r.push(i.id):300<o&&i.levelTimedOut()}r.forEach(i=>this.speakers.delete(i))}}const kd=new Map;let ss=null,Gp=null;const bO=3;let Ec=[];const as=new Map,Hp=new Map;class F6{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(e,r){xt(this,"id",void 0),xt(this,"track",void 0),xt(this,"score",0),xt(this,"active",!0),xt(this,"muted",!1),xt(this,"timer",0),xt(this,"actives",0),xt(this,"inactives",0),this.id=e,this.track=r,this.setActive(as.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const e=this.active;this.active=this.activeRate>=.8;const{actives:r,inactives:n}=function(){const i=[],o=[];return Array.from(Gi(as).call(as)).forEach(s=>{s.active?i.push(s):o.push(s)}),{actives:i,inactives:o}}();if(r.length>3){let i;r.forEach(o=>{(!i||i.score>o.score)&&(i=o)}),i&&i.setActive(!1)}if(r.length<3&&n.length>0){let i;n.forEach(o=>{(!i||i.score<o.score)&&o.id!==this.id&&(i=o)}),i&&e&&!this.active&&(i.samples>40&&i.activeRate-this.activeRate>.4?i.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(e){this.active=e,this.resetTimer(),this.setMuted(!e)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const e=function(r){let n;return Array.from(Gi(as).call(as)).forEach(i=>{!i.active||i.id===r||i.samples<40||(!n||i.score<n.score)&&(n=i)}),n}(this.id);e&&this.activeRate-e.activeRate>.4&&(e.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const e=function(r){let n;return Array.from(Gi(as).call(as)).forEach(i=>{i.active||i.id===r||i.samples<40||(!n||i.score>n.score)&&(n=i)}),n}(this.id);e&&e.activeRate-this.activeRate>.4&&(e.setActive(!0),this.setActive(!1))}addSample(e){e?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(e){this.track&&(this.track.enabled=!e,this.muted=e)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let Wp;function OO(t){const e=as.get(t);e&&(as.delete(t),e.clearTimer())}const Kp=new Map,G6=new Map,wg="video/h264",Ng="video/h265";function wO(t,e,r){let n=new Uint8Array(t,e,r),i=[],o=0;for(;i.length<r;)o+3<r&&n[o]===0&&n[o+1]===0&&n[o+2]===3&&(n[o+3]===0||n[o+3]===1||n[o+3]===2||n[o+3]===3)?(i.push(n[o],n[o+1],n[o+3]),o+=4):(i.push(n[o]),o++);return new Uint8Array(i)}function NO(t){const e=t.length;let r=[],n=0;for(;n<e;)n+2<e&&t[n]===0&&t[n+1]===0&&(t[n+2]===0||t[n+2]===1||t[n+2]===2||t[n+2]===3)?(r.push(t[n],t[n+1],3,t[n+2]),n+=3):(r.push(t[n]),n++);return new Uint8Array(r)}function PO(t){if(t.length<5)return"";let e=-1;for(let i=0;i<t.length-3;i++){if(t[i]===0&&t[i+1]===0&&t[i+2]===1){e=i;break}if(i<t.length-4&&t[i]===0&&t[i+1]===0&&t[i+2]===0&&t[i+3]===1){e=i;break}}if(e===-1)return"";const r=e+(t[e+2]===0?4:3);if(r>=t.length)return"";const n=t[r];return 128&n?"":(n>>1&63)>=32||r+1<t.length&&!(248&t[r+1])?Ng:(31&n)<=31?wg:""}const zp=new Map,nl=new Map;(function(){const t=Rr();Xn.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Xn.getStreamFromExtension=t.name===wr.CHROME&&Number(t.version)>34,Xn.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let r=!1;try{e.addTransceiver("audio"),r=!0}catch{}return e.close(),r}(),Xn.supportMinBitrate=t.name===wr.CHROME||t.name===wr.EDGE,Xn.supportSetRtpSenderParameters=function(){const e=Rr();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!zs()||!(!ei()&&!yp())||e.name===wr.FIREFOX&&Number(e.version)>=64)}(),t.name===wr.SAFARI&&(Number(t.version)>=14?Xn.supportDualStream=!0:Xn.supportDualStream=!1),Xn.webAudioMediaStreamDest=function(){const e=Rr();return!(e.name===wr.SAFARI&&Number(e.version)<12)}(),Xn.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Xn.supportWebGL=typeof WebGLRenderingContext<"u",Xn.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,zs()||(Xn.webAudioWithAEC=!0),Xn.supportShareAudio=function(){const e=Rr();return(e.os===Vn.WIN_10||e.os===Vn.WIN_81||e.os===Vn.WIN_7||e.os===Vn.LINUX||e.os===Vn.MAC_OS||e.os===Vn.CHROMIUM_OS)&&e.name===wr.CHROME&&Number(e.version)>=74}(),Xn.supportDataChannel=!!(md(76)||ME(68)||N0(14)),Xn.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!mn()&&!!e&&e.prototype.setConfiguration instanceof Function}(),Xn.supportWebRTCEncodedTransform=md(87)||b0()||ME(117),Xn.supportWebRTCInsertableStream=function(){const e=Rr();return(e.name===wr.CHROME||e.name===wr.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Xn.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Xn.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,Ip(()=>{Xn.supportDualStreamEncoding=function(){const e=Rr();return!!st("DISABLE_WEBAUDIO")||e.name==="Safari"&&Number(e.version)>=14||!!(e.name==="Chrome"&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&st("CHROME_DUAL_STREAM_USE_ENCODING"))}(),C.debug("browser ua: ",navigator.userAgent),C.info("browser info: ",t),C.info("browser compatibility: ",Xn)})})();const H6=["CHINA","GLOBAL"],DO=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],gc=[],Ld=[];function Tc(t,e){return!!e&&gc.some(r=>r.uid===t&&r.channelName===e)}function Pg(){return Ld.length>0}var W6=zI.forEach,kO=Xl("forEach")?[].forEach:function(t){return W6(this,t,arguments.length>1?arguments[1]:void 0)};xr({target:"Array",proto:!0,forced:[].forEach!==kO},{forEach:kO});var K6=Co("Array","forEach"),z6=fa,q6=Ye,Y6=_,X6=K6,Dg=Array.prototype,J6={DOMTokenList:!0,NodeList:!0},Z6=function(t){var e=t.forEach;return t===Dg||Y6(Dg,t)&&e===Dg.forEach||q6(J6,z6(t))?X6:e},Q6=ke(Z6),$6=he,LO=eh;xr({target:"Object",stat:!0,forced:on(function(){LO(1)})},{keys:function(t){return LO($6(t))}});var tH=ke(xe.Object.keys),eH=ke(ev),rH=ke(nv),nH=xr,MO=mu,iH=mh,oH=je,UO=Qf,sH=pa,aH=me,cH=__,dH=sn,uH=_a,lH=UI("slice"),hH=dH("species"),kg=Array,pH=Math.max;nH({target:"Array",proto:!0,forced:!lH},{slice:function(t,e){var r,n,i,o=aH(this),s=sH(o),c=UO(t,s),d=UO(e===void 0?s:e,s);if(MO(o)&&(r=o.constructor,(iH(r)&&(r===kg||MO(r.prototype))||oH(r)&&(r=r[hH])===null)&&(r=void 0),r===kg||r===void 0))return uH(o,c,d);for(n=new(r===void 0?kg:r)(pH(d-c,0)),i=0;c<d;c++,i++)c in o&&cH(n,i,o[c]);return n.length=i,n}});var fH=Co("Array","slice"),mH=_,_H=fH,Lg=Array.prototype,EH=function(t){var e=t.slice;return t===Lg||mH(Lg,t)&&e===Lg.slice?_H:e},gH=ke(EH);function Ke(t,e,r,n,i){var o,s,c,d={};return Q6(o=tH(n)).call(o,function(u){d[u]=n[u]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=eH(s=rH(c=gH(r).call(r)).call(c)).call(s,function(u,l){return l(t,e,u)||u},d),i&&d.initializer!==void 0&&(d.value=d.initializer?d.initializer.call(i):void 0,d.initializer=void 0),d.initializer===void 0?(DI(t,e,d),null):d}let qp=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),Mg=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),xo=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),Ri=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),er=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),Jr=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),cr=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t}({}),sr=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t.DOWNGRADE_CODEC="downgrade_codec",t}({}),il=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),yr=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),Ii=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),pr=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});function Yp(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw C.error("Invalid Channel Name ".concat(t)),new Bt(et.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Xp(t){if(e=t,!(typeof e=="number"&&Math.floor(e)===e&&0<=e&&e<=4294967295||V0(t,1,255)))throw new Bt(et.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var e;typeof t=="string"&&C.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Ys=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const TH={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Ug={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function xg(t,e){qn(t.url,"".concat(e,".url"),1,1e3,!1),_n(t.x)||Hr(t.x,"".concat(e,".x"),0,1e4),_n(t.y)||Hr(t.y,"".concat(e,".y"),0,1e4),_n(t.width)||Hr(t.width,"".concat(e,".width"),0,1e4),_n(t.height)||Hr(t.height,"".concat(e,".height"),0,1e4),_n(t.zOrder)||Hr(t.zOrder,"".concat(e,".zOrder"),0,255),_n(t.alpha)||Hr(t.alpha,"".concat(e,".alpha"),0,1,!1)}const vH={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let ba=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),Vg=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),Pn=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function xO(t){if(!t.channelName)throw new Bt(et.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new Bt(et.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&qn(t.token,"info.token",1,2047),Xp(t.uid),Yp(t.channelName),!0}let Ci=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),Xs=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),Mi=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),Md=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),Ur=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),Gn=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t}({}),Jp=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),jn=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),Dr=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const VO=[Dr.AFRICA,Dr.ASIA,Dr.CHINA,Dr.EUROPE,Dr.GLOBAL,Dr.INDIA,Dr.JAPAN,Dr.NORTH_AMERICA,Dr.OCEANIA,Dr.OVERSEA,Dr.SOUTH_AMERICA];let ci=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const Zp={CHINA:{},ASIA:{CODE:ci.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ci.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ci.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ci.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ci.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ci.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ci.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ci.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ci.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ci.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ci.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ci.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ci.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};eg&&(Zp.CHINA={CODE:ci.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let ol=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t}({});function jO(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class BO extends pn{constructor(e,r){super(),G(this,"onICEConnectionStateChange",void 0),G(this,"onConnectionStateChange",void 0),G(this,"onDTLSTransportStateChange",void 0),G(this,"onDTLSTransportError",void 0),G(this,"onICETransportStateChange",void 0),G(this,"onFirstAudioReceived",void 0),G(this,"onFirstVideoReceived",void 0),G(this,"onFirstAudioDecoded",void 0),G(this,"onFirstVideoDecoded",void 0),G(this,"onFirstVideoRender",void 0),G(this,"onFirstVideoDecodedTimeout",void 0),G(this,"onSelectedLocalCandidateChanged",void 0),G(this,"onSelectedRemoteCandidateChanged",void 0),G(this,"onICECandidateError",void 0),G(this,"getLocalVideoStats",void 0)}}class FO extends BO{constructor(e,r){super(e,r),G(this,"establishPromise",void 0)}}let Ue=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),di=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),Js=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const GO=["disconnected","failed"];let _e=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),Mr=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),$e=function(t){return t.AudioMetadata="audioMetadata",t.AudioPts="audioPts",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),Vo=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),jo=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),Hn=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),HO=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),Os=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),Eo=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),cs=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),Ud=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),Sn=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),xd=function(t){return t.ABORT="abort",t}({}),Oa=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),yH=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const SH={[qp.ACCESS_POINT]:{[Ri.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Ri.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Ri.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Ri.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Ri.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Ri.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Ri.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Ri.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Ri.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Ri.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Ri.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Ri.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Ri.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Ri.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Ri.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Ri.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Ri.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Ri.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[qp.UNILBS]:{[xo.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[xo.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[xo.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[xo.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[xo.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[xo.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[xo.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[xo.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[xo.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[xo.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[xo.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[xo.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[qp.STRING_UID_ALLOCATOR]:{[Mg.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Mg.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Mg.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Vd(t){const e=SH[Math.floor(t/1e4)];if(!e)return{desc:"unknown error",retry:!1};const r=e[t%1e4];if(!r){if(Math.floor(t/1e4)===qp.ACCESS_POINT){const n=t%1e4;if(n.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(n.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return r}const RH={[er.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[er.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[er.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[er.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[er.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[er.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[er.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[er.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[er.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[er.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[er.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[er.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[er.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[er.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[er.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[er.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[er.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[er.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[er.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[er.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[er.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[er.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[er.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[er.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[er.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[er.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[er.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[er.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[er.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[er.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[er.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[er.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[er.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[er.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[er.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[er.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[er.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[er.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[er.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[er.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[er.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[er.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[er.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[er.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[er.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[er.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[er.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[er.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[er.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[er.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[er.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[er.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[er.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[er.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[er.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[er.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[er.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[er.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[er.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[er.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[er.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[er.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[er.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[er.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function sl(t){return RH[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function WO(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function jg(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?WO(Object(r),!0).forEach(function(n){G(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):WO(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Bg(t,e){if(typeof t=="string")return t;const{proxy:r,host:n,port:i}=t;if(e){const o=st("JOIN_GATEWAY_FALLBACK_PORT")||443;return o===443?"wss://".concat(n,"/ws/?p=").concat(Number(i)+150):"wss://".concat(n,":").concat(o,"/ws/?p=").concat(Number(i)+150)}return r?"wss://".concat(r,"/ws/?h=").concat(n,"&p=").concat(i):"wss://".concat(n,":").concat(i)}const IH=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,CH=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,AH=/wss:\/\/(.+):([0-9]+)\/?/,bH=/wss:\/\/(.[^\/]+)\/?/;let OH=0;class wH{constructor(e,r){G(this,"id",0),G(this,"store",void 0),G(this,"recordIndex",void 0),G(this,"websockets",[]),G(this,"try443PortDuration",2e3),G(this,"forceCloseWSDuration",5e3),G(this,"try443PortTimeout",null),G(this,"forceCloseTimeout",null),G(this,"isTry443PortFailed",!1),G(this,"isNormalPortFailed",!1),G(this,"useDoubleDomain",!1),G(this,"useProxy",!1),G(this,"startTime",Date.now()),this.id=++OH,this.try443PortDuration=st("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=r}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var e;const r=Date.now()-this.startTime;for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];C.debug("[choose-best-ws ".concat((e=this.store)===null||e===void 0?void 0:e.clientId," ").concat(this.id,"] ").concat(r,"ms:"),...i)}createWebSocket(e,r,n){this.logger("createWebSocket:",e,{isTry443Port:r,hasTimeoutDetection:n});const i=st("GATEWAY_DOMAINS"),o=Date.now(),s=[],c=i.find(v=>{var y;return Ce(y=e.host).call(y,v)});c||(this.useDoubleDomain=!1);const d=[];if(this.useDoubleDomain)i.forEach(v=>{d.push(Bg(jg(jg({},e),{},{host:e.host.replace(c,v)}),r))});else{const v=jg({},e);if(r&&c){const y=i.find(x=>x!==c);y&&(v.host=v.host.replace(c,y))}d.push(Bg(v,r))}try{d.forEach(v=>{const y=new WebSocket(v);y.binaryType="arraybuffer",s.push(y),this.logger("ws is connecting:",y.url)})}catch(v){if(this.logger("ws create failed"),s.forEach(y=>y.close()),s.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,r,n);if(!r&&Number(e.port)!==443)return this.createWebSocket(e,!0,n);throw new Bt(et.WS_ERR,"init websocket failed! Error: ".concat(v.toString()))}const u=Wu();this.store&&this.store.recordJoinChannelService({urls:s.map(v=>v.url),service:"gateway"},this.recordIndex),s.forEach(v=>{v.onopen=()=>{this.logger("onopen: ws ".concat(v.url," open cost ").concat(Date.now()-o,"ms")),this.websockets.forEach(y=>{y!==v&&(y.onopen=null,y.onclose=null,y.onmessage=null,y.close(),this.logger("close backup websocket: ".concat(y.url)))}),this.websockets.length=0,u.resolve(v)},v.onclose=y=>{this.logger("onclose: ws ".concat(v.url," closed cost ").concat(Date.now()-o,"ms state: ").concat(v.readyState));const x=s.every(N=>N.readyState===WebSocket.CLOSED||N.readyState===WebSocket.CLOSING);this.logger("".concat(r?"443":"47xx"," websocket closed, all failed: ").concat(x)),x&&(r||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(y.reason)),u.reject({code:y.code,reason:Jp.A_ROUND_WS_FAILED})):!r&&x&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),T()),r?this.isTry443PortFailed=x:this.isNormalPortFailed=x},v.onmessage=y=>this.logger("".concat(v.url," onmessage: ").concat(y.data))}),this.websockets.push(...s);const l=()=>{this.websockets.forEach(v=>v.readyState!==WebSocket.OPEN&&v.close())},T=()=>{if(u.isResolved)return l();Rr().os===Vn.MAC_OS&&mn()&&l(),this.createWebSocket(e,!0,!0).then(v=>{u.resolve(v)}).catch(v=>{this.isNormalPortFailed&&u.reject(v),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",u.isResolved),this.forceCloseTimeout=null,l()},this.forceCloseWSDuration)};return n||(()=>{if(r||this.useProxy)return this.logger("add 5s timeout at ".concat(r?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,l()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",u.isResolved),this.try443PortTimeout=null,T()},this.try443PortDuration)})(),u.promise}chooseBestWebsocket(e,r,n,i){return this.useDoubleDomain=!!r,typeof e=="string"&&(e=function(o){let s,c,d;return[,s,c,d]=o.match(IH)||[],s||([,c,d]=o.match(CH)||[]),c&&d||([,c,d]=o.match(AH)||[]),c&&d||([,c]=o.match(bH)||[]),c||C.warning("un-destructible url: ",o),{proxy:s,host:c,port:d||"443"}}(e)),this.recordIndex=i,this.useProxy=!!e.proxy,n&&this.useProxy&&(C.warn("cannot use 443 only when use proxy"),n=!1),this.createWebSocket(e,!!n,!1).finally(()=>this.clearTimeout())}}function KO(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}class zO extends pn{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var r;Ce(r=["tryNext","recover"]).call(r,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(pr.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(pr.CONNECTED):this._state==="closed"?this.emit(pr.CLOSED):this._state==="failed"&&this.emit(pr.FAILED))}resetReconnectCount(e){C.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,r){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3],o=arguments.length>4&&arguments[4]!==void 0&&arguments[4],s=arguments.length>5?arguments[5]:void 0;super(),G(this,"_websocketUrl",null),G(this,"connectionID",0),G(this,"currentURLIndex",0),G(this,"urls",[]),G(this,"_reconnectMode","tryNext"),G(this,"reconnectReason",void 0),G(this,"_initMutex",void 0),G(this,"name",void 0),G(this,"_state","closed"),G(this,"reconnectInterrupter",void 0),G(this,"websocket",void 0),G(this,"retryConfig",void 0),G(this,"reconnectCount",0),G(this,"forceCloseTimeout",5e3),G(this,"onlineReconnectListener",void 0),G(this,"useCompress",void 0),G(this,"tryDoubleDomain",!1),G(this,"use443PortOnly",!1),G(this,"wsInflateLength",0),G(this,"wsDeflateLength",0),G(this,"closeEstablishingWs",()=>{}),G(this,"store",void 0),G(this,"joinGatewayRecordIndex",void 0),this.store=s,this.name=e,this.retryConfig=function(T){for(var v=1;v<arguments.length;v++){var y=arguments[v]!=null?arguments[v]:{};v%2?KO(Object(y),!0).forEach(function(x){G(T,x,y[x])}):Object.getOwnPropertyDescriptors?Object.defineProperties(T,Object.getOwnPropertyDescriptors(y)):KO(Object(y)).forEach(function(x){Object.defineProperty(T,x,Object.getOwnPropertyDescriptor(y,x))})}return T}({},r),this.useCompress=n,this.tryDoubleDomain=i,this.use443PortOnly=o,this._initMutex=new si("websocket",s?s.clientId:void 0);const{timeout:c,timeoutFactor:d}=r,u=Math.max(300,Math.floor(3*c/5)),l=Math.max(1.2,Math.floor(8*d)/10);Ki.ONLINE&&(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=l),In.on(Ed.NETWORK_STATE_CHANGE,(T,v)=>{T!==v&&(this.resetReconnectCount("network state change: ".concat(v," -> ").concat(T)),T===Ki.ONLINE?(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=l):(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=d))})}getConnection(){return this.websocket||void 0}async init(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=r,this.urls=e,this.state="connecting";try{var i;const o=Wu(),s=this.urls[this.currentURLIndex];(i=this.store)===null||i===void 0||i.beforeConnect(),function(c){return!(Pp()||st("USE_NEW_TOKEN")||!st("ENABLE_PREALLOC_PC")&&(c==null||!c.autoSubscribe||st("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(HO.PRE_CONNECT_PC),this.createWebSocketConnection(s).then(o.resolve).catch(o.reject),this.once(pr.CLOSED,()=>{o.reject(new Qt(et.WS_DISCONNECT))}),this.once(pr.CONNECTED,o.resolve),await o.promise}catch{}finally{n()}}close(e,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const n=this.websocket;r?setTimeout(()=>n.close(),500):n.close(),this.websocket=void 0,this._websocketUrl=null}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,r){if(!this.websocket)return void C.warning("[".concat(this.name,"] can not reconnect, no websocket"));e!==void 0&&(this.reconnectMode=e),C.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(r)]},this.joinGatewayRecordIndex);const n=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),n&&n.bind(this.websocket)({code:9999,reason:r})}sendMessage(e){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Qt(et.WS_ABORT,"websocket is not ready");try{r||(e=JSON.stringify(e)),this.websocket.send(e)}catch(n){throw new Qt(et.WS_ERR,"send websocket message error"+n.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,r=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:r}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var r;const n=Wu();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const i=l=>{var T;(T=this.store)===null||T===void 0||T.signalChannelOpen(),C.debug("[".concat(this.name,"] websocket opened:"),l),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n.resolve()},o=async l=>{var T;if(C.debug("[".concat(this.name,"] websocket close ").concat((T=this.websocket)===null||T===void 0?void 0:T.url,", code: ").concat(l.code,", reason: ").concat(l.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)n.reject(new Qt(et.WS_DISCONNECT,"websocket close: ".concat(l.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=l.reason,this.state="reconnecting");const v=$i(this,pr.WILL_RECONNECT,this.reconnectMode,l.reason)||this.reconnectMode,y=await this.reconnectWithAction(v);if(this.state==="closed")return void C.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!y)return n.reject(new Qt(et.WS_DISCONNECT,"websocket reconnect failed: ".concat(l.code))),this.close(!0);n.resolve()}},s=l=>{this.emit(pr.ON_MESSAGE,l)},c=l=>{C.warn("[".concat(this.connectionID,"] ws open error ").concat(l))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),st("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=st("GATEWAY_WSS_ADDRESS")),C.debug("[".concat(this.name,"] start connect, url:"),e);const d=(r=this.store)===null||r===void 0?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var u;this._websocketUrl=Bg(e);const l=await this.chooseBestWebsocketConnection(e);this.websocket=l,i&&i(this.websocket.url),this.websocket.onclose=o,this.websocket.onmessage=s,this.websocket.onerror=c,(u=this.store)===null||u===void 0||u.recordJoinChannelService({endTs:Date.now(),status:"success"},d),this.joinGatewayRecordIndex=d}catch(l){const T=this.state==="closed",v=l instanceof Qt,y=v&&l.code===et.WS_ABORT,x=v&&l.code===et.WS_ERR,N=v?l.message:l&&(l.reason||l.toString());C.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(N)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:y?"aborted":"error",errors:[l]},d),T||x?(n.reject(T?new Qt(et.WS_DISCONNECT,"websocket is closed: ".concat(N)):new Qt(et.WS_ERR,"init websocket failed: ".concat(N))),x&&C.error("[".concat(this.name,"] init websocket failed: ").concat(N))):o&&o(l)}return n.promise}async reconnectWithAction(e){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;C.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||In.isOnline||!In.onlineWaiter||(this.onlineReconnectListener=In.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let n=!0;if(this.reconnectInterrupter=()=>n=!1,r){const s=qE(this.reconnectCount,this.retryConfig);C.debug("[".concat(this.name,"] wait ").concat(s,"ms to reconnect websocket, mode: ").concat(e)),await De.race([Yn(s),this.onlineReconnectListener||new De(()=>{})])}if(this._state==="closed"||!n)return!1;this.reconnectCount+=1;const i=async(s,c)=>{this.emit(pr.RECONNECT_CREATE_CONNECTION,c),await this.createWebSocketConnection(s)};try{if(e==="retry")await i(this.urls[this.currentURLIndex],e);else if(e==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);C.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await i(this.urls[this.currentURLIndex],e)}else e==="recover"&&(C.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await ni(this,pr.REQUEST_NEW_URLS),this.currentURLIndex=0,await i(this.urls[this.currentURLIndex],e))}catch(s){var o;C.error("[".concat(this.name,"] reconnect failed ").concat(s&&s.toString()));const c=s==null||(o=s.data)===null||o===void 0?void 0:o.desc;return Array.isArray(c)&&Ce(c).call(c,"dynamic key expired")?(this.emit(pr.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,r)}return!0}}class Fg extends zO{constructor(e,r){super(e,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,r){const n=Wu(),i=function(s,c){return new wH(s,c)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{C.debug("[choose-best-ws] close establishing websockets"),i.closeAllWebsockets(),n.reject(new Qt(et.WS_ABORT,"choose best websocket aborted"))};const o=st("GATEWAY_DOMAINS");return C.debug("[choose-best-ws] currentDomain: ",e,", domains: ",o,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,r).then(n.resolve).catch(n.reject),n.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class al extends zO{constructor(e,r){super(e,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,r){return new De((n,i)=>{let o=!1;const s=[];this.closeEstablishingWs=()=>{C.debug("[choose-best-ws] close establishing websockets"),s.forEach(x=>{x.onclose=null,x.onopen=null,x.onmessage=null,x.close()}),i(new Qt(et.WS_ABORT,"choose best websocket aborted"))};const c=st("GATEWAY_DOMAINS");let d;const u=e.indexOf("?h="),l=c.find(x=>u!==-1?Ce(e).call(e,x,u):Ce(e).call(e,x));C.debug("[choose-best-ws] currentDomain: ",l,", domains: ",c);let T=!this.tryDoubleDomain||!l;if(!T&&l){var v;const x=Date.now();try{c.forEach(N=>{const L=u===-1?e.replace(l,N):e.substr(0,u)+e.substr(u).replace(l,N),Q=new WebSocket(L);Q.binaryType="arraybuffer",s.push(Q),C.debug("[choose-best-ws] ws is connecting:",Q.url)})}catch{for(C.debug("[choose-best-ws] ws create failed, fallback to single url"),s.forEach(L=>L.close());s.length;)s.pop();T=!0}(v=this.store)===null||v===void 0||v.recordJoinChannelService({urls:s.map(N=>N.url),service:"gateway"},r),s.forEach(N=>{N.onopen=()=>{if(o)return;const L=Date.now()-x;C.debug("[choose-best-ws] ws open cost ".concat(L,"ms")),s.filter(Q=>Q!==N).forEach(Q=>{C.debug("[choose-best-ws]close backup websocket: ".concat(Q.url)),Q.close()}),o=!0,n(N)},N.onclose=L=>{d=L,!o&&(s.find(Q=>!(Q.readyState===WebSocket.CLOSED||Q.readyState===WebSocket.CLOSING))||(C.debug("[choose-best-ws] all websocket is closed"),o=!0,i(d)))},N.onmessage=L=>{C.debug("[choose-best-ws]".concat(N.url," onmessage: ").concat(L.data))}}),Yn(this.forceCloseTimeout).then(()=>{s.forEach(N=>{N.readyState!==WebSocket.OPEN&&N.close()})})}if(T){var y;let x;C.debug("[choose-best-ws] use single url: ",e),(y=this.store)===null||y===void 0||y.recordJoinChannelService({urls:[e],service:"gateway"},r);try{x=new WebSocket(e),s.push(x),x.binaryType="arraybuffer"}catch(N){const L=new Qt(et.WS_ERR,"init websocket failed! Error: ".concat(N.toString()));return C.error("[".concat(this.name,"]").concat(L)),void i(L)}x.onopen=()=>{n(x)},x.onclose=N=>{i(N)},x.onmessage=N=>{C.debug("[choose-best-ws]".concat(x.url," onmessage: ").concat(N.data))},Yn(this.forceCloseTimeout).then(()=>{x&&x.readyState!==WebSocket.OPEN&&x.close()})}}).then(n=>(this.closeEstablishingWs=void 0,n)).catch(n=>{throw this.closeEstablishingWs=void 0,n})}}class NH extends pn{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Jr.CONNECTED?this.emit(cr.WS_CONNECTED):e===Jr.RECONNECTING?this.emit(cr.WS_RECONNECTING,this._websocketReconnectReason):e===Jr.CLOSED&&this.emit(cr.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,r){super(),G(this,"_disconnectedReason",void 0),G(this,"_websocketReconnectReason",void 0),G(this,"_connectionState",Jr.CLOSED),G(this,"reconnectToken",void 0),G(this,"websocket",void 0),G(this,"openConnectionTime",void 0),G(this,"clientId",void 0),G(this,"lastMsgTime",Date.now()),G(this,"uploadCache",[]),G(this,"uploadCacheInterval",void 0),G(this,"rttRolling",new tA(5)),G(this,"pingpongTimer",void 0),G(this,"wsInflateDataTimer",void 0),G(this,"pingpongTimeoutCount",0),G(this,"ortc",void 0),G(this,"joinResponse",void 0),G(this,"multiIpOption",void 0),G(this,"initError",void 0),G(this,"spec",void 0),G(this,"store",void 0),G(this,"onWebsocketMessage",n=>{if(n.data instanceof ArrayBuffer)return void this.emit(cr.ON_BINARY_DATA,n.data);const i=JSON.parse(n.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const o="res-@".concat(i._id);this.emit(o,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){if(this.emit(i._type,i._message),i._type===yr.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===yr.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Lr.UID_BANNED);break;case 15:this.close(Lr.IP_BANNED);break;case 16:this.close(Lr.CHANNEL_BANNED)}if(i._type===yr.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case er.ERR_LICENSE_MISSING:this.close(Lr.LICENSE_MISSING);break;case er.ERR_LICENSE_EXPIRED:this.close(Lr.LICENSE_EXPIRED);break;case er.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Lr.LICENSE_MINUTES_EXCEEDED);break;case er.ERR_LICENSE_PERIOD_INVALID:this.close(Lr.LICENSE_PERIOD_INVALID);break;case er.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Lr.LICENSE_MULTIPLE_SDK_SERVICE);break;case er.ERR_LICENSE_ILLEGAL:this.close(Lr.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=r,this.websocket=new Fg("gateway-".concat(this.clientId),this.spec.retryConfig,!0,st("JOIN_GATEWAY_USE_DUAL_DOMAIN"),st("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Jr.CONNECTED&&this.reconnect("retry",ri.OFFLINE)})}async request(e,r,n,i){const o=zr(6,""),s={_id:o,_type:e,_message:r},c=this.websocket.connectionID,d=()=>new De((x,N)=>{if(this.connectionState===Jr.CONNECTED)return x();const L=()=>{this.off(cr.WS_CLOSED,Q),x()},Q=()=>{this.off(cr.WS_CONNECTED,L),N(new Bt(et.WS_ABORT))};this.once(cr.WS_CONNECTED,L),this.once(cr.WS_CLOSED,Q),e!==sr.PUBLISH&&e!==sr.PUBLISH_DATASTREAM&&e!==sr.SUBSCRIBE&&e!==sr.SUBSCRIBE_DATASTREAM&&e!==sr.UNSUBSCRIBE&&e!==sr.UNSUBSCRIBE_DATASTREAM&&e!==sr.UNPUBLISH&&e!==sr.UNPUBLISH_DATASTREAM&&e!==sr.CONTROL&&e!==sr.RESTART_ICE||this.once(cr.DISCONNECT_P2P,()=>{N(new Bt(et.DISCONNECT_P2P))}),e!==sr.PUBLISH&&e!==sr.RESTART_ICE||this.once(cr.ABORT_P2P_EXECUTION,()=>{N(new Bt(et.DISCONNECT_P2P))})});if(this.connectionState!==Jr.CONNECTING&&this.connectionState!==Jr.RECONNECTING||e===sr.JOIN||e===sr.REJOIN||await d(),this.websocket.sendMessage(s,!0),i)return;const u=new De((x,N)=>{let L=!1;const Q=(at,Rt)=>{L=!0,x({isSuccess:at==="success",message:Rt||{}}),this.off(cr.WS_CLOSED,J),this.off(cr.WS_RECONNECTING,J),this.emit(cr.REQUEST_SUCCESS,e,r)};this.once("res-@".concat(o),Q);const J=()=>{N(new Bt(et.WS_ABORT,"type: ".concat(e))),this.off(cr.WS_CLOSED,J),this.off(cr.WS_RECONNECTING,J),this.off("res-@".concat(o),Q)};this.once(cr.WS_CLOSED,J),this.once(cr.WS_RECONNECTING,J),Yn(st("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==c||L||(C.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(cr.REQUEST_TIMEOUT,e,r))})});let l=null;try{l=await u}catch(x){if(this.connectionState===Jr.CLOSED||e===sr.LEAVE)throw new Bt(et.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?x.throw():e===sr.JOIN||e===sr.REJOIN?null:(await d(),await this.request(e,r))}if(l.isSuccess)return l.message;const T=Number(l.message.error_code||l.message.code),v=sl(T),y=new Bt(et.UNEXPECTED_RESPONSE,"".concat(v.desc,": ").concat(l.message.error_str),{code:T,data:l.message,desc:v.desc});return v.action==="success"?l.message:(C.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(T,", message: ").concat(v.desc,", action: ").concat(v.action)),T===er.ERR_TOO_MANY_BROADCASTERS?((e===sr.JOIN||e===sr.REJOIN)&&(this.initError=y,this.close()),y.throw()):v.action==="failed"?y.throw():v.action==="quit"?(this.initError=y,this.close(),y.throw()):(T===er.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,C.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ri.MULTI_IP)):this.reconnect(v.action,ri.SERVER_ERROR),e===sr.JOIN||e===sr.REJOIN?null:await this.request(e,r)))}waitMessage(e,r){return new De(n=>{const i=o=>{(!r||r(o))&&(this.off(e,i),n(o))};this.on(e,i)})}uploadWRTCStats(e){if(!this.store.sessionId)return void C.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(il.WRTC_STATS,r)}upload(e,r){const n={_type:e,_message:r};try{this.websocket.sendMessage(n)}catch{const o=st("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>o&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Jr.CONNECTED)return;const s=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(s._type,s._message)},st("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,r){const n={_type:e,_message:r};this.websocket.sendMessage(n)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new De((r,n)=>{this.once(cr.WS_CONNECTED,()=>r(this.joinResponse)),this.once(cr.WS_CLOSED,i=>n(this.initError||new Bt(et.WS_ABORT,i))),this.connectionState=Jr.CONNECTING,this.websocket.init(e).catch(n),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||Lr.LEAVE,this.connectionState=Jr.CLOSED,C.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(cr.ABORT_P2P_EXECUTION),this.store.signalConnected();const e=await ni(this,cr.REQUEST_JOIN_INFO);this.store.joinReq();const r=await this.request(sr.JOIN,e);if(this.ortc=e?.ortc,this.store.joinRep(),!r)return this.emit(cr.REPORT_JOIN_GATEWAY,Jp.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(cr.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Jr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Bt(et.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=Xu(this,cr.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const r=await this.request(sr.REJOIN,e);return!!r&&(this.connectionState=Jr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),r.peers&&r.peers.forEach(n=>{this.emit(yr.ON_USER_ONLINE,{uid:n.uid}),n.audio&&this.emit(yr.ON_ADD_AUDIO_STREAM,{uid:n.uid,uint_id:n.uint_id,audio:!0,ssrcId:n.audio_ssrc}),n.video&&this.emit(yr.ON_ADD_VIDEO_STREAM,{uid:n.uid,uint_id:n.uint_id,video:!0,ssrcId:n.video_ssrc}),n.audio_mute?this.emit(yr.MUTE_AUDIO,{uid:n.uid}):this.emit(yr.UNMUTE_AUDIO,{uid:n.uid}),n.video_mute?this.emit(yr.MUTE_VIDEO,{uid:n.uid}):this.emit(yr.UNMUTE_VIDEO,{uid:n.uid}),n.audio_enable_local?this.emit(yr.ENABLE_LOCAL_AUDIO,{uid:n.uid}):this.emit(yr.DISABLE_LOCAL_AUDIO,{uid:n.uid}),n.video_enable_local?this.emit(yr.ENABLE_LOCAL_VIDEO,{uid:n.uid}):this.emit(yr.DISABLE_LOCAL_VIDEO,{uid:n.uid}),n.audio||n.video||this.emit(yr.ON_REMOVE_STREAM,{uid:n.uid,uint_id:n.uint_id})}),!0)}reconnect(e,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,r)}async downgradeCodec(e){if(!this.ortc)return!1;const r={downgrade_codec:e,ortc:this.ortc};return!!await this.request(sr.DOWNGRADE_CODEC,r)}handleNotification(e){C.debug("[".concat(this.clientId,"] receive notification: "),e);const r=sl(e.code);if(e.code===28&&"detail"in e&&(C.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(cr.RECOVER_NOTIFICATION,e.detail)),r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Lr.UID_BANNED),void this.close()):void this.reconnect(r.action,ri.SERVER_ERROR);C.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=st("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=e&&(C.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>st("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ri.TIMEOUT):this.request(sr.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const n=Date.now()-r;this.rttRolling.add(n),st("REPORT_STATS")&&this.send(sr.PING_BACK,{pingpongElapse:n})}).catch(n=>{})}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:r}=this.websocket.getWsInflateData();e!==0&&r!==0&&this.upload(il.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(pr.RECONNECT_CREATE_CONNECTION,e=>{this.emit(cr.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(pr.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(pr.CLOSED,()=>{this.connectionState=Jr.CLOSED}),this.websocket.on(pr.FAILED,()=>{this._disconnectedReason=Lr.NETWORK_ERROR,this.connectionState=Jr.CLOSED}),this.websocket.on(pr.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===Jr.CONNECTED?this.connectionState=Jr.RECONNECTING:this.connectionState=Jr.CONNECTING}),this.websocket.on(pr.WILL_RECONNECT,(e,r,n)=>{const i=Xu(this,cr.IS_P2P_DISCONNECTED),o=i||e!=="retry";i&&e==="retry"&&(C.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",r=Jp.P2P_DISCONNECTED),o&&(C.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(cr.REPORT_JOIN_GATEWAY,r||Jp.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(cr.DISCONNECT_P2P)),n(e)}),this.websocket.on(pr.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{C.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",ri.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(cr.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof Bt){if(e.code===et.UNEXPECTED_RESPONSE&&e.data.code===er.ERR_NO_AUTHORIZED)return this.initError=new Bt(et.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Lr.TOKEN_EXPIRE);C.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ri.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(pr.REQUEST_NEW_URLS,(e,r)=>{ni(this,cr.REQUEST_RECOVER,this.multiIpOption).then(e).catch(r)}),this.websocket.on(pr.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(yr.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(HO.PRE_CONNECT_PC,()=>{this.emit(cr.PRE_CONNECT_PC)})}}let PH=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),Cn=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function qO(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Qp(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?qO(Object(r),!0).forEach(function(n){G(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):qO(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function wa(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(st("TURN_DOMAIN")):(C.debug("Cannot recognized as ip address: ".concat(t,", use as host2")),t)}function $p(t){try{const e=st("GATEWAY_DOMAINS").concat(st("TURN_DOMAIN")).find(r=>Ce(t).call(t,r));return e?t.split(".".concat(e))[0].replace(/-/g,"."):t}catch{return C.debug("serverUrlToIp error, fallback to url",t),t}}function Gg(t,e){t.addresses||(t.addresses=[]);const r=function(c,d){if(st("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return c.map(T=>{let{ip:v,port:y}=T;return{address:"".concat(v,":").concat(y)}});const u=st("GATEWAY_DOMAINS");let l=u[1]&&Ce(d).call(d,u[1])?1:0;return c.map(T=>{let{domain_prefix:v,port:y,ip:x}=T;if(v)return{address:"".concat(v,".").concat(u[l++%u.length],":").concat(y)};const N=/^[\.\:\d]+$/.test(x),L=N?"".concat(x.replace(/[^\d]/g,"-"),".").concat(u[l++%u.length],":").concat(y):"".concat(x,":").concat(y);return N||C.debug("Cannot recognized as ip address: ".concat(x,", use as host3")),{ip:x,port:y,address:L}})}(t.addresses,e),n=Array.isArray(t.detail)&&t.detail[18];if(n&&typeof n=="string"){const c=n.split(";");for(let d=0;d<c.length;d++){var i;const u=Ei(i=c[d]).call(i);r[d]&&u&&(r[d].ip6=u)}}const o=t.detail&&t.detail.candidate;let s;if(o){const[c,d]=o.split(":");c&&d&&(s={port:Number(d),ip:c,address:"".concat(c,":").concat(d)})}return{gatewayAddrs:r,apGatewayAddress:s,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function zi(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function YO(t){const e=t._encoderConfig;if(!e)return{};const r={resolution:e.width&&e.height?"".concat(zi(e.width),"x").concat(zi(e.height)):void 0,maxVideoBW:e.bitrateMax,minVideoBW:e.bitrateMin};return typeof e.frameRate=="number"?(r.maxFrameRate=e.frameRate,r.minFrameRate=e.frameRate):e.frameRate&&(r.maxFrameRate=e.frameRate.max||e.frameRate.ideal||e.frameRate.exact||e.frameRate.min,r.minFrameRate=e.frameRate.min||e.frameRate.ideal||e.frameRate.exact||e.frameRate.max),r}function XO(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function cl(t,e){let r,n,i;switch(e){case Cn.CHOOSE_SERVER:n=4096,i="choose server";break;case Cn.CLOUD_PROXY:n=1048576,i="proxy";break;case Cn.CLOUD_PROXY_5:n=4194304,i="proxy5";break;case Cn.CLOUD_PROXY_FALLBACK:n=4194310,i="proxy fallback";break;default:throw new Bt(et.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(o=>{o.buffer&&o.buffer.flag===n&&(r={code:o.buffer.code,addresses:(o.buffer.edges_services||[]).map(s=>Qp(Qp({},s),{},{ticket:o.buffer.cert})),server_ts:t.enter_ts,uid:o.buffer.uid,cid:o.buffer.cid,cname:o.buffer.cname,detail:Qp(Qp({},o.buffer.detail),t.detail),flag:o.buffer.flag,opid:t.opid,cert:o.buffer.cert})}),!r)throw new Bt(et.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return r}async function JO(t,e){return await De.all(t.addresses.map(async r=>({address:wa(r.ip),tcpport:r.port,udpport:r.port,username:e&&st("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?e.toString():ii.username,password:e&&st("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await HE(e.toString()):ii.password})))}function Hg(t,e){const r=e.getMediaStreamTrack(!0).getSettings(),n=e.videoHeight||r.height,i=e.videoWidth||r.width;return n&&i?Math.max(Math.min(n,i)/Math.min(zi(t.height),zi(t.width)),1):(C.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Na(t){let{candidateType:e,relayProtocol:r,type:n,address:i,port:o,protocol:s}=t;const c={candidateType:e,relayProtocol:r,protocol:s};if(n!=="local-candidate"){const d=i.split(".");d.length>=4&&(d[1]="*",d[2]="*"),c.address=d.join("."),c.port=o}return c}function vc(t){const e=t.split(":"),r=t.split(/[-.]/),n=Ce(t).call(t,"-")?"-":".";let i=t;return e.length>1?r.length>1?(r[1]="**",i=r[0]+n+"**:"+e[e.length-1]):i=e.length>2?e[0]+n+"**:"+e[e.length-1]:"**:"+e[e.length-1]:r.length>1&&(i=r[0]+n+"**"),i}function tf(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:st("SVC_MODE");if(st("ENABLE_SVC"))return function(e){return e in Op}(t)?t:Op.L1T3}const ZO={[Ue.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Ue.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function ef(t,e,r){e.forEach(n=>{var i;const o=ZO[t].find(c=>{var d;let{key:u}=c;return Ce(d=n.extensionName).call(d,u)});if(!o)return;const s=r.find(c=>{let{extensionName:d}=c;return Ce(d).call(d,o.key)});s&&Ce(i=s.extensionName).call(i,"gdpr_forbidden")&&(n.extensionName=s.extensionName)})}function jd(t,e){e.forEach(r=>{var n;const i=ZO[t].find(o=>{var s;let{key:c}=o;return Ce(s=r.extensionName).call(s,c)});Ce(n=r.extensionName).call(n,"gdpr_forbidden")&&i&&(r.extensionName=i.extensionName)})}function QO(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Ce(t).call(t,"abs-send-time")}function rf(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Ce(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function $O(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function tw(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?$O(Object(r),!0).forEach(function(n){G(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):$O(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function dl(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;const{filterRTX:i,filterVideoFec:o,filterAudioFec:s,filterAudioCodec:c,filterVideoCodec:d,unsupportedVideoUplinkCodec:u,unsupportedVideoDownlinkCodec:l}=e,{useXR:T}=r;let v=[],y=[],x=[],N=[],L=!1,Q=!1;if(ki(t).mediaDescriptions.forEach(at=>{n&&n!==at.attributes.direction||(at.media.mediaType!=="video"||L||(y=at.attributes.payloads,N=at.attributes.extmaps,L=!0),at.media.mediaType!=="audio"||Q||(v=at.attributes.payloads,x=at.attributes.extmaps,Q=!0))}),!N||y.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!x||v.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(y.forEach(at=>{var Rt;(Rt=at.rtpMap)!==null&&Rt!==void 0&&Rt.clockRate&&(at.rtpMap.clockRate=parseInt(at.rtpMap.clockRate)),T&&at.rtcpFeedbacks.push({type:"rrtr"})}),v.forEach(at=>{var Rt;(Rt=at.rtpMap)!==null&&Rt!==void 0&&Rt.clockRate&&(at.rtpMap.clockRate=parseInt(at.rtpMap.clockRate)),T&&at.rtcpFeedbacks.push({type:"rrtr"})}),i&&(v=v.filter(at=>{var Rt;return((Rt=at.rtpMap)===null||Rt===void 0?void 0:Rt.encodingName.toLowerCase())!=="rtx"}),y=y.filter(at=>{var Rt;return((Rt=at.rtpMap)===null||Rt===void 0?void 0:Rt.encodingName.toLowerCase())!=="rtx"})),o){const at=y.filter(pt=>{var kt;return/(red)|(ulpfec)|(flexfec)/i.test(((kt=pt.rtpMap)===null||kt===void 0?void 0:kt.encodingName)||"")}),Rt=Da(at,y).map(pt=>pt.payloadType),vt=[...at.map(pt=>pt.payloadType),...Rt];y=y.filter(pt=>!Ce(vt).call(vt,pt.payloadType))}if(s&&(v=v.filter(at=>{var Rt;return!/(red)|(ulpfec)|(flexfec)/i.test(((Rt=at.rtpMap)===null||Rt===void 0?void 0:Rt.encodingName)||"")})),c&&c?.length>0&&(v=v.filter(at=>{var Rt;return Ce(c).call(c,((Rt=at.rtpMap)===null||Rt===void 0?void 0:Rt.encodingName.toLowerCase())||"")})),d&&d?.length>0){const at=y.filter(Rt=>{var vt;return Ce(d).call(d,((vt=Rt.rtpMap)===null||vt===void 0?void 0:vt.encodingName.toLowerCase())||"")});y=at.concat(i?[]:Da(at,y))}const J=st("UNSUPPORTED_VIDEO_CODEC");if(J&&J.length>0){const at=y.filter(pt=>pt.rtpMap&&Ce(J).call(J,pt.rtpMap.encodingName.toLowerCase())),Rt=Da(at,y),vt=at.concat(Rt).map(pt=>pt.payloadType);y=y.filter(pt=>!Ce(vt).call(vt,pt.payloadType)),C.debug("unsupportedVideoCodec: ".concat(J,", toBeRemoved: ").concat(vt))}if(u&&u.length>0&&n==="sendonly"){const at=y.filter(pt=>pt.rtpMap&&Ce(u).call(u,pt.rtpMap.encodingName.toLowerCase())),Rt=Da(at,y),vt=at.concat(Rt).map(pt=>pt.payloadType);y=y.filter(pt=>!Ce(vt).call(vt,pt.payloadType)),C.debug("unsupportedVideoUplinkCodec: ".concat(u,", toBeRemoved: ").concat(vt))}if(l&&l.length>0&&n==="recvonly"){const at=y.filter(pt=>pt.rtpMap&&Ce(l).call(l,pt.rtpMap.encodingName.toLowerCase())),Rt=Da(at,y),vt=at.concat(Rt).map(pt=>pt.payloadType);y=y.filter(pt=>!Ce(vt).call(vt,pt.payloadType)),C.debug("unsupportedVideoDownlinkCodec: ".concat(l,", toBeRemoved: ").concat(vt))}return{audioCodecs:v,videoCodecs:y,audioExtensions:x,videoExtensions:N}}function Pa(t){const e=ki(t);let r,n;for(const i of e.mediaDescriptions){if(!r){const o=i.attributes.iceUfrag,s=i.attributes.icePwd;if(!o||!s)throw new Error("Cannot get iceUfrag or icePwd from SDP.");r={iceUfrag:o,icePwd:s}}if(!n){const o=i.attributes.fingerprints;o.length>0&&(n={fingerprints:o})}}if(!n&&e.attributes.fingerprints.length>0&&(n={fingerprints:e.attributes.fingerprints}),!n||!r)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:r,dtlsParameters:n}}function ew(t,e){const r=[],n=t.attributes.ssrcGroups.filter(s=>s.semantic==="FID"),i=t.attributes.ssrcGroups.find(s=>s.semantic==="SIM"),o=t.attributes.ssrcs;if(i)i.ssrcIds.forEach(s=>{var c;const d=(c=n.find(u=>u.ssrcIds[0]===s))===null||c===void 0?void 0:c.ssrcIds[1];r.push({ssrcId:s,rtx:e?d:void 0})});else if(n.length>0){const s=n[0].ssrcIds[0],c=n[0].ssrcIds[1];r.push({ssrcId:s,rtx:e?c:void 0})}else{if(o.length===0)throw new Error("No ssrcs found on local media description.");r.push({ssrcId:o[0].ssrcId})}return r}function rw(t,e,r){const{cname:n}=t;let i=[];e&&(i=nw(e)),i.length===0&&(i=t.iceParameters.candidates.map(l=>({foundation:l.foundation,componentId:"1",transport:l.protocol,priority:l.priority.toString(),connectionAddress:l.ip,port:l.port.toString(),type:l.type,extension:{}})),C.debug("Using candidates from gateway."));const o={fingerprints:t.dtlsParameters.fingerprints.map(l=>({hashFunction:l.algorithm,fingerprint:l.fingerprint}))},s={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let c;switch(t.dtlsParameters.role){case"server":c="passive";break;case"client":c="active";break;case"auto":c="actpass"}const d=of(t.rtpCapabilities),u=[];return Array.isArray(r)&&r.length>0&&r.forEach(l=>{u.push({kind:Ue.VIDEO,ssrcMsg:[{ssrcId:l.v,rtx:l.v_rtx}],mslabel:"".concat(l.v,"_").concat(l.a)},{kind:Ue.AUDIO,ssrcMsg:[{ssrcId:l.a}],mslabel:"".concat(l.v,"_").concat(l.a)})}),{dtlsParameters:o,iceParameters:s,candidates:i,rtpCapabilities:d,setup:c,cname:n,preSSRCs:u}}function nw(t){let e=[];return t.ip&&typeof t.port=="number"&&(e=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],C.debug("Using remote candidate from AP ".concat(vc(t.ip),":").concat(t.port)),t.ip6&&(e.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),C.debug("Using IPV6 remote candidate from AP ".concat(vc(t.ip6),":").concat(t.port)))),e}function ul(t,e,r){const n=[],i=[];return t.forEach(o=>{let{ssrcId:s,rtx:c}=o;const d=zr(8,"track-"),u={ssrcId:s,attributes:tw({label:d,mslabel:r=r||zr(10,""),msid:"".concat(r," ").concat(d)},e&&{cname:e})};if(n.push(u),c!==void 0){const l={ssrcId:c,attributes:tw({label:d,mslabel:r,msid:"".concat(r," ").concat(d)},e&&{cname:e})};n.push(l),i.push({semantic:"FID",ssrcIds:[s,c]})}}),t.length>1&&i.push({semantic:"SIM",ssrcIds:t.map(o=>{let{ssrcId:s}=o;return s})}),{ssrcs:n,ssrcGroups:i}}function Bd(t,e){e instanceof Tn&&t.attributes.payloads.forEach(r=>{var n;const i=(n=r.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase();if(!i||["opus","pcmu","pcma","g722"].indexOf(i)===-1)return;r.fmtp||(r.fmtp={parameters:{}}),i==="opus"&&typeof st("OPUS_PTIME")=="number"?r.fmtp.parameters.ptime=st("OPUS_PTIME"):r.fmtp.parameters.minptime="10",r.fmtp.parameters.useinbandfec="1";const o=e._encoderConfig;o&&(i!=="pcmu"&&i!=="pcma"&&i!=="g722"&&(o.bitrate&&!mn()&&(r.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*o.bitrate))),o.sampleRate&&(r.fmtp.parameters.maxplaybackrate="".concat(o.sampleRate),r.fmtp.parameters["sprop-maxcapturerate"]="".concat(o.sampleRate)),o.stereo&&(r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1")),e instanceof rl&&i==="opus"&&e._config.DTX&&(r.fmtp.parameters.usedtx="1"))})}function Wg(t){const e=t.attributes.unrecognized.findIndex(r=>r.attField==="x-google-flag"&&r.attValue==="conference");e!==-1&&t.attributes.unrecognized.splice(e,1)}function Kg(t,e){var r;if(!(e instanceof Zr&&e._encoderConfig&&e._hints.indexOf(Wr.SCREEN_TRACK)===-1))return;const n=e._encoderConfig;br().supportMinBitrate&&n.bitrateMin&&t.attributes.payloads.forEach(i=>{var o,s;Ce(o=["h264","h265","vp8","vp9","av1"]).call(o,((s=i.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-min-bitrate"]="".concat(n.bitrateMin))}),br().supportMinBitrate&&!Ce(r=e._hints).call(r,Wr.LOW_STREAM)&&n.bitrateMax&&t.attributes.payloads.forEach(i=>{var o,s;Ce(o=["h264","h265","vp8","vp9","av1"]).call(o,((s=i.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-start-bitrate"]="".concat(st("X_GOOGLE_START_BITRATE")||Math.floor(n.bitrateMax)))})}function iw(t){if(t.media.mediaType!=="video")return;const e=Rr();if(e.name!==wr.SAFARI&&e.os!==Vn.IOS)return;const r=t.attributes.extmaps.findIndex(n=>/video-orientation/g.test(n.extensionName));r!==-1&&t.attributes.extmaps.splice(r,1)}function nf(t,e,r){if(!e)return;let n,i;if(t.media.mediaType==="video"?(n=r.videoExtensions,i=r.videoCodecs):(n=r.audioExtensions,i=r.audioCodecs),e.twcc===!0){const o=n.find(s=>rf(s.extensionName));if(o){const s=o.extensionName;t.attributes.extmaps.find(d=>rf(d.extensionName))||t.attributes.extmaps.push({entry:o.entry,extensionName:s}),function(d,u){return u.filter(l=>!!d.find(T=>T.payloadType===l.payloadType&&!!T.rtcpFeedbacks.find(v=>v.type==="transport-cc")))}(i,t.attributes.payloads).forEach(d=>{d.rtcpFeedbacks.find(u=>u.type==="transport-cc")||d.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(e.twcc===!1){const o=t.attributes.extmaps.findIndex(s=>rf(s.extensionName));o!==-1&&t.attributes.extmaps.splice(o,1),t.attributes.payloads.forEach(s=>{const c=s.rtcpFeedbacks.findIndex(d=>d.type==="transport-cc");c!==-1&&s.rtcpFeedbacks.splice(c,1)})}if(e.remb===!0){const o=n.find(s=>QO(s.extensionName));if(o){const s=o.extensionName;t.attributes.extmaps.find(d=>d.extensionName===s)||t.attributes.extmaps.push({entry:o.entry,extensionName:s}),function(d,u){return u.filter(l=>!!d.find(T=>T.payloadType===l.payloadType&&!!T.rtcpFeedbacks.find(v=>v.type==="goog-remb")))}(i,t.attributes.payloads).forEach(d=>{d.rtcpFeedbacks.find(u=>u.type==="goog-remb")||d.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(e.remb===!1){const o=t.attributes.extmaps.findIndex(s=>QO(s.extensionName));o!==-1&&t.attributes.extmaps.splice(o,1),t.attributes.payloads.forEach(s=>{const c=s.rtcpFeedbacks.findIndex(d=>d.type==="goog-remb");c!==-1&&s.rtcpFeedbacks.splice(c,1)})}}function ow(t,e,r){if(mn()||t.media.mediaType!=="video"||!(e instanceof Zr)||r!=="vp9"&&r!=="vp8"||r==="vp8"&&!st("SIMULCAST")||r==="vp9"&&st("ENABLE_SVC")||e._scalabilityMode===void 0||e._scalabilityMode.numSpatialLayers<=1)return;const n=r==="vp8"?2:e._scalabilityMode.numSpatialLayers,i=t.attributes.ssrcs[0],o=t.attributes.ssrcGroups.find(c=>c.semantic==="FID"&&c.ssrcIds[0]===i.ssrcId),s={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let c=1;c<n;c++)t.attributes.ssrcs.push({ssrcId:i.ssrcId+c,attributes:dn(i.attributes)}),s.ssrcIds.push(i.ssrcId+c),o&&(t.attributes.ssrcs.push({ssrcId:o.ssrcIds[1]+c,attributes:dn(i.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+c,o.ssrcIds[1]+c]}));t.attributes.ssrcGroups.unshift(s)}async function sw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new RTCPeerConnection;r.addTransceiver("video",{direction:"sendonly"}),r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});const n=(await r.createOffer()).sdp,{send:i,recv:o,sendrecv:s}=function(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=arguments.length>2?arguments[2]:void 0;const l=dl(u,c,d,"sendonly"),T=dl(u,c,d,"recvonly"),v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},x={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Bo(l,T,"videoExtensions",v,y,x),Bo(l,T,"videoCodecs",v,y,x),Bo(l,T,"audioExtensions",v,y,x),Bo(l,T,"audioCodecs",v,y,x),st("RAISE_H264_BASELINE_PRIORITY")){const N=[],L=[];if(x.videoCodecs.forEach((Q,J)=>{var at;if(((at=Q.rtpMap)===null||at===void 0?void 0:at.encodingName.toLocaleLowerCase())==="h264"){var Rt,vt;const pt=x.videoCodecs[J+1],kt=pt&&lw(Q,pt),$t=(Rt=Q.fmtp)===null||Rt===void 0?void 0:Rt.parameters["profile-level-id"],se=(vt=Q.fmtp)===null||vt===void 0?void 0:vt.parameters["packetization-mode"];!$t||$t!==st("FIRST_H264_PROFILE_LEVEL_ID")||st("FIRST_PACKETIZATION_MODE")&&se!==st("FIRST_PACKETIZATION_MODE")?kt?L.push([Q,pt]):L.push([Q]):kt?N.push([Q,pt]):N.push([Q])}}),N.length>0&&L.length>0){C.debug("raising H264 baseline profile priority"),x.videoCodecs.forEach((J,at)=>{var Rt;if(((Rt=J.rtpMap)===null||Rt===void 0?void 0:Rt.encodingName.toLocaleLowerCase())==="h264"){const vt=lw(J,x.videoCodecs[at+1]),pt=N.shift()||L.shift()||[];pt.length>0&&(vt?x.videoCodecs.splice(at,2,...pt):x.videoCodecs.splice(at,1,...pt))}});const Q=y.videoCodecs.filter(J=>{var at,Rt;return((at=J.rtpMap)===null||at===void 0?void 0:at.encodingName.toLocaleLowerCase())==="h264"&&((Rt=J.fmtp)===null||Rt===void 0?void 0:Rt.parameters["profile-level-id"])!==st("FIRST_H264_PROFILE_LEVEL_ID")});if(Q.length>0){const J=Da(Q,y.videoCodecs).map(Rt=>Rt.payloadType),at=[...Q.map(Rt=>Rt.payloadType),...J];y.videoCodecs=y.videoCodecs.filter(Rt=>!Ce(at).call(at,Rt.payloadType))}st("FILTER_SEND_H264_BASELINE")&&(v.videoCodecs=v.videoCodecs.filter(J=>{var at,Rt;return!(((at=J.rtpMap)===null||at===void 0?void 0:at.encodingName.toLocaleLowerCase())==="h264"&&((Rt=J.fmtp)===null||Rt===void 0?void 0:Rt.parameters["profile-level-id"])!==st("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:v,recv:y,sendrecv:x}}return{send:v,recv:y,sendrecv:x}}(t,e,n);try{r.close()}catch{}return{send:i,recv:o,sendrecv:s}}function aw(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},e=dl(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Bo(t,e,"videoExtensions",r,n,i),Bo(t,e,"videoCodecs",r,n,i),Bo(t,e,"audioExtensions",r,n,i),Bo(t,e,"audioCodecs",r,n,i),st("RAISE_H264_BASELINE_PRIORITY")){const o=i.videoCodecs.findIndex(s=>s.rtpMap&&s.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&s.fmtp&&s.fmtp.parameters["profile-level-id"]==="42001f");if(o!==-1){const s=i.videoCodecs.findIndex(c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(s<o){C.debug("raising H264 baseline profile priority");const c=i.videoCodecs[o];i.videoCodecs.splice(o,1),i.videoCodecs.splice(s,0,c)}s!==-1&&(n.videoCodecs=n.videoCodecs.filter(c=>!(c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:r,recv:n,sendrecv:i}}function Bo(t,e,r,n,i,o){if(r==="videoExtensions"||r==="audioExtensions"){const s=[];return t[r].forEach(c=>{e[r].some((d,u)=>{if(c.entry===d.entry&&c.extensionName===d.extensionName)return s.push(u),!0})?o[r].push(c):n[r].push(c)}),void e[r].forEach((c,d)=>{s.indexOf(d)===-1&&i[r].push(c)})}if(r==="videoCodecs"||r==="audioCodecs"){const s=[];return t[r].forEach(c=>{e[r].some((d,u)=>{if(c.payloadType===d.payloadType&&JSON.stringify(c)===JSON.stringify(d))return s.push(u),!0})?o[r].push(c):n[r].push(c)}),void e[r].forEach((c,d)=>{s.indexOf(d)===-1&&i[r].push(c)})}}function of(t){const{send:e,recv:r,sendrecv:n}=t;if(!n){if(!e||!r)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:e,recv:r}}let i,o;return e?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...e.audioCodecs,...n.audioCodecs],i.videoCodecs=[...e.videoCodecs,...n.videoCodecs],i.audioExtensions=[...e.audioExtensions,...n.audioExtensions],i.videoExtensions=[...e.videoExtensions,...n.videoExtensions]):i=n,r?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...r.audioCodecs,...n.audioCodecs],o.videoCodecs=[...r.videoCodecs,...n.videoCodecs],o.audioExtensions=[...r.audioExtensions,...n.audioExtensions],o.videoExtensions=[...r.videoExtensions,...n.videoExtensions]):o=n,{send:i,recv:o}}function Fd(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(e=>{var r;return((r=e.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase())==="opus"}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function ll(t,e,r,n){let i=[];if(t===Ue.VIDEO){if(st("H264_PROFILE_LEVEL_ID")&&n==="h264"&&(i=e.videoCodecs.filter(o=>{var s;return Ce(s=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(s,n)&&o&&o.fmtp&&o.fmtp.parameters["profile-level-id"]===st("H264_PROFILE_LEVEL_ID")})),!Array.isArray(i)||i.length===0){let o=[];const s=[],c=[],d=[];if(r.videoCodecs.forEach(u=>{const l=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"";Ce(l).call(l,n)?o.push(u):Ce(l).call(l,"vp9")?s.push(u):Ce(l).call(l,"vp8")?c.push(u):Ce(l).call(l,"h264")&&d.push(u)}),o.length===0){let u="";s.length!==0?(o=s,u="vp9"):c.length!==0?(o=c,u="vp8"):d.length!==0&&(o=d,u="h264"),C.warning("codec ".concat(n," not included in rtpCapabilities, fallback to default payloads: ").concat(u))}o.length!==0&&(i=e.videoCodecs.filter(u=>o.some(l=>l.payloadType===u.payloadType)))}if(i.length===0&&(C.warning("codec ".concat(n," not included in rtpCapabilities, fallback to default payloads: ").concat(e.videoCodecs[0].rtpMap&&e.videoCodecs[0].rtpMap.encodingName)),i=e.videoCodecs),st("USE_PUB_RTX")||st("USE_SUB_RTX")){const o=Da(i,e.videoCodecs);i=[...i,...o]}}else{i=e.audioCodecs.filter(s=>{var c;return Ce(c=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(c,n)});const o=e.audioCodecs.filter(s=>{var c;return Ce(c=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(c,"red")});i.length===0&&(C.warning("codec ".concat(n," not included in rtpCapabilities, fallback to opus")),i=e.audioCodecs.filter(s=>{var c;return Ce(c=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(c,"opus")})),st("ENABLE_AUDIO_RED")&&o.length!==0&&(i=[...o,...i])}return i}function Da(t,e){const r=t.map(n=>n.payloadType.toString());return e.filter(n=>n.rtpMap&&n.rtpMap.encodingName==="rtx"&&n.fmtp&&n.fmtp.parameters.apt&&Ce(r).call(r,n.fmtp&&n.fmtp.parameters.apt))}async function ka(t,e,r){const n=e.toString(),i=dw(n,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:n});const o=await t.createAnswer();if(!o.sdp)throw new Error("cannot get answer sdp");let s=o.sdp;s=cw(s,r||{}),i?.(s||""),await t.setLocalDescription({type:"answer",sdp:s})}function cw(t,e,r){const n=ki(t),{useXR:i}=e;return n.mediaDescriptions.forEach(o=>{var s;o.attributes.mid&&(Array.isArray(r)&&!Ce(r).call(r,o.attributes.mid)||(o.media.mediaType==="audio"&&Fd(o),i&&Ce(s=["audio","video"]).call(s,o.media.mediaType)&&o.attributes.payloads.forEach(c=>{c.rtcpFeedbacks.findIndex(d=>d.type==="rrtr")===-1&&c.rtcpFeedbacks.push({type:"rrtr"})})))}),Ca(n)}function dw(t,e,r,n){if(st("SDP_LOGGING"))return C.upload("exchanging ".concat(r," ").concat(e," SDP during P2PConnection.").concat(n,`
`),t),e==="offer"?i=>{dw(i,"answer",r==="local"?"remote":"local",n)}:void 0}function uw(t){const e=st("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(e)&&e.length>0)&&e.some(r=>Ce(t).call(t,r))}function lw(t,e){try{var r;return((r=t.fmtp)===null||r===void 0?void 0:r.parameters.apt)===e.payloadType.toString()}catch{return!1}}function hw(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function co(t,e){return typeof st(t)===e?st(t):void 0}function DH(){try{const t=st("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r]!=null?arguments[r]:{};r%2?hw(Object(n),!0).forEach(function(i){G(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hw(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}({},t)}catch(t){return C.debug("handle gateway attributes failed: ",t),{}}}const pw={};function La(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&C.debug("install service ".concat(t.name)),pw[t.name]=t}function Zs(t){const e=pw[t];if(!e)throw new Qt(et.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return e}function fw(t,e){return Zs("DataStream").create(t,e)}function sf(){return Zs("InterceptFrame").create()}function mw(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function _i(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?mw(Object(r),!0).forEach(function(n){G(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):mw(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}const zg=new Map;class kH extends pn{get state(){return this._state}set state(e){if(e===this._state)return;const r=this._state;this._state=e,e==="DISCONNECTED"&&this._disconnectedReason?this.emit(Gn.CONNECTION_STATE_CHANGE,e,r,this._disconnectedReason):this.emit(Gn.CONNECTION_STATE_CHANGE,e,r)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){C.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,r){var n,i,o;super(),G(this,"store",void 0),G(this,"joinInfo",void 0),G(this,"key",void 0),G(this,"ntpOffset",0),G(this,"signal",void 0),G(this,"role",void 0),G(this,"isPreallocation",void 0),G(this,"isPreSub",void 0),G(this,"inChannelInfo",{joinAt:null,duration:0}),G(this,"spec",void 0),G(this,"_state","DISCONNECTED"),G(this,"_statsCollector",void 0),G(this,"_disconnectedReason",void 0),G(this,"isSignalRecover",!1),G(this,"hasChangeBGPAddress",!1),G(this,"trafficStatsInterval",void 0),G(this,"networkQualityInterval",void 0),G(this,"_joinGatewayStartTime",0),G(this,"_signalTimeout",!1),G(this,"_clientRoleOptions",void 0),G(this,"_isProactiveJoin",!1),this.store=e,this.spec=r,this.signal=this.store.useP2P?(n={spec:_i(_i({},r),{},{retryConfig:r.websocketRetryConfig}),store:e},(i=(o=Zs("P2PChannel")).createSubmodule)===null||i===void 0?void 0:i.call(o,n)):new NH(_i(_i({},r),{},{retryConfig:r.websocketRetryConfig}),e),this._statsCollector=r.statsCollector,this.role=r.role||"audience",this._clientRoleOptions=r.clientRoleOptions,this.handleSignalEvents()}async join(e,r,n){this.store.joinGatewayStart(),e.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const i=Date.now();let o=zg.get(e.cname);if(o||(o=new Map,zg.set(e.cname,o)),this._isProactiveJoin=!0,o.has(e.uid)){const u=new Bt(et.UID_CONFLICT);throw qe.joinGateway(e.sid,{lts:i,succ:!1,ec:u.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),u}o.set(e.uid,!0),this.joinInfo=e,this.key=r;let s=0;this.joinGatewayStartTime=i;const c=e.proxyServer;try{C.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(s));const u=e.gatewayAddrs.map(l=>{let{address:T}=l;const[v,y]=T.split(":"),x={host:v,port:y};return e.proxyServer&&(x.proxy=e.proxyServer),x});s=(await this.signal.init(u)).uid,C.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(s," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(u){var d;throw C.error("[".concat(this.store.clientId,"] User join failed"),u.toString()),qe.joinGateway(e.sid,{lts:i,succ:!1,ec:((d=u.data)===null||d===void 0?void 0:d.desc)||u.code,errorMsg:u.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,isProxy:!!c,signalChannel:"0",preload:e.preload}),o.delete(e.uid),this.signal.close(),u}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),C.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(u=>{C.warning("[".concat(this.store.clientId,"] get traffic stats error"),u.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Gn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Gn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Gn.NETWORK_QUALITY,{uplinkNetworkQuality:XO(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:XO(this._statsCollector.trafficStats.B_dnq)}):this.emit(Gn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),s}async leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],r=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){r!==Lr.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==Jr.CONNECTED||await function(n,i){return i===1/0?n:De.race([n,i6(i)])}(this.signal.request(sr.LEAVE,void 0,!0),3e3)}catch(n){C.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),n)}this.signal.close(r),r!==Lr.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,r,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Bt(et.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={state:"offer",p2p_id:this.store.p2pId,ortc:r,mode:this.spec.mode,extend:st("PUB_EXTEND"),twcc:!!st("PUBLISH_TWCC"),rtx:!!st("USE_PUB_RTX")};try{return(await this.signal.request(sr.PUBLISH,i,!0))._message}catch(o){if(n&&o.data&&o.data.code===er.ERR_PUBLISH_REQUEST_INVALID)return C.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),o.toString()),await this.tryUnpubBeforeRepub(e,r),this.publish(e,r,!1);throw o}}async publishDataChannel(e,r,n){var i;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Bt(et.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const o={stream_id:r.streamId,ordered:r.ordered?1:0,max_retrans_times:(i=r.maxRetransmits)!==null&&i!==void 0?i:10,channel_id:r.channelId,metadata:r.metadata};try{await this.signal.request(sr.PUBLISH_DATASTREAM,o,!0)}catch(s){if(n&&s.data&&s.data.code===er.ERR_PUBLISH_REQUEST_INVALID)return C.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),s.toString()),await this.tryUnpubDataChannelBeforeRepub(e,r),this.publishDataChannel(e,r,!1);throw s}}async unpublish(e,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Bt(et.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(sr.UNPUBLISH,{stream_id:r,ortc:e},!0)}catch(n){C.warning("[".concat(this.store.clientId,"] unpublish warning: "),n)}}async unpublishDataChannel(e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Bt(et.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await De.all(e.map(r=>this.signal.request(sr.UNPUBLISH_DATASTREAM,{channel_id:r},!0)))}catch(r){C.warning("unpublish datachannels warning: ",r)}}async presubscribe(e,r,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Bt(et.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const i={stream_id:e,stream_type:r,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!st("SUBSCRIBE_TWCC"),rtx:!!st("USE_SUB_RTX")||void 0,extend:st("SUB_EXTEND"),svc:Array.isArray(st("SVC"))&&st("SVC").length!==0?st("SVC"):void 0};try{return await this.signal.request(sr.PRE_SUBSCRIBE,i,!0)}catch(o){if(n&&o.data&&o.data.code===er.ERR_SUBSCRIBE_REQUEST_INVALID)return C.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),o.toString()),this.presubscribe(e,r,!1);throw o}}async subscribe(e,r,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Bt(et.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const i={stream_id:e,stream_type:r.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!st("SUBSCRIBE_TWCC"),rtx:!!st("USE_SUB_RTX"),extend:st("SUB_EXTEND"),ssrcId:r.ssrcId,svc:Array.isArray(st("SVC"))&&st("SVC").length!==0?st("SVC"):void 0};try{return(await this.signal.request(sr.SUBSCRIBE,i,!0))._message}catch(o){if(n&&o.data&&o.data.code===er.ERR_SUBSCRIBE_REQUEST_INVALID)return C.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),o.toString()),await this.tryUnsubBeforeResub(e,r),await this.subscribe(e,r,!1);throw o}}async subscribeDataChannel(e,r,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Bt(et.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const i={uid:e,stream_id:r.id,channel_id:r.datachannelId};try{return void await this.signal.request(sr.SUBSCRIBE_DATASTREAM,i,!0)}catch(o){if(n&&o.data&&o.data.code===er.ERR_SUBSCRIBE_REQUEST_INVALID)return C.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),o.toString()),await this.tryUnsubDataChannelBeforeResub(e,r),await this.subscribeDataChannel(e,r,!1);throw o}}async subscribeAll(e,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Bt(et.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const n={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!st("USE_SUB_RTX"),twcc:!!st("SUBSCRIBE_TWCC"),svc:Array.isArray(st("SVC"))&&st("SVC").length!==0?st("SVC"):void 0};try{return await this.signal.request(sr.SUBSCRIBE_STREAMS,n,!0)}catch(i){if(r&&i.data&&i.data.code===er.ERR_SUBSCRIBE_REQUEST_INVALID)return C.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),i.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw i}}async setVideoProfile(e){const r=function(n){if(!(n.bitrateMax&&n.bitrateMin&&n.frameRate&&n.height&&n.width))return;let i=n.frameRate,o=n.width,s=n.height,c=!0;return typeof i!="number"&&(i=i.exact||i.ideal||i.max||i.min||0,i||(c=!1)),typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,o||(c=!1)),typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,i||(c=!1)),c?{stream_type:0,width:o,height:s,fps:i,start_bps:1e3*n.bitrateMax,min_bps:1e3*n.bitrateMin,target_bps:1e3*n.bitrateMax}:void 0}(e);if(r)return this.signal.request(sr.SET_VIDEO_PROFILE,r);C.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,r){try{await this.signal.request(sr.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:r},!0)}catch(n){C.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),n)}}async unsubscribeDataChannel(e,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Bt(et.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await De.all(e.map(n=>this.signal.request(sr.UNSUBSCRIBE_DATASTREAM,{stream_id:n,uid:r},!0)))}catch(n){C.warning("unsubscribeDataChannel warning: ",n)}}async massUnsubscribe(e){try{await this.signal.request(sr.UNSUBSCRIBE_STREAMS,e,!0)}catch(r){C.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),r)}}async reconnectPC(e){const{iceParameters:r,dtlsParameters:n,rtpCapabilities:i}=e;return{gatewayEstablishParams:await this.signal.request(sr.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:r,dtlsParameters:n,rtpCapabilities:i}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(sr.GATEWAY_INFO)}async renewToken(e){await this.signal.request(sr.RENEW_TOKEN,e),this.key=e.token}updateClientRole(e,r){r&&(this._clientRoleOptions=Object.assign({},r)),st("CLIENT_ROLE_OPTIONS")&&(C.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(st("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},st("CLIENT_ROLE_OPTIONS"))),this.role=e}async setClientRole(e,r){if(r&&(this._clientRoleOptions=Object.assign({},r)),st("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},st("CLIENT_ROLE_OPTIONS")),C.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(st("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=e);let n,i=0;e==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(n=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0;const o=Object.assign({},r);delete o.delay,delete o.level,await this.signal.request(sr.SET_CLIENT_ROLE,_i(_i({role:e,level:i,delay:n},o),{},{client_ts:Date.now()})),this.role=e}async setRemoteVideoStreamType(e,r){await this.signal.request(sr.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:r})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(sr.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,r){await this.signal.request(sr.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:r})}async pickSVCLayer(e,r){await this.signal.request(sr.PICK_SVC_LAYER,{stream_id:e,spatial_layer:r.spatialLayer,temporal_layer:r.temporalLayer})}async setRTM2Flag(e){await this.signal.request(sr.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,r,n){if(this.store.useP2P)return this.signal.sendExtensionMessage(e,r,n)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),_i({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(sr.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=zg.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(r){let n;return n=r.startsWith("dc")?r.match(/(dc\:\/\/)?([^:]+):(\d+)/):r.match(/(wss\:\/\/)?([^:]+):(\d+)/),n?{username:ii.username,password:ii.password,turnServerURL:n[2],tcpport:parseInt(n[3])+30,udpport:parseInt(n[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(_i(_i({},ii),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const e=await this.signal.request(sr.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.ntp_offset!=null&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(r=>{const n=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(i=>i.peer_uid===r.peer_uid);n&&n.B_st!==r.B_st&&Ip(()=>{this.emit(Gn.STREAM_TYPE_CHANGE,r.peer_uid,r.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){var r,n;if(!this.joinInfo||!this.key)throw new Bt(et.UNEXPECTED_ERROR,"can not generate join message, no join info");const i=Object.assign({},this.joinInfo.apResponse);let o=st("REPORT_APP_SCENARIO");if(typeof o!="string")try{o=JSON.stringify(o)}catch{o=void 0}var s;o&&o.length>128&&(o=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Gn.UPDATE_GATEWAY_CONFIG),s=this.store.clientId,Ce(Ld).call(Ld,s)||Ld.push(s);const c=ag(this.store),d=!((r=this.isPreallocation)===null||r===void 0||!r.call(this)),u=gA(this.store),l=DH(),T=md(87)||b0()||ME(117),v=(function(){const x=Rr();if(x.name!==wr.SAFARI||!x.browserVersion)return!1;const N=x.browserVersion.split(".");return Number(N[0])>18||Number(N[0])===18&&Number(N[1])>=4}()||P0(18,4,!1))&&UE(18,6,!0)&&this.spec.codec==="h264"&&st("ENABLE_ABSSENDTIME_AS_SENTTS"),y=_i({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:po,browser:navigator.userAgent,process_id:st("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:st("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:o,attributes:{userAttributes:_i(_i({enableEncodedTransform:(!!st("ENABLE_AUDIO_METADATA")||!!st("ENABLE_AUDIO_PTS"))&&T||!!st("ENABLE_AUDIO_TOPN")&&kE(wr.CHROME,87,116)||void 0,enableAudioMetadata:!!st("ENABLE_AUDIO_METADATA")&&T,enableAudioPts:!!st("ENABLE_AUDIO_PTS")&&T,topnSmoothLevel:st("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:st("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:st("TOPN_SWITCH_HOLD_MS"),topnAudioGain:st("TOPN_AUDIO_GAIN"),enablePublishedUserList:st("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:st("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:co("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:co("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:co("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:st("USE_PUB_RTX")===!0||st("USE_SUB_RTX")===!0||void 0,disableFEC:st("DISABLE_FEC"),enableNTPReport:!!st("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:u,enableFulllinkAvSync:!!st("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:co("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!st("FORCE_ENABLE_AUT_CC")||!Pp()&&(!!st("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!st("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:co("USE_XR","boolean"),enableLossbasedBwe:co("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!st("FORCE_ENABLE_AUT_CC")||!Pp()&&(!!st("ENABLE_AUT_CC")||void 0),enableCCFallback:co("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:d,preSubNum:c?co("PRE_SUB_NUM","number"):void 0,enablePubTWCC:co("PUBLISH_TWCC","boolean"),enableSubTWCC:co("SUBSCRIBE_TWCC","boolean"),enablePubRTX:co("USE_PUB_RTX","boolean"),enableSubRTX:co("USE_SUB_RTX","boolean"),enableSubSVC:st("ENABLE_SVC")?st("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(st("SVC"))&&st("SVC").length!==0?st("SVC"):void 0,enableSvcExtended:st("ENABLE_SVC")&&Array.isArray(st("SVC_EXTENDED"))&&st("SVC_EXTENDED").length!==0?st("SVC_EXTENDED"):void 0},l),{},{audioDuplicate:co("ENABLE_AUDIO_RED","boolean")?(n=co("AUDIO_DUPLICATE_NUM","number"))!==null&&n!==void 0?n:2:void 0,senttsUsesAbsSendTime:!!v||void 0})},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(y.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(y.aes_mode=this.joinInfo.aesmode,st("ENCRYPT_AES")?(y.aes_secret=this.joinInfo.aespassword,y.aes_encrypt=!0):y.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(y.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(y.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),this.joinInfo.defaultVideoStream!==void 0&&(y.default_video_stream=this.joinInfo.defaultVideoStream),y}getRejoinMessage(){if(!this.joinInfo)throw new Bt(et.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(cr.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(cr.WS_RECONNECTING,e=>{this.joinInfo&&qe.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||ri.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",qe.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(cr.WS_CLOSED,e=>{let r;switch(e){case Lr.LEAVE:r=ri.LEAVE;break;case Lr.UID_BANNED:case Lr.IP_BANNED:case Lr.CHANNEL_BANNED:case Lr.SERVER_ERROR:r=ri.SERVER_ERROR;break;case Lr.FALLBACK:r=ri.FALLBACK;break;case Lr.LICENSE_MISSING:case Lr.LICENSE_EXPIRED:case Lr.LICENSE_MINUTES_EXCEEDED:case Lr.LICENSE_PERIOD_INVALID:case Lr.LICENSE_MULTIPLE_SDK_SERVICE:case Lr.LICENSE_ILLEGAL:case Lr.TOKEN_EXPIRE:r=e;break;default:r=ri.NETWORK_ERROR}C.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(r||"undefined -> "+ri.NETWORK_ERROR)),this.joinInfo&&qe.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===Lr.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r}),this._disconnectedReason=e,e!==Lr.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(cr.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const e=st("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;e&&(e.level||e.delay)&&(C.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(e.level,", delay: ").concat(e.delay)),this.setClientRole(this.role,e))}if(qe.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void C.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));Br("EVENT_REPORT_DOMAIN",e[1]),Br("EVENT_REPORT_BACKUP_DOMAIN",e[1]),Br("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}}),this.signal.on(yr.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(cr.REQUEST_RECOVER,(e,r,n)=>{if(!this.joinInfo)return n(new Bt(et.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ni(this,Gn.REQUEST_NEW_GATEWAY_LIST).then(r).catch(n)}),this.signal.on(cr.REQUEST_JOIN_INFO,async(e,r,n)=>{var i,o,s;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const c=dn((i=this.joinInfo)===null||i===void 0?void 0:i.turnServer);if(st("NEW_TURN_MODE")&&c&&((o=this.joinInfo)===null||o===void 0?void 0:o.cloudProxyServer)==="disabled"){var d;let v=c.servers.map(N=>"turnServerURL"in N&&st("USE_TURN_IP")?_i(_i({},N),{},{turnServerURL:$p(N.turnServerURL)}):N),y=(d=c.serversFromGateway)===null||d===void 0?void 0:d.map(N=>st("USE_TURN_IP")?_i(_i({},N),{},{turnServerURL:$p(N.turnServerURL)}):N);const x=this.signal.currentURLIndex;v.length>0&&(v=[v[x%v.length]],c.servers=v),Array.isArray(y)&&y.length>0&&(y=[y[0]],c.serversFromGateway=y),C.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(x))}const{iceParameters:u,dtlsParameters:l,rtpCapabilities:T}=await ni(this,Gn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:c,cloudProxyServer:(s=this.joinInfo)===null||s===void 0?void 0:s.cloudProxyServer});try{e(this.getJoinMessage({ortc:{iceParameters:u,dtlsParameters:l,rtpCapabilities:T,version:"2"}}))}catch(v){r(v)}}),this.signal.on(cr.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(cr.REPORT_JOIN_GATEWAY,(e,r)=>{if(!this.joinInfo)return;let n,i="";var o;e instanceof Bt?(n=((o=e.data)===null||o===void 0?void 0:o.desc)||e.code,i=e.message):n=e,qe.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:n,errorMsg:i,addr:r,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(cr.IS_P2P_DISCONNECTED,e=>{e(Xu(this,Gn.IS_P2P_DISCONNECTED))}),this.signal.on(cr.DISCONNECT_P2P,()=>{this.emit(Gn.DISCONNECT_P2P)}),this.signal.on(cr.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(cr.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(cr.JOIN_RESPONSE,e=>{const r=this.getCurrentGatewayAddress();this.emit(Gn.JOIN_RESPONSE,e,r)}),this.signal.on(cr.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var e,r;this.updateTurnConfigFromSignal();const i=this.getCurrentGatewayAddress(),o=dn((e=this.joinInfo)===null||e===void 0?void 0:e.turnServer);if(st("NEW_TURN_MODE")&&o&&((r=this.joinInfo)===null||r===void 0?void 0:r.cloudProxyServer)==="disabled"){var n;let c=o.servers.map(l=>"turnServerURL"in l&&st("USE_TURN_IP")?_i(_i({},l),{},{turnServerURL:$p(l.turnServerURL)}):l),d=(n=o.serversFromGateway)===null||n===void 0?void 0:n.map(l=>st("USE_TURN_IP")?_i(_i({},l),{},{turnServerURL:$p(l.turnServerURL)}):l);const u=this.signal.currentURLIndex;c.length>0&&(c=[c[u%c.length]],o.servers=c),Array.isArray(d)&&d.length>0&&(d=[d[0]],o.serversFromGateway=d),C.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(u,",in pre pc"))}const s=st("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(i&&s){const c=nw(i);this.emit(Gn.PRE_CONNECT_PC,{candidates:c,fingerprint:s,turnServer:o})}}}),this.signal.on(cr.RECOVER_NOTIFICATION,e=>{this.joinInfo&&typeof st("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(st("AP_REQUEST_DETAIL"),";").concat(e))})}async tryUnsubBeforeResub(e,r){try{await this.signal.request(sr.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[r]},!0)}catch(n){throw C.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),n),n}}async tryUnsubDataChannelBeforeResub(e,r){try{await this.signal.request(sr.UNSUBSCRIBE,{stream_id:r.id},!0)}catch(n){throw C.warning("unsubscribe datachannel warning",n),n}}async tryUnpubBeforeRepub(e,r){try{await this.signal.request(sr.UNPUBLISH,{stream_id:e,ortc:r},!0)}catch(n){throw C.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),n),n}}async tryUnpubDataChannelBeforeRepub(e,r){try{await this.signal.request(sr.UNPUBLISH_DATASTREAM,{channnel_id:r.channelId},!0)}catch(n){throw C.warning("unpublish datastream warning: ",n),n}}async tryMassUnsubBeforeResub(e){const r={users:e.map(n=>({stream_id:n.stream_id,stream_type:n.stream_type}))};try{await this.signal.request(sr.UNSUBSCRIBE_STREAMS,r,!0)}catch(n){throw C.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),n),n}}async muteLocal(e,r){const n={action:e.find(i=>i.stream_type===Ur.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:r};try{await this.signal.request(sr.CONTROL,n,!0,!0)}catch(i){throw C.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),i),i}}async unmuteLocal(e,r){const n={action:e.find(i=>i.stream_type===Ur.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:r};try{await this.signal.request(sr.CONTROL,n,!0,!0)}catch(i){throw C.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),i),i}}async muteRemote(e,r){const n={action:e===Ue.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request(sr.CONTROL,n,!0,!0)}catch(i){throw C.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),i),i}}async unmuteRemote(e,r){const n={action:e===Ue.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request(sr.CONTROL,n,!0,!0)}catch(i){throw C.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),i),i}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,r){this.signal.upload(e,r)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const r={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(sr.RESTART_ICE,r,!0)}catch(n){throw C.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),n),n}}reconnect(e,r){this.state==="CONNECTED"&&this.signal.reconnect(e||void 0,r||ri.P2P_FAILED)}getCurrentGatewayAddress(){var e,r;if(!st("GATEWAY_WSS_ADDRESS"))return st("USE_CANDIDATE_FROM_AP_DETAIL")&&(e=this.joinInfo)!==null&&e!==void 0&&e.apGatewayAddress?(C.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(r=this.joinInfo)!==null&&r!==void 0&&r.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(sr.SET_PARAMETER,{enablePublishAudioFilter:e})}downgradeCodec(e){this.signal.downgradeCodec(e)}}let af=0,qg=0;function ds(t,e,r,n){return new De((i,o)=>{e.timeout=e.timeout||st("HTTP_CONNECT_TIMEOUT"),e.responseType=e.responseType||"json",e.data&&!r?(e.data=JSON.stringify(e.data),af+=Rs(e.data)):r&&(e.data.size?af+=e.data.size:e.data instanceof FormData?af+=q0(e.data):af+=Rs(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,bi.request(e).then(s=>{typeof s.data=="string"?qg+=Rs(s.data):s.data instanceof ArrayBuffer||s.data instanceof Uint8Array?qg+=s.data.byteLength:qg+=Rs(JSON.stringify(s.data)),n&&i({data:s.data,headers:s.headers}),i(s.data)}).catch(s=>{bi.isCancel(s)?o(new Bt(et.OPERATION_ABORTED,"cancel token canceled")):s.code==="ECONNABORTED"?o(new Bt(et.NETWORK_TIMEOUT,s.message)):s.response?o(new Bt(et.NETWORK_RESPONSE_ERROR,s.response.status)):o(new Bt(et.NETWORK_ERROR,s.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function e(ie){var Se=0;return function(){return Se<ie.length?{done:!1,value:ie[Se++]}:{done:!0}}}var r=typeof Object.defineProperties=="function"?Object.defineProperty:function(ie,Se,Fe){return ie==Array.prototype||ie==Object.prototype||(ie[Se]=Fe.value),ie},n,i=function(ie){ie=[typeof globalThis=="object"&&globalThis,ie,typeof window=="object"&&window,typeof self=="object"&&self,typeof xn=="object"&&xn];for(var Se=0;Se<ie.length;++Se){var Fe=ie[Se];if(Fe&&Fe.Math==Math)return Fe}throw Error("Cannot find global object")}(this);function o(ie,Se){if(Se)t:{var Fe=i;ie=ie.split(".");for(var ce=0;ce<ie.length-1;ce++){var w=ie[ce];if(!(w in Fe))break t;Fe=Fe[w]}(Se=Se(ce=Fe[ie=ie[ie.length-1]]))!=ce&&Se!=null&&r(Fe,ie,{configurable:!0,writable:!0,value:Se})}}function s(ie){return(ie={next:ie})[Symbol.iterator]=function(){return this},ie}function c(ie){var Se=typeof Symbol<"u"&&Symbol.iterator&&ie[Symbol.iterator];return Se?Se.call(ie):{next:e(ie)}}if(o("Symbol",function(ie){function Se(w,ht){this.A=w,r(this,"description",{configurable:!0,writable:!0,value:ht})}if(ie)return ie;Se.prototype.toString=function(){return this.A};var Fe="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ce=0;return function w(ht){if(this instanceof w)throw new TypeError("Symbol is not a constructor");return new Se(Fe+(ht||"")+"_"+ce++,ht)}}),o("Symbol.iterator",function(ie){if(ie)return ie;ie=Symbol("Symbol.iterator");for(var Se="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Fe=0;Fe<Se.length;Fe++){var ce=i[Se[Fe]];typeof ce=="function"&&typeof ce.prototype[ie]!="function"&&r(ce.prototype,ie,{configurable:!0,writable:!0,value:function(){return s(e(this))}})}return ie}),typeof Object.setPrototypeOf=="function")n=Object.setPrototypeOf;else{var d;t:{var u={};try{u.__proto__={a:!0},d=u.a;break t}catch{}d=!1}n=d?function(ie,Se){if(ie.__proto__=Se,ie.__proto__!==Se)throw new TypeError(ie+" is not extensible");return ie}:null}var l=n;function T(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function v(ie){if(ie.m)throw new TypeError("Generator is already running");ie.m=!0}function y(ie,Se){return ie.h=3,{value:Se}}function x(ie){this.g=new T,this.G=ie}function N(ie,Se,Fe,ce){try{var w=Se.call(ie.g.j,Fe);if(!(w instanceof Object))throw new TypeError("Iterator result "+w+" is not an object");if(!w.done)return ie.g.m=!1,w;var ht=w.value}catch(Tt){return ie.g.j=null,ie.g.s(Tt),L(ie)}return ie.g.j=null,ce.call(ie.g,ht),L(ie)}function L(ie){for(;ie.g.h;)try{var Se=ie.G(ie.g);if(Se)return ie.g.m=!1,{value:Se.value,done:!1}}catch(Fe){ie.g.v=void 0,ie.g.s(Fe)}if(ie.g.m=!1,ie.g.l){if(Se=ie.g.l,ie.g.l=null,Se.F)throw Se.D;return{value:Se.return,done:!0}}return{value:void 0,done:!0}}function Q(ie){this.next=function(Se){return ie.o(Se)},this.throw=function(Se){return ie.s(Se)},this.return=function(Se){return function(Fe,ce){v(Fe.g);var w=Fe.g.j;return w?N(Fe,"return"in w?w.return:function(ht){return{value:ht,done:!0}},ce,Fe.g.return):(Fe.g.return(ce),L(Fe))}(ie,Se)},this[Symbol.iterator]=function(){return this}}function J(ie,Se){return Se=new Q(new x(Se)),l&&ie.prototype&&l(Se,ie.prototype),Se}if(T.prototype.o=function(ie){this.v=ie},T.prototype.s=function(ie){this.l={D:ie,F:!0},this.h=this.C||this.u},T.prototype.return=function(ie){this.l={return:ie},this.h=this.u},x.prototype.o=function(ie){return v(this.g),this.g.j?N(this,this.g.j.next,ie,this.g.o):(this.g.o(ie),L(this))},x.prototype.s=function(ie){return v(this.g),this.g.j?N(this,this.g.j.throw,ie,this.g.o):(this.g.s(ie),L(this))},o("Array.prototype.entries",function(ie){return ie||function(){return function(Se,Fe){Se instanceof String&&(Se+="");var ce=0,w=!1,ht={next:function(){if(!w&&ce<Se.length){var Tt=ce++;return{value:Fe(Tt,Se[Tt]),done:!1}}return w=!0,{done:!0,value:void 0}}};return ht[Symbol.iterator]=function(){return ht},ht}(this,function(Se,Fe){return[Se,Fe]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var at=function(ie,Se){for(var Fe=0;Fe<ie.length;Fe++)Se(ie[Fe])},Rt=function(ie){return ie.replace(/\r?\n|\r/g,`\r
`)},vt=function(ie,Se,Fe){return Se instanceof Blob?(Fe=Fe!==void 0?Fe+"":typeof Se.name=="string"?Se.name:"blob",Se.name===Fe&&Object.prototype.toString.call(Se)!=="[object Blob]"||(Se=new File([Se],Fe)),[String(ie),Se]):[String(ie),String(Se)]},pt=function(ie,Se){if(ie.length<Se)throw new TypeError(Se+" argument required, but only "+ie.length+" present.")},kt=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,$t=kt.FormData,se=kt.XMLHttpRequest&&kt.XMLHttpRequest.prototype.send,Te=kt.Request&&kt.fetch,mr=kt.navigator&&kt.navigator.sendBeacon,Er=kt.Element&&kt.Element.prototype,ar=kt.Symbol&&Symbol.toStringTag;ar&&(Blob.prototype[ar]||(Blob.prototype[ar]="Blob"),"File"in kt&&!File.prototype[ar]&&(File.prototype[ar]="File"));try{new File([],"")}catch{kt.File=function(Se,Fe,ce){return Se=new Blob(Se,ce||{}),Object.defineProperties(Se,{name:{value:Fe},lastModified:{value:+(ce&&ce.lastModified!==void 0?new Date(ce.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),ar&&Object.defineProperty(Se,ar,{value:"File"}),Se}}var kr=function(ie){return ie.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Nr=function(ie){this.i=[];var Se=this;ie&&at(ie.elements,function(Fe){if(Fe.name&&!Fe.disabled&&Fe.type!=="submit"&&Fe.type!=="button"&&!Fe.matches("form fieldset[disabled] *"))if(Fe.type==="file"){var ce=Fe.files&&Fe.files.length?Fe.files:[new File([],"",{type:"application/octet-stream"})];at(ce,function(w){Se.append(Fe.name,w)})}else Fe.type==="select-multiple"||Fe.type==="select-one"?at(Fe.options,function(w){!w.disabled&&w.selected&&Se.append(Fe.name,w.value)}):Fe.type==="checkbox"||Fe.type==="radio"?Fe.checked&&Se.append(Fe.name,Fe.value):(ce=Fe.type==="textarea"?Rt(Fe.value):Fe.value,Se.append(Fe.name,ce))})};if((t=Nr.prototype).append=function(ie,Se,Fe){pt(arguments,2),this.i.push(vt(ie,Se,Fe))},t.delete=function(ie){pt(arguments,1);var Se=[];ie=String(ie),at(this.i,function(Fe){Fe[0]!==ie&&Se.push(Fe)}),this.i=Se},t.entries=function ie(){var Se,Fe=this;return J(ie,function(ce){if(ce.h==1&&(Se=0),ce.h!=3)return Se<Fe.i.length?ce=y(ce,Fe.i[Se]):(ce.h=0,ce=void 0),ce;Se++,ce.h=2})},t.forEach=function(ie,Se){pt(arguments,1);for(var Fe=c(this),ce=Fe.next();!ce.done;ce=Fe.next()){var w=c(ce.value);ce=w.next().value,w=w.next().value,ie.call(Se,w,ce,this)}},t.get=function(ie){pt(arguments,1);var Se=this.i;ie=String(ie);for(var Fe=0;Fe<Se.length;Fe++)if(Se[Fe][0]===ie)return Se[Fe][1];return null},t.getAll=function(ie){pt(arguments,1);var Se=[];return ie=String(ie),at(this.i,function(Fe){Fe[0]===ie&&Se.push(Fe[1])}),Se},t.has=function(ie){pt(arguments,1),ie=String(ie);for(var Se=0;Se<this.i.length;Se++)if(this.i[Se][0]===ie)return!0;return!1},t.keys=function ie(){var Se,Fe,ce,w,ht=this;return J(ie,function(Tt){if(Tt.h==1&&(Se=c(ht),Fe=Se.next()),Tt.h!=3)return Fe.done?void(Tt.h=0):(ce=Fe.value,w=c(ce),y(Tt,w.next().value));Fe=Se.next(),Tt.h=2})},t.set=function(ie,Se,Fe){pt(arguments,2),ie=String(ie);var ce=[],w=vt(ie,Se,Fe),ht=!0;at(this.i,function(Tt){Tt[0]===ie?ht&&(ht=!ce.push(w)):ce.push(Tt)}),ht&&ce.push(w),this.i=ce},t.values=function ie(){var Se,Fe,ce,w,ht=this;return J(ie,function(Tt){if(Tt.h==1&&(Se=c(ht),Fe=Se.next()),Tt.h!=3)return Fe.done?void(Tt.h=0):(ce=Fe.value,(w=c(ce)).next(),y(Tt,w.next().value));Fe=Se.next(),Tt.h=2})},Nr.prototype._asNative=function(){for(var ie=new $t,Se=c(this),Fe=Se.next();!Fe.done;Fe=Se.next()){var ce=c(Fe.value);Fe=ce.next().value,ce=ce.next().value,ie.append(Fe,ce)}return ie},Nr.prototype._blob=function(){var ie="----formdata-polyfill-"+Math.random(),Se=[],Fe="--"+ie+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(ce,w){return typeof ce=="string"?Se.push(Fe+kr(Rt(w))+`"\r
\r
`+Rt(ce)+`\r
`):Se.push(Fe+kr(Rt(w))+'"; filename="'+kr(ce.name)+`"\r
Content-Type: `+(ce.type||"application/octet-stream")+`\r
\r
`,ce,`\r
`)}),Se.push("--"+ie+"--"),new Blob(Se,{type:"multipart/form-data; boundary="+ie})},Nr.prototype[Symbol.iterator]=function(){return this.entries()},Nr.prototype.toString=function(){return"[object FormData]"},Er&&!Er.matches&&(Er.matches=Er.matchesSelector||Er.mozMatchesSelector||Er.msMatchesSelector||Er.oMatchesSelector||Er.webkitMatchesSelector||function(ie){for(var Se=(ie=(this.document||this.ownerDocument).querySelectorAll(ie)).length;0<=--Se&&ie.item(Se)!==this;);return-1<Se}),ar&&(Nr.prototype[ar]="FormData"),se){var li=kt.XMLHttpRequest.prototype.setRequestHeader;kt.XMLHttpRequest.prototype.setRequestHeader=function(ie,Se){li.call(this,ie,Se),ie.toLowerCase()==="content-type"&&(this.B=!0)},kt.XMLHttpRequest.prototype.send=function(ie){ie instanceof Nr?(ie=ie._blob(),this.B||this.setRequestHeader("Content-Type",ie.type),se.call(this,ie)):se.call(this,ie)}}Te&&(kt.fetch=function(ie,Se){return Se&&Se.body&&Se.body instanceof Nr&&(Se.body=Se.body._blob()),Te.call(this,ie,Se)}),mr&&(kt.navigator.sendBeacon=function(ie,Se){return Se instanceof Nr&&(Se=Se._asNative()),mr.call(this,ie,Se)}),kt.FormData=Nr}})();const hl=()=>{const t=st("AREAS");return t.length===0&&t.push(Dr.GLOBAL),Ao(t).call(t,(e,r,n)=>{const i=_w(r);return i?n===0?i:"".concat(e,",").concat(i):e},"")},_w=t=>t===Dr.OVERSEA?"".concat(ci.ASIA,",").concat(ci.EUROPE,",").concat(ci.AFRICA,",").concat(ci.NORTH_AMERICA,",").concat(ci.SOUTH_AMERICA,",").concat(ci.OCEANIA):ci[t],LH=t=>{const e={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(r=>{const n=Zp[r],i=Object.keys(n);i&&i.map(o=>{o!=="CODE"&&(e[o]=e[o].concat(n[o]))})}),e},cf={GLOBAL:{ASIA:[Dr.CHINA,Dr.JAPAN,Dr.INDIA,Dr.KOREA,Dr.HKMC],EUROPE:[],NORTH_AMERICA:[Dr.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},df=Object.keys(cf[Dr.GLOBAL]),Yg=[Dr.CHINA,Dr.NORTH_AMERICA,Dr.EUROPE,Dr.ASIA,Dr.JAPAN,Dr.INDIA,Dr.OCEANIA,Dr.SOUTH_AMERICA,Dr.AFRICA,Dr.KOREA,Dr.HKMC,Dr.US],MH=function(t,e){let r=[];if(Ce(t).call(t,Dr.GLOBAL)){const o=[Dr.GLOBAL,Dr.OVERSEA],s=Object.keys(Zp);if(e===Dr.GLOBAL)throw new Bt(et.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(e===Dr.CHINA)r=[Dr.OVERSEA];else if(i=e,Ce(df).call(df,i)){const c=(n=e,cf[Dr.GLOBAL][n]||[]),d=[...o,e,...c];r=s.filter(u=>!Ce(d).call(d,u))}else if(function(c){let d=!1;return df.forEach(u=>{var l;Ce(l=cf[Dr.GLOBAL][u]).call(l,c)&&(d=!0)}),d}(e)){const c=function(u){let l;return df.forEach(T=>{var v;Ce(v=cf[Dr.GLOBAL][T]).call(v,u)&&(l=T)}),l}(e),d=[...o,c,e];r=s.filter(u=>!Ce(d).call(d,u))}else r=t;r=function(c){const d=[];return Yg.forEach(u=>{Ce(c).call(c,u)&&d.push(u)}),d.concat(c.filter(u=>!Ce(Yg).call(Yg,u)))}(r)}else r=t;var n,i;return r};function Ew(t){var e,r;if(!t&&Ce(e=st("AREAS")).call(e,Dr.EXTENSIONS))return C.debug("update area from ap : reset"),void Xg(H6,!0);if(!Ce(r=st("AREAS")).call(r,Dr.GLOBAL)||!t)return;let n=Zp.EXTENSIONS;n&&(n={CODE:_w(Dr.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},C.debug("update area from ap success: ".concat(t,",config is "),n),Br("AREAS",[Dr.EXTENSIONS],!0),Object.keys(n).map(i=>{i==="LOG_UPLOAD_SERVER"||i==="EVENT_REPORT_DOMAIN"||i==="EVENT_REPORT_BACKUP_DOMAIN"||i==="PROXY_SERVER_TYPE3"?Br(i,n[i][0]):Br(i,n[i])}))}function Xg(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=qe.reportApiInvoke(null,{name:vn.SET_AREA,options:t,tag:cn.TRACER});try{let n=[];if(typeof t=="string"&&(n=[t]),Array.isArray(t)&&(t.forEach(o=>{if(!Ce(VO).call(VO,o))throw new Bt(et.INVALID_PARAMS,"invalid area code")}),n=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:o,excludedArea:s}=t;if(!o)throw new Bt(et.INVALID_PARAMS,"area code is needed");let c=o;typeof o=="string"&&(c=[o]),n=s?MH(c,s):c}if(!e){if(os.AREAS){const o=new Bt(et.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return r.onError(o),void C.warning("setArea is prohibited because of config-distribute")}if(Ce(n).call(n,Dr.GLOBAL)&&st("AREAS")===Dr.EXTENSIONS){const o=new Bt(et.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return r.onError(o),void C.warning("setArea is prohibited because of ap extensions")}}Br("AREAS",n,e);const i=LH(n);Object.keys(i).map(o=>{o==="LOG_UPLOAD_SERVER"||o==="EVENT_REPORT_DOMAIN"||o==="EVENT_REPORT_BACKUP_DOMAIN"||o==="PROXY_SERVER_TYPE3"?Br(o,i[o][0]):Br(o,i[o])}),C.debug("set area success:",n.join(","))}catch(n){throw r.onError(n),n}r.onSuccess()}function gw(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function ws(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?gw(Object(r),!0).forEach(function(n){G(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):gw(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}let Jg=1;function UH(t,e,r,n,i){Jg+=1;const o={sid:r.sid,command:"convergeAllocateEdge",uid:"666",appId:r.appId,ts:Math.floor(Date.now()/1e3),seq:Jg,requestId:Jg,version:po,cname:r.cname},s={service_name:e,json_body:JSON.stringify(o)};let c,d,u=t[0];return is(async()=>{c=Date.now();const l=await ds(u,{data:s,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(d=Date.now()-c,l.code!==0){const y=new Bt(et.UNEXPECTED_RESPONSE,"live streaming ap error, code"+l.code,{retry:!0,responseTime:d});throw C.error(y.toString()),y}const T=JSON.parse(l.json_body);if(T.code!==200){const y=new Bt(et.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(T.code,", reason: ").concat(T.reason),{code:T.code,responseTime:d});throw C.error(y.toString()),y}if(!T.servers||T.servers.length===0){const y=new Bt(et.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:T.code,responseTime:d});throw C.error(y.toString()),y}const v=function(y,x){return{addressList:y.servers.map(N=>"wss://".concat(N.address.replace(/\./g,"-"),".").concat(st("WORKER_DOMAIN"),":").concat(N.wss,"?serviceName=").concat(encodeURIComponent(x))),workerToken:y.workerToken,vid:y.vid}}(T,e);return st("LIVE_STREAMING_ADDRESS")&&(v.addressList=st("LIVE_STREAMING_ADDRESS")instanceof Array?st("LIVE_STREAMING_ADDRESS"):[st("LIVE_STREAMING_ADDRESS")]),ws(ws({},v),{},{responseTime:d})},(l,T)=>(qe.apworkerEvent(r.sid,{success:!0,sc:200,serviceName:e,responseDetail:JSON.stringify(l.addressList),firstSuccess:T===0,responseTime:d,serverIp:t[T%t.length]}),!1),(l,T)=>(qe.apworkerEvent(r.sid,{success:!1,sc:l.data&&l.data.code||200,serviceName:e,responseTime:d,serverIp:t[T%t.length]}),!!(l.code!==et.OPERATION_ABORTED&&l.code!==et.UNEXPECTED_RESPONSE||l.data&&l.data.retry)&&(u=t[(T+1)%t.length],!0)),i)}let Zg=1;function Tw(t,e,r,n){let{url:i,areaCode:o}=t;const{clientId:s,sid:c}=e,d=Date.now();let u;const l=e.role,[T,v]=$g(e,o,[Cn.CHOOSE_SERVER]);let y=In.networkState;return is(async()=>{y&&In.networkState===Ki.OFFLINE&&In.onlineWaiter&&await De.race([In.onlineWaiter,Yn(n&&n.maxRetryTimeout||bn.maxRetryTimeout)]),y=In.networkState;const{data:x,headers:N}=await ds(i,{data:T,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);u=N.http3==="1"?1:-1,qe.reportResourceTiming(i,c),yw(x,i,e,d,[Cn.CHOOSE_SERVER],u);const L=cl(x,Cn.CHOOSE_SERVER);return Qg(L),Gg(L,i)},x=>(x&&qe.joinChooseServer(c,{role:l,lts:d,succ:!0,csAddr:i,opid:v,serverList:x.gatewayAddrs.map(N=>N.address),ec:null,cid:x.cid.toString(),uid:x.uid.toString(),csIp:x.csIp,unilbsServerIds:[Cn.CHOOSE_SERVER].toString(),isHttp3:u,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:x.res.detail&&x.res.detail[38]}),!1),x=>x.code!==et.OPERATION_ABORTED&&(x.code===et.CAN_NOT_GET_GATEWAY_SERVER?x.data.retry:(qe.joinChooseServer(c,{role:l,lts:d,succ:!1,csAddr:i,serverList:null,opid:v,ec:x.code,csIp:x.data&&x.data.csIp,unilbsServerIds:[Cn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:y}),isHttp3:u,corssRegionTagReq:e.apRequestDetail}),C.warning("[".concat(s||"sid-".concat(c.slice(0,6)),"] Choose server network error, retry"),x),!0)),n)}function vw(t,e,r,n){let i,{url:o,areaCode:s,serviceIds:c}=t;const d=Date.now(),u=e.role,[l,T]=$g(e,s,c);let v;return is(async()=>{v&&In.networkState===Ki.OFFLINE&&In.onlineWaiter&&await De.race([In.onlineWaiter,Yn(n&&n.maxRetryTimeout||bn.maxRetryTimeout)]),v=In.networkState;const{data:y,headers:x}=await ds(o,{data:l,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i=x.http3==="1"?1:-1,qe.reportResourceTiming(o,e.sid),yw(y,o,e,d,c,i);const N=cl(y,Cn.CHOOSE_SERVER),L=cl(y,e.cloudProxyServer==="proxy5"?Cn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Cn.CLOUD_PROXY:Cn.CLOUD_PROXY_FALLBACK),Q=performance.getEntriesByName(o),J=Q[Q.length-1];let at;return J&&(at={name:J.name,protocol:"nextHopProtocol"in J?J.nextHopProtocol:"",dnscost:"domainLookupEnd"in J&&"domainLookupStart"in J&&typeof J.domainLookupEnd=="number"&&typeof J.domainLookupStart=="number"?J.domainLookupEnd-J.domainLookupStart:-1,tcpTlsCost:"connectEnd"in J&&"connectStart"in J&&typeof J.connectEnd=="number"&&typeof J.connectStart=="number"?J.connectEnd-J.connectStart:-1,reqCost:"requestStart"in J&&typeof J.requestStart=="number"&&"responseEnd"in J&&typeof J.responseEnd=="number"?J.responseEnd-J.requestStart:-1,handleCost:"leave_ts"in y&&"enter_ts"in y&&typeof y.leave_ts=="number"&&typeof y.enter_ts=="number"?y.leave_ts-y.enter_ts:-1}),Qg(N),{gatewayInfo:Gg(N,o),proxyInfo:L,url:o,resourceTimingInfo:at}},y=>(y.gatewayInfo&&qe.joinChooseServer(e.sid,{role:u,lts:d,succ:!0,csAddr:o,serverList:y.gatewayInfo.gatewayAddrs.map(x=>x.address),ec:null,opid:T,cid:y.gatewayInfo.cid.toString(),uid:y.gatewayInfo.uid.toString(),csIp:y.gatewayInfo.csIp,unilbsServerIds:c.toString(),isHttp3:i,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:y.gatewayInfo.res.detail&&y.gatewayInfo.res.detail[38],resourceTimingInfo:y.resourceTimingInfo?JSON.stringify(y.resourceTimingInfo):void 0}),y.proxyInfo&&qe.joinWebProxyAP(e.sid,{lts:d,sucess:1,apServerAddr:o,turnServerAddrList:y.proxyInfo.addresses.map(x=>x.ip).join(","),errorCode:null,eventType:e.cloudProxyServer,unilbsServerIds:c.toString()}),!1),y=>y.code!==et.OPERATION_ABORTED&&(y.code===et.CAN_NOT_GET_GATEWAY_SERVER?y.data.retry:(qe.joinWebProxyAP(e.sid,{lts:d,sucess:0,apServerAddr:o,turnServerAddrList:null,errorCode:y.code,eventType:e.cloudProxyServer,unilbsServerIds:c.toString(),extend:JSON.stringify({networkState:v})}),C.warning("[".concat(e.clientId,"] multi unilbs network error, retry"),y),!0)),n)}const yw=(t,e,r,n,i,o)=>{const{sid:s,clientId:c,cloudProxyServer:d}=r,u=[],l=T=>{T.flag===4096?qe.joinChooseServer(s,{role:r.role,lts:n,succ:!1,csAddr:e,opid:t.opid,serverList:null,ec:T.error.message,csIp:T.error.data&&T.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:o,corssRegionTagReq:r.apRequestDetail}):T.flag!==1048576&&T.flag!==4194304&&T.flag!==4194310||qe.joinWebProxyAP(s,{lts:n,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:T.error.code,eventType:d,unilbsServerIds:i.toString()})};if(t.response_body.forEach(T=>{const v=T.buffer.code;if(T.uri===23&&v===0&&!T.buffer.edges_services)if(T.buffer.flag===4194310)C.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),T.buffer.edges_services=[];else{const y={error:new Bt(et.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:T.buffer.flag};u.push(y),l(y)}if(v!==0){const y=Vd(v),x={error:new Bt(et.CAN_NOT_GET_GATEWAY_SERVER,y.desc,{desc:y.desc,retry:y.retry,csIp:t.detail[502]}),flag:T.buffer.flag};T.buffer.flag===4194310?C.warning(x.error.toString()):u.push(x),l(x)}}),u.length)throw C.warning("[".concat(c||"sid-".concat(s.slice(0,6)),"] multi unilbs ").concat(e," failed, ").concat(u.map(T=>"flag: ".concat(T.flag,", message: ").concat(T.error.message,", retry: ").concat(T.error.data.retry)).join(" | "))),new Bt(et.CAN_NOT_GET_GATEWAY_SERVER,u.map(T=>"flag: ".concat(T.flag,", message: ").concat(T.error.message)).join(" | "),{retry:!!u.find(T=>T.error.data.retry),csIp:t.detail[502],desc:[...new Set(u.map(T=>{var v;return T==null||(v=T.error)===null||v===void 0||(v=v.data)===null||v===void 0?void 0:v.desc}).filter(T=>!!T))]})},Qg=t=>{var e,r,n,i;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new Bt(et.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(st("AP_AREA")&&((n=t.detail)!==null&&n!==void 0&&n[23]&&typeof((i=t.detail)===null||i===void 0?void 0:i[23])=="string"?Ew(t.detail[23].toLowerCase()):Ew()),(e=t.detail)!==null&&e!==void 0&&e[19]&&typeof((r=t.detail)===null||r===void 0?void 0:r[19])=="string"){const s=t.detail[19],c=s?.split(";");for(let d=0;d<c.length;d++){var o;const u=Ei(o=c[d]).call(o);t.addresses[d]&&c&&(t.addresses[d].fingerprint=u)}}if(st("GATEWAY_ADDRESS")&&st("GATEWAY_ADDRESS").length>0){C.debug("assign gateway address to",st("GATEWAY_ADDRESS"));const s=st("GATEWAY_ADDRESS").map(c=>{var d,u;const l=(d=(u=t.addresses.find(T=>T.ip===c.ip&&T.port===c.port))===null||u===void 0?void 0:u.fingerprint)!==null&&d!==void 0?d:"";return{ip:c.ip,port:c.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:l}});t.addresses=s}},xH=(t,e)=>{if(t.response_body&&t.response_body.length){const r=t.response_body[0];if(r.buffer.code!==0){const n=Vd(r.buffer.code);throw new Bt(et.UPDATE_TICKET_FAILED,"[".concat(r.buffer.code,"]: ").concat(n.desc),{retry:n.retry})}return r.buffer.ticket}throw C.debug("update ticket request received ap response without response body:",e),new Bt(et.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},$g=(t,e,r)=>{const n=Math.floor(Math.random()*1e12),i=t.role==="host"?"1":t.role==="audience"?"2":void 0,o={appid:t.appId,client_ts:Date.now(),opid:n,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:ws(ws(ws({6:t.stringUid,11:e,12:st("USE_NEW_TOKEN")?"1":void 0},i?{17:i}:{}),{},{22:e},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:r,uid:t.uid||0}}]};o.request_bodies.forEach(c=>{t.multiIP&&t.multiIP.gateway_ip&&(c.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const s=new FormData;return s.append("request",JSON.stringify(o)),[s,n]},VH=(t,e)=>{const r=Math.floor(Math.random()*1e12),n={appid:t.appId,client_ts:Date.now(),opid:r,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:e,uid:t.uid||0,edges_services:t.apResponse.addresses.map(o=>({ip:o.ip,port:o.port}))}}]},i=new FormData;return i.append("request",JSON.stringify(n)),[i,r]};let Gd=0;function Hd(t){return De.all(t.map(e=>e.then(r=>{throw r},r=>r))).then(e=>{throw e},e=>e)}const pl=async t=>{let{fragementLength:e,referenceList:r,asyncMapHandler:n,allFailedhandler:i,promisesCollector:o}=t,s=0;const c=e;let d,u=0;const l=async()=>{const T=(()=>{const v=s*c,y=v+c;return r.slice(v,y).map(n)})();o&&o.push(...T);try{d=await Hd(T)}catch(v){if(u+=c,s++,!(u>=r.length))return void await l();i(v)}T.forEach(v=>v.cancel())};return await l(),d},Sw=async t=>{let{referenceList:e,asyncMapHandler:r,closeFn:n}=t;const i=e.length;let o=0;const s=async()=>{const c=r(e.shift());try{return await c}catch(d){if(o++,o>=i||n!=null&&n(d))throw d;return s()}};return s()};async function jH(){if(typeof VideoDecoder>"u")return!0;let t;const e=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],i=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],o=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],s=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new De((d,u)=>{let l;(async function(){t&&t.state!=="closed"||await async function(){t=new VideoDecoder({output:v=>{v.close(),clearTimeout(l),d(!0)},error:v=>{clearTimeout(l),d(!1)}}),await t.configure({codec:"av01.0.05M.08",width:160,height:90})}();const T=[e,r,n,i,o,s];for(let v=0;v<T.length;v++){const y=new EncodedVideoChunk({type:v==0?"key":"delta",timestamp:33333*v,duration:33333,data:new Uint8Array(T[v])});try{await t.decode(y)}catch{return void d(!1)}}})(),l=setTimeout(()=>{d(!1)},5e3)})}async function tT(t,e,r,n){return{gatewayInfo:await async function(o,s,c,d){let u=null;const l=[],T=async()=>{const y=st("WEBCS_DOMAIN").slice(0,st("AJAX_REQUEST_CONCURRENT")).map(L=>({url:o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(L+"/api/v2/transpond/webrtc?v=2"):"https://".concat(L,"/api/v2/transpond/webrtc?v=2"),areaCode:hl()})),x=d.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(L=>L.url)}),N=await pl({fragementLength:st("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:L=>(C.debug("[".concat(o.clientId,"] Connect to choose_server:"),L.url),Tw(L,o,s,c)),allFailedhandler:L=>{throw d.recordJoinChannelService({endTs:Date.now(),status:"error",errors:L},x),L[0]},promisesCollector:l});return d.recordJoinChannelService({endTs:Date.now(),status:"success"},x),N},v=async()=>{if(await Yn(1e3),u!==null)return u;const y=st("WEBCS_DOMAIN_BACKUP_LIST").map(L=>({url:o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(L+"/api/v2/transpond/webrtc?v=2"):"https://".concat(L,"/api/v2/transpond/webrtc?v=2"),areaCode:hl()})),x=d.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(L=>L.url)}),N=await pl({fragementLength:st("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:L=>(C.debug("[".concat(o.clientId,"] Connect to backup choose_server:"),L.url),Tw(L,o,s,c)),allFailedhandler:L=>{throw d.recordJoinChannelService({endTs:Date.now(),status:"error",errors:L},x),L[0]},promisesCollector:l});return d.recordJoinChannelService({endTs:Date.now(),status:"success"},x),N};try{return u=await Hd([T(),v()]),l.length&&l.forEach(y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),u}catch(y){throw y[0]}}(t,e,r,n)}}async function Rw(t,e,r,n,i){const o=t.cloudProxyServer;if(o==="disabled"){if(t.useLocalAccessPoint)return await tT(t,e,r,i);if(st("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:v,proxyInfo:y}=await Aw(t,e,r,i);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:v};const x=y.map(N=>({turnServerURL:N.address,tcpport:N.tcpport||ii.tcpport,udpport:N.udpport||ii.udpport,username:N.username||ii.username,password:N.password||ii.password,forceturn:!1,security:!0}));if(i.useP2P){var s;const N=(s=t.uid)!==null&&s!==void 0?s:v.uid,L="glb:".concat(N.toString()),Q=await HE(L),J=y.map(at=>({turnServerURL:at.address,tcpport:at.tcpport||ii.tcpport,udpport:at.udpport||ii.udpport,username:L,password:Q,forceturn:!1,security:!0}));x.push(...J)}return t.turnServer={mode:"manual",servers:x},{gatewayInfo:v}}return await tT(t,e,r,i)}const{proxyInfo:c,gatewayInfo:d}=await Aw(t,e,r,i),u={gatewayInfo:d},l=c.map(v=>({turnServerURL:v.address,tcpport:o==="proxy3"?void 0:v.tcpport?v.tcpport:ii.tcpport,udpport:o==="proxy4"?void 0:v.udpport?v.udpport:ii.udpport,username:v.username||ii.username,password:v.password||ii.password,forceturn:o!=="proxy4",security:o==="proxy5"}));if(i.useP2P){var T;const v=(T=t.uid)!==null&&T!==void 0?T:d.uid,y="glb:".concat(v.toString()),x=await HE(y),N=c.map(L=>({turnServerURL:L.address,tcpport:o==="proxy3"?void 0:L.tcpport||ii.tcpport,udpport:o==="proxy4"?void 0:L.udpport||ii.udpport,username:y,password:x,forceturn:o!=="proxy4",security:o==="proxy5"}));l.push(...N)}return t.turnServer={mode:"manual",servers:l},C.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(o)),u}async function Iw(t,e,r,n,i){const o=st("ACCOUNT_REGISTER").slice(0,st("AJAX_REQUEST_CONCURRENT"));let s=[];s=e.proxyServer?o.map(d=>"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v1")):o.map(d=>"https://".concat(d,"/api/v1"));const c=i?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:s});try{const d=await async function(u,l,T,v,y){const x=Date.now(),N={sid:T.sid,opid:10,appid:T.appId,string_uid:l};let L=u[0];const Q=await is(()=>ds(L+"".concat(L.indexOf("?")===-1?"?":"&","action=stringuid"),{data:N,cancelToken:v,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(J,at)=>{if(J.code===0){if(J.uid<=0||J.uid>=Math.pow(2,32))throw C.error("Invalid Uint Uid ".concat(l," => ").concat(J.uid),J),qe.reqUserAccount(N.sid,{lts:x,success:!1,serverAddr:L,stringUid:N.string_uid,uid:J.uid,errorCode:et.INVALID_UINT_UID_FROM_STRING_UID,extend:N}),new Bt(et.INVALID_UINT_UID_FROM_STRING_UID);return qe.reqUserAccount(N.sid,{lts:x,success:!0,serverAddr:L,stringUid:N.string_uid,uid:J.uid,errorCode:null,extend:N}),!1}const Rt=Vd(J.code);return Rt.retry&&(L=u[(at+1)%u.length]),qe.reqUserAccount(N.sid,{lts:x,success:!1,serverAddr:L,stringUid:N.string_uid,uid:J.uid,errorCode:Rt.desc,extend:N}),Rt.retry},(J,at)=>J.code!==et.OPERATION_ABORTED&&(qe.reqUserAccount(N.sid,{lts:x,success:!1,serverAddr:L,stringUid:N.string_uid,uid:null,errorCode:J.code,extend:N}),L=u[(at+1)%u.length],!0),y);if(Q.code!==0){const J=Vd(Q.code);throw new Bt(et.UNEXPECTED_RESPONSE,J.desc)}return Q}(s,t,e,r,n);return i?.recordJoinChannelService({status:"success",endTs:Date.now()},c),d.uid}catch(d){throw i?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[d]},c),d}}async function BH(t,e,r){const n=st("ACCOUNT_REGISTER");let i=[];i=e.proxyServer?n.map(o=>"https://".concat(e.proxyServer,"/ap/?url=").concat(o+"/api/v1")):n.map(o=>"https://".concat(o,"/api/v1"));try{return await Sw({referenceList:i,asyncMapHandler:s=>async function(c,d,u,l){const T=Date.now(),v={sid:u.sid,opid:10,appid:u.appId,string_uid:d};try{const y=await ds(c+"".concat(c.indexOf("?")===-1?"?":"&","action=stringuid"),{data:v,cancelToken:l,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(y.code!==0){const x=Vd(y.code);throw new Bt(et.UNEXPECTED_RESPONSE,"preload sua error:".concat(x.desc),x)}if(y.uid<=0||y.uid>=Math.pow(2,32))throw new Bt(et.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:T,url:c,req:v,uid:y.uid,elapse:Date.now()-T}}catch(y){throw y}}(s,t,e,r),closeFn:s=>s.code===et.OPERATION_ABORTED||s.code===et.UNEXPECTED_RESPONSE&&!s.data.retry})}catch(o){throw o}}async function FH(t,e,r){const n=st("CDS_AP").slice(0,st("AJAX_REQUEST_CONCURRENT")).map(d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1"):"https://".concat(d,"/api/v1?action=config")),i=n.map(d=>function(u,l,T,v){const y=Rr(),x={flag:64,cipher_method:0,features:ws(ws(ws(ws(ws({install_id:tg(),device:y.name,system:y.os,system_general:navigator.userAgent,vendor:l.appId,version:po,cname:l.cname,session_id:l.sid,proxyServer:l.proxyServer,sdk_type:PH.WEB_RTC,browser_name:y.name,browser_version:y.version,user_agent:navigator.userAgent,channel_name:l.cname},l.stringUid&&{string_uid:l.stringUid}),l.uid&&{uid:l.uid+""}),y.os&&{os_name:y.os}),y.osVersion&&{os_version:y.osVersion}),{},{detail:""})};return is(()=>ds(u,{data:x,timeout:1e3,cancelToken:T,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,N=>N.code!==et.OPERATION_ABORTED,v)}(d,t,e,r));let o=null,s=null,c={};try{o=await Hd(i)}catch(d){if(d.code===et.OPERATION_ABORTED)throw d;s=d}if(i.forEach(d=>d.cancel()),qe.reportApiInvoke(t.sid,{name:vn.REQUEST_CONFIG_DISTRIBUTE,options:{error:s,res:o}}).onSuccess(),o&&o.test_tags)try{c=function(d){if(!d.test_tags)return{};const u=d.test_tags,l=Object.keys(u),T={};return l.forEach(v=>{var y;const x=Ei(y=v.slice(4)).call(y),N=JSON.parse(u[v]),L=N[1];T[x]={tag:N[0]||"",value:L}}),T}(o)}catch{}return c}async function Cw(t,e){const r=st("WEBCS_DOMAIN").concat(st("WEBCS_DOMAIN_BACKUP_LIST")).map(n=>({url:"https://".concat(n,"/api/v2/transpond/webrtc?v=2"),areaCode:hl(),serviceIds:[Cn.CHOOSE_SERVER,Cn.CLOUD_PROXY_FALLBACK]}));try{return await Sw({referenceList:r,asyncMapHandler:i=>async function(o,s,c){let d,{url:u,areaCode:l,serviceIds:T}=o;const v=Date.now(),[y,x]=$g(s,l,T);let N=In.networkState;try{N&&In.networkState===Ki.OFFLINE&&In.onlineWaiter&&await De.race([In.onlineWaiter,Yn(bn.maxRetryTimeout)]),N=In.networkState;const{data:L,headers:Q}=await ds(u,{data:y,cancelToken:c,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);d=Q.http3==="1"?1:-1,(vt=>{const pt=[];if(vt.response_body.forEach(kt=>{const $t=kt.buffer.code;if(kt.uri===23&&$t===0&&!kt.buffer.edges_services)if(kt.buffer.flag===4194310)kt.buffer.edges_services=[];else{const se={error:new Bt(et.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:vt.detail[502]}),flag:kt.buffer.flag};pt.push(se)}if($t!==0){const se=Vd($t),Te={error:new Bt(et.CAN_NOT_GET_GATEWAY_SERVER,se.desc,{desc:se.desc,retry:se.retry,csIp:vt.detail[502]}),flag:kt.buffer.flag};kt.buffer.flag===4194310?C.warning(Te.error.toString()):pt.push(Te)}}),pt.length)throw new Bt(et.CAN_NOT_GET_GATEWAY_SERVER,pt.map(kt=>"flag: ".concat(kt.flag,", message: ").concat(kt.error.message)).join(" | "),{retry:!!pt.find(kt=>kt.error.data.retry),csIp:vt.detail[502],desc:[...new Set(pt.map(kt=>{var $t;return kt==null||($t=kt.error)===null||$t===void 0||($t=$t.data)===null||$t===void 0?void 0:$t.desc}).filter(kt=>!!kt))]})})(L);const at=cl(L,Cn.CHOOSE_SERVER),Rt=cl(L,Cn.CLOUD_PROXY_FALLBACK);return Qg(at),{gatewayInfo:Gg(at,u),proxyInfo:Rt,opid:x,requestTime:v,url:u,isHttp3:d,elapse:Date.now()-v}}catch(L){throw L}}(i,t,e),closeFn:i=>i.code===et.OPERATION_ABORTED||i.code===et.CAN_NOT_GET_GATEWAY_SERVER&&!i.data.retry})}catch(n){throw n}}async function Aw(t,e,r,n){const i=st("PROXY_SERVER_TYPE3"),o=(y,x,N)=>{let L=N||i;return Array.isArray(L)&&(L=x%2==0&&i[1]||i[0]),"https://".concat(L,"/ap/?url=").concat(y)};let s=null;const c=[],d=async()=>{const y=st("WEBCS_DOMAIN").slice(0,st("AJAX_REQUEST_CONCURRENT")).map((L,Q)=>{let J;return J=t.cloudProxyServer==="disabled"&&t.proxyServer?o("".concat(L,"/api/v2/transpond/webrtc?v=2"),Q,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(L,"/api/v2/transpond/webrtc?v=2"):o("".concat(L,"/api/v2/transpond/webrtc?v=2"),Q),{url:J,areaCode:hl(),serviceIds:[Cn.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Cn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Cn.CLOUD_PROXY:Cn.CLOUD_PROXY_FALLBACK]}}),x=n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(L=>L.url)}),N=await pl({fragementLength:st("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:L=>(C.debug("[".concat(t.clientId,"] Connect to choose_server:"),L.url),vw(L,t,e,r)),allFailedhandler:L=>{throw n.recordJoinChannelService({endTs:Date.now(),status:"error",errors:L},x),L[0]},promisesCollector:c});return n.recordJoinChannelService({endTs:Date.now(),status:"success"},x),N},u=async()=>{if(await Yn(1e3),s!==null)return s;const y=st("WEBCS_DOMAIN_BACKUP_LIST").map((L,Q)=>{let J;return J=t.cloudProxyServer==="disabled"&&t.proxyServer?o("".concat(L,"/api/v2/transpond/webrtc?v=2"),Q,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(L,"/api/v2/transpond/webrtc?v=2"):o("".concat(L,"/api/v2/transpond/webrtc?v=2"),Q),{url:J,areaCode:hl(),serviceIds:[Cn.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Cn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Cn.CLOUD_PROXY:Cn.CLOUD_PROXY_FALLBACK]}}),x=n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(L=>L.url)}),N=await pl({fragementLength:st("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:L=>(C.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),L.url),vw(L,t,e,r)),allFailedhandler:L=>{throw n.recordJoinChannelService({endTs:Date.now(),status:"error",errors:L},x),L[0]},promisesCollector:c});return n.recordJoinChannelService({endTs:Date.now(),status:"success"},x),N};let l,T,v;try{({gatewayInfo:l,proxyInfo:T,url:v}=await Hd([d(),u()]))}catch(y){throw y[0]}if(c.length&&c.forEach(y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),!l||!T)throw new Bt(et.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=v,t.cloudProxyServer!=="disabled"&&Array.isArray(i)&&v){const y=/^https?:\/\/(.+?)(\/.*)?$/.exec(v)[1];Ce(i).call(i,y)&&(t.proxyServer=y,C.setProxyServer(y),qe.setProxyServer(y))}return s={gatewayInfo:l,proxyInfo:await JO(T,l.uid)},s}async function GH(t,e,r){const n=st("UAP_AP").slice(0,st("AJAX_REQUEST_CONCURRENT")).map(o=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(o+"/api/v1?action=uap"):"https://".concat(o,"/api/v1?action=uap")),i=n.map(o=>function(s,c,d,u){const l={command:"convergeAllocateEdge",sid:c.sid,appId:c.appId,token:c.token,ts:Date.now(),version:po,cname:c.cname,uid:c.uid.toString(),requestId:Zg,seq:Zg};Zg+=1;const T={service_name:"tele_channel",json_body:JSON.stringify(l)};return is(async()=>{const v=await ds(s,{data:T,cancelToken:d,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(v.code!==0){const x=new Bt(et.UNEXPECTED_RESPONSE,"cross channel ap error, code"+v.code,{retry:!0});throw C.error(x.toString()),x}const y=JSON.parse(v.json_body);if(y.code!==200){const x=new Bt(et.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(y.code,", reason: ").concat(y.reason));throw C.error(x.toString()),x}if(!y.servers||y.servers.length===0){const x=new Bt(et.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw C.error(x.toString()),x}return{vid:y.vid,workerToken:y.workerToken,addressList:(st("CHANNEL_MEDIA_RELAY_SERVERS")||y.servers).map(x=>"wss://".concat(x.address.replace(/\./g,"-"),".").concat(st("WORKER_DOMAIN"),":").concat(x.wss))}},void 0,v=>!!(v.code!==et.OPERATION_ABORTED&&v.code!==et.UNEXPECTED_RESPONSE||v.data&&v.data.retry),u)}(o,t,e,r));try{const o=await Hd(i);return i.forEach(s=>s.cancel()),o}catch(o){throw o[0]}}async function HH(t,e,r){let n=null;const i=[],o=async s=>{const c=st(s?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v2/transpond/webrtc?v=2"):"https://".concat(d,"/api/v2/transpond/webrtc?v=2"));return s&&(await Yn(1e3),n!==null)?n:await pl({fragementLength:st("FRAGEMENT_LENGTH"),referenceList:c,asyncMapHandler:d=>(C.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(s?"backup":""," choose_server:"),d),function(u,l,T,v){const[y]=VH(l,[Cn.CHOOSE_SERVER]);let x=In.networkState;return is(async()=>{x&&In.networkState===Ki.OFFLINE&&In.onlineWaiter&&await De.race([In.onlineWaiter,Yn(v&&v.maxRetryTimeout||bn.maxRetryTimeout)]),x=In.networkState;const N=await ds(u,{data:y,cancelToken:T,headers:{"Content-Type":"multipart/form-data;"}},!0);return xH(N,u)},()=>!1,N=>N.code!==et.OPERATION_ABORTED&&(N.code===et.UPDATE_TICKET_FAILED?N.data.retry:(C.warning("[".concat(l.clientId,"] update ticket network error, retry"),N),!0)),v)}(d,t,e,r)),allFailedhandler:d=>{throw d[0]},promisesCollector:i})};try{return n=await Hd([o(!1),o(!0)]),i.length&&i.forEach(s=>s.cancel&&typeof s.cancel=="function"&&s.cancel()),n}catch(s){throw s[0]}}function bw(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function eT(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?bw(Object(r),!0).forEach(function(n){G(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):bw(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}class WH extends pn{get isSuccess(){return!!this.configs}constructor(e,r){super(),G(this,"configs",void 0),G(this,"store",void 0),G(this,"joinInfo",void 0),G(this,"cancelToken",void 0),G(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),G(this,"interval",void 0),G(this,"mutex",void 0),G(this,"mutableParamsRead",!1),G(this,"configCache",{}),G(this,"limit_bitrate",void 0),this.mutex=new si("config-distribute",e),this.store=r}startGetConfigDistribute(e,r){this.joinInfo=e,this.cancelToken=r,this.interval&&this.stopGetConfigDistribute(),st("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},st("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,qe.reportApiInvoke(null,{options:void 0,name:vn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:cn.TRACER}).onSuccess(JSON.stringify(os))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void C.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const r=await this.mutex.lock();try{e=await FH(this.joinInfo,this.cancelToken,this.retryConfig),C.debug("[config-distribute] get config distribute",JSON.stringify(e));const n=function(i){var o;const s=tc(o=Object.keys(i).filter(u=>/^webrtc_ng_global_parameter/.test(u))).call(o);for(let u=0;u<s.length;u++)for(let l=s.length-1;l>u;l--){const T=s[l],v=i[T].value;if(typeof v.__priority=="number"){const y=v.__priority,x=s[l-1],N=i[x].value;if(typeof N.__priority=="number"){if(!(y>N.__priority))continue;{const L=T;s[l]=s[l-1],s[l-1]=L}}else{const L=T;s[l]=s[l-1],s[l-1]=L}}}const c=Date.now();let d={};return s.forEach(u=>{const l=i[u].value.__expires;l&&l<=c||(d[u]=i[u])}),d}(e);this.cacheGlobalParameterConfig(n),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=n}catch(n){const i=new Bt(et.NETWORK_RESPONSE_ERROR,n);C.warning("[config-distribute] ".concat(i.toString()))}finally{r()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(e){jO(e)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==e.id&&this.emit(ol.UPDATE_BITRATE_LIMIT,e):this.emit(ol.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.limit_bitrate&&eT({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(e){try{const r={},n=Object.keys(e),i=[];n.forEach(o=>{const s=e[o].value;r[o]=s;const c=s.__id;if(c&&this.configCache[o]&&this.configCache[o].__id===c)return;const d=s.__type,u=e[o].value,l=e[o].tag;let T=0;d?d===dA.REALTIME&&(T=1):Object.keys(u).some(v=>Object.prototype.hasOwnProperty.call(ig,v)||!Pg()&&Object.prototype.hasOwnProperty.call(wp,v)?(T=1,!0):void 0),i.push({tag:l,isApplied:T,feature:o,params:JSON.stringify(s)})}),i.forEach(o=>{let{tag:s,feature:c,params:d,isApplied:u}=o;this.store.sessionId&&qe.abTest(this.store.sessionId,{intSucc:1,isApplied:u,tag:s,feature:c,params:d,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=r}catch(r){C.debug("handleABTestConfigDistribute error",r)}}cacheGlobalParameterConfig(e){const r=function(i){const o={};return Object.keys(i).forEach(s=>{const c=i[s].value,d=c.__expires,u=c.__type;Object.keys(c).forEach(l=>{l==="__id"||l==="__type"||l==="__priority"||l==="__expires"||Object.prototype.hasOwnProperty.call(o,l)||(o[l]=eT(eT({value:c[l]},d&&{expires:d}),u&&{type:u}))})}),o}(e);try{var n;const i=(n=r.LIMIT_BITRATE)===null||n===void 0?void 0:n.value;delete r.LIMIT_BITRATE,i&&jO(i)&&this.handleBitrateLimit(i),this.limit_bitrate=i,this.handleGlobalParameterConfig(r),this.handleABTestConfigDistribute(e),function(c){try{const d=Date.now();Object.keys(c).forEach(u=>{const{value:l,type:T,expires:v}=c[u];v&&v<=d||((T===dA.REALTIME||Object.prototype.hasOwnProperty.call(ig,u))&&(os[u]=l,rn[u]=l,C.debug("Update realtime parameters from config distribute",u,l)),T||Pg()||!Object.prototype.hasOwnProperty.call(wp,u)||(os[u]=l,rn[u]=l,C.debug("Update gateway parameters from config distribute",u,l)))})}catch(d){C.error("Error update config immediately: ".concat(c),d.message)}}(r);const o=JSON.stringify(r),s=window.btoa(o);window.localStorage.setItem("websdk_ng_global_parameter",s),C.debug("Caching global parameters ".concat(o))}catch(i){C.error("Error caching global parameters:",i.message)}}handleGlobalParameterConfig(e){try{const r=Date.now();Object.keys(e).forEach(n=>{if(n==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(rn,n)){const{value:i,expires:o}=e[n];if(o&&o<=r)return;(function(s,c){try{return typeof s=="object"&&typeof c=="object"&&JSON.stringify(s)===JSON.stringify(c)}catch{return!1}})(rn[n],i)||(os[n]=i,rn[n]=i,this.emit(ol.UPDATE_CLIENT_ROLE_OPTIONS,i),C.debug("Updating client role options: ".concat(JSON.stringify(i))))}})}catch(r){C.error("Error handling global parameter config:",r.message)}}}class KH extends pn{constructor(){super(...arguments),G(this,"resultStorage",new Map)}setLocalAudioStats(e,r,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(n,r)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(n,r))}setLocalVideoStats(e,r,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(n,r)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(n,r)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(n)),!r.muted&&this.record("VIDEO_ENCODE_FAILED",e,this.checResolutionSent(n))}setRemoteAudioStats(e,r){const n=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n,this.checkAudioOutputLevel(r))}setRemoteVideoStats(e,r){const n=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",n,this.checkVideoDecode(r))}record(e,r,n){if(st("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const i=this.resultStorage.get(e);if(!i)return;i.result.push(n);const o=e==="VIDEO_ENCODE_FAILED"?st("ENCODE_EXCEPTION_TIMES"):5;if(i.result.length>=o){var s;const c=Ce(s=i.result).call(s,!0);i.isPrevNormal&&!c&&this.emit("exception",rT[e],e,r),!i.isPrevNormal&&c&&this.emit("exception",rT[e]+2e3,e+"_RECOVER",r),i.isPrevNormal=c,i.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,r){return r instanceof Nn&&!r.isActive||!!r.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,r){let n=null;r._encoderConfig&&r._encoderConfig.frameRate&&(n=zi(r._encoderConfig.frameRate));const i=e.captureFrameRate;return!n||!i||!(n>10&&i<5||n<10&&n>=5&&i<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checResolutionSent(e){var r;return!(!e.codecType||Ce(r=st("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(r,e.codecType.toLocaleLowerCase()))||!e.captureFrameRate||e.sendFrameRate!==0||e.sendResolutionWidth!==0||e.sendResolutionHeight!==0}checkSendVideoBitrate(e,r){return!!r.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,r){return r instanceof Nn&&!r.isActive||!!r.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}}const rT={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},ui=new class{markSubscribeStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(e))}markPublishStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(e))}measureFromSubscribeStart(t,e){const r=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(e));if(r.length>0){const n=r[r.length-1];return Math.round(performance.now()-n.startTime)}return 0}measureFromPublishStart(t,e){const r=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(e));if(r.length>0){const n=r[r.length-1];return Math.round(performance.now()-n.startTime)}return 0}};function Ow(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function yc(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Ow(Object(r),!0).forEach(function(n){G(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ow(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}class fl{constructor(e){G(this,"store",void 0),G(this,"onStatsException",void 0),G(this,"onUploadPublishDuration",void 0),G(this,"onStatsChanged",void 0),G(this,"onVideoCodecChanged",void 0),G(this,"localStats",new Map),G(this,"remoteStats",new Map),G(this,"updateStatsInterval",void 0),G(this,"trafficStats",void 0),G(this,"trafficStatsPeerList",[]),G(this,"uplinkStats",void 0),G(this,"exceptionMonitor",void 0),G(this,"p2pChannel",void 0),G(this,"scalabilityMode",Op.L1T1),G(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.exceptionMonitor=new KH,this.exceptionMonitor.on("exception",(r,n,i)=>{this.onStatsException&&this.onStatsException(r,n,i)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(_e.LocalAudioTrack)||yc({},ug)}getLocalVideoTrackStats(){return this.localStats.get(_e.LocalVideoTrack)||yc({},lg)}getRemoteAudioTrackStats(e){const r=(o,s)=>{if(!this.trafficStats)return s;const c=this.trafficStats.peer_delay.find(d=>d.peer_uid===o);return c&&(s.publishDuration=c.B_ppad+(Date.now()-this.trafficStats.timestamp)),s},n={};if(e){var i;const o=(i=this.remoteStats.get(e))===null||i===void 0?void 0:i.audioStats;o&&(n[e]=r(e,o))}else Array.from(this.remoteStats.entries()).forEach(o=>{let[s,{audioStats:c}]=o;c&&(n[s]=r(s,c))});return n}getRemoteNetworkQualityStats(e){const r={};if(e){var n;const i=(n=this.remoteStats.get(e))===null||n===void 0?void 0:n.networkStats;i&&(r[e]=i)}else Array.from(this.remoteStats.entries()).forEach(i=>{let[o,{networkStats:s}]=i;s&&(r[o]=s)});return r}getRemoteVideoTrackStats(e){const r=(o,s)=>{if(!this.trafficStats)return s;const c=this.trafficStats.peer_delay.find(d=>d.peer_uid===o);return c&&(s.publishDuration=c.B_ppvd+(Date.now()-this.trafficStats.timestamp)),s},n={};if(e){var i;const o=(i=this.remoteStats.get(e))===null||i===void 0?void 0:i.videoStats;o&&(n[e]=r(e,o))}else Array.from(this.remoteStats.entries()).forEach(o=>{let[s,{videoStats:c}]=o;c&&(n[s]=r(s,c))});return n}getRTCStats(){let e=0,r=0,n=0,i=0;const o=this.localStats.get(_e.LocalAudioTrack);o&&(e+=o.sendBytes,r+=o.sendBitrate);const s=this.localStats.get(_e.LocalVideoTrack);s&&(e+=s.sendBytes,r+=s.sendBitrate);const c=this.localStats.get(_e.LocalVideoLowTrack);c&&(e+=c.sendBytes,r+=c.sendBitrate),this.remoteStats.forEach(u=>{let{audioStats:l,videoStats:T}=u;l&&(n+=l.receiveBytes,i+=l.receiveBitrate),T&&(n+=T.receiveBytes,i+=T.receiveBitrate)});let d=1;return this.trafficStats&&(d+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:d,SendBitrate:r,SendBytes:e,RecvBytes:n,RecvBitrate:i,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(r=>r.B_ppad!==void 0||r.B_ppvd!==void 0),e.peer_delay.filter(r=>this.trafficStatsPeerList.indexOf(r.peer_uid)===-1).forEach(r=>{var n;const i=(n=this.p2pChannel)===null||n===void 0?void 0:n.getRemoteMedia(r.peer_uid),o=i!=null&&i.videoSSRC?ui.measureFromSubscribeStart(this.store.clientId,i.videoSSRC):0,s=i!=null&&i.audioSSRC?ui.measureFromSubscribeStart(this.store.clientId,i.audioSSRC):0;r.B_ppad!==void 0&&r.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(r.peer_uid,r.B_ppad,r.B_ppvd,o>s?o:s),this.trafficStatsPeerList.push(r.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&C.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,r,n){if(!e)return!1;const i=!!n&&r.framesDecodeFreezeTime>n.framesDecodeFreezeTime,o=!n||r.framesDecodeCount>n.framesDecodeCount;return i||!o}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(r=>{let[n,i]=r;switch(n){case _e.LocalVideoTrack:case _e.LocalVideoLowTrack:{const c=i,d=yc({},lg),u=e.getStats(),l=e.getLocalMedia(n);if(u){const T=u.videoSend.find(v=>v.ssrc===l?.ssrcs[0].ssrcId);if(T){const v=e.getLocalVideoSize(),y=e.getEncoderConfig(_e.LocalVideoTrack);var o;(T.codec==="H264"||T.codec==="H265"||T.codec==="VP8"||T.codec==="VP9"||T.codec==="AV1X"||T.codec==="AV1")&&(d.codecType=T.codec,c?.codecType!==T.codec&&((o=this.onVideoCodecChanged)===null||o===void 0||o.call(this,T.codec.toLocaleLowerCase()))),d.sendBytes=T.bytes,d.sendBitrate=c?8*Math.max(0,d.sendBytes-c.sendBytes):0,T.inputFrame?(d.captureFrameRate=T.inputFrame.frameRate,d.captureResolutionHeight=T.inputFrame.height,d.captureResolutionWidth=T.inputFrame.width):v&&(d.captureResolutionWidth=v.width,d.captureResolutionHeight=v.height),T.sentFrame?(d.sendFrameRate=T.sentFrame.frameRate,d.sendResolutionHeight=T.sentFrame.height,d.sendResolutionWidth=T.sentFrame.width):v&&(d.sendResolutionWidth=v.width,d.sendResolutionHeight=v.height),T.avgEncodeMs&&(d.encodeDelay=T.avgEncodeMs),y&&y.bitrateMax?d.targetSendBitrate=1e3*y.bitrateMax:T.targetBitrate&&(d.targetSendBitrate=T.targetBitrate),d.sendPackets=T.packets,d.sendPacketsLost=T.packetsLost,d.sendJitterMs=T.jitterMs,d.sendRttMs=T.rttMs,d.totalDuration=c?c.totalDuration+1:1,d.totalFreezeTime=c?c.totalFreezeTime:0,this.isLocalVideoFreeze(T)&&(d.totalFreezeTime+=1),T.scalabilityMode&&this.scalabilityMode!==T.scalabilityMode&&(C.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(T.scalabilityMode)),this.scalabilityMode=T.scalabilityMode)}this.trafficStats&&(d.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var s;this.localStats.set(n,d),(c?.sendResolutionWidth!==d.sendResolutionWidth||c?.sendResolutionHeight!==d.sendResolutionHeight)&&((s=this.onStatsChanged)===null||s===void 0||s.call(this,"resolution",{width:d.sendResolutionWidth,height:d.sendResolutionHeight})),d&&l&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,l.track,d);break}case _e.LocalAudioTrack:{const c=i,d=yc({},ug),u=e.getStats(),l=e.getLocalMedia(n);if(u){const T=u.audioSend.find(v=>v.ssrc===l?.ssrcs[0].ssrcId);if(T){if(T.codec!=="opus"&&T.codec!=="aac"&&T.codec!=="PCMU"&&T.codec!=="PCMA"&&T.codec!=="G722"||(d.codecType=T.codec),T.inputLevel)d.sendVolumeLevel=Math.round(32767*T.inputLevel);else{const v=e.getLocalAudioVolume();v&&(d.sendVolumeLevel=Math.round(32767*v))}d.sendBytes=T.bytes,d.sendPackets=T.packets,d.sendPacketsLost=T.packetsLost,d.sendJitterMs=T.jitterMs,d.sendRttMs=T.rttMs,d.sendBitrate=c?8*Math.max(0,d.sendBytes-c.sendBytes):0}}this.trafficStats&&(d.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(_e.LocalAudioTrack,d),d&&l&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,l.track,d);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(r=>{var n,i;let[o,{videoStats:s,audioStats:c,videoPcStats:d}]=r;const u=c,l=s,T=d,v=yc({},vA),y=yc({},yA),x=yc({},O6),{audioTrack:N,videoTrack:L,audioSSRC:Q,videoSSRC:J}=e.getRemoteMedia(o);let at;at=this.store.useP2P?e.getStats(!0):e.getStats();const Rt=(n=at)===null||n===void 0?void 0:n.audioRecv.find($t=>$t.ssrc===Q),vt=(i=at)===null||i===void 0?void 0:i.videoRecv.find($t=>$t.ssrc===J),pt=this.trafficStats&&this.trafficStats.peer_delay.find($t=>$t.peer_uid===o);if(Rt&&(Rt.codec!=="opus"&&Rt.codec!=="aac"&&Rt.codec!=="PCMU"&&Rt.codec!=="PCMA"&&Rt.codec!=="G722"||(v.codecType=Rt.codec),Rt.outputLevel?v.receiveLevel=Math.round(32767*Rt.outputLevel):N&&(v.receiveLevel=Math.round(32767*N.getVolumeLevel())),v.receiveBytes=Rt.bytes,v.receivePackets=Rt.packets,v.receivePacketsLost=Rt.packetsLost,v.receivePacketsDiscarded=Rt.packetsDiscarded,v.packetLossRate=v.receivePacketsLost/(v.receivePackets+v.receivePacketsLost),v.receiveBitrate=u?8*Math.max(0,v.receiveBytes-u.receiveBytes):0,v.totalDuration=u?u.totalDuration+1:1,v.totalFreezeTime=u?u.totalFreezeTime:0,v.freezeRate=v.totalFreezeTime/v.totalDuration,v.receiveDelay=Rt.jitterBufferMs,v.totalDuration>10&&fl.isRemoteAudioFreeze(N)&&(v.totalFreezeTime+=1)),vt){var kt;vt.codec!=="H264"&&vt.codec!=="H265"&&vt.codec!=="VP8"&&vt.codec!=="VP9"&&vt.codec!=="AV1X"&&vt.codec!=="AV1"||(y.codecType=vt.codec),y.receiveBytes=vt.bytes,y.receiveBitrate=l?8*Math.max(0,y.receiveBytes-l.receiveBytes):0,y.decodeFrameRate=vt.decodeFrameRate<0?0:vt.decodeFrameRate,y.renderFrameRate=vt.decodeFrameRate<0?0:vt.decodeFrameRate,vt.outputFrame&&(y.renderFrameRate=vt.outputFrame.frameRate),vt.receivedFrame?(y.receiveFrameRate=vt.receivedFrame.frameRate,y.receiveResolutionHeight=vt.receivedFrame.height,y.receiveResolutionWidth=vt.receivedFrame.width):L&&(y.receiveResolutionHeight=L._videoHeight||0,y.receiveResolutionWidth=L._videoWidth||0),vt.framesRateFirefox!==void 0&&(y.receiveFrameRate=Math.round(vt.framesRateFirefox)),y.receivePackets=vt.packets,y.receivePacketsLost=vt.packetsLost,y.packetLossRate=y.receivePacketsLost/(y.receivePackets+y.receivePacketsLost);const $t=l?l.totalFreezeTime:0,se=l?l.totalDuration:0;y.totalDuration=l?l.totalDuration+1:1,y.totalFreezeTime=(kt=vt.totalFreezesDuration)!==null&&kt!==void 0?kt:$t||0,y.receiveDelay=vt.jitterBufferMs||0;const Te=!!J&&e.getRemoteVideoIsReady(J);vt.totalFreezesDuration===void 0&&L&&Te&&fl.isRemoteVideoFreeze(L,vt,T)&&(y.totalFreezeTime+=1),y.freezeRate=Math.max(0,Math.min((y.totalFreezeTime-$t)/(y.totalDuration-se),1))}pt&&(v.end2EndDelay=pt.B_ad,y.end2EndDelay=pt.B_vd,v.transportDelay=pt.B_ed,y.transportDelay=pt.B_ed,v.currentPacketLossRate=pt.B_ealr4/100,y.currentPacketLossRate=pt.B_evlr4/100,x.uplinkNetworkQuality=pt.B_punq?pt.B_punq:0,x.downlinkNetworkQuality=pt.B_pdnq?pt.B_pdnq:0),this.remoteStats.set(o,{audioStats:v,videoStats:y,videoPcStats:vt,networkStats:x}),N&&this.exceptionMonitor.setRemoteAudioStats(N,v),L&&this.exceptionMonitor.setRemoteVideoStats(L,y)})}}class ww{constructor(){G(this,"destChannelMediaInfos",new Map),G(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){xO(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){xO(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){Yp(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function Nw(t){if(!(t instanceof ww))return new Bt(et.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const e=t.getSrcChannelMediaInfo(),r=t.getDestChannelMediaInfo();if(!e)return new Bt(et.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(r.size===0)return new Bt(et.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Ma{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,r){G(this,"uid",void 0),G(this,"_uintid",void 0),G(this,"_trust_in_room_",!0),G(this,"_trust_audio_enabled_state_",!0),G(this,"_trust_video_enabled_state_",!0),G(this,"_trust_audio_mute_state_",!0),G(this,"_trust_video_mute_state_",!0),G(this,"_audio_muted_",!1),G(this,"_video_muted_",!1),G(this,"_audio_enabled_",!0),G(this,"_video_enabled_",!0),G(this,"_audio_added_",!1),G(this,"_video_added_",!1),G(this,"_is_pre_created",!1),G(this,"_video_pre_subscribed",!1),G(this,"_audio_pre_subscribed",!1),G(this,"_trust_video_stream_added_state_",!0),G(this,"_trust_audio_stream_added_state_",!0),G(this,"_audioTrack",void 0),G(this,"_videoTrack",void 0),G(this,"_dataChannels",[]),G(this,"_audioSSRC",void 0),G(this,"_videoSSRC",void 0),G(this,"_audioOrtc",void 0),G(this,"_videoOrtc",void 0),G(this,"_cname",void 0),G(this,"_rtxSsrcId",void 0),G(this,"_videoMid",void 0),G(this,"_audioMid",void 0),this.uid=e,this._uintid=r}}function Pw(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function nT(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Pw(Object(r),!0).forEach(function(n){G(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Pw(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}const uf="9",iT=2e4,lf=4e4;function Dw(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Qs(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Dw(Object(r),!0).forEach(function(n){G(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Dw(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Wd=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(Wd||{});const hf=new Map;function kw(t,e,r,n){let{scale:i}=t;if(i===0&&n===Wd.UP||i>=e.length-1&&n===Wd.DOWN)return t;let o=Qs(Qs({},t),{},{scale:n===Wd.DOWN?++i:--i});switch(r){case"maintain-framerate":o=Qs(Qs({},o),e[i].motion);break;case"maintain-resolution":o=Qs(Qs({},o),e[i].detail);break;case"balanced":o=Qs(Qs({},o),e[i].balanced)}return o}function Lw(t,e){if(e){const r={overUse:0,underUse:0,adaptationList:Mw(e)};hf.set(t,r)}else hf.delete(t)}function Mw(t){const e=Qs({},t),{bitrateMax:r,frameRate:n,scaleResolutionDownBy:i,bitrateMin:o}=e,{MIN_FRAME_RATE:s,MAX_THRESHOLD_FRAMERATE:c,MAX_SCALE:d,BITRATE_MIN_THRESHOLD:u,BITRATE_MAX_THRESHOLD:l,BWE_SCALE_UP_THRESHOLD:T,BWE_SCALE_DOWN_THRESHOLD:v,PERF_SCALE_DOWN_THRESHOLD:y,PERF_SCALE_UP_THRESHOLD:x,BALANCE_BITRATE_FACTOR:N,BALANCE_FRAMERATE_FACTOR:L,BALANCE_RESOLUTION_FACTOR:Q,MOTION_RESOLUTION_FACTOR:J,MOTION_BITRATE_FACTOR:at,DETAIL_FRAMERATE_FACTOR:Rt,DETAIL_BITRATE_FACTOR:vt}=rg,pt=Math.min(e.frameRate,c),kt=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(v,1)*r),bwe_up:r,fps_down:Math.round(Math.pow(y,1)*pt),fps_up:n},balanced:{scaleResolutionDownBy:1,frameRate:n,bitrateMax:r,bitrateMin:o},motion:{scaleResolutionDownBy:1,frameRate:n,bitrateMax:r,bitrateMin:o},detail:{scaleResolutionDownBy:1,frameRate:n,bitrateMax:r,bitrateMin:o}}];for(let $t=1;$t<=d;$t++){const se={bwe_up:Math.round(Math.pow(T,$t)*r),bwe_down:Math.round(Math.pow(v,$t+1)*r),fps_up:Math.round(Math.pow(x,$t)*pt),fps_down:Math.round(Math.pow(y,$t+1)*pt)},Te={scaleResolutionDownBy:i/Math.pow(Q,$t),frameRate:Math.max(Math.round(Math.pow(L,$t)*n),s),bitrateMax:Math.max(Math.round(Math.pow(N,$t)*r),l),bitrateMin:Math.max(Math.round(Math.pow(N,$t)*o),u)},mr={scaleResolutionDownBy:i/Math.pow(J,$t),frameRate:n,bitrateMax:Math.max(Math.round(Math.pow(at,$t)*r),l),bitrateMin:Math.max(Math.round(Math.pow(at,$t)*o),u)},Er={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(Rt,$t)*n),s),bitrateMax:Math.max(Math.round(Math.pow(vt,$t)*r),l),bitrateMin:Math.max(Math.round(Math.pow(vt,$t)*o),u)};kt.push({scale:$t,threshold:se,balanced:Te,motion:mr,detail:Er})}return kt}function zH(t,e,r,n,i,o){const s=hf.get(t)||{overUse:0,underUse:0,adaptationList:Mw(i)},{adaptationList:c}=s;hf.set(t,s);const{OVERUSE_TIMES_THRESHOLD:d,UNDERUSE_TIMES_THRESHOLD:u}=rg,{scale:l}=n;let T,v;return typeof e=="number"&&e>0&&function(y,x,N,L){if(x>=N.length)return!1;let{threshold:{fps_down:Q}}=N[x];return st("FORCE_AG_HIGH_FRAMERATE")&&L==="maintain-framerate"&&(Q=N[0].threshold.fps_down),y<Q}(e,l,c,o)&&(s.overUse++,v=Zu.CPU,s.overUse>d)||typeof r=="number"&&r>0&&function(y,x,N){if(x>=N.length)return!1;const{threshold:{bwe_down:L}}=N[x];return y<L}(r,l,c)&&(s.overUse++,v=Zu.BANDWIDTH,s.overUse>d)?(s.overUse=0,s.underUse=0,T=kw(n,c,o,Wd.DOWN),[T,v]):(typeof e=="number"&&e>0&&typeof r=="number"&&r>0&&function(y,x,N,L){if(x===0)return;let{threshold:{fps_up:Q}}=N[x];return st("FORCE_AG_HIGH_FRAMERATE")&&L==="maintain-framerate"&&(Q=N[1].threshold.fps_up),y>Q}(e,l,c,o)&&function(y,x,N){if(x===0)return;const{threshold:{bwe_up:L}}=N[x];return y>L}(r,l,c)&&(s.underUse++,s.underUse>u&&(s.overUse=0,s.underUse=0,T=kw(n,c,o,Wd.UP),T.scale===0&&(v=Zu.NONE))),[T,v])}function Uw(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function oT(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Uw(Object(r),!0).forEach(function(n){G(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Uw(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}const pf=new Map;function ff(t,e){const r=pf.get(t);if(r){const{timer:n}=r;window.clearTimeout(n),pf.delete(t)}e.qualityLimitationReason=Zu.NONE,Lw(t)}function qH(t,e){var r;let n;switch(e){case _e.LocalAudioTrack:n=Ur.Audio;break;case _e.LocalVideoTrack:n=Ce(r=t._hints).call(r,Wr.SCREEN_TRACK)?Ur.Screen:Ur.High;break;case _e.LocalVideoLowTrack:n=Ur.Low}return n}function sT(t){const e=br();if(t.some(r=>r._bypassWebAudio))throw new Qt(et.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!e.webAudioMediaStreamDest)throw new Qt(et.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function aT(t,e){sT(t);const r=new Nn;return t.forEach(n=>r.addAudioTrack(n)),r}const YH=!br().supportUnifiedPlan||st("CHROME_FORCE_PLAN_B")&&zs();function mf(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;return YH?(r={spec:e,store:t},Zs("PlanBConnection").create(r)):new go(e,t)}function cT(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function xw(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(Yu(t.turnServer.servers))return!1;if(st("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(e=>e.forceturn))return!0}return!1}catch{return!1}}var Ir;function Vw(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function us(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Vw(Object(r),!0).forEach(function(n){G(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Vw(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}let go=(Ir=class Lc extends FO{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,r;return(e=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&e!==void 0?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var r;return Ce(r=Object.keys($u)).call(r,e)}))]}constructor(e,r){super(e,r),G(this,"id",zr(5,"connection-")),G(this,"store",void 0),G(this,"peerConnection",void 0),G(this,"forceTurn",!1),G(this,"remoteSDP",void 0),G(this,"initialOffer",void 0),G(this,"transportEventReceiver",void 0),G(this,"statsFilter",void 0),G(this,"extension",{useXR:st("USE_XR")}),G(this,"localCapabilities",void 0),G(this,"remoteCodecs",void 0),G(this,"localCandidateCount",0),G(this,"allCandidatesReceived",!1),G(this,"isPreallocation",!1),G(this,"preMediaMap",new Map),G(this,"dataStreamChannelMap",new Map),G(this,"establishPromise",void 0),G(this,"recoveredDataChannelIds",[]),G(this,"currentDataChannelId",1),G(this,"supportAV1RtpSpec",!1),G(this,"mutex",void 0),G(this,"qualityLimitationReason",Zu.NONE),G(this,"isFirstConnected",!1),this.store=r,this.forceTurn=xw(e),this.mutex=new si("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(Lc.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=$E(this.peerConnection,st("STATS_UPDATE_INTERVAL"),void 0,mn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,e.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(e){return this.preMediaMap.get(e)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(e,r){if(this.remoteCodecs=r,!this.remoteSDP)return void C.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(r));if(this.remoteSDP.updateRemoteCodec(e,r,this.store.codec)){const n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n);const o=this.remoteSDP.toString();i?.(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}else C.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Pa(n.sdp),o=await sw({filterRTX:!st("USE_PUB_RTX")&&!st("USE_SUB_RTX"),filterVideoFec:st("FILTER_VIDEO_FEC"),filterAudioFec:st("FILTER_AUDIO_FEC"),filterVideoCodec:st("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:st("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:st("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=of(o),this.initialOffer=n,st("ENABLE_SVC")&&this.store.codec=="av1"){const c=await async function(){try{const d=new RTCPeerConnection;d.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:Op.L1T3}]});const u=await d.createOffer();if(!u.sdp)return void d.close();const l=ki(u.sdp).mediaDescriptions[0];if(!l)return;const T=l.attributes.extmaps.find(v=>v.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return d.close(),T}catch{return}}();var e;c&&(this.supportAV1RtpSpec=!0,(e=o.send)===null||e===void 0||e.videoExtensions.push(c))}let s;return n.sdp&&uw(n.sdp)&&(s=dn(o),(r=s).send&&(jd(Ue.VIDEO,r.send.videoExtensions),jd(Ue.AUDIO,r.send.audioExtensions)),r.recv&&(jd(Ue.VIDEO,r.recv.videoExtensions),jd(Ue.AUDIO,r.recv.audioExtensions)),r.sendrecv&&(jd(Ue.VIDEO,r.sendrecv.videoExtensions),jd(Ue.AUDIO,r.sendrecv.audioExtensions))),us(us({},i),{},{rtpCapabilities:s||o,offerSDP:n.sdp})}catch(n){throw new Qt(et.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}var r}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&uw(this.initialOffer.sdp)&&(r=e.rtpCapabilities,n=this.localCapabilities,r.send&&(ef(Ue.VIDEO,r.send.videoExtensions,n.send.videoExtensions),ef(Ue.AUDIO,r.send.audioExtensions,n.send.audioExtensions)),r.recv&&(ef(Ue.VIDEO,r.recv.videoExtensions,n.recv.videoExtensions),ef(Ue.AUDIO,r.recv.audioExtensions,n.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return dn(this._localCapabilities)}get rtpCapabilities(){return dn(this._rtpCapabilities)}get candidates(){return dn(this._candidates)}get iceParameters(){return dn(this._iceParameters)}get dtlsParameters(){return dn(this._dtlsParameters)}constructor(d){let u=arguments.length>1&&arguments[1]!==void 0&&arguments[1],l=arguments.length>2&&arguments[2]!==void 0&&arguments[2];G(this,"sessionDesc",void 0),G(this,"_localCapabilities",void 0),G(this,"_rtpCapabilities",void 0),G(this,"_candidates",void 0),G(this,"_originCandidates",void 0),G(this,"_iceParameters",void 0),G(this,"_isUseExtmapAllowMixed",void 0),G(this,"_isUseLocalCodecs",void 0),G(this,"_dtlsParameters",void 0),G(this,"setup",void 0),G(this,"currentMidIndex",void 0),G(this,"cname",void 0),G(this,"useLocalCodecsMids",[]),G(this,"preloadSsrcs",[]),G(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=u,this._isUseLocalCodecs=l,d=dn(d);const{iceParameters:T,dtlsParameters:v,candidates:y,rtpCapabilities:x,setup:N,localCapabilities:L,cname:Q}=d;this._rtpCapabilities=x,this._candidates=y,this._originCandidates=dn(y),this._iceParameters=T,this._dtlsParameters=v,this._localCapabilities=L,this.setup=N,this.cname=Q,[this.sessionDesc]=this.updateRemoteRTPCapabilities(x),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(d){return d.length===this.preloadSsrcs.length&&d.every(u=>{var l;return Ce(l=this.preloadSsrcs).call(l,u)})}preloadRemoteMedia(d){let u=0;const l=[],T=[];for(;d>0;){const v=[nT({ssrcId:lf+u},st("USE_SUB_RTX")?{rtx:lf+u+1}:{})],y="".concat(lf+u,"_").concat(iT+u),{ssrcs:x,ssrcGroups:N}=ul(v,this.cname,st("SYNC_GROUP")?y:void 0),L=this.preCreateOrRecycleSendMedia("video",x,N,void 0),Q=[{ssrcId:iT+u}],J="".concat(lf+u,"_").concat(iT+u),{ssrcs:at,ssrcGroups:Rt}=ul(Q,this.cname,st("SYNC_GROUP")?J:void 0),vt=this.preCreateOrRecycleSendMedia("audio",at,Rt,void 0);d--,u+=2,l.push(L,vt),T.push(x[0].ssrcId,at[0].ssrcId)}return this.useLocalCodecsMids.push(...l),this.preloadSsrcs=T,{mids:l,preSSRCs:T,isAvailable:!0}}preCreateOrRecycleSendMedia(d,u,l,T){const v=this.rtpCapabilities.send.videoCodecs,y=this._isUseLocalCodecs||v.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;C.debug("create or recycle send media without remote rtp capabilities, ssrcs ",u[0].ssrcId);const x=d===Ue.VIDEO?y.videoCodecs:y.audioCodecs,N=d===Ue.VIDEO?y.videoExtensions:y.audioExtensions;this.currentMidIndex+=1;const L="".concat(this.currentMidIndex);let Q={media:{mediaType:d,port:uf,protos:["UDP","TLS","RTP","SAVPF"],fmts:x.map(J=>J.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:N,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:u,ssrcGroups:l,rtcpFeedbackWildcards:[],payloads:x,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(L)}};return Q=this.mungSendMediaDesc(Q,T),this.sessionDesc.mediaDescriptions.push(Q),this.updateBundleMids(),L}toString(){return Ca(this.sessionDesc)}send(d,u,l,T){const{ssrcs:v,ssrcGroups:y}=ul(u,this.cname,st("SYNC_GROUP")?l:void 0),x=this.findPreloadMediaDesc(v);if(x){if(mn()&&this.firefoxSsrcMidMap.set(v[0].ssrcId,x.attributes.mid),T&&(T.twcc||T.remb)){const N=this.sessionDesc.mediaDescriptions.indexOf(x);return this.sessionDesc.mediaDescriptions[N]=this.mungSendMediaDesc(x,T),{mid:x.attributes.mid,needExchangeSDP:!0}}return{mid:x.attributes.mid,needExchangeSDP:!1}}{const N=this.findAvailableMediaIndex(d,v);let L;return N===-1||N===1&&(ei()||function(){const Q=Rr();return!(Q.name!==wr.CHROME||!Q.osVersion)&&Number(Q.version)<=90}()||st("ENABLE_ENCODED_TRANSFORM")&&Ks())||N===0&&!function(Q){const J=Rr();return!(J.name!==wr.FIREFOX||!J.osVersion)&&Number(J.version)===Q}(138)&&st("USE_SUB_RTX")||k0()?(L=this.createOrRecycleSendMedia(d,v,y,"sendonly",T),this.updateBundleMids()):(L=dn(this.sessionDesc.mediaDescriptions[N]),L.attributes.direction="sendonly",L.attributes.ssrcs=v,L.attributes.ssrcGroups=y,this.sessionDesc.mediaDescriptions[N]=this.mungSendMediaDesc(L,T)),mn()&&this.firefoxSsrcMidMap.set(v[0].ssrcId,L.attributes.mid),{mid:L.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:d,needExchangeSDP:u}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:d.attributes.mid,needExchangeSDP:u}}batchSend(d){const u=d.map(v=>{let{kind:y,ssrcMsg:x,mslabel:N}=v;return this.send(y,x,N)}),l=[];let T=!1;return u.forEach(v=>{let{mid:y,needExchangeSDP:x}=v;x&&(T=!0),l.push(y)}),{mids:l,needExchangeSDP:T}}stopSending(d){const u=this.sessionDesc.mediaDescriptions.filter(l=>l.attributes.mid&&d.indexOf(l.attributes.mid)!==-1);if(u.length!==d.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");u.forEach(l=>{l.attributes.mid==="0"||mn()||k0()?l.attributes.ssrcs=[]:(l.attributes.ssrcs=[],l.attributes.direction="inactive",l.media.port="0")}),this.updateBundleMids()}mute(d){const u=this.sessionDesc.mediaDescriptions.find(l=>l.attributes.mid===d);if(!u)throw new Error("mediaDescription not found with ".concat(d," in remote SDP when calling RemoteSDP.mute."));u.attributes.direction="inactive"}unmute(d){const u=this.sessionDesc.mediaDescriptions.find(l=>l.attributes.mid===d);if(!u)throw new Error("mediaDescription not found with ".concat(d," in remote SDP when calling RemoteSDP.unmute."));u.attributes.direction="sendonly"}muteRemote(d){const u=this.sessionDesc.mediaDescriptions.filter(l=>Ce(d).call(d,l.attributes.mid||""));if(u.length!==d.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");u.forEach(l=>{l.attributes.direction="inactive"})}unmuteRemote(d){const u=this.sessionDesc.mediaDescriptions.filter(l=>Ce(d).call(d,l.attributes.mid||""));if(u.length!==d.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");u.forEach(l=>{l.attributes.direction="recvonly"})}receive(d,u,l,T){d.forEach((v,y)=>{this.createOrRecycleRecvMedia(v,[],"recvonly",u,l,T[y])}),this.updateBundleMids()}stopReceiving(d){const u=this.sessionDesc.mediaDescriptions.filter(l=>d.indexOf(l.attributes.mid)!==-1);if(u.length!==d.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");u.forEach(l=>{l.media.port="0",l.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(d){const u=this.sessionDesc||ki((l=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(l?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var l;this._rtpCapabilities=d;let T=!1;const v=this.rtpCapabilities.send,y=this.localCapabilities.send,x=this.localCapabilities.recv,N=x.videoCodecs,L=x.audioCodecs,Q=x.videoExtensions,J=x.audioExtensions;for(const pt of u.mediaDescriptions){var at;if(pt.attributes.direction!=="sendonly"||typeof pt.attributes.mid!="string"||!Ce(at=this.useLocalCodecsMids).call(at,pt.attributes.mid)){if(T=!0,pt.attributes.iceUfrag=this._iceParameters.iceUfrag,pt.attributes.icePwd=this._iceParameters.icePwd,pt.attributes.fingerprints=this._dtlsParameters.fingerprints,pt.attributes.candidates=this._candidates,pt.attributes.setup=this.setup,pt.media.mediaType==="application"&&(pt.attributes.sctpPort="5000"),pt.media.mediaType==="video")if(this._isUseLocalCodecs&&pt.attributes.direction==="sendonly"){var Rt;pt.media.fmts=N.map($t=>$t.payloadType.toString(10)),pt.attributes.payloads=N,pt.attributes.extmaps=Q;const kt=pt.attributes.mid;typeof kt!="string"||Ce(Rt=this.useLocalCodecsMids).call(Rt,kt)||this.useLocalCodecsMids.push(kt)}else if(v.videoCodecs.length===0){const kt=y.videoCodecs.filter($t=>{var se,Te;return(se=$t.rtpMap)===null||se===void 0?void 0:Ce(Te=se.encodingName.toLowerCase()).call(Te,"vp8")})||[y.videoCodecs[0]];pt.media.fmts=kt.map($t=>$t.payloadType.toString(10)),pt.attributes.payloads=kt,pt.attributes.extmaps=[]}else pt.media.fmts=v.videoCodecs.map(kt=>kt.payloadType.toString(10)),pt.attributes.payloads=v.videoCodecs,pt.attributes.extmaps=v.videoExtensions;if(pt.media.mediaType==="audio")if(this._isUseLocalCodecs&&pt.attributes.direction==="sendonly"){var vt;pt.media.fmts=L.map($t=>$t.payloadType.toString(10)),pt.attributes.payloads=L,pt.attributes.extmaps=J;const kt=pt.attributes.mid;typeof kt!="string"||Ce(vt=this.useLocalCodecsMids).call(vt,kt)||this.useLocalCodecsMids.push(kt)}else if(v.audioCodecs.length===0){const kt=y.audioCodecs.filter($t=>{var se,Te;return(se=$t.rtpMap)===null||se===void 0?void 0:Ce(Te=se.encodingName.toLowerCase()).call(Te,"opus")})||[y.audioCodecs[0]];pt.media.fmts=kt.map($t=>$t.payloadType.toString(10)),pt.attributes.payloads=kt,pt.attributes.extmaps=[]}else pt.media.fmts=v.audioCodecs.map(kt=>kt.payloadType.toString(10)),pt.attributes.payloads=v.audioCodecs,pt.attributes.extmaps=v.audioExtensions,Fd(pt)}}return this.sessionDesc=u,this.currentMidIndex=u.mediaDescriptions.length-1,[this.sessionDesc,T]}updateCandidates(d){const u=this._originCandidates.filter(T=>T.transport==="udp"),l=[];if(u.forEach(T=>{l.push(nT(nT({},T),{},{foundation:"tcpcandidate",priority:Number(T.priority)-1+"",transport:"tcp",port:Number(T.port)+90+""}))}),u.length!==0){switch(d){case di.TCP_RELAY:this._candidates=l;break;case di.UDP_TCP_RELAY:case di.RELAY:this._candidates=[...u,...l];break;default:this._candidates=u}for(const T of this.sessionDesc.mediaDescriptions)T.attributes.candidates=this.candidates}}restartICE(d){d=dn(d),this._iceParameters=d,this.sessionDesc.mediaDescriptions.forEach(u=>{u.attributes.iceUfrag=d.iceUfrag,u.attributes.icePwd=d.icePwd})}predictReceivingMids(d){const u=[];for(let l=0;l<d;l++)u.push((this.currentMidIndex+l+1).toString(10));return u}findAvailableMediaIndex(d,u){return this.sessionDesc.mediaDescriptions.findIndex(l=>{const T=l.media.mediaType===d&&l.media.port!=="0"&&(l.attributes.direction==="sendonly"||l.attributes.direction==="sendrecv")&&l.attributes.ssrcs.length===0;if(mn()){if(T){const v=this.firefoxSsrcMidMap.get(u[0].ssrcId);return!(v||l.attributes.mid!=="0"&&l.attributes.mid!=="1")||!(!v||v!==l.attributes.mid)}return!1}return T})}createOrRecycleDataChannel(){for(const l of this.sessionDesc.mediaDescriptions)if(l.media.mediaType==="application")return{mediaDesc:l,needExchangeSDP:!1};this.currentMidIndex+=1;const d="".concat(this.currentMidIndex),u={media:{mediaType:"application",port:uf,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(d),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(u),{mediaDesc:u,needExchangeSDP:!0}}createOrRecycleRecvMedia(d,u,l,T,v,y){const x=d._mediaStreamTrack.kind,N=this.rtpCapabilities.recv,L=ll(x,N,this.localCapabilities.send,x===Ue.VIDEO?T:v),Q=x===Ue.VIDEO?N.videoExtensions:N.audioExtensions;this.currentMidIndex+=1;const J="".concat(this.currentMidIndex);let at={media:{mediaType:x,port:uf,protos:["UDP","TLS","RTP","SAVPF"],fmts:L.map(vt=>vt.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Q,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:u,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:L,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:l,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(J)}};at=this.mungRecvMediaDsec(at,d,y);const Rt=this.findFirstClosedMedia(x);if(Rt){const vt=this.sessionDesc.mediaDescriptions.indexOf(Rt);this.sessionDesc.mediaDescriptions[vt]=at}else this.sessionDesc.mediaDescriptions.push(at);return at}updateRemoteDtlsParameters(d){const u=new Set(this._dtlsParameters.fingerprints.map(v=>v.fingerprint)),l=new Set(d.map(v=>v.fingerprint));let T=!1;u.size!==l.size&&(T=!0);for(const v of u)l.has(v)||(T=!0);return T}updateRemoteCodec(d,u,l){const T=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(at=>at.rtpMap&&at.rtpMap.encodingName.toLowerCase()||"").filter(at=>{var Rt;return Ce(Rt=Object.keys($u)).call(Rt,at)}))],v=new Set(u);if(T.every(at=>v.has(at)))return C.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(u)),!1;const y=this._rtpCapabilities.recv.videoCodecs.filter(at=>u.some(Rt=>{var vt;return Ce(vt=at.rtpMap&&at.rtpMap.encodingName.toLowerCase()||"").call(vt,Rt)}));if(y.length===0)return C.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(T," codecs: ").concat(u)),!1;const x=[...new Set(y.map(at=>at.rtpMap&&at.rtpMap.encodingName.toLowerCase()||""))];let N;if(C.debug("updateRemoteCodec, from ".concat(T," to ").concat(x)),d.length===0)N=this.sessionDesc.mediaDescriptions.filter(at=>at.media.mediaType==="video"&&at.attributes.direction==="recvonly");else if(N=this.sessionDesc.mediaDescriptions.filter(at=>at.attributes.mid&&at.media.mediaType==="video"&&Ce(d).call(d,at.attributes.mid)&&at.attributes.direction==="recvonly"),N.length!==d.length)return C.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(d,", codecs: ").concat(u)),!1;if(st("USE_PUB_RTX")||st("USE_SUB_RTX")){const at=Da(y,this.rtpCapabilities.recv.videoCodecs);y.push(...at)}this._rtpCapabilities.recv.videoCodecs=y;const L=this.localCapabilities.send,Q=this.rtpCapabilities.recv,J=ll(Ue.VIDEO,Q,L,l);return N.forEach(at=>{const Rt=J.map(vt=>vt.payloadType.toString(10));C.debug("updateRemoteCodec mid: ".concat(at.attributes.mid,", from"),at.attributes.payloads,"to",J),at.attributes.payloads=J,at.media.fmts=Rt}),!0}createOrRecycleSendMedia(d,u,l,T,v){const y=this.rtpCapabilities.send.videoCodecs,x=this._isUseLocalCodecs||y.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,N=d===Ue.VIDEO?x.videoCodecs:x.audioCodecs,L=d===Ue.VIDEO?x.videoExtensions:x.audioExtensions;this.currentMidIndex+=1;const Q="".concat(this.currentMidIndex);let J={media:{mediaType:d,port:uf,protos:["UDP","TLS","RTP","SAVPF"],fmts:N.map(Rt=>Rt.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:L,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:u,ssrcGroups:l,rtcpFeedbackWildcards:[],payloads:N,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:T,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Q)}};J=this.mungSendMediaDesc(J,v);const at=this.findFirstClosedMedia(d);if(at){const Rt=this.sessionDesc.mediaDescriptions.indexOf(at);this.sessionDesc.mediaDescriptions[Rt]=J}else this.sessionDesc.mediaDescriptions.push(J);return J}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(d=>d.media.port!=="0").map(d=>d.attributes.mid)}mungRecvMediaDsec(d,u,l){const T=dn(d);return Wg(T),Bd(T,u),Kg(T,u),iw(T),nf(T,l,this.localCapabilities.send),T}mungSendMediaDesc(d,u){const l=dn(d);return nf(l,u,this.localCapabilities.recv),Fd(l),l}updateRecvMedia(d,u){const l=this.sessionDesc.mediaDescriptions.findIndex(T=>T.attributes.mid===d);if(l!==-1){const T=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],u);this.sessionDesc.mediaDescriptions[l]=T}}bumpMid(d){this.currentMidIndex+=d}findFirstClosedMedia(d){return this.sessionDesc.mediaDescriptions.find(u=>mn()?u.media.port==="0"&&u.media.mediaType===d:u.media.port==="0")}findPreloadMediaDesc(d){return this.sessionDesc.mediaDescriptions.find(u=>{var l;return((l=u.attributes)===null||l===void 0||(l=l.ssrcs[0])===null||l===void 0?void 0:l.ssrcId)===d[0].ssrcId})}getSSRC(d){var u;return(u=this.sessionDesc.mediaDescriptions.find(l=>l.attributes.mid===d))===null||u===void 0?void 0:u.attributes.ssrcs}}(us(us({},e),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!st("ENABLE_PRE_SUB_WITH_PRE_PC")||!st("PRE_USE_LOCAL_CODECS"))&&ag(this.store)),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const i=this.remoteSDP.toString(),o=cw(this.initialOffer.sdp,this.extension),s=this.logSDPExchange(o||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),s?.(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i});const c=this.peerConnection.getTransceivers()[0];if(c!=null&&c.receiver&&this.tryBindTransportEvents(c.receiver),ag(this.store))if(e.preallocation&&st("ENABLE_PRE_SUB_WITH_PRE_PC")){const d=st("PRE_SUB_NUM"),{mids:u,preSSRCs:l}=this.remoteSDP.preloadRemoteMedia(d);await ka(this.peerConnection,this.remoteSDP,this.extension),C.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(l)),this.presetMedia(u,l)}else{const{preSSRCs:d=[]}=e,u=d.map(T=>T.ssrcMsg[0].ssrcId);if(d.length===0)return;const{mids:l}=this.remoteSDP.batchSend(d.map(T=>Object.assign({},T)));await ka(this.peerConnection,this.remoteSDP,this.extension),C.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(u)),this.presetMedia(l,u)}}catch(i){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}var r,n}presetMedia(e,r){e.forEach((n,i)=>{this.peerConnection.getTransceivers().forEach(o=>{if(o.mid!=null&&n===o.mid&&o.receiver.track){const s=o.receiver.track;let c;s.kind==="video"&&st("ENABLE_PRE_RENDER")&&(c=new vg({trackId:"track-".concat(s.kind,"-unknown-").concat(this.store.clientId,"_").concat(zr(5,""))},!0),c.updateVideoTrack(s),c.onFirstVideoFrameRender=()=>{var d;const u=this.preMediaMap.get(r[i]);u&&(u.firstVideoRender=Date.now()),(d=this.onFirstVideoRender)===null||d===void 0||d.call(this,r[i])},c.play(this.store.sessionId||void 0)),this.preMediaMap.set(r[i],{mid:n,track:s,player:c,transceiver:o})}}),this.store.peerReceiver()})}checkDtlsParameters(e){return!!this.remoteSDP&&e.length>0&&this.remoteSDP.updateRemoteDtlsParameters(e)}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let r=!1;const{rtpCapabilities:n}=e;if([,r]=this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const s=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);r=r||s}const{preSSRCs:i=[]}=e,o=i.map(s=>s.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(o)){const s=[],c=[];if(Array.from(this.preMediaMap.entries()).every(d=>{let[u,{mid:l,player:T,track:v}]=d;return s.push(l),c.push(u),this.preMediaMap.delete(u),T&&T.destroy(),!0}),s.length>0&&(this.remoteSDP.stopSending(s),await ka(this.peerConnection,this.remoteSDP,this.extension),C.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(c)),qe.reportApiInvoke(this.store.sessionId,{name:vn.PRELOAD_MEDIA_FAILED,options:[i,c],tag:cn.TRACER}).onSuccess()),i.length>0){const{mids:d}=this.remoteSDP.batchSend(i.map(u=>Object.assign({},u)));await ka(this.peerConnection,this.remoteSDP,this.extension),C.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(o)),this.presetMedia(d,o)}}r?(await ka(this.peerConnection,this.remoteSDP,this.extension),C.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):C.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(r){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(r.toString()))}}send(e,r,n){var i=this;return ho(function*(){const o=yield Ar(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=[],c=tf();e.forEach(L=>{const Q=i.peerConnection.addTransceiver(L._mediaStreamTrack,us({direction:"sendonly"},L.trackMediaType==="video"&&i.supportAV1RtpSpec&&c?{sendEncodings:[{scalabilityMode:c}]}:{}));s.push(Q),L._updateRtpTransceiver(Q)}),mn()&&st("SIMULCAST")===!0&&(yield Ar(i.applySimulcastForFirefox(s,e)));const d=yield Ar(i.peerConnection.createOffer()),u=i.remoteSDP.predictReceivingMids(e.length),l=i.mungSendOfferSDP(d.sdp,e,u),T=ki(l),v=u.map(L=>{const Q=T.mediaDescriptions.find(J=>J.attributes.mid===L);if(!Q)throw new Error("Cannot extract ssrc from mediaDescription.");return ew(Q,st("USE_PUB_RTX"))});let y;try{y=yield v}catch(L){y=[],i.remoteSDP.receive(e,r,n,y);const Q=i.remoteSDP.toString();throw yield Ar(i.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield Ar(i.peerConnection.setRemoteDescription({type:"answer",sdp:Q})),yield Ar(i.stopSending(u,!0)),L}i.remoteSDP.receive(e,r,n,y);const x=i.remoteSDP.toString(),N=i.logSDPExchange(l,"offer","local","send");return yield Ar(i.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield Ar(i.applySimulcastEncodings(s,e)),yield Ar(i.applySendEncodings(s,e)),N?.(x),yield Ar(i.peerConnection.setRemoteDescription({type:"answer",sdp:x})),s.map((L,Q)=>{const J=u[Q];return{localSSRC:v[Q],id:J,transceiver:L}})}catch(s){throw s instanceof Qt?s:new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{o()}})()}async createDataChannels(e,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let n=this.dataStreamChannelMap.get(e);if(n&&n.readyState==="open")C.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const o=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof o!="number")throw new Error("create DataChannel error, because cannot get dc id");n=this.peerConnection.createDataChannel("datastream-channel",{id:o,negotiated:!0,ordered:!1,maxRetransmits:st("DATASTREAM_MAX_RETRANSMITS")}),n.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,n)}r.forEach(o=>{o._updateOriginDataChannel(n)});const{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const s=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(s),C.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else C.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(n){throw n instanceof Qt?n:new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(n.toString()))}}async stopDataChannels(e){try{const r=this.dataStreamChannelMap.get(e);return r&&(r.id&&this.recoveredDataChannelIds.push(r.id),r.close()),void this.dataStreamChannelMap.delete(e)}catch(r){throw r instanceof Qt?r:new Qt(et.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(r.toString()))}}async stopSending(e,r){const n=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(d=>e.indexOf(d.mid)!==-1);if(i.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(d=>{var u;ff(this.id+d.mid,this),d.direction="inactive",(u=d.stop)===null||u===void 0||u.call(d)});const o=await this.peerConnection.createOffer(),s=this.logSDPExchange(o.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(e);const c=this.remoteSDP.toString();s?.(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{n&&n()}}async receive(e,r,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:o,needExchangeSDP:s}=this.remoteSDP.send(e,r,n,i);s&&(await ka(this.peerConnection,this.remoteSDP,this.extension),C.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));const c=this.peerConnection.getTransceivers().find(d=>d.mid===o);if(!c)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,id:o,transceiver:c}}catch(o){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:r,needExchangeSDP:n}=this.remoteSDP.batchSend(e);return n&&(await ka(this.peerConnection,this.remoteSDP,this.extension),C.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),r.map(i=>{const o=this.peerConnection.getTransceivers().find(s=>s.mid===i);if(!o)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:o.receiver.track,id:i,transceiver:o}})}catch(r){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach(o=>{Array.from(this.preMediaMap.entries()).some(s=>{let[c,{mid:d,player:u}]=s;if(d===o)return this.preMediaMap.delete(c),u&&u.destroy(),!0})}),this.remoteSDP.stopSending(e);const r=this.remoteSDP.toString(),n=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const i=await this.peerConnection.createAnswer();n?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(r){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const r=this.remoteSDP.toString(),n=this.logSDPExchange(r,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const i=await this.peerConnection.createAnswer();n?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(r){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(r.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const r=this.remoteSDP.toString(),n=this.logSDPExchange(r,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const i=await this.peerConnection.createAnswer();n?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(r){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(r.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(s=>s.mid&&e.indexOf(s.mid)!==-1);if(r.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(s=>{s.direction="inactive"});const n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const o=this.remoteSDP.toString();i?.(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(s=>s.mid&&e.indexOf(s.mid)!==-1);if(r.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async(s,c)=>{s.direction="sendonly"});const n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(e,this.remoteCodecs,this.store.codec);const o=this.remoteSDP.toString();i?.(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(e){var r=this;return ho(function*(){const n=yield Ar(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const i=br().supportPCSetConfiguration,o=st("FORCE_TURN_TCP")||r.forceTurn;if(e===di.RELAY&&!i)return;if(i&&!o){const T=e===di.RELAY?"relay":"all",v=r.peerConnection.getConfiguration();v.iceTransportPolicy!==T&&(C.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(T,"]")),v.iceTransportPolicy=T,r.peerConnection.setConfiguration(v))}r.remoteSDP.updateCandidates(e);const s=yield Ar(r.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const c=Pa(s.sdp),{remoteIceParameters:d}=yield c.iceParameters;r.remoteSDP.restartICE(d);const u=r.remoteSDP.toString(),l=r.logSDPExchange(s.sdp||"","offer","local","restartICE");r.store.descriptionStart(),yield Ar(r.peerConnection.setLocalDescription(s)),l?.(u),yield Ar(r.peerConnection.setRemoteDescription({type:"answer",sdp:u}))}catch(i){C.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),i)}finally{n()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const e=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(di.TCP_RELAY),await ka(this.peerConnection,this.remoteSDP,this.extension)}catch(r){C.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),r)}finally{e()}}close(){var e;this.peerConnection.getTransceivers().forEach(r=>{ff(this.id+r.mid,this)}),this.preMediaMap.forEach(r=>{let{player:n}=r;n&&n.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return us(us({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(n.sdp,[r],[e]);this.remoteSDP.updateRecvMedia(e,r);const o=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),s?.(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new Qt(et.EXCHANGE_SDP_FAILED,n.toString())}}async updateSendParameters(e,r){const n=this.peerConnection.getTransceivers().filter(i=>i.mid===e);n.length===1&&(this.isVP8Simulcast(r)?mn()||await this.applySimulcastEncodings(n,[r]):await this.applySendEncodings(n,[r]))}setStatsRemoteVideoIsReady(e,r){this.statsFilter.setVideoIsReady2(e,r)}async replaceTrack(e,r){const n=this.peerConnection.getTransceivers().find(i=>i.mid===r);n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const r=e[0].transport.iceTransport,{local:n,remote:i}=r.getSelectedCandidatePair();return{local:us(us({},Is),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:us(us({},Is),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=e=>{if(e&&(e.errorCode||e.errorText)){var r;const n="code: ".concat(e.errorCode,", message: ").concat(e.errorText),i=e.port?"local: ".concat(e.port):"",o=vc(e.url||"");C.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(n,"), url: ").concat(o||"",", host_candidate:").concat(i)),(r=this.onICECandidateError)===null||r===void 0||r.call(this,n)}},this.peerConnection.onicegatheringstatechange=e=>{e&&e.target&&"iceGatheringState"in e.target&&C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(e.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},st("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const r={iceServers:[]},n=e.cloudProxyServer||"disabled";return e.iceServers?r.iceServers=e.iceServers:e.turnServer&&(Yu(e.turnServer.servers)?r.iceServers=e.turnServer.servers:st("NEW_TURN_MODE")&&r.iceServers&&n==="disabled"?(st("USE_TURN_SERVER_OF_GATEWAY")?e.turnServer.serversFromGateway&&r.iceServers.push(...Lc.newTurnServerConfigToIceServers(e.turnServer.serversFromGateway)):r.iceServers.push(...Lc.newTurnServerConfigToIceServers(e.turnServer.servers)),st("NEW_FORCE_TURN")&&(r.iceTransportPolicy="relay")):e.turnServer.mode!=="off"&&(r.iceServers&&r.iceServers.push(...Lc.turnServerConfigToIceServers(e.turnServer.servers)),st("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&e.turnServer.serversFromGateway&&r.iceServers.push(...Lc.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),st("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(r.iceTransportPolicy="relay")}))),st("ENABLE_ENCODED_TRANSFORM")&&br().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(e){const r=[];return e.forEach(n=>{n.security?n.tcpport&&r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turns:".concat(wa(n.turnServerURL),":").concat(n.tcpport,"?transport=tcp")}):(n.udpport&&!st("FORCE_TURN_TCP")&&r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":").concat(n.udpport,"?transport=udp")}),n.tcpport&&r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":").concat(n.tcpport,"?transport=tcp")}))}),r}static newTurnServerConfigToIceServers(e){const r=[];return e.forEach(n=>{const i=st("NEW_TURN_MODE");i===1?r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":3478?transport=udp")}):i===2?r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":3478?transport=tcp")}):i===3?r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turns:".concat(wa(n.turnServerURL),":443?transport=tcp")}):i===4&&(r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":3478?transport=udp")}),r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":3478?transport=tcp")}),r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turns:".concat(wa(n.turnServerURL),":443?transport=tcp")}))}),r}tryBindTransportEvents(e){const r=e.transport;if(r){this.transportEventReceiver=e,r.onstatechange=()=>{var i;r!=null&&r.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,r.state))},r.onerror=i=>{var o;(o=this.onDTLSTransportError)===null||o===void 0||o.call(this,"error"in i?i.error:i)};const n=r.iceTransport;n&&(n.onstatechange=()=>{const i=r?.iceTransport.state;var o;i&&((o=this.onICETransportStateChange)===null||o===void 0||o.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:i,remote:o}=n.getSelectedCandidatePair()||{};if(i&&o){const s=i.address+":"+i.port,c=o.address+":"+o.port;C.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(vc(s)),", remote ").concat(JSON.stringify(vc(c))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,r){var n,i;if(r||(r=this.peerConnection.getSenders().find(L=>L.track===e._mediaStreamTrack)),!r)return C.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return C.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!br().supportSetRtpSenderParameters)return C.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const o={},s={};switch(e._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;case"balanced":o.degradationPreference="balanced"}const c=function(N,L){return N.getTransceivers().find(Q=>Q.sender.track===L||Q.receiver.track===L)}(this.peerConnection,e._mediaStreamTrack),d=k6(e);if(function(N){var L;return!(!st("ENABLE_AG_ADAPTATION")||!(N instanceof xp||Ce(L=N._hints).call(L,Wr.CUSTOM_TRACK))||!st("FORCE_SUPPORT_AG_ADAPTATION")&&!(P0(14,0,!1)&&D0(17,4)||N0(14)&&UE(17,4,!0)))}(e)&&c&&r&&d&&this.getLocalVideoStats&&Ce(n=["vp8","vp9"]).call(n,this.store.codec)){var u;const N=o.degradationPreference||(Ce(u=e._hints).call(u,Wr.CUSTOM_TRACK)?st("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(L,Q,J,at,Rt,vt){if(ff(L,J),Rt(Q),at!=="balanced"&&at!=="maintain-framerate"&&at!=="maintain-resolution")return;let pt=-1;Lw(L,Q);const kt=window.setInterval(()=>{const se=pf.get(L);if(!st("ENABLE_AG_ADAPTATION")||!se)return ff(L,J),void Rt(Q);const Te=vt();if(Te.sendPackets>0&&Te.OutgoingAvailableBandwidth>0){if(pt===-1)return void(pt=Date.now());if(Date.now()-pt<1e3)return;const mr=Te.sendFrameRate,Er=Te.OutgoingAvailableBandwidth,[ar,kr]=zH(L,mr,Er,se.adaptationConfig,Q,at);kr&&(J.qualityLimitationReason=kr),ar&&se.adaptationConfig.scale!==ar.scale&&(C.debug("[".concat(L,"] applyAdaptation: ").concat(J.qualityLimitationReason,`
           sendFps `).concat(mr,", bwe ").concat(Er,", switch from ").concat(se.adaptationConfig.scale," to ").concat(ar.scale," ")),se.adaptationConfig=oT(oT({},se.adaptationConfig),ar),Rt(ar))}},st("CHECK_LOCAL_STATS_INTERVAL")),$t=oT({},Q);pf.set(L,{timer:kt,adaptationConfig:$t,originConfig:Q,adaptationFunc:Rt}),C.debug("[".concat(L,"] start adaptation, originConfig: ").concat(JSON.stringify(Q),", degradationPreference: ").concat(at))})(this.id+c.mid,d,this,N,L=>{r&&this.updateAdaptation(r,L)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var l;const{bitrateMax:N,frameRate:L,scaleResolutionDownBy:Q}=e._encoderConfig;N&&(s.maxBitrate=1e3*N),(Ce(l=e._hints).call(l,Wr.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(L&&(s.maxFramerate=zi(L)),Q&&Q>=1&&(s.scaleResolutionDownBy=Q))}const{maxFramerate:T}=st("ENCODER_CONFIG_LIMIT");if(T&&typeof T=="number"&&(s.maxFramerate=s.maxFramerate?Math.min(s.maxFramerate,T):T),st("DSCP_TYPE")&&zs()){var v;const N=st("DSCP_TYPE");Ce(v=["very-low","low","medium","high"]).call(v,N)&&(s.networkPriority=N)}const y=r.getParameters(),x=(i=y.encodings)===null||i===void 0?void 0:i[0];mn()&&!x&&(o.encodings=[s]),x&&Object.assign(x,s),Object.assign(y,o),C.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(y.encodings))),await r.setParameters(y),await async function(N,L,Q){try{var J;if(!br().supportSetRtpSenderParameters||!function(kt){return kt==="vp9"||kt==="av1"}(N)||!st("ENABLE_SVC"))return;const at={},Rt={},vt=L.getParameters(),pt=(J=vt.encodings)===null||J===void 0?void 0:J[0];Rt.scalabilityMode=tf(Q),pt&&Object.assign(pt,Rt),Object.assign(vt,at),await L.setParameters(vt),C.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(vt.encodings)))}catch(at){C.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",at)}}(this.store.codec,r,st("SVC_MODE"))}async updateAdaptation(e,r){var n,i;if(!e)return C.debug("[updateAdaptation] no rtpSender found");if(!br().supportSetRtpSenderParameters)return C.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const o={},{bitrateMax:s,frameRate:c,scaleResolutionDownBy:d}=r;s&&(o.maxBitrate=1e3*s),c&&(o.maxFramerate=zi(c)),d&&d>=1&&Ce(n=["vp8","vp9"]).call(n,this.store.codec)&&(o.scaleResolutionDownBy=d);const u=e.getParameters(),l=(i=u.encodings)===null||i===void 0?void 0:i[0];l&&Object.assign(l,o),Object.assign(u,{});try{await e.setParameters(u),C.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(u.encodings)))}catch(T){!("transport"in e)||e.transport&&e.transport.state==="connected"?this.peerConnectionState!=="connected"?C.debug("[updateAdaptation] peerConnection not connected}"):C.debug("[updateAdaptation] updateRtpSenderEncodings failed",T):C.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,r){try{if(!br().supportSetRtpSenderParameters||e.length!==r.length)return;for(let n=0;n<e.length;n++){const i=e[n],o=r[n];o instanceof Zr&&!this.isVP8Simulcast(o)&&await this.updateRtpSenderEncodings(o,i.sender)}}catch{C.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,r,n){const i=ki(e);return r.forEach((o,s)=>{const c=n[s],d=i.mediaDescriptions.find(u=>u.attributes.mid===c);d&&(Bd(d,o),ow(d,o,this.store.codec))}),Ca(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,r,n)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,e,r,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,r)=>{var n;(n=this.onSelectedLocalCandidateChanged)===null||n===void 0||n.call(this,e,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,r)=>{var n;(n=this.onSelectedRemoteCandidateChanged)===null||n===void 0||n.call(this,e,r)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,r){if(e.length===r.length)for(let d=0;d<e.length;d++){var n,i,o,s,c;const u=e[d],l=r[d];if(l instanceof Zr&&!Ce(n=l._hints).call(n,Wr.LOW_STREAM)&&(i=l._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=l._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(s=l._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((c=l._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const T={},v={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};T.encodings=[{rid:"m",active:!0,maxBitrate:v.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:v.high}];const y=u.sender.getParameters();await u.sender.setParameters(Object.assign(y,T))}}}async applySimulcastEncodings(e,r){if(!mn()&&e.length===r.length)for(let n=0;n<e.length;n++){const i=r[n];if(i instanceof Zr&&this.isVP8Simulcast(i)){const o=e[n],s={},c={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};s.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];const d=o.sender.getParameters();await o.sender.setParameters(Object.assign(d,s))}}}isVP8Simulcast(e){var r,n,i,o,s;return!!(e instanceof Zr&&st("SIMULCAST")&&this.store.codec==="vp8"&&!Ce(r=e._hints).call(r,Wr.LOW_STREAM)&&(n=e._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((i=e._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(o=e._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((s=e._scalabilityMode)===null||s===void 0?void 0:s.numSpatialLayers)>1)}logSDPExchange(e,r,n,i){if(st("SDP_LOGGING"))return C.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(r," SDP during P2PConnection.").concat(i,`
`),e),r==="offer"?o=>{this.logSDPExchange(o,"answer",n==="local"?"remote":"local",i)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const r=this.remoteSDP.getSSRC(e);return r&&r.length!==0?r[0].ssrcId:void 0}setConfiguration(e){if(br().supportPCSetConfiguration){const r=Lc.resolvePCConfiguration(e);this.peerConnection.setConfiguration(r)}e.isPreallocation&&(this.isPreallocation=!0)}},Ke(Ir.prototype,"updateRemoteRTPCapabilities",[wi],Object.getOwnPropertyDescriptor(Ir.prototype,"updateRemoteRTPCapabilities"),Ir.prototype),Ke(Ir.prototype,"connect",[wi],Object.getOwnPropertyDescriptor(Ir.prototype,"connect"),Ir.prototype),Ke(Ir.prototype,"updateRemoteConnect",[wi],Object.getOwnPropertyDescriptor(Ir.prototype,"updateRemoteConnect"),Ir.prototype),Ke(Ir.prototype,"createDataChannels",[wi],Object.getOwnPropertyDescriptor(Ir.prototype,"createDataChannels"),Ir.prototype),Ke(Ir.prototype,"receive",[wi],Object.getOwnPropertyDescriptor(Ir.prototype,"receive"),Ir.prototype),Ke(Ir.prototype,"batchReceive",[wi],Object.getOwnPropertyDescriptor(Ir.prototype,"batchReceive"),Ir.prototype),Ke(Ir.prototype,"stopReceiving",[wi],Object.getOwnPropertyDescriptor(Ir.prototype,"stopReceiving"),Ir.prototype),Ke(Ir.prototype,"muteRemote",[wi],Object.getOwnPropertyDescriptor(Ir.prototype,"muteRemote"),Ir.prototype),Ke(Ir.prototype,"unmuteRemote",[wi],Object.getOwnPropertyDescriptor(Ir.prototype,"unmuteRemote"),Ir.prototype),Ke(Ir.prototype,"muteLocal",[wi],Object.getOwnPropertyDescriptor(Ir.prototype,"muteLocal"),Ir.prototype),Ke(Ir.prototype,"unmuteLocal",[wi],Object.getOwnPropertyDescriptor(Ir.prototype,"unmuteLocal"),Ir.prototype),Ke(Ir.prototype,"close",[wi],Object.getOwnPropertyDescriptor(Ir.prototype,"close"),Ir.prototype),Ke(Ir.prototype,"updateEncoderConfig",[wi],Object.getOwnPropertyDescriptor(Ir.prototype,"updateEncoderConfig"),Ir.prototype),Ke(Ir.prototype,"updateSendParameters",[wi],Object.getOwnPropertyDescriptor(Ir.prototype,"updateSendParameters"),Ir.prototype),Ke(Ir.prototype,"replaceTrack",[wi],Object.getOwnPropertyDescriptor(Ir.prototype,"replaceTrack"),Ir.prototype),Ke(Ir.prototype,"updateAdaptation",[wi],Object.getOwnPropertyDescriptor(Ir.prototype,"updateAdaptation"),Ir.prototype),Ke(Ir.prototype,"getRemoteSSRC",[wi],Object.getOwnPropertyDescriptor(Ir.prototype,"getRemoteSSRC"),Ir.prototype),Ir);function wi(t,e,r){const n=t[e];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const i=this.mutex,o=await i.lock("From P2PConnection.".concat(e));try{for(var s=arguments.length,c=new Array(s),d=0;d<s;d++)c[d]=arguments[d];return await n.apply(this,c)}finally{o()}},r}function dT(t,e){let r=document.createElement("video"),n=document.createElement("canvas");r.setAttribute("style","display:none"),n.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),n.width=zi(e.width),n.height=zi(e.height);const i=zi(e.framerate||15);document.body.append(r),document.body.append(n);let o=t._mediaStreamTrack;r.srcObject=new MediaStream([o]),r.play();const s=n.getContext("2d");if(!s)throw new Bt(et.UNEXPECTED_ERROR,"can not get canvas context");const c=br(),d=n.captureStream(c.supportRequestFrame?0:i).getVideoTracks()[0];d.canvas||(d.canvas=n),n.startCapture=()=>{if(!r)return n.stopCapture&&n.stopCapture();if(r.paused&&r.play(),r.videoHeight>2&&r.videoWidth>2){const l=r.videoWidth,T=r.videoHeight/l,v=n.width*T;Math.abs(v-n.height)>=2&&(C.debug("adjust low stream resolution","".concat(n.width,"x").concat(n.height," -> ").concat(n.width,"x").concat(v)),n.height=v)}s.drawImage(r,0,0,n.width,n.height),d.requestFrame&&d.requestFrame(),o!==t._mediaStreamTrack&&(o=t._mediaStreamTrack,r.srcObject=new MediaStream([o]))},n.stopCapture=fg(()=>n.startCapture&&n.startCapture(),i);const u=d.stop;return d.stop=()=>{u.call(d),r&&(r.remove(),r.srcObject=null,r=null),n&&(n.width=0,n.remove(),n.stopCapture&&n.stopCapture(),n.startCapture=void 0,n.stopCapture=void 0,n=null),C.debug("clean low stream renderer")},d}var jw=function(t){return t[t.Video_Send_Type=190]="Video_Send_Type",t}(jw||{}),ls=function(t){return t[t.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",t[t.Video_Send_Freeze=2082]="Video_Send_Freeze",t[t.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",t[t.Video_Recv_Freeze=2084]="Video_Recv_Freeze",t[t.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",t[t.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",t[t.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",t[t.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",t}(ls||{}),lr=function(t){return t[t.Video_Send_Retransmit=2062]="Video_Send_Retransmit",t[t.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",t[t.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",t[t.Video_Send_Transmit=2066]="Video_Send_Transmit",t[t.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",t[t.Video_Capture_Height=2033]="Video_Capture_Height",t[t.Video_Capture_Width=2035]="Video_Capture_Width",t[t.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",t[t.Video_Send_Low_Height=2073]="Video_Send_Low_Height",t[t.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",t[t.Video_Send_Low_Width=2077]="Video_Send_Low_Width",t[t.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",t[t.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",t[t.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",t[t.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",t[t.Video_Send_Width=2003]="Video_Send_Width",t[t.Video_Send_Height=2004]="Video_Send_Height",t[t.Video_Send_Disabled=2095]="Video_Send_Disabled",t[t.Video_Send_Adaptation=2032]="Video_Send_Adaptation",t[t.Video_Send_Player_Status=2128]="Video_Send_Player_Status",t[t.Video_Send_Nacks=2009]="Video_Send_Nacks",t[t.Video_Send_Plis=2010]="Video_Send_Plis",t[t.Video_Send_Firs=2011]="Video_Send_Firs",t[t.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",t[t.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",t[t.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",t[t.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",t[t.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",t[t.Video_Send_Bitrate=2012]="Video_Send_Bitrate",t[t.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",t[t.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",t[t.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",t[t.Audio_Send_Level=2038]="Audio_Send_Level",t[t.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",t[t.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",t[t.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",t[t.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",t[t.Audio_Send_Freeze=2081]="Audio_Send_Freeze",t[t.Audio_Send_Disabled=2096]="Audio_Send_Disabled",t[t.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",t[t.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",t[t.Video_Recv_Height=2019]="Video_Recv_Height",t[t.Video_Recv_Width=2018]="Video_Recv_Width",t[t.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",t[t.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",t[t.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",t[t.Video_Recv_Nacks=2026]="Video_Recv_Nacks",t[t.Video_Recv_Plis=2027]="Video_Recv_Plis",t[t.Video_Recv_Firs=2028]="Video_Recv_Firs",t[t.Video_Recv_Disabled=2101]="Video_Recv_Disabled",t[t.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",t[t.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",t[t.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",t[t.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",t[t.Audio_Render_Level=2043]="Audio_Render_Level",t[t.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",t[t.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",t[t.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",t[t.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",t[t.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",t[t.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",t[t.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",t[t.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",t[t.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",t[t.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",t[t.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",t[t.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",t}(lr||{}),Zn=function(t){return t[t.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",t[t.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",t[t.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",t[t.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",t[t.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",t[t.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",t[t.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",t[t.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",t[t.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",t[t.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",t[t.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",t[t.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",t[t.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",t[t.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",t[t.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",t[t.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",t[t.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",t[t.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",t[t.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",t[t.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",t[t.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",t}(Zn||{}),Ni=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(Ni||{}),_f=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t}(_f||{});const Sc=1e3,Ef=6,ml=3,XH=Math.max(Ef,ml,60);function rr(t,e,r){r!=null&&Number.isFinite(r)&&(t[e]=Math.round(Math.max(0,r)))}function Bw(t){const e={[Ni.CONN_TYPE]:0,[Ni.RTT]:t.rtt,[Ni.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const r=t.selectedCandidatePair.localCandidate.relayProtocol;r==="udp"&&(e[Ni.CONN_TYPE]=1),r==="tcp"&&(e[Ni.CONN_TYPE]=3),r==="tls"&&(e[Ni.CONN_TYPE]=4);break}case"srflx":e[Ni.CONN_TYPE]=2;break;case"unknown":e[Ni.CONN_TYPE]=5;break;default:e[Ni.CONN_TYPE]=0}return e}function Fw(t){let e=0;switch(t){case"none":e=0;break;case"cpu":e=1;break;case"bandwidth":e=2;break;case"other":e=3}return e}class Gw extends pn{constructor(e){super(),G(this,"store",void 0),G(this,"uploadWRTCStatsTimer",void 0),G(this,"uploadOutboundDenoiserStatsTimer",void 0),G(this,"uploadExtStatsTimer",void 0),G(this,"uploadExtUsageStatsTimer",void 0),G(this,"uploadInboundExtStatsTimer",void 0),G(this,"requestStats",void 0),G(this,"requestTransportStats",void 0),G(this,"requestLocalMedia",void 0),G(this,"requestRemoteMedia",void 0),G(this,"requestAllTracks",void 0),G(this,"requestVideoIsReady",void 0),G(this,"requestUploadStats",void 0),G(this,"requestUpload",void 0),G(this,"uploadOutboundStarted",!1),G(this,"uploadInboundStarted",!1),G(this,"uploadTransportStarted",!1),G(this,"uploadBaseStatsStarted",!1),G(this,"uploadExtensionUsageStarted",!1),G(this,"lastRecvStats",void 0),G(this,"lastSendStats",void 0),G(this,"lastRefRecvStats",void 0),G(this,"lastRefSendStats",void 0),G(this,"lastNormalRecvStats",void 0),G(this,"lastNormalSendStats",void 0),G(this,"lastExtendStats",{}),G(this,"needUploadStats",{}),G(this,"needUploadRenderFreezeTime",!0),G(this,"lastUploadCompensateTime",-1),G(this,"uploadCompensateDeltaTime",0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;const r=e%ml==0,n=e%Ef==0,i=e%60==0;let o,s;if(this.uploadTransportStarted&&(o=this.requestStats(),this.store.useP2P&&(s=this.requestStats(!0))),!o&&this.uploadOutboundStarted&&(o=this.requestStats()),!s&&this.uploadInboundStarted&&(s=this.requestStats(!0)),o||s){var c;const d={};if(this.uploadTransportStarted&&o){const l=this.getTransportStats(o,s,r);l&&(d.misc=[l])}if(this.uploadOutboundStarted&&o){const l=this.getOutboundStats(o,n?this.lastNormalSendStats:void 0,r?this.lastRefSendStats:void 0,this.lastSendStats,i);l&&(d.outbound=[l])}if(this.uploadInboundStarted&&s){this.uploadCompensateStats(e);const l=this.getInboundStats(s,n?this.lastNormalRecvStats:void 0,r?this.lastRefRecvStats:void 0,this.lastRecvStats);l&&(d.inbound=l)}const u=(c=this.requestTransportStats)===null||c===void 0?void 0:c.call(this).connectState;u&&(Array.isArray(d.misc)?d.misc[0]&&d.misc[0].addition&&(d.misc[0].addition[_f.RTC_PEER_CONNECTION_STATE]=QE[u]):d.misc=[{addition:{[_f.RTC_PEER_CONNECTION_STATE]:QE[u]}}]),this.needUploadStats.sendType&&(Array.isArray(d.outbound)&&d.outbound[0]&&d.outbound[0].high&&(d.outbound[0].high[jw.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(d)}this.lastRecvStats=s,this.lastSendStats=o,n&&(this.lastNormalRecvStats=s,this.lastNormalSendStats=o),r&&(this.lastRefRecvStats=s,this.lastRefSendStats=o)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var r,n;const i=(r=this.requestTransportStats)===null||r===void 0?void 0:r.call(this);return void(i&&((n=this.requestUploadStats)===null||n===void 0||n.call(this,{misc:[{addition:{[_f.RTC_PEER_CONNECTION_STATE]:QE[i.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(e),++e===XH+1&&(e=1)},Sc)}uploadCompensateStats(e){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const r=e%ml==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!r)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const n=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=n,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const i=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*i;const o=this.requestStats(!0);new Array(i).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const s={};if(this.uploadInboundStarted&&o){const c=this.requestRemoteMedia()||[],d=[];c.forEach(u=>{let[l,T]=u;const v={peer:l.uid};if(l._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(l._videoSSRC)&&T.has(Ue.VIDEO)&&l.videoTrack){const y=function(x,N,L){if(!N.videoRecv.find(J=>J.ssrc===x))return;const Q={};if(L&&L._player){const J=L._player,{renderFreezeAccTime2:at,videoElementStatus:Rt}=J;if(bs.visibility==="visible"&&Rt===ai.PLAYING&&br().supportRequestVideoFrameCallback){const vt=Math.min(6e3,at);J.renderFreezeAccTime2=Math.max(0,at-vt),rr(Q,ls.Video_Render_Freeze_Time_Render2,vt),st("USE_NEW_RENDER_FREEZE_TIME")&&rr(Q,ls.Video_Render_Freeze_Time_Render,vt)}}return Q}(l._videoSSRC,o,l.videoTrack);y&&(v.video=y)}v.video&&d.push(v)}),d.length>0&&(s.inbound=d,this.requestUploadStats(s))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(e,r,n){if(!this.requestStats)return;if(!n)return e.rtt==null?void 0:{addition:{[Ni.RTT]:e.rtt,[Ni.CONN_TYPE]:void 0,[Ni.STATS_UPDATE_INTERVAL]:e.updateInterval||void 0}};const i=Bw(e);if(this.store.useP2P){if(r){const o=Bw(r);i[Ni.CONN_TYPE]+=o[Ni.CONN_TYPE]<<3}i[Ni.CONN_TYPE]+=110}else i[Ni.CONN_TYPE]+=100;return{addition:i}}getOutboundStats(e,r,n,i,o){if(!this.requestUploadStats||!this.requestLocalMedia)return;const s=this.requestLocalMedia();if(!s||s.length===0)return;let c,d,u;return s.forEach(l=>{let[T,{track:v,ssrcs:y}]=l;switch(T){case _e.LocalVideoLowTrack:case _e.LocalVideoTrack:if(T===_e.LocalVideoTrack){var x;const N=function(at,Rt,vt,pt,kt,$t){const se=Rt.videoSend.find(ar=>ar.ssrc===at);if(!se)return;const Te={},{sentFrame:mr,inputFrame:Er}=se;if(pt&&(rr(Te,ls.Video_Send_Qp_Sum,se.qpSumPerFrame),Er&&mr)){const ar=Er.frameRate,kr=mr.frameRate;Te[ls.Video_Send_Freeze]=function(Nr,li){let ie=!0;return ie=!(Nr<=5)&&(Nr<=10?li<3:Nr<=20?li<4:li<5),ie}(ar,kr)?1:0}if(kt){switch(mr&&(rr(Te,lr.Video_Send_Height,mr.height),rr(Te,lr.Video_Send_Width,mr.width),rr(Te,lr.Video_Send_Frame_Rate,mr.frameRate)),Te[lr.Video_Send_Disabled]=vt._originMediaStreamTrack&&!vt._originMediaStreamTrack.enabled||vt._mediaStreamTrack&&!vt._mediaStreamTrack.enabled?1:0,se.adaptionChangeReason){case"none":Te[lr.Video_Send_Adaptation]=0;break;case"cpu":Te[lr.Video_Send_Adaptation]=1;break;case"bandwidth":Te[lr.Video_Send_Adaptation]=2;break;case"other":Te[lr.Video_Send_Adaptation]=3}let ar=0;se.adaptionChangeReason&&(ar+=Fw(se.adaptionChangeReason)),Rt.qualityLimitationReason&&(ar+=Fw(Rt.qualityLimitationReason)<<3),Te[lr.Video_Send_Adaptation]=ar,Te[lr.Video_Send_Player_Status]=hg[vt._player?vt._player.videoElementStatus:"uninit"],rr(Te,lr.Video_Send_Nacks,se.nacksCount),rr(Te,lr.Video_Send_Plis,se.plisCount),rr(Te,lr.Video_Send_Firs,se.firsCount),rr(Te,lr.Video_Send_Avg_Encode,se.avgEncodeMs),rr(Te,lr.Video_Send_Huge_Frame_Sent,se.hugeFramesSent),rr(Te,lr.Video_Send_Bytes_Retransmit,se.retransmittedBytesSent),rr(Te,lr.Video_Send_Packages_Retransmit,se.retransmittedPacketsSent),rr(Te,lr.Video_Send_Key_Frames_Encoded,se.keyFramesEncoded);const kr=kt.videoSend.find(Nr=>Nr.ssrc===at);if(kr){let Nr=Sc*ml;kr.timestamp&&se.timestamp&&(Nr=se.timestamp-kr.timestamp),kr.packets!=null&&se.packets!=null&&rr(Te,lr.Video_Send_Package_Rate,1e3*(se.packets-kr.packets)/Nr),se.packetsLost!=null&&kr.packetsLost!=null&&rr(Te,lr.Video_Send_Package_Lost,se.packetsLost-kr.packetsLost),kr.bytes!=null&&se.bytes!=null&&rr(Te,lr.Video_Send_Bitrate,8*(se.bytes-kr.bytes)/Nr)}}return Te}(y[0].ssrcId,e,v,r,n),L=v.__className__==="CameraVideoTrack"?3:Ce(x=v._hints).call(x,Wr.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==L||o)&&(this.needUploadStats={sendType:L},this.lastExtendStats.sendType=L);const Q=v&&function(at,Rt,vt,pt){const kt=Rt.videoSend.find(se=>se.ssrc===at);if(!kt)return null;const $t={};if(pt){const se=kt.inputFrame,Te=se&&se.height||vt.videoHeight||0,mr=se&&se.width||vt.videoWidth||0,Er=se&&se.frameRate||0;rr($t,lr.Video_Capture_Height,Te),rr($t,lr.Video_Capture_Width,mr),rr($t,lr.Video_Capture_Frame_Rate,Er)}return $t}(y[0].ssrcId,e,v,!!n),J=function(at,Rt){const vt={};return Rt&&(rr(vt,lr.Video_Send_Retransmit,at.bitrate.retransmit),rr(vt,lr.Video_Send_Target_Encoded,at.bitrate.targetEncoded),rr(vt,lr.Video_Send_Actual_Encoded,at.bitrate.actualEncoded),rr(vt,lr.Video_Send_Transmit,at.bitrate.transmit),rr(vt,lr.Video_Send_Bandwidth,at.sendBandwidth)),vt}(e,!!n);d=Object.assign({},N,Q,J)}else u=function(N,L,Q,J,at){const Rt=L.videoSend.find(pt=>pt.ssrc===N);if(!Rt)return;const vt={};if(J){const pt=Rt.sentFrame;pt&&(rr(vt,lr.Video_Send_Low_Height,pt.height),rr(vt,lr.Video_Send_Low_Width,pt.width),rr(vt,lr.Video_Send_Low_Frame_Rate,pt.frameRate));const kt=J.videoSend.find($t=>$t.ssrc===N);if(kt){let $t=Sc*Ef;kt.timestamp&&Rt.timestamp&&($t=Rt.timestamp-kt.timestamp),kt.packets!=null&&Rt.packets!=null&&rr(vt,lr.Video_Send_Low_Package_Rate,1e3*(Rt.packets-kt.packets)/$t),Rt.packetsLost!=null&&kt.packetsLost!=null&&rr(vt,lr.Video_Send_Low_Package_Lost,Rt.packetsLost-kt.packetsLost),kt.bytes!=null&&Rt.bytes!=null&&rr(vt,lr.Video_Send_Low_Bitrate,8*(Rt.bytes-kt.bytes)/$t)}}return vt}(y[0].ssrcId,e,0,n);break;case _e.LocalAudioTrack:c=v&&function(N,L,Q,J,at,Rt){const vt=L.audioSend.find(kt=>kt.ssrc===N);if(!vt)return;const pt={};if(at){pt[lr.Audio_Send_Disabled]=Q._originMediaStreamTrack&&!Q._originMediaStreamTrack.enabled||Q._mediaStreamTrack&&!Q._mediaStreamTrack.enabled?1:0;const kt=100*Q._source.getAccurateVolumeLevel(),$t=vt.inputLevel;if($t!=null){const Te=Math.ceil(50*Math.log10(100*$t+1));rr(pt,lr.Audio_Send_Level,Te)}rr(pt,lr.Audio_Capture_PCM_Level,kt),rr(pt,lr.Audio_Send_AEC_Return_Loss,vt.aecReturnLoss),rr(pt,lr.Audio_Send_AEC_Return_Loss_Enhancement,vt.aecReturnLossEnhancement),rr(pt,lr.Audio_Send_Bytes_Retransmit,vt.retransmittedBytesSent),rr(pt,lr.Audio_Send_Packages_Retransmit,vt.retransmittedPacketsSent),pt[lr.Audio_Send_Freeze]=0;const se=at.audioSend.find(Te=>Te.ssrc===N);if(se){let Te=Sc*Ef;se.timestamp&&vt.timestamp&&(Te=vt.timestamp-se.timestamp),se.bytes!=null&&vt.bytes!=null&&rr(pt,lr.Audio_Send_Bitrate,8*(vt.bytes-se.bytes)/Te),se.packets!=null&&vt.packets!=null&&rr(pt,lr.Audio_Send_Package_Rate,1e3*(vt.packets-se.packets)/Te)}}return pt}(y[0].ssrcId,e,v,0,n)}}),{high:d,low:u,audio:c}}getInboundStats(e,r,n,i){if(!this.requestRemoteMedia)return;const o=this.requestRemoteMedia()||[],s=[];return o.forEach(c=>{let[d,u]=c;const l={peer:d.uid};if(u.has(Ue.VIDEO)&&d.videoTrack){const T=d._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(d._videoSSRC)||!1,v=d.videoTrack?function(y,x,N,L,Q,J,at,Rt){const vt=x.videoRecv.find(ar=>ar.ssrc===y);if(!vt)return;const pt={},{receivedFrame:kt,outputFrame:$t,decodeFrameRate:se}=vt;rr(pt,Zn.Video_Render_Frame_Rate_Decode,se),vt.framesRateFirefox&&rr(pt,Zn.Video_Recv_Frame_Rate,vt.framesRateFirefox),kt&&rr(pt,Zn.Video_Recv_Frame_Rate,kt.frameRate),rr(pt,Zn.Video_Recv_Frame_Dropped,vt.framesDroppedCount),rr(pt,Zn.Video_Recv_Bytes_Retransmit,vt.retransmittedBytesReceived),rr(pt,Zn.Video_Recv_Packages_Retransmit,vt.retransmittedPacketsReceived),rr(pt,Zn.Video_Recv_Packages_Discarded,vt.packetsDiscarded),rr(pt,Zn.Video_Recv_Avg_Decode,vt.avgDecodeMs),rr(pt,Zn.Video_Recv_Avg_Processing_Delay,vt.avgProcessingDelayMs),rr(pt,Zn.Video_Recv_Avg_Assembly_Time,vt.avgFramesAssembledFromMultiplePacketsMs),rr(pt,Zn.Video_Recv_Avg_Inter_Frame_Delay,vt.avgInterFrameDelayMs),rr(pt,Zn.Video_Recv_Key_Frames_Decoded,vt.keyFramesDecoded);const Te=Rt&&Rt.videoRecv.find(ar=>ar.ssrc===y);if(Te){const ar=x.timestamp-Rt.timestamp||Sc;vt.packetsLost!=null&&Te.packetsLost!=null&&rr(pt,Zn.Video_Recv_Package_Lost,vt.packetsLost-Te.packetsLost),Te.bytes!=null&&vt.bytes!=null&&rr(pt,Zn.Video_Recv_Bitrate,8*(vt.bytes-Te.bytes)/ar),Te.packets!=null&&vt.packets!=null&&rr(pt,Zn.Video_Recv_Package_Rate,1e3*(vt.packets-Te.packets)/ar)}const mr=J&&J.videoRecv.find(ar=>ar.ssrc===y);if(mr&&(rr(pt,ls.Video_Recv_Qp_Sum,vt.qpSumPerFrame),pt[ls.Video_Recv_Freeze]=L&&fl.isRemoteVideoFreeze(N,vt,mr)?1:0),at){var Er;const ar=at.videoRecv.find(Nr=>Nr.ssrc===y);kt?(rr(pt,lr.Video_Recv_Height,kt.height),rr(pt,lr.Video_Recv_Width,kt.width)):N&&(rr(pt,lr.Video_Recv_Height,N._videoHeight||0),rr(pt,lr.Video_Recv_Width,N._videoWidth||0)),$t&&rr(pt,lr.Video_Recv_Frame_Rate_Output,$t.frameRate);const kr=(Er=N._player)===null||Er===void 0?void 0:Er.rendFrameRate.toFixed(0);if(kr&&rr(pt,lr.Video_Render_Frame_Rate_Render,+kr),rr(pt,lr.Video_Recv_Jitter_Buffer,vt.jitterBufferMs),rr(pt,lr.Video_Recv_Current_Delay,vt.currentDelayMs),rr(pt,lr.Video_Recv_Firs,vt.firsCount),rr(pt,lr.Video_Recv_Nacks,vt.nacksCount),rr(pt,lr.Video_Recv_Plis,vt.plisCount),N){pt[lr.Video_Recv_Disabled]=N._originMediaStreamTrack.enabled&&N._mediaStreamTrack.enabled?0:1;const Nr=N._player;if(Nr){const{freezeTimeCounterList:li,renderFreezeAccTime:ie,renderFreezeAccTime2:Se,videoElementStatus:Fe}=Nr;if(li&&li.length>0&&rr(pt,ls.Video_Render_Freeze_Time,li.splice(0,1)[0]),Q&&bs.visibility==="visible"&&Fe===ai.PLAYING&&br().supportRequestVideoFrameCallback){const ce=Math.min(6e3,Se);Nr.renderFreezeAccTime2=Math.max(0,Se-ce),rr(pt,ls.Video_Render_Freeze_Time_Render2,ce);const w=Math.min(6e3,ie);Nr.renderFreezeAccTime=Math.max(0,ie-w),rr(pt,ls.Video_Render_Freeze_Time_Render,st("USE_NEW_RENDER_FREEZE_TIME")?ce:w)}if(typeof vt.totalFreezesDuration=="number"){const ce=ar&&ar.totalFreezesDuration?vt.totalFreezesDuration-ar.totalFreezesDuration:vt.totalFreezesDuration;rr(pt,lr.Video_Render_Freeze_Duration,1e3*ce)}}}if(pt[lr.Video_Recv_Player_Status]=hg[N._player?N._player.videoElementStatus:"uninit"],ar&&vt.totalInterFrameDelay!==void 0&&vt.totalSquaredInterFrameDelay!==void 0&&ar.totalInterFrameDelay!==void 0&&ar.totalSquaredInterFrameDelay!==void 0){const Nr=vt.totalInterFrameDelay-ar.totalInterFrameDelay,li=vt.totalSquaredInterFrameDelay-ar.totalSquaredInterFrameDelay,ie=vt.framesDecodeCount-ar.framesDecodeCount,Se=Nr/ie*1e3,Fe=Math.round(1e3*Math.sqrt((li-Math.pow(Nr,2)/ie)/ie));!isNaN(Fe)&&Se+Fe>Math.max(3*Se,Se+150)&&(pt[lr.Video_Recv_I_Frame_Delay]=Fe)}}return pt}(d._videoSSRC,e,d.videoTrack,T===!0,this.needUploadRenderFreezeTime,r,n,i):void 0;v&&(l.video=v)}if(u.has(Ue.AUDIO)&&d.audioTrack){const T=d.audioTrack?function(v,y,x,N,L,Q){const J=y.audioRecv.find(pt=>pt.ssrc===v);if(!J)return;const at={};rr(at,Zn.Audio_Recv_Jitter,J.jitterMs),rr(at,Zn.Audio_Recv_Bytes_Retransmit,J.retransmittedBytesReceived),rr(at,Zn.Audio_Recv_Packages_Retransmit,J.retransmittedPacketsReceived),rr(at,Zn.Audio_Recv_Packages_Discarded,J.packetsDiscarded),rr(at,Zn.Audio_Recv_Avg_Processing_Delay,J.avgProcessingDelayMs);const Rt=Q&&Q.audioRecv.find(pt=>pt.ssrc===v);if(Rt){const pt=Sc;J.packets!=null&&Rt.packets!=null&&rr(at,Zn.Audio_Recv_Package_Rate,1e3*(J.packets-Rt.packets)/pt),J.packetsLost!=null&&Rt.packetsLost!=null&&rr(at,Zn.Audio_Recv_Package_Lost,J.packetsLost-Rt.packetsLost)}if(N){const{receivedFrames:pt,droppedFrames:kt}=J;pt!=null&&kt!=null&&(at[ls.Audio_Recv_Freeze]=(vt=pt)===0||100*kt/vt>20?1:0)}var vt;if(L){const pt=100*x._source.getAccurateVolumeLevel(),kt=J.outputLevel;if(kt!=null){const se=Math.ceil(50*Math.log10(100*kt+1));rr(at,lr.Audio_Render_Level,se)}rr(at,lr.Audio_Recv_PCM_Level,pt),x&&(at[lr.Audio_Recv_Disabled]=x._originMediaStreamTrack.enabled&&x._mediaStreamTrack.enabled?0:1),rr(at,lr.Audio_Recv_Jitter_Buffer,J.jitterBufferMs),rr(at,lr.Audio_Recv_Current_Delay,J.jitterBufferMs),at[lr.Audio_Recv_Player_Status]=hg[Oi.getPlayerState(x.getTrackId())];const $t=L.audioRecv.find(se=>se.ssrc===v);if($t){$t.bytes!=null&&J.bytes!=null&&rr(at,lr.Audio_Recv_Bitrate,8*(J.bytes-$t.bytes)/(Sc*ml));const se=J.concealedSamples-$t.concealedSamples;se>0&&rr(at,lr.Audio_Recv_Concealed_Samples,se);const Te=J.totalSamplesReceived-$t.totalSamplesReceived;Te>0&&rr(at,lr.Audio_Recv_Total_Samples_Received,Te);const mr=J.freezeSamples80-$t.freezeSamples80;mr>0&&rr(at,lr.Audio_Render_Freeze_Samples_80ms,mr);const Er=J.freezeSamples200-$t.freezeSamples200;Er>0&&rr(at,lr.Audio_Render_Freeze_Samples_200ms,Er);const ar=J.freezeMs80-$t.freezeMs80;rr(at,lr.Audio_Render_Freeze_Time_80ms,ar<0?0:ar);const kr=J.freezeMs200-$t.freezeMs200;rr(at,lr.Audio_Render_Freeze_Time_200ms,kr<0?0:kr)}}return at}(d._audioSSRC,e,d.audioTrack,r,n,i):void 0;T&&(l.audio=T)}(l.video||l.audio)&&s.push(l)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,s}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find(r=>r instanceof rl);if(e&&e._external.getDenoiserStats){const r=e._external.getDenoiserStats();r&&this.requestUpload(il.DENOISER_STATS,r)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e=>{let[r,n]=e;n.has(Ue.VIDEO)&&r.videoTrack&&r.videoTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)}),n.has(Ue.AUDIO)&&r.audioTrack&&r.audioTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const r=Date.now(),n={connectionInterval:st("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:r};let i=[];const o=this.requestAllTracks&&this.requestAllTracks()||[];for(const u of o)!u.muted&&u.enabled&&(i=i.concat(await u.getProcessorUsage()));const s=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[u,l]of s)l.has(Ue.VIDEO)&&u.videoTrack&&(i=i.concat(await u.videoTrack.getProcessorUsage())),l.has(Ue.AUDIO)&&u.audioTrack&&(i=i.concat(await u.audioTrack.getProcessorUsage()));if(i.length===0)return;n.details=function(u,l){const T={};for(const{id:N,value:L,level:Q,direction:J}of u){var v;const at=(v=l.get(N))!==null&&v!==void 0?v:0,Rt=L===2?at+st("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:at;var y,x;l.set(N,Rt),T[N]?(L===2&&(T[N].value=L),Q>T[N].level&&(T[N].level=Q),J==="remote"&&(T[N].remoteUidCount+=1),T[N].totalTs=(y=l.get(N))!==null&&y!==void 0?y:0):T[N]={value:L,level:Q,remoteUidCount:J==="local"?0:1,totalTs:(x=l.get(N))!==null&&x!==void 0?x:0}}return Object.keys(T).map(N=>{const{level:L,value:Q,totalTs:J}=T[N];return{id:N,level:L,value:Q,totalTs:J}})}(i,e);const c=Date.now(),d=c>r?c:r+1;this.requestUpload&&this.requestUpload(il.EXTENSION_USAGE_STATS,{usageStats:n,sendTs:d})},st("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const JH=st("ICE_RESTART_INTERVAL");let gf=new Map,Kd=new Map,Ua=[di.UDP_TCP_RELAY,di.TCP_RELAY,di.RELAY],uT=st("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&br().supportPCSetConfiguration;function Hw(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=gf.get(t.id);r&&(window.clearTimeout(r),gf.delete(t.id));const n=Kd.get(t.id);e&&n&&n.index===Ua.length-1&&(C.debug("[".concat(t.id,"] reset ICE restart policy")),Kd.delete(t.id))}function Ww(t,e,r){if(gf.size===0&&Kd.size===0&&(Array.isArray(st("RESTART_SEQUENCE"))&&st("RESTART_SEQUENCE").length>0&&!function(c,d){if(c.length!==d.length)return!1;for(let u=0;u<c.length;u+=1){const l=c[u];if(c.filter(T=>T===l).length!==d.filter(T=>T===l).length)return!1}return!0}(Ua,st("RESTART_SEQUENCE"))&&(Ua=st("RESTART_SEQUENCE").filter(c=>{var d;if(Ce(d=Object.values(di)).call(d,c))return!0}),C.debug("use reconnection policy from config distribution, queues: ".concat(Ua.join(" => ")))),uT=st("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&br().supportPCSetConfiguration),Ua.length===0)return void r();let n,{index:i=0,type:o}=Kd.get(t.id)||{};if(uT&&o===di.RELAY)return void r();let s=o&&i>=Ua.length-1;if(uT)o=di.RELAY;else{if(s)return void r();o?(i++,o=Ua[i]):(o=Ua[0],i=0)}C.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(o,", index: ").concat(i)),e(o),Kd.set(t.id,{index:i,type:o}),n=window.setTimeout(()=>Ww(t,e,r),JH),gf.set(t.id,n)}var Tr;function Kw(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Ns(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Kw(Object(r),!0).forEach(function(n){G(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Kw(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function zw(t){var e,r,n,i=2;for(typeof Symbol<"u"&&(r=CE,n=Symbol.iterator);i--;){if(r&&(e=t[r])!=null)return e.call(t);if(n&&(e=t[n])!=null)return new Tf(e.call(t));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function Tf(t){function e(r){if(Object(r)!==r)return De.reject(new TypeError(r+" is not an object."));var n=r.done;return De.resolve(r.value).then(function(i){return{value:i,done:n}})}return Tf=function(r){this.s=r,this.n=r.next},Tf.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(r){var n=this.s.return;return n===void 0?De.resolve({value:r,done:!0}):e(n.apply(this.s,arguments))},throw:function(r){var n=this.s.return;return n===void 0?De.reject(r):e(n.apply(this.s,arguments))}},new Tf(t)}let _l=(Tr=class extends pn{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit($e.StateChange,e,this._state)}constructor(t,e){super(),G(this,"isPlanB",void 0),G(this,"store",void 0),G(this,"statsUploader",void 0),G(this,"connection",void 0),G(this,"localTrackMap",new Map),G(this,"remoteUserMap",new Map),G(this,"localDataChannels",[]),G(this,"remoteDataChannelMap",new Map),G(this,"pendingLocalTracks",[]),G(this,"pendingRemoteTracks",[]),G(this,"pendingLocalDataChannels",[]),G(this,"pendingRemoteDataChannels",[]),G(this,"statsCollector",void 0),G(this,"shouldForwardP2PCreation",void 0),G(this,"iceFailedCount",0),G(this,"dtlsFailedCount",0),G(this,"mutex",void 0),G(this,"_state",Mr.Disconnected),G(this,"_pcStatsUploadType",st("NEW_ICE_RESTART")?Js.FIRST_CONNECTION:Js.OLD_FIRST_CONNECTION),G(this,"_isStartRestartIce",!1),G(this,"_restartTimer",void 0),G(this,"_isTryConnecting",!1),G(this,"_iceError",null),G(this,"_forceTurn",!1),G(this,"_isWaitPcToRePub",!1),G(this,"handleMuteLocalTrack",async(r,n,i)=>{const o=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Mr.Connected)return void i(new Qt(et.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const s=this.filterTobeMutedTracks(r);if(s.length===0)return void n();const c=s.find(u=>u[0]==="videoLowTrack");if(c){const u=c[1];this.store.enableInstantMuteRestore?(u.track._originMediaStreamTrack.enabled=!1,C.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):u.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?C.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(s.map(u=>{let[,{id:l}]=u;return l}));const d=this.createMuteMessage(s);await Kr(this,$e.RequestMuteLocal,d),n()}catch(s){i(s)}finally{o()}}),G(this,"handleUnmuteLocalTrack",async(r,n,i)=>{const o=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Mr.Connected)return void i(new Qt(et.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const s=this.filterTobeUnmutedTracks(r);if(s.length===0)return void n();const c=s.find(u=>u[0]==="videoLowTrack");if(c){const u=c[1];if(this.store.enableInstantMuteRestore)u.track._originMediaStreamTrack.enabled=!0,C.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(u.track._originMediaStreamTrack.stop(),!st("DISABLE_DUAL_STREAM_USE_ENCODING")&&br().supportDualStreamEncoding){const l=r._mediaStreamTrack.clone();u.track._mediaStreamTrack=l,u.track._originMediaStreamTrack=l}else{const l=dT(r,Xu(this,$e.RequestLowStreamParameter));u.track._mediaStreamTrack=l,u.track._originMediaStreamTrack=l}await new De((l,T)=>{this.handleReplaceTrack(u.track,l,T,!0)})}}this.store.enableInstantMuteRestore?C.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(s.map(u=>{let[,{id:l}]=u;return l}));const d=this.createUnmuteMessage(s);await Kr(this,$e.RequestUnmuteLocal,d),n()}catch(s){i(s)}finally{o()}}),G(this,"handleUpdateVideoEncoder",async(r,n,i,o)=>{let s;o||(s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const d=this.localTrackMap.get(_e.LocalVideoTrack);if(!this.connection||!d||d.track!==r||this.state!==Mr.Connected)return void n();const{id:u,track:l}=d;await this.connection.updateSendParameters(u,l),await this.connection.updateEncoderConfig(u,l),this.emit($e.UpdateVideoEncoder,l),n()}catch(d){i(d)}finally{var c;(c=s)===null||c===void 0||c()}}),G(this,"handleUpdateVideoSendParameters",async(r,n,i)=>{const o=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const s=this.localTrackMap.get(_e.LocalVideoTrack);if(!this.connection||!s||s.track!==r||this.state!==Mr.Connected)return void n();const{id:c,track:d}=s;await this.connection.updateSendParameters(c,d),n()}catch(s){i(s)}finally{o()}}),G(this,"handleReplaceMixingTrack",async(r,n,i,o)=>{if(!this.connection||this.state!==Mr.Connected)return void n();const s=aT([r]);let c;C.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(s.getTrackId(),"]")),typeof o=="boolean"&&o||(c=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(r,s),n()}catch(u){i(u)}finally{var d;(d=c)===null||d===void 0||d()}}),G(this,"handleReplaceTrack",async(r,n,i,o)=>{let s;C.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof o=="boolean"&&o||(s=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var c;const u=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:T}]=l;return r===T});if(!this.connection||!u||this.state!==Mr.Connected)return void n();if(await((c=this.connection)===null||c===void 0?void 0:c.replaceTrack(r,u[1].id)),this.isPlanB){const l=u[1];l.id=r._mediaStreamTrack.id,this.localTrackMap.set(u[0],l)}if(u[0]===_e.LocalVideoTrack&&!st("DISABLE_DUAL_STREAM_USE_ENCODING")&&br().supportDualStreamEncoding){const l=this.localTrackMap.get(_e.LocalVideoLowTrack);if(l){const T=r._mediaStreamTrack.clone();l.track._originMediaStreamTrack.stop(),l.track._mediaStreamTrack=T,l.track._originMediaStreamTrack=T,await new De((v,y)=>{this.handleReplaceTrack(l.track,v,y,!0)})}}n()}catch(u){i(u)}finally{var d;(d=s)===null||d===void 0||d()}}),G(this,"handleGetRTCStats",r=>{r(this.statsCollector.getRTCStats())}),G(this,"handleGetLocalVideoStats",r=>{r(this.statsCollector.getLocalVideoTrackStats())}),G(this,"handleGetLocalAudioStats",r=>{r(this.statsCollector.getLocalAudioTrackStats())}),G(this,"handleGetRemoteVideoStats",r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid]),G(this,"handleGetRemoteAudioStats",r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new Gw(this.store),this.bindStatsUploaderEvents(),this.mutex=new si("P2PChannel-mutex",this.store.clientId),this.isPlanB=!br().supportUnifiedPlan||st("CHROME_FORCE_PLAN_B")&&zs(),this.shouldForwardP2PCreation=st("FORWARD_P2P_CREATION")&&br().supportPCSetConfiguration&&jE(),this.shouldForwardP2PCreation&&(this.connection=mf(this.store),this.emit($e.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t,e){var r;this.state=Mr.New,this._forceTurn=xw(t),C.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const n=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||n||e)&&((n||e)&&this.connection&&(C.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=mf(this.store,t),this.emit($e.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Qt(et.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=st("NEW_ICE_RESTART")?Js.FIRST_CONNECTION:Js.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new Qt(et.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===Mr.Connected){if(this.connection instanceof go&&this.connection.checkDtlsParameters(t.dtlsParameters.fingerprints))return C.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),qe.reportApiInvoke(this.store.sessionId,{name:vn.MISMATCH_DTLS_PARAMETERS,options:[t.dtlsParameters.fingerprints],tag:cn.TRACER}).onSuccess(),void setTimeout(()=>{this.emit($e.RequestReconnect)});await this.connection.updateRemoteConnect(t)}else this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Mr.Connected}updateRemoteRTPCapabilities(t){const e=Array.from(this.localTrackMap.entries()).filter(i=>{var o;let[s]=i;return Ce(o=[_e.LocalVideoLowTrack,_e.LocalVideoTrack]).call(o,s)}),r=e.map(i=>{let[,{id:o}]=i;return o}),n=e.map(i=>{let[o]=i;return o});if(this.connection instanceof go){if(qe.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(n),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!Ce(t).call(t,this.store.codec)){const i=["vp9","vp8","h264"].find(o=>Ce(t).call(t,o));i&&(this.store.codec=i,C.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i,".")))}this.connection.updateRemoteRTPCapabilities(r,t)}}async getEstablishParams(){var t;if(this.connection instanceof go&&this.connection.peerConnectionState!=="closed"&&Ce(t=[Mr.New,Mr.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==Mr.Connected){if(this.state===Mr.Disconnected)throw new Qt(et.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(r=>{var n;Ce(n=this.pendingLocalDataChannels).call(n,r)||this.pendingLocalDataChannels.push(r)}),[]}const e=this.filterTobePublishedDataChannels(t);return e.length===0?[]:(e.forEach(r=>{const n=Date.now();this.store.publish(r.id.toString(),"datachannel",n)}),await this.connection.createDataChannels(this.store.uid,e),e.forEach(r=>{this.localDataChannels.push(r);const n=Date.now();this.store.publish(r.id+"","datachannel",void 0,n)}),t.map(r=>({streamId:r.id,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:r.metadata,channelId:r._originDataChannelId})))}publish(t,e,r){var n=this;return ho(function*(){const i=yield Ar(n.mutex.lock("From P2PChannel.publish"));try{var o;const s=n.connection&&Ce(o=["disconnected","failed"]).call(o,n.connection.peerConnectionState);if(!n.connection||n.state!==Mr.Connected||s){if(n.state===Mr.Disconnected)throw new Qt(et.UNEXPECTED_ERROR,"PeerConnection already disconnected.");n.throwIfTrackTypeNotMatch(t);const d=t.filter(u=>n.pendingLocalTracks.indexOf(u)===-1);return n.pendingLocalTracks=n.pendingLocalTracks.concat(d),void(s&&(n._isWaitPcToRePub=!0))}n.store.pubId=n.store.pubId+1,ui.markPublishStart(n.store.clientId,n.store.pubId);const c=n.filterTobePublishedTracks(t,e,r);if(c.length===0)return void(yield Ar(n.tryToUnmuteAudio(t)));yield*up(zw(n.doPublish(n.connection,c)))}finally{i()}})()}doPublish(t,e){var r=this;return ho(function*(){e.forEach(v=>{let{track:y,type:x}=v;const N=Date.now();r.store.publish(y.getTrackId(),x===_e.LocalAudioTrack?"audio":"video",N)}),r.bindLocalTrackEvents(e);const n=e.map(v=>{let{track:y}=v;return y}),i=yield Ar(t.send(n,r.store.codec,r.store.audioCodec)),o=(yield Ar(i.next())).value,s=r.createGatewayPublishMessage(e,o);let c;try{c=yield s}catch(v){throw i.throw(v),v?.code===et.WS_ABORT&&e.forEach(y=>{let{track:x}=y;r.pendingLocalTracks.indexOf(x)===-1&&r.pendingLocalTracks.push(x)}),r.unbindLocalTrackEvents(e),v}const d=r.mapPubResToRemoteConfig(s,c,n),u=(yield Ar(i.next(d))).value;if(r.state===Mr.Disconnected)throw new Qt(et.UNEXPECTED_ERROR,"PeerConnection already disconnected.");st("ENABLE_VIDEO_SEI");const l=st("ENABLE_ENCODED_TRANSFORM"),T=st("ENABLE_AUDIO_METADATA");n.forEach(async v=>{const y=v.getRTCRtpTransceiver();if(!y||!l)return;const{interceptLocalVideoFrame:x,interceptLocalAudioFrame:N}=sf();v.trackMediaType===Ue.VIDEO?await x(y.sender,v):v.trackMediaType===Ue.AUDIO&&await N(y.sender,{metadata:T?()=>{const L=v.metadata.shift();return L&&L.value}:void 0})}),e.forEach(v=>{let{type:y}=v;r.statsCollector.addLocalStats(y)}),r.assignLocalTracks(e,u),r.statsUploader.startUploadOutboundStats(),e.forEach(v=>{let{track:y,type:x}=v;const N=Date.now();r.store.publish(y.getTrackId(),x===_e.LocalAudioTrack?"audio":"video",void 0,N)})})()}async updateVideoStreamParameter(t,e){const r=this.localTrackMap.get(e);if(!r||!this.connection)return;if(!(r.track instanceof Zr))return C.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:n}=r,i=function(o,s){const c={};return o.height&&o.width&&(c.scaleResolutionDownBy=Hg(o,s)),c.maxFramerate=o.framerate?zi(o.framerate):void 0,c.maxBitrate=o.bitrate?1e3*o.bitrate:void 0,c}(t,n);if(n._encoderConfig||(n._encoderConfig={}),e!==_e.LocalVideoLowTrack||!st("DISABLE_DUAL_STREAM_USE_ENCODING")&&br().supportDualStreamEncoding)i.scaleResolutionDownBy!=null&&(n._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{const o=n._originMediaStreamTrack;if(!o.canvas)return C.warn("[".concat(n.getTrackId(),"] no canvas on track"));(function(s,c){const d=s.canvas;c.width&&(d.width=zi(c.width)),c.height&&(d.height=zi(c.height)),c.framerate&&(d.stopCapture&&d.stopCapture(),d.stopCapture=fg(()=>{!d.startCapture&&d.stopCapture&&d.stopCapture(),d.startCapture&&d.startCapture()},zi(c.framerate)))})(o,t)}i.maxBitrate!=null&&(n._encoderConfig.bitrateMax=i.maxBitrate/1e3),i.maxFramerate!=null&&(n._encoderConfig.frameRate&&typeof n._encoderConfig.frameRate=="object"?n._encoderConfig.frameRate.max=i.maxFramerate:n._encoderConfig.frameRate={max:i.maxFramerate}),C.debug("[".concat(n.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(n._encoderConfig))),await this.connection.updateRtpSenderEncodings(n)}publishLowStream(t){var e=this;return ho(function*(){if(!e.connection||e.state!==Mr.Connected)return;const r=yield Ar(e.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const i=e.localTrackMap.get(_e.LocalVideoTrack);if(!i)throw new Qt(et.UNEXPECTED_ERROR,"Could not find high stream");if(e.localTrackMap.has(_e.LocalVideoLowTrack))throw new Qt(et.UNEXPECTED_ERROR,"[".concat(e.store.clientId,"] Can't publish low stream when stream already publish"));const o=[{track:e.getLowVideoTrack(i.track,t),type:_e.LocalVideoLowTrack}];if(yield*up(zw(e.doPublish(e.connection,o))),i.track.muted||!i.track.enabled){var n;const s=(n=e.localTrackMap.get(_e.LocalVideoLowTrack))===null||n===void 0?void 0:n.id;s!==void 0&&(yield Ar(e.connection.muteLocal([s])))}}finally{r()}})()}async republish(){this.pendingLocalTracks.length>0&&(C.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ni(this,$e.RequestRePublish,this.pendingLocalTracks),this.emit($e.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(C.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await ni(this,$e.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){const{user:r,kind:n}=this.pendingRemoteTracks[e];(n!==Ue.AUDIO||r._audio_added_&&r._audioSSRC)&&(n!==Ue.VIDEO||r._video_added_&&r._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(t)await ni(this,$e.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:e,kind:r}of this.pendingRemoteTracks)await this.subscribe(e,r,r===Ue.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:r}=e;this.emit($e.MediaReconnectEnd,r.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==Mr.Connected)return void t.forEach(n=>{const i=this.pendingLocalTracks.indexOf(n);i!==-1&&this.pendingLocalTracks.splice(i,1)});const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const r=e.find(n=>n[0]==="videoLowTrack");return r&&r[1].track.close(),this.doUnpublish(this.connection,e)}async unpublishDataChannel(t){if(!this.connection||this.state!==Mr.Connected)return void t.forEach(r=>{const n=this.pendingLocalDataChannels.indexOf(r);n!==-1&&this.pendingLocalDataChannels.splice(n,1)});const e=this.filterTobeUnpublishedDataChannels(t);return e.length!==0?(e.forEach(r=>{const n=this.localDataChannels.indexOf(r);n!==-1&&this.localDataChannels.splice(n,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),e.map(r=>r.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Mr.Connected)return;const t=this.localTrackMap.get(_e.LocalVideoLowTrack);if(!t)return;t.track.close();const e=[[_e.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,e)}async doUnpublish(t,e){const r=this.createGatewayUnpublishMessage(e);return await t.stopSending(e.map(n=>{let[,{id:i}]=n;return i})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(n=>{let[i,{track:o}]=n;return{type:i,track:o}})),e.forEach(n=>{let[i]=n;this.statsCollector.removeLocalStats(i)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),r}async subscribeDataChannel(t,e){if(!this.connection||this.state!==Mr.Connected)throw new Qt(et.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const r=e.filter(n=>{var i;return!((i=this.remoteDataChannelMap.get(t))!==null&&i!==void 0&&i.get(n.id))});if(r.length!==0)return await this.connection.createDataChannels(t.uid,r),r.forEach(n=>{var i;this.remoteDataChannelMap.has(t)?(i=this.remoteDataChannelMap.get(t))===null||i===void 0||i.set(n.id,n):this.remoteDataChannelMap.set(t,new Map([[n.id,n]]));const o=this.pendingRemoteDataChannels.findIndex(s=>{let{user:c,id:d}=s;return c.uid===t.uid&&d===n.id});o!==-1&&this.pendingRemoteDataChannels.splice(o,1)}),r.map(n=>n.id)}async subscribe(t,e,r,n,i){var o;if(!this.connection||this.state!==Mr.Connected)throw new Qt(et.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((o=this.remoteUserMap.get(t))!==null&&o!==void 0&&o.has(e))return;let s,c,d,u;const l=this.connection.getPreMedia(r);if(l)C.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(r,", no need to send sub to gateway.")),d=l.transceiver,s=l.track,c=l.mid,u=l.player,l.firstVideoRender&&this.store.firstVideoFrameDecoded(t.uid,{firstPreRender:l.firstVideoRender});else if(i){const y=i.find(N=>{let{stream_type:L}=N;return L===e});if(!y)throw new Qt(et.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(e," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(e,"."));const x=await this.connection.receive(e,y.ssrcs,String(t._uintid),y.attributes);this.connection instanceof go&&(d=x.transceiver),s=x.track,c=x.id}else{const y=await this.connection.receive(e,[{ssrcId:r,rtx:n}],String(t._uintid),void 0);this.connection instanceof go&&(d=y.transceiver),s=y.track,c=y.id}if(e===Ue.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(s):(t._audioTrack=new Dd(s,t.uid,t._uintid,this.store),C.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),d&&t._audioTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(s):(t._videoTrack=new Pd(s,t.uid,t._uintid,this.store,u),C.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId())),t._videoTrack.once(mo.PLAY_START,()=>{this.store.firstVideoFrameDecoded(t.uid,{playStart:Date.now()})}),t._videoTrack.once(mo.PLAY_END,()=>{this.store.firstVideoFrameDecoded(t.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(t)}),u?t._videoTrack.once(mo.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(t.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(t)}):t._videoTrack.once(mo.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(t.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(t)})),d&&t._videoTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(t,t._videoTrack)),d&&st("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:y,interceptRemoteAudioFrame:x}=sf();e==Ue.VIDEO?await y(d.receiver,{onSei:st("ENABLE_VIDEO_SEI")&&(N=>{var L;return(L=t._videoTrack)===null||L===void 0?void 0:L._onSei(N)})}):e==Ue.AUDIO&&await x(d.receiver,{enableTopn:!!st("ENABLE_AUDIO_TOPN"),enableMetadata:!!st("ENABLE_AUDIO_METADATA"),enablePts:!!st("ENABLE_AUDIO_PTS"),onMetadata:N=>{this.safeEmit($e.AudioMetadata,N)},onPts:N=>{this.safeEmit($e.AudioPts,N)}})}const T=this.remoteUserMap.get(t);T?T.set(e,c):this.remoteUserMap.set(t,new Map([[e,c]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const v=this.pendingRemoteTracks.findIndex(y=>{let{user:x,kind:N}=y;return x.uid===t.uid&&e===N});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit($e.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==Mr.Connected)throw new Qt(et.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(i=>{var o;let{user:s,mediaType:c}=i;return!((o=this.remoteUserMap.get(s))!==null&&o!==void 0&&o.has(c))});const e=[],r=new Map;t.forEach(i=>{if(!this.connection)return;const o=this.connection.getPreMedia(i.ssrcId);if(o){const{track:s,mid:c,transceiver:d,player:u}=o;r.set(i.ssrcId,{track:s,id:c,transceiver:d,player:u})}else e.push(i)});const n=await this.connection.batchReceive(e.map(i=>{let{user:o,mediaType:s,ssrcId:c,rtxSsrcId:d}=i;return{kind:s,ssrcMsg:[{ssrcId:c,rtx:d}],mslabel:String(o._uintid)}}));e.forEach((i,o)=>{r.set(i.ssrcId,n[o])});for(const{user:i,mediaType:o,ssrcId:s}of t){const c=r.get(s);if(!c)return void C.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(i.uid," subscribe data,").concat(o,", ").concat(s));const{track:d,id:u,transceiver:l,player:T}=c;if(l&&st("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:x,interceptRemoteAudioFrame:N}=sf();o==Ue.VIDEO?await x(l.receiver,{onSei:st("ENABLE_VIDEO_SEI")&&(L=>{var Q;return(Q=i._videoTrack)===null||Q===void 0?void 0:Q._onSei(L)})}):o==Ue.AUDIO&&await N(l.receiver,{enableTopn:!!st("ENABLE_AUDIO_TOPN"),enableMetadata:!!st("ENABLE_AUDIO_METADATA"),enablePts:!!st("ENABLE_AUDIO_PTS"),onMetadata:L=>{this.safeEmit($e.AudioMetadata,L)},onPts:L=>{this.safeEmit($e.AudioPts,L)}})}if(o===Ue.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(d):(i._audioTrack=new Dd(d,i.uid,i._uintid,this.store),C.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),l&&i._audioTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(d):(i._videoTrack=new Pd(d,i.uid,i._uintid,this.store,T),C.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),l&&i._videoTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(i,i._videoTrack)),st("ENABLE_VIDEO_SEI")&&l){const{interceptRemoteVideoFrame:x,interceptRemoteAudioFrame:N}=sf();o==Ue.VIDEO?await x(l.receiver,{onSei:L=>{var Q;(Q=i._videoTrack)===null||Q===void 0||Q._onSei(L)}}):o==Ue.AUDIO&&await N(l.receiver)}const v=this.remoteUserMap.get(i);v?v.set(o,u):this.remoteUserMap.set(i,new Map([[o,u]])),this.statsCollector.addRemoteStats(i.uid),this.statsUploader.startUploadInboundStats();const y=this.pendingRemoteTracks.findIndex(x=>{let{user:N,kind:L}=x;return N.uid===i.uid&&o===L});y!==-1&&(this.pendingRemoteTracks.splice(y,1),this.emit($e.MediaReconnectEnd,i.uid))}}async unsubscribe(t,e,r){const n=this.pendingRemoteTracks.filter(s=>{let{user:c,kind:d}=s;return e!==void 0?c.uid===t.uid&&e===d:c.uid===t.uid});if(n.forEach(s=>{const c=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(c,1)}),this.connection&&this.state===Mr.Connected||r||n.forEach(s=>{let{kind:c}=s;var d;if(c===Ue.AUDIO)(d=t._audioTrack)===null||d===void 0||d._destroy(),t._audioTrack=void 0;else if(c===Ue.VIDEO){var u;(u=t._videoTrack)===null||u===void 0||u._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==Mr.Connected)return;const i=this.filterTobeUnSubscribedTracks(t,e);if(i.length===0)return;await this.connection.stopReceiving(i.map(s=>{let[,{id:c}]=s;return c}));const o=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(s=>{let[c,{kind:d}]=s;var u,l;if(d===Ue.VIDEO&&c._videoSSRC&&((u=this.connection)===null||u===void 0||u.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),d===Ue.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),r||((l=c._videoTrack)===null||l===void 0||l._destroy(),c._videoTrack=void 0);else if(d===Ue.AUDIO){var T;this.unbindRemoteTrackEvents(c._audioTrack),!r&&((T=c._audioTrack)===null||T===void 0||T._destroy(),c._audioTrack=void 0)}}),o}async unsubscribeDataChannel(t,e){if(e.forEach(i=>{const o=this.pendingRemoteDataChannels.findIndex(s=>s.id===i.id);o!==-1&&this.pendingRemoteDataChannels.splice(o,1)}),!this.connection)return;const r=this.filterTobeUnSubscribedDataChannels(t,e);if(r.length===0)return;e.forEach(i=>{i._close()});const n=this.remoteDataChannelMap.get(t);return r.forEach(i=>{n&&n.delete(i.id)}),n&&n.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),r.map(i=>i.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let e=[];for(const{user:i,mediaType:o}of t){const s=this.pendingRemoteTracks.filter(c=>{let{user:d,kind:u}=c;return o!==void 0?d.uid===i.uid&&o===u:d.uid===i.uid});s.forEach(c=>{const d=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(d,1)}),e=e.concat(s)}if(!this.connection||this.state!==Mr.Connected)return void e.forEach(i=>{let{user:o,kind:s}=i;var c;if(s===Ue.AUDIO)(c=o._audioTrack)===null||c===void 0||c._destroy(),o._audioTrack=void 0;else if(s===Ue.VIDEO){var d;(d=o._videoTrack)===null||d===void 0||d._destroy(),o._videoTrack=void 0}});const r=Ao(t).call(t,(i,o)=>{let{user:s,mediaType:c}=o;const d=this.filterTobeUnSubscribedTracks(s,c);return i.concat(d)},[]);if(r.length===0)return;await this.connection.stopReceiving(r.map(i=>{let[,{id:o}]=i;return o}));const n=this.createUnsubscribeAllMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(i=>{let[o,{kind:s}]=i;var c,d;if(s===Ue.VIDEO&&o._videoSSRC&&((c=this.connection)===null||c===void 0||c.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),s===Ue.VIDEO)this.unbindRemoteTrackEvents(o._videoTrack),(d=o._videoTrack)===null||d===void 0||d._destroy(),o._videoTrack=void 0;else if(s===Ue.AUDIO){var u;this.unbindRemoteTrackEvents(o._audioTrack),(u=o._audioTrack)===null||u===void 0||u._destroy(),o._audioTrack=void 0}}),n}isPreSubScribe(t){return!this.connection||this.state!==Mr.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,e){if(!this.connection)return;const r=this.remoteUserMap.get(t);if(!r)return void C.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!r.get(e))return void C.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const n=e===Ue.VIDEO?t._videoSSRC:t._audioSSRC;n!==void 0&&this.connection.setStatsRemoteVideoIsReady(n,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.connection)return;const r=this.remoteUserMap.get(t);if(!r)return void C.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));r.get(e)||C.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}addAudioMetadata(t){const e=this.localTrackMap.get(_e.LocalAudioTrack),r=e&&e.track;r&&r.metadata.push(t)}getAllTracks(t){const e=this.localTrackMap.get(_e.LocalAudioTrack);if(e?.track instanceof Nn){const r=e.track;return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return i!==_e.LocalAudioTrack}).filter(n=>{let[i]=n;return!(t&&i===_e.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(r=>{let[n]=r;return!(t&&n===_e.LocalVideoLowTrack)}).map(r=>{let[,{track:n}]=r;return n})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,e,r,n,i){if(t){const s=this.localTrackMap.get(_e.LocalAudioTrack),c=n?this.localTrackMap.get(_e.LocalVideoLowTrack):this.localTrackMap.get(_e.LocalVideoTrack);qe.publish(this.store.sessionId,{eventElapse:ui.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:s?.track.getTrackLabel(),videoName:c?.track.getTrackLabel(),screenshare:c?.track._hints.indexOf(Wr.SCREEN_TRACK)!==-1,audio:!!s,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var o;r||(r=[]);const s=r.find(d=>d instanceof Tn),c=n?(o=this.localTrackMap.get(_e.LocalVideoTrack))===null||o===void 0?void 0:o.track:r.find(d=>d instanceof Zr);qe.publish(this.store.sessionId,{eventElapse:ui.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:s?.getTrackLabel(),videoName:c?.getTrackLabel(),screenshare:c?._hints.indexOf(Wr.SCREEN_TRACK)!==-1,audio:!!s,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(t,e,r,n){const i=n===Ue.VIDEO?r._videoSSRC:r._audioSSRC;i&&qe.subscribe(this.store.sessionId,{succ:t,ec:e,video:n===Ue.VIDEO,audio:n===Ue.AUDIO,peerid:r.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:ui.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){C.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new si("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=mf(this.store),this.emit($e.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(_e.LocalAudioTrack);if(t?.track instanceof Nn){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(r=>{e.removeAudioTrack(r)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Mr.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.connection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(_e.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(_e.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof Zr||e&&e.track instanceof Tn?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(t);return!!r&&(!e||r.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(t);return!!r&&(!e||r.has(e))}getRemoteMedia(t){var e;const r=Array.from(Li(e=this.remoteUserMap).call(e)).find(n=>n.uid===t);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(r=>{let[n]=r;return{uid:n.uid,level:n.audioTrack?100*n.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(_e.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=tc(t).call(t,(r,n)=>r.level-n.level),t}async disconnectForReconnect(){this.connection&&(C.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Mr.Reconnecting,st("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var r;e._videoTrack&&e._videoTrack._player&&((r=e._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=mf(this.store),this.emit($e.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[r,{track:n}]=t;switch(r){case _e.LocalVideoTrack:Ce(e=n._hints).call(e,Wr.LOW_STREAM)?n.close():this.pendingLocalTracks.push(n);break;case _e.LocalAudioTrack:n instanceof Nn?this.pendingLocalTracks=this.pendingLocalTracks.concat(n.trackList):this.pendingLocalTracks.push(n);case _e.LocalVideoLowTrack:}}),this.emit($e.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,r]=t;Array.from(Li(r).call(r)).forEach(n=>{this.setPendingRemoteMedia(e,n)}),this.emit($e.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[e,r]=t;Array.from(Li(r).call(r)).forEach(n=>{this.setPendingRemoteDataChannel(e,n)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),C.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,e){for(const r of this.pendingRemoteDataChannels){const{user:n,id:i}=r;if((t instanceof Ma?t.uid:t)===n.uid&&i===e)return!0}return!1}setPendingRemoteDataChannel(t,e){this.hasPendingRemoteDataChannel(t,e)||this.pendingRemoteDataChannels.push({user:t,id:e})}hasPendingRemoteMedia(t,e){for(const r of this.pendingRemoteTracks){const{user:n,kind:i}=r;if((t instanceof Ma?t.uid:t)===n.uid&&e===i)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}restartICE(t){var e=this;return ho(function*(){if(!e.connection||e.state!==Mr.Connected)return;const r=yield Ar(e.mutex.lock("From P2PChannel.restartICE"));let n;try{n=yield Ar(e.connection.restartICE(t));const o=yield Ar(n.next());if(o.done)return;const s=o.value,c=yield s;switch(cT(e.connection)&&e.reportPCStats(Date.now(),!1,e._pcStatsUploadType),t){case di.UDP_TCP_RELAY:e._pcStatsUploadType=Js.UDP_TCP_RESTART;break;case di.TCP_RELAY:e._pcStatsUploadType=Js.TCP_RESTART;break;case di.RELAY:e._pcStatsUploadType=Js.RELAY_RESTART;break;default:e._pcStatsUploadType=Js.OLD_RESTART}e._isTryConnecting=!0,n.next(c)}catch(o){var i;(i=n)===null||i===void 0||i.throw(o)}finally{r()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),e=this.localTrackMap.get(_e.LocalVideoTrack),r=this.localTrackMap.get(_e.LocalAudioTrack),n=t.videoSend.find(y=>y.ssrc===e?.ssrcs[0].ssrcId),i=t.audioSend.find(y=>y.ssrc===r?.ssrcs[0].ssrcId);if(!n||!i)return 1;const o=$i(this,$e.NeedSignalRTT),s=n?n.rttMs:void 0,c=i?i.rttMs:void 0,d=s&&c?(s+c)/2:s||c,u=(d&&o?(d+o)/2:d||o)||0,l=100*t.sendPacketLossRate*.7/50+.3*u/1500,T=l<.17?1:l<.36?2:l<.59?3:l<.1?4:5,v=e?.track;if(v&&v._encoderConfig&&v._hints.indexOf(Wr.SCREEN_TRACK)===-1){const y=v._encoderConfig.bitrateMax,x=t.bitrate.actualEncoded;if(y&&x){const N=(1e3*y-x)/(1e3*y);return DO[N<.15?0:N<.3?1:N<.45?2:N<.6?3:4][T]}}return T}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[n]=r;const i=n._audioSSRC,o=n._videoSSRC,s=t.audioRecv.find(x=>x.ssrc===i),c=t.videoRecv.find(x=>x.ssrc===o);if(!s&&!c)return void(e+=1);const d=$i(this,$e.NeedSignalRTT),u=t.rtt,l=(u&&d?(u+d)/2:u||d)||0,T=s?s.jitterMs:void 0,v=t.recvPacketLossRate;let y=.7*v*100/50+.3*l/1500;T&&(y=.6*v*100/50+.2*l/1500+.2*T/400),e+=y<.1?1:y<.17?2:y<.36?3:y<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new De((e,r)=>{this.handleMuteLocalTrack(t,e,r)})}async replaceTrack(t,e){var r;if(C.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(e.getTrackId(),"]")),!this.connection||this.state!==Mr.Connected)return;const n=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:s}]=o;return t===s});if(!n)return;const i=n[0];if(t!==e&&(this.unbindLocalTrackEvents([{track:t,type:i}]),this.bindLocalTrackEvents([{track:e,type:i}]),n[1].track=e),await((r=this.connection)===null||r===void 0?void 0:r.replaceTrack(e,n[1].id)),this.isPlanB){const o=n[1];o.id=e._mediaStreamTrack.id,this.localTrackMap.set(i,o)}if(i===_e.LocalVideoTrack&&!st("DISABLE_DUAL_STREAM_USE_ENCODING")&&br().supportDualStreamEncoding){const o=this.localTrackMap.get(_e.LocalVideoLowTrack);if(o){const s=t._mediaStreamTrack.clone();o.track._originMediaStreamTrack.stop(),o.track._mediaStreamTrack=s,o.track._originMediaStreamTrack=s,await new De((c,d)=>{this.handleReplaceTrack(o.track,c,d,!0)})}}}filterTobePublishedTracks(t,e,r){const n=[],i=this.getAllTracks();t=gd(t=t.filter(d=>i.indexOf(d)===-1));let o,s=!1;const c=this.localTrackMap.get(_e.LocalAudioTrack);for(const d of t){if(d instanceof Zr&&(this.localTrackMap.has(_e.LocalVideoTrack)||s?new Qt(et.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(n.push({track:d,type:_e.LocalVideoTrack}),s=!0),e)){const u=this.getLowVideoTrack(d,r);n.push({track:u,type:_e.LocalVideoLowTrack})}if(d instanceof Tn)if(c){const u=c.track;if(u instanceof Nn)sT([d]),u.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0);else{const l=aT([u,d]);C.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(l.getTrackId(),"]")),this.replaceTrack(u,l)}}else o instanceof Nn?(sT([d]),o.addAudioTrack(d)):o||!d._useAudioElement&&br().webAudioMediaStreamDest&&!d._bypassWebAudio?o=aT(o?[d,o]:[d]):o=d}return o&&(C.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(o.getTrackId(),"]")),n.push({track:o,type:_e.LocalAudioTrack})),n}filterTobeUnpublishedTracks(t){const e=[],r=this.getAllTracks();t=gd(t=t.filter(n=>r.indexOf(n)!==-1));for(const n of t){if(n instanceof Tn){const i=this.localTrackMap.get(_e.LocalAudioTrack);if(!i)continue;i.track instanceof Nn?(i.track.removeAudioTrack(n),this.unbindLocalAudioTrackEvents(n),i.track.trackList.length===0&&(e.push([_e.LocalAudioTrack,i]),i.track.close())):e.push([_e.LocalAudioTrack,i])}if(n instanceof Zr){const i=this.localTrackMap.get(_e.LocalVideoTrack);if(!i)continue;e.push([_e.LocalVideoTrack,i]);const o=this.localTrackMap.get(_e.LocalVideoLowTrack);o&&e.push([_e.LocalVideoLowTrack,o])}}return e}filterTobePublishedDataChannels(t){return t=(t=gd(t)).filter(e=>this.localDataChannels.findIndex(r=>r.id===e.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=gd(t)).filter(e=>this.localDataChannels.indexOf(e)!==-1)).filter(e=>e._originDataChannel)}bindLocalTrackEvents(t){t.forEach(e=>{let{track:r,type:n}=e;switch(n){case _e.LocalVideoTrack:r.addListener(Ge.GET_STATS,this.handleGetLocalVideoStats),r.addListener(Ge.GET_RTC_STATS,this.handleGetRTCStats),r.addListener(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(Ge.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener(Ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener(Ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case _e.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case _e.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof Nn?t.trackList.forEach(r=>{r.addListener(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(Ge.GET_STATS,this.handleGetLocalAudioStats),r.addListener(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Ge.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||(t.addListener(Ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(Ge.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[r,{track:n}]=e;return{track:n,type:r}})),t.forEach(e=>{let{track:r,type:n}=e;switch(n){case _e.LocalVideoTrack:r.off(Ge.GET_STATS,this.handleGetLocalVideoStats),r.off(Ge.GET_RTC_STATS,this.handleGetRTCStats),r.off(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Ge.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off(Ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off(Ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case _e.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case _e.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Nn?t.trackList.forEach(e=>{e.off(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ge.GET_STATS,this.handleGetLocalAudioStats),e.off(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Ge.GET_STATS,this.handleGetLocalAudioStats),t.off(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Ge.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof Pd&&e.addListener(Ge.GET_STATS,r=>{r(this.handleGetRemoteVideoStats(t))}),e instanceof Dd&&e.addListener(Ge.GET_STATS,r=>{r(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Ge.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,r]=t;r.has(Ue.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),r.has(Ue.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((r,n)=>{var i;let o,s,{track:c,type:d}=r;switch(d){case _e.LocalAudioTrack:o=Ur.Audio,s={dtx:c instanceof rl&&c._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case _e.LocalVideoTrack:o=Ce(i=c._hints).call(i,Wr.SCREEN_TRACK)?Ur.Screen:Ur.High,s=Ns(Ns({},YO(c)),{},{codec:this.store.codec,svc_mode:tf()});break;case _e.LocalVideoLowTrack:o=Ur.Low,s=Ns(Ns({},YO(c)),{},{codec:this.store.codec,svc_mode:tf()})}return{stream_type:o,attributes:s,ssrcs:e[n]}})}createGatewayUnpublishMessage(t){return t.map(e=>{var r;let n,[i,{track:o,ssrcs:s,id:c}]=e;switch(i){case _e.LocalVideoTrack:n=Ce(r=o._hints).call(r,Wr.SCREEN_TRACK)?Ur.Screen:Ur.High;break;case _e.LocalAudioTrack:n=Ur.Audio;break;case _e.LocalVideoLowTrack:n=Ur.Low}return{stream_type:n,ssrcs:s,mid:c}})}assignLocalTracks(t,e){t.forEach((r,n)=>{let{track:i,type:o}=r;this.localTrackMap.set(o,{track:i,id:e[n].id,ssrcs:e[n].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[r]=e;this.localTrackMap.delete(r)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{if(C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit($e.PeerConnectionStateChange,e),e==="connecting"&&t instanceof go&&!mn()&&st("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{e==="connecting"&&t.extendCandidate()},st("FIRST_TCP_CANDIDATE_INTERVAL")),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof go&&Hw(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=Js.DISCONNECTED_OR_FAILED,$i(this,$e.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const r=this.pendingLocalTracks.map(i=>i.getTrackId()),n=this.pendingLocalDataChannels.map(i=>"dc_".concat(i.id));qe.reportApiInvoke(this.store.sessionId,{name:vn.REPUB_AFTER_PC_CONNECTED,options:r.concat(n),tag:cn.TRACER}).onSuccess(),this.republish()}if(st("NEW_ICE_RESTART")&&t instanceof go&&!mn()&&!this._forceTurn){if(Ce(GO).call(GO,e)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const r=i=>{cT(t)&&(C.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(i)),$i(this,$e.QueryClientConnectionState)==="CONNECTED"&&this.emit($e.RequestRestartICE,i))},n=()=>{cT(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),C.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit($e.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{Ww(t,r,n)},800))}}else{if(e==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&st("ICE_RESTART")&&$i(this,$e.QueryClientConnectionState)==="CONNECTED"&&this.emit($e.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(C.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit($e.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);e==="failed"&&(C.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit($e.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),qe.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:cn.TRACER}).onSuccess(),this.emit($e.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var r;const n=Array.from(Li(r=this.remoteUserMap).call(r)).find(o=>o._audioSSRC===e);var i;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),(i=n.audioTrack)===null||i===void 0||i.emit(mo.FIRST_FRAME_DECODED),qe.firstRemoteFrame(this.store.sessionId,Un.FIRST_AUDIO_DECODE,nn.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:ui.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var r;const n=Array.from(Li(r=this.remoteUserMap).call(r)).find(i=>i._audioSSRC===e);n&&qe.firstRemoteFrame(this.store.sessionId,Un.FIRST_AUDIO_RECEIVED,nn.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:ui.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,r,n)=>{var i;const o=Array.from(Li(i=this.remoteUserMap).call(i)).find(s=>s._videoSSRC===e);o&&this.store.firstVideoFrameDecoded(o.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(e,r,n)},t.onFirstVideoRender=e=>{var r;const n=Array.from(Li(r=this.remoteUserMap).call(r)).find(i=>i._videoSSRC===e);n&&(this.store.firstVideoFrameDecoded(n.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(n))},t.onFirstVideoReceived=e=>{var r;const n=Array.from(Li(r=this.remoteUserMap).call(r)).find(i=>i._videoSSRC===e);n&&(this.store.firstVideoFrameDecoded(n.uid,{firstReceived:Date.now()}),qe.firstRemoteFrame(this.store.sessionId,Un.FIRST_VIDEO_RECEIVED,nn.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:ui.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onSelectedLocalCandidateChanged=(e,r)=>{const n=e.candidateType==="relay",i=r.candidateType==="relay";r.candidateType!=="unknown"&&n===i||this.emit($e.ConnectionTypeChange,n),C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Na(r))," -> ").concat(JSON.stringify(Na(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,r)=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Na(r))," -> ").concat(JSON.stringify(Na(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),r=this.statsCollector.getRTCStats();return Ns(Ns({},e),r)},t.onICECandidateError=e=>{this._iceError=e}}resetConnection(t){t instanceof go&&function(e){Kd.delete(e.id),Hw(e)}(t),t.close(),this.emit($e.PeerConnectionStateChange,"closed"),function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const r=this.localTrackMap.get(_e.LocalAudioTrack);if(t instanceof Tn&&r?.track instanceof Nn)return r.track.isActive||e.push([_e.LocalAudioTrack,r]),e;const n=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:o}]=i;return t===o});if(n&&(e.push(n),n[0]===_e.LocalVideoTrack)){const i=this.localTrackMap.get(_e.LocalVideoLowTrack);i&&e.push([_e.LocalVideoLowTrack,i])}return e}filterTobeUnmutedTracks(t){const e=[],r=this.localTrackMap.get(_e.LocalAudioTrack);if(t instanceof Tn&&r?.track instanceof Nn)return r.track.isActive&&e.push([_e.LocalAudioTrack,r]),e;const n=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:o}]=i;return t===o});if(n)if(n[0]===_e.LocalVideoTrack){e.push(n);const i=this.localTrackMap.get(_e.LocalVideoLowTrack);i&&e.push([_e.LocalVideoLowTrack,i])}else e.push(n);return e}createMuteMessage(t){return t.map(e=>{var r;let n,[i,{track:o,ssrcs:s,id:c}]=e;switch(i){case _e.LocalAudioTrack:n=Ur.Audio;break;case _e.LocalVideoTrack:n=Ce(r=o._hints).call(r,Wr.SCREEN_TRACK)?Ur.Screen:Ur.High;break;case _e.LocalVideoLowTrack:n=Ur.Low}return{stream_type:n,ssrcs:s,mid:c}})}createUnmuteMessage(t){return t.map(e=>{var r;let n,[i,{track:o,ssrcs:s,id:c}]=e;switch(i){case _e.LocalAudioTrack:n=Ur.Audio;break;case _e.LocalVideoTrack:n=Ce(r=o._hints).call(r,Wr.SCREEN_TRACK)?Ur.Screen:Ur.High;break;case _e.LocalVideoLowTrack:n=Ur.Low}return{stream_type:n,ssrcs:s,mid:c}})}filterTobeUnSubscribedTracks(t,e){const r=[],n=this.remoteUserMap.get(t);if(!n)return r;if(e){const i=n.get(e);if(!i)return r;r.push([t,{kind:e,id:i}])}else Array.from(n.entries()).forEach(i=>{let[o,s]=i;r.push([t,{kind:o,id:s}])});return r}filterTobeUnSubscribedDataChannels(t,e){const r=[];return e.forEach(n=>{var i;(i=this.remoteDataChannelMap.get(t))!==null&&i!==void 0&&i.has(n.id)&&r.push(n)}),r}createUnsubscribeMessage(t){const e=[];return t.forEach(r=>{let[n,{kind:i,id:o}]=r;switch(i){case Ue.VIDEO:return void(n._videoSSRC&&e.push({stream_type:Ue.VIDEO,ssrcId:n._videoSSRC}));case Ue.AUDIO:return void(n._audioSSRC&&e.push({stream_type:Ue.AUDIO,ssrcId:n._audioSSRC}))}}),e}createUnsubscribeAllMessage(t){const e=new Map;return t.forEach(r=>{let[n,{kind:i}]=r;if(e.has(n)){let o=e.get(n);i===Ue.VIDEO?o|=jn.Video:o|=jn.Audio,e.set(n,o)}else i===Ue.VIDEO?e.set(n,jn.Video):e.set(n,jn.Audio)}),{users:Array.from(e.entries()).map(r=>{let[n,i]=r;return{stream_id:n.uid,stream_type:i}})}}withdrawRemoteTracks(t){t.forEach(e=>{let[r,{kind:n}]=e;const i=this.remoteUserMap.get(r);i&&(i.delete(n),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(r))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(_e.LocalVideoTrack),r=this.localTrackMap.get(_e.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(t.uplink),await new De((n,i)=>{this.handleUpdateVideoEncoder(e.track,n,i,!0)})),r&&t.low_stream_uplink&&(await r.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new De((n,i)=>{this.handleUpdateVideoEncoder(r.track,n,i,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof go&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof go&&this.connection.isPreSub()}mapPubResToRemoteConfig(t,e,r){return t.map((n,i)=>{var o;let{stream_type:s}=n;const c=(o=e.find(d=>{let{stream_type:u}=d;return s===u}))===null||o===void 0?void 0:o.attributes;if(c&&st("DISABLE_SCREEN_SHARE_REMB")){const d=r[i]._hints;(Ce(d).call(d,Wr.SCREEN_TRACK)||Ce(d).call(d,Wr.SCREEN_LOW_TRACK))&&(c.remb=!1,C.debug("disable remb for screen share, hints:",d))}return c})}async tryToUnmuteAudio(t){for(let r=0;r<t.length;r++)if(t[r]instanceof Tn){var e;const n=this.filterTobeUnmutedTracks(t[r]);if(n.length===0)continue;await((e=this.connection)===null||e===void 0?void 0:e.unmuteLocal(n.map(o=>{let[,{id:s}]=o;return s})));const i=this.createUnmuteMessage(n);return void await Kr(this,$e.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.connection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit($e.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit($e.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Yn(qE(this.dtlsFailedCount,bn)),this.emit($e.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),e=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),e.length>0&&await ni(this,$e.RequestUnpublishForReconnectPC,e),this.disconnectForReconnect(),this.emit($e.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(_e.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Zr)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof Zr).length>1)throw new Qt(et.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof Tn).length>1&&(t.some(e=>e instanceof Tn&&e._bypassWebAudio)||!br().webAudioMediaStreamDest))throw new Qt(et.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof Zr&&this.pendingLocalTracks.some(r=>r instanceof Zr))throw new Qt(et.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof Tn&&this.pendingLocalTracks.some(r=>r instanceof Tn)&&(!br().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(r=>r instanceof Tn&&r._bypassWebAudio)))throw new Qt(et.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){var r;const n=!st("DISABLE_DUAL_STREAM_USE_ENCODING")&&br().supportDualStreamEncoding,i=Ns(Ns({},{width:160,height:120,framerate:15,bitrate:50}),e);let o;o=n?t._mediaStreamTrack.clone():dT(t,i);const s=zr(8,"track-low-"),c=new Zr(o,Ns(Ns({},n&&{scaleResolutionDownBy:Hg(i,t)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,s);return c.on(pc.TRANSCEIVER_UPDATED,d=>{t._updateRtpTransceiver(d,Cd.LOW_STREAM)}),c._hints.push(Wr.LOW_STREAM),Ce(r=t._hints).call(r,Wr.SCREEN_TRACK)&&c._hints.push(Wr.SCREEN_LOW_TRACK),t.on("sei-to-send",d=>{c.emit("sei-to-send",d)}),t.addListener(Ge.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof go){var i,o,s,c;const d=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:u,dtlsTransportState:l,peerConnectionState:T}=this.connection,{local:v,remote:y}=await this.connection.getSelectedCandidatePair();qe.pcStats(this.store.sessionId,{startTime:d,eventElapse:t-d||0,iceconnectionsate:u,dtlsstate:l,connectionstate:T,intSucc:e?1:2,error:this._iceError||n||"",selectedLocalCandidateProtocol:(i=v?.protocol)!==null&&i!==void 0?i:"",selectedLocalCandidateType:(o=v.candidateType)!==null&&o!==void 0?o:"",selectedLocalCandidateAddress:"".concat(v.address,":").concat(v.port),selectedRemoteCandidateProtocol:(s=y.protocol)!==null&&s!==void 0?s:"",selectedRemoteCandidateType:(c=y.candidateType)!==null&&c!==void 0?c:"",selectedRemoteCandidateAddress:"".concat(y.address,":").concat(y.port),restartCnt:r,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(t){const e=this.store.keyMetrics,r=e.firstVideoFrameDecoded.find(l=>l.userId===t.uid);if(!r)return;const{isInternalUpload:n,isExternalUpload:i}=r;if(n&&i)return;const{subscribeEnd:o,firstPreRender:s,peerPublishDuration:c,peerPubStatusMs:d}=r;let{firstRender:u=0}=r;if(o&&(u||s)&&c&&d){r.isInternalUpload=!0;const{playEnd:l}=r;l&&(r.isExternalUpload=!0);const{firstPreRender:T=0}=r;u=T||u;const v=t.videoTrack,y={peer:t._uintid,width:v?._videoWidth||0,height:v?._videoHeight||0,ssrc:t._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:c,peerPubStatusMs:d,joinChannelStart:e.joinStart||0,preloadStart:e.preloadStart||0,preloadEnd:e.preloadEnd||0,apStart:e.requestAPStart||0,apEnd:e.requestAPEnd||0,suaEnd:e.requestSUAEnd||0,beforeConnect:e.beforeConnect||0,peerReceiver:e.peerReceiver||0,ice:e.iceConnectionEnd||0,pc:e.peerConnectionEnd||0,signalConnected:e.signalConnected||0,joinReq:e.joinReq||0,joinRes:e.joinRep||0,userJoinNotify:r.userJoinNotify||0,videoAddNotify:r.videoAddNotify||0,subscribeStart:r.subscribeStart||0,subscribeEnd:r.subscribeEnd||0,firstReceived:r.firstReceived||0,firstDecoded:r.firstDecoded||0,firstPreRender:T||0,firstRender:l?Math.max(u,l):Math.max(u,o),playStart:r.playStart||0,playEnd:r.playEnd||0,isPreSub:!(!t._videoSSRC||!this.isPreSubScribe(t._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:gA(this.store)};qe.firstXLAPeerFirstVideoFrame(this.store.sessionId,y)}}reportVideoFirstFrameDecoded(t,e,r,n){var i;const o=Array.from(Li(i=this.remoteUserMap).call(i)).find(s=>s._videoSSRC===t);if(o){n||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const s=this.store.keyMetrics,c=s.subscribe.find(d=>d.userId===o.uid&&d.type==="video");qe.firstRemoteVideoDecode(this.store.sessionId,Un.FIRST_VIDEO_DECODE,nn.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:e,videoheight:r,subscribeElapse:ui.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:s.requestAPEnd||0,apStart:s.requestAPStart||0,joinGwEnd:s.joinGatewayEnd||0,joinGwStart:s.joinGatewayStart||0,pcEnd:s.peerConnectionEnd||0,pcStart:s.peerConnectionStart||0,subscriberEnd:c?.subscribeEnd||0,subscriberStart:c?.subscribeStart||0,videoAddNotify:c?.streamAdded||0,state:n?1:0,firstFrame:c?.firstFrame||0})}}async remoteMediaSsrcChanged(t,e,r){if(!this.connection)return!1;const n=this.remoteUserMap.get(t);if(!n)return!1;const i=n.get(e);if(!i)return!1;const o=await this.connection.getRemoteSSRC(i);return o!==void 0&&o!==r}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:r}]=t;e===_e.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,Cd.LOW_STREAM):r._updateRtpTransceiver(void 0)})}},Ke(Tr.prototype,"startP2PConnection",[Ti],Object.getOwnPropertyDescriptor(Tr.prototype,"startP2PConnection"),Tr.prototype),Ke(Tr.prototype,"connect",[Ti],Object.getOwnPropertyDescriptor(Tr.prototype,"connect"),Tr.prototype),Ke(Tr.prototype,"updateRemoteRTPCapabilities",[Ti],Object.getOwnPropertyDescriptor(Tr.prototype,"updateRemoteRTPCapabilities"),Tr.prototype),Ke(Tr.prototype,"publishDataChannel",[Ti],Object.getOwnPropertyDescriptor(Tr.prototype,"publishDataChannel"),Tr.prototype),Ke(Tr.prototype,"unpublish",[Ti],Object.getOwnPropertyDescriptor(Tr.prototype,"unpublish"),Tr.prototype),Ke(Tr.prototype,"unpublishDataChannel",[Ti],Object.getOwnPropertyDescriptor(Tr.prototype,"unpublishDataChannel"),Tr.prototype),Ke(Tr.prototype,"unpublishLowStream",[Ti],Object.getOwnPropertyDescriptor(Tr.prototype,"unpublishLowStream"),Tr.prototype),Ke(Tr.prototype,"subscribeDataChannel",[Ti],Object.getOwnPropertyDescriptor(Tr.prototype,"subscribeDataChannel"),Tr.prototype),Ke(Tr.prototype,"subscribe",[Ti],Object.getOwnPropertyDescriptor(Tr.prototype,"subscribe"),Tr.prototype),Ke(Tr.prototype,"massSubscribe",[Ti],Object.getOwnPropertyDescriptor(Tr.prototype,"massSubscribe"),Tr.prototype),Ke(Tr.prototype,"unsubscribe",[Ti],Object.getOwnPropertyDescriptor(Tr.prototype,"unsubscribe"),Tr.prototype),Ke(Tr.prototype,"unsubscribeDataChannel",[Ti],Object.getOwnPropertyDescriptor(Tr.prototype,"unsubscribeDataChannel"),Tr.prototype),Ke(Tr.prototype,"massUnsubscribe",[Ti],Object.getOwnPropertyDescriptor(Tr.prototype,"massUnsubscribe"),Tr.prototype),Ke(Tr.prototype,"muteRemote",[Ti],Object.getOwnPropertyDescriptor(Tr.prototype,"muteRemote"),Tr.prototype),Ke(Tr.prototype,"unmuteRemote",[Ti],Object.getOwnPropertyDescriptor(Tr.prototype,"unmuteRemote"),Tr.prototype),Ke(Tr.prototype,"hasRemoteMediaWithLock",[Ti],Object.getOwnPropertyDescriptor(Tr.prototype,"hasRemoteMediaWithLock"),Tr.prototype),Ke(Tr.prototype,"disconnectForReconnect",[Ti],Object.getOwnPropertyDescriptor(Tr.prototype,"disconnectForReconnect"),Tr.prototype),Ke(Tr.prototype,"updateBitrateLimit",[Ti],Object.getOwnPropertyDescriptor(Tr.prototype,"updateBitrateLimit"),Tr.prototype),Ke(Tr.prototype,"remoteMediaSsrcChanged",[Ti],Object.getOwnPropertyDescriptor(Tr.prototype,"remoteMediaSsrcChanged"),Tr.prototype),Tr);function Ti(t,e,r){const n=t[e];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const i=this.mutex,o=await i.lock("From P2PChannel.".concat(e));try{for(var s=arguments.length,c=new Array(s),d=0;d<s;d++)c[d]=arguments[d];return await n.apply(this,c)}finally{o()}},r}function qw(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Yw(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?qw(Object(r),!0).forEach(function(n){G(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):qw(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}const ZH=Date.now(),QH=20,lT=new Map,vf=new Map;async function Xw(t){const e=lT.get(t),r=Array.isArray(e)&&e[e.length-1],n=vf.get(t);if(!r)return void(n.isSyncing=!1);const i={uid:r.uid,payload:r.payload};n.firstRecvTs===0&&(n.firstRecvTs=r.recvTs,n.firstSendTs=r.sendTs);const o=r.sendTs-n.firstSendTs,s=o-(Date.now()-n.firstRecvTs);s>0&&(n.firstRecvTs=Date.now()-o);let c=r.mediaDelay+s;c<=0?(e.pop(),Jw(r.context,i),c=0):c=Math.min(c,QH),setTimeout(()=>e.length&&Xw(t),c)}function Jw(t,e){t.safeEmit(vr.STREAM_MESSAGE,e.uid,e.payload),t.onStreamMessage&&t.onStreamMessage(e)}function $H(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return Jw(r,{uid:t.uid,payload:t.payload});const n="".concat(r.id,"-").concat(t.uid),i=lT.get(n)||[],o=i.findIndex(u=>t.sendTs>=u.sendTs),s=Yw(Yw({},t),{},{context:r,mediaDelay:e,recvTs:Date.now()});o===-1?i.push(s):i.splice(o,0,s),lT.set(n,i);let c=!1;var d;vf.has(n)?c=!((d=vf.get(n))===null||d===void 0||!d.isSyncing):vf.set(n,{isSyncing:c,firstRecvTs:0,firstSendTs:0}),c||Xw(n)}const t8=Rr().name;function Zw(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Qw(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Zw(Object(r),!0).forEach(function(n){G(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Zw(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}const zd="websdk_ng_cache_parameter",e8=st("MAX_PRELOAD_ASYNC_LENGTH"),r8=1e4,Rc=new Map,Ic=[];let hT=null,pT=0,fT=0;const yf=new Map,n8=function(t,e){const r=[];let n=0;const i=async()=>{const o=r.shift();o&&await o(),r.length>0&&n<e?i():n--};return async function(){for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];return new De(async(d,u)=>{r.push(async()=>{try{const l=await t(...s);d(l)}catch(l){u(l)}}),n<e&&(n++,i())})}}($w,e8),mT=bi.CancelToken.source();async function $w(t,e,r,n,i,o){try{if(!st("ENABLE_PRELOAD"))return;if(!br().supportWebCrypto)return void Ra(()=>{C.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!r&&r!==null)throw new Qt(et.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&qn(r,"token",1,2047),qn(t,"appid",1,2047),Yp(e),n&&Xp(n);const s=lc();C.debug("preload channel ".concat(e,", uid is ").concat(n));const c={appId:t,cname:e,token:r||t,uid:typeof n!="string"?n:null,sid:s,proxyServer:i};let d,u;typeof n=="string"?(c.stringUid=n,[u,d]=await De.all([BH(n,{sid:s,appId:t},mT.token),Cw(Qw(Qw({},c),{},{token:r||t,uid:0}),mT.token)]),c.uid=u.uid,d.gatewayInfo.uid=c.uid,d.gatewayInfo.res.uid=c.uid):(o&&(c.stringUid=o),d=await Cw(c,mT.token));const l={sid:s,appId:t,cname:e,token:r||t,uid:c.stringUid||n,intUid:c.uid||d.gatewayInfo.uid,stringUid:c.stringUid,ts:Date.now(),sua:u,ap:d};await async function(T){let v;try{T.uid&&eN({appId:T.appId,cname:T.cname,token:T.token,uid:T.uid,stringUid:T.stringUid});const y=oN(T),x=await async function(L,Q){try{const J=await window.crypto.subtle.importKey("raw",K0(Q),"AES-GCM",!1,["encrypt"]),at=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},J,uc(window.btoa(JSON.stringify(L))));return Ia(new Uint8Array(at))}catch{return}}(T,T.token||T.appId);if(!x)return;v=iN(zd);const N=v?JSON.parse(v):[];N.push({[y]:x}),N.length>st("AP_CACHE_NUM")&&N.shift(),Sf(zd,JSON.stringify(N))}catch(y){C.warn("Error caching server parameters:",y.message),Sf(zd,"")}}(l),pT++}catch(s){throw fT++,function(c){hT||(hT=window.setTimeout(()=>{let u="";yf.forEach((l,T)=>{u+="".concat(T,": ").concat(l," ;")}),qe.reportApiInvoke(null,{name:vn.PRELOAD,options:{success:pT,failed:fT,err:u}}).onError(c),pT=0,fT=0,yf.clear(),hT=null},r8));const d=yf.get(c.code)||0;yf.set(c.code,d+1)}(s),s}}async function tN(t){try{if(st("AP_REQUEST_DETAIL")||st("ENABLE_ROLE_SELECT_EDGE"))return;const e=eN(t);if(!e||t.cloudProxyServer!=="disabled")return;const r=await async function(n,i){try{const o=await window.crypto.subtle.importKey("raw",K0(i),"AES-GCM",!1,["decrypt"]),s=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},o,uc(n));return JSON.parse(window.atob(Ia(new Uint8Array(s))))}catch{return}}(e,t.token||t.appId);if(!r||!function(n,i){return n.cname===i.cname&&n.appId===i.appId&&n.token===i.token?i.stringUid?n.stringUid===i.stringUid:typeof i.uid=="number"?n.uid===i.uid:n.uid==i.uid:!1}(r,t))return;if(r&&Date.now()-r.ts<st("AP_CACHE_LIFETIME"))return r}catch(e){C.warn("Error get preloadInfo",e.message)}}function eN(t){let e;try{if(e=iN(zd),!e)return;const r=JSON.parse(e),n=oN(t),i=function(s,c){for(let d=s.length-1;d>=0;d--)if(c(s[d]))return d;return-1}(r,s=>n in s);if(i===-1)return;const o=r.splice(i,1)[0];return Sf(zd,JSON.stringify(r)),o[n]}catch(r){C.warn("Error delete preload info: ".concat(e),r.message),Sf(zd,"")}}function _T(t){if(t){let e=Rc.get(t);e&&(window.clearTimeout(e),e=null,Rc.delete(t)),Ce(Ic).call(Ic,t)||t.cloudProxyServer!=="disabled"||Ic.push(t)}if(Rc.size<st("AP_CACHE_NUM")&&Ic.length>0){const e=Ic.shift();Rc.set(e,window.setTimeout(async()=>{const{appId:r,cname:n,token:i,stringUid:o,uid:s,proxyServer:c}=e;try{await n8(r,n,i,s,c,o),Rc.has(e)&&_T(e)}catch(d){C.warn("update preload failed",d.message),rN(e)}},st("AP_UPDATE_INTERVAL")))}}function rN(t){const e=Ic.indexOf(t);e!==-1&&Ic.splice(e,1);let r=Rc.get(t);r&&(window.clearTimeout(r),r=null,Rc.delete(t),_T())}function nN(t,e){const r=t.sua,n=t.ap;e&&r&&qe.reqUserAccount(t.sid,{lts:r.requestTime,elapse:r.elapse,success:!0,serverAddr:r.url,stringUid:e,uid:t.intUid,errorCode:null,extend:r.req}),qe.reportResourceTiming(t.ap.url,t.sid),qe.joinWebProxyAP(t.sid,{lts:n.requestTime,elapse:n.elapse,sucess:1,apServerAddr:n.url,turnServerAddrList:n.proxyInfo.addresses.map(i=>i.ip).join(","),eventType:"disabled",unilbsServerIds:[Cn.CHOOSE_SERVER,Cn.CLOUD_PROXY_FALLBACK].toString()}),qe.joinChooseServer(t.sid,{lts:n.requestTime,elapse:n.elapse,succ:!0,csAddr:n.url,opid:n.opid,serverList:n.gatewayInfo.gatewayAddrs.map(i=>i.address),ec:null,cid:n.gatewayInfo.cid.toString(),uid:n.gatewayInfo.uid.toString(),csIp:n.gatewayInfo.csIp,unilbsServerIds:[Cn.CHOOSE_SERVER].toString(),isHttp3:n.isHttp3})}function iN(t){return window.atob(window.localStorage.getItem(t)||"")}function Sf(t,e){window.localStorage.setItem(t,window.btoa(e))}function oN(t){let e="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(e+="_s_".concat(t.uid)),typeof t.uid=="number"&&(e+="_".concat(t.uid)),t.token&&(e+="_".concat(t.token)),Q0(e)}function i8(t){let e=function(){const r=a8.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(r,n){let i=r.appId;i!==void 0&&(An(n,10),xa(n,i));let o=r.cid;o!==void 0&&(An(n,16),An(n,o));let s=r.cname;s!==void 0&&(An(n,26),xa(n,s));let c=r.deviceId;c!==void 0&&(An(n,34),xa(n,c));let d=r.elapse;d!==void 0&&(An(n,40),Va(n,d));let u=r.fileSize;u!==void 0&&(An(n,48),Va(n,qd(u)));let l=r.height;l!==void 0&&(An(n,56),Va(n,qd(l)));let T=r.jpg;T!==void 0&&(An(n,66),An(n,T.length),aN(n,T));let v=r.networkType;v!==void 0&&(An(n,72),Va(n,qd(v)));let y=r.osType;y!==void 0&&(An(n,80),Va(n,qd(y)));let x=r.requestId;x!==void 0&&(An(n,90),xa(n,x));let N=r.sdkVersion;N!==void 0&&(An(n,98),xa(n,N));let L=r.sequence;L!==void 0&&(An(n,104),Va(n,qd(L)));let Q=r.sid;Q!==void 0&&(An(n,114),xa(n,Q));let J=r.timestamp;J!==void 0&&(An(n,120),Va(n,J));let at=r.uid;at!==void 0&&(An(n,128),An(n,at));let Rt=r.vid;Rt!==void 0&&(An(n,136),An(n,Rt));let vt=r.width;vt!==void 0&&(An(n,144),Va(n,qd(vt)));let pt=r.service;pt!==void 0&&(An(n,152),An(n,pt));let kt=r.callbackData;kt!==void 0&&(An(n,162),An(n,kt.length),aN(n,kt));let $t=r.ticket;$t!==void 0&&(An(n,170),xa(n,$t));let se=r.vendorConfigs;se!==void 0&&(An(n,178),xa(n,se))}(t,e),function(r){let n=r.bytes,i=r.limit;return n.length===i?n:n.subarray(0,i)}(e)}function o8(t){return function(r){let n={};t:for(;!c8(r);){let i=El(r);switch(i>>>3){case 0:break t;case 1:n.code=El(r);break;case 2:n.msg=cN(r,El(r));break;case 3:n.requestId=cN(r,El(r));break;case 4:n.timestamp=d8(r,!1);break;default:s8(r,7&i)}}return n}({bytes:e=t,offset:0,limit:e.length});var e}function s8(t,e){switch(e){case 0:for(;128&Fo(t););break;case 2:ET(t,El(t));break;case 5:ET(t,4);break;case 1:ET(t,8);break;default:throw new Error("Unimplemented type: "+e)}}function qd(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let a8=[];function ET(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function c8(t){return t.offset>=t.limit}function Rf(t,e){let r=t.bytes,n=t.offset,i=t.limit,o=n+e;if(o>r.length){let s=new Uint8Array(2*o);s.set(r),t.bytes=s}return t.offset=o,o>i&&(t.limit=o),n}function sN(t,e){let r=t.offset;if(r+e>t.limit)throw new Error("Read past limit");return t.offset+=e,r}function aN(t,e){let r=Rf(t,e.length);t.bytes.set(e,r)}function cN(t,e){let r=sN(t,e),n=String.fromCharCode,i=t.bytes,o="ï¿½",s="";for(let c=0;c<e;c++){let d,u,l,T,v=i[c+r];128&v?(224&v)==192?c+1>=e?s+=o:(d=i[c+r+1],(192&d)!=128?s+=o:(T=(31&v)<<6|63&d,T<128?s+=o:(s+=n(T),c++))):(240&v)==224?c+2>=e?s+=o:(d=i[c+r+1],u=i[c+r+2],(49344&(d|u<<8))!=32896?s+=o:(T=(15&v)<<12|(63&d)<<6|63&u,T<2048||T>=55296&&T<=57343?s+=o:(s+=n(T),c+=2))):(248&v)==240?c+3>=e?s+=o:(d=i[c+r+1],u=i[c+r+2],l=i[c+r+3],(12632256&(d|u<<8|l<<16))!=8421504?s+=o:(T=(7&v)<<18|(63&d)<<12|(63&u)<<6|63&l,T<65536||T>1114111?s+=o:(T-=65536,s+=n(55296+(T>>10),56320+(1023&T)),c+=3))):s+=o:s+=n(v)}return s}function xa(t,e){let r=e.length,n=0;for(let s=0;s<r;s++){let c=e.charCodeAt(s);c>=55296&&c<=56319&&s+1<r&&(c=(c<<10)+e.charCodeAt(++s)-56613888),n+=c<128?1:c<2048?2:c<65536?3:4}An(t,n);let i=Rf(t,n),o=t.bytes;for(let s=0;s<r;s++){let c=e.charCodeAt(s);c>=55296&&c<=56319&&s+1<r&&(c=(c<<10)+e.charCodeAt(++s)-56613888),c<128?o[i++]=c:(c<2048?o[i++]=c>>6&31|192:(c<65536?o[i++]=c>>12&15|224:(o[i++]=c>>18&7|240,o[i++]=c>>12&63|128),o[i++]=c>>6&63|128),o[i++]=63&c|128)}}function Fo(t){return t.bytes[sN(t,1)]}function dN(t,e){let r=Rf(t,1);t.bytes[r]=e}function El(t){let e,r=0,n=0;do e=Fo(t),r<32&&(n|=(127&e)<<r),r+=7;while(128&e);return n}function An(t,e){for(e>>>=0;e>=128;)dN(t,127&e|128),e>>>=7;dN(t,e)}function d8(t,e){let r,n=0,i=0,o=0;return r=Fo(t),n=127&r,128&r&&(r=Fo(t),n|=(127&r)<<7,128&r&&(r=Fo(t),n|=(127&r)<<14,128&r&&(r=Fo(t),n|=(127&r)<<21,128&r&&(r=Fo(t),i=127&r,128&r&&(r=Fo(t),i|=(127&r)<<7,128&r&&(r=Fo(t),i|=(127&r)<<14,128&r&&(r=Fo(t),i|=(127&r)<<21,128&r&&(r=Fo(t),o=127&r,128&r&&(r=Fo(t),o|=(127&r)<<7))))))))),{low:n|i<<28,high:i>>>4|o<<24,unsigned:e}}function Va(t,e){let r=e.low>>>0,n=(e.low>>>28|e.high<<4)>>>0,i=e.high>>>24,o=i===0?n===0?r<16384?r<128?1:2:r<1<<21?3:4:n<16384?n<128?5:6:n<1<<21?7:8:i<128?9:10,s=Rf(t,o),c=t.bytes;switch(o){case 10:c[s+9]=i>>>7&1;case 9:c[s+8]=o!==9?128|i:127&i;case 8:c[s+7]=o!==8?n>>>21|128:n>>>21&127;case 7:c[s+6]=o!==7?n>>>14|128:n>>>14&127;case 6:c[s+5]=o!==6?n>>>7|128:n>>>7&127;case 5:c[s+4]=o!==5?128|n:127&n;case 4:c[s+3]=o!==4?r>>>21|128:r>>>21&127;case 3:c[s+2]=o!==3?r>>>14|128:r>>>14&127;case 2:c[s+1]=o!==2?r>>>7|128:r>>>7&127;case 1:c[s]=o!==1?128|r:127&r}}const uN={},lN={},If=4294967296,u8=If*If,hN=u8/2;fN(0,!0);const pN=fN(0),l8=gl(0,-2147483648,!1),h8=gl(-1,2147483647,!1);function fN(t,e){let r,n,i;return e?(i=0<=(t>>>=0)&&t<256)&&(n=lN[t],n)?n:(r=gl(t,0,!0),i&&(lN[t]=r),r):(i=-128<=(t|=0)&&t<128)&&(n=uN[t],n)?n:(r=gl(t,t<0?-1:0,!1),i&&(uN[t]=r),r)}function gl(t,e,r){return{low:0|t,high:0|e,unsigned:!!r}}function mN(t,e){if(isNaN(t))return pN;{if(t<=-hN)return l8;if(t+1>=hN)return h8}return t<0?pN:gl(t%If|0,t/If|0,e)}function _N(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}class gT extends pn{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const r=this._connectionState;this._connectionState=e,this.emit(cs.CONNECTION_STATE_CHANGE,e,r)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var r;super(),G(this,"name","AgoraRTCImageModeration"),G(this,"_connectionState",Eo.CONNECTING),G(this,"_sequence",0),G(this,"_moderationStartTime",void 0),G(this,"_workerConnection",void 0),G(this,"_workerMessageLengthLimit",void 0),G(this,"_qualityRatio",void 0),G(this,"_connectInfo",void 0),G(this,"_cancelTokenSource",bi.CancelToken.source()),G(this,"_retryConfig",void 0),G(this,"_moderationInterval",void 0),G(this,"_moderationTimer",null),G(this,"_moderationMode",1),G(this,"_quality",1),G(this,"_qualityTimer",null),G(this,"_ticket",void 0),G(this,"_moderationIntervalMinimum",void 0),G(this,"_uploadFailedNum",0),G(this,"_uploadNum",0),G(this,"_uploadTimer",null),G(this,"_extraInfo",void 0),G(this,"_vendor",""),G(this,"_encoder",new TextEncoder),G(this,"_moderationId",void 0),G(this,"inspectImage",()=>{if(this.connectionState!==Eo.CONNECTED)throw new Bt(et.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Eo.CONNECTED?this.requestToInspectImage():C.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=zr(5,"image-moderation-"),this._workerMessageLengthLimit=st("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=st("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(r=e.interval)!==null&&r!==void 0?r:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=st("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new al("worker-"+this._moderationId,bn),this.on(cs.STATE_CHANGE,(n,i)=>{C.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Ud[n]," ").concat(i||""))}),this.handleWorkerEvents()}async init(e,r){this.emit(cs.STATE_CHANGE,Ud.CONNECT_AP),this._connectInfo=e;const n=this._cancelTokenSource.token;return this._retryConfig=r,new De((i,o)=>{this.on(cs.CONNECTION_STATE_CHANGE,(s,c)=>{s===Eo.CONNECTED&&i()}),this.requestAP(e,n,r).then(s=>{this.connectWorker(s)}).catch(s=>{o(s)})})}updateConfig(e){var r;this._moderationInterval=(r=e.interval)!==null&&r!==void 0?r:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),C.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===Eo.CONNECTED&&this.inspectImage()}async requestAP(e,r,n){const i=st("WEBCS_DOMAIN").map(d=>"https://".concat(d,"/api/v1")),o=await function(d,u,l,T){let{appId:v,areaCode:y,cname:x,sid:N,token:L,uid:Q}=u;Gd++;const J="moderation_plugin",at={service_name:J,json_body:JSON.stringify({appId:v,areaCode:y,cname:x,command:"allocateEdge",requestId:Gd,seq:Gd,sid:N,appToken:L,ts:Date.now(),uid:Q+""})};let Rt,vt,pt=d[0];return is(async()=>{Rt=Date.now();const kt=await ds(pt,{data:at,cancelToken:l,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(vt=Date.now()-Rt,kt.code!==0){const Te=new Bt(et.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+kt.code,{retry:!0,responseTime:vt});throw C.error(Te.toString()),Te}const $t=JSON.parse(kt.json_body);if($t.code!==200){const Te=new Bt(et.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat($t.code,", reason: ").concat($t.reason),{code:$t.code,responseTime:vt});throw C.error(Te.toString()),Te}if(!$t.servers||!Array.isArray($t.servers)||$t.servers.length===0){const Te=new Bt(et.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:$t.code,responseTime:vt});throw C.error(Te.toString()),Te}if(!$t.servers.some(Te=>!!Te.wss)){const Te=new Bt(et.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:$t.code,responseTime:vt});throw C.error(Te.toString()),Te}const se=st("IMAGE_MODERATION_WORKER_HOST");return{addressList:$t.servers.map(Te=>{let{address:mr,wss:Er}=Te;if(mr&&Er)return"wss://".concat(mr.replace(/\./g,"-"),".").concat(se,":").concat(Er,"/moderation")}).filter(Te=>!!Te),workerToken:$t.workerToken,vid:$t.vid,ticket:$t.appTicket,responseTime:vt}},(kt,$t)=>(qe.apworkerEvent(N,{success:!0,sc:200,serviceName:J,responseDetail:JSON.stringify(kt.addressList),firstSuccess:$t===0,responseTime:vt,serverIp:d[$t%d.length]}),!1),(kt,$t)=>(qe.apworkerEvent(N,{success:!1,sc:kt.data&&kt.data.code||200,serviceName:J,responseTime:vt,serverIp:d[$t%d.length]}),!!(kt.code!==et.OPERATION_ABORTED&&kt.code!==et.UNEXPECTED_RESPONSE||kt.data&&kt.data.retry)&&(pt=d[($t+1)%d.length],!0)),T)}(i,e,r,n);this.emit(cs.STATE_CHANGE,Ud.AP_CONNECTED);const{addressList:s,ticket:c}=o;return this._ticket=c,s}async connectWorker(e){this.emit(cs.STATE_CHANGE,Ud.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(pr.CONNECTED,async()=>{this.emit(cs.STATE_CHANGE,Ud.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Eo.CONNECTED}),this._workerConnection.on(pr.CLOSED,()=>{this.connectionState=Eo.CLOSED}),this._workerConnection.on(pr.FAILED,()=>{this.connectionState=Eo.CLOSED}),this._workerConnection.on(pr.RECONNECTING,()=>{this.connectionState=this.connectionState===Eo.CONNECTED?Eo.RECONNECTING:Eo.CONNECTING}),this._workerConnection.on(pr.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const r=o8(new Uint8Array(e.data));st("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&C.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(r)),this._uploadNum++,r.code===void 0||r.code===0||(this._uploadFailedNum++,C.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(r.code,", msg is ").concat(r.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{qe.reportApiInvoke(this._connectInfo.sid||null,{name:vn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,r.code],tag:cn.TRACER}).onError(new Bt(et.IMAGE_MODERATION_UPLOAD_FAILED,r.msg)),this._uploadTimer=null},st("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else C.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(pr.WILL_RECONNECT,(e,r,n)=>{e==="recover"&&n(e),n("tryNext")}),this._workerConnection.on(pr.REQUEST_NEW_URLS,(e,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(r)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=$i(this,cs.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(st("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&C.debug("Only the track being played can be inspected"));this._sequence++;const n=await this.generateRequestData(e,r);this._workerConnection.sendMessage(n,!0,!0)}else st("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&C.debug("Only the track being published can be inspected")}async generateRequestData(e,r){let{appId:n,cname:i,cid:o,vid:s,sid:c,uid:d}=r;const u=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),T=await FA(l,n,i),v=this._sequence+"-"+o+"-"+d+"-"+u+"-"+zr(12,""),y={appId:n,cid:o,cname:i,deviceId:"",elapse:gT.intToLong(Number(u-this._moderationStartTime)),fileSize:l.buffer.byteLength,height:l.height,width:l.width,jpg:T,networkType:6,osType:7,requestId:v,sdkVersion:"4.24.0",sequence:this._sequence,sid:c,timestamp:mN(u),uid:d,vid:s,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete y.callbackData;const x=i8(y);if(x.byteLength<this._workerMessageLengthLimit){if(st("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const N=function(L){for(var Q=1;Q<arguments.length;Q++){var J=arguments[Q]!=null?arguments[Q]:{};Q%2?_N(Object(J),!0).forEach(function(at){G(L,at,J[at])}):Object.getOwnPropertyDescriptors?Object.defineProperties(L,Object.getOwnPropertyDescriptors(J)):_N(Object(J)).forEach(function(at){Object.defineProperty(L,at,Object.getOwnPropertyDescriptor(J,at))})}return L}({},y);delete N.jpg,C.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(N))}return x}{const N=this.quality*this._qualityRatio;return this.quality=N,await this.generateRequestData(e,{appId:n,cname:i,cid:o,vid:s,sid:c,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=bi.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Eo.CLOSED,this.emit(cs.STATE_CHANGE,Ud.CLOSED)}}function EN(t){if(Hr(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new Bt(et.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new Bt(et.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const p8={name:"ImageModeration",create:function(t){let{config:e}=t;return EN(e),new gT(e)}};var gN,TN,vN,yN,SN,RN,IN,CN,AN,bN,ON,wN,NN,PN,DN,kN,LN,MN,UN,xN,VN,jN,BN,FN,GN,HN,WN,KN,zN,qN,YN,XN,JN,ZN,QN,$N,tP,eP,rP,nP,iP,Me;function oP(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Go(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?oP(Object(r),!0).forEach(function(n){G(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):oP(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}si.setLogger(C);let f8=(gN=nr(),TN=nr({argsMap:(t,e)=>{if(!Array.isArray(e)){if(!(e instanceof Od))return[e];e=[e]}return e.map(r=>r?Object(r).toString():"null")}}),vN=nr({argsMap:(t,e)=>(e||(e=[]),Array.isArray(e)||e.trackMediaType!==bd.DATA?(Array.isArray(e)||(e=[e]),e.map(r=>r.getTrackId())):[e.getChannelId()])}),yN=nr({argsMap:(t,e,r,n)=>[typeof e=="object"?e.uid:e,r,n]}),SN=nr({argsMap:(t,e,r)=>[e,r]}),RN=nr({argsMap:(t,e)=>e.map(r=>{let{user:n,mediaType:i}=r;return[n?.uid,i]})}),IN=nr({argsMap:(t,e,r,n)=>[typeof e=="object"?e.uid:e,r,n]}),CN=nr({argsMap:(t,e)=>e.map(r=>{let{user:n,mediaType:i}=r;return{uid:n?.uid,mediaType:i}})}),AN=nr(),bN=nr(),ON=nr(),wN=nr(),NN=nr(),PN=nr(),DN=nr(),kN=nr(),LN=nr(),MN=nr(),UN=nr(),xN=nr(),VN=nr(),jN=nr(),BN=nr(),FN=nr({argsMap:(t,e)=>[e]}),GN=nr(),HN=nr(),WN=nr(),KN=nr(),zN=nr(),qN=nr(),YN=nr(),XN=nr(),JN=nr({argsMap:(t,e)=>(Array.isArray(e)||(e=[e]),[JSON.stringify(e)])}),ZN=nr(),QN=nr(),$N=nr(),tP=nr(),eP=nr(),rP=nr(),nP=nr({reportResult:!0}),iP=nr(),Me=class extends pn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,e){let r;if(super(),G(this,"store",void 0),G(this,"_uid",void 0),G(this,"_channelName",void 0),G(this,"_uintUid",void 0),G(this,"_users",[]),G(this,"_config",void 0),G(this,"_clientId",void 0),G(this,"_appId",void 0),G(this,"_sessionId",null),G(this,"_key",void 0),G(this,"_rtmConfig",{}),G(this,"_joinInfo",void 0),G(this,"_gateway",void 0),G(this,"_statsCollector",void 0),G(this,"_configDistribute",void 0),G(this,"_leaveMutex",void 0),G(this,"_publishMutex",void 0),G(this,"_renewTokenMutex",void 0),G(this,"_subscribeMutex",void 0),G(this,"_encryptionMode","none"),G(this,"_encryptionSecret",null),G(this,"_encryptionSalt",null),G(this,"_encryptDataStream",!1),G(this,"_encryptDataStreamKey",null),G(this,"_encryptDataStreamIv",null),G(this,"_proxyServer",void 0),G(this,"_turnServer",{servers:[],mode:"auto"}),G(this,"_cloudProxyServerMode","disabled"),G(this,"_isDualStreamEnabled",!1),G(this,"_defaultStreamFallbackType",void 0),G(this,"_lowStreamParameter",void 0),G(this,"_streamFallbackTypeCacheMap",new Map),G(this,"_remoteStreamTypeCacheMap",new Map),G(this,"_axiosCancelSource",bi.CancelToken.source()),G(this,"_audioVolumeIndicationInterval",void 0),G(this,"_networkQualityInterval",void 0),G(this,"_userOfflineTimeout",void 0),G(this,"_streamRemovedTimeout",void 0),G(this,"_liveTranscodeStreamingClient",void 0),G(this,"_liveRawStreamingClient",void 0),G(this,"_channelMediaRelayClient",void 0),G(this,"_networkQualitySensitivity","normal"),G(this,"_p2pChannel",void 0),G(this,"_useLocalAccessPoint",!1),G(this,"_setLocalAPVersion",void 0),G(this,"_joinAndNotLeaveYet",!1),G(this,"_numberOfJoinCount",0),G(this,"_joinResponse",null),G(this,"_remoteDefaultVideoStreamType",void 0),G(this,"_inspect",void 0),G(this,"_moderation",void 0),G(this,"_license",void 0),G(this,"_pendingPublishedUsers",[]),G(this,"ntpAlignErrorCount",0),G(this,"remoteInboundOffset",0),G(this,"_peerConnectionState",void 0),G(this,"_handleLocalTrackEnable",(i,o,s)=>{this.publish(i,!1).then(o).catch(s)}),G(this,"_handleLocalTrackDisable",(i,o,s)=>{this.unpublish(i).then(o).catch(s)}),G(this,"_handleUserOnline",i=>{if(st("BLOCK_LOCAL_CLIENT")&&Tc(i.uid,this.channelName))return void C.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&typeof i.uid!="string"&&C.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const o=this._users.find(s=>s.uid===i.uid);if(o)o._trust_in_room_=!0,o._is_pre_created&&(o._is_pre_created=!1,this.safeEmit(vr.USER_JOINED,o));else{const s=new Ma(i.uid,i.uint_id||i.uid);this._users.push(s),C.debug("[".concat(this._clientId,"] user online"),i.uid),this.store.firstVideoFrameDecoded(s.uid,{userJoinNotify:Date.now()}),this.safeEmit(vr.USER_JOINED,s)}}),G(this,"_handleUserOffline",i=>{if(st("BLOCK_LOCAL_CLIENT")&&Tc(i.uid,this.channelName))return;const o=this._users.find(s=>s.uid===i.uid);o&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),o._audio_pre_subscribed||o._video_pre_subscribed?o._is_pre_created=!0:Rp(this._users,o),this._remoteStreamTypeCacheMap.delete(o.uid),this._streamFallbackTypeCacheMap.delete(o.uid),C.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(vr.USER_LEAVED,o,i.reason))}),G(this,"_handleAddAudioOrVideoStream",(i,o,s,c,d,u,l,T)=>{if(st("BLOCK_LOCAL_CLIENT")&&Tc(o,this.channelName))return;const v=this._users.find(x=>x.uid===o);if(!v)return void C.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));C.debug("[".concat(this._clientId,"] stream added with uid ").concat(o,", type ").concat(i)),this.store.subscribe(v.uid,i,void 0,void 0,void 0,Date.now()),i==="video"&&this.store.firstVideoFrameDecoded(v.uid,{videoAddNotify:Date.now()});const y=i==="audio"?v.hasAudio:v.hasVideo;if(v._uintid||(v._uintid=u||o),i==="audio"?v._trust_audio_stream_added_state_=!0:v._trust_video_stream_added_state_=!0,i==="audio"?(v._audio_added_=!0,s!==void 0&&(v._audioSSRC=s),c!==void 0&&(v._cname=c),l&&(v._audioOrtc=l)):(v._video_added_=!0,s!==void 0&&(v._videoSSRC=s),c!==void 0&&(v._cname=c),T!==void 0&&(v._rtxSsrcId=T),l&&(v._videoOrtc=l)),(i==="audio"?v.hasAudio:v.hasVideo)&&!y&&(C.info("[".concat(this._clientId,"] remote user ").concat(v.uid," published ").concat(i)),this.safeEmit(vr.USER_PUBLISHED,v,i)),i==="video"?qe.onGatewayStream(this._sessionId,Un.ON_ADD_VIDEO_STREAM,nn.ON_ADD_VIDEO_STREAM,{peer:u||o,ssrc:v._videoSSRC}):qe.onGatewayStream(this._sessionId,Un.ON_ADD_AUDIO_STREAM,nn.ON_ADD_AUDIO_STREAM,{peer:u||o,ssrc:v._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(v,i,s).then(x=>{if(x&&(C.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(v.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof _l))return this._p2pChannel.unsubscribe(v,i,!0).then(()=>this._subscribe(v,i,!0).catch(N=>{C.error("[".concat(this._clientId,"] resubscribe error"),N.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(v,i)&&(C.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(v.uid," after reconnect.")),this._subscribe(v,i,!0).catch(x=>{C.error("[".concat(this._clientId,"] resubscribe error"),x.toString())})),i==="video"&&!ei()&&!mi()){const x=this._getEncodingName(d);x?.toLocaleLowerCase()==$u.av1&&jH().then(N=>{N||this._gateway.downgradeCodec(x)})}}),G(this,"_handleRemoveStream",i=>{if(st("BLOCK_LOCAL_CLIENT")&&Tc(i.uid,this.channelName))return;const o=this._users.find(c=>c.uid===i.uid);if(!o)return void C.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));C.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let s=()=>{};o.hasAudio&&o.hasVideo?s=()=>{C.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished audio track")),this.safeEmit(vr.USER_UNPUBLISHED,o,"audio"),C.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished video track")),this.safeEmit(vr.USER_UNPUBLISHED,o,"video")}:o.hasVideo?s=()=>{C.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished video track")),this.safeEmit(vr.USER_UNPUBLISHED,o,"video")}:o.hasAudio&&(s=()=>{C.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished audio track")),this.safeEmit(vr.USER_UNPUBLISHED,o,"audio")}),o._video_pre_subscribed||o._audio_pre_subscribed||(o._trust_audio_stream_added_state_=!0,o._trust_video_stream_added_state_=!0,o._audio_added_=!1,o._video_added_=!1,this._p2pChannel instanceof _l&&this._p2pChannel.unsubscribe(o).then(c=>{if(c)return this._gateway.unsubscribe(c,o.uid)}),o._audioSSRC=void 0,o._videoSSRC=void 0,o._audioOrtc=void 0,o._videoOrtc=void 0,o._rtxSsrcId=void 0),qe.onGatewayStream(this._sessionId,Un.ON_REMOVE_STREAM,nn.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),s()}),G(this,"_handleSetStreamLocalEnable",(i,o,s)=>{if(st("BLOCK_LOCAL_CLIENT")&&Tc(o,this.channelName))return;const c=this._users.find(l=>l.uid===o);if(!c)return void C.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));C.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(s?"enabled":"disabled"," with uid ").concat(o));const d=i==="audio"?c.hasAudio:c.hasVideo;if(i==="audio"){c._trust_audio_enabled_state_=!0;const l=c._audio_enabled_;if(c._audio_enabled_=s,c._audio_enabled_===l)return;{const T=c._audio_enabled_?"enable-local-audio":"disable-local-audio";C.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(o,", msg: ").concat(T)),this.safeEmit(vr.USER_INFO_UPDATED,o,T)}}else{c._trust_video_enabled_state_=!0;const l=c._video_enabled_;if(c._video_enabled_=s,c._video_enabled_===l)return;{const T=c._video_enabled_?"enable-local-video":"disable-local-video";C.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(T)),this.safeEmit(vr.USER_INFO_UPDATED,o,T)}}const u=i==="audio"?c.hasAudio:c.hasVideo;return d!==u?!d&&u?(C.info("[".concat(this._clientId,"] remote user ").concat(o," published ").concat(i)),void this.safeEmit(vr.USER_PUBLISHED,c,i)):(i==="video"&&c._videoTrack&&c._videoTrack._destroy(),i==="audio"&&c._audioTrack,this._p2pChannel.muteRemote(c,i),C.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished ").concat(i)),void this.safeEmit(vr.USER_UNPUBLISHED,c,i)):void 0}),G(this,"_handleMuteStream",(i,o,s)=>{if(st("BLOCK_LOCAL_CLIENT")&&Tc(i,this.channelName))return;C.debug("[".concat(this._clientId,"] receive mute message"),i,o,s);const c=this._users.find(l=>l.uid===i);if(!c)return void C.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));const d=o==="audio"?c.hasAudio:c.hasVideo;if(o==="audio"){c._trust_audio_mute_state_=!0;const l=c._audio_muted_;if(c._audio_muted_=s,c._audio_muted_===l)return;{const T=c._audio_muted_?"mute-audio":"unmute-audio";C.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(T)),this.safeEmit(vr.USER_INFO_UPDATED,i,T)}}else{c._trust_video_mute_state_=!0;const l=c._video_muted_;if(c._video_muted_=s,c._video_muted_===l)return;{const T=c._video_muted_?"mute-video":"unmute-video";C.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(T)),this.safeEmit(vr.USER_INFO_UPDATED,i,T)}}const u=o==="audio"?c.hasAudio:c.hasVideo;if(d!==u){if(!d&&u)return(o==="audio"?c._audioSSRC:c._videoSSRC)?(C.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(o)),void this.safeEmit(vr.USER_PUBLISHED,c,o)):void C.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(o," unmute message  before add stream message, ").concat(o," SSRC doesn't exist yet."));o==="video"&&c._videoTrack&&!c._video_pre_subscribed&&c._videoTrack._destroy(),o==="audio"&&c._audioTrack,this._p2pChannel.muteRemote(c,o),C.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(o)),this.safeEmit(vr.USER_UNPUBLISHED,c,o)}}),G(this,"_handleP2PLost",async i=>{C.debug("[".concat(this._clientId,"] receive p2p lost"),i),parseInt(i.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():C.warning("[".concat(this._clientId,"] P2PLost stream not found"),i)}),G(this,"_handleTokenWillExpire",()=>{C.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(vr.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),G(this,"_handleBeforeUnload",i=>{i.type==="beforeunload"&&i.returnValue!==void 0&&i.returnValue!==""||(this.leave(),C.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),G(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(vr.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(vr.NETWORK_QUALITY,i)}),G(this,"_handleP2PAddAudioOrVideoStream",(i,o,s,c)=>{const d=this._users.find(l=>l.uid===o);if(!d)return void C.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));C.debug("[".concat(this._clientId,"] stream added with uid ").concat(o,", type ").concat(i)),this.store.subscribe(d.uid,i,void 0,void 0,void 0,Date.now());const u=i==="audio"?d.hasAudio:d.hasVideo;i==="audio"?d._trust_audio_stream_added_state_=!0:d._trust_video_stream_added_state_=!0,i==="audio"?(d._audio_added_=!0,s!==void 0&&(d._audioSSRC=s),c!==void 0&&(d._audioMid=c)):(d._video_added_=!0,s!==void 0&&(d._videoSSRC=s),c!==void 0&&(d._videoMid=c)),(i==="audio"?d.hasAudio:d.hasVideo)&&!u&&(C.info("[".concat(this._clientId,"] remote user ").concat(d.uid," published ").concat(i)),this.safeEmit(vr.USER_PUBLISHED,d,i)),this._p2pChannel.hasPendingRemoteMedia(d,i)&&(C.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(d.uid," after reconnect.")),this._subscribe(d,i,!0).catch(l=>{C.error("[".concat(this._clientId,"] resubscribe error"),l.toString())}))}),this._config=t,this._clientId=e||zr(5,"client-"),this.store=new class{constructor(i,o,s,c){dr(this,"state",void 0),this.state={codec:i,audioCodec:o,mode:s,clientId:c,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:hc.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(i){this.state=function(o,s){switch(s.type){case ur.SET_SESSION_ID:return ve(ve({},o),{},{sessionId:s.sessionId});case ur.SET_P2P_ID:return ve(ve({},o),{},{p2pId:s.p2pId});case ur.SET_UID:return ve(ve({},o),{},{uid:s.uid});case ur.SET_INT_UID:return ve(ve({},o),{},{intUid:s.intUid});case ur.SET_PUB_ID:return ve(ve({},o),{},{pubId:s.pubId});case ur.KEY_METRIC_CLIENT_CREATED:return ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{clientCreated:s.metric})});case ur.KEY_METRIC_JOIN_START:return ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{joinStart:s.metric})});case ur.KEY_METRIC_PRELOAD_START:return ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{preloadStart:s.metric})});case ur.KEY_METRIC_PRELOAD_END:return ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{preloadEnd:s.metric})});case ur.KEY_METRIC_JOIN_END:return ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{joinEnd:s.metric})});case ur.KEY_METRIC_REQUEST_AP_START:return ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{requestAPStart:s.metric})});case ur.KEY_METRIC_REQUEST_AP_END:return ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{requestAPEnd:s.metric})});case ur.KEY_METRIC_REQUEST_SUA_END:return ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{requestSUAEnd:s.metric})});case ur.KEY_METRIC_BEFORE_CONNECT:return ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{beforeConnect:s.metric})});case ur.KEY_METRIC_PEER_RECEIVER:return ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{peerReceiver:s.metric})});case ur.KEY_METRIC_SIGNAL_CONNECTED:return ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{signalConnected:s.metric})});case ur.KEY_METRIC_JOIN_REQ:return ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{joinReq:s.metric})});case ur.KEY_METRIC_JOIN_REP:return ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{joinRep:s.metric})});case ur.KEY_METRIC_JOIN_GATEWAY_START:return ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{joinGatewayStart:s.metric})});case ur.KEY_METRIC_JOIN_GATEWAY_END:return ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{joinGatewayEnd:s.metric})});case ur.KEY_METRIC_PEER_CONNECTION_START:return ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{peerConnectionStart:s.metric})});case ur.KEY_METRIC_PEER_CONNECTION_END:return ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{peerConnectionEnd:s.metric})});case ur.KEY_METRIC_DESCRIPTION_START:return ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{descriptionStart:s.metric})});case ur.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{signalChannelOpen:s.metric})});case ur.KEY_METRIC_ICE_CONNECTION_END:return ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{iceConnectionEnd:s.metric})});case ur.KEY_METRIC_PUBLISH:{const c=o.keyMetrics.publish,d=c.findIndex(u=>u.trackId===s.metric.trackId);return d!==-1?(c[d]=ve(ve({},c[d]),s.metric),ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{publish:[...c]})})):ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{publish:[...o.keyMetrics.publish,s.metric]})})}case ur.KEY_METRIC_SUBSCRIBE:{const c=o.keyMetrics.subscribe,d=c.findIndex(u=>u.userId===s.metric.userId&&u.type===s.metric.type);return d!==-1?(c[d]=ve(ve({},c[d]),s.metric),ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{subscribe:[...c]})})):ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{subscribe:[...o.keyMetrics.subscribe,s.metric]})})}case ur.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const c=o.keyMetrics.firstVideoFrameDecoded,d=c.findIndex(u=>u.userId===s.metric.userId);return d!==-1?(c[d]=ve(ve({},c[d]),s.metric),ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{firstVideoFrameDecoded:[...c]})})):ve(ve({},o),{},{keyMetrics:ve(ve({},o.keyMetrics),{},{firstVideoFrameDecoded:[...o.keyMetrics.firstVideoFrameDecoded,s.metric]})})}case ur.RESET_FIRST_VIDEO_FRAME_DECODED:return o.keyMetrics.firstVideoFrameDecoded=[],o;case ur.SET_CLOUD_PROXY_SERVER_MODE:return o.cloudProxyServerMode=s.mode,o;case ur.RECORD_JOIN_CHANNEL_SERVICE:return typeof s.index!="number"?o.joinChannelServiceRecords=[...o.joinChannelServiceRecords,s.record]:(o.joinChannelServiceRecords[s.index]=ve(ve({},o.joinChannelServiceRecords[s.index]),s.record),o.joinChannelServiceRecords=[...o.joinChannelServiceRecords]),o;case ur.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return o.joinChannelServiceRecords=[],o;case ur.RESET_KEY_METRICS:return o.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},o;case ur.SET_USE_P2P:return ve(ve({},o),{},{useP2P:s.val});case ur.SET_TRANSPORT_TYPE:return ve(ve({},o),{},{p2pTransport:s.val});default:return o}}(this.state,i)}set autoSubscribe(i){this.state.autoSubscribe=i}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(i){this.state.enableInstantMuteRestore=i}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(i){this.dispatch({type:ur.SET_SESSION_ID,sessionId:i})}get sessionId(){return this.state.sessionId}set cid(i){this.state.cid=i}get cid(){return this.state.cid}set codec(i){this.state.codec=i}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(i){this.dispatch({type:ur.SET_P2P_ID,p2pId:i})}get p2pId(){return this.state.p2pId}set dcId(i){this.dispatch({type:ur.SET_DC_ID,dcId:i})}get dcId(){return this.state.dcId}set uid(i){this.dispatch({type:ur.SET_UID,uid:i})}get uid(){return this.state.uid}set intUid(i){this.dispatch({type:ur.SET_INT_UID,intUid:i})}get intUid(){return this.state.intUid}set pubId(i){this.dispatch({type:ur.SET_PUB_ID,pubId:i})}get pubId(){return this.state.pubId}set cloudProxyServerMode(i){this.dispatch({type:ur.SET_CLOUD_PROXY_SERVER_MODE,mode:i})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(i){this.dispatch({type:ur.SET_USE_P2P,val:i})}get useP2P(){return this.state.useP2P}set p2pTransport(i){this.dispatch({type:ur.SET_TRANSPORT_TYPE,val:i})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(i){this.state.hasStartJoinChannel=i}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(i){this.state.isABTestSuccess=i}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:ur.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ur.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:ur.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:ur.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:ur.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ur.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ur.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:ur.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:ur.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:ur.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:ur.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:ur.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:ur.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ur.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ur.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ur.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ur.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(i,o){this.dispatch({type:ur.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:ve({userId:i},o)})}descriptionStart(){this.dispatch({type:ur.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ur.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ur.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(i,o,s,c){this.dispatch({type:ur.KEY_METRIC_PUBLISH,metric:ve(ve({trackId:i,type:o},s&&{publishStart:s}),c&&{publishEnd:c})})}subscribe(i,o,s,c,d,u,l){this.dispatch({type:ur.KEY_METRIC_SUBSCRIBE,metric:ve(ve(ve(ve(ve({userId:i,type:o},s&&{subscribeStart:s}),c&&{subscribeEnd:c}),d&&{firstFrame:d}),u&&{streamAdded:u}),l&&{firstDecoded:l})})}massSubscribe(i,o,s,c){i.forEach(d=>{this.dispatch({type:ur.KEY_METRIC_SUBSCRIBE,metric:ve(ve(ve({userId:d.userId,type:d.type},o&&{subscribeStart:o}),s&&{subscribeEnd:s}),c&&{firstFrame:c})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(i,o){i.service==="gateway"&&Array.isArray(i.urls)&&(i.urls=i.urls.map(s=>s.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof o!="number"?(this.dispatch({type:ur.RECORD_JOIN_CHANNEL_SERVICE,record:ve(ve({},i),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(o<0||o>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ur.RECORD_JOIN_CHANNEL_SERVICE,record:i,index:o}),o)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ur.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ur.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:ur.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new si("client-leave",this._clientId),this._publishMutex=new si("client-publish",this._clientId),this._renewTokenMutex=new si("client-renewtoken",this._clientId),this._subscribeMutex=new si("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),C.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(po," build: ").concat(ng,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{WE(t.clientRoleOptions),r=Object.assign({},t.clientRoleOptions)}catch(i){C.warning("[".concat(this._clientId,"] ").concat(i.toString()))}var n;this._statsCollector=new fl(this.store),this._statsCollector.onStatsException=(i,o,s)=>{C.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(o,", uid: ").concat(s)),i===rT.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(c=>{c instanceof xp&&st("ENABLE_ENCODE_EXCEPTION")&&c.findClosestProfile()}),this.safeEmit(vr.EXCEPTION,{code:i,msg:o,uid:s})},this._statsCollector.onUploadPublishDuration=(i,o,s,c)=>{const d=this._users.find(u=>u.uid===i);d&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(d._uintid,{peerPublishDuration:s,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(d)),qe.peerPublishStatus(this._sessionId,{subscribeElapse:c,audioPublishDuration:o,videoPublishDuration:s,peer:d._uintid}))},this._statsCollector.onVideoCodecChanged=i=>{if(st("VIDEO_STANDARD_BITRATE_VERSION")&&(i==="av1"||i==="h265"||i==="h264")){const o=this.localTracks.find(s=>s instanceof Zr);o&&o._saveEncodeBitrateRatio!==1&&o.setSaveEncodeBitrateRatio(i==="h264"?st("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=t.mode==="p2p",this._gateway=new kH(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||bn,httpRetryConfig:t.httpRetryConfig||bn,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:r}),this._configDistribute=new WH(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(n={store:this.store,statsCollector:this._statsCollector},Zs("P2PChannel").create(n)),this._handleP2PEvents()):this._p2pChannel=new _l(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,e,r,n,i){let o=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],s=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Br("JOIN_GATEWAY_USE_443PORT_ONLY",o),Br("JOIN_GATEWAY_USE_DUAL_DOMAIN",s);const c=this._gateway.signal.websocket;return c instanceof Fg&&(c.use443PortOnly=o,c.tryDoubleDomain=s),async function(d,u,l){gp.get(d)||gp.set(d,[]),Tp.get(d)||Tp.set(d,u),Ss.get(d)||Ss.set(d,0);const T=gp.get(d),v=Tp.get(d);if(!T||!v)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Ss.get(d)===v){const Q=Wu();T.push(Q),await Q.promise}Ss.set(d,Ss.get(d)+1);for(var y=arguments.length,x=new Array(y>3?y-3:0),N=3;N<y;N++)x[N-3]=arguments[N];const L=await l(...x);return Ss.set(d,Ss.get(d)-1),Ss.get(d)===v-1&&T.length>0&&(T[0].resolve(),T.shift()),Ss.get(d)===0&&(gp.set(d,[]),Tp.set(d,0),Ss.set(d,0)),L}("client.join",st("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,e,r,n,i)}async join(t,e,r,n,i){const o=++this._numberOfJoinCount;this.store.joinStart(),n&&(this.store.uid=n);const s=(Ap||Ap||(Ap=(window.location.protocol.split(":")[0]||"").toUpperCase(),Ap))==="HTTPS",c=eA()?window.isSecureContext:"Browser Not Support";(!eA()&&!s||!window.isSecureContext)&&C.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let d;qe.setAppId(t);try{if(!r&&r!==null)throw new Bt(et.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));if(r&&qn(r,"token",1,2047),qn(t,"appid",1,2047),Yp(e),n&&Xp(n),i)if(typeof i=="string")qn(i,"optionalInfo",1,256),d=i;else{if(typeof i!="object")throw new Bt(et.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:L,enableInstantMuteRestore:Q}=i;L&&(ns(L,"autoSubscribe"),C.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(L)),this.store.autoSubscribe=L),Q&&(ns(Q,"enableInstantMuteRestore"),C.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(Q)),this.store.enableInstantMuteRestore=Q)}}}catch(L){throw qe.reportApiInvoke(lc(),{name:vn.JOIN,options:[t,e,r,n],states:{isHttps:s,isSecureContext:c},tag:cn.TRACER}).onError(L),L}if(this._leaveMutex.isLocked&&(C.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),C.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const L=new Bt(et.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw qe.reportApiInvoke(lc(),{name:vn.JOIN,options:[t,e,r,n],states:{isHttps:s,isSecureContext:c},tag:cn.TRACER}).onError(L),L}this._gateway.state="CONNECTING",this.store.preloadStart();const u=await tN({appId:t,cname:e,uid:n,stringUid:typeof n=="string"?n:void 0,token:r||t,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new Bt(et.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const l=u?.sid||lc();C.info("[".concat(this._clientId,"] start join channel ").concat(e,", join number: ").concat(o)),this._sessionId||(this._sessionId=l,this.store.sessionId=this._sessionId);const T=qe.reportApiInvoke(l,{id:this._clientId,name:vn.JOIN,options:[t,e,r,n],states:{isHttps:s,isSecureContext:c},tag:cn.TRACER}),v=Go(Go(Go({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:e,uid:typeof n!="string"?n:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:r||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:d,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!u},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:st("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(v.setLocalAPVersion=this._setLocalAPVersion),typeof n=="string"&&(v.stringUid=n,this._uintUid?(v.uid=this._uintUid,this._uintUid=void 0):v.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(v.aesmode=this._encryptionMode,v.aespassword=await(async L=>{const Q=function(vt){const pt=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),kt=new Uint8Array(new ArrayBuffer(pt.length));for(let $t=0;$t<pt.length;$t+=1)kt[$t]=pt.charCodeAt($t);return kt}(),J=await window.crypto.subtle.importKey("spki",Q,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),at=GE(L),Rt=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},J,at);return function(vt){let pt="";for(let kt=0;kt<vt.length;kt+=1)pt+=String.fromCharCode(vt[kt]);return window.btoa(pt)}(new Uint8Array(Rt))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Bt(et.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(v.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const L=new TextEncoder,Q=st("USE_PURE_ENCRYPTION_MASTER_KEY")?L.encode(v.appId+this._encryptionSecret+this._encryptionSecret):L.encode(v.appId+v.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(J,at,Rt){const vt=await window.crypto.subtle.importKey("raw",at,"PBKDF2",!1,["deriveBits","deriveKey"]),pt=J==="aes-128-gcm2"?128:256,kt=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:lA,hash:"SHA-256",salt:Rt},vt,pt+d6);return new Uint8Array(kt).subarray(pt/8)}(this._encryptionMode,Q,uc(this._encryptionSalt)),this._encryptDataStreamKey=await async function(J,at,Rt){const vt=await window.crypto.subtle.importKey("raw",at,"PBKDF2",!1,["deriveBits","deriveKey"]),pt=J==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:lA,hash:"SHA-256",salt:Rt},vt,{name:"AES-GCM",length:pt},!0,["encrypt","decrypt"])}(this._encryptionMode,Q,uc(this._encryptionSalt))}else c?C.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):C.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,C.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:e,appId:t,stringUid:v.stringUid});const y=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&y===this._sessionId&&qe.joinChannelTimeout(this._sessionId,5)},5e3);try{var x;let L;const Q=v.cloudProxyServer;if(Ce(x=["proxy3","proxy4","proxy5"]).call(x,Q)){const pt=st("PROXY_SERVER_TYPE3");Array.isArray(pt)?v.proxyServer=pt[0]:v.proxyServer=pt}if(qe.setProxyServer(v.proxyServer),C.setProxyServer(v.proxyServer),this.store.requestAPStart(),u){if(C.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(v.stringUid?", ".concat(v.stringUid," => ").concat(u.intUid):""," ")),v.stringUid&&!v.uid&&(v.uid=u.intUid),L={gatewayInfo:u.ap.gatewayInfo},st("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&v.turnServer.mode==="auto")if(u.ap.proxyInfo.addresses.length===0)C.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const pt=(await JO(u.ap.proxyInfo,u.ap.gatewayInfo.uid)).map(kt=>({turnServerURL:kt.address,tcpport:kt.tcpport||ii.tcpport,udpport:kt.udpport||ii.udpport,username:kt.username||ii.username,password:kt.password||ii.password,forceturn:!1,security:!0}));v.turnServer={mode:"manual",servers:pt}}nN(u,v.stringUid)}else{if(v.stringUid&&!v.uid){let pt;[pt,L]=await De.all([Iw(v.stringUid,v,this._axiosCancelSource.token,this._config.httpRetryConfig||bn,this.store).finally(()=>{this.store.requestSUAEnd()}),Rw(v,this._axiosCancelSource.token,this._config.httpRetryConfig||bn,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),C.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(v.stringUid," => ").concat(pt)),v.uid=pt,L.gatewayInfo.uid=pt,L.gatewayInfo.res.uid=pt}else L=await Rw(v,this._axiosCancelSource.token,this._config.httpRetryConfig||bn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Bt(et.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(v,this._axiosCancelSource.token),this._configDistribute.on(ol.UPDATE_BITRATE_LIMIT,pt=>{this._p2pChannel.updateBitrateLimit(pt)}),this._configDistribute.on(ol.UPDATE_CLIENT_ROLE_OPTIONS,pt=>{this._setClientRoleOptions(pt)})},0),this._key=r||t;const J=L.gatewayInfo,at=v.uid?v.uid:J.uid;this._joinInfo=Go(Go({},v),{},{cid:J.cid,uid:at,vid:J.vid,apResponse:J.res,apGatewayAddress:J.apGatewayAddress,uni_lbs_ip:J.uni_lbs_ip,gatewayAddrs:J.gatewayAddrs}),this.store.intUid=at,this.store.cid=J.cid;const Rt=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Bt(et.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));T.onSuccess(Rt),this._appId=t,this._channelName=v.cname,this._uid=Rt,this.store.uid=Rt,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(ei()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const vt=v.stringUid?"string uid: ".concat(v.stringUid,",uid: ").concat(v.uid):"uid: ".concat(this._uid);return C.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(e,",").concat(vt)),setTimeout(()=>{C.startUpload()},5e3),this.store.joinEnd(),N=this,Ce(gc).call(gc,N)||gc.push(N),this._cloudProxyServerMode==="disabled"&&br().supportWebCrypto&&st("ENABLE_PRELOAD")&&_T(this._joinInfo),Rt}catch(L){const Q=Array.isArray(L)?L[0]:L;throw Q&&Q.code===et.OPERATION_ABORTED?C.warning("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),Q):C.error("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),Q),Q.code!==et.OPERATION_ABORTED&&this._numberOfJoinCount===o&&(this._gateway.state="DISCONNECTED",this._reset()),T.onError(Q),Q}var N}_joinGateway(){if(!this._joinInfo||!this._key)throw new Bt(et.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!st("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){C.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(ei()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const r=gc.indexOf(e);r!==-1&&gc.splice(r,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return C.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",Lr.LEAVE),C.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof Od))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new Bt(et.INVALID_PARAMS,"param list is empty");const r=t;if(this._gateway.role==="audience")throw new Bt(et.INVALID_OPERATION,"audience can not publish stream");for(const i of r){if(!(i instanceof Od))throw new Bt(et.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&e)throw new Bt(et.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}C.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r.map(i=>"".concat(i.getTrackId()," "))));const n=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),e&&r.forEach(i=>{const o=this._configDistribute.getBitrateLimit();i instanceof Zr&&o&&i.setBitrateLimit(o.uplink)});try{await this._publishHighStream(r),C.info("[".concat(this._clientId,"] Publish success, id ").concat(r.map(i=>"".concat(i.getTrackId()," "))))}catch(i){throw C.error("[".concat(this._clientId,"] publish error"),i.toString()),i}finally{n()}}async _publishDataChannel(t){if(t==null)throw new Bt(et.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(t)));Hr(t.id,"id",0,65535,!0),ns(t.ordered,"ordered"),qn(t.metadata,"metadata",0,512),C.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const e=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(i=>i.id===t.id)!==-1)throw new Bt(et.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Bt(et.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Bt(et.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&st("FORCE_TURN")&&!st("TURN_ENABLE_TCP")&&!st("TURN_ENABLE_UDP"))throw new Bt(et.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const r=function(i){return fw(i,!1)}(t),n=await this._p2pChannel.publishDataChannel([r]);if(n.length>0){if(typeof r._originDataChannelId!="number")throw C.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Bt(et.CREATE_DATACHANNEL_ERROR);try{await De.all(n.map(i=>this._uid&&this._gateway.publishDataChannel(this._uid,i,!0))),await r._waitTillOpen()}catch(i){if(i.code!==et.DISCONNECT_P2P)throw i}}return C.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(r.id)),r}catch(r){throw C.error("[".concat(this._clientId,"] publish datachannels error"),r.toString()),r}finally{e()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new Bt(et.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let e=[];if(t)if(Array.isArray(t))e=t;else{if(!(t instanceof Od))return this._unpublishDataChannel([t]);e=[t]}else this.store.useP2P||await this._unpublishDataChannel(),e=this._p2pChannel.getAllTracks(!0);C.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(n=>"".concat(n.getTrackId()," "))," "));const r=await this._publishMutex.lock();try{if(this.store.useP2P){const n=await this._p2pChannel.unpublish(e);n&&await this._gateway.sendExtensionMessage(Sn.UNPUBLISH,{unpubMsg:n},!0)}else{const n=await this._p2pChannel.unpublish(e);n&&await this._gateway.unpublish(n,this._uid),C.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(i=>"".concat(i.getTrackId()))))}}catch(n){throw C.error("[".concat(this._clientId,"] unpublish error"),n.toString()),n}finally{r&&r()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),C.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(r=>"".concat(r.id," "))," "));const e=await this._publishMutex.lock();try{const r=await this._p2pChannel.unpublishDataChannel(t);r&&await this._gateway.unpublishDataChannel(r),C.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(n=>"".concat(n.id))))}catch(r){throw C.error("[".concat(this._clientId,"] unpublish dataChannel error"),r.toString()),r}finally{e&&e()}}async subscribe(t,e,r){if(!(t instanceof Ma)){const n=this.remoteUsers.find(i=>i.uid===t);if(!n)throw new Bt(et.INVALID_REMOTE_USER,"user is not in the channel");t=n}return e==="datachannel"?this._subscribeDataChannel(t,r):this._subscribe(t,e)}async presubscribe(t,e){if(Mn(e,"mediaType",["audio","video"]),this.store.useP2P)throw new Bt(et.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Bt(et.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Bt(et.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const r=e===Ue.AUDIO,n=e===Ue.VIDEO,i=await this._subscribeMutex.lock();try{const{ssrcId:o,ortc:s,rtxSsrcId:c,cname:d,uint_id:u}=await this._gateway.presubscribe(t,e,!0);if(o==null)throw new Bt(et.UNEXPECTED_RESPONSE,"no ssrc id");let l=this._users.find(v=>v.uid===t);l||(l=new Ma(t,u||t),l._is_pre_created=!0,this._users.push(l)),d&&(l._cname=d),l._uintid||(l._uintid=u||t),r&&(l._audioSSRC=o,l._audio_pre_subscribed=!0,s&&(l._audioOrtc=s)),n&&(l._videoSSRC=o,l._video_pre_subscribed=!0,s&&(l._videoOrtc=s),c!=null&&(l._rtxSsrcId=c)),C.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(o)),await this._p2pChannel.subscribe(l,e,o,c,s);const T=r?l._audioTrack:l._videoTrack;if(!T)throw new Bt(et.UNEXPECTED_ERROR,"can not find remote track in user");return r&&(l._trust_audio_stream_added_state_=!0,l._audio_added_=!0),n&&(l._trust_video_stream_added_state_=!0,l._video_added_=!0),T}catch(o){throw C.error("[".concat(this._clientId,"] presub user ").concat(t," error"),o),o}finally{i()}}async _subscribeDataChannel(t,e){var r;if(Hr(e,"channelId",0,65535,!0),!this._joinInfo)throw new Bt(et.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Bt(et.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(c=>c===t))throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new Bt(et.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new Bt(et.INVALID_REMOTE_USER,"user is not published");const i=(r=t._dataChannels)===null||r===void 0?void 0:r.find(c=>c.id===e);if(!i)throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new Bt(et.REMOTE_USER_IS_NOT_PUBLISHED);const o=await this._subscribeMutex.lock();C.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const c=await this._p2pChannel.subscribeDataChannel(t,[i]);if(c&&Ce(c).call(c,i.id))try{var s;if(typeof i._originDataChannelId!="number")throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Bt(et.CREATE_DATACHANNEL_ERROR);const d={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:(s=i.metadata)!==null&&s!==void 0?s:""};await this._gateway.subscribeDataChannel(t.uid,d,!0),await i._waitTillOpen()}catch(d){if(d?.code!==et.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[i]),d;await this._p2pChannel.unsubscribeDataChannel(t,[i]),this._p2pChannel.setPendingRemoteDataChannel(t,i.id)}return C.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),i}finally{o()}}async _p2pSubscribe(t,e,r){if(Mn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new Bt(et.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Bt(et.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(o=>o===t)){const o=new Bt(et.INVALID_REMOTE_USER,"user is not in the channel");throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),o}if(!t.hasAudio&&!t.hasVideo){const o=new Bt(et.INVALID_REMOTE_USER,"user is not published");throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),o}if(!r&&(e==="audio"&&!t.hasAudio||e==="video"&&!t.hasVideo)){const o=new Bt(et.REMOTE_USER_IS_NOT_PUBLISHED);throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),o}const i=await this._subscribeMutex.lock();C.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const s=e==="audio"?t._audioSSRC:t._videoSSRC,c=e==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,e,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,e,s,c)}catch(s){throw s}C.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(s=>{C.warning("[".concat(this._clientId,"] auto set fallback failed"),s)});const o=e==="audio"?t._audioTrack:t._videoTrack;if(!o)throw new Bt(et.UNEXPECTED_ERROR,"can not find remote track in user object");return o}catch(o){throw C.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),o),o}finally{i()}}async _subscribe(t,e,r){if(this.store.useP2P)return this._p2pSubscribe(t,e);if(Mn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new Bt(et.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Bt(et.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===t)){const u=new Bt(et.INVALID_REMOTE_USER,"user is not in the channel");throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),u}if(!t.hasAudio&&!t.hasVideo){const u=new Bt(et.INVALID_REMOTE_USER,"user is not published");throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),u}if(!(r||(e!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(e!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const u=new Bt(et.REMOTE_USER_IS_NOT_PUBLISHED);throw C.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),u}let i=e==="audio"?t._audioSSRC:t._videoSSRC,o=e==="audio"?t._audioOrtc:t._videoOrtc,s=e==="video"?t._rtxSsrcId:void 0,c={stream_type:e==="audio"?Ue.AUDIO:Ue.VIDEO,ssrcId:i};e==="video"&&this.store.firstVideoFrameDecoded(t.uid,{subscribeStart:Date.now()});const d=await this._subscribeMutex.lock();C.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const l=e==="audio"?t._audioSSRC:t._videoSSRC;l!==void 0&&l!==i&&(i=l,o=e==="audio"?t._audioOrtc:t._videoOrtc,s=e==="video"?t._rtxSsrcId:void 0,c={stream_type:e==="audio"?Ue.AUDIO:Ue.VIDEO,ssrcId:i}),ui.markSubscribeStart(this.store.clientId,i),this.store.subscribe(t.uid,e,Date.now()),await this._p2pChannel.subscribe(t,e,i,s,o);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(t.uid,c,!0)}catch(T){if(T?.code!==et.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,e),T;await this._p2pChannel.unsubscribe(t,e,!0),this._p2pChannel.setPendingRemoteMedia(t,e)}this.store.subscribe(t.uid,e,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,e)}catch(l){throw this._p2pChannel.reportSubscribeEvent(!1,l?.code,t,e),l}C.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(l=>{C.warning("[".concat(this._clientId,"] auto set fallback failed"),l)});const u=e==="audio"?t._audioTrack:t._videoTrack;if(!u)throw new Bt(et.UNEXPECTED_ERROR,"can not find remote track in user object");return e==="video"&&(this.store.firstVideoFrameDecoded(t.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(t)),u}catch(u){throw C.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),u),u}finally{d()}}async massSubscribe(t){if(qs(t,"subscribeList"),!this._joinInfo)throw new Bt(et.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Bt(et.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const e=Date.now(),r=new Map,n=await this._subscribeMutex.lock();C.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(c=>{let{user:d,mediaType:u}=c;return"user: ".concat(d?.uid,", mediaType: ").concat(u)}).join("; ")));const i=(t=[...t]).map(c=>{let{user:d,mediaType:u}=c;return{user:d,mediaType:u}}),o=await this._p2pChannel.globalLock();try{var s;for(let d=t.length-1;d>=0;d--){const u=t[d],{user:l,mediaType:T}=u;if(Mn(T,"mediaType",["audio","video"]),!l){const N=new Bt(et.INVALID_PARAMS,"user property does not exist in subscribeList item");throw C.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),N}if(!this._users.find(N=>N===l)){const N=new Bt(et.INVALID_REMOTE_USER,"user is not in the channel");C.error("[".concat(this._clientId,"] can not massSubscribe ").concat(l.uid,", this user is not in the channel")),i[d].error=N,t.splice(d,1);continue}if(T==="audio"&&(!l.hasAudio||l._audioSSRC===void 0)||T==="video"&&(!l.hasVideo||l._videoSSRC===void 0)){const N=new Bt(et.REMOTE_USER_IS_NOT_PUBLISHED);C.error("[".concat(this._clientId,"] can not subscribe ").concat(l.uid," with mediaType ").concat(T,", remote user is not published")),i[d].error=N,t.splice(d,1);continue}const y=jn.Video|jn.LwoVideo,x=r.get(l);if(x){if(T==="video"?x&y:x&jn.Audio){t.splice(d,1),C.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(l.uid,", mediaType:").concat(T," twice"));continue}r.set(l,x|(T==="video"?y:jn.Audio))}else r.set(l,T==="video"?y:jn.Audio)}for(let d=t.length-1;d>=0;d--){const u=t[d],{user:l,mediaType:T}=u,v=jn.Video|jn.LwoVideo;if(this._p2pChannel.hasRemoteMedia(l,T)){await this._p2pChannel.unmuteRemoteNoLock(l,T);const y=r.get(l);r.set(l,T==="video"?y^v:y^jn.Audio),t.splice(d,1)}}this.store.massSubscribe(t.map(d=>({userId:d.user.uid,type:d.mediaType})),e);let c=Ao(s=Array.from(r.entries())).call(s,(d,u)=>{let[l,T]=u;if(T===0)return d;const v={stream_id:l.uid,stream_type:T};return T&jn.Audio&&(v.audio_ssrc=l._audioSSRC),T&jn.Video&&(v.video_ssrc=l._videoSSRC),d.push(v),d},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(u=>{let{user:l,mediaType:T}=u;return{user:l,mediaType:T,ssrcId:T===Ue.VIDEO?l._videoSSRC:l._audioSSRC,rtxSsrcId:T===Ue.VIDEO?l._rtxSsrcId:void 0}}));const d=new Map;if(c=c.filter(u=>u.video_ssrc&&!this._p2pChannel.isPreSubScribe(u.video_ssrc)||u.audio_ssrc&&!this._p2pChannel.isPreSubScribe(u.audio_ssrc)||!u.video_ssrc&&!u.audio_ssrc),c.length>0){const u=await this._gateway.subscribeAll(c,!0);(u?.users||[]).forEach(l=>{let{stream_id:T,video_error_code:v,audio_error_code:y,error_code:x}=l;(v||y||x)&&d.set(T,{video_error_code:v,audio_error_code:y,error_code:x})})}if(Array.from(d.entries()).length>0){const u=[];Array.from(d.entries()).forEach(l=>{let[T,v]=l;const y=this.remoteUsers.find(x=>x.uid===T);if(y){let x;v.error_code||v.video_error_code&&v.audio_error_code?x=void 0:v.video_error_code?x=Ue.VIDEO:v.audio_error_code&&(x=Ue.AUDIO),u.push({user:y,mediaType:x})}}),u.length>0&&await this._p2pChannel.massUnsubscribeNoLock(u)}for(const u of i){const l=d.get(u.user.uid);if(l){const T=l.error_code||u.mediaType==="audio"&&l.audio_error_code||u.mediaType==="video"&&l.video_error_code;if(T){const v=sl(T);C.error("user:".concat(u.user.uid," mediaType:").concat(u.mediaType," has massSubscribe error ").concat(v.desc)),u.error=new Bt(et.SUBSCRIBE_FAILED,"code ".concat(T,": ").concat(v.desc))}}u.error||(u.mediaType==="video"?u.track=u.user.videoTrack:u.track=u.user.audioTrack)}return this.store.massSubscribe(i.filter(u=>!u.error).map(u=>({userId:u.user.uid,type:u.mediaType})),void 0,Date.now()),i.forEach(u=>{var l;qe.subscribe(this.store.sessionId,{succ:!!u.error,ec:((l=u.error)===null||l===void 0?void 0:l.code)||null,video:u.mediaType===Ue.VIDEO,audio:u.mediaType===Ue.AUDIO,peerid:u.user.uid,subscribeRequestid:u.mediaType===Ue.VIDEO?u.user._videoSSRC:u.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-e),preSsrc:this._p2pChannel.isPreSubScribe(u.user._videoSSRC)},!0)}),C.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(u=>{let{user:l,mediaType:T}=u;return"user: ".concat(l?.uid,", mediaType: ").concat(T)}).join("; "))),i}catch(d){throw await this._p2pChannel.massUnsubscribeNoLock(t),d}}finally{o(),n()}}async unsubscribe(t,e,r){if(!(t instanceof Ma)){const o=this.remoteUsers.find(s=>s.uid===t);if(!o)throw new Bt(et.INVALID_REMOTE_USER,"user is not in the channel");t=o}if(e||this.store.useP2P){if(e==="datachannel")return this._unsubscribeDataChannel(t,r)}else await this._unsubscribeDataChannel(t,r);if(e&&Mn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new Bt(et.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(o=>o===t)){const o=new Bt(et.INVALID_REMOTE_USER,"user is not in the channel");throw C.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),o}C.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(e));const i=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,e);else{const o=await this._p2pChannel.unsubscribe(t,e);o&&await this._gateway.unsubscribe(o,t.uid),e&&e!=="audio"||(t._audio_pre_subscribed=!1),e&&e!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&Rp(this._users,t),C.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(e))}}catch(o){if(o.code===et.DISCONNECT_P2P)return void C.warning("disconnecting p2p, abort unsubscribe request.");throw C.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),o.toString()),o}finally{i()}}async _unsubscribeDataChannel(t,e){if(e&&Hr(e,"id",0,65535,!0),!this._joinInfo)throw new Bt(et.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(i=>i===t)){const i=new Bt(et.INVALID_REMOTE_USER,"user is not in the channel");throw C.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),i}let n;if(typeof e=="number"){const i=t._dataChannels.find(o=>o.id===e);i&&(n=[i])}else n=t._dataChannels;if(n===void 0){const i=new Bt(et.REMOTE_USER_IS_NOT_PUBLISHED);throw C.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(e,", remote datachannel is not published")),i}C.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(n.map(i=>i.id)));try{const i=await this._p2pChannel.unsubscribeDataChannel(t,n);i&&await this._gateway.unsubscribeDataChannel(i,t.uid),C.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(i))}catch(i){if(i.code===et.DISCONNECT_P2P)return void C.warning("disconnecting p2p, abort unsubscribe request.");throw C.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),i.toString()),i}}async massUnsubscribe(t){if(qs(t,"unsubscribeList"),!this._joinInfo)throw new Bt(et.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");C.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(r=>{let{user:n,mediaType:i}=r;return"user: ".concat(n?.uid,", mediaType: ").concat(i,";")}).join())),t=[...t];const e=new Map;for(let r=t.length-1;r>=0;r--){const{user:n,mediaType:i}=t[r];if(!n){const c=new Bt(et.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw C.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),c}if(Mn(i,"mediaType",["video","audio",void 0]),!this._users.find(c=>c===n)){C.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(n.uid,", user is not in the channel")),t.splice(r,1);continue}const s=jn.Video|jn.LwoVideo;if(e.has(n)){const c=e.get(n);let d;switch(i){case"video":d=c&s;break;case"audio":d=c&jn.Audio;break;default:d=c&(jn.Audio|s)}if(d){C.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(n.uid,",mediaType:").concat(i," twice.")),t.splice(r,1);continue}i?i==="audio"?e.set(n,c|jn.Audio):i==="video"&&e.set(n,c|s):e.set(n,c|jn.Audio|s)}else i?i==="audio"?e.set(n,jn.Audio):i==="video"&&e.set(n,s):e.set(n,jn.Audio|s)}try{const r=await this._p2pChannel.massUnsubscribe(t);r&&await this._gateway.massUnsubscribe(r),C.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(n=>{let{user:i,mediaType:o}=n;return"user: ".concat(i?.uid,", mediaType: ").concat(o,";")}).join()))}catch(r){if(r.code===et.DISCONNECT_P2P)return void C.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw C.error("[".concat(this._clientId,"] massUnsubscribe error"),r.toString()),r}}async setLowStreamParameter(t){(function(r){if(!r)throw new Qt(et.INVALID_PARAMS);_n(r.width)||BE(r.width,"streamParameter.width"),_n(r.height)||BE(r.height,"streamParameter.height"),_n(r.framerate)||BE(r.framerate,"streamParameter.framerate"),_n(r.bitrate)||Hr(r.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&C.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),C.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const e=this._configDistribute.getLowStreamConfigDistribute();if(e&&e.bitrate&&t.bitrate&&e.bitrate<t.bitrate&&(t.bitrate=e.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,_e.LocalVideoLowTrack)}async enableDualStream(){if(!br().supportDualStream)throw qe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Bt(et.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Bt(et.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw qe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,qe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),C.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Bt(et.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(_e.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw qe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,qe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),C.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,e){if(function(n){Mn(n,"role",["audience","host"])}(t),e&&WE(e),this.mode==="rtc"||this.mode==="p2p")throw C.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Bt(et.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(e&&e.level&&t==="host")throw new Bt(et.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new Bt(et.INVALID_OPERATION,"can not set client role to audience when publishing stream");const r=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==r&&st("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,e),this._config.role=t,this._gateway.reconnect("recover",ri.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,e),this._config.role=t),C.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(e&&e.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let e=!1;try{t&&WE(t),await this._gateway.setClientRole(this._config.role,t),e=!0}catch{}finally{C.info("[".concat(this._clientId,"] set client role options ").concat(e?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const e=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!e||!e.timestamp)return 0;const r=e.timestamp-Date.now();return Math.abs(r)>1e3+e.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?r:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,e){if(qn(t,"proxyServer"),!e){if(this.connectionState!=="DISCONNECTED")throw new Bt(et.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Bt(et.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,qe.setProxyServer(this._proxyServer),C.setProxyServer(this._proxyServer),C.info("[".concat(this._clientId,"] Set proxy server ").concat(e?"by initialize call":""," success."))}setTurnServer(t,e){if(Array.isArray(t)||(t=[t]),!e){if(this.connectionState!=="DISCONNECTED")throw new Bt(et.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Bt(et.INVALID_OPERATION,"You have already set the proxy")}if(Yu(t))return this._turnServer={servers:t,mode:"original-manual"},void C.info("[".concat(this._clientId,"] Set original turnserver ").concat(e?"by initialize call":""," success: ").concat(t.map(r=>r.urls).join(","),"."));t.forEach(r=>H0(r)),this._turnServer={servers:t,mode:"manual"},C.info("[".concat(this._clientId,"] Set turnserver ").concat(e?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new Bt(et.INVALID_OPERATION,"you should set license before join channel");if(qn(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new Bt(et.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,C.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new Bt(et.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Bt(et.INVALID_OPERATION,"You have already set the proxy");const e=[3,4,5];let r;switch(t===void 0&&(t=3),t){case 1:case 2:throw new Bt(et.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:r="proxy3";break;case 4:r="proxy4";break;case 5:r="proxy5";break;default:throw new Bt(et.INVALID_PARAMS,"proxy server mode must be ".concat(e.join("|")))}this._cloudProxyServerMode=r,this.store.cloudProxyServerMode=r,C.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Bt(et.INVALID_OPERATION,"Stop proxy server after leave channel");qe.setProxyServer(),C.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",C.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new Bt(et.INVALID_PARAMS,"accessPoints is required.");qs(t.accessPoints.serverList,"accessPoints.serverList"),qn(t.accessPoints.domain,"accessPoints.domain");const e=(v,y)=>{Hr(v,y,0,65535,!0)};let r=443;if(t.accessPoints.port&&(e(t.accessPoints.port,"accessPoints.port"),r=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Bt(et.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");st("CLOSE_AFB_FOR_LOCAL_AP")&&(Br("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Br("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const n=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=t.accessPoints.domain,o=t.accessPoints.serverList.map(v=>n.test(v)?"".concat(v.replace(/\./g,"-"),".").concat(i):v),s=o.map(v=>"".concat(v,":").concat(r));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Br("WEBCS_DOMAIN",s),Br("WEBCS_DOMAIN_BACKUP_LIST",s),Br("GATEWAY_DOMAINS",[i]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(qs(t.report.hostname,"report.hostname"),Br("EVENT_REPORT_DOMAIN",t.report.hostname[0]),Br("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(Br("EVENT_REPORT_DOMAIN",o[0]),Br("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]));let c=6443;t.report&&t.report.port&&(e(t.report.port,"report.port"),c=t.report.port),Br("STATS_COLLECTOR_PORT",c),t.report?Br("ENABLE_EVENT_REPORT",!0):Br("ENABLE_EVENT_REPORT",!1);let d="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(qs(t.log.hostname,"log.hostname"),d=t.log.hostname[0]):d=o[0];let u=6444;t.log&&t.log.port&&(e(t.log.port,"log.port"),u=t.log.port),Br("LOG_UPLOAD_SERVER","".concat(d,":").concat(u));let l=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(qs(t.cds.hostname,"cds.hostname"),l=t.cds.hostname):l=o;let T=443;t.cds&&t.cds.port&&(e(t.cds.port,"cds.port"),T=t.cds.port),Br("CDS_AP",l.map(v=>"".concat(v,":").concat(T))),t.cds?Br("ENABLE_CONFIG_DISTRIBUTE",!0):Br("ENABLE_CONFIG_DISTRIBUTE",!1),C.info("set local access point v2 success")}setLocalAccessPoints(t,e){if(qs(t,"serverList"),qn(e,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Bt(et.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const r=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(n=>r.test(n)?"".concat(n.replace(/\./g,"-"),".").concat(e):n),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Br("WEBCS_DOMAIN",t),Br("WEBCS_DOMAIN_BACKUP_LIST",t),Br("GATEWAY_DOMAINS",[e]),Br("EVENT_REPORT_DOMAIN",t[0]),Br("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),Br("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),C.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Mn(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw C.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else C.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,e){Mn(e,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,e),setTimeout(()=>{const r=this._users.find(n=>n.uid===t);r&&r.videoTrack&&r.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(r){throw C.error("[".concat(this._clientId,"] set remote video stream type error"),r.toString()),r}C.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(e)),this._remoteStreamTypeCacheMap.set(t,e)}async setStreamFallbackOption(t,e){Mn(e,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,e)}catch(r){throw C.error("[".concat(this._clientId,"] set stream fallback option"),r.toString()),r}C.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(e)),this._streamFallbackTypeCacheMap.set(t,e)}setEncryptionConfig(t,e,r,n){(function(o){Mn(o,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),qn(e,"secret");const i=["aes-128-gcm2","aes-256-gcm2"];if(Ce(i).call(i,t)){if(!r||!(r instanceof Uint8Array&&r.length===32))throw new Bt(et.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(r)throw new Bt(et.INVALID_PARAMS,"current encrypt mode does not need salt");if(n){if(ns(n,"encryptDataStream"),!Ce(i).call(i,t))throw new Bt(et.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(e)||C.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=e,r&&(this._encryptionSalt=Ia(r))}async renewToken(t){if(qn(t,"token",1,2047),!this._key||!this._joinInfo)throw new Bt(et.INVALID_OPERATION,"renewToken should not be called before user join");const e=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const r=await this._renewTokenMutex.lock();try{if(st("USE_NEW_TOKEN")){C.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const n=await HH(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||bn);C.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:n})}else C.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});C.debug("[".concat(this._clientId,"] renewToken success"))}catch(n){throw this._key=e,this._joinInfo.token=e,C.error("[".concat(this._clientId,"] renewToken failed"),n.toString()),n}finally{r()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?C.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(vr.VOLUME_INDICATOR,t)},st("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),e=this._gateway.getInChannelInfo();return t.Duration=Math.round(e.duration/1e3),t}async startLiveStreaming(t,e){if(!e){if(this.codec!=="h264")throw new Bt(et.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Bt(et.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new Bt(et.LIVE_STREAMING_TASK_CONFLICT);const r=e?Ys.TRANSCODE:Ys.RAW;return this._createLiveStreamingClient(r).startLiveStreamingTask(t,r)}setLiveTranscoding(t){return this._createLiveStreamingClient(Ys.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const e=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(r=>r&&r.hasUrl(t));if(!e.length)throw new Bt(et.INVALID_PARAMS,"can not find live streaming url to stop");await De.all(e.map(r=>r&&r.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){Nw(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){Nw(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof _l&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var e;let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Bt(et.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const i=new TextEncoder;t.payload=i.encode(t.payload)}let n=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ce(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)&&(n=!0,t.payload=await async function(i,o,s){var c;const d=Ao(c=Array.from(s)).call(c,(N,L)=>N+L,0),u={serverTs:0,seq:u6++,length:s.length,checkSum:d},l=new Uint8Array(Z0(d,2)),T=new ArrayBuffer(Sd),v=new DataView(T);v.setUint32(0,u.serverTs),v.setUint16(4,u.seq),v.setUint16(6,u.length),v.setUint16(8,u.checkSum);const y=16-s.length%16;s=z0(s,new Uint8Array(y));const x=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i,tagLength:uA,additionalData:l},o,s);return z0(new Uint8Array(T),new Uint8Array(x))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new Bt(et.INVALID_PARAMS,n?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(sr.DATA_STREAM,{payload:Ia(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-ZH},!r)}sendMetadata(t){if(!this._joinInfo)throw new Bt(et.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new Bt(et.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(sr.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Ia(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(T6),!this._joinInfo)throw new Bt(et.INVALID_OPERATION,"can not send custom report, not joined");await qe.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const t=this._statsCollector.getRemoteNetworkQualityStats();if(st("DELETE_NEQ_AFTER_USER_LEAVE")){const e=this._users.map(r=>r.uid+"");Object.keys(t).forEach(r=>{Ce(e).call(e,r)||delete t[r]})}return t}async pickSVCLayer(t,e){Mn(e.spatialLayer,"spatialLayer",[0,1,2,3]),Mn(e.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,e)}catch(r){throw C.error("[".concat(this._clientId,"] pick SVC layer failed"),r.toString()),r}}async setRTMConfig(t){const{apRTM:e=!1,rtmFlag:r}=t;if(ns(e,"apRTM"),Hr(r,"rtmFlag",0),this._rtmConfig.apRTM=e,this._rtmConfig.rtmFlag=r,C.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=e,this._joinInfo.rtmFlag=r,this._gateway.setRTM2Flag(r)}_reset(){if(C.debug("[".concat(this._clientId,"] reset client")),function(t){const e=Ld.indexOf(t);e!==-1&&Ld.splice(e,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=bi.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&rN(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&qe.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(e=>e._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new si("client-publish",this._clientId),this._subscribeMutex=new si("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,e){var r;const n=t||lc();t?C.debug("[".concat(this._clientId,"] new Session ").concat(n)):C.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(n));const i=t?"":this._sessionId||"";this._sessionId=n,this.store.sessionId=n,qe.addSid(n);const o={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:e?.stringUid||((r=this._joinInfo)===null||r===void 0?void 0:r.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:this.role==="audience"?2:1};qe.sessionInit(this._sessionId,Go({cname:e.channel,appid:e.appId},o)),this._joinInfo&&(this._joinInfo.sid=n),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=n)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new Bt(et.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Bt(et.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&st("FORCE_TURN")&&!st("TURN_ENABLE_TCP")&&!st("TURN_ENABLE_UDP"))throw new Bt(et.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");C.debug("[".concat(this._clientId,"] publish high stream"));try{const r=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const n=(await r.next()).value;if(n){try{await this._gateway.sendExtensionMessage(Sn.PUBLISH,n,!0)}catch(i){throw r.throw(i),i}await r.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const n=(await r.next()).value;if(n){var e;let i;try{i=await this._gateway.publish(this._uid,n,!0)}catch(o){if(o.code!==et.DISCONNECT_P2P)throw r.throw(o),o}await r.next(((e=i)===null||e===void 0?void 0:e.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const i of t)i instanceof Zr&&i._encoderConfig&&this._gateway.setVideoProfile(i._encoderConfig).catch(o=>{C.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!i.muted&&i.enabled||await this._p2pChannel.muteLocalTrack(i)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r?.code,t),r?.code===et.WS_ABORT)return;throw r}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Bt(et.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Bt(et.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));C.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const r=await this._p2pChannel.publishLowStream(this._lowStreamParameter),n=(await r.next()).value;if(n){var e;let i;try{i=await this._gateway.publish(this._uid,n,!0)}catch(o){if(o.code!==et.DISCONNECT_P2P)throw r.throw(o),o}r.next(((e=i)===null||e===void 0?void 0:e.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r?.code,void 0,!0),r?.code===et.WS_ABORT)return;throw r}}_createLiveStreamingClient(t){const e=()=>{if(!this._joinInfo||!this._appId)return new Bt(et.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const r=(n={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Zs("LiveStreaming").create(n));var n;return r.onLiveStreamError=(i,o)=>{qe.reportApiInvoke(this._sessionId,{name:vn.ON_LIVE_STREAM_ERROR,options:[i,o],tag:cn.TRACER}).onSuccess(),this.safeEmit(vr.LIVE_STREAMING_ERROR,i,o)},r.onLiveStreamWarning=(i,o)=>{qe.reportApiInvoke(this._sessionId,{name:vn.ON_LIVE_STREAM_WARNING,options:[i,o],tag:cn.TRACER}).onSuccess(),this.safeEmit(vr.LIVE_STREAMING_WARNING,i,o)},r.on(Vg.REQUEST_WORKER_MANAGER_LIST,(i,o,s)=>{if(!this._joinInfo)return s(new Bt(et.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(c,d,u,l){const T=st("UAP_AP").slice(0,st("AJAX_REQUEST_CONCURRENT")).map(v=>d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(v+"/api/v1?action=uap"):"https://".concat(v,"/api/v1?action=uap"));return await UH(T,c,d,u,l)})(i,this._joinInfo,this._axiosCancelSource.token,bn).then(o).catch(s)}),r};return t===Ys.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||e(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||e(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Bt(et.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:r}=this.getLocalVideoStats(),n=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:e,height:r}},Zs("ChannelMediaRelay").create(t));n.on("state",i=>{i===Mi.RELAY_STATE_FAILURE&&n&&n.dispose(),this.safeEmit(vr.CHANNEL_MEDIA_RELAY_STATE,i)}),n.on("event",i=>{this.safeEmit(vr.CHANNEL_MEDIA_RELAY_EVENT,i)}),this._channelMediaRelayClient=n,this._statsCollector.onStatsChanged=(i,o)=>{var s;i==="resolution"&&((s=this._channelMediaRelayClient)===null||s===void 0||s.setVideoProfile(o))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,e){const{added:r,deleted:n}=t,i=[];if(e){const o=[];this._users.forEach(s=>{s._dataChannels.forEach(c=>{r.every(d=>d.uid!==s._uintid||d.stream_id!==c.id)&&o.push({uid:s._uintid,stream_id:c.id,ordered:c.ordered,max_retrans_times:c.maxRetransmits,metadata:c.metadata})})}),o.length>0&&this._handleUpdateDataChannel({added:[],deleted:o})}Array.isArray(r)&&r.length>0&&r.forEach(o=>{const{uid:s,stream_id:c,ordered:d,max_retrans_times:u,metadata:l}=o,T=this._users.find(v=>v._uintid===s);if(!T)return void C.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(C.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(s)),Ce(i).call(i,T)||i.push(T),T._uintid||(T._uintid=s),T._dataChannels.findIndex(v=>v.id===o.stream_id)===-1){const v={id:c,ordered:!!d,maxRetransmits:u,metadata:l},y=function(x){return fw(x,!0)}(v);T._dataChannels.push(y),C.info("[".concat(this._clientId,"] remote user ").concat(T.uid," published datachannel")),e||this.safeEmit(vr.USER_PUBLISHED,T,"datachannel",v)}this._p2pChannel.hasPendingRemoteDataChannel(T,o.stream_id)&&(C.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(T.uid," after reconnect.")),this._subscribeDataChannel(T,o.stream_id).catch(v=>{C.error("[".concat(this._clientId,"] resubscribe datachannel error"),v.toString())}))}),e&&(this.safeEmit(vr.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(n)&&n.length>0&&n.forEach(o=>{const{uid:s,stream_id:c}=o,d=this._users.find(l=>l._uintid===s);if(!d)return void C.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const u=d._dataChannels.find(l=>l.id===o.stream_id);u&&(C.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(s)),this._p2pChannel.unsubscribeDataChannel(d,[u]).then(l=>{if(d._dataChannels=d._dataChannels.filter(T=>T!==u),l)return this._gateway.unsubscribeDataChannel(l,d.uid)}),C.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished datachannel ,id:").concat(u.id)),this.safeEmit(vr.USER_UNPUBLISHED,d,"datachannel",u._config))})}_getEncodingName(t){var e;if(!this._joinResponse)return;const r=(e=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||e===void 0?void 0:e.videoCodecs;if(r)for(const i of r){var n;if(i.payloadType===t)return i==null||(n=i.rtpMap)===null||n===void 0?void 0:n.encodingName}}_handleRemoveDataChannels(t){const e=this._users.find(r=>r.uid===t.uid);if(e){if(e._dataChannels!==void 0&&e._dataChannels.length>0){C.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const r=()=>{C.info("[".concat(this._clientId,"] remote user ").concat(e.uid," unpublished datachannel")),e._dataChannels.forEach(n=>{this.safeEmit(vr.USER_UNPUBLISHED,e,"datachannel",n._config)})};this._p2pChannel.unsubscribeDataChannel(e,e._dataChannels).then(n=>{if(n)return this._gateway.unsubscribeDataChannel(n,e.uid)}),r()}}else C.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Gn.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void C.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),r=Date.now();Object.keys(e).forEach(n=>{const{value:i,type:o,expires:s}=e[n];s&&s<=r||o||Pg()||!Object.prototype.hasOwnProperty.call(wp,n)||(os[n]=i,rn[n]=i,C.debug("Update gateway parameters from config distribute",n,i))})}catch(e){C.error("Error update config from local cache",e.message)}})()}),this._gateway.on(Gn.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Gn.CONNECTION_STATE_CHANGE,(t,e,r)=>{var n;if(r===Lr.FALLBACK)return;const i=()=>{this.safeEmit(vr.CONNECTION_STATE_CHANGE,t,e,r)};if(qe.reportApiInvoke(this._sessionId||((n=this._gateway.joinInfo)===null||n===void 0?void 0:n.sid)||null,{name:vn.CONNECTION_STATE_CHANGE,options:[t,e,r],tag:cn.TRACER}).onSuccess(JSON.stringify({cur:t,prev:e,reason:r})),C.info("[".concat(this._clientId,"] signal connection state change: ").concat(e," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void i();if(t==="RECONNECTING")this._users.forEach(s=>{s._trust_in_room_=!1,s._trust_audio_enabled_state_=!1,s._trust_video_enabled_state_=!1,s._trust_audio_mute_state_=!1,s._trust_video_mute_state_=!1,s._trust_audio_stream_added_state_=!1,s._trust_video_stream_added_state_=!1,s._is_pre_created||(s._audio_pre_subscribed||(s._audioSSRC=void 0,s._audioOrtc=void 0),s._video_pre_subscribed||(s._videoSSRC=void 0,s._videoOrtc=void 0,s._rtxSsrcId=void 0),s._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var o;this._streamFallbackTypeCacheMap.forEach((s,c)=>{this._gateway.setStreamFallbackOption(c,s).catch(d=>{C.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),d)})}),this._remoteStreamTypeCacheMap.forEach((s,c)=>{this._gateway.setRemoteVideoStreamType(c,s).catch(d=>{C.warning("[".concat(this._clientId,"] auto set remote stream type failed"),d)})}),this._remoteDefaultVideoStreamType!==void 0&&((o=this._joinInfo)===null||o===void 0?void 0:o.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{C.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(s=>{C.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(s))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(s=>!s._trust_in_room_).forEach(s=>{C.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(s.uid)),this._handleUserOffline({uid:s.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(s=>{s._trust_audio_mute_state_||(C.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(s.uid)),this._handleMuteStream(s.uid,Ue.AUDIO,!1)),s._trust_video_mute_state_||(C.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(s.uid)),this._handleMuteStream(s.uid,Ue.VIDEO,!1)),s._trust_audio_enabled_state_||(C.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(s.uid)),this._handleSetStreamLocalEnable("audio",s.uid,!0)),s._trust_video_enabled_state_||(C.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(s.uid)),this._handleSetStreamLocalEnable("video",s.uid,!0)),s._trust_video_stream_added_state_||(C.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(s.uid)),this._handleResetAddStream(s,"video")),s._trust_audio_stream_added_state_||(C.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(s.uid)),this._handleResetAddStream(s,"audio")),s._video_added_||s._audio_added_||(C.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(s.uid)),this._handleRemoveStream({uid:s.uid,uint_id:s._uintid}))}))},1e3))}i()}),this._gateway.on(Gn.REQUEST_NEW_GATEWAY_LIST,async(t,e)=>{if(!this._joinInfo)return e(new Bt(et.UNEXPECTED_ERROR,"can not recover, no join info"));try{let r;const n=await tN(Go(Go({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));n?(r=n.ap,nN(n),this._joinInfo.preload=!0):(r=await tT(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||bn,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=r.gatewayInfo.res,this._joinInfo.gatewayAddrs=r.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=r.gatewayInfo.uni_lbs_ip);const i=[];r.gatewayInfo.gatewayAddrs.forEach(o=>{let{address:s}=o;const[c,d]=s.split(":");this._joinInfo&&this._joinInfo.proxyServer?i.push({proxy:this._joinInfo.proxyServer,host:c,port:d}):i.push({host:c,port:d})}),t(i)}catch(r){e(r)}}),this._gateway.on(Gn.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(vr.NETWORK_QUALITY,t)}),this._gateway.on(Gn.STREAM_TYPE_CHANGE,(t,e)=>{this.safeEmit(vr.STREAM_TYPE_CHANGED,t,e),qe.reportApiInvoke(this._sessionId,{name:vn.STREAM_TYPE_CHANGE,options:[t,e],tag:cn.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:e}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(Gn.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(Gn.REQUEST_P2P_CONNECTION_PARAMS,async(t,e,r)=>{try{let n=await this._p2pChannel.getEstablishParams();n&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(n=await this._p2pChannel.startP2PConnection(t)),e(n)}catch(n){r(n)}}),this._gateway.on(Gn.JOIN_RESPONSE,(t,e)=>{if(this.store.useP2P)return;let r;this._joinResponse=t,t.attributes?r=t.attributes.userAttributes.preSubSsrcs:C.debug("no attributes in joinResponse");const n=rw(t.ortc,e,r);this._p2pChannel.connect(n)}),this._gateway.on(Gn.PRE_CONNECT_PC,async t=>{const{candidates:e,fingerprint:r,turnServer:n}=t;if(this._joinInfo&&e.length>0&&!this._p2pChannel.isPlanB){const{cert:o,cid:s}=this._joinInfo.apResponse,c="".concat(s,"_").concat(o);if(c.length<4||c.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:n,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var i;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(s,"_").concat(o),icePwd:"".concat(s,"_").concat(o)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(i=st("FINGERPRINT"))!==null&&i!==void 0?i:r}]},candidates:e,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(d){d.code&&d.code===et.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:n,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on(yr.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(yr.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(yr.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.pt,t.uint_id,t.ortc)),this._gateway.signal.on(yr.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.pt,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(yr.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(yr.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(yr.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(yr.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(yr.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,Ue.AUDIO,!0)),this._gateway.signal.on(yr.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,Ue.AUDIO,!1)),this._gateway.signal.on(yr.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,Ue.VIDEO,!0)),this._gateway.signal.on(yr.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,Ue.VIDEO,!1)),this._gateway.signal.on(yr.RECEIVE_METADATA,t=>{const e=uc(t.metadata);this.safeEmit(vr.RECEIVE_METADATA,t.uid,e)}),this._gateway.signal.on(yr.ON_DATA_STREAM,async t=>{var e;if(!t)return;let r=uc(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ce(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)){if(t.payload.length<Sd)throw new Bt(et.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(Sd));r=await async function(o,s,c){const d=c.subarray(0,Sd),u=d.slice(8,Sd),l=(u[0]<<8)+u[1],T=(d[6]<<8)+d[7],v=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:o,tagLength:uA,additionalData:new Uint8Array(Z0(l,2))},s,c.subarray(Sd));return new Uint8Array(v).subarray(0,T)}(this._encryptDataStreamIv,this._encryptDataStreamKey,r)}let n=0;if(t.ordered||t.syncWithAudio){const i=this._p2pChannel.getStats(),o=this.remoteUsers.find(c=>c.uid===t.uid),s=i?.audioRecv.find(c=>c.ssrc===o?._audioSSRC);n=s?.jitterBufferMs}(n==null||Number.isNaN(n))&&(n=0),$H(Go(Go({},t),{},{payload:r}),n,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(yr.ON_CRYPT_ERROR,()=>{Ra(()=>{C.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(vr.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(yr.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(yr.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{C.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Lr.TOKEN_EXPIRE),this.safeEmit(vr.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(yr.ON_STREAM_FALLBACK_UPDATE,t=>{C.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(vr.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(yr.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),C.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(yr.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(yr.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(cr.REQUEST_TIMEOUT,(t,e)=>{if(this._joinInfo)switch(t){case sr.PUBLISH:{if(!e)return;const i=e.ortc;if(i){var r,n;const o=i.some(d=>{let{stream_type:u}=d;return u===Ur.Audio}),s=i.some(d=>{let{stream_type:u}=d;return u!==Ur.Audio}),c=i.some(d=>{let{stream_type:u}=d;return u===Ur.Screen||u===Ur.ScreenLow});e.state==="offer"&&qe.publish(this._joinInfo.sid,{eventElapse:ui.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:et.TIMEOUT,audio:o,video:s,p2pid:e.p2p_id,publishRequestid:this.store.pubId,screenshare:c,audioName:o?(r=i.find(d=>{let{stream_type:u}=d;return u===Ur.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0,videoName:s?(n=i.find(d=>{let{stream_type:u}=d;return u!==Ur.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0})}break}case sr.SUBSCRIBE:e&&qe.subscribe(this._joinInfo.sid,{succ:!1,ec:et.TIMEOUT,audio:e.stream_type===Ue.AUDIO,video:e.stream_type===Ue.VIDEO,peerid:e.stream_id,subscribeRequestid:e.ssrcId,p2pid:this.store.p2pId,eventElapse:ui.measureFromSubscribeStart(this.store.clientId,e.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(e.ssrcId)})}}),this._gateway.signal.on(yr.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(yr.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;st("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(n=>!Tc(n.string_id||n.stream_id,this.channelName)));const e=[],r=[];for(const n of t.users){let i=this._users.find(l=>l._uintid===n.stream_id);i?i._trust_in_room_=!0:(i=new Ma(n.string_id||n.stream_id,n.stream_id),this._users.push(i),this.store.firstVideoFrameDecoded(i.uid,{userJoinNotify:Date.now()}),this.getListeners(vr.PUBLISHED_USER_LIST).length===0&&(C.debug("[".concat(this._clientId,"] user online"),n.stream_id),this.safeEmit(vr.USER_JOINED,i)));const o=jn.Audio&n.stream_type,s=(jn.Video|jn.LwoVideo)&n.stream_type,c=(65280&n.stream_type)!=0,d=o&&i.hasAudio,u=s&&i.hasVideo;s&&(i._trust_video_stream_added_state_=!0,i._video_added_=!0,i._videoSSRC=n.video_ssrc,i._rtxSsrcId=n.video_rtx),o&&(i._trust_audio_stream_added_state_=!0,i._audio_added_=!0,i._audioSSRC=n.audio_ssrc),o&&!d&&this.getListeners(vr.PUBLISHED_USER_LIST).length===0&&(C.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published audio")),this.safeEmit(vr.USER_PUBLISHED,i,"audio")),s&&!u&&this.getListeners(vr.PUBLISHED_USER_LIST).length===0&&(C.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published video")),this.safeEmit(vr.USER_PUBLISHED,i,"video")),(o&&!d||s&&!u||c)&&e.push(i),s&&this._p2pChannel.hasPendingRemoteMedia(i,"video")&&r.push({user:i,mediaType:"video"}),o&&this._p2pChannel.hasPendingRemoteMedia(i,"audio")&&r.push({user:i,mediaType:"audio"})}r.length>0&&(C.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(r.map(n=>"user: ".concat(n.user.uid,", mediaType: ").concat(n.mediaType)).join("; ")," ")),this.massSubscribe(r).catch(n=>{C.error("[".concat(this._clientId,"] mass resubscribe error"),n.toString())})),this.getListeners(vr.PUBLISHED_USER_LIST).length>0?st("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=e:(C.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(e.map(n=>n.uid).join(", "))),this.safeEmit(vr.PUBLISHED_USER_LIST,e)):C.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(e.map(n=>n.uid).join(", ")))}),this._gateway.signal.on(yr.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:e}=t;this._p2pChannel instanceof _l&&this._p2pChannel.updateRemoteRTPCapabilities(e.map(r=>r.toLowerCase()).filter(r=>{var n;return Ce(n=Object.keys($u)).call(n,r)}))})}_handleP2PEvents(){this._gateway.signal.on(yr.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Sn.PUBLISH,(t,e,r)=>{const{uid:n}=t;t.forEach(i=>{const{kind:o,ssrcs:s,mid:c,isMuted:d}=i;this._handleP2PAddAudioOrVideoStream(o,n,s[0].ssrcId,c);const u=this._users.find(l=>l.uid===n);return u&&this.store.useP2P?this._p2pChannel.mockSubscribe(u,o,s[0].ssrcId,c).then(()=>{e()}).catch(r):e(),this._handleMuteStream(n,o,!!d)})}),this._gateway.signal.on(Sn.CALL,async(t,e,r)=>{if(this.store.useP2P)try{var n;e(await this._p2pChannel.startP2P({turnServer:(n=this._joinInfo)===null||n===void 0?void 0:n.turnServer},t))}catch(i){r(i)}}),this._gateway.signal.on(cr.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(Sn.UNPUBLISH,async(t,e,r)=>{if(this.store.useP2P){const{unpubMsg:n,uid:i}=t,o=this._users.find(s=>s.uid===i);if(!o)return C.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void e();try{n.forEach(async s=>{let{stream_type:c}=s;const d=c===Ur.Audio?Ue.AUDIO:Ue.VIDEO;await this._p2pChannel.unsubscribe(o,d),this._handleMuteStream(i,d,!0)}),e()}catch(s){r(s)}}}),this._gateway.signal.on(Sn.CONTROL,async(t,e)=>{const{action:r}=t;switch(r){case Oa.MUTE_LOCAL_VIDEO:this._handleMuteStream(e,Ue.VIDEO,!0);break;case Oa.MUTE_LOCAL_AUDIO:this._handleMuteStream(e,Ue.AUDIO,!0);break;case Oa.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",e),this._handleMuteStream(e,Ue.VIDEO,!1);break;case Oa.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",e),this._handleMuteStream(e,Ue.AUDIO,!1)}}),this._gateway.signal.on(Sn.RESTART_ICE,async(t,e,r)=>{if(this.store.useP2P)try{const{direction:n,iceParameter:i}=t;n!==Ii.SEND_ONLY||i?e(await this._p2pChannel.restartICE(n,i)):(this._p2pChannel.handleDisconnect(n),e())}catch(n){r(n)}}),this._gateway.signal.on(Sn.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:e,direction:r}=t;this._p2pChannel.addRemoteCandidate(e,r)}}),this._p2pChannel.on($e.RequestP2PRestartICE,async(t,e,r)=>{try{const{direction:n}=t;e(await this._gateway.sendExtensionMessage(Sn.RESTART_ICE,t,n===Ii.SEND_ONLY))}catch(n){r(n)}}),this._p2pChannel.on($e.LocalCandidate,t=>{this._gateway.sendExtensionMessage(Sn.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on($e.RequestP2PMuteLocal,async(t,e,r)=>{try{await this._gateway.sendExtensionMessage(Sn.CONTROL,t,!0),e()}catch(n){r(n)}}),this._p2pChannel.on($e.RequestP2PUnmuteRemote,async(t,e,r)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(n){n.code===et.DISCONNECT_P2P?e():r(n)}else e()}),this._p2pChannel.on($e.RequestP2PMuteRemote,async(t,e,r)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(n){n.code===et.DISCONNECT_P2P?e():r(n)}else e()}),this._p2pChannel.on($e.StateChange,(t,e)=>{e===Mr.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on($e.PeerConnectionStateChange,t=>{const e=this._peerConnectionState;t!==e&&(this.safeEmit(vr.PEERCONNECTION_STATE_CHANGE,t,e),this._peerConnectionState=t)}),this._p2pChannel.on($e.RequestMuteLocal,async(t,e,r)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(n){n.code===et.DISCONNECT_P2P?e():r(n)}else e()}),this._p2pChannel.on($e.RequestUnmuteLocal,async(t,e,r)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(n){n.code===et.DISCONNECT_P2P?e():r(n)}else e()}),this._p2pChannel.on($e.RequestRePublish,(t,e,r)=>{this.publish(t,!1).then(e).catch(r)}),this._p2pChannel.on($e.RequestRePublishDataChannel,(t,e,r)=>{De.all(t.map(async n=>{const i=await this._p2pChannel.publishDataChannel([n]);try{i.forEach(o=>{this._uid&&this._gateway.publishDataChannel(this._uid,o,!0)})}catch(o){if(o.code!==et.DISCONNECT_P2P)throw o}})).then(e).catch(r)}),this._p2pChannel.on($e.RequestReSubscribe,async(t,e,r)=>{try{for(const{user:n,kind:i}of t)i===Ue.VIDEO?await this.subscribe(n,"video"):await this.subscribe(n,"audio");e()}catch(n){r(n)}}),this._p2pChannel.on($e.RequestUpload,(t,e)=>{this._gateway.upload(t,e)}),this._p2pChannel.on($e.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on($e.MediaReconnectStart,t=>{this.safeEmit(vr.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on($e.MediaReconnectEnd,t=>{this.safeEmit(vr.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on($e.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on($e.RequestRestartICE,async t=>{if(this.store.useP2P)return;const e=await this._p2pChannel.restartICE(t),r=await e.next();if(r.done)return;const n=r.value;let i;try{i=await this._gateway.restartICE({iceParameters:n})}catch(s){return void e.throw(s)}const{iceParameters:o}=function(s){const c=s.iceParameters;return{iceParameters:{iceUfrag:c.iceUfrag,icePwd:c.icePwd}}}(i);await e.next({remoteIceParameters:o})}),this._p2pChannel.on($e.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on($e.RequestReconnectPC,async()=>{var t;const{iceParameters:e,dtlsParameters:r,rtpCapabilities:n}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:i,gatewayAddress:o}=await this._gateway.reconnectPC({iceParameters:e,dtlsParameters:r,rtpCapabilities:n}),s=rw(i,o);await this._p2pChannel.connect(s),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on($e.RequestUnpublishForReconnectPC,async(t,e,r)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),e()):r()}),this._p2pChannel.on($e.P2PLost,()=>{this.safeEmit(vr.P2P_LOST,this.store.uid)}),this._p2pChannel.on($e.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on($e.ConnectionTypeChange,t=>{this.safeEmit(vr.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on($e.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on($e.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on($e.AudioMetadata,t=>{this.safeEmit(vr.AUDIO_METADATA,t)}),this._p2pChannel.on($e.AudioPts,t=>{this.safeEmit(vr.AUDIO_PTS,Number(t))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Bt(et.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Bt(et.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const r=(e={config:t},Zs("ContentInspect").create(e));this._inspect=r,this.handleVideoInspectEvents(r);const{appId:n,cname:i,sid:o,token:s,uid:c,cid:d,vid:u}=this._joinInfo;await r.init({appId:n,areaCode:"",cname:i,sid:o,token:s,uid:c,cid:d,vid:u?Number(u):0},bn)}catch(r){throw Array.isArray(r)?r[0]:r}var e}handleVideoInspectEvents(t){t.on(Hn.CONNECTION_STATE_CHANGE,(e,r)=>{if(this.safeEmit(vr.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,e,r),r===Vo.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(vr.CONTENT_INSPECT_ERROR,new Bt(et.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(Hn.INSPECT_RESULT,(e,r)=>{var n;if(r?.code===et.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return C.debug("Stop inspect content because that has left channel"),this==null||(n=this._inspect)===null||n===void 0||n.close(),void(this._inspect=void 0);this.safeEmit(vr.CONTENT_INSPECT_RESULT,e,r)}),t.on(Hn.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(r=>r.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Bt(et.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,e){if(ns(t,"enabled"),t){if(!e)throw new Bt(et.INVALID_PARAMS,"config is required");if(EN(e),!this._joinInfo)throw new Bt(et.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(e);else{const n=(r={config:e},Zs("ImageModeration").create(r));this._moderation=n,this.handleImageModerationEvents(n);const{appId:i,cname:o,sid:s,token:c,uid:d,cid:u,vid:l}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:o,sid:s,token:c,uid:d,cid:u,vid:l?Number(l):0},bn)}}catch(n){throw Array.isArray(n)?n[0]:n}}else{var r;if(!this._moderation)throw new Bt(et.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(n){throw Array.isArray(n)?n[0]:n}}}handleImageModerationEvents(t){t.on(cs.CONNECTION_STATE_CHANGE,(e,r)=>{if(this.safeEmit(vr.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,e,r),e===Eo.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Bt(et.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(cs.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(r=>r.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(e){Mn(e,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new Bt(et.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,C.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return C.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){ns(t,"enabled"),Br("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,e){switch(e){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},Ke(Me.prototype,"leave",[gN],Object.getOwnPropertyDescriptor(Me.prototype,"leave"),Me.prototype),Ke(Me.prototype,"publish",[TN],Object.getOwnPropertyDescriptor(Me.prototype,"publish"),Me.prototype),Ke(Me.prototype,"unpublish",[vN],Object.getOwnPropertyDescriptor(Me.prototype,"unpublish"),Me.prototype),Ke(Me.prototype,"subscribe",[yN],Object.getOwnPropertyDescriptor(Me.prototype,"subscribe"),Me.prototype),Ke(Me.prototype,"presubscribe",[SN],Object.getOwnPropertyDescriptor(Me.prototype,"presubscribe"),Me.prototype),Ke(Me.prototype,"massSubscribe",[RN],Object.getOwnPropertyDescriptor(Me.prototype,"massSubscribe"),Me.prototype),Ke(Me.prototype,"unsubscribe",[IN],Object.getOwnPropertyDescriptor(Me.prototype,"unsubscribe"),Me.prototype),Ke(Me.prototype,"massUnsubscribe",[CN],Object.getOwnPropertyDescriptor(Me.prototype,"massUnsubscribe"),Me.prototype),Ke(Me.prototype,"setLowStreamParameter",[AN],Object.getOwnPropertyDescriptor(Me.prototype,"setLowStreamParameter"),Me.prototype),Ke(Me.prototype,"enableDualStream",[bN],Object.getOwnPropertyDescriptor(Me.prototype,"enableDualStream"),Me.prototype),Ke(Me.prototype,"disableDualStream",[ON],Object.getOwnPropertyDescriptor(Me.prototype,"disableDualStream"),Me.prototype),Ke(Me.prototype,"setClientRole",[wN],Object.getOwnPropertyDescriptor(Me.prototype,"setClientRole"),Me.prototype),Ke(Me.prototype,"_setClientRoleOptions",[NN],Object.getOwnPropertyDescriptor(Me.prototype,"_setClientRoleOptions"),Me.prototype),Ke(Me.prototype,"setProxyServer",[PN],Object.getOwnPropertyDescriptor(Me.prototype,"setProxyServer"),Me.prototype),Ke(Me.prototype,"setTurnServer",[DN],Object.getOwnPropertyDescriptor(Me.prototype,"setTurnServer"),Me.prototype),Ke(Me.prototype,"setLicense",[kN],Object.getOwnPropertyDescriptor(Me.prototype,"setLicense"),Me.prototype),Ke(Me.prototype,"startProxyServer",[LN],Object.getOwnPropertyDescriptor(Me.prototype,"startProxyServer"),Me.prototype),Ke(Me.prototype,"stopProxyServer",[MN],Object.getOwnPropertyDescriptor(Me.prototype,"stopProxyServer"),Me.prototype),Ke(Me.prototype,"setLocalAccessPointsV2",[UN],Object.getOwnPropertyDescriptor(Me.prototype,"setLocalAccessPointsV2"),Me.prototype),Ke(Me.prototype,"setLocalAccessPoints",[xN],Object.getOwnPropertyDescriptor(Me.prototype,"setLocalAccessPoints"),Me.prototype),Ke(Me.prototype,"setRemoteDefaultVideoStreamType",[VN],Object.getOwnPropertyDescriptor(Me.prototype,"setRemoteDefaultVideoStreamType"),Me.prototype),Ke(Me.prototype,"setRemoteVideoStreamType",[jN],Object.getOwnPropertyDescriptor(Me.prototype,"setRemoteVideoStreamType"),Me.prototype),Ke(Me.prototype,"setStreamFallbackOption",[BN],Object.getOwnPropertyDescriptor(Me.prototype,"setStreamFallbackOption"),Me.prototype),Ke(Me.prototype,"setEncryptionConfig",[FN],Object.getOwnPropertyDescriptor(Me.prototype,"setEncryptionConfig"),Me.prototype),Ke(Me.prototype,"renewToken",[GN],Object.getOwnPropertyDescriptor(Me.prototype,"renewToken"),Me.prototype),Ke(Me.prototype,"enableAudioVolumeIndicator",[HN],Object.getOwnPropertyDescriptor(Me.prototype,"enableAudioVolumeIndicator"),Me.prototype),Ke(Me.prototype,"startLiveStreaming",[WN],Object.getOwnPropertyDescriptor(Me.prototype,"startLiveStreaming"),Me.prototype),Ke(Me.prototype,"setLiveTranscoding",[KN],Object.getOwnPropertyDescriptor(Me.prototype,"setLiveTranscoding"),Me.prototype),Ke(Me.prototype,"stopLiveStreaming",[zN],Object.getOwnPropertyDescriptor(Me.prototype,"stopLiveStreaming"),Me.prototype),Ke(Me.prototype,"startChannelMediaRelay",[qN],Object.getOwnPropertyDescriptor(Me.prototype,"startChannelMediaRelay"),Me.prototype),Ke(Me.prototype,"updateChannelMediaRelay",[YN],Object.getOwnPropertyDescriptor(Me.prototype,"updateChannelMediaRelay"),Me.prototype),Ke(Me.prototype,"stopChannelMediaRelay",[XN],Object.getOwnPropertyDescriptor(Me.prototype,"stopChannelMediaRelay"),Me.prototype),Ke(Me.prototype,"sendCustomReportMessage",[JN],Object.getOwnPropertyDescriptor(Me.prototype,"sendCustomReportMessage"),Me.prototype),Ke(Me.prototype,"pickSVCLayer",[ZN],Object.getOwnPropertyDescriptor(Me.prototype,"pickSVCLayer"),Me.prototype),Ke(Me.prototype,"setRTMConfig",[QN],Object.getOwnPropertyDescriptor(Me.prototype,"setRTMConfig"),Me.prototype),Ke(Me.prototype,"enableContentInspect",[$N],Object.getOwnPropertyDescriptor(Me.prototype,"enableContentInspect"),Me.prototype),Ke(Me.prototype,"disableContentInspect",[tP],Object.getOwnPropertyDescriptor(Me.prototype,"disableContentInspect"),Me.prototype),Ke(Me.prototype,"setImageModeration",[eP],Object.getOwnPropertyDescriptor(Me.prototype,"setImageModeration"),Me.prototype),Ke(Me.prototype,"setP2PTransport",[rP],Object.getOwnPropertyDescriptor(Me.prototype,"setP2PTransport"),Me.prototype),Ke(Me.prototype,"getJoinChannelServiceRecords",[nP],Object.getOwnPropertyDescriptor(Me.prototype,"getJoinChannelServiceRecords"),Me.prototype),Ke(Me.prototype,"setPublishAudioFilterEnabled",[iP],Object.getOwnPropertyDescriptor(Me.prototype,"setPublishAudioFilterEnabled"),Me.prototype),Me);class Tl{constructor(e,r){G(this,"id",0),G(this,"element",void 0),G(this,"peerPair",void 0),G(this,"context",void 0),G(this,"audioPlayerElement",void 0),G(this,"audioTrack",void 0),Tl.count+=1,this.id=Tl.count,this.element=e,this.context=r}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const r=document.createElement("audio");r.srcObject=new MediaStream([e.track]),r.play(),this.audioPlayerElement=r}}async switchSdp(){if(!this.peerPair)return;const e=async(n,i)=>{const o=i==="offer"?await n.createOffer():await n.createAnswer();return await n.setLocalDescription(o),n.iceGatheringState==="complete"?n.localDescription:new De(s=>{n.onicegatheringstatechange=()=>{n.iceGatheringState==="complete"&&s(n.localDescription)}})},r=async(n,i)=>await n.setRemoteDescription(i);try{const n=await e(this.peerPair[0],"offer");await r(this.peerPair[1],n);const i=await e(this.peerPair[1],"answer");await r(this.peerPair[0],i)}catch(n){throw new Bt(et.LOCAL_AEC_ERROR,n.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let r;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),r=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(r)}catch(i){throw new Bt(et.LOCAL_AEC_ERROR,i.toString()).print()}if(!r)throw new Bt(et.LOCAL_AEC_ERROR,"no dest node when local aec").print();const n=r.stream.getAudioTracks()[0];return this.audioTrack=n,n}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,r=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(r),await this.switchSdp()}close(){C.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var sP,Cf;G(Tl,"count",0);const m8=window.AudioContext||window.webkitAudioContext,_8=new(sP=nr({report:qe}),Ke((Cf=class{constructor(){G(this,"units",[]),G(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return C.debug("the system does not need to process local aec"),-1;this.context||(this.context=new m8);let e=this.units.find(r=>r&&r.getElement()===t);return e||(e=new Tl(t,this.context),this.units.push(e)),e.startEchoCancellation(),C.debug("start processing local audio echo cancellation, id is",e.id),e.id}_doesEnvironmentNeedAEC(){return Rr().name!==wr.SAFARI}}).prototype,"processExternalMediaAEC",[sP],Object.getOwnPropertyDescriptor(Cf.prototype,"processExternalMediaAEC"),Cf.prototype),Cf);function aP(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function cP(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?aP(Object(r),!0).forEach(function(n){G(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):aP(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}const TT=window||document;function dP(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!TT)return;const r=On._cspEventHandlerPointer;if(r&&e)return void console.error(r,e);const n=i=>{if(!(i&&i.blockedURI&&(On.onSecurityPolicyViolation||On.getListeners(Os.SECURITY_POLICY_VIOLATION).length>0)))return;const o=i.blockedURI;st("CSP_DETECTED_HOSTNAME_LIST").some(s=>Ce(o).call(o,s))&&(On.onSecurityPolicyViolation&&typeof On.onSecurityPolicyViolation=="function"&&On.onSecurityPolicyViolation(i),On.getListeners(Os.SECURITY_POLICY_VIOLATION).length>0&&On.safeEmit(Os.SECURITY_POLICY_VIOLATION,i))};r&&TT.removeEventListener("securitypolicyviolation",r),(e||t&&typeof t=="function"||On.getListeners(Os.SECURITY_POLICY_VIOLATION).length>0)&&TT.addEventListener("securitypolicyviolation",n),On._cspEventHandlerPointer=n}var E8=_,g8=WC,uP=RegExp.prototype,T8=function(t){return t===uP||E8(uP,t)?g8(t):t.flags},vi=ke(T8);function Yd(t){let e=t.length;for(;--e>=0;)t[e]=0}const vT=256,lP=286,vl=30,yl=15,yT=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Af=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),v8=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),hP=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$s=new Array(576);Yd($s);const Sl=new Array(60);Yd(Sl);const Rl=new Array(512);Yd(Rl);const Il=new Array(256);Yd(Il);const ST=new Array(29);Yd(ST);const bf=new Array(vl);function RT(t,e,r,n,i){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=t&&t.length}let pP,fP,mP;function IT(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}Yd(bf);const _P=t=>t<256?Rl[t]:Rl[256+(t>>>7)],Cl=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},uo=(t,e,r)=>{t.bi_valid>16-r?(t.bi_buf|=e<<t.bi_valid&65535,Cl(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=r-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)},Ps=(t,e,r)=>{uo(t,r[2*e],r[2*e+1])},EP=(t,e)=>{let r=0;do r|=1&t,t>>>=1,r<<=1;while(--e>0);return r>>>1},gP=(t,e,r)=>{const n=new Array(16);let i,o,s=0;for(i=1;i<=yl;i++)s=s+r[i-1]<<1,n[i]=s;for(o=0;o<=e;o++){let c=t[2*o+1];c!==0&&(t[2*o]=EP(n[c]++,c))}},TP=t=>{let e;for(e=0;e<lP;e++)t.dyn_ltree[2*e]=0;for(e=0;e<vl;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},vP=t=>{t.bi_valid>8?Cl(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},yP=(t,e,r,n)=>{const i=2*e,o=2*r;return t[i]<t[o]||t[i]===t[o]&&n[e]<=n[r]},CT=(t,e,r)=>{const n=t.heap[r];let i=r<<1;for(;i<=t.heap_len&&(i<t.heap_len&&yP(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!yP(e,n,t.heap[i],t.depth));)t.heap[r]=t.heap[i],r=i,i<<=1;t.heap[r]=n},SP=(t,e,r)=>{let n,i,o,s,c=0;if(t.sym_next!==0)do n=255&t.pending_buf[t.sym_buf+c++],n+=(255&t.pending_buf[t.sym_buf+c++])<<8,i=t.pending_buf[t.sym_buf+c++],n===0?Ps(t,i,e):(o=Il[i],Ps(t,o+vT+1,e),s=yT[o],s!==0&&(i-=ST[o],uo(t,i,s)),n--,o=_P(n),Ps(t,o,r),s=Af[o],s!==0&&(n-=bf[o],uo(t,n,s)));while(c<t.sym_next);Ps(t,256,e)},AT=(t,e)=>{const r=e.dyn_tree,n=e.stat_desc.static_tree,i=e.stat_desc.has_stree,o=e.stat_desc.elems;let s,c,d,u=-1;for(t.heap_len=0,t.heap_max=573,s=0;s<o;s++)r[2*s]!==0?(t.heap[++t.heap_len]=u=s,t.depth[s]=0):r[2*s+1]=0;for(;t.heap_len<2;)d=t.heap[++t.heap_len]=u<2?++u:0,r[2*d]=1,t.depth[d]=0,t.opt_len--,i&&(t.static_len-=n[2*d+1]);for(e.max_code=u,s=t.heap_len>>1;s>=1;s--)CT(t,r,s);d=o;do s=t.heap[1],t.heap[1]=t.heap[t.heap_len--],CT(t,r,1),c=t.heap[1],t.heap[--t.heap_max]=s,t.heap[--t.heap_max]=c,r[2*d]=r[2*s]+r[2*c],t.depth[d]=(t.depth[s]>=t.depth[c]?t.depth[s]:t.depth[c])+1,r[2*s+1]=r[2*c+1]=d,t.heap[1]=d++,CT(t,r,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((l,T)=>{const v=T.dyn_tree,y=T.max_code,x=T.stat_desc.static_tree,N=T.stat_desc.has_stree,L=T.stat_desc.extra_bits,Q=T.stat_desc.extra_base,J=T.stat_desc.max_length;let at,Rt,vt,pt,kt,$t,se=0;for(pt=0;pt<=yl;pt++)l.bl_count[pt]=0;for(v[2*l.heap[l.heap_max]+1]=0,at=l.heap_max+1;at<573;at++)Rt=l.heap[at],pt=v[2*v[2*Rt+1]+1]+1,pt>J&&(pt=J,se++),v[2*Rt+1]=pt,Rt>y||(l.bl_count[pt]++,kt=0,Rt>=Q&&(kt=L[Rt-Q]),$t=v[2*Rt],l.opt_len+=$t*(pt+kt),N&&(l.static_len+=$t*(x[2*Rt+1]+kt)));if(se!==0){do{for(pt=J-1;l.bl_count[pt]===0;)pt--;l.bl_count[pt]--,l.bl_count[pt+1]+=2,l.bl_count[J]--,se-=2}while(se>0);for(pt=J;pt!==0;pt--)for(Rt=l.bl_count[pt];Rt!==0;)vt=l.heap[--at],vt>y||(v[2*vt+1]!==pt&&(l.opt_len+=(pt-v[2*vt+1])*v[2*vt],v[2*vt+1]=pt),Rt--)}})(t,e),gP(r,u,t.bl_count)},RP=(t,e,r)=>{let n,i,o=-1,s=e[1],c=0,d=7,u=4;for(s===0&&(d=138,u=3),e[2*(r+1)+1]=65535,n=0;n<=r;n++)i=s,s=e[2*(n+1)+1],++c<d&&i===s||(c<u?t.bl_tree[2*i]+=c:i!==0?(i!==o&&t.bl_tree[2*i]++,t.bl_tree[32]++):c<=10?t.bl_tree[34]++:t.bl_tree[36]++,c=0,o=i,s===0?(d=138,u=3):i===s?(d=6,u=3):(d=7,u=4))},IP=(t,e,r)=>{let n,i,o=-1,s=e[1],c=0,d=7,u=4;for(s===0&&(d=138,u=3),n=0;n<=r;n++)if(i=s,s=e[2*(n+1)+1],!(++c<d&&i===s)){if(c<u)do Ps(t,i,t.bl_tree);while(--c!=0);else i!==0?(i!==o&&(Ps(t,i,t.bl_tree),c--),Ps(t,16,t.bl_tree),uo(t,c-3,2)):c<=10?(Ps(t,17,t.bl_tree),uo(t,c-3,3)):(Ps(t,18,t.bl_tree),uo(t,c-11,7));c=0,o=i,s===0?(d=138,u=3):i===s?(d=6,u=3):(d=7,u=4)}};let CP=!1;const AP=(t,e,r,n)=>{uo(t,0+(n?1:0),3),vP(t),Cl(t,r),Cl(t,~r),r&&t.pending_buf.set(t.window.subarray(e,e+r),t.pending),t.pending+=r};var y8=t=>{CP||((()=>{let e,r,n,i,o;const s=new Array(16);for(n=0,i=0;i<28;i++)for(ST[i]=n,e=0;e<1<<yT[i];e++)Il[n++]=i;for(Il[n-1]=i,o=0,i=0;i<16;i++)for(bf[i]=o,e=0;e<1<<Af[i];e++)Rl[o++]=i;for(o>>=7;i<vl;i++)for(bf[i]=o<<7,e=0;e<1<<Af[i]-7;e++)Rl[256+o++]=i;for(r=0;r<=yl;r++)s[r]=0;for(e=0;e<=143;)$s[2*e+1]=8,e++,s[8]++;for(;e<=255;)$s[2*e+1]=9,e++,s[9]++;for(;e<=279;)$s[2*e+1]=7,e++,s[7]++;for(;e<=287;)$s[2*e+1]=8,e++,s[8]++;for(gP($s,287,s),e=0;e<vl;e++)Sl[2*e+1]=5,Sl[2*e]=EP(e,5);pP=new RT($s,yT,257,lP,yl),fP=new RT(Sl,Af,0,vl,yl),mP=new RT(new Array(0),v8,0,19,7)})(),CP=!0),t.l_desc=new IT(t.dyn_ltree,pP),t.d_desc=new IT(t.dyn_dtree,fP),t.bl_desc=new IT(t.bl_tree,mP),t.bi_buf=0,t.bi_valid=0,TP(t)},S8=(t,e,r,n)=>{let i,o,s=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(c=>{let d,u=4093624447;for(d=0;d<=31;d++,u>>>=1)if(1&u&&c.dyn_ltree[2*d]!==0)return 0;if(c.dyn_ltree[18]!==0||c.dyn_ltree[20]!==0||c.dyn_ltree[26]!==0)return 1;for(d=32;d<vT;d++)if(c.dyn_ltree[2*d]!==0)return 1;return 0})(t)),AT(t,t.l_desc),AT(t,t.d_desc),s=(c=>{let d;for(RP(c,c.dyn_ltree,c.l_desc.max_code),RP(c,c.dyn_dtree,c.d_desc.max_code),AT(c,c.bl_desc),d=18;d>=3&&c.bl_tree[2*hP[d]+1]===0;d--);return c.opt_len+=3*(d+1)+5+5+4,d})(t),i=t.opt_len+3+7>>>3,o=t.static_len+3+7>>>3,o<=i&&(i=o)):i=o=r+5,r+4<=i&&e!==-1?AP(t,e,r,n):t.strategy===4||o===i?(uo(t,2+(n?1:0),3),SP(t,$s,Sl)):(uo(t,4+(n?1:0),3),((c,d,u,l)=>{let T;for(uo(c,d-257,5),uo(c,u-1,5),uo(c,l-4,4),T=0;T<l;T++)uo(c,c.bl_tree[2*hP[T]+1],3);IP(c,c.dyn_ltree,d-1),IP(c,c.dyn_dtree,u-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,s+1),SP(t,t.dyn_ltree,t.dyn_dtree)),TP(t),n&&vP(t)},R8=(t,e,r)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=r,e===0?t.dyn_ltree[2*r]++:(t.matches++,e--,t.dyn_ltree[2*(Il[r]+vT+1)]++,t.dyn_dtree[2*_P(e)]++),t.sym_next===t.sym_end),I8=t=>{uo(t,2,3),Ps(t,256,$s),(e=>{e.bi_valid===16?(Cl(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(t)},C8={_tr_init:y8,_tr_stored_block:AP,_tr_flush_block:S8,_tr_tally:R8,_tr_align:I8},Al=(t,e,r,n)=>{let i=65535&t|0,o=t>>>16&65535|0,s=0;for(;r!==0;){s=r>2e3?2e3:r,r-=s;do i=i+e[n++]|0,o=o+i|0;while(--s);i%=65521,o%=65521}return i|o<<16|0};const A8=new Uint32Array((()=>{let t,e=[];for(var r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e})());var Ai=(t,e,r,n)=>{const i=A8,o=n+r;t^=-1;for(let s=n;s<o;s++)t=t>>>8^i[255&(t^e[s])];return-1^t},Cc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Of={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:b8,_tr_stored_block:bT,_tr_flush_block:O8,_tr_tally:ja,_tr_align:w8}=C8,{Z_NO_FLUSH:Ba,Z_PARTIAL_FLUSH:N8,Z_FULL_FLUSH:P8,Z_FINISH:Ho,Z_BLOCK:bP,Z_OK:Pi,Z_STREAM_END:OP,Z_STREAM_ERROR:Ds,Z_DATA_ERROR:D8,Z_BUF_ERROR:OT,Z_DEFAULT_COMPRESSION:k8,Z_FILTERED:L8,Z_HUFFMAN_ONLY:wf,Z_RLE:M8,Z_FIXED:U8,Z_DEFAULT_STRATEGY:x8,Z_UNKNOWN:V8,Z_DEFLATED:Nf}=Of,wT=286,j8=30,B8=19,F8=2*wT+1,G8=15,Ac=258,ks=262,Xd=42,bc=113,bl=666,Oc=(t,e)=>(t.msg=Cc[e],e),wP=t=>2*t-(t>4?9:0),Fa=t=>{let e=t.length;for(;--e>=0;)t[e]=0},H8=t=>{let e,r,n,i=t.w_size;e=t.hash_size,n=e;do r=t.head[--n],t.head[n]=r>=i?r-i:0;while(--e);e=i,n=e;do r=t.prev[--n],t.prev[n]=r>=i?r-i:0;while(--e)};let Ga=(t,e,r)=>(e<<t.hash_shift^r)&t.hash_mask;const To=t=>{const e=t.state;let r=e.pending;r>t.avail_out&&(r=t.avail_out),r!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+r),t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,e.pending===0&&(e.pending_out=0))},vo=(t,e)=>{O8(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,To(t.strm)},yn=(t,e)=>{t.pending_buf[t.pending++]=e},Ol=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},NT=(t,e,r,n)=>{let i=t.avail_in;return i>n&&(i=n),i===0?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),r),t.state.wrap===1?t.adler=Al(t.adler,e,i,r):t.state.wrap===2&&(t.adler=Ai(t.adler,e,i,r)),t.next_in+=i,t.total_in+=i,i)},NP=(t,e)=>{let r,n,i=t.max_chain_length,o=t.strstart,s=t.prev_length,c=t.nice_match;const d=t.strstart>t.w_size-ks?t.strstart-(t.w_size-ks):0,u=t.window,l=t.w_mask,T=t.prev,v=t.strstart+Ac;let y=u[o+s-1],x=u[o+s];t.prev_length>=t.good_match&&(i>>=2),c>t.lookahead&&(c=t.lookahead);do if(r=e,u[r+s]===x&&u[r+s-1]===y&&u[r]===u[o]&&u[++r]===u[o+1]){o+=2,r++;do;while(u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&o<v);if(n=Ac-(v-o),o=v-Ac,n>s){if(t.match_start=e,s=n,n>=c)break;y=u[o+s-1],x=u[o+s]}}while((e=T[e&l])>d&&--i!=0);return s<=t.lookahead?s:t.lookahead},Jd=t=>{const e=t.w_size;let r,n,i;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-ks)&&(t.window.set(t.window.subarray(e,e+e-n),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),H8(t),n+=e),t.strm.avail_in===0)break;if(r=NT(t.strm,t.window,t.strstart+t.lookahead,n),t.lookahead+=r,t.lookahead+t.insert>=3)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=Ga(t,t.ins_h,t.window[i+1]);t.insert&&(t.ins_h=Ga(t,t.ins_h,t.window[i+3-1]),t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<ks&&t.strm.avail_in!==0)},PP=(t,e)=>{let r,n,i,o=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,s=0,c=t.strm.avail_in;do{if(r=65535,i=t.bi_valid+42>>3,t.strm.avail_out<i||(i=t.strm.avail_out-i,n=t.strstart-t.block_start,r>n+t.strm.avail_in&&(r=n+t.strm.avail_in),r>i&&(r=i),r<o&&(r===0&&e!==Ho||e===Ba||r!==n+t.strm.avail_in)))break;s=e===Ho&&r===n+t.strm.avail_in?1:0,bT(t,0,0,s),t.pending_buf[t.pending-4]=r,t.pending_buf[t.pending-3]=r>>8,t.pending_buf[t.pending-2]=~r,t.pending_buf[t.pending-1]=~r>>8,To(t.strm),n&&(n>r&&(n=r),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+n),t.strm.next_out),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n,t.block_start+=n,r-=n),r&&(NT(t.strm,t.strm.output,t.strm.next_out,r),t.strm.next_out+=r,t.strm.avail_out-=r,t.strm.total_out+=r)}while(s===0);return c-=t.strm.avail_in,c&&(c>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=c&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-c,t.strm.next_in),t.strstart),t.strstart+=c,t.insert+=c>t.w_size-t.insert?t.w_size-t.insert:c),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),s?4:e!==Ba&&e!==Ho&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(i=t.window_size-t.strstart,t.strm.avail_in>i&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,i+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),i>t.strm.avail_in&&(i=t.strm.avail_in),i&&(NT(t.strm,t.window,t.strstart,i),t.strstart+=i,t.insert+=i>t.w_size-t.insert?t.w_size-t.insert:i),t.high_water<t.strstart&&(t.high_water=t.strstart),i=t.bi_valid+42>>3,i=t.pending_buf_size-i>65535?65535:t.pending_buf_size-i,o=i>t.w_size?t.w_size:i,n=t.strstart-t.block_start,(n>=o||(n||e===Ho)&&e!==Ba&&t.strm.avail_in===0&&n<=i)&&(r=n>i?i:n,s=e===Ho&&t.strm.avail_in===0&&r===n?1:0,bT(t,t.block_start,r,s),t.block_start+=r,To(t.strm)),s?3:1)},PT=(t,e)=>{let r,n;for(;;){if(t.lookahead<ks){if(Jd(t),t.lookahead<ks&&e===Ba)return 1;if(t.lookahead===0)break}if(r=0,t.lookahead>=3&&(t.ins_h=Ga(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),r!==0&&t.strstart-r<=t.w_size-ks&&(t.match_length=NP(t,r)),t.match_length>=3)if(n=ja(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=Ga(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Ga(t,t.ins_h,t.window[t.strstart+1]);else n=ja(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(vo(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,e===Ho?(vo(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(vo(t,!1),t.strm.avail_out===0)?1:2},Zd=(t,e)=>{let r,n,i;for(;;){if(t.lookahead<ks){if(Jd(t),t.lookahead<ks&&e===Ba)return 1;if(t.lookahead===0)break}if(r=0,t.lookahead>=3&&(t.ins_h=Ga(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,r!==0&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-ks&&(t.match_length=NP(t,r),t.match_length<=5&&(t.strategy===L8||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-3,n=ja(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=i&&(t.ins_h=Ga(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,n&&(vo(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(n=ja(t,0,t.window[t.strstart-1]),n&&vo(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=ja(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===Ho?(vo(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(vo(t,!1),t.strm.avail_out===0)?1:2};function Ls(t,e,r,n,i){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=i}const wl=[new Ls(0,0,0,0,PP),new Ls(4,4,8,4,PT),new Ls(4,5,16,8,PT),new Ls(4,6,32,32,PT),new Ls(4,4,16,16,Zd),new Ls(8,16,32,32,Zd),new Ls(8,16,128,128,Zd),new Ls(8,32,128,256,Zd),new Ls(32,128,258,1024,Zd),new Ls(32,258,258,4096,Zd)];function W8(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Nf,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*F8),this.dyn_dtree=new Uint16Array(2*(2*j8+1)),this.bl_tree=new Uint16Array(2*(2*B8+1)),Fa(this.dyn_ltree),Fa(this.dyn_dtree),Fa(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(G8+1),this.heap=new Uint16Array(2*wT+1),Fa(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*wT+1),Fa(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Nl=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==Xd&&e.status!==57&&e.status!==69&&e.status!==73&&e.status!==91&&e.status!==103&&e.status!==bc&&e.status!==bl?1:0},DP=t=>{if(Nl(t))return Oc(t,Ds);t.total_in=t.total_out=0,t.data_type=V8;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?57:e.wrap?Xd:bc,t.adler=e.wrap===2?0:1,e.last_flush=-2,b8(e),Pi},kP=t=>{const e=DP(t);return e===Pi&&(r=>{r.window_size=2*r.w_size,Fa(r.head),r.max_lazy_match=wl[r.level].max_lazy,r.good_match=wl[r.level].good_length,r.nice_match=wl[r.level].nice_length,r.max_chain_length=wl[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0})(t.state),e},LP=(t,e,r,n,i,o)=>{if(!t)return Ds;let s=1;if(e===k8&&(e=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),i<1||i>9||r!==Nf||n<8||n>15||e<0||e>9||o<0||o>U8||n===8&&s!==1)return Oc(t,Ds);n===8&&(n=9);const c=new W8;return t.state=c,c.strm=t,c.status=Xd,c.wrap=s,c.gzhead=null,c.w_bits=n,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=i+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new Uint8Array(2*c.w_size),c.head=new Uint16Array(c.hash_size),c.prev=new Uint16Array(c.w_size),c.lit_bufsize=1<<i+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new Uint8Array(c.pending_buf_size),c.sym_buf=c.lit_bufsize,c.sym_end=3*(c.lit_bufsize-1),c.level=e,c.strategy=o,c.method=r,kP(t)};var K8=(t,e)=>{if(Nl(t)||e>bP||e<0)return t?Oc(t,Ds):Ds;const r=t.state;if(!t.output||t.avail_in!==0&&!t.input||r.status===bl&&e!==Ho)return Oc(t,t.avail_out===0?OT:Ds);const n=r.last_flush;if(r.last_flush=e,r.pending!==0){if(To(t),t.avail_out===0)return r.last_flush=-1,Pi}else if(t.avail_in===0&&wP(e)<=wP(n)&&e!==Ho)return Oc(t,OT);if(r.status===bl&&t.avail_in!==0)return Oc(t,OT);if(r.status===Xd&&r.wrap===0&&(r.status=bc),r.status===Xd){let i=Nf+(r.w_bits-8<<4)<<8,o=-1;if(o=r.strategy>=wf||r.level<2?0:r.level<6?1:r.level===6?2:3,i|=o<<6,r.strstart!==0&&(i|=32),i+=31-i%31,Ol(r,i),r.strstart!==0&&(Ol(r,t.adler>>>16),Ol(r,65535&t.adler)),t.adler=1,r.status=bc,To(t),r.pending!==0)return r.last_flush=-1,Pi}if(r.status===57){if(t.adler=0,yn(r,31),yn(r,139),yn(r,8),r.gzhead)yn(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),yn(r,255&r.gzhead.time),yn(r,r.gzhead.time>>8&255),yn(r,r.gzhead.time>>16&255),yn(r,r.gzhead.time>>24&255),yn(r,r.level===9?2:r.strategy>=wf||r.level<2?4:0),yn(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(yn(r,255&r.gzhead.extra.length),yn(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=Ai(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(yn(r,0),yn(r,0),yn(r,0),yn(r,0),yn(r,0),yn(r,r.level===9?2:r.strategy>=wf||r.level<2?4:0),yn(r,3),r.status=bc,To(t),r.pending!==0)return r.last_flush=-1,Pi}if(r.status===69){if(r.gzhead.extra){let i=r.pending,o=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+o>r.pending_buf_size;){let c=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+c),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>i&&(t.adler=Ai(t.adler,r.pending_buf,r.pending-i,i)),r.gzindex+=c,To(t),r.pending!==0)return r.last_flush=-1,Pi;i=0,o-=c}let s=new Uint8Array(r.gzhead.extra);r.pending_buf.set(s.subarray(r.gzindex,r.gzindex+o),r.pending),r.pending+=o,r.gzhead.hcrc&&r.pending>i&&(t.adler=Ai(t.adler,r.pending_buf,r.pending-i,i)),r.gzindex=0}r.status=73}if(r.status===73){if(r.gzhead.name){let i,o=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>o&&(t.adler=Ai(t.adler,r.pending_buf,r.pending-o,o)),To(t),r.pending!==0)return r.last_flush=-1,Pi;o=0}i=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,yn(r,i)}while(i!==0);r.gzhead.hcrc&&r.pending>o&&(t.adler=Ai(t.adler,r.pending_buf,r.pending-o,o)),r.gzindex=0}r.status=91}if(r.status===91){if(r.gzhead.comment){let i,o=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>o&&(t.adler=Ai(t.adler,r.pending_buf,r.pending-o,o)),To(t),r.pending!==0)return r.last_flush=-1,Pi;o=0}i=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,yn(r,i)}while(i!==0);r.gzhead.hcrc&&r.pending>o&&(t.adler=Ai(t.adler,r.pending_buf,r.pending-o,o))}r.status=103}if(r.status===103){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(To(t),r.pending!==0))return r.last_flush=-1,Pi;yn(r,255&t.adler),yn(r,t.adler>>8&255),t.adler=0}if(r.status=bc,To(t),r.pending!==0)return r.last_flush=-1,Pi}if(t.avail_in!==0||r.lookahead!==0||e!==Ba&&r.status!==bl){let i=r.level===0?PP(r,e):r.strategy===wf?((o,s)=>{let c;for(;;){if(o.lookahead===0&&(Jd(o),o.lookahead===0)){if(s===Ba)return 1;break}if(o.match_length=0,c=ja(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++,c&&(vo(o,!1),o.strm.avail_out===0))return 1}return o.insert=0,s===Ho?(vo(o,!0),o.strm.avail_out===0?3:4):o.sym_next&&(vo(o,!1),o.strm.avail_out===0)?1:2})(r,e):r.strategy===M8?((o,s)=>{let c,d,u,l;const T=o.window;for(;;){if(o.lookahead<=Ac){if(Jd(o),o.lookahead<=Ac&&s===Ba)return 1;if(o.lookahead===0)break}if(o.match_length=0,o.lookahead>=3&&o.strstart>0&&(u=o.strstart-1,d=T[u],d===T[++u]&&d===T[++u]&&d===T[++u])){l=o.strstart+Ac;do;while(d===T[++u]&&d===T[++u]&&d===T[++u]&&d===T[++u]&&d===T[++u]&&d===T[++u]&&d===T[++u]&&d===T[++u]&&u<l);o.match_length=Ac-(l-u),o.match_length>o.lookahead&&(o.match_length=o.lookahead)}if(o.match_length>=3?(c=ja(o,1,o.match_length-3),o.lookahead-=o.match_length,o.strstart+=o.match_length,o.match_length=0):(c=ja(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++),c&&(vo(o,!1),o.strm.avail_out===0))return 1}return o.insert=0,s===Ho?(vo(o,!0),o.strm.avail_out===0?3:4):o.sym_next&&(vo(o,!1),o.strm.avail_out===0)?1:2})(r,e):wl[r.level].func(r,e);if(i!==3&&i!==4||(r.status=bl),i===1||i===3)return t.avail_out===0&&(r.last_flush=-1),Pi;if(i===2&&(e===N8?w8(r):e!==bP&&(bT(r,0,0,!1),e===P8&&(Fa(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),To(t),t.avail_out===0))return r.last_flush=-1,Pi}return e!==Ho?Pi:r.wrap<=0?OP:(r.wrap===2?(yn(r,255&t.adler),yn(r,t.adler>>8&255),yn(r,t.adler>>16&255),yn(r,t.adler>>24&255),yn(r,255&t.total_in),yn(r,t.total_in>>8&255),yn(r,t.total_in>>16&255),yn(r,t.total_in>>24&255)):(Ol(r,t.adler>>>16),Ol(r,65535&t.adler)),To(t),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?Pi:OP)},z8=(t,e)=>{let r=e.length;if(Nl(t))return Ds;const n=t.state,i=n.wrap;if(i===2||i===1&&n.status!==Xd||n.lookahead)return Ds;if(i===1&&(t.adler=Al(t.adler,e,r,0)),n.wrap=0,r>=n.w_size){i===0&&(Fa(n.head),n.strstart=0,n.block_start=0,n.insert=0);let d=new Uint8Array(n.w_size);d.set(e.subarray(r-n.w_size,r),0),e=d,r=n.w_size}const o=t.avail_in,s=t.next_in,c=t.input;for(t.avail_in=r,t.next_in=0,t.input=e,Jd(n);n.lookahead>=3;){let d=n.strstart,u=n.lookahead-2;do n.ins_h=Ga(n,n.ins_h,n.window[d+3-1]),n.prev[d&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=d,d++;while(--u);n.strstart=d,n.lookahead=2,Jd(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,t.next_in=s,t.input=c,t.avail_in=o,n.wrap=i,Pi},Pl={deflateInit:(t,e)=>LP(t,e,Nf,15,8,x8),deflateInit2:LP,deflateReset:kP,deflateResetKeep:DP,deflateSetHeader:(t,e)=>Nl(t)||t.state.wrap!==2?Ds:(t.state.gzhead=e,Pi),deflate:K8,deflateEnd:t=>{if(Nl(t))return Ds;const e=t.state.status;return t.state=null,e===bc?Oc(t,D8):Pi},deflateSetDictionary:z8,deflateInfo:"pako deflate (from Nodeca project)"};const q8=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Pf={assign:function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const r=e.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(const n in r)q8(r,n)&&(t[n]=r[n])}}return t},flattenChunks:t=>{let e=0;for(let n=0,i=t.length;n<i;n++)e+=t[n].length;const r=new Uint8Array(e);for(let n=0,i=0,o=t.length;n<o;n++){let s=t[n];r.set(s,i),i+=s.length}return r}};let MP=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{MP=!1}const Dl=new Uint8Array(256);for(let t=0;t<256;t++)Dl[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Dl[254]=Dl[254]=1;var kl={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,r,n,i,o,s=t.length,c=0;for(i=0;i<s;i++)r=t.charCodeAt(i),(64512&r)==55296&&i+1<s&&(n=t.charCodeAt(i+1),(64512&n)==56320&&(r=65536+(r-55296<<10)+(n-56320),i++)),c+=r<128?1:r<2048?2:r<65536?3:4;for(e=new Uint8Array(c),o=0,i=0;o<c;i++)r=t.charCodeAt(i),(64512&r)==55296&&i+1<s&&(n=t.charCodeAt(i+1),(64512&n)==56320&&(r=65536+(r-55296<<10)+(n-56320),i++)),r<128?e[o++]=r:r<2048?(e[o++]=192|r>>>6,e[o++]=128|63&r):r<65536?(e[o++]=224|r>>>12,e[o++]=128|r>>>6&63,e[o++]=128|63&r):(e[o++]=240|r>>>18,e[o++]=128|r>>>12&63,e[o++]=128|r>>>6&63,e[o++]=128|63&r);return e},buf2string:(t,e)=>{const r=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let n,i;const o=new Array(2*r);for(i=0,n=0;n<r;){let s=t[n++];if(s<128){o[i++]=s;continue}let c=Dl[s];if(c>4)o[i++]=65533,n+=c-1;else{for(s&=c===2?31:c===3?15:7;c>1&&n<r;)s=s<<6|63&t[n++],c--;c>1?o[i++]=65533:s<65536?o[i++]=s:(s-=65536,o[i++]=55296|s>>10&1023,o[i++]=56320|1023&s)}}return((s,c)=>{if(c<65534&&s.subarray&&MP)return String.fromCharCode.apply(null,s.length===c?s:s.subarray(0,c));let d="";for(let u=0;u<c;u++)d+=String.fromCharCode(s[u]);return d})(o,i)},utf8border:(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let r=e-1;for(;r>=0&&(192&t[r])==128;)r--;return r<0||r===0?e:r+Dl[t[r]]>e?r:e}},UP=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const xP=Object.prototype.toString,{Z_NO_FLUSH:Y8,Z_SYNC_FLUSH:X8,Z_FULL_FLUSH:J8,Z_FINISH:Z8,Z_OK:Df,Z_STREAM_END:Q8,Z_DEFAULT_COMPRESSION:$8,Z_DEFAULT_STRATEGY:tW,Z_DEFLATED:eW}=Of;function kf(t){this.options=Pf.assign({level:$8,method:eW,chunkSize:16384,windowBits:15,memLevel:8,strategy:tW},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new UP,this.strm.avail_out=0;let r=Pl.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==Df)throw new Error(Cc[r]);if(e.header&&Pl.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(n=typeof e.dictionary=="string"?kl.string2buf(e.dictionary):xP.call(e.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e.dictionary):e.dictionary,r=Pl.deflateSetDictionary(this.strm,n),r!==Df)throw new Error(Cc[r]);this._dict_set=!0}}function rW(t,e){const r=new kf(e);if(r.push(t,!0),r.err)throw r.msg||Cc[r.err];return r.result}kf.prototype.push=function(t,e){const r=this.strm,n=this.options.chunkSize;let i,o;if(this.ended)return!1;for(o=e===~~e?e:e===!0?Z8:Y8,typeof t=="string"?r.input=kl.string2buf(t):xP.call(t)==="[object ArrayBuffer]"?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;)if(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(o===X8||o===J8)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(i=Pl.deflate(r,o),i===Q8)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),i=Pl.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Df;if(r.avail_out!==0){if(o>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(r.avail_in===0)break}else this.onData(r.output)}return!0},kf.prototype.onData=function(t){this.chunks.push(t)},kf.prototype.onEnd=function(t){t===Df&&(this.result=Pf.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var nW={deflate:rW};const Lf=16209;var iW=function(t,e){let r,n,i,o,s,c,d,u,l,T,v,y,x,N,L,Q,J,at,Rt,vt,pt,kt,$t,se;const Te=t.state;r=t.next_in,$t=t.input,n=r+(t.avail_in-5),i=t.next_out,se=t.output,o=i-(e-t.avail_out),s=i+(t.avail_out-257),c=Te.dmax,d=Te.wsize,u=Te.whave,l=Te.wnext,T=Te.window,v=Te.hold,y=Te.bits,x=Te.lencode,N=Te.distcode,L=(1<<Te.lenbits)-1,Q=(1<<Te.distbits)-1;t:do{y<15&&(v+=$t[r++]<<y,y+=8,v+=$t[r++]<<y,y+=8),J=x[v&L];e:for(;;){if(at=J>>>24,v>>>=at,y-=at,at=J>>>16&255,at===0)se[i++]=65535&J;else{if(!(16&at)){if(!(64&at)){J=x[(65535&J)+(v&(1<<at)-1)];continue e}if(32&at){Te.mode=16191;break t}t.msg="invalid literal/length code",Te.mode=Lf;break t}Rt=65535&J,at&=15,at&&(y<at&&(v+=$t[r++]<<y,y+=8),Rt+=v&(1<<at)-1,v>>>=at,y-=at),y<15&&(v+=$t[r++]<<y,y+=8,v+=$t[r++]<<y,y+=8),J=N[v&Q];r:for(;;){if(at=J>>>24,v>>>=at,y-=at,at=J>>>16&255,!(16&at)){if(!(64&at)){J=N[(65535&J)+(v&(1<<at)-1)];continue r}t.msg="invalid distance code",Te.mode=Lf;break t}if(vt=65535&J,at&=15,y<at&&(v+=$t[r++]<<y,y+=8,y<at&&(v+=$t[r++]<<y,y+=8)),vt+=v&(1<<at)-1,vt>c){t.msg="invalid distance too far back",Te.mode=Lf;break t}if(v>>>=at,y-=at,at=i-o,vt>at){if(at=vt-at,at>u&&Te.sane){t.msg="invalid distance too far back",Te.mode=Lf;break t}if(pt=0,kt=T,l===0){if(pt+=d-at,at<Rt){Rt-=at;do se[i++]=T[pt++];while(--at);pt=i-vt,kt=se}}else if(l<at){if(pt+=d+l-at,at-=l,at<Rt){Rt-=at;do se[i++]=T[pt++];while(--at);if(pt=0,l<Rt){at=l,Rt-=at;do se[i++]=T[pt++];while(--at);pt=i-vt,kt=se}}}else if(pt+=l-at,at<Rt){Rt-=at;do se[i++]=T[pt++];while(--at);pt=i-vt,kt=se}for(;Rt>2;)se[i++]=kt[pt++],se[i++]=kt[pt++],se[i++]=kt[pt++],Rt-=3;Rt&&(se[i++]=kt[pt++],Rt>1&&(se[i++]=kt[pt++]))}else{pt=i-vt;do se[i++]=se[pt++],se[i++]=se[pt++],se[i++]=se[pt++],Rt-=3;while(Rt>2);Rt&&(se[i++]=se[pt++],Rt>1&&(se[i++]=se[pt++]))}break}}break}}while(r<n&&i<s);Rt=y>>3,r-=Rt,y-=Rt<<3,v&=(1<<y)-1,t.next_in=r,t.next_out=i,t.avail_in=r<n?n-r+5:5-(r-n),t.avail_out=i<s?s-i+257:257-(i-s),Te.hold=v,Te.bits=y};const Mf=15,oW=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),sW=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),aW=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),cW=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Ll=(t,e,r,n,i,o,s,c)=>{const d=c.bits;let u,l,T,v,y,x,N=0,L=0,Q=0,J=0,at=0,Rt=0,vt=0,pt=0,kt=0,$t=0,se=null;const Te=new Uint16Array(16),mr=new Uint16Array(16);let Er,ar,kr,Nr=null;for(N=0;N<=Mf;N++)Te[N]=0;for(L=0;L<n;L++)Te[e[r+L]]++;for(at=d,J=Mf;J>=1&&Te[J]===0;J--);if(at>J&&(at=J),J===0)return i[o++]=20971520,i[o++]=20971520,c.bits=1,0;for(Q=1;Q<J&&Te[Q]===0;Q++);for(at<Q&&(at=Q),pt=1,N=1;N<=Mf;N++)if(pt<<=1,pt-=Te[N],pt<0)return-1;if(pt>0&&(t===0||J!==1))return-1;for(mr[1]=0,N=1;N<Mf;N++)mr[N+1]=mr[N]+Te[N];for(L=0;L<n;L++)e[r+L]!==0&&(s[mr[e[r+L]]++]=L);if(t===0?(se=Nr=s,x=20):t===1?(se=oW,Nr=sW,x=257):(se=aW,Nr=cW,x=0),$t=0,L=0,N=Q,y=o,Rt=at,vt=0,T=-1,kt=1<<at,v=kt-1,t===1&&kt>852||t===2&&kt>592)return 1;for(;;){Er=N-vt,s[L]+1<x?(ar=0,kr=s[L]):s[L]>=x?(ar=Nr[s[L]-x],kr=se[s[L]-x]):(ar=96,kr=0),u=1<<N-vt,l=1<<Rt,Q=l;do l-=u,i[y+($t>>vt)+l]=Er<<24|ar<<16|kr|0;while(l!==0);for(u=1<<N-1;$t&u;)u>>=1;if(u!==0?($t&=u-1,$t+=u):$t=0,L++,--Te[N]==0){if(N===J)break;N=e[r+s[L]]}if(N>at&&($t&v)!==T){for(vt===0&&(vt=at),y+=Q,Rt=N-vt,pt=1<<Rt;Rt+vt<J&&(pt-=Te[Rt+vt],!(pt<=0));)Rt++,pt<<=1;if(kt+=1<<Rt,t===1&&kt>852||t===2&&kt>592)return 1;T=$t&v,i[T]=at<<24|Rt<<16|y-o|0}}return $t!==0&&(i[y+$t]=N-vt<<24|64<<16|0),c.bits=at,0};const{Z_FINISH:VP,Z_BLOCK:dW,Z_TREES:Uf,Z_OK:wc,Z_STREAM_END:uW,Z_NEED_DICT:lW,Z_STREAM_ERROR:Wo,Z_DATA_ERROR:jP,Z_MEM_ERROR:BP,Z_BUF_ERROR:hW,Z_DEFLATED:FP}=Of,xf=16180,Vf=16190,ta=16191,DT=16192,kT=16194,jf=16199,Bf=16200,LT=16206,Wn=16209,GP=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function pW(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Nc=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<xf||e.mode>16211?1:0},HP=t=>{if(Nc(t))return Wo;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=xf,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,wc},WP=t=>{if(Nc(t))return Wo;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,HP(t)},KP=(t,e)=>{let r;if(Nc(t))return Wo;const n=t.state;return e<0?(r=0,e=-e):(r=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?Wo:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,WP(t))},zP=(t,e)=>{if(!t)return Wo;const r=new pW;t.state=r,r.strm=t,r.window=null,r.mode=xf;const n=KP(t,e);return n!==wc&&(t.state=null),n};let MT,UT,qP=!0;const fW=t=>{if(qP){MT=new Int32Array(512),UT=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Ll(1,t.lens,0,288,MT,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Ll(2,t.lens,0,32,UT,0,t.work,{bits:5}),qP=!1}t.lencode=MT,t.lenbits=9,t.distcode=UT,t.distbits=5},YP=(t,e,r,n)=>{let i;const o=t.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(e.subarray(r-o.wsize,r),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>n&&(i=n),o.window.set(e.subarray(r-n,r-n+i),o.wnext),(n-=i)?(o.window.set(e.subarray(r-n,r),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0};var mW=(t,e)=>{let r,n,i,o,s,c,d,u,l,T,v,y,x,N,L,Q,J,at,Rt,vt,pt,kt,$t=0;const se=new Uint8Array(4);let Te,mr;const Er=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Nc(t)||!t.output||!t.input&&t.avail_in!==0)return Wo;r=t.state,r.mode===ta&&(r.mode=DT),s=t.next_out,i=t.output,d=t.avail_out,o=t.next_in,n=t.input,c=t.avail_in,u=r.hold,l=r.bits,T=c,v=d,kt=wc;t:for(;;)switch(r.mode){case xf:if(r.wrap===0){r.mode=DT;break}for(;l<16;){if(c===0)break t;c--,u+=n[o++]<<l,l+=8}if(2&r.wrap&&u===35615){r.wbits===0&&(r.wbits=15),r.check=0,se[0]=255&u,se[1]=u>>>8&255,r.check=Ai(r.check,se,2,0),u=0,l=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&u)<<8)+(u>>8))%31){t.msg="incorrect header check",r.mode=Wn;break}if((15&u)!==FP){t.msg="unknown compression method",r.mode=Wn;break}if(u>>>=4,l-=4,pt=8+(15&u),r.wbits===0&&(r.wbits=pt),pt>15||pt>r.wbits){t.msg="invalid window size",r.mode=Wn;break}r.dmax=1<<r.wbits,r.flags=0,t.adler=r.check=1,r.mode=512&u?16189:ta,u=0,l=0;break;case 16181:for(;l<16;){if(c===0)break t;c--,u+=n[o++]<<l,l+=8}if(r.flags=u,(255&vi(r))!==FP){t.msg="unknown compression method",r.mode=Wn;break}if(57344&vi(r)){t.msg="unknown header flags set",r.mode=Wn;break}r.head&&(r.head.text=u>>8&1),512&vi(r)&&4&r.wrap&&(se[0]=255&u,se[1]=u>>>8&255,r.check=Ai(r.check,se,2,0)),u=0,l=0,r.mode=16182;case 16182:for(;l<32;){if(c===0)break t;c--,u+=n[o++]<<l,l+=8}r.head&&(r.head.time=u),512&vi(r)&&4&r.wrap&&(se[0]=255&u,se[1]=u>>>8&255,se[2]=u>>>16&255,se[3]=u>>>24&255,r.check=Ai(r.check,se,4,0)),u=0,l=0,r.mode=16183;case 16183:for(;l<16;){if(c===0)break t;c--,u+=n[o++]<<l,l+=8}r.head&&(r.head.xflags=255&u,r.head.os=u>>8),512&vi(r)&&4&r.wrap&&(se[0]=255&u,se[1]=u>>>8&255,r.check=Ai(r.check,se,2,0)),u=0,l=0,r.mode=16184;case 16184:if(1024&vi(r)){for(;l<16;){if(c===0)break t;c--,u+=n[o++]<<l,l+=8}r.length=u,r.head&&(r.head.extra_len=u),512&vi(r)&&4&r.wrap&&(se[0]=255&u,se[1]=u>>>8&255,r.check=Ai(r.check,se,2,0)),u=0,l=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&vi(r)&&(y=r.length,y>c&&(y=c),y&&(r.head&&(pt=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(o,o+y),pt)),512&vi(r)&&4&r.wrap&&(r.check=Ai(r.check,n,y,o)),c-=y,o+=y,r.length-=y),r.length))break t;r.length=0,r.mode=16186;case 16186:if(2048&vi(r)){if(c===0)break t;y=0;do pt=n[o+y++],r.head&&pt&&r.length<65536&&(r.head.name+=String.fromCharCode(pt));while(pt&&y<c);if(512&vi(r)&&4&r.wrap&&(r.check=Ai(r.check,n,y,o)),c-=y,o+=y,pt)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&vi(r)){if(c===0)break t;y=0;do pt=n[o+y++],r.head&&pt&&r.length<65536&&(r.head.comment+=String.fromCharCode(pt));while(pt&&y<c);if(512&vi(r)&&4&r.wrap&&(r.check=Ai(r.check,n,y,o)),c-=y,o+=y,pt)break t}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&vi(r)){for(;l<16;){if(c===0)break t;c--,u+=n[o++]<<l,l+=8}if(4&r.wrap&&u!==(65535&r.check)){t.msg="header crc mismatch",r.mode=Wn;break}u=0,l=0}r.head&&(r.head.hcrc=vi(r)>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=ta;break;case 16189:for(;l<32;){if(c===0)break t;c--,u+=n[o++]<<l,l+=8}t.adler=r.check=GP(u),u=0,l=0,r.mode=Vf;case Vf:if(r.havedict===0)return t.next_out=s,t.avail_out=d,t.next_in=o,t.avail_in=c,r.hold=u,r.bits=l,lW;t.adler=r.check=1,r.mode=ta;case ta:if(e===dW||e===Uf)break t;case DT:if(r.last){u>>>=7&l,l-=7&l,r.mode=LT;break}for(;l<3;){if(c===0)break t;c--,u+=n[o++]<<l,l+=8}switch(r.last=1&u,u>>>=1,l-=1,3&u){case 0:r.mode=16193;break;case 1:if(fW(r),r.mode=jf,e===Uf){u>>>=2,l-=2;break t}break;case 2:r.mode=16196;break;case 3:t.msg="invalid block type",r.mode=Wn}u>>>=2,l-=2;break;case 16193:for(u>>>=7&l,l-=7&l;l<32;){if(c===0)break t;c--,u+=n[o++]<<l,l+=8}if((65535&u)!=(u>>>16^65535)){t.msg="invalid stored block lengths",r.mode=Wn;break}if(r.length=65535&u,u=0,l=0,r.mode=kT,e===Uf)break t;case kT:r.mode=16195;case 16195:if(y=r.length,y){if(y>c&&(y=c),y>d&&(y=d),y===0)break t;i.set(n.subarray(o,o+y),s),c-=y,o+=y,d-=y,s+=y,r.length-=y;break}r.mode=ta;break;case 16196:for(;l<14;){if(c===0)break t;c--,u+=n[o++]<<l,l+=8}if(r.nlen=257+(31&u),u>>>=5,l-=5,r.ndist=1+(31&u),u>>>=5,l-=5,r.ncode=4+(15&u),u>>>=4,l-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=Wn;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;l<3;){if(c===0)break t;c--,u+=n[o++]<<l,l+=8}r.lens[Er[r.have++]]=7&u,u>>>=3,l-=3}for(;r.have<19;)r.lens[Er[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,Te={bits:r.lenbits},kt=Ll(0,r.lens,0,19,r.lencode,0,r.work,Te),r.lenbits=Te.bits,kt){t.msg="invalid code lengths set",r.mode=Wn;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;$t=r.lencode[u&(1<<r.lenbits)-1],L=$t>>>24,Q=$t>>>16&255,J=65535&$t,!(L<=l);){if(c===0)break t;c--,u+=n[o++]<<l,l+=8}if(J<16)u>>>=L,l-=L,r.lens[r.have++]=J;else{if(J===16){for(mr=L+2;l<mr;){if(c===0)break t;c--,u+=n[o++]<<l,l+=8}if(u>>>=L,l-=L,r.have===0){t.msg="invalid bit length repeat",r.mode=Wn;break}pt=r.lens[r.have-1],y=3+(3&u),u>>>=2,l-=2}else if(J===17){for(mr=L+3;l<mr;){if(c===0)break t;c--,u+=n[o++]<<l,l+=8}u>>>=L,l-=L,pt=0,y=3+(7&u),u>>>=3,l-=3}else{for(mr=L+7;l<mr;){if(c===0)break t;c--,u+=n[o++]<<l,l+=8}u>>>=L,l-=L,pt=0,y=11+(127&u),u>>>=7,l-=7}if(r.have+y>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=Wn;break}for(;y--;)r.lens[r.have++]=pt}}if(r.mode===Wn)break;if(r.lens[256]===0){t.msg="invalid code -- missing end-of-block",r.mode=Wn;break}if(r.lenbits=9,Te={bits:r.lenbits},kt=Ll(1,r.lens,0,r.nlen,r.lencode,0,r.work,Te),r.lenbits=Te.bits,kt){t.msg="invalid literal/lengths set",r.mode=Wn;break}if(r.distbits=6,r.distcode=r.distdyn,Te={bits:r.distbits},kt=Ll(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,Te),r.distbits=Te.bits,kt){t.msg="invalid distances set",r.mode=Wn;break}if(r.mode=jf,e===Uf)break t;case jf:r.mode=Bf;case Bf:if(c>=6&&d>=258){t.next_out=s,t.avail_out=d,t.next_in=o,t.avail_in=c,r.hold=u,r.bits=l,iW(t,v),s=t.next_out,i=t.output,d=t.avail_out,o=t.next_in,n=t.input,c=t.avail_in,u=r.hold,l=r.bits,r.mode===ta&&(r.back=-1);break}for(r.back=0;$t=r.lencode[u&(1<<r.lenbits)-1],L=$t>>>24,Q=$t>>>16&255,J=65535&$t,!(L<=l);){if(c===0)break t;c--,u+=n[o++]<<l,l+=8}if(Q&&!(240&Q)){for(at=L,Rt=Q,vt=J;$t=r.lencode[vt+((u&(1<<at+Rt)-1)>>at)],L=$t>>>24,Q=$t>>>16&255,J=65535&$t,!(at+L<=l);){if(c===0)break t;c--,u+=n[o++]<<l,l+=8}u>>>=at,l-=at,r.back+=at}if(u>>>=L,l-=L,r.back+=L,r.length=J,Q===0){r.mode=16205;break}if(32&Q){r.back=-1,r.mode=ta;break}if(64&Q){t.msg="invalid literal/length code",r.mode=Wn;break}r.extra=15&Q,r.mode=16201;case 16201:if(r.extra){for(mr=r.extra;l<mr;){if(c===0)break t;c--,u+=n[o++]<<l,l+=8}r.length+=u&(1<<r.extra)-1,u>>>=r.extra,l-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;$t=r.distcode[u&(1<<r.distbits)-1],L=$t>>>24,Q=$t>>>16&255,J=65535&$t,!(L<=l);){if(c===0)break t;c--,u+=n[o++]<<l,l+=8}if(!(240&Q)){for(at=L,Rt=Q,vt=J;$t=r.distcode[vt+((u&(1<<at+Rt)-1)>>at)],L=$t>>>24,Q=$t>>>16&255,J=65535&$t,!(at+L<=l);){if(c===0)break t;c--,u+=n[o++]<<l,l+=8}u>>>=at,l-=at,r.back+=at}if(u>>>=L,l-=L,r.back+=L,64&Q){t.msg="invalid distance code",r.mode=Wn;break}r.offset=J,r.extra=15&Q,r.mode=16203;case 16203:if(r.extra){for(mr=r.extra;l<mr;){if(c===0)break t;c--,u+=n[o++]<<l,l+=8}r.offset+=u&(1<<r.extra)-1,u>>>=r.extra,l-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=Wn;break}r.mode=16204;case 16204:if(d===0)break t;if(y=v-d,r.offset>y){if(y=r.offset-y,y>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=Wn;break}y>r.wnext?(y-=r.wnext,x=r.wsize-y):x=r.wnext-y,y>r.length&&(y=r.length),N=r.window}else N=i,x=s-r.offset,y=r.length;y>d&&(y=d),d-=y,r.length-=y;do i[s++]=N[x++];while(--y);r.length===0&&(r.mode=Bf);break;case 16205:if(d===0)break t;i[s++]=r.length,d--,r.mode=Bf;break;case LT:if(r.wrap){for(;l<32;){if(c===0)break t;c--,u|=n[o++]<<l,l+=8}if(v-=d,t.total_out+=v,r.total+=v,4&r.wrap&&v&&(t.adler=r.check=vi(r)?Ai(r.check,i,v,s-v):Al(r.check,i,v,s-v)),v=d,4&r.wrap&&(vi(r)?u:GP(u))!==r.check){t.msg="incorrect data check",r.mode=Wn;break}u=0,l=0}r.mode=16207;case 16207:if(r.wrap&&vi(r)){for(;l<32;){if(c===0)break t;c--,u+=n[o++]<<l,l+=8}if(4&r.wrap&&u!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=Wn;break}u=0,l=0}r.mode=16208;case 16208:kt=uW;break t;case Wn:kt=jP;break t;case 16210:return BP;default:return Wo}return t.next_out=s,t.avail_out=d,t.next_in=o,t.avail_in=c,r.hold=u,r.bits=l,(r.wsize||v!==t.avail_out&&r.mode<Wn&&(r.mode<LT||e!==VP))&&YP(t,t.output,t.next_out,v-t.avail_out),T-=t.avail_in,v-=t.avail_out,t.total_in+=T,t.total_out+=v,r.total+=v,4&r.wrap&&v&&(t.adler=r.check=vi(r)?Ai(r.check,i,v,t.next_out-v):Al(r.check,i,v,t.next_out-v)),t.data_type=r.bits+(r.last?64:0)+(r.mode===ta?128:0)+(r.mode===jf||r.mode===kT?256:0),(T===0&&v===0||e===VP)&&kt===wc&&(kt=hW),kt},ea={inflateReset:WP,inflateReset2:KP,inflateResetKeep:HP,inflateInit:t=>zP(t,15),inflateInit2:zP,inflate:mW,inflateEnd:t=>{if(Nc(t))return Wo;let e=t.state;return e.window&&(e.window=null),t.state=null,wc},inflateGetHeader:(t,e)=>{if(Nc(t))return Wo;const r=t.state;return 2&r.wrap?(r.head=e,e.done=!1,wc):Wo},inflateSetDictionary:(t,e)=>{const r=e.length;let n,i,o;return Nc(t)?Wo:(n=t.state,n.wrap!==0&&n.mode!==Vf?Wo:n.mode===Vf&&(i=1,i=Al(i,e,r,0),i!==n.check)?jP:(o=YP(t,e,r,r),o?(n.mode=16210,BP):(n.havedict=1,wc)))},inflateInfo:"pako inflate (from Nodeca project)"},_W=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const XP=Object.prototype.toString,{Z_NO_FLUSH:EW,Z_FINISH:gW,Z_OK:Ml,Z_STREAM_END:xT,Z_NEED_DICT:VT,Z_STREAM_ERROR:TW,Z_DATA_ERROR:JP,Z_MEM_ERROR:vW}=Of;function Ff(t){this.options=Pf.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&!(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new UP,this.strm.avail_out=0;let r=ea.inflateInit2(this.strm,e.windowBits);if(r!==Ml)throw new Error(Cc[r]);if(this.header=new _W,ea.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=kl.string2buf(e.dictionary):XP.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=ea.inflateSetDictionary(this.strm,e.dictionary),r!==Ml)))throw new Error(Cc[r])}function yW(t,e){const r=new Ff(e);if(r.push(t),r.err)throw r.msg||Cc[r.err];return r.result}Ff.prototype.push=function(t,e){const r=this.strm,n=this.options.chunkSize,i=this.options.dictionary;let o,s,c;if(this.ended)return!1;for(s=e===~~e?e:e===!0?gW:EW,XP.call(t)==="[object ArrayBuffer]"?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),o=ea.inflate(r,s),o===VT&&i&&(o=ea.inflateSetDictionary(r,i),o===Ml?o=ea.inflate(r,s):o===JP&&(o=VT));r.avail_in>0&&o===xT&&r.state.wrap>0&&t[r.next_in]!==0;)ea.inflateReset(r),o=ea.inflate(r,s);switch(o){case TW:case JP:case VT:case vW:return this.onEnd(o),this.ended=!0,!1}if(c=r.avail_out,r.next_out&&(r.avail_out===0||o===xT))if(this.options.to==="string"){let d=kl.utf8border(r.output,r.next_out),u=r.next_out-d,l=kl.buf2string(r.output,d);r.next_out=u,r.avail_out=n-u,u&&r.output.set(r.output.subarray(d,d+u),0),this.onData(l)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(o!==Ml||c!==0){if(o===xT)return o=ea.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(r.avail_in===0)break}}return!0},Ff.prototype.onData=function(t){this.chunks.push(t)},Ff.prototype.onEnd=function(t){t===Ml&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Pf.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var SW={inflate:yW};const{deflate:RW}=nW,{inflate:IW}=SW;var CW=RW,AW=IW,ZP=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(ZP||{});class bW{constructor(){G(this,"_sequence",0),G(this,"_startTime",Date.now()),G(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const r={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const c=new Uint8Array(4);c.set([1,0,0,0]);const d={id:0,length:4,data:c.buffer},u={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[d]};r.commonPacketHeader.extension=1,r.extension=u,r.payload=this.compress(e),r.commonPacketHeader.length=8+(r.extension.length+2)+r.payload.byteLength}else r.commonPacketHeader.length=8+r.payload.byteLength;st("SHOW_DATASTREAM2_LOG")&&C.debug("send data header: ".concat(JSON.stringify(r.commonPacketHeader)));const n=new ArrayBuffer(r.commonPacketHeader.length),i=new Uint8Array(n),o=new DataView(n);let s=0;if(o.setUint16(s,r.commonPacketHeader.extension<<15|r.commonPacketHeader.reserved<<14|r.commonPacketHeader.length,!0),s+=2,o.setUint32(s,r.commonPacketHeader.sequence,!0),s+=4,o.setUint16(s,r.commonStreamHeader,!0),s+=2,r.extension){const c=this.serializeExtension(r.extension);i.set(new Uint8Array(c),s),s+=c.byteLength}if(i.set(new Uint8Array(r.payload),s),s+=r.payload.byteLength,s!==r.commonPacketHeader.length)throw Error("serialize error!");return n}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const r=new DataView(e);let n=0;const i=r.getUint16(n,!0);n+=2;const o={length:16383&i,reserved:(16384&i)>>14,extension:(32768&i)>>15,sequence:r.getUint16(n+2,!0)<<16|r.getUint16(n,!0)};let s,c;if(n+=4,st("SHOW_DATASTREAM2_LOG")&&C.debug("receive data header: ".concat(JSON.stringify(o))),r.getUint16(n,!0),n+=2,o.extension){c=this.deserializeExtension(e.slice(n)),n+=2+c.length,s=e.slice(n);let d=!1;if(c.datas.length>0){const u=c.datas.find(l=>l.id===0);u&&(d=(1&new DataView(u.data).getUint32(0,!0))==1)}s=d?this.decompress(s):s}else s=e.slice(8);return s}serializeExtension(e){const{profile:r,length:n,datas:i}=e,o=new ArrayBuffer(n+2),s=new Uint8Array(o),c=new DataView(o);let d=0;if(c.setUint8(d++,r),c.setUint8(d++,n),i.forEach(u=>{r?(c.setUint8(d++,u.id),c.setUint8(d++,u.length),s.set(new Uint8Array(u.data),d),d+=u.data.byteLength):(c.setUint8(d++,u.id|u.length<<4),s.set(new Uint8Array(u.data),d),d+=u.data.byteLength)}),d!==n+2)throw Error("serialize extension error, is ".concat(d,"!==").concat(n+2));return o}deserializeExtension(e){const r=new DataView(e);let n=0;const i=r.getUint8(n);n++;const o=r.getUint8(n);n++;const s=i===ZP.TWO_BYTE,c=[],d=new DataView(e,2);let u=0;for(;u<o;){let l=0,T=0,v=new ArrayBuffer(0);s?(l=d.getUint8(u),u++,T=d.getUint8(u),u++):(l=15&d.getUint8(u),T=d.getUint8(u)>>4,u++),T>0&&(v=d.buffer.slice(u+2,u+2+T),u+=v.byteLength),c.push({id:l,length:T,data:v})}if(u!==o)throw Error("parse error");return{profile:i,length:o,datas:c}}decompress(e){return AW(new Uint8Array(e))}compress(e){return CW(new Uint8Array(e))}}const OW={name:"DataStream",create:(t,e)=>{const r=e?new U6(t):new x6(t);return r.useDataStream(new bW),r}};class wW extends pn{constructor(e,r,n){super(),G(this,"ws",void 0),G(this,"requestId",1),G(this,"heartBeatTimer",void 0),G(this,"joinInfo",void 0),G(this,"clientId",void 0),G(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),G(this,"onClose",i=>{this.emit("close"),this.dispose()}),G(this,"onMessage",i=>{const o=JSON.parse(i.data);if(!o||o.command!=="serverResponse"||!o.requestId)return o&&o.command==="serverStatus"&&o.serverStatus&&o.serverStatus.command?(this.emit("status",o.serverStatus),void this.emit(o.serverStatus.command,o.serverStatus)):void 0;this.emit("req_".concat(o.requestId),o)}),this.joinInfo=e,this.clientId=r,this.ws=new al("cross-channel-".concat(this.clientId),n),this.ws.on(pr.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(pr.CONNECTED,this.onOpen),this.ws.on(pr.ON_MESSAGE,this.onMessage),this.ws.on(pr.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){const r=this.requestId++;return e.requestId=r,e.seq=r,this.ws.sendMessage(e),r}waitStatus(e){return new De((r,n)=>{const i=window.setTimeout(()=>{n(new Bt(et.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,o=>{window.clearTimeout(i),o.state&&o.state!==0?n(new Bt(et.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):r(void 0)}),this.once("dispose",()=>{window.clearTimeout(i),n(new Bt(et.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new Bt(et.WS_DISCONNECT);const r=()=>new De((s,c)=>{this.ws.once(pr.CLOSED,()=>c(new Bt(et.WS_ABORT))),this.ws.once(pr.CONNECTED,s)});this.ws.state!=="connected"&&await r();const n=this.sendMessage(e),i=new De((s,c)=>{const d=()=>{c(new Bt(et.WS_ABORT))};this.ws.once(pr.RECONNECTING,d),this.ws.once(pr.CLOSED,d),this.once("req_".concat(n),s),Yn(3e3).then(()=>{this.removeAllListeners("req_".concat(n)),this.ws.off(pr.RECONNECTING,d),this.ws.off(pr.CLOSED,d),c(new Bt(et.TIMEOUT,"cross channel ws request timeout"))})}),o=await i;if(!o||o.code!==200)throw new Bt(et.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(o)));return o}async connect(e){this.ws.removeAllListeners(pr.REQUEST_NEW_URLS),this.ws.on(pr.REQUEST_NEW_URLS,r=>{r(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const r=this.requestId++;return e.requestId=r,this.ws.sendMessage(e),r}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class NW extends pn{set state(e){e!==this._state&&(e!==Mi.RELAY_STATE_FAILURE&&(this.errorCode=Md.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,r,n,i,o){super(),G(this,"joinInfo",void 0),G(this,"sid",void 0),G(this,"clientId",void 0),G(this,"cancelToken",bi.CancelToken.source()),G(this,"workerToken",void 0),G(this,"requestId",0),G(this,"signal",void 0),G(this,"prevChannelMediaConfig",void 0),G(this,"httpRetryConfig",void 0),G(this,"_resolution",void 0),G(this,"_state",Mi.RELAY_STATE_IDLE),G(this,"errorCode",Md.RELAY_OK),G(this,"onStatus",s=>{C.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(s))),s&&s.command&&(s.command==="onAudioPacketReceived"&&this.emit("event",Xs.PACKET_RECEIVED_AUDIO_FROM_SRC),s.command==="onVideoPacketReceived"&&this.emit("event",Xs.PACKET_RECEIVED_VIDEO_FROM_SRC),s.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Md.SRC_TOKEN_EXPIRED,this.state=Mi.RELAY_STATE_FAILURE),s.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Md.DEST_TOKEN_EXPIRED,this.state=Mi.RELAY_STATE_FAILURE))}),G(this,"onReconnect",async()=>{C.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Xs.NETWORK_DISCONNECTED),this.state=Mi.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(s=>{this.state!==Mi.RELAY_STATE_IDLE&&(C.error("auto restart channel media relay failed",s.toString()),this.errorCode=Md.SERVER_CONNECTION_LOST,this.state=Mi.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=r,this.sid=lc(),this.signal=new wW(this.joinInfo,this.clientId,n),this.httpRetryConfig=i,this._resolution=o}async startChannelMediaRelay(e){if(this.state!==Mi.RELAY_STATE_IDLE)throw new Bt(et.INVALID_OPERATION);this.state=Mi.RELAY_STATE_CONNECTING,await this.connect(),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(r){throw r.data&&r.data.serverResponse&&r.data.serverResponse.command==="SetSourceChannel"?new Bt(et.CROSS_CHANNEL_FAILED_JOIN_SRC):r.data&&r.data.serverResponse&&r.serverResponse.command==="SetDestChannelStatus"?new Bt(et.CROSS_CHANNEL_FAILED_JOIN_DEST):r.data&&r.data.serverResponse&&r.serverResponse.command==="StartPacketTransfer"?new Bt(et.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):r}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==Mi.RELAY_STATE_RUNNING)throw new Bt(et.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==Mi.RELAY_STATE_RUNNING)throw new Bt(et.INVALID_OPERATION);const r=this.genMessage(Ci.SetVideoProfile);await this.signal.request(r),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),C.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Mi.RELAY_STATE_IDLE,this.dispose()}dispose(){C.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=bi.CancelToken.source(),this.state=Mi.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await GH(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",Xs.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const r=this.genMessage(Ci.StopPacketTransfer);await this.signal.request(r),await this.signal.waitStatus("Normal Quit"),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const n=this.genMessage(Ci.SetSdkProfile,e);await this.signal.request(n),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const i=this.genMessage(Ci.SetSourceChannel,e);await this.signal.request(i),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Xs.PACKET_JOINED_SRC_CHANNEL),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const o=this.genMessage(Ci.SetSourceUserId,e);await this.signal.request(o),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const s=this.genMessage(Ci.SetDestChannel,e);await this.signal.request(s),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Xs.PACKET_JOINED_DEST_CHANNEL),C.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const c=this.genMessage(Ci.StartPacketTransfer,e);await this.signal.request(c),this.emit("event",Xs.PACKET_SENT_TO_DEST_CHANNEL),this.state=Mi.RELAY_STATE_RUNNING,C.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const r=this.genMessage(Ci.UpdateDestChannel,e);await this.signal.request(r),this.emit("event",Xs.PACKET_UPDATE_DEST_CHANNEL),C.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(Ci.StopPacketTransfer);await this.signal.request(e),C.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,r){const n=[],i=[],o=[];this.requestId+=1;const s={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:po,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};s.sdkVersion==="4.24.0"&&(s.sdkVersion="0.0.1");let c=null,d=null;switch(e){case Ci.SetSdkProfile:return s.clientRequest={command:"SetSdkProfile",type:"multi_channel"},s;case Ci.SetSourceChannel:if(d=r&&r.getSrcChannelMediaInfo(),!d)throw new Bt(et.UNEXPECTED_ERROR,"can not find source config");return s.clientRequest={command:"SetSourceChannel",uid:"0",channelName:d.channelName,token:d.token||this.joinInfo.appId},s;case Ci.SetSourceUserId:if(d=r&&r.getSrcChannelMediaInfo(),!d)throw new Bt(et.UNEXPECTED_ERROR,"can not find source config");return s.clientRequest={command:"SetSourceUserId",uid:d.uid+""},s;case Ci.SetDestChannel:if(c=r&&r.getDestChannelMediaInfo(),!c)throw new Bt(et.UNEXPECTED_ERROR,"can not find dest config");return c.forEach(u=>{n.push(u.channelName),i.push(u.uid+""),o.push(u.token||this.joinInfo.appId)}),s.clientRequest={command:"SetDestChannel",channelName:n,uid:i,token:o},s;case Ci.StartPacketTransfer:return s.clientRequest={command:"StartPacketTransfer"},s;case Ci.Reconnect:return s.clientRequest={command:"Reconnect"},s;case Ci.StopPacketTransfer:return s.clientRequest={command:"StopPacketTransfer"},s;case Ci.UpdateDestChannel:if(c=r&&r.getDestChannelMediaInfo(),!c)throw new Bt(et.UNEXPECTED_ERROR,"can not find dest config");return c.forEach(u=>{n.push(u.channelName),i.push(u.uid+""),o.push(u.token||this.joinInfo.appId)}),s.clientRequest={command:"UpdateDestChannel",channelName:n,uid:i,token:o},s;case Ci.SetVideoProfile:s.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return s}}const PW={name:"ChannelMediaRelay",create:function(t){return new NW(t.joinInfo,t.clientId,t.websocketRetryConfig||bn,t.httpRetryConfig||bn,t.resolution)}};function QP(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Ul(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?QP(Object(r),!0).forEach(function(n){G(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):QP(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}class DW extends pn{constructor(e,r,n,i){super(),G(this,"spec",void 0),G(this,"token",void 0),G(this,"websocket",void 0),G(this,"pingpongTimer",void 0),G(this,"reconnectMode","retry"),G(this,"serviceMode",void 0),G(this,"reqId",0),G(this,"commandReqId",0),G(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),G(this,"handleWebSocketMessage",o=>{if(!o.data)return;const s=JSON.parse(o.data);s.requestId?this.emit("@".concat(s.requestId,"-").concat(s.sid),s):(qe.workerEvent(this.spec.sid,{actionType:"status",serverCode:s.code,workerType:this.serviceMode===Ys.TRANSCODE?1:2}),this.emit(ba.PUBLISH_STREAM_STATUS,s))}),this.spec=r,this.token=e,this.serviceMode=i,this.websocket=new al("live-streaming",n),this.websocket.on(pr.CONNECTED,this.handleWebSocketOpen),this.websocket.on(pr.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(pr.REQUEST_NEW_URLS,(o,s)=>{ni(this,ba.REQUEST_NEW_ADDRESS).then(o).catch(s)}),this.websocket.on(pr.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,r,n,i){this.reqId+=1,e==="request"&&(this.commandReqId+=1);const o=this.commandReqId,s=this.reqId;if(!s||!this.websocket)throw new Bt(et.UNEXPECTED_ERROR);const c=Ul({command:e,sdkVersion:po==="4.24.0"?"0.0.1":po,seq:s,requestId:s,allocate:n,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},r);if(this.websocket.state==="closed")throw new Bt(et.WS_DISCONNECT);const d=()=>new De((v,y)=>{this.websocket.once(pr.CLOSED,()=>y(new Bt(et.WS_ABORT))),this.websocket.once(pr.CONNECTED,v)});this.websocket.state!=="connected"&&await d(),c.clientRequest&&(c.clientRequest.workerToken=this.token);const u=new De((v,y)=>{const x=()=>{y(new Bt(et.WS_ABORT))};this.websocket.once(pr.RECONNECTING,x),this.websocket.once(pr.CLOSED,x),this.once("@".concat(s,"-").concat(this.spec.sid),N=>{v(N)})});i&&qe.workerEvent(this.spec.sid,Ul(Ul({},i),{},{requestId:o,actionType:"request",payload:JSON.stringify(r.clientRequest),serverCode:0,code:0}));const l=Date.now();this.websocket.sendMessage(c);let T=null;try{T=await u}catch(v){if(this.websocket.state==="closed")throw v;return await d(),await this.request(e,r,n)}return i&&qe.workerEvent(this.spec.sid,Ul(Ul({},i),{},{requestId:o,actionType:"response",payload:JSON.stringify(T.serverResponse),serverCode:T.code,success:T.code===200,responseTime:Date.now()-l})),T.code!==200&&this.handleResponseError(T),T}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e=po==="4.24.0"?"0.0.1":po;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case Pn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void C.warning("live stream response already exists stream");case Pn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Pn.LIVE_STREAM_RESPONSE_BAD_STREAM:case Pn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Bt(et.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case Pn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream")return;throw new Bt(et.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Pn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Bt(et.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case Pn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const r=new Bt(et.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(ba.WARNING,r,e.serverResponse.url)}case Pn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const r=new Bt(et.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(ba.WARNING,r,e.serverResponse.url)}case Pn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Bt(et.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Pn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Bt(et.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case Pn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const r=new Bt(et.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(ba.WARNING,r,e.serverResponse.url)}case Pn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Bt(et.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case Pn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Bt(et.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Pn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Pn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream")return;throw new Bt(et.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Pn.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new Bt(et.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new Bt(et.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Pn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Pn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Pn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Pn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Bt(et.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Cp)},6e3)}}function $P(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Ui(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?$P(Object(r),!0).forEach(function(n){G(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):$P(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}class kW extends pn{constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:bn,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:bn;super(),G(this,"onLiveStreamWarning",void 0),G(this,"onLiveStreamError",void 0),G(this,"spec",void 0),G(this,"retryTimeout",1e4),G(this,"connection",void 0),G(this,"httpRetryConfig",void 0),G(this,"wsRetryConfig",void 0),G(this,"streamingTasks",new Map),G(this,"isStartingStreamingTask",!1),G(this,"taskMutex",new si("live-streaming")),G(this,"cancelToken",bi.CancelToken.source()),G(this,"transcodingConfig",void 0),G(this,"uapResponse",void 0),G(this,"lastTaskId",1),G(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=n,this.wsRetryConfig=r}async setTranscodingConfig(e){const r=Ui(Ui({},vH),e);r.videoCodecProfile!==66&&r.videoCodecProfile!==77&&r.videoCodecProfile!==100&&(C.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(r.videoCodecProfile," -> 100")),r.videoCodecProfile=100),r.transcodingUsers||(r.transcodingUsers=r.userConfigs),r.transcodingUsers&&(r.transcodingUsers=r.transcodingUsers.map(s=>Ui(Ui(Ui({},TH),s),{},{zOrder:s.zOrder?s.zOrder+1:1}))),function(s){_n(s.width)||Hr(s.width,"config.width",0,1e4),_n(s.height)||Hr(s.height,"config.height",0,1e4),_n(s.videoBitrate)||Hr(s.videoBitrate,"config.videoBitrate",1,1e6),_n(s.videoFrameRate)||Hr(s.videoFrameRate,"config.videoFrameRate"),_n(s.lowLatency)||ns(s.lowLatency,"config.lowLatency"),_n(s.audioSampleRate)||Mn(s.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),_n(s.audioBitrate)||Hr(s.audioBitrate,"config.audioBitrate",1,128),_n(s.audioChannels)||Mn(s.audioChannels,"config.audioChannels",[1,2,3,4,5]),_n(s.videoGop)||Hr(s.videoGop,"config.videoGop"),_n(s.videoCodecProfile)||Mn(s.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),_n(s.userCount)||Hr(s.userCount,"config.userCount",0,17),_n(s.backgroundColor)||Hr(s.backgroundColor,"config.backgroundColor",0,16777215),_n(s.userConfigExtraInfo)||qn(s.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),s.transcodingUsers&&!_n(s.transcodingUsers)&&(qs(s.transcodingUsers,"config.transcodingUsers"),s.transcodingUsers.forEach((c,d)=>{Xp(c.uid),_n(c.x)||Hr(c.x,"transcodingUser[".concat(d,"].x"),0,1e4),_n(c.y)||Hr(c.y,"transcodingUser[".concat(d,"].y"),0,1e4),_n(c.width)||Hr(c.width,"transcodingUser[".concat(d,"].width"),0,1e4),_n(c.height)||Hr(c.height,"transcodingUser[".concat(d,"].height"),0,1e4),_n(c.zOrder)||Hr(c.zOrder-1,"transcodingUser[".concat(d,"].zOrder"),0,100),_n(c.alpha)||Hr(c.alpha,"transcodingUser[".concat(d,"].alpha"),0,1,!1)})),_n(s.watermark)||xg(s.watermark,"watermark"),_n(s.backgroundImage)||xg(s.backgroundImage,"backgroundImage"),s.images&&!_n(s.images)&&(qs(s.images,"config.images"),s.images.forEach((c,d)=>{xg(c,"images[".concat(d,"]"))}))}(r);const n=[];r.images&&n.push(...r.images.map(s=>Ui(Ui(Ui({},Ug),s),{},{zOrder:255}))),r.backgroundImage&&(n.push(Ui(Ui(Ui({},Ug),r.backgroundImage),{},{zOrder:0})),delete r.backgroundImage),r.watermark&&(n.push(Ui(Ui(Ui({},Ug),r.watermark),{},{zOrder:255})),delete r.watermark),r.images=n,r.transcodingUsers&&(r.userConfigs=r.transcodingUsers.map(s=>Ui({},s)),r.userCount=r.transcodingUsers.length,delete r.transcodingUsers);const i=(r.userConfigs||[]).map(s=>typeof s.uid=="number"?De.resolve(s.uid):Iw(s.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await De.all(i)).forEach((s,c)=>{r.userConfigs&&r.userConfigs[c]&&(r.userConfigs[c].uid=s)}),this.transcodingConfig=r,this.connection)try{var o;const s=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Gi(o=this.streamingTasks).call(o)).map(c=>c.taskId).join("#")});C.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(s.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(s){if(!s.data||!s.data.retry)throw s;s.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(c=>{C.warning("[".concat(this.spec.clientId,"] live streaming receive error"),s.toString(),"try to republish",c.url),this.startLiveStreamingTask(c.url,c.mode,s).then(()=>{C.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(c.url," success"))}).catch(d=>{C.error("[".concat(this.spec.clientId,"] live streaming republish failed"),c.url,d.toString()),this.onLiveStreamError&&this.onLiveStreamError(c.url,d)})})}}async startLiveStreamingTask(e,r,n){if(!this.transcodingConfig&&r===Ys.TRANSCODE)throw new Bt(et.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const i={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};C.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(r));const o=await this.taskMutex.lock();if(!this.connection&&n)return void o();if(this.streamingTasks.get(e)&&!n)return o(),new Bt(et.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(r))}catch(c){throw o(),c}switch(r){case Ys.TRANSCODE:i.transcodingConfig=Ui({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const s=this.lastTaskId++;try{const c=new De((u,l)=>{Yn(this.retryTimeout).then(()=>{if(n)return l(n);const T=this.statusError.get(e);return T?(this.statusError.delete(e),l(T)):void 0})}),d=await De.race([this.connection.request("request",{clientRequest:i},!0,{url:e,command:"PublishStream",workerType:r===Ys.TRANSCODE?1:2,requestByUser:!n,tid:s.toString()}),c]);this.isStartingStreamingTask=!1,C.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(d.code)),this.streamingTasks.set(e,{clientRequest:i,mode:r,url:e,taskId:s}),o()}catch(c){if(o(),this.isStartingStreamingTask=!1,!c.data||!c.data.retry||n)throw c;return c.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,r,c)):await this.startLiveStreamingTask(e,r,c)}}stopLiveStreamingTask(e){return new De((r,n)=>{const i=this.streamingTasks.get(e);if(!i||!this.connection)return new Bt(et.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const o=i.mode;i.abortTask=()=>{C.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),r()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:i.url}},!1,{url:e,command:"UnPublishStream",workerType:o===Ys.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(s=>{C.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(s.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),r()}).catch(n)})}resetAllTask(){var e;const r=Array.from(Gi(e=this.streamingTasks).call(e));this.terminate();for(const n of r)this.startLiveStreamingTask(n.url,n.mode).catch(i=>{this.onLiveStreamError&&this.onLiveStreamError(n.url,i)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=bi.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new Bt(et.UNEXPECTED_ERROR,"live streaming connection has already connected");const r=await ni(this,Vg.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=r,this.connection=new DW(r.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(ba.WARNING,(n,i)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(i,n)),this.connection.on(ba.PUBLISH_STREAM_STATUS,n=>this.handlePublishStreamServer(n)),this.connection.on(ba.REQUEST_NEW_ADDRESS,(n,i)=>{if(!this.connection)return i(new Bt(et.UNEXPECTED_ERROR,"can not get new live streaming address list"));ni(this,Vg.REQUEST_WORKER_MANAGER_LIST,e).then(o=>{this.uapResponse=o,n(o.addressList)}).catch(i)}),await this.connection.init(r.addressList),this.connection}handlePublishStreamServer(e){const r=e.serverStatus&&e.serverStatus.url||"empty_url",n=this.streamingTasks.get(r),i=e.reason;switch(e.code){case Pn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Pn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Pn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Pn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const s=new Bt(et.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(n)return C.error(s.toString()),this.onLiveStreamError&&this.onLiveStreamError(r,s);if(!this.isStartingStreamingTask)return;this.statusError.set(r,s)}case Pn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s=new Bt(et.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(r,s)}case Pn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Pn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var o;if(!this.connection)return;this.connection.tryNextAddress();const s=Array.from(Gi(o=this.streamingTasks).call(o));for(const c of s)c.abortTask?c.abortTask():(C.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",c.url),this.startLiveStreamingTask(c.url,c.mode,new Bt(et.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{C.debug("[".concat(this.spec.clientId,"] republish live stream success"),c.url)}).catch(d=>{C.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(c.url,d)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}}const LW={name:"LiveStreaming",create:function(t){return new kW(t.joinInfo,t.websocketRetryConfig||bn,t.httpRetryConfig||bn)}};function MW(t){let e=rD();return function(r,n){let i=r.appId;i!==void 0&&(Vr(n,10),Ms(n,i));let o=r.cid;o!==void 0&&(Vr(n,16),Vr(n,o));let s=r.cname;s!==void 0&&(Vr(n,26),Ms(n,s));let c=r.deviceId;c!==void 0&&(Vr(n,34),Ms(n,c));let d=r.elapse;d!==void 0&&(Vr(n,40),Ha(n,d));let u=r.fileSize;u!==void 0&&(Vr(n,48),Ha(n,Qd(u)));let l=r.height;l!==void 0&&(Vr(n,56),Ha(n,Qd(l)));let T=r.jpg;T!==void 0&&(Vr(n,66),Vr(n,T.length),function(li,ie){let Se=$d(li,ie.length);li.bytes.set(ie,Se)}(n,T));let v=r.networkType;v!==void 0&&(Vr(n,72),Ha(n,Qd(v)));let y=r.osType;y!==void 0&&(Vr(n,80),Ha(n,Qd(y)));let x=r.requestId;x!==void 0&&(Vr(n,90),Ms(n,x));let N=r.sdkVersion;N!==void 0&&(Vr(n,98),Ms(n,N));let L=r.sequence;L!==void 0&&(Vr(n,104),Ha(n,Qd(L)));let Q=r.sid;Q!==void 0&&(Vr(n,114),Ms(n,Q));let J=r.timestamp;J!==void 0&&(Vr(n,120),Ha(n,J));let at=r.uid;at!==void 0&&(Vr(n,128),Vr(n,at));let Rt=r.vid;Rt!==void 0&&(Vr(n,136),Vr(n,Rt));let vt=r.width;vt!==void 0&&(Vr(n,144),Ha(n,Qd(vt)));let pt=r.service;pt!==void 0&&(Vr(n,152),Vr(n,pt));let kt=r.callbackData;kt!==void 0&&(Vr(n,162),Ms(n,kt));let $t=r.jpgEncryption;$t!==void 0&&(Vr(n,168),Vr(n,$t));let se=r.requestType;se!==void 0&&(Vr(n,176),Vr(n,se));let Te=r.scorePorn;Te!==void 0&&(Vr(n,185),HT(n,Te));let mr=r.scoreSexy;mr!==void 0&&(Vr(n,193),HT(n,mr));let Er=r.scoreNeutral;Er!==void 0&&(Vr(n,201),HT(n,Er));let ar=r.scene;ar!==void 0&&(Vr(n,208),Vr(n,ar));let kr=r.ossFilePrefix;kr!==void 0&&(Vr(n,218),Ms(n,kr));let Nr=r.serviceVendor;if(Nr!==void 0)for(let li of Nr){Vr(n,226);let ie=rD();VW(li,ie),Vr(n,ie.limit),GW(n,ie),FW(ie)}}(t,e),function(r){let n=r.bytes,i=r.limit;return n.length===i?n:n.subarray(0,i)}(e)}function UW(t){return function(r){let n={};t:for(;!nD(r);){let i=Us(r);switch(i>>>3){case 0:break t;case 1:n.code=Us(r);break;case 2:n.msg=iD(r,Us(r));break;case 3:{let o=jW(r);n.data=xW(r),r.limit=o;break}default:tD(r,7&i)}}return n}({bytes:e=t,offset:0,limit:e.length});var e}function xW(t){let e={};t:for(;!nD(t);){let r=Us(t);switch(r>>>3){case 0:break t;case 1:e.requestId=iD(t,Us(t));break;case 2:e.requestType=Us(t)>>>0;break;case 3:e.scorePorn=GT(t);break;case 4:e.scoreSexy=GT(t);break;case 5:e.scoreNeutral=GT(t);break;case 6:e.requestScene=Us(t)>>>0;break;case 7:e.scene=Us(t)>>>0;break;default:tD(t,7&r)}}return e}function VW(t,e){let r=t.service;r!==void 0&&(Vr(e,8),Vr(e,r));let n=t.vendor;n!==void 0&&(Vr(e,16),Vr(e,n));let i=t.token;i!==void 0&&(Vr(e,26),Ms(e,i));let o=t.callbackUrl;o!==void 0&&(Vr(e,34),Ms(e,o))}function jW(t){let e=Us(t),r=t.limit;return t.limit=t.offset+e,r}function tD(t,e){switch(e){case 0:for(;128&oD(t););break;case 2:BT(t,Us(t));break;case 5:BT(t,4);break;case 1:BT(t,8);break;default:throw new Error("Unimplemented type: "+e)}}let BW=new Float32Array(1);new Uint8Array(BW.buffer);let jT=new Float64Array(1),xi=new Uint8Array(jT.buffer);function Qd(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let eD=[];function rD(){const t=eD.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function FW(t){eD.push(t)}function BT(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function nD(t){return t.offset>=t.limit}function $d(t,e){let r=t.bytes,n=t.offset,i=t.limit,o=n+e;if(o>r.length){let s=new Uint8Array(2*o);s.set(r),t.bytes=s}return t.offset=o,o>i&&(t.limit=o),n}function FT(t,e){let r=t.offset;if(r+e>t.limit)throw new Error("Read past limit");return t.offset+=e,r}function iD(t,e){let r=FT(t,e),n=String.fromCharCode,i=t.bytes,o="ï¿½",s="";for(let c=0;c<e;c++){let d,u,l,T,v=i[c+r];128&v?(224&v)==192?c+1>=e?s+=o:(d=i[c+r+1],(192&d)!=128?s+=o:(T=(31&v)<<6|63&d,T<128?s+=o:(s+=n(T),c++))):(240&v)==224?c+2>=e?s+=o:(d=i[c+r+1],u=i[c+r+2],(49344&(d|u<<8))!=32896?s+=o:(T=(15&v)<<12|(63&d)<<6|63&u,T<2048||T>=55296&&T<=57343?s+=o:(s+=n(T),c+=2))):(248&v)==240?c+3>=e?s+=o:(d=i[c+r+1],u=i[c+r+2],l=i[c+r+3],(12632256&(d|u<<8|l<<16))!=8421504?s+=o:(T=(7&v)<<18|(63&d)<<12|(63&u)<<6|63&l,T<65536||T>1114111?s+=o:(T-=65536,s+=n(55296+(T>>10),56320+(1023&T)),c+=3))):s+=o:s+=n(v)}return s}function Ms(t,e){let r=e.length,n=0;for(let s=0;s<r;s++){let c=e.charCodeAt(s);c>=55296&&c<=56319&&s+1<r&&(c=(c<<10)+e.charCodeAt(++s)-56613888),n+=c<128?1:c<2048?2:c<65536?3:4}Vr(t,n);let i=$d(t,n),o=t.bytes;for(let s=0;s<r;s++){let c=e.charCodeAt(s);c>=55296&&c<=56319&&s+1<r&&(c=(c<<10)+e.charCodeAt(++s)-56613888),c<128?o[i++]=c:(c<2048?o[i++]=c>>6&31|192:(c<65536?o[i++]=c>>12&15|224:(o[i++]=c>>18&7|240,o[i++]=c>>12&63|128),o[i++]=c>>6&63|128),o[i++]=63&c|128)}}function GW(t,e){let r=$d(t,e.limit),n=t.bytes,i=e.bytes;for(let o=0,s=e.limit;o<s;o++)n[o+r]=i[o]}function oD(t){return t.bytes[FT(t,1)]}function sD(t,e){let r=$d(t,1);t.bytes[r]=e}function GT(t){let e=FT(t,8),r=t.bytes;return xi[0]=r[e++],xi[1]=r[e++],xi[2]=r[e++],xi[3]=r[e++],xi[4]=r[e++],xi[5]=r[e++],xi[6]=r[e++],xi[7]=r[e++],jT[0]}function HT(t,e){let r=$d(t,8),n=t.bytes;jT[0]=e,n[r++]=xi[0],n[r++]=xi[1],n[r++]=xi[2],n[r++]=xi[3],n[r++]=xi[4],n[r++]=xi[5],n[r++]=xi[6],n[r++]=xi[7]}function Us(t){let e,r=0,n=0;do e=oD(t),r<32&&(n|=(127&e)<<r),r+=7;while(128&e);return n}function Vr(t,e){for(e>>>=0;e>=128;)sD(t,127&e|128),e>>>=7;sD(t,e)}function Ha(t,e){let r=e.low>>>0,n=(e.low>>>28|e.high<<4)>>>0,i=e.high>>>24,o=i===0?n===0?r<16384?r<128?1:2:r<1<<21?3:4:n<16384?n<128?5:6:n<1<<21?7:8:i<128?9:10,s=$d(t,o),c=t.bytes;switch(o){case 10:c[s+9]=i>>>7&1;case 9:c[s+8]=o!==9?128|i:127&i;case 8:c[s+7]=o!==8?n>>>21|128:n>>>21&127;case 7:c[s+6]=o!==7?n>>>14|128:n>>>14&127;case 6:c[s+5]=o!==6?n>>>7|128:n>>>7&127;case 5:c[s+4]=o!==5?128|n:127&n;case 4:c[s+3]=o!==4?r>>>21|128:r>>>21&127;case 3:c[s+2]=o!==3?r>>>14|128:r>>>14&127;case 2:c[s+1]=o!==2?r>>>7|128:r>>>7&127;case 1:c[s]=o!==1?128|r:127&r}}function aD(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}const HW=new Map([["moderation",1],["supervise",2]]);class WW extends pn{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const r=this._connectionState;this._connectionState=e,this.emit(Hn.CONNECTION_STATE_CHANGE,r,e)}get inspectType(){return this._inspectType}set inspectType(e){var r;this._inspectMode=Ao(r=e.map(n=>HW.get(n)||0)).call(r,(n,i)=>n+i),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),G(this,"name","AgoraRTCVideoContentInspect"),G(this,"_connectionState",Vo.CONNECTING),G(this,"_innerConnectionState",void 0),G(this,"sequence",0),G(this,"inspectStartTime",void 0),G(this,"workerManagerConnection",void 0),G(this,"workerConnection",void 0),G(this,"workerMessageLengthLimit",void 0),G(this,"inspectIntervalMinimum",void 0),G(this,"qualityRatio",void 0),G(this,"_connectInfo",void 0),G(this,"_cancelTokenSource",bi.CancelToken.source()),G(this,"_retryConfig",void 0),G(this,"wmSequence",0),G(this,"inspectInterval",void 0),G(this,"inspectTimer",null),G(this,"ossFilePrefix",void 0),G(this,"extraInfo",void 0),G(this,"_inspectType",void 0),G(this,"_inspectMode",void 0),G(this,"_quality",1),G(this,"qualityTimer",null),G(this,"_inspectId",void 0),G(this,"_needWorkUrlOnly",!1),G(this,"inspectImage",()=>{if(this.connectionState!==Vo.CONNECTED)throw new Bt(et.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Vo.CONNECTED?this.requestToInspectImage():C.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=zr(5,"inspect-"),this.workerMessageLengthLimit=st("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=st("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=st("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new al("worker-manager-"+this._inspectId,bn),this.on(Hn.STATE_CHANGE,(r,n)=>{this._innerConnectionState=r,C.debug("[".concat(this._inspectId,"] Inspect operation :").concat(jo[r]," ").concat(n||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new al("worker-"+this._inspectId,bn),this.handleWorkerEvents()}async init(e,r){this.emit(Hn.STATE_CHANGE,jo.CONNECT_AP),this._connectInfo=e;const n=this._cancelTokenSource.token;return this._retryConfig=r,new De((i,o)=>{this.on(Hn.CONNECTION_STATE_CHANGE,(s,c)=>{c===Vo.CONNECTED&&i()}),this.requestAP(e,n,r).then(s=>{this.connectWorkerManager(s)}).catch(s=>{o(s)})})}async requestAP(e,r,n){const i=st("WEBCS_DOMAIN").map(c=>"https://".concat(c,"/api/v1")),o=await function(c,d,u,l){let{appId:T,areaCode:v,cname:y,sid:x,token:N,uid:L}=d;Gd++;const Q="image_moderation_api",J={service_name:Q,json_body:JSON.stringify({appId:T,areaCode:v,cname:y,command:"allocateEdge",requestId:Gd,seq:Gd,sid:x,token:N,ts:Date.now(),uid:L+""})};let at,Rt,vt=c[0];return is(async()=>{at=Date.now();const pt=await ds(vt,{data:J,cancelToken:u,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Rt=Date.now()-at,pt.code!==0){const Te=new Bt(et.UNEXPECTED_RESPONSE,"image inspect ap error, code"+pt.code,{retry:!0,responseTime:Rt});throw C.error(Te.toString()),Te}const kt=JSON.parse(pt.json_body);if(kt.code!==200){const Te=new Bt(et.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(kt.code,", reason: ").concat(kt.reason),{code:kt.code,responseTime:Rt});throw C.error(Te.toString()),Te}if(!kt.servers||!Array.isArray(kt.servers)||kt.servers.length===0){const Te=new Bt(et.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:kt.code,responseTime:Rt});throw C.error(Te.toString()),Te}const $t=st("VIDEO_INSPECT_WORKER_MANAGER_HOST"),se=st("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:kt.servers.map(Te=>{let{address:mr,wss:Er}=Te;if(mr&&Er)return"wss://".concat(mr.replace(/\./g,"-"),".").concat($t,":").concat(se||Er)}).filter(Te=>!!Te),workerToken:kt.workerToken,vid:kt.vid,responseTime:Rt}},(pt,kt)=>(qe.apworkerEvent(x,{success:!0,sc:200,serviceName:Q,responseDetail:JSON.stringify(pt.addressList),firstSuccess:kt===0,responseTime:Rt,serverIp:c[kt%c.length]}),!1),(pt,kt)=>(qe.apworkerEvent(x,{success:!1,sc:pt.data&&pt.data.code||200,serviceName:Q,responseTime:Rt,serverIp:c[kt%c.length]}),!!(pt.code!==et.OPERATION_ABORTED&&pt.code!==et.UNEXPECTED_RESPONSE||pt.data&&pt.data.retry)&&(vt=c[(kt+1)%c.length],!0)),l)}(i,e,r,n);this.emit(Hn.STATE_CHANGE,jo.AP_CONNECTED);const{addressList:s}=o;return this.wmSequence++,s}async connectWorkerManager(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=r,this.emit(Hn.STATE_CHANGE,jo.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(pr.CONNECTED,async()=>{this.emit(Hn.STATE_CHANGE,jo.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(pr.CLOSED,()=>{this._innerConnectionState<jo.GET_WORKER_MANAGER_RESPONSE&&C.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(pr.FAILED,()=>{this._innerConnectionState<jo.GET_WORKER_MANAGER_RESPONSE&&C.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(pr.RECONNECTING,()=>{this._innerConnectionState<jo.GET_WORKER_MANAGER_RESPONSE&&C.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(pr.ON_MESSAGE,async e=>{this.emit(Hn.STATE_CHANGE,jo.GET_WORKER_MANAGER_RESPONSE);const r=this.workerManagerConnection.url;this.workerManagerConnection.close();const n=JSON.parse(e.data);if(n.code!==200)throw C.error("[".concat(this._inspectId,"] Unexpected code ").concat(n.code," from worker manager")),new Bt(et.UNEXPECTED_RESPONSE,"response code of worker is unexpected",n);if(!(n.serverResponse&&n.serverResponse.portWss&&r))throw C.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(n))),new Bt(et.UNEXPECTED_RESPONSE,"response content of worker is unexpected",n);{const i=st("VIDEO_INSPECT_WORKER_PORT")||n.serverResponse.portWss,o=r.replace(/:\d+\/?$/,":".concat(i));this.emit(Hn.STATE_CHANGE,jo.CONNECT_WORKER,o),this._needWorkUrlOnly?this.emit(Hn.REQUEST_NEW_WORKER_URL,o):await this.connectWorker(o)}}),this.workerManagerConnection.on(pr.WILL_RECONNECT,(e,r,n)=>{n(e)}),this.workerManagerConnection.on(pr.REQUEST_NEW_URLS,(e,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(r)})}handleWorkerEvents(){this.workerConnection.on(pr.CONNECTED,async()=>{this.emit(Hn.STATE_CHANGE,jo.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Vo.CONNECTED}),this.workerConnection.on(pr.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const n=UW(new Uint8Array(e.data));if(st("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&C.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(n)),n.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Hn.INSPECT_RESULT,void 0,void 0);if(n.data&&n.data.scorePorn&&n.data.scoreSexy&&n.data.scoreNeutral){var r;const i={porn:n.data.scorePorn,sexy:n.data.scoreSexy,neutral:n.data.scoreNeutral},o=Ao(r=Object.keys(i)).call(r,(c,d)=>i[c]>i[d]?c:d,"porn"),s=Object.keys(i).find(c=>c===o);this.emit(Hn.INSPECT_RESULT,s)}else this.emit(Hn.INSPECT_RESULT,void 0,new Bt(et.UNEXPECTED_RESPONSE,n.code+"","There is an unexpected data on message"))}else this.emit(Hn.INSPECT_RESULT,void 0,new Bt(et.UNEXPECTED_RESPONSE,n.code+"",n.msg))}else C.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Hn.INSPECT_RESULT,void 0,new Bt(et.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(pr.CLOSED,()=>{this.connectionState=Vo.CLOSED}),this.workerConnection.on(pr.FAILED,()=>{this.connectionState=Vo.CLOSED}),this.workerConnection.on(pr.RECONNECTING,()=>{this.connectionState=this.connectionState===Vo.CONNECTED?Vo.RECONNECTING:Vo.CONNECTING}),this.workerConnection.on(pr.WILL_RECONNECT,(e,r,n)=>{e==="recover"&&n(e),n("tryNext")}),this.workerConnection.on(pr.REQUEST_NEW_URLS,(e,r)=>{this.workerManagerConnection.close(),this.once(Hn.REQUEST_NEW_WORKER_URL,n=>{e([n])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(n=>{this.connectWorkerManager(n,!0)}).catch(n=>{r(n)})})}async requestToInspectImage(){this.sequence++;const e=$i(this,Hn.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(Hn.INSPECT_RESULT,void 0,new Bt(et.INVALID_OPERATION,"Only the track being played can be inspected"));const n=await this.generateRequestData(e,r);this.workerConnection.sendMessage(n,!0,!0)}else this.emit(Hn.INSPECT_RESULT,void 0,new Bt(et.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,r){let{appId:n,cname:i,cid:o,vid:s,sid:c,uid:d}=r;const u=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),T=await FA(l,n,i),v=this.sequence+"-"+o+"-"+d+"-"+u+"-"+zr(12,""),y={appId:n,cid:o,cname:i,deviceId:"",elapse:(x=Number(u-this.inspectStartTime),{low:x|=0,high:x>>31,unsigned:x>=0}),fileSize:T.byteLength,jpgEncryption:2,height:l.height,width:l.width,jpg:T,networkType:6,osType:7,requestId:v,sdkVersion:"4.24.0",sequence:this.sequence,sid:c,timestamp:mN(u),uid:d,vid:s,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var x;this.extraInfo===void 0&&delete y.callbackData,this.ossFilePrefix===void 0&&delete y.ossFilePrefix;const N=MW(y);if(N.byteLength<this.workerMessageLengthLimit){if(st("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const L=function(Q){for(var J=1;J<arguments.length;J++){var at=arguments[J]!=null?arguments[J]:{};J%2?aD(Object(at),!0).forEach(function(Rt){G(Q,Rt,at[Rt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(at)):aD(Object(at)).forEach(function(Rt){Object.defineProperty(Q,Rt,Object.getOwnPropertyDescriptor(at,Rt))})}return Q}({},y);delete L.jpg,C.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(L))}return N}{const L=this.quality*this.qualityRatio;return this.quality=L,await this.generateRequestData(e,{appId:n,cname:i,cid:o,vid:s,sid:c,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=bi.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Vo.CLOSED,this.emit(Hn.STATE_CHANGE,jo.CLOSED)}}const KW={name:"ContentInspect",create:function(t){let{config:e}=t;return function(r){if(!r)throw new Bt(et.INVALID_PARAMS,"inspectConfig is necessary.");if(!r.inspectType||!Array.isArray(r.inspectType))throw new Bt(et.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const n=[...new Set(r.inspectType)];n.forEach(i=>{var o;if(!Ce(o=["supervise","moderation"]).call(o,i))throw new Bt(et.INVALID_PARAMS,"".concat(i," is not a valid inspect type."))}),r.inspectType=n}if(r&&r.extraInfo&&r.extraInfo.length>1024)throw new Bt(et.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(e),new WW(e)}};var cD=ke(xe.Object.getOwnPropertySymbols),zW=xr,qW=$f.indexOf,YW=Xl,WT=M([].indexOf),dD=!!WT&&1/WT([1],1,-0)<0;zW({target:"Array",proto:!0,forced:dD||!YW("indexOf")},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return dD?WT(this,t,e)||0:qW(this,t,e)}});var XW=Co("Array","indexOf"),JW=_,ZW=XW,KT=Array.prototype,QW=function(t){var e=t.indexOf;return t===KT||JW(KT,t)&&e===KT.indexOf?ZW:e},uD=ke(QW);function $W(t,e){if(t==null)return{};var r,n,i=function(s,c){if(s==null)return{};var d={};for(var u in s)if({}.hasOwnProperty.call(s,u)){if(uD(c).call(c,u)!==-1)continue;d[u]=s[u]}return d}(t,e);if(cD){var o=cD(t);for(n=0;n<o.length;n++)r=o[n],uD(e).call(e,r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}let lD=class{get localCapabilities(){return dn(this._localCapabilities)}get rtpCapabilities(){return dn(this._rtpCapabilities)}get candidates(){return dn(this._candidates)}get iceParameters(){return dn(this._iceParameters)}get dtlsParameters(){return dn(this._dtlsParameters)}constructor(t){G(this,"sessionDesc",void 0),G(this,"_localCapabilities",void 0),G(this,"_rtpCapabilities",void 0),G(this,"_candidates",void 0),G(this,"_iceParameters",void 0),G(this,"_dtlsParameters",void 0),G(this,"setup",void 0),G(this,"currentMidIndex",void 0),G(this,"cname","o/i14u9pJrxRKAsu"),G(this,"firefoxSsrcMidMap",new Map),t=dn(t);const{remoteIceParameters:e,remoteDtlsParameters:r,candidates:n,remoteRTPCapabilities:i,localCapabilities:o,direction:s,setup:c,videoCodec:d,audioCodec:u}=t;let l;this.setup=c,l=s===Ii.RECEIVE_ONLY?ki(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):ki(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=i,this._candidates=n,this._iceParameters=e,this._dtlsParameters=r,this._localCapabilities=o;const T=s===Ii.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,v=s===Ii.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,y=s===Ii.RECEIVE_ONLY?i.send.videoCodecs:ll(Ue.VIDEO,T,v,d),x=s===Ii.RECEIVE_ONLY?i.send.audioCodecs:ll(Ue.AUDIO,T,v,u);for(const N of l.mediaDescriptions)N.attributes.iceUfrag=e.iceUfrag,N.attributes.icePwd=e.icePwd,N.attributes.fingerprints=r.fingerprints,N.attributes.candidates=n,N.attributes.setup=this.setup,N.media.mediaType==="application"&&(N.attributes.sctpPort="5000"),N.media.mediaType==="video"&&(N.media.fmts=y.map(L=>L.payloadType.toString(10)),N.attributes.payloads=y,N.attributes.extmaps=T.videoExtensions),N.media.mediaType==="audio"&&(N.media.fmts=x.map(L=>L.payloadType.toString(10)),N.attributes.payloads=x,N.attributes.extmaps=T.audioExtensions,Fd(N));this.sessionDesc=l,this.currentMidIndex=l.mediaDescriptions.length-1}toString(){return Ca(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(e=>e.attributes.mid===t)}send(t,e,r,n,i){r=r.replace(/ /g,"-");const{ssrcs:o,ssrcGroups:s}=ul(e,this.cname,st("SYNC_GROUP")?r:void 0),c=this.findPreloadMediaDesc(o);if(c){if(mn()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,c.attributes.mid),i&&(i.twcc||i.remb)){const d=this.sessionDesc.mediaDescriptions.indexOf(c);return this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(c,i),{mid:c.attributes.mid,needExchangeSDP:!0}}return{mid:c.attributes.mid,needExchangeSDP:!1}}{const d=this.findAvailableMediaIndex(t,o,n);let u;return d===-1?(u=this.createOrRecycleSendMedia(t,o,s,"sendonly",n,i),this.updateBundleMids()):(u=dn(this.sessionDesc.mediaDescriptions[d]),u.attributes.direction="sendonly",u.attributes.ssrcs=o,u.attributes.ssrcGroups=s,this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(u,i)),mn()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,u.attributes.mid),{needExchangeSDP:!0,mid:u.attributes.mid}}}stopSending(t){const e=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&t.indexOf(r.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(r=>{r.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,e,r){const n=[];return t.forEach(i=>{const o=i._mediaStreamTrack.kind,s=this.findAvailableRecvMediaIndex(o);let c,d=!1;s===-1?(d=!0,c=this.createOrRecycleRecvMedia(i,[],"recvonly",e,r),this.updateBundleMids()):(c=dn(this.sessionDesc.mediaDescriptions[s]),c.attributes.direction="recvonly"),n.push({mid:c.attributes.mid,needCreateTransceiver:d})}),n}stopReceiving(t){const e=this.sessionDesc.mediaDescriptions.filter(r=>t.indexOf(r.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:e,protocol:r,address:n,port:i,type:o,relatedAddress:s,relatedPort:c,priority:d}=new RTCIceCandidate(t),u={foundation:e??"",componentId:"1",transport:r??"",priority:d?d+"":"",connectionAddress:n??"",port:i?i+"":"",type:o?o+"":"",relAddr:s??"",relPort:c?c+"":"",extension:{}};this.candidates.some(l=>l.priority===u.priority&&l.connectionAddress===u.connectionAddress&&l.port===u.port)||(this._candidates.push(u),this.sessionDesc.mediaDescriptions.forEach(l=>{l.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,e,r,n,i){const o=t._mediaStreamTrack.kind,s=this.rtpCapabilities.recv,c=ll(o,s,this.localCapabilities.send,o===Ue.AUDIO?i:n),d=o===Ue.VIDEO?s.videoExtensions:s.audioExtensions,u="".concat(++this.currentMidIndex);let l={media:{mediaType:o,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(v=>v.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};l=this.mungRecvMediaDsec(l,t);const T=this.findFirstClosedMedia(o);if(T){const v=this.sessionDesc.mediaDescriptions.indexOf(T);this.sessionDesc.mediaDescriptions[v]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}muteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(r=>Ce(t).call(t,r.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(r=>Ce(t).call(t,r.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(r=>{r.attributes.direction="recvonly"})}findAvailableMediaIndex(t,e,r){return this.sessionDesc.mediaDescriptions.findIndex(n=>{const i=n.media.mediaType===t&&n.media.port!=="0"&&(n.attributes.direction==="sendonly"||n.attributes.direction==="sendrecv")&&n.attributes.ssrcs.length===0;if(mn()){if(i){const o=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(o||n.attributes.mid!=="0"&&n.attributes.mid!=="1")||!(!o||o!==n.attributes.mid)}return!1}return i&&n.attributes.mid===r})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(e=>{const r=e.media.mediaType===t&&e.media.port!=="0"&&(e.attributes.direction==="recvonly"||e.attributes.direction==="sendrecv");return e.attributes.mid!=="0"&&e.attributes.mid!=="1"&&r})}predictReceivingMids(t){const e=[];for(let r=0;r<t;r++)e.push((this.currentMidIndex+r+1).toString(10));return e}restartICE(t){t=dn(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,e,r,n,i,o){const s=this.rtpCapabilities.send,c=t===Ue.VIDEO?s.videoCodecs:s.audioCodecs,d=t===Ue.VIDEO?s.videoExtensions:s.audioExtensions;mn()&&(i="".concat(++this.currentMidIndex));let u={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:i}};u=this.mungSendMediaDesc(u,o);const l=this.findFirstClosedMedia(t);if(l){const T=this.sessionDesc.mediaDescriptions.indexOf(l);this.sessionDesc.mediaDescriptions[T]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}mungRecvMediaDsec(t,e,r){const n=dn(t);return Wg(n),Bd(n,e),Kg(n,e),iw(n),nf(n,r,this.localCapabilities.send),n}mungSendMediaDesc(t,e){const r=dn(t);return nf(r,e,this.localCapabilities.recv),Fd(r),r}updateRecvMedia(t,e){const r=this.sessionDesc.mediaDescriptions.findIndex(n=>n.attributes.mid===t);if(r!==-1){const n=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],e);this.sessionDesc.mediaDescriptions[r]=n}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(e=>{var r;return((r=e.attributes)===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(e=>mn()?e.media.port==="0"&&e.media.mediaType===t:e.media.port==="0")}};const t7=["sdp"];var Qr;function hD(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Wa(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?hD(Object(r),!0).forEach(function(n){G(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):hD(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}let pD=(Qr=class ru extends BO{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,r;return(e=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&e!==void 0?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(e,r,n){super(e,r),G(this,"direction",void 0),G(this,"name",void 0),G(this,"store",void 0),G(this,"spec",void 0),G(this,"peerConnection",void 0),G(this,"initialOffer",void 0),G(this,"transport",void 0),G(this,"statsFilter",void 0),G(this,"localCandidateCount",0),G(this,"_isInRestartIce",!1),G(this,"mutex",void 0),G(this,"onLocalCandidate",void 0),G(this,"remoteSDP",void 0),G(this,"pendingCandidates",[]),G(this,"localCapabilities",void 0),G(this,"isReady",!1),G(this,"restartCnt",0),G(this,"curTurnServerIndex",0),this.store=r,this.spec=e,this.mutex=new si("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(ru.resolvePCConfiguration(e,r.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=n??Ii.SEND_ONLY,this.name=this.direction===Ii.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=$E(this.peerConnection,st("STATS_UPDATE_INTERVAL"),void 0,mn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const r=await sw();if(this.localCapabilities=of(r),e){const{sdp:n}=e,i=$W(e,t7),o=function(){const l={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},T=dl(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},x={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Bo(T,l,"videoExtensions",v,y,x),Bo(T,l,"videoCodecs",v,y,x),Bo(T,l,"audioExtensions",v,y,x),Bo(T,l,"audioCodecs",v,y,x),st("RAISE_H264_BASELINE_PRIORITY")){const N=x.videoCodecs.findIndex(L=>L.rtpMap&&L.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&L.fmtp&&L.fmtp.parameters["profile-level-id"]==="42001f");if(N!==-1){const L=x.videoCodecs.findIndex(Q=>Q.rtpMap&&Q.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(L<N){C.debug("raising H264 baseline profile priority");const Q=x.videoCodecs[N];x.videoCodecs.splice(N,1),x.videoCodecs.splice(L,0,Q)}L!==-1&&st("FILTER_SEND_H264_BASELINE")&&(v.videoCodecs=v.videoCodecs.filter(Q=>!(Q.rtpMap&&Q.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&Q.fmtp&&Q.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:v,recv:y,sendrecv:x}}({},{},n);this.remoteSDP=new lD({remoteIceParameters:i.iceParameters,remoteDtlsParameters:i.dtlsParameters,candidates:[],remoteRTPCapabilities:o,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const c=Pa(s.sdp);await this.peerConnection.setLocalDescription(s);const d=await aw({},{},s.sdp);this.localCapabilities=of(d);const u=this.peerConnection.getTransceivers()[0];return u!=null&&u.receiver&&u.receiver.transport&&this.tryBindTransportEvents(u.receiver.transport),Wa(Wa({},c),{},{sdp:s.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Pa(n.sdp);return this.initialOffer=n,Wa(Wa({},i),{},{sdp:n.sdp})}}catch(r){throw new Qt(et.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:r,iceParameters:n,dtlsParameters:i}=e,o=await aw({},{},r);this.remoteSDP=new lD({remoteIceParameters:n,remoteDtlsParameters:i,candidates:[],remoteRTPCapabilities:o,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const s=this.peerConnection.getTransceivers()[0];s!=null&&s.sender&&s.sender.transport&&this.tryBindTransportEvents(s.sender.transport)}catch(r){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(r=>{this.peerConnection.addIceCandidate(r)}),this.pendingCandidates=[])}catch(r){throw new Qt(et.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(r.toString()))}}send(e,r,n){var i=this;return ho(function*(){const o=yield Ar(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=[],c=i.remoteSDP.receive(e,r,n);e.forEach((L,Q)=>{if(c[Q].needCreateTransceiver){const J=i.peerConnection.addTransceiver(L._mediaStreamTrack,{direction:"sendonly"});s.push(J),L._updateRtpTransceiver(J)}else{const J=i.peerConnection.getTransceivers().find(at=>at.mid===c[Q].mid);if(!J)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(c[Q].mid));s.push(J),L._updateRtpTransceiver(J)}}),mn()&&st("SIMULCAST")===!0&&(yield Ar(i.applySimulcastForFirefox(s,e)));const d=c.map(L=>L.mid),u=yield Ar(i.peerConnection.createOffer()),l=i.mungSendOfferSDP(u.sdp,e,d),T=ki(l),v=d.map(L=>{const Q=T.mediaDescriptions.find(J=>J.attributes.mid===L);if(!Q)throw new Error("Cannot extract ssrc from mediaDescription.");return ew(Q,st("USE_PUB_RTX"))}),y=s.map((L,Q)=>{const J=d[Q];return{localSSRC:v[Q],id:J}});yield Ar(i.peerConnection.setLocalDescription({type:"offer",sdp:l}));try{yield y}catch(L){const Q=i.remoteSDP.toString();throw yield Ar(i.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield Ar(i.peerConnection.setRemoteDescription({type:"answer",sdp:Q})),yield Ar(i.stopSending(d,!0)),L}yield Ar(i.applySimulcastEncodings(s,e)),yield Ar(i.applySendEncodings(s,e));const x=i.remoteSDP.toString(),N=i.logSDPExchange(l,"offer","local","send");return N?.(x),yield Ar(i.setRemoteDescription({type:"answer",sdp:x})),s.map((L,Q)=>{const J=d[Q];return{localSSRC:v[Q],id:J}})}catch(s){throw s instanceof Qt?s:new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{o()}})()}async stopSending(e,r){const n=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(d=>e.indexOf(d.mid)!==-1);if(i.length!==e.length)throw new Error("Transceivers' length (".concat(i.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));i.map(d=>{var u;d.direction="inactive",(u=d.stop)===null||u===void 0||u.call(d)});const o=await this.peerConnection.createOffer(),s=this.logSDPExchange(o.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(e);const c=this.remoteSDP.toString();s?.(c),await this.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{n&&n()}}async receive(e,r,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:o,needExchangeSDP:s}=this.remoteSDP.send(e,r,n,i);if(s){const d=this.remoteSDP.toString(),u=this.logSDPExchange(d,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:d});const l=await this.peerConnection.createAnswer(),T=this.mungReceiveAnswerSDP(l.sdp,o,e);u?.(T||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:T}),C.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else C.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const c=this.peerConnection.getTransceivers().find(d=>d.mid===o);if(!c||c.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,mid:c.mid,transceiver:c}}catch(o){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async mockReceive(e,r,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:o,needExchangeSDP:s}=this.remoteSDP.send(e,r,n,i);if(s){const c=this.remoteSDP.toString(),d=this.logSDPExchange(c,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:c});const u=await this.peerConnection.createAnswer(),l=this.mungReceiveAnswerSDP(u.sdp,o,e);d?.(l||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:l}),C.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else C.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(o){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const r=this.remoteSDP.toString(),n=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:r});const i=await this.peerConnection.createAnswer();n?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(r){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async restartICE(e){try{if(this.store.p2pTransport===hc.Auto&&(this.store.p2pTransport=hc.SdRtn,br().supportPCSetConfiguration&&this.peerConnection.setConfiguration(ru.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,br().supportPCSetConfiguration&&this.peerConnection.setConfiguration(ru.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!e){this.restartCnt++,this.isReady=!1;const r=await this.peerConnection.createOffer({iceRestart:!0});if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:n}=Pa(r.sdp);return this.store.descriptionStart(),this.direction===Ii.SEND_ONLY&&await this.peerConnection.setLocalDescription(r),n}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(e),this.store.descriptionStart(),this.direction===Ii.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const r=await this.peerConnection.createAnswer();if(!r.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:n}=Pa(r.sdp);return await this.peerConnection.setLocalDescription(r),n}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(r){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(n.sdp,[r],[e]);this.remoteSDP.updateRecvMedia(e,r);const o=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),s?.(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new Qt(et.EXCHANGE_SDP_FAILED,n.toString())}}async updateSendParameters(e,r){const n=this.peerConnection.getTransceivers().filter(i=>i.mid===e);n.length===1&&(this.isVP8Simulcast(r)?mn()||await this.applySimulcastEncodings(n,[r]):await this.applySendEncodings(n,[r]))}setStatsRemoteVideoIsReady(e,r){this.statsFilter.setVideoIsReady2(e,r)}async replaceTrack(e,r){const n=this.peerConnection.getTransceivers().find(i=>i.mid===r);n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const r=e[0].transport.iceTransport,{local:n,remote:i}=r.getSelectedCandidatePair();return{local:Wa(Wa({},Is),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:Wa(Wa({},Is),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,r;Ce(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{if(e.candidate){var r;e.candidate.candidate&&((r=this.onLocalCandidate)===null||r===void 0||r.call(this,e.candidate.toJSON())),this.localCandidateCount+=1}else C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e,r){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i={iceServers:[]};var o;return e.iceServers?i.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(Yu(e.turnServer.servers)?i.iceServers=e.turnServer.servers:(i.iceServers&&i.iceServers.push(...ru.turnServerConfigToIceServers(e.turnServer.servers,r,n)),st("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&e.turnServer.serversFromGateway&&i.iceServers.push(...ru.turnServerConfigToIceServers(e.turnServer.serversFromGateway,r,n)),Ce(o=[hc.Relay,hc.SdRtn]).call(o,r)&&(i.iceTransportPolicy="relay"),st("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),st("ENABLE_ENCODED_TRANSFORM")&&br().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),C.debug("P2PConnection p2pTransport is ".concat(r)),i}static turnServerConfigToIceServers(e,r){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=[],o=e.filter(c=>c.tcpport);C.debug("P2PConnection turnServers is ".concat(o,", current index is ").concat(n));const s=o.length>n?o[n]:o[0];switch(r){case hc.SdRtn:const c=e.filter(u=>{var l;return Ce(l=u.username).call(l,"glb:")&&u.turnServerURL==u.turnServerURL}),d=c.length>n?c[n]:c[0];d&&(i.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(wa(d.turnServerURL),":").concat(d.tcpport,"?transport=udp")}),i.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(wa(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}));break;case hc.Relay:s&&(i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=udp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(wa(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}));break;default:s&&(i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=udp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(wa(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"stun:".concat(s.turnServerURL,":").concat(s.tcpport)}))}return i}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var n;e!=null&&e.state&&((n=this.onDTLSTransportStateChange)===null||n===void 0||n.call(this,e.state))},e.onerror=n=>{var i;(i=this.onDTLSTransportError)===null||i===void 0||i.call(this,"error"in n?n.error:n)};const r=e.iceTransport;r&&(r.onstatechange=()=>{const n=e?.iceTransport.state;var i;n&&((i=this.onICETransportStateChange)===null||i===void 0||i.call(this,n))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:n,remote:i}=r.getSelectedCandidatePair()||{};if(n&&i){const o=n.address+":"+n.port,s=i.address+":"+i.port;C.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(vc(o)),", remote ").concat(JSON.stringify(vc(s))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,r){var n;if(r||(r=this.peerConnection.getSenders().find(l=>l.track===e._mediaStreamTrack)),!r)return C.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return C.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!br().supportSetRtpSenderParameters)return C.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},o={};switch(e._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(e._encoderConfig){var s;const{bitrateMax:l,frameRate:T,scaleResolutionDownBy:v}=e._encoderConfig;l&&(o.maxBitrate=1e3*l),Ce(s=e._hints).call(s,Wr.LOW_STREAM)&&(T&&(o.maxFramerate=zi(T)),v&&v>=1&&(o.scaleResolutionDownBy=v))}if(st("DSCP_TYPE")&&zs()){var c;const l=st("DSCP_TYPE");Ce(c=["very-low","low","medium","high"]).call(c,l)&&(o.networkPriority=l)}const d=r.getParameters(),u=(n=d.encodings)===null||n===void 0?void 0:n[0];mn()&&!u&&(i.encodings=[o]),u&&Object.assign(u,o),Object.assign(d,i),C.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(d.encodings))),await r.setParameters(d)}async applySendEncodings(e,r){try{if(!br().supportSetRtpSenderParameters||e.length!==r.length)return;for(let n=0;n<e.length;n++){const i=e[n],o=r[n];o instanceof Zr&&!this.isVP8Simulcast(o)&&await this.updateRtpSenderEncodings(o,i.sender)}}catch{C.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,r,n){const i=ki(e);return r.forEach((o,s)=>{const c=n[s],d=i.mediaDescriptions.find(u=>u.attributes.mid===c);d&&(Bd(d,o),ow(d,o,this.store.codec))}),Ca(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,r,n)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,e,r,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,r)=>{var n;(n=this.onSelectedLocalCandidateChanged)===null||n===void 0||n.call(this,e,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,r)=>{var n;(n=this.onSelectedRemoteCandidateChanged)===null||n===void 0||n.call(this,e,r)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,r){if(e.length===r.length)for(let d=0;d<e.length;d++){var n,i,o,s,c;const u=e[d],l=r[d];if(l instanceof Zr&&!Ce(n=l._hints).call(n,Wr.LOW_STREAM)&&(i=l._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=l._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(s=l._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((c=l._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const T={},v={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};T.encodings=[{rid:"m",active:!0,maxBitrate:v.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:v.high}];const y=u.sender.getParameters();await u.sender.setParameters(Object.assign(y,T))}}}async applySimulcastEncodings(e,r){if(!mn()&&e.length===r.length)for(let n=0;n<e.length;n++){const i=r[n];if(i instanceof Zr&&this.isVP8Simulcast(i)){const o=e[n],s={},c={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};s.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];const d=o.sender.getParameters();await o.sender.setParameters(Object.assign(d,s))}}}isVP8Simulcast(e){var r,n,i,o,s;return!!(e instanceof Zr&&st("SIMULCAST")&&this.store.codec==="vp8"&&!Ce(r=e._hints).call(r,Wr.LOW_STREAM)&&(n=e._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((i=e._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(o=e._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((s=e._scalabilityMode)===null||s===void 0?void 0:s.numSpatialLayers)>1)}logSDPExchange(e,r,n,i){if(st("SDP_LOGGING"))return C.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(r," SDP during P2PConnection.").concat(i,`
`),e),r==="offer"?o=>{this.logSDPExchange(o,"answer",n==="local"?"remote":"local",i)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(s=>s.mid&&e.indexOf(s.mid)!==-1);if(r.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(s=>{s.direction="inactive"});const n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const o=this.remoteSDP.toString();i?.(o),await this.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter(s=>s.mid&&e.indexOf(s.mid)!==-1);if(r.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async s=>{s.direction="sendonly"});const n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e);const o=this.remoteSDP.toString();i?.(o),await this.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}async getRemoteSSRC(e,r){var n;if(r=r??((n=this.currentRemoteDescription)===null||n===void 0?void 0:n.sdp)){var i;const o=(i=ki(r).mediaDescriptions.find(s=>s.attributes.mid===e))===null||i===void 0?void 0:i.attributes.ssrcs;return o?.[0].ssrcId}}async setRemoteDescription(e){var r;await this.peerConnection.setRemoteDescription(e),Ce(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,r,n){const i=ki(e),o=i.mediaDescriptions.find(s=>s.attributes.mid===r);return o&&n===Ue.AUDIO&&o.media.mediaType==="audio"&&Fd(o),Ca(i)}},Ke(Qr.prototype,"establish",[Ko],Object.getOwnPropertyDescriptor(Qr.prototype,"establish"),Qr.prototype),Ke(Qr.prototype,"connect",[Ko],Object.getOwnPropertyDescriptor(Qr.prototype,"connect"),Qr.prototype),Ke(Qr.prototype,"receive",[Ko],Object.getOwnPropertyDescriptor(Qr.prototype,"receive"),Qr.prototype),Ke(Qr.prototype,"mockReceive",[Ko],Object.getOwnPropertyDescriptor(Qr.prototype,"mockReceive"),Qr.prototype),Ke(Qr.prototype,"stopReceiving",[Ko],Object.getOwnPropertyDescriptor(Qr.prototype,"stopReceiving"),Qr.prototype),Ke(Qr.prototype,"restartICE",[Ko],Object.getOwnPropertyDescriptor(Qr.prototype,"restartICE"),Qr.prototype),Ke(Qr.prototype,"close",[Ko],Object.getOwnPropertyDescriptor(Qr.prototype,"close"),Qr.prototype),Ke(Qr.prototype,"updateEncoderConfig",[Ko],Object.getOwnPropertyDescriptor(Qr.prototype,"updateEncoderConfig"),Qr.prototype),Ke(Qr.prototype,"updateSendParameters",[Ko],Object.getOwnPropertyDescriptor(Qr.prototype,"updateSendParameters"),Qr.prototype),Ke(Qr.prototype,"replaceTrack",[Ko],Object.getOwnPropertyDescriptor(Qr.prototype,"replaceTrack"),Qr.prototype),Ke(Qr.prototype,"muteLocal",[Ko],Object.getOwnPropertyDescriptor(Qr.prototype,"muteLocal"),Qr.prototype),Ke(Qr.prototype,"unmuteLocal",[Ko],Object.getOwnPropertyDescriptor(Qr.prototype,"unmuteLocal"),Qr.prototype),Qr);function Ko(t,e,r){const n=t[e];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const i=this.mutex,o=await i.lock("From P2PConnection.".concat(e));try{for(var s=arguments.length,c=new Array(s),d=0;d<s;d++)c[d]=arguments[d];return await n.apply(this,c)}finally{o()}},r}let hs=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var fD,mD,_D,ED,gD,TD,vD,yD,SD,RD,ID,un;function CD(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Gf(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?CD(Object(r),!0).forEach(function(n){G(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):CD(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}let e7=(fD=ps(hs.SEND_ONLY),mD=ps(hs.SEND_ONLY),_D=ps(),ED=ps(hs.RECEIVE_ONLY),gD=ps(hs.RECEIVE_ONLY),TD=ps(hs.RECEIVE_ONLY),vD=ps(hs.RECEIVE_ONLY),yD=ps(hs.RECEIVE_ONLY),SD=ps(hs.RECEIVE_ONLY),RD=ps(),ID=ps(hs.RECEIVE_ONLY),un=class extends pn{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit($e.StateChange,e,this._state)}constructor(t,e){super(),G(this,"isPlanB",!1),G(this,"store",void 0),G(this,"statsUploader",void 0),G(this,"sendConnection",void 0),G(this,"recvConnection",void 0),G(this,"localTrackMap",new Map),G(this,"remoteUserMap",new Map),G(this,"localDataChannels",[]),G(this,"pendingLocalTracks",[]),G(this,"pendingRemoteTracks",[]),G(this,"statsCollector",void 0),G(this,"dtlsFailedCount",0),G(this,"sendMutex",void 0),G(this,"recvMutex",void 0),G(this,"_state",Mr.Disconnected),G(this,"_restartStates",["disconnected","failed"]),G(this,"reconnectInterval",void 0),G(this,"uploadUnplinkStarted",!1),G(this,"uploadDownlinkStarted",!1),G(this,"uplinkStateUploadInterval",void 0),G(this,"downlinkStatsUploadInterval",void 0),G(this,"handleMuteLocalTrack",async(r,n,i)=>{const o=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Mr.Connected)return void i(new Qt(et.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const d=this.filterTobeMutedTracks(r);if(d.length===0)return void n();const u=d.find(y=>y[0]==="videoLowTrack");u&&u[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(d.map(y=>{let[,{id:x}]=y;return x}));let l=!1;var s,c;r.trackMediaType==="video"?l=!((s=this.localTrackMap.get(_e.LocalAudioTrack))===null||s===void 0||!s.track._muted):l=((c=this.localTrackMap.get(_e.LocalVideoTrack))===null||c===void 0?void 0:c.id)===void 0;const T=this.createMuteMessage(d);await Kr(this,$e.RequestMuteLocal,T);const v=r.trackMediaType==="video"?Oa.MUTE_LOCAL_VIDEO:Oa.MUTE_LOCAL_AUDIO;await Kr(this,$e.RequestP2PMuteLocal,{action:v,message:T,isMuteAll:l}),n()}catch(d){i(d)}finally{o()}}),G(this,"handleUnmuteLocalTrack",async(r,n,i)=>{const o=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Mr.Connected)return void i(new Qt(et.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const s=this.filterTobeUnmutedTracks(r);if(s.length===0)return void n();await this.sendConnection.unmuteLocal(s.map(u=>{let[,{id:l}]=u;return l}));const c=this.createUnmuteMessage(s),d=r.trackMediaType==="video"?Oa.UNMUTE_LOCAL_VIDEO:Oa.UNMUTE_LOCAL_AUDIO;await Kr(this,$e.RequestP2PMuteLocal,{action:d,message:c}),n()}catch(s){i(s)}finally{o()}}),G(this,"handleUpdateVideoEncoder",async(r,n,i,o)=>{let s;typeof o=="boolean"&&o||(s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const d=this.localTrackMap.get(_e.LocalVideoTrack);if(!this.sendConnection||!d||d.track!==r||this.state!==Mr.Connected)return void n();const{id:u,track:l}=d;u&&(await this.sendConnection.updateSendParameters(u,l),await this.sendConnection.updateEncoderConfig(u,l),this.emit($e.UpdateVideoEncoder,l)),n()}catch(d){i(d)}finally{var c;(c=s)===null||c===void 0||c()}}),G(this,"handleUpdateVideoSendParameters",async(r,n,i)=>{const o=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const s=this.localTrackMap.get(_e.LocalVideoTrack);if(!this.sendConnection||!s||s.track!==r||this.state!==Mr.Connected)return void n();const{id:c,track:d}=s;c&&await this.sendConnection.updateSendParameters(c,d),n()}catch(s){i(s)}finally{o()}}),G(this,"handleReplaceTrack",async(r,n,i,o)=>{let s;C.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof o=="boolean"&&o||(s=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var c;const u=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:T}]=l;return r===T});if(!this.sendConnection||!u||u[1].id===void 0||this.state!==Mr.Connected)return void n();if(await((c=this.sendConnection)===null||c===void 0?void 0:c.replaceTrack(r,u[1].id)),u[0]===_e.LocalVideoTrack&&br().supportDualStreamEncoding){const l=this.localTrackMap.get(_e.LocalVideoLowTrack);if(l){const T=r._mediaStreamTrack.clone();l.track._originMediaStreamTrack.stop(),l.track._mediaStreamTrack=T,l.track._originMediaStreamTrack=T,await new De((v,y)=>{this.handleReplaceTrack(l.track,v,y,!0)})}}n()}catch(u){i(u)}finally{var d;(d=s)===null||d===void 0||d()}}),G(this,"handleGetLocalVideoStats",r=>{r(this.statsCollector.getLocalVideoTrackStats())}),G(this,"handleGetLocalAudioStats",r=>{r(this.statsCollector.getLocalAudioTrackStats())}),G(this,"handleGetRemoteVideoStats",r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid]),G(this,"handleGetRemoteAudioStats",r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new Gw(t),this.bindStatsUploaderEvents(),this.sendMutex=new si("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new si("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(r=>{r&&(r.iceConnectionState!=="disconnected"&&r.iceConnectionState!=="failed"||this.handleDisconnect(r.direction))})},st("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,e){throw new Qt(et.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new Qt(et.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,e){let r;try{if(e){this.recvConnection&&(C.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),r=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new pD(t,this.store,Ii.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const n=await this.recvConnection.establish(e);return{iceParameters:n.iceParameters,dtlsParameters:n.dtlsParameters,sdp:n.sdp}}{this.state=Mr.New,this.sendConnection&&(C.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),r=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new pD(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const n=await this.sendConnection.establish();return{iceParameters:n.iceParameters,dtlsParameters:n.dtlsParameters,sdp:n.sdp}}}finally{r&&r()}}async p2pConnect(t){if(!this.sendConnection)throw new Qt(et.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Mr.Connected}async addRemoteCandidate(t,e){if(e===Ii.RECEIVE_ONLY){if(!this.sendConnection)throw new Qt(et.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new Qt(et.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,e,r){var n=this;return ho(function*(){const i=yield Ar(n.sendMutex.lock("From P2PChannel.publish"));try{if(!n.sendConnection||n.state!==Mr.Connected){n.throwIfTrackTypeNotMatch(t);const u=t.filter(l=>n.pendingLocalTracks.indexOf(l)===-1);return void(n.pendingLocalTracks=n.pendingLocalTracks.concat(u))}n.store.pubId=n.store.pubId+1,ui.markPublishStart(n.store.clientId,n.store.pubId);const o=n.filterTobePublishedTracks(t,e,r);if(o.length===0)return void(yield Ar(n.tryToUnmuteAudio(t)));o.forEach(u=>{let{track:l,type:T}=u;const v=Date.now();n.store.publish(l.getTrackId(),T===_e.LocalAudioTrack?"audio":"video",v)}),n.bindLocalTrackEvents(o);const s=yield Ar(n.sendConnection.send(o.map(u=>{let{track:l}=u;return l}),n.store.codec,n.store.audioCodec)),c=(yield Ar(s.next())).value,d=n.createGatewayPublishMessage(o,c);try{yield d}catch(u){throw s.throw(u),u?.code===et.WS_ABORT&&o.forEach(l=>{let{track:T}=l;n.pendingLocalTracks.indexOf(T)===-1&&n.pendingLocalTracks.push(T)}),n.unbindLocalTrackEvents(o),u}yield Ar(s.next()),o.forEach(u=>{let{type:l}=u;n.statsCollector.addLocalStats(l)}),n.statsUploader.startUploadOutboundStats(),n.assignLocalTracks(o,c),o.forEach(u=>{let{track:l,type:T}=u;const v=Date.now();n.store.publish(l.getTrackId(),T===_e.LocalAudioTrack?"audio":"video",void 0,v)}),n.startUploadUplinkState()}finally{i()}})()}async unpublish(t){if(!this.sendConnection||this.state!==Mr.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(i=>!Ce(t).call(t,i)));const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const r=e.find(i=>i[0]==="videoLowTrack");r&&r[1].track.close();const n=this.createGatewayUnpublishMessage(e);if(await this.sendConnection.stopSending(e.map(i=>{let[,{id:o}]=i;return o})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(i=>{let[o,{track:s}]=i;return{type:o,track:s}})),e.forEach(i=>{let[o]=i;this.statsCollector.removeLocalStats(o)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Mr.Connected)return r&&r[1].track.close(),n;t.forEach(i=>{const o=this.pendingLocalTracks.indexOf(i);o!==-1&&this.pendingLocalTracks.splice(o,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const e=[],r=[];Array.from(this.localTrackMap.entries()).forEach(n=>{let[i,{track:o,ssrcs:s}]=n;const c={stream_type:qH(o,i),ssrcs:s};o._muted||!o._enabled?e.push(c):r.push(c)}),e.length>0&&e.forEach(n=>{Kr(this,$e.RequestMuteLocal,[n])}),r.length>0&&r.forEach(n=>{Kr(this,$e.RequestUnmuteLocal,[n])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return ho(function*(){throw new Qt(et.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(C.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ni(this,$e.RequestRePublish,this.pendingLocalTracks),this.emit($e.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Qt(et.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,e,r,n){var i;if(!this.recvConnection)throw new Qt(et.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((i=this.remoteUserMap.get(t))!==null&&i!==void 0&&i.has(e))return;const{track:o,mid:s,transceiver:c}=await this.recvConnection.receive(e,[{ssrcId:r}],String(t.uid),n);e===Ue.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(o):(t._audioTrack=new Dd(o,t.uid,t._uintid,this.store),C.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),c&&t._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=r,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(o):(t._videoTrack=new Pd(o,t.uid,t._uintid,this.store),C.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),c&&t._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(t,t._videoTrack));const d=this.remoteUserMap.get(t);d?d.set(e,s):this.remoteUserMap.set(t,new Map([[e,s]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const u=this.pendingRemoteTracks.findIndex(l=>{let{user:T,kind:v}=l;return T.uid===t.uid&&e===v});u!==-1&&(this.pendingRemoteTracks.splice(u,1),this.emit($e.MediaReconnectEnd,t.uid))}async mockSubscribe(t,e,r,n){if(!this.recvConnection)throw new Qt(et.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(e,[{ssrcId:r}],String(t.uid),n)}async unsubscribe(t,e,r){const n=this.pendingRemoteTracks.filter(o=>{let{user:s,kind:c}=o;return e!==void 0?s.uid===t.uid&&e===c:s.uid===t.uid});if(n.forEach(o=>{const s=this.pendingRemoteTracks.indexOf(o);this.pendingRemoteTracks.splice(s,1)}),this.recvConnection||r||n.forEach(o=>{let{kind:s}=o;var c;if(s===Ue.AUDIO)(c=t._audioTrack)===null||c===void 0||c._destroy(),t._audioTrack=void 0;else if(s===Ue.VIDEO){var d;(d=t._videoTrack)===null||d===void 0||d._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const i=this.filterTobeUnSubscribedTracks(t,e);i.length!==0&&(await this.recvConnection.stopReceiving(i.map(o=>{let[,{id:s}]=o;return s})),this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach(o=>{let[s,{kind:c}]=o;var d,u;if(c===Ue.VIDEO&&s._videoSSRC&&((d=this.recvConnection)===null||d===void 0||d.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),c===Ue.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),r||((u=s._videoTrack)===null||u===void 0||u._destroy(),s._videoTrack=void 0);else if(c===Ue.AUDIO){var l;this.unbindRemoteTrackEvents(s._audioTrack),!r&&((l=s._audioTrack)===null||l===void 0||l._destroy(),s._audioTrack=void 0)}}),i.forEach(o=>{let[,{kind:s}]=o;Kr(this,$e.RequestP2PMuteRemote,s)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(e=>{let[,r]=e;[Ue.VIDEO,Ue.AUDIO].forEach(n=>{r.has(n)?Kr(this,$e.RequestP2PUnmuteRemote,n):Kr(this,$e.RequestP2PMuteRemote,n)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new Qt(et.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new Qt(et.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new Qt(et.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new Qt(et.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,e){if(!this.recvConnection)return;const r=this.remoteUserMap.get(t);if(!r)return void C.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!r.get(e))return void C.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const n=e===Ue.VIDEO?t._videoSSRC:t._audioSSRC;n!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(n,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.recvConnection)return;const r=this.remoteUserMap.get(t);if(!r)return void C.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));r.get(e)||C.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(_e.LocalAudioTrack);if(e?.track instanceof Nn){const r=e.track;return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return i!==_e.LocalAudioTrack}).filter(n=>{let[i]=n;return!(t&&i===_e.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(r=>{let[n]=r;return!(t&&n===_e.LocalVideoLowTrack)}).map(r=>{let[,{track:n}]=r;return n})}reportPublishEvent(t,e,r,n,i){if(t){const s=this.localTrackMap.get(_e.LocalAudioTrack),c=n?this.localTrackMap.get(_e.LocalVideoLowTrack):this.localTrackMap.get(_e.LocalVideoTrack);qe.publish(this.store.sessionId,{eventElapse:ui.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:s?.track.getTrackLabel(),videoName:c?.track.getTrackLabel(),screenshare:c?.track._hints.indexOf(Wr.SCREEN_TRACK)!==-1,audio:!!s,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var o;r||(r=[]);const s=r.find(d=>d instanceof Tn),c=n?(o=this.localTrackMap.get(_e.LocalVideoTrack))===null||o===void 0?void 0:o.track:r.find(d=>d instanceof Zr);qe.publish(this.store.sessionId,{eventElapse:ui.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:s?.getTrackLabel(),videoName:c?.getTrackLabel(),screenshare:c?._hints.indexOf(Wr.SCREEN_TRACK)!==-1,audio:!!s,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(t,e,r,n){const i=n===Ue.VIDEO?r._videoSSRC:r._audioSSRC;i&&qe.subscribe(this.store.sessionId,{succ:t,ec:e,video:n===Ue.VIDEO,audio:n===Ue.AUDIO,peerid:r.uid,subscribeRequestid:n===Ue.VIDEO?r._videoSSRC:r._audioSSRC,p2pid:this.store.p2pId,eventElapse:ui.measureFromSubscribeStart(this.store.clientId,i)})}reset(){C.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new si("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new si("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(_e.LocalAudioTrack);if(t?.track instanceof Nn){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(r=>{e.removeAudioTrack(r)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Mr.Disconnected}getStats(t){var e,r;return t?(r=this.recvConnection)===null||r===void 0?void 0:r.getStats():(e=this.sendConnection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.recvConnection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(_e.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(_e.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof Zr||e&&e.track instanceof Tn?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(t);return!!r&&(!e||r.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(t);return!!r&&(!e||r.has(e))}getRemoteMedia(t){var e;const r=Array.from(Li(e=this.remoteUserMap).call(e)).find(n=>n.uid===t);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(r=>{let[n]=r;return{uid:n.uid,level:n.audioTrack?100*n.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(_e.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=tc(t).call(t,(r,n)=>r.level-n.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(C.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Mr.Reconnecting,st("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var r;e._videoTrack&&e._videoTrack._player&&((r=e._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[r,{track:n}]=t;switch(r){case _e.LocalVideoTrack:Ce(e=n._hints).call(e,Wr.LOW_STREAM)?n.close():this.pendingLocalTracks.push(n);break;case _e.LocalAudioTrack:n instanceof Nn?this.pendingLocalTracks=this.pendingLocalTracks.concat(n.trackList):this.pendingLocalTracks.push(n);case _e.LocalVideoLowTrack:}}),this.emit($e.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,r]=t;Array.from(Li(r).call(r)).forEach(n=>{this.setPendingRemoteMedia(e,n)}),this.emit($e.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),C.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,e){for(const r of this.pendingRemoteTracks){const{user:n,kind:i}=r;if((t instanceof Ma?t.uid:t)===n.uid&&e===i)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}async restartICE(t,e){let r,n;if(t===Ii.SEND_ONLY){if(!this.sendConnection)throw new Qt(et.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");r=await this.sendMutex.lock("From P2PChannel.restartICE"),n=this.sendConnection}else{if(!this.recvConnection)throw new Qt(et.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");r=await this.recvMutex.lock("From P2PChannel.restartICE"),n=this.recvConnection}try{if(e){const i=await n.restartICE(e);return n.isInRestartIce=!1,i}{const i=await n.restartICE();if(i){const o=await ni(this,$e.RequestP2PRestartICE,{direction:Ii.RECEIVE_ONLY,iceParameter:i});await n.restartICE(o),n.isInRestartIce=!1}}}finally{r()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),e=this.localTrackMap.get(_e.LocalVideoTrack),r=this.localTrackMap.get(_e.LocalAudioTrack),n=t.videoSend.find(y=>{var x;return y.ssrc===(e==null||(x=e.ssrcs)===null||x===void 0?void 0:x[0].ssrcId)}),i=t.audioSend.find(y=>{var x;return y.ssrc===(r==null||(x=r.ssrcs)===null||x===void 0?void 0:x[0].ssrcId)});if(!n||!i)return 1;const o=$i(this,$e.NeedSignalRTT),s=n?n.rttMs:void 0,c=i?i.rttMs:void 0,d=s&&c?(s+c)/2:s||c,u=(d&&o?(d+o)/2:d||o)||0,l=100*t.sendPacketLossRate*.7/50+.3*u/1500,T=l<.17?1:l<.36?2:l<.59?3:l<.1?4:5,v=e?.track;if(v&&v._encoderConfig&&v._hints.indexOf(Wr.SCREEN_TRACK)===-1){const y=v._encoderConfig.bitrateMax,x=t.bitrate.actualEncoded;if(y&&x){const N=(1e3*y-x)/(1e3*y);return DO[N<.15?0:N<.3?1:N<.45?2:N<.6?3:4][T]}}return T}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[n]=r;const i=n._audioSSRC,o=n._videoSSRC,s=t.audioRecv.find(x=>x.ssrc===i),c=t.videoRecv.find(x=>x.ssrc===o);if(!s&&!c)return void(e+=1);const d=$i(this,$e.NeedSignalRTT),u=t.rtt,l=(u&&d?(u+d)/2:u||d)||0,T=s?s.jitterMs:void 0,v=t.recvPacketLossRate;let y=.7*v*100/50+.3*l/1500;T&&(y=.6*v*100/50+.2*l/1500+.2*T/400),e+=y<.1?1:y<.17?2:y<.36?3:y<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new De((e,r)=>{this.handleMuteLocalTrack(t,e,r)})}filterTobePublishedTracks(t,e,r){const n=[],i=br(),o=this.getAllTracks();t=gd(t=t.filter(d=>o.indexOf(d)===-1));let s=!1,c=!1;for(const d of t){if(d instanceof Zr&&(this.localTrackMap.has(_e.LocalVideoTrack)||s?new Qt(et.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(n.push({track:d,type:_e.LocalVideoTrack}),s=!0),e)){const u=this.getLowVideoTrack(d,r);n.push({track:u,type:_e.LocalVideoLowTrack})}if(d instanceof Tn){const u=this.localTrackMap.get(_e.LocalAudioTrack);if(u){if(!(u.track instanceof Nn))throw new Qt(et.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new Qt(et.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");u.track.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0)}else if(c){const l=n.find(T=>{let{type:v}=T;return v===_e.LocalAudioTrack});if(!(l.track instanceof Nn))throw new Qt(et.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new Qt(et.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");l.track.addAudioTrack(d)}else{if(!i.webAudioMediaStreamDest||d instanceof Nn||d._bypassWebAudio)n.push({track:d,type:_e.LocalAudioTrack});else{const l=new Nn;l.addAudioTrack(d),n.push({track:l,type:_e.LocalAudioTrack})}c=!0}}}return n}filterTobeUnpublishedTracks(t){const e=[],r=this.getAllTracks();t=gd(t=t.filter(n=>r.indexOf(n)!==-1));for(const n of t){if(n instanceof Tn){const i=this.localTrackMap.get(_e.LocalAudioTrack);if(!i)continue;i.track instanceof Nn?(i.track.removeAudioTrack(n),this.unbindLocalAudioTrackEvents(n),i.track.trackList.length===0&&(e.push([_e.LocalAudioTrack,i]),i.track.close())):e.push([_e.LocalAudioTrack,i])}if(n instanceof Zr){const i=this.localTrackMap.get(_e.LocalVideoTrack);if(!i)continue;e.push([_e.LocalVideoTrack,i]);const o=this.localTrackMap.get(_e.LocalVideoLowTrack);o&&e.push([_e.LocalVideoLowTrack,o])}}return e}bindLocalTrackEvents(t){t.forEach(e=>{let{track:r,type:n}=e;switch(n){case _e.LocalVideoTrack:r.addListener(Ge.GET_STATS,this.handleGetLocalVideoStats),r.addListener(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(Ge.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener(Ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener(Ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case _e.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case _e.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof Nn?t.trackList.forEach(r=>{r.addListener(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(Ge.GET_STATS,this.handleGetLocalAudioStats),r.addListener(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Ge.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(Ge.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[r,{track:n}]=e;return{track:n,type:r}})),t.forEach(e=>{let{track:r,type:n}=e;switch(n){case _e.LocalVideoTrack:r.off(Ge.GET_STATS,this.handleGetLocalVideoStats),r.off(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Ge.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off(Ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off(Ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case _e.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case _e.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Nn?t.trackList.forEach(e=>{e.off(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ge.GET_STATS,this.handleGetLocalAudioStats),e.off(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Ge.GET_STATS,this.handleGetLocalAudioStats),t.off(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof Pd&&e.addListener(Ge.GET_STATS,r=>{r(this.handleGetRemoteVideoStats(t))}),e instanceof Dd&&e.addListener(Ge.GET_STATS,r=>{r(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Ge.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,r]=t;r.has(Ue.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),r.has(Ue.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((r,n)=>{var i;let o,{track:s,type:c}=r;switch(c){case _e.LocalAudioTrack:o=Ur.Audio;break;case _e.LocalVideoTrack:o=Ce(i=s._hints).call(i,Wr.SCREEN_TRACK)?Ur.Screen:Ur.High;break;case _e.LocalVideoLowTrack:o=Ur.Low}return{kind:c===_e.LocalAudioTrack?Ue.AUDIO:Ue.VIDEO,stream_type:o,mid:e[n].id,ssrcs:e[n].localSSRC,isMuted:s.muted||!s.enabled}})}createGatewayUnpublishMessage(t){return t.map(e=>{var r;let n,[i,{track:o,ssrcs:s,id:c}]=e;switch(i){case _e.LocalVideoTrack:n=Ce(r=o._hints).call(r,Wr.SCREEN_TRACK)?Ur.Screen:Ur.High;break;case _e.LocalAudioTrack:n=Ur.Audio;break;case _e.LocalVideoLowTrack:n=Ur.Low}return{stream_type:n,ssrcs:s,mid:c}})}assignLocalTracks(t,e){t.forEach((r,n)=>{let{track:i,type:o}=r;this.localTrackMap.set(o,{track:i,id:e[n].id,ssrcs:e[n].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[r]=e;this.localTrackMap.delete(r)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{var r;C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(e,")")),this.emit($e.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(t.isInRestartIce=!1),Ce(r=this._restartStates).call(r,e)&&!t.isInRestartIce&&(e==="disconnected"&&await Yn(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),qe.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:cn.TRACER}).onSuccess(),this.emit($e.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var r;const n=Array.from(Li(r=this.remoteUserMap).call(r)).find(o=>o._audioSSRC===e);var i;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),(i=n.audioTrack)===null||i===void 0||i.emit(mo.FIRST_FRAME_DECODED),qe.firstRemoteFrame(this.store.sessionId,Un.FIRST_AUDIO_DECODE,nn.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:ui.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var r;const n=Array.from(Li(r=this.remoteUserMap).call(r)).find(i=>i._audioSSRC===e);n&&qe.firstRemoteFrame(this.store.sessionId,Un.FIRST_AUDIO_RECEIVED,nn.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:ui.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,r,n)=>{this.reportVideoFirstFrameDecoded(e,r,n)},t.onFirstVideoReceived=e=>{var r;const n=Array.from(Li(r=this.remoteUserMap).call(r)).find(i=>i._videoSSRC===e);n&&qe.firstRemoteFrame(this.store.sessionId,Un.FIRST_VIDEO_RECEIVED,nn.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:ui.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,r)=>{const n=e.candidateType==="relay",i=r.candidateType==="relay";r.candidateType!=="unknown"&&n===i||this.emit($e.ConnectionTypeChange,n),C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Na(r))," -> ").concat(JSON.stringify(Na(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,r)=>{C.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Na(r))," -> ").concat(JSON.stringify(Na(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.onLocalCandidate=e=>{this.emit($e.LocalCandidate,{candidate:e,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const e=t===Ii.SEND_ONLY?this.sendConnection:this.recvConnection;e&&!e.isInRestartIce&&(e.isInRestartIce=!0,C.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(e.name,"] start use restartICE")),t===Ii.SEND_ONLY?this.restartICE(t):ni(this,$e.RequestP2PRestartICE,{direction:Ii.SEND_ONLY}))}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const r=this.localTrackMap.get(_e.LocalAudioTrack);if(t instanceof Tn&&r?.track instanceof Nn)return r.track.isActive||e.push([_e.LocalAudioTrack,r]),e;const n=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:o}]=i;return t===o});if(n&&(e.push(n),n[0]===_e.LocalVideoTrack)){const i=this.localTrackMap.get(_e.LocalVideoLowTrack);i&&e.push([_e.LocalVideoLowTrack,i])}return e}filterTobeUnmutedTracks(t){const e=[],r=this.localTrackMap.get(_e.LocalAudioTrack);if(t instanceof Tn&&r?.track instanceof Nn)return r.track.isActive&&e.push([_e.LocalAudioTrack,r]),e;const n=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:o}]=i;return t===o});if(n)if(n[0]===_e.LocalVideoTrack){e.push(n);const i=this.localTrackMap.get(_e.LocalVideoLowTrack);i&&e.push([_e.LocalVideoLowTrack,i])}else e.push(n);return e}createMuteMessage(t){return t.map(e=>{var r;let n,[i,{track:o,ssrcs:s,id:c}]=e;switch(i){case _e.LocalAudioTrack:n=Ur.Audio;break;case _e.LocalVideoTrack:n=Ce(r=o._hints).call(r,Wr.SCREEN_TRACK)?Ur.Screen:Ur.High;break;case _e.LocalVideoLowTrack:n=Ur.Low}return{stream_type:n,ssrcs:s,mid:c}})}createUnmuteMessage(t){return t.map(e=>{var r;let n,[i,{track:o,ssrcs:s,id:c}]=e;switch(i){case _e.LocalAudioTrack:n=Ur.Audio;break;case _e.LocalVideoTrack:n=Ce(r=o._hints).call(r,Wr.SCREEN_TRACK)?Ur.Screen:Ur.High;break;case _e.LocalVideoLowTrack:n=Ur.Low}return{stream_type:n,ssrcs:s,mid:c}})}filterTobeUnSubscribedTracks(t,e){const r=[],n=this.remoteUserMap.get(t);if(!n)return r;if(e){const i=n.get(e);if(!i)return r;r.push([t,{kind:e,id:i}])}else Array.from(n.entries()).forEach(i=>{let[o,s]=i;r.push([t,{kind:o,id:s}])});return r}createUnsubscribeMessage(t){const e=[];return t.forEach(r=>{let[n,{kind:i,id:o}]=r;switch(i){case Ue.VIDEO:return void(n._videoSSRC&&e.push({stream_type:Ue.VIDEO,ssrcId:n._videoSSRC}));case Ue.AUDIO:return void(n._audioSSRC&&e.push({stream_type:Ue.AUDIO,ssrcId:n._audioSSRC}))}}),e}withdrawRemoteTracks(t){t.forEach(e=>{let[r,{kind:n}]=e;const i=this.remoteUserMap.get(r);i&&(i.delete(n),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(r))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(_e.LocalVideoTrack),r=this.localTrackMap.get(_e.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(t.uplink),await new De((n,i)=>{this.handleUpdateVideoEncoder(e.track,n,i,!0)})),r&&t.low_stream_uplink&&(await r.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new De((n,i)=>{this.handleUpdateVideoEncoder(r.track,n,i,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,e=this.recvConnection.peerConnectionState;return t!=="connected"&&e!=="connected"}return!0}async tryToUnmuteAudio(t){for(let e=0;e<t.length;e++)if(t[e]instanceof Tn){const r=this.filterTobeUnmutedTracks(t[e]);if(r.length===0)continue;const n=this.createUnmuteMessage(r);return void await Kr(this,$e.RequestUnmuteLocal,n)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:e}]=t;return!!e}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.recvConnection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit($e.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit($e.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Yn(qE(this.dtlsFailedCount,bn)),this.emit($e.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(_e.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Zr)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof Zr).length>1)throw new Qt(et.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof Tn).length>1&&(t.some(e=>e instanceof Tn&&e._bypassWebAudio)||!br().webAudioMediaStreamDest))throw new Qt(et.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof Zr&&this.pendingLocalTracks.some(r=>r instanceof Zr))throw new Qt(et.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof Tn&&this.pendingLocalTracks.some(r=>r instanceof Tn)&&(!br().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(r=>r instanceof Tn&&r._bypassWebAudio)))throw new Qt(et.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const r=!st("DISABLE_DUAL_STREAM_USE_ENCODING")&&br().supportDualStreamEncoding,n=Gf(Gf({},{width:160,height:120,framerate:15,bitrate:50}),e);let i;i=r?t._mediaStreamTrack.clone():dT(t,n);const o=zr(8,"track-low-"),s=new Zr(i,Gf(Gf({},r&&{scaleResolutionDownBy:Hg(n,t)}),{},{frameRate:n.framerate,bitrateMax:n.bitrate,bitrateMin:n.bitrate}),void 0,void 0,o);return s.on(pc.TRANSCEIVER_UPDATED,c=>{t._updateRtpTransceiver(c,Cd.LOW_STREAM)}),s._hints.push(Wr.LOW_STREAM),t.addListener(Ge.NEED_CLOSE,()=>{s.close()}),s}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,e,r,n){var i;const o=Array.from(Li(i=this.remoteUserMap).call(i)).find(s=>s._videoSSRC===t);if(o){n||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const s=this.store.keyMetrics,c=s.subscribe.find(d=>d.userId===o.uid&&d.type==="video");qe.firstRemoteVideoDecode(this.store.sessionId,Un.FIRST_VIDEO_DECODE,nn.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:e,videoheight:r,subscribeElapse:ui.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:s.requestAPEnd||0,apStart:s.requestAPStart||0,joinGwEnd:s.joinGatewayEnd||0,joinGwStart:s.joinGatewayStart||0,pcEnd:s.peerConnectionEnd||0,pcStart:s.peerConnectionStart||0,subscriberEnd:c?.subscribeEnd||0,subscriberStart:c?.subscribeStart||0,videoAddNotify:c?.streamAdded||0,state:n?1:0})}}async remoteMediaSsrcChanged(t,e,r){if(!this.recvConnection)return!1;const n=this.remoteUserMap.get(t);if(!n)return!1;const i=n.get(e);if(!i)return!1;const o=await this.recvConnection.getRemoteSSRC(i);return o!==void 0&&o!==r}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new Qt(et.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new Qt(et.NOT_SUPPORTED)}async subscribeDataChannel(t,e){throw new Qt(et.NOT_SUPPORTED)}async unsubscribeDataChannel(t,e){throw new Qt(et.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,e){throw new Qt(et.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,e){throw new Qt(et.NOT_SUPPORTED)}async preConnect(t){throw new Qt(et.NOT_SUPPORTED)}getEstablishParams(){throw new Qt(et.NOT_SUPPORTED)}async reSubscribe(t){throw new Qt(et.NOT_SUPPORTED)}reportVideoFirstFrameRender(t){}async updateVideoStreamParameter(t,e){throw new Qt(et.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:r}]=t;e===_e.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,Cd.LOW_STREAM):r._updateRtpTransceiver(void 0)})}},Ke(un.prototype,"p2pConnect",[fD],Object.getOwnPropertyDescriptor(un.prototype,"p2pConnect"),un.prototype),Ke(un.prototype,"unpublish",[mD],Object.getOwnPropertyDescriptor(un.prototype,"unpublish"),un.prototype),Ke(un.prototype,"unpublishLowStream",[_D],Object.getOwnPropertyDescriptor(un.prototype,"unpublishLowStream"),un.prototype),Ke(un.prototype,"subscribe",[ED],Object.getOwnPropertyDescriptor(un.prototype,"subscribe"),un.prototype),Ke(un.prototype,"mockSubscribe",[gD],Object.getOwnPropertyDescriptor(un.prototype,"mockSubscribe"),un.prototype),Ke(un.prototype,"unsubscribe",[TD],Object.getOwnPropertyDescriptor(un.prototype,"unsubscribe"),un.prototype),Ke(un.prototype,"muteRemote",[vD],Object.getOwnPropertyDescriptor(un.prototype,"muteRemote"),un.prototype),Ke(un.prototype,"unmuteRemote",[yD],Object.getOwnPropertyDescriptor(un.prototype,"unmuteRemote"),un.prototype),Ke(un.prototype,"hasRemoteMediaWithLock",[SD],Object.getOwnPropertyDescriptor(un.prototype,"hasRemoteMediaWithLock"),un.prototype),Ke(un.prototype,"disconnectForReconnect",[RD],Object.getOwnPropertyDescriptor(un.prototype,"disconnectForReconnect"),un.prototype),Ke(un.prototype,"remoteMediaSsrcChanged",[ID],Object.getOwnPropertyDescriptor(un.prototype,"remoteMediaSsrcChanged"),un.prototype),un);function ps(t){return function(e,r,n){const i=e[r];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];switch(t){case hs.SEND_ONLY:{const d=await this.sendMutex.lock("From P2PChannel2.".concat(r));try{return await i.apply(this,s)}finally{d()}}case hs.RECEIVE_ONLY:{const d=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await i.apply(this,s)}finally{d()}}default:{const d=await this.sendMutex.lock("From P2PChannel2.".concat(r)),u=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await i.apply(this,s)}finally{d(),u()}}}},n}}class Pc extends pn{constructor(e,r){super(),G(this,"signal",void 0),G(this,"token",void 0),G(this,"tokenTimeout",void 0),G(this,"tokenInterval",void 0),G(this,"_sequence",0),G(this,"userMap",new Map),G(this,"encoder",new TextEncoder),this.signal=e,this.token=r;const n=()=>{this.signal.connectionState===Jr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(n,1e3):this.tokenInterval=window.setTimeout(n,3*st("P2P_TOKEN_INTERVAL"))};n()}async send(e,r,n,i,o){var s;if(this.userMap.size===0)return;const c=Array.from(Gi(s=this.userMap).call(s))[0].token;typeof r!="string"&&(r=JSON.stringify(r)),i=i??zr(6,""),o=o??this._sequence++;const d={_id:i,_type:e,_seq:o,_message:r,token:"".concat(this.token,"_").concat(c)};st("SHOW_P2P_LOG")&&C.debug("send message",d,"noNeedResponse : ".concat(n)),this.splitMessage(JSON.stringify(d)).forEach(l=>{this.signal.request(sr.DATA_STREAM,{payload:Ia(this.encoder.encode(l))})});const u=new De((l,T)=>{const v=window.setTimeout(()=>{this.off("res-@".concat(i,"_ack"),y),this.off("res-@".concat(i),N),this.off(xd.ABORT,x),C.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(i)),this.userMap.size===0?T(new Qt(et.INVALID_REMOTE_USER)):T(new Qt(et.TIMEOUT))},st("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),y=()=>{v&&window.clearTimeout(v),this.off(xd.ABORT,x),n&&l()},x=()=>{v&&window.clearTimeout(v),this.off("res-@".concat(i,"_ack"),y),this.off("res-@".concat(i),N),T(new Qt(et.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(i)))};this.once(xd.ABORT,x),this.once("res-@".concat(i,"_ack"),y);const N=(Q,J)=>{L=!0,v&&window.clearTimeout(v),this.off("res-@".concat(i,"_ack"),y),this.off(xd.ABORT,x),Q==="success"?l(J):T(new Qt(et.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(i)))};let L=!1;n||(this.once("res-@".concat(i),N),Yn(st("SIGNAL_REQUEST_TIMEOUT")).then(()=>{L||C.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(i,", ").concat(d))}))});try{return await u}catch(l){if(l.code===et.TIMEOUT)return await this.send(e,r,n,i,o);throw l}}onMessage(e){var r;const{_uid:n}=e;let i,o=this.userMap.get(n);if(o)i=o.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==Sn.CHECK)return;const{token:u}=e;i=new Map,o={uid:n,isStart:!0,token:u,splitMessageMap:i,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(n,o),this.signal.emit(yr.ON_USER_ONLINE,{uid:n}),this.handleUserOnline()}if("id"in e&&"total"in e){var s;const{id:u,total:l}=e,T=(s=i.get(u))!==null&&s!==void 0?s:[];if(T.push(e),i.has(u)||i.set(u,T),T.length!==l)return;{const v=tc(T).call(T,(y,x)=>y.index-x.index).map(y=>y.payload).join("");i.delete(u),(e=JSON.parse(v))._uid=n}}const{_type:c,token:d}=e;if(Ce(r=[Sn.ACK,Sn.CHECK]).call(r,c))return c===Sn.CHECK&&this.handleCheckToken(o,d),void this.receiveMessage(e);d==="".concat(o.token,"_").concat(this.token)?this.handleReceivedMessage(e):C.debug('Receive unexpected message", '.concat(d,", cur_token: ").concat(o.token,"_").concat(this.token),e)}check(){const e={_id:zr(6,""),token:this.token,_type:Sn.CHECK};st("SHOW_P2P_LOG")&&C.debug("send message",e),this.signal.request(sr.DATA_STREAM,{payload:Ia(this.encoder.encode(JSON.stringify(e)))})}ack(e){const r={_id:e,_type:Sn.ACK,token:this.token};st("SHOW_P2P_LOG")&&C.debug("send message",r),this.signal.request(sr.DATA_STREAM,{payload:Ia(this.encoder.encode(JSON.stringify(r)))})}response(e,r,n){this.send(Sn.RESPONSE,JSON.stringify({success:!n,message:r}),!0,e)}handleReceivedMessage(e){const r=()=>{this.userMap.forEach(u=>{const{receivedMessagesMap:l,nextExpectedSequenceNumber:T}=u;for(;l.has(T);){const v=l.get(T);l.delete(T),this.receiveMessage(v),u.nextExpectedSequenceNumber++}})};if(!e)return void r();const{_uid:n,_seq:i}=e,o=this.userMap.get(n),{receivedMessagesMap:s,isStart:c,nextExpectedSequenceNumber:d}=o;if(i<d)return this.ack(e._id),void C.debug("[external-signal] receive old message, seq: ".concat(i,", ").concat(e._message));s.set(i,e),c&&i===d&&(this.receiveMessage(e),s.delete(d),o.nextExpectedSequenceNumber++,r())}receiveMessage(e){const{_id:r,_type:n,_message:i,_uid:o}=e;if(st("SHOW_P2P_LOG")&&C.debug("receive message",e),r){let s;switch(e._type!==Sn.ACK&&(i&&(s=JSON.parse(i)),this.ack(e._id)),e._type){case Sn.CANDIDATE:case Sn.CONTROL:this.signal.emit(n,s,o);break;case Sn.PUBLISH:case Sn.UNPUBLISH:case Sn.RESTART_ICE:case Sn.CALL:s.uid=o,ni(this.signal,n,s).then(c=>{this.response(e._id,c)}).catch(()=>{this.response(e._id,void 0,!0)});break;case Sn.ACK:this.getListeners("res-@".concat(r,"_ack")).length>0&&this.emit("res-@".concat(r,"_ack"));break;case Sn.RESPONSE:{const{success:c,message:d}=s;this.emit("res-@".concat(r),c?"success":"failed",d);break}}}}splitMessage(e){if(e.length<Pc.MAX_MESSAGE_SIZE)return[e];const r=[],{remoteToken:n}=JSON.parse(e),i=zr(6,"");let o=0,s=800;const c=Math.ceil(e.length/s);for(;e.length>0;){o++;const d={id:i,index:o,total:c,payload:e.slice(0,s),token:"".concat(this.token,"_").concat(n)};JSON.stringify(d).length>Pc.MAX_MESSAGE_SIZE?s-=50:(r.push(d),e=e.slice(s))}return r.map(d=>JSON.stringify(d))}handleCheckToken(e,r){return e.token!==r?(C.debug("token changed, from ".concat(e.token," to ").concat(r)),this.reset(e.uid,r),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{C.debug("token timeout, ".concat(r)),this.reset(e.uid)},st("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await ni(this.signal,Sn.CALL,void 0),r=await this.send(Sn.CALL,e);this.signal.emit(cr.P2P_CONNECTION,r,!0)}async reset(e,r){const n=this.userMap.get(e);n&&(this.emit(xd.ABORT),this.signal.emit(yr.ON_USER_OFFLINE,{uid:n.uid,reason:yH.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),r||(C.debug("change local token from ".concat(r," to ").concat(r)),this.token=zr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(xd.ABORT)}}G(Pc,"MAX_SIZE",1),G(Pc,"MAX_MESSAGE_SIZE",1024);class r7 extends pn{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Jr.CONNECTED?this.emit(cr.WS_CONNECTED):e===Jr.RECONNECTING?this.emit(cr.WS_RECONNECTING,this._websocketReconnectReason):e===Jr.CLOSED&&this.emit(cr.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,r){super(),G(this,"_disconnectedReason",void 0),G(this,"_websocketReconnectReason",void 0),G(this,"_connectionState",Jr.CLOSED),G(this,"reconnectToken",void 0),G(this,"p2pToken",void 0),G(this,"websocket",void 0),G(this,"openConnectionTime",void 0),G(this,"clientId",void 0),G(this,"lastMsgTime",Date.now()),G(this,"uploadCache",[]),G(this,"uploadCacheInterval",void 0),G(this,"rttRolling",new tA(5)),G(this,"pingpongTimer",void 0),G(this,"pingpongTimeoutCount",0),G(this,"joinResponse",void 0),G(this,"multiIpOption",void 0),G(this,"initError",void 0),G(this,"spec",void 0),G(this,"store",void 0),G(this,"_external_signal",void 0),G(this,"onWebsocketMessage",n=>{if(n.data instanceof ArrayBuffer)return void this.emit(cr.ON_BINARY_DATA,n.data);const i=JSON.parse(n.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const o="res-@".concat(i._id);this.emit(o,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){switch(i._type){case yr.ON_DATA_STREAM:return void this.handleDataStream(i._message);case yr.MUTE_AUDIO:case yr.MUTE_VIDEO:case yr.ON_P2P_LOST:case yr.ON_USER_ONLINE:return;case yr.ON_USER_OFFLINE:const{uid:o}=i._message;return C.debug("[".concat(this.clientId,"] user-offline uid: ").concat(o)),void this._external_signal.reset(o)}if(this.emit(i._type,i._message),i._type===yr.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===yr.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Lr.UID_BANNED);break;case 15:this.close(Lr.IP_BANNED);break;case 16:this.close(Lr.CHANNEL_BANNED)}if(i._type===yr.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case er.ERR_LICENSE_MISSING:this.close(Lr.LICENSE_MISSING);break;case er.ERR_LICENSE_EXPIRED:this.close(Lr.LICENSE_EXPIRED);break;case er.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Lr.LICENSE_MINUTES_EXCEEDED);break;case er.ERR_LICENSE_PERIOD_INVALID:this.close(Lr.LICENSE_PERIOD_INVALID);break;case er.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Lr.LICENSE_MULTIPLE_SDK_SERVICE);break;case er.ERR_LICENSE_ILLEGAL:this.close(Lr.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=r,this.websocket=new Fg("gateway-".concat(this.clientId),this.spec.retryConfig,!0,st("JOIN_GATEWAY_USE_DUAL_DOMAIN"),st("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Jr.CONNECTED&&this.reconnect("retry",ri.OFFLINE)}),this.p2pToken=zr(6,""),this._external_signal=new Pc(this,this.p2pToken)}async request(e,r,n,i){const o=zr(6,""),s={_id:o,_type:e,_message:r},c=this.websocket.connectionID,d=()=>new De((x,N)=>{if(this.connectionState===Jr.CONNECTED)return x();const L=()=>{this.off(cr.WS_CLOSED,Q),x()},Q=()=>{this.off(cr.WS_CONNECTED,L),N(new Qt(et.WS_ABORT))};this.once(cr.WS_CONNECTED,L),this.once(cr.WS_CLOSED,Q)});if(this.connectionState!==Jr.CONNECTING&&this.connectionState!==Jr.RECONNECTING||e===sr.JOIN||e===sr.REJOIN||await d(),this.websocket.sendMessage(s,!0),i)return;const u=new De((x,N)=>{let L=!1;const Q=(at,Rt)=>{L=!0,x({isSuccess:at==="success",message:Rt||{}}),this.off(cr.WS_CLOSED,J),this.off(cr.WS_RECONNECTING,J),this.emit(cr.REQUEST_SUCCESS,e,r)};this.once("res-@".concat(o),Q);const J=()=>{N(new Qt(et.WS_ABORT,"type: ".concat(e))),this.off(cr.WS_CLOSED,J),this.off(cr.WS_RECONNECTING,J),this.off("res-@".concat(o),Q)};this.once(cr.WS_CLOSED,J),this.once(cr.WS_RECONNECTING,J),Yn(st("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==c||L||(C.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(cr.REQUEST_TIMEOUT,e,r))})});let l=null;try{l=await u}catch(x){if(this.connectionState===Jr.CLOSED||e===sr.LEAVE)throw new Qt(et.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?x.throw():e===sr.JOIN||e===sr.REJOIN?null:(await d(),await this.request(e,r))}if(l.isSuccess)return l.message;const T=Number(l.message.error_code||l.message.code),v=sl(T),y=new Qt(et.UNEXPECTED_RESPONSE,"".concat(v.desc,": ").concat(l.message.error_str),{code:T,data:l.message,desc:v.desc});return v.action==="success"?l.message:(C.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(T,", message: ").concat(v.desc,", action: ").concat(v.action)),T===er.ERR_TOO_MANY_BROADCASTERS?((e===sr.JOIN||e===sr.REJOIN)&&(this.initError=y,this.close()),y.throw()):v.action==="failed"?y.throw():v.action==="quit"?(this.initError=y,this.close(),y.throw()):(T===er.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,C.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ri.MULTI_IP)):this.reconnect(v.action,ri.SERVER_ERROR),e===sr.JOIN||e===sr.REJOIN?null:await this.request(e,r)))}waitMessage(e,r){return new De(n=>{const i=o=>{(!r||r(o))&&(this.off(e,i),n(o))};this.on(e,i)})}uploadWRTCStats(e){if(!this.store.sessionId)return void C.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(il.WRTC_STATS,r)}upload(e,r){const n={_type:e,_message:r};try{this.websocket.sendMessage(n)}catch{const o=st("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>o&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Jr.CONNECTED)return;const s=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(s._type,s._message)},st("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,r){const n={_type:e,_message:r};this.websocket.sendMessage(n)}async sendExtensionMessage(e,r,n){return await this._external_signal.send(e,r,n)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new De((r,n)=>{this.once(cr.WS_CONNECTED,()=>r(this.joinResponse)),this.once(cr.WS_CLOSED,()=>n(this.initError||new Qt(et.WS_ABORT))),this.connectionState=Jr.CONNECTING,this.websocket.init(e).catch(n)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||Lr.LEAVE,this.connectionState=Jr.CLOSED,C.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=zr(6,""),this._external_signal.clear(),this._external_signal=new Pc(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(cr.ABORT_P2P_EXECUTION);const e=await ni(this,cr.REQUEST_JOIN_INFO),r=await this.request(sr.JOIN,e);if(!r)return this.emit(cr.REPORT_JOIN_GATEWAY,et.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(cr.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Jr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,r)}async downgradeCodec(e){return!1}handleDataStream(e){try{var r;const n=uc(e.payload),i=new TextDecoder().decode(n),o=JSON.parse(i);"total"in o&&"id"in o||Ce(r=Object.values(Sn)).call(r,o._type)?(o._uid=e.uid,this._external_signal.onMessage(o)):this.emit(yr.ON_DATA_STREAM,e)}catch{this.emit(yr.ON_DATA_STREAM,e)}}handleNotification(e){C.debug("[".concat(this.clientId,"] receive notification: "),e);const r=sl(e.code);if(r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Lr.UID_BANNED),void this.close()):void this.reconnect(r.action,ri.SERVER_ERROR);C.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=st("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=e&&(C.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>st("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ri.TIMEOUT):this.request(sr.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const n=Date.now()-r;this.rttRolling.add(n),st("REPORT_STATS")&&this.send(sr.PING_BACK,{pingpongElapse:n})}).catch(n=>{})}handleWebsocketEvents(){this.websocket.on(pr.RECONNECT_CREATE_CONNECTION,e=>{this.emit(cr.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(pr.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(pr.CLOSED,()=>{this.connectionState=Jr.CLOSED}),this.websocket.on(pr.FAILED,()=>{this._disconnectedReason=Lr.NETWORK_ERROR,this.connectionState=Jr.CLOSED}),this.websocket.on(pr.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===Jr.CONNECTED?this.connectionState=Jr.RECONNECTING:this.connectionState=Jr.CONNECTING}),this.websocket.on(pr.WILL_RECONNECT,(e,r,n)=>{e!=="retry"?(C.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):C.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),n(e)}),this.websocket.on(pr.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(cr.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof Qt&&e.code===et.UNEXPECTED_RESPONSE&&e.data.code===er.ERR_NO_AUTHORIZED)return C.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",ri.SERVER_ERROR);C.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ri.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(pr.REQUEST_NEW_URLS,(e,r)=>{ni(this,cr.REQUEST_RECOVER,this.multiIpOption).then(e).catch(r)}),this.websocket.on(pr.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(yr.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const n7={name:"P2PChannel",create:function(t){let{store:e,statsCollector:r}=t;return new e7(e,r)},createSubmodule:function(t){let{store:e,spec:r}=t;return new r7(r,e)}};function AD(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function bD(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?AD(Object(r),!0).forEach(function(n){G(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):AD(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}class i7{constructor(e){G(this,"sessionDesc",void 0),G(this,"localCapabilities",void 0),G(this,"rtpCapabilities",void 0),G(this,"candidates",void 0),G(this,"_originCandidates",void 0),G(this,"iceParameters",void 0),G(this,"dtlsParameters",void 0),G(this,"setup",void 0),G(this,"currentMidIndex",void 0),G(this,"cname",void 0),e=dn(e);const{iceParameters:r,dtlsParameters:n,candidates:i,rtpCapabilities:o,setup:s,localCapabilities:c,sdkCodec:d,cname:u}=e,l=ki(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=o,this.candidates=i,this._originCandidates=dn(i),this.iceParameters=r,this.dtlsParameters=n,this.setup=s,this.localCapabilities=c,this.cname=u;for(let T=0;T<l.mediaDescriptions.length;T++){const v=l.mediaDescriptions[T];if(v.attributes.iceUfrag=r.iceUfrag,v.attributes.icePwd=r.icePwd,v.attributes.fingerprints=n.fingerprints,v.attributes.candidates=i,v.attributes.setup=s,v.media.mediaType==="video"){v.media.fmts=o.videoCodecs.map(N=>N.payloadType.toString(10));const y=o.videoCodecs.filter(N=>{var L,Q;return(L=N.rtpMap)===null||L===void 0?void 0:Ce(Q=L.encodingName.toLowerCase()).call(Q,d)}),x=o.videoCodecs.filter(N=>!Ce(y).call(y,N));v.attributes.payloads=[...y,...x],v.attributes.extmaps=o.videoExtensions}v.media.mediaType==="audio"&&(v.media.fmts=o.audioCodecs.map(y=>y.payloadType.toString(10)),v.attributes.payloads=o.audioCodecs,v.attributes.extmaps=o.audioExtensions),l.mediaDescriptions[T]=this.mungMediaDesc(v)}this.sessionDesc=l,this.currentMidIndex=l.mediaDescriptions.length-1}toString(){return Ca(this.sessionDesc)}send(e,r,n){const{ssrcs:i,ssrcGroups:o}=ul(r,this.cname),s=this.sessionDesc.mediaDescriptions.find(u=>e===Ue.VIDEO?u.media.mediaType==="video":u.media.mediaType==="audio"),c=i[0].attributes.label,d=i[0].attributes.mslabel;return s.attributes.ssrcs=s.attributes.ssrcs.concat(i),s.attributes.ssrcGroups=s.attributes.ssrcGroups.concat(o),{id:c,mslabel:d}}batchSend(e){return e.map(r=>{let{kind:n,ssrcMsg:i}=r;return this.send(n,i,void 0)})}stopSending(e){this.sessionDesc.mediaDescriptions.forEach(r=>{const n=[],i=[],o=[];r.attributes.ssrcs.forEach(s=>{Ce(e).call(e,s.attributes.label||"")?o.push(s):n.push(s)}),r.attributes.ssrcGroups.forEach(s=>{var c;Ce(c=o.map(d=>d.ssrcId)).call(c,s.ssrcIds[0])||i.push(s)}),r.attributes.ssrcs=n,r.attributes.ssrcGroups=i})}mute(e){const r=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e);if(!r)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));r.attributes.direction="inactive"}unmute(e){const r=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e);if(!r)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));r.attributes.direction="sendonly"}receive(e,r,n){e.forEach((i,o)=>{const s=i._mediaStreamTrack,c=this.sessionDesc.mediaDescriptions.findIndex(u=>u.attributes.mid===s.kind),d=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[c],i);this.sessionDesc.mediaDescriptions[c]=d})}stopReceiving(e){}updateCandidates(e){const r=this._originCandidates.filter(i=>i.transport==="udp"),n=[];if(r.forEach(i=>{n.push(bD(bD({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),r.length!==0){switch(e){case di.TCP_RELAY:this.candidates=n;break;case di.UDP_TCP_RELAY:case di.RELAY:this.candidates=[...r,...n];break;default:this.candidates=r}for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}}restartICE(e){e=dn(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=e.iceUfrag,r.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const r=[];for(let n=0;n<e;n++)r.push((this.currentMidIndex+n+1).toString(10));return r}mungRecvMediaDsec(e,r){const n=dn(e);return Bd(n,r),Kg(n,r),n}updateRecvMedia(e,r){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===e);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],r);this.sessionDesc.mediaDescriptions[n]=i}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,r,n){const i=this.sessionDesc.mediaDescriptions.find(s=>e===Ue.VIDEO?s.attributes.mid==="video":s.attributes.mid==="audio");if(i){const s=i.attributes.ssrcs.find(c=>c.attributes.label===r);var o;s&&(s.attributes.label=n,(o=s.attributes.msid)===null||o===void 0||o.replace(r,n))}}mungMediaDesc(e){const r=dn(e);return Wg(r),function(n){const i=n.attributes.extmaps.find(o=>rf(o.extensionName));i&&n.attributes.extmaps.splice(n.attributes.extmaps.indexOf(i),1),n.attributes.payloads.forEach(o=>{const s=o.rtcpFeedbacks.findIndex(c=>c.type==="transport-cc");s!==-1&&o.rtcpFeedbacks.splice(s,1)})}(r),r}getSSRC(e){for(const r of this.sessionDesc.mediaDescriptions)for(const n of r.attributes.ssrcs)if(n.attributes.label===e)return[n]}}var qr;function OD(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Hf(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?OD(Object(r),!0).forEach(function(n){G(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):OD(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}let o7=(qr=class Vl extends FO{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var r;return Ce(r=Object.keys($u)).call(r,e)}))]}constructor(e,r){super(e,r),G(this,"store",void 0),G(this,"peerConnection",void 0),G(this,"remoteSDP",void 0),G(this,"initialOffer",void 0),G(this,"statsFilter",void 0),G(this,"useRTX",!1),G(this,"localCapabilities",void 0),G(this,"localCandidateCount",0),G(this,"allCandidatesReceived",!1),G(this,"establishPromise",void 0),G(this,"mutex",void 0),this.store=r,this.mutex=new si("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(Vl.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=$E(this.peerConnection,st("STATS_UPDATE_INTERVAL"),void 0,mn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=Pa(e.sdp),n=dl(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:st("FILTER_VIDEO_FEC"),filterAudioFec:st("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=n,this.initialOffer=e,Hf(Hf({},r),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:n},offerSDP:e.sdp})}catch(e){throw new Qt(et.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new i7(Hf(Hf({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(r){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async updateRemoteRTPCapabilities(e,r){throw new Qt(et.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,r){var n=this;return ho(function*(){const i=yield Ar(n.mutex.lock());try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=e.map(v=>n.peerConnection.addTrack(v._mediaStreamTrack)),s=yield Ar(n.peerConnection.createOffer()),c=ki(s.sdp),d=e.map(v=>{const y=v._mediaStreamTrack,x=c.mediaDescriptions.find(N=>N.attributes.mid===y.kind);if(!x)throw new Error("Cannot extract ssrc from mediaDescription.");return function(N,L,Q){const J=N.attributes.ssrcs.filter(Rt=>Rt.attributes.label===L),at=N.attributes.ssrcGroups;if(J.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(at&&J.length>1){const Rt=at.find(vt=>vt.ssrcIds.indexOf(J[0].ssrcId)!==-1);return Rt?[{ssrcId:Rt.ssrcIds[0],rtx:Q?Rt.ssrcIds[1]:void 0}]:[{ssrcId:J[0].ssrcId}]}return[{ssrcId:J[0].ssrcId}]}(x,y.id,n.useRTX)});let u;try{u=yield d}catch(v){throw o.forEach(y=>{ei()&&y.replaceTrack(null),n.peerConnection.removeTrack(y)}),v}const l=n.mungSendOfferSDP(s.sdp,e);n.remoteSDP.receive(e,r,u);const T=n.remoteSDP.toString();return yield Ar(n.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield Ar(n.applySendEncodings(o,e)),yield Ar(n.peerConnection.setRemoteDescription({type:"answer",sdp:T})),e.map((v,y)=>{const x=v._mediaStreamTrack.id;return{localSSRC:d[y],id:x}})}catch(o){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{i()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getSenders().filter(o=>{var s;return e.indexOf(((s=o.track)===null||s===void 0?void 0:s.id)||"")!==-1});if(r.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(o=>{ei()&&o.replaceTrack(null),this.peerConnection.removeTrack(o)});const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(r){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}}async receive(e,r,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:o,mslabel:s}=this.remoteSDP.send(e,r,i),c=new De((l,T)=>{const v=setTimeout(()=>{T(new Error("Cannot receive track, id: ".concat(o)))},1e4),y=x=>{const N=Rr();if((N.name==="Safari"&&Number(N.version)===11||mi())&&x.track.id!==o&&x.streams[0].id===s){var L;const Q=x.streams[0].getTracks()[0];return(L=this.remoteSDP)===null||L===void 0||L.updateTrackLabel(e,o,x.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(v),void l(Q)}if(x.track.id===o)return this.peerConnection.removeEventListener("track",y),clearTimeout(v),void l(x.track)};this.peerConnection.addEventListener("track",y)}),d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const u=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(u),{track:await c,id:o}}catch(o){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n)}catch(r){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r=this.peerConnection.getSenders().filter(n=>{var i;return e.indexOf(((i=n.track)===null||i===void 0?void 0:i.id)||"")!==-1});if(r.length!==e.length)throw new Error("sender' length doesn't match mids' length.");r.map(n=>{if(ei()&&n.track)n.track.enabled=!1;else{const i=n.getParameters();i.encodings.forEach(o=>o.active=!1),n.setParameters(i)}})}catch(r){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r=this.peerConnection.getSenders().filter(o=>{var s;return e.indexOf(((s=o.track)===null||s===void 0?void 0:s.id)||"")!==-1});if(r.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");r.map(async o=>{if(ei()&&o.track)o.track.enabled=!0;else{const s=o.getParameters();s.encodings.forEach(c=>c.active=!0),await o.setParameters(s)}});const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(r){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(e){var r=this;return ho(function*(){const n=yield Ar(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const i=br().supportPCSetConfiguration;if(e===di.RELAY&&!i)return;if(i){const u=r.peerConnection.getConfiguration(),l=e===di.RELAY?"relay":"all";u.iceTransportPolicy!==l&&(C.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(u.iceTransportPolicy,"] to [").concat(l,"]")),u.iceTransportPolicy=l,r.peerConnection.setConfiguration(u))}e!==di.RELAY&&r.remoteSDP.updateCandidates(e);const o=yield Ar(r.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const s=Pa(o.sdp),{remoteIceParameters:c}=yield s.iceParameters;r.remoteSDP.restartICE(c);const d=r.remoteSDP.toString();yield Ar(r.peerConnection.setLocalDescription(o)),yield Ar(r.peerConnection.setRemoteDescription({type:"answer",sdp:d}))}catch(i){C.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),i)}finally{n()}})()}close(){var e;this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(n.sdp,[r]);this.remoteSDP.updateRecvMedia(r._mediaStreamTrack.kind,r);const o=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new Qt(et.EXCHANGE_SDP_FAILED,n.toString())}}async updateSendParameters(e,r){const n=this.peerConnection.getSenders().filter(i=>{var o;return((o=i.track)===null||o===void 0?void 0:o.id)===e});n.length===1&&await this.applySendEncodings(n,[r])}setStatsRemoteVideoIsReady(e,r){this.statsFilter.setVideoIsReady2(e,r)}async replaceTrack(e,r){const n=this.peerConnection.getSenders().find(i=>{var o;return((o=i.track)===null||o===void 0?void 0:o.id)===r});n&&await n.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,r){throw new Qt(et.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new Qt(et.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,C.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},st("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const r={iceServers:[],sdpSemantics:"plan-b"};return e.iceServers?r.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(Yu(e.turnServer.servers)?r.iceServers=e.turnServer.servers:(r.iceServers&&r.iceServers.push(...Vl.turnServerConfigToIceServers(e.turnServer.servers)),st("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&e.turnServer.serversFromGateway&&r.iceServers.push(...Vl.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(n=>{n.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(e){const r=[];return e.forEach(n=>{n.security?n.tcpport&&r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turns:".concat(n.turnServerURL,":").concat(n.tcpport,"?transport=tcp")}):(n.udpport&&r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":").concat(n.udpport,"?transport=udp")}),n.tcpport&&r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":").concat(n.tcpport,"?transport=tcp")}))}),r}async updateRtpSenderEncodings(e,r){var n;if(r||(r=this.peerConnection.getSenders().find(u=>{var l;return((l=u.track)===null||l===void 0?void 0:l.id)===e._mediaStreamTrack.id})),!r)return C.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!br().supportSetRtpSenderParameters)return C.warn("Browser not support set rtp-sender parameters");const i={},o={};if(e instanceof Zr)switch(e._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(st("DSCP_TYPE")&&zs()){var s;const u=st("DSCP_TYPE");Ce(s=["very-low","low","medium","high"]).call(s,u)&&(o.networkPriority=u)}const c=r.getParameters(),d=(n=c.encodings)===null||n===void 0?void 0:n[0];d&&Object.assign(d,o),Object.assign(c,i),C.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(c.encodings))),await r.setParameters(c)}async applySendEncodings(e,r){try{if(!br().supportSetRtpSenderParameters||e.length!==r.length)return;for(let n=0;n<e.length;n++){const i=e[n],o=r[n];i&&o&&await this.updateRtpSenderEncodings(o,i)}}catch{C.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,r){const n=ki(e);return r.forEach((i,o)=>{const s=i._mediaStreamTrack,c=n.mediaDescriptions.find(d=>d.attributes.mid===s.kind);c&&Bd(c,i)}),Ca(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,r,n)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,e,r,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,r)=>{var n;(n=this.onSelectedLocalCandidateChanged)===null||n===void 0||n.call(this,e,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,r)=>{var n;(n=this.onSelectedRemoteCandidateChanged)===null||n===void 0||n.call(this,e,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const r=this.remoteSDP.batchSend(e).map((o,s)=>{let{id:c,mslabel:d}=o;const{kind:u}=e[s];return new De((l,T)=>{const v=setTimeout(()=>{T(new Error("Cannot receive track, id: ".concat(c)))},1e4),y=x=>{const N=Rr();if(N.name==="Safari"&&Number(N.version)===11&&x.track.id!==c&&x.streams[0].id===d){var L;const Q=x.streams[0].getTracks()[0];return(L=this.remoteSDP)===null||L===void 0||L.updateTrackLabel(u,c,x.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(v),void l({track:Q,id:c})}if(x.track.id===c)return this.peerConnection.removeEventListener("track",y),clearTimeout(v),void l({track:x.track,id:c})};this.peerConnection.addEventListener("track",y)})}),n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i),await De.all(r)}catch(r){throw new Qt(et.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const r=this.remoteSDP.getSSRC(e);return r?.[0].ssrcId}setConfiguration(e){if(br().supportPCSetConfiguration){const r=Vl.resolvePCConfiguration(e);this.peerConnection.setConfiguration(r)}}},Ke(qr.prototype,"connect",[yo],Object.getOwnPropertyDescriptor(qr.prototype,"connect"),qr.prototype),Ke(qr.prototype,"stopSending",[yo],Object.getOwnPropertyDescriptor(qr.prototype,"stopSending"),qr.prototype),Ke(qr.prototype,"receive",[yo],Object.getOwnPropertyDescriptor(qr.prototype,"receive"),qr.prototype),Ke(qr.prototype,"stopReceiving",[yo],Object.getOwnPropertyDescriptor(qr.prototype,"stopReceiving"),qr.prototype),Ke(qr.prototype,"muteRemote",[yo],Object.getOwnPropertyDescriptor(qr.prototype,"muteRemote"),qr.prototype),Ke(qr.prototype,"unmuteRemote",[yo],Object.getOwnPropertyDescriptor(qr.prototype,"unmuteRemote"),qr.prototype),Ke(qr.prototype,"muteLocal",[yo],Object.getOwnPropertyDescriptor(qr.prototype,"muteLocal"),qr.prototype),Ke(qr.prototype,"unmuteLocal",[yo],Object.getOwnPropertyDescriptor(qr.prototype,"unmuteLocal"),qr.prototype),Ke(qr.prototype,"close",[yo],Object.getOwnPropertyDescriptor(qr.prototype,"close"),qr.prototype),Ke(qr.prototype,"updateEncoderConfig",[yo],Object.getOwnPropertyDescriptor(qr.prototype,"updateEncoderConfig"),qr.prototype),Ke(qr.prototype,"updateSendParameters",[yo],Object.getOwnPropertyDescriptor(qr.prototype,"updateSendParameters"),qr.prototype),Ke(qr.prototype,"replaceTrack",[yo],Object.getOwnPropertyDescriptor(qr.prototype,"replaceTrack"),qr.prototype),Ke(qr.prototype,"getRemoteSSRC",[yo],Object.getOwnPropertyDescriptor(qr.prototype,"getRemoteSSRC"),qr.prototype),qr);function yo(t,e,r){const n=t[e];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const i=this.mutex,o=await i.lock("Locking from P2PConnection.".concat(e));try{for(var s=arguments.length,c=new Array(s),d=0;d<s;d++)c[d]=arguments[d];return await n.apply(this,c)}finally{o()}},r}const s7={name:"PlanBConnection",create:function(t){let{store:e,spec:r}=t;return new o7(r,e)}},a7={interceptLocalAudioFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!br().supportWebRTCEncodedTransform)return void C.warning("browser not support audio encoded transform");if(jp.has(t)||!t.track)return;const r={track:t.track};if(Ks()){if(!t.createEncodedStreams)return void C.warning("browser not support createEncodedStreams() API");let i=null;try{i=t.createEncodedStreams()}catch(s){return void C.error("create audio-encoded-streams error",s&&s.message)}const o=new TransformStream({transform(s,c){r.controller||(r.controller=c),t.track&&t.track.id!==r.track.id&&(C.debug("audio track changed: ".concat(r.track.id," => ").concat(t.track.id)),r.track.removeEventListener("ended",n),r.track=t.track,r.track.addEventListener("ended",n));const d=e.metadata&&e.metadata();d?function(u,l){const{chunk:T,controller:v}=l,y=Aa.METADATA;T.data=function(x,N,L){const Q=L.byteLength,J=Q+Ig+IO,at=Sg+Rg+J,Rt=new ArrayBuffer(x.byteLength+at),vt=new DataView(Rt);vt.setUint8(0,RO),vt.setUint16(1,J),vt.setUint8(3,N),vt.setUint16(4,Q);for(let kt=0;kt<Q;kt++)vt.setUint8(6+kt,L[kt]);const pt=new Uint8Array(vt.buffer);return pt.set(new Uint8Array(x),at),pt.buffer}(T.data,y,u),v.enqueue(T)}(d,{chunk:s,controller:c}):c.enqueue(s)}});i.readable.pipeThrough(o).pipeTo(i.writable)}else if(ei()){if(typeof RTCRtpScriptTransform>"u")return void C.warning("browser not support RTCRtpScriptTransform");const i=Vp(),o=new MessageChannel;await new De(c=>i.onmessage=d=>{d.data==="registered"&&c(void 0)});const s=new RTCRtpScriptTransform(i,{name:"audio-metadata-tx",port:o.port2},[o.port2]);t.transform=s,await new De(c=>i.onmessage=d=>{d.data==="started"&&c(void 0)}),o.port1.onmessage=c=>{var d;if(c.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==r.track.id)C.debug("audio track changed: ".concat(r.track.id," => ").concat(t.track.id)),r.track.removeEventListener("ended",n),r.track=t.track,r.track.addEventListener("ended",n);else if(c.data.getMetadata){const u=e.metadata&&e.metadata();u&&o.port1.postMessage({metadata:u})}},r.worker=i}function n(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",n)}const i=jp.get(t);if(i){jp.delete(t);try{var o,s;(o=i.controller)===null||o===void 0||o.terminate(),(s=i.worker)===null||s===void 0||s.terminate()}catch(c){C.warning(c&&c.message)}}}jp.set(t,r),t.track.addEventListener("ended",n)},interceptRemoteAudioFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!br().supportWebRTCEncodedTransform)return void C.warning("browser not support audio encoded transform");if(Kp.has(t))return;const r={track:t.track,onMetadata:e.onMetadata,onPts:e.onPts};if(Ks()&&!mi()){if(!t.createEncodedStreams)return void C.warning("browser not support createEncodedStreams() API");kE(wr.CHROME,87,116)||(e.enableTopn=!1);let i=null;try{i=t.createEncodedStreams()}catch(s){return void C.error("create audio-encoded-streams error",s&&s.message)}const o=new TransformStream({transform(s,c){r.controller||(r.controller=c),t.track&&t.track.id!==r.track.id&&(C.debug("audio track changed: ".concat(r.track.id," => ").concat(t.track.id)),r.track.removeEventListener("ended",n),r.track=t.track,r.track.addEventListener("ended",n)),e.enableTopn?function(d,u,l){var T;const v=Cg(new DataView(u.data));if(!v)return l.enqueue(u);const y=d.track.id;G6.set(y,d.track);const x=(T=v.tlv.find(Rt=>Rt.tag===Aa.AUDIO_LEVEL))===null||T===void 0?void 0:T.value;let N=0;typeof x=="number"&&(N=127-x);const L=Math.round(Math.pow(10,N/60)-1),{selected:Q,speaker:J}=function(Rt,vt){let pt=kd.get(Rt);if(pt||(pt=function(kt){const $t=new AO;return kd.set(kt,$t),ss||(ss=new B6(st("TOPN_SILENCE_THRESHOLD")||500),ss.on("ActiveSpeakerChanged",se=>{se!=null&&(Gp=se)})),ss.addSpeakers([$t]),$t}(Rt)),kd.size<=bO)return{selected:!0,speaker:pt};if(!ss)throw new Error("no active speaker detector");return ss.levelChanged(pt.id,vt),Ec=ss.loudest.map(kt=>kt.id),Gp&&!Ce(Ec).call(Ec,Gp)&&Ec.length>=bO&&Ec.pop(),{selected:Ce(Ec).call(Ec,pt.id)||pt.id===Gp,speaker:pt}}(d,L),at=function(Rt,vt,pt){const kt=as.get(Rt)||new F6(Rt,vt);return kt.score=pt,as.set(Rt,kt),function($t){if(Hp.set($t,!0),!Wp)return void(Wp=Date.now());const se=Date.now();se-Wp>1e3&&(Hp.get($t)?Hp.set($t,!1):(OO($t),Hp.delete($t)),Wp=se)}(Rt),kt}(y,d.track,J.energyScore);at.addSample(Q),at.active&&(u.data=v.frame.buffer,l.enqueue(u))}(t,s,c):e.enableMetadata||e.enablePts?function(d,u,l,T){const v=new DataView(d.data),y=v.getUint8(0);let x;if(128&y&&y!==71){const Q=function(J){if(J.byteLength<=0)return[];const at=[];let Rt=0;for(;Rt<J.byteLength;){const pt=(128&J.getUint8(Rt))>>7,kt=127&J.getUint8(Rt);if(!(pt&&Rt+4<=J.byteLength)){Rt++;break}{const $t=J.getUint32(Rt,!1),se=(16776192&$t)>>10,Te=1023&$t;at.push({pt:kt,ts_offset:se,length:Te,data:new Uint8Array}),Rt+=4}}let vt=J.byteLength-Rt;for(const pt of at){if(pt.length>vt)return console.warn("Broken red payload"),[];pt.length>0&&(pt.data=new Uint8Array(J.buffer,J.byteOffset+Rt,pt.length),Rt+=pt.length,vt-=pt.length)}if(vt>0){const pt={pt:at.length>0?at[at.length-1].pt:0,ts_offset:0,length:vt,data:new Uint8Array(J.buffer,J.byteOffset+Rt,vt)};at.push(pt)}return at}(v);if(Q.length>0){const J=function(at){let Rt=0;for(let kt=0;kt<at.length;kt++)Rt+=kt<at.length-1?4:1,Rt+=at[kt].length;const vt=new Uint8Array(Rt);let pt=0;for(let kt=0;kt<at.length;kt++)if(kt<at.length-1){const $t=(2147483648|(127&at[kt].pt)<<24|(262143&at[kt].ts_offset)<<10|1023&at[kt].length)>>>0;vt[pt++]=$t>>24&255,vt[pt++]=$t>>16&255,vt[pt++]=$t>>8&255,vt[pt++]=255&$t}else vt[pt++]=127&at[kt].pt;for(const kt of at)vt.set(kt.data,pt),pt+=kt.length;return vt}(Q.map(at=>{const Rt=new Uint8Array(at.length);Rt.set(at.data);const vt=Cg(new DataView(Rt.buffer));return vt!=null&&vt.frame&&(at.data=vt?.frame),x=vt,at}));d.data=J.buffer}}else x=Cg(v),x&&(d.data=x.frame.buffer);if(u.enqueue(d),!x)return;const N=x.tlv.find(Q=>Q.tag===Aa.METADATA);N&&l&&N.value instanceof Uint8Array&&l(N.value);const L=x.tlv.find(Q=>Q.tag===Aa.AUDIO_64_BIT_PTS);L&&T&&L.value instanceof Uint8Array&&L.value.length==8&&T(new DataView(L.value.buffer).getBigUint64(0,!0))}(s,c,e.onMetadata,e.onPts):c.enqueue(s)}});i.readable.pipeThrough(o).pipeTo(i.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void C.warning("browser not support RTCRtpScriptTransform");const i=Vp(),o=new MessageChannel;await new De(c=>i.onmessage=d=>{d.data==="registered"&&c(void 0)});const s=new RTCRtpScriptTransform(i,{name:"audio-metadata-rx",port:o.port2},[o.port2]);t.transform=s,await new De(c=>i.onmessage=d=>{d.data==="started"&&c(void 0)}),o.port1.onmessage=c=>{var d;c.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==r.track.id?(C.debug("audio track changed: ".concat(r.track.id," => ").concat(t.track.id)),r.track.removeEventListener("ended",n),r.track=t.track,r.track.addEventListener("ended",n)):c.data.metadata&&r.onMetadata?r.onMetadata(c.data.metadata):c.data.pts&&r.onPts&&r.onPts(c.data.pts)},r.worker=i}function n(){t.track.removeEventListener("ended",n),function(i){const o=Kp.get(i);if(o){(function(d){const u=kd.get(d);u&&(kd.delete(d),ss&&(ss.removeSpeakers([u]),kd.size===0&&(ss.destroy(),ss=null)))})(i),OO(i.track.id),Kp.delete(i);try{var s,c;(s=o.controller)===null||s===void 0||s.terminate(),(c=o.worker)===null||c===void 0||c.terminate()}catch(d){C.warning(d&&d.message)}}}(t)}Kp.set(t,r),t.track.addEventListener("ended",n)},interceptLocalVideoFrame:async function(t,e){if(!br().supportWebRTCEncodedTransform)return void C.warning("browser not support video encoded transform");if(zp.has(t)||!t.track)return;const r={track:t.track};if(Ks()){if(!t.createEncodedStreams)return void C.warning("browser not support createEncodedStreams() API");let i=null;try{i=t.createEncodedStreams()}catch(c){return void C.error("create video-encoded-streams error",c&&c.message)}const o=[];e.on("sei-to-send",c=>{o.push(c)});const s=new TransformStream({transform(c,d){r.controller||(r.controller=d),t.track&&t.track.id!==r.track.id&&(C.debug("video track changed: ".concat(r.track.id," => ").concat(t.track.id)),r.track.removeEventListener("ended",n),r.track=t.track,r.track.addEventListener("ended",n));const u=PO(new Uint8Array(c.data)),l=o.shift();if(l){const T=function(v,y,x){switch(x){case wg:return function(N,L){const Q=NO(L),J=Q.length,at=Math.floor(J/255),Rt=J%255,vt=new Uint8Array(6+at+1+J+N.byteLength);vt[0]=0,vt[1]=0,vt[2]=0,vt[3]=1,vt[4]=6,vt[5]=101;let pt=0;for(;pt<at;)vt[6+pt]=255,pt++;return vt[6+pt]=Rt,pt++,vt.set(Q,6+pt),vt.set(new Uint8Array(N),6+pt+J),vt.buffer}(v,y);case Ng:return function(N,L){const Q=NO(L),J=Q.length,at=Math.floor(J/255),Rt=J%255,vt=new Uint8Array(7+at+1+J+1+N.byteLength);vt[0]=0,vt[1]=0,vt[2]=0,vt[3]=1,vt[4]=78,vt[5]=1,vt[6]=101;let pt=0;for(;pt<at;)vt[7+pt]=255,pt++;return vt[7+pt]=Rt,pt++,vt.set(Q,7+pt),pt+=J,vt[7+pt]=128,pt++,vt.set(new Uint8Array(N),7+pt),vt.buffer}(v,y);default:return null}}(c.data,l,u);T&&(c.data=T)}d.enqueue(c)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else{if(!ei())return;{if(typeof RTCRtpScriptTransform>"u")return void C.warning("browser not support RTCRtpScriptTransform");const i=Vp(),o=new MessageChannel;await new De(c=>i.onmessage=d=>{d.data==="registered"&&c(void 0)});const s=new RTCRtpScriptTransform(i,{name:"sei-tx",port:o.port2},[o.port2]);t.transform=s,await new De(c=>i.onmessage=d=>{d.data==="started"&&c(void 0)}),e.on("sei-to-send",c=>{o.port1.postMessage({sei:c})}),o.port1.onmessage=c=>{var d;c.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==r.track.id&&(C.debug("video track changed: ".concat(r.track.id," => ").concat(t.track.id)),r.track.removeEventListener("ended",n),r.track=t.track,r.track.addEventListener("ended",n))},r.worker=i}}function n(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",n)}const i=zp.get(t);if(i){zp.delete(t);try{var o,s;(o=i.controller)===null||o===void 0||o.terminate(),(s=i.worker)===null||s===void 0||s.terminate()}catch(c){C.warning(c&&c.message)}}}zp.set(t,r),t.track.addEventListener("ended",n)},interceptRemoteVideoFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!br().supportWebRTCEncodedTransform)return void C.warning("browser not support video encoded transform");if(!t.track)return;if(nl.has(t)){const i=nl.get(t);return void(i&&(i.onSei=e.onSei))}const r={track:t.track,onSei:e.onSei};if(Ks()){if(!t.createEncodedStreams)return void C.warning("browser not support createEncodedStreams() API");let i=null;try{i=t.createEncodedStreams()}catch(s){return void C.error("create video-encoded-streams error",s&&s.message)}const o=new TransformStream({transform(s,c){r.controller||(r.controller=c),t.track&&t.track.id!==r.track.id&&(C.debug("video track changed: ".concat(r.track.id," => ").concat(t.track.id)),r.track.removeEventListener("ended",n),r.track=t.track,r.track.addEventListener("ended",n));const d=function(u,l){switch(l){case wg:return function(T){const v=new DataView(T.data);let y=0;for(;y+4<T.data.byteLength;){if(v.getUint8(y+0)===0&&v.getUint8(y+1)===0&&v.getUint8(y+2)===0&&v.getUint8(y+3)===1&&v.getUint8(y+4)===6){let x=y+6,N=0,L=0;for(;(L=v.getUint8(x++))===255;)N+=255;N+=L;const Q=wO(T.data,x,N);return new Uint8Array(Q)}y++}return null}(u);case Ng:return function(T){const v=new DataView(T.data);let y=0;for(;y+5<T.data.byteLength;){if(v.getUint8(y+0)===0&&v.getUint8(y+1)===0&&v.getUint8(y+2)===0&&v.getUint8(y+3)===1&&v.getUint8(y+4)===78&&v.getUint8(y+5)===1&&v.getUint8(y+6)===101){let x=y+7,N=0,L=0;for(;(L=v.getUint8(x++))===255;)N+=255;N+=L;const Q=wO(T.data,x,N);return new Uint8Array(Q)}y++}return null}(u);default:return null}}(s,PO(new Uint8Array(s.data)));d&&r.onSei&&r.onSei(d),c.enqueue(s)}});i.readable.pipeThrough(o).pipeTo(i.writable)}else if(ei()){if(typeof RTCRtpScriptTransform>"u")return void C.warning("browser not support RTCRtpScriptTransform");const i=Vp(),o=new MessageChannel;await new De(c=>i.onmessage=d=>{d.data==="registered"&&c(void 0)});const s=new RTCRtpScriptTransform(i,{name:"sei-rx",port:o.port2},[o.port2]);t.transform=s,await new De(c=>i.onmessage=d=>{d.data==="started"&&c(void 0)}),o.port1.onmessage=c=>{var d;c.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==r.track.id?(C.debug("video track changed: ".concat(r.track.id," => ").concat(t.track.id)),r.track.removeEventListener("ended",n),r.track=t.track,r.track.addEventListener("ended",n)):c.data.sei&&r.onSei&&r.onSei(c.data.sei)},r.worker=i}function n(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",n)}(function(i){const o=nl.get(i);if(o){nl.delete(i);try{var s,c;(s=o.controller)===null||s===void 0||s.terminate(),(c=o.worker)===null||c===void 0||c.terminate()}catch(d){C.warning(d&&d.message)}}})(t)}nl.set(t,r),t.track.addEventListener("ended",n)}},c7={name:"InterceptFrame",create:()=>a7};tg(),Br("PROCESS_ID","process-".concat(zr(8,""),"-").concat(zr(4,""),"-").concat(zr(4,""),"-").concat(zr(4,""),"-").concat(zr(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void C.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),r=Date.now();C.debug("Loading global parameters from cache",e),Object.keys(e).forEach(n=>{if(Object.prototype.hasOwnProperty.call(rn,n)){const{value:i,expires:o}=e[n];if(o&&o<=r)return;os[n]=i,rn[n]=i}})}catch(e){C.error("Error loading mutableParamsCache: ".concat(t),e.message)}}(),Array.isArray(os.AREAS)&&os.AREAS.length>0&&Xg(os.AREAS,!0);const wD=(t,e,r)=>{C.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(e))),Br(t,e,r)};La(PW,!1),La(LW,!1),La(p8,!1),La(KW,!1),La(OW,!1),La(n7,!1),La(s7,!1),La(c7,!1);const On=function(t){const e=new pn,r=t,n={getListeners:e.getListeners.bind(e),on:(i,o)=>(function(s,c){s===Os.SECURITY_POLICY_VIOLATION&&dP(c,!0)}(i,o),e.on.bind(e)(i,o)),addListener:e.addListener.bind(e),once:e.once.bind(e),off:e.off.bind(e),removeAllListeners:e.removeAllListeners.bind(e),emit:e.emit.bind(e),safeEmit:e.safeEmit.bind(e)};return cP(cP({},r),n)}({__TRACK_LIST__:Id,VERSION:po,BUILD:ng,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:wD,getParameter:st,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let e=new RTCPeerConnection;const r=await async function(n){let i;return br().supportUnifiedPlan?(n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"}),i=(await n.createOffer()).sdp):i=(await n.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,i}(e);if(!r)return t;e.close(),e=null,t=function(n){const i={video:[],audio:[]};return n.match(/ VP8/i)&&i.video.push("VP8"),n.match(/ VP9/i)&&i.video.push("VP9"),n.match(/ AV1/i)&&i.video.push("AV1"),n.match(/ H264/i)&&i.video.push("H264"),n.match(/ H265/i)&&i.video.push("H265"),n.match(/ opus/i)&&i.audio.push("OPUS"),n.match(/ PCMU/i)&&i.audio.push("PCMU"),n.match(/ PCMA/i)&&i.audio.push("PCMA"),n.match(/ G722/i)&&i.audio.push("G722"),i}(r)}catch(e){throw new Bt(et.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return t},checkSystemRequirements:function(){const t=qe.reportApiInvoke(null,{name:vn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:cn.TRACER});let e=!1;try{const o=window.RTCPeerConnection,s=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,c=window.WebSocket;e=!!(o&&s&&c),e&&jE()&&w0(75)&&new o().close()}catch(o){return C.error("check system requirement failed: ",o),!1}let r=!1;const n=Rr();n.name===wr.CHROME&&Number(n.version)>=58&&(rs.engine.name!=="WebKit"||function(){const o=Rr();if(yp()){if(o.os===Vn.MAC_OS)return!0;if(o.os===Vn.IOS){const s=rs.os.version&&rs.os.version.split(".");if(s&&Number(s[0])===14&&s[1]&&Number(s[1])>=3||s&&Number(s[0])>14)return!0}}return!1}())&&(r=!0),(n.name===wr.FIREFOX&&Number(n.version)>=56||n.name===wr.OPERA&&Number(n.version)>=45||n.name===wr.SAFARI&&Number(n.version)>=11||n.name==="WebKit"&&(mi()||ko())&&n.osVersion&&Number(n.osVersion.split(".")[0])>=11||M0()||Rr().name===wr.QQ)&&(r=!0),C.debug("checkSystemRequirements, api:",e,"browser",r);const i=e&&r;return t.onSuccess(i),i},getDevices:function(t){return oo.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return oo.getRecordingDevices(t)},getCameras:function(t){return oo.getCamerasDevices(t)},getElectronScreenSources:wA,getPlaybackDevices:function(t){return oo.getSpeakers(t)},createClient:function(){var t;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const r=zr(5,"client-"),n=qe.reportApiInvoke(null,{id:r,name:vn.CREATE_CLIENT,options:[e],tag:cn.TRACER});try{(function(i){Mn(i.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Mn(i.mode,"config.mode",["rtc","live","p2p"]),i.audioCodec!==void 0&&Mn(i.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),i.proxyServer!==void 0&&qn(i.proxyServer,"config.proxyServer",1,1e4),i.turnServer!==void 0&&H0(i.turnServer),i.httpRetryConfig!==void 0&&G0(i.httpRetryConfig),i.websocketRetryConfig!==void 0&&G0(i.websocketRetryConfig)})(e)}catch(i){throw n.onError(i),i}return(D0(16,0)||UE(16,0,!0))&&(e.codec==="vp9"&&(e.codec="vp8",C.debug("browser not support vp9, force use vp8")),Br("UNSUPPORTED_VIDEO_CODEC",["vp9"])),e.audioCodec===void 0&&(e.audioCodec="opus"),n.onSuccess(),new f8(Go(Go({forceWaitGatewayResponse:!0},e),{},{role:Ce(t=["rtc","p2p"]).call(t,e.mode)?"host":e.role||"audience"}),r)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=st("CAMERA_CAPTURE_CONFIG"),r=zr(8,"track-cam-"),n=qe.reportApiInvoke(null,{id:r,tag:cn.TRACER,name:vn.CREATE_CAM_VIDEO_TRACK,options:[Xr({},t),e]});e&&(t.encoderConfig=e);const i=Up(t);let o=null;C.info("start create camera video track with config",JSON.stringify(t),"trackId",r);try{o=(await io({video:i},r)).getVideoTracks()[0]||null}catch(c){throw n.onError(c),c}if(!o){const c=new Qt(et.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(c),c.throw(C)}if(t.optimizationMode&&yg(r,o,t,Uo(t.encoderConfig)),st("USE_STANDARD_BITRATE_DEFAULT")){const c=Uo(t.encoderConfig);t.encoderConfig=c,delete c.bitrateMax,delete c.bitrateMin}const s=new xp(o,t,i,t.scalabiltyMode?Dp(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,r);return n.onSuccess(s.getTrackId()),C.info("create camera video success, trackId:",r),s},createCustomVideoTrack:function(t){const e=zr(8,"track-cus-"),r=qe.reportApiInvoke(null,{id:e,tag:cn.TRACER,name:vn.CREATE_CUSTOM_VIDEO_TRACK,options:[t]});st("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin);const n=new Zr(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?Dp(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,e,[Wr.CUSTOM_TRACK]);return r.onSuccess(n.getTrackId()),C.info("create custom video track success with config",t,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const r=typeof e=="object"?function(v){return jA(v)}(e):void 0;r&&(e="auto");const n=zr(8,"track-scr-v-"),i=qe.reportApiInvoke(null,{id:n,tag:cn.TRACER,name:vn.CREATE_SCREEN_VIDEO_TRACK,options:[Xr({},t),e]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const o=function(v){const y={};v.screenSourceType&&(y.mediaSource=v.screenSourceType),v.extensionId&&Ks()&&(y.extensionId=v.extensionId);const{displaySurface:x,selfBrowserSurface:N,surfaceSwitching:L,systemAudio:Q,preferCurrentTab:J}=v;(md(107)||LE(107)||xE(93))&&(x&&(Mn(x,"displaySurface",["browser","window","monitor"]),y.displaySurface=x),N?(Mn(N,"selfBrowserSurface",["exclude","include"]),y.selfBrowserSurface=N):y.selfBrowserSurface="include",L&&(Mn(L,"surfaceSwitching",["exclude","include"]),y.surfaceSwitching=L)),(md(105)||LE(105)||xE(91))&&Q&&(Mn(Q,"systemAudio",["exclude","include"]),y.systemAudio=Q),(md(94)||LE(94)||xE(80))&&J&&(y.preferCurrentTab=!0),v.electronScreenSourceId&&(y.sourceId=v.electronScreenSourceId);const at=v.encoderConfig?dg(v.encoderConfig):null;return y.mandatory={chromeMediaSource:"desktop",maxWidth:at?at.width:void 0,maxHeight:at?at.height:void 0},at&&(at.frameRate&&(typeof at.frameRate=="number"?(y.mandatory.maxFrameRate=at.frameRate,y.mandatory.minFrameRate=at.frameRate):(y.mandatory.maxFrameRate=at.frameRate.max||at.frameRate.ideal||at.frameRate.exact||void 0,y.mandatory.minFrameRate=at.frameRate.min||at.frameRate.ideal||at.frameRate.exact||void 0),y.frameRate=at.frameRate),at.width&&(y.width=at.width),at.height&&(y.height=at.height)),y}(t);let s=null,c=null;const d=br();if(!d.supportShareAudio&&e==="enable"){const v=new Qt(et.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return i.onError(v),v.throw(C)}C.info("start create screen video track with config",t,"withAudio",e,"trackId",n);const u=d.supportShareAudio&&e!=="disable";try{const v=await io({screen:o,screenAudio:u?r||!0:void 0},n);s=v.getVideoTracks()[0]||null,c=v.getAudioTracks()[0]||null}catch(v){throw i.onError(v),v}if(!s){const v=new Qt(et.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(v),v.throw(C)}if(!c&&e==="enable"){s&&s.stop();const v=new Qt(et.SHARE_AUDIO_NOT_ALLOWED);return i.onError(v),v.throw(C)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(yg(n,s,t,t.encoderConfig&&dg(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const l=new Zr(s,t.encoderConfig?dg(t.encoderConfig):{},t.scalabiltyMode?Dp(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,n,[Wr.SCREEN_TRACK]);if(!c)return i.onSuccess(l.getTrackId()),C.info("create screen video track success","video:",l.getTrackId()),l;const T=new Tn(c,void 0,zr(8,"track-scr-a-"),!1);return i.onSuccess([l.getTrackId(),T.getTrackId()]),C.info("create screen video track success","video:",l.getTrackId(),"audio:",T.getTrackId()),[l,T]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=st("CAMERA_CAPTURE_CONFIG"),n=zr(8,"track-mic-"),i=zr(8,"track-cam-"),o=qe.reportApiInvoke(null,{id:"".concat(n,"-").concat(i),tag:cn.TRACER,name:vn.CREATE_MIC_AND_CAM_TRACKS,options:[t,e,r]});r&&(e.encoderConfig=r);const s=Up(e),c=BA(t);let d=null,u=null;C.info("start create camera video track(".concat(i,") and microphone audio track(").concat(n,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(e)));try{const v=await io({audio:c,video:s},"".concat(n,"-").concat(i));d=v.getAudioTracks()[0],u=v.getVideoTracks()[0]}catch(v){throw o.onError(v),v}if(!d||!u){const v=new Qt(et.UNEXPECTED_ERROR,"can not find tracks in media stream");return o.onError(v),v.throw(C)}if(e.optimizationMode&&yg(i,u,e,Uo(e.encoderConfig)),st("USE_STANDARD_BITRATE_DEFAULT")){const v=Uo(e.encoderConfig);e.encoderConfig=v,delete v.bitrateMax,delete v.bitrateMin}const l=new rl(d,t,c,n),T=new xp(u,e,s,e.scalabiltyMode?Dp(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return o.onSuccess([l.getTrackId(),T.getTrackId()]),C.info("create camera video track(".concat(i,") and microphone audio track(").concat(n,") success")),[l,T]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=zr(8,"track-mic-"),r=qe.reportApiInvoke(null,{id:e,tag:cn.TRACER,name:vn.CREATE_MIC_AUDIO_TRACK,options:[t]}),n=BA(t);let i=null;C.info("start create microphone audio track with config",JSON.stringify(t),"trackId",e);try{i=(await io({audio:n},e)).getAudioTracks()[0]||null}catch(s){throw r.onError(s),s}if(!i){const s=new Qt(et.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(s),s.throw(C)}const o=new rl(i,t,n,e);return r.onSuccess(o.getTrackId()),C.info("create microphone audio track success, trackId:",e),o},createCustomAudioTrack:function(t){const e=zr(8,"track-cus-"),r=qe.reportApiInvoke(null,{id:e,tag:cn.TRACER,name:vn.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),n=new Tn(t.mediaStreamTrack,t.encoderConfig?kp(t.encoderConfig):{},e,!1);return C.info("create custom audio track success with config",t,"trackId",n.getTrackId()),r.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(t){var e;const{cacheOnlineFile:r,encoderConfig:n}=t;let{source:i}=t;const o={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?(e=File.name)!==null&&e!==void 0?e:"File":i,cacheOnlineFile:r,encoderConfig:n},s=zr(8,"track-buf-"),c=qe.reportApiInvoke(null,{id:s,tag:cn.TRACER,name:vn.CREATE_BUFFER_AUDIO_TRACK,options:[o]});if(st("DISABLE_WEBAUDIO"))throw new Qt(et.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");C.info("start create buffer source audio track with config",JSON.stringify(o),"trackId",s);const d=i;if(!(i instanceof AudioBuffer))try{i=await async function(T,v){let y=null;if(typeof T=="string"){const N=Ab.get(T);if(N)return C.debug("use cached audio resource: ",T),N;try{y=(await is(()=>bi.get(T,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(L){throw new Qt(et.FETCH_AUDIO_FILE_FAILED,L.toString())}}else y=await new De((L,Q)=>{const J=new FileReader;J.onload=at=>{at.target?L(at.target.result):Q(new Qt(et.READ_LOCAL_AUDIO_FILE_ERROR))},J.onerror=()=>{Q(new Qt(et.READ_LOCAL_AUDIO_FILE_ERROR))},J.readAsArrayBuffer(T)});const x=await function(N){const L=wd();return new De((Q,J)=>{L.decodeAudioData(N,at=>{Q(at)},at=>{J(new Qt(et.DECODE_AUDIO_FILE_FAILED,at.toString()))})})}(y);return typeof T=="string"&&v&&Ab.set(T,x),x}(i,r)}catch(T){return c.onError(T),T.throw(C)}const u=new M6(i),l=new L6(d,u,n?kp(n):{},s);return C.info("create buffer source audio track success, trackId:",s),c.onSuccess(l.getTrackId()),l},setAppType:function(t){if(C.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw C.debug("Invalid appType"),new Bt(et.INVALID_PARAMS,"invalid app type",t);Br("APP_TYPE",Math.floor(t))},setLogLevel:function(t){C.setLogLevel(t)},enableLogUpload:function(){st("USE_NEW_LOG")?Br("UPLOAD_LOG",!0):C.enableLogUpload()},disableLogUpload:function(){st("USE_NEW_LOG")?Br("UPLOAD_LOG",!1):C.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new ww},checkAudioTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=qe.reportApiInvoke(null,{tag:cn.TRACER,name:vn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof Tn||t instanceof Dd)){const d=new Bt(et.INVALID_TRACK,"the parameter is not a audio track");return r.onError(d),d.throw()}e&&e<1e3&&(e=1e3);const n=t instanceof Tn?t.getTrackLabel():"remote_track",i=t.getVolumeLevel();let o=i,s=i;const c=Date.now();return new De(d=>{const u=setInterval(()=>{const l=t.getVolumeLevel();o=l>o?l:o,s=l<s?l:s;const T=o-s>1e-4,v=Date.now()-c;if(T||v>e){clearInterval(u);const y=T,x={duration:v,deviceLabel:n,maxVolumeLevel:o,result:y};C.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(x))),r.onSuccess(x),d(y)}},200)})},checkVideoTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=qe.reportApiInvoke(null,{tag:cn.TRACER,name:vn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof Zr||t instanceof Pd)){const T=new Bt(et.INVALID_TRACK,"the parameter is not a video track");return r.onError(T),T.throw()}e&&e<1e3&&(e=1e3);const n=t instanceof Zr?t.getTrackLabel():"remote_track",i=t.getMediaStreamTrack(!0),o=document.createElement("video");o.style.width="1px",o.style.height="1px",o.setAttribute("muted",""),o.muted=!0,o.setAttribute("playsinline",""),o.controls=!1,(ei()||yp())&&(o.style.opacity="0.01",o.style.position="fixed",o.style.left="0",o.style.top="0",document.body.appendChild(o)),o.srcObject=new MediaStream([i]),o.play();const s=document.createElement("canvas");s.width=160,s.height=120;let c=0,d=0;try{const T=Date.now();c=await function(v,y,x,N){let L,Q=0,J=null;return new De((at,Rt)=>{function vt(){Q>N&&L&&(L(),at(Q));const pt=x.getContext("2d");if(!pt){const se=new Bt(et.UNEXPECTED_ERROR,"can not get canvas 2d context.");return C.error(se.toString()),void Rt(se)}pt.drawImage(v,0,0,160,120);const kt=pt.getImageData(0,0,x.width,x.height),$t=Math.floor(kt.data.length/3);if(J){for(let se=0;se<$t;se+=3)if(kt.data[se]!==J[se])return Q+=1,void(J=kt.data);J=kt.data}else J=kt.data}setTimeout(()=>{L&&(L(),at(Q))},y),L=fg(()=>{vt()},30)})}(o,e,s,4),d=Date.now()-T}catch(T){throw r.onError(T),T}t8===wr.SAFARI&&(o.pause(),o.remove()),o.srcObject=null;const u=c>4,l={duration:d,changedPicNum:c,deviceLabel:n,result:u};return C.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(l))),r.onSuccess(l),u},setArea:Xg,audioElementPlayCenter:Oi,resumeAudioContext:function(){Oi.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){_8.processExternalMediaAEC(t)},registerExtensions:function(t){const e=st("PLUGIN_INFO")||[];t.forEach(r=>{"name"in r&&!Ce(e).call(e,r.name)&&e.push(r.name);const n=r;n.__registered__=!0,n.logger.hookLog=C.extLog,n.reporter.hookApiInvoke=qe.extApiInvoke,n.parameters&&Object.keys(n.parameters).forEach(i=>{n.parameters[i]=st(i)})}),wD("PLUGIN_INFO",e)},ChannelMediaRelayError:Md,ChannelMediaRelayEvent:Xs,ChannelMediaRelayState:Mi,RemoteStreamFallbackType:b6,RemoteStreamType:A6,ConnectionDisconnectedReason:Lr,AudienceLatencyLevelType:n6,AREAS:Dr,preload:async function(t,e,r,n){return $w(t,e,r,n)}});return Object.defineProperties(On,{onAudioAutoplayFailed:{get:()=>so.onAudioAutoplayFailed,set:t=>{so.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>so.onAutoplayFailed,set:t=>{so.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>On._onSecurityPolicyViolation,set(t){On._onSecurityPolicyViolation=t,dP(t)}},__CLIENT_LIST__:{get:()=>st("SHOW_GLOBAL_CLIENT_LIST")?gc:[]}}),oo.on(fc.CAMERA_DEVICE_CHANGED,t=>{C.info("camera device changed",JSON.stringify(t)),On.onCameraChanged&&On.onCameraChanged(t),On.safeEmit(Os.CAMERA_CHANGED,t)}),oo.on(fc.RECORDING_DEVICE_CHANGED,t=>{C.info("microphone device changed",JSON.stringify(t)),On.onMicrophoneChanged&&On.onMicrophoneChanged(t),On.safeEmit(Os.MICROPHONE_CHANGED,t)}),oo.on(fc.PLAYOUT_DEVICE_CHANGED,t=>{C.debug("playout device changed",JSON.stringify(t)),On.onPlaybackDeviceChanged&&On.onPlaybackDeviceChanged(t),On.safeEmit(Os.PLAYBACK_DEVICE_CHANGED,t)}),Oi.onAutoplayFailed=()=>{C.info("detect audio element autoplay failed"),so.onAudioAutoplayFailed&&so.onAudioAutoplayFailed()},Fr.on("autoplay-failed",()=>{C.info("detect webaudio autoplay failed"),so.onAudioAutoplayFailed&&so.onAudioAutoplayFailed(),On.safeEmit(Os.AUTOPLAY_FAILED)}),Fr.on(Jn.STATE_CHANGE,(t,e)=>{C.info("audio context state changed: ".concat(e," => ").concat(t)),On.onAudioContextStateChanged&&On.onAudioContextStateChanged(t,e),On.safeEmit(Os.AUDIO_CONTEXT_STATE_CHANGED,t,e)}),In.on(Ed.NETWORK_STATE_CHANGE,(t,e)=>{C.info("[network-indicator] network state changed, ".concat(e," => ").concat(t))}),window&&(window.__ARTC__=On),On})})(LD);var m7=LD.exports;const Yf=kD(m7);var xD={exports:{}};(function(Ka,Bn){(function(Yi,xn){Ka.exports=xn()})(self,function(){return function(){var Yi={4537:function(O){O.exports=function(H,a){for(var f=new Array(arguments.length-1),h=0,g=2,_=!0;g<arguments.length;)f[h++]=arguments[g++];return new Promise(function(E,m){f[h]=function(p){if(_)if(_=!1,p)m(p);else{for(var A=new Array(arguments.length-1),R=0;R<A.length;)A[R++]=arguments[R];E.apply(null,A)}};try{H.apply(a||null,f)}catch(p){_&&(_=!1,m(p))}})}},7419:function(O,H){var a=H;a.length=function(E){var m=E.length;if(!m)return 0;for(var p=0;--m%4>1&&E.charAt(m)==="=";)++p;return Math.ceil(3*E.length)/4-p};for(var f=new Array(64),h=new Array(123),g=0;g<64;)h[f[g]=g<26?g+65:g<52?g+71:g<62?g-4:g-59|43]=g++;a.encode=function(E,m,p){for(var A,R=null,D=[],P=0,k=0;m<p;){var b=E[m++];switch(k){case 0:D[P++]=f[b>>2],A=(3&b)<<4,k=1;break;case 1:D[P++]=f[A|b>>4],A=(15&b)<<2,k=2;break;case 2:D[P++]=f[A|b>>6],D[P++]=f[63&b],k=0}P>8191&&((R||(R=[])).push(String.fromCharCode.apply(String,D)),P=0)}return k&&(D[P++]=f[A],D[P++]=61,k===1&&(D[P++]=61)),R?(P&&R.push(String.fromCharCode.apply(String,D.slice(0,P))),R.join("")):String.fromCharCode.apply(String,D.slice(0,P))};var _="invalid encoding";a.decode=function(E,m,p){for(var A,R=p,D=0,P=0;P<E.length;){var k=E.charCodeAt(P++);if(k===61&&D>1)break;if((k=h[k])===void 0)throw Error(_);switch(D){case 0:A=k,D=1;break;case 1:m[p++]=A<<2|(48&k)>>4,A=k,D=2;break;case 2:m[p++]=(15&A)<<4|(60&k)>>2,A=k,D=3;break;case 3:m[p++]=(3&A)<<6|k,D=0}}if(D===1)throw Error(_);return p-R},a.test=function(E){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(E)}},5124:function(O){function H(a,f){typeof a=="string"&&(f=a,a=void 0);var h=[];function g(E){if(typeof E!="string"){var m=_();if(H.verbose&&console.log("codegen: "+m),m="return "+m,E){for(var p=Object.keys(E),A=new Array(p.length+1),R=new Array(p.length),D=0;D<p.length;)A[D]=p[D],R[D]=E[p[D++]];return A[D]=m,Function.apply(null,A).apply(null,R)}return Function(m)()}for(var P=new Array(arguments.length-1),k=0;k<P.length;)P[k]=arguments[++k];if(k=0,E=E.replace(/%([%dfijs])/g,function(b,j){var z=P[k++];switch(j){case"d":case"f":return String(Number(z));case"i":return String(Math.floor(z));case"j":return JSON.stringify(z);case"s":return String(z)}return"%"}),k!==P.length)throw Error("parameter count mismatch");return h.push(E),g}function _(E){return"function "+(E||f||"")+"("+(a&&a.join(",")||"")+`){
  `+h.join(`
  `)+`
}`}return g.toString=_,g}O.exports=H,H.verbose=!1},9211:function(O){function H(){this._listeners={}}O.exports=H,H.prototype.on=function(a,f,h){return(this._listeners[a]||(this._listeners[a]=[])).push({fn:f,ctx:h||this}),this},H.prototype.off=function(a,f){if(a===void 0)this._listeners={};else if(f===void 0)this._listeners[a]=[];else for(var h=this._listeners[a],g=0;g<h.length;)h[g].fn===f?h.splice(g,1):++g;return this},H.prototype.emit=function(a){var f=this._listeners[a];if(f){for(var h=[],g=1;g<arguments.length;)h.push(arguments[g++]);for(g=0;g<f.length;)f[g].fn.apply(f[g++].ctx,h)}return this}},9054:function(O,H,a){O.exports=g;var f=a(4537),h=a(7199)("fs");function g(_,E,m){return typeof E=="function"?(m=E,E={}):E||(E={}),m?!E.xhr&&h&&h.readFile?h.readFile(_,function(p,A){return p&&typeof XMLHttpRequest<"u"?g.xhr(_,E,m):p?m(p):m(null,E.binary?A:A.toString("utf8"))}):g.xhr(_,E,m):f(g,this,_,E)}g.xhr=function(_,E,m){var p=new XMLHttpRequest;p.onreadystatechange=function(){if(p.readyState===4){if(p.status!==0&&p.status!==200)return m(Error("status "+p.status));if(E.binary){var A=p.response;if(!A){A=[];for(var R=0;R<p.responseText.length;++R)A.push(255&p.responseText.charCodeAt(R))}return m(null,typeof Uint8Array<"u"?new Uint8Array(A):A)}return m(null,p.responseText)}},E.binary&&("overrideMimeType"in p&&p.overrideMimeType("text/plain; charset=x-user-defined"),p.responseType="arraybuffer"),p.open("GET",_),p.send()}},945:function(O){function H(_){return typeof Float32Array<"u"?function(){var E=new Float32Array([-0]),m=new Uint8Array(E.buffer),p=m[3]===128;function A(k,b,j){E[0]=k,b[j]=m[0],b[j+1]=m[1],b[j+2]=m[2],b[j+3]=m[3]}function R(k,b,j){E[0]=k,b[j]=m[3],b[j+1]=m[2],b[j+2]=m[1],b[j+3]=m[0]}function D(k,b){return m[0]=k[b],m[1]=k[b+1],m[2]=k[b+2],m[3]=k[b+3],E[0]}function P(k,b){return m[3]=k[b],m[2]=k[b+1],m[1]=k[b+2],m[0]=k[b+3],E[0]}_.writeFloatLE=p?A:R,_.writeFloatBE=p?R:A,_.readFloatLE=p?D:P,_.readFloatBE=p?P:D}():function(){function E(p,A,R,D){var P=A<0?1:0;if(P&&(A=-A),A===0)p(1/A>0?0:2147483648,R,D);else if(isNaN(A))p(2143289344,R,D);else if(A>34028234663852886e22)p((P<<31|2139095040)>>>0,R,D);else if(A<11754943508222875e-54)p((P<<31|Math.round(A/1401298464324817e-60))>>>0,R,D);else{var k=Math.floor(Math.log(A)/Math.LN2);p((P<<31|k+127<<23|8388607&Math.round(A*Math.pow(2,-k)*8388608))>>>0,R,D)}}function m(p,A,R){var D=p(A,R),P=2*(D>>31)+1,k=D>>>23&255,b=8388607&D;return k===255?b?NaN:P*(1/0):k===0?1401298464324817e-60*P*b:P*Math.pow(2,k-150)*(b+8388608)}_.writeFloatLE=E.bind(null,a),_.writeFloatBE=E.bind(null,f),_.readFloatLE=m.bind(null,h),_.readFloatBE=m.bind(null,g)}(),typeof Float64Array<"u"?function(){var E=new Float64Array([-0]),m=new Uint8Array(E.buffer),p=m[7]===128;function A(k,b,j){E[0]=k,b[j]=m[0],b[j+1]=m[1],b[j+2]=m[2],b[j+3]=m[3],b[j+4]=m[4],b[j+5]=m[5],b[j+6]=m[6],b[j+7]=m[7]}function R(k,b,j){E[0]=k,b[j]=m[7],b[j+1]=m[6],b[j+2]=m[5],b[j+3]=m[4],b[j+4]=m[3],b[j+5]=m[2],b[j+6]=m[1],b[j+7]=m[0]}function D(k,b){return m[0]=k[b],m[1]=k[b+1],m[2]=k[b+2],m[3]=k[b+3],m[4]=k[b+4],m[5]=k[b+5],m[6]=k[b+6],m[7]=k[b+7],E[0]}function P(k,b){return m[7]=k[b],m[6]=k[b+1],m[5]=k[b+2],m[4]=k[b+3],m[3]=k[b+4],m[2]=k[b+5],m[1]=k[b+6],m[0]=k[b+7],E[0]}_.writeDoubleLE=p?A:R,_.writeDoubleBE=p?R:A,_.readDoubleLE=p?D:P,_.readDoubleBE=p?P:D}():function(){function E(p,A,R,D,P,k){var b=D<0?1:0;if(b&&(D=-D),D===0)p(0,P,k+A),p(1/D>0?0:2147483648,P,k+R);else if(isNaN(D))p(0,P,k+A),p(2146959360,P,k+R);else if(D>17976931348623157e292)p(0,P,k+A),p((b<<31|2146435072)>>>0,P,k+R);else{var j;if(D<22250738585072014e-324)p((j=D/5e-324)>>>0,P,k+A),p((b<<31|j/4294967296)>>>0,P,k+R);else{var z=Math.floor(Math.log(D)/Math.LN2);z===1024&&(z=1023),p(4503599627370496*(j=D*Math.pow(2,-z))>>>0,P,k+A),p((b<<31|z+1023<<20|1048576*j&1048575)>>>0,P,k+R)}}}function m(p,A,R,D,P){var k=p(D,P+A),b=p(D,P+R),j=2*(b>>31)+1,z=b>>>20&2047,S=4294967296*(1048575&b)+k;return z===2047?S?NaN:j*(1/0):z===0?5e-324*j*S:j*Math.pow(2,z-1075)*(S+4503599627370496)}_.writeDoubleLE=E.bind(null,a,0,4),_.writeDoubleBE=E.bind(null,f,4,0),_.readDoubleLE=m.bind(null,h,0,4),_.readDoubleBE=m.bind(null,g,4,0)}(),_}function a(_,E,m){E[m]=255&_,E[m+1]=_>>>8&255,E[m+2]=_>>>16&255,E[m+3]=_>>>24}function f(_,E,m){E[m]=_>>>24,E[m+1]=_>>>16&255,E[m+2]=_>>>8&255,E[m+3]=255&_}function h(_,E){return(_[E]|_[E+1]<<8|_[E+2]<<16|_[E+3]<<24)>>>0}function g(_,E){return(_[E]<<24|_[E+1]<<16|_[E+2]<<8|_[E+3])>>>0}O.exports=H(H)},7199:function(O,H,a){O.exports=function(f){try{var h=a(822)(f);if(h&&(h.length||Object.keys(h).length))return h}catch{}return null}},822:function(O){function H(a){var f=new Error("Cannot find module '"+a+"'");throw f.code="MODULE_NOT_FOUND",f}H.keys=function(){return[]},H.resolve=H,H.id=822,O.exports=H},8626:function(O,H){var a=H,f=a.isAbsolute=function(g){return/^(?:\/|\w+:)/.test(g)},h=a.normalize=function(g){var _=(g=g.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),E=f(g),m="";E&&(m=_.shift()+"/");for(var p=0;p<_.length;)_[p]===".."?p>0&&_[p-1]!==".."?_.splice(--p,2):E?_.splice(p,1):++p:_[p]==="."?_.splice(p,1):++p;return m+_.join("/")};a.resolve=function(g,_,E){return E||(_=h(_)),f(_)?_:(E||(g=h(g)),(g=g.replace(/(?:\/|^)[^/]+$/,"")).length?h(g+"/"+_):_)}},6662:function(O){O.exports=function(H,a,f){var h=f||8192,g=h>>>1,_=null,E=h;return function(m){if(m<1||m>g)return H(m);E+m>h&&(_=H(h),E=0);var p=a.call(_,E,E+=m);return 7&E&&(E=1+(7|E)),p}}},4997:function(O,H){var a=H;a.length=function(f){for(var h=0,g=0,_=0;_<f.length;++_)(g=f.charCodeAt(_))<128?h+=1:g<2048?h+=2:(64512&g)==55296&&(64512&f.charCodeAt(_+1))==56320?(++_,h+=4):h+=3;return h},a.read=function(f,h,g){if(g-h<1)return"";for(var _,E=null,m=[],p=0;h<g;)(_=f[h++])<128?m[p++]=_:_>191&&_<224?m[p++]=(31&_)<<6|63&f[h++]:_>239&&_<365?(_=((7&_)<<18|(63&f[h++])<<12|(63&f[h++])<<6|63&f[h++])-65536,m[p++]=55296+(_>>10),m[p++]=56320+(1023&_)):m[p++]=(15&_)<<12|(63&f[h++])<<6|63&f[h++],p>8191&&((E||(E=[])).push(String.fromCharCode.apply(String,m)),p=0);return E?(p&&E.push(String.fromCharCode.apply(String,m.slice(0,p))),E.join("")):String.fromCharCode.apply(String,m.slice(0,p))},a.write=function(f,h,g){for(var _,E,m=g,p=0;p<f.length;++p)(_=f.charCodeAt(p))<128?h[g++]=_:_<2048?(h[g++]=_>>6|192,h[g++]=63&_|128):(64512&_)==55296&&(64512&(E=f.charCodeAt(p+1)))==56320?(_=65536+((1023&_)<<10)+(1023&E),++p,h[g++]=_>>18|240,h[g++]=_>>12&63|128,h[g++]=_>>6&63|128,h[g++]=63&_|128):(h[g++]=_>>12|224,h[g++]=_>>6&63|128,h[g++]=63&_|128);return g-m}},4188:function(O,H,a){var f,h,g;(function(_){if(H!=null&&typeof H.nodeType!="number")O.exports=_();else if(a.amdO!=null)h=[],(g=typeof(f=_)=="function"?f.apply(H,h):f)===void 0||(O.exports=g);else{var E=_(),m=typeof self<"u"?self:$.global;typeof m.btoa!="function"&&(m.btoa=E.btoa),typeof m.atob!="function"&&(m.atob=E.atob)}})(function(){var _="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function E(m){this.message=m}return E.prototype=new Error,E.prototype.name="InvalidCharacterError",{btoa:function(m){for(var p,A,R=String(m),D=0,P=_,k="";R.charAt(0|D)||(P="=",D%1);k+=P.charAt(63&p>>8-D%1*8)){if((A=R.charCodeAt(D+=.75))>255)throw new E("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");p=p<<8|A}return k},atob:function(m){var p=String(m).replace(/[=]+$/,"");if(p.length%4==1)throw new E("'atob' failed: The string to be decoded is not correctly encoded.");for(var A,R,D=0,P=0,k="";R=p.charAt(P++);~R&&(A=D%4?64*A+R:R,D++%4)?k+=String.fromCharCode(255&A>>(-2*D&6)):0)R=_.indexOf(R);return k}}})},9667:function(O,H,a){a.r(H),a.d(H,{addUsersToChatRoom:function(){return F},addUsersToChatRoomAllowlist:function(){return je},addUsersToChatRoomWhitelist:function(){return Oe},blockChatRoomMember:function(){return re},blockChatRoomMembers:function(){return ft},chatRoomBlockMulti:function(){return de},chatRoomBlockSingle:function(){return zt},createChatRoom:function(){return R},deleteChatRoomSharedFile:function(){return te},destroyChatRoom:function(){return D},disableSendChatRoomMsg:function(){return Ie},enableSendChatRoomMsg:function(){return me},fetchChatRoomAnnouncement:function(){return We},fetchChatRoomSharedFileList:function(){return Ae},getChatRoomAdmin:function(){return V},getChatRoomAllowlist:function(){return Ne},getChatRoomAttributes:function(){return Be},getChatRoomBlacklist:function(){return fe},getChatRoomBlacklistNew:function(){return oe},getChatRoomBlocklist:function(){return le},getChatRoomDetails:function(){return P},getChatRoomMuteList:function(){return At},getChatRoomMuted:function(){return Yt},getChatRoomMutelist:function(){return Lt},getChatRoomSharedFilelist:function(){return Xe},getChatRoomWhitelist:function(){return ae},getChatRooms:function(){return A},getJoinedChatRooms:function(){return Dt},isChatRoomWhiteUser:function(){return Ze},isInChatRoomAllowlist:function(){return ee},isInChatRoomMutelist:function(){return be},joinChatRoom:function(){return M},leaveChatRoom:function(){return U},listChatRoomMember:function(){return Y},listChatRoomMembers:function(){return q},modifyChatRoom:function(){return k},muteChatRoomMember:function(){return wt},quitChatRoom:function(){return Z},removeChatRoomAdmin:function(){return mt},removeChatRoomAllowlistMember:function(){return He},removeChatRoomAttribute:function(){return nt},removeChatRoomAttributes:function(){return Et},removeChatRoomBlockMulti:function(){return Pt},removeChatRoomBlockSingle:function(){return gt},removeChatRoomMember:function(){return j},removeChatRoomMembers:function(){return S},removeChatRoomWhitelistMember:function(){return ir},removeMultiChatRoomMember:function(){return z},removeMuteChatRoomMember:function(){return yt},removeSingleChatRoomMember:function(){return b},rmUsersFromChatRoomWhitelist:function(){return xe},setChatRoomAdmin:function(){return it},setChatRoomAttribute:function(){return ot},setChatRoomAttributes:function(){return ze},unblockChatRoomMember:function(){return Zt},unblockChatRoomMembers:function(){return Wt},unmuteChatRoomMember:function(){return Ht},updateChatRoomAnnouncement:function(){return Pe},uploadChatRoomSharedFile:function(){return Ee}}),a(1539),a(8674),a(8309),a(2526),a(1817),a(2222),a(9753),a(9600),a(1249),a(4916),a(3123),a(2165),a(6992),a(8783),a(3948);var f=a(5531),h=a(7252),g=a(4024),_=a(3246),E=a(7360),m=a(1595);function p(B){return p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Ft){return typeof Ft}:function(Ft){return Ft&&typeof Symbol=="function"&&Ft.constructor===Symbol&&Ft!==Symbol.prototype?"symbol":typeof Ft},p(B)}function A(B){var Ft=this;if(typeof B.pagenum!="number"||typeof B.pagesize!="number")throw Error("Invalid parameter");if(!_.XZ.call(this)){var St=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(St)}var Nt={pagenum:B.pagenum||1,pagesize:B.pagesize||20},Ut=this.context,Xt=Ut.orgName,Gt=Ut.appName,ne=Ut.accessToken,Re={url:this.apiUrl+"/"+Xt+"/"+Gt+"/chatrooms",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+ne},data:Nt,success:function(pe){typeof B.success=="function"&&B.success(pe)},error:function(pe){pe.error&&pe.error_description&&Ft.onError&&Ft.onError({type:f.E.WEBIM_CONNCTION_LOAD_CHATROOM_ERROR,message:pe.error_description,data:pe}),typeof B.error=="function"&&B.error(pe)}};return E.kg.debug("Call getChatRooms",B),g.hj.call(this,Re,m.fI.GET_CHATROOM_LIST)}function R(B){if(typeof B.name!="string")throw Error("Invalid parameter");if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St={name:B.name,description:B.description,maxusers:B.maxusers,owner:this.user,members:B.members},Nt=this.context,Ut=Nt.orgName,Xt=Nt.appName,Gt=Nt.accessToken,ne=Nt.jid,Re={url:"".concat(this.apiUrl,"/").concat(Ut,"/").concat(Xt,"/chatrooms?resource=").concat(ne.clientResource),dataType:"json",type:"POST",data:JSON.stringify(St),headers:{Authorization:"Bearer "+(B.token||Gt),"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call createChatRoom",B),g.hj.call(this,Re,m.fI.CREATE_CHATROOM)}function D(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error("Invalid parameter");if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=St.jid,ne={url:"".concat(this.apiUrl,"/").concat(Nt,"/").concat(Ut,"/chatrooms/").concat(B.chatRoomId,"?resource=").concat(Gt.clientResource,"&version=v3"),dataType:"json",type:"DELETE",headers:{Authorization:"Bearer "+(B.token||Xt)},success:B.success,error:B.error};return E.kg.debug("Call destroyChatRoom",B),g.hj.call(this,ne,m.fI.DESTROY_CHATROOM)}function P(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error("Invalid parameter");if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt={url:this.apiUrl+"/"+Nt+"/"+Ut+"/chatrooms/"+B.chatRoomId,dataType:"json",type:"GET",headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call getChatRoomDetails",B),g.hj.call(this,Gt,m.fI.GET_CHATROOM_DETAIL)}function k(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error("Invalid parameter");if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=St.jid,ne=B.chatRoomId,Re={groupname:B.chatRoomName,description:B.description,maxusers:B.maxusers},pe={url:"".concat(this.apiUrl,"/").concat(Nt,"/").concat(Ut,"/chatrooms/").concat(ne,"?resource=").concat(Gt.clientResource),type:"PUT",data:JSON.stringify(Re),dataType:"json",headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call modifyChatRoom",B),g.hj.call(this,pe,m.fI.MODIFY_CHATROOM)}function b(B){if(typeof B.chatRoomId!="string"||B.chatRoomId===""||typeof B.username!="string")throw Error("Invalid parameter");if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=St.jid,ne=B.chatRoomId,Re=B.username,pe={url:"".concat(this.apiUrl,"/").concat(Nt,"/").concat(Ut,"/chatrooms/").concat(ne,"/users/").concat(Re,"?resource=").concat(Gt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call removeChatRoomMember",B),g.hj.call(this,pe,m.fI.REMOVE_CHATROOM_MEMBER)}var j=b;function z(B){if(typeof B.chatRoomId!="string"||B.chatRoomId===""||!Array.isArray(B.users))throw Error("Invalid parameter");if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=B.chatRoomId,Nt=B.users.join(","),Ut=this.context,Xt=Ut.orgName,Gt=Ut.appName,ne=Ut.accessToken,Re=Ut.jid,pe={url:"".concat(this.apiUrl,"/").concat(Xt,"/").concat(Gt,"/chatrooms/").concat(St,"/users/").concat(Nt,"?resource=").concat(Re.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+ne,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call removeChatRoomMembers",B),g.hj.call(this,pe,m.fI.MULTI_REMOVE_CHATROOM_MEMBER)}var S=z;function F(B){if(typeof B.chatRoomId!="string"||B.chatRoomId===""||!Array.isArray(B.users))throw Error("Invalid parameter");if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=B.chatRoomId,Nt={usernames:B.users},Ut=this.context,Xt=Ut.orgName,Gt=Ut.appName,ne=Ut.accessToken,Re=Ut.jid,pe={url:"".concat(this.apiUrl,"/").concat(Xt,"/").concat(Gt,"/chatrooms/").concat(St,"/users?resource=").concat(Re.clientResource),type:"POST",data:JSON.stringify(Nt),dataType:"json",headers:{Authorization:"Bearer "+ne,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call addUsersToChatRoom",B),g.hj.call(this,pe,m.fI.ADD_USERS_TO_CHATROOM)}function M(B){var Ft=B.roomId,St=B.message,Nt=St===void 0?"":St,Ut=B.ext,Xt=Ut===void 0?"":Ut,Gt=B.leaveOtherRooms,ne=Gt!==void 0&&Gt,Re=B.success,pe=B.error;if(typeof Ft!="string"||Ft==="")throw Error("Invalid parameter roomId");if(typeof Xt!="string")throw Error("Invalid parameter ext");if(typeof ne!="boolean")throw Error("Invalid parameter leaveOtherRooms");if(!_.XZ.call(this)){var Je=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Je)}return E.kg.debug("Call joinChatRoom",B),this.logOut?Promise.reject({type:f.E.WEBIM_CONNECTION_CLOSED,message:"not login"}):this.mSync.handleChatRoom({roomId:Ft,ext:Xt,leaveOtherRooms:ne,message:Nt,success:Re,error:pe},"join")}function Z(B){if(typeof B.roomId!="string"||B.roomId==="")throw Error("Invalid parameter");if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}return E.kg.debug("Call leaveChatRoom",B),this.logOut?Promise.reject({type:f.E.WEBIM_CONNECTION_CLOSED,message:"not login"}):this.mSync.handleChatRoom(B,"leave")}var U=Z;function Y(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(isNaN(B.pageNum)||B.pageNum<=0)throw Error('The parameter "pageNum" should be a positive number');if(isNaN(B.pageSize)||B.pageSize<=0)throw Error('The parameter "pageSize" should be a positive number');if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St={pagenum:B.pageNum,pagesize:B.pageSize},Nt=this.context,Ut=Nt.orgName,Xt=Nt.appName,Gt=Nt.accessToken,ne={url:this.apiUrl+"/"+Ut+"/"+Xt+"/chatrooms/"+B.chatRoomId+"/users",dataType:"json",type:"GET",data:St,headers:{Authorization:"Bearer "+Gt,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call listChatRoomMembers",B),g.hj.call(this,ne,m.fI.LIST_CHATROOM_MEMBERS)}var q=Y;function V(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=B.chatRoomId,ne={url:this.apiUrl+"/"+Nt+"/"+Ut+"/chatrooms/"+Gt+"/admin",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call getChatRoomAdmin",B),g.hj.call(this,ne,m.fI.GET_CHATROOM_ADMIN)}function it(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(typeof B.username!="string"||B.username==="")throw Error('Invalid parameter: "username"');if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=St.jid,ne=B.chatRoomId,Re={newadmin:B.username},pe={url:"".concat(this.apiUrl,"/").concat(Nt,"/").concat(Ut,"/chatrooms/").concat(ne,"/admin?resource=").concat(Gt.clientResource),type:"POST",dataType:"json",data:JSON.stringify(Re),headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call setChatRoomAdmin",B),g.hj.call(this,pe,m.fI.SET_CHATROOM_ADMIN)}function mt(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(typeof B.username!="string"||B.username==="")throw Error('Invalid parameter: "username"');if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=St.jid,ne=B.chatRoomId,Re=B.username,pe={url:"".concat(this.apiUrl,"/").concat(Nt,"/").concat(Ut,"/chatrooms/").concat(ne,"/admin/").concat(Re,"?resource=").concat(Gt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call removeChatRoomAdmin",B),g.hj.call(this,pe,m.fI.REMOVE_CHATROOM_ADMIN)}function wt(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error('Invalid parameter: "groupId"');if(typeof B.username!="string"||B.username==="")throw Error('Invalid parameter: "username"');if(typeof B.muteDuration!="number")throw Error('Invalid parameter: "muteDuration"');if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=St.jid,ne=B.chatRoomId,Re={usernames:[B.username],mute_duration:B.muteDuration},pe={url:"".concat(this.apiUrl,"/").concat(Nt,"/").concat(Ut,"/chatrooms/").concat(ne,"/mute?resource=").concat(Gt.clientResource),dataType:"json",type:"POST",headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"},data:JSON.stringify(Re),success:B.success,error:B.error};return E.kg.debug("Call muteChatRoomMember",B),g.hj.call(this,pe,m.fI.MUTE_CHATROOM_MEMBER)}function yt(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(typeof B.username!="string"||B.username==="")throw Error('Invalid parameter: "username"');if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=St.jid,ne=B.chatRoomId,Re=B.username,pe={url:"".concat(this.apiUrl,"/").concat(Nt,"/").concat(Ut,"/chatrooms/").concat(ne,"/mute/").concat(Re,"?resource=").concat(Gt.clientResource),dataType:"json",type:"DELETE",headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call unmuteChatRoomMember",B),g.hj.call(this,pe,m.fI.REMOVE_MUTE_CHATROOM_MEMBER)}var Ht=yt;function Yt(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=B.chatRoomId,ne={url:this.apiUrl+"/"+Nt+"/"+Ut+"/chatrooms/"+Gt+"/mute",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call getChatRoomMutelist",B),g.hj.call(this,ne,m.fI.GET_MUTE_CHATROOM_MEMBERS)}var At=Yt,Lt=Yt;function zt(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(typeof B.username!="string"||B.username==="")throw Error('Invalid parameter: "username"');if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=St.jid,ne=B.chatRoomId,Re=B.username,pe={url:"".concat(this.apiUrl,"/").concat(Nt,"/").concat(Ut,"/chatrooms/").concat(ne,"/blocks/users/").concat(Re,"?resource=").concat(Gt.clientResource),type:"POST",dataType:"json",headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call blockChatRoomMember",B),g.hj.call(this,pe,m.fI.SET_CHATROOM_MEMBER_TO_BLACK)}var re=zt;function de(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(!Array.isArray(B.usernames))throw Error('Invalid parameter: "usernames"');if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=St.jid,ne=B.chatRoomId,Re={usernames:B.usernames},pe={url:"".concat(this.apiUrl,"/").concat(Nt,"/").concat(Ut,"/chatrooms/").concat(ne,"/blocks/users?resource=").concat(Gt.clientResource),data:JSON.stringify(Re),type:"POST",dataType:"json",headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Chat blockChatRoomMembers:",pe),g.hj.call(this,pe,m.fI.MULTI_SET_CHATROOM_MEMBER_TO_BLACK)}var ft=de;function gt(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(typeof B.username!="string"||B.username==="")throw Error('Invalid parameter: "username"');if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=St.jid,ne=B.chatRoomId,Re=B.username,pe={url:"".concat(this.apiUrl,"/").concat(Nt,"/").concat(Ut,"/chatrooms/").concat(ne,"/blocks/users/").concat(Re,"?resource=").concat(Gt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call unblockChatRoomMember",B),g.hj.call(this,pe,m.fI.REMOVE_CHATROOM_MEMBER_BLACK)}var Zt=gt;function Pt(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(!Array.isArray(B.usernames))throw Error('Invalid parameter: "usernames"');if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=St.jid,ne=B.chatRoomId,Re=B.usernames.join(","),pe={url:"".concat(this.apiUrl,"/").concat(Nt,"/").concat(Ut,"/chatrooms/").concat(ne,"/blocks/users/").concat(Re,"?resource=").concat(Gt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call unblockChatRoomMembers",B),g.hj.call(this,pe,m.fI.MULTI_REMOVE_CHATROOM_MEMBER_BLACK)}var Wt=Pt;function oe(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=B.chatRoomId,ne={url:this.apiUrl+"/"+Nt+"/"+Ut+"/chatrooms/"+Gt+"/blocks/users",type:"GET",dataType:"json",headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call getChatRoomBlocklist",B),g.hj.call(this,ne,m.fI.GET_CHATROOM_BLOCK_MEMBERS)}var fe=oe,le=oe;function Ie(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=St.jid,ne=B.chatRoomId,Re={url:"".concat(this.apiUrl,"/").concat(Nt,"/").concat(Ut,"/chatrooms/").concat(ne,"/ban?resource=").concat(Gt.clientResource),type:"POST",dataType:"json",headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call disableSendChatRoomMsg",B),g.hj.call(this,Re,m.fI.DISABLED_CHATROOM_SEND_MSG)}function me(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=St.jid,ne=B.chatRoomId,Re={url:"".concat(this.apiUrl,"/").concat(Nt,"/").concat(Ut,"/chatrooms/").concat(ne,"/ban?resource=").concat(Gt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call enableSendChatRoomMsg",B),g.hj.call(this,Re,m.fI.ENABLE_CHATROOM_SEND_MSG)}function Oe(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(!Array.isArray(B.users))throw Error('Invalid parameter: "users"');if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=St.jid,ne=B.chatRoomId,Re={usernames:B.users},pe={url:"".concat(this.apiUrl,"/").concat(Nt,"/").concat(Ut,"/chatrooms/").concat(ne,"/white/users?resource=").concat(Gt.clientResource),type:"POST",data:JSON.stringify(Re),dataType:"json",headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call addUsersToChatRoomWhitelist",B),g.hj.call(this,pe,m.fI.ADD_USERS_TO_CHATROOM)}var je=Oe;function xe(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(typeof B.userName!="string"||B.userName==="")throw Error('Invalid parameter: "userName"');if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=St.jid,ne=B.chatRoomId,Re={url:"".concat(this.apiUrl,"/").concat(Nt,"/").concat(Ut,"/chatrooms/").concat(ne,"/white/users/").concat(B.userName,"?resource=").concat(Gt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call removeChatRoomAllowlistMember",B),g.hj.call(this,Re,m.fI.REMOVE_CHATROOM_WHITE_USERS)}var ir=xe,He=xe;function ae(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=B.chatRoomId,ne={url:this.apiUrl+"/"+Nt+"/"+Ut+"/chatrooms/"+Gt+"/white/users",type:"GET",dataType:"json",headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call getChatRoomAllowlist",B),g.hj.call(this,ne,m.fI.GET_CHATROOM_WHITE_USERS)}var Ne=ae;function Ze(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(typeof B.userName!="string"||B.userName==="")throw Error('Invalid parameter: "userName"');if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=B.chatRoomId,ne={url:this.apiUrl+"/"+Nt+"/"+Ut+"/chatrooms/"+Gt+"/white/users/"+B.userName,type:"GET",dataType:"json",headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call isInChatRoomAllowlist",B),g.hj.call(this,ne,m.fI.CHECK_CHATROOM_WHITE_USER)}var ee=Ze;function be(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=St.userId,ne={url:this.apiUrl+"/"+Nt+"/"+Ut+"/sdk/chatrooms/"+B.chatRoomId+"/mute/"+Gt,dataType:"json",type:"GET",headers:{Authorization:"Bearer "+Xt}};return E.kg.debug("Call isInChatRoomMutelist",B),g.hj.call(this,ne).then(function(Re){return{type:Re.type,data:Re.data}})}function We(B){if(typeof B.roomId!="string"||B.roomId==="")throw Error('Invalid parameter: "roomId"');if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=B.roomId,ne={url:"".concat(this.apiUrl,"/").concat(Nt,"/").concat(Ut,"/chatrooms/").concat(Gt,"/announcement"),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call fetchChatRoomAnnouncement",B),g.hj.call(this,ne,m.fI.GET_CHATROOM_ANN)}function Pe(B){if(typeof B.roomId!="string"||B.roomId==="")throw Error('Invalid parameter: "roomId"');if(typeof B.announcement!="string")throw Error('Invalid parameter: "announcement"');if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=St.jid,ne=B.roomId,Re={announcement:B.announcement},pe={url:"".concat(this.apiUrl,"/").concat(Nt,"/").concat(Ut,"/chatrooms/").concat(ne,"/announcement?resource=").concat(Gt.clientResource),type:"POST",dataType:"json",data:JSON.stringify(Re),headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call updateChatRoomAnnouncement:",B),g.hj.call(this,pe,m.fI.UPDATE_CHATROOM_ANN)}function Ee(B){if(typeof B.roomId!="string"||B.roomId==="")throw Error('Invalid parameter: "roomId"');if(p(B.file)!=="object")throw Error('Invalid parameter: "file"');if(_.XZ.call(this)){var Ft=this.context,St=Ft.orgName,Nt=Ft.appName,Ut=Ft.accessToken,Xt=Ft.jid,Gt=B.roomId;g.cT.call(this,{uploadUrl:"".concat(this.apiUrl,"/").concat(St,"/").concat(Nt,"/chatrooms/").concat(Gt,"/share_files?resource=").concat(Xt.clientResource),onFileUploadProgress:B.onFileUploadProgress,onFileUploadComplete:B.onFileUploadComplete,onFileUploadError:B.onFileUploadError,onFileUploadCanceled:B.onFileUploadCanceled,accessToken:Ut,apiUrl:this.apiUrl,file:B.file,appKey:this.context.appKey},m.fI.UPLOAD_CHATROOM_FILE),E.kg.debug("Call uploadChatRoomSharedFile",B)}}function te(B){if(typeof B.roomId!="string"||B.roomId==="")throw Error('Invalid parameter: "roomId"');if(typeof B.fileId!="string"||B.fileId==="")throw Error('Invalid parameter: "fileId"');if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=St.jid,ne=B.roomId,Re=B.fileId,pe={url:"".concat(this.apiUrl,"/").concat(Nt,"/").concat(Ut,"/chatrooms/").concat(ne,"/share_files/").concat(Re,"?resource=").concat(Gt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"},success:B.success,error:B.error};return E.kg.debug("Call deleteChatRoomSharedFile",B),g.hj.call(this,pe,m.fI.DELETE_CHATROOM_FILE)}function Ae(B){if(typeof B.roomId!="string"||B.roomId==="")throw Error('Invalid parameter: "roomId"');if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=B.roomId,ne={url:"".concat(this.apiUrl,"/").concat(Nt,"/").concat(Ut,"/chatrooms/").concat(Gt,"/share_files"),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json",accept:"application/json"},success:B.success,error:B.error};return E.kg.debug("Call fetchChatRoomSharedFileList",B),g.hj.call(this,ne,m.fI.GET_CHATROOM_FILES)}var Xe=Ae;function Be(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error("Invalid parameter chatRoomId: "+B.chatRoomId);if(B.attributeKeys&&!Array.isArray(B.attributeKeys))throw Error('"Invalid parameter attributeKeys": '+B.attributeKeys);if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=(St.jid,B.chatRoomId),ne={keys:B.attributeKeys},Re={url:"".concat(this.apiUrl,"/").concat(Nt,"/").concat(Ut,"/metadata/chatroom/").concat(Gt),type:"POST",dataType:"json",data:JSON.stringify(ne),headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"}};return E.kg.debug("Call getChatRoomAttributes:",B),g.hj.call(this,Re,m.fI.GET_CHATROOM_ATTR).then(function(pe){return{data:pe.data,type:pe.type}})}function ze(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error("Invalid parameter chatRoomId: "+B.chatRoomId);if(p(B.attributes)!=="object")throw Error("Invalid parameter attributes: "+B.attributes);if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=St.userId,ne=B.chatRoomId,Re=B.attributes,pe=B.autoDelete,Je=pe===void 0||pe,I=B.isForced?"/forced":"",X={metaData:Re,autoDelete:Je?"DELETE":"NO_DELETE"},_t={url:"".concat(this.apiUrl,"/").concat(Nt,"/").concat(Ut,"/metadata/chatroom/").concat(ne,"/user/").concat(Gt)+I,type:"PUT",dataType:"json",data:JSON.stringify(X),headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"}};return E.kg.debug("Call setChatRoomAttributes:",B),g.hj.call(this,_t,m.fI.SET_CHATROOM_ATTR).then(function(K){return(0,_._W)(K)})}function ot(B){var Ft;if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error("Invalid parameter chatRoomId: "+B.chatRoomId);if(typeof B.attributeKey!="string"||B.attributeKey==="")throw Error("Invalid parameter attributeKey: "+B.attributeKey);if(typeof B.attributeValue!="string"||B.attributeValue==="")throw Error("Invalid parameter attributeValue: "+B.attributeValue);if(!_.XZ.call(this)){var St=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(St)}var Nt=this.context,Ut=Nt.orgName,Xt=Nt.appName,Gt=Nt.accessToken,ne=Nt.userId,Re=B.chatRoomId,pe=B.attributeKey,Je=B.attributeValue,I=B.autoDelete,X=I===void 0||I,_t=B.isForced?"/forced":"",K={metaData:(Ft={},Ft[pe]=Je,Ft),autoDelete:X?"DELETE":"NO_DELETE"},dt={url:"".concat(this.apiUrl,"/").concat(Ut,"/").concat(Xt,"/metadata/chatroom/").concat(Re,"/user/").concat(ne)+_t,type:"PUT",dataType:"json",data:JSON.stringify(K),headers:{Authorization:"Bearer "+Gt,"Content-Type":"application/json"}};return E.kg.debug("Call setChatRoomAttribute:",B),g.hj.call(this,dt,m.fI.SET_CHATROOM_ATTR).then(function(bt){var rt=(0,_.H7)(bt);if(rt)throw rt})}function Et(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error("Invalid parameter chatRoomId: "+B.chatRoomId);if(!Array.isArray(B.attributeKeys))throw Error('"Invalid parameter attributes": '+B.attributeKeys);if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=St.userId,ne=B.chatRoomId,Re=B.attributeKeys,pe=B.isForced?"/forced":"",Je={keys:Re},I={url:"".concat(this.apiUrl,"/").concat(Nt,"/").concat(Ut,"/metadata/chatroom/").concat(ne,"/user/").concat(Gt)+pe,type:"DELETE",dataType:"json",data:JSON.stringify(Je),headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"}};return E.kg.debug("Call removeChatRoomAttributes:",B),g.hj.call(this,I,m.fI.DELETE_CHATROOM_ATTR).then(function(X){return(0,_._W)(X)})}function nt(B){if(typeof B.chatRoomId!="string"||B.chatRoomId==="")throw Error("Invalid parameter chatRoomId: "+B.chatRoomId);if(typeof B.attributeKey!="string"||B.attributeKey==="")throw Error('"Invalid parameter attributeKey": '+B.attributeKey);if(!_.XZ.call(this)){var Ft=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ft)}var St=this.context,Nt=St.orgName,Ut=St.appName,Xt=St.accessToken,Gt=St.userId,ne=B.chatRoomId,Re=B.attributeKey,pe=B.isForced?"/forced":"",Je={keys:[Re]},I={url:"".concat(this.apiUrl,"/").concat(Nt,"/").concat(Ut,"/metadata/chatroom/").concat(ne,"/user/").concat(Gt)+pe,type:"DELETE",dataType:"json",data:JSON.stringify(Je),headers:{Authorization:"Bearer "+Xt,"Content-Type":"application/json"}};return E.kg.debug("Call removeChatRoomAttribute:",B),g.hj.call(this,I,m.fI.DELETE_CHATROOM_ATTR).then(function(X){var _t=(0,_.H7)(X);if(_t)throw _t})}function Dt(B){var Ft=this,St=B||{},Nt=St.pageNum,Ut=St.pageSize;if(isNaN(Nt)||Nt<=0)throw Error("Invalid parameter pageNum:".concat(Nt));if(isNaN(Ut)||Ut<=0)throw Error("Invalid parameter pageSize:".concat(Ut));if(!_.XZ.call(this)){var Xt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Xt)}var Gt={pagenum:Nt,pagesize:Ut,detail:!0},ne=this.context,Re=ne.orgName,pe=ne.appName,Je=ne.accessToken,I={url:"".concat(this.apiUrl,"/").concat(Re,"/").concat(pe,"/users/").concat(this.user,"/joined_chatrooms"),dataType:"json",type:"GET",data:Gt,headers:{Authorization:"Bearer "+Je,"Content-Type":"application/json"}};return E.kg.debug("Call getJoinedChatRooms",B),g.hj.call(this,I,m.fI.GET_USER_JOINED_CHATROOM).then(function(X){var _t=(X.data||[]).map(function(K){var dt=K.id,bt=K.title,rt=K.owner,Vt=K.created,ut=K.description,Kt=K.max_users;return{id:dt,name:bt,owner:rt.split("".concat(Ft.appKey,"_"))[1],created:Vt,description:ut,maxusers:Kt}});return{type:X.type,data:_t}})}},4363:function(O,H,a){a.d(H,{U:function(){return E},w:function(){return m}}),a(9601),a(2772),a(1249);var f=a(7360),h=a(8161),g=a(4024),_=function(){return _=Object.assign||function(p){for(var A,R=1,D=arguments.length;R<D;R++)for(var P in A=arguments[R])Object.prototype.hasOwnProperty.call(A,P)&&(p[P]=A[P]);return p},_.apply(this,arguments)},E={chat:"singleChat",chatroom:"chatRoom",groupchat:"groupChat",singleChat:"singleChat",chatRoom:"chatRoom",groupChat:"groupChat"};function m(p,A){var R,D,P,k=A||{},b=k.formatCustomExts,j=b===void 0||b,z=k.formatChatType,S=z!==void 0&&z,F=p.id,M=p.payload,Z=p.timestamp,U=p.to,Y=M.bodies&&M.bodies.length>0?M.bodies[0]:{},q={},V={},it=M.type?M.type:U.indexOf("@conference.easemob.com")>-1?"groupChat":"singleChat";it=it==="chat"?"singleChat":it,S&&M.type&&(it=E[M.type]);var mt="";switch(Y.type){case"txt":if(Object.prototype.hasOwnProperty.call(Y,"subType")&&Y.subType==="sub_combine")mt=h.t.call(this,{remotePath:Y?.url,secret:Y?.secret}),q={id:F,type:"combine",chatType:it,to:M.to,from:M.from,ext:M.ext,time:Z,title:Y.title||"",summary:Y.summary||"",url:mt||"",secret:Y.secret||"",file_length:Y.file_length||0,filename:Y.filename||"",compatibleText:Y.msg,combineLevel:Y.combineLevel||0};else{var wt=(R=M?.meta)===null||R===void 0?void 0:R.edit_msg;if(q={id:F,type:"txt",chatType:it,msg:Y.msg||"",to:M.to||"",from:M.from,time:Z,ext:M.ext},wt){var yt=wt.edit_time,Ht=wt.operator,Yt=wt.count;q.modifiedInfo={operationTime:yt,operatorId:Ht,operationCount:Yt}}}break;case"img":mt=this.useOwnUploadFun?Y?.url:h.t.call(this,{remotePath:Y?.url,secret:Y?.secret}),q={id:F,type:"img",chatType:it,to:M.to,from:M.from,time:Z,ext:M.ext,width:((D=Y.size)===null||D===void 0?void 0:D.width)||0,height:((P=Y.size)===null||P===void 0?void 0:P.height)||0,thumb:this.useOwnUploadFun?"":"".concat(mt,"&thumbnail=true"),thumb_secret:Y.secret,secret:Y.secret||"",url:mt||"",file_length:Y.file_length||0,file:{}};break;case"video":mt=this.useOwnUploadFun?Y?.url:h.t.call(this,{remotePath:Y?.url,secret:Y?.secret}),q={id:F,type:"video",chatType:it,from:M.from,to:M.to,thumb:g.P6.formatAttachUrl.call(this,Y.thumb),thumb_secret:Y.thumb_secret||"",url:mt||"",secret:Y.secret||"",filename:Y.filename,length:Y.length||0,file:{},file_length:Y.file_length||0,filetype:M.ext.file_type||"",ext:M.ext,time:Z};break;case"loc":q={id:F,type:"loc",chatType:it,from:M.from,to:M.to,buildingName:Y.buildingName||"",addr:Y.addr,lat:Y.lat,lng:Y.lng,ext:M.ext,time:Z};break;case"audio":mt=this.useOwnUploadFun?Y?.url:h.t.call(this,{remotePath:Y?.url,secret:Y?.secret}),q={id:F,type:"audio",chatType:it,from:M.from,to:M.to,secret:Y.secret||"",ext:M.ext,time:Z,url:mt||"",file:{},filename:Y.filename,length:Y.length||0,file_length:Y.file_length||0,filetype:M.ext.file_type||""};break;case"file":mt=this.useOwnUploadFun?Y?.url:h.t.call(this,{remotePath:Y?.url,secret:Y?.secret}),q={id:F,type:"file",chatType:it,from:M.from,to:M.to,ext:M.ext,time:Z,url:mt||"",secret:Y.secret||"",file:{},filename:Y.filename||"",file_length:Y.file_length||0,filetype:M.ext.file_type||""};break;case"cmd":q={id:F,type:"cmd",chatType:it,from:M.from,to:M.to,ext:M.ext,time:Z,action:Y.action||""};break;case"custom":var At=Y.customExts||{};j&&Y.customExts&&(At={},Y.customExts.map(function(zt){At=_(_({},At),zt)})),q={id:F,type:"custom",chatType:it,from:M.from,to:M.to,ext:M.ext,time:Z,customEvent:Y.customEvent||"",customExts:At};break;case"combine":mt=h.t.call(this,{remotePath:Y?.url,secret:Y?.secret}),q={id:F,type:"combine",chatType:it,msg:Y.msg||"",to:M.to||"",from:M.from,time:Z,ext:M.ext,title:Y.title||"",summary:Y.summary||"",url:mt||"",compatibleText:Y.text,combineLevel:Y.combineLevel||0,secret:Y.secret||"",filename:Y.filename||"",file_length:Y.file_length||0};break;default:f.kg.error("unexpected message: ".concat(p))}if(M.msgConfig&&(V.msgConfig=M.msgConfig),M?.meta){var Lt=M.meta;Lt.thread&&(V.chatThread={messageId:Lt.thread.msg_parent_id,parentId:Lt.thread.muc_parent_id,chatThreadName:Lt.thread.thread_name}),Lt.reaction&&(V.reactions=Lt.reaction),Lt.translations&&(V.translations=Lt.translations)}return _(_({},q),V)}},2856:function(O,H,a){a.r(H),a.d(H,{acceptGroupInvite:function(){return fe},acceptGroupJoinRequest:function(){return Zt},addUsersToGroupAllowlist:function(){return St},addUsersToGroupWhitelist:function(){return Ft},agreeInviteIntoGroup:function(){return oe},agreeJoinGroup:function(){return gt},blockGroup:function(){return k},blockGroupMember:function(){return Pe},blockGroupMembers:function(){return te},blockGroupMessages:function(){return b},changeGroupOwner:function(){return Z},changeOwner:function(){return M},createGroup:function(){return P},createGroupNew:function(){return D},deleteGroupSharedFile:function(){return bt},destroyGroup:function(){return At},disableSendGroupMsg:function(){return Dt},dissolveGroup:function(){return Yt},downloadGroupSharedFile:function(){return ut},enableSendGroupMsg:function(){return B},fetchGroupAnnouncement:function(){return _t},fetchGroupSharedFileList:function(){return rt},getGroup:function(){return S},getGroupAdmin:function(){return it},getGroupAllowlist:function(){return ne},getGroupBlacklist:function(){return Et},getGroupBlacklistNew:function(){return ot},getGroupBlocklist:function(){return nt},getGroupInfo:function(){return U},getGroupMemberAttributes:function(){return jt},getGroupMembersAttributes:function(){return ge},getGroupMsgReadUser:function(){return X},getGroupMuteList:function(){return ee},getGroupMutelist:function(){return be},getGroupSharedFilelist:function(){return Vt},getGroupWhitelist:function(){return Gt},getJoinedGroups:function(){return F},getMuted:function(){return Ze},getPublicGroups:function(){return z},groupBlockMulti:function(){return Ee},groupBlockSingle:function(){return We},inviteToGroup:function(){return re},inviteUsersToGroup:function(){return de},isGroupWhiteUser:function(){return Re},isInGroupAllowlist:function(){return Je},isInGroupMutelist:function(){return I},isInGroupWhiteList:function(){return pe},joinGroup:function(){return ft},leaveGroup:function(){return zt},listGroupMember:function(){return q},listGroupMembers:function(){return V},listGroups:function(){return j},modifyGroup:function(){return Y},mute:function(){return ir},muteGroupMember:function(){return He},quitGroup:function(){return Lt},rejectGroupInvite:function(){return Ie},rejectGroupJoinRequest:function(){return Wt},rejectInviteIntoGroup:function(){return le},rejectJoinGroup:function(){return Pt},removeAdmin:function(){return yt},removeGroupAdmin:function(){return Ht},removeGroupAllowlistMember:function(){return Xt},removeGroupBlockMulti:function(){return Be},removeGroupBlockSingle:function(){return Ae},removeGroupMember:function(){return Oe},removeGroupMembers:function(){return xe},removeGroupWhitelistMember:function(){return Ut},removeMultiGroupMember:function(){return je},removeMute:function(){return ae},removeSingleGroupMember:function(){return me},rmUsersFromGroupWhitelist:function(){return Nt},setAdmin:function(){return mt},setGroupAdmin:function(){return wt},setGroupMemberAttributes:function(){return Kt},unblockGroupMember:function(){return Xe},unblockGroupMembers:function(){return ze},unmuteGroupMember:function(){return Ne},updateGroupAnnouncement:function(){return K},uploadGroupSharedFile:function(){return dt}}),a(1539),a(8674),a(2526),a(1817),a(2165),a(6992),a(8783),a(3948),a(2222),a(6699),a(2023),a(9554),a(4747),a(8309),a(9753),a(9600);var f=a(5531),h=a(7252),g=a(4024),_=a(3246),E=a(7360),m=a(1595);function p(W){return p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(lt){return typeof lt}:function(lt){return lt&&typeof Symbol=="function"&&lt.constructor===Symbol&&lt!==Symbol.prototype?"symbol":typeof lt},p(W)}var A=function(W,lt,ct,It){return new(ct||(ct=Promise))(function(Ct,Ot){function Mt(Jt){try{he(It.next(Jt))}catch(Ve){Ot(Ve)}}function qt(Jt){try{he(It.throw(Jt))}catch(Ve){Ot(Ve)}}function he(Jt){var Ve;Jt.done?Ct(Jt.value):(Ve=Jt.value,Ve instanceof ct?Ve:new ct(function(Ye){Ye(Ve)})).then(Mt,qt)}he((It=It.apply(W,[])).next())})},R=function(W,lt){var ct,It,Ct,Ot,Mt={label:0,sent:function(){if(1&Ct[0])throw Ct[1];return Ct[1]},trys:[],ops:[]};return Ot={next:qt(0),throw:qt(1),return:qt(2)},typeof Symbol=="function"&&(Ot[Symbol.iterator]=function(){return this}),Ot;function qt(he){return function(Jt){return function(Ve){if(ct)throw new TypeError("Generator is already executing.");for(;Mt;)try{if(ct=1,It&&(Ct=2&Ve[0]?It.return:Ve[0]?It.throw||((Ct=It.return)&&Ct.call(It),0):It.next)&&!(Ct=Ct.call(It,Ve[1])).done)return Ct;switch(It=0,Ct&&(Ve=[2&Ve[0],Ct.value]),Ve[0]){case 0:case 1:Ct=Ve;break;case 4:return Mt.label++,{value:Ve[1],done:!1};case 5:Mt.label++,It=Ve[1],Ve=[0];continue;case 7:Ve=Mt.ops.pop(),Mt.trys.pop();continue;default:if(!((Ct=(Ct=Mt.trys).length>0&&Ct[Ct.length-1])||Ve[0]!==6&&Ve[0]!==2)){Mt=0;continue}if(Ve[0]===3&&(!Ct||Ve[1]>Ct[0]&&Ve[1]<Ct[3])){Mt.label=Ve[1];break}if(Ve[0]===6&&Mt.label<Ct[1]){Mt.label=Ct[1],Ct=Ve;break}if(Ct&&Mt.label<Ct[2]){Mt.label=Ct[2],Mt.ops.push(Ve);break}Ct[2]&&Mt.ops.pop(),Mt.trys.pop();continue}Ve=lt.call(W,Mt)}catch(Ye){Ve=[6,Ye],It=0}finally{ct=Ct=0}if(5&Ve[0])throw Ve[1];return{value:Ve[0]?Ve[1]:void 0,done:!0}}([he,Jt])}}};function D(W){if(!W||!W.data)throw Error("Invalid parameter");if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.jid,qt={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups?resource=").concat(Mt.clientResource),dataType:"json",type:"POST",data:JSON.stringify({owner:this.user,groupname:W.data.groupname,desc:W.data.desc,members:W.data.members,public:W.data.public,approval:W.data.approval,allowinvites:W.data.allowinvites,invite_need_confirm:W.data.inviteNeedConfirm,maxusers:W.data.maxusers,custom:W.data.ext}),headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:function(he){W.success&&W.success(he)},error:W.error};return E.kg.debug("Call createGroup:",W),g.hj.call(this,qt,m.fI.CREATE_GROUP)}var P=D;function k(W){var lt;if(typeof W.groupId!="string"||W.groupId==="")throw Error("Invalid parameter");if(!_.XZ.call(this)){var ct=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(ct)}var It=this.context,Ct=It.orgName,Ot=It.appName,Mt=It.accessToken,qt=It.jid,he={entities:[(lt={},lt["notification_ignore_"+W.groupId]=!0,lt)]},Jt={type:"PUT",url:"".concat(this.apiUrl,"/").concat(Ct,"/").concat(Ot,"/users/").concat(this.user,"?resource=").concat(qt.clientResource),data:JSON.stringify(he),dataType:"json",headers:{Authorization:"Bearer "+Mt,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call blockGroupMessages",W),g.hj.call(this,Jt,m.fI.BLOCK_GROUP)}var b=k;function j(W){if(typeof W.limit!="number")throw Error("Invalid parameter");if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt={limit:W.limit,cursor:W.cursor};W.cursor||delete Mt.cursor;var qt={url:this.apiUrl+"/"+It+"/"+Ct+"/publicchatgroups",type:"GET",dataType:"json",data:Mt,headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call listGroups",W),g.hj.call(this,qt,m.fI.LIST_GROUP)}var z=j;function S(W){if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt={url:this.apiUrl+"/"+It+"/"+Ct+"/users/"+this.user+"/joined_chatgroups",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W&&W?.success,error:W&&W?.error};return E.kg.debug("Call getJoinedGroups",W),g.hj.call(this,Mt,m.fI.GET_USER_GROUP)}function F(W){if(typeof W.pageNum!="number"||typeof W.pageSize!="number")throw Error('Invalid parameter: "pageNum or pageSize"');if(W.pageNum<0||W.pageSize<0)throw Error('"pageNum" should >= 0 and "pageSize" should >= 0');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=W.needAffiliations||W.needRole?"/chatgroups/user/".concat(this.user,"?pagenum=").concat(W.pageNum,"&pagesize=").concat(W.pageSize,"&needAffiliations=").concat(W.needAffiliations,"&needRole=").concat(W.needRole):"/users/".concat(this.user,"/joined_chatgroups?pagenum=").concat(W.pageNum,"&pagesize=").concat(W.pageSize),qt={url:this.apiUrl+"/"+It+"/"+Ct+Mt,dataType:"json",type:"GET",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W&&W?.success,error:W&&W?.error};return E.kg.debug("Call getGroup",W),g.hj.call(this,qt,m.fI.GET_USER_GROUP).then(function(he){var Jt=he.uri,Ve=he.entities,Ye=[];return Jt.includes("joined_chatgroups")||(Ve.forEach(function(or){var ue={affiliationsCount:or.affiliations_count,groupName:or.name,groupId:or.groupId,role:or.permission,disabled:or.disabled,approval:or.membersonly,allowInvites:or.allowinvites,description:or.description,maxUsers:or.maxusers,public:or.public};Ye.push(ue)}),he.entities=Ye),he})}function M(W){if(typeof W.groupId!="string"||typeof W.newOwner!="string")throw Error("Invalid parameter");if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct={newowner:W.newOwner},It=this.context,Ct=It.orgName,Ot=It.appName,Mt=It.accessToken,qt=It.jid,he={url:"".concat(this.apiUrl,"/").concat(Ct,"/").concat(Ot,"/chatgroups/").concat(W.groupId,"?resource=").concat(qt.clientResource),type:"PUT",dataType:"json",headers:{Authorization:"Bearer "+Mt,"Content-Type":"application/json"},data:JSON.stringify(ct),success:W.success,error:W.error};return E.kg.debug("Call changeOwner",W),g.hj.call(this,he,m.fI.CHANGE_OWNER)}var Z=M;function U(W){if(typeof W.groupId!="string"&&!Array.isArray(W.groupId))throw Error('Invalid parameter: "groupId"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt={url:this.apiUrl+"/"+It+"/"+Ct+"/chatgroups/"+W.groupId+"?joined_time=true",type:"GET",dataType:"json",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call getGroupInfo",W),g.hj.call(this,Mt,m.fI.GET_GROUP_INFO)}function Y(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error("Invalid parameter");if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.jid,qt=W.groupId,he={groupname:W.groupName,description:W.description,custom:W.ext},Jt={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(qt,"?resource=").concat(Mt.clientResource),type:"PUT",data:JSON.stringify(he),dataType:"json",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call modifyGroup",W),g.hj.call(this,Jt,m.fI.MODIFY_GROUP)}function q(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(isNaN(W.pageNum)||W.pageNum<=0)throw Error('The parameter "pageNum" should be a positive number');if(isNaN(W.pageSize)||W.pageSize<=0)throw Error('The parameter "pageSize" should be a positive number');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct={pagenum:W.pageNum,pagesize:W.pageSize},It=this.context,Ct=It.orgName,Ot=It.appName,Mt=It.accessToken,qt={url:this.apiUrl+"/"+Ct+"/"+Ot+"/chatgroups/"+W.groupId+"/users",dataType:"json",type:"GET",data:ct,headers:{Authorization:"Bearer "+Mt,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call listGroupMember",W),g.hj.call(this,qt,m.fI.LIST_GROUP_MEMBER)}var V=q;function it(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=W.groupId,qt={url:this.apiUrl+"/"+It+"/"+Ct+"/chatgroups/"+Mt+"/admin",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call getGroupAdmin",W),g.hj.call(this,qt,m.fI.GET_GROUP_ADMIN)}function mt(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof W.username!="string"||W.username==="")throw Error('Invalid parameter: "username"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.jid,qt=W.groupId,he={newadmin:W.username},Jt={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(qt,"/admin?resource=").concat(Mt.clientResource),type:"POST",dataType:"json",data:JSON.stringify(he),headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call setGroupAdmin",W),g.hj.call(this,Jt,m.fI.SET_GROUP_ADMIN)}var wt=mt;function yt(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof W.username!="string"||W.username==="")throw Error('Invalid parameter: "username"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.jid,qt=W.groupId,he=W.username,Jt={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(qt,"/admin/").concat(he,"?resource=").concat(Mt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call removeAdmin",W),g.hj.call(this,Jt,m.fI.REMOVE_GROUP_ADMIN)}var Ht=yt;function Yt(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.jid,qt=W.groupId,he={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(qt,"?version=v3&resource=").concat(Mt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call destroyGroup",W),g.hj.call(this,he,m.fI.DISSOLVE_GROUP)}var At=Yt;function Lt(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.jid,qt=W.groupId,he={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(qt,"/quit?resource=").concat(Mt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call quitGroup",W),g.hj.call(this,he,m.fI.QUIT_GROUP)}var zt=Lt;function re(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(!Array.isArray(W.users))throw Error('Invalid parameter: "users"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=W.groupId,It={usernames:W.users},Ct=this.context,Ot=Ct.orgName,Mt=Ct.appName,qt=Ct.accessToken,he=Ct.jid,Jt={url:"".concat(this.apiUrl,"/").concat(Ot,"/").concat(Mt,"/chatgroups/").concat(ct,"/invite?resource=").concat(he.clientResource),type:"POST",data:JSON.stringify(It),dataType:"json",headers:{Authorization:"Bearer "+qt,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call inviteUsersToGroup",W),g.hj.call(this,Jt,m.fI.INVITE_TO_GROUP)}var de=re;function ft(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.jid,qt={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(W.groupId,"/apply?resource=").concat(Mt.clientResource),type:"POST",dataType:"json",data:JSON.stringify({message:W.message||""}),headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call joinGroup",W),g.hj.call(this,qt,m.fI.JOIN_GROUP)}function gt(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof W.applicant!="string"||W.applicant==="")throw Error('Invalid parameter: "applicant"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.jid,qt=W.groupId,he={applicant:W.applicant,verifyResult:!0,reason:"no clue"},Jt={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(qt,"/apply_verify?resource=").concat(Mt.clientResource),type:"POST",dataType:"json",data:JSON.stringify(he),headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call agreeJoinGroup",W),g.hj.call(this,Jt,m.fI.AGREE_JOIN_GROUP)}var Zt=gt;function Pt(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof W.applicant!="string"||W.applicant==="")throw Error('Invalid parameter: "applicant"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.jid,qt=W.groupId,he={applicant:W.applicant,verifyResult:!1,reason:W.reason||""},Jt={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(qt,"/apply_verify?resource=").concat(Mt.clientResource),type:"POST",dataType:"json",data:JSON.stringify(he),headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call rejectGroupJoinRequest",W),g.hj.call(this,Jt,m.fI.REJECT_JOIN_GROUP)}var Wt=Pt;function oe(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof W.invitee!="string"||W.invitee==="")throw Error('Invalid parameter: "invitee"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.jid,qt=W.groupId,he={invitee:W.invitee,verifyResult:!0},Jt={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(qt,"/invite_verify?resource=").concat(Mt.clientResource),type:"POST",dataType:"json",data:JSON.stringify(he),headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call acceptGroupInvite",W),g.hj.call(this,Jt,m.fI.AGREE_INVITE_GROUP)}var fe=oe;function le(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof W.invitee!="string"||W.invitee==="")throw Error('Invalid parameter: "invitee"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.jid,qt=W.groupId,he={invitee:W.invitee,verifyResult:!1},Jt={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(qt,"/invite_verify?resource=").concat(Mt.clientResource),type:"POST",dataType:"json",data:JSON.stringify(he),headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call rejectGroupInvite",W),g.hj.call(this,Jt,m.fI.REJECT_INVITE_GROUP)}var Ie=le;function me(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof W.username!="string"||W.username==="")throw Error('Invalid parameter: "username"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=W.groupId,It=W.username,Ct=this.context,Ot=Ct.orgName,Mt=Ct.appName,qt=Ct.accessToken,he=Ct.jid,Jt={url:"".concat(this.apiUrl,"/").concat(Ot,"/").concat(Mt,"/chatgroups/").concat(ct,"/users/").concat(It,"?resource=").concat(he.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+qt,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call removeGroupMember",W),g.hj.call(this,Jt,m.fI.REMOVE_GROUP_MEMBER)}var Oe=me;function je(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(!Array.isArray(W.users))throw Error('Invalid parameter: "users"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.jid,qt=W.groupId,he=W.users.join(","),Jt={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(qt,"/users/").concat(he,"?resource=").concat(Mt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call removeGroupMembers",W),g.hj.call(this,Jt,m.fI.MULTI_REMOVE_GROUP_MEMBER)}var xe=je;function ir(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(!(Array.isArray(W.username)||typeof W.username=="string"&&W.username!==""))throw Error('Invalid parameter: "username"');if(typeof W.muteDuration!="number")throw Error('Invalid parameter: "muteDuration"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.jid,qt=W.groupId,he={usernames:typeof W.username=="string"?[W.username]:W.username,mute_duration:W.muteDuration},Jt={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(qt,"/mute?resource=").concat(Mt.clientResource),dataType:"json",type:"POST",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},data:JSON.stringify(he),success:W.success,error:W.error};return E.kg.debug("Call muteGroupMember",W),g.hj.call(this,Jt,m.fI.MUTE_GROUP_MEMBER)}var He=ir;function ae(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(!(Array.isArray(W.username)||typeof W.username=="string"&&W.username!==""))throw Error('Invalid parameter: "username"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.jid,qt=W.groupId,he=W.username,Jt={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(qt,"/mute/").concat(he,"?resource=").concat(Mt.clientResource),dataType:"json",type:"DELETE",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call unmuteGroupMember",W),g.hj.call(this,Jt,m.fI.UNMUTE_GROUP_MEMBER)}var Ne=ae;function Ze(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=W.groupId,qt={url:this.apiUrl+"/"+It+"/"+Ct+"/chatgroups/"+Mt+"/mute",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call getGroupMuteList",W),g.hj.call(this,qt,m.fI.GET_GROUP_MUTE_LIST)}var ee=Ze,be=Ze;function We(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof W.username!="string"||W.username==="")throw Error('Invalid parameter: "username"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.jid,qt=W.groupId,he=W.username,Jt={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(qt,"/blocks/users/").concat(he,"?resource=").concat(Mt.clientResource),type:"POST",dataType:"json",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call blockGroupMember",W),g.hj.call(this,Jt,m.fI.BLOCK_GROUP_MEMBER)}var Pe=We;function Ee(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(!Array.isArray(W.usernames))throw Error('Invalid parameter: "usernames"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.jid,qt=W.groupId,he={usernames:W.usernames},Jt={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(qt,"/blocks/users?resource=").concat(Mt.clientResource),data:JSON.stringify(he),type:"POST",dataType:"json",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call blockGroupMembers",W),g.hj.call(this,Jt,m.fI.BLOCK_GROUP_MEMBERS)}var te=Ee;function Ae(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof W.username!="string"||W.username==="")throw Error('Invalid parameter: "username"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.jid,qt=W.groupId,he=W.username,Jt={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(qt,"/blocks/users/").concat(he,"?resource=").concat(Mt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call unblockGroupMember",W),g.hj.call(this,Jt,m.fI.UNBLOCK_GROUP_MEMBER)}var Xe=Ae;function Be(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(!Array.isArray(W.usernames))throw Error('Invalid parameter: "usernames"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.jid,qt=W.groupId,he=W.usernames.join(","),Jt={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(qt,"/blocks/users/").concat(he,"?resource=").concat(Mt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call unblockGroupMembers",W),g.hj.call(this,Jt,m.fI.UNBLOCK_GROUP_MEMBERS)}var ze=Be;function ot(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=W.groupId,qt={url:this.apiUrl+"/"+It+"/"+Ct+"/chatgroups/"+Mt+"/blocks/users",type:"GET",dataType:"json",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call getGroupBlacklist",W),g.hj.call(this,qt,m.fI.GET_GROUP_BLACK_LIST)}var Et=ot,nt=ot;function Dt(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.jid,qt=W.groupId,he={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(qt,"/ban?resource=").concat(Mt.clientResource),type:"POST",dataType:"json",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call disableSendGroupMsg",W),g.hj.call(this,he,m.fI.DISABLED_SEND_GROUP_MSG)}function B(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.jid,qt=W.groupId,he={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(qt,"/ban?resource=").concat(Mt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call enableSendGroupMsg",W),g.hj.call(this,he,m.fI.ENABLE_SEND_GROUP_MSG)}function Ft(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(!Array.isArray(W.users))throw Error('Invalid parameter: "users"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.jid,qt=W.groupId,he={usernames:W.users},Jt={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(qt,"/white/users?resource=").concat(Mt.clientResource),type:"POST",data:JSON.stringify(he),dataType:"json",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call addUsersToGroupWhitelist",W),g.hj.call(this,Jt,m.fI.ADD_USERS_TO_GROUP_WHITE)}var St=Ft;function Nt(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof W.userName!="string"||W.userName==="")throw Error('Invalid parameter: "userName"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.jid,qt=W.groupId,he={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(qt,"/white/users/").concat(W.userName,"?resource=").concat(Mt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call removeGroupAllowlistMember",W),g.hj.call(this,he,m.fI.REMOVE_GROUP_WHITE_MEMBER)}var Ut=Nt,Xt=Nt;function Gt(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=W.groupId,qt={url:this.apiUrl+"/"+It+"/"+Ct+"/chatgroups/"+Mt+"/white/users",type:"GET",dataType:"json",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call getGroupAllowlist",W),g.hj.call(this,qt,m.fI.GET_GROUP_WHITE_LIST)}var ne=Gt;function Re(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof W.userName!="string"||W.userName==="")throw Error('Invalid parameter: "userName"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=W.groupId,qt={url:this.apiUrl+"/"+It+"/"+Ct+"/chatgroups/"+Mt+"/white/users/"+W.userName,type:"GET",dataType:"json",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call isInGroupAllowlist",W),g.hj.call(this,qt,m.fI.IS_IN_GROUP_WHITE_LIST)}var pe=Re,Je=Re;function I(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.userId,qt={url:this.apiUrl+"/"+It+"/"+Ct+"/sdk/chatgroups/"+W.groupId+"/mute/"+Mt,dataType:"json",type:"GET",headers:{Authorization:"Bearer "+Ot}};return E.kg.debug("Call isInGroupMutelist",W),g.hj.call(this,qt).then(function(he){return{type:he.type,data:he.data}})}function X(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof W.msgId!="string"||W.msgId==="")throw Error('Invalid parameter: "msgId"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt={url:this.apiUrl+"/"+It+"/"+Ct+"/chatgroups/"+W.groupId+"/acks/"+W.msgId,dataType:"json",type:"GET",data:{limit:500,key:void 0},headers:{Authorization:"Bearer "+Ot},success:W.success,error:W.error};return E.kg.debug("Call getGroupMsgReadUser",W),g.hj.call(this,Mt,m.fI.GET_GROUP_MSG_READ_USER)}function _t(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=W.groupId,qt={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(Mt,"/announcement"),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call fetchGroupAnnouncement",W),g.hj.call(this,qt,m.fI.GET_GROUP_ANN)}function K(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof W.announcement!="string")throw Error('Invalid parameter: "announcement"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.jid,qt=W.groupId,he={announcement:W.announcement},Jt={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(qt,"/announcement?resource=").concat(Mt.clientResource),type:"POST",dataType:"json",data:JSON.stringify(he),headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call updateGroupAnnouncement",W),g.hj.call(this,Jt,m.fI.UPDATE_GROUP_ANN)}function dt(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(p(W.file)!=="object")throw Error('Invalid parameter: "file"');if(_.XZ.call(this)){var lt=this.context,ct=lt.orgName,It=lt.appName,Ct=lt.accessToken,Ot=lt.jid,Mt=W.groupId;g.cT.call(this,{uploadUrl:"".concat(this.apiUrl,"/").concat(ct,"/").concat(It,"/chatgroups/").concat(Mt,"/share_files?resource=").concat(Ot.clientResource),onFileUploadProgress:W.onFileUploadProgress,onFileUploadComplete:W.onFileUploadComplete,onFileUploadError:W.onFileUploadError,onFileUploadCanceled:W.onFileUploadCanceled,accessToken:Ct,apiUrl:this.apiUrl,file:W.file,appKey:this.context.appKey},m.fI.UPLOAD_GROUP_FILE),E.kg.debug("Call uploadGroupSharedFile",W)}}function bt(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof W.fileId!="string"||W.fileId==="")throw Error('Invalid parameter: "file"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=ct.jid,qt=W.groupId,he=W.fileId,Jt={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(qt,"/share_files/").concat(he,"?resource=").concat(Mt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call deleteGroupSharedFile",W),g.hj.call(this,Jt,m.fI.DELETE_GROUP_FILE)}function rt(W){if(typeof W.groupId!="string"||W.groupId==="")throw Error('Invalid parameter: "groupId"');if(!_.XZ.call(this)){var lt=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(lt)}var ct=this.context,It=ct.orgName,Ct=ct.appName,Ot=ct.accessToken,Mt=W.pageNum||1,qt=W.pageSize||10,he=W.groupId,Jt={url:"".concat(this.apiUrl,"/").concat(It,"/").concat(Ct,"/chatgroups/").concat(he,"/share_files?pagenum=").concat(Mt,"&pagesize=").concat(qt),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+Ot,"Content-Type":"application/json"},success:W.success,error:W.error};return E.kg.debug("Call getGroupSharedFilelist",W),g.hj.call(this,Jt,m.fI.GET_GROUP_FILE_LIST)}var Vt=rt;function ut(W){var lt=this.context,ct=lt.orgName,It=lt.appName,Ct=lt.accessToken,Ot=this.apiUrl,Mt=W.groupId,qt=W.fileId;g.LR.call(this,{url:"".concat(Ot,"/").concat(ct,"/").concat(It,"/chatgroups/").concat(Mt,"/share_files/").concat(qt),onFileDownloadComplete:W.onFileDownloadComplete,onFileDownloadError:W.onFileDownloadError,accessToken:Ct,id:qt,secret:W.secret},m.fI.DOWN_GROUP_FILE),E.kg.debug("Call downloadGroupSharedFile",W)}function Kt(W){return A(this,void 0,void 0,function(){var lt,ct,It,Ct,Ot,Mt,qt,he,Jt,Ve,Ye;return R(this,function(or){switch(or.label){case 0:if(lt=W.groupId,ct=W.userId,It=W.memberAttributes,typeof lt!="string"||lt==="")throw Error('Invalid parameter: "groupId"');if(typeof ct!="string"||ct==="")throw Error('Invalid parameter: "userId"');if(p(It)!=="object")throw Error('Invalid parameter: "memberAttributes"');return _.XZ.call(this)?(Ot=this.context,Mt=Ot.orgName,qt=Ot.appName,he=Ot.accessToken,Jt=Ot.jid,Ve={metaData:It},Ye={url:"".concat(this.apiUrl,"/").concat(Mt,"/").concat(qt,"/sdk/metadata/chatgroup/").concat(lt,"/user/").concat(ct,"?resource=").concat(Jt.clientResource),type:"PUT",dataType:"json",data:JSON.stringify(Ve),headers:{Authorization:"Bearer "+he,"Content-Type":"application/json"}},E.kg.debug("Call setGroupMemberAttributes",W),[4,g.hj.call(this,Ye,m.fI.SET_GROUP_MEMBER_ATTRS)]):(Ct=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(Ct)]);case 1:return or.sent(),[2]}})})}function jt(W){var lt=W.groupId,ct=W.userId;return ge.call(this,{groupId:lt,userIds:[ct]}).then(function(It){var Ct;return{type:It.type,data:(Ct=It.data)===null||Ct===void 0?void 0:Ct[ct]}})}function ge(W){var lt=W.groupId,ct=W.userIds,It=W.keys,Ct=It===void 0?[]:It;if(typeof lt!="string"||lt==="")throw Error('Invalid parameter: "groupId"');if(!Array.isArray(ct)||ct?.length<=0)throw Error('Invalid parameter: "userIds"');if(!Array.isArray(Ct))throw Error('Invalid parameter: "keys"');if(!_.XZ.call(this)){var Ot=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ot)}var Mt=this.context,qt=Mt.orgName,he=Mt.appName,Jt=Mt.accessToken,Ve={targets:ct,properties:Ct},Ye={url:"".concat(this.apiUrl,"/").concat(qt,"/").concat(he,"/sdk/metadata/chatgroup/").concat(lt,"/get"),type:"POST",dataType:"json",data:JSON.stringify(Ve),headers:{Authorization:"Bearer "+Jt,"Content-Type":"application/json"}};return E.kg.debug("Call getGroupMembersAttributes",W),g.hj.call(this,Ye,m.fI.GET_GROUP_MEMBER_ATTR).then(function(or){return{type:or.type,data:or?.data||{}}})}},7479:function(O,H,a){a.r(H),a.d(H,{acceptContactInvite:function(){return le},acceptInvitation:function(){return fe},addContact:function(){return Pt},addConversationMark:function(){return Ft},addReaction:function(){return ee},addToBlackList:function(){return Oe},addUsersToBlacklist:function(){return je},addUsersToBlocklist:function(){return xe},declineContactInvite:function(){return me},declineInvitation:function(){return Ie},deleteAllMessagesAndConversations:function(){return Xt},deleteContact:function(){return oe},deleteConversation:function(){return Yt},deleteReaction:function(){return be},deleteSession:function(){return Ht},fetchHistoryMessages:function(){return ft},fetchUserInfoById:function(){return zt},getAllContacts:function(){return nt},getBlacklist:function(){return Z},getBlocklist:function(){return U},getContacts:function(){return q},getContactsWithCursor:function(){return Dt},getConversationlist:function(){return wt},getHistoryMessages:function(){return Zt},getReactionDetail:function(){return Ee},getReactionList:function(){return We},getReactionlist:function(){return Pe},getRoster:function(){return Y},getSelfIdsOnOtherPlatform:function(){return Ut},getServerConversations:function(){return Xe},getServerConversationsByFilter:function(){return Nt},getServerPinnedConversations:function(){return ze},getServerPinnedMessages:function(){return pe},getSessionList:function(){return mt},getTokenExpireTimestamp:function(){return de},modifyMessage:function(){return Ze},pinConversation:function(){return ot},pinMessage:function(){return ne},recallMessage:function(){return Ne},removeConversationMark:function(){return St},removeFromBlackList:function(){return ir},removeHistoryMessages:function(){return Ae},removeRoster:function(){return Wt},removeUserFromBlackList:function(){return He},removeUserFromBlocklist:function(){return ae},reportMessage:function(){return te},setContactRemark:function(){return Et},unbindPushToken:function(){return Je},unpinMessage:function(){return Re},updateCurrentUserNick:function(){return re},updateOwnUserInfo:function(){return At},updateUserInfo:function(){return Lt},uploadPushToken:function(){return it},uploadToken:function(){return V}}),a(9601),a(1539),a(8674),a(2526),a(1817),a(2165),a(6992),a(8783),a(3948),a(9554),a(4747),a(2222),a(7941),a(6699),a(3710),a(9714),a(9600),a(5069),a(561),a(9753),a(8309),a(1249),a(7327);var f=a(3246),h=a(5531),g=a(7252),_=a(4024),E=a(9937),m=a(8161),p=a(4188),A=a.n(p),R=a(7360),D=a(1595),P=a(4363),k=a(7288),b=a(9743),j=a(6801),z=function(){return z=Object.assign||function(I){for(var X,_t=1,K=arguments.length;_t<K;_t++)for(var dt in X=arguments[_t])Object.prototype.hasOwnProperty.call(X,dt)&&(I[dt]=X[dt]);return I},z.apply(this,arguments)},S=function(I,X,_t,K){return new(_t||(_t=Promise))(function(dt,bt){function rt(Kt){try{ut(K.next(Kt))}catch(jt){bt(jt)}}function Vt(Kt){try{ut(K.throw(Kt))}catch(jt){bt(jt)}}function ut(Kt){var jt;Kt.done?dt(Kt.value):(jt=Kt.value,jt instanceof _t?jt:new _t(function(ge){ge(jt)})).then(rt,Vt)}ut((K=K.apply(I,[])).next())})},F=function(I,X){var _t,K,dt,bt,rt={label:0,sent:function(){if(1&dt[0])throw dt[1];return dt[1]},trys:[],ops:[]};return bt={next:Vt(0),throw:Vt(1),return:Vt(2)},typeof Symbol=="function"&&(bt[Symbol.iterator]=function(){return this}),bt;function Vt(ut){return function(Kt){return function(jt){if(_t)throw new TypeError("Generator is already executing.");for(;rt;)try{if(_t=1,K&&(dt=2&jt[0]?K.return:jt[0]?K.throw||((dt=K.return)&&dt.call(K),0):K.next)&&!(dt=dt.call(K,jt[1])).done)return dt;switch(K=0,dt&&(jt=[2&jt[0],dt.value]),jt[0]){case 0:case 1:dt=jt;break;case 4:return rt.label++,{value:jt[1],done:!1};case 5:rt.label++,K=jt[1],jt=[0];continue;case 7:jt=rt.ops.pop(),rt.trys.pop();continue;default:if(!((dt=(dt=rt.trys).length>0&&dt[dt.length-1])||jt[0]!==6&&jt[0]!==2)){rt=0;continue}if(jt[0]===3&&(!dt||jt[1]>dt[0]&&jt[1]<dt[3])){rt.label=jt[1];break}if(jt[0]===6&&rt.label<dt[1]){rt.label=dt[1],dt=jt;break}if(dt&&rt.label<dt[2]){rt.label=dt[2],rt.ops.push(jt);break}dt[2]&&rt.ops.pop(),rt.trys.pop();continue}jt=X.call(I,rt)}catch(ge){jt=[6,ge],K=0}finally{_t=dt=0}if(5&jt[0])throw jt[1];return{value:jt[0]?jt[1]:void 0,done:!0}}([ut,Kt])}}},M={singleChat:"chat",chatRoom:"chatroom",groupChat:"groupchat"};function Z(I){if(!f.XZ.call(this)){var X=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(X)}var _t=this.context,K=_t.orgName,dt=_t.appName,bt=_t.accessToken,rt={url:this.apiUrl+"/"+K+"/"+dt+"/users/"+this.user+"/blocks/users",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+bt},success:function(Vt){Vt.data.forEach(function(ut){}),typeof I?.success=="function"&&I.success(Vt)},error:function(Vt){typeof I?.error=="function"&&I.error(Vt)}};return R.kg.debug("Call getBlocklist"),_.hj.call(this,rt,D.fI.GET_BLACK_LIST)}var U=Z,Y=q;function q(I){var X=this;if(!f.XZ.call(this)){var _t=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(_t)}var K=this.context,dt=K.orgName,bt=K.appName,rt=K.accessToken,Vt={url:this.apiUrl+"/"+dt+"/"+bt+"/users/"+this.user+"/contacts/users",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+rt},success:function(ut){var Kt=[];ut.data.forEach(function(jt){Kt.push({name:jt,subscription:"both",jid:X.context.jid})}),typeof I?.success=="function"&&I.success(Kt)},error:function(ut){typeof I?.error=="function"&&I.error(ut)}};return R.kg.debug("Call getContacts"),_.hj.call(this,Vt,D.fI.GET_CONTACTS)}function V(I){return R.kg.debug("Call uploadPushToken"),j.r.call(this,I)}var it=V;function mt(I){if(!f.XZ.call(this)){var X=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(X)}var _t=this.context,K=_t.orgName,dt=_t.appName,bt=_t.accessToken,rt={url:"".concat(this.apiUrl,"/").concat(K,"/").concat(dt,"/users/").concat(this.user,"/user_channels"),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+bt,"Content-Type":"application/json"},success:I&&I?.success,error:I&&I?.error};return R.kg.debug("Call getSessionList"),_.hj.call(this,rt,D.fI.GET_SESSION_LIST)}function wt(I){var X=this;if(!f.XZ.call(this)){var _t=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(_t)}var K=this.context,dt=K.orgName,bt=K.appName,rt=K.accessToken,Vt=!!(I&&typeof I.pageNum=="number"&&typeof I.pageSize=="number"&&I.pageNum>0&&I.pageSize>0),ut={url:"".concat(this.apiUrl,"/").concat(dt,"/").concat(bt,"/users/").concat(this.user,"/user_channels").concat(Vt?"/page":""),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+rt,"Content-Type":"application/json"},success:I&&I?.success,error:I&&I?.error};return Vt&&(ut.data={pageNum:I.pageNum,pageSize:I.pageSize}),R.kg.debug("Call getConversationlist"),_.hj.call(this,ut,D.fI.GET_SESSION_LIST).then(function(Kt){return yt.call(X,Kt)})}function yt(I){var X=this,_t=I.data.channel_infos;return _t?.forEach(function(K){K.meta&&JSON.stringify(K.meta)!=="{}"?(K.meta.payload=JSON.parse(K.meta.payload),K.lastMessage=P.w.call(X,K.meta,{formatCustomExts:!1})):K.lastMessage=K.meta,delete K.meta}),I}function Ht(I){if(I&&typeof I.channel!="string")throw Error("Invalid parameter channel: ".concat(I.channel));if(I&&I.chatType!=="singleChat"&&I.chatType!=="groupChat")throw Error("Invalid parameter chatType: ".concat(I.chatType));if(I&&typeof I.deleteRoam!="boolean")throw Error("Invalid parameter deleteRoam: ".concat(I.deleteRoam));if(!f.XZ.call(this)){var X=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(X)}var _t,K=this.context,dt=K.orgName,bt=K.appName,rt=K.accessToken,Vt=K.jid;_t=I.chatType==="singleChat"?"chat":"groupChat";var ut={url:"".concat(this.apiUrl,"/").concat(dt,"/").concat(bt,"/user/").concat(this.user,"/user_channel?resource=").concat(Vt.clientResource),dataType:"json",type:"DELETE",data:JSON.stringify({channel:I.channel,type:_t,delete_roam:I.deleteRoam}),headers:{Authorization:"Bearer "+rt,"Content-Type":"application/json"},success:I.success,error:I.error};return R.kg.debug("Call deleteSession",I),_.hj.call(this,ut,D.fI.DELETE_SESSION)}var Yt=Ht;function At(I,X){if(!f.XZ.call(this)){var _t=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(_t)}var K=this.context,dt=K.orgName,bt=K.appName,rt=K.accessToken,Vt=["nickname","avatarurl","mail","phone","gender","sign","birth","ext"],ut={},Kt=_.P6.getEnvInfo();if(Kt.platform==="wx"||Kt.platform==="qq")if(typeof I=="string"&&X!==void 0){if(!Vt.includes(I))throw new Error("illegal key, only these keys: nickname, avatarurl, mail, phone, gender, sign, birth, ext are allowed");ut[I]=X}else{if(Object.prototype.toString.call(I)!=="[object Object]")throw new Error("illegal params");Vt.forEach(function(W){Vt.includes(W)&&I[W]!==void 0&&(ut[W]=I[W])})}else if(typeof I=="string"){if(!Vt.includes(I))throw new Error("illegal key, only these keys: nickname, avatarurl, mail, phone, gender, sign, birth, ext are allowed");ut=I+"="+X}else{if(Object.prototype.toString.call(I)!=="[object Object]")throw new Error("illegal params");var jt=[];Vt.forEach(function(W){if(Vt.includes(W)&&I[W]!==void 0){var lt=encodeURIComponent(W),ct=encodeURIComponent(I[W]);jt.push(lt+"="+ct)}}),ut=jt.join("&")}var ge={url:"".concat(this.apiUrl,"/").concat(dt,"/").concat(bt,"/metadata/user/").concat(this.user),type:"PUT",data:ut,dataType:"json",headers:{Authorization:"Bearer "+rt,"Content-Type":"application/x-www-form-urlencoded"}};return R.kg.debug("Call updateOwnUserInfo",I),_.hj.call(this,ge,D.fI.UPDATE_USER_INFO)}var Lt=At;function zt(I,X){if(!f.XZ.call(this)){var _t=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(_t)}var K,dt=this.context,bt=dt.orgName,rt=dt.appName,Vt=dt.accessToken,ut=[];if(typeof I=="string")ut=[I];else{if(Object.prototype.toString.call(I)!=="[object Array]")throw new Error("illegal params");ut=I}K=typeof X=="string"?[X]:X&&Object.prototype.toString.call(X)==="[object Array]"?X:["nickname","avatarurl","mail","phone","gender","sign","birth","ext"];var Kt={url:"".concat(this.apiUrl,"/").concat(bt,"/").concat(rt,"/metadata/user/get"),type:"POST",data:JSON.stringify({targets:ut,properties:K}),dataType:"json",headers:{Authorization:"Bearer "+Vt,"Content-Type":"application/json"}};return R.kg.debug("Call fetchUserInfoById",I),_.hj.call(this,Kt,D.fI.GET_USER_INFO)}function re(I){if(!f.XZ.call(this)){var X=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(X)}var _t=this.context,K=_t.orgName,dt=_t.appName,bt=_t.accessToken,rt={url:"".concat(this.apiUrl,"/").concat(K,"/").concat(dt,"/users/").concat(this.user),type:"PUT",dataType:"json",data:JSON.stringify({nickname:I}),headers:{Authorization:"Bearer "+bt,"Content-Type":"application/json"}};return R.kg.debug("Call updateCurrentUserNick",I),_.hj.call(this,rt)}function de(I){if(typeof I!="string"||I==="")throw Error('Invalid parameter: "token"');var X=this.context,_t=X.orgName,K=X.appName,dt={url:"".concat(this.apiUrl,"/").concat(_t,"/").concat(K,"/sdk/users/").concat(this.user,"/token/expires"),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+I,"Content-Type":"application/json"}};return R.kg.debug("Call getTokenExpireTimestamp",I),_.hj.call(this,dt,D.fI.SDK_INTERNAL)}function ft(I){var X=this;return new Promise(function(_t,K){if(!I.queue)throw Error('Invalid parameter: "specified"');if(!f.XZ.call(X)){var dt=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(dt)}(function bt(rt){var Vt=this,ut=rt.count||20;gt.call(this,{count:ut,isGroup:!!rt.isGroup,queue:rt.queue,start:rt.start,format:rt.format,success:function(Kt){if(Kt.msgs.length>=ut||Kt.is_last){var jt=Kt.msgs.splice(0,ut).reverse();rt.success&&rt.success(jt),_t(jt)}else bt.call(Vt,z(z({},rt),{start:null}))},fail:function(Kt){K(Kt),rt.fail&&rt.fail(Kt)}})}).call(X,I),R.kg.debug("Call fetchHistoryMessages",I)})}function gt(I){var X=this,_t=I.queue,K=this.mr_cache[_t]||(this.mr_cache[_t]={msgs:[]}),dt=this.context.userId,bt=I.start||-1,rt=I.count||20;if(K.msgs.length>=rt||K.is_last)typeof I.success=="function"&&I.success(K);else{K&&K.next_key&&(bt=K.next_key),I.start&&(bt=I.start);var Vt={queue:_t+(I.isGroup?"@conference.easemob.com":"@easemob.com"),start:bt,end:-1},ut=this.context,Kt=ut.orgName,jt=ut.appName,ge={url:"".concat(this.apiUrl,"/").concat(Kt,"/").concat(jt,"/users/").concat(dt,"/messageroaming"),dataType:"json",type:"POST",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"},data:JSON.stringify(Vt),success:function(W){return S(X,void 0,void 0,function(){var lt,ct,It,Ct,Ot,Mt,qt=this;return F(this,function(he){switch(he.label){case 0:if(lt=W?.data,!W.data.msgs)return typeof I.success=="function"&&I.success(K),K.is_last=!0,K.next_key="",[2];ct=lt.msgs,It=ct.length,K.is_last=lt.is_last,K.next_key=lt.next_key,Ct=function(Jt){return S(qt,void 0,void 0,function(){var Ve,Ye,or,ue,tr;return F(this,function(Pr){switch(Pr.label){case 0:for(Ve=[],Jt=A().atob(Jt),Ye=0,or=Jt.length;Ye<or;++Ye)Ve.push(Jt.charCodeAt(Ye));return ue=(ue=this.context.root.lookup("easemob.pb.Meta")).decode(Ve),tr={errorCode:0,reason:""},ue.ns!==1?[3,2]:[4,m.Z.call(this,ue,tr,!0,I.format)];case 1:return[2,Pr.sent()];case 2:return[2]}})})},Ot=0,he.label=1;case 1:return Ot<It?[4,Ct(ct[Ot].msg)]:[3,4];case 2:(Mt=he.sent())&&K.msgs.push(Mt),he.label=3;case 3:return Ot++,[3,1];case 4:return typeof I.success=="function"&&I.success(K),[2]}})})},error:function(W){if(W.error&&W.error_description){var lt=g.Z.create({type:h.E.WEBIM_CONNCTION_AJAX_ERROR,message:"fetch history messages error",data:W});X.onError&&X.onError(lt)}}};_.hj.call(this,ge,D.fI.GET_HISTORY_MSG).catch(function(W){typeof I.fail=="function"&&I.fail(W)})}}function Zt(I){var X=this;return new Promise(function(_t,K){var dt=I.targetId,bt=I.cursor,rt=bt===void 0?-1:bt,Vt=I.pageSize,ut=Vt===void 0?20:Vt,Kt=I.chatType,jt=I.searchDirection,ge=I.searchOptions,W=ge===void 0?{}:ge,lt=W.msgTypes,ct=lt===void 0?[]:lt,It=W.startTime,Ct=It===void 0?null:It,Ot=W.endTime,Mt=Ot===void 0?null:Ot,qt=W.from,he=qt===void 0?null:qt;if(typeof dt!="string"||dt==="")throw Error('"Invalid parameter": "targetId"');if(he&&typeof he!="string")throw Error('"Invalid parameter": "searchOptions.from"');if(ct&&!Array.isArray(ct))throw Error('"Invalid parameter": "searchOptions.msgTypes"');if(Ct&&typeof Ct!="number")throw Error('"Invalid parameter": "searchOptions.startTime"');if(Mt&&typeof Ct!="number")throw Error('"Invalid parameter": "searchOptions.endTime"');if(!f.XZ.call(X)){var Jt=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"});return K(Jt)}var Ve=X.context,Ye=Ve.orgName,or=Ve.appName,ue=Ve.userId,tr=I.chatType==="singleChat"?"@easemob.com":"@conference.easemob.com",Pr={queue:"".concat(dt).concat(tr),start:rt,pull_number:ut,is_positive:jt==="down",msgType:ct.join(",")||"",end:-1,startTime:Ct,endTime:Mt,userId:Kt==="singleChat"?null:he},_r={url:"".concat(X.apiUrl,"/").concat(Ye,"/").concat(or,"/users/").concat(ue,"/messageroaming"),dataType:"json",type:"POST",headers:{Authorization:"Bearer "+X.token,"Content-Type":"application/json"},data:JSON.stringify(Pr),success:function(en){return S(X,void 0,void 0,function(){var tn,Kn,Ln,ln,hi,Xi,Vs,sn,za=this;return F(this,function(Yo){switch(Yo.label){case 0:tn=en?.data,Kn=tn.msgs||[],Ln=function(Xo){return S(za,void 0,void 0,function(){var js,_s,ia,Es,oa;return F(this,function(Qe){switch(Qe.label){case 0:for(js=[],Xo=A().atob(Xo),_s=0,ia=Xo.length;_s<ia;++_s)js.push(Xo.charCodeAt(_s));return Es=(Es=this.context.root.lookup("easemob.pb.Meta")).decode(js),oa={errorCode:0,reason:""},Es.ns!==1?[3,2]:[4,m.Z.call(this,Es,oa,!0,!0)];case 1:return[2,Qe.sent()];case 2:return[2]}})})},ln=[],hi=0,Yo.label=1;case 1:return hi<Kn.length?[4,Ln(Kn[hi].msg)]:[3,4];case 2:(Xi=Yo.sent())&&ln.push(Xi),Yo.label=3;case 3:return hi++,[3,1];case 4:return tn.msgs=ln,Vs={cursor:tn.next_key,messages:ln,isLast:tn.is_last},(sn=I.success)===null||sn===void 0||sn.call(I,Vs),_t(Vs),[2]}})})},error:I.fail};_.hj.call(X,_r).catch(function(en){K(en)}),R.kg.debug("Call getHistoryMessages",I)})}function Pt(I,X){return S(this,void 0,void 0,function(){var _t,K,dt,bt,rt,Vt,ut;return F(this,function(Kt){switch(Kt.label){case 0:if(!f.XZ.call(this))return _t=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(_t)];if(typeof I!="string"||I==="")throw Error('"Invalid parameter": "to"');return R.kg.debug("Call addContact",I,X),K=this.context,dt=K.orgName,bt=K.appName,rt=K.accessToken,Vt=K.jid,ut={url:"".concat(this.apiUrl,"/").concat(dt,"/").concat(bt,"/users/").concat(this.user,"/contacts/apply?resource=").concat(Vt.clientResource),type:"POST",dataType:"json",data:JSON.stringify({usernames:[I],reason:X}),headers:{Authorization:"Bearer "+rt,"Content-Type":"application/json"}},[4,_.hj.call(this,ut,D.fI.ROSTER_ADD)];case 1:return Kt.sent(),[2]}})})}var Wt=oe;function oe(I){return S(this,void 0,void 0,function(){var X,_t,K,dt,bt,rt,Vt;return F(this,function(ut){switch(ut.label){case 0:if(!f.XZ.call(this))return X=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(X)];if(typeof I!="string"||I==="")throw Error('"Invalid parameter": "to"');return R.kg.debug("Call deleteContact",I),_t=this.context,K=_t.orgName,dt=_t.appName,bt=_t.accessToken,rt=_t.jid,Vt={url:"".concat(this.apiUrl,"/").concat(K,"/").concat(dt,"/users/").concat(this.user,"/contacts/users/").concat(I,"?resource=").concat(rt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+bt,"Content-Type":"application/json"}},[4,_.hj.call(this,Vt,D.fI.ROSTER_REMOVE)];case 1:return ut.sent(),[2]}})})}function fe(I){return S(this,void 0,void 0,function(){var X,_t,K,dt,bt,rt,Vt;return F(this,function(ut){switch(ut.label){case 0:if(!f.XZ.call(this))return X=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(X)];if(typeof I!="string"||I==="")throw Error('"Invalid parameter": "to"');return R.kg.debug("Call acceptInvitation",I),_t=this.context,K=_t.orgName,dt=_t.appName,bt=_t.accessToken,rt=_t.jid,Vt={url:"".concat(this.apiUrl,"/").concat(K,"/").concat(dt,"/users/").concat(this.user,"/contacts/accept/users/").concat(I,"?resource=").concat(rt.clientResource),type:"POST",dataType:"json",headers:{Authorization:"Bearer "+bt,"Content-Type":"application/json"}},[4,_.hj.call(this,Vt,D.fI.ROSTER_ACCEPT)];case 1:return ut.sent(),[2]}})})}var le=fe;function Ie(I){return S(this,void 0,void 0,function(){var X,_t,K,dt,bt,rt,Vt;return F(this,function(ut){switch(ut.label){case 0:if(!f.XZ.call(this))return X=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(X)];if(typeof I!="string"||I==="")throw Error('"Invalid parameter": "to"');return R.kg.debug("Call declineInvitation",I),_t=this.context,K=_t.orgName,dt=_t.appName,bt=_t.accessToken,rt=_t.jid,Vt={url:"".concat(this.apiUrl,"/").concat(K,"/").concat(dt,"/users/").concat(this.user,"/contacts/decline/users/").concat(I,"?resource=").concat(rt.clientResource),type:"POST",dataType:"json",headers:{Authorization:"Bearer "+bt,"Content-Type":"application/json"}},[4,_.hj.call(this,Vt,D.fI.ROSTER_DECLINE)];case 1:return ut.sent(),[2]}})})}var me=Ie;function Oe(I){return S(this,void 0,void 0,function(){var X,_t,K,dt,bt,rt,Vt,ut,Kt;return F(this,function(jt){switch(jt.label){case 0:if(!f.XZ.call(this))return X=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(X)];if(_t=I.name,K=[],typeof _t=="string"){if(_t==="")throw Error('"Invalid parameter": "name"');K=[_t]}else{if(!Array.isArray(_t))throw Error('"Invalid parameter": "name"');K=_t}return R.kg.debug("Call addToBlockList",I),dt=this.context,bt=dt.orgName,rt=dt.appName,Vt=dt.accessToken,ut=dt.jid,Kt={url:"".concat(this.apiUrl,"/").concat(bt,"/").concat(rt,"/sdk/user/").concat(this.user,"/blocks?resource=").concat(ut.clientResource),type:"POST",dataType:"json",data:JSON.stringify({usernames:K}),headers:{Authorization:"Bearer "+Vt,"Content-Type":"application/json"}},[4,_.hj.call(this,Kt,D.fI.ROSTER_BAN).then(function(ge){return{type:ge.type,data:{userIds:ge?.data||[]}}})];case 1:return[2,jt.sent()]}})})}var je=Oe,xe=Oe;function ir(I){return S(this,void 0,void 0,function(){var X,_t,K,dt,bt,rt,Vt,ut,Kt;return F(this,function(jt){switch(jt.label){case 0:if(!f.XZ.call(this))return X=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(X)];if(_t=I.name,K=[],typeof _t=="string"){if(_t==="")throw Error('"Invalid parameter": "name"');K=[_t]}else{if(!Array.isArray(_t))throw Error('"Invalid parameter": "name"');K=_t}return R.kg.debug("Call removeFromBlockList",I),dt=this.context,bt=dt.orgName,rt=dt.appName,Vt=dt.accessToken,ut=dt.jid,Kt={url:"".concat(this.apiUrl,"/").concat(bt,"/").concat(rt,"/sdk/user/").concat(this.user,"/blocks?resource=").concat(ut.clientResource),type:"DELETE",dataType:"json",data:JSON.stringify({usernames:K}),headers:{Authorization:"Bearer "+Vt,"Content-Type":"application/json"}},[4,_.hj.call(this,Kt,D.fI.ROSTER_ALLOW)];case 1:return jt.sent(),[2]}})})}var He=ir,ae=ir;function Ne(I){var X=this,_t=I?.ext||"";if(typeof _t!="string")throw Error('"Invalid parameter": "ext"',_t);var K=this.getUniqueId(),dt={id:K,to:I.to};this._msgHash[K]=z({},dt);var bt="";I.chatType!==void 0?bt=I.chatType:I.type!==void 0&&(bt=I.type==="chat"?"singleChat":I.type);var rt={id:K,type:"recall",chatType:bt,ackId:I.mid,to:I.to,isChatThread:I.isChatThread||!1,metaExt:_t,success:function(Vt){return S(X,void 0,void 0,function(){var ut,Kt,jt,ge,W,lt,ct,It,Ct;return F(this,function(Ot){switch(Ot.label){case 0:return Ot.trys.push([0,5,,6]),bt!=="singleChat"&&bt!=="groupChat"?[3,4]:[4,(jt=(Kt=this._localCache)===null||Kt===void 0?void 0:Kt.getInstance())===null||jt===void 0?void 0:jt.removeMsgByServerMsgId(I.mid)];case 1:return Ot.sent(),[4,(W=(ge=this._localCache)===null||ge===void 0?void 0:ge.getInstance())===null||W===void 0?void 0:W.getConversationLastMessage(I.to,bt)];case 2:return ut=Ot.sent(),[4,(ct=(lt=this._localCache)===null||lt===void 0?void 0:lt.getInstance())===null||ct===void 0?void 0:ct.updateLocalConversation((0,b.MQ)({conversationId:I.to,conversationType:bt}),{lastMessageId:ut?.serverMsgId})];case 3:Ot.sent(),Ot.label=4;case 4:return(It=I?.success)===null||It===void 0||It.call(I,Vt),[3,6];case 5:return Ot.sent(),(Ct=I?.success)===null||Ct===void 0||Ct.call(I,Vt),[3,6];case 6:return[2]}})})},fail:I.fail};return R.kg.debug("Call recallMessage",I),this.mSync.send(rt,this)}function Ze(I){var X=I||{},_t=X.messageId,K=X.modifiedMessage;if(R.kg.debug("Call modifyMessage",_t,K),_t==="")throw Error('Invalid parameter: "messageId"');if(K.type!=="txt")throw Error('Invalid parameter: "modifiedMessage.type"');return this.mSync.send(z({editMessageId:_t},K))}function ee(I){return S(this,void 0,void 0,function(){var X,_t,K,dt,bt,rt,Vt,ut,Kt;return F(this,function(jt){switch(jt.label){case 0:if(typeof I.messageId!="string"||!I.messageId)throw Error("Invalid parameter messageId: ".concat(I.messageId));if(typeof I.reaction!="string"||!I.reaction)throw Error("Invalid parameter reaction: ".concat(I.reaction));return f.XZ.call(this)?(_t=this.context,K=_t.orgName,dt=_t.appName,bt=_t.accessToken,rt=I.reaction,Vt=I.messageId,ut={msgId:Vt,message:rt},Kt={url:"".concat(this.apiUrl,"/").concat(K,"/").concat(dt,"/reaction/user/").concat(this.user),type:"POST",data:JSON.stringify(ut),dataType:"json",headers:{Authorization:"Bearer "+bt,"Content-Type":"application/json"}},[4,_.hj.call(this,Kt)]):(X=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(X)]);case 1:return jt.sent(),[2]}})})}function be(I){return S(this,void 0,void 0,function(){var X,_t,K,dt,bt,rt,Vt,ut;return F(this,function(Kt){switch(Kt.label){case 0:if(typeof I.reaction!="string"||!I.reaction)throw Error("Invalid parameter reactionId: ".concat(I.reaction));return f.XZ.call(this)?(_t=this.context,K=_t.orgName,dt=_t.appName,bt=_t.accessToken,rt=I.messageId,Vt=I.reaction,ut={url:"".concat(this.apiUrl,"/").concat(K,"/").concat(dt,"/reaction/user/").concat(this.user,"?msgId=").concat(rt,"&message=").concat(Vt),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+bt,"Content-Type":"application/json"}},[4,_.hj.call(this,ut)]):(X=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(X)]);case 1:return Kt.sent(),[2]}})})}function We(I){if(typeof I.chatType!="string"||!I.chatType)throw Error("Invalid parameter chatType: ".concat(I.chatType));if(!I.messageId)throw Error("Invalid parameter messageId: ".concat(I.messageId));if(!f.XZ.call(this)){var X=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(X)}var _t=this.context,K=_t.orgName,dt=_t.appName,bt=_t.accessToken,rt=I.chatType,Vt=I.messageId,ut={msgIdList:typeof Vt=="string"?[Vt]:Vt,msgType:rt==="singleChat"?"chat":"groupchat",groupId:I.groupId||null},Kt={url:"".concat(this.apiUrl,"/").concat(K,"/").concat(dt,"/reaction/user/").concat(this.user),type:"GET",data:ut,dataType:"json",headers:{Authorization:"Bearer "+bt,"Content-Type":"application/json"}};return _.hj.call(this,Kt).then(function(jt){var ge=jt.data;return ge?.forEach(function(W){W?.reactionList.forEach(function(lt){lt.isAddedBySelf=lt.state,delete lt.state,delete lt.reactionId})}),jt})}var Pe=We;function Ee(I){if(typeof I.reaction!="string"||!I.reaction)throw Error("Invalid parameter reaction: ".concat(I.reaction));if(typeof I.messageId!="string"||!I.messageId)throw Error("Invalid parameter messageId: ".concat(I.messageId));if(!f.XZ.call(this)){var X=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(X)}var _t=this.context,K=_t.orgName,dt=_t.appName,bt=_t.accessToken,rt=I.cursor,Vt=I.pageSize,ut={msgId:I.messageId,message:I.reaction,currentPage:rt||null,pageSize:Vt||20},Kt={url:"".concat(this.apiUrl,"/").concat(K,"/").concat(dt,"/reaction/user/").concat(this.user,"/detail"),type:"GET",data:ut,dataType:"json",headers:{Authorization:"Bearer "+bt,"Content-Type":"application/json"}};return _.hj.call(this,Kt).then(function(jt){return jt.data.isAddedBySelf=jt.data.state,delete jt.data.state,delete jt.data.reactionId,jt})}function te(I){return S(this,void 0,void 0,function(){var X,_t,K,dt,bt,rt,Vt,ut,Kt,jt,ge;return F(this,function(W){switch(W.label){case 0:if(typeof I.reportType!="string"||!I.reportType)throw Error("Invalid parameter reportType: ".concat(I.reportType));if(typeof I.messageId!="string"||!I.messageId)throw Error("Invalid parameter messageId: ".concat(I.messageId));if(typeof I.reportReason!="string"||!I.reportReason)throw Error("Invalid parameter messageId: ".concat(I.reportReason));return f.XZ.call(this)?(_t=this.context,K=_t.orgName,dt=_t.appName,bt=_t.accessToken,rt=I.reportType,Vt=I.reportReason,ut=I.messageId,Kt={username:this.user,reportType:rt,reportReason:Vt},jt="".concat(this.apiUrl,"/").concat(K,"/").concat(dt,"/user/").concat(this.user,"/moderation/report/message/").concat(ut),ge={url:jt,type:"POST",data:JSON.stringify(Kt),dataType:"json",headers:{Authorization:"Bearer "+bt,"Content-Type":"application/json"}},[4,_.hj.call(this,ge)]):(X=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(X)]);case 1:return W.sent(),[2]}})})}function Ae(I){var X;return S(this,void 0,void 0,function(){var _t,K,dt,bt,rt,Vt,ut,Kt,jt;return F(this,function(ge){switch(ge.label){case 0:if(typeof I.targetId!="string"||I.targetId==="")throw Error('"Invalid parameter targetId": '+I.targetId);if(!["singleChat","groupChat","chatRoom"].includes(I.chatType))throw Error('"Invalid parameter chatType": '+I.chatType);if(I.beforeTimeStamp&&(typeof I.beforeTimeStamp!="number"||I.beforeTimeStamp<0||((X=I.beforeTimeStamp)===null||X===void 0?void 0:X.toString().length)>18))throw Error('"Invalid parameter beforeTimeStamp": '+I.beforeTimeStamp);if(I.messageIds&&!(Array.isArray(I.messageIds)&&I.messageIds.length>0&&I.messageIds.length<=20))throw Error('"Invalid parameter messageIds": '+I.messageIds);if(!I.messageIds&&!I.beforeTimeStamp)throw Error("messageIds or beforeTimeStamp field is required.");return f.XZ.call(this)?(K=this.context,dt=K.orgName,bt=K.appName,rt=K.userId,Vt=I.chatType==="singleChat"?"userId":"groupId",ut=I.chatType==="singleChat"?"chat":"group",Kt=I.messageIds?"".concat(this.apiUrl,"/").concat(dt,"/").concat(bt,"/sdk/message/roaming/").concat(ut,"/user/").concat(rt,"?").concat(Vt,"=").concat(I.targetId,"&msgIdList=").concat(I.messageIds,"&resource=").concat(this.clientResource):"".concat(this.apiUrl,"/").concat(dt,"/").concat(bt,"/sdk/message/roaming/").concat(ut,"/user/").concat(rt,"/time?").concat(Vt,"=").concat(I.targetId,"&delTime=").concat(I.beforeTimeStamp,"&&resource=").concat(this.clientResource),jt={url:Kt,dataType:"json",type:"DELETE",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}},R.kg.debug("Call removeHistoryMessages",I),[4,_.hj.call(this,jt)]):(_t=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(_t)]);case 1:return ge.sent(),[2]}})})}function Xe(I){var X=this;if(!f.XZ.call(this)){var _t=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(_t)}if(I?.pageSize&&typeof I.pageSize!="number")throw Error("Invalid parameter pageSize: ".concat(I.pageSize));if(I?.cursor&&typeof I.cursor!="string")throw Error("Invalid parameter cursor: ".concat(I.cursor));var K=this.context,dt=K.orgName,bt=K.appName,rt=K.accessToken,Vt={url:"".concat(this.apiUrl,"/").concat(dt,"/").concat(bt,"/sdk/user/").concat(this.user,"/user_channels/list?"),type:"GET",dataType:"json",data:{limit:I?.pageSize||20,cursor:I?.cursor||"",need_mark:!0},headers:{Authorization:"Bearer "+rt,"Content-Type":"application/json"}};return R.kg.debug("Call getServerConversations",I),new Promise(function(ut,Kt){_.hj.call(X,Vt,D.fI.GET_SESSION_LIST).then(function(jt){return S(X,void 0,void 0,function(){var ge,W,lt=this;return F(this,function(ct){switch(ct.label){case 0:return ge=Be.call(this,jt),this._localCache?(W=ge.data.conversations.map(function(It){return S(lt,void 0,void 0,function(){var Ct,Ot,Mt,qt;return F(this,function(he){switch(he.label){case 0:return[4,(Ot=(Ct=this._localCache)===null||Ct===void 0?void 0:Ct.getInstance())===null||Ot===void 0?void 0:Ot.storeMessage(It.lastMessage,k.r.SUCCESS,!0)];case 1:return he.sent(),[4,(qt=(Mt=this._localCache)===null||Mt===void 0?void 0:Mt.getInstance())===null||qt===void 0?void 0:qt.updateLocalConversation((0,b.MQ)({conversationId:It.conversationId,conversationType:It.conversationType}),{unReadCount:It.unReadCount})];case 2:return he.sent(),[2]}})})}),[4,Promise.all(W)]):[3,2];case 1:ct.sent(),ct.label=2;case 2:return ut(ge),[2]}})})}).catch(function(jt){Kt(jt)})})}function Be(I){var X=this,_t=I.data,K=_t.cursor,dt=_t.channel_infos,bt=[];dt?.forEach(function(Vt){var ut=null;Vt?.meta&&JSON.stringify(Vt.meta)!=="{}"&&(Vt.meta.payload=JSON.parse(Vt.meta.payload),(ut=P.w.call(X,Vt.meta)).type!=="delivery"&&ut.type!=="read"&&ut.type!=="channel"&&(ut.chatType=P.U[ut.chatType]));var Kt={conversationId:Vt.session_to,conversationType:Vt.session_type==="chat"?"singleChat":"groupChat",isPinned:Vt.is_top,pinnedTime:Vt.is_top?Vt.update_top_status_time:0,unReadCount:Vt.unread_num,lastMessage:ut};Vt.marks&&(Kt.marks=Vt.marks.map(function(jt){return E.Z[jt]})),bt.push(Kt)});var rt={conversations:bt,cursor:K||""};return{type:I.type,data:rt}}function ze(I){var X=this;if(!f.XZ.call(this)){var _t=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(_t)}if(I?.pageSize&&typeof I.pageSize!="number")throw Error("Invalid parameter pageSize: ".concat(I.pageSize));if(I?.cursor&&typeof I.cursor!="string")throw Error("Invalid parameter cursor: ".concat(I.cursor));var K=this.context,dt=K.orgName,bt=K.appName,rt=K.accessToken,Vt={url:"".concat(this.apiUrl,"/").concat(dt,"/").concat(bt,"/sdk/user/").concat(this.user,"/user_channels/list?"),type:"GET",dataType:"json",data:{limit:I?.pageSize||20,cursor:I?.cursor||"",is_top:!0,need_mark:!0},headers:{Authorization:"Bearer "+rt,"Content-Type":"application/json"}};return R.kg.debug("Call getServerPinnedConversations",I),_.hj.call(this,Vt,D.fI.GET_SESSION_LIST).then(function(ut){return Be.call(X,ut)})}function ot(I){return S(this,void 0,void 0,function(){var X,_t,K,dt,bt,rt,Vt,ut,Kt,jt,ge,W,lt,ct;return F(this,function(It){if(!f.XZ.call(this))return X=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(X)];if(_t=I.conversationId,K=I.conversationType,dt=I.isPinned,bt=K==="singleChat"?"chat":"groupChat",typeof _t!="string"||_t==="")throw Error("Invalid parameter conversationId: ".concat(_t));if(!["singleChat","groupChat"].includes(K))throw Error("Invalid parameter conversationType: ".concat(K));if(typeof dt!="boolean")throw Error("Invalid parameter isPinned: ".concat(dt));return rt=this.context,Vt=rt.orgName,ut=rt.appName,Kt=rt.accessToken,jt=rt.jid,ge={type:bt,to:_t},W=dt?"":"type=".concat(bt,"&to=").concat(_t,"&"),lt="".concat(this.apiUrl,"/").concat(Vt,"/").concat(ut,"/sdk/user/").concat(this.user,"/user_channel/top?").concat(W,"resource=").concat(jt.clientResource),ct={url:lt,type:dt?"POST":"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Kt,"Content-Type":"application/json"}},dt&&(ct.data=JSON.stringify(ge)),R.kg.debug("Call pinConversation",I),[2,_.hj.call(this,ct,D.fI.PIN_CONVERSATION).then(function(Ct){var Ot=Ct.type,Mt=Ct.data;return{type:Ot,data:{isPinned:Mt.is_top||!1,pinnedTime:Mt.is_top?Mt.update_top_status_time:0}}})]})})}function Et(I){return S(this,void 0,void 0,function(){var X,_t,K,dt,bt,rt,Vt,ut,Kt,jt;return F(this,function(ge){switch(ge.label){case 0:if(X=I.userId,_t=I.remark,!f.XZ.call(this))return K=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(K)];if(typeof X!="string"||X==="")throw Error('Invalid parameter: "userId"');if(typeof _t!="string")throw Error('Invalid parameter: "remark"');return R.kg.debug("Call setContactRemark",I),dt=this.context,bt=dt.orgName,rt=dt.appName,Vt=dt.accessToken,ut=dt.jid,Kt="".concat(this.apiUrl,"/").concat(bt,"/").concat(rt,"/users/").concat(this.context.userId,"/contacts/users/").concat(X,"?resource=").concat(ut.clientResource),jt={url:Kt,type:"PUT",data:JSON.stringify({remark:_t}),dataType:"json",headers:{Authorization:"Bearer "+Vt,"Content-Type":"application/json"}},[4,_.hj.call(this,jt,D.fI.ROSTER_SET_CONTACT_REMARK)];case 1:return ge.sent(),[2]}})})}function nt(){if(!f.XZ.call(this)){var I=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(I)}var X=this.context,_t=X.orgName,K=X.appName,dt=X.accessToken,bt={url:"".concat(this.apiUrl,"/").concat(_t,"/").concat(K,"/users/").concat(this.user,"/contacts/users?needReturnRemark=true"),dataType:"json",type:"GET",headers:{Authorization:"Bearer "+dt}};return R.kg.debug("Call getAllContacts"),_.hj.call(this,bt,D.fI.ROSTER_GET_ALL_CONTACTS_REMARKS).then(function(rt){var Vt=(rt?.entities||[]).map(function(ut){return{userId:ut.username,remark:ut.remark}});return{type:rt.type,data:Vt}})}function Dt(I){if(!f.XZ.call(this)){var X=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(X)}R.kg.debug("Call getContactsWithCursor",I);var _t=I||{},K=_t.pageSize,dt=K===void 0?20:K,bt=_t.cursor,rt=bt===void 0?"":bt;if(dt&&typeof dt!="number")throw Error("Invalid parameter pageSize: ".concat(I.pageSize));var Vt=this.context,ut=Vt.orgName,Kt=Vt.appName,jt=Vt.accessToken,ge={url:"".concat(this.apiUrl,"/").concat(ut,"/").concat(Kt,"/users/").concat(this.user,"/contacts?needReturnRemark=true&limit=").concat(dt,"&cursor=").concat(rt),dataType:"json",type:"GET",headers:{Authorization:"Bearer "+jt}};return _.hj.call(this,ge,D.fI.ROSTER_GET_ALL_CONTACTS_REMARKS_FROM_SERVER_BY_PAGE).then(function(W){var lt,ct,It=((lt=W?.data)===null||lt===void 0?void 0:lt.contacts)||[],Ct=((ct=W?.data)===null||ct===void 0?void 0:ct.cursor)||"",Ot=It.map(function(Mt){return{userId:Mt.username,remark:Mt.remark}});return{type:W.type,data:{cursor:Ct,contacts:Ot}}})}function B(I){return S(this,void 0,void 0,function(){var X,_t,K,dt,bt,rt,Vt,ut,Kt,jt,ge,W,lt,ct,It;return F(this,function(Ct){switch(Ct.label){case 0:if(!f.XZ.call(this))return X=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(X)];if(R.kg.debug("Call markConversation",I),K=(_t=I||{}).conversations,dt=K===void 0?[]:K,bt=_t.mark,rt=_t.isMarked,!Array.isArray(dt))throw Error("Invalid parameter conversations");if(Vt=dt.map(function(Ot){if(!Ot.conversationId||!["singleChat","groupChat"].includes(Ot.conversationType))throw Error("Invalid parameter conversations");return{to:Ot.conversationId,type:M[Ot.conversationType]}}),typeof rt!="boolean")throw Error("Invalid parameter isMarked: ".concat(rt));if(typeof bt!="number")throw Error("Invalid parameter mark: ".concat(bt));return ut=this.context,Kt=ut.orgName,jt=ut.appName,ge=ut.accessToken,W=ut.userId,lt=ut.jid,ct={mark:E.Z[bt],targets:Vt},It={url:"".concat(this.apiUrl,"/").concat(Kt,"/").concat(jt,"/sdk/user/").concat(W,"/user_channels/mark?resource=").concat(lt.clientResource),dataType:"json",data:JSON.stringify(ct),type:rt?"Post":"Delete",headers:{Authorization:"Bearer "+ge}},[4,_.hj.call(this,It,D.fI.MARK_CONVERSATION).then(function(Ot){var Mt,qt=((Mt=Ot.data)===null||Mt===void 0?void 0:Mt.ignore)||[];qt&&Array.isArray(qt)&&qt.length>0&&R.kg.debug("markConversation has ignored conversations",qt.map(function(he){return{conversationId:he.to,conversationType:P.U[he.type]}}))})];case 1:return Ct.sent(),[2]}})})}function Ft(I){return S(this,void 0,void 0,function(){var X,_t;return F(this,function(K){return R.kg.debug("Call addConversationMark",I),X=I.conversations,_t=I.mark,[2,B.call(this,{conversations:X,mark:_t,isMarked:!0})]})})}function St(I){return S(this,void 0,void 0,function(){var X,_t;return F(this,function(K){return R.kg.debug("Call removeConversationMark",I),X=I.conversations,_t=I.mark,[2,B.call(this,{conversations:X,mark:_t,isMarked:!1})]})})}function Nt(I){var X,_t,K=this;if(!f.XZ.call(this)){var dt=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(dt)}if(R.kg.debug("Call getServerConversationsByFilter",I),I?.pageSize&&typeof I.pageSize!="number")throw Error("Invalid parameter pageSize: ".concat(I.pageSize));if(I?.cursor&&typeof I.cursor!="string")throw Error("Invalid parameter cursor: ".concat(I.cursor));if(typeof((X=I?.filter)===null||X===void 0?void 0:X.mark)!="number")throw Error("Invalid parameter mark: ".concat((_t=I?.filter)===null||_t===void 0?void 0:_t.mark));var bt=this.context,rt=bt.orgName,Vt=bt.appName,ut=bt.accessToken,Kt="".concat(this.apiUrl,"/").concat(rt,"/").concat(Vt,"/sdk/user/").concat(this.user,"/user_channels/mark/search?"),jt=I.pageSize,ge=I.cursor,W=(I?.filter||{}).mark,lt={url:Kt,type:"GET",dataType:"json",data:{limit:jt||10,cursor:ge||"",need_mark:!0,mark:E.Z[W]},headers:{Authorization:"Bearer "+ut,"Content-Type":"application/json"}};return _.hj.call(this,lt,D.fI.GET_SESSION_LIST).then(function(ct){return Be.call(K,ct)})}function Ut(){if(!f.XZ.call(this)){var I=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(I)}R.kg.debug("Call getSelfIdsOnOtherPlatform");var X=this.context,_t=X.orgName,K=X.appName,dt=X.accessToken,bt=X.userId,rt=X.jid,Vt={url:"".concat(this.apiUrl,"/").concat(_t,"/").concat(K,"/users/").concat(bt,"/resources"),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+dt,"Content-Type":"application/json"}};return _.hj.call(this,Vt,D.fI.USER_LOGGEDIN_OTHER_PLATFORM).then(function(ut){var Kt,jt=(Kt=ut.data)===null||Kt===void 0?void 0:Kt.filter(function(W){return W.res!==rt.clientResource}),ge=jt?.map(function(W){return"".concat(bt,"/").concat(W.res)});return{type:ut.type,data:ge}})}function Xt(){var I,X,_t,K,dt,bt;return S(this,void 0,void 0,function(){var rt,Vt,ut,Kt,jt,ge,W,lt,ct;return F(this,function(It){switch(It.label){case 0:return f.XZ.call(this)?(R.kg.debug("Call deleteAllMessagesAndConversations"),Vt=this.context,ut=Vt.orgName,Kt=Vt.appName,jt=Vt.accessToken,ge=Vt.userId,W=Vt.jid,lt="".concat(this.apiUrl,"/").concat(ut,"/").concat(Kt,"/sdk/message/roaming/user/").concat(ge,"/delete/all?resource=").concat(W.clientResource),ct={url:lt,type:"POST",dataType:"json",headers:{Authorization:"Bearer "+jt,"Content-Type":"application/json"}},[4,_.hj.call(this,ct,D.fI.REST_DELETE_MESSAGES_CONVERSATIONS)]):(rt=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(rt)]);case 1:return It.sent(),(X=(I=this._localCache)===null||I===void 0?void 0:I.getInstance())===null||X===void 0||X.clearConversationMap(),[4,(K=(_t=this._localCache)===null||_t===void 0?void 0:_t.getInstance())===null||K===void 0?void 0:K.clearStoreData("conversationList")];case 2:return It.sent(),[4,(bt=(dt=this._localCache)===null||dt===void 0?void 0:dt.getInstance())===null||bt===void 0?void 0:bt.clearStoreData("message")];case 3:return It.sent(),[2]}})})}function Gt(I){return S(this,void 0,void 0,function(){var X,_t,K,dt,bt,rt,Vt,ut,Kt,jt,ge,W,lt,ct,It;return F(this,function(Ct){switch(Ct.label){case 0:if(!f.XZ.call(this))return X=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(X)];if(R.kg.debug("Call setMessagePinStatus",I),K=(_t=I||{}).conversationId,dt=K===void 0?"":K,bt=_t.conversationType,rt=_t.messageId,Vt=_t.isPinned,typeof dt!="string"||dt==="")throw Error("Invalid parameter conversationId");if(typeof rt!="string"||rt==="")throw Error("Invalid parameter messageId");if(typeof Vt!="boolean")throw Error("Invalid parameter isPinned");return ut=this.context,Kt=ut.orgName,jt=ut.appName,ge=ut.accessToken,W=ut.userId,lt=ut.jid,ct={to:dt,type:M[bt],pin_msg_id:rt},It={url:"".concat(this.apiUrl,"/").concat(Kt,"/").concat(jt,"/sdk/user/").concat(W,"/user_channel/pin?resource=").concat(lt.clientResource),dataType:"json",data:JSON.stringify(ct),type:Vt?"Post":"Delete",headers:{Authorization:"Bearer "+ge}},[4,_.hj.call(this,It,D.fI.REST_PIN_MESSAGE)];case 1:return Ct.sent(),[2]}})})}function ne(I){return S(this,void 0,void 0,function(){var X,_t,K,dt;return F(this,function(bt){return R.kg.debug("Call pinMessage",I),_t=(X=I||{}).conversationType,K=X.conversationId,dt=X.messageId,[2,Gt.call(this,{conversationId:K,conversationType:_t,messageId:dt,isPinned:!0})]})})}function Re(I){return S(this,void 0,void 0,function(){var X,_t,K,dt;return F(this,function(bt){return R.kg.debug("Call unpinMessage",I),_t=(X=I||{}).conversationType,K=X.conversationId,dt=X.messageId,[2,Gt.call(this,{conversationId:K,conversationType:_t,messageId:dt,isPinned:!1})]})})}function pe(I){var X=this;if(!f.XZ.call(this)){var _t=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(_t)}R.kg.debug("Call getServerPinnedMessages",I);var K=I.conversationId,dt=I.conversationType,bt=I.pageSize,rt=I.cursor;if(typeof K!="string"||K==="")throw Error("Invalid parameter conversationId");if(bt&&typeof bt!="number")throw Error("Invalid parameter pageSize: ".concat(bt));if(rt&&typeof rt!="string")throw Error("Invalid parameter cursor: ".concat(rt));var Vt=this.context,ut=Vt.orgName,Kt=Vt.appName,jt=Vt.accessToken,ge={url:"".concat(this.apiUrl,"/").concat(ut,"/").concat(Kt,"/sdk/user/").concat(this.user,"/user_channel/pin"),type:"GET",dataType:"json",data:{to:K,type:M[dt],limit:bt||10,cursor:rt||""},headers:{Authorization:"Bearer "+jt,"Content-Type":"application/json"}};return _.hj.call(this,ge,D.fI.GET_SESSION_LIST).then(function(W){return{type:0,data:{list:W.data.msg_infos.map(function(lt){lt.message.payload=JSON.parse(lt.message.payload);var ct=lt.message,It=lt.pin_opt_at,Ct=lt.pin_operator;return{message:P.w.call(X,ct,{formatChatType:!0}),pinTime:It,operatorId:Ct}}),cursor:W.data.cursor||""}}})}function Je(){var I=this;R.kg.debug("Call unbindPushToken");var X={deviceId:this.clientResource,deviceToken:"",notifierName:this.pushCertificateName};return j.r.call(this,X).then(function(_t){return I.isRegisterPush=!1,_t})}},3770:function(O,H,a){a.r(H),a.d(H,{getPresenceStatus:function(){return b},getSubscribedPresenceList:function(){return P},getSubscribedPresencelist:function(){return k},publishPresence:function(){return A},subscribePresence:function(){return R},unsubscribePresence:function(){return D}}),a(1539),a(8674),a(2526),a(1817),a(2165),a(6992),a(8783),a(3948),a(2222),a(9753);var f=a(4024),h=a(3246),g=a(7252),_=a(5531),E=a(7360),m=function(j,z,S,F){return new(S||(S=Promise))(function(M,Z){function U(V){try{q(F.next(V))}catch(it){Z(it)}}function Y(V){try{q(F.throw(V))}catch(it){Z(it)}}function q(V){var it;V.done?M(V.value):(it=V.value,it instanceof S?it:new S(function(mt){mt(it)})).then(U,Y)}q((F=F.apply(j,[])).next())})},p=function(j,z){var S,F,M,Z,U={label:0,sent:function(){if(1&M[0])throw M[1];return M[1]},trys:[],ops:[]};return Z={next:Y(0),throw:Y(1),return:Y(2)},typeof Symbol=="function"&&(Z[Symbol.iterator]=function(){return this}),Z;function Y(q){return function(V){return function(it){if(S)throw new TypeError("Generator is already executing.");for(;U;)try{if(S=1,F&&(M=2&it[0]?F.return:it[0]?F.throw||((M=F.return)&&M.call(F),0):F.next)&&!(M=M.call(F,it[1])).done)return M;switch(F=0,M&&(it=[2&it[0],M.value]),it[0]){case 0:case 1:M=it;break;case 4:return U.label++,{value:it[1],done:!1};case 5:U.label++,F=it[1],it=[0];continue;case 7:it=U.ops.pop(),U.trys.pop();continue;default:if(!((M=(M=U.trys).length>0&&M[M.length-1])||it[0]!==6&&it[0]!==2)){U=0;continue}if(it[0]===3&&(!M||it[1]>M[0]&&it[1]<M[3])){U.label=it[1];break}if(it[0]===6&&U.label<M[1]){U.label=M[1],M=it;break}if(M&&U.label<M[2]){U.label=M[2],U.ops.push(it);break}M[2]&&U.ops.pop(),U.trys.pop();continue}it=z.call(j,U)}catch(mt){it=[6,mt],F=0}finally{S=M=0}if(5&it[0])throw it[1];return{value:it[0]?it[1]:void 0,done:!0}}([q,V])}}};function A(j){return m(this,void 0,void 0,function(){var z,S,F,M,Z,U,Y,q,V;return p(this,function(it){switch(it.label){case 0:if(typeof j.description!="string")throw Error('Invalid parameter: "description"');return h.XZ.call(this)?(S=this.context,F=S.accessToken,M=S.orgName,Z=S.appName,U=S.userId,Y=this.context.jid.clientResource,q={ext:j.description},V={url:"".concat(this.apiUrl,"/").concat(M,"/").concat(Z,"/users/").concat(U,"/presence/").concat(Y,"/1"),type:"POST",dataType:"json",data:JSON.stringify(q),headers:{Authorization:"Bearer "+F,"Content-Type":"application/json"},success:j.success,error:j.error},E.kg.debug("Call publishPresence:",j),[4,f.hj.call(this,V)]):(z=g.Z.create({type:_.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(z)]);case 1:return it.sent(),[2]}})})}function R(j){if(!Array.isArray(j.usernames))throw Error('Invalid parameter: "usernames"');if(!j.usernames.length)throw Error('"usernames" can not be empty');if(typeof j.expiry!="number")throw Error('Invalid parameter: "expiry"');if(!h.XZ.call(this)){var z=g.Z.create({type:_.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(z)}var S=this.context,F=S.orgName,M=S.appName,Z=S.userId,U=S.accessToken,Y={usernames:j.usernames},q={url:"".concat(this.apiUrl,"/").concat(F,"/").concat(M,"/users/").concat(Z,"/presence/").concat(j.expiry),type:"POST",dataType:"json",data:JSON.stringify(Y),headers:{Authorization:"Bearer "+U,"Content-Type":"application/json"},success:j.success,error:j.error};return E.kg.debug("Call subscribePresence:",j),f.hj.call(this,q).then(function(V){return V.data={result:V?.result},V})}function D(j){return m(this,void 0,void 0,function(){var z,S,F,M,Z,U,Y;return p(this,function(q){switch(q.label){case 0:if(!Array.isArray(j.usernames))throw Error('Invalid parameter: "usernames"');if(!j.usernames.length)throw Error('"usernames" can not be empty');return h.XZ.call(this)?(S=this.context,F=S.orgName,M=S.appName,Z=S.userId,U=S.accessToken,Y={url:"".concat(this.apiUrl,"/").concat(F,"/").concat(M,"/users/").concat(Z,"/presence"),type:"DELETE",dataType:"json",data:JSON.stringify(j.usernames),headers:{Authorization:"Bearer "+U,"Content-Type":"application/json"},success:j.success,error:j.error},E.kg.debug("Call unsubscribePresence:",j),[4,f.hj.call(this,Y)]):(z=g.Z.create({type:_.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(z)]);case 1:return q.sent(),[2]}})})}function P(j){if(typeof j.pageNum!="number"||typeof j.pageSize!="number")throw Error('Invalid parameter: "pageNum or pageSize"');if(j.pageNum<0||j.pageSize<0)throw Error('"pageNum" should >= 0 and "pageSize" should >= 0');if(!h.XZ.call(this)){var z=g.Z.create({type:_.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(z)}var S=this.context,F=S.orgName,M=S.appName,Z=S.userId,U=S.accessToken,Y={url:"".concat(this.apiUrl,"/").concat(F,"/").concat(M,"/users/").concat(Z,"/presence/sublist?pageNum=").concat(j.pageNum,"&pageSize=").concat(j.pageSize),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+U,"Content-Type":"application/json"},success:j.success,error:j.error};return E.kg.debug("Call getSubscribedPresenceList:",j),f.hj.call(this,Y).then(function(q){return q.data={result:q?.result},q})}var k=P;function b(j){if(!Array.isArray(j.usernames))throw Error('Invalid parameter: "usernames"');if(!j.usernames.length)throw Error('"usernames" can not be empty');if(!h.XZ.call(this)){var z=g.Z.create({type:_.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(z)}var S={usernames:j.usernames},F=this.context,M=F.orgName,Z=F.appName,U=F.userId,Y=F.accessToken,q={url:"".concat(this.apiUrl,"/").concat(M,"/").concat(Z,"/users/").concat(U,"/presence"),type:"POST",dataType:"json",data:JSON.stringify(S),headers:{Authorization:"Bearer "+Y,"Content-Type":"application/json"},success:j.success,error:j.error};return E.kg.debug("Call getPresenceStatus:",j),f.hj.call(this,q).then(function(V){return V.data={result:V?.result},V})}},6801:function(O,H,a){a.d(H,{r:function(){return p}}),a(1539),a(8674),a(2222),a(4812);var f=a(3246),h=a(5531),g=a(7252),_=a(4024),E=a(7360),m=a(1595);function p(A){if(typeof A.deviceId!="string"||A.deviceId==="")throw Error('Invalid parameter: "deviceId"');if(!f.XZ.call(this)){var R=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(R)}var D=this.context,P=D.orgName,k=D.appName,b=D.accessToken,j={url:"".concat(this.apiUrl,"/").concat(P,"/").concat(k,"/users/").concat(this.user),type:"PUT",data:JSON.stringify({device_id:A.deviceId,device_token:A.deviceToken,notifier_name:A.notifierName}),dataType:"json",headers:{Authorization:"Bearer "+b,"Content-Type":"application/json"},success:A.success,error:A.error};E.kg.debug("Call uploadPushTokenToServer",A);var z=_.hj.bind(this,j,m.fI.UPLOAD_PUSH_TOKEN);return _.P6.retryPromise(z).then(function(S){var F=S.entities[0]||{};return{type:S.type,data:F}})}},1735:function(O,H,a){a.r(H),a.d(H,{clearRemindTypeForConversation:function(){return R},getPushPerformLanguage:function(){return b},getSilentModeForAll:function(){return p},getSilentModeForConversation:function(){return D},getSilentModeForConversations:function(){return P},getSilentModeRemindTypeConversations:function(){return j},setPushPerformLanguage:function(){return k},setSilentModeForAll:function(){return m},setSilentModeForConversation:function(){return A}}),a(7941),a(1539),a(8674),a(2222),a(9753),a(9554),a(4747),a(9600),a(1249);var f=a(4024),h=a(3246),g=a(7252),_=a(5531),E=a(7360);function m(z){if(!(z.options instanceof Object))throw Error('Invalid parameter: "options"');var S=z.options.paramType;if(typeof S!="number"||S<0||S>2)throw Error('Invalid parameter: "options of paramType"');if(S===0){if(typeof z.options.remindType!="string")throw Error('Invalid parameter: "options of remindType"')}else if(S===1){if(typeof z.options.duration!="number")throw Error('Invalid parameter: "options of duration"')}else if(S===2){var F=z.options,M=F.startTime,Z=F.endTime;if(!(M instanceof Object&&Object.keys(M).length))throw Error('Invalid parameter: "options of startTime"');if(!M.hours||typeof M.hours!="number"||!M.minutes||typeof M.minutes!="number")throw Error('Invalid parameter: "options of startTime of hours or minutes"');if(!(Z instanceof Object&&Object.keys(Z).length))throw Error('Invalid parameter: "options of endTime"');if(!Z.hours||typeof Z.hours!="number"||!Z.minutes||typeof Z.minutes!="number")throw Error('Invalid parameter: "options of endTime of hours or minutes"')}if(!h.XZ.call(this)){var U=g.Z.create({type:_.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(U)}var Y=this.context,q=Y.accessToken,V=Y.orgName,it=Y.appName,mt=Y.userId,wt=Y.jid,yt={};switch(S){case 0:yt={type:z.options.remindType};break;case 1:yt={ignoreDuration:z.options.duration};break;case 2:var Ht=z.options;M=Ht.startTime,Z=Ht.endTime,yt={ignoreInterval:"".concat(M.hours,":").concat(M.minutes,"-").concat(Z.hours,":").concat(Z.minutes)}}var Yt={url:"".concat(this.apiUrl,"/").concat(V,"/").concat(it,"/users/").concat(mt,"/notification/user/").concat(mt,"?resource=").concat(wt.clientResource),type:"PUT",dataType:"json",data:JSON.stringify(yt),headers:{Authorization:"Bearer "+q,"Content-Type":"application/json"},success:z.success,error:z.error};return E.kg.debug("Call setSilentModeForAll:",z),f.hj.call(this,Yt)}function p(z){if(!h.XZ.call(this)){var S=g.Z.create({type:_.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(S)}var F=this.context,M=F.accessToken,Z=F.orgName,U=F.appName,Y=F.userId,q={url:"".concat(this.apiUrl,"/").concat(Z,"/").concat(U,"/users/").concat(Y,"/notification/user/").concat(Y),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+M,"Content-Type":"application/json"},success:z?.success,error:z?.error};return E.kg.debug("Call getSilentModeForAll:",z),f.hj.call(this,q)}function A(z){if(typeof z.conversationId!="string"||!z.conversationId)throw Error('Invalid parameter: "conversationId"');if(typeof z.type!="string"||!z.type)throw Error('Invalid parameter: "type"');if(!(z.options instanceof Object))throw Error('Invalid parameter: "options"');var S=z.options.paramType;if(typeof S!="number"||S<0||S>2)throw Error('Invalid parameter: "options of paramType"');if(S===0){if(typeof z.options.remindType!="string")throw Error('Invalid parameter: "options of remindType"')}else if(S===1){if(typeof z.options.duration!="number")throw Error('Invalid parameter: "options of duration"')}else if(S===2){var F=z.options,M=F.startTime,Z=F.endTime;if(!(M instanceof Object&&Object.keys(M).length))throw Error('Invalid parameter: "options of startTime"');if(!M.hours||typeof M.hours!="number"||!M.minutes||typeof M.minutes!="number")throw Error('Invalid parameter: "options of startTime of hours or minutes"');if(!(Z instanceof Object&&Object.keys(Z).length))throw Error('Invalid parameter: "options of endTime"');if(!Z.hours||typeof Z.hours!="number"||!Z.minutes||typeof Z.minutes!="number")throw Error('Invalid parameter: "options of endTime of hours or minutes"')}if(!h.XZ.call(this)){var U=g.Z.create({type:_.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(U)}var Y=this.context,q=Y.accessToken,V=Y.orgName,it=Y.appName,mt=Y.userId,wt=Y.jid,yt="chatgroup",Ht={};switch(S){case 0:Ht={type:z.options.remindType};break;case 1:Ht={ignoreDuration:z.options.duration};break;case 2:var Yt=z.options;M=Yt.startTime,Z=Yt.endTime,Ht={ignoreInterval:"".concat(M.hours,":").concat(M.minutes,"-").concat(Z.hours,":").concat(Z.minutes)}}z.type==="singleChat"&&(yt="user");var At={url:"".concat(this.apiUrl,"/").concat(V,"/").concat(it,"/users/").concat(mt,"/notification/").concat(yt,"/").concat(z.conversationId,"?resource=").concat(wt.clientResource),type:"PUT",dataType:"json",data:JSON.stringify(Ht),headers:{Authorization:"Bearer "+q,"Content-Type":"application/json"},success:z.success,error:z.error};return E.kg.debug("Call setSilentModeForConversation:",z),f.hj.call(this,At)}function R(z){if(typeof z.conversationId!="string"||!z.conversationId)throw Error('Invalid parameter: "conversationId"');if(typeof z.type!="string"||!z.type)throw Error('Invalid parameter: "type"');if(!h.XZ.call(this)){var S=g.Z.create({type:_.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(S)}var F=this.context,M=F.accessToken,Z=F.orgName,U=F.appName,Y=F.userId,q=F.jid,V="chatgroup";z.type==="singleChat"&&(V="user");var it={url:"".concat(this.apiUrl,"/").concat(Z,"/").concat(U,"/users/").concat(Y,"/notification/").concat(V,"/").concat(z.conversationId,"?resource=").concat(q.clientResource),type:"PUT",dataType:"json",data:JSON.stringify({type:"DEFAULT"}),headers:{Authorization:"Bearer "+M,"Content-Type":"application/json"},success:z.success,error:z.error};return E.kg.debug("Call clearRemindTypeForConversation:",z),f.hj.call(this,it)}function D(z){if(typeof z.conversationId!="string"||!z.conversationId)throw Error('Invalid parameter: "conversationId"');if(typeof z.type!="string"||!z.type)throw Error('Invalid parameter: "type"');if(!h.XZ.call(this)){var S=g.Z.create({type:_.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(S)}var F=this.context,M=F.accessToken,Z=F.orgName,U=F.appName,Y=F.userId,q="chatgroup";z.type==="singleChat"&&(q="user");var V={url:"".concat(this.apiUrl,"/").concat(Z,"/").concat(U,"/users/").concat(Y,"/notification/").concat(q,"/").concat(z.conversationId),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+M,"Content-Type":"application/json"},success:z.success,error:z.error};return E.kg.debug("Call getSilentModeForConversation:",z),f.hj.call(this,V)}function P(z){if(!Array.isArray(z.conversationList))throw Error('Invalid parameter: "conversationList"');if(!h.XZ.call(this)){var S=g.Z.create({type:_.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(S)}var F=this.context,M=F.accessToken,Z=F.orgName,U=F.appName,Y=F.userId,q=[],V=[];z.conversationList.forEach(function(yt){yt.type==="singleChat"?q.push(yt.id):V.push(yt.id)});var it=q.length?q.join(","):"",mt=V.length?V.join(","):"",wt={url:"".concat(this.apiUrl,"/").concat(Z,"/").concat(U,"/users/").concat(Y,"/notification?user=").concat(it,"&group=").concat(mt),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+M,"Content-Type":"application/json"},success:z.success,error:z.error};return E.kg.debug("Call getSilentModeForConversations:",z),f.hj.call(this,wt)}function k(z){if(typeof z.language!="string"||!z.language)throw Error('Invalid parameter: "language"');if(!h.XZ.call(this)){var S=g.Z.create({type:_.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(S)}var F={translationLanguage:z.language},M=this.context,Z=M.accessToken,U=M.orgName,Y=M.appName,q=M.userId,V={url:"".concat(this.apiUrl,"/").concat(U,"/").concat(Y,"/users/").concat(q,"/notification/language"),type:"PUT",dataType:"json",data:JSON.stringify(F),headers:{Authorization:"Bearer "+Z,"Content-Type":"application/json"},success:z.success,error:z.error};return E.kg.debug("Call setPushPerformLanguage:",z),f.hj.call(this,V)}function b(z){if(!h.XZ.call(this)){var S=g.Z.create({type:_.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(S)}var F=this.context,M=F.accessToken,Z=F.orgName,U=F.appName,Y=F.userId,q={url:"".concat(this.apiUrl,"/").concat(Z,"/").concat(U,"/users/").concat(Y,"/notification/language"),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+M,"Content-Type":"application/json"},success:z?.success,error:z?.error};return E.kg.debug("Call getPushPerformLanguage:",z),f.hj.call(this,q)}function j(z){if(!h.XZ.call(this)){var S=g.Z.create({type:_.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(S)}if(typeof z.pageSize!="number")throw Error('Invalid parameter: "pageSize"');var F=this.context,M=F.accessToken,Z=F.orgName,U=F.appName,Y=F.userId,q={limit:z.pageSize||10,cursor:z.cursor};z.cursor||delete q.cursor;var V={url:"".concat(this.apiUrl,"/").concat(Z,"/").concat(U,"/users/").concat(Y,"/notification/mute/type"),type:"GET",dataType:"json",data:q,headers:{Authorization:"Bearer "+M,"Content-Type":"application/json"}};return E.kg.debug("Call getSilentModeRemindTypeConversations:",z),f.hj.call(this,V).then(function(it){return it.data?{data:{conversations:it.data.map(function(mt){return"user"in mt?{conversationId:mt.user,type:"singleChat",remindType:mt.value}:{conversationId:mt.group,type:"groupChat",remindType:mt.value}}),cursor:it.cursor},type:it.type}:it})}},7384:function(O,H,a){a.r(H),a.d(H,{changeChatThreadName:function(){return k},createChatThread:function(){return A},destroyChatThread:function(){return P},getChatThreadDetail:function(){return Z},getChatThreadLastMessage:function(){return F},getChatThreadMembers:function(){return b},getChatThreads:function(){return S},getJoinedChatThreads:function(){return z},joinChatThread:function(){return R},leaveChatThread:function(){return D},removeChatThreadMember:function(){return j}}),a(1539),a(8674),a(2526),a(1817),a(2165),a(6992),a(8783),a(3948),a(8309),a(2222),a(9554),a(4747),a(9753);var f=a(5531),h=a(7252),g=a(4024),_=a(3246),E=a(4363),m=function(U,Y,q,V){return new(q||(q=Promise))(function(it,mt){function wt(Yt){try{Ht(V.next(Yt))}catch(At){mt(At)}}function yt(Yt){try{Ht(V.throw(Yt))}catch(At){mt(At)}}function Ht(Yt){var At;Yt.done?it(Yt.value):(At=Yt.value,At instanceof q?At:new q(function(Lt){Lt(At)})).then(wt,yt)}Ht((V=V.apply(U,[])).next())})},p=function(U,Y){var q,V,it,mt,wt={label:0,sent:function(){if(1&it[0])throw it[1];return it[1]},trys:[],ops:[]};return mt={next:yt(0),throw:yt(1),return:yt(2)},typeof Symbol=="function"&&(mt[Symbol.iterator]=function(){return this}),mt;function yt(Ht){return function(Yt){return function(At){if(q)throw new TypeError("Generator is already executing.");for(;wt;)try{if(q=1,V&&(it=2&At[0]?V.return:At[0]?V.throw||((it=V.return)&&it.call(V),0):V.next)&&!(it=it.call(V,At[1])).done)return it;switch(V=0,it&&(At=[2&At[0],it.value]),At[0]){case 0:case 1:it=At;break;case 4:return wt.label++,{value:At[1],done:!1};case 5:wt.label++,V=At[1],At=[0];continue;case 7:At=wt.ops.pop(),wt.trys.pop();continue;default:if(!((it=(it=wt.trys).length>0&&it[it.length-1])||At[0]!==6&&At[0]!==2)){wt=0;continue}if(At[0]===3&&(!it||At[1]>it[0]&&At[1]<it[3])){wt.label=At[1];break}if(At[0]===6&&wt.label<it[1]){wt.label=it[1],it=At;break}if(it&&wt.label<it[2]){wt.label=it[2],wt.ops.push(At);break}it[2]&&wt.ops.pop(),wt.trys.pop();continue}At=Y.call(U,wt)}catch(Lt){At=[6,Lt],V=0}finally{q=it=0}if(5&At[0])throw At[1];return{value:At[0]?At[1]:void 0,done:!0}}([Ht,Yt])}}};function A(U){if(typeof U.name!="string"||U.name==="")throw Error("Invalid parameter name: ".concat(U.name));if(typeof U.messageId!="string"||U.messageId==="")throw Error("Invalid parameter messageId: ".concat(U.messageId));if(typeof U.parentId!="string"||U.parentId==="")throw Error("Invalid parameter parentId: ".concat(U.parentId));if(!_.XZ.call(this)){var Y=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Y)}var q=this.context,V=q.orgName,it=q.appName,mt=q.accessToken,wt=q.jid,yt={name:U.name,msg_id:U.messageId,group_id:U.parentId,owner:this.user},Ht={url:"".concat(this.apiUrl,"/").concat(V,"/").concat(it,"/thread?resource=").concat(wt.clientResource),type:"POST",dataType:"json",data:JSON.stringify(yt),headers:{Authorization:"Bearer "+mt,"Content-Type":"application/json"}};return g.hj.call(this,Ht).then(function(Yt){var At=Yt.data.thread_id;return Yt.data={chatThreadId:At},Yt})}function R(U){if(typeof U.chatThreadId!="string"||U.chatThreadId==="")throw Error("Invalid parameter chatThreadId: ".concat(U.chatThreadId));if(!_.XZ.call(this)){var Y=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Y)}var q=this.context,V=q.orgName,it=q.appName,mt=q.accessToken,wt=q.jid,yt={url:"".concat(this.apiUrl,"/").concat(V,"/").concat(it,"/thread/").concat(U.chatThreadId,"/user/").concat(this.user,"/join?resource=").concat(wt.clientResource),type:"POST",dataType:"json",headers:{Authorization:"Bearer "+mt,"Content-Type":"application/json"}};return g.hj.call(this,yt).then(function(Ht){var Yt=Ht.data.detail;return Yt.messageId=Yt.msgId,Yt.parentId=Yt.groupId,delete Yt.msgId,delete Yt.groupId,Ht})}function D(U){return m(this,void 0,void 0,function(){var Y,q,V,it,mt,wt,yt;return p(this,function(Ht){switch(Ht.label){case 0:if(typeof U.chatThreadId!="string"||U.chatThreadId==="")throw Error("Invalid parameter chatThreadId: ".concat(U.chatThreadId));return _.XZ.call(this)?(q=this.context,V=q.orgName,it=q.appName,mt=q.accessToken,wt=q.jid,yt={url:"".concat(this.apiUrl,"/").concat(V,"/").concat(it,"/thread/").concat(U.chatThreadId,"/user/").concat(this.user,"/quit?resource=").concat(wt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+mt,"Content-Type":"application/json"}},[4,g.hj.call(this,yt)]):(Y=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(Y)]);case 1:return Ht.sent(),[2]}})})}function P(U){return m(this,void 0,void 0,function(){var Y,q,V,it,mt,wt,yt;return p(this,function(Ht){switch(Ht.label){case 0:if(typeof U.chatThreadId!="string"||U.chatThreadId==="")throw Error("Invalid parameter chatThreadId: ".concat(U.chatThreadId));return _.XZ.call(this)?(q=this.context,V=q.orgName,it=q.appName,mt=q.accessToken,wt=q.jid,yt={url:"".concat(this.apiUrl,"/").concat(V,"/").concat(it,"/thread/").concat(U.chatThreadId,"?resource=").concat(wt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+mt,"Content-Type":"application/json"}},[4,g.hj.call(this,yt)]):(Y=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(Y)]);case 1:return Ht.sent(),[2]}})})}function k(U){if(typeof U.chatThreadId!="string"||U.chatThreadId==="")throw Error("Invalid parameter chatThreadId: ".concat(U.chatThreadId));if(typeof U.name!="string"||U.name==="")throw Error("Invalid parameter name: ".concat(U.name));if(!_.XZ.call(this)){var Y=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Y)}var q=this.context,V=q.orgName,it=q.appName,mt=q.accessToken,wt=q.jid,yt={name:U.name},Ht={url:"".concat(this.apiUrl,"/").concat(V,"/").concat(it,"/thread/").concat(U.chatThreadId,"?resource=").concat(wt.clientResource),type:"PUT",dataType:"json",data:JSON.stringify(yt),headers:{Authorization:"Bearer "+mt,"Content-Type":"application/json"}};return g.hj.call(this,Ht)}function b(U){if(typeof U.chatThreadId!="string"||U.chatThreadId==="")throw Error("Invalid parameter chatThreadId: ".concat(U.chatThreadId));if(!_.XZ.call(this)){var Y=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Y)}var q=this.context,V=q.orgName,it=q.appName,mt=q.accessToken,wt={limit:U.pageSize||20,cursor:U.cursor||""},yt={url:"".concat(this.apiUrl,"/").concat(V,"/").concat(it,"/thread/").concat(U.chatThreadId,"/users"),type:"GET",dataType:"json",data:wt,headers:{Authorization:"Bearer "+mt,"Content-Type":"application/json"}};return g.hj.call(this,yt)}function j(U){if(typeof U.chatThreadId!="string"||U.chatThreadId==="")throw Error("Invalid parameter chatThreadId: ".concat(U.chatThreadId));if(typeof U.username!="string"||U.username==="")throw Error("Invalid parameter username: ".concat(U.username));if(!_.XZ.call(this)){var Y=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Y)}var q=this.context,V=q.orgName,it=q.appName,mt=q.accessToken,wt=q.jid,yt={url:"".concat(this.apiUrl,"/").concat(V,"/").concat(it,"/thread/").concat(U.chatThreadId,"/users/").concat(U.username,"?resource=").concat(wt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+mt,"Content-Type":"application/json"}};return g.hj.call(this,yt)}function z(U){if(!_.XZ.call(this)){var Y=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Y)}var q=this.context,V=q.orgName,it=q.appName,mt=q.accessToken,wt={limit:U.pageSize||20,cursor:U.cursor||""},yt={url:U.parentId?"".concat(this.apiUrl,"/").concat(V,"/").concat(it,"/threads/chatgroups/").concat(U.parentId,"/user/").concat(this.user):"".concat(this.apiUrl,"/").concat(V,"/").concat(it,"/threads/user/").concat(this.user),type:"GET",dataType:"json",data:wt,headers:{Authorization:"Bearer "+mt,"Content-Type":"application/json"}};return g.hj.call(this,yt).then(function(Ht){var Yt=Ht.entities;return Yt?.forEach(function(At){At.parentId=At.groupId,At.messageId=At.msgId,delete At.groupId,delete At.msgId}),Ht})}function S(U){if(typeof U.parentId!="string"||U.parentId==="")throw Error("Invalid parameter parentId: ".concat(U.parentId));if(!_.XZ.call(this)){var Y=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Y)}var q=this.context,V=q.orgName,it=q.appName,mt=q.accessToken,wt={cursor:U.cursor||"",limit:U.pageSize||20},yt={url:"".concat(this.apiUrl,"/").concat(V,"/").concat(it,"/threads/chatgroups/").concat(U.parentId),type:"GET",dataType:"json",data:wt,headers:{Authorization:"Bearer "+mt,"Content-Type":"application/json"}};return g.hj.call(this,yt).then(function(Ht){var Yt=Ht.entities;return Yt?.forEach(function(At){At.parentId=At.groupId,At.messageId=At.msgId,delete At.groupId,delete At.msgId}),Ht})}function F(U){var Y=this;if(!Array.isArray(U.chatThreadIds))throw Error("Invalid parameter chatThreadIds: ".concat(U.chatThreadIds));if(!_.XZ.call(this)){var q=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(q)}var V=this.context,it=V.orgName,mt=V.appName,wt=V.accessToken,yt={threadIds:U.chatThreadIds},Ht={url:"".concat(this.apiUrl,"/").concat(it,"/").concat(mt,"/thread/message"),type:"POST",dataType:"json",data:JSON.stringify(yt),headers:{Authorization:"Bearer "+wt,"Content-Type":"application/json"}};return g.hj.call(this,Ht).then(function(Yt){return M.call(Y,Yt)})}function M(U){var Y=this,q=U.entities;return q?.forEach(function(V){V.chatThreadId=V.thread_id,V.last_message&&JSON.stringify(V.last_message)!=="{}"?V.lastMessage=E.w.call(Y,V.last_message):V.lastMessage=V.last_message,delete V.thread_id,delete V.last_message}),U}function Z(U){if(typeof U.chatThreadId!="string"||U.chatThreadId==="")throw Error("Invalid parameter chatThreadId: ".concat(U.chatThreadId));if(!_.XZ.call(this)){var Y=h.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Y)}var q=this.context,V=q.orgName,it=q.appName,mt=q.accessToken,wt={url:"".concat(this.apiUrl,"/").concat(V,"/").concat(it,"/thread/").concat(U.chatThreadId),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+mt,"Content-Type":"application/json"}};return g.hj.call(this,wt).then(function(yt){return yt.data.affiliationsCount=yt.data.affiliations_count,yt.data.messageId=yt.data.msgId,yt.data.parentId=yt.data.groupId,delete yt.data.affiliations_count,delete yt.data.msgId,delete yt.data.groupId,yt})}},70:function(O,H,a){a.r(H),a.d(H,{getSupportedLanguages:function(){return m},translateMessage:function(){return p}}),a(1539),a(8674),a(2222),a(9753);var f=a(3246),h=a(5531),g=a(7252),_=a(7360),E=a(4024);function m(){if(!f.XZ.call(this)){var A=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(A)}var R=this.context,D=R.orgName,P=R.appName,k=R.accessToken,b={url:"".concat(this.apiUrl,"/").concat(D,"/").concat(P,"/users/").concat(this.user,"/translate/support/language"),dataType:"json",type:"GET",headers:{Authorization:"Bearer "+k}};return _.kg.debug("Call getSupportedLanguages"),E.hj.call(this,b)}function p(A){if(typeof A.text!="string"||A.text==="")throw Error('Invalid parameter: "text"');if(!Array.isArray(A.languages))throw Error('Invalid parameter: "language"');if(!f.XZ.call(this)){var R=g.Z.create({type:h.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(R)}var D=this.context,P=D.orgName,k=D.appName,b=D.accessToken,j="".concat(this.apiUrl,"/").concat(P,"/").concat(k,"/users/").concat(this.user,"/translate"),z={text:A.text,to:A.languages},S={url:j,dataType:"json",type:"POST",data:JSON.stringify(z),headers:{Authorization:"Bearer "+b}};return _.kg.debug("Call translateMessage"),E.hj.call(this,S)}},3246:function(O,H,a){a.d(H,{H7:function(){return A},XZ:function(){return m},_W:function(){return p}}),a(7941),a(9554),a(1539),a(4747),a(6699),a(2023);var f=a(5531),h=a(7252),g=a(7360);function _(){var R=this.context.appName,D=this.context.orgName;return!(!R||!D)||(this.onError&&this.onError({type:f.E.WEBIM_CONNCTION_AUTH_ERROR,message:"appName or orgName is illegal"}),!1)}function E(){var R,D=this.context.accessToken;if(!D){var P=h.Z.create({type:f.E.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR,message:"token not assign error"});return g.kg.debug("token not assign error",D),this.onError&&this.onError(P),(R=this.eventHandler)===null||R===void 0||R.dispatch("onError",P),!1}return!0}function m(){return E.call(this)&&_.call(this)}function p(R){var D=R.data,P=R.type;return{data:{status:Object.keys(D.errorKeys).length>0?"fail":"success",errorKeys:D.errorKeys,successKeys:D.successKeys},type:P}}function A(R){var D=R.data,P=void 0;return Object.keys(D.errorKeys).length>0&&Object.keys(D.errorKeys).forEach(function(k){var b=D.errorKeys[k];P=b.includes("is not part of you")?h.Z.create({type:f.E.NO_PERMISSION,message:b}):b.includes("size of metadata for this single chatroom exceeds the user defined limit")||b.includes("total size of chatroom metadata for this app exceeds the user defined limit")||b.includes("is exceeding maximum limit")?h.Z.create({type:f.E.MAX_LIMIT,message:b}):b.includes("is not Legal")?h.Z.create({type:f.E.REQUEST_PARAMETER_ERROR,message:b}):b.includes("Failed to update userMetadata. Concurrent updates not allowed")?h.Z.create({type:f.E.OPERATION_NOT_ALLOWED,message:b}):h.Z.create({type:f.E.WEBIM_CONNCTION_AJAX_ERROR,message:b})}),P}},2071:function(O,H,a){a.d(H,{$x:function(){return E},F3:function(){return m},TJ:function(){return h},Tp:function(){return R},Wc:function(){return f},el:function(){return g},iB:function(){return p},iO:function(){return _},yK:function(){return A}}),a(6992),a(1532),a(1539),a(8783),a(3948);var f=7,h=new Map,g="im",_=new Map,E="32f24ab2ddb74f508aa9286c356cec84",m=1e3,p={INIT:9674,API:9675},A="direct",R=-1},1595:function(O,H,a){var f,h,g,_,E,m;a.d(H,{C8:function(){return f},aC:function(){return m},c:function(){return g},dd:function(){return E},fI:function(){return h},td:function(){return _}}),function(p){p[p.UNKNOWOPERATION=-1]="UNKNOWOPERATION",p[p.REST_GET_SESSION_LIST=1]="REST_GET_SESSION_LIST",p[p.REST_DEL_SESSION=2]="REST_DEL_SESSION",p[p.REST_GET_HISTORY_MESSAGE=3]="REST_GET_HISTORY_MESSAGE",p[p.REST_PIN_CONVERSATION=4]="REST_PIN_CONVERSATION",p[p.REST_MARK_CONVERSATION=5]="REST_MARK_CONVERSATION",p[p.REST_UPLOAD_FILE_IN_PARTS=6]="REST_UPLOAD_FILE_IN_PARTS",p[p.REST_DELETE_MESSAGES_CONVERSATIONS=7]="REST_DELETE_MESSAGES_CONVERSATIONS",p[p.REST_PIN_MESSAGE=8]="REST_PIN_MESSAGE",p[p.REST_FETCH_PINMESSAGES=9]="REST_FETCH_PINMESSAGES",p[p.REST_OPERATE=100]="REST_OPERATE",p[p.MSYNC_SENDMESSAGE=101]="MSYNC_SENDMESSAGE",p[p.MSYNC_RECALLMESSAGE=102]="MSYNC_RECALLMESSAGE",p[p.MSYNC_MODIFYMESSAGE=103]="MSYNC_MODIFYMESSAGE",p[p.MSYNC_OPERATE=200]="MSYNC_OPERATE",p[p.ROSTER_ADD=201]="ROSTER_ADD",p[p.ROSTER_REMOVE=202]="ROSTER_REMOVE",p[p.ROSTER_ACCEPT=203]="ROSTER_ACCEPT",p[p.ROSTER_DECLINE=204]="ROSTER_DECLINE",p[p.ROSTER_BAN=205]="ROSTER_BAN",p[p.ROSTER_ALLOW=206]="ROSTER_ALLOW",p[p.ROSTER_BLACKLIST=207]="ROSTER_BLACKLIST",p[p.ROSTER_CONTACTS=208]="ROSTER_CONTACTS",p[p.ROSTER_GET_ALL_CONTACTS_REMARKS=209]="ROSTER_GET_ALL_CONTACTS_REMARKS",p[p.ROSTER_GET_ALL_CONTACTS_REMARKS_FROM_SERVER_BY_PAGE=210]="ROSTER_GET_ALL_CONTACTS_REMARKS_FROM_SERVER_BY_PAGE",p[p.ROSTER_SET_CONTACT_REMARK=211]="ROSTER_SET_CONTACT_REMARK",p[p.ROSTER_OPERATE=300]="ROSTER_OPERATE",p[p.USER_LOGIN=301]="USER_LOGIN",p[p.USER_CREATE=302]="USER_CREATE",p[p.USER_UPDATE_USERINFO=303]="USER_UPDATE_USERINFO",p[p.USER_FETCH_USERINFO=304]="USER_FETCH_USERINFO",p[p.USER_UPDATE_NICK=305]="USER_UPDATE_NICK",p[p.USER_UPLOAD_PUSH_TOKEN=306]="USER_UPLOAD_PUSH_TOKEN",p[p.USER_LOGGEDIN_OTHER_PLATFORM=307]="USER_LOGGEDIN_OTHER_PLATFORM",p[p.USER_OPERATE=400]="USER_OPERATE",p[p.GROUP_CREATEGROUP=401]="GROUP_CREATEGROUP",p[p.GROUP_BLOCK_MESSAGE=402]="GROUP_BLOCK_MESSAGE",p[p.GROUP_FETCH_PUBLICGROUPS_WITHCURSOR=403]="GROUP_FETCH_PUBLICGROUPS_WITHCURSOR",p[p.GROUP_FETCH_USERS_GROUP=404]="GROUP_FETCH_USERS_GROUP",p[p.GROUP_CHANGE_OWNER=405]="GROUP_CHANGE_OWNER",p[p.GROUP_FETCH_SPECIFICATION=406]="GROUP_FETCH_SPECIFICATION",p[p.GROUP_CHANGE_GROUPATTRIBUTE=407]="GROUP_CHANGE_GROUPATTRIBUTE",p[p.GROUP_FETCH_MEMEBERS=408]="GROUP_FETCH_MEMEBERS",p[p.GROUP_GET_ADMIN=409]="GROUP_GET_ADMIN",p[p.GROUP_SET_ADMIN=410]="GROUP_SET_ADMIN",p[p.GROUP_REMOVE_ADMIN=411]="GROUP_REMOVE_ADMIN",p[p.GROUP_DESTOTYGROUP=412]="GROUP_DESTOTYGROUP",p[p.GROUP_LEAVEGROUP=413]="GROUP_LEAVEGROUP",p[p.GROUP_INVITE_TO_GROUP=414]="GROUP_INVITE_TO_GROUP",p[p.GROUP_JOIN_PUBLICGROUP=415]="GROUP_JOIN_PUBLICGROUP",p[p.GROUP_ACCEPT_JOINPUBLICGROUPAPPL=416]="GROUP_ACCEPT_JOINPUBLICGROUPAPPL",p[p.GROUP_DECLINE_JOINPUBLICGROUPAPPL=417]="GROUP_DECLINE_JOINPUBLICGROUPAPPL",p[p.GROUP_ACCEPT_INVITATION=418]="GROUP_ACCEPT_INVITATION",p[p.GROUP_DECLINE_INVITATION=419]="GROUP_DECLINE_INVITATION",p[p.GROUP_REMOVE_MEMBER=420]="GROUP_REMOVE_MEMBER",p[p.GROUP_REMOVE_MEMBERS=421]="GROUP_REMOVE_MEMBERS",p[p.GROUP_MUTE_MEMBERS=422]="GROUP_MUTE_MEMBERS",p[p.GROUP_UNMUTE_MEMBERS=423]="GROUP_UNMUTE_MEMBERS",p[p.GROUP_FETCH_MUTES=424]="GROUP_FETCH_MUTES",p[p.GROUP_BLOCK_MEMBER=425]="GROUP_BLOCK_MEMBER",p[p.GROUP_BLOCK_MEMBERS=426]="GROUP_BLOCK_MEMBERS",p[p.GROUP_UNBLOCK_MEMBER=427]="GROUP_UNBLOCK_MEMBER",p[p.GROUP_UNBLOCK_MEMBERS=428]="GROUP_UNBLOCK_MEMBERS",p[p.GROUP_GET_BLOCK_LIST=429]="GROUP_GET_BLOCK_LIST",p[p.GROUP_MUTE_ALLMEMBERS=430]="GROUP_MUTE_ALLMEMBERS",p[p.GROUP_UNMUTE_ALLMEMBERS=431]="GROUP_UNMUTE_ALLMEMBERS",p[p.GROUP_ADD_WHITELIST=432]="GROUP_ADD_WHITELIST",p[p.GROUP_REMOVE_WHITELIST=433]="GROUP_REMOVE_WHITELIST",p[p.GROUP_FETCH_WHITELIST=434]="GROUP_FETCH_WHITELIST",p[p.GROUP_IS_IN_WHITELIST=435]="GROUP_IS_IN_WHITELIST",p[p.GROUP_GET_READ_USERS=436]="GROUP_GET_READ_USERS",p[p.GROUP_FETCH_ANNOUNCEMENT=437]="GROUP_FETCH_ANNOUNCEMENT",p[p.GROUP_UPDATE_ANNOUNCEMENT=438]="GROUP_UPDATE_ANNOUNCEMENT",p[p.GROUP_UPLOAD_SHAREDFILE=439]="GROUP_UPLOAD_SHAREDFILE",p[p.GROUP_DELETE_SHAREDFILE=440]="GROUP_DELETE_SHAREDFILE",p[p.GROUP_FETCH_SHAREDFILE=441]="GROUP_FETCH_SHAREDFILE",p[p.GROUP_DOWNLOAD_SHAREDFILE=442]="GROUP_DOWNLOAD_SHAREDFILE",p[p.GROUP_MEMBER_SET_META_DATA=443]="GROUP_MEMBER_SET_META_DATA",p[p.GROUP_MEMBER_FETCH_META_DATA=444]="GROUP_MEMBER_FETCH_META_DATA",p[p.GROUP_OPERATE=500]="GROUP_OPERATE",p[p.CHATROOM_FETCH_CHATROOMSWITHPAGE=501]="CHATROOM_FETCH_CHATROOMSWITHPAGE",p[p.CHATROOM_CREATECHATROOM=502]="CHATROOM_CREATECHATROOM",p[p.CHATROOM_DESTORYCHATROOM=503]="CHATROOM_DESTORYCHATROOM",p[p.CHATROOM_FETCH_SPECIFICATION=504]="CHATROOM_FETCH_SPECIFICATION",p[p.CHATROOM_CHANGE_ATTRIBUTE=505]="CHATROOM_CHANGE_ATTRIBUTE",p[p.CHATROOM_REMOVE_MEMBER=506]="CHATROOM_REMOVE_MEMBER",p[p.CHATROOM_REMOVE_MEMBERS=507]="CHATROOM_REMOVE_MEMBERS",p[p.CHATROOM_ADD_MEMBERS=508]="CHATROOM_ADD_MEMBERS",p[p.CHATROOM_JOINCAHTROOM=509]="CHATROOM_JOINCAHTROOM",p[p.CHATROOM_LEAVECAHTROOM=510]="CHATROOM_LEAVECAHTROOM",p[p.CHATROOM_FETCH_MEMBERS=511]="CHATROOM_FETCH_MEMBERS",p[p.CHATROOM_GET_ADMIN=512]="CHATROOM_GET_ADMIN",p[p.CHATROOM_SET_ADMIN=513]="CHATROOM_SET_ADMIN",p[p.CHATROOM_REMOVE_ADMIN=514]="CHATROOM_REMOVE_ADMIN",p[p.CHATROOM_MUTE_USER=515]="CHATROOM_MUTE_USER",p[p.CHATROOM_UNMUTE_USER=516]="CHATROOM_UNMUTE_USER",p[p.CHATROOM_FETCH_MUTES=517]="CHATROOM_FETCH_MUTES",p[p.CHATROOM_BLOCK_USER=518]="CHATROOM_BLOCK_USER",p[p.CHATROOM_BLOCK_USERS=519]="CHATROOM_BLOCK_USERS",p[p.CHATROOM_UNBLOCK_USER=520]="CHATROOM_UNBLOCK_USER",p[p.CHATROOM_UNBLOCK_USERS=521]="CHATROOM_UNBLOCK_USERS",p[p.CHATROOM_FETCH_BANS=522]="CHATROOM_FETCH_BANS",p[p.CHATROOM_MUTE_ALLMEMEBERS=523]="CHATROOM_MUTE_ALLMEMEBERS",p[p.CHATROOM_UNMUTE_ALLMEMEBERS=524]="CHATROOM_UNMUTE_ALLMEMEBERS",p[p.CHATROOM_ADD_WHITELIST=525]="CHATROOM_ADD_WHITELIST",p[p.CHATROOM_REMOVE_WHITELIST=526]="CHATROOM_REMOVE_WHITELIST",p[p.CHATROOM_FETCH_WHITELIST=527]="CHATROOM_FETCH_WHITELIST",p[p.CHATROOM_FETCH_MEMBERIN_WHITELIST=528]="CHATROOM_FETCH_MEMBERIN_WHITELIST",p[p.CHATROOM_FETCH_ANNOUNCEMENT=529]="CHATROOM_FETCH_ANNOUNCEMENT",p[p.CHATROOM_UPDATE_ANNOUNCEMENT=530]="CHATROOM_UPDATE_ANNOUNCEMENT",p[p.CHATROOM_REMOVE_SHARE_FILE=531]="CHATROOM_REMOVE_SHARE_FILE",p[p.CHATROOM_GET_SHARE_FILE_LIST=532]="CHATROOM_GET_SHARE_FILE_LIST",p[p.CHATROOM_UPLOAD_FILE=533]="CHATROOM_UPLOAD_FILE",p[p.CHATROOM_SET_META_DATA=534]="CHATROOM_SET_META_DATA",p[p.CHATROOM_DELETE_META_DATA=535]="CHATROOM_DELETE_META_DATA",p[p.CHATROOM_FETCH_META_DATA=536]="CHATROOM_FETCH_META_DATA",p[p.CHATROOM_FETCH_USER_JOINED_CHATROOM=537]="CHATROOM_FETCH_USER_JOINED_CHATROOM",p[p.CHATROOM_OPERATE=600]="CHATROOM_OPERATE"}(f||(f={})),function(p){p.SDK_INTERNAL="SDK_INTERNAL",p.LOGIN="USER_LOGIN",p.REGISTER="USER_CREATE",p.GET_CHATROOM_LIST="CHATROOM_FETCH_CHATROOMSWITHPAGE",p.CREATE_CHATROOM="CHATROOM_CREATECHATROOM",p.DESTROY_CHATROOM="CHATROOM_DESTORYCHATROOM",p.GET_CHATROOM_DETAIL="CHATROOM_FETCH_SPECIFICATION",p.MODIFY_CHATROOM="CHATROOM_CHANGE_ATTRIBUTE",p.REMOVE_CHATROOM_MEMBER="CHATROOM_REMOVE_MEMBER",p.MULTI_REMOVE_CHATROOM_MEMBER="CHATROOM_REMOVE_MEMBERS",p.ADD_USERS_TO_CHATROOM="CHATROOM_ADD_MEMBERS",p.JOIN_CHATROOM="CHATROOM_JOINCAHTROOM",p.QUIT_CHATROOM="CHATROOM_LEAVECAHTROOM",p.LIST_CHATROOM_MEMBERS="CHATROOM_FETCH_MEMBERS",p.GET_CHATROOM_ADMIN="CHATROOM_GET_ADMIN",p.SET_CHATROOM_ADMIN="CHATROOM_SET_ADMIN",p.REMOVE_CHATROOM_ADMIN="CHATROOM_REMOVE_ADMIN",p.MUTE_CHATROOM_MEMBER="CHATROOM_MUTE_USER",p.REMOVE_MUTE_CHATROOM_MEMBER="CHATROOM_UNMUTE_USER",p.GET_MUTE_CHATROOM_MEMBERS="CHATROOM_FETCH_MUTES",p.SET_CHATROOM_MEMBER_TO_BLACK="CHATROOM_BLOCK_USER",p.MULTI_SET_CHATROOM_MEMBER_TO_BLACK="CHATROOM_BLOCK_USERS",p.REMOVE_CHATROOM_MEMBER_BLACK="CHATROOM_UNBLOCK_USER",p.MULTI_REMOVE_CHATROOM_MEMBER_BLACK="CHATROOM_UNBLOCK_USERS",p.GET_CHATROOM_BLOCK_MEMBERS="CHATROOM_FETCH_BANS",p.DISABLED_CHATROOM_SEND_MSG="CHATROOM_MUTE_ALLMEMEBERS",p.ENABLE_CHATROOM_SEND_MSG="CHATROOM_UNMUTE_ALLMEMEBERS",p.ADD_CHATROOM_WHITE_USERS="CHATROOM_ADD_WHITELIST",p.REMOVE_CHATROOM_WHITE_USERS="CHATROOM_REMOVE_WHITELIST",p.GET_CHATROOM_WHITE_USERS="CHATROOM_FETCH_WHITELIST",p.CHECK_CHATROOM_WHITE_USER="CHATROOM_FETCH_MEMBERIN_WHITELIST",p.GET_CHATROOM_ANN="CHATROOM_FETCH_ANNOUNCEMENT",p.UPDATE_CHATROOM_ANN="CHATROOM_UPDATE_ANNOUNCEMENT",p.DELETE_CHATROOM_FILE="CHATROOM_REMOVE_SHARE_FILE",p.GET_CHATROOM_FILES="CHATROOM_GET_SHARE_FILE_LIST",p.UPLOAD_CHATROOM_FILE="CHATROOM_UPLOAD_FILE",p.SET_CHATROOM_ATTR="CHATROOM_SET_META_DATA",p.DELETE_CHATROOM_ATTR="CHATROOM_DELETE_META_DATA",p.GET_CHATROOM_ATTR="CHATROOM_FETCH_META_DATA",p.GET_USER_JOINED_CHATROOM="CHATROOM_FETCH_USER_JOINED_CHATROOM",p.CREATE_GROUP="GROUP_CREATEGROUP",p.BLOCK_GROUP="GROUP_BLOCK_MESSAGE",p.LIST_GROUP="GROUP_FETCH_PUBLICGROUPS_WITHCURSOR",p.GET_USER_GROUP="GROUP_FETCH_USERS_GROUP",p.CHANGE_OWNER="GROUP_CHANGE_OWNER",p.GET_GROUP_INFO="GROUP_FETCH_SPECIFICATION",p.MODIFY_GROUP="GROUP_CHANGE_GROUPATTRIBUTE",p.LIST_GROUP_MEMBER="GROUP_FETCH_MEMEBERS",p.GET_GROUP_ADMIN="GROUP_GET_ADMIN",p.SET_GROUP_ADMIN="GROUP_SET_ADMIN",p.REMOVE_GROUP_ADMIN="GROUP_REMOVE_ADMIN",p.DISSOLVE_GROUP="GROUP_DESTOTYGROUP",p.QUIT_GROUP="GROUP_LEAVEGROUP",p.INVITE_TO_GROUP="GROUP_INVITE_TO_GROUP",p.JOIN_GROUP="GROUP_JOIN_PUBLICGROUP",p.AGREE_JOIN_GROUP="GROUP_ACCEPT_JOINPUBLICGROUPAPPL",p.REJECT_JOIN_GROUP="GROUP_DECLINE_JOINPUBLICGROUPAPPL",p.AGREE_INVITE_GROUP="GROUP_ACCEPT_INVITATION",p.REJECT_INVITE_GROUP="GROUP_DECLINE_INVITATION",p.REMOVE_GROUP_MEMBER="GROUP_REMOVE_MEMBER",p.MULTI_REMOVE_GROUP_MEMBER="GROUP_REMOVE_MEMBERS",p.MUTE_GROUP_MEMBER="GROUP_MUTE_MEMBERS",p.UNMUTE_GROUP_MEMBER="GROUP_UNMUTE_MEMBERS",p.GET_GROUP_MUTE_LIST="GROUP_FETCH_MUTES",p.BLOCK_GROUP_MEMBER="GROUP_BLOCK_MEMBER",p.BLOCK_GROUP_MEMBERS="GROUP_BLOCK_MEMBERS",p.UNBLOCK_GROUP_MEMBER="GROUP_UNBLOCK_MEMBER",p.UNBLOCK_GROUP_MEMBERS="GROUP_UNBLOCK_MEMBERS",p.GET_GROUP_BLACK_LIST="GROUP_GET_BLOCK_LIST",p.DISABLED_SEND_GROUP_MSG="GROUP_MUTE_ALLMEMBERS",p.ENABLE_SEND_GROUP_MSG="GROUP_UNMUTE_ALLMEMBERS",p.ADD_USERS_TO_GROUP_WHITE="GROUP_ADD_WHITELIST",p.REMOVE_GROUP_WHITE_MEMBER="GROUP_REMOVE_WHITELIST",p.GET_GROUP_WHITE_LIST="GROUP_FETCH_WHITELIST",p.IS_IN_GROUP_WHITE_LIST="GROUP_IS_IN_WHITELIST",p.GET_GROUP_MSG_READ_USER="GROUP_GET_READ_USERS",p.GET_GROUP_ANN="GROUP_FETCH_ANNOUNCEMENT",p.UPDATE_GROUP_ANN="GROUP_UPDATE_ANNOUNCEMENT",p.UPLOAD_GROUP_FILE="GROUP_UPLOAD_SHAREDFILE",p.DELETE_GROUP_FILE="GROUP_DELETE_SHAREDFILE",p.GET_GROUP_FILE_LIST="GROUP_FETCH_SHAREDFILE",p.DOWN_GROUP_FILE="GROUP_DOWNLOAD_SHAREDFILE",p.SET_GROUP_MEMBER_ATTRS="GROUP_MEMBER_SET_META_DATA",p.GET_GROUP_MEMBER_ATTR="GROUP_MEMBER_FETCH_META_DATA",p.GET_SESSION_LIST="REST_GET_SESSION_LIST",p.DELETE_SESSION="REST_DEL_SESSION",p.GET_HISTORY_MSG="REST_GET_HISTORY_MESSAGE",p.PIN_CONVERSATION="REST_PIN_CONVERSATION",p.REST_UPLOAD_FILE_IN_PARTS="REST_UPLOAD_FILE_IN_PARTS",p.REST_DELETE_MESSAGES_CONVERSATIONS="REST_DELETE_MESSAGES_CONVERSATIONS",p.MARK_CONVERSATION="REST_MARK_CONVERSATION",p.REST_FETCH_PINMESSAGES="REST_FETCH_PINMESSAGES",p.REST_PIN_MESSAGE="REST_PIN_MESSAGE",p.UPDATE_USER_INFO="USER_UPDATE_USERINFO",p.GET_USER_INFO="USER_FETCH_USERINFO",p.UPDATE_USER_NICK="USER_UPDATE_NICK",p.UPLOAD_PUSH_TOKEN="USER_UPLOAD_PUSH_TOKEN",p.USER_LOGGEDIN_OTHER_PLATFORM="USER_LOGGEDIN_OTHER_PLATFORM",p.GET_BLACK_LIST="ROSTER_BLACKLIST",p.GET_CONTACTS="ROSTER_CONTACTS",p.ROSTER_GET_ALL_CONTACTS_REMARKS="ROSTER_GET_ALL_CONTACTS_REMARKS",p.ROSTER_GET_ALL_CONTACTS_REMARKS_FROM_SERVER_BY_PAGE="ROSTER_GET_ALL_CONTACTS_REMARKS_FROM_SERVER_BY_PAGE",p.ROSTER_SET_CONTACT_REMARK="ROSTER_SET_CONTACT_REMARK",p.ROSTER_ADD="ROSTER_ADD",p.ROSTER_REMOVE="ROSTER_REMOVE",p.ROSTER_ACCEPT="ROSTER_ACCEPT",p.ROSTER_DECLINE="ROSTER_DECLINE",p.ROSTER_BAN="ROSTER_BAN",p.ROSTER_ALLOW="ROSTER_ALLOW",p.SEND_MSG="MSYNC_SENDMESSAGE",p.UPLOAD_MSG_ATTACH="UPLOAD_MSG_ATTACH",p.SEND_RECALL_MSG="MSYNC_RECALLMESSAGE",p.MODIFY_MESSAGE="MSYNC_MODIFYMESSAGE"}(h||(h={})),function(p){p.GET_DNS="REST_DNSLIST",p.LOGIN_BY_AGORA_TOKEN="LOGIN_BY_AGORA_TOKEN",p.LOGIN_BY_PWD="LOGIN_BY_PWD",p.RESISTER="REGISTER",p.REST_INIT_UPLOAD_TASK_IN_PARTS="REST_INIT_UPLOAD_TASK_IN_PARTS",p.REST_UPLOAD_PART="REST_UPLOAD_PART",p.REST_COMPLETE_UPLOAD_PART="REST_COMPLETE_UPLOAD_PART",p.REST_ABORT_UPLOAD_PART="REST_ABORT_UPLOAD_PART"}(g||(g={})),function(p){p[p["5G"]=7]="5G",p[p["4G"]=7]="4G",p[p["3G"]=7]="3G",p[p["2G"]=7]="2G",p[p["SLOW-2G"]=7]="SLOW-2G",p[p.WIFI=2]="WIFI",p[p.LAN=1]="LAN",p[p.DISCONNECTED=0]="DISCONNECTED",p[p.NONE=0]="NONE",p[p.UNKNOWN=-1]="UNKNOWN",p[p["WEBIM UNABLE TO GET"]=-2]="WEBIM UNABLE TO GET"}(_||(_={})),function(p){p[p.success=200]="success",p[p.failed=500]="failed",p[p.disconnect=-1]="disconnect",p[p.notFound=404]="notFound",p[p.reachLimit=429]="reachLimit"}(E||(E={})),function(p){p[p.web=0]="web",p[p.native=1]="native"}(m||(m={}))},6424:function(O,H,a){a.d(H,{gA:function(){return re},ZP:function(){return Je}}),a(9601),a(1539),a(8674),a(2526),a(1817),a(2165),a(6992),a(8783),a(3948),a(7042),a(2222),a(3710),a(7941),a(9714),a(3843),a(8309),a(2772),a(5212),a(7327),a(5827),a(9826),a(4553),a(561),a(9653),a(1038),a(2564),a(9575),a(2472),a(2990),a(8927),a(3105),a(5035),a(4345),a(7174),a(2846),a(4731),a(7209),a(6319),a(8867),a(7789),a(3739),a(9368),a(4483),a(2056),a(3462),a(678),a(7462),a(3824),a(5021),a(2974),a(5016),a(6699),a(2023),a(3161),a(4048),a(9753),a(9554),a(4747),a(285),a(1637),a(8145),a(1249),a(4812);var f=a(4188),h=a.n(f),g=a(3720),_=a.n(g),E=a(5531),m=a(8161),p=a(7360),A=["public","members_only","allow_user_invites","invite_need_confirm"],R={name:"name",title:"name",description:"description",public:"public",members_only:"approval",allow_user_invites:"allowInvites",max_users:"maxUsers",invite_need_confirm:"inviteNeedConfirm",custom:"ext",last_modified:"lastModified"};function D(I,X){var _t,K,dt,bt,rt,Vt,ut=this,Kt=this.context,jt=Kt.userId,ge=Kt.jid,W=X.from.name===jt&&ge.clientResource!==X.from.clientResource;return X.isThread?(dt={id:X.mucId.name,name:X.mucName,operation:"",parentId:X.mucParentId.name,operator:X.from.name,userName:X.to.length?X.to[0].name:""},bt={chatThreadId:X.mucId.name,chatThreadName:X.mucName,operation:"",parentId:X.mucParentId.name}):(K={type:"",owner:X.from.name,gid:X.mucId.name,from:X.from.name,fromJid:X.from,to:X.to.length?X.to[0].name:"",toJid:X.to,chatroom:X.isChatroom,status:X.status},rt={operation:"",id:X.mucId.name,from:X.from.name},X.isChatroom&&(!((_t=X?.eventInfo)===null||_t===void 0)&&_t.ext)&&(Vt=JSON.parse(X.eventInfo.ext))),({45:function(){var lt,ct,It;rt.operation="memberAttributesUpdate";var Ct=JSON.parse((lt=X?.eventInfo)===null||lt===void 0?void 0:lt.ext)||{};rt.attributes=Ct.properties||{},rt.userId=Ct.username||"",W?(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onMultiDeviceEvent",rt):(It=ut.eventHandler)===null||It===void 0||It.dispatch("onGroupEvent",rt)},44:function(){var lt;rt.operation="removeChatRoomAttributes",rt.attributes=Vt.result.successKeys,Vt.result.successKeys.length>0&&((lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomEvent",rt))},43:function(){var lt;rt.operation="updateChatRoomAttributes";var ct={};Vt.result.successKeys.forEach(function(It){ct[It]=Vt.properties[It]}),rt.attributes=ct,Vt.result.successKeys.length>0&&((lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomEvent",rt))},42:function(){},41:function(){},40:function(){},39:function(){},38:function(){var lt;bt.operation="chatThreadNameUpdate",(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onMultiDeviceEvent",bt)},37:function(){var lt;dt.operation="userRemove",(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatThreadChange",dt)},36:function(){var lt;bt.operation="chatThreadLeave",(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onMultiDeviceEvent",bt)},35:function(){var lt;bt.operation="chatThreadJoin",(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onMultiDeviceEvent",bt)},34:function(){var lt;bt.operation="chatThreadDestroy",(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onMultiDeviceEvent",bt)},33:function(){var lt;bt.operation="chatThreadCreate",(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onMultiDeviceEvent",bt)},32:function(){var lt,ct,It,Ct;K.type=X.isChatroom?"rmChatRoomMute":"rmGroupMute",ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),rt.operation="unmuteAllMembers",X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt)},31:function(){var lt,ct,It,Ct;K.type=X.isChatroom?"muteChatRoom":"muteGroup",ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),rt.operation="muteAllMembers",X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt)},30:function(){var lt,ct,It,Ct;K.type=X.isChatroom?"rmUserFromChatRoomWhiteList":"rmUserFromGroupWhiteList",ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),rt.operation="removeAllowlistMember",X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt)},29:function(){var lt,ct,It,Ct;K.type=X.isChatroom?"addUserToChatRoomWhiteList":"addUserToGroupWhiteList",ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),rt.operation="addUserToAllowlist",X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt)},28:function(){var lt,ct,It,Ct;K.type="deleteFile",ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),rt.operation="deleteFile",X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt)},27:function(){var lt,ct,It,Ct;K.type="uploadFile",ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),rt.operation="uploadFile",X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt)},26:function(){var lt,ct,It,Ct;K.type="deleteAnnouncement",ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),rt.operation="deleteAnnouncement",X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt)},25:function(){var lt,ct,It,Ct;K.type="updateAnnouncement",K.announcement=X.reason,ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),rt.operation="updateAnnouncement",rt.announcement=X.reason,X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt)},24:function(){var lt,ct,It,Ct;K.type="removeMute",ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),rt.operation="unmuteMember",X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt)},23:function(){var lt,ct,It,Ct;K.type="addMute",ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),rt.operation="muteMember",X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt)},22:function(){var lt,ct,It,Ct;K.type="removeAdmin",ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),rt.operation="removeAdmin",X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt)},21:function(){var lt,ct,It,Ct;K.type="addAdmin",ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),rt.operation="setAdmin",X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt)},20:function(){var lt,ct,It,Ct;K.type="changeOwner",ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),rt.operation="changeOwner",X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt)},19:function(){var lt,ct,It,Ct;K.type="direct_joined",K.groupName=X.mucName,ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),rt.operation="directJoined",rt.name=X.mucName,X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt)},18:function(){var lt,ct,It,Ct;K.type=X.isChatroom?"leaveChatRoom":"leaveGroup",ut.onPresence&&ut.onPresence(K);var Ot=X.mucMemberCount;Ot&&(rt.memberCount=Ot),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),rt.operation="memberAbsence",X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt)},17:function(){var lt,ct,It,Ct;X.isChatroom&&X.ext&&(rt.ext=X.ext,K.ext=X.ext),K.type=X.isChatroom?"memberJoinChatRoomSuccess":"memberJoinPublicGroupSuccess",ut.onPresence&&ut.onPresence(K);var Ot=X.mucMemberCount;X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),rt.operation="memberPresence",Ot&&(rt.memberCount=Ot),X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt)},16:function(){var lt,ct;K.type="unblock",ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K)},15:function(){var lt,ct;K.type="block",ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K)},14:function(){var lt,ct,It,Ct,Ot,Mt=X.isChatroom;if(!Mt){var qt=JSON.parse(((lt=X?.eventInfo)===null||lt===void 0?void 0:lt.ext)||"{}",function(he,Jt){return he==="last_modified"?Number(Jt):A.includes(he)?Jt==="true"||Jt===!0:Jt});rt.detail=K.detail={},Object.keys(qt).forEach(function(he){var Jt=R[he];if(Jt){var Ve=qt[he];rt.detail&&(rt.detail[Jt]=Ve),K.detail&&(K.detail[Jt]=Ve)}})}K.type="update",ut.onPresence&&ut.onPresence(K),Mt?(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onChatroomChange",K):(It=ut.eventHandler)===null||It===void 0||It.dispatch("onGroupChange",K),rt.operation="updateInfo",Mt?(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onChatroomEvent",rt):(Ot=ut.eventHandler)===null||Ot===void 0||Ot.dispatch("onGroupEvent",rt)},13:function(){var lt,ct,It,Ct;K.type="allow",K.reason=X.reason,ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),X.reason&&(rt.reason=X.reason),rt.operation="unblockMember",X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt)},12:function(){var lt,ct;K.type="ban",ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K)},11:function(){var lt,ct;K.type="getBlackList",ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K)},10:function(){var lt,ct,It,Ct;K.type="removedFromGroup",K.kicked=K.to,ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),rt.operation="removeMember",X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt)},9:function(){var lt,ct,It,Ct;K.type="invite_decline",K.kicked=K.to,ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),rt.operation="rejectInvite",X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt)},8:function(){var lt,ct,It,Ct;K.type="invite_accept",K.kicked=K.to,ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),rt.operation="acceptInvite",X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt)},7:function(){var lt,ct,It,Ct;K.type="invite",K.kicked=K.to,K.groupName=X.mucName,ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),rt.operation="inviteToJoin",rt.name=X.mucName,X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt)},6:function(){var lt,ct,It,Ct;K.type="joinPublicGroupDeclined",ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),rt.operation="joinPublicGroupDeclined",X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(rt.userId=X.to.length?X.to[0].name:"",(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt))},5:function(){var lt,ct,It,Ct;K.type="joinPublicGroupSuccess",ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),rt.operation="acceptRequest",X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt)},4:function(){var lt,ct,It,Ct;K.type="joinGroupNotifications",K.reason=X.reason,ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),X.reason&&(rt.reason=X.reason),rt.operation="requestToJoin",X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt)},3:function(){var lt,ct;K.type="leave",ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K)},2:function(){var lt,ct;K.type="join",ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K)},1:function(){var lt,ct,It,Ct;K.type="deleteGroupChat",ut.onPresence&&ut.onPresence(K),X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomChange",K):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupChange",K),rt.operation="destroy",X.isChatroom?(It=ut.eventHandler)===null||It===void 0||It.dispatch("onChatroomEvent",rt):(Ct=ut.eventHandler)===null||Ct===void 0||Ct.dispatch("onGroupEvent",rt)},0:function(){var lt,ct;rt.operation="create",X.isChatroom?(lt=ut.eventHandler)===null||lt===void 0||lt.dispatch("onChatroomEvent",rt):(ct=ut.eventHandler)===null||ct===void 0||ct.dispatch("onGroupEvent",rt)}}[I]||function(){console.error("No match operation ".concat(I))})()}var P=function(I){var X=this.root.lookup("easemob.pb.MUCBody").decode(I.payload),_t=X.operation;p.kg.debug("onMucMessage",X),D.call(this,_t,X)},k={handleRosterMsg:function(I){var X,_t,K,dt,bt,rt,Vt=this.root.lookup("easemob.pb.RosterBody").decode(I.payload),ut={type:"",to:Vt.to[0].name,from:Vt.from.name,status:Vt.reason};switch(Vt.operation){case 2:ut.type="subscribe",this.onContactInvited&&this.onContactInvited(ut),(X=this.eventHandler)===null||X===void 0||X.dispatch("onContactInvited",ut);break;case 3:ut.type="unsubscribed",this.onContactDeleted&&this.onContactDeleted(ut),(_t=this.eventHandler)===null||_t===void 0||_t.dispatch("onContactDeleted",ut);break;case 4:ut.type="subscribed",this.onContactAdded&&this.onContactAdded(ut),(K=this.eventHandler)===null||K===void 0||K.dispatch("onContactAdded",ut);break;case 5:ut.type="unsubscribed",this.onContactRefuse&&this.onContactRefuse(ut),(dt=this.eventHandler)===null||dt===void 0||dt.dispatch("onContactRefuse",ut);break;case 6:case 7:break;case 8:ut.type="subscribed",this.onContactAgreed&&this.onContactAgreed(ut),(bt=this.eventHandler)===null||bt===void 0||bt.dispatch("onContactAgreed",ut);break;case 9:ut.type="unsubscribed",this.onContactRefuse&&this.onContactRefuse(ut),(rt=this.eventHandler)===null||rt===void 0||rt.dispatch("onContactRefuse",ut);break;default:p.kg.error("handleRosterMsg:",Vt)}this.onPresence&&ut.type&&this.onPresence(ut)}},b=a(7252),j=function(I){var X,_t,K,dt,bt,rt,Vt=this.root.lookup("easemob.pb.StatisticsBody").decode(I.payload),ut=Vt.operation,Kt=Vt.reason;switch(ut){case 0:this.onStatisticMessage&&this.onStatisticMessage(Vt),(X=this.eventHandler)===null||X===void 0||X.dispatch("onStatisticMessage",Vt);break;case 1:rt=b.Z.create({type:E.E.WEBIM_CONNCTION_USER_REMOVED,message:"user has been removed"}),this.disconnectedReason=rt,this.logOut=!0,this.onError&&this.onError(rt),(_t=this.eventHandler)===null||_t===void 0||_t.dispatch("onError",rt);break;case 2:rt=b.Z.create({type:E.E.WEBIM_CONNCTION_USER_LOGIN_ANOTHER_DEVICE,message:"the user is already logged on another device"}),Kt&&(rt.data={loginInfoCustomExt:Vt.reason}),this.disconnectedReason=rt,this.logOut=!0,this.onError&&this.onError(rt),(K=this.eventHandler)===null||K===void 0||K.dispatch("onError",rt);break;case 3:rt=b.Z.create({type:E.E.WEBIM_CONNCTION_USER_KICKED_BY_CHANGE_PASSWORD,message:"the user was kicked by changing password"}),this.disconnectedReason=rt,this.logOut=!0,this.onError&&this.onError(rt),(dt=this.eventHandler)===null||dt===void 0||dt.dispatch("onError",rt);break;case 4:rt=b.Z.create({type:E.E.WEBIM_CONNCTION_USER_KICKED_BY_OTHER_DEVICE,message:"the user was kicked by other device"}),this.disconnectedReason=rt,this.logOut=!0,this.onError&&this.onError(rt),(bt=this.eventHandler)===null||bt===void 0||bt.dispatch("onError",rt);break;default:p.kg.error("handleStatisticsMsg:",Vt)}},z=(a(9720),a(4024)),S=a(4363),F=a(9937);function M(I){var X,_t=[],K=[],dt=I.data;dt&&dt.values&&dt.values.forEach(function(bt){Object.entries(bt.status).forEach(function(rt){K.push({device:rt[0],status:Number(rt[1])})}),_t.push({userId:bt.uid,lastTime:Number(bt.last_time),expire:Number(bt.expiry),ext:bt.ext,statusDetails:K})}),this.onPresenceStatusChange&&this.onPresenceStatusChange(_t),(X=this.eventHandler)===null||X===void 0||X.dispatch("onPresenceStatusChange",_t)}function Z(I){var X=this;I.data.forEach(function(_t){var K,dt={from:_t.from,to:_t.to,chatType:_t.channel_type==="chat"?"singleChat":"groupChat",messageId:_t.messageId,reactions:_t.reactions,ts:_t.ts};(K=X.eventHandler)===null||K===void 0||K.dispatch("onReactionChange",dt)})}function U(I){var X,_t,K,dt;if(I.data){var bt=I.data,rt={id:bt.id||"",name:bt.name||"",parentId:bt.muc_parent_id||"",messageId:bt.msg_parent_id||"",timestamp:bt.timestamp||0,operator:bt.from||"",operation:""};switch(bt.operation){case"create":rt.operation="create",rt.createTimestamp=rt.timestamp,rt.messageCount=0,(X=this.eventHandler)===null||X===void 0||X.dispatch("onChatThreadChange",rt);break;case"update_msg":rt.operation="update",rt.messageCount=bt.message_count,bt.last_message&&JSON.stringify(bt.last_message)!=="{}"?rt.lastMessage=S.w.call(this,bt.last_message):JSON.stringify(bt.last_message)==="{}"&&(rt.lastMessage={}),(_t=this.eventHandler)===null||_t===void 0||_t.dispatch("onChatThreadChange",rt);break;case"update":rt.operation="update",rt.messageCount=bt.message_count,(K=this.eventHandler)===null||K===void 0||K.dispatch("onChatThreadChange",rt);break;case"delete":rt.operation="destroy",(dt=this.eventHandler)===null||dt===void 0||dt.dispatch("onChatThreadChange",rt)}}}function Y(I){var X,_t=I.data;if(_t.resource!==this.clientResource){var K={operation:"deleteRoaming",conversationId:_t.to,chatType:_t.chatType==="chat"?"singleChat":"groupChat",resource:_t.resource};(X=this.eventHandler)===null||X===void 0||X.dispatch("onMultiDeviceEvent",K)}}function q(I){var X,_t,K=I.data,dt="";if(this.clientResource!==K.res){switch(K.op){case"del":dt="deleteConversation";break;case"top":dt="pinnedConversation";break;case"not_top":dt="unpinnedConversation";break;case"mark":dt="markConversation";break;case"mark_delete":dt="unMarkConversation";break;case"pin":dt="pin";break;case"pin_delete":dt="unpin";break;default:return void p.kg.error("unexpected conversation op:",K.op)}if(dt!=="pin"&&dt!=="unpin"){var bt={operation:dt,conversationId:K.id,conversationType:K.type==="chat"?"singleChat":"groupChat",timestamp:K.ts};bt.operation!=="markConversation"&&bt.operation!=="unMarkConversation"||K.ext&&(bt.conversationMark=F.Z[K.ext]),(_t=this.eventHandler)===null||_t===void 0||_t.dispatch("onMultiDeviceEvent",bt)}else{var rt=K.ext,Vt=K.from,ut=K.id,Kt=K.type,jt=K.ts,ge={messageId:rt||"",conversationId:Vt===this.user?ut:Vt,conversationType:S.U[Kt],operation:dt,operatorId:Vt,time:jt};(X=this.eventHandler)===null||X===void 0||X.dispatch("onMessagePinEvent",ge)}}}function V(I){var X,_t=this;(X=I.values)===null||X===void 0||X.forEach(function(K){var dt,bt,rt,Vt,ut;if(K.operator_resource!==_t.clientResource)if("ignoreInterval"in K.data){var Kt={operation:"setSilentModeForUser",resource:K.operator_resource,data:K.data};(dt=_t.eventHandler)===null||dt===void 0||dt.dispatch("onMultiDeviceEvent",Kt)}else"group"in K?(Kt={operation:Object.keys((bt=K.data)!==null&&bt!==void 0?bt:{}).length===0?"removeSilentModeForConversation":"setSilentModeForConversation",resource:K.operator_resource,conversationId:K.group,type:"groupChat",data:K.data},(rt=_t.eventHandler)===null||rt===void 0||rt.dispatch("onMultiDeviceEvent",Kt)):(Kt={operation:Object.keys((Vt=K.data)!==null&&Vt!==void 0?Vt:{}).length===0?"removeSilentModeForConversation":"setSilentModeForConversation",resource:K.operator_resource,conversationId:K.user,type:"singleChat",data:K.data},(ut=_t.eventHandler)===null||ut===void 0||ut.dispatch("onMultiDeviceEvent",Kt))})}var it=function(I){var X=z.P6.parseNotify(I.payload);switch(X.type){case"presence":M.call(this,X);break;case"reaction":Z.call(this,X);break;case"thread":U.call(this,X);break;case"roaming_delete":Y.call(this,X);break;case"conv":q.call(this,X);break;case"user_notification_mute":V.call(this,X);break;default:p.kg.error("unexpected notify type: ".concat(X.type))}},mt=a(7288),wt=a(9743),yt=2,Ht=a(4998),Yt=a(6801),At=a(2071),Lt=a(1595);function zt(I){return zt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(X){return typeof X}:function(X){return X&&typeof Symbol=="function"&&X.constructor===Symbol&&X!==Symbol.prototype?"symbol":typeof X},zt(I)}var re,de,ft,gt=function(){return gt=Object.assign||function(I){for(var X,_t=1,K=arguments.length;_t<K;_t++)for(var dt in X=arguments[_t])Object.prototype.hasOwnProperty.call(X,dt)&&(I[dt]=X[dt]);return I},gt.apply(this,arguments)},Zt=function(I,X,_t,K){return new(_t||(_t=Promise))(function(dt,bt){function rt(Kt){try{ut(K.next(Kt))}catch(jt){bt(jt)}}function Vt(Kt){try{ut(K.throw(Kt))}catch(jt){bt(jt)}}function ut(Kt){var jt;Kt.done?dt(Kt.value):(jt=Kt.value,jt instanceof _t?jt:new _t(function(ge){ge(jt)})).then(rt,Vt)}ut((K=K.apply(I,[])).next())})},Pt=function(I,X){var _t,K,dt,bt,rt={label:0,sent:function(){if(1&dt[0])throw dt[1];return dt[1]},trys:[],ops:[]};return bt={next:Vt(0),throw:Vt(1),return:Vt(2)},typeof Symbol=="function"&&(bt[Symbol.iterator]=function(){return this}),bt;function Vt(ut){return function(Kt){return function(jt){if(_t)throw new TypeError("Generator is already executing.");for(;rt;)try{if(_t=1,K&&(dt=2&jt[0]?K.return:jt[0]?K.throw||((dt=K.return)&&dt.call(K),0):K.next)&&!(dt=dt.call(K,jt[1])).done)return dt;switch(K=0,dt&&(jt=[2&jt[0],dt.value]),jt[0]){case 0:case 1:dt=jt;break;case 4:return rt.label++,{value:jt[1],done:!1};case 5:rt.label++,K=jt[1],jt=[0];continue;case 7:jt=rt.ops.pop(),rt.trys.pop();continue;default:if(!((dt=(dt=rt.trys).length>0&&dt[dt.length-1])||jt[0]!==6&&jt[0]!==2)){rt=0;continue}if(jt[0]===3&&(!dt||jt[1]>dt[0]&&jt[1]<dt[3])){rt.label=jt[1];break}if(jt[0]===6&&rt.label<dt[1]){rt.label=dt[1],dt=jt;break}if(dt&&rt.label<dt[2]){rt.label=dt[2],rt.ops.push(jt);break}dt[2]&&rt.ops.pop(),rt.trys.pop();continue}jt=X.call(I,rt)}catch(ge){jt=[6,ge],K=0}finally{_t=dt=0}if(5&jt[0])throw jt[1];return{value:jt[0]?jt[1]:void 0,done:!0}}([ut,Kt])}}},Wt=function(I,X,_t){for(var K,dt=0,bt=X.length;dt<bt;dt++)!K&&dt in X||(K||(K=Array.prototype.slice.call(X,0,dt)),K[dt]=X[dt]);return I.concat(K||Array.prototype.slice.call(X))};(function(I){I[I.NORMAL=0]="NORMAL",I[I.SINGLECHAT=1]="SINGLECHAT",I[I.GROUPCHAT=2]="GROUPCHAT",I[I.CHATROOM=3]="CHATROOM",I[I.READ_ACK=4]="READ_ACK",I[I.DELIVER_ACK=5]="DELIVER_ACK",I[I.RECALL=6]="RECALL",I[I.CHANNEL_ACK=7]="CHANNEL_ACK",I[I.EDIT=8]="EDIT"})(re||(re={})),function(I){I[I.APNs=0]="APNs",I[I.FCM=1]="FCM",I[I.HMSPUSH=2]="HMSPUSH",I[I.MIPUSH=3]="MIPUSH",I[I.MEIZUPUSH=4]="MEIZUPUSH",I[I.VIVOPUSH=5]="VIVOPUSH",I[I.OPPOPUSH=6]="OPPOPUSH",I[I.HONORPUSH=7]="HONORPUSH"}(de||(de={})),function(I){I[I.OK=0]="OK",I[I.FAIL=1]="FAIL",I[I.UNAUTHORIZED=2]="UNAUTHORIZED",I[I.MISSING_PARAMETER=3]="MISSING_PARAMETER",I[I.WRONG_PARAMETER=4]="WRONG_PARAMETER",I[I.REDIRECT=5]="REDIRECT",I[I.TOKEN_EXPIRED=6]="TOKEN_EXPIRED",I[I.PERMISSION_DENIED=7]="PERMISSION_DENIED",I[I.NO_ROUTE=8]="NO_ROUTE",I[I.UNKNOWN_COMMAND=9]="UNKNOWN_COMMAND",I[I.PB_PARSER_ERROR=10]="PB_PARSER_ERROR",I[I.BIND_ANOTHER_DEVICE=11]="BIND_ANOTHER_DEVICE",I[I.IM_FORBIDDEN=12]="IM_FORBIDDEN",I[I.TOO_MANY_DEVICES=13]="TOO_MANY_DEVICES",I[I.PLATFORM_LIMIT=14]="PLATFORM_LIMIT",I[I.USER_MUTED=15]="USER_MUTED",I[I.ENCRYPT_DISABLE=16]="ENCRYPT_DISABLE",I[I.ENCRYPT_ENABLE=17]="ENCRYPT_ENABLE",I[I.DECRYPT_FAILURE=18]="DECRYPT_FAILURE",I[I.PERMISSION_DENIED_EXTERNAL=19]="PERMISSION_DENIED_EXTERNAL"}(ft||(ft={}));var oe=["txt","img","video","audio","file","loc","custom","cmd","combine"],fe=z.P6.getEnvInfo();function le(){var I="webim",X="",_t="",K=[],dt=new Date().valueOf(),bt=z.P6.getDevicePlatform(fe);if(this.isFixedDeviceId){var rt=z.P6.getLocalDeviceInfo();if(rt){var Vt=JSON.parse(rt);I=Vt.deviceId,X=Vt.deviceName,_t=Vt.deviceUuid}else this.deviceId==="webim"?(_t="".concat(bt,"_").concat(dt.toString()),I="".concat(this.deviceId,"_").concat(_t),X=this.deviceId):I=X=_t="webim_".concat(bt,"_").concat(this.deviceId),z.P6.setLocalDeviceInfo(JSON.stringify({deviceId:I,deviceName:X,deviceUuid:_t}))}else this.deviceId==="webim"?(_t="random_".concat(bt,"_").concat(dt.toString()),I="".concat(this.deviceId,"_").concat(_t),X=this.deviceId):I=X=_t="webim_".concat(bt,"_").concat(this.deviceId);this.context.jid&&(this.context.jid.clientResource=I);var ut=this.root.lookup("easemob.pb.Provision"),Kt=ut.decode(K);Kt.compressType=this.compressType,Kt.encryptType=this.encryptType,Kt.osType=this.osType,Kt.version=this.version,Kt.deviceName=X,Kt.resource=I,Kt.deviceUuid=_t,Kt.authToken='{"token":"$t$'+this.token+'"}',Kt.sessionId=Date.now().toString()+":",this.loginInfoCustomExt&&(Kt.reason=this.loginInfoCustomExt),p.kg.debug("provision info",{version:this.version,resource:I,isFixedDeviceId:this.isFixedDeviceId,loginInfoCustomExt:!!this.loginInfoCustomExt,token:!!this.token}),Kt.actionVersion="v5.0",Kt=ut.encode(Kt).finish();var jt=this.root.lookup("easemob.pb.MSync"),ge=jt.decode(K);return ge.version=this.version,ge.guid=this.context.jid,ge.auth="$t$"+this.token,ge.command=3,ge.deviceId=X,ge.serviceId=this.dataReport.getServiceId(),ge.encryptType=this.encryptType,ge.payload=Kt,jt.encode(ge).finish()}function Ie(I,X){var _t=this,K=z.P6.getEnvInfo();if(K.platform==="web"||K.platform==="zfb"||K.platform==="dd"){for(var dt="",bt=0;bt<I.length;bt++)dt+=String.fromCharCode(I[bt]);return dt=h().btoa(dt),K.platform==="web"?dt:{data:dt,isBuffer:!1,complete:function(){},fail:function(Vt){Vt.errMsg!=="sendSocketMessage:fail taskID not exist"&&Vt.errMsg!=="SocketTast.send:fail SocketTask.readyState is not OPEN"||(p.kg.debug("send message fail and reconnect"),_t.reconnecting||_t.reconnect()),X&&_t._msgHash&&_t._msgHash[X]&&_t._msgHash[X].fail({id:X})}}}var rt=I;return{data:rt.buffer.slice(rt.byteOffset,rt.byteOffset+rt.byteLength),fail:function(Vt){Vt.errMsg!=="sendSocketMessage:fail taskID not exist"&&Vt.errMsg!=="SocketTast.send:fail SocketTask.readyState is not OPEN"||_t.reconnecting||_t.reconnect(),X&&_t._msgHash&&_t._msgHash[X]&&_t._msgHash[X].fail({id:X})}}}function me(I,X){var _t;return Zt(this,void 0,void 0,function(){var K,dt,bt,rt,Vt,ut;return Pt(this,function(Kt){switch(Kt.label){case 0:for(p.kg.debug("distributeMeta, metas length: ",I.length),K=[],dt=function(jt){var ge=I[jt],W=new(_())(ge.id.low,ge.id.high,ge.id.unsigned).toString(),lt=ge.from.name,ct=ge.to?ge.to.name:"",It=!!ge.to&&ge.to.domain.indexOf("conference")!==-1;if(bt._load_msg_cache.some(function(Ct){return Ct.msgId===W}))return"continue";switch(bt._load_msg_cache.length<=bt.max_cache_length||bt._load_msg_cache.shift(),bt._load_msg_cache.push({msgId:W,from:lt,to:ct,isGroup:It}),ge.ns){case 0:j.call(bt,ge);break;case 1:K.push(m.Z.call(bt,ge,X,!1,!0,!0));break;case 2:P.call(bt,ge);break;case 3:k.handleRosterMsg.call(bt,ge);break;case 4:bt.registerConfrIQHandler&&bt.registerConfrIQHandler(ge,X,bt);break;case 5:it.call(bt,ge);break;default:p.kg.error("distributeMeta",ge)}},bt=this,rt=0;rt<I.length;rt++)dt(rt);return[4,Promise.all(K)];case 1:return Vt=Kt.sent(),(ut=Vt.filter(function(jt){return jt&&jt.type!=="cmd"})).length>0&&((_t=this.eventHandler)===null||_t===void 0||_t.dispatch("onMessage",ut)),[2]}})})}function Oe(I,X){me.call(this,I,X)}function je(I){var X;this._offlineMessagePullState===Ht.a.SYNC_INIT&&(this._offlineMessagePullState=Ht.a.SYNC_START,this._offlineMessagePullQueue=I.unread.reduce(function(_t,K){return _t.find(function(dt){return dt.name===K.queue.name})||_t.push(K.queue),_t},[]),(X=this.eventHandler)===null||X===void 0||X.dispatch("onOfflineMessageSyncStart"))}function xe(I){var X;if(this._offlineMessagePullState===Ht.a.SYNC_START){var _t=this._offlineMessagePullQueue.findIndex(function(K){return K.name===I.queue.name});_t>-1&&this._offlineMessagePullQueue.splice(_t,1),this._offlineMessagePullQueue.length===0&&(this._offlineMessagePullState=Ht.a.SYNC_FINISH,(X=this.eventHandler)===null||X===void 0||X.dispatch("onOfflineMessageSyncFinish"))}}function ir(I){var X=this.root.lookup("easemob.pb.CommUnreadDL");X=X.decode(I.payload);var _t=new(_())(X.timestamp.low,X.timestamp.high,X.timestamp.unsigned).toString();if(this.expirationTime&&this.compareTokenExpireTime(Number(_t),this.expirationTime),X.unread.length===0)te.call(this);else{je.call(this,X),p.kg.debug("pull unread message",X.unread);for(var K=0;K<X.unread.length;K++){var dt=ot(this._queues,X.unread[K].queue),bt=ot(this.unSyncQueue,X.unread[K].queue);dt||bt?p.kg.warn("receive unread message and already in queue"):this.unSyncQueue.push(X.unread[K].queue)}for(K=0;K<this.unSyncQueue.length;K++)this.unSyncQueue[K].hasSync||Ne.call(this,this.unSyncQueue[K]),this.unSyncQueue[K].hasSync=!0}te.call(this)}function He(){var I=[],X=this.root.lookup("easemob.pb.StatisticsBody"),_t=X.decode(I);_t.operation=0,_t=X.encode(_t).finish();var K=this.root.lookup("easemob.pb.Meta").decode(I);K.id=new Date().valueOf(),K.ns=0,K.payload=_t;var dt=this.root.lookup("easemob.pb.CommSyncUL"),bt=dt.decode(I);bt.meta=K,bt=dt.encode(bt).finish();var rt=this.root.lookup("easemob.pb.MSync"),Vt=rt.decode(I);return Vt.version=this.version,Vt.encryptType=[0],Vt.command=0,Vt.payload=bt,rt.encode(Vt).finish()}function ae(I){var X=[],_t=this.root.lookup("easemob.pb.CommSyncUL"),K=_t.decode(X);K.queue=I,K=_t.encode(K).finish();var dt=this.root.lookup("easemob.pb.MSync"),bt=dt.decode(X);return bt.version=this.version,bt.encryptType=this.encryptType,bt.command=0,bt.payload=K,dt.encode(bt).finish()}function Ne(I){p.kg.debug("sendBackqueue");var X=ae.call(this,I);pe.call(this,X)}function Ze(I,X){var _t=[],K=this.root.lookup("easemob.pb.CommSyncUL"),dt=K.decode(_t);dt.queue=X,dt.key=new(_())(I.low,I.high,I.unsigned).toString(),dt=K.encode(dt).finish();var bt=this.root.lookup("easemob.pb.MSync"),rt=bt.decode(_t);return rt.version=this.version,rt.encryptType=this.encryptType,rt.command=0,rt.payload=dt,bt.encode(rt).finish()}function ee(){var I=this;this.uniPush&&this.isRegisterPush===!1&&(this.isRegisterPush=!0,this.uniPush.onRegister(function(X){p.kg.debug("push token onRegister",X);var _t=I.uniPushConfig||{},K=_t.APNsCertificateName,dt=K===void 0?"":K,bt=_t.HMSCertificateName,rt=bt===void 0?"":bt,Vt=_t.HONORCertificateName,ut=Vt===void 0?"":Vt,Kt=_t.MEIZUCertificateName,jt=Kt===void 0?"":Kt,ge=_t.MICertificateName,W=ge===void 0?"":ge,lt=_t.OPPOCertificateName,ct=lt===void 0?"":lt,It=_t.VIVOCertificateName,Ct=It===void 0?"":It;switch(X.push_type){case de.APNs:I.pushCertificateName=dt;break;case de.HMSPUSH:I.pushCertificateName=rt;break;case de.HONORPUSH:I.pushCertificateName=ut;break;case de.MEIZUPUSH:I.pushCertificateName=jt;break;case de.MIPUSH:I.pushCertificateName=W;break;case de.OPPOPUSH:I.pushCertificateName=ct;break;case de.VIVOPUSH:I.pushCertificateName=Ct;break;default:p.kg.error("unexpected push type",X.push_type)}I.pushCertificateName&&X.push_token&&Yt.r.call(I,{deviceId:I.clientResource,deviceToken:X.push_token,notifierName:I.pushCertificateName}).then(function(){p.kg.debug("uploadPushToken success")}).catch(function(Ot){p.kg.debug("uploadPushToken failed",Ot)})}))}function be(){var I;this._offlineMessagePullState=Ht.a.SYNC_INIT,this._offlineMessagePullQueue=[],this.times=1,this.autoReconnectNumTotal=0,this.onOpened&&this.onOpened(),ee.call(this),(I=this.eventHandler)===null||I===void 0||I.dispatch("onConnected"),Ee.call(this),Xe.call(this),Ae.call(this),te.call(this)}function We(I,X){p.kg.debug("sendLastSession",I);var _t=Ze.call(this,I,X);pe.call(this,_t)}function Pe(I){var X,_t,K,dt,bt,rt,Vt,ut=this,Kt=this.root.lookup("easemob.pb.Provision").decode(I.payload);if(this.context.jid&&(this.context.jid.clientResource=Kt.resource),this.clientResource=Kt.resource,Kt.status.errorCode===ft.OK){if(this.disconnectedReason=void 0,Kt.authToken){var jt=JSON.parse(Kt.authToken).expires_in;if(!this.tokenExpiredTimer&&!this.tokenWillExpireTimer){var ge=Date.now();this.expirationTime=jt;var W=this.expirationTime-ge;this.expiresIn=W<0?0:W,this.tokenExpireTimeCountDown(this.expiresIn)}}this.reconnecting=!1,this.logOut=!1,fe.platform!=="zfb"&&fe.platform!=="dd"||(this.sock.readyState=1),this._localCache?!((X=this._localCache)===null||X===void 0)&&X.getInstance()?be.call(this):this._localCache&&new this._localCache({user:this.user,dbName:"cache_".concat(Math.abs((0,wt.un)(this.appKey)),"_").concat(this.user),version:yt,onInit:function(){return Zt(ut,void 0,void 0,function(){return Pt(this,function(Ot){return p.kg.debug("localCache init success"),be.call(this),[2]})})}}):be.call(this)}else{var lt=void 0,ct=Kt.status,It=ct.reason,Ct=ct.errorCode;switch(p.kg.debug("provision errorCode: ",Ct),p.kg.debug("provision reason: ",It),Ct){case ft.FAIL:lt=It==="Sorry, user register limit"?b.Z.create({type:E.E.MAX_LIMIT,message:"Sorry, the number of user registrations limit has been reached"}):It==="Sorry, user register rate limit"?b.Z.create({type:E.E.MAX_LIMIT,message:"Sorry, user register rate limit"}):It==="Sorry, token expired"?b.Z.create({type:E.E.WEBIM_TOKEN_EXPIRED,message:"Sorry, token expired"}):It==="Sorry, token or password does not match login info"?b.Z.create({type:E.E.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR,message:"INVALID_TOKEN"}):It==="Sorry, user not found"?b.Z.create({type:E.E.USER_NOT_FOUND,message:"User not found"}):b.Z.create({type:E.E.WEBIM_CONNCTION_AUTH_ERROR,message:"Auth failed"}),(_t=this.eventHandler)===null||_t===void 0||_t.dispatch("onError",lt);break;case ft.WRONG_PARAMETER:lt=b.Z.create({type:E.E.REQUEST_PARAMETER_ERROR,message:"Invalid parameter"}),(K=this.eventHandler)===null||K===void 0||K.dispatch("onError",lt);break;case ft.UNAUTHORIZED:lt=b.Z.create({type:E.E.WEBIM_CONNCTION_AUTH_ERROR,message:"Auth failed"}),(dt=this.eventHandler)===null||dt===void 0||dt.dispatch("onError",lt);break;case ft.IM_FORBIDDEN:lt=b.Z.create({type:E.E.WEBIM_SERVER_SERVING_DISABLED,message:"Server serving disabled."}),(bt=this.eventHandler)===null||bt===void 0||bt.dispatch("onError",lt);break;case ft.PERMISSION_DENIED:lt=It==="Sorry, the app month live count limit"?b.Z.create({type:E.E.MAX_LIMIT,message:"Sorry, the monthly active user limit for this app has been reached"}):It==="Sorry, the app day live count limit"?b.Z.create({type:E.E.MAX_LIMIT,message:"Sorry, the daily active user limit for this app has been reached"}):It==="Sorry, the app online count limit"?b.Z.create({type:E.E.MAX_LIMIT,message:"Sorry, the maximum number limit of online users for this app has been reached"}):b.Z.create({type:E.E.WEBIM_CONNCTION_AUTH_ERROR,message:"Auth failed"}),(rt=this.eventHandler)===null||rt===void 0||rt.dispatch("onError",lt);break;default:lt=b.Z.create({type:E.E.WEBIM_CONNCTION_AUTH_ERROR,message:It}),(Vt=this.eventHandler)===null||Vt===void 0||Vt.dispatch("onError",lt)}this.disconnectedReason=lt}}function Ee(){var I,X;if(((I=this.unMSyncSendMsgMap)===null||I===void 0?void 0:I.size)>0){for(var _t=Array.from(this.unMSyncSendMsgMap.keys()),K=0;K<_t.length;K++){var dt=this.unMSyncSendMsgMap.get(_t[K]);pe.call(this,dt,_t[K])}(X=this.unMSyncSendMsgMap)===null||X===void 0||X.clear()}}function te(){var I=He.call(this);pe.call(this,I)}function Ae(){p.kg.debug("sendUnreadDeal");var I=ze.call(this);pe.call(this,I)}function Xe(){var I=this;Be.call(this),this.heartBeatID=setInterval(function(){(Date.now()-I.lastHeartbeat)/1e3>=30&&(p.kg.debug("send heart beat"),Ae.call(I),I.lastHeartbeat=Date.now())},this.heartBeatWait)}function Be(){clearInterval(this.heartBeatID)}function ze(){var I=this.root.lookup("easemob.pb.MSync"),X=I.decode([]);return X.version=this.version,X.encryptType=this.encryptType,X.command=1,I.encode(X).finish()}function ot(I,X){return I.some(function(_t){return _t.name===X.name})}function Et(I){var X=this.root.lookup("easemob.pb.CommNotice"),_t=X.decode(I.payload),K=ot(this._queues,_t.queue);p.kg.debug("receive notice",X,this._queues);var dt=ot(this.unSyncQueue,_t.queue);K||dt||this.clientResource===_t.queue.clientResource&&_t.queue.name===this.context.userId||(this._queues.push(_t.queue),this._queues.length===1&&Ne.call(this,_t.queue))}function nt(I){return Zt(this,void 0,void 0,function(){var X,_t,K,dt,bt,rt,Vt,ut;return Pt(this,function(Kt){if(X=z.P6.getEnvInfo(),_t=this.root.lookup("easemob.pb.MSync"),this.name==="miniCore"){try{dt=new Uint8Array(I.data),K=_t.decode(dt)}catch{throw new Error("decode message fail.")}return[2,K]}if(X.platform==="web"||X.platform==="zfb"||X.platform==="dd"){for(bt=h().atob(I.data),rt=[],Vt=0,ut=bt.length;Vt<ut;++Vt)rt.push(bt.charCodeAt(Vt));return[2,_t.decode(rt)]}try{K=_t.decode(I.data)}catch{throw new Error("decode message fail.")}return[2,K]})})}function Dt(I){var X=this;this.lastHeartbeat=Date.now(),I.then(function(_t){if(_t)switch(_t.command){case 0:B.call(X,_t);break;case 1:ir.call(X,_t);break;case 2:Et.call(X,_t);break;case 3:Pe.call(X,_t);break;default:p.kg.error("unexpected msync command: ".concat(_t.command))}else p.kg.error("unexpected msync result: ".concat(_t))})}function B(I){var X,_t,K,dt,bt,rt,Vt,ut,Kt,jt,ge,W,lt,ct,It,Ct,Ot,Mt,qt,he,Jt,Ve,Ye,or,ue,tr,Pr,_r,en,tn,Kn,Ln,ln,hi,Xi,Vs,sn,za,Yo,Xo,js,_s,ia,Es,oa;return Zt(this,void 0,void 0,function(){var Qe,an,Le,sa,qa,Ya,nu,aa,iu,ou,ca,Mc,jl,Bl,Fl,da,su,Gl,Hl,Wl,ua,Kl,Uc,Bs,au,cu,zl,ql,du,ji,Bi,hn,xc,uu,la,Qn,Fn,pi,Vc,ha,jc,lu,Io,Jf=this;return Pt(this,function($n){switch($n.label){case 0:if(Qe=(Qe=this.root.lookup("easemob.pb.CommSyncDL")).decode(I.payload),an=new(_())(Qe.serverId.low,Qe.serverId.high,Qe.serverId.unsigned).toString(),Le=new(_())(Qe.metaId.low,Qe.metaId.high,Qe.metaId.unsigned).toString(),!(Number(Le)>0))return[3,23];if(!Qe.status)return[3,22];if(Qe.status.errorCode!==0)return[3,21];if((sa=this._msgHash[Le])!=null&&sa.isHandleChatroom){try{qa=((X=this._msgHash[Le])===null||X===void 0?void 0:X.operation)==="join",((_t=this._msgHash[Le])===null||_t===void 0?void 0:_t.resolve)instanceof Function&&qa&&this._msgHash[Le].resolve({type:0,data:{action:"apply",id:this._msgHash[Le].roomId,result:!0,user:this.context.userId}}),((K=this._msgHash[Le])===null||K===void 0?void 0:K.success)instanceof Function&&qa&&this._msgHash[Le].success({type:0,data:{action:"apply",id:this._msgHash[Le].roomId,result:!0,user:this.context.userId}}),((dt=this._msgHash[Le])===null||dt===void 0?void 0:dt.resolve)instanceof Function&&!qa&&this._msgHash[Le].resolve({type:0,data:{result:!0}}),((bt=this._msgHash[Le])===null||bt===void 0?void 0:bt.success)instanceof Function&&!qa&&this._msgHash[Le].success({type:0,data:{result:!0}}),At.iO.has(Le)&&(Ya=At.iO.get(Le),la=Ya.rpt,Qn=Ya.requestName,la({isEndApi:!0,data:{isSuccess:1,requestName:Qn,requestMethod:"WEBSOCKET",requestUrl:this.url,code:Lt.dd.success}}),At.iO.delete(Le))}catch(ti){At.iO.has(Le)&&(nu=At.iO.get(Le),la=nu.rpt,Qn=nu.requestName,la({isEndApi:!0,data:{isSuccess:0,requestName:Qn,requestMethod:"WEBSOCKET",requestUrl:this.url,code:Lt.dd.failed,codeDesc:"when executing success function error"}}),At.iO.delete(Le)),pi=b.Z.create({type:E.E.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,message:"when executing success function error",data:ti}),this.onError&&this.onError(pi),(rt=this.eventHandler)===null||rt===void 0||rt.dispatch("onError",pi)}delete this._msgHash[Le]}return!sa||sa.isHandleChatroom?[3,20]:(aa=null,iu="",ou=0,ca=null,this._msgHash[Le].thirdMessage?(this._msgHash[Le].thirdMessage.id=Qe.serverId,this._msgHash[Le].thirdMessage.timestamp=Qe.timestamp,[4,m.Z.call(this,this._msgHash[Le].thirdMessage,Qe.status,!0,!0)]):[3,2]);case 1:ca=$n.sent(),$n.label=2;case 2:if(Qe.metas.length===0)return[3,13];$n.label=3;case 3:switch($n.trys.push([3,12,,13]),Mc=Qe.metas[0],jl=Qe.status,Mc.ns){case 1:return[3,4];case 5:return[3,9]}return[3,10];case 4:return this.useReplacedMessageContents?[4,m.Z.call(this,Mc,jl,!0,!0)]:[3,8];case 5:return ca=$n.sent(),[4,(ut=(Vt=this._localCache)===null||Vt===void 0?void 0:Vt.getInstance())===null||ut===void 0?void 0:ut.getMessageByServerMsgId(Le)];case 6:return(Bl=$n.sent())?[4,(jt=(Kt=this._localCache)===null||Kt===void 0?void 0:Kt.getInstance())===null||jt===void 0?void 0:jt.putMessageToDB(gt(gt(gt({},Bl),ca),{id:Le}))]:[3,8];case 7:$n.sent(),$n.label=8;case 8:return[3,11];case 9:return(Fl=z.P6.parseNotify(Qe.metas[0].payload)).edit_msg&&(da=Fl.edit_msg,su=da.count,Gl=da.operator,Hl=da.edit_time,Wl=da.sender,ua=da.send_time,aa={operationTime:Hl,operatorId:Gl,operationCount:su},iu=Wl,ou=Number(ua)),[3,11];case 10:return p.kg.error("decode local meta error",Mc),[3,11];case 11:return[3,13];case 12:return Kl=$n.sent(),pi=b.Z.create({type:E.E.WEBIM_LOAD_MSG_ERROR,message:"decode local meta message error",data:Kl}),this.onError&&this.onError(pi),(ge=this.eventHandler)===null||ge===void 0||ge.dispatch("onError",pi),[3,13];case 13:At.TJ.has(Le)&&(At.TJ.get(Le).rpt({isEndApi:!0,data:{isSuccess:1,requestMethod:"WEBSOCKET",requestUrl:this.url,code:Lt.dd.success,msgId:an}}),At.TJ.delete(Le)),$n.label=14;case 14:return $n.trys.push([14,18,,19]),Uc={localMsgId:Le,serverMsgId:an},aa&&(this._msgHash[Le].modifiedInfo=aa,Bs=this._msgHash[Le],au=Bs.editMessageId,hn=Bs.type,cu=Bs.chatType,zl=Bs.msg,ql=Bs.to,du=Bs.translations,ji={id:au,type:hn,chatType:cu,msg:zl,modifiedInfo:aa,to:ql,from:iu,time:Number(ou)},du&&(ji.translations=du),Uc.message=ji,(ct=(lt=(W=this._localCache)===null||W===void 0?void 0:W.getInstance())===null||lt===void 0?void 0:lt.getMessageByServerMsgId(au))===null||ct===void 0||ct.then(function(ti){var Fi,hu;ti&&ti.type==="txt"&&((hu=(Fi=Jf._localCache)===null||Fi===void 0?void 0:Fi.getInstance())===null||hu===void 0||hu.putMessageToDB(gt(gt({},ti),{msg:ji.msg,modifiedInfo:ji.modifiedInfo,translations:ji.translations})))})),ca&&(Uc.message=ca),[4,(Ct=(It=this._localCache)===null||It===void 0?void 0:It.getInstance())===null||Ct===void 0?void 0:Ct.updateLocalMessage(Le,{serverMsgId:an,status:mt.r.SUCCESS})];case 15:return $n.sent(),((Ot=this._msgHash[Le])===null||Ot===void 0?void 0:Ot.success)instanceof Function?[4,this._msgHash[Le].success(Le,an)]:[3,17];case 16:$n.sent(),$n.label=17;case 17:return((Mt=this._msgHash[Le])===null||Mt===void 0?void 0:Mt.resolve)instanceof Function&&this._msgHash[Le].resolve(Uc),[3,19];case 18:return Bi=$n.sent(),pi=b.Z.create({type:E.E.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,message:"when executing success function error",data:Bi}),this.onError&&this.onError(pi),(qt=this.eventHandler)===null||qt===void 0||qt.dispatch("onError",pi),[3,19];case 19:this.onReceivedMessage&&this.onReceivedMessage({id:Le,mid:an,to:this._msgHash[Le].to,time:0}),(he=this.eventHandler)===null||he===void 0||he.dispatch("onReceivedMessage",{id:Le,mid:an,to:this._msgHash[Le].to}),delete this._msgHash[Le],$n.label=20;case 20:return[3,22];case 21:if(Qe.status.errorCode===15)((Jt=this._msgHash[Le])===null||Jt===void 0?void 0:Jt.fail)instanceof Function&&this._msgHash[Le].fail({type:E.E.SERVICE_NOT_ALLOW_MESSAGING_MUTE,reason:"you were muted"}),this._msgHash[Le].reject instanceof Function&&this._msgHash[Le].reject({type:E.E.SERVICE_NOT_ALLOW_MESSAGING_MUTE,reason:"you were muted"}),(Ye=(Ve=this._localCache)===null||Ve===void 0?void 0:Ve.getInstance())===null||Ye===void 0||Ye.updateLocalMessage(Le,{serverMsgId:an,status:mt.r.FAIL});else if(Qe.status.errorCode===1){switch(hn=void 0,Qe.status.reason){case"blocked":hn=E.E.PERMISSION_DENIED;break;case"group not found":hn=E.E.GROUP_NOT_EXIST;break;case"not in group or chatroom":hn=E.E.GROUP_NOT_JOINED;break;case"exceed recall time limit":hn=E.E.MESSAGE_RECALL_TIME_LIMIT;break;case"message recall disabled":hn=E.E.SERVICE_NOT_ENABLED;break;case"not in group or chatroom white list":hn=E.E.SERVICE_NOT_ALLOW_MESSAGING;break;case"nonroster":hn=E.E.USER_NOT_FRIEND,Qe.status.reason="not contact";break;case"group is disabled":hn=E.E.GROUP_IS_DISABLED,Qe.status.reason="group is disabled";break;case"limit directed users":hn=E.E.MAX_LIMIT;break;case"Sorry, edit limit reached":hn=E.E.MAX_LIMIT,Qe.status.reason="Modify message limit reached";break;case"Sorry, message does not exist":hn=E.E.MODIFY_MESSAGE_NOT_EXIST,Qe.status.reason="The message does not exist.";break;case"Sorry, You do not have permission":hn=E.E.PERMISSION_DENIED,Qe.status.reason="You do not have the modified permission.";break;case"Sorry, format is incorrect":hn=E.E.MODIFY_MESSAGE_FORMAT_ERROR,Qe.status.reason="The modify messaged format error.";break;case"Sorry, edit is not available":hn=E.E.SERVICE_NOT_ENABLED,Qe.status.reason="The message modify function is not activated.";break;case"Sorry, edit fail":hn=E.E.MODIFY_MESSAGE_FAILED,Qe.status.reason="Modify message failed.";break;default:Qe.status.reason.includes("grpID")&&Qe.status.reason.includes("does not exist!")?(hn=E.E.CHATROOM_NOT_EXIST,Qe.status.reason="The chat room dose not exist."):Qe.status.reason.includes("username")&&Qe.status.reason.includes("doesn't exist!")?hn=E.E.USER_NOT_FOUND:Qe.status.reason==="group member list is full!"?hn=E.E.CHATROOM_MEMBERS_FULL:Qe.status.reason.includes("can not join this group")&&Qe.status.reason.includes("is in the blacklist")?(hn=E.E.PERMISSION_DENIED,Qe.status.reason="permission denied"):Qe.status.reason==="can not operate this group, reason: group is disabled"?hn=E.E.GROUP_IS_DISABLED:Qe.status.reason.includes("moderation")?hn=E.E.MESSAGE_MODERATION_BLOCKED:Qe.status.reason.includes("group ID illegal, please check it")?(hn=E.E.REQUEST_PARAMETER_ERROR,Qe.status.reason="Invalid parameter"):hn=Qe.status.reason.includes("has create too many chatrooms")||Qe.status.reason.includes("has joined too many chatrooms")?E.E.MAX_LIMIT:Qe.status.reason.includes("auto create failed")?E.E.SERVER_BUSY:E.E.SERVER_UNKNOWN_ERROR}this._msgHash[Le]&&(!((or=this._msgHash[Le])===null||or===void 0)&&or.isHandleChatroom?(Fn=b.Z.create({type:hn,message:Qe.status.reason||"",data:""}),this._msgHash[Le].reject instanceof Function&&this._msgHash[Le].reject(Fn),this._msgHash[Le].error instanceof Function&&this._msgHash[Le].error(Fn),At.iO.has(Le)&&(xc=Lt.dd.failed,hn===E.E.CHATROOM_NOT_EXIST?xc=Lt.dd.notFound:hn===E.E.CHATROOM_MEMBERS_FULL&&(xc=Lt.dd.reachLimit),uu=At.iO.get(Le),la=uu.rpt,Qn=uu.requestName,la({isEndApi:!0,data:{isSuccess:0,requestName:Qn,requestMethod:"WEBSOCKET",requestUrl:this.url,code:xc,codeDesc:Qe.status.reason}}),At.iO.delete(Le))):(Fn=b.Z.create({type:hn,message:Qe.status.reason||"",data:{id:Le,mid:an}}),this._msgHash[Le].reject instanceof Function&&this._msgHash[Le].reject(Fn),this._msgHash[Le].fail instanceof Function&&this._msgHash[Le].fail({type:hn,reason:Qe.status.reason?Qe.status.reason:"",data:{id:Le,mid:an}}),(tr=(ue=this._localCache)===null||ue===void 0?void 0:ue.getInstance())===null||tr===void 0||tr.updateLocalMessage(Le,{serverMsgId:an,status:mt.r.FAIL})),delete this._msgHash[Le])}else if(Qe.status.errorCode===7)Qe.status.reason==="sensitive words"&&this._msgHash[Le]?(Fn=b.Z.create({type:E.E.MESSAGE_INCLUDE_ILLEGAL_CONTENT,message:"sensitive words",data:{id:Le,mid:an}}),this._msgHash[Le].reject instanceof Function&&this._msgHash[Le].reject(Fn),this._msgHash[Le].fail instanceof Function&&this._msgHash[Le].fail({type:E.E.MESSAGE_INCLUDE_ILLEGAL_CONTENT,data:{id:Le,mid:an,reason:"sensitive words"}}),(_r=(Pr=this._localCache)===null||Pr===void 0?void 0:Pr.getInstance())===null||_r===void 0||_r.updateLocalMessage(Le,{serverMsgId:an,status:mt.r.FAIL})):Qe.status.reason==="blocked by mod_antispam"&&this._msgHash[Le]?(Fn=b.Z.create({type:E.E.MESSAGE_INCLUDE_ILLEGAL_CONTENT,message:"blocked by mod_antispam",data:{id:Le,mid:an}}),this._msgHash[Le].reject instanceof Function&&this._msgHash[Le].reject(Fn),this._msgHash[Le].fail instanceof Function&&this._msgHash[Le].fail({type:E.E.MESSAGE_INCLUDE_ILLEGAL_CONTENT,data:{id:Le,mid:an,reason:"blocked by mod_antispam"}}),(tn=(en=this._localCache)===null||en===void 0?void 0:en.getInstance())===null||tn===void 0||tn.updateLocalMessage(Le,{serverMsgId:an,status:mt.r.FAIL})):Qe.status.reason==="user is mute"&&this._msgHash[Le]?(Fn=b.Z.create({type:E.E.USER_MUTED_BY_ADMIN,message:"user is mute",data:{id:Le,mid:an}}),this._msgHash[Le].reject instanceof Function&&this._msgHash[Le].reject(Fn),this._msgHash[Le].fail instanceof Function&&this._msgHash[Le].fail(Fn),(Ln=(Kn=this._localCache)===null||Kn===void 0?void 0:Kn.getInstance())===null||Ln===void 0||Ln.updateLocalMessage(Le,{serverMsgId:an,status:mt.r.FAIL})):Qe.status.reason==="traffic limit"&&this._msgHash[Le]?(Fn=b.Z.create({type:E.E.MESSAGE_CURRENT_LIMITING,message:"traffic limit",data:{id:Le,mid:an}}),this._msgHash[Le].reject instanceof Function&&this._msgHash[Le].reject(Fn),this._msgHash[Le].fail instanceof Function&&this._msgHash[Le].fail(Fn),(hi=(ln=this._localCache)===null||ln===void 0?void 0:ln.getInstance())===null||hi===void 0||hi.updateLocalMessage(Le,{serverMsgId:an,status:mt.r.FAIL})):Qe.status.reason==="Sorry, data is too large"&&this._msgHash[Le]&&(Fn=b.Z.create({type:E.E.MESSAGE_SIZE_LIMIT,message:"Sorry, data is too large",data:{id:Le,mid:an}}),this._msgHash[Le].reject instanceof Function&&this._msgHash[Le].reject(Fn),this._msgHash[Le].fail instanceof Function&&this._msgHash[Le].fail(Fn),(Vs=(Xi=this._localCache)===null||Xi===void 0?void 0:Xi.getInstance())===null||Vs===void 0||Vs.updateLocalMessage(Le,{serverMsgId:an,status:mt.r.FAIL}));else if(Qe.status.errorCode===19)this._msgHash[Le]&&(At.TJ.has(Le)&&(At.TJ.get(Le).rpt({isEndApi:!0,data:{isSuccess:0,requestMethod:"WEBSOCKET",requestUrl:this.url,code:E.E.MESSAGE_EXTERNAL_LOGIC_BLOCKED,codeDesc:Qe.status.reason||"",msgId:an}}),At.TJ.delete(Le)),Fn=b.Z.create({type:E.E.MESSAGE_EXTERNAL_LOGIC_BLOCKED,message:Qe.status.reason||"",data:{id:Le,mid:an}}),this._msgHash[Le].reject instanceof Function&&this._msgHash[Le].reject(Fn),this._msgHash[Le].fail instanceof Function&&this._msgHash[Le].fail({type:E.E.MESSAGE_EXTERNAL_LOGIC_BLOCKED,data:{id:Le,mid:an,reason:Qe.status.reason}}),(za=(sn=this._localCache)===null||sn===void 0?void 0:sn.getInstance())===null||za===void 0||za.updateLocalMessage(Le,{serverMsgId:an,status:mt.r.FAIL}));else if(this._msgHash[Le]){At.TJ.has(Le)&&(At.TJ.get(Le).rpt({isEndApi:!0,data:{isSuccess:0,requestMethod:"WEBSOCKET",requestUrl:this.url,code:E.E.WEBIM_LOAD_MSG_ERROR,codeDesc:((Yo=Qe.status)===null||Yo===void 0?void 0:Yo.reason)||"",msgId:an}}),At.TJ.delete(Le));try{Fn=b.Z.create({type:E.E.WEBIM_LOAD_MSG_ERROR,message:((Xo=Qe.status)===null||Xo===void 0?void 0:Xo.reason)||"",data:{id:Le,mid:an,reason:Qe.status&&Qe.status.reason}}),this._msgHash[Le].reject instanceof Function&&this._msgHash[Le].reject(Fn),(_s=(js=this._localCache)===null||js===void 0?void 0:js.getInstance())===null||_s===void 0||_s.updateLocalMessage(Le,{serverMsgId:an,status:mt.r.FAIL}),this._msgHash[Le].fail instanceof Function&&this._msgHash[Le].fail({type:E.E.WEBIM_LOAD_MSG_ERROR,data:{errorCode:Qe.status&&Qe.status.errorCode,reason:Qe.status&&Qe.status.reason}})}catch(ti){pi=b.Z.create({type:E.E.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,message:"when executing fail function error",data:ti}),this.onError&&this.onError(pi),(ia=this.eventHandler)===null||ia===void 0||ia.dispatch("onError",pi)}delete this._msgHash[Le]}else At.TJ.has(Le)&&(At.TJ.get(Le).rpt({isEndApi:!0,data:{isSuccess:0,requestMethod:"WEBSOCKET",requestUrl:this.url,code:E.E.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,codeDesc:"on message error",msgId:an}}),At.TJ.delete(Le)),pi=b.Z.create({type:E.E.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,message:"on message error"}),this.onError&&this.onError(pi),(Es=this.eventHandler)===null||Es===void 0||Es.dispatch("onError",pi);$n.label=22;case 22:return[2];case 23:if(Qe.metas&&Qe.metas.length!==0)try{Oe.call(this,Qe.metas,Qe.status)}catch(ti){pi=b.Z.create({type:E.E.WEBIM_LOAD_MSG_ERROR,message:"decode message error",data:ti}),p.kg.error("decode message error",ti),this.onError&&this.onError(pi),(oa=this.eventHandler)===null||oa===void 0||oa.dispatch("onError",pi)}finally{Qe.isLast?(p.kg.debug("metas & CommSyncDLMessage.isLast",Qe.isLast),Vc=-1,this._queues.some(function(ti,Fi){return ti.name===Qe.name&&(Vc=Fi,!0)})&&Vc>0&&this._queues.splice(Vc,1),this._queues.length>0&&Ne.call(this,this._queues[0]),ha=-1,this.unSyncQueue.some(function(ti,Fi){return ti.name===Qe.queue.name&&(ha=Fi,!0)})&&this.unSyncQueue.splice(ha,1),xe.call(this,Qe)):Qe.nextKey&&(Io=new(_())(Qe.nextKey.low,Qe.nextKey.high,Qe.nextKey.unsigned).toString(),p.kg.debug("nexKey:",Io,"this.nextKey:",this.nexKey),Io!==this.nexKey&&(this.nexKey=Io,We.call(this,Qe.nextKey,Qe.queue)))}else Qe.isLast?(p.kg.debug("CommSyncDLMessage.isLast",Qe.isLast),jc=-1,this._queues.some(function(ti,Fi){return ti.name===Qe.queue.name&&(jc=Fi,!0)})&&this._queues.splice(jc,1),this._queues.length>0&&Ne.call(this,this._queues[0]),lu=-1,this.unSyncQueue.some(function(ti,Fi){return ti.name===Qe.queue.name&&(lu=Fi,!0)})&&this.unSyncQueue.splice(lu,1),xe.call(this,Qe)):Qe.nextKey&&(Io=new(_())(Qe.nextKey.low,Qe.nextKey.high,Qe.nextKey.unsigned).toString(),p.kg.debug("nexKey:",Io,"this.nextKey:",this.nexKey),Io!==this.nexKey&&(this.nexKey=Io,We.call(this,Qe.nextKey,Qe.queue)));return[2]}})})}function Ft(I){var X=[],_t=this.root.lookup("easemob.pb.KeyValue"),K=[];for(var dt in I){var bt=_t.decode(X);if(bt.key=dt,I[dt]!==void 0){if(zt(I[dt])==="object")bt.type=8,bt.stringValue=JSON.stringify(I[dt]);else if(typeof I[dt]=="string")bt.type=7,bt.stringValue=I[dt];else if(typeof I[dt]=="boolean")bt.type=1,bt.varintValue=I[dt]===!0?1:0;else if(Number.isInteger(I[dt]))bt.type=2,bt.varintValue=I[dt];else if(typeof I[dt]=="bigint"||zt(I[dt])==="symbol"||typeof I[dt]=="function"||Number.isNaN(I[dt]))bt.type=7,bt.stringValue=I[dt].toString();else{if(typeof I[dt]!="number"||Number.isInteger(I[dt]))continue;bt.type=6,bt.doubleValue=I[dt]}K.push(bt)}}return K}function St(I){var X,_t,K,dt=[];if(this.root){var bt,rt=this.root.lookup("easemob.pb.MessageBody.Content").decode(dt);switch(bt=!I.group&&((X=I?.chatType)===null||X===void 0?void 0:X.toLowerCase())!=="groupchat"||I.roomType?I.group&&I.roomType||((_t=I?.chatType)===null||_t===void 0?void 0:_t.toLowerCase())==="chatroom"?"chatRoom":"singleChat":"groupChat",I.type){case"txt":rt.type=0,rt.text=I.msg;break;case"img":rt.type=1,I.body?(rt.displayName=I.body.filename,rt.remotePath=I.body.url,rt.secretKey=I.body.secret,rt.fileLength=I.body.file_length,rt.size=I.body.size,rt.thumbnailDisplayName=I.body.filename):I.file?(rt.displayName=I.file.filename,rt.remotePath=I.file.url,rt.secretKey=I.file.secret,rt.fileLength=I.file.file_length,rt.size=I.file.size,rt.thumbnailDisplayName=I.file.filename):(rt.displayName=I.filename,rt.remotePath=I.url,rt.secretKey=I.secret,rt.fileLength=I.file_length,rt.size=I.size,rt.thumbnailDisplayName=I.filename),I.isBuildCombinedMsg&&(rt.remotePath=I.url,rt.secretKey=I.secret,rt.size={height:I.height,width:I.width});break;case"video":rt.type=2,I.body?(rt.displayName=I.body.filename,rt.remotePath=I.body.url,rt.secretKey=I.body.secret,rt.fileLength=I.body.file_length,rt.duration=I.body.length,rt.thumbnailDisplayName=I.body.filename,rt.thumbnailRemotePath=this.useOwnUploadFun?"":"".concat(I.body.url,"?vframe=true"),rt.thumbnailSecretKey=this.useOwnUploadFun?"":I.body.secret):I.isBuildCombinedMsg&&(rt.displayName=I.filename,rt.remotePath=I.url,rt.secretKey=I.secret,rt.fileLength=I.file_length,rt.duration=I.length,rt.thumbnailDisplayName=I.filename,rt.thumbnailRemotePath=I.thumb,rt.thumbnailSecretKey=I.thumb_secret);break;case"loc":rt.type=3,rt.latitude=I.lat,rt.longitude=I.lng,rt.address=I.addr,rt.buildingName=I.buildingName,rt.latitude=I.lat;break;case"audio":rt.type=4,I.body?(rt.displayName=I.body.filename,rt.remotePath=I.body.url,rt.secretKey=I.body.secret,rt.fileLength=I.body.file_length,rt.duration=I.body.length,rt.thumbnailDisplayName=I.body.filename):I.isBuildCombinedMsg&&(rt.displayName=I.filename,rt.remotePath=I.url,rt.secretKey=I.secret,rt.fileLength=I.file_length,rt.duration=I.length,rt.thumbnailDisplayName=I.filename);break;case"file":rt.type=5,I.body?(rt.displayName=I.body.filename,rt.remotePath=I.body.url,rt.secretKey=I.body.secret,rt.fileLength=I.body.file_length,rt.thumbnailDisplayName=I.body.filename):I.isBuildCombinedMsg&&(rt.displayName=I.filename,rt.remotePath=I.url,rt.secretKey=I.secret,rt.fileLength=I.file_length,rt.thumbnailDisplayName=I.filename);break;case"cmd":rt.type=6,rt.action=I.action;break;case"custom":rt.type=7,rt.customEvent=I.customEvent,rt.customExts=Ft.call(this,I.customExts);break;case"combine":rt.type=0,rt.subType=0,rt.text=I.compatibleText,rt.displayName=I.filename,rt.remotePath=I.url,rt.secretKey=I.secret,rt.fileLength=I.file_length,rt.title=I.title,rt.summary=I.summary,rt.combineLevel=I.combineLevel}var Vt=[];I.ext&&(Vt=Ft.call(this,I.ext));var ut=this.root.lookup("easemob.pb.MessageBody"),Kt=ut.decode(dt),jt=I.from||this.context.jid.name;Kt.from={name:I.isBuildCombinedMsg?jt:this.context.jid.name};var ge=I.to.indexOf("/"),W=ge>-1?I.to.substring(0,ge):I.to;if(Kt.to={name:W},I.type==="channel")Kt.type=re.CHANNEL_ACK;else if(I.type==="recall")Kt.type=re.RECALL,Kt.ackMessageId=I.ackId;else if(I.type==="delivery")Kt.type=re.DELIVER_ACK,Kt.ackMessageId=I.ackId;else if(I.type==="read")Kt.type=re.READ_ACK,Kt.ackMessageId=I.ackId,bt==="groupChat"&&(Kt.msgConfig={allowGroupAck:!0},Kt.ackContent=I.ackContent);else if(bt==="chatRoom")Kt.type=re.CHATROOM;else if(bt==="groupChat"){if(Kt.type=re.GROUPCHAT,I.msgConfig){var lt=I.msgConfig.allowGroupAck;Kt.msgConfig={allowGroupAck:!!lt}}}else bt==="singleChat"&&(Kt.type=re.SINGLECHAT);I.editMessageId&&(Kt.type=re.EDIT,Kt.editMessageId=I.editMessageId),Kt.contents=[rt],Kt.ext=Vt;var ct=function(Ve){var Ye={};return"translations"in Ve&&(Ye.translations=Ve.translations),"isChatThread"in Ve&&Ve.isChatThread&&(Ye.thread={}),Object.keys(Ye).length>0?JSON.stringify(Ye):""}(I);ct&&(Kt.meta=ct),Kt=ut.encode(Kt).finish();var It=this.root.lookup("easemob.pb.Meta"),Ct=It.decode(dt);Ct.id=I.id;var Ot="easemob.com";if(bt!=="chatRoom"&&bt!=="groupChat"||(Ot="conference.easemob.com"),Ct.to={appKey:this.appKey,name:W,domain:Ot},ge>-1&&(Ct.to.clientResource=I.to.substring(ge+1,I.to.length)),bt==="chatRoom"&&(Ct.ext=Ft.call(this,function(Ve){return{chatroom_msg_tag:Ve.priority==="high"?0:Ve.priority==="low"?2:1}}(I))),I.type==="recall"&&I.metaExt&&(Ct.ext=Ft.call(this,{recallMessageExtensionInfo:I.metaExt})),Ct.ns=1,Ct.payload=Kt,Ct.routetype=I.deliverOnlineOnly?1:0,bt!=="singleChat"&&Array.isArray(I.receiverList)&&((K=I.receiverList)===null||K===void 0?void 0:K.length)>0&&(Ct.directedUsers=I.receiverList,Ct.routetype=2),I.isBuildCombinedMsg)return Ct.timestamp=_().fromValue(I.time),It.encode(Ct).finish();var Mt=this.root.lookup("easemob.pb.CommSyncUL"),qt=Mt.decode(dt);qt.meta=Ct,Ut.call(this,I,Ct),qt=Mt.encode(qt).finish();var he=this.root.lookup("easemob.pb.MSync"),Jt=he.decode(dt);return Jt.version=this.version,Jt.encryptType=this.encryptType,Jt.command=0,Jt.payload=qt,he.encode(Jt).finish()}I.fail&&I.fail({type:E.E.WEBIM_CONNCTION_CLIENT_OFFLINE,message:"Not logged in"})}function Nt(I){var X,_t,K=this,dt=gt({},I);if(I.file)return dt.accessToken=this.token,dt.appKey=this.appKey,dt.apiUrl=this.apiUrl,dt.body&&dt.body.url?St.call(this,dt):new Promise(function(ut,Kt){var jt=dt.onFileUploadComplete;dt.onFileUploadComplete=function(ge){var W,lt,ct,It,Ct,Ot;if(ge.entities[0]["file-metadata"]){var Mt=ge.entities[0]["file-metadata"]["content-length"];dt.file_length=Mt,dt.filetype=ge.entities[0]["file-metadata"]["content-type"],Mt>204800&&(dt.thumbnail=!0)}var qt="".concat(K.apiUrl,"/").concat(K.orgName,"/").concat(K.appName,"/chatfiles/").concat(ge.entities[0].uuid);dt.body={type:dt.type||"file",secret:ge.entities[0]["share-secret"],filename:dt.file.filename||dt.filename,url:qt,length:dt.length||0,filetype:dt.filetype||dt.file.filetype,file_length:((lt=(W=dt.file)===null||W===void 0?void 0:W.data)===null||lt===void 0?void 0:lt.size)||0,size:{width:dt.width||0,height:dt.height||0}},dt.file.url=ge.uri,I.secret=ge.entities[0]["share-secret"],ge.url=I.url="".concat(qt,"?em-redirect=true&share-secret=").concat(ge.entities[0]["share-secret"]),I.file_length=dt.file_length=((It=(ct=dt.file)===null||ct===void 0?void 0:ct.data)===null||It===void 0?void 0:It.size)||0,dt.type==="img"&&(I.thumb="".concat(I.url,"&thumbnail=true"),ge.thumb="".concat(ge.url,"&thumbnail=true")),dt.type==="video"&&(I.thumb="".concat(I.url,"&vframe=true"),I.thumb_secret=ge.entities[0]["share-secret"],ge.thumb="".concat(ge.url,"&vframe=true")),jt instanceof Function&&jt(ge,dt.id);var he=St.call(K,dt);At.TJ.size<=At.F3&&At.TJ.set(dt.id,{rpt:K.dataReport.geOperateFun({operationName:Lt.fI.SEND_MSG})}),(Ot=(Ct=K._localCache)===null||Ct===void 0?void 0:Ct.getInstance())===null||Ot===void 0||Ot.storeMessage(I,mt.r.INPROGRESS),pe.call(K,he)},z.P6.uploadFile.call(K,dt,Lt.fI.UPLOAD_MSG_ATTACH)});if(I.type==="combine"){dt.accessToken=this.token,dt.appKey=this.appKey,dt.apiUrl=this.apiUrl;var bt=dt.onFileUploadComplete,rt=dt.onFileUploadError;return new Promise(function(ut,Kt){var jt,ge,W,lt;if(((jt=I.messageList)===null||jt===void 0?void 0:jt.length)>300||((ge=I.messageList)===null||ge===void 0?void 0:ge.length)===0)return K._msgHash[dt.id].reject({type:E.E.MAX_LIMIT,message:"The number of combined messages exceeded the limit."});var ct=Wt([],I.messageList),It=0;if(ct.forEach(function(Ye){Ye?.combineLevel>It&&(It=Ye?.combineLevel)}),dt.combineLevel=It+1,dt.combineLevel>10)return K._msgHash[dt.id].reject({type:E.E.MAX_LIMIT,message:"The level of the merged message exceeded the limit."});var Ct=Xt.call(K,ct),Ot=function(Ye,or){var ue,tr,Pr,_r,en,tn,Kn="".concat(K.apiUrl,"/").concat(K.orgName,"/").concat(K.appName,"/chatfiles/").concat(Ye.entities[0].uuid),Ln=(ue=Ye.entities[0])===null||ue===void 0?void 0:ue["share-secret"],ln=Kn+"?em-redirect=true";Ln&&(ln="".concat(ln,"&share-secret=").concat(Ln)),bt instanceof Function&&bt({url:ln,secret:Ln}),I.url=ln,I.secret=Ln,dt.url=ln,dt.secret=Ye.entities[0]["share-secret"],dt.filename=((tr=dt.file)===null||tr===void 0?void 0:tr.filename)||or?.fileName,dt.file_length=((_r=(Pr=dt.file)===null||Pr===void 0?void 0:Pr.data)===null||_r===void 0?void 0:_r.size)||or?.fileLength||0,(tn=(en=K._localCache)===null||en===void 0?void 0:en.getInstance())===null||tn===void 0||tn.storeMessage(I,mt.r.INPROGRESS);var hi=St.call(K,dt);pe.call(K,hi)},Mt=z.P6.getEnvInfo();if(Mt.platform!=="web"&&Mt.platform!=="node"&&Mt.platform!=="quick_app"&&(!((lt=(W=Mt.global)===null||W===void 0?void 0:W.canIUse)===null||lt===void 0)&&lt.call(W,"getFileSystemManager"))){var qt=Mt.global.getFileSystemManager(),he="".concat(K.apiUrl,"/").concat(K.orgName,"/").concat(K.appName,"/chatfiles");qt.writeFile({filePath:"".concat(Mt.global.env.USER_DATA_PATH,"/combine"),data:Ct.buffer,encoding:"binary",success:function(Ye){Mt.global.uploadFile({url:he,filePath:"".concat(Mt.global.env.USER_DATA_PATH,"/combine"),name:"file",header:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+dt.accessToken},success:function(or){if(or.statusCode===200){p.kg.debug("upload success",or);var ue=JSON.parse(or.data);Ot(ue,{fileName:"combine",fileLength:Ct.length})}else p.kg.debug("upload fail"),dt.onFileUploadError instanceof Function&&dt.onFileUploadError(or),this._msgHash[dt.id].reject({type:E.E.WEBIM_UPLOADFILE_ERROR,message:"Failed to upload the merge message.Please try again",data:or})},fail:function(or){p.kg.debug("upload fail"),dt.onFileUploadError instanceof Function&&dt.onFileUploadError(Ye),this._msgHash[dt.id].reject({type:E.E.WEBIM_UPLOADFILE_ERROR,message:"Failed to upload the merge message.Please try again",data:or})}})},fail:function(Ye){p.kg.debug("write file fail",Ye),this._msgHash[dt.id].reject({type:E.E.WEBIM_UPLOADFILE_ERROR,message:"Failed to upload the merge message.Please try again",data:Ye})}})}else{var Jt=new File([Ct],"combine",{type:"application/octet-stream"}),Ve={url:URL.createObjectURL(Jt),filename:dt.id,data:Jt};dt.file=Ve,dt.onFileUploadComplete=function(Ye){Ot(Ye)},dt.onFileUploadError=function(Ye){rt instanceof Function&&rt(Ye),K._msgHash[dt.id].reject({type:E.E.WEBIM_UPLOADFILE_ERROR,message:"Failed to upload the merge message.Please try again",data:Ye})},z.P6.uploadFile.call(K,dt,Lt.fI.UPLOAD_MSG_ATTACH)}})}I.type==="img"&&(dt.body||(dt.body=gt(gt({},dt),{size:{width:dt.width||0,height:dt.height||0}}))),(_t=(X=this._localCache)===null||X===void 0?void 0:X.getInstance())===null||_t===void 0||_t.storeMessage(I,mt.r.INPROGRESS);var Vt=St.call(this,dt);pe.call(this,Vt)}function Ut(I,X){I.editMessageId||oe.includes(I.type)&&(this._msgHash[I.id].thirdMessage=X)}function Xt(I){for(var X=Uint8Array.from("cm",function(W){return W.charCodeAt(0)}),_t=0;_t<I.length;_t++){for(var K=I[_t],dt=gt(gt({},K),{isBuildCombinedMsg:!0}),bt=this.mSync.encodeChatMsg.call(this,dt),rt=bt.length,Vt=new Uint8Array(4),ut=0;ut<4;ut++)Vt[ut]=rt>>8*(3-ut)&255;p.kg.debug("message length:",Vt);var Kt=new Uint8Array(X.length+Vt.length+bt.length);Kt.set(X),Kt.set(Vt,X.length),Kt.set(bt,X.length+Vt.length),X=Kt}var jt=new Uint8Array(X.length+1),ge=0;for(_t=2;_t<X.length;_t++)_t%2==1&&(ge^=X[_t]);return jt.set(X),p.kg.debug("checkResult:",ge),jt[X.length]=ge,jt}function Gt(I,X,_t){var K=[],dt=this.root.lookup("easemob.pb.MUCBody"),bt=I.roomId,rt=I.ext,Vt=rt===void 0?"":rt,ut=I.leaveOtherRooms,Kt=ut!==void 0&&ut,jt=dt.decode(K);jt.mucId={appKey:this.appKey,name:bt,domain:"conference.easemob.com"},jt.operation=_t==="join"?2:3,jt.from={name:this.context.userId},jt.isChatroom=!0,_t==="join"&&(jt.ext=Vt,jt.leaveOtherRooms=Kt),jt=dt.encode(jt).finish();var ge=this.root.lookup("easemob.pb.Meta").decode(K);ge.id=X,ge.from={appKey:this.appKey,name:this.context.userId,domain:"easemob.com",client_resource:this.context.jid.clientResource},ge.to={domain:"easemob.com"},ge.ns=2,ge.payload=jt;var W=this.root.lookup("easemob.pb.CommSyncUL"),lt=W.decode(K);lt.meta=ge,lt=W.encode(lt).finish();var ct=this.root.lookup("easemob.pb.MSync"),It=ct.decode(K);return It.version=this.version,It.encryptType=this.encryptType,It.command=0,It.payload=lt,ct.encode(It).finish()}function ne(I,X){var _t=z.P6.getUniqueId(),K=Gt.call(this,I,_t,X),dt=X==="join"?Lt.fI.JOIN_CHATROOM:Lt.fI.QUIT_CHATROOM,bt=this.dataReport.geOperateFun({operationName:dt});return At.iO.size<=At.F3&&At.iO.set(_t,{rpt:bt,requestName:dt}),pe.call(this,gt(gt({},I),{isHandleChatroom:!0,joinMsg:K,id:_t,operation:X}),_t)}function Re(I){var X=this;return new Promise(function(_t,K){var dt,bt,rt,Vt,ut,Kt;if(p.kg.debug("call send"),X.logOut)return p.kg.debug("send message failed",E.E.WEBIM_CONNECTION_CLOSED),K({type:E.E.WEBIM_CONNECTION_CLOSED,message:"not login"});if(!I.id||typeof I.id!="string"||I.id==="")return K({type:E.E.MESSAGE_PARAMETER_ERROR,message:'Missing required parameter: "id"'});if(!I.to||typeof I.to!="string"||I.to==="")return K({type:E.E.MESSAGE_PARAMETER_ERROR,message:'Missing required parameter: "to"'});var jt=I.type==="file"||I.type==="img"||I.type==="audio"||I.type==="video",ge=I.type==="delivery"||I.type==="read"||I.type==="channel",W=I.type==="cmd",lt=I.type==="recall",ct=I?.editMessageId,It=!(ge||lt||W||ct);if(I.id){if(!jt&&!ge||jt&&X.useOwnUploadFun){var Ct=I.type==="recall"?Lt.fI.SEND_RECALL_MSG:Lt.fI.SEND_MSG;ct&&(Ct=Lt.fI.MODIFY_MESSAGE),At.TJ.size<=At.F3&&At.TJ.set(I.id,{rpt:X.dataReport.geOperateFun({operationName:Ct})})}It&&((bt=(dt=X._localCache)===null||dt===void 0?void 0:dt.getInstance())===null||bt===void 0||bt.storeMessage(I,mt.r.CREATE)),X._msgHash[I.id]=gt(gt({},I),{resolve:_t,reject:K})}if(jt||I.type==="combine")return Nt.call(X,I);if(I.type==="txt"&&(!((rt=I.msgConfig)===null||rt===void 0)&&rt.languages)&&Array.isArray((Vt=I.msgConfig)===null||Vt===void 0?void 0:Vt.languages)&&I.msgConfig.languages.length>0){var Ot=X.translateMessage||X.translation.translateMessage;if(!Ot)throw new Error("there is no method to translate message");Ot.call(X,{text:I.msg,languages:I.msgConfig.languages}).then(function(qt){var he,Jt,Ve,Ye=(he=qt.data[0])===null||he===void 0?void 0:he.translations;Ye=Ye.map(function(ue){return{code:ue.to,text:ue.text}}),I.translations=Ye,X._msgHash[I.id].translations=Ye,(Ve=(Jt=X._localCache)===null||Jt===void 0?void 0:Jt.getInstance())===null||Ve===void 0||Ve.storeMessage(I,mt.r.INPROGRESS);var or=St.call(X,I);pe.call(X,or,I.id)}).catch(function(qt){K(qt)})}else{It&&((Kt=(ut=X._localCache)===null||ut===void 0?void 0:ut.getInstance())===null||Kt===void 0||Kt.storeMessage(I,mt.r.INPROGRESS));var Mt=St.call(X,I);pe.call(X,Mt,I.id)}})}function pe(I,X){var _t,K,dt=this;if(I.isHandleChatroom){if(!this.isOpened()){var bt={data:"",type:E.E.WEBIM_CONNCTION_DISCONNECTED,message:"websocket has been disconnected"};if(At.iO.has(I.id)){var rt=At.iO.get(I.id);(0,rt.rpt)({isEndApi:!0,data:{isSuccess:0,requestName:rt.requestName,requestMethod:"WEBSOCKET",requestUrl:this.url,code:Lt.dd.disconnect,codeDesc:"websocket has been disconnected"}}),At.iO.delete(I.id)}return Promise.reject(bt)}return new Promise(function(Vt,ut){var Kt;dt._msgHash[I.id]=gt(gt({},I),{resolve:Vt,reject:ut}),Kt=dt.name==="miniCore"?I.joinMsg:Ie.call(dt,I.joinMsg,X),dt.sock.send(Kt)})}if(!this.isOpened())return(_t=this.unMSyncSendMsgMap)===null||_t===void 0||_t.set(X,I),!this.logOut&&this.autoReconnectNumTotal<this.autoReconnectNumMax&&(p.kg.debug("need to reconnect",this.autoReconnectNumTotal,this.autoReconnectNumMax),this.offLineSendConnecting=!0,this.reconnecting||this.reconnect()),void(this.onError&&this.onError({type:E.E.WEBIM_CONNCTION_DISCONNECTED,message:"websocket has been disconnected"}));K=this.name==="miniCore"?I:Ie.call(this,I,X),this.sock.send(K)}var Je=function(I,X){return I.send=Re,I.sendMsg=Re,p.kg.debug("init Msync by ".concat(I.name)),{generateProvision:le.bind(I),base64transform:Ie.bind(I),distributeMeta:me.bind(I),decodeMeta:Oe.bind(I),decodeUnreadDL:ir.bind(I),_rebuild:He.bind(I),_lastsession:Ze.bind(I),receiveProvision:Pe.bind(I),isInQueue:ot.bind(I),decodeNotice:Et.bind(I),decodeMSync:nt.bind(I),distributeMSync:Dt.bind(I),encodeChatMsg:St.bind(I),upLoadFile:Nt.bind(I),send:Re.bind(I),stopHeartBeat:Be.bind(I),handleChatRoom:ne.bind(I)}}},7252:function(O,H){var a=function(){function f(h){this.type=h.type,this.message=h.message,this.data=h.data}return f.create=function(h){return new f(h)},f}();H.Z=a},8161:function(O,H,a){a.d(H,{t:function(){return z}}),a(9601),a(1539),a(8674),a(2526),a(1817),a(2165),a(6992),a(8783),a(3948),a(7941),a(3710),a(9714),a(9653),a(6699),a(2023),a(2222),a(8309),a(9554),a(4747),a(2772);var f=a(3720),h=a.n(f),g=a(4363),_=a(4024),E=a(6424),m=a(9743),p=a(7360),A=a(2449),R=a(7288),D=function(){return D=Object.assign||function(U){for(var Y,q=1,V=arguments.length;q<V;q++)for(var it in Y=arguments[q])Object.prototype.hasOwnProperty.call(Y,it)&&(U[it]=Y[it]);return U},D.apply(this,arguments)},P=function(U,Y,q,V){return new(q||(q=Promise))(function(it,mt){function wt(Yt){try{Ht(V.next(Yt))}catch(At){mt(At)}}function yt(Yt){try{Ht(V.throw(Yt))}catch(At){mt(At)}}function Ht(Yt){var At;Yt.done?it(Yt.value):(At=Yt.value,At instanceof q?At:new q(function(Lt){Lt(At)})).then(wt,yt)}Ht((V=V.apply(U,[])).next())})},k=function(U,Y){var q,V,it,mt,wt={label:0,sent:function(){if(1&it[0])throw it[1];return it[1]},trys:[],ops:[]};return mt={next:yt(0),throw:yt(1),return:yt(2)},typeof Symbol=="function"&&(mt[Symbol.iterator]=function(){return this}),mt;function yt(Ht){return function(Yt){return function(At){if(q)throw new TypeError("Generator is already executing.");for(;wt;)try{if(q=1,V&&(it=2&At[0]?V.return:At[0]?V.throw||((it=V.return)&&it.call(V),0):V.next)&&!(it=it.call(V,At[1])).done)return it;switch(V=0,it&&(At=[2&At[0],it.value]),At[0]){case 0:case 1:it=At;break;case 4:return wt.label++,{value:At[1],done:!1};case 5:wt.label++,V=At[1],At=[0];continue;case 7:At=wt.ops.pop(),wt.trys.pop();continue;default:if(!((it=(it=wt.trys).length>0&&it[it.length-1])||At[0]!==6&&At[0]!==2)){wt=0;continue}if(At[0]===3&&(!it||At[1]>it[0]&&At[1]<it[3])){wt.label=At[1];break}if(At[0]===6&&wt.label<it[1]){wt.label=it[1],it=At;break}if(it&&wt.label<it[2]){wt.label=it[2],wt.ops.push(At);break}it[2]&&wt.ops.pop(),wt.trys.pop();continue}At=Y.call(U,wt)}catch(Lt){At=[6,Lt],V=0}finally{q=it=0}if(5&At[0])throw At[1];return{value:At[0]?At[1]:void 0,done:!0}}([Ht,Yt])}}},b={0:"TEXT",1:"IMAGE",2:"VIDEO",3:"LOCATION",4:"VOICE",5:"FILE",6:"COMMAND",7:"CUSTOM",8:"COMBINE"};function j(U){for(var Y={},q=0;q<U.length;q++)if(U[q].type===8)Y[U[q].key]=JSON.parse(U[q].stringValue);else if(U[q].type===7)Y[U[q].key]=U[q].stringValue;else if(U[q].type===6)Y[U[q].key]=U[q].doubleValue;else if(U[q].type===5)Y[U[q].key]=U[q].floatValue;else if(U[q].type===1){var V=U[q].varintValue,it=new(h())(V.low,V.high,V.unsigned).toString();Y[U[q].key]=Number(it)!==0}else U[q].type!==2&&U[q].type!==3&&U[q].type!==4||(V=U[q].varintValue,it=new(h())(V.low,V.high,V.unsigned).toString(),Y[U[q].key]=Number(it));return Y}function z(U){var Y="";return U.remotePath&&(Y=_.P6.formatAttachUrl.call(this,U.remotePath),U.remotePath.includes("?em-redirect")||(Y="".concat(Y,"?em-redirect=true"),U.secretKey&&(Y="".concat(Y,"&share-secret=").concat(U.secretKey)))),Y}function S(U,Y){var q,V,it=Y.from&&Y.from.name;if(it===this.context.userId){var mt=(q=U?.from)===null||q===void 0?void 0:q.clientResource;it===((V=Y?.to)===null||V===void 0?void 0:V.name)&&mt&&mt!==this.clientResource&&(it="".concat(it,"/").concat(mt))}return it}function F(U,Y){var q,V=Y.to&&Y.to.name;return!((q=U?.to)===null||q===void 0)&&q.clientResource&&(V="".concat(V,"/").concat(U.to.clientResource)),V}function M(U){var Y,q,V,it,mt,wt,yt,Ht,Yt,At,Lt,zt,re,de,ft,gt,Zt,Pt,Wt,oe,fe,le,Ie,me,Oe,je,xe;return P(this,void 0,void 0,function(){var ir,He,ae,Ne,Ze,ee,be,We,Pe,Ee,te,Ae,Xe,Be,ze,ot,Et,nt,Dt,B,Ft,St,Nt,Ut,Xt,Gt,ne,Re,pe,Je,I,X,_t,K,dt,bt,rt,Vt,ut,Kt,jt,ge,W,lt,ct,It,Ct,Ot,Mt,qt,he,Jt;return k(this,function(Ve){switch(Ve.label){case 0:switch(ir=U.status,He=U.thirdMessage,ae=U.msgBody,Ne=U.msgId,Ze=U.type,ee=U.from,be=U.to,We=U.time,Pe=U.onlineState,Ee=U.chatType,te=U.ignoreCallback,Ae=U.priority,Xe=U.format,Be=U.broadcast,ze=Be!==void 0&&Be,ot=U.isContentReplaced,Et=ot!==void 0&&ot,nt={},Dt={},B=ir.errorCode>0,Ft=ir.errorCode,St=ir.reason,Nt={},Ut=[],Xt=[],Gt={},ne="",Re=0,pe=null,Je=null,He.ext&&(Nt=j(He.ext)),He.meta&&typeof He.meta=="string"&&((X=JSON.parse(He.meta)).reaction&&(Ut=X.reaction).forEach(function(Ye){Ye.isAddedBySelf=Ye.state,delete Ye.state}),X.translations&&(Xt=X.translations),X.edit_msg&&(_t=X.edit_msg,K=_t.count,dt=_t.operator,bt=_t.edit_time,rt=_t.sender,Vt=_t.send_time,Gt={operationTime:bt,operatorId:dt,operationCount:K},ne=rt,Re=Vt),X.thread&&JSON.stringify(X.thread)!=="{}"&&(pe={messageId:X.thread.msg_parent_id,parentId:X.thread.muc_parent_id,chatThreadName:X.thread.thread_name}),X.thread_overview&&JSON.stringify(X.thread_overview)!=="{}"&&(Je={id:X.thread_overview.id,parentId:X.thread_overview.muc_parent_id,name:X.thread_overview.name,lastMessage:X.thread_overview.last_message&&JSON.stringify(X.thread_overview.last_message)!=="{}"?g.w.call(this,X.thread_overview.last_message):null,createTimestamp:X.thread_overview.create_timestamp,updateTimestamp:X.thread_overview.update_timestamp,messageCount:X.thread_overview.message_count||0})),ae.type){case 0:return[3,1];case 1:return[3,7];case 2:return[3,10];case 3:return[3,13];case 4:return[3,16];case 5:return[3,19];case 6:return[3,22];case 7:return[3,23];case 8:return[3,26]}return[3,27];case 1:return Object.prototype.hasOwnProperty.call(ae,"subType")&&ae.subType===0?(I=z.call(this,ae),ut={id:Ne,type:"combine",chatType:Ee,to:be,from:ee,ext:Nt,time:Number(We),onlineState:Pe,title:ae.title||"",summary:ae.summary||"",url:I||"",secret:ae.secretKey||"",file_length:ae.fileLength||0,filename:ae.displayName||"",compatibleText:ae.text,combineLevel:ae.combineLevel||0},nt.msgConfig&&(ut.msgConfig=nt.msgConfig),Ut.length>0&&(ut.reactions=Ut),pe&&(ut.chatThread=pe),Je&&(ut.chatThreadOverview=Je),Ee==="chatRoom"&&(ut.priority=Ae,ut.broadcast=ze),Et&&(ut.isContentReplaced=Et),Dt=ut,te?[3,3]:[4,(q=(Y=this._localCache)===null||Y===void 0?void 0:Y.getInstance())===null||q===void 0?void 0:q.storeMessage(ut,R.r.SUCCESS)]):[3,4];case 2:Ve.sent(),(V=this.eventHandler)===null||V===void 0||V.dispatch("onCombineMessage",ut),Ve.label=3;case 3:return[3,28];case 4:return!(nt={id:Ne,type:Ze,contentsType:b[ae.type],from:ee,to:be,data:ae.text,ext:Nt,sourceMsg:ae.text,time:We,msgConfig:He.msgConfig,onlineState:Pe}).msgConfig&&delete He.msgConfig,nt.error=B,nt.errorText=St,nt.errorCode=Ft,!te&&this.onTextMessage&&this.onTextMessage(nt),Kt={id:Ne,type:"txt",chatType:Ee,msg:ae.text,to:be,from:ee,ext:Nt,time:Number(We),onlineState:Pe},nt.msgConfig&&(Kt.msgConfig=nt.msgConfig),Ut.length>0&&(Kt.reactions=Ut),pe&&(Kt.chatThread=pe),Je&&(Kt.chatThreadOverview=Je),Xt.length>0&&(Kt.translations=Xt),Gt.operationCount>0&&(Kt.modifiedInfo=Gt,He.type===E.gA.EDIT&&(Kt.from=ne,Kt.time=Re)),Ee==="chatRoom"&&(Kt.priority=Ae,Kt.broadcast=ze),Et&&(Kt.isContentReplaced=Et),Dt=Kt,te?[3,6]:[4,(mt=(it=this._localCache)===null||it===void 0?void 0:it.getInstance())===null||mt===void 0?void 0:mt.storeMessage(Kt,R.r.SUCCESS)];case 5:Ve.sent(),(wt=this.eventHandler)===null||wt===void 0||wt.dispatch("onTextMessage",Kt),Ve.label=6;case 6:return[3,28];case 7:return jt=((yt=ae?.size)===null||yt===void 0?void 0:yt.width)||0,ge=((Ht=ae?.size)===null||Ht===void 0?void 0:Ht.height)||0,I=this.useOwnUploadFun?ae.remotePath:z.call(this,ae),!(nt={id:Ne,type:Ze,contentsType:b[ae.type],from:ee,to:be,url:I,secret:ae.secretKey,filename:ae.displayName,thumb:this.useOwnUploadFun?"":"".concat(I,"&thumbnail=true"),thumb_secret:ae.secretKey,file_length:ae.fileLength||"",width:jt,height:ge,filetype:ae.filetype||"",accessToken:this.token,ext:Nt,time:We,msgConfig:He.msgConfig,onlineState:Pe}).delay&&delete nt.delay,!nt.msgConfig&&delete He.msgConfig,nt.error=B,nt.errorText=St,nt.errorCode=Ft,!te&&this.onPictureMessage&&this.onPictureMessage(nt),W={id:Ne,type:"img",chatType:Ee,from:ee,to:be,url:I||"",width:jt,height:ge,secret:ae.secretKey||"",thumb:this.useOwnUploadFun?"":"".concat(I,"&thumbnail=true"),thumb_secret:ae.secretKey,file_length:ae.fileLength||0,ext:Nt,time:Number(We),onlineState:Pe},nt.msgConfig&&(W.msgConfig=nt.msgConfig),Ut.length>0&&(W.reactions=Ut),pe&&(W.chatThread=pe),Je&&(W.chatThreadOverview=Je),Ee==="chatRoom"&&(W.priority=Ae,W.broadcast=ze),Et&&(W.isContentReplaced=Et),Dt=W,te?[3,9]:[4,(At=(Yt=this._localCache)===null||Yt===void 0?void 0:Yt.getInstance())===null||At===void 0?void 0:At.storeMessage(W,R.r.SUCCESS)];case 8:Ve.sent(),(Lt=this.eventHandler)===null||Lt===void 0||Lt.dispatch("onImageMessage",W),Ve.label=9;case 9:return[3,28];case 10:return I=this.useOwnUploadFun?ae.remotePath:z.call(this,ae),!(nt={id:Ne,type:Ze,contentsType:b[ae.type],from:ee,to:be,url:I,secret:ae.secretKey,filename:ae.displayName,length:ae.duration||"",file_length:ae.fileLength||"",filetype:ae.filetype||"",accessToken:this.token||"",ext:Nt,time:We,msgConfig:He.msgConfig,onlineState:Pe}).delay&&delete nt.delay,!nt.msgConfig&&delete He.msgConfig,nt.error=B,nt.errorText=St,nt.errorCode=Ft,!te&&this.onVideoMessage&&this.onVideoMessage(nt),lt={id:Ne,type:"video",chatType:Ee,from:ee,to:be,url:I,secret:ae.secretKey,thumb:_.P6.formatAttachUrl.call(this,ae.thumbnailRemotePath),thumb_secret:ae.thumbnailSecretKey,filename:ae.displayName,length:ae.duration||0,file:{},file_length:ae.fileLength||0,filetype:ae.filetype||"",accessToken:this.token||"",ext:Nt,time:Number(We),onlineState:Pe},nt.msgConfig&&(lt.msgConfig=nt.msgConfig),Ut.length>0&&(lt.reactions=Ut),pe&&(lt.chatThread=pe),Je&&(lt.chatThreadOverview=Je),Ee==="chatRoom"&&(lt.priority=Ae,lt.broadcast=ze),Et&&(lt.isContentReplaced=Et),Dt=lt,te?[3,12]:[4,(re=(zt=this._localCache)===null||zt===void 0?void 0:zt.getInstance())===null||re===void 0?void 0:re.storeMessage(lt,R.r.SUCCESS)];case 11:Ve.sent(),(de=this.eventHandler)===null||de===void 0||de.dispatch("onVideoMessage",lt),Ve.label=12;case 12:return[3,28];case 13:return!(nt={id:Ne,type:Ze,contentsType:b[ae.type],from:ee,to:be,addr:ae.address,buildingName:ae.buildingName,lat:ae.latitude,lng:ae.longitude,ext:Nt,time:We,msgConfig:He.msgConfig,onlineState:Pe}).delay&&delete nt.delay,!nt.msgConfig&&delete He.msgConfig,nt.error=B,nt.errorText=St,nt.errorCode=Ft,!te&&this.onLocationMessage&&this.onLocationMessage(nt),ct={id:Ne,type:"loc",chatType:Ee,from:ee,to:be,buildingName:ae.buildingName,addr:ae.address,lat:ae.latitude,lng:ae.longitude,ext:Nt,time:Number(We),onlineState:Pe},nt.msgConfig&&(ct.msgConfig=nt.msgConfig),Ut.length>0&&(ct.reactions=Ut),pe&&(ct.chatThread=pe),Je&&(ct.chatThreadOverview=Je),Ee==="chatRoom"&&(ct.priority=Ae,ct.broadcast=ze),Et&&(ct.isContentReplaced=Et),Dt=ct,te?[3,15]:[4,(gt=(ft=this._localCache)===null||ft===void 0?void 0:ft.getInstance())===null||gt===void 0?void 0:gt.storeMessage(ct,R.r.SUCCESS)];case 14:Ve.sent(),(Zt=this.eventHandler)===null||Zt===void 0||Zt.dispatch("onLocationMessage",ct),Ve.label=15;case 15:return[3,28];case 16:return I=this.useOwnUploadFun?ae.remotePath:z.call(this,ae),!(nt={id:Ne,type:Ze,contentsType:b[ae.type],from:ee,to:be,url:I,secret:ae.secretKey,filename:ae.displayName,file_length:ae.fileLength||"",accessToken:this.token||"",ext:Nt,length:ae.duration,time:We,msgConfig:He.msgConfig,onlineState:Pe}).delay&&delete nt.delay,!nt.msgConfig&&delete He.msgConfig,nt.error=B,nt.errorText=St,nt.errorCode=Ft,!te&&this.onAudioMessage&&this.onAudioMessage(nt),It={id:Ne,type:"audio",chatType:Ee,from:ee,to:be,url:I,secret:ae.secretKey,file:{},filename:ae.displayName,length:ae.duration||0,file_length:ae.fileLength||0,filetype:ae.filetype||"",accessToken:this.token||"",ext:Nt,time:Number(We),onlineState:Pe},nt.msgConfig&&(It.msgConfig=nt.msgConfig),Ut.length>0&&(It.reactions=Ut),pe&&(It.chatThread=pe),Je&&(It.chatThreadOverview=Je),Ee==="chatRoom"&&(It.priority=Ae,It.broadcast=ze),Et&&(It.isContentReplaced=Et),Dt=It,te?[3,18]:[4,(Wt=(Pt=this._localCache)===null||Pt===void 0?void 0:Pt.getInstance())===null||Wt===void 0?void 0:Wt.storeMessage(It,R.r.SUCCESS)];case 17:Ve.sent(),(oe=this.eventHandler)===null||oe===void 0||oe.dispatch("onAudioMessage",It),Ve.label=18;case 18:return[3,28];case 19:return I=this.useOwnUploadFun?ae.remotePath:z.call(this,ae),!(nt={id:Ne,type:Ze,contentsType:b[ae.type],from:ee,to:be,url:I,secret:ae.secretKey,filename:ae.displayName,file_length:ae.fileLength,accessToken:this.token||"",ext:Nt,time:We,msgConfig:He.msgConfig,onlineState:Pe}).delay&&delete nt.delay,!nt.msgConfig&&delete He.msgConfig,nt.error=B,nt.errorText=St,nt.errorCode=Ft,!te&&this.onFileMessage&&this.onFileMessage(nt),Ct={id:Ne,type:"file",chatType:Ee,from:ee,to:be,url:I,secret:ae.secretKey,file:{},filename:ae.displayName,length:ae.duration||0,file_length:ae.fileLength||0,filetype:ae.filetype||"",accessToken:this.token||"",ext:Nt,time:Number(We),onlineState:Pe},nt.msgConfig&&(Ct.msgConfig=nt.msgConfig),Ut.length>0&&(Ct.reactions=Ut),pe&&(Ct.chatThread=pe),Je&&(Ct.chatThreadOverview=Je),Ee==="chatRoom"&&(Ct.priority=Ae,Ct.broadcast=ze),Et&&(Ct.isContentReplaced=Et),Dt=Ct,te?[3,21]:[4,(le=(fe=this._localCache)===null||fe===void 0?void 0:fe.getInstance())===null||le===void 0?void 0:le.storeMessage(Ct,R.r.SUCCESS)];case 20:Ve.sent(),(Ie=this.eventHandler)===null||Ie===void 0||Ie.dispatch("onFileMessage",Ct),Ve.label=21;case 21:return[3,28];case 22:return!(nt={id:Ne,type:Ze,contentsType:b[ae.type],from:ee,to:be,action:ae.action,ext:Nt,time:We,msgConfig:He.msgConfig,onlineState:Pe}).msgConfig&&delete He.msgConfig,nt.error=B,nt.errorText=St,nt.errorCode=Ft,!te&&this.onCmdMessage&&this.onCmdMessage(nt),Ot={id:Ne,type:"cmd",chatType:Ee,from:ee,to:be,action:ae.action,ext:Nt,time:Number(We),onlineState:Pe},nt.msgConfig&&(Ot.msgConfig=nt.msgConfig),Ut.length>0&&(Ot.reactions=Ut),pe&&(Ot.chatThread=pe),Je&&(Ot.chatThreadOverview=Je),Ee==="chatRoom"&&(Ot.priority=Ae,Ot.broadcast=ze),Et&&(Ot.isContentReplaced=Et),Dt=Ot,te||(me=this.eventHandler)===null||me===void 0||me.dispatch("onCmdMessage",Ot),[3,28];case 23:return Mt={},qt={},He.contents[0].customExts&&(Mt=j(He.contents[0].customExts)),He.contents[0].params&&(qt=j(He.contents[0].params)),nt={id:Ne,type:Ze,contentsType:b[ae.type],from:ee,to:be,customEvent:ae.customEvent,params:qt,customExts:Mt,ext:Nt,time:We,onlineState:Pe},!te&&this.onCustomMessage&&this.onCustomMessage(nt),he={id:Ne,type:"custom",chatType:Ee,from:ee,to:be,customEvent:ae.customEvent,params:qt,customExts:Mt,ext:Nt,time:Number(We),onlineState:Pe},nt.msgConfig&&(he.msgConfig=nt.msgConfig),Ut.length>0&&(he.reactions=Ut),pe&&(he.chatThread=pe),Je&&(he.chatThreadOverview=Je),Gt.operationCount>0&&(he.modifiedInfo=Gt,He.type===E.gA.EDIT&&(he.from=ne,he.time=Re)),Ee==="chatRoom"&&(he.priority=Ae,he.broadcast=ze),Et&&(he.isContentReplaced=Et),Dt=he,te?[3,25]:[4,(je=(Oe=this._localCache)===null||Oe===void 0?void 0:Oe.getInstance())===null||je===void 0?void 0:je.storeMessage(he,R.r.SUCCESS)];case 24:Ve.sent(),(xe=this.eventHandler)===null||xe===void 0||xe.dispatch("onCustomMessage",he),Ve.label=25;case 25:return[3,28];case 26:return I=z.call(this,ae),Jt={id:Ne,type:"combine",chatType:Ee,to:be,from:ee,ext:Nt,time:Number(We),onlineState:Pe,title:ae.title||"",summary:ae.summary||"",url:I||"",secret:ae.secretKey||"",file_length:ae.fileLength||0,filename:ae.displayName||"",compatibleText:ae.text,combineLevel:ae.combineLevel||0},nt.msgConfig&&(Jt.msgConfig=nt.msgConfig),Ut.length>0&&(Jt.reactions=Ut),pe&&(Jt.chatThread=pe),Je&&(Jt.chatThreadOverview=Je),Ee==="chatRoom"&&(Jt.priority=Ae,Jt.broadcast=ze),Et&&(Jt.isContentReplaced=Et),Dt=Jt,!te&&this.eventHandler&&this.eventHandler.dispatch("onCombineMessage",Jt),[3,28];case 27:return p.kg.error("Unknow message type, message:",ae),[3,28];case 28:return Xe?[2,Dt]:[2,nt]}})})}function Z(U,Y,q){if(this.delivery&&U!==Y){var V=this.getUniqueId(),it=new A.Message("delivery",V);it.set({ackId:q,to:U}),p.kg.debug("send delivery ack"),this.send(it.body)}}H.Z=function(U,Y,q,V,it){var mt,wt,yt,Ht,Yt,At,Lt,zt,re,de,ft,gt,Zt,Pt,Wt,oe,fe,le,Ie,me,Oe,je,xe,ir,He,ae;return P(this,void 0,void 0,function(){var Ne,Ze,ee,be,We,Pe,Ee,te,Ae,Xe,Be,ze,ot,Et,nt,Dt,B,Ft,St,Nt,Ut,Xt,Gt,ne,Re,pe,Je,I,X,_t,K,dt,bt,rt,Vt,ut,Kt,jt,ge,W;return k(this,function(lt){switch(lt.label){case 0:if(Ne=new(h())(U.timestamp.low,U.timestamp.high,U.timestamp.unsigned).toString(),Ze=this.root.lookup("easemob.pb.MessageBody"),ee=Ze.decode(U.payload),be=3,We=!1,Pe=new(h())(U.id.low,U.id.high,U.id.unsigned).toString(),it&&U.from&&U.from.name===this.context.userId&&U.from.clientResource===this.clientResource&&ee.type===E.gA.CHATROOM)return[2,p.kg.debug("Discard your own chat room message:",Pe)];if(U.meta&&U.meta.length){if(Ee=_.P6.parseNotify(U.meta),te=Ee.is_online,Ae=Ee.callback_replace,this.useReplacedMessageContents&&Ae&&(We=!0),te||te===0)switch(te){case 0:be=0;break;case 1:be=1;break;default:be=2}}else be=3;switch(Xe=ee.ackMessageId?new(h())(ee.ackMessageId.low,ee.ackMessageId.high,ee.ackMessageId.unsigned).toString():"",Be="",ze=S.call(this,U,ee),ot=F.call(this,U,ee),p.kg.debug("meta thirdMessage:",{metaId:Pe,metaNs:U.ns,type:ee.type,from:ze,to:ot,contentType:(wt=(mt=ee.contents)===null||mt===void 0?void 0:mt[0])===null||wt===void 0?void 0:wt.type,contentLen:(yt=ee.contents)===null||yt===void 0?void 0:yt.length}),ee.type){case E.gA.SINGLECHAT:return[3,1];case E.gA.GROUPCHAT:return[3,2];case E.gA.CHATROOM:return[3,3];case E.gA.READ_ACK:return[3,4];case E.gA.DELIVER_ACK:return[3,5];case E.gA.RECALL:return[3,6];case E.gA.CHANNEL_ACK:return[3,15];case E.gA.EDIT:return[3,16]}return[3,20];case 1:return Be="chat",this.grantType==="agoraToken"&&(Be="singleChat"),this.delivery&&!q&&ze!==this.context.userId&&Z.call(this,ze,ot,Pe),[3,21];case 2:return Be="groupchat",this.grantType==="agoraToken"&&(Be="groupChat"),[3,21];case 3:return Be="chatroom",this.grantType==="agoraToken"&&(Be="chatRoom"),be=1,[3,21];case 4:return Be="read_ack",Et=void 0,ee.ext[0]&&JSON.parse(ee.ext[0].stringValue)?(Et={id:Pe,type:"read",from:ze,to:ot,mid:Xe,groupReadCount:ee.ext[0]&&JSON.parse(ee.ext[0].stringValue),ackContent:ee.ackContent,onlineState:be},this.onReadMessage&&this.onReadMessage(Et),(Ht=this.eventHandler)===null||Ht===void 0||Ht.dispatch("onReadMessage",Et),[2]):(Et={id:Pe,type:"read",from:ze,to:ot,mid:Xe,onlineState:be},this.onReadMessage&&this.onReadMessage(Et),(Yt=this.eventHandler)===null||Yt===void 0||Yt.dispatch("onReadMessage",Et),[2]);case 5:return Be="deliver_ack",this.onDeliveredMessage&&this.onDeliveredMessage({id:Pe,type:"delivery",from:ze,to:ot,mid:Xe,onlineState:be}),nt={id:Pe,type:"delivery",from:ze,to:ot,mid:Xe,onlineState:be},(At=this.eventHandler)===null||At===void 0||At.dispatch("onDeliveredMessage",nt),[2];case 6:return Be="recall",Dt="",U.ext&&(Dt=((Lt=j(U.ext))===null||Lt===void 0?void 0:Lt.recallMessageExtensionInfo)||""),B={id:Pe,from:ze||"admin",to:ot,mid:Xe,ext:Dt,onlineState:be},Ft=ot===this.user?ze:ot,[4,(re=(zt=this._localCache)===null||zt===void 0?void 0:zt.getInstance())===null||re===void 0?void 0:re.getMessageByServerMsgId(B.mid)];case 7:return(St=lt.sent())?[4,(ft=(de=this._localCache)===null||de===void 0?void 0:de.getInstance())===null||ft===void 0?void 0:ft.removeMsgByServerMsgId(B.mid)]:[3,9];case 8:lt.sent(),lt.label=9;case 9:return St?.chatType!=="singleChat"&&St?.chatType!=="groupChat"?[3,14]:(Nt=St?.from===this.user||St?.from==="",[4,(Zt=(gt=this._localCache)===null||gt===void 0?void 0:gt.getInstance())===null||Zt===void 0?void 0:Zt.getConversationLastMessage(Ft,St.chatType)]);case 10:return Ut=lt.sent(),[4,(Wt=(Pt=this._localCache)===null||Pt===void 0?void 0:Pt.getInstance())===null||Wt===void 0?void 0:Wt.getConversationBySessionId((0,m.MQ)({conversationId:Ft,conversationType:St.chatType}))];case 11:return(Xt=lt.sent())?[4,(fe=(oe=this._localCache)===null||oe===void 0?void 0:oe.getInstance())===null||fe===void 0?void 0:fe.updateLocalConversation((0,m.MQ)({conversationId:Ft,conversationType:St.chatType}),{lastMessageId:Ut?.serverMsgId,unReadCount:(0,m.E7)({conversation:Xt,isRecallSelfMsg:Nt,recalledMsgTime:St.time})})]:[3,13];case 12:lt.sent(),lt.label=13;case 13:lt.label=14;case 14:return this.onRecallMessage&&this.onRecallMessage(B),(le=this.eventHandler)===null||le===void 0||le.dispatch("onRecallMessage",B),[2];case 15:return this.onChannelMessage&&this.onChannelMessage({id:Pe,type:"channel",chatType:"singleChat",from:ze,to:ot,time:Number(Ne),onlineState:be}),Gt={id:Pe,type:"channel",chatType:"singleChat",from:ze,to:ot,time:Number(Ne),onlineState:be},(Ie=this.eventHandler)===null||Ie===void 0||Ie.dispatch("onChannelMessage",Gt),[2];case 16:return ne={errorCode:0,reason:""},[4,M.call(this,{status:ne,thirdMessage:ee,msgBody:ee.contents[0],msgId:Pe,type:Be,from:ze,to:ot,time:Ne,onlineState:be,ignoreCallback:!0,format:!0,isContentReplaced:We})];case 17:return Re=lt.sent(),pe=!!U.to&&U.to.domain.indexOf("conference")!==-1,Re.chatType=pe?"groupChat":"singleChat",Je=ee.editMessageId&&new(h())(ee.editMessageId.low,ee.editMessageId.high,ee.editMessageId.unsigned).toString(),I={},Re.type==="txt"?(X=Re.type,_t=Re.chatType,K=Re.to,dt=Re.from,bt=Re.time,rt=Re.modifiedInfo,I={id:Je,type:X,chatType:_t,to:K,from:dt,time:bt,modifiedInfo:rt,msg:Re.msg},Re.translations&&(I.translations=Re.translations)):Re.type==="custom"&&((I=Re).id=Je,delete I.onlineState),I?[4,(Oe=(me=this._localCache)===null||me===void 0?void 0:me.getInstance())===null||Oe===void 0?void 0:Oe.getMessageByServerMsgId(Je)]:[3,19];case 18:((Vt=lt.sent())==null?void 0:Vt.type)==="txt"&&I.type==="txt"?(xe=(je=this._localCache)===null||je===void 0?void 0:je.getInstance())===null||xe===void 0||xe.putMessageToDB(D(D({},Vt),{msg:I.msg,modifiedInfo:I.modifiedInfo,translations:I.translations})):Vt?.type==="custom"&&I.type==="custom"&&((He=(ir=this._localCache)===null||ir===void 0?void 0:ir.getInstance())===null||He===void 0||He.putMessageToDB(D(D({},Vt),{modifiedInfo:I.modifiedInfo,customEvent:I.customEvent,customExts:I.customExts,ext:I.ext}))),lt.label=19;case 19:return Re.type!=="txt"&&Re.type!=="custom"||(ae=this.eventHandler)===null||ae===void 0||ae.dispatch("onModifiedMessage",I),[2];case 20:return p.kg.error("unexpected message type: ".concat(ee.type)),[2];case 21:ut="normal",jt=!1,Be.toLowerCase()==="chat"||Be==="singleChat"?Kt="singleChat":Be.toLowerCase()==="groupchat"||Be==="groupChat"?Kt="groupChat":(Kt="chatRoom",be=1,U.ext&&(ge=j(U.ext),jt=!!ge?.is_broadcast,ut=ge.chatroom_msg_tag===0?"high":ge.chatroom_msg_tag===2?"low":"normal")),W=0,lt.label=22;case 22:return W<ee.contents.length?[4,M.call(this,{status:Y,thirdMessage:ee,msgBody:ee.contents[W],msgId:Pe,type:Be,from:ze,to:ot,time:Ne,onlineState:be,chatType:Kt,ignoreCallback:q,priority:ut,format:V,broadcast:jt,isContentReplaced:We})]:[3,25];case 23:return[2,lt.sent()];case 24:return W++,[3,22];case 25:return[2]}})})}},7288:function(O,H,a){var f;a.d(H,{r:function(){return f}}),function(h){h[h.CREATE=0]="CREATE",h[h.FAIL=1]="FAIL",h[h.INPROGRESS=2]="INPROGRESS",h[h.SUCCESS=3]="SUCCESS"}(f||(f={}))},9743:function(O,H,a){a.d(H,{E7:function(){return h},MQ:function(){return f},un:function(){return g}}),a(2222);var f=function(_){return"".concat(_.conversationType,"-").concat(_.conversationId)},h=function(_){var E=_.isRecallSelfMsg,m=_.conversation,p=_.recalledMsgTime,A=m.unReadCount,R=A===void 0?0:A,D=m.unreadCountClearTimestamp;return E||(D===void 0?0:D)>p?R:R&&R>0?R-1:0},g=function(_){var E,m=0;if(_.length===0)return m;for(E=0;E<_.length;E++)m=(m<<5)-m+_.charCodeAt(E),m|=0;return m}},7360:function(O,H,a){function f(){console.log&&(console.log.apply?console.log.apply(console,Array.prototype.slice.call(arguments)):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}a.d(H,{kg:function(){return P}}),a(1539),a(8674),a(2526),a(1817),a(2165),a(6992),a(8783),a(3948),a(7042),a(2222),a(8309),a(9600),a(2564),a(285),a(1637),a(4812),a(3710),a(9554),a(2772),a(4916);var h=typeof window<"u"&&window.navigator!==void 0&&/Trident\/|MSIE /.test(window.navigator.userAgent),g=a(4024);function _(k){return _=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(b){return typeof b}:function(b){return b&&typeof Symbol=="function"&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},_(k)}var E,m=function(){},p={};(function(k){k[k.TRACE=0]="TRACE",k[k.DEBUG=1]="DEBUG",k[k.INFO=2]="INFO",k[k.WARN=3]="WARN",k[k.ERROR=4]="ERROR",k[k.SILENT=5]="SILENT"})(E||(E={}));var A=function(){function k(b,j,z){this.name=b||"defaultLogger",this.currentLevel=0,this.useCookiePersist=!1,this.storageLogLevelKey="loglevel",this.levels=E,this.consoleLogVisibility=!0,this.logMethods=["trace","debug","info","warn","error"],this.methodFactory=z||this.defaultMethodFactory,this.report=!1;var S=this._getPersistedLevel();S==null&&(S=j===null?"WARN":j),this.logs=[],this.reportLogs=[],this.reportInterval=3e5,this.timer=null,this.config={useCache:!1,maxCache:3145728,color:"",background:""},this.logBytes=0,this.setLevel(S,!1,"")}return k.prototype.reportLog=function(){var b,j,z,S,F,M,Z;return S=this,F=void 0,Z=function(){var U,Y,q,V,it,mt,wt,yt;return function(Ht,Yt){var At,Lt,zt,re,de={label:0,sent:function(){if(1&zt[0])throw zt[1];return zt[1]},trys:[],ops:[]};return re={next:ft(0),throw:ft(1),return:ft(2)},typeof Symbol=="function"&&(re[Symbol.iterator]=function(){return this}),re;function ft(gt){return function(Zt){return function(Pt){if(At)throw new TypeError("Generator is already executing.");for(;de;)try{if(At=1,Lt&&(zt=2&Pt[0]?Lt.return:Pt[0]?Lt.throw||((zt=Lt.return)&&zt.call(Lt),0):Lt.next)&&!(zt=zt.call(Lt,Pt[1])).done)return zt;switch(Lt=0,zt&&(Pt=[2&Pt[0],zt.value]),Pt[0]){case 0:case 1:zt=Pt;break;case 4:return de.label++,{value:Pt[1],done:!1};case 5:de.label++,Lt=Pt[1],Pt=[0];continue;case 7:Pt=de.ops.pop(),de.trys.pop();continue;default:if(!((zt=(zt=de.trys).length>0&&zt[zt.length-1])||Pt[0]!==6&&Pt[0]!==2)){de=0;continue}if(Pt[0]===3&&(!zt||Pt[1]>zt[0]&&Pt[1]<zt[3])){de.label=Pt[1];break}if(Pt[0]===6&&de.label<zt[1]){de.label=zt[1],zt=Pt;break}if(zt&&de.label<zt[2]){de.label=zt[2],de.ops.push(Pt);break}zt[2]&&de.ops.pop(),de.trys.pop();continue}Pt=Yt.call(Ht,de)}catch(Wt){Pt=[6,Wt],Lt=0}finally{At=zt=0}if(5&Pt[0])throw Pt[1];return{value:Pt[0]?Pt[1]:void 0,done:!0}}([gt,Zt])}}}(this,function(Ht){switch(Ht.label){case 0:if(((b=this.reportLogs)===null||b===void 0?void 0:b.length)===0)return[2];for(U=2097152,Y=this.reportLogs.join(`
`)+`
`,q=Y.length,V=[];q>U;)V.push(Y.substring(0,U)),q-=U,Y=Y.substring(U);V.push(Y),it=0,mt=V,Ht.label=1;case 1:if(!(it<mt.length))return[3,8];if(wt=mt[it],this.reportLogs=[],!(!((z=(j=this.connection)===null||j===void 0?void 0:j.context)===null||z===void 0)&&z.accessToken))return[2];Ht.label=2;case 2:return Ht.trys.push([2,4,,5]),[4,this.reportData(wt)];case 3:return((yt=Ht.sent())==null?void 0:yt.status)!=="ok"&&this.reportLogs.unshift(wt),[3,5];case 4:return Ht.sent(),this.reportLogs.unshift(wt),[3,5];case 5:return[4,g.P6.delay(3e3)];case 6:Ht.sent(),Ht.label=7;case 7:return it++,[3,1];case 8:return[2]}})},new((M=void 0)||(M=Promise))(function(U,Y){function q(mt){try{it(Z.next(mt))}catch(wt){Y(wt)}}function V(mt){try{it(Z.throw(mt))}catch(wt){Y(wt)}}function it(mt){var wt;mt.done?U(mt.value):(wt=mt.value,wt instanceof M?wt:new M(function(yt){yt(wt)})).then(q,V)}it((Z=Z.apply(S,F||[])).next())})},k.prototype.reportData=function(b){var j,z=this;if(this.connection){var S=this.connection.context||{},F=S.orgName,M=S.appName,Z=S.accessToken,U=S.userId,Y={url:"".concat((j=this.connection)===null||j===void 0?void 0:j.apiUrl,"/").concat(F,"/").concat(M,"/sdk/users/").concat(U,"/client/logs"),type:"POST",data:JSON.stringify({resource:this.connection.clientResource,logContent:b}),dataType:"json",headers:{Authorization:"Bearer "+Z,"Content-Type":"application/json"}};return g.hj.call(this.connection,Y).then(function(q){return z.log("report log success",q),q}).catch(function(q){z.error("report log error",q)})}this.error("report log error","connection is null")},k.prototype._regularlyReportLogs=function(){var b,j=this;this.timer&&clearInterval(this.timer),((b=this.reportInterval)!==null&&b!==void 0?b:0)<6e4&&(this.reportInterval=6e4),this.timer=setInterval(function(){j.reportLog()},this.reportInterval||3e5)},k.prototype._stopReportLogs=function(){this.reportLog(),clearInterval(this.timer)},k.prototype.setConfig=function(b){this.config=b},k.prototype.getLevel=function(){return this.currentLevel},k.prototype.setLevel=function(b,j,z){if(typeof b=="string"&&(b=E[b]),b===void 0&&(b=0),!(typeof b=="number"&&b>=0&&b<=this.levels.SILENT))throw Error("log.setLevel() called with invalid level: "+b);if(this.currentLevel=b,j!==!1&&this._persistLevel(b),this.replaceLoggingMethods(b,z||""),typeof console>"u"&&b<E.SILENT)throw Error("No console available for logging")},k.prototype.setDefaultLevel=function(b){this._getPersistedLevel()||this.setLevel(b,!1,"")},k.prototype.enableAll=function(b){this.setLevel(this.levels.TRACE,!0,"")},k.prototype.disableAll=function(b){this.setLevel(this.levels.SILENT,!0,"")},k.prototype.getLogs=function(){return this.logs},k.prototype.download=function(){if(typeof window<"u"&&typeof document<"u"){var b=this.getLogs().join(`
`),j=new Blob([b],{type:"text/plain;charset=UTF-8"}),z=window.URL.createObjectURL(j),S=document.createElement("a");S.style.display="none",S.href=z,S.setAttribute("download","sdklog"),document.body.appendChild(S),S.click()}},k.prototype.setConsoleLogVisibility=function(b){this.consoleLogVisibility=b},k.prototype._bindMethod=function(b,j,z){var S=this,F=b[j],M=this.getTime();if(z)return this._cacheLog;if(typeof F.bind=="function")return function(){for(var Z=[],U=0;U<arguments.length;U++)Z[U]=arguments[U];var Y=S.getTime();S.consoleLogVisibility&&F.call.apply(F,function(q,V,it){if(arguments.length===2)for(var mt,wt=0,yt=V.length;wt<yt;wt++)!mt&&wt in V||(mt||(mt=Array.prototype.slice.call(V,0,wt)),mt[wt]=V[wt]);return q.concat(mt||Array.prototype.slice.call(V))}([b,"".concat(Y," IM SDK [").concat(j==="log"?"debug":j,"]: ")],Z,!1)),S.onLog&&S.onLog({time:Y,level:j==="log"?"debug":j,logs:Z}),S._cacheReportLogs.apply(S,Z)};try{return Function.prototype.bind.call(F,b,"".concat(M," IM SDK [").concat(j==="log"?"debug":j,"]: "))}catch{return function(){return Function.prototype.apply.apply(F,[b,arguments])}}},k.prototype.getTime=function(){var b=new Date;return b.toTimeString().split(" ")[0]+":"+b.getMilliseconds()},k.prototype._cacheLog=function(){for(var b=[],j=0;j<arguments.length;j++)b[j]=arguments[j];var z=new Date().toLocaleString()+": ",S="";b.forEach(function(F){_(F)==="object"?S+=JSON.stringify(F)+" ":S+=F+" "}),this._cacheLogCall(z+S),this._cacheReportLogs.apply(this,b)},k.prototype._cacheLogCall=function(b){var j=b.length,z=this.logBytes+j,S=this.config.maxCache;if(!(j>=S)){if(z<S)this.logBytes+=j;else for(var F=z-S,M=0;M<F;){var Z=this.logs.shift();Z!==void 0&&(M+=Z.length)}this.logs.push(b)}},k.prototype._cacheReportLogs=function(){for(var b=[],j=0;j<arguments.length;j++)b[j]=arguments[j];if(this.report){var z=new Date().toLocaleString()+": ",S="";b.forEach(function(F){_(F)==="object"?S+=JSON.stringify(F)+" ":S+=F+" "}),this.reportLogs.push(z+S)}},k.prototype._getPersistedLevel=function(){var b;if(typeof window>"u")return 5;if((b=window&&window.localStorage&&window.localStorage[this.storageLogLevelKey])==="undefined"){var j=window.document.cookie,z=j.indexOf(encodeURIComponent(this.storageLogLevelKey));z!==-1&&(b=/^([^;]+)/.exec(j.slice(z))[1])}return b||5},k.prototype._persistLevel=function(b){var j=this.logMethods[b]||"SILENT";typeof window<"u"&&(window.localStorage&&(window.localStorage[this.storageLogLevelKey]=j),this.useCookiePersist&&(window.document.cookie=encodeURIComponent(this.storageLogLevelKey)+"="+j+";"))},k.prototype.replaceLoggingMethods=function(b,j){for(var z=this,S=0;S<this.logMethods.length;S++){var F=this.logMethods[S];this[F]=S<b?function(){for(var M=[],Z=0;Z<arguments.length;Z++)M[Z]=arguments[Z];z.report&&z._cacheReportLogs.apply(z,M)}:this.methodFactory(F,b,j)}this.log=this.debug},k.prototype.defaultMethodFactory=function(b,j,z){return this.realMethod(b)||this.enableLoggingWhenConsoleArrives.apply(this,[b,j,z])},k.prototype.realMethod=function(b){return b==="debug"&&(b="log"),typeof console<"u"&&(b==="trace"&&h?f:console[b]!==void 0?this._bindMethod(console,b,this.config.useCache):console.log!==void 0?this._bindMethod(console,"log",this.config.useCache):m)},k.prototype.enableLoggingWhenConsoleArrives=function(b,j,z){return function(){typeof console<"u"&&(this.replaceLoggingMethods.call(this,j,z),this[b].apply(this,arguments))}.bind(this)},k}(),R=new A;R.getLogger=function(k){if(typeof k!="string"||k==="")throw new TypeError("You must supply a name when creating a logger.");return this};var D=typeof window<"u"?window.log:void 0;R.noConflict=function(){return typeof window<"u"&&window.log===R&&(window.log=D),R},R.getLoggers=function(){return p},R.initReport=function(k){var b=k.report,j=k.reportInterval,z=k.connection;R.report=b,R.reportInterval=j,R.connection=z,b&&R._regularlyReportLogs()};var P=R},2449:function(O,H,a){a.d(H,{Message:function(){return j}});var f=a(4024),h=function(){function z(S){var F=S.id;this.id=F,this.type=S.type}return z.prototype.set=function(S){this.body={id:this.id,ackId:S.id,type:"read",to:S.to,from:S.from||"",chatType:S.chatType}},z.create=function(S){return{id:f.P6.getUniqueId(),chatType:S.chatType,ackId:S.id,type:"read",to:S.to,from:S.from||"",ackContent:S.ackContent,isChatThread:S.isChatThread,priority:S.priority,deliverOnlineOnly:S.deliverOnlineOnly}},z}(),g=function(){function z(S){this.id=S.id,this.type=S.type}return z.prototype.set=function(S){this.body={id:this.id,ackId:S.ackId,type:"delivery",to:S.to,from:S.from||""}},z.create=function(S){return{id:f.P6.getUniqueId(),ackId:S.ackId,type:"delivery",to:S.to,from:S.from||"",isChatThread:S.isChatThread,priority:S.priority,deliverOnlineOnly:S.deliverOnlineOnly}},z}(),_=(a(3843),a(3710),function(){function z(S){var F=S.type,M=S.id;this.id=M,this.type=F}return z.prototype.set=function(S){this.body={id:this.id,chatType:S.chatType||"singleChat",type:"channel",to:S.to,from:S.from||"",time:Date.now()}},z.prototype.setChatType=function(S){return!!this.body&&(this.body.chatType=S,!0)},z.prototype.setGroup=function(S){return!!this.body&&(this.body.group=S,!0)},z.create=function(S){return{id:f.P6.getUniqueId(),type:"channel",chatType:S.chatType||"singleChat",to:S.to,from:S.from||"",time:Date.now(),isChatThread:S.isChatThread,priority:S.priority,deliverOnlineOnly:S.deliverOnlineOnly}},z}()),E=(a(9753),function(){function z(S){var F=S.type,M=S.id||f.P6.getUniqueId();this.id=M,this.type=F,this.value=""}return z.prototype.set=function(S){this.body={id:this.id,chatType:S.chatType||"singleChat",type:"txt",to:S.to,msg:S.msg,from:S.from,roomType:S.roomType,success:S.success,fail:S.fail,ext:S.ext,time:Date.now(),isChatThread:S.isChatThread},this.value=S.msg},z.prototype.setChatType=function(S){return!!this.body&&(this.body.chatType=S,!0)},z.prototype.setGroup=function(S){return!!this.body&&(this.body.group=S,!0)},z.create=function(S){var F,M;return!((F=S.msgConfig)===null||F===void 0)&&F.languages&&Array.isArray((M=S.msgConfig)===null||M===void 0?void 0:M.languages),{type:"txt",id:f.P6.getUniqueId(),msg:S.msg,to:S.to,from:S.from||"",chatType:S.chatType,ext:S.ext,time:Date.now(),msgConfig:S.msgConfig,isChatThread:S.isChatThread,priority:S.priority,deliverOnlineOnly:S.deliverOnlineOnly,receiverList:S.receiverList}},z}()),m=function(){function z(S){var F=S.type,M=S.id;this.id=M||f.P6.getUniqueId(),this.type=F}return z.prototype.set=function(S){this.body={id:this.id,chatType:S.chatType||"singleChat",type:"cmd",to:S.to,action:S.action,from:S.from,roomType:S.roomType,success:S.success,fail:S.fail,ext:S.ext,time:Date.now()}},z.prototype.setChatType=function(S){return!!this.body&&(this.body.chatType=S,!0)},z.prototype.setGroup=function(S){return!!this.body&&(this.body.group=S,!0)},z.create=function(S){return{id:f.P6.getUniqueId(),type:"cmd",to:S.to,from:S.from||"",chatType:S.chatType||"singleChat",action:S.action,time:Date.now(),ext:S.ext,msgConfig:S.msgConfig,isChatThread:S.isChatThread,priority:S.priority,deliverOnlineOnly:S.deliverOnlineOnly,receiverList:S.receiverList}},z}(),p=function(){function z(S){var F=S.type,M=S.id||f.P6.getUniqueId();this.id=M,this.type=F}return z.prototype.set=function(S){this.body={id:this.id,chatType:S.chatType||"singleChat",type:"custom",to:S.to,customEvent:S.customEvent,customExts:S.customExts,from:S.from,roomType:S.roomType,success:S.success,fail:S.fail,ext:S.ext,time:Date.now()}},z.prototype.setChatType=function(S){return!!this.body&&(this.body.chatType=S,!0)},z.prototype.setGroup=function(S){return!!this.body&&(this.body.group=S,!0)},z.create=function(S){return{id:f.P6.getUniqueId(),chatType:S.chatType||"singleChat",type:"custom",to:S.to,customEvent:S.customEvent,customExts:S.customExts,from:S.from||"",ext:S.ext,time:Date.now(),msgConfig:S.msgConfig,isChatThread:S.isChatThread,priority:S.priority,deliverOnlineOnly:S.deliverOnlineOnly,receiverList:S.receiverList}},z}(),A=function(){function z(S){var F=S.type,M=S.id;this.id=M||f.P6.getUniqueId(),this.type=F}return z.prototype.set=function(S){this.body={id:this.id,chatType:S.chatType||"singleChat",type:"loc",to:S.to,addr:S.addr,buildingName:S.buildingName,lat:S.lat,lng:S.lng,from:S.from,roomType:S.roomType,success:S.success,fail:S.fail,ext:S.ext,time:Date.now()}},z.prototype.setChatType=function(S){return!!this.body&&(this.body.chatType=S,!0)},z.prototype.setGroup=function(S){return!!this.body&&(this.body.group=S,!0)},z.create=function(S){return{id:f.P6.getUniqueId(),chatType:S.chatType||"singleChat",type:"loc",to:S.to,addr:S.addr,buildingName:S.buildingName,lat:S.lat,lng:S.lng,from:S.from||"",ext:S.ext,time:Date.now(),msgConfig:S.msgConfig,isChatThread:S.isChatThread,priority:S.priority,deliverOnlineOnly:S.deliverOnlineOnly,receiverList:S.receiverList}},z}(),R=function(){function z(S){var F=S.type,M=S.id||f.P6.getUniqueId();this.id=M,this.type=F}return z.prototype.set=function(S){S.file=S.file||S.fileInputId&&f.P6.getFileUrl(S.fileInputId),this.body={id:this.id,chatType:S.chatType||"singleChat",type:"img",file:S.file,width:S.width,height:S.height,to:S.to,from:S.from||"",roomType:S.roomType,success:S.success,fail:S.fail,ext:S.ext,time:Date.now(),onFileUploadError:S.onFileUploadError,onFileUploadComplete:S.onFileUploadComplete,onFileUploadProgress:S.onFileUploadProgress,body:S.body,isChatThread:S.isChatThread}},z.prototype.setChatType=function(S){return!!this.body&&(this.body.chatType=S,!0)},z.prototype.setGroup=function(S){return!!this.body&&(this.body.group=S,!0)},z.create=function(S){return{id:f.P6.getUniqueId(),chatType:S.chatType,type:"img",url:S.url,width:S.width,height:S.height,file:S.file,to:S.to,from:S.from||"",ext:S.ext,time:Date.now(),msgConfig:S.msgConfig,file_length:S.file_length,onFileUploadError:S.onFileUploadError,onFileUploadComplete:S.onFileUploadComplete,onFileUploadProgress:S.onFileUploadProgress,isChatThread:S.isChatThread,priority:S.priority,deliverOnlineOnly:S.deliverOnlineOnly,receiverList:S.receiverList,thumbnailWidth:S.thumbnailWidth,thumbnailHeight:S.thumbnailHeight}},z}(),D=function(){function z(S){var F=S.type,M=S.id||f.P6.getUniqueId();this.id=M,this.type=F}return z.prototype.set=function(S){S.file=S.file||S.fileInputId&&f.P6.getFileUrl(S.fileInputId),this.body={id:this.id,chatType:S.chatType||"singleChat",type:"audio",file:S.file,filename:S.filename,length:S.length,file_length:S.file_length,fileInputId:S.fileInputId,to:S.to,from:S.from,roomType:S.roomType,success:S.success,fail:S.fail,ext:S.ext,time:Date.now(),onFileUploadError:S.onFileUploadError,onFileUploadComplete:S.onFileUploadComplete,onFileUploadProgress:S.onFileUploadProgress,body:S.body,isChatThread:S.isChatThread}},z.prototype.setChatType=function(S){return!!this.body&&(this.body.chatType=S,!0)},z.prototype.setGroup=function(S){return!!this.body&&(this.body.group=S,!0)},z.create=function(S){return{id:f.P6.getUniqueId(),chatType:S.chatType,type:"audio",filename:S.filename,length:S.length,file:S.file,to:S.to,from:S.from||"",ext:S.ext,time:Date.now(),onFileUploadError:S.onFileUploadError,onFileUploadComplete:S.onFileUploadComplete,onFileUploadProgress:S.onFileUploadProgress,body:S.body,file_length:S.file_length,msgConfig:S.msgConfig,isChatThread:S.isChatThread,priority:S.priority,deliverOnlineOnly:S.deliverOnlineOnly,receiverList:S.receiverList}},z}(),P=function(){function z(S){var F=S.type,M=S.id;this.id=M,this.type=F}return z.prototype.set=function(S){S.file=S.file||S.fileInputId&&f.P6.getFileUrl(S.fileInputId),this.body={id:this.id,chatType:S.chatType||"singleChat",type:"video",file:S.file,filename:S.filename,length:S.length,file_length:S.file_length,fileInputId:S.fileInputId,to:S.to,from:S.from,roomType:S.roomType,success:S.success,fail:S.fail,ext:S.ext,time:Date.now(),apiUrl:S.apiUrl,onFileUploadError:S.onFileUploadError,onFileUploadComplete:S.onFileUploadComplete,onFileUploadProgress:S.onFileUploadProgress,body:S.body,isChatThread:S.isChatThread}},z.prototype.setChatType=function(S){return!!this.body&&(this.body.chatType=S,!0)},z.prototype.setGroup=function(S){return!!this.body&&(this.body.group=S,!0)},z.create=function(S){return{id:f.P6.getUniqueId(),chatType:S.chatType||"singleChat",type:"video",file:S.file,filename:S.filename,length:S.length,file_length:S.file_length,fileInputId:S.fileInputId,to:S.to,from:S.from||"",ext:S.ext,time:Date.now(),onFileUploadError:S.onFileUploadError,onFileUploadComplete:S.onFileUploadComplete,onFileUploadProgress:S.onFileUploadProgress,body:S.body,msgConfig:S.msgConfig,isChatThread:S.isChatThread,priority:S.priority,deliverOnlineOnly:S.deliverOnlineOnly,receiverList:S.receiverList}},z}(),k=function(){function z(S){var F=S.type,M=S.id;this.id=M,this.type=F}return z.prototype.set=function(S){S.file=S.file||S.fileInputId&&f.P6.getFileUrl(S.fileInputId),this.body={id:this.id,chatType:S.chatType||"singleChat",type:"file",file:S.file,filename:S.filename,fileInputId:S.fileInputId,to:S.to,from:S.from,roomType:S.roomType,success:S.success,fail:S.fail,ext:S.ext,time:Date.now(),onFileUploadError:S.onFileUploadError,onFileUploadComplete:S.onFileUploadComplete,onFileUploadProgress:S.onFileUploadProgress,body:S.body,isChatThread:S.isChatThread}},z.prototype.setChatType=function(S){return!!this.body&&(this.body.chatType=S,!0)},z.prototype.setGroup=function(S){return!!this.body&&(this.body.group=S,!0)},z.create=function(S){return{id:f.P6.getUniqueId(),chatType:S.chatType||"singleChat",type:"file",file:S.file,filename:S.filename,fileInputId:S.fileInputId,file_length:S.file_length,to:S.to,from:S.from||"",ext:S.ext,onFileUploadError:S.onFileUploadError,onFileUploadComplete:S.onFileUploadComplete,onFileUploadProgress:S.onFileUploadProgress,body:S.body,time:Date.now(),msgConfig:S.msgConfig,isChatThread:S.isChatThread,priority:S.priority,deliverOnlineOnly:S.deliverOnlineOnly,receiverList:S.receiverList}},z}(),b=function(){function z(S){var F=S.type,M=S.id||f.P6.getUniqueId();this.id=M,this.type=F,this.value=""}return z.create=function(S){return{type:"combine",id:f.P6.getUniqueId(),to:S.to,from:S.from||"",chatType:S.chatType,ext:S.ext,time:Date.now(),msgConfig:S.msgConfig,isChatThread:S.isChatThread,priority:S.priority,deliverOnlineOnly:S.deliverOnlineOnly,receiverList:S.receiverList,compatibleText:S.compatibleText,title:S.title,summary:S.summary,messageList:S.messageList,onFileUploadError:S.onFileUploadError,onFileUploadComplete:S.onFileUploadComplete}},z}(),j=function(){function z(S,F){return this.type=S,this.id=F||f.P6.getUniqueId(),z.createOldMsg({type:S,id:this.id})}return z.createOldMsg=function(S){switch(S.type){case"read":return new h({type:"read",id:S.id});case"delivery":return new g({type:"delivery",id:S.id});case"channel":return new _({type:"channel",id:S.id});case"txt":return new E({type:"txt",id:S.id});case"cmd":return new m({type:"cmd",id:S.id});case"custom":return new p({type:"custom",id:S.id});case"loc":return new A({type:"loc",id:S.id});case"img":return new R({type:"img",id:S.id});case"audio":return new D({type:"audio",id:S.id});case"video":return new P({type:"video",id:S.id});case"file":return new k({type:"file",id:S.id})}},z.create=function(S){return(F=S).type!=="txt"||"version"in F?function(M){return M.type==="img"&&!("version"in M)}(S)?R.create(S):function(M){return M.type==="cmd"&&!("version"in M)}(S)?m.create(S):function(M){return M.type==="file"&&!("version"in M)}(S)?k.create(S):function(M){return M.type==="audio"&&!("version"in M)}(S)?D.create(S):function(M){return M.type==="video"&&!("version"in M)}(S)?P.create(S):function(M){return M.type==="custom"&&!("version"in M)}(S)?p.create(S):function(M){return M.type==="loc"&&!("version"in M)}(S)?A.create(S):function(M){return M.type==="channel"&&!("version"in M)}(S)?_.create(S):function(M){return M.type==="delivery"&&!("version"in M)}(S)?g.create(S):function(M){return M.type==="read"&&!("version"in M)}(S)?h.create(S):function(M){return M.type==="combine"&&!("version"in M)}(S)?b.create(S):{}:E.create(S);var F},z.prototype.set=function(S){},z.getFileUrl=f.P6.getFileUrl,z}()},5531:function(O,H,a){var f;a.d(H,{E:function(){return f}}),function(h){h[h.REQUEST_SUCCESS=0]="REQUEST_SUCCESS",h[h.REQUEST_TIMEOUT=-1]="REQUEST_TIMEOUT",h[h.REQUEST_UNKNOWN=-2]="REQUEST_UNKNOWN",h[h.REQUEST_PARAMETER_ERROR=-3]="REQUEST_PARAMETER_ERROR",h[h.REQUEST_ABORT=-4]="REQUEST_ABORT",h[h.WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR=0]="WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR",h[h.WEBIM_CONNCTION_OPEN_ERROR=1]="WEBIM_CONNCTION_OPEN_ERROR",h[h.WEBIM_CONNCTION_AUTH_ERROR=2]="WEBIM_CONNCTION_AUTH_ERROR",h[h.WEBIM_CONNCTION_OPEN_USERGRID_ERROR=3]="WEBIM_CONNCTION_OPEN_USERGRID_ERROR",h[h.WEBIM_CONNCTION_ATTACH_ERROR=4]="WEBIM_CONNCTION_ATTACH_ERROR",h[h.WEBIM_CONNCTION_ATTACH_USERGRID_ERROR=5]="WEBIM_CONNCTION_ATTACH_USERGRID_ERROR",h[h.WEBIM_CONNCTION_REOPEN_ERROR=6]="WEBIM_CONNCTION_REOPEN_ERROR",h[h.WEBIM_CONNCTION_SERVER_CLOSE_ERROR=7]="WEBIM_CONNCTION_SERVER_CLOSE_ERROR",h[h.WEBIM_CONNCTION_SERVER_ERROR=8]="WEBIM_CONNCTION_SERVER_ERROR",h[h.WEBIM_CONNCTION_IQ_ERROR=9]="WEBIM_CONNCTION_IQ_ERROR",h[h.WEBIM_CONNCTION_PING_ERROR=10]="WEBIM_CONNCTION_PING_ERROR",h[h.WEBIM_CONNCTION_NOTIFYVERSION_ERROR=11]="WEBIM_CONNCTION_NOTIFYVERSION_ERROR",h[h.WEBIM_CONNCTION_GETROSTER_ERROR=12]="WEBIM_CONNCTION_GETROSTER_ERROR",h[h.WEBIM_CONNCTION_CROSSDOMAIN_ERROR=13]="WEBIM_CONNCTION_CROSSDOMAIN_ERROR",h[h.WEBIM_CONNCTION_LISTENING_OUTOF_MAXRETRIES=14]="WEBIM_CONNCTION_LISTENING_OUTOF_MAXRETRIES",h[h.WEBIM_CONNCTION_RECEIVEMSG_CONTENTERROR=15]="WEBIM_CONNCTION_RECEIVEMSG_CONTENTERROR",h[h.WEBIM_CONNCTION_DISCONNECTED=16]="WEBIM_CONNCTION_DISCONNECTED",h[h.WEBIM_CONNCTION_AJAX_ERROR=17]="WEBIM_CONNCTION_AJAX_ERROR",h[h.WEBIM_CONNCTION_JOINROOM_ERROR=18]="WEBIM_CONNCTION_JOINROOM_ERROR",h[h.WEBIM_CONNCTION_GETROOM_ERROR=19]="WEBIM_CONNCTION_GETROOM_ERROR",h[h.WEBIM_CONNCTION_GETROOMINFO_ERROR=20]="WEBIM_CONNCTION_GETROOMINFO_ERROR",h[h.WEBIM_CONNCTION_GETROOMMEMBER_ERROR=21]="WEBIM_CONNCTION_GETROOMMEMBER_ERROR",h[h.WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR=22]="WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR",h[h.WEBIM_CONNCTION_LOAD_CHATROOM_ERROR=23]="WEBIM_CONNCTION_LOAD_CHATROOM_ERROR",h[h.WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR=24]="WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR",h[h.WEBIM_CONNCTION_JOINCHATROOM_ERROR=25]="WEBIM_CONNCTION_JOINCHATROOM_ERROR",h[h.WEBIM_CONNCTION_QUITCHATROOM_ERROR=26]="WEBIM_CONNCTION_QUITCHATROOM_ERROR",h[h.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR=27]="WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR",h[h.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR=28]="WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR",h[h.WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR=29]="WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR",h[h.WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR=30]="WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR",h[h.WEBIM_CONNCTION_CALLBACK_INNER_ERROR=31]="WEBIM_CONNCTION_CALLBACK_INNER_ERROR",h[h.WEBIM_CONNCTION_CLIENT_OFFLINE=32]="WEBIM_CONNCTION_CLIENT_OFFLINE",h[h.WEBIM_CONNCTION_CLIENT_LOGOUT=33]="WEBIM_CONNCTION_CLIENT_LOGOUT",h[h.WEBIM_CONNCTION_CLIENT_TOO_MUCH_ERROR=34]="WEBIM_CONNCTION_CLIENT_TOO_MUCH_ERROR",h[h.WEBIM_CONNECTION_ACCEPT_INVITATION_FROM_GROUP=35]="WEBIM_CONNECTION_ACCEPT_INVITATION_FROM_GROUP",h[h.WEBIM_CONNECTION_DECLINE_INVITATION_FROM_GROUP=36]="WEBIM_CONNECTION_DECLINE_INVITATION_FROM_GROUP",h[h.WEBIM_CONNECTION_ACCEPT_JOIN_GROUP=37]="WEBIM_CONNECTION_ACCEPT_JOIN_GROUP",h[h.WEBIM_CONNECTION_DECLINE_JOIN_GROUP=38]="WEBIM_CONNECTION_DECLINE_JOIN_GROUP",h[h.WEBIM_CONNECTION_CLOSED=39]="WEBIM_CONNECTION_CLOSED",h[h.WEBIM_CONNECTION_ERROR=40]="WEBIM_CONNECTION_ERROR",h[h.MAX_LIMIT=50]="MAX_LIMIT",h[h.MESSAGE_NOT_FOUND=51]="MESSAGE_NOT_FOUND",h[h.NO_PERMISSION=52]="NO_PERMISSION",h[h.OPERATION_UNSUPPORTED=53]="OPERATION_UNSUPPORTED",h[h.OPERATION_NOT_ALLOWED=54]="OPERATION_NOT_ALLOWED",h[h.WEBIM_TOKEN_EXPIRED=56]="WEBIM_TOKEN_EXPIRED",h[h.WEBIM_SERVER_SERVING_DISABLED=57]="WEBIM_SERVER_SERVING_DISABLED",h[h.WEBIM_UPLOADFILE_BROWSER_ERROR=100]="WEBIM_UPLOADFILE_BROWSER_ERROR",h[h.WEBIM_UPLOADFILE_ERROR=101]="WEBIM_UPLOADFILE_ERROR",h[h.WEBIM_UPLOADFILE_NO_LOGIN=102]="WEBIM_UPLOADFILE_NO_LOGIN",h[h.WEBIM_UPLOADFILE_NO_FILE=103]="WEBIM_UPLOADFILE_NO_FILE",h[h.WEBIM_DOWNLOADFILE_ERROR=200]="WEBIM_DOWNLOADFILE_ERROR",h[h.WEBIM_DOWNLOADFILE_NO_LOGIN=201]="WEBIM_DOWNLOADFILE_NO_LOGIN",h[h.WEBIM_DOWNLOADFILE_BROWSER_ERROR=202]="WEBIM_DOWNLOADFILE_BROWSER_ERROR",h[h.PARSE_FILE_ERROR=203]="PARSE_FILE_ERROR",h[h.USER_NOT_FOUND=204]="USER_NOT_FOUND",h[h.MESSAGE_PARAMETER_ERROR=205]="MESSAGE_PARAMETER_ERROR",h[h.WEBIM_CONNCTION_USER_LOGIN_ANOTHER_DEVICE=206]="WEBIM_CONNCTION_USER_LOGIN_ANOTHER_DEVICE",h[h.WEBIM_CONNCTION_USER_REMOVED=207]="WEBIM_CONNCTION_USER_REMOVED",h[h.WEBIM_CONNCTION_USER_KICKED_BY_CHANGE_PASSWORD=216]="WEBIM_CONNCTION_USER_KICKED_BY_CHANGE_PASSWORD",h[h.WEBIM_CONNCTION_USER_KICKED_BY_OTHER_DEVICE=217]="WEBIM_CONNCTION_USER_KICKED_BY_OTHER_DEVICE",h[h.USER_MUTED_BY_ADMIN=219]="USER_MUTED_BY_ADMIN",h[h.USER_NOT_FRIEND=221]="USER_NOT_FRIEND",h[h.WEBIM_MESSAGE_REC_TEXT=300]="WEBIM_MESSAGE_REC_TEXT",h[h.WEBIM_MESSAGE_REC_TEXT_ERROR=301]="WEBIM_MESSAGE_REC_TEXT_ERROR",h[h.WEBIM_MESSAGE_REC_EMOTION=302]="WEBIM_MESSAGE_REC_EMOTION",h[h.WEBIM_MESSAGE_REC_PHOTO=303]="WEBIM_MESSAGE_REC_PHOTO",h[h.SERVER_GET_DNSLIST_FAILED=304]="SERVER_GET_DNSLIST_FAILED",h[h.WEBIM_MESSAGE_REC_AUDIO_FILE=305]="WEBIM_MESSAGE_REC_AUDIO_FILE",h[h.WEBIM_MESSAGE_REC_VEDIO=306]="WEBIM_MESSAGE_REC_VEDIO",h[h.WEBIM_MESSAGE_REC_VEDIO_FILE=307]="WEBIM_MESSAGE_REC_VEDIO_FILE",h[h.WEBIM_MESSAGE_REC_FILE=308]="WEBIM_MESSAGE_REC_FILE",h[h.WEBIM_MESSAGE_SED_TEXT=309]="WEBIM_MESSAGE_SED_TEXT",h[h.WEBIM_MESSAGE_SED_EMOTION=310]="WEBIM_MESSAGE_SED_EMOTION",h[h.WEBIM_MESSAGE_SED_PHOTO=311]="WEBIM_MESSAGE_SED_PHOTO",h[h.WEBIM_MESSAGE_SED_AUDIO=312]="WEBIM_MESSAGE_SED_AUDIO",h[h.WEBIM_MESSAGE_SED_AUDIO_FILE=313]="WEBIM_MESSAGE_SED_AUDIO_FILE",h[h.WEBIM_MESSAGE_SED_VEDIO=314]="WEBIM_MESSAGE_SED_VEDIO",h[h.WEBIM_MESSAGE_SED_VEDIO_FILE=315]="WEBIM_MESSAGE_SED_VEDIO_FILE",h[h.WEBIM_MESSAGE_SED_FILE=316]="WEBIM_MESSAGE_SED_FILE",h[h.WEBIM_MESSAGE_SED_ERROR=317]="WEBIM_MESSAGE_SED_ERROR",h[h.STATUS_INIT=400]="STATUS_INIT",h[h.STATUS_DOLOGIN_USERGRID=401]="STATUS_DOLOGIN_USERGRID",h[h.STATUS_DOLOGIN_IM=402]="STATUS_DOLOGIN_IM",h[h.STATUS_OPENED=403]="STATUS_OPENED",h[h.STATUS_CLOSING=404]="STATUS_CLOSING",h[h.STATUS_CLOSED=405]="STATUS_CLOSED",h[h.STATUS_ERROR=406]="STATUS_ERROR",h[h.SERVER_BUSY=500]="SERVER_BUSY",h[h.MESSAGE_INCLUDE_ILLEGAL_CONTENT=501]="MESSAGE_INCLUDE_ILLEGAL_CONTENT",h[h.MESSAGE_EXTERNAL_LOGIC_BLOCKED=502]="MESSAGE_EXTERNAL_LOGIC_BLOCKED",h[h.SERVER_UNKNOWN_ERROR=503]="SERVER_UNKNOWN_ERROR",h[h.MESSAGE_RECALL_TIME_LIMIT=504]="MESSAGE_RECALL_TIME_LIMIT",h[h.SERVICE_NOT_ENABLED=505]="SERVICE_NOT_ENABLED",h[h.SERVICE_NOT_ALLOW_MESSAGING=506]="SERVICE_NOT_ALLOW_MESSAGING",h[h.SERVICE_NOT_ALLOW_MESSAGING_MUTE=507]="SERVICE_NOT_ALLOW_MESSAGING_MUTE",h[h.MESSAGE_MODERATION_BLOCKED=508]="MESSAGE_MODERATION_BLOCKED",h[h.MESSAGE_CURRENT_LIMITING=509]="MESSAGE_CURRENT_LIMITING",h[h.MESSAGE_WEBSOCKET_DISCONNECTED=510]="MESSAGE_WEBSOCKET_DISCONNECTED",h[h.MESSAGE_SIZE_LIMIT=511]="MESSAGE_SIZE_LIMIT",h[h.GROUP_NOT_EXIST=605]="GROUP_NOT_EXIST",h[h.GROUP_NOT_JOINED=602]="GROUP_NOT_JOINED",h[h.GROUP_MEMBERS_FULL=606]="GROUP_MEMBERS_FULL",h[h.PERMISSION_DENIED=603]="PERMISSION_DENIED",h[h.WEBIM_LOAD_MSG_ERROR=604]="WEBIM_LOAD_MSG_ERROR",h[h.GROUP_ALREADY_JOINED=601]="GROUP_ALREADY_JOINED",h[h.GROUP_MEMBERS_LIMIT=607]="GROUP_MEMBERS_LIMIT",h[h.GROUP_IS_DISABLED=608]="GROUP_IS_DISABLED",h[h.GROUP_MEMBER_ATTRIBUTES_SET_FAILED=609]="GROUP_MEMBER_ATTRIBUTES_SET_FAILED",h[h.REST_PARAMS_STATUS=700]="REST_PARAMS_STATUS",h[h.CHATROOM_NOT_JOINED=702]="CHATROOM_NOT_JOINED",h[h.CHATROOM_MEMBERS_FULL=704]="CHATROOM_MEMBERS_FULL",h[h.CHATROOM_NOT_EXIST=705]="CHATROOM_NOT_EXIST",h[h.LOCAL_DB_OPERATION_FAILED=800]="LOCAL_DB_OPERATION_FAILED",h[h.SDK_RUNTIME_ERROR=999]="SDK_RUNTIME_ERROR",h[h.PRESENCE_PARAM_EXCEED=1100]="PRESENCE_PARAM_EXCEED",h[h.REACTION_ALREADY_ADDED=1101]="REACTION_ALREADY_ADDED",h[h.REACTION_CREATING=1102]="REACTION_CREATING",h[h.REACTION_OPERATION_IS_ILLEGAL=1103]="REACTION_OPERATION_IS_ILLEGAL",h[h.TRANSLATION_NOT_VALID=1200]="TRANSLATION_NOT_VALID",h[h.TRANSLATION_TEXT_TOO_LONG=1201]="TRANSLATION_TEXT_TOO_LONG",h[h.TRANSLATION_FAILED=1204]="TRANSLATION_FAILED",h[h.THREAD_NOT_EXIST=1300]="THREAD_NOT_EXIST",h[h.THREAD_ALREADY_EXIST=1301]="THREAD_ALREADY_EXIST",h[h.MODIFY_MESSAGE_NOT_EXIST=1302]="MODIFY_MESSAGE_NOT_EXIST",h[h.MODIFY_MESSAGE_FORMAT_ERROR=1303]="MODIFY_MESSAGE_FORMAT_ERROR",h[h.MODIFY_MESSAGE_FAILED=1304]="MODIFY_MESSAGE_FAILED",h[h.CONVERSATION_NOT_EXIST=1400]="CONVERSATION_NOT_EXIST"}(f||(f={}))},4998:function(O,H,a){var f;a.d(H,{a:function(){return f}}),a(7252),function(h){h[h.SYNC_INIT=0]="SYNC_INIT",h[h.SYNC_START=1]="SYNC_START",h[h.SYNC_FINISH=2]="SYNC_FINISH"}(f||(f={}))},9937:function(O,H,a){var f;a.d(H,{Z:function(){return f}}),function(h){h[h.mark_0=0]="mark_0",h[h.mark_1=1]="mark_1",h[h.mark_2=2]="mark_2",h[h.mark_3=3]="mark_3",h[h.mark_4=4]="mark_4",h[h.mark_5=5]="mark_5",h[h.mark_6=6]="mark_6",h[h.mark_7=7]="mark_7",h[h.mark_8=8]="mark_8",h[h.mark_9=9]="mark_9",h[h.mark_10=10]="mark_10",h[h.mark_11=11]="mark_11",h[h.mark_12=12]="mark_12",h[h.mark_13=13]="mark_13",h[h.mark_14=14]="mark_14",h[h.mark_15=15]="mark_15",h[h.mark_16=16]="mark_16",h[h.mark_17=17]="mark_17",h[h.mark_18=18]="mark_18",h[h.mark_19=19]="mark_19"}(f||(f={}))},4024:function(O,H,a){a.d(H,{PU:function(){return U},iw:function(){return mt},hj:function(){return Y},LR:function(){return Lt},cT:function(){return At},P6:function(){return de}}),a(9601),a(1539),a(8674),a(3710),a(7941),a(6699),a(7042),a(2772),a(9714),a(9653),a(6992),a(8783),a(3948),a(285),a(1637),a(8309),a(4986),a(2222),a(4916),a(2564);var f=a(5531),h=(a(2023),function(){return h=Object.assign||function(ft){for(var gt,Zt=1,Pt=arguments.length;Zt<Pt;Zt++)for(var Wt in gt=arguments[Zt])Object.prototype.hasOwnProperty.call(gt,Wt)&&(ft[Wt]=gt[Wt]);return ft},h.apply(this,arguments)}),g=function(ft,gt,Zt,Pt){var Wt,oe,fe,le,Ie,me,Oe,je,xe,ir,He,ae,Ne,Ze,ee,be,We,Pe,Ee,te,Ae,Xe,Be,ze,ot=ft.response;ot&&typeof ot=="string"&&(ot=JSON.parse(ot));var Et=ft.status,nt={elapse:Pt,httpCode:Et,errDesc:ot?.error_description};if(Et===400){if(ot.error_code===40002)return void gt({type:f.E.THREAD_ALREADY_EXIST,message:ot?.error_description,extraInfo:nt});if(ot.error_code===40009)return void gt({type:f.E.OPERATION_UNSUPPORTED,message:ot?.error_description,extraInfo:nt});if(ot.error_code===60005)return void gt({type:f.E.GROUP_MEMBER_ATTRIBUTES_SET_FAILED,message:ot?.desc||ot?.error_description,extraInfo:nt});if(ot.error_code===60010)return void(ot?.error_description.includes("exceeds chatgroup user metadata single value limit")?gt({type:f.E.MAX_LIMIT,message:ot?.desc||ot.error_description,extraInfo:nt}):gt({type:f.E.NO_PERMISSION,message:ot?.desc||ot.error_description,extraInfo:nt}));if(ot.error_code===60011)return void gt({type:f.E.CHATROOM_NOT_JOINED,message:ot?.desc,extraInfo:nt});if(ot.error_code===14403)return void gt({type:f.E.WEBIM_UPLOADFILE_ERROR,message:ot?.error_description,data:ot,extraInfo:nt});if(ot.error_code===60006||ot.error_code===60007||ot.error_code===60009||ot.error_code===60012)return void gt({type:f.E.MAX_LIMIT,message:ot?.desc||ot?.error_description,extraInfo:nt});if(ot.error_code===91104)return void gt({type:f.E.NO_PERMISSION,message:ot?.error_description,extraInfo:nt});if(!((Wt=ot.error_description)===null||Wt===void 0)&&Wt.includes("are not members of this group"))return!((oe=ft.responseURL)===null||oe===void 0)&&oe.includes("chatgroups")?gt({type:f.E.GROUP_NOT_JOINED,data:ft.response||ft.responseText,message:ot.error_description,extraInfo:nt}):gt({type:f.E.CHATROOM_NOT_JOINED,data:ft.response||ft.responseText,message:ot.error_description,extraInfo:nt}),void Zt({type:f.E.WEBIM_CONNCTION_AJAX_ERROR,message:ot?.error_description,data:ft.responseText,extraInfo:nt});if(ot?.result==="the app not open presence")return void gt({type:f.E.SERVICE_NOT_ENABLED,message:ot?.result,extraInfo:nt});if(ot?.error_description.includes("remark length must less"))return void gt({type:f.E.MAX_LIMIT,message:ot?.error_description,extraInfo:nt});switch(ot?.error_description){case"the user is already operation this message":gt({type:f.E.REACTION_ALREADY_ADDED,message:ot?.error_description,extraInfo:nt});break;case"The quantity has exceeded the limit!":gt({type:f.E.MAX_LIMIT,message:ot?.error_description,extraInfo:nt});break;case"The user not in this group!":gt({type:f.E.GROUP_NOT_JOINED,message:ot?.error_description,extraInfo:nt});break;case"the user operation is illegal!":gt({type:f.E.REACTION_OPERATION_IS_ILLEGAL,message:ot?.error_description,extraInfo:nt});break;case"this appKey is not open reaction service!":case"this appKey not open message roaming":gt({type:f.E.SERVICE_NOT_ENABLED,message:ot?.error_description,extraInfo:nt});break;case"this message is creating reaction, please try again.":gt({type:f.E.REACTION_CREATING,message:ot?.error_description,extraInfo:nt});break;case"groupId can not be null!":gt({type:f.E.GROUP_NOT_EXIST,message:ot?.error_description,extraInfo:nt});break;case"The input text is too long.":gt({type:f.E.TRANSLATION_TEXT_TOO_LONG,message:ot?.error_description,extraInfo:nt});break;case"The target language is not valid.":gt({type:f.E.TRANSLATION_NOT_VALID,message:ot?.error_description,extraInfo:nt});break;case"report failed, get message by id failed":gt({type:f.E.MESSAGE_NOT_FOUND,message:ot?.error_description,extraInfo:nt});break;case"ext is too big ":gt({type:f.E.PRESENCE_PARAM_EXCEED,message:ot?.error_description,extraInfo:nt});break;case"Request body not readable.Please check content type is correct!":case"param mark must be not empty, please check!":case"param mark illegal, please check it!":case"param pin_msg_id illegal, please check it!":gt({type:f.E.REQUEST_PARAMETER_ERROR,message:ot?.error_description,extraInfo:nt});break;case"updateRemark | they are not friends, please add as a friend first.":gt({type:f.E.USER_NOT_FRIEND,message:ot?.error_description,extraInfo:nt});break;default:gt({type:f.E.WEBIM_CONNCTION_AJAX_ERROR,message:ot?.error_description,data:ft.responseText,extraInfo:nt}),Zt({type:f.E.WEBIM_CONNCTION_AJAX_ERROR,message:ot?.error_description,data:ft.responseText,extraInfo:nt})}}else if(Et===401)ot.error_code===40001||ot.error_code===60001||ot.error_description==="Unable to authenticate (OAuth)"?gt({type:f.E.NO_PERMISSION,message:ot?.error_description,extraInfo:nt}):(Zt({type:f.E.WEBIM_CONNCTION_AJAX_ERROR,data:ft.responseText,message:ft.responseText,extraInfo:nt}),gt({type:f.E.WEBIM_CONNCTION_AJAX_ERROR,data:ft.responseText,message:ft.responseText,extraInfo:nt}));else if(Et===403)ot.error_code===4e4||ot.error_code===60004||ot.error_code===15002?gt({type:f.E.SERVICE_NOT_ENABLED,message:ot?.error_description,extraInfo:nt}):ot.error_code===40003||ot.error_code===40004?gt({type:f.E.THREAD_ALREADY_EXIST,message:ot?.error_description,extraInfo:nt}):ot.error_code===40005||ot.error_code===40007||ot.error_code===91002?gt({type:f.E.MAX_LIMIT,message:ot?.error_description,extraInfo:nt}):ot.error_code===60002?gt({type:f.E.PERMISSION_DENIED,message:ot?.error_description,extraInfo:nt}):ot.error_code===91101?gt({type:f.E.MAX_LIMIT,message:ot?.error_description,extraInfo:nt}):ot.error_code===91102&&gt({type:f.E.REQUEST_PARAMETER_ERROR,message:ot.error_description,extraInfo:nt}),ot.error_description==="group member list is full!"?!((fe=ft.responseURL)===null||fe===void 0)&&fe.includes("chatgroups")?gt({type:f.E.GROUP_MEMBERS_FULL,data:ft.response||ft.responseText,message:ot.error_description,extraInfo:nt}):gt({type:f.E.CHATROOM_MEMBERS_FULL,data:ft.response||ft.responseText,message:ot.error_description,extraInfo:nt}):!((le=ot.error_description)===null||le===void 0)&&le.includes(ot.error_description.includes("already in group"))?!((Ie=ft.responseURL)===null||Ie===void 0)&&Ie.includes("chatgroups")&&gt({type:f.E.GROUP_ALREADY_JOINED,data:ft.response||ft.responseText,message:ot.error_description,extraInfo:nt}):!((me=ot.error_description)===null||me===void 0)&&me.includes("are not members of this group")?!((Oe=ft.responseURL)===null||Oe===void 0)&&Oe.includes("chatgroups")?gt({type:f.E.GROUP_NOT_JOINED,data:ft.response||ft.responseText,message:ot.error_description,extraInfo:nt}):gt({type:f.E.CHATROOM_NOT_JOINED,data:ft.response||ft.responseText,message:ot.error_description,extraInfo:nt}):!((je=ot.error_description)===null||je===void 0)&&je.includes("service not open!")||!((xe=ot.error_description)===null||xe===void 0)&&xe.includes("message report not open")||!((ir=ot.error_description)===null||ir===void 0)&&ir.includes("messageroaming function not open")?gt({type:f.E.SERVICE_NOT_ENABLED,data:ft.response||ft.responseText,message:ot.error_description,extraInfo:nt}):!((He=ot.error_description)===null||He===void 0)&&He.includes("members size is greater than max user size !")?gt({type:f.E.GROUP_MEMBERS_LIMIT,data:ft.response||ft.responseText,message:ot.error_description,extraInfo:nt}):!((ae=ot.error_description)===null||ae===void 0)&&ae.includes("can not operate this group, reason: group is disabled")?gt({type:f.E.GROUP_IS_DISABLED,data:ft.response||ft.responseText,message:ot.error_description,extraInfo:nt}):!((Ne=ot.error_description)===null||Ne===void 0)&&Ne.includes("Invitee's contact max count")||!((Ze=ot.error_description)===null||Ze===void 0)&&Ze.includes("Inviter's contact max count")?gt({type:f.E.MAX_LIMIT,data:ft.response||ft.responseText,message:ot.error_description,extraInfo:nt}):gt({type:f.E.PERMISSION_DENIED,data:ft.response||ft.responseText,message:"permission denied",extraInfo:h(h({},nt),{errDesc:"permission denied"})}),Zt({type:f.E.WEBIM_CONNCTION_AJAX_ERROR,data:ft.responseText,message:ft.responseText,extraInfo:nt});else if(Et===404)ot.error_code===40011?gt({type:f.E.THREAD_NOT_EXIST,message:ot?.error_description,extraInfo:nt}):ot.error_code===40012?gt({type:f.E.NO_PERMISSION,message:ot?.error_description,extraInfo:nt}):ot.error_code===60003||ot.error_code===20004?gt({type:f.E.GROUP_NOT_JOINED,message:ot?.error_description,extraInfo:nt}):ot.error_code===91001&&gt({type:f.E.CONVERSATION_NOT_EXIST,message:ot?.error_description,extraInfo:nt}),!((ee=ot.error_description)===null||ee===void 0)&&ee.includes("do not find this group")||!((be=ot.error_description)===null||be===void 0)&&be.includes("does not exist")?!((We=ft.responseURL)===null||We===void 0)&&We.includes("chatgroups")?gt({type:f.E.GROUP_NOT_EXIST,data:ft.response||ft.responseText,message:"The chat room dose not exist.",extraInfo:h(h({},nt),{errDesc:"The chat room dose not exist."})}):gt({type:f.E.CHATROOM_NOT_EXIST,data:ft.response||ft.responseText,message:"The chat room dose not exist.",extraInfo:h(h({},nt),{errDesc:"The chat room dose not exist."})}):!((Pe=ot.error_description)===null||Pe===void 0)&&Pe.includes("username")&&(!((Ee=ot.error_description)===null||Ee===void 0)&&Ee.includes("doesn't exist!'"))||!((te=ot.error_description)===null||te===void 0)&&te.includes("user not found")||!((Ae=ot.error_description)===null||Ae===void 0)&&Ae.includes("Service resource not found")&&ot?.exception==="UserNotFoundException"?gt({type:f.E.USER_NOT_FOUND,data:ft.response||ft.responseText,message:ot.error_description,extraInfo:nt}):ot.error_description.includes("user session pin message not exist")?gt({type:f.E.MESSAGE_NOT_FOUND,message:ot.error_description,extraInfo:nt}):gt({type:f.E.WEBIM_CONNCTION_AJAX_ERROR,data:ft.response||ft.responseText,message:ft.responseText,extraInfo:nt}),Zt({type:f.E.WEBIM_CONNCTION_AJAX_ERROR,data:ft.response||ft.responseText,message:ft.responseText,extraInfo:nt});else if(Et===406)ot.error_code===90004&&gt({type:f.E.OPERATION_NOT_ALLOWED,message:ot?.error_description,extraInfo:nt});else if(Et===429||Et===503){if(!((Xe=ot.error_description)===null||Xe===void 0)&&Xe.includes("The request has reached the maximum limit"))return void gt({type:f.E.MAX_LIMIT,message:ft.responseText,extraInfo:nt});if(!((Be=ot.error_description)===null||Be===void 0)&&Be.includes("upload client logs reached limit"))return void gt({type:f.E.MAX_LIMIT,message:ft.responseText});gt({type:f.E.SERVER_BUSY,data:ft.response||ft.responseText,message:"Server is busy.",extraInfo:h(h({},nt),{errDesc:"Server is busy."})}),Zt({type:f.E.WEBIM_CONNCTION_AJAX_ERROR,data:ft.responseText,message:"Server is busy.",extraInfo:h(h({},nt),{errDesc:"Server is busy."})})}else if(Et===500){if(ot.error_code===40006||ot.error_code===40008||ot.error_code===40010)return void gt({type:f.E.SERVER_UNKNOWN_ERROR,message:ot?.error_description,extraInfo:nt});if(ot.error_code===90005||ot.error_code===99999)return void gt({type:f.E.REQUEST_UNKNOWN,message:ot?.error_description,extraInfo:nt});if(!((ze=ot.error_description)===null||ze===void 0)&&ze.includes("translte failed!"))return void gt({type:f.E.TRANSLATION_FAILED,message:ft.responseText,extraInfo:nt});gt({type:f.E.WEBIM_CONNCTION_AJAX_ERROR,data:ft.responseText,message:"",extraInfo:nt}),Zt({type:f.E.WEBIM_CONNCTION_AJAX_ERROR,data:ft.responseText,message:"",extraInfo:nt})}else gt({type:f.E.WEBIM_CONNCTION_AJAX_ERROR,data:ft.responseText,message:ft.responseText,extraInfo:h(h({},nt),{errDesc:"ajax error"})}),Zt({type:f.E.WEBIM_CONNCTION_AJAX_ERROR,data:ft.responseText,message:ft.responseText,extraInfo:h(h({},nt),{errDesc:"ajax error"})})},_=a(1595),E=a(2071),m=a(7360),p=5242880,A=5242880,R={size:0},D=(a(2526),a(1817),a(2165),a(5827),a(4553),a(561),function(){return D=Object.assign||function(ft){for(var gt,Zt=1,Pt=arguments.length;Zt<Pt;Zt++)for(var Wt in gt=arguments[Zt])Object.prototype.hasOwnProperty.call(gt,Wt)&&(ft[Wt]=gt[Wt]);return ft},D.apply(this,arguments)});function P(){var ft=this.context,gt=ft.orgName,Zt=ft.appName,Pt=ft.accessToken,Wt={url:"".concat(this.apiUrl,"/").concat(gt,"/").concat(Zt,"/sdk/chatfiles/part-upload"),dataType:"json",type:"POST",headers:{Authorization:"Bearer "+Pt}};return m.kg.debug("Call multipartInit"),Y.call(this,Wt,_.fI.SDK_INTERNAL).then(function(oe){var fe=oe.entities[0];return{data:{fileMaxSize:fe.file_upper_limit,partMinSize:fe.part_lower_limit,uuid:fe.uuid},extraInfo:oe.extraInfo,type:oe.type}})}function k(ft){var gt=this;return new Promise(function(Zt,Pt){var Wt,oe,fe=new Date().getTime(),le=gt.context,Ie=le.orgName,me=le.appName,Oe=le.accessToken,je=ft.uuid,xe=ft.partNumber,ir=ft.part,He=ft.onProgress,ae="".concat(gt.apiUrl,"/").concat(Ie,"/").concat(me,"/sdk/chatfiles/part-upload/").concat(je),Ne=new XMLHttpRequest;m.kg.debug("Call multipartUpload"),Ne.upload&&((oe=(Wt=Ne.upload).addEventListener)===null||oe===void 0||oe.call(Wt,"progress",function(ee){He?.(ee)},!1)),Ne.addEventListener("abort",function(){Pt({type:f.E.REQUEST_ABORT,message:"Request Abort",errorType:"onabort",xhr:Ne,extraInfo:{elapse:new Date().getTime()-fe,httpCode:Ne.status||-1,errDesc:"Request Abort",url:ae}})},!1),Ne.addEventListener("error",function(){Pt({type:f.E.WEBIM_UPLOADFILE_ERROR,data:Ne,extraInfo:{elapse:new Date().getTime()-fe,httpCode:Ne.status||-1,errDesc:"request error",url:ae}})},!1),Ne.addEventListener("load",function(){try{var ee=JSON.parse(Ne.responseText);if(Ne.status!==200)return Pt({type:f.E.WEBIM_UPLOADFILE_ERROR,data:ee,extraInfo:{elapse:new Date().getTime()-fe,httpCode:Ne.status||-1,errDesc:"part upload failed",url:ae}}),!1;try{Zt(D(D({},ee),{extraInfo:{elapse:new Date().getTime()-fe,httpCode:Ne.status||-1,url:ae}}))}catch(be){Pt({type:f.E.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:be,extraInfo:{elapse:new Date().getTime()-fe,httpCode:Ne.status||-1,errDesc:"part upload failed",url:ae}})}}catch{Pt({type:f.E.WEBIM_UPLOADFILE_ERROR,data:Ne.responseText,extraInfo:{elapse:new Date().getTime()-fe,httpCode:Ne.status||-1,errDesc:"part upload failed",url:ae}})}},!1);var Ze=new FormData;Ze.append("part_file",ir),Ze.append("part_number",xe),Ne.open("PUT",ae),Ne.setRequestHeader("restrict-access","true"),Ne.setRequestHeader("Accept","*/*"),Ne.setRequestHeader("Authorization","Bearer "+Oe),Ne.send(Ze)})}function b(ft){var gt=ft.uuid,Zt=ft.thumbnailHeight,Pt=ft.thumbnailWidth,Wt=this.context,oe=Wt.orgName,fe=Wt.appName,le=Wt.accessToken,Ie="".concat(this.apiUrl,"/").concat(oe,"/").concat(fe,"/sdk/chatfiles/part-upload/").concat(gt,"?restrict-access=true");Pt&&(Ie+="&thumbnail-width=".concat(Pt)),Zt&&(Ie+="&thumbnail-height=".concat(Zt));var me={url:Ie,dataType:"json",type:"POST",headers:{Authorization:"Bearer "+le}};return m.kg.debug("Call multipartComplete"),Y.call(this,me,_.fI.SDK_INTERNAL)}function j(ft){var gt=ft.uuid,Zt=this.context,Pt=Zt.orgName,Wt=Zt.appName,oe=Zt.accessToken,fe={url:"".concat(this.apiUrl,"/").concat(Pt,"/").concat(Wt,"/sdk/chatfiles/part-upload/").concat(gt),dataType:"json",type:"DELETE",headers:{Authorization:"Bearer "+oe}};return m.kg.debug("Call multipartAbort"),Y.call(this,fe,_.fI.SDK_INTERNAL)}var z=function(ft,gt,Zt,Pt){return new(Zt||(Zt=Promise))(function(Wt,oe){function fe(me){try{Ie(Pt.next(me))}catch(Oe){oe(Oe)}}function le(me){try{Ie(Pt.throw(me))}catch(Oe){oe(Oe)}}function Ie(me){var Oe;me.done?Wt(me.value):(Oe=me.value,Oe instanceof Zt?Oe:new Zt(function(je){je(Oe)})).then(fe,le)}Ie((Pt=Pt.apply(ft,[])).next())})},S=function(ft,gt){var Zt,Pt,Wt,oe,fe={label:0,sent:function(){if(1&Wt[0])throw Wt[1];return Wt[1]},trys:[],ops:[]};return oe={next:le(0),throw:le(1),return:le(2)},typeof Symbol=="function"&&(oe[Symbol.iterator]=function(){return this}),oe;function le(Ie){return function(me){return function(Oe){if(Zt)throw new TypeError("Generator is already executing.");for(;fe;)try{if(Zt=1,Pt&&(Wt=2&Oe[0]?Pt.return:Oe[0]?Pt.throw||((Wt=Pt.return)&&Wt.call(Pt),0):Pt.next)&&!(Wt=Wt.call(Pt,Oe[1])).done)return Wt;switch(Pt=0,Wt&&(Oe=[2&Oe[0],Wt.value]),Oe[0]){case 0:case 1:Wt=Oe;break;case 4:return fe.label++,{value:Oe[1],done:!1};case 5:fe.label++,Pt=Oe[1],Oe=[0];continue;case 7:Oe=fe.ops.pop(),fe.trys.pop();continue;default:if(!((Wt=(Wt=fe.trys).length>0&&Wt[Wt.length-1])||Oe[0]!==6&&Oe[0]!==2)){fe=0;continue}if(Oe[0]===3&&(!Wt||Oe[1]>Wt[0]&&Oe[1]<Wt[3])){fe.label=Oe[1];break}if(Oe[0]===6&&fe.label<Wt[1]){fe.label=Wt[1],Wt=Oe;break}if(Wt&&fe.label<Wt[2]){fe.label=Wt[2],fe.ops.push(Oe);break}Wt[2]&&fe.ops.pop(),fe.trys.pop();continue}Oe=gt.call(ft,fe)}catch(je){Oe=[6,je],Pt=0}finally{Zt=Wt=0}if(5&Oe[0])throw Oe[1];return{value:Oe[0]?Oe[1]:void 0,done:!0}}([Ie,me])}}},F=function(){function ft(gt,Zt){var Pt=this;this.handleUploadProgress=function(Wt,oe){var fe,le;if(Wt.total){Pt.progressArr[oe]=Wt.loaded;var Ie=Pt.progressArr.reduce(function(me,Oe){return me+Oe},0);(le=(fe=Pt.options).onFileUploadProgress)===null||le===void 0||le.call(fe,{isTrusted:Wt.isTrusted,type:Wt.type,loaded:Ie>Pt.file.size?Pt.file.size:Ie,total:Pt.file.size,lengthComputable:Wt.lengthComputable})}},this.uuid="",this.pool=[],this.progressArr=[],this.connection=gt,this.options=Zt,this.partSize=p,this.file=Zt.file,this.init(),this.rpt=this.connection.dataReport.geOperateFun({operationName:_.fI.REST_UPLOAD_FILE_IN_PARTS})}return ft.prototype.init=function(){var gt,Zt,Pt,Wt;return z(this,void 0,void 0,function(){var oe,fe,le,Ie,me,Oe,je,xe,ir,He,ae,Ne,Ze,ee,be;return S(this,function(We){switch(We.label){case 0:return We.trys.push([0,4,,6]),[4,P.call(this.connection)];case 1:return oe=We.sent(),fe=oe.data||{},le=fe.fileMaxSize,Ie=le===void 0?0:le,me=fe.partMinSize,Oe=me===void 0?p:me,je=fe.uuid,xe=je===void 0?"":je,ir=oe.extraInfo,Ne=ir.elapse,Ze=ir.httpCode,be=ir.url,this.partSize=Oe,this.uuid=xe,R.size=Oe,m.kg.debug("multipartInit success","uuid: ".concat(xe),"fileMaxSize: ".concat(Ie),"partMinSize: ".concat(Oe)),this.file.size>Ie?[4,this.multipartAbort()]:[3,3];case 2:return We.sent(),(Zt=(gt=this.options).onFileUploadError)===null||Zt===void 0||Zt.call(gt,{code:f.E.WEBIM_UPLOADFILE_ERROR,message:"The file size exceeds the maximum limit"}),[2];case 3:return this.rpt({data:{requestUrl:be,requestName:_.c.REST_INIT_UPLOAD_TASK_IN_PARTS,requestElapse:Ne,requestMethod:"POST",isSuccess:1,code:Ze}}),this.upload(),[3,6];case 4:return He=We.sent(),ae=He?.extraInfo||{},Ne=ae.elapse,Ze=ae.httpCode,ee=ae.errDesc,be=ae.url,this.rpt({data:{requestUrl:be,requestName:_.c.REST_INIT_UPLOAD_TASK_IN_PARTS,requestElapse:Ne,requestMethod:"POST",isSuccess:0,codeDesc:ee,code:Ze}}),[4,this.multipartAbort()];case 5:return We.sent(),(Wt=(Pt=this.options)===null||Pt===void 0?void 0:Pt.onInitFail)===null||Wt===void 0||Wt.call(Pt),[3,6];case 6:return[2]}})})},ft.prototype.upload=function(){var gt,Zt,Pt;return z(this,void 0,void 0,function(){var Wt,oe,fe,le,Ie,me,Oe=this;return S(this,function(je){switch(je.label){case 0:new FileReader().readAsArrayBuffer(this.file),Wt=this.file.size,oe=Math.ceil(Wt/this.partSize),je.label=1;case 1:je.trys.push([1,7,,9]),fe=function(xe){var ir,He,ae,Ne;return S(this,function(Ze){switch(Ze.label){case 0:return ir=xe*le.partSize,He=Math.min(Wt,ir+le.partSize),ae=(gt=le.file)===null||gt===void 0?void 0:gt.slice(ir,He),(Ne=k.call(le.connection,{uuid:le.uuid,partNumber:"".concat(xe+1),part:ae,onProgress:function(ee){Oe.handleUploadProgress(ee,xe)}})).then(function(ee){var be=ee?.extraInfo||{},We=be.elapse,Pe=be.httpCode,Ee=be.url;Oe.rpt({data:{requestUrl:Ee,requestName:_.c.REST_UPLOAD_PART,requestElapse:We,isSuccess:1,requestMethod:"PUT",code:Pe}}),Oe.handleTask(Ne)}),Ne.catch(function(ee){var be=ee?.extraInfo||{},We=be.elapse,Pe=be.httpCode,Ee=be.url,te=be.errDesc;Oe.rpt({data:{requestUrl:Ee,requestName:_.c.REST_UPLOAD_PART,requestElapse:We,isSuccess:0,requestMethod:"PUT",code:Pe,codeDesc:te}}),delete ee.extraInfo}),le.pool.push(Ne),le.pool.length!==4?[3,2]:[4,Promise.race(le.pool)];case 1:Ze.sent(),Ze.label=2;case 2:return[2]}})},le=this,Ie=0,je.label=2;case 2:return Ie<oe?[5,fe(Ie)]:[3,5];case 3:je.sent(),je.label=4;case 4:return Ie++,[3,2];case 5:return[4,Promise.all(this.pool)];case 6:return je.sent(),this.multipartComplete(),[3,9];case 7:return me=je.sent(),[4,this.multipartAbort()];case 8:return je.sent(),this.rpt({data:{isLastApi:1,isSuccess:0}}),(Pt=(Zt=this.options).onFileUploadError)===null||Pt===void 0||Pt.call(Zt,me),[3,9];case 9:return[2]}})})},ft.prototype.multipartComplete=function(){var gt,Zt,Pt,Wt;return z(this,void 0,void 0,function(){var oe,fe,le,Ie,me,Oe,je,xe,ir,He,ae;return S(this,function(Ne){switch(Ne.label){case 0:return Ne.trys.push([0,2,,3]),oe=this.options.thumbnailInfo||{},fe=oe.width,le=oe.height,[4,b.call(this.connection,{uuid:this.uuid,thumbnailHeight:le,thumbnailWidth:fe})];case 1:return Ie=Ne.sent(),me=Ie?.extraInfo||{},xe=me.elapse,ir=me.httpCode,ae=me.url,this.rpt({data:{requestUrl:ae,requestName:_.c.REST_COMPLETE_UPLOAD_PART,requestElapse:xe,requestMethod:"POST",isSuccess:1,code:ir}}),this.rpt({data:{isLastApi:1,isSuccess:1}}),(Zt=(gt=this.options).onFileUploadComplete)===null||Zt===void 0||Zt.call(gt,Ie),[3,3];case 2:return Oe=Ne.sent(),je=Oe?.extraInfo||{},xe=je.elapse,ir=je.httpCode,He=je.errDesc,ae=je.url,this.rpt({data:{requestUrl:ae,requestName:_.c.REST_COMPLETE_UPLOAD_PART,requestElapse:xe,requestMethod:"POST",isSuccess:0,codeDesc:He,code:ir}}),this.rpt({data:{isLastApi:1,isSuccess:0}}),(Wt=(Pt=this.options).onFileUploadError)===null||Wt===void 0||Wt.call(Pt,Oe),[3,3];case 3:return[2]}})})},ft.prototype.multipartAbort=function(){return z(this,void 0,void 0,function(){var gt,Zt,Pt,Wt,oe,fe,le,Ie;return S(this,function(me){switch(me.label){case 0:if(!this.uuid)return[2];me.label=1;case 1:return me.trys.push([1,3,,4]),[4,j.call(this.connection,{uuid:this.uuid})];case 2:return gt=me.sent(),Zt=gt?.extraInfo||{},oe=Zt.elapse,fe=Zt.httpCode,Ie=Zt.url,this.rpt({data:{requestUrl:Ie,requestName:_.c.REST_ABORT_UPLOAD_PART,requestElapse:oe,requestMethod:"DELETE",isSuccess:1,code:fe}}),[3,4];case 3:return Pt=me.sent(),Wt=Pt?.extraInfo||{},oe=Wt.elapse,fe=Wt.httpCode,le=Wt.errDesc,Ie=Wt.url,this.rpt({data:{requestUrl:Ie,requestName:_.c.REST_ABORT_UPLOAD_PART,requestElapse:oe,requestMethod:"DELETE",isSuccess:0,codeDesc:le,code:fe}}),[3,4];case 4:return[2]}})})},ft.prototype.handleTask=function(gt){var Zt=this.pool.findIndex(function(Pt){return Pt===gt});this.pool.splice(Zt,1)},ft}(),M=function(ft){var gt,Zt,Pt=this,Wt=new Date().getTime(),oe=ft.apiUrl,fe=ft.orgName,le=ft.appName,Ie=ft.operateName,me=ft.accessToken,Oe=ft.uploadUrl||"".concat(oe,"/").concat(fe,"/").concat(le,"/chatfiles"),je=function(He){var ae=new Date().getTime()-Wt;Pt.dataReport&&Ie&&[_.fI.UPLOAD_MSG_ATTACH,_.fI.UPLOAD_CHATROOM_FILE,_.fI.UPLOAD_GROUP_FILE].includes(Ie)&&Pt.dataReport.geOperateFun({operationName:Ie})({isEndApi:!0,data:{isSuccess:0,requestMethod:"POST",requestName:Ie,requestElapse:ae,requestUrl:Oe,code:xe?.status||0,codeDesc:"upload file error"}}),ft.onFileUploadError&&ft.onFileUploadError(He)},xe=new XMLHttpRequest;xe.upload&&((Zt=(gt=xe.upload).addEventListener)===null||Zt===void 0||Zt.call(gt,"progress",ft.onFileUploadProgress||U,!1)),xe.addEventListener("abort",ft.onFileUploadCanceled||U,!1),xe.addEventListener("error",function(He){je({type:f.E.WEBIM_UPLOADFILE_ERROR,data:xe})},!1),xe.addEventListener("load",function(He){try{var ae=JSON.parse(xe.responseText);if(xe.status===400)return je({type:f.E.WEBIM_UPLOADFILE_ERROR,data:ae}),!1;try{(function(Ne){var Ze=new Date().getTime()-Wt;Pt.dataReport&&Ie&&[_.fI.UPLOAD_MSG_ATTACH,_.fI.UPLOAD_CHATROOM_FILE,_.fI.UPLOAD_GROUP_FILE].includes(Ie)&&Pt.dataReport.geOperateFun({operationName:Ie})({isEndApi:!0,data:{isSuccess:Ne?.error?0:1,requestMethod:"POST",requestName:Ie,requestElapse:Ze,requestUrl:Oe,code:xe.status,codeDesc:Ne?.error_description||""}}),ft.onFileUploadComplete&&ft.onFileUploadComplete(Ne)})(ae)}catch(Ne){je({type:f.E.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:Ne})}}catch{je({type:f.E.WEBIM_UPLOADFILE_ERROR,data:xe.responseText})}},!1),xe.open("POST",Oe),xe.setRequestHeader("restrict-access","true"),xe.setRequestHeader("Accept","*/*"),xe.setRequestHeader("Authorization","Bearer "+me);var ir=new FormData;ir.append("file",ft.file.data),ft.thumbnailWidth&&ir.append("thumbnail-width",ft.thumbnailWidth+""),ft.thumbnailHeight&&ir.append("thumbnail-height",ft.thumbnailHeight+""),xe.send(ir)},Z=function(){return Z=Object.assign||function(ft){for(var gt,Zt=1,Pt=arguments.length;Zt<Pt;Zt++)for(var Wt in gt=arguments[Zt])Object.prototype.hasOwnProperty.call(gt,Wt)&&(ft[Wt]=gt[Wt]);return ft},Z.apply(this,arguments)},U=function(){};function Y(ft,gt){var Zt,Pt=this;return Ht().platform===mt.WEB?new Promise(function(Wt,oe){var fe=ft.dataType||"text",le=ft.success||U,Ie=ft.error||U,me=new XMLHttpRequest;me.ontimeout=function(){oe({type:f.E.REQUEST_TIMEOUT,message:"Request Timeout",errorType:"timeout_error",xhr:me})},me.onerror=function(){oe({type:f.E.REQUEST_UNKNOWN,message:"Request Unknow Error",errorType:"onerror",xhr:me})},me.onabort=function(){oe({type:f.E.REQUEST_ABORT,message:"Request Abort",errorType:"onabort",xhr:me})},me.onreadystatechange=function(){if(me.readyState===4){var Ne=new Date().getTime()-Zt,Ze=me.status||0,ee={elapse:Ne,httpCode:Ze};if(Ze===200){de.ajaxUnconventionalErrorTimes=0;try{switch(fe){case"text":return le(me.responseText),void Wt(me.responseText);case"json":var be=JSON.parse(me.responseText);return be.extraInfo=ee,le(be),void Wt(be);case"xml":return me.responseXML&&me.responseXML.documentElement?(le(me.responseXML.documentElement),void Wt(me.responseXML.documentElement)):(Ie({type:f.E.WEBIM_CONNCTION_AJAX_ERROR,data:me.responseText,message:"XHR.responseXML is null or XHR.responseXML.documentElement is null"}),void oe({type:f.E.WEBIM_CONNCTION_AJAX_ERROR,data:me.responseText,message:"XHR.responseXML is null or XHR.responseXML.documentElement is null"}));default:Ie({type:f.E.WEBIM_CONNCTION_AJAX_ERROR,data:me.responseText,message:"Invalid dataType"}),oe({type:f.E.WEBIM_CONNCTION_AJAX_ERROR,data:me.responseText,message:"Invalid dataType"})}return Wt(me.response||me.responseText),void le(me.response||me.responseText,me)}catch(We){oe(We)}return}[400,401,403,404,429,500,503].includes(Ze)||(m.kg.debug("rest api request fail status:",Ze),de.ajaxUnconventionalErrorTimes++),g(me,oe,Ie,Ne)}me.readyState===0&&(Ie({type:f.E.WEBIM_CONNCTION_AJAX_ERROR,data:me.responseText,message:"Request not initialized"}),oe({type:f.E.WEBIM_CONNCTION_AJAX_ERROR,data:me.responseText,message:"Request not initialized"}))},ft.responseType&&me.responseType&&(me.responseType=ft.responseType),ft.mimeType&&me.overrideMimeType(ft.mimeType);var Oe=ft.type||"POST",je=ft.data||null,xe="";if(Oe.toLowerCase()==="get"&&je){for(var ir in je)je.hasOwnProperty(ir)&&(xe+=ir+"="+je[ir]+"&");xe=xe&&xe.slice(0,-1),ft.url+=(ft.url.indexOf("?")>0?"&":"?")+(xe&&xe+"&")+"_v="+new Date().getTime(),je=null,xe=""}Zt=new Date().getTime(),me.open(Oe,ft.url);var He=ft.headers||{};for(var ae in He["Content-Type"]||(He["Content-Type"]="application/json"),He)He.hasOwnProperty(ae)&&me.setRequestHeader(ae,He[ae]);me.send(je)}).then(function(Wt){return Pt.dataReport&&gt&&gt!==_.fI.SDK_INTERNAL&&Pt.dataReport.geOperateFun({operationName:gt})({isEndApi:!0,data:Z({isSuccess:1,requestUrl:ft.url,requestName:gt,requestMethod:ft.type},zt(Wt.extraInfo))}),gt===_.fI.SDK_INTERNAL&&(Wt.extraInfo.url=ft.url),gt!==_.fI.SDK_INTERNAL&&delete Wt.extraInfo,q(Wt)==="Object"?Z(Z({},Wt),{type:f.E.REQUEST_SUCCESS}):{data:Wt,type:f.E.REQUEST_SUCCESS}}).catch(function(Wt){throw Pt.dataReport&&gt&&gt!==_.fI.SDK_INTERNAL&&Pt.dataReport.geOperateFun({operationName:gt})({isEndApi:!0,data:Z({isSuccess:0,requestUrl:ft.url,requestName:gt,requestMethod:ft.type},zt(Wt.extraInfo))}),gt===_.fI.SDK_INTERNAL&&(Wt.extraInfo.url=ft.url),gt!==_.fI.SDK_INTERNAL&&delete Wt.extraInfo,Wt}):V.call(this,ft,gt)}function q(ft){return Object.prototype.toString.call(ft).slice(8,-1)}function V(ft,gt){var Zt=this;return new Promise(function(Pt,Wt){var oe=ft.success||U,fe=ft.error||U,le=ft.type||"POST",Ie=ft.data||null,me="",Oe=new Date().getTime(),je=de.getEnvInfo();if(le.toLowerCase()==="get"&&Ie){for(var xe in Ie)Ie.hasOwnProperty(xe)&&(me+=xe+"="+Ie[xe]+"&");me=me&&me.slice(0,-1),ft.url+=(ft.url.indexOf("?")>0?"&":"?")+(me&&me+"&")+"_v="+new Date().getTime(),Ie=null,me=""}var ir={url:ft.url,data:ft.data,method:le,headers:{},success:function(He){var ae,Ne,Ze,ee,be,We={elapse:new Date().getTime()-Oe,httpCode:Number(((ae=He.statusCode)===null||ae===void 0?void 0:ae.toString())||((Ne=He.status)===null||Ne===void 0?void 0:Ne.toString())),errDesc:((Ze=He?.data)===null||Ze===void 0?void 0:Ze.error_description)||""};if(((ee=He.statusCode)===null||ee===void 0?void 0:ee.toString())==="200"||((be=He.status)===null||be===void 0?void 0:be.toString())==="200"){He.data.extraInfo=We;var Pe=He.data;oe(Pe),Pt(Pe)}else He.extraInfo=We,fe(Pe=He),Wt(Pe),m.kg.debug(gt,"reject reason: ",Pe)},complete:function(){},fail:function(He){var ae={elapse:new Date().getTime()-Oe,httpCode:E.Tp,errDesc:"request:fail"};He.extraInfo=ae,He.data={error:"request:fail",error_description:"request:fail"},fe(He),Wt(He),m.kg.debug(gt,"fail reason:",He)}};if(je.platform==="zfb"||je.platform==="dd"?ir.headers=ft.headers:ir.header=ft.headers,je.platform==="dd")return dd.httpRequest(ir);je.global.request(ir)}).then(function(Pt){return Zt.dataReport&&gt&&gt!==_.fI.SDK_INTERNAL&&Zt.dataReport.geOperateFun({operationName:gt})({isEndApi:!0,data:Z({isSuccess:1,requestUrl:ft.url,requestName:gt,requestMethod:ft.type},zt(Pt.extraInfo))}),gt!==_.fI.SDK_INTERNAL&&delete Pt.extraInfo,q(Pt)==="Object"?Z(Z({},Pt),{type:f.E.REQUEST_SUCCESS}):{data:Pt,type:f.E.REQUEST_SUCCESS}}).catch(function(Pt){throw Zt.dataReport&&gt&&gt!==_.fI.SDK_INTERNAL&&Zt.dataReport.geOperateFun({operationName:gt})({isEndApi:!0,data:Z({isSuccess:0,requestUrl:ft.url,requestName:gt,requestMethod:ft.type},zt(Pt.extraInfo))}),gt!==_.fI.SDK_INTERNAL&&delete Pt.extraInfo,Pt})}function it(ft,gt){var Zt;return function(){for(var Pt=[],Wt=0;Wt<arguments.length;Wt++)Pt[Wt]=arguments[Wt];if(!ft)return Zt;Zt=ft.apply(void 0,Pt),ft=null}}var mt,wt=it(function(ft,gt){var Zt=Ht();if(Zt.platform!==mt.WEB){var Pt=Zt.global,Wt=function(oe){oe.isConnected?ft():gt()};Pt.offNetworkStatusChange&&Pt.offNetworkStatusChange(Wt),Pt.onNetworkStatusChange&&Pt.onNetworkStatusChange(Wt)}else typeof addEventListener<"u"&&(window.addEventListener("online",ft),window.addEventListener("offline",gt))}),yt=it(function(ft,gt){var Zt,Pt,Wt=Ht();if(Wt.platform===mt.WEB)document&&document.addEventListener("visibilitychange",function(){document.hidden?gt?.():ft?.()},!1);else{var oe=Wt.global;oe.onAppShow&&((Zt=oe.onAppShow)===null||Zt===void 0||Zt.call(oe,ft)),oe.onAppHide&&((Pt=oe.onAppHide)===null||Pt===void 0||Pt.call(oe,gt))}});function Ht(){return typeof swan<"u"&&Yt(swan)?{platform:mt.BAIDU,global:swan}:typeof tt<"u"&&Yt(tt)?{platform:mt.TT,global:tt}:typeof dd<"u"&&Yt(dd)?{platform:mt.DD,global:dd}:typeof my<"u"&&Yt(my)?{platform:mt.ZFB,global:my}:typeof wx<"u"&&Yt(wx)?{platform:mt.WX,global:wx}:typeof qq<"u"&&Yt(qq)?{platform:mt.QQ,global:qq}:typeof uni<"u"&&Yt(uni)?{platform:mt.UNI,global:uni}:typeof window<"u"&&window.WebSocket?{platform:mt.WEB,global:window}:{platform:mt.NODE,global:a.g||{}}}function Yt(ft){for(var gt=["canIUse","getSystemInfo"],Zt=0,Pt=gt.length;Zt<Pt;Zt++)if(!ft[gt[Zt]])return!1;return!0}function At(ft,gt){var Zt,Pt,Wt,oe=this,fe=ft.accessToken,le=ft.appKey,Ie=(Pt=(Zt=ft?.file)===null||Zt===void 0?void 0:Zt.data)===null||Pt===void 0?void 0:Pt.size,me=[],Oe="",je="";if(fe)if(le&&(me=le.split("#"),Oe=me[0],je=me[1]),Oe||je)if(Ie<=0)ft.onFileUploadError&&ft.onFileUploadError({type:f.E.WEBIM_UPLOADFILE_ERROR,message:"fileSize must be greater than 0"});else if(ft.uploadUrl)M.call(this,Z(Z({},ft),{orgName:Oe,appName:je,operateName:gt}));else{var xe=R.size||A;this.uploadPartEnable&&Ie>1.5*xe?new F(this,{file:(Wt=ft?.file)===null||Wt===void 0?void 0:Wt.data,onFileUploadProgress:ft.onFileUploadProgress||U,onFileUploadComplete:ft.onFileUploadComplete||U,onFileUploadError:ft.onFileUploadError||U,onFileUploadCanceled:ft.onFileUploadCanceled||U,onInitFail:function(){M.call(oe,Z(Z({},ft),{orgName:Oe,appName:je,operateName:gt}))},thumbnailInfo:{width:ft.thumbnailWidth,height:ft.thumbnailHeight}}):M.call(this,Z(Z({},ft),{orgName:Oe,appName:je,operateName:gt}))}else ft.onFileUploadError&&ft.onFileUploadError({type:f.E.WEBIM_UPLOADFILE_ERROR,message:"AppKey illegal"});else ft.onFileUploadError&&ft.onFileUploadError({type:f.E.WEBIM_UPLOADFILE_NO_LOGIN,message:"AccessToken cannot be empty"})}function Lt(ft,gt){ft.onFileDownloadComplete=ft.onFileDownloadComplete||U,ft.onFileDownloadError=ft.onFileDownloadError||U;var Zt=new Date().getTime(),Pt=new XMLHttpRequest,Wt=this;Pt.addEventListener("load",function(je){var xe=new Date().getTime()-Zt;Wt.dataReport&&gt&&gt===_.fI.DOWN_GROUP_FILE&&Wt.dataReport.geOperateFun({operationName:gt})({isEndApi:!0,data:{isSuccess:Pt.status===200?1:0,requestMethod:"POST",requestName:gt,requestElapse:xe,requestUrl:ft?.url,code:Pt.status,codeDesc:Pt.status===200?"":"download file error"}}),ft.onFileDownloadComplete&&ft.onFileDownloadComplete(Pt.response)},!1),Pt.addEventListener("error",function(je){var xe=new Date().getTime()-Zt;Wt.dataReport&&gt&&gt===_.fI.DOWN_GROUP_FILE&&Wt.dataReport.geOperateFun({operationName:gt})({isEndApi:!0,data:{isSuccess:0,requestMethod:"POST",requestName:gt,requestElapse:xe,requestUrl:ft?.url,code:Pt?.status||0,codeDesc:"download file error"}}),ft.onFileDownloadError&&ft.onFileDownloadError({type:f.E.WEBIM_DOWNLOADFILE_ERROR,id:ft.id,xhr:Pt})},!1);var oe=ft.method||"GET",fe=ft.responseType||"blob",le=ft.mimeType||"text/plain; charset=x-user-defined";Pt.open(oe,ft.url),typeof Blob<"u"?Pt.responseType=fe:Pt.overrideMimeType(le);var Ie={"X-Requested-With":"XMLHttpRequest",Accept:"application/octet-stream","share-secret":ft.secret,Authorization:"Bearer "+this.context.accessToken},me=ft.headers||{};for(var Oe in me)Ie[Oe]=me[Oe];for(var Oe in Ie)Ie[Oe]&&Pt.setRequestHeader(Oe,Ie[Oe]);Pt.send(null)}function zt(ft){ft===void 0&&(ft={});var gt=ft.elapse,Zt=gt===void 0?0:gt,Pt=ft.httpCode,Wt=Pt===void 0?0:Pt,oe=ft.errDesc;return{requestElapse:Zt,code:Wt,codeDesc:oe===void 0?"":oe}}(function(ft){ft.WEB="web",ft.WX="wx",ft.QQ="qq",ft.ZFB="zfb",ft.DD="dd",ft.TT="tt",ft.BAIDU="baidu",ft.QUICK_APP="quick_app",ft.UNI="uni",ft.NODE="node"})(mt||(mt={}));var re="localDeviceInfo",de={autoIncrement:0,ajaxUnconventionalErrorTimes:0,ajax:Y,getUniqueId:function(){this.autoIncrement?this.autoIncrement++:this.autoIncrement=1;var ft=new Date,gt=new Date(2010,1,1);return(ft.getTime()-gt.getTime()+this.autoIncrement).toString()},getFileUrl:function(ft){var gt={url:"",filename:"",filetype:"",data:{}},Zt=typeof ft=="string"?document.getElementById(ft):ft;if(window.URL.createObjectURL){if(!Zt.files)throw Error("this is not HTMLInputElement");var Pt=Zt.files;if(Pt.length>0){var Wt=Pt.item(0);gt.data=Wt,gt.url=window.URL.createObjectURL(Wt),gt.filename=Wt?.name||""}}else{if(typeof ft!="string")throw Error("in IE fileInputId must be string");Wt=document.getElementById(ft).value,gt.url=Wt;var oe=Wt.lastIndexOf("/"),fe=Wt.lastIndexOf("\\"),le=Math.max(oe,fe);gt.filename=le<0?Wt:Wt.substring(le+1)}var Ie=gt.filename.lastIndexOf(".");return Ie!==-1&&(gt.filetype=gt.filename.substring(Ie+1).toLowerCase()),gt},uploadFile:At,flow:function(ft){for(var gt=ft.length,Zt=gt;Zt--;)if(typeof ft[Zt]!="function")throw new TypeError("Expected a function");return function(){for(var Pt=[],Wt=0;Wt<arguments.length;Wt++)Pt[Wt]=arguments[Wt];for(var oe=0,fe=gt?ft[oe].apply(this,Pt):Pt[0];++oe<gt;)fe=ft[oe].call(this,fe);return fe}},listenNetwork:wt,listenBrowserVisibility:yt,getEnvInfo:Ht,wxRequest:V,parseDownloadResponse:function(ft){if(!window||!window.URL)throw Error("parseDownloadResponse can be used in broswer only");return ft&&ft.type&&ft.type==="application/json"||0>Object.prototype.toString.call(ft).indexOf("Blob")?this.url+"?token=":window.URL.createObjectURL(ft)},download:Lt,parseNotify:function(ft){for(var gt="",Zt=0;Zt<ft.length;Zt++)gt+="%"+ft[Zt].toString(16);return JSON.parse(decodeURIComponent(gt))},getExtraData:zt,retryPromise:function(ft,gt,Zt){return new Promise(function(Pt,Wt){(function oe(fe){ft().then(Pt).catch(function(le){fe>0?setTimeout(function(){oe(fe-1)},Zt||1e3):Wt(le)})})(gt||3)})},formatAttachUrl:function(ft){return ft&&typeof ft=="string"?"".concat(this.apiUrl).concat(ft.substr(ft.indexOf("/",9))):""},Uint8ArrayToString:function(ft){for(var gt="",Zt=0;Zt<ft.length;Zt++)gt+=String.fromCharCode(ft[Zt]);return gt},getLocalDeviceInfo:function(){return function(ft){var gt,Zt=de.getEnvInfo(),Pt=Zt.platform,Wt="";Pt!==mt.NODE&&Pt!==mt.QUICK_APP||(Wt="");try{Pt===mt.WEB?Wt=localStorage.getItem(ft)||"":Pt===mt.WX||Pt===mt.QQ||Pt===mt.TT||Pt===mt.BAIDU||Pt===mt.UNI?Wt=Zt.global.getStorageSync(ft)||"":Pt!==mt.ZFB&&Pt!==mt.DD||(Wt=((gt=Zt.global.getStorageSync({key:ft}))===null||gt===void 0?void 0:gt.data)||"")}catch(oe){m.kg.debug("get local ".concat(ft," failed: "),oe)}return m.kg.debug("".concat(ft," "),Wt),Wt}(re)},setLocalDeviceInfo:function(ft){var gt,Zt,Pt,Wt;gt=re,Zt=ft,(Wt=(Pt=de.getEnvInfo()).platform)!==mt.NODE&&Wt!==mt.QUICK_APP&&(Wt===mt.WEB?localStorage.setItem(gt,Zt):Pt.global.setStorage({key:gt,data:Zt,success:function(oe){m.kg.debug("set local ".concat(gt," success: "),oe)},fail:function(oe){m.kg.error("set local ".concat(gt," failed: "),oe)}}))},detectBrowser:function(){if(typeof navigator>"u")return"unknown";var ft=navigator.userAgent;return/MicroMessenger/i.test(ft)?"WeChat":/QQBrowser/i.test(ft)?"QQ":!/Chrome/i.test(ft)||/Edg/i.test(ft)||/OPR/i.test(ft)?!/Safari/i.test(ft)||/Chrome/i.test(ft)||/CriOS/i.test(ft)?/Firefox/i.test(ft)?"Firefox":/MSIE/i.test(ft)||/Trident/i.test(ft)?"IE":/Edg/i.test(ft)?"Edge":"unknown":"Safari":"Chrome"},getDevicePlatform:function(ft){return ft.platform===mt.WX&&typeof uni<"u"&&Yt(uni)?mt.UNI:ft.platform},delay:function(ft){return new Promise(function(gt){return setTimeout(gt,ft)})}}},9662:function(O,H,a){var f=a(614),h=a(6330),g=TypeError;O.exports=function(_){if(f(_))return _;throw g(h(_)+" is not a function")}},9483:function(O,H,a){var f=a(4411),h=a(6330),g=TypeError;O.exports=function(_){if(f(_))return _;throw g(h(_)+" is not a constructor")}},6077:function(O,H,a){var f=a(614),h=String,g=TypeError;O.exports=function(_){if(typeof _=="object"||f(_))return _;throw g("Can't set "+h(_)+" as a prototype")}},1223:function(O,H,a){var f=a(5112),h=a(30),g=a(3070).f,_=f("unscopables"),E=Array.prototype;E[_]==null&&g(E,_,{configurable:!0,value:h(null)}),O.exports=function(m){E[_][m]=!0}},1530:function(O,H,a){var f=a(8710).charAt;O.exports=function(h,g,_){return g+(_?f(h,g).length:1)}},5787:function(O,H,a){var f=a(7976),h=TypeError;O.exports=function(g,_){if(f(_,g))return g;throw h("Incorrect invocation")}},9670:function(O,H,a){var f=a(111),h=String,g=TypeError;O.exports=function(_){if(f(_))return _;throw g(h(_)+" is not an object")}},3013:function(O){O.exports=typeof ArrayBuffer<"u"&&typeof DataView<"u"},7556:function(O,H,a){var f=a(7293);O.exports=f(function(){if(typeof ArrayBuffer=="function"){var h=new ArrayBuffer(8);Object.isExtensible(h)&&Object.defineProperty(h,"a",{value:8})}})},260:function(O,H,a){var f,h,g,_=a(3013),E=a(9781),m=a(7854),p=a(614),A=a(111),R=a(2597),D=a(648),P=a(6330),k=a(8880),b=a(8052),j=a(7045),z=a(7976),S=a(9518),F=a(7674),M=a(5112),Z=a(9711),U=a(9909),Y=U.enforce,q=U.get,V=m.Int8Array,it=V&&V.prototype,mt=m.Uint8ClampedArray,wt=mt&&mt.prototype,yt=V&&S(V),Ht=it&&S(it),Yt=Object.prototype,At=m.TypeError,Lt=M("toStringTag"),zt=Z("TYPED_ARRAY_TAG"),re="TypedArrayConstructor",de=_&&!!F&&D(m.opera)!=="Opera",ft=!1,gt={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Zt={BigInt64Array:8,BigUint64Array:8},Pt=function(oe){var fe=S(oe);if(A(fe)){var le=q(fe);return le&&R(le,re)?le[re]:Pt(fe)}},Wt=function(oe){if(!A(oe))return!1;var fe=D(oe);return R(gt,fe)||R(Zt,fe)};for(f in gt)(g=(h=m[f])&&h.prototype)?Y(g)[re]=h:de=!1;for(f in Zt)(g=(h=m[f])&&h.prototype)&&(Y(g)[re]=h);if((!de||!p(yt)||yt===Function.prototype)&&(yt=function(){throw At("Incorrect invocation")},de))for(f in gt)m[f]&&F(m[f],yt);if((!de||!Ht||Ht===Yt)&&(Ht=yt.prototype,de))for(f in gt)m[f]&&F(m[f].prototype,Ht);if(de&&S(wt)!==Ht&&F(wt,Ht),E&&!R(Ht,Lt))for(f in ft=!0,j(Ht,Lt,{configurable:!0,get:function(){return A(this)?this[zt]:void 0}}),gt)m[f]&&k(m[f],zt,f);O.exports={NATIVE_ARRAY_BUFFER_VIEWS:de,TYPED_ARRAY_TAG:ft&&zt,aTypedArray:function(oe){if(Wt(oe))return oe;throw At("Target is not a typed array")},aTypedArrayConstructor:function(oe){if(p(oe)&&(!F||z(yt,oe)))return oe;throw At(P(oe)+" is not a typed array constructor")},exportTypedArrayMethod:function(oe,fe,le,Ie){if(E){if(le)for(var me in gt){var Oe=m[me];if(Oe&&R(Oe.prototype,oe))try{delete Oe.prototype[oe]}catch{try{Oe.prototype[oe]=fe}catch{}}}Ht[oe]&&!le||b(Ht,oe,le?fe:de&&it[oe]||fe,Ie)}},exportTypedArrayStaticMethod:function(oe,fe,le){var Ie,me;if(E){if(F){if(le){for(Ie in gt)if((me=m[Ie])&&R(me,oe))try{delete me[oe]}catch{}}if(yt[oe]&&!le)return;try{return b(yt,oe,le?fe:de&&yt[oe]||fe)}catch{}}for(Ie in gt)!(me=m[Ie])||me[oe]&&!le||b(me,oe,fe)}},getTypedArrayConstructor:Pt,isView:function(oe){if(!A(oe))return!1;var fe=D(oe);return fe==="DataView"||R(gt,fe)||R(Zt,fe)},isTypedArray:Wt,TypedArray:yt,TypedArrayPrototype:Ht}},3331:function(O,H,a){var f=a(7854),h=a(1702),g=a(9781),_=a(3013),E=a(6530),m=a(8880),p=a(7045),A=a(9190),R=a(7293),D=a(5787),P=a(9303),k=a(7466),b=a(7067),j=a(1179),z=a(9518),S=a(7674),F=a(8006).f,M=a(1285),Z=a(1589),U=a(8003),Y=a(9909),q=E.PROPER,V=E.CONFIGURABLE,it="ArrayBuffer",mt="DataView",wt="prototype",yt="Wrong index",Ht=Y.getterFor(it),Yt=Y.getterFor(mt),At=Y.set,Lt=f[it],zt=Lt,re=zt&&zt[wt],de=f[mt],ft=de&&de[wt],gt=Object.prototype,Zt=f.Array,Pt=f.RangeError,Wt=h(M),oe=h([].reverse),fe=j.pack,le=j.unpack,Ie=function(te){return[255&te]},me=function(te){return[255&te,te>>8&255]},Oe=function(te){return[255&te,te>>8&255,te>>16&255,te>>24&255]},je=function(te){return te[3]<<24|te[2]<<16|te[1]<<8|te[0]},xe=function(te){return fe(te,23,4)},ir=function(te){return fe(te,52,8)},He=function(te,Ae,Xe){p(te[wt],Ae,{configurable:!0,get:function(){return Xe(this)[Ae]}})},ae=function(te,Ae,Xe,Be){var ze=b(Xe),ot=Yt(te);if(ze+Ae>ot.byteLength)throw Pt(yt);var Et=ot.bytes,nt=ze+ot.byteOffset,Dt=Z(Et,nt,nt+Ae);return Be?Dt:oe(Dt)},Ne=function(te,Ae,Xe,Be,ze,ot){var Et=b(Xe),nt=Yt(te);if(Et+Ae>nt.byteLength)throw Pt(yt);for(var Dt=nt.bytes,B=Et+nt.byteOffset,Ft=Be(+ze),St=0;St<Ae;St++)Dt[B+St]=Ft[ot?St:Ae-St-1]};if(_){var Ze=q&&Lt.name!==it;if(R(function(){Lt(1)})&&R(function(){new Lt(-1)})&&!R(function(){return new Lt,new Lt(1.5),new Lt(NaN),Lt.length!=1||Ze&&!V}))Ze&&V&&m(Lt,"name",it);else{(zt=function(te){return D(this,re),new Lt(b(te))})[wt]=re;for(var ee,be=F(Lt),We=0;be.length>We;)(ee=be[We++])in zt||m(zt,ee,Lt[ee]);re.constructor=zt}S&&z(ft)!==gt&&S(ft,gt);var Pe=new de(new zt(2)),Ee=h(ft.setInt8);Pe.setInt8(0,2147483648),Pe.setInt8(1,2147483649),!Pe.getInt8(0)&&Pe.getInt8(1)||A(ft,{setInt8:function(te,Ae){Ee(this,te,Ae<<24>>24)},setUint8:function(te,Ae){Ee(this,te,Ae<<24>>24)}},{unsafe:!0})}else re=(zt=function(te){D(this,re);var Ae=b(te);At(this,{type:it,bytes:Wt(Zt(Ae),0),byteLength:Ae}),g||(this.byteLength=Ae,this.detached=!1)})[wt],ft=(de=function(te,Ae,Xe){D(this,ft),D(te,re);var Be=Ht(te),ze=Be.byteLength,ot=P(Ae);if(ot<0||ot>ze)throw Pt("Wrong offset");if(ot+(Xe=Xe===void 0?ze-ot:k(Xe))>ze)throw Pt("Wrong length");At(this,{type:mt,buffer:te,byteLength:Xe,byteOffset:ot,bytes:Be.bytes}),g||(this.buffer=te,this.byteLength=Xe,this.byteOffset=ot)})[wt],g&&(He(zt,"byteLength",Ht),He(de,"buffer",Yt),He(de,"byteLength",Yt),He(de,"byteOffset",Yt)),A(ft,{getInt8:function(te){return ae(this,1,te)[0]<<24>>24},getUint8:function(te){return ae(this,1,te)[0]},getInt16:function(te){var Ae=ae(this,2,te,arguments.length>1?arguments[1]:void 0);return(Ae[1]<<8|Ae[0])<<16>>16},getUint16:function(te){var Ae=ae(this,2,te,arguments.length>1?arguments[1]:void 0);return Ae[1]<<8|Ae[0]},getInt32:function(te){return je(ae(this,4,te,arguments.length>1?arguments[1]:void 0))},getUint32:function(te){return je(ae(this,4,te,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(te){return le(ae(this,4,te,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(te){return le(ae(this,8,te,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(te,Ae){Ne(this,1,te,Ie,Ae)},setUint8:function(te,Ae){Ne(this,1,te,Ie,Ae)},setInt16:function(te,Ae){Ne(this,2,te,me,Ae,arguments.length>2?arguments[2]:void 0)},setUint16:function(te,Ae){Ne(this,2,te,me,Ae,arguments.length>2?arguments[2]:void 0)},setInt32:function(te,Ae){Ne(this,4,te,Oe,Ae,arguments.length>2?arguments[2]:void 0)},setUint32:function(te,Ae){Ne(this,4,te,Oe,Ae,arguments.length>2?arguments[2]:void 0)},setFloat32:function(te,Ae){Ne(this,4,te,xe,Ae,arguments.length>2?arguments[2]:void 0)},setFloat64:function(te,Ae){Ne(this,8,te,ir,Ae,arguments.length>2?arguments[2]:void 0)}});U(zt,it),U(de,mt),O.exports={ArrayBuffer:zt,DataView:de}},1048:function(O,H,a){var f=a(7908),h=a(1400),g=a(6244),_=a(5117),E=Math.min;O.exports=[].copyWithin||function(m,p){var A=f(this),R=g(A),D=h(m,R),P=h(p,R),k=arguments.length>2?arguments[2]:void 0,b=E((k===void 0?R:h(k,R))-P,R-D),j=1;for(P<D&&D<P+b&&(j=-1,P+=b-1,D+=b-1);b-- >0;)P in A?A[D]=A[P]:_(A,D),D+=j,P+=j;return A}},1285:function(O,H,a){var f=a(7908),h=a(1400),g=a(6244);O.exports=function(_){for(var E=f(this),m=g(E),p=arguments.length,A=h(p>1?arguments[1]:void 0,m),R=p>2?arguments[2]:void 0,D=R===void 0?m:h(R,m);D>A;)E[A++]=_;return E}},8533:function(O,H,a){var f=a(2092).forEach,h=a(9341)("forEach");O.exports=h?[].forEach:function(g){return f(this,g,arguments.length>1?arguments[1]:void 0)}},7745:function(O,H,a){var f=a(6244);O.exports=function(h,g){for(var _=0,E=f(g),m=new h(E);E>_;)m[_]=g[_++];return m}},8457:function(O,H,a){var f=a(9974),h=a(6916),g=a(7908),_=a(3411),E=a(7659),m=a(4411),p=a(6244),A=a(6135),R=a(4121),D=a(1246),P=Array;O.exports=function(k){var b=g(k),j=m(this),z=arguments.length,S=z>1?arguments[1]:void 0,F=S!==void 0;F&&(S=f(S,z>2?arguments[2]:void 0));var M,Z,U,Y,q,V,it=D(b),mt=0;if(!it||this===P&&E(it))for(M=p(b),Z=j?new this(M):P(M);M>mt;mt++)V=F?S(b[mt],mt):b[mt],A(Z,mt,V);else for(q=(Y=R(b,it)).next,Z=j?new this:[];!(U=h(q,Y)).done;mt++)V=F?_(Y,S,[U.value,mt],!0):U.value,A(Z,mt,V);return Z.length=mt,Z}},1318:function(O,H,a){var f=a(5656),h=a(1400),g=a(6244),_=function(E){return function(m,p,A){var R,D=f(m),P=g(D),k=h(A,P);if(E&&p!=p){for(;P>k;)if((R=D[k++])!=R)return!0}else for(;P>k;k++)if((E||k in D)&&D[k]===p)return E||k||0;return!E&&-1}};O.exports={includes:_(!0),indexOf:_(!1)}},2092:function(O,H,a){var f=a(9974),h=a(1702),g=a(8361),_=a(7908),E=a(6244),m=a(5417),p=h([].push),A=function(R){var D=R==1,P=R==2,k=R==3,b=R==4,j=R==6,z=R==7,S=R==5||j;return function(F,M,Z,U){for(var Y,q,V=_(F),it=g(V),mt=f(M,Z),wt=E(it),yt=0,Ht=U||m,Yt=D?Ht(F,wt):P||z?Ht(F,0):void 0;wt>yt;yt++)if((S||yt in it)&&(q=mt(Y=it[yt],yt,V),R))if(D)Yt[yt]=q;else if(q)switch(R){case 3:return!0;case 5:return Y;case 6:return yt;case 2:p(Yt,Y)}else switch(R){case 4:return!1;case 7:p(Yt,Y)}return j?-1:k||b?b:Yt}};O.exports={forEach:A(0),map:A(1),filter:A(2),some:A(3),every:A(4),find:A(5),findIndex:A(6),filterReject:A(7)}},6583:function(O,H,a){var f=a(2104),h=a(5656),g=a(9303),_=a(6244),E=a(9341),m=Math.min,p=[].lastIndexOf,A=!!p&&1/[1].lastIndexOf(1,-0)<0,R=E("lastIndexOf"),D=A||!R;O.exports=D?function(P){if(A)return f(p,this,arguments)||0;var k=h(this),b=_(k),j=b-1;for(arguments.length>1&&(j=m(j,g(arguments[1]))),j<0&&(j=b+j);j>=0;j--)if(j in k&&k[j]===P)return j||0;return-1}:p},1194:function(O,H,a){var f=a(7293),h=a(5112),g=a(7392),_=h("species");O.exports=function(E){return g>=51||!f(function(){var m=[];return(m.constructor={})[_]=function(){return{foo:1}},m[E](Boolean).foo!==1})}},9341:function(O,H,a){var f=a(7293);O.exports=function(h,g){var _=[][h];return!!_&&f(function(){_.call(null,g||function(){return 1},1)})}},3671:function(O,H,a){var f=a(9662),h=a(7908),g=a(8361),_=a(6244),E=TypeError,m=function(p){return function(A,R,D,P){f(R);var k=h(A),b=g(k),j=_(k),z=p?j-1:0,S=p?-1:1;if(D<2)for(;;){if(z in b){P=b[z],z+=S;break}if(z+=S,p?z<0:j<=z)throw E("Reduce of empty array with no initial value")}for(;p?z>=0:j>z;z+=S)z in b&&(P=R(P,b[z],z,k));return P}};O.exports={left:m(!1),right:m(!0)}},3658:function(O,H,a){var f=a(9781),h=a(3157),g=TypeError,_=Object.getOwnPropertyDescriptor,E=f&&!function(){if(this!==void 0)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(m){return m instanceof TypeError}}();O.exports=E?function(m,p){if(h(m)&&!_(m,"length").writable)throw g("Cannot set read only .length");return m.length=p}:function(m,p){return m.length=p}},1589:function(O,H,a){var f=a(1400),h=a(6244),g=a(6135),_=Array,E=Math.max;O.exports=function(m,p,A){for(var R=h(m),D=f(p,R),P=f(A===void 0?R:A,R),k=_(E(P-D,0)),b=0;D<P;D++,b++)g(k,b,m[D]);return k.length=b,k}},206:function(O,H,a){var f=a(1702);O.exports=f([].slice)},4362:function(O,H,a){var f=a(1589),h=Math.floor,g=function(m,p){var A=m.length,R=h(A/2);return A<8?_(m,p):E(m,g(f(m,0,R),p),g(f(m,R),p),p)},_=function(m,p){for(var A,R,D=m.length,P=1;P<D;){for(R=P,A=m[P];R&&p(m[R-1],A)>0;)m[R]=m[--R];R!==P++&&(m[R]=A)}return m},E=function(m,p,A,R){for(var D=p.length,P=A.length,k=0,b=0;k<D||b<P;)m[k+b]=k<D&&b<P?R(p[k],A[b])<=0?p[k++]:A[b++]:k<D?p[k++]:A[b++];return m};O.exports=g},7475:function(O,H,a){var f=a(3157),h=a(4411),g=a(111),_=a(5112)("species"),E=Array;O.exports=function(m){var p;return f(m)&&(p=m.constructor,(h(p)&&(p===E||f(p.prototype))||g(p)&&(p=p[_])===null)&&(p=void 0)),p===void 0?E:p}},5417:function(O,H,a){var f=a(7475);O.exports=function(h,g){return new(f(h))(g===0?0:g)}},3411:function(O,H,a){var f=a(9670),h=a(9212);O.exports=function(g,_,E,m){try{return m?_(f(E)[0],E[1]):_(E)}catch(p){h(g,"throw",p)}}},7072:function(O,H,a){var f=a(5112)("iterator"),h=!1;try{var g=0,_={next:function(){return{done:!!g++}},return:function(){h=!0}};_[f]=function(){return this},Array.from(_,function(){throw 2})}catch{}O.exports=function(E,m){if(!m&&!h)return!1;var p=!1;try{var A={};A[f]=function(){return{next:function(){return{done:p=!0}}}},E(A)}catch{}return p}},4326:function(O,H,a){var f=a(1702),h=f({}.toString),g=f("".slice);O.exports=function(_){return g(h(_),8,-1)}},648:function(O,H,a){var f=a(1694),h=a(614),g=a(4326),_=a(5112)("toStringTag"),E=Object,m=g(function(){return arguments}())=="Arguments";O.exports=f?g:function(p){var A,R,D;return p===void 0?"Undefined":p===null?"Null":typeof(R=function(P,k){try{return P[k]}catch{}}(A=E(p),_))=="string"?R:m?g(A):(D=g(A))=="Object"&&h(A.callee)?"Arguments":D}},5631:function(O,H,a){var f=a(30),h=a(7045),g=a(9190),_=a(9974),E=a(5787),m=a(8554),p=a(408),A=a(1656),R=a(6178),D=a(6340),P=a(9781),k=a(2423).fastKey,b=a(9909),j=b.set,z=b.getterFor;O.exports={getConstructor:function(S,F,M,Z){var U=S(function(mt,wt){E(mt,Y),j(mt,{type:F,index:f(null),first:void 0,last:void 0,size:0}),P||(mt.size=0),m(wt)||p(wt,mt[Z],{that:mt,AS_ENTRIES:M})}),Y=U.prototype,q=z(F),V=function(mt,wt,yt){var Ht,Yt,At=q(mt),Lt=it(mt,wt);return Lt?Lt.value=yt:(At.last=Lt={index:Yt=k(wt,!0),key:wt,value:yt,previous:Ht=At.last,next:void 0,removed:!1},At.first||(At.first=Lt),Ht&&(Ht.next=Lt),P?At.size++:mt.size++,Yt!=="F"&&(At.index[Yt]=Lt)),mt},it=function(mt,wt){var yt,Ht=q(mt),Yt=k(wt);if(Yt!=="F")return Ht.index[Yt];for(yt=Ht.first;yt;yt=yt.next)if(yt.key==wt)return yt};return g(Y,{clear:function(){for(var mt=q(this),wt=mt.index,yt=mt.first;yt;)yt.removed=!0,yt.previous&&(yt.previous=yt.previous.next=void 0),delete wt[yt.index],yt=yt.next;mt.first=mt.last=void 0,P?mt.size=0:this.size=0},delete:function(mt){var wt=this,yt=q(wt),Ht=it(wt,mt);if(Ht){var Yt=Ht.next,At=Ht.previous;delete yt.index[Ht.index],Ht.removed=!0,At&&(At.next=Yt),Yt&&(Yt.previous=At),yt.first==Ht&&(yt.first=Yt),yt.last==Ht&&(yt.last=At),P?yt.size--:wt.size--}return!!Ht},forEach:function(mt){for(var wt,yt=q(this),Ht=_(mt,arguments.length>1?arguments[1]:void 0);wt=wt?wt.next:yt.first;)for(Ht(wt.value,wt.key,this);wt&&wt.removed;)wt=wt.previous},has:function(mt){return!!it(this,mt)}}),g(Y,M?{get:function(mt){var wt=it(this,mt);return wt&&wt.value},set:function(mt,wt){return V(this,mt===0?0:mt,wt)}}:{add:function(mt){return V(this,mt=mt===0?0:mt,mt)}}),P&&h(Y,"size",{configurable:!0,get:function(){return q(this).size}}),U},setStrong:function(S,F,M){var Z=F+" Iterator",U=z(F),Y=z(Z);A(S,F,function(q,V){j(this,{type:Z,target:q,state:U(q),kind:V,last:void 0})},function(){for(var q=Y(this),V=q.kind,it=q.last;it&&it.removed;)it=it.previous;return q.target&&(q.last=it=it?it.next:q.state.first)?R(V=="keys"?it.key:V=="values"?it.value:[it.key,it.value],!1):(q.target=void 0,R(void 0,!0))},M?"entries":"values",!M,!0),D(F)}}},7710:function(O,H,a){var f=a(2109),h=a(7854),g=a(1702),_=a(4705),E=a(8052),m=a(2423),p=a(408),A=a(5787),R=a(614),D=a(8554),P=a(111),k=a(7293),b=a(7072),j=a(8003),z=a(9587);O.exports=function(S,F,M){var Z=S.indexOf("Map")!==-1,U=S.indexOf("Weak")!==-1,Y=Z?"set":"add",q=h[S],V=q&&q.prototype,it=q,mt={},wt=function(zt){var re=g(V[zt]);E(V,zt,zt=="add"?function(de){return re(this,de===0?0:de),this}:zt=="delete"?function(de){return!(U&&!P(de))&&re(this,de===0?0:de)}:zt=="get"?function(de){return U&&!P(de)?void 0:re(this,de===0?0:de)}:zt=="has"?function(de){return!(U&&!P(de))&&re(this,de===0?0:de)}:function(de,ft){return re(this,de===0?0:de,ft),this})};if(_(S,!R(q)||!(U||V.forEach&&!k(function(){new q().entries().next()}))))it=M.getConstructor(F,S,Z,Y),m.enable();else if(_(S,!0)){var yt=new it,Ht=yt[Y](U?{}:-0,1)!=yt,Yt=k(function(){yt.has(1)}),At=b(function(zt){new q(zt)}),Lt=!U&&k(function(){for(var zt=new q,re=5;re--;)zt[Y](re,re);return!zt.has(-0)});At||((it=F(function(zt,re){A(zt,V);var de=z(new q,zt,it);return D(re)||p(re,de[Y],{that:de,AS_ENTRIES:Z}),de})).prototype=V,V.constructor=it),(Yt||Lt)&&(wt("delete"),wt("has"),Z&&wt("get")),(Lt||Ht)&&wt(Y),U&&V.clear&&delete V.clear}return mt[S]=it,f({global:!0,constructor:!0,forced:it!=q},mt),j(it,S),U||M.setStrong(it,S,Z),it}},9920:function(O,H,a){var f=a(2597),h=a(3887),g=a(1236),_=a(3070);O.exports=function(E,m,p){for(var A=h(m),R=_.f,D=g.f,P=0;P<A.length;P++){var k=A[P];f(E,k)||p&&f(p,k)||R(E,k,D(m,k))}}},4964:function(O,H,a){var f=a(5112)("match");O.exports=function(h){var g=/./;try{"/./"[h](g)}catch{try{return g[f]=!1,"/./"[h](g)}catch{}}return!1}},8544:function(O,H,a){var f=a(7293);O.exports=!f(function(){function h(){}return h.prototype.constructor=null,Object.getPrototypeOf(new h)!==h.prototype})},6178:function(O){O.exports=function(H,a){return{value:H,done:a}}},8880:function(O,H,a){var f=a(9781),h=a(3070),g=a(9114);O.exports=f?function(_,E,m){return h.f(_,E,g(1,m))}:function(_,E,m){return _[E]=m,_}},9114:function(O){O.exports=function(H,a){return{enumerable:!(1&H),configurable:!(2&H),writable:!(4&H),value:a}}},6135:function(O,H,a){var f=a(4948),h=a(3070),g=a(9114);O.exports=function(_,E,m){var p=f(E);p in _?h.f(_,p,g(0,m)):_[p]=m}},7045:function(O,H,a){var f=a(6339),h=a(3070);O.exports=function(g,_,E){return E.get&&f(E.get,_,{getter:!0}),E.set&&f(E.set,_,{setter:!0}),h.f(g,_,E)}},8052:function(O,H,a){var f=a(614),h=a(3070),g=a(6339),_=a(3072);O.exports=function(E,m,p,A){A||(A={});var R=A.enumerable,D=A.name!==void 0?A.name:m;if(f(p)&&g(p,D,A),A.global)R?E[m]=p:_(m,p);else{try{A.unsafe?E[m]&&(R=!0):delete E[m]}catch{}R?E[m]=p:h.f(E,m,{value:p,enumerable:!1,configurable:!A.nonConfigurable,writable:!A.nonWritable})}return E}},9190:function(O,H,a){var f=a(8052);O.exports=function(h,g,_){for(var E in g)f(h,E,g[E],_);return h}},3072:function(O,H,a){var f=a(7854),h=Object.defineProperty;O.exports=function(g,_){try{h(f,g,{value:_,configurable:!0,writable:!0})}catch{f[g]=_}return _}},5117:function(O,H,a){var f=a(6330),h=TypeError;O.exports=function(g,_){if(!delete g[_])throw h("Cannot delete property "+f(_)+" of "+f(g))}},9781:function(O,H,a){var f=a(7293);O.exports=!f(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7})},4154:function(O){var H=typeof document=="object"&&document.all,a=H===void 0&&H!==void 0;O.exports={all:H,IS_HTMLDDA:a}},317:function(O,H,a){var f=a(7854),h=a(111),g=f.document,_=h(g)&&h(g.createElement);O.exports=function(E){return _?g.createElement(E):{}}},7207:function(O){var H=TypeError;O.exports=function(a){if(a>9007199254740991)throw H("Maximum allowed index exceeded");return a}},8324:function(O){O.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},8509:function(O,H,a){var f=a(317)("span").classList,h=f&&f.constructor&&f.constructor.prototype;O.exports=h===Object.prototype?void 0:h},8886:function(O,H,a){var f=a(8113).match(/firefox\/(\d+)/i);O.exports=!!f&&+f[1]},7871:function(O,H,a){var f=a(3823),h=a(5268);O.exports=!f&&!h&&typeof window=="object"&&typeof document=="object"},9363:function(O){O.exports=typeof Bun=="function"&&Bun&&typeof Bun.version=="string"},3823:function(O){O.exports=typeof Deno=="object"&&Deno&&typeof Deno.version=="object"},256:function(O,H,a){var f=a(8113);O.exports=/MSIE|Trident/.test(f)},1528:function(O,H,a){var f=a(8113);O.exports=/ipad|iphone|ipod/i.test(f)&&typeof Pebble<"u"},6833:function(O,H,a){var f=a(8113);O.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(f)},5268:function(O,H,a){var f=a(4326);O.exports=typeof Xf<"u"&&f(Xf)=="process"},1036:function(O,H,a){var f=a(8113);O.exports=/web0s(?!.*chrome)/i.test(f)},8113:function(O){O.exports=typeof navigator<"u"&&String(navigator.userAgent)||""},7392:function(O,H,a){var f,h,g=a(7854),_=a(8113),E=g.process,m=g.Deno,p=E&&E.versions||m&&m.version,A=p&&p.v8;A&&(h=(f=A.split("."))[0]>0&&f[0]<4?1:+(f[0]+f[1])),!h&&_&&(!(f=_.match(/Edge\/(\d+)/))||f[1]>=74)&&(f=_.match(/Chrome\/(\d+)/))&&(h=+f[1]),O.exports=h},8008:function(O,H,a){var f=a(8113).match(/AppleWebKit\/(\d+)\./);O.exports=!!f&&+f[1]},748:function(O){O.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},2109:function(O,H,a){var f=a(7854),h=a(1236).f,g=a(8880),_=a(8052),E=a(3072),m=a(9920),p=a(4705);O.exports=function(A,R){var D,P,k,b,j,z=A.target,S=A.global,F=A.stat;if(D=S?f:F?f[z]||E(z,{}):(f[z]||{}).prototype)for(P in R){if(b=R[P],k=A.dontCallGetSet?(j=h(D,P))&&j.value:D[P],!p(S?P:z+(F?".":"#")+P,A.forced)&&k!==void 0){if(typeof b==typeof k)continue;m(b,k)}(A.sham||k&&k.sham)&&g(b,"sham",!0),_(D,P,b,A)}}},7293:function(O){O.exports=function(H){try{return!!H()}catch{return!0}}},7007:function(O,H,a){a(4916);var f=a(1470),h=a(8052),g=a(2261),_=a(7293),E=a(5112),m=a(8880),p=E("species"),A=RegExp.prototype;O.exports=function(R,D,P,k){var b=E(R),j=!_(function(){var M={};return M[b]=function(){return 7},""[R](M)!=7}),z=j&&!_(function(){var M=!1,Z=/a/;return R==="split"&&((Z={}).constructor={},Z.constructor[p]=function(){return Z},Z.flags="",Z[b]=/./[b]),Z.exec=function(){return M=!0,null},Z[b](""),!M});if(!j||!z||P){var S=f(/./[b]),F=D(b,""[R],function(M,Z,U,Y,q){var V=f(M),it=Z.exec;return it===g||it===A.exec?j&&!q?{done:!0,value:S(Z,U,Y)}:{done:!0,value:V(U,Z,Y)}:{done:!1}});h(String.prototype,R,F[0]),h(A,b,F[1])}k&&m(A[b],"sham",!0)}},6677:function(O,H,a){var f=a(7293);O.exports=!f(function(){return Object.isExtensible(Object.preventExtensions({}))})},2104:function(O,H,a){var f=a(4374),h=Function.prototype,g=h.apply,_=h.call;O.exports=typeof Reflect=="object"&&Reflect.apply||(f?_.bind(g):function(){return _.apply(g,arguments)})},9974:function(O,H,a){var f=a(1470),h=a(9662),g=a(4374),_=f(f.bind);O.exports=function(E,m){return h(E),m===void 0?E:g?_(E,m):function(){return E.apply(m,arguments)}}},4374:function(O,H,a){var f=a(7293);O.exports=!f(function(){var h=function(){}.bind();return typeof h!="function"||h.hasOwnProperty("prototype")})},7065:function(O,H,a){var f=a(1702),h=a(9662),g=a(111),_=a(2597),E=a(206),m=a(4374),p=Function,A=f([].concat),R=f([].join),D={};O.exports=m?p.bind:function(P){var k=h(this),b=k.prototype,j=E(arguments,1),z=function(){var S=A(j,E(arguments));return this instanceof z?function(F,M,Z){if(!_(D,M)){for(var U=[],Y=0;Y<M;Y++)U[Y]="a["+Y+"]";D[M]=p("C,a","return new C("+R(U,",")+")")}return D[M](F,Z)}(k,S.length,S):k.apply(P,S)};return g(b)&&(z.prototype=b),z}},6916:function(O,H,a){var f=a(4374),h=Function.prototype.call;O.exports=f?h.bind(h):function(){return h.apply(h,arguments)}},6530:function(O,H,a){var f=a(9781),h=a(2597),g=Function.prototype,_=f&&Object.getOwnPropertyDescriptor,E=h(g,"name"),m=E&&function(){}.name==="something",p=E&&(!f||f&&_(g,"name").configurable);O.exports={EXISTS:E,PROPER:m,CONFIGURABLE:p}},5668:function(O,H,a){var f=a(1702),h=a(9662);O.exports=function(g,_,E){try{return f(h(Object.getOwnPropertyDescriptor(g,_)[E]))}catch{}}},1470:function(O,H,a){var f=a(4326),h=a(1702);O.exports=function(g){if(f(g)==="Function")return h(g)}},1702:function(O,H,a){var f=a(4374),h=Function.prototype,g=h.call,_=f&&h.bind.bind(g,g);O.exports=f?_:function(E){return function(){return g.apply(E,arguments)}}},5005:function(O,H,a){var f=a(7854),h=a(614);O.exports=function(g,_){return arguments.length<2?(E=f[g],h(E)?E:void 0):f[g]&&f[g][_];var E}},1246:function(O,H,a){var f=a(648),h=a(8173),g=a(8554),_=a(7497),E=a(5112)("iterator");O.exports=function(m){if(!g(m))return h(m,E)||h(m,"@@iterator")||_[f(m)]}},4121:function(O,H,a){var f=a(6916),h=a(9662),g=a(9670),_=a(6330),E=a(1246),m=TypeError;O.exports=function(p,A){var R=arguments.length<2?E(p):A;if(h(R))return g(f(R,p));throw m(_(p)+" is not iterable")}},8044:function(O,H,a){var f=a(1702),h=a(3157),g=a(614),_=a(4326),E=a(1340),m=f([].push);O.exports=function(p){if(g(p))return p;if(h(p)){for(var A=p.length,R=[],D=0;D<A;D++){var P=p[D];typeof P=="string"?m(R,P):typeof P!="number"&&_(P)!="Number"&&_(P)!="String"||m(R,E(P))}var k=R.length,b=!0;return function(j,z){if(b)return b=!1,z;if(h(this))return z;for(var S=0;S<k;S++)if(R[S]===j)return z}}}},8173:function(O,H,a){var f=a(9662),h=a(8554);O.exports=function(g,_){var E=g[_];return h(E)?void 0:f(E)}},7854:function(O,H,a){var f=function(h){return h&&h.Math==Math&&h};O.exports=f(typeof globalThis=="object"&&globalThis)||f(typeof window=="object"&&window)||f(typeof self=="object"&&self)||f(typeof a.g=="object"&&a.g)||function(){return this}()||this||Function("return this")()},2597:function(O,H,a){var f=a(1702),h=a(7908),g=f({}.hasOwnProperty);O.exports=Object.hasOwn||function(_,E){return g(h(_),E)}},3501:function(O){O.exports={}},842:function(O){O.exports=function(H,a){try{arguments.length==1?console.error(H):console.error(H,a)}catch{}}},490:function(O,H,a){var f=a(5005);O.exports=f("document","documentElement")},4664:function(O,H,a){var f=a(9781),h=a(7293),g=a(317);O.exports=!f&&!h(function(){return Object.defineProperty(g("div"),"a",{get:function(){return 7}}).a!=7})},1179:function(O){var H=Array,a=Math.abs,f=Math.pow,h=Math.floor,g=Math.log,_=Math.LN2;O.exports={pack:function(E,m,p){var A,R,D,P=H(p),k=8*p-m-1,b=(1<<k)-1,j=b>>1,z=m===23?f(2,-24)-f(2,-77):0,S=E<0||E===0&&1/E<0?1:0,F=0;for((E=a(E))!=E||E===1/0?(R=E!=E?1:0,A=b):(A=h(g(E)/_),E*(D=f(2,-A))<1&&(A--,D*=2),(E+=A+j>=1?z/D:z*f(2,1-j))*D>=2&&(A++,D/=2),A+j>=b?(R=0,A=b):A+j>=1?(R=(E*D-1)*f(2,m),A+=j):(R=E*f(2,j-1)*f(2,m),A=0));m>=8;)P[F++]=255&R,R/=256,m-=8;for(A=A<<m|R,k+=m;k>0;)P[F++]=255&A,A/=256,k-=8;return P[--F]|=128*S,P},unpack:function(E,m){var p,A=E.length,R=8*A-m-1,D=(1<<R)-1,P=D>>1,k=R-7,b=A-1,j=E[b--],z=127&j;for(j>>=7;k>0;)z=256*z+E[b--],k-=8;for(p=z&(1<<-k)-1,z>>=-k,k+=m;k>0;)p=256*p+E[b--],k-=8;if(z===0)z=1-P;else{if(z===D)return p?NaN:j?-1/0:1/0;p+=f(2,m),z-=P}return(j?-1:1)*p*f(2,z-m)}}},8361:function(O,H,a){var f=a(1702),h=a(7293),g=a(4326),_=Object,E=f("".split);O.exports=h(function(){return!_("z").propertyIsEnumerable(0)})?function(m){return g(m)=="String"?E(m,""):_(m)}:_},9587:function(O,H,a){var f=a(614),h=a(111),g=a(7674);O.exports=function(_,E,m){var p,A;return g&&f(p=E.constructor)&&p!==m&&h(A=p.prototype)&&A!==m.prototype&&g(_,A),_}},2788:function(O,H,a){var f=a(1702),h=a(614),g=a(5465),_=f(Function.toString);h(g.inspectSource)||(g.inspectSource=function(E){return _(E)}),O.exports=g.inspectSource},2423:function(O,H,a){var f=a(2109),h=a(1702),g=a(3501),_=a(111),E=a(2597),m=a(3070).f,p=a(8006),A=a(1156),R=a(2050),D=a(9711),P=a(6677),k=!1,b=D("meta"),j=0,z=function(F){m(F,b,{value:{objectID:"O"+j++,weakData:{}}})},S=O.exports={enable:function(){S.enable=function(){},k=!0;var F=p.f,M=h([].splice),Z={};Z[b]=1,F(Z).length&&(p.f=function(U){for(var Y=F(U),q=0,V=Y.length;q<V;q++)if(Y[q]===b){M(Y,q,1);break}return Y},f({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:A.f}))},fastKey:function(F,M){if(!_(F))return typeof F=="symbol"?F:(typeof F=="string"?"S":"P")+F;if(!E(F,b)){if(!R(F))return"F";if(!M)return"E";z(F)}return F[b].objectID},getWeakData:function(F,M){if(!E(F,b)){if(!R(F))return!0;if(!M)return!1;z(F)}return F[b].weakData},onFreeze:function(F){return P&&k&&R(F)&&!E(F,b)&&z(F),F}};g[b]=!0},9909:function(O,H,a){var f,h,g,_=a(4811),E=a(7854),m=a(111),p=a(8880),A=a(2597),R=a(5465),D=a(6200),P=a(3501),k="Object already initialized",b=E.TypeError,j=E.WeakMap;if(_||R.state){var z=R.state||(R.state=new j);z.get=z.get,z.has=z.has,z.set=z.set,f=function(F,M){if(z.has(F))throw b(k);return M.facade=F,z.set(F,M),M},h=function(F){return z.get(F)||{}},g=function(F){return z.has(F)}}else{var S=D("state");P[S]=!0,f=function(F,M){if(A(F,S))throw b(k);return M.facade=F,p(F,S,M),M},h=function(F){return A(F,S)?F[S]:{}},g=function(F){return A(F,S)}}O.exports={set:f,get:h,has:g,enforce:function(F){return g(F)?h(F):f(F,{})},getterFor:function(F){return function(M){var Z;if(!m(M)||(Z=h(M)).type!==F)throw b("Incompatible receiver, "+F+" required");return Z}}}},7659:function(O,H,a){var f=a(5112),h=a(7497),g=f("iterator"),_=Array.prototype;O.exports=function(E){return E!==void 0&&(h.Array===E||_[g]===E)}},3157:function(O,H,a){var f=a(4326);O.exports=Array.isArray||function(h){return f(h)=="Array"}},4067:function(O,H,a){var f=a(648);O.exports=function(h){var g=f(h);return g=="BigInt64Array"||g=="BigUint64Array"}},614:function(O,H,a){var f=a(4154),h=f.all;O.exports=f.IS_HTMLDDA?function(g){return typeof g=="function"||g===h}:function(g){return typeof g=="function"}},4411:function(O,H,a){var f=a(1702),h=a(7293),g=a(614),_=a(648),E=a(5005),m=a(2788),p=function(){},A=[],R=E("Reflect","construct"),D=/^\s*(?:class|function)\b/,P=f(D.exec),k=!D.exec(p),b=function(z){if(!g(z))return!1;try{return R(p,A,z),!0}catch{return!1}},j=function(z){if(!g(z))return!1;switch(_(z)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return k||!!P(D,m(z))}catch{return!0}};j.sham=!0,O.exports=!R||h(function(){var z;return b(b.call)||!b(Object)||!b(function(){z=!0})||z})?j:b},4705:function(O,H,a){var f=a(7293),h=a(614),g=/#|\.prototype\./,_=function(R,D){var P=m[E(R)];return P==A||P!=p&&(h(D)?f(D):!!D)},E=_.normalize=function(R){return String(R).replace(g,".").toLowerCase()},m=_.data={},p=_.NATIVE="N",A=_.POLYFILL="P";O.exports=_},5988:function(O,H,a){var f=a(111),h=Math.floor;O.exports=Number.isInteger||function(g){return!f(g)&&isFinite(g)&&h(g)===g}},8554:function(O){O.exports=function(H){return H==null}},111:function(O,H,a){var f=a(614),h=a(4154),g=h.all;O.exports=h.IS_HTMLDDA?function(_){return typeof _=="object"?_!==null:f(_)||_===g}:function(_){return typeof _=="object"?_!==null:f(_)}},1913:function(O){O.exports=!1},7850:function(O,H,a){var f=a(111),h=a(4326),g=a(5112)("match");O.exports=function(_){var E;return f(_)&&((E=_[g])!==void 0?!!E:h(_)=="RegExp")}},2190:function(O,H,a){var f=a(5005),h=a(614),g=a(7976),_=a(3307),E=Object;O.exports=_?function(m){return typeof m=="symbol"}:function(m){var p=f("Symbol");return h(p)&&g(p.prototype,E(m))}},408:function(O,H,a){var f=a(9974),h=a(6916),g=a(9670),_=a(6330),E=a(7659),m=a(6244),p=a(7976),A=a(4121),R=a(1246),D=a(9212),P=TypeError,k=function(j,z){this.stopped=j,this.result=z},b=k.prototype;O.exports=function(j,z,S){var F,M,Z,U,Y,q,V,it=S&&S.that,mt=!(!S||!S.AS_ENTRIES),wt=!(!S||!S.IS_RECORD),yt=!(!S||!S.IS_ITERATOR),Ht=!(!S||!S.INTERRUPTED),Yt=f(z,it),At=function(zt){return F&&D(F,"normal",zt),new k(!0,zt)},Lt=function(zt){return mt?(g(zt),Ht?Yt(zt[0],zt[1],At):Yt(zt[0],zt[1])):Ht?Yt(zt,At):Yt(zt)};if(wt)F=j.iterator;else if(yt)F=j;else{if(!(M=R(j)))throw P(_(j)+" is not iterable");if(E(M)){for(Z=0,U=m(j);U>Z;Z++)if((Y=Lt(j[Z]))&&p(b,Y))return Y;return new k(!1)}F=A(j,M)}for(q=wt?j.next:F.next;!(V=h(q,F)).done;){try{Y=Lt(V.value)}catch(zt){D(F,"throw",zt)}if(typeof Y=="object"&&Y&&p(b,Y))return Y}return new k(!1)}},9212:function(O,H,a){var f=a(6916),h=a(9670),g=a(8173);O.exports=function(_,E,m){var p,A;h(_);try{if(!(p=g(_,"return"))){if(E==="throw")throw m;return m}p=f(p,_)}catch(R){A=!0,p=R}if(E==="throw")throw m;if(A)throw p;return h(p),m}},3061:function(O,H,a){var f=a(3383).IteratorPrototype,h=a(30),g=a(9114),_=a(8003),E=a(7497),m=function(){return this};O.exports=function(p,A,R,D){var P=A+" Iterator";return p.prototype=h(f,{next:g(+!D,R)}),_(p,P,!1,!0),E[P]=m,p}},1656:function(O,H,a){var f=a(2109),h=a(6916),g=a(1913),_=a(6530),E=a(614),m=a(3061),p=a(9518),A=a(7674),R=a(8003),D=a(8880),P=a(8052),k=a(5112),b=a(7497),j=a(3383),z=_.PROPER,S=_.CONFIGURABLE,F=j.IteratorPrototype,M=j.BUGGY_SAFARI_ITERATORS,Z=k("iterator"),U="keys",Y="values",q="entries",V=function(){return this};O.exports=function(it,mt,wt,yt,Ht,Yt,At){m(wt,mt,yt);var Lt,zt,re,de=function(fe){if(fe===Ht&&Wt)return Wt;if(!M&&fe in Zt)return Zt[fe];switch(fe){case U:case Y:case q:return function(){return new wt(this,fe)}}return function(){return new wt(this)}},ft=mt+" Iterator",gt=!1,Zt=it.prototype,Pt=Zt[Z]||Zt["@@iterator"]||Ht&&Zt[Ht],Wt=!M&&Pt||de(Ht),oe=mt=="Array"&&Zt.entries||Pt;if(oe&&(Lt=p(oe.call(new it)))!==Object.prototype&&Lt.next&&(g||p(Lt)===F||(A?A(Lt,F):E(Lt[Z])||P(Lt,Z,V)),R(Lt,ft,!0,!0),g&&(b[ft]=V)),z&&Ht==Y&&Pt&&Pt.name!==Y&&(!g&&S?D(Zt,"name",Y):(gt=!0,Wt=function(){return h(Pt,this)})),Ht)if(zt={values:de(Y),keys:Yt?Wt:de(U),entries:de(q)},At)for(re in zt)(M||gt||!(re in Zt))&&P(Zt,re,zt[re]);else f({target:mt,proto:!0,forced:M||gt},zt);return g&&!At||Zt[Z]===Wt||P(Zt,Z,Wt,{name:Ht}),b[mt]=Wt,zt}},3383:function(O,H,a){var f,h,g,_=a(7293),E=a(614),m=a(111),p=a(30),A=a(9518),R=a(8052),D=a(5112),P=a(1913),k=D("iterator"),b=!1;[].keys&&("next"in(g=[].keys())?(h=A(A(g)))!==Object.prototype&&(f=h):b=!0),!m(f)||_(function(){var j={};return f[k].call(j)!==j})?f={}:P&&(f=p(f)),E(f[k])||R(f,k,function(){return this}),O.exports={IteratorPrototype:f,BUGGY_SAFARI_ITERATORS:b}},7497:function(O){O.exports={}},6244:function(O,H,a){var f=a(7466);O.exports=function(h){return f(h.length)}},6339:function(O,H,a){var f=a(1702),h=a(7293),g=a(614),_=a(2597),E=a(9781),m=a(6530).CONFIGURABLE,p=a(2788),A=a(9909),R=A.enforce,D=A.get,P=String,k=Object.defineProperty,b=f("".slice),j=f("".replace),z=f([].join),S=E&&!h(function(){return k(function(){},"length",{value:8}).length!==8}),F=String(String).split("String"),M=O.exports=function(Z,U,Y){b(P(U),0,7)==="Symbol("&&(U="["+j(P(U),/^Symbol\(([^)]*)\)/,"$1")+"]"),Y&&Y.getter&&(U="get "+U),Y&&Y.setter&&(U="set "+U),(!_(Z,"name")||m&&Z.name!==U)&&(E?k(Z,"name",{value:U,configurable:!0}):Z.name=U),S&&Y&&_(Y,"arity")&&Z.length!==Y.arity&&k(Z,"length",{value:Y.arity});try{Y&&_(Y,"constructor")&&Y.constructor?E&&k(Z,"prototype",{writable:!1}):Z.prototype&&(Z.prototype=void 0)}catch{}var q=R(Z);return _(q,"source")||(q.source=z(F,typeof U=="string"?U:"")),Z};Function.prototype.toString=M(function(){return g(this)&&D(this).source||p(this)},"toString")},4758:function(O){var H=Math.ceil,a=Math.floor;O.exports=Math.trunc||function(f){var h=+f;return(h>0?a:H)(h)}},5948:function(O,H,a){var f,h,g,_,E,m=a(7854),p=a(9974),A=a(1236).f,R=a(261).set,D=a(8572),P=a(6833),k=a(1528),b=a(1036),j=a(5268),z=m.MutationObserver||m.WebKitMutationObserver,S=m.document,F=m.process,M=m.Promise,Z=A(m,"queueMicrotask"),U=Z&&Z.value;if(!U){var Y=new D,q=function(){var V,it;for(j&&(V=F.domain)&&V.exit();it=Y.get();)try{it()}catch(mt){throw Y.head&&f(),mt}V&&V.enter()};P||j||b||!z||!S?!k&&M&&M.resolve?((_=M.resolve(void 0)).constructor=M,E=p(_.then,_),f=function(){E(q)}):j?f=function(){F.nextTick(q)}:(R=p(R,m),f=function(){R(q)}):(h=!0,g=S.createTextNode(""),new z(q).observe(g,{characterData:!0}),f=function(){g.data=h=!h}),U=function(V){Y.head||f(),Y.add(V)}}O.exports=U},8523:function(O,H,a){var f=a(9662),h=TypeError,g=function(_){var E,m;this.promise=new _(function(p,A){if(E!==void 0||m!==void 0)throw h("Bad Promise constructor");E=p,m=A}),this.resolve=f(E),this.reject=f(m)};O.exports.f=function(_){return new g(_)}},3929:function(O,H,a){var f=a(7850),h=TypeError;O.exports=function(g){if(f(g))throw h("The method doesn't accept regular expressions");return g}},1574:function(O,H,a){var f=a(9781),h=a(1702),g=a(6916),_=a(7293),E=a(1956),m=a(5181),p=a(5296),A=a(7908),R=a(8361),D=Object.assign,P=Object.defineProperty,k=h([].concat);O.exports=!D||_(function(){if(f&&D({b:1},D(P({},"a",{enumerable:!0,get:function(){P(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var b={},j={},z=Symbol(),S="abcdefghijklmnopqrst";return b[z]=7,S.split("").forEach(function(F){j[F]=F}),D({},b)[z]!=7||E(D({},j)).join("")!=S})?function(b,j){for(var z=A(b),S=arguments.length,F=1,M=m.f,Z=p.f;S>F;)for(var U,Y=R(arguments[F++]),q=M?k(E(Y),M(Y)):E(Y),V=q.length,it=0;V>it;)U=q[it++],f&&!g(Z,Y,U)||(z[U]=Y[U]);return z}:D},30:function(O,H,a){var f,h=a(9670),g=a(6048),_=a(748),E=a(3501),m=a(490),p=a(317),A=a(6200),R="prototype",D="script",P=A("IE_PROTO"),k=function(){},b=function(S){return"<"+D+">"+S+"</"+D+">"},j=function(S){S.write(b("")),S.close();var F=S.parentWindow.Object;return S=null,F},z=function(){try{f=new ActiveXObject("htmlfile")}catch{}var S,F,M;z=typeof document<"u"?document.domain&&f?j(f):(F=p("iframe"),M="java"+D+":",F.style.display="none",m.appendChild(F),F.src=String(M),(S=F.contentWindow.document).open(),S.write(b("document.F=Object")),S.close(),S.F):j(f);for(var Z=_.length;Z--;)delete z[R][_[Z]];return z()};E[P]=!0,O.exports=Object.create||function(S,F){var M;return S!==null?(k[R]=h(S),M=new k,k[R]=null,M[P]=S):M=z(),F===void 0?M:g.f(M,F)}},6048:function(O,H,a){var f=a(9781),h=a(3353),g=a(3070),_=a(9670),E=a(5656),m=a(1956);H.f=f&&!h?Object.defineProperties:function(p,A){_(p);for(var R,D=E(A),P=m(A),k=P.length,b=0;k>b;)g.f(p,R=P[b++],D[R]);return p}},3070:function(O,H,a){var f=a(9781),h=a(4664),g=a(3353),_=a(9670),E=a(4948),m=TypeError,p=Object.defineProperty,A=Object.getOwnPropertyDescriptor,R="enumerable",D="configurable",P="writable";H.f=f?g?function(k,b,j){if(_(k),b=E(b),_(j),typeof k=="function"&&b==="prototype"&&"value"in j&&P in j&&!j[P]){var z=A(k,b);z&&z[P]&&(k[b]=j.value,j={configurable:D in j?j[D]:z[D],enumerable:R in j?j[R]:z[R],writable:!1})}return p(k,b,j)}:p:function(k,b,j){if(_(k),b=E(b),_(j),h)try{return p(k,b,j)}catch{}if("get"in j||"set"in j)throw m("Accessors not supported");return"value"in j&&(k[b]=j.value),k}},1236:function(O,H,a){var f=a(9781),h=a(6916),g=a(5296),_=a(9114),E=a(5656),m=a(4948),p=a(2597),A=a(4664),R=Object.getOwnPropertyDescriptor;H.f=f?R:function(D,P){if(D=E(D),P=m(P),A)try{return R(D,P)}catch{}if(p(D,P))return _(!h(g.f,D,P),D[P])}},1156:function(O,H,a){var f=a(4326),h=a(5656),g=a(8006).f,_=a(1589),E=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];O.exports.f=function(m){return E&&f(m)=="Window"?function(p){try{return g(p)}catch{return _(E)}}(m):g(h(m))}},8006:function(O,H,a){var f=a(6324),h=a(748).concat("length","prototype");H.f=Object.getOwnPropertyNames||function(g){return f(g,h)}},5181:function(O,H){H.f=Object.getOwnPropertySymbols},9518:function(O,H,a){var f=a(2597),h=a(614),g=a(7908),_=a(6200),E=a(8544),m=_("IE_PROTO"),p=Object,A=p.prototype;O.exports=E?p.getPrototypeOf:function(R){var D=g(R);if(f(D,m))return D[m];var P=D.constructor;return h(P)&&D instanceof P?P.prototype:D instanceof p?A:null}},2050:function(O,H,a){var f=a(7293),h=a(111),g=a(4326),_=a(7556),E=Object.isExtensible,m=f(function(){});O.exports=m||_?function(p){return!!h(p)&&(!_||g(p)!="ArrayBuffer")&&(!E||E(p))}:E},7976:function(O,H,a){var f=a(1702);O.exports=f({}.isPrototypeOf)},6324:function(O,H,a){var f=a(1702),h=a(2597),g=a(5656),_=a(1318).indexOf,E=a(3501),m=f([].push);O.exports=function(p,A){var R,D=g(p),P=0,k=[];for(R in D)!h(E,R)&&h(D,R)&&m(k,R);for(;A.length>P;)h(D,R=A[P++])&&(~_(k,R)||m(k,R));return k}},1956:function(O,H,a){var f=a(6324),h=a(748);O.exports=Object.keys||function(g){return f(g,h)}},5296:function(O,H){var a={}.propertyIsEnumerable,f=Object.getOwnPropertyDescriptor,h=f&&!a.call({1:2},1);H.f=h?function(g){var _=f(this,g);return!!_&&_.enumerable}:a},7674:function(O,H,a){var f=a(5668),h=a(9670),g=a(6077);O.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var _,E=!1,m={};try{(_=f(Object.prototype,"__proto__","set"))(m,[]),E=m instanceof Array}catch{}return function(p,A){return h(p),g(A),E?_(p,A):p.__proto__=A,p}}():void 0)},4699:function(O,H,a){var f=a(9781),h=a(1702),g=a(1956),_=a(5656),E=h(a(5296).f),m=h([].push),p=function(A){return function(R){for(var D,P=_(R),k=g(P),b=k.length,j=0,z=[];b>j;)D=k[j++],f&&!E(P,D)||m(z,A?[D,P[D]]:P[D]);return z}};O.exports={entries:p(!0),values:p(!1)}},288:function(O,H,a){var f=a(1694),h=a(648);O.exports=f?{}.toString:function(){return"[object "+h(this)+"]"}},2140:function(O,H,a){var f=a(6916),h=a(614),g=a(111),_=TypeError;O.exports=function(E,m){var p,A;if(m==="string"&&h(p=E.toString)&&!g(A=f(p,E))||h(p=E.valueOf)&&!g(A=f(p,E))||m!=="string"&&h(p=E.toString)&&!g(A=f(p,E)))return A;throw _("Can't convert object to primitive value")}},3887:function(O,H,a){var f=a(5005),h=a(1702),g=a(8006),_=a(5181),E=a(9670),m=h([].concat);O.exports=f("Reflect","ownKeys")||function(p){var A=g.f(E(p)),R=_.f;return R?m(A,R(p)):A}},857:function(O,H,a){var f=a(7854);O.exports=f},2534:function(O){O.exports=function(H){try{return{error:!1,value:H()}}catch(a){return{error:!0,value:a}}}},3702:function(O,H,a){var f=a(7854),h=a(2492),g=a(614),_=a(4705),E=a(2788),m=a(5112),p=a(7871),A=a(3823),R=a(1913),D=a(7392),P=h&&h.prototype,k=m("species"),b=!1,j=g(f.PromiseRejectionEvent),z=_("Promise",function(){var S=E(h),F=S!==String(h);if(!F&&D===66||R&&(!P.catch||!P.finally))return!0;if(!D||D<51||!/native code/.test(S)){var M=new h(function(U){U(1)}),Z=function(U){U(function(){},function(){})};if((M.constructor={})[k]=Z,!(b=M.then(function(){})instanceof Z))return!0}return!F&&(p||A)&&!j});O.exports={CONSTRUCTOR:z,REJECTION_EVENT:j,SUBCLASSING:b}},2492:function(O,H,a){var f=a(7854);O.exports=f.Promise},9478:function(O,H,a){var f=a(9670),h=a(111),g=a(8523);O.exports=function(_,E){if(f(_),h(E)&&E.constructor===_)return E;var m=g.f(_);return(0,m.resolve)(E),m.promise}},612:function(O,H,a){var f=a(2492),h=a(7072),g=a(3702).CONSTRUCTOR;O.exports=g||!h(function(_){f.all(_).then(void 0,function(){})})},8572:function(O){var H=function(){this.head=null,this.tail=null};H.prototype={add:function(a){var f={item:a,next:null},h=this.tail;h?h.next=f:this.head=f,this.tail=f},get:function(){var a=this.head;if(a)return(this.head=a.next)===null&&(this.tail=null),a.item}},O.exports=H},7651:function(O,H,a){var f=a(6916),h=a(9670),g=a(614),_=a(4326),E=a(2261),m=TypeError;O.exports=function(p,A){var R=p.exec;if(g(R)){var D=f(R,p,A);return D!==null&&h(D),D}if(_(p)==="RegExp")return f(E,p,A);throw m("RegExp#exec called on incompatible receiver")}},2261:function(O,H,a){var f,h,g=a(6916),_=a(1702),E=a(1340),m=a(7066),p=a(2999),A=a(2309),R=a(30),D=a(9909).get,P=a(9441),k=a(7168),b=A("native-string-replace",String.prototype.replace),j=RegExp.prototype.exec,z=j,S=_("".charAt),F=_("".indexOf),M=_("".replace),Z=_("".slice),U=(h=/b*/g,g(j,f=/a/,"a"),g(j,h,"a"),f.lastIndex!==0||h.lastIndex!==0),Y=p.BROKEN_CARET,q=/()??/.exec("")[1]!==void 0;(U||q||Y||P||k)&&(z=function(V){var it,mt,wt,yt,Ht,Yt,At,Lt=this,zt=D(Lt),re=E(V),de=zt.raw;if(de)return de.lastIndex=Lt.lastIndex,it=g(z,de,re),Lt.lastIndex=de.lastIndex,it;var ft=zt.groups,gt=Y&&Lt.sticky,Zt=g(m,Lt),Pt=Lt.source,Wt=0,oe=re;if(gt&&(Zt=M(Zt,"y",""),F(Zt,"g")===-1&&(Zt+="g"),oe=Z(re,Lt.lastIndex),Lt.lastIndex>0&&(!Lt.multiline||Lt.multiline&&S(re,Lt.lastIndex-1)!==`
`)&&(Pt="(?: "+Pt+")",oe=" "+oe,Wt++),mt=new RegExp("^(?:"+Pt+")",Zt)),q&&(mt=new RegExp("^"+Pt+"$(?!\\s)",Zt)),U&&(wt=Lt.lastIndex),yt=g(j,gt?mt:Lt,oe),gt?yt?(yt.input=Z(yt.input,Wt),yt[0]=Z(yt[0],Wt),yt.index=Lt.lastIndex,Lt.lastIndex+=yt[0].length):Lt.lastIndex=0:U&&yt&&(Lt.lastIndex=Lt.global?yt.index+yt[0].length:wt),q&&yt&&yt.length>1&&g(b,yt[0],mt,function(){for(Ht=1;Ht<arguments.length-2;Ht++)arguments[Ht]===void 0&&(yt[Ht]=void 0)}),yt&&ft)for(yt.groups=Yt=R(null),Ht=0;Ht<ft.length;Ht++)Yt[(At=ft[Ht])[0]]=yt[At[1]];return yt}),O.exports=z},7066:function(O,H,a){var f=a(9670);O.exports=function(){var h=f(this),g="";return h.hasIndices&&(g+="d"),h.global&&(g+="g"),h.ignoreCase&&(g+="i"),h.multiline&&(g+="m"),h.dotAll&&(g+="s"),h.unicode&&(g+="u"),h.unicodeSets&&(g+="v"),h.sticky&&(g+="y"),g}},4706:function(O,H,a){var f=a(6916),h=a(2597),g=a(7976),_=a(7066),E=RegExp.prototype;O.exports=function(m){var p=m.flags;return p!==void 0||"flags"in E||h(m,"flags")||!g(E,m)?p:f(_,m)}},2999:function(O,H,a){var f=a(7293),h=a(7854).RegExp,g=f(function(){var m=h("a","y");return m.lastIndex=2,m.exec("abcd")!=null}),_=g||f(function(){return!h("a","y").sticky}),E=g||f(function(){var m=h("^r","gy");return m.lastIndex=2,m.exec("str")!=null});O.exports={BROKEN_CARET:E,MISSED_STICKY:_,UNSUPPORTED_Y:g}},9441:function(O,H,a){var f=a(7293),h=a(7854).RegExp;O.exports=f(function(){var g=h(".","s");return!(g.dotAll&&g.exec(`
`)&&g.flags==="s")})},7168:function(O,H,a){var f=a(7293),h=a(7854).RegExp;O.exports=f(function(){var g=h("(?<a>b)","g");return g.exec("b").groups.a!=="b"||"b".replace(g,"$<a>c")!=="bc"})},4488:function(O,H,a){var f=a(8554),h=TypeError;O.exports=function(g){if(f(g))throw h("Can't call method on "+g);return g}},7152:function(O,H,a){var f,h=a(7854),g=a(2104),_=a(614),E=a(9363),m=a(8113),p=a(206),A=a(8053),R=h.Function,D=/MSIE .\./.test(m)||E&&((f=h.Bun.version.split(".")).length<3||f[0]==0&&(f[1]<3||f[1]==3&&f[2]==0));O.exports=function(P,k){var b=k?2:1;return D?function(j,z){var S=A(arguments.length,1)>b,F=_(j)?j:R(j),M=S?p(arguments,b):[],Z=S?function(){g(F,this,M)}:F;return k?P(Z,z):P(Z)}:P}},6340:function(O,H,a){var f=a(5005),h=a(7045),g=a(5112),_=a(9781),E=g("species");O.exports=function(m){var p=f(m);_&&p&&!p[E]&&h(p,E,{configurable:!0,get:function(){return this}})}},8003:function(O,H,a){var f=a(3070).f,h=a(2597),g=a(5112)("toStringTag");O.exports=function(_,E,m){_&&!m&&(_=_.prototype),_&&!h(_,g)&&f(_,g,{configurable:!0,value:E})}},6200:function(O,H,a){var f=a(2309),h=a(9711),g=f("keys");O.exports=function(_){return g[_]||(g[_]=h(_))}},5465:function(O,H,a){var f=a(7854),h=a(3072),g="__core-js_shared__",_=f[g]||h(g,{});O.exports=_},2309:function(O,H,a){var f=a(1913),h=a(5465);(O.exports=function(g,_){return h[g]||(h[g]=_!==void 0?_:{})})("versions",[]).push({version:"3.30.2",mode:f?"pure":"global",copyright:"Â© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.30.2/LICENSE",source:"https://github.com/zloirock/core-js"})},6707:function(O,H,a){var f=a(9670),h=a(9483),g=a(8554),_=a(5112)("species");O.exports=function(E,m){var p,A=f(E).constructor;return A===void 0||g(p=f(A)[_])?m:h(p)}},8710:function(O,H,a){var f=a(1702),h=a(9303),g=a(1340),_=a(4488),E=f("".charAt),m=f("".charCodeAt),p=f("".slice),A=function(R){return function(D,P){var k,b,j=g(_(D)),z=h(P),S=j.length;return z<0||z>=S?R?"":void 0:(k=m(j,z))<55296||k>56319||z+1===S||(b=m(j,z+1))<56320||b>57343?R?E(j,z):k:R?p(j,z,z+2):b-56320+(k-55296<<10)+65536}};O.exports={codeAt:A(!1),charAt:A(!0)}},3197:function(O,H,a){var f=a(1702),h=2147483647,g=/[^\0-\u007E]/,_=/[.\u3002\uFF0E\uFF61]/g,E="Overflow: input needs wider integers to process",m=RangeError,p=f(_.exec),A=Math.floor,R=String.fromCharCode,D=f("".charCodeAt),P=f([].join),k=f([].push),b=f("".replace),j=f("".split),z=f("".toLowerCase),S=function(Z){return Z+22+75*(Z<26)},F=function(Z,U,Y){var q=0;for(Z=Y?A(Z/700):Z>>1,Z+=A(Z/U);Z>455;)Z=A(Z/35),q+=36;return A(q+36*Z/(Z+38))},M=function(Z){var U=[];Z=function(gt){for(var Zt=[],Pt=0,Wt=gt.length;Pt<Wt;){var oe=D(gt,Pt++);if(oe>=55296&&oe<=56319&&Pt<Wt){var fe=D(gt,Pt++);(64512&fe)==56320?k(Zt,((1023&oe)<<10)+(1023&fe)+65536):(k(Zt,oe),Pt--)}else k(Zt,oe)}return Zt}(Z);var Y,q,V=Z.length,it=128,mt=0,wt=72;for(Y=0;Y<Z.length;Y++)(q=Z[Y])<128&&k(U,R(q));var yt=U.length,Ht=yt;for(yt&&k(U,"-");Ht<V;){var Yt=h;for(Y=0;Y<Z.length;Y++)(q=Z[Y])>=it&&q<Yt&&(Yt=q);var At=Ht+1;if(Yt-it>A((h-mt)/At))throw m(E);for(mt+=(Yt-it)*At,it=Yt,Y=0;Y<Z.length;Y++){if((q=Z[Y])<it&&++mt>h)throw m(E);if(q==it){for(var Lt=mt,zt=36;;){var re=zt<=wt?1:zt>=wt+26?26:zt-wt;if(Lt<re)break;var de=Lt-re,ft=36-re;k(U,R(S(re+de%ft))),Lt=A(de/ft),zt+=36}k(U,R(S(Lt))),wt=F(mt,At,Ht==yt),mt=0,Ht++}}mt++,it++}return P(U,"")};O.exports=function(Z){var U,Y,q=[],V=j(b(z(Z),_,"."),".");for(U=0;U<V.length;U++)Y=V[U],k(q,p(g,Y)?"xn--"+M(Y):Y);return P(q,".")}},3111:function(O,H,a){var f=a(1702),h=a(4488),g=a(1340),_=a(1361),E=f("".replace),m=RegExp("^["+_+"]+"),p=RegExp("(^|[^"+_+"])["+_+"]+$"),A=function(R){return function(D){var P=g(h(D));return 1&R&&(P=E(P,m,"")),2&R&&(P=E(P,p,"$1")),P}};O.exports={start:A(1),end:A(2),trim:A(3)}},6293:function(O,H,a){var f=a(7392),h=a(7293),g=a(7854).String;O.exports=!!Object.getOwnPropertySymbols&&!h(function(){var _=Symbol();return!g(_)||!(Object(_)instanceof Symbol)||!Symbol.sham&&f&&f<41})},6532:function(O,H,a){var f=a(6916),h=a(5005),g=a(5112),_=a(8052);O.exports=function(){var E=h("Symbol"),m=E&&E.prototype,p=m&&m.valueOf,A=g("toPrimitive");m&&!m[A]&&_(m,A,function(R){return f(p,this)},{arity:1})}},2015:function(O,H,a){var f=a(6293);O.exports=f&&!!Symbol.for&&!!Symbol.keyFor},261:function(O,H,a){var f,h,g,_,E=a(7854),m=a(2104),p=a(9974),A=a(614),R=a(2597),D=a(7293),P=a(490),k=a(206),b=a(317),j=a(8053),z=a(6833),S=a(5268),F=E.setImmediate,M=E.clearImmediate,Z=E.process,U=E.Dispatch,Y=E.Function,q=E.MessageChannel,V=E.String,it=0,mt={},wt="onreadystatechange";D(function(){f=E.location});var yt=function(Lt){if(R(mt,Lt)){var zt=mt[Lt];delete mt[Lt],zt()}},Ht=function(Lt){return function(){yt(Lt)}},Yt=function(Lt){yt(Lt.data)},At=function(Lt){E.postMessage(V(Lt),f.protocol+"//"+f.host)};F&&M||(F=function(Lt){j(arguments.length,1);var zt=A(Lt)?Lt:Y(Lt),re=k(arguments,1);return mt[++it]=function(){m(zt,void 0,re)},h(it),it},M=function(Lt){delete mt[Lt]},S?h=function(Lt){Z.nextTick(Ht(Lt))}:U&&U.now?h=function(Lt){U.now(Ht(Lt))}:q&&!z?(_=(g=new q).port2,g.port1.onmessage=Yt,h=p(_.postMessage,_)):E.addEventListener&&A(E.postMessage)&&!E.importScripts&&f&&f.protocol!=="file:"&&!D(At)?(h=At,E.addEventListener("message",Yt,!1)):h=wt in b("script")?function(Lt){P.appendChild(b("script"))[wt]=function(){P.removeChild(this),yt(Lt)}}:function(Lt){setTimeout(Ht(Lt),0)}),O.exports={set:F,clear:M}},863:function(O,H,a){var f=a(1702);O.exports=f(1 .valueOf)},1400:function(O,H,a){var f=a(9303),h=Math.max,g=Math.min;O.exports=function(_,E){var m=f(_);return m<0?h(m+E,0):g(m,E)}},4599:function(O,H,a){var f=a(7593),h=TypeError;O.exports=function(g){var _=f(g,"number");if(typeof _=="number")throw h("Can't convert number to bigint");return BigInt(_)}},7067:function(O,H,a){var f=a(9303),h=a(7466),g=RangeError;O.exports=function(_){if(_===void 0)return 0;var E=f(_),m=h(E);if(E!==m)throw g("Wrong length or index");return m}},5656:function(O,H,a){var f=a(8361),h=a(4488);O.exports=function(g){return f(h(g))}},9303:function(O,H,a){var f=a(4758);O.exports=function(h){var g=+h;return g!=g||g===0?0:f(g)}},7466:function(O,H,a){var f=a(9303),h=Math.min;O.exports=function(g){return g>0?h(f(g),9007199254740991):0}},7908:function(O,H,a){var f=a(4488),h=Object;O.exports=function(g){return h(f(g))}},4590:function(O,H,a){var f=a(3002),h=RangeError;O.exports=function(g,_){var E=f(g);if(E%_)throw h("Wrong offset");return E}},3002:function(O,H,a){var f=a(9303),h=RangeError;O.exports=function(g){var _=f(g);if(_<0)throw h("The argument can't be less than 0");return _}},7593:function(O,H,a){var f=a(6916),h=a(111),g=a(2190),_=a(8173),E=a(2140),m=a(5112),p=TypeError,A=m("toPrimitive");O.exports=function(R,D){if(!h(R)||g(R))return R;var P,k=_(R,A);if(k){if(D===void 0&&(D="default"),P=f(k,R,D),!h(P)||g(P))return P;throw p("Can't convert object to primitive value")}return D===void 0&&(D="number"),E(R,D)}},4948:function(O,H,a){var f=a(7593),h=a(2190);O.exports=function(g){var _=f(g,"string");return h(_)?_:_+""}},1694:function(O,H,a){var f={};f[a(5112)("toStringTag")]="z",O.exports=String(f)==="[object z]"},1340:function(O,H,a){var f=a(648),h=String;O.exports=function(g){if(f(g)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return h(g)}},6330:function(O){var H=String;O.exports=function(a){try{return H(a)}catch{return"Object"}}},9843:function(O,H,a){var f=a(2109),h=a(7854),g=a(6916),_=a(9781),E=a(3832),m=a(260),p=a(3331),A=a(5787),R=a(9114),D=a(8880),P=a(5988),k=a(7466),b=a(7067),j=a(4590),z=a(4948),S=a(2597),F=a(648),M=a(111),Z=a(2190),U=a(30),Y=a(7976),q=a(7674),V=a(8006).f,it=a(7321),mt=a(2092).forEach,wt=a(6340),yt=a(7045),Ht=a(3070),Yt=a(1236),At=a(9909),Lt=a(9587),zt=At.get,re=At.set,de=At.enforce,ft=Ht.f,gt=Yt.f,Zt=Math.round,Pt=h.RangeError,Wt=p.ArrayBuffer,oe=Wt.prototype,fe=p.DataView,le=m.NATIVE_ARRAY_BUFFER_VIEWS,Ie=m.TYPED_ARRAY_TAG,me=m.TypedArray,Oe=m.TypedArrayPrototype,je=m.aTypedArrayConstructor,xe=m.isTypedArray,ir="BYTES_PER_ELEMENT",He="Wrong length",ae=function(Pe,Ee){je(Pe);for(var te=0,Ae=Ee.length,Xe=new Pe(Ae);Ae>te;)Xe[te]=Ee[te++];return Xe},Ne=function(Pe,Ee){yt(Pe,Ee,{configurable:!0,get:function(){return zt(this)[Ee]}})},Ze=function(Pe){var Ee;return Y(oe,Pe)||(Ee=F(Pe))=="ArrayBuffer"||Ee=="SharedArrayBuffer"},ee=function(Pe,Ee){return xe(Pe)&&!Z(Ee)&&Ee in Pe&&P(+Ee)&&Ee>=0},be=function(Pe,Ee){return Ee=z(Ee),ee(Pe,Ee)?R(2,Pe[Ee]):gt(Pe,Ee)},We=function(Pe,Ee,te){return Ee=z(Ee),!(ee(Pe,Ee)&&M(te)&&S(te,"value"))||S(te,"get")||S(te,"set")||te.configurable||S(te,"writable")&&!te.writable||S(te,"enumerable")&&!te.enumerable?ft(Pe,Ee,te):(Pe[Ee]=te.value,Pe)};_?(le||(Yt.f=be,Ht.f=We,Ne(Oe,"buffer"),Ne(Oe,"byteOffset"),Ne(Oe,"byteLength"),Ne(Oe,"length")),f({target:"Object",stat:!0,forced:!le},{getOwnPropertyDescriptor:be,defineProperty:We}),O.exports=function(Pe,Ee,te){var Ae=Pe.match(/\d+/)[0]/8,Xe=Pe+(te?"Clamped":"")+"Array",Be="get"+Pe,ze="set"+Pe,ot=h[Xe],Et=ot,nt=Et&&Et.prototype,Dt={},B=function(St,Nt){ft(St,Nt,{get:function(){return function(Ut,Xt){var Gt=zt(Ut);return Gt.view[Be](Xt*Ae+Gt.byteOffset,!0)}(this,Nt)},set:function(Ut){return function(Xt,Gt,ne){var Re=zt(Xt);te&&(ne=(ne=Zt(ne))<0?0:ne>255?255:255&ne),Re.view[ze](Gt*Ae+Re.byteOffset,ne,!0)}(this,Nt,Ut)},enumerable:!0})};le?E&&(Et=Ee(function(St,Nt,Ut,Xt){return A(St,nt),Lt(M(Nt)?Ze(Nt)?Xt!==void 0?new ot(Nt,j(Ut,Ae),Xt):Ut!==void 0?new ot(Nt,j(Ut,Ae)):new ot(Nt):xe(Nt)?ae(Et,Nt):g(it,Et,Nt):new ot(b(Nt)),St,Et)}),q&&q(Et,me),mt(V(ot),function(St){St in Et||D(Et,St,ot[St])}),Et.prototype=nt):(Et=Ee(function(St,Nt,Ut,Xt){A(St,nt);var Gt,ne,Re,pe=0,Je=0;if(M(Nt)){if(!Ze(Nt))return xe(Nt)?ae(Et,Nt):g(it,Et,Nt);Gt=Nt,Je=j(Ut,Ae);var I=Nt.byteLength;if(Xt===void 0){if(I%Ae||(ne=I-Je)<0)throw Pt(He)}else if((ne=k(Xt)*Ae)+Je>I)throw Pt(He);Re=ne/Ae}else Re=b(Nt),Gt=new Wt(ne=Re*Ae);for(re(St,{buffer:Gt,byteOffset:Je,byteLength:ne,length:Re,view:new fe(Gt)});pe<Re;)B(St,pe++)}),q&&q(Et,me),nt=Et.prototype=U(Oe)),nt.constructor!==Et&&D(nt,"constructor",Et),de(nt).TypedArrayConstructor=Et,Ie&&D(nt,Ie,Xe);var Ft=Et!=ot;Dt[Xe]=Et,f({global:!0,constructor:!0,forced:Ft,sham:!le},Dt),ir in Et||D(Et,ir,Ae),ir in nt||D(nt,ir,Ae),wt(Xe)}):O.exports=function(){}},3832:function(O,H,a){var f=a(7854),h=a(7293),g=a(7072),_=a(260).NATIVE_ARRAY_BUFFER_VIEWS,E=f.ArrayBuffer,m=f.Int8Array;O.exports=!_||!h(function(){m(1)})||!h(function(){new m(-1)})||!g(function(p){new m,new m(null),new m(1.5),new m(p)},!0)||h(function(){return new m(new E(2),1,void 0).length!==1})},3074:function(O,H,a){var f=a(7745),h=a(6304);O.exports=function(g,_){return f(h(g),_)}},7321:function(O,H,a){var f=a(9974),h=a(6916),g=a(9483),_=a(7908),E=a(6244),m=a(4121),p=a(1246),A=a(7659),R=a(4067),D=a(260).aTypedArrayConstructor,P=a(4599);O.exports=function(k){var b,j,z,S,F,M,Z,U,Y=g(this),q=_(k),V=arguments.length,it=V>1?arguments[1]:void 0,mt=it!==void 0,wt=p(q);if(wt&&!A(wt))for(U=(Z=m(q,wt)).next,q=[];!(M=h(U,Z)).done;)q.push(M.value);for(mt&&V>2&&(it=f(it,arguments[2])),j=E(q),z=new(D(Y))(j),S=R(z),b=0;j>b;b++)F=mt?it(q[b],b):q[b],z[b]=S?P(F):+F;return z}},6304:function(O,H,a){var f=a(260),h=a(6707),g=f.aTypedArrayConstructor,_=f.getTypedArrayConstructor;O.exports=function(E){return g(h(E,_(E)))}},9711:function(O,H,a){var f=a(1702),h=0,g=Math.random(),_=f(1 .toString);O.exports=function(E){return"Symbol("+(E===void 0?"":E)+")_"+_(++h+g,36)}},5143:function(O,H,a){var f=a(7293),h=a(5112),g=a(9781),_=a(1913),E=h("iterator");O.exports=!f(function(){var m=new URL("b?a=1&b=2&c=3","http://a"),p=m.searchParams,A="";return m.pathname="c%20d",p.forEach(function(R,D){p.delete("b"),A+=D+R}),_&&!m.toJSON||!p.size&&(_||!g)||!p.sort||m.href!=="http://a/c%20d?a=1&c=3"||p.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!p[E]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://ÑÐµÑÑ").host!=="xn--e1aybc"||new URL("http://a#Ð±").hash!=="#%D0%B1"||A!=="a1c3"||new URL("http://x",void 0).host!=="x"})},3307:function(O,H,a){var f=a(6293);O.exports=f&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},3353:function(O,H,a){var f=a(9781),h=a(7293);O.exports=f&&h(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42})},8053:function(O){var H=TypeError;O.exports=function(a,f){if(a<f)throw H("Not enough arguments");return a}},4811:function(O,H,a){var f=a(7854),h=a(614),g=f.WeakMap;O.exports=h(g)&&/native code/.test(String(g))},6800:function(O,H,a){var f=a(857),h=a(2597),g=a(6061),_=a(3070).f;O.exports=function(E){var m=f.Symbol||(f.Symbol={});h(m,E)||_(m,E,{value:g.f(E)})}},6061:function(O,H,a){var f=a(5112);H.f=f},5112:function(O,H,a){var f=a(7854),h=a(2309),g=a(2597),_=a(9711),E=a(6293),m=a(3307),p=f.Symbol,A=h("wks"),R=m?p.for||p:p&&p.withoutSetter||_;O.exports=function(D){return g(A,D)||(A[D]=E&&g(p,D)?p[D]:R("Symbol."+D)),A[D]}},1361:function(O){O.exports=`	
\v\f\r Â áââââââââââââ¯âã\u2028\u2029\uFEFF`},9575:function(O,H,a){var f=a(2109),h=a(1470),g=a(7293),_=a(3331),E=a(9670),m=a(1400),p=a(7466),A=a(6707),R=_.ArrayBuffer,D=_.DataView,P=D.prototype,k=h(R.prototype.slice),b=h(P.getUint8),j=h(P.setUint8);f({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:g(function(){return!new R(2).slice(1,void 0).byteLength})},{slice:function(z,S){if(k&&S===void 0)return k(E(this),z);for(var F=E(this).byteLength,M=m(z,F),Z=m(S===void 0?F:S,F),U=new(A(this,R))(p(Z-M)),Y=new D(this),q=new D(U),V=0;M<Z;)j(q,V++,b(Y,M++));return U}})},2222:function(O,H,a){var f=a(2109),h=a(7293),g=a(3157),_=a(111),E=a(7908),m=a(6244),p=a(7207),A=a(6135),R=a(5417),D=a(1194),P=a(5112),k=a(7392),b=P("isConcatSpreadable"),j=k>=51||!h(function(){var S=[];return S[b]=!1,S.concat()[0]!==S}),z=function(S){if(!_(S))return!1;var F=S[b];return F!==void 0?!!F:g(S)};f({target:"Array",proto:!0,arity:1,forced:!j||!D("concat")},{concat:function(S){var F,M,Z,U,Y,q=E(this),V=R(q,0),it=0;for(F=-1,Z=arguments.length;F<Z;F++)if(z(Y=F===-1?q:arguments[F]))for(U=m(Y),p(it+U),M=0;M<U;M++,it++)M in Y&&A(V,it,Y[M]);else p(it+1),A(V,it++,Y);return V.length=it,V}})},7327:function(O,H,a){var f=a(2109),h=a(2092).filter;f({target:"Array",proto:!0,forced:!a(1194)("filter")},{filter:function(g){return h(this,g,arguments.length>1?arguments[1]:void 0)}})},4553:function(O,H,a){var f=a(2109),h=a(2092).findIndex,g=a(1223),_="findIndex",E=!0;_ in[]&&Array(1)[_](function(){E=!1}),f({target:"Array",proto:!0,forced:E},{findIndex:function(m){return h(this,m,arguments.length>1?arguments[1]:void 0)}}),g(_)},9826:function(O,H,a){var f=a(2109),h=a(2092).find,g=a(1223),_="find",E=!0;_ in[]&&Array(1)[_](function(){E=!1}),f({target:"Array",proto:!0,forced:E},{find:function(m){return h(this,m,arguments.length>1?arguments[1]:void 0)}}),g(_)},9554:function(O,H,a){var f=a(2109),h=a(8533);f({target:"Array",proto:!0,forced:[].forEach!=h},{forEach:h})},1038:function(O,H,a){var f=a(2109),h=a(8457);f({target:"Array",stat:!0,forced:!a(7072)(function(g){Array.from(g)})},{from:h})},6699:function(O,H,a){var f=a(2109),h=a(1318).includes,g=a(7293),_=a(1223);f({target:"Array",proto:!0,forced:g(function(){return!Array(1).includes()})},{includes:function(E){return h(this,E,arguments.length>1?arguments[1]:void 0)}}),_("includes")},2772:function(O,H,a){var f=a(2109),h=a(1470),g=a(1318).indexOf,_=a(9341),E=h([].indexOf),m=!!E&&1/E([1],1,-0)<0;f({target:"Array",proto:!0,forced:m||!_("indexOf")},{indexOf:function(p){var A=arguments.length>1?arguments[1]:void 0;return m?E(this,p,A)||0:g(this,p,A)}})},9753:function(O,H,a){a(2109)({target:"Array",stat:!0},{isArray:a(3157)})},6992:function(O,H,a){var f=a(5656),h=a(1223),g=a(7497),_=a(9909),E=a(3070).f,m=a(1656),p=a(6178),A=a(1913),R=a(9781),D="Array Iterator",P=_.set,k=_.getterFor(D);O.exports=m(Array,"Array",function(j,z){P(this,{type:D,target:f(j),index:0,kind:z})},function(){var j=k(this),z=j.target,S=j.kind,F=j.index++;return!z||F>=z.length?(j.target=void 0,p(void 0,!0)):p(S=="keys"?F:S=="values"?z[F]:[F,z[F]],!1)},"values");var b=g.Arguments=g.Array;if(h("keys"),h("values"),h("entries"),!A&&R&&b.name!=="values")try{E(b,"name",{value:"values"})}catch{}},9600:function(O,H,a){var f=a(2109),h=a(1702),g=a(8361),_=a(5656),E=a(9341),m=h([].join);f({target:"Array",proto:!0,forced:g!=Object||!E("join",",")},{join:function(p){return m(_(this),p===void 0?",":p)}})},4986:function(O,H,a){var f=a(2109),h=a(6583);f({target:"Array",proto:!0,forced:h!==[].lastIndexOf},{lastIndexOf:h})},1249:function(O,H,a){var f=a(2109),h=a(2092).map;f({target:"Array",proto:!0,forced:!a(1194)("map")},{map:function(g){return h(this,g,arguments.length>1?arguments[1]:void 0)}})},5827:function(O,H,a){var f=a(2109),h=a(3671).left,g=a(9341),_=a(7392);f({target:"Array",proto:!0,forced:!a(5268)&&_>79&&_<83||!g("reduce")},{reduce:function(E){var m=arguments.length;return h(this,E,m,m>1?arguments[1]:void 0)}})},5069:function(O,H,a){var f=a(2109),h=a(1702),g=a(3157),_=h([].reverse),E=[1,2];f({target:"Array",proto:!0,forced:String(E)===String(E.reverse())},{reverse:function(){return g(this)&&(this.length=this.length),_(this)}})},7042:function(O,H,a){var f=a(2109),h=a(3157),g=a(4411),_=a(111),E=a(1400),m=a(6244),p=a(5656),A=a(6135),R=a(5112),D=a(1194),P=a(206),k=D("slice"),b=R("species"),j=Array,z=Math.max;f({target:"Array",proto:!0,forced:!k},{slice:function(S,F){var M,Z,U,Y=p(this),q=m(Y),V=E(S,q),it=E(F===void 0?q:F,q);if(h(Y)&&(M=Y.constructor,(g(M)&&(M===j||h(M.prototype))||_(M)&&(M=M[b])===null)&&(M=void 0),M===j||M===void 0))return P(Y,V,it);for(Z=new(M===void 0?j:M)(z(it-V,0)),U=0;V<it;V++,U++)V in Y&&A(Z,U,Y[V]);return Z.length=U,Z}})},5212:function(O,H,a){var f=a(2109),h=a(2092).some;f({target:"Array",proto:!0,forced:!a(9341)("some")},{some:function(g){return h(this,g,arguments.length>1?arguments[1]:void 0)}})},561:function(O,H,a){var f=a(2109),h=a(7908),g=a(1400),_=a(9303),E=a(6244),m=a(3658),p=a(7207),A=a(5417),R=a(6135),D=a(5117),P=a(1194)("splice"),k=Math.max,b=Math.min;f({target:"Array",proto:!0,forced:!P},{splice:function(j,z){var S,F,M,Z,U,Y,q=h(this),V=E(q),it=g(j,V),mt=arguments.length;for(mt===0?S=F=0:mt===1?(S=0,F=V-it):(S=mt-2,F=b(k(_(z),0),V-it)),p(V+S-F),M=A(q,F),Z=0;Z<F;Z++)(U=it+Z)in q&&R(M,Z,q[U]);if(M.length=F,S<F){for(Z=it;Z<V-F;Z++)Y=Z+S,(U=Z+F)in q?q[Y]=q[U]:D(q,Y);for(Z=V;Z>V-F+S;Z--)D(q,Z-1)}else if(S>F)for(Z=V-F;Z>it;Z--)Y=Z+S-1,(U=Z+F-1)in q?q[Y]=q[U]:D(q,Y);for(Z=0;Z<S;Z++)q[Z+it]=arguments[Z+2];return m(q,V-F+S),M}})},3843:function(O,H,a){var f=a(2109),h=a(1702),g=Date,_=h(g.prototype.getTime);f({target:"Date",stat:!0},{now:function(){return _(new g)}})},3710:function(O,H,a){var f=a(1702),h=a(8052),g=Date.prototype,_="Invalid Date",E="toString",m=f(g[E]),p=f(g.getTime);String(new Date(NaN))!=_&&h(g,E,function(){var A=p(this);return A==A?m(this):_})},4812:function(O,H,a){var f=a(2109),h=a(7065);f({target:"Function",proto:!0,forced:Function.bind!==h},{bind:h})},8309:function(O,H,a){var f=a(9781),h=a(6530).EXISTS,g=a(1702),_=a(7045),E=Function.prototype,m=g(E.toString),p=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,A=g(p.exec);f&&!h&&_(E,"name",{configurable:!0,get:function(){try{return A(p,m(this))[1]}catch{return""}}})},8862:function(O,H,a){var f=a(2109),h=a(5005),g=a(2104),_=a(6916),E=a(1702),m=a(7293),p=a(614),A=a(2190),R=a(206),D=a(8044),P=a(6293),k=String,b=h("JSON","stringify"),j=E(/./.exec),z=E("".charAt),S=E("".charCodeAt),F=E("".replace),M=E(1 .toString),Z=/[\uD800-\uDFFF]/g,U=/^[\uD800-\uDBFF]$/,Y=/^[\uDC00-\uDFFF]$/,q=!P||m(function(){var wt=h("Symbol")();return b([wt])!="[null]"||b({a:wt})!="{}"||b(Object(wt))!="{}"}),V=m(function(){return b("\uDF06\uD834")!=='"\\udf06\\ud834"'||b("\uDEAD")!=='"\\udead"'}),it=function(wt,yt){var Ht=R(arguments),Yt=D(yt);if(p(Yt)||wt!==void 0&&!A(wt))return Ht[1]=function(At,Lt){if(p(Yt)&&(Lt=_(Yt,this,k(At),Lt)),!A(Lt))return Lt},g(b,null,Ht)},mt=function(wt,yt,Ht){var Yt=z(Ht,yt-1),At=z(Ht,yt+1);return j(U,wt)&&!j(Y,At)||j(Y,wt)&&!j(U,Yt)?"\\u"+M(S(wt,0),16):wt};b&&f({target:"JSON",stat:!0,arity:3,forced:q||V},{stringify:function(wt,yt,Ht){var Yt=R(arguments),At=g(q?it:b,null,Yt);return V&&typeof At=="string"?F(At,Z,mt):At}})},9098:function(O,H,a){a(7710)("Map",function(f){return function(){return f(this,arguments.length?arguments[0]:void 0)}},a(5631))},1532:function(O,H,a){a(9098)},9653:function(O,H,a){var f=a(2109),h=a(1913),g=a(9781),_=a(7854),E=a(857),m=a(1702),p=a(4705),A=a(2597),R=a(9587),D=a(7976),P=a(2190),k=a(7593),b=a(7293),j=a(8006).f,z=a(1236).f,S=a(3070).f,F=a(863),M=a(3111).trim,Z="Number",U=_[Z],Y=E[Z],q=U.prototype,V=_.TypeError,it=m("".slice),mt=m("".charCodeAt),wt=p(Z,!U(" 0o1")||!U("0b1")||U("+0x1")),yt=function(Yt){var At,Lt=arguments.length<1?0:U(function(zt){var re=k(zt,"number");return typeof re=="bigint"?re:function(de){var ft,gt,Zt,Pt,Wt,oe,fe,le,Ie=k(de,"number");if(P(Ie))throw V("Cannot convert a Symbol value to a number");if(typeof Ie=="string"&&Ie.length>2){if(Ie=M(Ie),(ft=mt(Ie,0))===43||ft===45){if((gt=mt(Ie,2))===88||gt===120)return NaN}else if(ft===48){switch(mt(Ie,1)){case 66:case 98:Zt=2,Pt=49;break;case 79:case 111:Zt=8,Pt=55;break;default:return+Ie}for(oe=(Wt=it(Ie,2)).length,fe=0;fe<oe;fe++)if((le=mt(Wt,fe))<48||le>Pt)return NaN;return parseInt(Wt,Zt)}}return+Ie}(re)}(Yt));return D(q,At=this)&&b(function(){F(At)})?R(Object(Lt),this,yt):Lt};yt.prototype=q,wt&&!h&&(q.constructor=yt),f({global:!0,constructor:!0,wrap:!0,forced:wt},{Number:yt});var Ht=function(Yt,At){for(var Lt,zt=g?j(At):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),re=0;zt.length>re;re++)A(At,Lt=zt[re])&&!A(Yt,Lt)&&S(Yt,Lt,z(At,Lt))};h&&Y&&Ht(E[Z],Y),(wt||h)&&Ht(E[Z],U)},3161:function(O,H,a){a(2109)({target:"Number",stat:!0},{isInteger:a(5988)})},4048:function(O,H,a){a(2109)({target:"Number",stat:!0},{isNaN:function(f){return f!=f}})},9601:function(O,H,a){var f=a(2109),h=a(1574);f({target:"Object",stat:!0,arity:2,forced:Object.assign!==h},{assign:h})},9070:function(O,H,a){var f=a(2109),h=a(9781),g=a(3070).f;f({target:"Object",stat:!0,forced:Object.defineProperty!==g,sham:!h},{defineProperty:g})},9720:function(O,H,a){var f=a(2109),h=a(4699).entries;f({target:"Object",stat:!0},{entries:function(g){return h(g)}})},9660:function(O,H,a){var f=a(2109),h=a(6293),g=a(7293),_=a(5181),E=a(7908);f({target:"Object",stat:!0,forced:!h||g(function(){_.f(1)})},{getOwnPropertySymbols:function(m){var p=_.f;return p?p(E(m)):[]}})},7941:function(O,H,a){var f=a(2109),h=a(7908),g=a(1956);f({target:"Object",stat:!0,forced:a(7293)(function(){g(1)})},{keys:function(_){return g(h(_))}})},1539:function(O,H,a){var f=a(1694),h=a(8052),g=a(288);f||h(Object.prototype,"toString",g,{unsafe:!0})},821:function(O,H,a){var f=a(2109),h=a(6916),g=a(9662),_=a(8523),E=a(2534),m=a(408);f({target:"Promise",stat:!0,forced:a(612)},{all:function(p){var A=this,R=_.f(A),D=R.resolve,P=R.reject,k=E(function(){var b=g(A.resolve),j=[],z=0,S=1;m(p,function(F){var M=z++,Z=!1;S++,h(b,A,F).then(function(U){Z||(Z=!0,j[M]=U,--S||D(j))},P)}),--S||D(j)});return k.error&&P(k.value),R.promise}})},4164:function(O,H,a){var f=a(2109),h=a(1913),g=a(3702).CONSTRUCTOR,_=a(2492),E=a(5005),m=a(614),p=a(8052),A=_&&_.prototype;if(f({target:"Promise",proto:!0,forced:g,real:!0},{catch:function(D){return this.then(void 0,D)}}),!h&&m(_)){var R=E("Promise").prototype.catch;A.catch!==R&&p(A,"catch",R,{unsafe:!0})}},3401:function(O,H,a){var f,h,g,_=a(2109),E=a(1913),m=a(5268),p=a(7854),A=a(6916),R=a(8052),D=a(7674),P=a(8003),k=a(6340),b=a(9662),j=a(614),z=a(111),S=a(5787),F=a(6707),M=a(261).set,Z=a(5948),U=a(842),Y=a(2534),q=a(8572),V=a(9909),it=a(2492),mt=a(3702),wt=a(8523),yt="Promise",Ht=mt.CONSTRUCTOR,Yt=mt.REJECTION_EVENT,At=mt.SUBCLASSING,Lt=V.getterFor(yt),zt=V.set,re=it&&it.prototype,de=it,ft=re,gt=p.TypeError,Zt=p.document,Pt=p.process,Wt=wt.f,oe=Wt,fe=!!(Zt&&Zt.createEvent&&p.dispatchEvent),le="unhandledrejection",Ie=function(ee){var be;return!(!z(ee)||!j(be=ee.then))&&be},me=function(ee,be){var We,Pe,Ee,te=be.value,Ae=be.state==1,Xe=Ae?ee.ok:ee.fail,Be=ee.resolve,ze=ee.reject,ot=ee.domain;try{Xe?(Ae||(be.rejection===2&&He(be),be.rejection=1),Xe===!0?We=te:(ot&&ot.enter(),We=Xe(te),ot&&(ot.exit(),Ee=!0)),We===ee.promise?ze(gt("Promise-chain cycle")):(Pe=Ie(We))?A(Pe,We,Be,ze):Be(We)):ze(te)}catch(Et){ot&&!Ee&&ot.exit(),ze(Et)}},Oe=function(ee,be){ee.notified||(ee.notified=!0,Z(function(){for(var We,Pe=ee.reactions;We=Pe.get();)me(We,ee);ee.notified=!1,be&&!ee.rejection&&xe(ee)}))},je=function(ee,be,We){var Pe,Ee;fe?((Pe=Zt.createEvent("Event")).promise=be,Pe.reason=We,Pe.initEvent(ee,!1,!0),p.dispatchEvent(Pe)):Pe={promise:be,reason:We},!Yt&&(Ee=p["on"+ee])?Ee(Pe):ee===le&&U("Unhandled promise rejection",We)},xe=function(ee){A(M,p,function(){var be,We=ee.facade,Pe=ee.value;if(ir(ee)&&(be=Y(function(){m?Pt.emit("unhandledRejection",Pe,We):je(le,We,Pe)}),ee.rejection=m||ir(ee)?2:1,be.error))throw be.value})},ir=function(ee){return ee.rejection!==1&&!ee.parent},He=function(ee){A(M,p,function(){var be=ee.facade;m?Pt.emit("rejectionHandled",be):je("rejectionhandled",be,ee.value)})},ae=function(ee,be,We){return function(Pe){ee(be,Pe,We)}},Ne=function(ee,be,We){ee.done||(ee.done=!0,We&&(ee=We),ee.value=be,ee.state=2,Oe(ee,!0))},Ze=function(ee,be,We){if(!ee.done){ee.done=!0,We&&(ee=We);try{if(ee.facade===be)throw gt("Promise can't be resolved itself");var Pe=Ie(be);Pe?Z(function(){var Ee={done:!1};try{A(Pe,be,ae(Ze,Ee,ee),ae(Ne,Ee,ee))}catch(te){Ne(Ee,te,ee)}}):(ee.value=be,ee.state=1,Oe(ee,!1))}catch(Ee){Ne({done:!1},Ee,ee)}}};if(Ht&&(ft=(de=function(ee){S(this,ft),b(ee),A(f,this);var be=Lt(this);try{ee(ae(Ze,be),ae(Ne,be))}catch(We){Ne(be,We)}}).prototype,(f=function(ee){zt(this,{type:yt,done:!1,notified:!1,parent:!1,reactions:new q,rejection:!1,state:0,value:void 0})}).prototype=R(ft,"then",function(ee,be){var We=Lt(this),Pe=Wt(F(this,de));return We.parent=!0,Pe.ok=!j(ee)||ee,Pe.fail=j(be)&&be,Pe.domain=m?Pt.domain:void 0,We.state==0?We.reactions.add(Pe):Z(function(){me(Pe,We)}),Pe.promise}),h=function(){var ee=new f,be=Lt(ee);this.promise=ee,this.resolve=ae(Ze,be),this.reject=ae(Ne,be)},wt.f=Wt=function(ee){return ee===de||ee===void 0?new h(ee):oe(ee)},!E&&j(it)&&re!==Object.prototype)){g=re.then,At||R(re,"then",function(ee,be){var We=this;return new de(function(Pe,Ee){A(g,We,Pe,Ee)}).then(ee,be)},{unsafe:!0});try{delete re.constructor}catch{}D&&D(re,ft)}_({global:!0,constructor:!0,wrap:!0,forced:Ht},{Promise:de}),P(de,yt,!1,!0),k(yt)},8674:function(O,H,a){a(3401),a(821),a(4164),a(6027),a(683),a(6294)},6027:function(O,H,a){var f=a(2109),h=a(6916),g=a(9662),_=a(8523),E=a(2534),m=a(408);f({target:"Promise",stat:!0,forced:a(612)},{race:function(p){var A=this,R=_.f(A),D=R.reject,P=E(function(){var k=g(A.resolve);m(p,function(b){h(k,A,b).then(R.resolve,D)})});return P.error&&D(P.value),R.promise}})},683:function(O,H,a){var f=a(2109),h=a(6916),g=a(8523);f({target:"Promise",stat:!0,forced:a(3702).CONSTRUCTOR},{reject:function(_){var E=g.f(this);return h(E.reject,void 0,_),E.promise}})},6294:function(O,H,a){var f=a(2109),h=a(5005),g=a(1913),_=a(2492),E=a(3702).CONSTRUCTOR,m=a(9478),p=h("Promise"),A=g&&!E;f({target:"Promise",stat:!0,forced:g||E},{resolve:function(R){return m(A&&this===p?_:this,R)}})},4916:function(O,H,a){var f=a(2109),h=a(2261);f({target:"RegExp",proto:!0,forced:/./.exec!==h},{exec:h})},9714:function(O,H,a){var f=a(6530).PROPER,h=a(8052),g=a(9670),_=a(1340),E=a(7293),m=a(4706),p="toString",A=RegExp.prototype[p],R=E(function(){return A.call({source:"a",flags:"b"})!="/a/b"}),D=f&&A.name!=p;(R||D)&&h(RegExp.prototype,p,function(){var P=g(this);return"/"+_(P.source)+"/"+_(m(P))},{unsafe:!0})},2023:function(O,H,a){var f=a(2109),h=a(1702),g=a(3929),_=a(4488),E=a(1340),m=a(4964),p=h("".indexOf);f({target:"String",proto:!0,forced:!m("includes")},{includes:function(A){return!!~p(E(_(this)),E(g(A)),arguments.length>1?arguments[1]:void 0)}})},8783:function(O,H,a){var f=a(8710).charAt,h=a(1340),g=a(9909),_=a(1656),E=a(6178),m="String Iterator",p=g.set,A=g.getterFor(m);_(String,"String",function(R){p(this,{type:m,string:h(R),index:0})},function(){var R,D=A(this),P=D.string,k=D.index;return k>=P.length?E(void 0,!0):(R=f(P,k),D.index+=R.length,E(R,!1))})},3123:function(O,H,a){var f=a(2104),h=a(6916),g=a(1702),_=a(7007),E=a(9670),m=a(8554),p=a(7850),A=a(4488),R=a(6707),D=a(1530),P=a(7466),k=a(1340),b=a(8173),j=a(1589),z=a(7651),S=a(2261),F=a(2999),M=a(7293),Z=F.UNSUPPORTED_Y,U=4294967295,Y=Math.min,q=[].push,V=g(/./.exec),it=g(q),mt=g("".slice),wt=!M(function(){var yt=/(?:)/,Ht=yt.exec;yt.exec=function(){return Ht.apply(this,arguments)};var Yt="ab".split(yt);return Yt.length!==2||Yt[0]!=="a"||Yt[1]!=="b"});_("split",function(yt,Ht,Yt){var At;return At="abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||".".split(/()()/).length>1||"".split(/.?/).length?function(Lt,zt){var re=k(A(this)),de=zt===void 0?U:zt>>>0;if(de===0)return[];if(Lt===void 0)return[re];if(!p(Lt))return h(Ht,re,Lt,de);for(var ft,gt,Zt,Pt=[],Wt=(Lt.ignoreCase?"i":"")+(Lt.multiline?"m":"")+(Lt.unicode?"u":"")+(Lt.sticky?"y":""),oe=0,fe=new RegExp(Lt.source,Wt+"g");(ft=h(S,fe,re))&&!((gt=fe.lastIndex)>oe&&(it(Pt,mt(re,oe,ft.index)),ft.length>1&&ft.index<re.length&&f(q,Pt,j(ft,1)),Zt=ft[0].length,oe=gt,Pt.length>=de));)fe.lastIndex===ft.index&&fe.lastIndex++;return oe===re.length?!Zt&&V(fe,"")||it(Pt,""):it(Pt,mt(re,oe)),Pt.length>de?j(Pt,0,de):Pt}:"0".split(void 0,0).length?function(Lt,zt){return Lt===void 0&&zt===0?[]:h(Ht,this,Lt,zt)}:Ht,[function(Lt,zt){var re=A(this),de=m(Lt)?void 0:b(Lt,yt);return de?h(de,Lt,re,zt):h(At,k(re),Lt,zt)},function(Lt,zt){var re=E(this),de=k(Lt),ft=Yt(At,re,de,zt,At!==Ht);if(ft.done)return ft.value;var gt=R(re,RegExp),Zt=re.unicode,Pt=(re.ignoreCase?"i":"")+(re.multiline?"m":"")+(re.unicode?"u":"")+(Z?"g":"y"),Wt=new gt(Z?"^(?:"+re.source+")":re,Pt),oe=zt===void 0?U:zt>>>0;if(oe===0)return[];if(de.length===0)return z(Wt,de)===null?[de]:[];for(var fe=0,le=0,Ie=[];le<de.length;){Wt.lastIndex=Z?0:le;var me,Oe=z(Wt,Z?mt(de,le):de);if(Oe===null||(me=Y(P(Wt.lastIndex+(Z?le:0)),de.length))===fe)le=D(de,le,Zt);else{if(it(Ie,mt(de,fe,le)),Ie.length===oe)return Ie;for(var je=1;je<=Oe.length-1;je++)if(it(Ie,Oe[je]),Ie.length===oe)return Ie;le=fe=me}}return it(Ie,mt(de,fe)),Ie}]},!wt,Z)},4032:function(O,H,a){var f=a(2109),h=a(7854),g=a(6916),_=a(1702),E=a(1913),m=a(9781),p=a(6293),A=a(7293),R=a(2597),D=a(7976),P=a(9670),k=a(5656),b=a(4948),j=a(1340),z=a(9114),S=a(30),F=a(1956),M=a(8006),Z=a(1156),U=a(5181),Y=a(1236),q=a(3070),V=a(6048),it=a(5296),mt=a(8052),wt=a(7045),yt=a(2309),Ht=a(6200),Yt=a(3501),At=a(9711),Lt=a(5112),zt=a(6061),re=a(6800),de=a(6532),ft=a(8003),gt=a(9909),Zt=a(2092).forEach,Pt=Ht("hidden"),Wt="Symbol",oe="prototype",fe=gt.set,le=gt.getterFor(Wt),Ie=Object[oe],me=h.Symbol,Oe=me&&me[oe],je=h.TypeError,xe=h.QObject,ir=Y.f,He=q.f,ae=Z.f,Ne=it.f,Ze=_([].push),ee=yt("symbols"),be=yt("op-symbols"),We=yt("wks"),Pe=!xe||!xe[oe]||!xe[oe].findChild,Ee=m&&A(function(){return S(He({},"a",{get:function(){return He(this,"a",{value:7}).a}})).a!=7})?function(nt,Dt,B){var Ft=ir(Ie,Dt);Ft&&delete Ie[Dt],He(nt,Dt,B),Ft&&nt!==Ie&&He(Ie,Dt,Ft)}:He,te=function(nt,Dt){var B=ee[nt]=S(Oe);return fe(B,{type:Wt,tag:nt,description:Dt}),m||(B.description=Dt),B},Ae=function(nt,Dt,B){nt===Ie&&Ae(be,Dt,B),P(nt);var Ft=b(Dt);return P(B),R(ee,Ft)?(B.enumerable?(R(nt,Pt)&&nt[Pt][Ft]&&(nt[Pt][Ft]=!1),B=S(B,{enumerable:z(0,!1)})):(R(nt,Pt)||He(nt,Pt,z(1,{})),nt[Pt][Ft]=!0),Ee(nt,Ft,B)):He(nt,Ft,B)},Xe=function(nt,Dt){P(nt);var B=k(Dt),Ft=F(B).concat(Et(B));return Zt(Ft,function(St){m&&!g(Be,B,St)||Ae(nt,St,B[St])}),nt},Be=function(nt){var Dt=b(nt),B=g(Ne,this,Dt);return!(this===Ie&&R(ee,Dt)&&!R(be,Dt))&&(!(B||!R(this,Dt)||!R(ee,Dt)||R(this,Pt)&&this[Pt][Dt])||B)},ze=function(nt,Dt){var B=k(nt),Ft=b(Dt);if(B!==Ie||!R(ee,Ft)||R(be,Ft)){var St=ir(B,Ft);return!St||!R(ee,Ft)||R(B,Pt)&&B[Pt][Ft]||(St.enumerable=!0),St}},ot=function(nt){var Dt=ae(k(nt)),B=[];return Zt(Dt,function(Ft){R(ee,Ft)||R(Yt,Ft)||Ze(B,Ft)}),B},Et=function(nt){var Dt=nt===Ie,B=ae(Dt?be:k(nt)),Ft=[];return Zt(B,function(St){!R(ee,St)||Dt&&!R(Ie,St)||Ze(Ft,ee[St])}),Ft};p||(me=function(){if(D(Oe,this))throw je("Symbol is not a constructor");var nt=arguments.length&&arguments[0]!==void 0?j(arguments[0]):void 0,Dt=At(nt),B=function(Ft){this===Ie&&g(B,be,Ft),R(this,Pt)&&R(this[Pt],Dt)&&(this[Pt][Dt]=!1),Ee(this,Dt,z(1,Ft))};return m&&Pe&&Ee(Ie,Dt,{configurable:!0,set:B}),te(Dt,nt)},mt(Oe=me[oe],"toString",function(){return le(this).tag}),mt(me,"withoutSetter",function(nt){return te(At(nt),nt)}),it.f=Be,q.f=Ae,V.f=Xe,Y.f=ze,M.f=Z.f=ot,U.f=Et,zt.f=function(nt){return te(Lt(nt),nt)},m&&(wt(Oe,"description",{configurable:!0,get:function(){return le(this).description}}),E||mt(Ie,"propertyIsEnumerable",Be,{unsafe:!0}))),f({global:!0,constructor:!0,wrap:!0,forced:!p,sham:!p},{Symbol:me}),Zt(F(We),function(nt){re(nt)}),f({target:Wt,stat:!0,forced:!p},{useSetter:function(){Pe=!0},useSimple:function(){Pe=!1}}),f({target:"Object",stat:!0,forced:!p,sham:!m},{create:function(nt,Dt){return Dt===void 0?S(nt):Xe(S(nt),Dt)},defineProperty:Ae,defineProperties:Xe,getOwnPropertyDescriptor:ze}),f({target:"Object",stat:!0,forced:!p},{getOwnPropertyNames:ot}),de(),ft(me,Wt),Yt[Pt]=!0},1817:function(O,H,a){var f=a(2109),h=a(9781),g=a(7854),_=a(1702),E=a(2597),m=a(614),p=a(7976),A=a(1340),R=a(7045),D=a(9920),P=g.Symbol,k=P&&P.prototype;if(h&&m(P)&&(!("description"in k)||P().description!==void 0)){var b={},j=function(){var Y=arguments.length<1||arguments[0]===void 0?void 0:A(arguments[0]),q=p(k,this)?new P(Y):Y===void 0?P():P(Y);return Y===""&&(b[q]=!0),q};D(j,P),j.prototype=k,k.constructor=j;var z=String(P("test"))=="Symbol(test)",S=_(k.valueOf),F=_(k.toString),M=/^Symbol\((.*)\)[^)]+$/,Z=_("".replace),U=_("".slice);R(k,"description",{configurable:!0,get:function(){var Y=S(this);if(E(b,Y))return"";var q=F(Y),V=z?U(q,7,-1):Z(q,M,"$1");return V===""?void 0:V}}),f({global:!0,constructor:!0,forced:!0},{Symbol:j})}},763:function(O,H,a){var f=a(2109),h=a(5005),g=a(2597),_=a(1340),E=a(2309),m=a(2015),p=E("string-to-symbol-registry"),A=E("symbol-to-string-registry");f({target:"Symbol",stat:!0,forced:!m},{for:function(R){var D=_(R);if(g(p,D))return p[D];var P=h("Symbol")(D);return p[D]=P,A[P]=D,P}})},2165:function(O,H,a){a(6800)("iterator")},2526:function(O,H,a){a(4032),a(763),a(6620),a(8862),a(9660)},6620:function(O,H,a){var f=a(2109),h=a(2597),g=a(2190),_=a(6330),E=a(2309),m=a(2015),p=E("symbol-to-string-registry");f({target:"Symbol",stat:!0,forced:!m},{keyFor:function(A){if(!g(A))throw TypeError(_(A)+" is not a symbol");if(h(p,A))return p[A]}})},2990:function(O,H,a){var f=a(1702),h=a(260),g=f(a(1048)),_=h.aTypedArray;(0,h.exportTypedArrayMethod)("copyWithin",function(E,m){return g(_(this),E,m,arguments.length>2?arguments[2]:void 0)})},8927:function(O,H,a){var f=a(260),h=a(2092).every,g=f.aTypedArray;(0,f.exportTypedArrayMethod)("every",function(_){return h(g(this),_,arguments.length>1?arguments[1]:void 0)})},3105:function(O,H,a){var f=a(260),h=a(1285),g=a(4599),_=a(648),E=a(6916),m=a(1702),p=a(7293),A=f.aTypedArray,R=f.exportTypedArrayMethod,D=m("".slice);R("fill",function(P){var k=arguments.length;A(this);var b=D(_(this),0,3)==="Big"?g(P):+P;return E(h,this,b,k>1?arguments[1]:void 0,k>2?arguments[2]:void 0)},p(function(){var P=0;return new Int8Array(2).fill({valueOf:function(){return P++}}),P!==1}))},5035:function(O,H,a){var f=a(260),h=a(2092).filter,g=a(3074),_=f.aTypedArray;(0,f.exportTypedArrayMethod)("filter",function(E){var m=h(_(this),E,arguments.length>1?arguments[1]:void 0);return g(this,m)})},7174:function(O,H,a){var f=a(260),h=a(2092).findIndex,g=f.aTypedArray;(0,f.exportTypedArrayMethod)("findIndex",function(_){return h(g(this),_,arguments.length>1?arguments[1]:void 0)})},4345:function(O,H,a){var f=a(260),h=a(2092).find,g=f.aTypedArray;(0,f.exportTypedArrayMethod)("find",function(_){return h(g(this),_,arguments.length>1?arguments[1]:void 0)})},2846:function(O,H,a){var f=a(260),h=a(2092).forEach,g=f.aTypedArray;(0,f.exportTypedArrayMethod)("forEach",function(_){h(g(this),_,arguments.length>1?arguments[1]:void 0)})},8145:function(O,H,a){var f=a(3832);(0,a(260).exportTypedArrayStaticMethod)("from",a(7321),f)},4731:function(O,H,a){var f=a(260),h=a(1318).includes,g=f.aTypedArray;(0,f.exportTypedArrayMethod)("includes",function(_){return h(g(this),_,arguments.length>1?arguments[1]:void 0)})},7209:function(O,H,a){var f=a(260),h=a(1318).indexOf,g=f.aTypedArray;(0,f.exportTypedArrayMethod)("indexOf",function(_){return h(g(this),_,arguments.length>1?arguments[1]:void 0)})},6319:function(O,H,a){var f=a(7854),h=a(7293),g=a(1702),_=a(260),E=a(6992),m=a(5112)("iterator"),p=f.Uint8Array,A=g(E.values),R=g(E.keys),D=g(E.entries),P=_.aTypedArray,k=_.exportTypedArrayMethod,b=p&&p.prototype,j=!h(function(){b[m].call([1])}),z=!!b&&b.values&&b[m]===b.values&&b.values.name==="values",S=function(){return A(P(this))};k("entries",function(){return D(P(this))},j),k("keys",function(){return R(P(this))},j),k("values",S,j||!z,{name:"values"}),k(m,S,j||!z,{name:"values"})},8867:function(O,H,a){var f=a(260),h=a(1702),g=f.aTypedArray,_=f.exportTypedArrayMethod,E=h([].join);_("join",function(m){return E(g(this),m)})},7789:function(O,H,a){var f=a(260),h=a(2104),g=a(6583),_=f.aTypedArray;(0,f.exportTypedArrayMethod)("lastIndexOf",function(E){var m=arguments.length;return h(g,_(this),m>1?[E,arguments[1]]:[E])})},3739:function(O,H,a){var f=a(260),h=a(2092).map,g=a(6304),_=f.aTypedArray;(0,f.exportTypedArrayMethod)("map",function(E){return h(_(this),E,arguments.length>1?arguments[1]:void 0,function(m,p){return new(g(m))(p)})})},4483:function(O,H,a){var f=a(260),h=a(3671).right,g=f.aTypedArray;(0,f.exportTypedArrayMethod)("reduceRight",function(_){var E=arguments.length;return h(g(this),_,E,E>1?arguments[1]:void 0)})},9368:function(O,H,a){var f=a(260),h=a(3671).left,g=f.aTypedArray;(0,f.exportTypedArrayMethod)("reduce",function(_){var E=arguments.length;return h(g(this),_,E,E>1?arguments[1]:void 0)})},2056:function(O,H,a){var f=a(260),h=f.aTypedArray,g=f.exportTypedArrayMethod,_=Math.floor;g("reverse",function(){for(var E,m=this,p=h(m).length,A=_(p/2),R=0;R<A;)E=m[R],m[R++]=m[--p],m[p]=E;return m})},3462:function(O,H,a){var f=a(7854),h=a(6916),g=a(260),_=a(6244),E=a(4590),m=a(7908),p=a(7293),A=f.RangeError,R=f.Int8Array,D=R&&R.prototype,P=D&&D.set,k=g.aTypedArray,b=g.exportTypedArrayMethod,j=!p(function(){var S=new Uint8ClampedArray(2);return h(P,S,{length:1,0:3},1),S[1]!==3}),z=j&&g.NATIVE_ARRAY_BUFFER_VIEWS&&p(function(){var S=new R(2);return S.set(1),S.set("2",1),S[0]!==0||S[1]!==2});b("set",function(S){k(this);var F=E(arguments.length>1?arguments[1]:void 0,1),M=m(S);if(j)return h(P,this,M,F);var Z=this.length,U=_(M),Y=0;if(U+F>Z)throw A("Wrong length");for(;Y<U;)this[F+Y]=M[Y++]},!j||z)},678:function(O,H,a){var f=a(260),h=a(6304),g=a(7293),_=a(206),E=f.aTypedArray;(0,f.exportTypedArrayMethod)("slice",function(m,p){for(var A=_(E(this),m,p),R=h(this),D=0,P=A.length,k=new R(P);P>D;)k[D]=A[D++];return k},g(function(){new Int8Array(1).slice()}))},7462:function(O,H,a){var f=a(260),h=a(2092).some,g=f.aTypedArray;(0,f.exportTypedArrayMethod)("some",function(_){return h(g(this),_,arguments.length>1?arguments[1]:void 0)})},3824:function(O,H,a){var f=a(7854),h=a(1470),g=a(7293),_=a(9662),E=a(4362),m=a(260),p=a(8886),A=a(256),R=a(7392),D=a(8008),P=m.aTypedArray,k=m.exportTypedArrayMethod,b=f.Uint16Array,j=b&&h(b.prototype.sort),z=!(!j||g(function(){j(new b(2),null)})&&g(function(){j(new b(2),{})})),S=!!j&&!g(function(){if(R)return R<74;if(p)return p<67;if(A)return!0;if(D)return D<602;var F,M,Z=new b(516),U=Array(516);for(F=0;F<516;F++)M=F%4,Z[F]=515-F,U[F]=F-2*M+3;for(j(Z,function(Y,q){return(Y/4|0)-(q/4|0)}),F=0;F<516;F++)if(Z[F]!==U[F])return!0});k("sort",function(F){return F!==void 0&&_(F),S?j(this,F):E(P(this),function(M){return function(Z,U){return M!==void 0?+M(Z,U)||0:U!=U?-1:Z!=Z?1:Z===0&&U===0?1/Z>0&&1/U<0?1:-1:Z>U}}(F))},!S||z)},5021:function(O,H,a){var f=a(260),h=a(7466),g=a(1400),_=a(6304),E=f.aTypedArray;(0,f.exportTypedArrayMethod)("subarray",function(m,p){var A=E(this),R=A.length,D=g(m,R);return new(_(A))(A.buffer,A.byteOffset+D*A.BYTES_PER_ELEMENT,h((p===void 0?R:g(p,R))-D))})},2974:function(O,H,a){var f=a(7854),h=a(2104),g=a(260),_=a(7293),E=a(206),m=f.Int8Array,p=g.aTypedArray,A=g.exportTypedArrayMethod,R=[].toLocaleString,D=!!m&&_(function(){R.call(new m(1))});A("toLocaleString",function(){return h(R,D?E(p(this)):p(this),E(arguments))},_(function(){return[1,2].toLocaleString()!=new m([1,2]).toLocaleString()})||!_(function(){m.prototype.toLocaleString.call([1,2])}))},5016:function(O,H,a){var f=a(260).exportTypedArrayMethod,h=a(7293),g=a(7854),_=a(1702),E=g.Uint8Array,m=E&&E.prototype||{},p=[].toString,A=_([].join);h(function(){p.call({})})&&(p=function(){return A(this)});var R=m.toString!=p;f("toString",p,R)},2472:function(O,H,a){a(9843)("Uint8",function(f){return function(h,g,_){return f(this,h,g,_)}})},4747:function(O,H,a){var f=a(7854),h=a(8324),g=a(8509),_=a(8533),E=a(8880),m=function(A){if(A&&A.forEach!==_)try{E(A,"forEach",_)}catch{A.forEach=_}};for(var p in h)h[p]&&m(f[p]&&f[p].prototype);m(g)},3948:function(O,H,a){var f=a(7854),h=a(8324),g=a(8509),_=a(6992),E=a(8880),m=a(5112),p=m("iterator"),A=m("toStringTag"),R=_.values,D=function(k,b){if(k){if(k[p]!==R)try{E(k,p,R)}catch{k[p]=R}if(k[A]||E(k,A,b),h[b]){for(var j in _)if(k[j]!==_[j])try{E(k,j,_[j])}catch{k[j]=_[j]}}}};for(var P in h)D(f[P]&&f[P].prototype,P);D(g,"DOMTokenList")},6815:function(O,H,a){var f=a(2109),h=a(7854),g=a(7152)(h.setInterval,!0);f({global:!0,bind:!0,forced:h.setInterval!==g},{setInterval:g})},8417:function(O,H,a){var f=a(2109),h=a(7854),g=a(7152)(h.setTimeout,!0);f({global:!0,bind:!0,forced:h.setTimeout!==g},{setTimeout:g})},2564:function(O,H,a){a(6815),a(8417)},5556:function(O,H,a){a(6992);var f=a(2109),h=a(7854),g=a(6916),_=a(1702),E=a(9781),m=a(5143),p=a(8052),A=a(7045),R=a(9190),D=a(8003),P=a(3061),k=a(9909),b=a(5787),j=a(614),z=a(2597),S=a(9974),F=a(648),M=a(9670),Z=a(111),U=a(1340),Y=a(30),q=a(9114),V=a(4121),it=a(1246),mt=a(8053),wt=a(5112),yt=a(4362),Ht=wt("iterator"),Yt="URLSearchParams",At=Yt+"Iterator",Lt=k.set,zt=k.getterFor(Yt),re=k.getterFor(At),de=Object.getOwnPropertyDescriptor,ft=function(Nt){if(!E)return h[Nt];var Ut=de(h,Nt);return Ut&&Ut.value},gt=ft("fetch"),Zt=ft("Request"),Pt=ft("Headers"),Wt=Zt&&Zt.prototype,oe=Pt&&Pt.prototype,fe=h.RegExp,le=h.TypeError,Ie=h.decodeURIComponent,me=h.encodeURIComponent,Oe=_("".charAt),je=_([].join),xe=_([].push),ir=_("".replace),He=_([].shift),ae=_([].splice),Ne=_("".split),Ze=_("".slice),ee=/\+/g,be=Array(4),We=function(Nt){return be[Nt-1]||(be[Nt-1]=fe("((?:%[\\da-f]{2}){"+Nt+"})","gi"))},Pe=function(Nt){try{return Ie(Nt)}catch{return Nt}},Ee=function(Nt){var Ut=ir(Nt,ee," "),Xt=4;try{return Ie(Ut)}catch{for(;Xt;)Ut=ir(Ut,We(Xt--),Pe);return Ut}},te=/[!'()~]|%20/g,Ae={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Xe=function(Nt){return Ae[Nt]},Be=function(Nt){return ir(me(Nt),te,Xe)},ze=P(function(Nt,Ut){Lt(this,{type:At,iterator:V(zt(Nt).entries),kind:Ut})},"Iterator",function(){var Nt=re(this),Ut=Nt.kind,Xt=Nt.iterator.next(),Gt=Xt.value;return Xt.done||(Xt.value=Ut==="keys"?Gt.key:Ut==="values"?Gt.value:[Gt.key,Gt.value]),Xt},!0),ot=function(Nt){this.entries=[],this.url=null,Nt!==void 0&&(Z(Nt)?this.parseObject(Nt):this.parseQuery(typeof Nt=="string"?Oe(Nt,0)==="?"?Ze(Nt,1):Nt:U(Nt)))};ot.prototype={type:Yt,bindURL:function(Nt){this.url=Nt,this.update()},parseObject:function(Nt){var Ut,Xt,Gt,ne,Re,pe,Je,I=it(Nt);if(I)for(Xt=(Ut=V(Nt,I)).next;!(Gt=g(Xt,Ut)).done;){if(Re=(ne=V(M(Gt.value))).next,(pe=g(Re,ne)).done||(Je=g(Re,ne)).done||!g(Re,ne).done)throw le("Expected sequence with length 2");xe(this.entries,{key:U(pe.value),value:U(Je.value)})}else for(var X in Nt)z(Nt,X)&&xe(this.entries,{key:X,value:U(Nt[X])})},parseQuery:function(Nt){if(Nt)for(var Ut,Xt,Gt=Ne(Nt,"&"),ne=0;ne<Gt.length;)(Ut=Gt[ne++]).length&&(Xt=Ne(Ut,"="),xe(this.entries,{key:Ee(He(Xt)),value:Ee(je(Xt,"="))}))},serialize:function(){for(var Nt,Ut=this.entries,Xt=[],Gt=0;Gt<Ut.length;)Nt=Ut[Gt++],xe(Xt,Be(Nt.key)+"="+Be(Nt.value));return je(Xt,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Et=function(){b(this,nt);var Nt=Lt(this,new ot(arguments.length>0?arguments[0]:void 0));E||(this.length=Nt.entries.length)},nt=Et.prototype;if(R(nt,{append:function(Nt,Ut){mt(arguments.length,2);var Xt=zt(this);xe(Xt.entries,{key:U(Nt),value:U(Ut)}),E||this.length++,Xt.updateURL()},delete:function(Nt){mt(arguments.length,1);for(var Ut=zt(this),Xt=Ut.entries,Gt=U(Nt),ne=0;ne<Xt.length;)Xt[ne].key===Gt?ae(Xt,ne,1):ne++;E||(this.length=Xt.length),Ut.updateURL()},get:function(Nt){mt(arguments.length,1);for(var Ut=zt(this).entries,Xt=U(Nt),Gt=0;Gt<Ut.length;Gt++)if(Ut[Gt].key===Xt)return Ut[Gt].value;return null},getAll:function(Nt){mt(arguments.length,1);for(var Ut=zt(this).entries,Xt=U(Nt),Gt=[],ne=0;ne<Ut.length;ne++)Ut[ne].key===Xt&&xe(Gt,Ut[ne].value);return Gt},has:function(Nt){mt(arguments.length,1);for(var Ut=zt(this).entries,Xt=U(Nt),Gt=0;Gt<Ut.length;)if(Ut[Gt++].key===Xt)return!0;return!1},set:function(Nt,Ut){mt(arguments.length,1);for(var Xt,Gt=zt(this),ne=Gt.entries,Re=!1,pe=U(Nt),Je=U(Ut),I=0;I<ne.length;I++)(Xt=ne[I]).key===pe&&(Re?ae(ne,I--,1):(Re=!0,Xt.value=Je));Re||xe(ne,{key:pe,value:Je}),E||(this.length=ne.length),Gt.updateURL()},sort:function(){var Nt=zt(this);yt(Nt.entries,function(Ut,Xt){return Ut.key>Xt.key?1:-1}),Nt.updateURL()},forEach:function(Nt){for(var Ut,Xt=zt(this).entries,Gt=S(Nt,arguments.length>1?arguments[1]:void 0),ne=0;ne<Xt.length;)Gt((Ut=Xt[ne++]).value,Ut.key,this)},keys:function(){return new ze(this,"keys")},values:function(){return new ze(this,"values")},entries:function(){return new ze(this,"entries")}},{enumerable:!0}),p(nt,Ht,nt.entries,{name:"entries"}),p(nt,"toString",function(){return zt(this).serialize()},{enumerable:!0}),E&&A(nt,"size",{get:function(){return zt(this).entries.length},configurable:!0,enumerable:!0}),D(Et,Yt),f({global:!0,constructor:!0,forced:!m},{URLSearchParams:Et}),!m&&j(Pt)){var Dt=_(oe.has),B=_(oe.set),Ft=function(Nt){if(Z(Nt)){var Ut,Xt=Nt.body;if(F(Xt)===Yt)return Ut=Nt.headers?new Pt(Nt.headers):new Pt,Dt(Ut,"content-type")||B(Ut,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Y(Nt,{body:q(0,U(Xt)),headers:q(0,Ut)})}return Nt};if(j(gt)&&f({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(Nt){return gt(Nt,arguments.length>1?Ft(arguments[1]):{})}}),j(Zt)){var St=function(Nt){return b(this,Wt),new Zt(Nt,arguments.length>1?Ft(arguments[1]):{})};Wt.constructor=St,St.prototype=Wt,f({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:St})}}O.exports={URLSearchParams:Et,getState:zt}},1637:function(O,H,a){a(5556)},8789:function(O,H,a){a(8783);var f,h=a(2109),g=a(9781),_=a(5143),E=a(7854),m=a(9974),p=a(1702),A=a(8052),R=a(7045),D=a(5787),P=a(2597),k=a(1574),b=a(8457),j=a(1589),z=a(8710).codeAt,S=a(3197),F=a(1340),M=a(8003),Z=a(8053),U=a(5556),Y=a(9909),q=Y.set,V=Y.getterFor("URL"),it=U.URLSearchParams,mt=U.getState,wt=E.URL,yt=E.TypeError,Ht=E.parseInt,Yt=Math.floor,At=Math.pow,Lt=p("".charAt),zt=p(/./.exec),re=p([].join),de=p(1 .toString),ft=p([].pop),gt=p([].push),Zt=p("".replace),Pt=p([].shift),Wt=p("".split),oe=p("".slice),fe=p("".toLowerCase),le=p([].unshift),Ie="Invalid scheme",me="Invalid host",Oe="Invalid port",je=/[a-z]/i,xe=/[\d+-.a-z]/i,ir=/\d/,He=/^0x/i,ae=/^[0-7]+$/,Ne=/^\d+$/,Ze=/^[\da-f]+$/i,ee=/[\0\t\n\r #%/:<>?@[\\\]^|]/,be=/[\0\t\n\r #/:<>?@[\\\]^|]/,We=/^[\u0000-\u0020]+/,Pe=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Ee=/[\t\n\r]/g,te=function(Ot){var Mt,qt,he,Jt;if(typeof Ot=="number"){for(Mt=[],qt=0;qt<4;qt++)le(Mt,Ot%256),Ot=Yt(Ot/256);return re(Mt,".")}if(typeof Ot=="object"){for(Mt="",he=function(Ve){for(var Ye=null,or=1,ue=null,tr=0,Pr=0;Pr<8;Pr++)Ve[Pr]!==0?(tr>or&&(Ye=ue,or=tr),ue=null,tr=0):(ue===null&&(ue=Pr),++tr);return tr>or&&(Ye=ue,or=tr),Ye}(Ot),qt=0;qt<8;qt++)Jt&&Ot[qt]===0||(Jt&&(Jt=!1),he===qt?(Mt+=qt?":":"::",Jt=!0):(Mt+=de(Ot[qt],16),qt<7&&(Mt+=":")));return"["+Mt+"]"}return Ot},Ae={},Xe=k({},Ae,{" ":1,'"':1,"<":1,">":1,"`":1}),Be=k({},Xe,{"#":1,"?":1,"{":1,"}":1}),ze=k({},Be,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),ot=function(Ot,Mt){var qt=z(Ot,0);return qt>32&&qt<127&&!P(Mt,Ot)?Ot:encodeURIComponent(Ot)},Et={ftp:21,file:null,http:80,https:443,ws:80,wss:443},nt=function(Ot,Mt){var qt;return Ot.length==2&&zt(je,Lt(Ot,0))&&((qt=Lt(Ot,1))==":"||!Mt&&qt=="|")},Dt=function(Ot){var Mt;return Ot.length>1&&nt(oe(Ot,0,2))&&(Ot.length==2||(Mt=Lt(Ot,2))==="/"||Mt==="\\"||Mt==="?"||Mt==="#")},B=function(Ot){return Ot==="."||fe(Ot)==="%2e"},Ft={},St={},Nt={},Ut={},Xt={},Gt={},ne={},Re={},pe={},Je={},I={},X={},_t={},K={},dt={},bt={},rt={},Vt={},ut={},Kt={},jt={},ge=function(Ot,Mt,qt){var he,Jt,Ve,Ye=F(Ot);if(Mt){if(Jt=this.parse(Ye))throw yt(Jt);this.searchParams=null}else{if(qt!==void 0&&(he=new ge(qt,!0)),Jt=this.parse(Ye,null,he))throw yt(Jt);(Ve=mt(new it)).bindURL(this),this.searchParams=Ve}};ge.prototype={type:"URL",parse:function(Ot,Mt,qt){var he,Jt,Ve,Ye,or,ue=this,tr=Mt||Ft,Pr=0,_r="",en=!1,tn=!1,Kn=!1;for(Ot=F(Ot),Mt||(ue.scheme="",ue.username="",ue.password="",ue.host=null,ue.port=null,ue.path=[],ue.query=null,ue.fragment=null,ue.cannotBeABaseURL=!1,Ot=Zt(Ot,We,""),Ot=Zt(Ot,Pe,"$1")),Ot=Zt(Ot,Ee,""),he=b(Ot);Pr<=he.length;){switch(Jt=he[Pr],tr){case Ft:if(!Jt||!zt(je,Jt)){if(Mt)return Ie;tr=Nt;continue}_r+=fe(Jt),tr=St;break;case St:if(Jt&&(zt(xe,Jt)||Jt=="+"||Jt=="-"||Jt=="."))_r+=fe(Jt);else{if(Jt!=":"){if(Mt)return Ie;_r="",tr=Nt,Pr=0;continue}if(Mt&&(ue.isSpecial()!=P(Et,_r)||_r=="file"&&(ue.includesCredentials()||ue.port!==null)||ue.scheme=="file"&&!ue.host))return;if(ue.scheme=_r,Mt)return void(ue.isSpecial()&&Et[ue.scheme]==ue.port&&(ue.port=null));_r="",ue.scheme=="file"?tr=K:ue.isSpecial()&&qt&&qt.scheme==ue.scheme?tr=Ut:ue.isSpecial()?tr=Re:he[Pr+1]=="/"?(tr=Xt,Pr++):(ue.cannotBeABaseURL=!0,gt(ue.path,""),tr=ut)}break;case Nt:if(!qt||qt.cannotBeABaseURL&&Jt!="#")return Ie;if(qt.cannotBeABaseURL&&Jt=="#"){ue.scheme=qt.scheme,ue.path=j(qt.path),ue.query=qt.query,ue.fragment="",ue.cannotBeABaseURL=!0,tr=jt;break}tr=qt.scheme=="file"?K:Gt;continue;case Ut:if(Jt!="/"||he[Pr+1]!="/"){tr=Gt;continue}tr=pe,Pr++;break;case Xt:if(Jt=="/"){tr=Je;break}tr=Vt;continue;case Gt:if(ue.scheme=qt.scheme,Jt==f)ue.username=qt.username,ue.password=qt.password,ue.host=qt.host,ue.port=qt.port,ue.path=j(qt.path),ue.query=qt.query;else if(Jt=="/"||Jt=="\\"&&ue.isSpecial())tr=ne;else if(Jt=="?")ue.username=qt.username,ue.password=qt.password,ue.host=qt.host,ue.port=qt.port,ue.path=j(qt.path),ue.query="",tr=Kt;else{if(Jt!="#"){ue.username=qt.username,ue.password=qt.password,ue.host=qt.host,ue.port=qt.port,ue.path=j(qt.path),ue.path.length--,tr=Vt;continue}ue.username=qt.username,ue.password=qt.password,ue.host=qt.host,ue.port=qt.port,ue.path=j(qt.path),ue.query=qt.query,ue.fragment="",tr=jt}break;case ne:if(!ue.isSpecial()||Jt!="/"&&Jt!="\\"){if(Jt!="/"){ue.username=qt.username,ue.password=qt.password,ue.host=qt.host,ue.port=qt.port,tr=Vt;continue}tr=Je}else tr=pe;break;case Re:if(tr=pe,Jt!="/"||Lt(_r,Pr+1)!="/")continue;Pr++;break;case pe:if(Jt!="/"&&Jt!="\\"){tr=Je;continue}break;case Je:if(Jt=="@"){en&&(_r="%40"+_r),en=!0,Ve=b(_r);for(var Ln=0;Ln<Ve.length;Ln++){var ln=Ve[Ln];if(ln!=":"||Kn){var hi=ot(ln,ze);Kn?ue.password+=hi:ue.username+=hi}else Kn=!0}_r=""}else if(Jt==f||Jt=="/"||Jt=="?"||Jt=="#"||Jt=="\\"&&ue.isSpecial()){if(en&&_r=="")return"Invalid authority";Pr-=b(_r).length+1,_r="",tr=I}else _r+=Jt;break;case I:case X:if(Mt&&ue.scheme=="file"){tr=bt;continue}if(Jt!=":"||tn){if(Jt==f||Jt=="/"||Jt=="?"||Jt=="#"||Jt=="\\"&&ue.isSpecial()){if(ue.isSpecial()&&_r=="")return me;if(Mt&&_r==""&&(ue.includesCredentials()||ue.port!==null))return;if(Ye=ue.parseHost(_r))return Ye;if(_r="",tr=rt,Mt)return;continue}Jt=="["?tn=!0:Jt=="]"&&(tn=!1),_r+=Jt}else{if(_r=="")return me;if(Ye=ue.parseHost(_r))return Ye;if(_r="",tr=_t,Mt==X)return}break;case _t:if(!zt(ir,Jt)){if(Jt==f||Jt=="/"||Jt=="?"||Jt=="#"||Jt=="\\"&&ue.isSpecial()||Mt){if(_r!=""){var Xi=Ht(_r,10);if(Xi>65535)return Oe;ue.port=ue.isSpecial()&&Xi===Et[ue.scheme]?null:Xi,_r=""}if(Mt)return;tr=rt;continue}return Oe}_r+=Jt;break;case K:if(ue.scheme="file",Jt=="/"||Jt=="\\")tr=dt;else{if(!qt||qt.scheme!="file"){tr=Vt;continue}if(Jt==f)ue.host=qt.host,ue.path=j(qt.path),ue.query=qt.query;else if(Jt=="?")ue.host=qt.host,ue.path=j(qt.path),ue.query="",tr=Kt;else{if(Jt!="#"){Dt(re(j(he,Pr),""))||(ue.host=qt.host,ue.path=j(qt.path),ue.shortenPath()),tr=Vt;continue}ue.host=qt.host,ue.path=j(qt.path),ue.query=qt.query,ue.fragment="",tr=jt}}break;case dt:if(Jt=="/"||Jt=="\\"){tr=bt;break}qt&&qt.scheme=="file"&&!Dt(re(j(he,Pr),""))&&(nt(qt.path[0],!0)?gt(ue.path,qt.path[0]):ue.host=qt.host),tr=Vt;continue;case bt:if(Jt==f||Jt=="/"||Jt=="\\"||Jt=="?"||Jt=="#"){if(!Mt&&nt(_r))tr=Vt;else if(_r==""){if(ue.host="",Mt)return;tr=rt}else{if(Ye=ue.parseHost(_r))return Ye;if(ue.host=="localhost"&&(ue.host=""),Mt)return;_r="",tr=rt}continue}_r+=Jt;break;case rt:if(ue.isSpecial()){if(tr=Vt,Jt!="/"&&Jt!="\\")continue}else if(Mt||Jt!="?")if(Mt||Jt!="#"){if(Jt!=f&&(tr=Vt,Jt!="/"))continue}else ue.fragment="",tr=jt;else ue.query="",tr=Kt;break;case Vt:if(Jt==f||Jt=="/"||Jt=="\\"&&ue.isSpecial()||!Mt&&(Jt=="?"||Jt=="#")){if((or=fe(or=_r))===".."||or==="%2e."||or===".%2e"||or==="%2e%2e"?(ue.shortenPath(),Jt=="/"||Jt=="\\"&&ue.isSpecial()||gt(ue.path,"")):B(_r)?Jt=="/"||Jt=="\\"&&ue.isSpecial()||gt(ue.path,""):(ue.scheme=="file"&&!ue.path.length&&nt(_r)&&(ue.host&&(ue.host=""),_r=Lt(_r,0)+":"),gt(ue.path,_r)),_r="",ue.scheme=="file"&&(Jt==f||Jt=="?"||Jt=="#"))for(;ue.path.length>1&&ue.path[0]==="";)Pt(ue.path);Jt=="?"?(ue.query="",tr=Kt):Jt=="#"&&(ue.fragment="",tr=jt)}else _r+=ot(Jt,Be);break;case ut:Jt=="?"?(ue.query="",tr=Kt):Jt=="#"?(ue.fragment="",tr=jt):Jt!=f&&(ue.path[0]+=ot(Jt,Ae));break;case Kt:Mt||Jt!="#"?Jt!=f&&(Jt=="'"&&ue.isSpecial()?ue.query+="%27":ue.query+=Jt=="#"?"%23":ot(Jt,Ae)):(ue.fragment="",tr=jt);break;case jt:Jt!=f&&(ue.fragment+=ot(Jt,Xe))}Pr++}},parseHost:function(Ot){var Mt,qt,he;if(Lt(Ot,0)=="["){if(Lt(Ot,Ot.length-1)!="]"||(Mt=function(Jt){var Ve,Ye,or,ue,tr,Pr,_r,en=[0,0,0,0,0,0,0,0],tn=0,Kn=null,Ln=0,ln=function(){return Lt(Jt,Ln)};if(ln()==":"){if(Lt(Jt,1)!=":")return;Ln+=2,Kn=++tn}for(;ln();){if(tn==8)return;if(ln()!=":"){for(Ve=Ye=0;Ye<4&&zt(Ze,ln());)Ve=16*Ve+Ht(ln(),16),Ln++,Ye++;if(ln()=="."){if(Ye==0||(Ln-=Ye,tn>6))return;for(or=0;ln();){if(ue=null,or>0){if(!(ln()=="."&&or<4))return;Ln++}if(!zt(ir,ln()))return;for(;zt(ir,ln());){if(tr=Ht(ln(),10),ue===null)ue=tr;else{if(ue==0)return;ue=10*ue+tr}if(ue>255)return;Ln++}en[tn]=256*en[tn]+ue,++or!=2&&or!=4||tn++}if(or!=4)return;break}if(ln()==":"){if(Ln++,!ln())return}else if(ln())return;en[tn++]=Ve}else{if(Kn!==null)return;Ln++,Kn=++tn}}if(Kn!==null)for(Pr=tn-Kn,tn=7;tn!=0&&Pr>0;)_r=en[tn],en[tn--]=en[Kn+Pr-1],en[Kn+--Pr]=_r;else if(tn!=8)return;return en}(oe(Ot,1,-1)),!Mt))return me;this.host=Mt}else if(this.isSpecial()){if(Ot=S(Ot),zt(ee,Ot)||(Mt=function(Jt){var Ve,Ye,or,ue,tr,Pr,_r,en=Wt(Jt,".");if(en.length&&en[en.length-1]==""&&en.length--,(Ve=en.length)>4)return Jt;for(Ye=[],or=0;or<Ve;or++){if((ue=en[or])=="")return Jt;if(tr=10,ue.length>1&&Lt(ue,0)=="0"&&(tr=zt(He,ue)?16:8,ue=oe(ue,tr==8?1:2)),ue==="")Pr=0;else{if(!zt(tr==10?Ne:tr==8?ae:Ze,ue))return Jt;Pr=Ht(ue,tr)}gt(Ye,Pr)}for(or=0;or<Ve;or++)if(Pr=Ye[or],or==Ve-1){if(Pr>=At(256,5-Ve))return null}else if(Pr>255)return null;for(_r=ft(Ye),or=0;or<Ye.length;or++)_r+=Ye[or]*At(256,3-or);return _r}(Ot),Mt===null))return me;this.host=Mt}else{if(zt(be,Ot))return me;for(Mt="",qt=b(Ot),he=0;he<qt.length;he++)Mt+=ot(qt[he],Ae);this.host=Mt}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return P(Et,this.scheme)},shortenPath:function(){var Ot=this.path,Mt=Ot.length;!Mt||this.scheme=="file"&&Mt==1&&nt(Ot[0],!0)||Ot.length--},serialize:function(){var Ot=this,Mt=Ot.scheme,qt=Ot.username,he=Ot.password,Jt=Ot.host,Ve=Ot.port,Ye=Ot.path,or=Ot.query,ue=Ot.fragment,tr=Mt+":";return Jt!==null?(tr+="//",Ot.includesCredentials()&&(tr+=qt+(he?":"+he:"")+"@"),tr+=te(Jt),Ve!==null&&(tr+=":"+Ve)):Mt=="file"&&(tr+="//"),tr+=Ot.cannotBeABaseURL?Ye[0]:Ye.length?"/"+re(Ye,"/"):"",or!==null&&(tr+="?"+or),ue!==null&&(tr+="#"+ue),tr},setHref:function(Ot){var Mt=this.parse(Ot);if(Mt)throw yt(Mt);this.searchParams.update()},getOrigin:function(){var Ot=this.scheme,Mt=this.port;if(Ot=="blob")try{return new W(Ot.path[0]).origin}catch{return"null"}return Ot!="file"&&this.isSpecial()?Ot+"://"+te(this.host)+(Mt!==null?":"+Mt:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(Ot){this.parse(F(Ot)+":",Ft)},getUsername:function(){return this.username},setUsername:function(Ot){var Mt=b(F(Ot));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var qt=0;qt<Mt.length;qt++)this.username+=ot(Mt[qt],ze)}},getPassword:function(){return this.password},setPassword:function(Ot){var Mt=b(F(Ot));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var qt=0;qt<Mt.length;qt++)this.password+=ot(Mt[qt],ze)}},getHost:function(){var Ot=this.host,Mt=this.port;return Ot===null?"":Mt===null?te(Ot):te(Ot)+":"+Mt},setHost:function(Ot){this.cannotBeABaseURL||this.parse(Ot,I)},getHostname:function(){var Ot=this.host;return Ot===null?"":te(Ot)},setHostname:function(Ot){this.cannotBeABaseURL||this.parse(Ot,X)},getPort:function(){var Ot=this.port;return Ot===null?"":F(Ot)},setPort:function(Ot){this.cannotHaveUsernamePasswordPort()||((Ot=F(Ot))==""?this.port=null:this.parse(Ot,_t))},getPathname:function(){var Ot=this.path;return this.cannotBeABaseURL?Ot[0]:Ot.length?"/"+re(Ot,"/"):""},setPathname:function(Ot){this.cannotBeABaseURL||(this.path=[],this.parse(Ot,rt))},getSearch:function(){var Ot=this.query;return Ot?"?"+Ot:""},setSearch:function(Ot){(Ot=F(Ot))==""?this.query=null:(Lt(Ot,0)=="?"&&(Ot=oe(Ot,1)),this.query="",this.parse(Ot,Kt)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var Ot=this.fragment;return Ot?"#"+Ot:""},setHash:function(Ot){(Ot=F(Ot))!=""?(Lt(Ot,0)=="#"&&(Ot=oe(Ot,1)),this.fragment="",this.parse(Ot,jt)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var W=function(Ot){var Mt=D(this,lt),qt=Z(arguments.length,1)>1?arguments[1]:void 0,he=q(Mt,new ge(Ot,!1,qt));g||(Mt.href=he.serialize(),Mt.origin=he.getOrigin(),Mt.protocol=he.getProtocol(),Mt.username=he.getUsername(),Mt.password=he.getPassword(),Mt.host=he.getHost(),Mt.hostname=he.getHostname(),Mt.port=he.getPort(),Mt.pathname=he.getPathname(),Mt.search=he.getSearch(),Mt.searchParams=he.getSearchParams(),Mt.hash=he.getHash())},lt=W.prototype,ct=function(Ot,Mt){return{get:function(){return V(this)[Ot]()},set:Mt&&function(qt){return V(this)[Mt](qt)},configurable:!0,enumerable:!0}};if(g&&(R(lt,"href",ct("serialize","setHref")),R(lt,"origin",ct("getOrigin")),R(lt,"protocol",ct("getProtocol","setProtocol")),R(lt,"username",ct("getUsername","setUsername")),R(lt,"password",ct("getPassword","setPassword")),R(lt,"host",ct("getHost","setHost")),R(lt,"hostname",ct("getHostname","setHostname")),R(lt,"port",ct("getPort","setPort")),R(lt,"pathname",ct("getPathname","setPathname")),R(lt,"search",ct("getSearch","setSearch")),R(lt,"searchParams",ct("getSearchParams")),R(lt,"hash",ct("getHash","setHash"))),A(lt,"toJSON",function(){return V(this).serialize()},{enumerable:!0}),A(lt,"toString",function(){return V(this).serialize()},{enumerable:!0}),wt){var It=wt.createObjectURL,Ct=wt.revokeObjectURL;It&&A(W,"createObjectURL",m(It,wt)),Ct&&A(W,"revokeObjectURL",m(Ct,wt))}M(W,"URL"),h({global:!0,constructor:!0,forced:!_,sham:!g},{URL:W})},285:function(O,H,a){a(8789)},5717:function(O){typeof Object.create=="function"?O.exports=function(H,a){a&&(H.super_=a,H.prototype=Object.create(a.prototype,{constructor:{value:H,enumerable:!1,writable:!0,configurable:!0}}))}:O.exports=function(H,a){if(a){H.super_=a;var f=function(){};f.prototype=a.prototype,H.prototype=new f,H.prototype.constructor=H}}},3720:function(O){O.exports=a;var H=null;try{H=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function a(V,it,mt){this.low=0|V,this.high=0|it,this.unsigned=!!mt}function f(V){return(V&&V.__isLong__)===!0}a.prototype.__isLong__,Object.defineProperty(a.prototype,"__isLong__",{value:!0}),a.isLong=f;var h={},g={};function _(V,it){var mt,wt,yt;return it?(yt=0<=(V>>>=0)&&V<256)&&(wt=g[V])?wt:(mt=m(V,(0|V)<0?-1:0,!0),yt&&(g[V]=mt),mt):(yt=-128<=(V|=0)&&V<128)&&(wt=h[V])?wt:(mt=m(V,V<0?-1:0,!1),yt&&(h[V]=mt),mt)}function E(V,it){if(isNaN(V))return it?z:j;if(it){if(V<0)return z;if(V>=P)return U}else{if(V<=-k)return Y;if(V+1>=k)return Z}return V<0?E(-V,it).neg():m(V%D|0,V/D|0,it)}function m(V,it,mt){return new a(V,it,mt)}a.fromInt=_,a.fromNumber=E,a.fromBits=m;var p=Math.pow;function A(V,it,mt){if(V.length===0)throw Error("empty string");if(V==="NaN"||V==="Infinity"||V==="+Infinity"||V==="-Infinity")return j;if(typeof it=="number"?(mt=it,it=!1):it=!!it,(mt=mt||10)<2||36<mt)throw RangeError("radix");var wt;if((wt=V.indexOf("-"))>0)throw Error("interior hyphen");if(wt===0)return A(V.substring(1),it,mt).neg();for(var yt=E(p(mt,8)),Ht=j,Yt=0;Yt<V.length;Yt+=8){var At=Math.min(8,V.length-Yt),Lt=parseInt(V.substring(Yt,Yt+At),mt);if(At<8){var zt=E(p(mt,At));Ht=Ht.mul(zt).add(E(Lt))}else Ht=(Ht=Ht.mul(yt)).add(E(Lt))}return Ht.unsigned=it,Ht}function R(V,it){return typeof V=="number"?E(V,it):typeof V=="string"?A(V,it):m(V.low,V.high,typeof it=="boolean"?it:V.unsigned)}a.fromString=A,a.fromValue=R;var D=4294967296,P=D*D,k=P/2,b=_(1<<24),j=_(0);a.ZERO=j;var z=_(0,!0);a.UZERO=z;var S=_(1);a.ONE=S;var F=_(1,!0);a.UONE=F;var M=_(-1);a.NEG_ONE=M;var Z=m(-1,2147483647,!1);a.MAX_VALUE=Z;var U=m(-1,-1,!0);a.MAX_UNSIGNED_VALUE=U;var Y=m(0,-2147483648,!1);a.MIN_VALUE=Y;var q=a.prototype;q.toInt=function(){return this.unsigned?this.low>>>0:this.low},q.toNumber=function(){return this.unsigned?(this.high>>>0)*D+(this.low>>>0):this.high*D+(this.low>>>0)},q.toString=function(V){if((V=V||10)<2||36<V)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(Y)){var it=E(V),mt=this.div(it),wt=mt.mul(it).sub(this);return mt.toString(V)+wt.toInt().toString(V)}return"-"+this.neg().toString(V)}for(var yt=E(p(V,6),this.unsigned),Ht=this,Yt="";;){var At=Ht.div(yt),Lt=(Ht.sub(At.mul(yt)).toInt()>>>0).toString(V);if((Ht=At).isZero())return Lt+Yt;for(;Lt.length<6;)Lt="0"+Lt;Yt=""+Lt+Yt}},q.getHighBits=function(){return this.high},q.getHighBitsUnsigned=function(){return this.high>>>0},q.getLowBits=function(){return this.low},q.getLowBitsUnsigned=function(){return this.low>>>0},q.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Y)?64:this.neg().getNumBitsAbs();for(var V=this.high!=0?this.high:this.low,it=31;it>0&&!(V&1<<it);it--);return this.high!=0?it+33:it+1},q.isZero=function(){return this.high===0&&this.low===0},q.eqz=q.isZero,q.isNegative=function(){return!this.unsigned&&this.high<0},q.isPositive=function(){return this.unsigned||this.high>=0},q.isOdd=function(){return(1&this.low)==1},q.isEven=function(){return(1&this.low)==0},q.equals=function(V){return f(V)||(V=R(V)),(this.unsigned===V.unsigned||this.high>>>31!=1||V.high>>>31!=1)&&this.high===V.high&&this.low===V.low},q.eq=q.equals,q.notEquals=function(V){return!this.eq(V)},q.neq=q.notEquals,q.ne=q.notEquals,q.lessThan=function(V){return this.comp(V)<0},q.lt=q.lessThan,q.lessThanOrEqual=function(V){return this.comp(V)<=0},q.lte=q.lessThanOrEqual,q.le=q.lessThanOrEqual,q.greaterThan=function(V){return this.comp(V)>0},q.gt=q.greaterThan,q.greaterThanOrEqual=function(V){return this.comp(V)>=0},q.gte=q.greaterThanOrEqual,q.ge=q.greaterThanOrEqual,q.compare=function(V){if(f(V)||(V=R(V)),this.eq(V))return 0;var it=this.isNegative(),mt=V.isNegative();return it&&!mt?-1:!it&&mt?1:this.unsigned?V.high>>>0>this.high>>>0||V.high===this.high&&V.low>>>0>this.low>>>0?-1:1:this.sub(V).isNegative()?-1:1},q.comp=q.compare,q.negate=function(){return!this.unsigned&&this.eq(Y)?Y:this.not().add(S)},q.neg=q.negate,q.add=function(V){f(V)||(V=R(V));var it=this.high>>>16,mt=65535&this.high,wt=this.low>>>16,yt=65535&this.low,Ht=V.high>>>16,Yt=65535&V.high,At=V.low>>>16,Lt=0,zt=0,re=0,de=0;return re+=(de+=yt+(65535&V.low))>>>16,zt+=(re+=wt+At)>>>16,Lt+=(zt+=mt+Yt)>>>16,Lt+=it+Ht,m((re&=65535)<<16|(de&=65535),(Lt&=65535)<<16|(zt&=65535),this.unsigned)},q.subtract=function(V){return f(V)||(V=R(V)),this.add(V.neg())},q.sub=q.subtract,q.multiply=function(V){if(this.isZero())return j;if(f(V)||(V=R(V)),H)return m(H.mul(this.low,this.high,V.low,V.high),H.get_high(),this.unsigned);if(V.isZero())return j;if(this.eq(Y))return V.isOdd()?Y:j;if(V.eq(Y))return this.isOdd()?Y:j;if(this.isNegative())return V.isNegative()?this.neg().mul(V.neg()):this.neg().mul(V).neg();if(V.isNegative())return this.mul(V.neg()).neg();if(this.lt(b)&&V.lt(b))return E(this.toNumber()*V.toNumber(),this.unsigned);var it=this.high>>>16,mt=65535&this.high,wt=this.low>>>16,yt=65535&this.low,Ht=V.high>>>16,Yt=65535&V.high,At=V.low>>>16,Lt=65535&V.low,zt=0,re=0,de=0,ft=0;return de+=(ft+=yt*Lt)>>>16,re+=(de+=wt*Lt)>>>16,de&=65535,re+=(de+=yt*At)>>>16,zt+=(re+=mt*Lt)>>>16,re&=65535,zt+=(re+=wt*At)>>>16,re&=65535,zt+=(re+=yt*Yt)>>>16,zt+=it*Lt+mt*At+wt*Yt+yt*Ht,m((de&=65535)<<16|(ft&=65535),(zt&=65535)<<16|(re&=65535),this.unsigned)},q.mul=q.multiply,q.divide=function(V){if(f(V)||(V=R(V)),V.isZero())throw Error("division by zero");var it,mt,wt;if(H)return this.unsigned||this.high!==-2147483648||V.low!==-1||V.high!==-1?m((this.unsigned?H.div_u:H.div_s)(this.low,this.high,V.low,V.high),H.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?z:j;if(this.unsigned){if(V.unsigned||(V=V.toUnsigned()),V.gt(this))return z;if(V.gt(this.shru(1)))return F;wt=z}else{if(this.eq(Y))return V.eq(S)||V.eq(M)?Y:V.eq(Y)?S:(it=this.shr(1).div(V).shl(1)).eq(j)?V.isNegative()?S:M:(mt=this.sub(V.mul(it)),wt=it.add(mt.div(V)));if(V.eq(Y))return this.unsigned?z:j;if(this.isNegative())return V.isNegative()?this.neg().div(V.neg()):this.neg().div(V).neg();if(V.isNegative())return this.div(V.neg()).neg();wt=j}for(mt=this;mt.gte(V);){it=Math.max(1,Math.floor(mt.toNumber()/V.toNumber()));for(var yt=Math.ceil(Math.log(it)/Math.LN2),Ht=yt<=48?1:p(2,yt-48),Yt=E(it),At=Yt.mul(V);At.isNegative()||At.gt(mt);)At=(Yt=E(it-=Ht,this.unsigned)).mul(V);Yt.isZero()&&(Yt=S),wt=wt.add(Yt),mt=mt.sub(At)}return wt},q.div=q.divide,q.modulo=function(V){return f(V)||(V=R(V)),H?m((this.unsigned?H.rem_u:H.rem_s)(this.low,this.high,V.low,V.high),H.get_high(),this.unsigned):this.sub(this.div(V).mul(V))},q.mod=q.modulo,q.rem=q.modulo,q.not=function(){return m(~this.low,~this.high,this.unsigned)},q.and=function(V){return f(V)||(V=R(V)),m(this.low&V.low,this.high&V.high,this.unsigned)},q.or=function(V){return f(V)||(V=R(V)),m(this.low|V.low,this.high|V.high,this.unsigned)},q.xor=function(V){return f(V)||(V=R(V)),m(this.low^V.low,this.high^V.high,this.unsigned)},q.shiftLeft=function(V){return f(V)&&(V=V.toInt()),(V&=63)==0?this:V<32?m(this.low<<V,this.high<<V|this.low>>>32-V,this.unsigned):m(0,this.low<<V-32,this.unsigned)},q.shl=q.shiftLeft,q.shiftRight=function(V){return f(V)&&(V=V.toInt()),(V&=63)==0?this:V<32?m(this.low>>>V|this.high<<32-V,this.high>>V,this.unsigned):m(this.high>>V-32,this.high>=0?0:-1,this.unsigned)},q.shr=q.shiftRight,q.shiftRightUnsigned=function(V){if(f(V)&&(V=V.toInt()),(V&=63)==0)return this;var it=this.high;return V<32?m(this.low>>>V|it<<32-V,it>>>V,this.unsigned):m(V===32?it:it>>>V-32,0,this.unsigned)},q.shru=q.shiftRightUnsigned,q.shr_u=q.shiftRightUnsigned,q.toSigned=function(){return this.unsigned?m(this.low,this.high,!1):this},q.toUnsigned=function(){return this.unsigned?this:m(this.low,this.high,!0)},q.toBytes=function(V){return V?this.toBytesLE():this.toBytesBE()},q.toBytesLE=function(){var V=this.high,it=this.low;return[255&it,it>>>8&255,it>>>16&255,it>>>24,255&V,V>>>8&255,V>>>16&255,V>>>24]},q.toBytesBE=function(){var V=this.high,it=this.low;return[V>>>24,V>>>16&255,V>>>8&255,255&V,it>>>24,it>>>16&255,it>>>8&255,255&it]},a.fromBytes=function(V,it,mt){return mt?a.fromBytesLE(V,it):a.fromBytesBE(V,it)},a.fromBytesLE=function(V,it){return new a(V[0]|V[1]<<8|V[2]<<16|V[3]<<24,V[4]|V[5]<<8|V[6]<<16|V[7]<<24,it)},a.fromBytesBE=function(V,it){return new a(V[4]<<24|V[5]<<16|V[6]<<8|V[7],V[0]<<24|V[1]<<16|V[2]<<8|V[3],it)}},3281:function(O,H,a){O.exports=a(9050)},2967:function(O){O.exports=f;var H,a=/\/|\./;function f(h,g){a.test(h)||(h="google/protobuf/"+h+".proto",g={nested:{google:{nested:{protobuf:{nested:g}}}}}),f[h]=g}f("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),f("duration",{Duration:H={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),f("timestamp",{Timestamp:H}),f("empty",{Empty:{fields:{}}}),f("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),f("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),f("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),f.get=function(h){return f[h]||null}},3996:function(O,H,a){var f=H,h=a(7025),g=a(9935);function _(m,p,A,R){if(p.resolvedType)if(p.resolvedType instanceof h){m("switch(d%s){",R);for(var D=p.resolvedType.values,P=Object.keys(D),k=0;k<P.length;++k)p.repeated&&D[P[k]]===p.typeDefault&&m("default:"),m("case%j:",P[k])("case %i:",D[P[k]])("m%s=%j",R,D[P[k]])("break");m("}")}else m('if(typeof d%s!=="object")',R)("throw TypeError(%j)",p.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",R,A,R);else{var b=!1;switch(p.type){case"double":case"float":m("m%s=Number(d%s)",R,R);break;case"uint32":case"fixed32":m("m%s=d%s>>>0",R,R);break;case"int32":case"sint32":case"sfixed32":m("m%s=d%s|0",R,R);break;case"uint64":b=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":m("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",R,R,b)('else if(typeof d%s==="string")',R)("m%s=parseInt(d%s,10)",R,R)('else if(typeof d%s==="number")',R)("m%s=d%s",R,R)('else if(typeof d%s==="object")',R)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",R,R,R,b?"true":"");break;case"bytes":m('if(typeof d%s==="string")',R)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",R,R,R)("else if(d%s.length)",R)("m%s=d%s",R,R);break;case"string":m("m%s=String(d%s)",R,R);break;case"bool":m("m%s=Boolean(d%s)",R,R)}}return m}function E(m,p,A,R){if(p.resolvedType)p.resolvedType instanceof h?m("d%s=o.enums===String?types[%i].values[m%s]:m%s",R,A,R,R):m("d%s=types[%i].toObject(m%s,o)",R,A,R);else{var D=!1;switch(p.type){case"double":case"float":m("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",R,R,R,R);break;case"uint64":D=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":m('if(typeof m%s==="number")',R)("d%s=o.longs===String?String(m%s):m%s",R,R,R)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",R,R,R,R,D?"true":"",R);break;case"bytes":m("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",R,R,R,R,R);break;default:m("d%s=m%s",R,R)}}return m}f.fromObject=function(m){var p=m.fieldsArray,A=g.codegen(["d"],m.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!p.length)return A("return new this.ctor");A("var m=new this.ctor");for(var R=0;R<p.length;++R){var D=p[R].resolve(),P=g.safeProp(D.name);D.map?(A("if(d%s){",P)('if(typeof d%s!=="object")',P)("throw TypeError(%j)",D.fullName+": object expected")("m%s={}",P)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",P),_(A,D,R,P+"[ks[i]]")("}")("}")):D.repeated?(A("if(d%s){",P)("if(!Array.isArray(d%s))",P)("throw TypeError(%j)",D.fullName+": array expected")("m%s=[]",P)("for(var i=0;i<d%s.length;++i){",P),_(A,D,R,P+"[i]")("}")("}")):(D.resolvedType instanceof h||A("if(d%s!=null){",P),_(A,D,R,P),D.resolvedType instanceof h||A("}"))}return A("return m")},f.toObject=function(m){var p=m.fieldsArray.slice().sort(g.compareFieldsById);if(!p.length)return g.codegen()("return {}");for(var A=g.codegen(["m","o"],m.name+"$toObject")("if(!o)")("o={}")("var d={}"),R=[],D=[],P=[],k=0;k<p.length;++k)p[k].partOf||(p[k].resolve().repeated?R:p[k].map?D:P).push(p[k]);if(R.length){for(A("if(o.arrays||o.defaults){"),k=0;k<R.length;++k)A("d%s=[]",g.safeProp(R[k].name));A("}")}if(D.length){for(A("if(o.objects||o.defaults){"),k=0;k<D.length;++k)A("d%s={}",g.safeProp(D[k].name));A("}")}if(P.length){for(A("if(o.defaults){"),k=0;k<P.length;++k){var b=P[k],j=g.safeProp(b.name);if(b.resolvedType instanceof h)A("d%s=o.enums===String?%j:%j",j,b.resolvedType.valuesById[b.typeDefault],b.typeDefault);else if(b.long)A("if(util.Long){")("var n=new util.Long(%i,%i,%j)",b.typeDefault.low,b.typeDefault.high,b.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",j)("}else")("d%s=o.longs===String?%j:%i",j,b.typeDefault.toString(),b.typeDefault.toNumber());else if(b.bytes){var z="["+Array.prototype.slice.call(b.typeDefault).join(",")+"]";A("if(o.bytes===String)d%s=%j",j,String.fromCharCode.apply(String,b.typeDefault))("else{")("d%s=%s",j,z)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",j,j)("}")}else A("d%s=%j",j,b.typeDefault)}A("}")}var S=!1;for(k=0;k<p.length;++k){b=p[k];var F=m._fieldsArray.indexOf(b);j=g.safeProp(b.name),b.map?(S||(S=!0,A("var ks2")),A("if(m%s&&(ks2=Object.keys(m%s)).length){",j,j)("d%s={}",j)("for(var j=0;j<ks2.length;++j){"),E(A,b,F,j+"[ks2[j]]")("}")):b.repeated?(A("if(m%s&&m%s.length){",j,j)("d%s=[]",j)("for(var j=0;j<m%s.length;++j){",j),E(A,b,F,j+"[j]")("}")):(A("if(m%s!=null&&m.hasOwnProperty(%j)){",j,b.name),E(A,b,F,j),b.partOf&&A("if(o.oneofs)")("d%s=%j",g.safeProp(b.partOf.name),b.name)),A("}")}return A("return d")}},5305:function(O,H,a){O.exports=function(E){var m=g.codegen(["r","l"],E.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(E.fieldsArray.filter(function(k){return k.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");E.group&&m("if((t&7)===4)")("break"),m("switch(t>>>3){");for(var p=0;p<E.fieldsArray.length;++p){var A=E._fieldsArray[p].resolve(),R=A.resolvedType instanceof f?"int32":A.type,D="m"+g.safeProp(A.name);m("case %i:",A.id),A.map?(m("if(%s===util.emptyObject)",D)("%s={}",D)("var c2 = r.uint32()+r.pos"),h.defaults[A.keyType]!==void 0?m("k=%j",h.defaults[A.keyType]):m("k=null"),h.defaults[R]!==void 0?m("value=%j",h.defaults[R]):m("value=null"),m("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",A.keyType)("case 2:"),h.basic[R]===void 0?m("value=types[%i].decode(r,r.uint32())",p):m("value=r.%s()",R),m("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),h.long[A.keyType]!==void 0?m('%s[typeof k==="object"?util.longToHash(k):k]=value',D):m("%s[k]=value",D)):A.repeated?(m("if(!(%s&&%s.length))",D,D)("%s=[]",D),h.packed[R]!==void 0&&m("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",D,R)("}else"),h.basic[R]===void 0?m(A.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",D,p):m("%s.push(r.%s())",D,R)):h.basic[R]===void 0?m(A.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",D,p):m("%s=r.%s()",D,R),m("break")}for(m("default:")("r.skipType(t&7)")("break")("}")("}"),p=0;p<E._fieldsArray.length;++p){var P=E._fieldsArray[p];P.required&&m("if(!m.hasOwnProperty(%j))",P.name)("throw util.ProtocolError(%j,{instance:m})",_(P))}return m("return m")};var f=a(7025),h=a(7063),g=a(9935);function _(E){return"missing required '"+E.name+"'"}},4928:function(O,H,a){O.exports=function(E){for(var m,p=g.codegen(["m","w"],E.name+"$encode")("if(!w)")("w=Writer.create()"),A=E.fieldsArray.slice().sort(g.compareFieldsById),R=0;R<A.length;++R){var D=A[R].resolve(),P=E._fieldsArray.indexOf(D),k=D.resolvedType instanceof f?"int32":D.type,b=h.basic[k];m="m"+g.safeProp(D.name),D.map?(p("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",m,D.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",m)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(D.id<<3|2)>>>0,8|h.mapKey[D.keyType],D.keyType),b===void 0?p("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",P,m):p(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|b,k,m),p("}")("}")):D.repeated?(p("if(%s!=null&&%s.length){",m,m),D.packed&&h.packed[k]!==void 0?p("w.uint32(%i).fork()",(D.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",m)("w.%s(%s[i])",k,m)("w.ldelim()"):(p("for(var i=0;i<%s.length;++i)",m),b===void 0?_(p,D,P,m+"[i]"):p("w.uint32(%i).%s(%s[i])",(D.id<<3|b)>>>0,k,m)),p("}")):(D.optional&&p("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",m,D.name),b===void 0?_(p,D,P,m):p("w.uint32(%i).%s(%s)",(D.id<<3|b)>>>0,k,m))}return p("return w")};var f=a(7025),h=a(7063),g=a(9935);function _(E,m,p,A){return m.resolvedType.group?E("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",p,A,(m.id<<3|3)>>>0,(m.id<<3|4)>>>0):E("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",p,A,(m.id<<3|2)>>>0)}},7025:function(O,H,a){O.exports=_;var f=a(3243);((_.prototype=Object.create(f.prototype)).constructor=_).className="Enum";var h=a(9313),g=a(9935);function _(E,m,p,A,R){if(f.call(this,E,p),m&&typeof m!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=A,this.comments=R||{},this.reserved=void 0,m)for(var D=Object.keys(m),P=0;P<D.length;++P)typeof m[D[P]]=="number"&&(this.valuesById[this.values[D[P]]=m[D[P]]]=D[P])}_.fromJSON=function(E,m){var p=new _(E,m.values,m.options,m.comment,m.comments);return p.reserved=m.reserved,p},_.prototype.toJSON=function(E){var m=!!E&&!!E.keepComments;return g.toObject(["options",this.options,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",m?this.comment:void 0,"comments",m?this.comments:void 0])},_.prototype.add=function(E,m,p){if(!g.isString(E))throw TypeError("name must be a string");if(!g.isInteger(m))throw TypeError("id must be an integer");if(this.values[E]!==void 0)throw Error("duplicate name '"+E+"' in "+this);if(this.isReservedId(m))throw Error("id "+m+" is reserved in "+this);if(this.isReservedName(E))throw Error("name '"+E+"' is reserved in "+this);if(this.valuesById[m]!==void 0){if(!this.options||!this.options.allow_alias)throw Error("duplicate id "+m+" in "+this);this.values[E]=m}else this.valuesById[this.values[E]=m]=E;return this.comments[E]=p||null,this},_.prototype.remove=function(E){if(!g.isString(E))throw TypeError("name must be a string");var m=this.values[E];if(m==null)throw Error("name '"+E+"' does not exist in "+this);return delete this.valuesById[m],delete this.values[E],delete this.comments[E],this},_.prototype.isReservedId=function(E){return h.isReservedId(this.reserved,E)},_.prototype.isReservedName=function(E){return h.isReservedName(this.reserved,E)}},3548:function(O,H,a){O.exports=p;var f=a(3243);((p.prototype=Object.create(f.prototype)).constructor=p).className="Field";var h,g=a(7025),_=a(7063),E=a(9935),m=/^required|optional|repeated$/;function p(A,R,D,P,k,b,j){if(E.isObject(P)?(j=k,b=P,P=k=void 0):E.isObject(k)&&(j=b,b=k,k=void 0),f.call(this,A,b),!E.isInteger(R)||R<0)throw TypeError("id must be a non-negative integer");if(!E.isString(D))throw TypeError("type must be a string");if(P!==void 0&&!m.test(P=P.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(k!==void 0&&!E.isString(k))throw TypeError("extend must be a string");P==="proto3_optional"&&(P="optional"),this.rule=P&&P!=="optional"?P:void 0,this.type=D,this.id=R,this.extend=k||void 0,this.required=P==="required",this.optional=!this.required,this.repeated=P==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!E.Long&&_.long[D]!==void 0,this.bytes=D==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=j}p.fromJSON=function(A,R){return new p(A,R.id,R.type,R.rule,R.extend,R.options,R.comment)},Object.defineProperty(p.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}}),p.prototype.setOption=function(A,R,D){return A==="packed"&&(this._packed=null),f.prototype.setOption.call(this,A,R,D)},p.prototype.toJSON=function(A){var R=!!A&&!!A.keepComments;return E.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",R?this.comment:void 0])},p.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=_.defaults[this.type])===void 0&&(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof h?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof g&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(this.options.packed!==!0&&(this.options.packed===void 0||!this.resolvedType||this.resolvedType instanceof g)||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=E.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var A;E.base64.test(this.typeDefault)?E.base64.decode(this.typeDefault,A=E.newBuffer(E.base64.length(this.typeDefault)),0):E.utf8.write(this.typeDefault,A=E.newBuffer(E.utf8.length(this.typeDefault)),0),this.typeDefault=A}return this.map?this.defaultValue=E.emptyObject:this.repeated?this.defaultValue=E.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof h&&(this.parent.ctor.prototype[this.name]=this.defaultValue),f.prototype.resolve.call(this)},p.d=function(A,R,D,P){return typeof R=="function"?R=E.decorateType(R).name:R&&typeof R=="object"&&(R=E.decorateEnum(R).name),function(k,b){E.decorateType(k.constructor).add(new p(b,A,R,D,{default:P}))}},p._configure=function(A){h=A}},8836:function(O,H,a){var f=O.exports=a(9482);f.build="light",f.load=function(h,g,_){return typeof g=="function"?(_=g,g=new f.Root):g||(g=new f.Root),g.load(h,_)},f.loadSync=function(h,g){return g||(g=new f.Root),g.loadSync(h)},f.encoder=a(4928),f.decoder=a(5305),f.verifier=a(4497),f.converter=a(3996),f.ReflectionObject=a(3243),f.Namespace=a(9313),f.Root=a(9424),f.Enum=a(7025),f.Type=a(7645),f.Field=a(3548),f.OneOf=a(7598),f.MapField=a(6039),f.Service=a(7513),f.Method=a(4429),f.Message=a(8368),f.wrappers=a(1667),f.types=a(7063),f.util=a(9935),f.ReflectionObject._configure(f.Root),f.Namespace._configure(f.Type,f.Service,f.Enum),f.Root._configure(f.Type),f.Field._configure(f.Type)},9482:function(O,H,a){var f=H;function h(){f.util._configure(),f.Writer._configure(f.BufferWriter),f.Reader._configure(f.BufferReader)}f.build="minimal",f.Writer=a(1173),f.BufferWriter=a(3155),f.Reader=a(1408),f.BufferReader=a(593),f.util=a(9693),f.rpc=a(5994),f.roots=a(5054),f.configure=h,h()},9050:function(O,H,a){var f=O.exports=a(8836);f.build="full",f.tokenize=a(626),f.parse=a(2228),f.common=a(2967),f.Root._configure(f.Type,f.parse,f.common)},6039:function(O,H,a){O.exports=_;var f=a(3548);((_.prototype=Object.create(f.prototype)).constructor=_).className="MapField";var h=a(7063),g=a(9935);function _(E,m,p,A,R,D){if(f.call(this,E,m,A,void 0,void 0,R,D),!g.isString(p))throw TypeError("keyType must be a string");this.keyType=p,this.resolvedKeyType=null,this.map=!0}_.fromJSON=function(E,m){return new _(E,m.id,m.keyType,m.type,m.options,m.comment)},_.prototype.toJSON=function(E){var m=!!E&&!!E.keepComments;return g.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",m?this.comment:void 0])},_.prototype.resolve=function(){if(this.resolved)return this;if(h.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return f.prototype.resolve.call(this)},_.d=function(E,m,p){return typeof p=="function"?p=g.decorateType(p).name:p&&typeof p=="object"&&(p=g.decorateEnum(p).name),function(A,R){g.decorateType(A.constructor).add(new _(R,E,m,p))}}},8368:function(O,H,a){O.exports=h;var f=a(9693);function h(g){if(g)for(var _=Object.keys(g),E=0;E<_.length;++E)this[_[E]]=g[_[E]]}h.create=function(g){return this.$type.create(g)},h.encode=function(g,_){return this.$type.encode(g,_)},h.encodeDelimited=function(g,_){return this.$type.encodeDelimited(g,_)},h.decode=function(g){return this.$type.decode(g)},h.decodeDelimited=function(g){return this.$type.decodeDelimited(g)},h.verify=function(g){return this.$type.verify(g)},h.fromObject=function(g){return this.$type.fromObject(g)},h.toObject=function(g,_){return this.$type.toObject(g,_)},h.prototype.toJSON=function(){return this.$type.toObject(this,f.toJSONOptions)}},4429:function(O,H,a){O.exports=g;var f=a(3243);((g.prototype=Object.create(f.prototype)).constructor=g).className="Method";var h=a(9935);function g(_,E,m,p,A,R,D,P,k){if(h.isObject(A)?(D=A,A=R=void 0):h.isObject(R)&&(D=R,R=void 0),E!==void 0&&!h.isString(E))throw TypeError("type must be a string");if(!h.isString(m))throw TypeError("requestType must be a string");if(!h.isString(p))throw TypeError("responseType must be a string");f.call(this,_,D),this.type=E||"rpc",this.requestType=m,this.requestStream=!!A||void 0,this.responseType=p,this.responseStream=!!R||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=P,this.parsedOptions=k}g.fromJSON=function(_,E){return new g(_,E.type,E.requestType,E.responseType,E.requestStream,E.responseStream,E.options,E.comment,E.parsedOptions)},g.prototype.toJSON=function(_){var E=!!_&&!!_.keepComments;return h.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",E?this.comment:void 0,"parsedOptions",this.parsedOptions])},g.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),f.prototype.resolve.call(this))}},9313:function(O,H,a){O.exports=R;var f=a(3243);((R.prototype=Object.create(f.prototype)).constructor=R).className="Namespace";var h,g,_,E=a(3548),m=a(7598),p=a(9935);function A(P,k){if(P&&P.length){for(var b={},j=0;j<P.length;++j)b[P[j].name]=P[j].toJSON(k);return b}}function R(P,k){f.call(this,P,k),this.nested=void 0,this._nestedArray=null}function D(P){return P._nestedArray=null,P}R.fromJSON=function(P,k){return new R(P,k.options).addJSON(k.nested)},R.arrayToJSON=A,R.isReservedId=function(P,k){if(P){for(var b=0;b<P.length;++b)if(typeof P[b]!="string"&&P[b][0]<=k&&P[b][1]>k)return!0}return!1},R.isReservedName=function(P,k){if(P){for(var b=0;b<P.length;++b)if(P[b]===k)return!0}return!1},Object.defineProperty(R.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=p.toArray(this.nested))}}),R.prototype.toJSON=function(P){return p.toObject(["options",this.options,"nested",A(this.nestedArray,P)])},R.prototype.addJSON=function(P){if(P)for(var k,b=Object.keys(P),j=0;j<b.length;++j)k=P[b[j]],this.add((k.fields!==void 0?h.fromJSON:k.values!==void 0?_.fromJSON:k.methods!==void 0?g.fromJSON:k.id!==void 0?E.fromJSON:R.fromJSON)(b[j],k));return this},R.prototype.get=function(P){return this.nested&&this.nested[P]||null},R.prototype.getEnum=function(P){if(this.nested&&this.nested[P]instanceof _)return this.nested[P].values;throw Error("no such enum: "+P)},R.prototype.add=function(P){if(!(P instanceof E&&P.extend!==void 0||P instanceof h||P instanceof _||P instanceof g||P instanceof R||P instanceof m))throw TypeError("object must be a valid nested object");if(this.nested){var k=this.get(P.name);if(k){if(!(k instanceof R&&P instanceof R)||k instanceof h||k instanceof g)throw Error("duplicate name '"+P.name+"' in "+this);for(var b=k.nestedArray,j=0;j<b.length;++j)P.add(b[j]);this.remove(k),this.nested||(this.nested={}),P.setOptions(k.options,!0)}}else this.nested={};return this.nested[P.name]=P,P.onAdd(this),D(this)},R.prototype.remove=function(P){if(!(P instanceof f))throw TypeError("object must be a ReflectionObject");if(P.parent!==this)throw Error(P+" is not a member of "+this);return delete this.nested[P.name],Object.keys(this.nested).length||(this.nested=void 0),P.onRemove(this),D(this)},R.prototype.define=function(P,k){if(p.isString(P))P=P.split(".");else if(!Array.isArray(P))throw TypeError("illegal path");if(P&&P.length&&P[0]==="")throw Error("path must be relative");for(var b=this;P.length>0;){var j=P.shift();if(b.nested&&b.nested[j]){if(!((b=b.nested[j])instanceof R))throw Error("path conflicts with non-namespace objects")}else b.add(b=new R(j))}return k&&b.addJSON(k),b},R.prototype.resolveAll=function(){for(var P=this.nestedArray,k=0;k<P.length;)P[k]instanceof R?P[k++].resolveAll():P[k++].resolve();return this.resolve()},R.prototype.lookup=function(P,k,b){if(typeof k=="boolean"?(b=k,k=void 0):k&&!Array.isArray(k)&&(k=[k]),p.isString(P)&&P.length){if(P===".")return this.root;P=P.split(".")}else if(!P.length)return this;if(P[0]==="")return this.root.lookup(P.slice(1),k);var j=this.get(P[0]);if(j){if(P.length===1){if(!k||k.indexOf(j.constructor)>-1)return j}else if(j instanceof R&&(j=j.lookup(P.slice(1),k,!0)))return j}else for(var z=0;z<this.nestedArray.length;++z)if(this._nestedArray[z]instanceof R&&(j=this._nestedArray[z].lookup(P,k,!0)))return j;return this.parent===null||b?null:this.parent.lookup(P,k)},R.prototype.lookupType=function(P){var k=this.lookup(P,[h]);if(!k)throw Error("no such type: "+P);return k},R.prototype.lookupEnum=function(P){var k=this.lookup(P,[_]);if(!k)throw Error("no such Enum '"+P+"' in "+this);return k},R.prototype.lookupTypeOrEnum=function(P){var k=this.lookup(P,[h,_]);if(!k)throw Error("no such Type or Enum '"+P+"' in "+this);return k},R.prototype.lookupService=function(P){var k=this.lookup(P,[g]);if(!k)throw Error("no such Service '"+P+"' in "+this);return k},R._configure=function(P,k,b){h=P,g=k,_=b}},3243:function(O,H,a){O.exports=g,g.className="ReflectionObject";var f,h=a(9935);function g(_,E){if(!h.isString(_))throw TypeError("name must be a string");if(E&&!h.isObject(E))throw TypeError("options must be an object");this.options=E,this.parsedOptions=null,this.name=_,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(g.prototype,{root:{get:function(){for(var _=this;_.parent!==null;)_=_.parent;return _}},fullName:{get:function(){for(var _=[this.name],E=this.parent;E;)_.unshift(E.name),E=E.parent;return _.join(".")}}}),g.prototype.toJSON=function(){throw Error()},g.prototype.onAdd=function(_){this.parent&&this.parent!==_&&this.parent.remove(this),this.parent=_,this.resolved=!1;var E=_.root;E instanceof f&&E._handleAdd(this)},g.prototype.onRemove=function(_){var E=_.root;E instanceof f&&E._handleRemove(this),this.parent=null,this.resolved=!1},g.prototype.resolve=function(){return this.resolved||this.root instanceof f&&(this.resolved=!0),this},g.prototype.getOption=function(_){if(this.options)return this.options[_]},g.prototype.setOption=function(_,E,m){return m&&this.options&&this.options[_]!==void 0||((this.options||(this.options={}))[_]=E),this},g.prototype.setParsedOption=function(_,E,m){this.parsedOptions||(this.parsedOptions=[]);var p=this.parsedOptions;if(m){var A=p.find(function(P){return Object.prototype.hasOwnProperty.call(P,_)});if(A){var R=A[_];h.setProperty(R,m,E)}else(A={})[_]=h.setProperty({},m,E),p.push(A)}else{var D={};D[_]=E,p.push(D)}return this},g.prototype.setOptions=function(_,E){if(_)for(var m=Object.keys(_),p=0;p<m.length;++p)this.setOption(m[p],_[m[p]],E);return this},g.prototype.toString=function(){var _=this.constructor.className,E=this.fullName;return E.length?_+" "+E:_},g._configure=function(_){f=_}},7598:function(O,H,a){O.exports=_;var f=a(3243);((_.prototype=Object.create(f.prototype)).constructor=_).className="OneOf";var h=a(3548),g=a(9935);function _(m,p,A,R){if(Array.isArray(p)||(A=p,p=void 0),f.call(this,m,A),p!==void 0&&!Array.isArray(p))throw TypeError("fieldNames must be an Array");this.oneof=p||[],this.fieldsArray=[],this.comment=R}function E(m){if(m.parent)for(var p=0;p<m.fieldsArray.length;++p)m.fieldsArray[p].parent||m.parent.add(m.fieldsArray[p])}_.fromJSON=function(m,p){return new _(m,p.oneof,p.options,p.comment)},_.prototype.toJSON=function(m){var p=!!m&&!!m.keepComments;return g.toObject(["options",this.options,"oneof",this.oneof,"comment",p?this.comment:void 0])},_.prototype.add=function(m){if(!(m instanceof h))throw TypeError("field must be a Field");return m.parent&&m.parent!==this.parent&&m.parent.remove(m),this.oneof.push(m.name),this.fieldsArray.push(m),m.partOf=this,E(this),this},_.prototype.remove=function(m){if(!(m instanceof h))throw TypeError("field must be a Field");var p=this.fieldsArray.indexOf(m);if(p<0)throw Error(m+" is not a member of "+this);return this.fieldsArray.splice(p,1),(p=this.oneof.indexOf(m.name))>-1&&this.oneof.splice(p,1),m.partOf=null,this},_.prototype.onAdd=function(m){f.prototype.onAdd.call(this,m);for(var p=0;p<this.oneof.length;++p){var A=m.get(this.oneof[p]);A&&!A.partOf&&(A.partOf=this,this.fieldsArray.push(A))}E(this)},_.prototype.onRemove=function(m){for(var p,A=0;A<this.fieldsArray.length;++A)(p=this.fieldsArray[A]).parent&&p.parent.remove(p);f.prototype.onRemove.call(this,m)},_.d=function(){for(var m=new Array(arguments.length),p=0;p<arguments.length;)m[p]=arguments[p++];return function(A,R){g.decorateType(A.constructor).add(new _(R,m)),Object.defineProperty(A,R,{get:g.oneOfGetter(m),set:g.oneOfSetter(m)})}}},2228:function(O,H,a){O.exports=q,q.filename=null,q.defaults={keepCase:!1};var f=a(626),h=a(9424),g=a(7645),_=a(3548),E=a(6039),m=a(7598),p=a(7025),A=a(7513),R=a(4429),D=a(7063),P=a(9935),k=/^[1-9][0-9]*$/,b=/^-?[1-9][0-9]*$/,j=/^0[x][0-9a-fA-F]+$/,z=/^-?0[x][0-9a-fA-F]+$/,S=/^0[0-7]+$/,F=/^-?0[0-7]+$/,M=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,Z=/^[a-zA-Z_][a-zA-Z_0-9]*$/,U=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,Y=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function q(V,it,mt){it instanceof h||(mt=it,it=new h),mt||(mt=q.defaults);var wt,yt,Ht,Yt,At,Lt=mt.preferTrailingComment||!1,zt=f(V,mt.alternateCommentMode||!1),re=zt.next,de=zt.push,ft=zt.peek,gt=zt.skip,Zt=zt.cmnt,Pt=!0,Wt=!1,oe=it,fe=mt.keepCase?function(Ee){return Ee}:P.camelCase;function le(Ee,te,Ae){var Xe=q.filename;return Ae||(q.filename=null),Error("illegal "+(te||"token")+" '"+Ee+"' ("+(Xe?Xe+", ":"")+"line "+zt.line+")")}function Ie(){var Ee,te=[];do{if((Ee=re())!=='"'&&Ee!=="'")throw le(Ee);te.push(re()),gt(Ee),Ee=ft()}while(Ee==='"'||Ee==="'");return te.join("")}function me(Ee){var te=re();switch(te){case"'":case'"':return de(te),Ie();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return function(Ae,Xe){var Be=1;switch(Ae.charAt(0)==="-"&&(Be=-1,Ae=Ae.substring(1)),Ae){case"inf":case"INF":case"Inf":return Be*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(k.test(Ae))return Be*parseInt(Ae,10);if(j.test(Ae))return Be*parseInt(Ae,16);if(S.test(Ae))return Be*parseInt(Ae,8);if(M.test(Ae))return Be*parseFloat(Ae);throw le(Ae,"number",!0)}(te)}catch{if(U.test(te))return te;throw le(te,"value")}}function Oe(Ee,te){var Ae,Xe;do!te||(Ae=ft())!=='"'&&Ae!=="'"?Ee.push([Xe=je(re()),gt("to",!0)?je(re()):Xe]):Ee.push(Ie());while(gt(",",!0));gt(";")}function je(Ee,te){switch(Ee){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!te&&Ee.charAt(0)==="-")throw le(Ee,"id");if(b.test(Ee))return parseInt(Ee,10);if(z.test(Ee))return parseInt(Ee,16);if(F.test(Ee))return parseInt(Ee,8);throw le(Ee,"id")}function xe(){if(wt!==void 0)throw le("package");if(wt=re(),!U.test(wt))throw le(wt,"name");oe=oe.define(wt),gt(";")}function ir(){var Ee,te=ft();switch(te){case"weak":Ee=Ht||(Ht=[]),re();break;case"public":re();default:Ee=yt||(yt=[])}te=Ie(),gt(";"),Ee.push(te)}function He(){if(gt("="),Yt=Ie(),!(Wt=Yt==="proto3")&&Yt!=="proto2")throw le(Yt,"syntax");gt(";")}function ae(Ee,te){switch(te){case"option":return ee(Ee,te),gt(";"),!0;case"message":return function(Ae,Xe){if(!Z.test(Xe=re()))throw le(Xe,"type name");var Be=new g(Xe);Ne(Be,function(ze){if(!ae(Be,ze))switch(ze){case"map":(function(ot){gt("<");var Et=re();if(D.mapKey[Et]===void 0)throw le(Et,"type");gt(",");var nt=re();if(!U.test(nt))throw le(nt,"type");gt(">");var Dt=re();if(!Z.test(Dt))throw le(Dt,"name");gt("=");var B=new E(fe(Dt),je(re()),Et,nt);Ne(B,function(Ft){if(Ft!=="option")throw le(Ft);ee(B,Ft),gt(";")},function(){Pe(B)}),ot.add(B)})(Be);break;case"required":case"repeated":Ze(Be,ze);break;case"optional":Ze(Be,Wt?"proto3_optional":"optional");break;case"oneof":(function(ot,Et){if(!Z.test(Et=re()))throw le(Et,"name");var nt=new m(fe(Et));Ne(nt,function(Dt){Dt==="option"?(ee(nt,Dt),gt(";")):(de(Dt),Ze(nt,"optional"))}),ot.add(nt)})(Be,ze);break;case"extensions":Oe(Be.extensions||(Be.extensions=[]));break;case"reserved":Oe(Be.reserved||(Be.reserved=[]),!0);break;default:if(!Wt||!U.test(ze))throw le(ze);de(ze),Ze(Be,"optional")}}),Ae.add(Be)}(Ee,te),!0;case"enum":return function(Ae,Xe){if(!Z.test(Xe=re()))throw le(Xe,"name");var Be=new p(Xe);Ne(Be,function(ze){switch(ze){case"option":ee(Be,ze),gt(";");break;case"reserved":Oe(Be.reserved||(Be.reserved=[]),!0);break;default:(function(ot,Et){if(!Z.test(Et))throw le(Et,"name");gt("=");var nt=je(re(),!0),Dt={};Ne(Dt,function(B){if(B!=="option")throw le(B);ee(Dt,B),gt(";")},function(){Pe(Dt)}),ot.add(Et,nt,Dt.comment)})(Be,ze)}}),Ae.add(Be)}(Ee,te),!0;case"service":return function(Ae,Xe){if(!Z.test(Xe=re()))throw le(Xe,"service name");var Be=new A(Xe);Ne(Be,function(ze){if(!ae(Be,ze)){if(ze!=="rpc")throw le(ze);(function(ot,Et){var nt=Zt(),Dt=Et;if(!Z.test(Et=re()))throw le(Et,"name");var B,Ft,St,Nt,Ut=Et;if(gt("("),gt("stream",!0)&&(Ft=!0),!U.test(Et=re())||(B=Et,gt(")"),gt("returns"),gt("("),gt("stream",!0)&&(Nt=!0),!U.test(Et=re())))throw le(Et);St=Et,gt(")");var Xt=new R(Ut,Dt,B,St,Ft,Nt);Xt.comment=nt,Ne(Xt,function(Gt){if(Gt!=="option")throw le(Gt);ee(Xt,Gt),gt(";")}),ot.add(Xt)})(Be,ze)}}),Ae.add(Be)}(Ee,te),!0;case"extend":return function(Ae,Xe){if(!U.test(Xe=re()))throw le(Xe,"reference");var Be=Xe;Ne(null,function(ze){switch(ze){case"required":case"repeated":Ze(Ae,ze,Be);break;case"optional":Ze(Ae,Wt?"proto3_optional":"optional",Be);break;default:if(!Wt||!U.test(ze))throw le(ze);de(ze),Ze(Ae,"optional",Be)}})}(Ee,te),!0}return!1}function Ne(Ee,te,Ae){var Xe=zt.line;if(Ee&&(typeof Ee.comment!="string"&&(Ee.comment=Zt()),Ee.filename=q.filename),gt("{",!0)){for(var Be;(Be=re())!=="}";)te(Be);gt(";",!0)}else Ae&&Ae(),gt(";"),Ee&&(typeof Ee.comment!="string"||Lt)&&(Ee.comment=Zt(Xe)||Ee.comment)}function Ze(Ee,te,Ae){var Xe=re();if(Xe!=="group"){if(!U.test(Xe))throw le(Xe,"type");var Be=re();if(!Z.test(Be))throw le(Be,"name");Be=fe(Be),gt("=");var ze=new _(Be,je(re()),Xe,te,Ae);if(Ne(ze,function(Et){if(Et!=="option")throw le(Et);ee(ze,Et),gt(";")},function(){Pe(ze)}),te==="proto3_optional"){var ot=new m("_"+Be);ze.setOption("proto3_optional",!0),ot.add(ze),Ee.add(ot)}else Ee.add(ze);Wt||!ze.repeated||D.packed[Xe]===void 0&&D.basic[Xe]!==void 0||ze.setOption("packed",!1,!0)}else(function(Et,nt){var Dt=re();if(!Z.test(Dt))throw le(Dt,"name");var B=P.lcFirst(Dt);Dt===B&&(Dt=P.ucFirst(Dt)),gt("=");var Ft=je(re()),St=new g(Dt);St.group=!0;var Nt=new _(B,Ft,Dt,nt);Nt.filename=q.filename,Ne(St,function(Ut){switch(Ut){case"option":ee(St,Ut),gt(";");break;case"required":case"repeated":Ze(St,Ut);break;case"optional":Ze(St,Wt?"proto3_optional":"optional");break;default:throw le(Ut)}}),Et.add(St).add(Nt)})(Ee,te)}function ee(Ee,te){var Ae=gt("(",!0);if(!U.test(te=re()))throw le(te,"name");var Xe,Be=te,ze=Be;Ae&&(gt(")"),ze=Be="("+Be+")",te=ft(),Y.test(te)&&(Xe=te.substr(1),Be+=te,re())),gt("="),function(ot,Et,nt,Dt){ot.setParsedOption&&ot.setParsedOption(Et,nt,Dt)}(Ee,ze,be(Ee,Be),Xe)}function be(Ee,te){if(gt("{",!0)){for(var Ae={};!gt("}",!0);){if(!Z.test(At=re()))throw le(At,"name");var Xe,Be=At;ft()==="{"?Xe=be(Ee,te+"."+At):(gt(":"),ft()==="{"?Xe=be(Ee,te+"."+At):(Xe=me(),We(Ee,te+"."+At,Xe)));var ze=Ae[Be];ze&&(Xe=[].concat(ze).concat(Xe)),Ae[Be]=Xe,gt(",",!0)}return Ae}var ot=me();return We(Ee,te,ot),ot}function We(Ee,te,Ae){Ee.setOption&&Ee.setOption(te,Ae)}function Pe(Ee){if(gt("[",!0)){do ee(Ee,"option");while(gt(",",!0));gt("]")}return Ee}for(;(At=re())!==null;)switch(At){case"package":if(!Pt)throw le(At);xe();break;case"import":if(!Pt)throw le(At);ir();break;case"syntax":if(!Pt)throw le(At);He();break;case"option":ee(oe,At),gt(";");break;default:if(ae(oe,At)){Pt=!1;continue}throw le(At)}return q.filename=null,{package:wt,imports:yt,weakImports:Ht,syntax:Yt,root:it}}},1408:function(O,H,a){O.exports=m;var f,h=a(9693),g=h.LongBits,_=h.utf8;function E(b,j){return RangeError("index out of range: "+b.pos+" + "+(j||1)+" > "+b.len)}function m(b){this.buf=b,this.pos=0,this.len=b.length}var p,A=typeof Uint8Array<"u"?function(b){if(b instanceof Uint8Array||Array.isArray(b))return new m(b);throw Error("illegal buffer")}:function(b){if(Array.isArray(b))return new m(b);throw Error("illegal buffer")},R=function(){return h.Buffer?function(b){return(m.create=function(j){return h.Buffer.isBuffer(j)?new f(j):A(j)})(b)}:A};function D(){var b=new g(0,0),j=0;if(!(this.len-this.pos>4)){for(;j<3;++j){if(this.pos>=this.len)throw E(this);if(b.lo=(b.lo|(127&this.buf[this.pos])<<7*j)>>>0,this.buf[this.pos++]<128)return b}return b.lo=(b.lo|(127&this.buf[this.pos++])<<7*j)>>>0,b}for(;j<4;++j)if(b.lo=(b.lo|(127&this.buf[this.pos])<<7*j)>>>0,this.buf[this.pos++]<128)return b;if(b.lo=(b.lo|(127&this.buf[this.pos])<<28)>>>0,b.hi=(b.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return b;if(j=0,this.len-this.pos>4){for(;j<5;++j)if(b.hi=(b.hi|(127&this.buf[this.pos])<<7*j+3)>>>0,this.buf[this.pos++]<128)return b}else for(;j<5;++j){if(this.pos>=this.len)throw E(this);if(b.hi=(b.hi|(127&this.buf[this.pos])<<7*j+3)>>>0,this.buf[this.pos++]<128)return b}throw Error("invalid varint encoding")}function P(b,j){return(b[j-4]|b[j-3]<<8|b[j-2]<<16|b[j-1]<<24)>>>0}function k(){if(this.pos+8>this.len)throw E(this,8);return new g(P(this.buf,this.pos+=4),P(this.buf,this.pos+=4))}m.create=R(),m.prototype._slice=h.Array.prototype.subarray||h.Array.prototype.slice,m.prototype.uint32=(p=4294967295,function(){if(p=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(p=(p|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(p=(p|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(p=(p|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(p=(p|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return p;if((this.pos+=5)>this.len)throw this.pos=this.len,E(this,10);return p}),m.prototype.int32=function(){return 0|this.uint32()},m.prototype.sint32=function(){var b=this.uint32();return b>>>1^-(1&b)|0},m.prototype.bool=function(){return this.uint32()!==0},m.prototype.fixed32=function(){if(this.pos+4>this.len)throw E(this,4);return P(this.buf,this.pos+=4)},m.prototype.sfixed32=function(){if(this.pos+4>this.len)throw E(this,4);return 0|P(this.buf,this.pos+=4)},m.prototype.float=function(){if(this.pos+4>this.len)throw E(this,4);var b=h.float.readFloatLE(this.buf,this.pos);return this.pos+=4,b},m.prototype.double=function(){if(this.pos+8>this.len)throw E(this,4);var b=h.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,b},m.prototype.bytes=function(){var b=this.uint32(),j=this.pos,z=this.pos+b;if(z>this.len)throw E(this,b);return this.pos+=b,Array.isArray(this.buf)?this.buf.slice(j,z):j===z?new this.buf.constructor(0):this._slice.call(this.buf,j,z)},m.prototype.string=function(){var b=this.bytes();return _.read(b,0,b.length)},m.prototype.skip=function(b){if(typeof b=="number"){if(this.pos+b>this.len)throw E(this,b);this.pos+=b}else do if(this.pos>=this.len)throw E(this);while(128&this.buf[this.pos++]);return this},m.prototype.skipType=function(b){switch(b){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(b=7&this.uint32())!=4;)this.skipType(b);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+b+" at offset "+this.pos)}return this},m._configure=function(b){f=b,m.create=R(),f._configure();var j=h.Long?"toLong":"toNumber";h.merge(m.prototype,{int64:function(){return D.call(this)[j](!1)},uint64:function(){return D.call(this)[j](!0)},sint64:function(){return D.call(this).zzDecode()[j](!1)},fixed64:function(){return k.call(this)[j](!0)},sfixed64:function(){return k.call(this)[j](!1)}})}},593:function(O,H,a){O.exports=g;var f=a(1408);(g.prototype=Object.create(f.prototype)).constructor=g;var h=a(9693);function g(_){f.call(this,_)}g._configure=function(){h.Buffer&&(g.prototype._slice=h.Buffer.prototype.slice)},g.prototype.string=function(){var _=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+_,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+_,this.len))},g._configure()},9424:function(O,H,a){O.exports=R;var f=a(9313);((R.prototype=Object.create(f.prototype)).constructor=R).className="Root";var h,g,_,E=a(3548),m=a(7025),p=a(7598),A=a(9935);function R(b){f.call(this,"",b),this.deferred=[],this.files=[]}function D(){}R.fromJSON=function(b,j){return j||(j=new R),b.options&&j.setOptions(b.options),j.addJSON(b.nested)},R.prototype.resolvePath=A.path.resolve,R.prototype.fetch=A.fetch,R.prototype.load=function b(j,z,S){typeof z=="function"&&(S=z,z=void 0);var F=this;if(!S)return A.asPromise(b,F,j,z);var M=S===D;function Z(wt,yt){if(S){var Ht=S;if(S=null,M)throw wt;Ht(wt,yt)}}function U(wt){var yt=wt.lastIndexOf("google/protobuf/");if(yt>-1){var Ht=wt.substring(yt);if(Ht in _)return Ht}return null}function Y(wt,yt){try{if(A.isString(yt)&&yt.charAt(0)==="{"&&(yt=JSON.parse(yt)),A.isString(yt)){g.filename=wt;var Ht,Yt=g(yt,F,z),At=0;if(Yt.imports)for(;At<Yt.imports.length;++At)(Ht=U(Yt.imports[At])||F.resolvePath(wt,Yt.imports[At]))&&q(Ht);if(Yt.weakImports)for(At=0;At<Yt.weakImports.length;++At)(Ht=U(Yt.weakImports[At])||F.resolvePath(wt,Yt.weakImports[At]))&&q(Ht,!0)}else F.setOptions(yt.options).addJSON(yt.nested)}catch(Lt){Z(Lt)}M||V||Z(null,F)}function q(wt,yt){if(!(F.files.indexOf(wt)>-1))if(F.files.push(wt),wt in _)M?Y(wt,_[wt]):(++V,setTimeout(function(){--V,Y(wt,_[wt])}));else if(M){var Ht;try{Ht=A.fs.readFileSync(wt).toString("utf8")}catch(Yt){return void(yt||Z(Yt))}Y(wt,Ht)}else++V,F.fetch(wt,function(Yt,At){--V,S&&(Yt?yt?V||Z(null,F):Z(Yt):Y(wt,At))})}var V=0;A.isString(j)&&(j=[j]);for(var it,mt=0;mt<j.length;++mt)(it=F.resolvePath("",j[mt]))&&q(it);if(M)return F;V||Z(null,F)},R.prototype.loadSync=function(b,j){if(!A.isNode)throw Error("not supported");return this.load(b,j,D)},R.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(b){return"'extend "+b.extend+"' in "+b.parent.fullName}).join(", "));return f.prototype.resolveAll.call(this)};var P=/^[A-Z]/;function k(b,j){var z=j.parent.lookup(j.extend);if(z){var S=new E(j.fullName,j.id,j.type,j.rule,void 0,j.options);return S.declaringField=j,j.extensionField=S,z.add(S),!0}return!1}R.prototype._handleAdd=function(b){if(b instanceof E)b.extend===void 0||b.extensionField||k(0,b)||this.deferred.push(b);else if(b instanceof m)P.test(b.name)&&(b.parent[b.name]=b.values);else if(!(b instanceof p)){if(b instanceof h)for(var j=0;j<this.deferred.length;)k(0,this.deferred[j])?this.deferred.splice(j,1):++j;for(var z=0;z<b.nestedArray.length;++z)this._handleAdd(b._nestedArray[z]);P.test(b.name)&&(b.parent[b.name]=b)}},R.prototype._handleRemove=function(b){if(b instanceof E){if(b.extend!==void 0)if(b.extensionField)b.extensionField.parent.remove(b.extensionField),b.extensionField=null;else{var j=this.deferred.indexOf(b);j>-1&&this.deferred.splice(j,1)}}else if(b instanceof m)P.test(b.name)&&delete b.parent[b.name];else if(b instanceof f){for(var z=0;z<b.nestedArray.length;++z)this._handleRemove(b._nestedArray[z]);P.test(b.name)&&delete b.parent[b.name]}},R._configure=function(b,j,z){h=b,g=j,_=z}},5054:function(O){O.exports={}},5994:function(O,H,a){H.Service=a(7948)},7948:function(O,H,a){O.exports=h;var f=a(9693);function h(g,_,E){if(typeof g!="function")throw TypeError("rpcImpl must be a function");f.EventEmitter.call(this),this.rpcImpl=g,this.requestDelimited=!!_,this.responseDelimited=!!E}(h.prototype=Object.create(f.EventEmitter.prototype)).constructor=h,h.prototype.rpcCall=function g(_,E,m,p,A){if(!p)throw TypeError("request must be specified");var R=this;if(!A)return f.asPromise(g,R,_,E,m,p);if(R.rpcImpl)try{return R.rpcImpl(_,E[R.requestDelimited?"encodeDelimited":"encode"](p).finish(),function(D,P){if(D)return R.emit("error",D,_),A(D);if(P!==null){if(!(P instanceof m))try{P=m[R.responseDelimited?"decodeDelimited":"decode"](P)}catch(k){return R.emit("error",k,_),A(k)}return R.emit("data",P,_),A(null,P)}R.end(!0)})}catch(D){return R.emit("error",D,_),void setTimeout(function(){A(D)},0)}else setTimeout(function(){A(Error("already ended"))},0)},h.prototype.end=function(g){return this.rpcImpl&&(g||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},7513:function(O,H,a){O.exports=E;var f=a(9313);((E.prototype=Object.create(f.prototype)).constructor=E).className="Service";var h=a(4429),g=a(9935),_=a(5994);function E(p,A){f.call(this,p,A),this.methods={},this._methodsArray=null}function m(p){return p._methodsArray=null,p}E.fromJSON=function(p,A){var R=new E(p,A.options);if(A.methods)for(var D=Object.keys(A.methods),P=0;P<D.length;++P)R.add(h.fromJSON(D[P],A.methods[D[P]]));return A.nested&&R.addJSON(A.nested),R.comment=A.comment,R},E.prototype.toJSON=function(p){var A=f.prototype.toJSON.call(this,p),R=!!p&&!!p.keepComments;return g.toObject(["options",A&&A.options||void 0,"methods",f.arrayToJSON(this.methodsArray,p)||{},"nested",A&&A.nested||void 0,"comment",R?this.comment:void 0])},Object.defineProperty(E.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=g.toArray(this.methods))}}),E.prototype.get=function(p){return this.methods[p]||f.prototype.get.call(this,p)},E.prototype.resolveAll=function(){for(var p=this.methodsArray,A=0;A<p.length;++A)p[A].resolve();return f.prototype.resolve.call(this)},E.prototype.add=function(p){if(this.get(p.name))throw Error("duplicate name '"+p.name+"' in "+this);return p instanceof h?(this.methods[p.name]=p,p.parent=this,m(this)):f.prototype.add.call(this,p)},E.prototype.remove=function(p){if(p instanceof h){if(this.methods[p.name]!==p)throw Error(p+" is not a member of "+this);return delete this.methods[p.name],p.parent=null,m(this)}return f.prototype.remove.call(this,p)},E.prototype.create=function(p,A,R){for(var D,P=new _.Service(p,A,R),k=0;k<this.methodsArray.length;++k){var b=g.lcFirst((D=this._methodsArray[k]).resolve().name).replace(/[^$\w_]/g,"");P[b]=g.codegen(["r","c"],g.isReserved(b)?b+"_":b)("return this.rpcCall(m,q,s,r,c)")({m:D,q:D.resolvedRequestType.ctor,s:D.resolvedResponseType.ctor})}return P}},626:function(O){O.exports=R;var H=/[\s{}=;:[\],'"()<>]/g,a=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,f=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,h=/^ *[*/]+ */,g=/^\s*\*?\/*/,_=/\n/g,E=/\s/,m=/\\(.?)/g,p={0:"\0",r:"\r",n:`
`,t:"	"};function A(D){return D.replace(m,function(P,k){switch(k){case"\\":case"":return k;default:return p[k]||""}})}function R(D,P){D=D.toString();var k=0,b=D.length,j=1,z=null,S=null,F=0,M=!1,Z=!1,U=[],Y=null;function q(At){return Error("illegal "+At+" (line "+j+")")}function V(At){return D.charAt(At)}function it(At,Lt,zt){z=D.charAt(At++),F=j,M=!1,Z=zt;var re,de=At-(P?2:3);do if(--de<0||(re=D.charAt(de))===`
`){M=!0;break}while(re===" "||re==="	");for(var ft=D.substring(At,Lt).split(_),gt=0;gt<ft.length;++gt)ft[gt]=ft[gt].replace(P?g:h,"").trim();S=ft.join(`
`).trim()}function mt(At){var Lt=wt(At),zt=D.substring(At,Lt);return/^\s*\/{1,2}/.test(zt)}function wt(At){for(var Lt=At;Lt<b&&V(Lt)!==`
`;)Lt++;return Lt}function yt(){if(U.length>0)return U.shift();if(Y)return function(){var Pt=Y==="'"?f:a;Pt.lastIndex=k-1;var Wt=Pt.exec(D);if(!Wt)throw q("string");return k=Pt.lastIndex,Ht(Y),Y=null,A(Wt[1])}();var At,Lt,zt,re,de,ft=k===0;do{if(k===b)return null;for(At=!1;E.test(zt=V(k));)if(zt===`
`&&(ft=!0,++j),++k===b)return null;if(V(k)==="/"){if(++k===b)throw q("comment");if(V(k)==="/")if(P){if(re=k,de=!1,mt(k)){de=!0;do{if((k=wt(k))===b)break;k++}while(mt(k))}else k=Math.min(b,wt(k)+1);de&&it(re,k,ft),j++,At=!0}else{for(de=V(re=k+1)==="/";V(++k)!==`
`;)if(k===b)return null;++k,de&&it(re,k-1,ft),++j,At=!0}else{if((zt=V(k))!=="*")return"/";re=k+1,de=P||V(re)==="*";do{if(zt===`
`&&++j,++k===b)throw q("comment");Lt=zt,zt=V(k)}while(Lt!=="*"||zt!=="/");++k,de&&it(re,k-2,ft),At=!0}}}while(At);var gt=k;if(H.lastIndex=0,!H.test(V(gt++)))for(;gt<b&&!H.test(V(gt));)++gt;var Zt=D.substring(k,k=gt);return Zt!=='"'&&Zt!=="'"||(Y=Zt),Zt}function Ht(At){U.push(At)}function Yt(){if(!U.length){var At=yt();if(At===null)return null;Ht(At)}return U[0]}return Object.defineProperty({next:yt,peek:Yt,push:Ht,skip:function(At,Lt){var zt=Yt();if(zt===At)return yt(),!0;if(!Lt)throw q("token '"+zt+"', '"+At+"' expected");return!1},cmnt:function(At){var Lt=null;return At===void 0?F===j-1&&(P||z==="*"||M)&&(Lt=Z?S:null):(F<At&&Yt(),F!==At||M||!P&&z!=="/"||(Lt=Z?null:S)),Lt}},"line",{get:function(){return j}})}R.unescape=A},7645:function(O,H,a){O.exports=S;var f=a(9313);((S.prototype=Object.create(f.prototype)).constructor=S).className="Type";var h=a(7025),g=a(7598),_=a(3548),E=a(6039),m=a(7513),p=a(8368),A=a(1408),R=a(1173),D=a(9935),P=a(4928),k=a(5305),b=a(4497),j=a(3996),z=a(1667);function S(M,Z){f.call(this,M,Z),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function F(M){return M._fieldsById=M._fieldsArray=M._oneofsArray=null,delete M.encode,delete M.decode,delete M.verify,M}Object.defineProperties(S.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var M=Object.keys(this.fields),Z=0;Z<M.length;++Z){var U=this.fields[M[Z]],Y=U.id;if(this._fieldsById[Y])throw Error("duplicate id "+Y+" in "+this);this._fieldsById[Y]=U}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=D.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=D.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=S.generateConstructor(this)())},set:function(M){var Z=M.prototype;Z instanceof p||((M.prototype=new p).constructor=M,D.merge(M.prototype,Z)),M.$type=M.prototype.$type=this,D.merge(M,p,!0),this._ctor=M;for(var U=0;U<this.fieldsArray.length;++U)this._fieldsArray[U].resolve();var Y={};for(U=0;U<this.oneofsArray.length;++U)Y[this._oneofsArray[U].resolve().name]={get:D.oneOfGetter(this._oneofsArray[U].oneof),set:D.oneOfSetter(this._oneofsArray[U].oneof)};U&&Object.defineProperties(M.prototype,Y)}}}),S.generateConstructor=function(M){for(var Z,U=D.codegen(["p"],M.name),Y=0;Y<M.fieldsArray.length;++Y)(Z=M._fieldsArray[Y]).map?U("this%s={}",D.safeProp(Z.name)):Z.repeated&&U("this%s=[]",D.safeProp(Z.name));return U("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},S.fromJSON=function(M,Z){var U=new S(M,Z.options);U.extensions=Z.extensions,U.reserved=Z.reserved;for(var Y=Object.keys(Z.fields),q=0;q<Y.length;++q)U.add((Z.fields[Y[q]].keyType!==void 0?E.fromJSON:_.fromJSON)(Y[q],Z.fields[Y[q]]));if(Z.oneofs)for(Y=Object.keys(Z.oneofs),q=0;q<Y.length;++q)U.add(g.fromJSON(Y[q],Z.oneofs[Y[q]]));if(Z.nested)for(Y=Object.keys(Z.nested),q=0;q<Y.length;++q){var V=Z.nested[Y[q]];U.add((V.id!==void 0?_.fromJSON:V.fields!==void 0?S.fromJSON:V.values!==void 0?h.fromJSON:V.methods!==void 0?m.fromJSON:f.fromJSON)(Y[q],V))}return Z.extensions&&Z.extensions.length&&(U.extensions=Z.extensions),Z.reserved&&Z.reserved.length&&(U.reserved=Z.reserved),Z.group&&(U.group=!0),Z.comment&&(U.comment=Z.comment),U},S.prototype.toJSON=function(M){var Z=f.prototype.toJSON.call(this,M),U=!!M&&!!M.keepComments;return D.toObject(["options",Z&&Z.options||void 0,"oneofs",f.arrayToJSON(this.oneofsArray,M),"fields",f.arrayToJSON(this.fieldsArray.filter(function(Y){return!Y.declaringField}),M)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",Z&&Z.nested||void 0,"comment",U?this.comment:void 0])},S.prototype.resolveAll=function(){for(var M=this.fieldsArray,Z=0;Z<M.length;)M[Z++].resolve();var U=this.oneofsArray;for(Z=0;Z<U.length;)U[Z++].resolve();return f.prototype.resolveAll.call(this)},S.prototype.get=function(M){return this.fields[M]||this.oneofs&&this.oneofs[M]||this.nested&&this.nested[M]||null},S.prototype.add=function(M){if(this.get(M.name))throw Error("duplicate name '"+M.name+"' in "+this);if(M instanceof _&&M.extend===void 0){if(this._fieldsById?this._fieldsById[M.id]:this.fieldsById[M.id])throw Error("duplicate id "+M.id+" in "+this);if(this.isReservedId(M.id))throw Error("id "+M.id+" is reserved in "+this);if(this.isReservedName(M.name))throw Error("name '"+M.name+"' is reserved in "+this);return M.parent&&M.parent.remove(M),this.fields[M.name]=M,M.message=this,M.onAdd(this),F(this)}return M instanceof g?(this.oneofs||(this.oneofs={}),this.oneofs[M.name]=M,M.onAdd(this),F(this)):f.prototype.add.call(this,M)},S.prototype.remove=function(M){if(M instanceof _&&M.extend===void 0){if(!this.fields||this.fields[M.name]!==M)throw Error(M+" is not a member of "+this);return delete this.fields[M.name],M.parent=null,M.onRemove(this),F(this)}if(M instanceof g){if(!this.oneofs||this.oneofs[M.name]!==M)throw Error(M+" is not a member of "+this);return delete this.oneofs[M.name],M.parent=null,M.onRemove(this),F(this)}return f.prototype.remove.call(this,M)},S.prototype.isReservedId=function(M){return f.isReservedId(this.reserved,M)},S.prototype.isReservedName=function(M){return f.isReservedName(this.reserved,M)},S.prototype.create=function(M){return new this.ctor(M)},S.prototype.setup=function(){for(var M=this.fullName,Z=[],U=0;U<this.fieldsArray.length;++U)Z.push(this._fieldsArray[U].resolve().resolvedType);this.encode=P(this)({Writer:R,types:Z,util:D}),this.decode=k(this)({Reader:A,types:Z,util:D}),this.verify=b(this)({types:Z,util:D}),this.fromObject=j.fromObject(this)({types:Z,util:D}),this.toObject=j.toObject(this)({types:Z,util:D});var Y=z[M];if(Y){var q=Object.create(this);q.fromObject=this.fromObject,this.fromObject=Y.fromObject.bind(q),q.toObject=this.toObject,this.toObject=Y.toObject.bind(q)}return this},S.prototype.encode=function(M,Z){return this.setup().encode(M,Z)},S.prototype.encodeDelimited=function(M,Z){return this.encode(M,Z&&Z.len?Z.fork():Z).ldelim()},S.prototype.decode=function(M,Z){return this.setup().decode(M,Z)},S.prototype.decodeDelimited=function(M){return M instanceof A||(M=A.create(M)),this.decode(M,M.uint32())},S.prototype.verify=function(M){return this.setup().verify(M)},S.prototype.fromObject=function(M){return this.setup().fromObject(M)},S.prototype.toObject=function(M,Z){return this.setup().toObject(M,Z)},S.d=function(M){return function(Z){D.decorateType(Z,M)}}},7063:function(O,H,a){var f=H,h=a(9935),g=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function _(E,m){var p=0,A={};for(m|=0;p<E.length;)A[g[p+m]]=E[p++];return A}f.basic=_([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),f.defaults=_([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",h.emptyArray,null]),f.long=_([0,0,0,1,1],7),f.mapKey=_([0,0,0,5,5,0,0,0,1,1,0,2],2),f.packed=_([1,5,0,0,0,5,5,0,0,0,1,1,0])},9935:function(O,H,a){var f,h,g=O.exports=a(9693),_=a(5054);g.codegen=a(5124),g.fetch=a(9054),g.path=a(8626),g.fs=g.inquire("fs"),g.toArray=function(R){if(R){for(var D=Object.keys(R),P=new Array(D.length),k=0;k<D.length;)P[k]=R[D[k++]];return P}return[]},g.toObject=function(R){for(var D={},P=0;P<R.length;){var k=R[P++],b=R[P++];b!==void 0&&(D[k]=b)}return D};var E=/\\/g,m=/"/g;g.isReserved=function(R){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(R)},g.safeProp=function(R){return!/^[$\w_]+$/.test(R)||g.isReserved(R)?'["'+R.replace(E,"\\\\").replace(m,'\\"')+'"]':"."+R},g.ucFirst=function(R){return R.charAt(0).toUpperCase()+R.substring(1)};var p=/_([a-z])/g;g.camelCase=function(R){return R.substring(0,1)+R.substring(1).replace(p,function(D,P){return P.toUpperCase()})},g.compareFieldsById=function(R,D){return R.id-D.id},g.decorateType=function(R,D){if(R.$type)return D&&R.$type.name!==D&&(g.decorateRoot.remove(R.$type),R.$type.name=D,g.decorateRoot.add(R.$type)),R.$type;f||(f=a(7645));var P=new f(D||R.name);return g.decorateRoot.add(P),P.ctor=R,Object.defineProperty(R,"$type",{value:P,enumerable:!1}),Object.defineProperty(R.prototype,"$type",{value:P,enumerable:!1}),P};var A=0;g.decorateEnum=function(R){if(R.$type)return R.$type;h||(h=a(7025));var D=new h("Enum"+A++,R);return g.decorateRoot.add(D),Object.defineProperty(R,"$type",{value:D,enumerable:!1}),D},g.setProperty=function(R,D,P){if(typeof R!="object")throw TypeError("dst must be an object");if(!D)throw TypeError("path must be specified");return function k(b,j,z){var S=j.shift();if(S==="__proto__")return b;if(j.length>0)b[S]=k(b[S]||{},j,z);else{var F=b[S];F&&(z=[].concat(F).concat(z)),b[S]=z}return b}(R,D=D.split("."),P)},Object.defineProperty(g,"decorateRoot",{get:function(){return _.decorated||(_.decorated=new(a(9424)))}})},1945:function(O,H,a){O.exports=h;var f=a(9693);function h(m,p){this.lo=m>>>0,this.hi=p>>>0}var g=h.zero=new h(0,0);g.toNumber=function(){return 0},g.zzEncode=g.zzDecode=function(){return this},g.length=function(){return 1};var _=h.zeroHash="\0\0\0\0\0\0\0\0";h.fromNumber=function(m){if(m===0)return g;var p=m<0;p&&(m=-m);var A=m>>>0,R=(m-A)/4294967296>>>0;return p&&(R=~R>>>0,A=~A>>>0,++A>4294967295&&(A=0,++R>4294967295&&(R=0))),new h(A,R)},h.from=function(m){if(typeof m=="number")return h.fromNumber(m);if(f.isString(m)){if(!f.Long)return h.fromNumber(parseInt(m,10));m=f.Long.fromString(m)}return m.low||m.high?new h(m.low>>>0,m.high>>>0):g},h.prototype.toNumber=function(m){if(!m&&this.hi>>>31){var p=1+~this.lo>>>0,A=~this.hi>>>0;return p||(A=A+1>>>0),-(p+4294967296*A)}return this.lo+4294967296*this.hi},h.prototype.toLong=function(m){return f.Long?new f.Long(0|this.lo,0|this.hi,!!m):{low:0|this.lo,high:0|this.hi,unsigned:!!m}};var E=String.prototype.charCodeAt;h.fromHash=function(m){return m===_?g:new h((E.call(m,0)|E.call(m,1)<<8|E.call(m,2)<<16|E.call(m,3)<<24)>>>0,(E.call(m,4)|E.call(m,5)<<8|E.call(m,6)<<16|E.call(m,7)<<24)>>>0)},h.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},h.prototype.zzEncode=function(){var m=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^m)>>>0,this.lo=(this.lo<<1^m)>>>0,this},h.prototype.zzDecode=function(){var m=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^m)>>>0,this.hi=(this.hi>>>1^m)>>>0,this},h.prototype.length=function(){var m=this.lo,p=(this.lo>>>28|this.hi<<4)>>>0,A=this.hi>>>24;return A===0?p===0?m<16384?m<128?1:2:m<2097152?3:4:p<16384?p<128?5:6:p<2097152?7:8:A<128?9:10}},9693:function(O,H,a){var f=H;function h(_,E,m){for(var p=Object.keys(E),A=0;A<p.length;++A)_[p[A]]!==void 0&&m||(_[p[A]]=E[p[A]]);return _}function g(_){function E(m,p){if(!(this instanceof E))return new E(m,p);Object.defineProperty(this,"message",{get:function(){return m}}),Error.captureStackTrace?Error.captureStackTrace(this,E):Object.defineProperty(this,"stack",{value:new Error().stack||""}),p&&h(this,p)}return(E.prototype=Object.create(Error.prototype)).constructor=E,Object.defineProperty(E.prototype,"name",{get:function(){return _}}),E.prototype.toString=function(){return this.name+": "+this.message},E}f.asPromise=a(4537),f.base64=a(7419),f.EventEmitter=a(9211),f.float=a(945),f.inquire=a(7199),f.utf8=a(4997),f.pool=a(6662),f.LongBits=a(1945),f.isNode=!!(a.g!==void 0&&a.g&&a.g.process&&a.g.process.versions&&a.g.process.versions.node),f.global=f.isNode&&a.g||typeof window<"u"&&window||typeof self<"u"&&self||this,f.emptyArray=Object.freeze?Object.freeze([]):[],f.emptyObject=Object.freeze?Object.freeze({}):{},f.isInteger=Number.isInteger||function(_){return typeof _=="number"&&isFinite(_)&&Math.floor(_)===_},f.isString=function(_){return typeof _=="string"||_ instanceof String},f.isObject=function(_){return _&&typeof _=="object"},f.isset=f.isSet=function(_,E){var m=_[E];return!(m==null||!_.hasOwnProperty(E))&&(typeof m!="object"||(Array.isArray(m)?m.length:Object.keys(m).length)>0)},f.Buffer=function(){try{var _=f.inquire("buffer").Buffer;return _.prototype.utf8Write?_:null}catch{return null}}(),f._Buffer_from=null,f._Buffer_allocUnsafe=null,f.newBuffer=function(_){return typeof _=="number"?f.Buffer?f._Buffer_allocUnsafe(_):new f.Array(_):f.Buffer?f._Buffer_from(_):typeof Uint8Array>"u"?_:new Uint8Array(_)},f.Array=typeof Uint8Array<"u"?Uint8Array:Array,f.Long=f.global.dcodeIO&&f.global.dcodeIO.Long||f.global.Long||f.inquire("long"),f.key2Re=/^true|false|0|1$/,f.key32Re=/^-?(?:0|[1-9][0-9]*)$/,f.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,f.longToHash=function(_){return _?f.LongBits.from(_).toHash():f.LongBits.zeroHash},f.longFromHash=function(_,E){var m=f.LongBits.fromHash(_);return f.Long?f.Long.fromBits(m.lo,m.hi,E):m.toNumber(!!E)},f.merge=h,f.lcFirst=function(_){return _.charAt(0).toLowerCase()+_.substring(1)},f.newError=g,f.ProtocolError=g("ProtocolError"),f.oneOfGetter=function(_){for(var E={},m=0;m<_.length;++m)E[_[m]]=1;return function(){for(var p=Object.keys(this),A=p.length-1;A>-1;--A)if(E[p[A]]===1&&this[p[A]]!==void 0&&this[p[A]]!==null)return p[A]}},f.oneOfSetter=function(_){return function(E){for(var m=0;m<_.length;++m)_[m]!==E&&delete this[_[m]]}},f.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},f._configure=function(){var _=f.Buffer;_?(f._Buffer_from=_.from!==Uint8Array.from&&_.from||function(E,m){return new _(E,m)},f._Buffer_allocUnsafe=_.allocUnsafe||function(E){return new _(E)}):f._Buffer_from=f._Buffer_allocUnsafe=null}},4497:function(O,H,a){O.exports=function(m){var p=h.codegen(["m"],m.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),A={};m.oneofsArray.length&&p("var p={}");for(var R=0;R<m.fieldsArray.length;++R){var D=m._fieldsArray[R].resolve(),P="m"+h.safeProp(D.name);if(D.optional&&p("if(%s!=null&&m.hasOwnProperty(%j)){",P,D.name),D.map)p("if(!util.isObject(%s))",P)("return%j",g(D,"object"))("var k=Object.keys(%s)",P)("for(var i=0;i<k.length;++i){"),E(p,D,"k[i]"),_(p,D,R,P+"[k[i]]")("}");else if(D.repeated)p("if(!Array.isArray(%s))",P)("return%j",g(D,"array"))("for(var i=0;i<%s.length;++i){",P),_(p,D,R,P+"[i]")("}");else{if(D.partOf){var k=h.safeProp(D.partOf.name);A[D.partOf.name]===1&&p("if(p%s===1)",k)("return%j",D.partOf.name+": multiple values"),A[D.partOf.name]=1,p("p%s=1",k)}_(p,D,R,P)}D.optional&&p("}")}return p("return null")};var f=a(7025),h=a(9935);function g(m,p){return m.name+": "+p+(m.repeated&&p!=="array"?"[]":m.map&&p!=="object"?"{k:"+m.keyType+"}":"")+" expected"}function _(m,p,A,R){if(p.resolvedType)if(p.resolvedType instanceof f){m("switch(%s){",R)("default:")("return%j",g(p,"enum value"));for(var D=Object.keys(p.resolvedType.values),P=0;P<D.length;++P)m("case %i:",p.resolvedType.values[D[P]]);m("break")("}")}else m("{")("var e=types[%i].verify(%s);",A,R)("if(e)")("return%j+e",p.name+".")("}");else switch(p.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":m("if(!util.isInteger(%s))",R)("return%j",g(p,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":m("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",R,R,R,R)("return%j",g(p,"integer|Long"));break;case"float":case"double":m('if(typeof %s!=="number")',R)("return%j",g(p,"number"));break;case"bool":m('if(typeof %s!=="boolean")',R)("return%j",g(p,"boolean"));break;case"string":m("if(!util.isString(%s))",R)("return%j",g(p,"string"));break;case"bytes":m('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',R,R,R)("return%j",g(p,"buffer"))}return m}function E(m,p,A){switch(p.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":m("if(!util.key32Re.test(%s))",A)("return%j",g(p,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":m("if(!util.key64Re.test(%s))",A)("return%j",g(p,"integer|Long key"));break;case"bool":m("if(!util.key2Re.test(%s))",A)("return%j",g(p,"boolean key"))}return m}},1667:function(O,H,a){var f=H,h=a(8368);f[".google.protobuf.Any"]={fromObject:function(g){if(g&&g["@type"]){var _=g["@type"].substring(g["@type"].lastIndexOf("/")+1),E=this.lookup(_);if(E){var m=g["@type"].charAt(0)==="."?g["@type"].substr(1):g["@type"];return m.indexOf("/")===-1&&(m="/"+m),this.create({type_url:m,value:E.encode(E.fromObject(g)).finish()})}}return this.fromObject(g)},toObject:function(g,_){var E="",m="";if(_&&_.json&&g.type_url&&g.value){m=g.type_url.substring(g.type_url.lastIndexOf("/")+1),E=g.type_url.substring(0,g.type_url.lastIndexOf("/")+1);var p=this.lookup(m);p&&(g=p.decode(g.value))}if(!(g instanceof this.ctor)&&g instanceof h){var A=g.$type.toObject(g,_);return E===""&&(E="type.googleapis.com/"),m=E+(g.$type.fullName[0]==="."?g.$type.fullName.substr(1):g.$type.fullName),A["@type"]=m,A}return this.toObject(g,_)}}},1173:function(O,H,a){O.exports=R;var f,h=a(9693),g=h.LongBits,_=h.base64,E=h.utf8;function m(S,F,M){this.fn=S,this.len=F,this.next=void 0,this.val=M}function p(){}function A(S){this.head=S.head,this.tail=S.tail,this.len=S.len,this.next=S.states}function R(){this.len=0,this.head=new m(p,0,0),this.tail=this.head,this.states=null}var D=function(){return h.Buffer?function(){return(R.create=function(){return new f})()}:function(){return new R}};function P(S,F,M){F[M]=255&S}function k(S,F){this.len=S,this.next=void 0,this.val=F}function b(S,F,M){for(;S.hi;)F[M++]=127&S.lo|128,S.lo=(S.lo>>>7|S.hi<<25)>>>0,S.hi>>>=7;for(;S.lo>127;)F[M++]=127&S.lo|128,S.lo=S.lo>>>7;F[M++]=S.lo}function j(S,F,M){F[M]=255&S,F[M+1]=S>>>8&255,F[M+2]=S>>>16&255,F[M+3]=S>>>24}R.create=D(),R.alloc=function(S){return new h.Array(S)},h.Array!==Array&&(R.alloc=h.pool(R.alloc,h.Array.prototype.subarray)),R.prototype._push=function(S,F,M){return this.tail=this.tail.next=new m(S,F,M),this.len+=F,this},k.prototype=Object.create(m.prototype),k.prototype.fn=function(S,F,M){for(;S>127;)F[M++]=127&S|128,S>>>=7;F[M]=S},R.prototype.uint32=function(S){return this.len+=(this.tail=this.tail.next=new k((S>>>=0)<128?1:S<16384?2:S<2097152?3:S<268435456?4:5,S)).len,this},R.prototype.int32=function(S){return S<0?this._push(b,10,g.fromNumber(S)):this.uint32(S)},R.prototype.sint32=function(S){return this.uint32((S<<1^S>>31)>>>0)},R.prototype.uint64=function(S){var F=g.from(S);return this._push(b,F.length(),F)},R.prototype.int64=R.prototype.uint64,R.prototype.sint64=function(S){var F=g.from(S).zzEncode();return this._push(b,F.length(),F)},R.prototype.bool=function(S){return this._push(P,1,S?1:0)},R.prototype.fixed32=function(S){return this._push(j,4,S>>>0)},R.prototype.sfixed32=R.prototype.fixed32,R.prototype.fixed64=function(S){var F=g.from(S);return this._push(j,4,F.lo)._push(j,4,F.hi)},R.prototype.sfixed64=R.prototype.fixed64,R.prototype.float=function(S){return this._push(h.float.writeFloatLE,4,S)},R.prototype.double=function(S){return this._push(h.float.writeDoubleLE,8,S)};var z=h.Array.prototype.set?function(S,F,M){F.set(S,M)}:function(S,F,M){for(var Z=0;Z<S.length;++Z)F[M+Z]=S[Z]};R.prototype.bytes=function(S){var F=S.length>>>0;if(!F)return this._push(P,1,0);if(h.isString(S)){var M=R.alloc(F=_.length(S));_.decode(S,M,0),S=M}return this.uint32(F)._push(z,F,S)},R.prototype.string=function(S){var F=E.length(S);return F?this.uint32(F)._push(E.write,F,S):this._push(P,1,0)},R.prototype.fork=function(){return this.states=new A(this),this.head=this.tail=new m(p,0,0),this.len=0,this},R.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new m(p,0,0),this.len=0),this},R.prototype.ldelim=function(){var S=this.head,F=this.tail,M=this.len;return this.reset().uint32(M),M&&(this.tail.next=S.next,this.tail=F,this.len+=M),this},R.prototype.finish=function(){for(var S=this.head.next,F=this.constructor.alloc(this.len),M=0;S;)S.fn(S.val,F,M),M+=S.len,S=S.next;return F},R._configure=function(S){f=S,R.create=D(),f._configure()}},3155:function(O,H,a){O.exports=g;var f=a(1173);(g.prototype=Object.create(f.prototype)).constructor=g;var h=a(9693);function g(){f.call(this)}function _(E,m,p){E.length<40?h.utf8.write(E,m,p):m.utf8Write?m.utf8Write(E,p):m.write(E,p)}g._configure=function(){g.alloc=h._Buffer_allocUnsafe,g.writeBytesBuffer=h.Buffer&&h.Buffer.prototype instanceof Uint8Array&&h.Buffer.prototype.set.name==="set"?function(E,m,p){m.set(E,p)}:function(E,m,p){if(E.copy)E.copy(m,p,0,E.length);else for(var A=0;A<E.length;)m[p++]=E[A++]}},g.prototype.bytes=function(E){h.isString(E)&&(E=h._Buffer_from(E,"base64"));var m=E.length>>>0;return this.uint32(m),m&&this._push(g.writeBytesBuffer,m,E),this},g.prototype.string=function(E){var m=h.Buffer.byteLength(E);return this.uint32(m),m&&this._push(_,m,E),this},g._configure()},8e3:function(O,H,a){var f=a(7581);O.exports=a(3626)(f),"_sockjs_onload"in a.g&&setTimeout(a.g._sockjs_onload,1)},2530:function(O,H,a){var f=a(5717),h=a(685);function g(){h.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}f(g,h),O.exports=g},3212:function(O,H,a){var f=a(5717),h=a(3184);function g(){h.call(this)}f(g,h),g.prototype.removeAllListeners=function(_){_?delete this._listeners[_]:this._listeners={}},g.prototype.once=function(_,E){var m=this,p=!1;this.on(_,function A(){m.removeListener(_,A),p||(p=!0,E.apply(this,arguments))})},g.prototype.emit=function(){var _=arguments[0],E=this._listeners[_];if(E){for(var m=arguments.length,p=new Array(m-1),A=1;A<m;A++)p[A-1]=arguments[A];for(var R=0;R<E.length;R++)E[R].apply(this,p)}},g.prototype.on=g.prototype.addListener=h.prototype.addEventListener,g.prototype.removeListener=h.prototype.removeEventListener,O.exports.v=g},685:function(O){function H(a){this.type=a}H.prototype.initEvent=function(a,f,h){return this.type=a,this.bubbles=f,this.cancelable=h,this.timeStamp=+new Date,this},H.prototype.stopPropagation=function(){},H.prototype.preventDefault=function(){},H.CAPTURING_PHASE=1,H.AT_TARGET=2,H.BUBBLING_PHASE=3,O.exports=H},3184:function(O){function H(){this._listeners={}}H.prototype.addEventListener=function(a,f){a in this._listeners||(this._listeners[a]=[]);var h=this._listeners[a];h.indexOf(f)===-1&&(h=h.concat([f])),this._listeners[a]=h},H.prototype.removeEventListener=function(a,f){var h=this._listeners[a];if(h){var g=h.indexOf(f);g===-1||(h.length>1?this._listeners[a]=h.slice(0,g).concat(h.slice(g+1)):delete this._listeners[a])}},H.prototype.dispatchEvent=function(){var a=arguments[0],f=a.type,h=arguments.length===1?[a]:Array.apply(null,arguments);if(this["on"+f]&&this["on"+f].apply(this,h),f in this._listeners)for(var g=this._listeners[f],_=0;_<g.length;_++)g[_].apply(this,h)},O.exports=H},3326:function(O,H,a){var f=a(5717),h=a(685);function g(_){h.call(this),this.initEvent("message",!1,!1),this.data=_}f(g,h),O.exports=g},691:function(O,H,a){var f=a(3683);function h(g){this._transport=g,g.on("message",this._transportMessage.bind(this)),g.on("close",this._transportClose.bind(this))}h.prototype._transportClose=function(g,_){f.postMessage("c",JSON.stringify([g,_]))},h.prototype._transportMessage=function(g){f.postMessage("t",g)},h.prototype._send=function(g){this._transport.send(g)},h.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()},O.exports=h},551:function(O,H,a){var f=a(273),h=a(7705),g=a(691),_=a(6311),E=a(3683),m=a(7486);O.exports=function(p,A){var R,D={};A.forEach(function(P){P.facadeTransport&&(D[P.facadeTransport.transportName]=P.facadeTransport)}),D[_.transportName]=_,p.bootstrap_iframe=function(){var P;E.currentWindowId=m.hash.slice(1),h.attachEvent("message",function(k){if(k.source===parent&&(R===void 0&&(R=k.origin),k.origin===R)){var b;try{b=JSON.parse(k.data)}catch{return void k.data}if(b.windowId===E.currentWindowId)switch(b.type){case"s":var j;try{j=JSON.parse(b.data)}catch{b.data;break}var z=j[0],S=j[1],F=j[2],M=j[3];if(z!==p.version)throw new Error('Incompatible SockJS! Main site uses: "'+z+'", the iframe: "'+p.version+'".');if(!f.isOriginEqual(F,m.href)||!f.isOriginEqual(M,m.href))throw new Error("Can't connect to different domain from within an iframe. ("+m.href+", "+F+", "+M+")");P=new g(new D[S](F,M));break;case"m":P._send(b.data);break;case"c":P&&P._close(),P=null}}}),E.postMessage("s")}}},2550:function(O,H,a){var f=a(3212).v,h=a(5717),g=a(2217);function _(E,m){f.call(this);var p=this,A=+new Date;this.xo=new m("GET",E),this.xo.once("finish",function(R,D){var P,k;if(R===200){if(k=+new Date-A,D)try{P=JSON.parse(D)}catch{}g.isObject(P)||(P={})}p.emit("finish",P,k),p.removeAllListeners()})}h(_,f),_.prototype.close=function(){this.removeAllListeners(),this.xo.close()},O.exports=_},6311:function(O,H,a){var f=a(5717),h=a(3212).v,g=a(3515),_=a(2550);function E(m){var p=this;h.call(this),this.ir=new _(m,g),this.ir.once("finish",function(A,R){p.ir=null,p.emit("message",JSON.stringify([A,R]))})}f(E,h),E.transportName="iframe-info-receiver",E.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()},O.exports=E},3616:function(O,H,a){var f=a(3212).v,h=a(5717),g=a(7705),_=a(5088),E=a(6311);function m(p,A){var R=this;f.call(this);var D=function(){var P=R.ifr=new _(E.transportName,A,p);P.once("message",function(k){if(k){var b;try{b=JSON.parse(k)}catch{return R.emit("finish"),void R.close()}var j=b[0],z=b[1];R.emit("finish",j,z)}R.close()}),P.once("close",function(){R.emit("finish"),R.close()})};a.g.document.body?D():g.attachEvent("load",D)}h(m,f),m.enabled=function(){return _.enabled()},m.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null},O.exports=m},5172:function(O,H,a){var f=a(3212).v,h=a(5717),g=a(273),_=a(6073),E=a(9033),m=a(3515),p=a(7103),A=a(3616),R=a(2550);function D(P,k){var b=this;f.call(this),setTimeout(function(){b.doXhr(P,k)},0)}h(D,f),D._getReceiver=function(P,k,b){return b.sameOrigin?new R(k,m):E.enabled?new R(k,E):_.enabled&&b.sameScheme?new R(k,_):A.enabled()?new A(P,k):new R(k,p)},D.prototype.doXhr=function(P,k){var b=this,j=g.addPath(P,"/info");this.xo=D._getReceiver(P,j,k),this.timeoutRef=setTimeout(function(){b._cleanup(!1),b.emit("finish")},D.timeout),this.xo.once("finish",function(z,S){b._cleanup(!0),b.emit("finish",z,S)})},D.prototype._cleanup=function(P){clearTimeout(this.timeoutRef),this.timeoutRef=null,!P&&this.xo&&this.xo.close(),this.xo=null},D.prototype.close=function(){this.removeAllListeners(),this._cleanup(!1)},D.timeout=8e3,O.exports=D},7486:function(O,H,a){O.exports=a.g.location||{origin:"http://localhost:80",protocol:"http:",host:"localhost",port:80,href:"http://localhost/",hash:""}},3626:function(O,H,a){a(1247);var f,h=a(4564),g=a(5717),_=a(8915),E=a(8028),m=a(273),p=a(7705),A=a(5581),R=a(2217),D=a(8510),P=a(4886),k=a(685),b=a(3184),j=a(7486),z=a(2530),S=a(3326),F=a(5172);function M(U,Y,q){if(!(this instanceof M))return new M(U,Y,q);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");b.call(this),this.readyState=M.CONNECTING,this.extensions="",this.protocol="",(q=q||{}).protocols_whitelist&&P.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=q.transports,this._transportOptions=q.transportOptions||{},this._timeout=q.timeout||0;var V=q.sessionId||8;if(typeof V=="function")this._generateSessionId=V;else{if(typeof V!="number")throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._generateSessionId=function(){return _.string(V)}}this._server=q.server||_.numberString(1e3);var it=new h(U);if(!it.host||!it.protocol)throw new SyntaxError("The URL '"+U+"' is invalid");if(it.hash)throw new SyntaxError("The URL must not contain a fragment");if(it.protocol!=="http:"&&it.protocol!=="https:")throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+it.protocol+"' is not allowed.");var mt=it.protocol==="https:";if(j.protocol==="https:"&&!mt&&!m.isLoopbackAddr(it.hostname))throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");Y?Array.isArray(Y)||(Y=[Y]):Y=[];var wt=Y.sort();wt.forEach(function(Ht,Yt){if(!Ht)throw new SyntaxError("The protocols entry '"+Ht+"' is invalid.");if(Yt<wt.length-1&&Ht===wt[Yt+1])throw new SyntaxError("The protocols entry '"+Ht+"' is duplicated.")});var yt=m.getOrigin(j.href);this._origin=yt?yt.toLowerCase():null,it.set("pathname",it.pathname.replace(/\/+$/,"")),this.url=it.href,this.url,this._urlInfo={nullOrigin:!D.hasDomain(),sameOrigin:m.isOriginEqual(this.url,j.href),sameScheme:m.isSchemeEqual(this.url,j.href)},this._ir=new F(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}function Z(U){return U===1e3||U>=3e3&&U<=4999}g(M,b),M.prototype.close=function(U,Y){if(U&&!Z(U))throw new Error("InvalidAccessError: Invalid code");if(Y&&Y.length>123)throw new SyntaxError("reason argument has an invalid length");this.readyState!==M.CLOSING&&this.readyState!==M.CLOSED&&this._close(U||1e3,Y||"Normal closure",!0)},M.prototype.send=function(U){if(typeof U!="string"&&(U=""+U),this.readyState===M.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===M.OPEN&&this._transport.send(E.quote(U))},M.version=a(2828),M.CONNECTING=0,M.OPEN=1,M.CLOSING=2,M.CLOSED=3,M.prototype._receiveInfo=function(U,Y){if(this._ir=null,U){this._rto=this.countRTO(Y),this._transUrl=U.base_url?U.base_url:this.url,U=R.extend(U,this._urlInfo);var q=f.filterToEnabled(this._transportsWhitelist,U);this._transports=q.main,this._transports.length,this._connect()}else this._close(1002,"Cannot connect to server")},M.prototype._connect=function(){for(var U=this._transports.shift();U;U=this._transports.shift()){if(U.transportName,U.needBody&&(!a.g.document.body||a.g.document.readyState!==void 0&&a.g.document.readyState!=="complete"&&a.g.document.readyState!=="interactive"))return this._transports.unshift(U),void p.attachEvent("load",this._connect.bind(this));var Y=Math.max(this._timeout,this._rto*U.roundTrips||5e3);this._transportTimeoutId=setTimeout(this._transportTimeout.bind(this),Y);var q=m.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),V=this._transportOptions[U.transportName],it=new U(q,this._transUrl,V);return it.on("message",this._transportMessage.bind(this)),it.once("close",this._transportClose.bind(this)),it.transportName=U.transportName,void(this._transport=it)}this._close(2e3,"All transports failed",!1)},M.prototype._transportTimeout=function(){this.readyState===M.CONNECTING&&(this._transport&&this._transport.close(),this._transportClose(2007,"Transport timed out"))},M.prototype._transportMessage=function(U){var Y,q=this,V=U.slice(0,1),it=U.slice(1);switch(V){case"o":return void this._open();case"h":return this.dispatchEvent(new k("heartbeat")),void this.transport}if(it)try{Y=JSON.parse(it)}catch{}if(Y!==void 0)switch(V){case"a":Array.isArray(Y)&&Y.forEach(function(mt){q.transport,q.dispatchEvent(new S(mt))});break;case"m":this.transport,this.dispatchEvent(new S(Y));break;case"c":Array.isArray(Y)&&Y.length===2&&this._close(Y[0],Y[1],!0)}},M.prototype._transportClose=function(U,Y){this.transport,this._transport&&(this._transport.removeAllListeners(),this._transport=null,this.transport=null),Z(U)||U===2e3||this.readyState!==M.CONNECTING?this._close(U,Y):this._connect()},M.prototype._open=function(){this._transport&&this._transport.transportName,this.readyState,this.readyState===M.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=M.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new k("open")),this.transport):this._close(1006,"Server lost session")},M.prototype._close=function(U,Y,q){this.transport,this.readyState;var V=!1;if(this._ir&&(V=!0,this._ir.close(),this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===M.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=M.CLOSING,setTimeout(function(){this.readyState=M.CLOSED,V&&this.dispatchEvent(new k("error"));var it=new z("close");it.wasClean=q||!1,it.code=U||1e3,it.reason=Y,this.dispatchEvent(it),this.onmessage=this.onclose=this.onerror=null}.bind(this),0)},M.prototype.countRTO=function(U){return U>100?4*U:300+U},O.exports=function(U){return f=A(U),a(551)(M,U),M}},1247:function(){var O,H=Array.prototype,a=Object.prototype,f=Function.prototype,h=String.prototype,g=H.slice,_=a.toString,E=function(U){return a.toString.call(U)==="[object Function]"},m=function(U){return _.call(U)==="[object String]"},p=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch{return!1}}();O=p?function(U,Y,q,V){!V&&Y in U||Object.defineProperty(U,Y,{configurable:!0,enumerable:!1,writable:!0,value:q})}:function(U,Y,q,V){!V&&Y in U||(U[Y]=q)};var A=function(U,Y,q){for(var V in Y)a.hasOwnProperty.call(Y,V)&&O(U,V,Y[V],q)},R=function(U){if(U==null)throw new TypeError("can't convert "+U+" to object");return Object(U)};function D(){}A(f,{bind:function(U){var Y=this;if(!E(Y))throw new TypeError("Function.prototype.bind called on incompatible "+Y);for(var q=g.call(arguments,1),V=Math.max(0,Y.length-q.length),it=[],mt=0;mt<V;mt++)it.push("$"+mt);var wt=Function("binder","return function ("+it.join(",")+"){ return binder.apply(this, arguments); }")(function(){if(this instanceof wt){var yt=Y.apply(this,q.concat(g.call(arguments)));return Object(yt)===yt?yt:this}return Y.apply(U,q.concat(g.call(arguments)))});return Y.prototype&&(D.prototype=Y.prototype,wt.prototype=new D,D.prototype=null),wt}}),A(Array,{isArray:function(U){return _.call(U)==="[object Array]"}});var P,k,b,j=Object("a"),z=j[0]!=="a"||!(0 in j);A(H,{forEach:function(U){var Y=R(this),q=z&&m(this)?this.split(""):Y,V=arguments[1],it=-1,mt=q.length>>>0;if(!E(U))throw new TypeError;for(;++it<mt;)it in q&&U.call(V,q[it],it,Y)}},(P=H.forEach,k=!0,b=!0,P&&(P.call("foo",function(U,Y,q){typeof q!="object"&&(k=!1)}),P.call([1],function(){b=typeof this=="string"},"x")),!(P&&k&&b)));var S=Array.prototype.indexOf&&[0,1].indexOf(1,2)!==-1;A(H,{indexOf:function(U){var Y=z&&m(this)?this.split(""):R(this),q=Y.length>>>0;if(!q)return-1;var V,it=0;for(arguments.length>1&&((V=+arguments[1])!=V?V=0:V!==0&&V!==1/0&&V!==-1/0&&(V=(V>0||-1)*Math.floor(Math.abs(V))),it=V),it=it>=0?it:Math.max(0,q+it);it<q;it++)if(it in Y&&Y[it]===U)return it;return-1}},S);var F,M=h.split;"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1?(F=/()??/.exec("")[1]===void 0,h.split=function(U,Y){var q=this;if(U===void 0&&Y===0)return[];if(_.call(U)!=="[object RegExp]")return M.call(this,U,Y);var V,it,mt,wt,yt=[],Ht=(U.ignoreCase?"i":"")+(U.multiline?"m":"")+(U.extended?"x":"")+(U.sticky?"y":""),Yt=0;for(U=new RegExp(U.source,Ht+"g"),q+="",F||(V=new RegExp("^"+U.source+"$(?!\\s)",Ht)),Y=Y===void 0?4294967295:Y>>>0;(it=U.exec(q))&&!((mt=it.index+it[0].length)>Yt&&(yt.push(q.slice(Yt,it.index)),!F&&it.length>1&&it[0].replace(V,function(){for(var At=1;At<arguments.length-2;At++)arguments[At]===void 0&&(it[At]=void 0)}),it.length>1&&it.index<q.length&&H.push.apply(yt,it.slice(1)),wt=it[0].length,Yt=mt,yt.length>=Y));)U.lastIndex===it.index&&U.lastIndex++;return Yt===q.length?!wt&&U.test("")||yt.push(""):yt.push(q.slice(Yt)),yt.length>Y?yt.slice(0,Y):yt}):"0".split(void 0,0).length&&(h.split=function(U,Y){return U===void 0&&Y===0?[]:M.call(this,U,Y)});var Z=h.substr;A(h,{substr:function(U,Y){return Z.call(this,U<0&&(U=this.length+U)<0?0:U,Y)}},"".substr&&"0b".substr(-1)!=="b")},7581:function(O,H,a){O.exports=[a(2412),a(9842),a(4620),a(3004),a(882)(a(3004)),a(5616),a(882)(a(5616)),a(2387),a(9998),a(882)(a(2387)),a(5375)]},2940:function(O,H,a){var f=a(3212).v,h=a(5717),g=a(7705),_=a(273),E=a.g.XMLHttpRequest;function m(R,D,P,k){var b=this;f.call(this),setTimeout(function(){b._start(R,D,P,k)},0)}h(m,f),m.prototype._start=function(R,D,P,k){var b=this;try{this.xhr=new E}catch{}if(!this.xhr)return this.emit("finish",0,"no xhr support"),void this._cleanup();D=_.addQuery(D,"t="+ +new Date),this.unloadRef=g.unloadAdd(function(){b._cleanup(!0)});try{this.xhr.open(R,D,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){b.emit("finish",0,""),b._cleanup(!1)})}catch{return this.emit("finish",0,""),void this._cleanup(!1)}if(k&&k.noCredentials||!m.supportsCORS||(this.xhr.withCredentials=!0),k&&k.headers)for(var j in k.headers)this.xhr.setRequestHeader(j,k.headers[j]);this.xhr.onreadystatechange=function(){if(b.xhr){var z,S,F=b.xhr;switch(F.readyState,F.readyState){case 3:try{S=F.status,z=F.responseText}catch{}S===1223&&(S=204),S===200&&z&&z.length>0&&b.emit("chunk",S,z);break;case 4:(S=F.status)===1223&&(S=204),S!==12005&&S!==12029||(S=0),F.responseText,b.emit("finish",S,F.responseText),b._cleanup(!1)}}};try{b.xhr.send(P)}catch{b.emit("finish",0,""),b._cleanup(!1)}},m.prototype._cleanup=function(R){if(this.xhr){if(this.removeAllListeners(),g.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),R)try{this.xhr.abort()}catch{}this.unloadRef=this.xhr=null}},m.prototype.close=function(){this._cleanup(!0)},m.enabled=!!E;var p=["Active"].concat("Object").join("X");!m.enabled&&p in a.g&&(E=function(){try{return new a.g[p]("Microsoft.XMLHTTP")}catch{return null}},m.enabled=!!new E);var A=!1;try{A="withCredentials"in new E}catch{}m.supportsCORS=A,O.exports=m},3759:function(O,H,a){O.exports=a.g.EventSource},9334:function(O,H,a){var f=a.g.WebSocket||a.g.MozWebSocket;O.exports=f?function(h){return new f(h)}:void 0},3004:function(O,H,a){var f=a(5717),h=a(9395),g=a(6709),_=a(9033),E=a(3759);function m(p){if(!m.enabled())throw new Error("Transport created when disabled");h.call(this,p,"/eventsource",g,_)}f(m,h),m.enabled=function(){return!!E},m.transportName="eventsource",m.roundTrips=2,O.exports=m},5616:function(O,H,a){var f=a(5717),h=a(3608),g=a(3515),_=a(9395);function E(m){if(!h.enabled)throw new Error("Transport created when disabled");_.call(this,m,"/htmlfile",h,g)}f(E,_),E.enabled=function(m){return h.enabled&&m.sameOrigin},E.transportName="htmlfile",E.roundTrips=2,O.exports=E},5088:function(O,H,a){var f=a(5717),h=a(3212).v,g=a(2828),_=a(273),E=a(3683),m=a(7705),p=a(8915);function A(R,D,P){if(!A.enabled())throw new Error("Transport created when disabled");h.call(this);var k=this;this.origin=_.getOrigin(P),this.baseUrl=P,this.transUrl=D,this.transport=R,this.windowId=p.string(8);var b=_.addPath(P,"/iframe.html")+"#"+this.windowId;this.iframeObj=E.createIframe(b,function(j){k.emit("close",1006,"Unable to load an iframe ("+j+")"),k.close()}),this.onmessageCallback=this._message.bind(this),m.attachEvent("message",this.onmessageCallback)}f(A,h),A.prototype.close=function(){if(this.removeAllListeners(),this.iframeObj){m.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch{}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}},A.prototype._message=function(R){if(R.data,!_.isOriginEqual(R.origin,this.origin))return R.origin,void this.origin;var D;try{D=JSON.parse(R.data)}catch{return void R.data}if(D.windowId!==this.windowId)return D.windowId,void this.windowId;switch(D.type){case"s":this.iframeObj.loaded(),this.postMessage("s",JSON.stringify([g,this.transport,this.transUrl,this.baseUrl]));break;case"t":this.emit("message",D.data);break;case"c":var P;try{P=JSON.parse(D.data)}catch{return void D.data}this.emit("close",P[0],P[1]),this.close()}},A.prototype.postMessage=function(R,D){this.iframeObj.post(JSON.stringify({windowId:this.windowId,type:R,data:D||""}),this.origin)},A.prototype.send=function(R){this.postMessage("m",R)},A.enabled=function(){return E.iframeEnabled},A.transportName="iframe",A.roundTrips=2,O.exports=A},5375:function(O,H,a){var f=a(5717),h=a(8347),g=a(514),_=a(771);function E(m){if(!E.enabled())throw new Error("Transport created when disabled");h.call(this,m,"/jsonp",_,g)}f(E,h),E.enabled=function(){return!!a.g.document},E.transportName="jsonp-polling",E.roundTrips=1,E.needBody=!0,O.exports=E},9395:function(O,H,a){var f=a(5717),h=a(273),g=a(8347);function _(E,m,p,A){g.call(this,E,m,function(R){return function(D,P,k){var b={};typeof P=="string"&&(b.headers={"Content-type":"text/plain"});var j=h.addPath(D,"/xhr_send"),z=new R("POST",j,P,b);return z.once("finish",function(S){if(z=null,S!==200&&S!==204)return k(new Error("http status "+S));k()}),function(){z.close(),z=null;var S=new Error("Aborted");S.code=1e3,k(S)}}}(A),p,A)}f(_,g),O.exports=_},1851:function(O,H,a){var f=a(5717),h=a(3212).v;function g(_,E){h.call(this),this.sendBuffer=[],this.sender=E,this.url=_}f(g,h),g.prototype.send=function(_){this.sendBuffer.push(_),this.sendStop||this.sendSchedule()},g.prototype.sendScheduleWait=function(){var _,E=this;this.sendStop=function(){E.sendStop=null,clearTimeout(_)},_=setTimeout(function(){E.sendStop=null,E.sendSchedule()},25)},g.prototype.sendSchedule=function(){this.sendBuffer.length;var _=this;if(this.sendBuffer.length>0){var E="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,E,function(m){_.sendStop=null,m?(_.emit("close",m.code||1006,"Sending error: "+m),_.close()):_.sendScheduleWait()}),this.sendBuffer=[]}},g.prototype._cleanup=function(){this.removeAllListeners()},g.prototype.close=function(){this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)},O.exports=g},882:function(O,H,a){var f=a(5717),h=a(5088),g=a(2217);O.exports=function(_){function E(m,p){h.call(this,_.transportName,m,p)}return f(E,h),E.enabled=function(m,p){if(!a.g.document)return!1;var A=g.extend({},p);return A.sameOrigin=!0,_.enabled(A)&&h.enabled()},E.transportName="iframe-"+_.transportName,E.needBody=!0,E.roundTrips=h.roundTrips+_.roundTrips-1,E.facadeTransport=_,E}},1265:function(O,H,a){var f=a(5717),h=a(3212).v;function g(_,E,m){h.call(this),this.Receiver=_,this.receiveUrl=E,this.AjaxObject=m,this._scheduleReceiver()}f(g,h),g.prototype._scheduleReceiver=function(){var _=this,E=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);E.on("message",function(m){_.emit("message",m)}),E.once("close",function(m,p){_.pollIsClosing,_.poll=E=null,_.pollIsClosing||(p==="network"?_._scheduleReceiver():(_.emit("close",m||1006,p),_.removeAllListeners()))})},g.prototype.abort=function(){this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()},O.exports=g},8347:function(O,H,a){var f=a(5717),h=a(273),g=a(1851),_=a(1265);function E(m,p,A,R,D){var P=h.addPath(m,p),k=this;g.call(this,m,A),this.poll=new _(R,P,D),this.poll.on("message",function(b){k.emit("message",b)}),this.poll.once("close",function(b,j){k.poll=null,k.emit("close",b,j),k.close()})}f(E,g),E.prototype.close=function(){g.prototype.close.call(this),this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null)},O.exports=E},6709:function(O,H,a){var f=a(5717),h=a(3212).v,g=a(3759);function _(E){h.call(this);var m=this,p=this.es=new g(E);p.onmessage=function(A){A.data,m.emit("message",decodeURI(A.data))},p.onerror=function(A){p.readyState;var R=p.readyState!==2?"network":"permanent";m._cleanup(),m._close(R)}}f(_,h),_.prototype.abort=function(){this._cleanup(),this._close("user")},_.prototype._cleanup=function(){var E=this.es;E&&(E.onmessage=E.onerror=null,E.close(),this.es=null)},_.prototype._close=function(E){var m=this;setTimeout(function(){m.emit("close",null,E),m.removeAllListeners()},200)},O.exports=_},3608:function(O,H,a){var f=a(5717),h=a(3683),g=a(273),_=a(3212).v,E=a(8915);function m(A){_.call(this);var R=this;h.polluteGlobalNamespace(),this.id="a"+E.string(6),A=g.addQuery(A,"c="+decodeURIComponent(h.WPrefix+"."+this.id)),m.htmlfileEnabled;var D=m.htmlfileEnabled?h.createHtmlfile:h.createIframe;a.g[h.WPrefix][this.id]={start:function(){R.iframeObj.loaded()},message:function(P){R.emit("message",P)},stop:function(){R._cleanup(),R._close("network")}},this.iframeObj=D(A,function(){R._cleanup(),R._close("permanent")})}f(m,_),m.prototype.abort=function(){this._cleanup(),this._close("user")},m.prototype._cleanup=function(){this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete a.g[h.WPrefix][this.id]},m.prototype._close=function(A){this.emit("close",null,A),this.removeAllListeners()},m.htmlfileEnabled=!1;var p=["Active"].concat("Object").join("X");if(p in a.g)try{m.htmlfileEnabled=!!new a.g[p]("htmlfile")}catch{}m.enabled=m.htmlfileEnabled||h.iframeEnabled,O.exports=m},514:function(O,H,a){var f=a(3683),h=a(8915),g=a(8510),_=a(273),E=a(5717),m=a(3212).v;function p(A){var R=this;m.call(this),f.polluteGlobalNamespace(),this.id="a"+h.string(6);var D=_.addQuery(A,"c="+encodeURIComponent(f.WPrefix+"."+this.id));a.g[f.WPrefix][this.id]=this._callback.bind(this),this._createScript(D),this.timeoutId=setTimeout(function(){R._abort(new Error("JSONP script loaded abnormally (timeout)"))},p.timeout)}E(p,m),p.prototype.abort=function(){if(a.g[f.WPrefix][this.id]){var A=new Error("JSONP user aborted read");A.code=1e3,this._abort(A)}},p.timeout=35e3,p.scriptErrorTimeout=1e3,p.prototype._callback=function(A){this._cleanup(),this.aborting||(A&&this.emit("message",A),this.emit("close",null,"network"),this.removeAllListeners())},p.prototype._abort=function(A){this._cleanup(),this.aborting=!0,this.emit("close",A.code,A.message),this.removeAllListeners()},p.prototype._cleanup=function(){if(clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),this.script2=null),this.script){var A=this.script;A.parentNode.removeChild(A),A.onreadystatechange=A.onerror=A.onload=A.onclick=null,this.script=null}delete a.g[f.WPrefix][this.id]},p.prototype._scriptError=function(){var A=this;this.errorTimer||(this.errorTimer=setTimeout(function(){A.loadedOkay||A._abort(new Error("JSONP script loaded abnormally (onerror)"))},p.scriptErrorTimeout))},p.prototype._createScript=function(A){var R,D=this,P=this.script=a.g.document.createElement("script");if(P.id="a"+h.string(8),P.src=A,P.type="text/javascript",P.charset="UTF-8",P.onerror=this._scriptError.bind(this),P.onload=function(){D._abort(new Error("JSONP script loaded abnormally (onload)"))},P.onreadystatechange=function(){if(P.readyState,/loaded|closed/.test(P.readyState)){if(P&&P.htmlFor&&P.onclick){D.loadedOkay=!0;try{P.onclick()}catch{}}P&&D._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},P.async===void 0&&a.g.document.attachEvent)if(g.isOpera())(R=this.script2=a.g.document.createElement("script")).text="try{var a = document.getElementById('"+P.id+"'); if(a)a.onerror();}catch(x){};",P.async=R.async=!1;else{try{P.htmlFor=P.id,P.event="onclick"}catch{}P.async=!0}P.async!==void 0&&(P.async=!0);var k=a.g.document.getElementsByTagName("head")[0];k.insertBefore(P,k.firstChild),R&&k.insertBefore(R,k.firstChild)},O.exports=p},1044:function(O,H,a){var f=a(5717),h=a(3212).v;function g(_,E){h.call(this);var m=this;this.bufferPosition=0,this.xo=new E("POST",_,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",function(p,A){m._chunkHandler(p,A),m.xo=null;var R=p===200?"network":"permanent";m.emit("close",null,R),m._cleanup()})}f(g,h),g.prototype._chunkHandler=function(_,E){if(_===200&&E)for(var m=-1;;this.bufferPosition+=m+1){var p=E.slice(this.bufferPosition);if((m=p.indexOf(`
`))===-1)break;var A=p.slice(0,m);A&&this.emit("message",A)}},g.prototype._cleanup=function(){this.removeAllListeners()},g.prototype.abort=function(){this.xo&&(this.xo.close(),this.emit("close",null,"user"),this.xo=null),this._cleanup()},O.exports=g},771:function(O,H,a){var f,h,g=a(8915),_=a(273);O.exports=function(E,m,p){f||((f=a.g.document.createElement("form")).style.display="none",f.style.position="absolute",f.method="POST",f.enctype="application/x-www-form-urlencoded",f.acceptCharset="UTF-8",(h=a.g.document.createElement("textarea")).name="d",f.appendChild(h),a.g.document.body.appendChild(f));var A="a"+g.string(8);f.target=A,f.action=_.addQuery(_.addPath(E,"/jsonp_send"),"i="+A);var R=function(P){try{return a.g.document.createElement('<iframe name="'+P+'">')}catch{var k=a.g.document.createElement("iframe");return k.name=P,k}}(A);R.id=A,R.style.display="none",f.appendChild(R);try{h.value=m}catch{}f.submit();var D=function(P){R.onerror&&(R.onreadystatechange=R.onerror=R.onload=null,setTimeout(function(){R.parentNode.removeChild(R),R=null},500),h.value="",p(P))};return R.onerror=function(){D()},R.onload=function(){D()},R.onreadystatechange=function(P){R.readyState,R.readyState==="complete"&&D()},function(){D(new Error("Aborted"))}}},6073:function(O,H,a){var f=a(3212).v,h=a(5717),g=a(7705),_=a(8510),E=a(273);function m(p,A,R){var D=this;f.call(this),setTimeout(function(){D._start(p,A,R)},0)}h(m,f),m.prototype._start=function(p,A,R){var D=this,P=new a.g.XDomainRequest;A=E.addQuery(A,"t="+ +new Date),P.onerror=function(){D._error()},P.ontimeout=function(){D._error()},P.onprogress=function(){P.responseText,D.emit("chunk",200,P.responseText)},P.onload=function(){D.emit("finish",200,P.responseText),D._cleanup(!1)},this.xdr=P,this.unloadRef=g.unloadAdd(function(){D._cleanup(!0)});try{this.xdr.open(p,A),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(R)}catch{this._error()}},m.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)},m.prototype._cleanup=function(p){if(this.xdr){if(this.removeAllListeners(),g.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,p)try{this.xdr.abort()}catch{}this.unloadRef=this.xdr=null}},m.prototype.close=function(){this._cleanup(!0)},m.enabled=!(!a.g.XDomainRequest||!_.hasDomain()),O.exports=m},9033:function(O,H,a){var f=a(5717),h=a(2940);function g(_,E,m,p){h.call(this,_,E,m,p)}f(g,h),g.enabled=h.enabled&&h.supportsCORS,O.exports=g},7103:function(O,H,a){var f=a(3212).v;function h(){var g=this;f.call(this),this.to=setTimeout(function(){g.emit("finish",200,"{}")},h.timeout)}a(5717)(h,f),h.prototype.close=function(){clearTimeout(this.to)},h.timeout=2e3,O.exports=h},3515:function(O,H,a){var f=a(5717),h=a(2940);function g(_,E,m){h.call(this,_,E,m,{noCredentials:!0})}f(g,h),g.enabled=h.enabled,O.exports=g},2412:function(O,H,a){var f=a(7705),h=a(273),g=a(5717),_=a(3212).v,E=a(9334);function m(p,A,R){if(!m.enabled())throw new Error("Transport created when disabled");_.call(this);var D=this,P=h.addPath(p,"/websocket");P=P.slice(0,5)==="https"?"wss"+P.slice(5):"ws"+P.slice(4),this.url=P,this.ws=new E(this.url,[],R),this.ws.onmessage=function(k){k.data,D.emit("message",k.data)},this.unloadRef=f.unloadAdd(function(){D.ws.close()}),this.ws.onclose=function(k){k.code,k.reason,D.emit("close",k.code,k.reason),D._cleanup()},this.ws.onerror=function(k){D.emit("close",1006,"WebSocket connection broken"),D._cleanup()}}g(m,_),m.prototype.send=function(p){var A="["+p+"]";this.ws.send(A)},m.prototype.close=function(){var p=this.ws;this._cleanup(),p&&p.close()},m.prototype._cleanup=function(){var p=this.ws;p&&(p.onmessage=p.onclose=p.onerror=null),f.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()},m.enabled=function(){return!!E},m.transportName="websocket",m.roundTrips=2,O.exports=m},9998:function(O,H,a){var f=a(5717),h=a(9395),g=a(4620),_=a(1044),E=a(6073);function m(p){if(!E.enabled)throw new Error("Transport created when disabled");h.call(this,p,"/xhr",_,E)}f(m,h),m.enabled=g.enabled,m.transportName="xdr-polling",m.roundTrips=2,O.exports=m},4620:function(O,H,a){var f=a(5717),h=a(9395),g=a(1044),_=a(6073);function E(m){if(!_.enabled)throw new Error("Transport created when disabled");h.call(this,m,"/xhr_streaming",g,_)}f(E,h),E.enabled=function(m){return!m.cookie_needed&&!m.nullOrigin&&_.enabled&&m.sameScheme},E.transportName="xdr-streaming",E.roundTrips=2,O.exports=E},2387:function(O,H,a){var f=a(5717),h=a(9395),g=a(1044),_=a(9033),E=a(3515);function m(p){if(!E.enabled&&!_.enabled)throw new Error("Transport created when disabled");h.call(this,p,"/xhr",g,_)}f(m,h),m.enabled=function(p){return!p.nullOrigin&&(!(!E.enabled||!p.sameOrigin)||_.enabled)},m.transportName="xhr-polling",m.roundTrips=2,O.exports=m},9842:function(O,H,a){var f=a(5717),h=a(9395),g=a(1044),_=a(9033),E=a(3515),m=a(8510);function p(A){if(!E.enabled&&!_.enabled)throw new Error("Transport created when disabled");h.call(this,A,"/xhr_streaming",g,_)}f(p,h),p.enabled=function(A){return!A.nullOrigin&&!m.isOpera()&&_.enabled},p.transportName="xhr-streaming",p.roundTrips=2,p.needBody=!!a.g.document,O.exports=p},2017:function(O,H,a){a.g.crypto&&a.g.crypto.getRandomValues?O.exports.randomBytes=function(f){var h=new Uint8Array(f);return a.g.crypto.getRandomValues(h),h}:O.exports.randomBytes=function(f){for(var h=new Array(f),g=0;g<f;g++)h[g]=Math.floor(256*Math.random());return h}},8510:function(O,H,a){O.exports={isOpera:function(){return a.g.navigator&&/opera/i.test(a.g.navigator.userAgent)},isKonqueror:function(){return a.g.navigator&&/konqueror/i.test(a.g.navigator.userAgent)},hasDomain:function(){if(!a.g.document)return!0;try{return!!a.g.document.domain}catch{return!1}}}},8028:function(O){var H,a=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g;O.exports={quote:function(f){var h=JSON.stringify(f);return a.lastIndex=0,a.test(h)?(H||(H=function(g){var _,E={},m=[];for(_=0;_<65536;_++)m.push(String.fromCharCode(_));return g.lastIndex=0,m.join("").replace(g,function(p){return E[p]="\\u"+("0000"+p.charCodeAt(0).toString(16)).slice(-4),""}),g.lastIndex=0,E}(a)),h.replace(a,function(g){return H[g]})):h}}},7705:function(O,H,a){var f=a(8915),h={},g=!1,_=a.g.chrome&&a.g.chrome.app&&a.g.chrome.app.runtime;O.exports={attachEvent:function(E,m){a.g.addEventListener!==void 0?a.g.addEventListener(E,m,!1):a.g.document&&a.g.attachEvent&&(a.g.document.attachEvent("on"+E,m),a.g.attachEvent("on"+E,m))},detachEvent:function(E,m){a.g.addEventListener!==void 0?a.g.removeEventListener(E,m,!1):a.g.document&&a.g.detachEvent&&(a.g.document.detachEvent("on"+E,m),a.g.detachEvent("on"+E,m))},unloadAdd:function(E){if(_)return null;var m=f.string(8);return h[m]=E,g&&setTimeout(this.triggerUnloadCallbacks,0),m},unloadDel:function(E){E in h&&delete h[E]},triggerUnloadCallbacks:function(){for(var E in h)h[E](),delete h[E]}},_||O.exports.attachEvent("unload",function(){g||(g=!0,O.exports.triggerUnloadCallbacks())})},3683:function(O,H,a){var f=a(7705),h=a(8510);O.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){O.exports.WPrefix in a.g||(a.g[O.exports.WPrefix]={})},postMessage:function(g,_){a.g.parent!==a.g&&a.g.parent.postMessage(JSON.stringify({windowId:O.exports.currentWindowId,type:g,data:_||""}),"*")},createIframe:function(g,_){var E,m,p=a.g.document.createElement("iframe"),A=function(){clearTimeout(E);try{p.onload=null}catch{}p.onerror=null},R=function(){p&&(A(),setTimeout(function(){p&&p.parentNode.removeChild(p),p=null},0),f.unloadDel(m))},D=function(P){p&&(R(),_(P))};return p.src=g,p.style.display="none",p.style.position="absolute",p.onerror=function(){D("onerror")},p.onload=function(){clearTimeout(E),E=setTimeout(function(){D("onload timeout")},2e3)},a.g.document.body.appendChild(p),E=setTimeout(function(){D("timeout")},15e3),m=f.unloadAdd(R),{post:function(P,k){setTimeout(function(){try{p&&p.contentWindow&&p.contentWindow.postMessage(P,k)}catch{}},0)},cleanup:R,loaded:A}},createHtmlfile:function(g,_){var E,m,p,A=["Active"].concat("Object").join("X"),R=new a.g[A]("htmlfile"),D=function(){clearTimeout(E),p.onerror=null},P=function(){R&&(D(),f.unloadDel(m),p.parentNode.removeChild(p),p=R=null,CollectGarbage())},k=function(j){R&&(P(),_(j))};R.open(),R.write('<html><script>document.domain="'+a.g.document.domain+'";<\/script></html>'),R.close(),R.parentWindow[O.exports.WPrefix]=a.g[O.exports.WPrefix];var b=R.createElement("div");return R.body.appendChild(b),p=R.createElement("iframe"),b.appendChild(p),p.src=g,p.onerror=function(){k("onerror")},E=setTimeout(function(){k("timeout")},15e3),m=f.unloadAdd(P),{post:function(j,z){try{setTimeout(function(){p&&p.contentWindow&&p.contentWindow.postMessage(j,z)},0)}catch{}},cleanup:P,loaded:D}}},O.exports.iframeEnabled=!1,a.g.document&&(O.exports.iframeEnabled=(typeof a.g.postMessage=="function"||typeof a.g.postMessage=="object")&&!h.isKonqueror())},4886:function(O,H,a){var f={};["log","debug","warn"].forEach(function(h){var g;try{g=a.g.console&&a.g.console[h]&&a.g.console[h].apply}catch{}f[h]=g?function(){return a.g.console[h].apply(a.g.console,arguments)}:h==="log"?function(){}:f.log}),O.exports=f},2217:function(O){O.exports={isObject:function(H){var a=typeof H;return a==="function"||a==="object"&&!!H},extend:function(H){if(!this.isObject(H))return H;for(var a,f,h=1,g=arguments.length;h<g;h++)for(f in a=arguments[h])Object.prototype.hasOwnProperty.call(a,f)&&(H[f]=a[f]);return H}}},8915:function(O,H,a){var f=a(2017);O.exports={string:function(h){for(var g=f.randomBytes(h),_=[],E=0;E<h;E++)_.push("abcdefghijklmnopqrstuvwxyz012345".substr(g[E]%32,1));return _.join("")},number:function(h){return Math.floor(Math.random()*h)},numberString:function(h){var g=(""+(h-1)).length;return(new Array(g+1).join("0")+this.number(h)).slice(-g)}}},5581:function(O){O.exports=function(H){return{filterToEnabled:function(a,f){var h={main:[],facade:[]};return a?typeof a=="string"&&(a=[a]):a=[],H.forEach(function(g){g&&(g.transportName==="websocket"&&f.websocket===!1||(a.length&&a.indexOf(g.transportName)===-1?g.transportName:g.enabled(f)?(g.transportName,h.main.push(g),g.facadeTransport&&h.facade.push(g.facadeTransport)):g.transportName))}),h}}}},273:function(O,H,a){var f=a(4564);O.exports={getOrigin:function(h){if(!h)return null;var g=new f(h);if(g.protocol==="file:")return null;var _=g.port;return _||(_=g.protocol==="https:"?"443":"80"),g.protocol+"//"+g.hostname+":"+_},isOriginEqual:function(h,g){return this.getOrigin(h)===this.getOrigin(g)},isSchemeEqual:function(h,g){return h.split(":")[0]===g.split(":")[0]},addPath:function(h,g){var _=h.split("?");return _[0]+g+(_[1]?"?"+_[1]:"")},addQuery:function(h,g){return h+(h.indexOf("?")===-1?"?"+g:"&"+g)},isLoopbackAddr:function(h){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(h)||/^\[::1\]$/.test(h)}}},2828:function(O){O.exports="1.6.1"},4564:function(O,H,a){var f=a(4058),h=a(8188),g=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,_=/[\n\r\t]/g,E=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,m=/:\d+$/,p=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,A=/^[a-zA-Z]:/;function R(S){return(S||"").toString().replace(g,"")}var D=[["#","hash"],["?","query"],function(S,F){return b(F.protocol)?S.replace(/\\/g,"/"):S},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],P={hash:1,query:1};function k(S){var F,M=(typeof window<"u"?window:a.g!==void 0?a.g:typeof self<"u"?self:{}).location||{},Z={},U=typeof(S=S||M);if(S.protocol==="blob:")Z=new z(unescape(S.pathname),{});else if(U==="string")for(F in Z=new z(S,{}),P)delete Z[F];else if(U==="object"){for(F in S)F in P||(Z[F]=S[F]);Z.slashes===void 0&&(Z.slashes=E.test(S.href))}return Z}function b(S){return S==="file:"||S==="ftp:"||S==="http:"||S==="https:"||S==="ws:"||S==="wss:"}function j(S,F){S=(S=R(S)).replace(_,""),F=F||{};var M,Z=p.exec(S),U=Z[1]?Z[1].toLowerCase():"",Y=!!Z[2],q=!!Z[3],V=0;return Y?q?(M=Z[2]+Z[3]+Z[4],V=Z[2].length+Z[3].length):(M=Z[2]+Z[4],V=Z[2].length):q?(M=Z[3]+Z[4],V=Z[3].length):M=Z[4],U==="file:"?V>=2&&(M=M.slice(2)):b(U)?M=Z[4]:U?Y&&(M=M.slice(2)):V>=2&&b(F.protocol)&&(M=Z[4]),{protocol:U,slashes:Y||b(U),slashesCount:V,rest:M}}function z(S,F,M){if(S=(S=R(S)).replace(_,""),!(this instanceof z))return new z(S,F,M);var Z,U,Y,q,V,it,mt=D.slice(),wt=typeof F,yt=this,Ht=0;for(wt!=="object"&&wt!=="string"&&(M=F,F=null),M&&typeof M!="function"&&(M=h.parse),Z=!(U=j(S||"",F=k(F))).protocol&&!U.slashes,yt.slashes=U.slashes||Z&&F.slashes,yt.protocol=U.protocol||F.protocol||"",S=U.rest,(U.protocol==="file:"&&(U.slashesCount!==2||A.test(S))||!U.slashes&&(U.protocol||U.slashesCount<2||!b(yt.protocol)))&&(mt[3]=[/(.*)/,"pathname"]);Ht<mt.length;Ht++)typeof(q=mt[Ht])!="function"?(Y=q[0],it=q[1],Y!=Y?yt[it]=S:typeof Y=="string"?~(V=Y==="@"?S.lastIndexOf(Y):S.indexOf(Y))&&(typeof q[2]=="number"?(yt[it]=S.slice(0,V),S=S.slice(V+q[2])):(yt[it]=S.slice(V),S=S.slice(0,V))):(V=Y.exec(S))&&(yt[it]=V[1],S=S.slice(0,V.index)),yt[it]=yt[it]||Z&&q[3]&&F[it]||"",q[4]&&(yt[it]=yt[it].toLowerCase())):S=q(S,yt);M&&(yt.query=M(yt.query)),Z&&F.slashes&&yt.pathname.charAt(0)!=="/"&&(yt.pathname!==""||F.pathname!=="")&&(yt.pathname=function(Yt,At){if(Yt==="")return At;for(var Lt=(At||"/").split("/").slice(0,-1).concat(Yt.split("/")),zt=Lt.length,re=Lt[zt-1],de=!1,ft=0;zt--;)Lt[zt]==="."?Lt.splice(zt,1):Lt[zt]===".."?(Lt.splice(zt,1),ft++):ft&&(zt===0&&(de=!0),Lt.splice(zt,1),ft--);return de&&Lt.unshift(""),re!=="."&&re!==".."||Lt.push(""),Lt.join("/")}(yt.pathname,F.pathname)),yt.pathname.charAt(0)!=="/"&&b(yt.protocol)&&(yt.pathname="/"+yt.pathname),f(yt.port,yt.protocol)||(yt.host=yt.hostname,yt.port=""),yt.username=yt.password="",yt.auth&&(~(V=yt.auth.indexOf(":"))?(yt.username=yt.auth.slice(0,V),yt.username=encodeURIComponent(decodeURIComponent(yt.username)),yt.password=yt.auth.slice(V+1),yt.password=encodeURIComponent(decodeURIComponent(yt.password))):yt.username=encodeURIComponent(decodeURIComponent(yt.auth)),yt.auth=yt.password?yt.username+":"+yt.password:yt.username),yt.origin=yt.protocol!=="file:"&&b(yt.protocol)&&yt.host?yt.protocol+"//"+yt.host:"null",yt.href=yt.toString()}z.prototype={set:function(S,F,M){var Z=this;switch(S){case"query":typeof F=="string"&&F.length&&(F=(M||h.parse)(F)),Z[S]=F;break;case"port":Z[S]=F,f(F,Z.protocol)?F&&(Z.host=Z.hostname+":"+F):(Z.host=Z.hostname,Z[S]="");break;case"hostname":Z[S]=F,Z.port&&(F+=":"+Z.port),Z.host=F;break;case"host":Z[S]=F,m.test(F)?(F=F.split(":"),Z.port=F.pop(),Z.hostname=F.join(":")):(Z.hostname=F,Z.port="");break;case"protocol":Z.protocol=F.toLowerCase(),Z.slashes=!M;break;case"pathname":case"hash":if(F){var U=S==="pathname"?"/":"#";Z[S]=F.charAt(0)!==U?U+F:F}else Z[S]=F;break;case"username":case"password":Z[S]=encodeURIComponent(F);break;case"auth":var Y=F.indexOf(":");~Y?(Z.username=F.slice(0,Y),Z.username=encodeURIComponent(decodeURIComponent(Z.username)),Z.password=F.slice(Y+1),Z.password=encodeURIComponent(decodeURIComponent(Z.password))):Z.username=encodeURIComponent(decodeURIComponent(F))}for(var q=0;q<D.length;q++){var V=D[q];V[4]&&(Z[V[1]]=Z[V[1]].toLowerCase())}return Z.auth=Z.password?Z.username+":"+Z.password:Z.username,Z.origin=Z.protocol!=="file:"&&b(Z.protocol)&&Z.host?Z.protocol+"//"+Z.host:"null",Z.href=Z.toString(),Z},toString:function(S){S&&typeof S=="function"||(S=h.stringify);var F,M=this,Z=M.host,U=M.protocol;U&&U.charAt(U.length-1)!==":"&&(U+=":");var Y=U+(M.protocol&&M.slashes||b(M.protocol)?"//":"");return M.username?(Y+=M.username,M.password&&(Y+=":"+M.password),Y+="@"):M.password?(Y+=":"+M.password,Y+="@"):M.protocol!=="file:"&&b(M.protocol)&&!Z&&M.pathname!=="/"&&(Y+="@"),(Z[Z.length-1]===":"||m.test(M.hostname)&&!M.port)&&(Z+=":"),Y+=Z+M.pathname,(F=typeof M.query=="object"?S(M.query):M.query)&&(Y+=F.charAt(0)!=="?"?"?"+F:F),M.hash&&(Y+=M.hash),Y}},z.extractProtocol=j,z.location=k,z.trimLeft=R,z.qs=h,O.exports=z},8188:function(O,H){var a=Object.prototype.hasOwnProperty;function f(g){try{return decodeURIComponent(g.replace(/\+/g," "))}catch{return null}}function h(g){try{return encodeURIComponent(g)}catch{return null}}H.stringify=function(g,_){_=_||"";var E,m,p=[];for(m in typeof _!="string"&&(_="?"),g)if(a.call(g,m)){if((E=g[m])||E!=null&&!isNaN(E)||(E=""),m=h(m),E=h(E),m===null||E===null)continue;p.push(m+"="+E)}return p.length?_+p.join("&"):""},H.parse=function(g){for(var _,E=/([^=?#&]+)=?([^&]*)/g,m={};_=E.exec(g);){var p=f(_[1]),A=f(_[2]);p===null||A===null||p in m||(m[p]=A)}return m}},4058:function(O){O.exports=function(H,a){if(a=a.split(":")[0],!(H=+H))return!1;switch(a){case"http":case"ws":return H!==80;case"https":case"wss":return H!==443;case"ftp":return H!==21;case"gopher":return H!==70;case"file":return!1}return H!==0}}},xn={};function ke(O){var H=xn[O];if(H!==void 0)return H.exports;var a=xn[O]={exports:{}};return Yi[O].call(a.exports,a,a.exports,ke),a.exports}ke.amdO={},ke.n=function(O){var H=O&&O.__esModule?function(){return O.default}:function(){return O};return ke.d(H,{a:H}),H},ke.d=function(O,H){for(var a in H)ke.o(H,a)&&!ke.o(O,a)&&Object.defineProperty(O,a,{enumerable:!0,get:H[a]})},ke.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),ke.o=function(O,H){return Object.prototype.hasOwnProperty.call(O,H)},ke.r=function(O){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(O,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(O,"__esModule",{value:!0})};var on={};return function(){ke.r(on),ke.d(on,{default:function(){return ze}});var O=ke(8e3),H=ke.n(O),a=ke(3281),f=ke.n(a),h=ke(3720),g=ke.n(h),_=(ke(9601),ke(1539),ke(8674),ke(2526),ke(1817),ke(2165),ke(6992),ke(8783),ke(3948),ke(8309),ke(3843),ke(3710),ke(1532),ke(4812),ke(9070),ke(7941),ke(2222),ke(9653),ke(9575),ke(2472),ke(2990),ke(8927),ke(3105),ke(5035),ke(4345),ke(7174),ke(2846),ke(4731),ke(7209),ke(6319),ke(8867),ke(7789),ke(3739),ke(9368),ke(4483),ke(2056),ke(3462),ke(678),ke(7462),ke(3824),ke(5021),ke(2974),ke(5016),ke(5827),ke(2564),ke(9554),ke(4747),ke(7327),ke(561),ke(7252)),E=ke(4024),m=ke(4998),p=ke(5531),A=ke(6424),R=(ke(6699),ke(7360)),D=["onTextMessage","onFileMessage","onAudioMessage","onVideoMessage","onImageMessage","onLocationMessage","onCustomMessage","onCMDMessage"],P=function(){function ot(Et,nt,Dt){this.handlerData={},this.handlerData={},Et.addEventHandler=this.addEventHandler.bind(this),Et.removeEventHandler=this.removeEventHandler.bind(this)}return ot.prototype.addEventHandler=function(Et,nt){this.handlerData[Et]=nt},ot.prototype.removeEventHandler=function(Et){delete this.handlerData[Et]},ot.prototype.dispatch=function(Et,nt){for(var Dt in D.includes(Et)&&nt?R.kg.debug("dispatch event: "+Et,{id:nt.id,type:nt.type,time:nt.time,from:nt.from,to:nt.to,chatType:nt.chatType}):Et==="onMessage"?R.kg.debug("dispatch event: "+Et,nt?.length):R.kg.debug("dispatch event: "+Et,nt||""),this.handlerData){var B=this.handlerData[Dt][Et];B&&B(nt)}},ot}(),k=function(){};function b(ot){this.onOpened=ot.onOpened||k,this.onPresence=ot.onPresence||k,this.onTextMessage=ot.onTextMessage||k,this.onPictureMessage=ot.onPictureMessage||k,this.onAudioMessage=ot.onAudioMessage||k,this.onVideoMessage=ot.onVideoMessage||k,this.onFileMessage=ot.onFileMessage||k,this.onLocationMessage=ot.onLocationMessage||k,this.onCmdMessage=ot.onCmdMessage||k,this.onCustomMessage=ot.onCustomMessage||k,this.onReceivedMessage=ot.onReceivedMessage||k,this.onDeliveredMessage=ot.onDeliveredMessage||k,this.onReadMessage=ot.onReadMessage||k,this.onRecallMessage=ot.onRecallMessage||k,this.onChannelMessage=ot.onChannelMessage||k,this.onError=ot.onError||k,this.onOffline=ot.onOffline||k,this.onOnline=ot.onOnline||k,this.onStatisticMessage=ot.onStatisticMessage||k,this.onContactInvited=ot.onContactInvited||k,this.onContactAgreed=ot.onContactAgreed||k,this.onContactRefuse=ot.onContactRefuse||k,this.onContactDeleted=ot.onContactDeleted||k,this.onContactAdded=ot.onContactAdded||k,this.onTokenWillExpire=ot.onTokenWillExpire||k,this.onTokenExpired=ot.onTokenExpired||k,this.onClosed=ot.onClosed||k,this.onPresenceStatusChange=ot.onPresenceStatusChange||k}ke(2772);var j={biz:"",debug:!1,token:""},z="https://data-reporting.agora.io/report",S="https://data-reporting.sh.agoralab.co/report",F=(ke(2023),ke(2071)),M=ke(1595),Z=function(ot){var Et=Number(M.C8[ot]);return Et===M.C8.USER_LOGIN?"MANUALLOGIN":Et===M.C8.MSYNC_SENDMESSAGE?"SENDMESSAGE":Et>M.C8.UNKNOWOPERATION&&Et<M.C8.REST_OPERATE?"REST":Et>M.C8.REST_OPERATE&&Et<M.C8.MSYNC_OPERATE?"MESSAGE":Et>M.C8.MSYNC_OPERATE&&Et<M.C8.ROSTER_OPERATE?"ROSTER":Et>M.C8.ROSTER_OPERATE&&Et<M.C8.USER_OPERATE?"USER":Et>M.C8.USER_OPERATE&&Et<M.C8.GROUP_OPERATE?"GROUP":Et>M.C8.GROUP_OPERATE&&Et<M.C8.CHATROOM_OPERATE?"CHATROOM":"OPERATION"},U=function(){return new Date().getTime()},Y=function(ot){return[E.iw.BAIDU,E.iw.WX,E.iw.DD,E.iw.ZFB,E.iw.TT,E.iw.QUICK_APP,E.iw.UNI].includes(ot.platform)},q=function(){return ot=1,Et=99999,ot=Math.ceil(ot),Et=Math.floor(Et),Math.floor(Math.random()*(Et-ot))+ot;var ot,Et},V={},it=(ke(1249),function(ot,Et){var nt={};for(var Dt in ot)Object.prototype.hasOwnProperty.call(ot,Dt)&&Et.indexOf(Dt)<0&&(nt[Dt]=ot[Dt]);if(ot!=null&&typeof Object.getOwnPropertySymbols=="function"){var B=0;for(Dt=Object.getOwnPropertySymbols(ot);B<Dt.length;B++)Et.indexOf(Dt[B])<0&&Object.prototype.propertyIsEnumerable.call(ot,Dt[B])&&(nt[Dt[B]]=ot[Dt[B]])}return nt}),mt=1e3,wt=function(){function ot(Et){this.eventQueue=[],this.stock=mt,this.config=Et,this.governor()}return ot.prototype.add=function(Et){this.stock<=0?console.warn("Event Report limit ".concat(mt," per minute")):(this.eventQueue.push(Et),this.consume(),this.stock-=1)},ot.prototype.consume=function(){var Et=this;this.eventQueue.length!==0&&(this.timer&&this.eventQueue.length<=10&&clearTimeout(this.timer),this.timer=setTimeout(function(){var nt,Dt=Et.eventQueue.splice(0,10),B=Dt.filter(function(St){return St.appId===Dt[0].appId}),Ft=Dt.filter(function(St){return St.appId!==Dt[0].appId});(nt=Et.eventQueue).unshift.apply(nt,Ft),Et.batchSend(B)},1e3))},ot.prototype.governor=function(){var Et=this,nt=setInterval(function(){Et.stock=mt},6e4);typeof addEventListener<"u"&&addEventListener("beforeunload",function(){clearInterval(nt)})},ot.prototype.batchSend=function(Et){var nt,Dt;if(Et===void 0&&(Et=[]),Et.length!==0)try{var B=Et.map(function(Ft){Ft.biz,Ft.appId;var St=Ft.eventId,Nt=it(Ft,["biz","appId","eventId"]);return{eventId:Number(St),body:Nt}});(function(Ft,St){try{var Nt=St.biz,Ut=St.appId,Xt=St.data,Gt=St.debug,ne=St.onSuccess;if(!Nt)throw new Error("biz is not defined");V.global||(V=E.P6.getEnvInfo());var Re=V;if(Y(Re)){var pe={url:Gt?S:z,data:Xt,method:"POST",success:function(){ne?.()},fail:function(){},complete:function(){}},Je={token:Ft,appid:Ut??"",sendts:"".concat(Math.floor(new Date().getTime()/1e3)),biz:Nt,debug:"".concat(Gt)};if(Re.platform==="zfb"||Re.platform==="dd"?pe.headers=Je:pe.header=Je,Re.platform==="dd")return Re.global.httpRequest(pe);Re.global.request(pe)}else{var I=new XMLHttpRequest;I.onreadystatechange=function(){I.readyState===2&&ne?.()},I.open("POST",Gt?S:z),I.setRequestHeader("Content-Type","application/json"),I.setRequestHeader("token",Ft),I.setRequestHeader("appid",Ut??""),I.setRequestHeader("sendts","".concat(Math.floor(new Date().getTime()/1e3))),I.setRequestHeader("biz",Nt),I.setRequestHeader("debug","".concat(Gt)),I.send(JSON.stringify(Xt))}}catch(X){console.error(X)}})(this.config.token,{biz:(nt=Et[0])===null||nt===void 0?void 0:nt.biz,appId:(Dt=Et[0])===null||Dt===void 0?void 0:Dt.appId,data:B,debug:this.config.debug,onSuccess:this.consume.bind(this)})}catch(Ft){console.error(Ft)}},ot}(),yt=function(){return yt=Object.assign||function(ot){for(var Et,nt=1,Dt=arguments.length;nt<Dt;nt++)for(var B in Et=arguments[nt])Object.prototype.hasOwnProperty.call(Et,B)&&(ot[B]=Et[B]);return ot},yt.apply(this,arguments)},Ht=new(function(){function ot(Et){this.inited=!1,this.appId="",this.biz="",this.eventQueue={},this.config=j,Et&&this.init(Et)}return ot.prototype.init=function(Et){var nt;if(Et===void 0&&(Et={}),!Et.biz||!Et.token)throw new Error("Event Report: biz or token is not defined");try{this.appId=(nt=Et.appId)!==null&&nt!==void 0?nt:"",this.biz=Et.biz,this.config=yt(yt({},j),Et),this.eventQueue=new wt(this.config),this.log(Et),this.inited=!0}catch(Dt){console.error(Dt)}},ot.prototype.send=function(Et,nt,Dt){var B;if(nt===void 0&&(nt={}),this.inited){var Ft=yt(yt({},nt),{eventId:Number(Et),biz:this.biz,appId:(B=Dt?.appId)!==null&&B!==void 0?B:this.appId});this.eventQueue.add(Ft),this.log(Ft)}else console.error("Event Report: init is not called")},ot.prototype.log=function(Et){try{if(this.config.debug){var nt=Et.payload,Dt=function(B,Ft){var St={};for(var Nt in B)Object.prototype.hasOwnProperty.call(B,Nt)&&Ft.indexOf(Nt)<0&&(St[Nt]=B[Nt]);if(B!=null&&typeof Object.getOwnPropertySymbols=="function"){var Ut=0;for(Nt=Object.getOwnPropertySymbols(B);Ut<Nt.length;Ut++)Ft.indexOf(Nt[Ut])<0&&Object.prototype.propertyIsEnumerable.call(B,Nt[Ut])&&(St[Nt[Ut]]=B[Nt[Ut]])}return St}(Et,["payload"]);console.log("%c Event Report: ".concat(this.config.biz," "),"background: #8A97FC; color: #fff"),console.table(Dt),nt&&(console.info("payload:"),console.table(nt))}}catch(B){console.error(B)}},ot}()),Yt=function(){return Yt=Object.assign||function(ot){for(var Et,nt=1,Dt=arguments.length;nt<Dt;nt++)for(var B in Et=arguments[nt])Object.prototype.hasOwnProperty.call(Et,B)&&(ot[B]=Et[B]);return ot},Yt.apply(this,arguments)},At={requestName:"",subrequestid:"1",requestMethod:"GET",requestUrl:"",requestElapse:0,code:0,codeDesc:"",isLastApi:0,isSuccess:1},Lt=function(){function ot(Et){this.platform=E.P6.getEnvInfo(),this.isReportDt=Et.isReport||!1,this.isCollectDt=!0,Y(this.platform)&&!this.isReportDt&&(this.isCollectDt=!1),this.eventQueue=[],this.accessChannel=F.yK,this.options=function(nt,Dt){Dt.platform||(Dt=E.P6.getEnvInfo());var B=nt.org,Ft=nt.appkey,St=nt.deviceId,Nt=nt.sdkVersion,Ut=navigator?.userAgent||"".concat(Dt.platform,"_mini_program");return{org:B,appkey:Ft,deviceId:St,sdkServiceId:"sid_".concat(E.P6.getUniqueId(),"_").concat(q()),did:Ut,sdkVersion:Nt,os:F.Wc,sdkProduct:M.aC.web}}(Et,this.platform),this.sid=this.options.sdkServiceId,this.init(Et)}return ot.getInstance=function(){return ot.instance},ot.prototype.getServiceId=function(){return this.sid||"sid_0"},ot.prototype.setIsReportDt=function(Et){this.isReportDt=Et,Et&&this.rptEventQueue()},ot.prototype.setIsCollectDt=function(Et){this.isCollectDt=Et,Et||(this.eventQueue=[])},ot.prototype.rptEventQueue=function(){var Et=this;this.eventQueue.length&&this.eventQueue.forEach(function(nt,Dt){Ht.send(nt.eventId,nt.dt),Dt>=Et.eventQueue.length-1&&(Et.eventQueue=[])})},ot.prototype.init=function(Et){ot.instance||(ot.instance=this,Ht.init({biz:F.el,token:F.$x,appId:Et.appkey,debug:!1}),this.reportInit())},ot.prototype.reportInit=function(){if(this.isCollectDt){var Et=this.options,nt=Et.did,Dt=Et.os,B=Et.sdkVersion,Ft=Et.deviceId;this.reportData(F.iB.INIT,{did:nt,os:Dt,sdkVersion:B,deviceId:Ft})}},ot.prototype.geOperateFun=function(Et){var nt=this;if(!this.isCollectDt)return function(){};var Dt=1,B=0,Ft="",St=U(),Nt=Et.uid,Ut=Et.operationName;Nt&&(this.uid=Nt);var Xt={uid:this.uid,operationId:"opr_".concat(E.P6.getUniqueId(),"_").concat(q()),requestid:"req_".concat(E.P6.getUniqueId(),"_").concat(q()),operationName:Ut};return function(Gt){var ne,Re,pe,Je;if(Gt.data.isSuccess?(B=0,Ft=""):(Gt.data.code===0&&(Gt.data.code=F.Tp),B=(ne=Gt.data.code)!==null&&ne!==void 0?ne:B,Ft=(Re=Gt.data.codeDesc)!==null&&Re!==void 0?Re:Ft),!((pe=Gt.data)===null||pe===void 0)&&pe.accessChannel&&(nt.accessChannel=(Je=Gt.data)===null||Je===void 0?void 0:Je.accessChannel),Gt.isRetry?(Dt++,Gt.data.subrequestid="".concat(Dt)):(Xt.requestid="req_".concat(E.P6.getUniqueId(),"_").concat(q()),Dt=1),Gt.data.isLastApi){var I=U();Gt.data.requestElapse=I-St,Gt.data.requestMethod="",Gt.data.subrequestid="0",Gt.data.code=B===200?0:B,Gt.data.codeDesc=Ft}else Gt.data.requestName||(Gt.data.requestName=Ut);Gt.data.requestElapse||(Gt.data.requestElapse=U()-St),nt.reportData.call(nt,F.iB.API,Yt(Yt(Yt(Yt({},At),Xt),Gt.data),{accessChannel:nt.accessChannel,operationType:Z(Ut)})),Gt.isEndApi&&nt.reportData.call(nt,F.iB.API,Yt(Yt(Yt({},Xt),At),{isSuccess:Gt.data.isSuccess,isLastApi:1,subrequestid:"0",requestMethod:"",code:B===200?0:B,codeDesc:Ft,requestElapse:Gt.data.requestElapse,accessChannel:nt.accessChannel,operationType:Z(Ut)}))}},ot.prototype.reportData=function(Et,nt){return Dt=this,B=void 0,St=function(){var Nt,Ut,Xt,Gt,ne,Re,pe,Je;return function(I,X){var _t,K,dt,bt,rt={label:0,sent:function(){if(1&dt[0])throw dt[1];return dt[1]},trys:[],ops:[]};return bt={next:Vt(0),throw:Vt(1),return:Vt(2)},typeof Symbol=="function"&&(bt[Symbol.iterator]=function(){return this}),bt;function Vt(ut){return function(Kt){return function(jt){if(_t)throw new TypeError("Generator is already executing.");for(;rt;)try{if(_t=1,K&&(dt=2&jt[0]?K.return:jt[0]?K.throw||((dt=K.return)&&dt.call(K),0):K.next)&&!(dt=dt.call(K,jt[1])).done)return dt;switch(K=0,dt&&(jt=[2&jt[0],dt.value]),jt[0]){case 0:case 1:dt=jt;break;case 4:return rt.label++,{value:jt[1],done:!1};case 5:rt.label++,K=jt[1],jt=[0];continue;case 7:jt=rt.ops.pop(),rt.trys.pop();continue;default:if(!((dt=(dt=rt.trys).length>0&&dt[dt.length-1])||jt[0]!==6&&jt[0]!==2)){rt=0;continue}if(jt[0]===3&&(!dt||jt[1]>dt[0]&&jt[1]<dt[3])){rt.label=jt[1];break}if(jt[0]===6&&rt.label<dt[1]){rt.label=dt[1],dt=jt;break}if(dt&&rt.label<dt[2]){rt.label=dt[2],rt.ops.push(jt);break}dt[2]&&rt.ops.pop(),rt.trys.pop();continue}jt=X.call(I,rt)}catch(ge){jt=[6,ge],K=0}finally{_t=dt=0}if(5&jt[0])throw jt[1];return{value:jt[0]?jt[1]:void 0,done:!0}}([ut,Kt])}}}(this,function(I){switch(I.label){case 0:return I.trys.push([0,3,,4]),Nt=U(),Ut=0,Et!==F.iB.API?[3,2]:[4,(X=this.platform,new Promise(function(_t){var K;X.platform||(X=E.P6.getEnvInfo());var dt="";if(X.platform===E.iw.WEB){var bt=navigator.connection;bt?.type?(bt?.type,dt=M.td.WIFI):bt?.effectiveType&&(dt=M.td[bt.effectiveType.toLocaleUpperCase()]),_t(dt)}else X.platform===E.iw.NODE?(dt=M.td.UNKNOWN,_t(dt)):(K=X.global)===null||K===void 0||K.getNetworkType({success:function(rt){dt=M.td[rt.networkType.toLocaleUpperCase()],_t(dt)}})}))];case 1:Ut=I.sent(),I.label=2;case 2:return Xt=this.options,Gt=Xt.appkey,ne=Xt.sdkServiceId,Re=Xt.sdkProduct,pe=Yt({lts:Nt,net:Ut,appkey:Gt,sdkServiceId:ne,sdkProduct:Re},nt),this.isReportDt?Ht.send(Et,pe):this.isCollectDt&&this.eventQueue.push({eventId:Et,dt:pe}),[3,4];case 3:return Je=I.sent(),console.warn(Je),[3,4];case 4:return[2]}var X})},new((Ft=void 0)||(Ft=Promise))(function(Nt,Ut){function Xt(Re){try{ne(St.next(Re))}catch(pe){Ut(pe)}}function Gt(Re){try{ne(St.throw(Re))}catch(pe){Ut(pe)}}function ne(Re){var pe;Re.done?Nt(Re.value):(pe=Re.value,pe instanceof Ft?pe:new Ft(function(Je){Je(pe)})).then(Xt,Gt)}ne((St=St.apply(Dt,B||[])).next())});var Dt,B,Ft,St},ot}(),zt=ke(7288),re=ke(7479),de=ke(2856),ft=ke(9667),gt=ke(3770),Zt=ke(1735),Pt=ke(7384),Wt=ke(70),oe=ke(8161);function fe(ot){return fe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Et){return typeof Et}:function(Et){return Et&&typeof Symbol=="function"&&Et.constructor===Symbol&&Et!==Symbol.prototype?"symbol":typeof Et},fe(ot)}var le=function(){return le=Object.assign||function(ot){for(var Et,nt=1,Dt=arguments.length;nt<Dt;nt++)for(var B in Et=arguments[nt])Object.prototype.hasOwnProperty.call(Et,B)&&(ot[B]=Et[B]);return ot},le.apply(this,arguments)},Ie=function(ot,Et){var nt,Dt,B,Ft,St={label:0,sent:function(){if(1&B[0])throw B[1];return B[1]},trys:[],ops:[]};return Ft={next:Nt(0),throw:Nt(1),return:Nt(2)},typeof Symbol=="function"&&(Ft[Symbol.iterator]=function(){return this}),Ft;function Nt(Ut){return function(Xt){return function(Gt){if(nt)throw new TypeError("Generator is already executing.");for(;St;)try{if(nt=1,Dt&&(B=2&Gt[0]?Dt.return:Gt[0]?Dt.throw||((B=Dt.return)&&B.call(Dt),0):Dt.next)&&!(B=B.call(Dt,Gt[1])).done)return B;switch(Dt=0,B&&(Gt=[2&Gt[0],B.value]),Gt[0]){case 0:case 1:B=Gt;break;case 4:return St.label++,{value:Gt[1],done:!1};case 5:St.label++,Dt=Gt[1],Gt=[0];continue;case 7:Gt=St.ops.pop(),St.trys.pop();continue;default:if(!((B=(B=St.trys).length>0&&B[B.length-1])||Gt[0]!==6&&Gt[0]!==2)){St=0;continue}if(Gt[0]===3&&(!B||Gt[1]>B[0]&&Gt[1]<B[3])){St.label=Gt[1];break}if(Gt[0]===6&&St.label<B[1]){St.label=B[1],B=Gt;break}if(B&&St.label<B[2]){St.label=B[2],St.ops.push(Gt);break}B[2]&&St.ops.pop(),St.trys.pop();continue}Gt=Et.call(ot,St)}catch(ne){Gt=[6,ne],Dt=0}finally{nt=B=0}if(5&Gt[0])throw Gt[1];return{value:Gt[0]?Gt[1]:void 0,done:!0}}([Ut,Xt])}}},me=E.P6.getEnvInfo(),Oe=me.platform==="web",je=function(){},xe={CLOSED:3,CONNECTING:0,OPEN:1},ir=function(){function ot(Et){var nt,Dt;if(this.name="connection",this.max_cache_length=100,this.enableReportLogs=!1,this._reportLogs=!1,this._reportInterval=3e5,this.unSyncQueue=[],this.lastHeartbeat=Date.now(),this.isDebug=Et.isDebug||!1,this.isReport=!1,this.enableReportLogs=Et.enableReportLogs||!1,this.uploadPartEnable=!0,this.isHttpDNS=Et.isHttpDNS===void 0?Oe:Et.isHttpDNS,this.heartBeatWait=Et.heartBeatWait||3e4,this.autoReconnectNumMax=Et.autoReconnectNumMax||5,this.refreshDNSIntervals=this.autoReconnectNumMax<5?this.autoReconnectNumMax:5,this.delivery=Et.delivery||!1,this.disconnectedReason=void 0,this.loginInfoCustomExt=void 0,this.dnsArr=["https://rs.easemob.com","https://rs.chat.agora.io","http://59.110.89.59","http://39.97.193.190","http://39.97.193.187"],this.dnsIndex=0,this.dnsTotal=this.dnsArr.length,this.restHosts=[],this.restTotal=0,this.restIndex=0,this.hostIndex=0,this.socketHost=[],this.hostTotal=0,this.times=1,this.autoReconnectNumTotal=0,this.domain="easemob.com",this.appKey=Et.appKey,this.appName="",this.orgName="",this.token="",this.grantType="",this.apiUrl=Et.apiUrl||"",this.url=Et.url||"",this.https=Et.https||typeof window<"u"&&((nt=window.location)===null||nt===void 0?void 0:nt.protocol)==="https:",this.version="1.3.1",this.deviceId=Et.deviceId||"webim",this.isFixedDeviceId=(Dt=Et.isFixedDeviceId)===null||Dt===void 0||Dt,this.osType=16,this.useOwnUploadFun=Et.useOwnUploadFun||!1,this.compressType=[0],this.encryptType=[0],this.clientResource="",this.expiresIn=0,this.expirationTime=0,this.useReplacedMessageContents=Et.useReplacedMessageContents||!1,this.logOut=!0,this.context={jid:{appKey:"",clientResource:"",domain:"easemob.com",name:""},userId:"",appKey:"",status:0,restTokenData:"",appName:"",orgName:"",root:{},accessToken:""},this._msgHash={},this._msgPromiseHash={},this._queues=[],this._load_msg_cache=[],this.unMSyncSendMsgMap=new Map,this.mr_cache={},this.reconnecting=!1,this._offlineMessagePullState=m.a.SYNC_INIT,this._offlineMessagePullQueue=[],this.uniPushConfig={},this.uniPush=null,this.isRegisterPush=!1,this.pushCertificateName="",typeof this.appKey!="string"||this.appKey.split("#").length!==2)throw Error("Illegal appKey: ".concat(this.appKey));this.devInfos=this.appKey.split("#"),this.orgName=this.devInfos[0],this.appName=this.devInfos[1],this.listen=b.bind(this),this.mSync=this.usePlugin(A.ZP),this.eventHandler=this.usePlugin(P),Object.assign(ot.prototype,re),Object.assign(ot.prototype,de),Object.assign(ot.prototype,ft),Object.assign(ot.prototype,gt),Object.assign(ot.prototype,Zt),Object.assign(ot.prototype,Pt),Object.assign(ot.prototype,Wt),this.dataReport=new Lt({appkey:this.appKey,org:this.orgName,sdkVersion:this.version,deviceId:this.deviceId,isReport:this.isReport});var B=0,Ft=this;if(Object.defineProperty(E.P6,"ajaxUnconventionalErrorTimes",{set:function(Nt){Nt!==0&&(R.kg.debug("rest api request fail times: ".concat(Nt)),(B=Nt)%5==0&&Ft.isHttpDNS&&(R.kg.debug("refresh dns config when rest request fail."),Pe.call(Ft,"refresh",{},{})))},get:function(){return B}}),this.isFixedDeviceId){var St=E.P6.getLocalDeviceInfo();St&&(this.clientResource=JSON.parse(St).deviceId)}R.kg.debug("init SDK: Conn ".concat(this.version," ").concat(me.platform))}return ot.prototype.usePlugin=function(Et,nt){if(nt!=="push")return nt?void(this[nt]=new Et(this)):new Et(this);Et.config&&Et.emPush?(this.uniPushConfig=Et.config,this.uniPush=Et.emPush):R.kg.error("use push plugin failed","emPush",this.uniPush,"config",this.uniPushConfig)},ot.prototype.listen=function(Et){},ot.prototype.addEventHandler=function(Et,nt){},ot.prototype.removeEventHandler=function(Et){},ot.prototype.registerUser=function(Et){var nt=this;return new Promise(function(Dt,B){var Ft=nt.dataReport.geOperateFun({uid:Et.username,operationName:M.fI.REGISTER});if(nt.isHttpDNS){nt.dnsIndex=0;var St=le(le({},Et),{user:Et.username,pwd:Et.password,promise:{resolve:Dt,reject:B}});Pe.call(nt,"signup",St,{rpt:Ft})}else St=le(le({},Et),{promise:{resolve:Dt,reject:B}}),He.call(nt,St,{rpt:Ft})})},ot.prototype.open=function(Et){var nt=this;if(R.kg.debug("open",Et.user),R.kg.debug("isLogout",this.logOut),me.platform==="web"){var Dt=E.P6.detectBrowser();R.kg.debug("browser",Dt)}return new Promise(function(B,Ft){var St,Nt=be.call(nt,Et);if(Nt)return(St=nt.onError)===null||St===void 0||St.call(nt,Nt),Ft(Nt);Et.accessToken&&(nt.token=Et.accessToken);var Ut=le(le({},Et),{promise:{resolve:B,reject:Ft}}),Xt=nt.dataReport.geOperateFun({uid:Et.user,operationName:M.fI.LOGIN});if(nt.isHttpDNS)nt.dnsIndex=0,Pe.call(nt,"login",Ut,{rpt:Xt});else{if(me.platform!=="web"&&nt.enableReportLogs)return nt.dnsIndex=0,void nt.getDNS().then(function(){ae.call(nt,Ut,{rpt:Xt})}).catch(function(Gt){var ne;Ut.promise.reject(Gt),(ne=Ut.error)===null||ne===void 0||ne.call(Ut,Gt)});ae.call(nt,Ut,{rpt:Xt})}})},ot.prototype.getDNS=function(){var Et=this,nt=this.dnsIndex<this.dnsTotal?this.dnsIndex:0,Dt=this.dnsArr[nt]+"/easemob/server.json";return new Promise(function(B,Ft){var St=Et;(function Nt(){var Ut={url:Dt,dataType:"json",type:"GET",data:{app_key:St.appKey},success:function(Xt){var Gt=Xt.enableReportLogs,ne=Xt.reportInterval;St._reportLogs=Gt==="true",St._reportInterval=Number(ne||3e5),B(Xt)},error:function(Xt){if(R.kg.debug("getHttpDNS fail: "+St.dnsIndex),St.dnsIndex++,St.dnsIndex<St.dnsTotal)Nt();else{var Gt=_.Z.create({type:p.E.SERVER_GET_DNSLIST_FAILED,message:"get DNS failed",data:Xt});Ft(Gt)}}};E.P6.ajax(Ut).catch(function(Xt){console.warn(Xt)})})()})},ot.prototype.isOpened=function(){return this.sock&&this.sock.readyState===xe.OPEN||!1},ot.prototype.close=function(){var Et,nt,Dt;R.kg.debug("call close"),R.kg._stopReportLogs(),this.logOut=!0,this.disconnectedReason=void 0,this.reconnecting=!1,this.context.status=p.E.STATUS_CLOSING,this.sock&&this.sock.close(),(Et=this.unMSyncSendMsgMap)===null||Et===void 0||Et.clear(),this.stopHeartBeat(),this.rejectMessage(),this.context.status=p.E.STATUS_CLOSED,this._load_msg_cache=[],this._queues=[],this.unSyncQueue=[],this._msgHash={},this.mr_cache={},this.token="",this.context.accessToken="",this.isRegisterPush=!1,this.clearTokenTimeout(),(Dt=(nt=this==null?void 0:this._localCache)===null||nt===void 0?void 0:nt.getInstance())===null||Dt===void 0||Dt.close()},ot.prototype.downloadAndParseCombineMessage=function(Et){var nt=this,Dt=Et.url,B=Et.secret;return new Promise(function(Ft,St){var Nt,Ut,Xt=E.P6.getEnvInfo(),Gt=Xt.platform!=="web"&&Xt.platform!=="node"&&Xt.platform!=="quick_app"&&((Ut=(Nt=Xt.global)===null||Nt===void 0?void 0:Nt.canIUse)===null||Ut===void 0?void 0:Ut.call(Nt,"getFileSystemManager")),ne=function(pe){var Je=function(dt){St({type:p.E.PARSE_FILE_ERROR,message:"Read file failed",data:dt})},I=function(dt){return bt=nt,rt=void 0,ut=function(){var Kt,jt,ge,W,lt,ct,It,Ct,Ot,Mt,qt,he,Jt;return Ie(this,function(Ve){switch(Ve.label){case 0:for(Kt=Gt?new Uint8Array(dt.data):new Uint8Array(dt.target.result),jt=0,ge=0,W=2,lt=Kt.subarray(jt,jt+W),ct=E.P6.Uint8ArrayToString(lt),R.kg.debug("file header:",ct),ge+=W,It=0,Ct=2;Ct<Kt.length-1;Ct++)Ct%2==1&&(It^=Kt[Ct]);if(Ot=Kt.subarray(Kt.length-1,Kt.length),R.kg.debug("checkResult:",It,Ot[0]===It),Ot[0]!==It)return[2,St({type:p.E.PARSE_FILE_ERROR,message:"File verification failed"})];if(ct!=="cm")return[3,7];Ve.label=1;case 1:Ve.trys.push([1,5,,6]),Mt=[],qt=function(){var Ye,or,ue,tr;return Ie(this,function(Pr){switch(Pr.label){case 0:return jt+=W,ge+=W=4,Ye=Kt.subarray(jt,jt+W),jt+=W,W=Ye.reduce(function(_r,en,tn){return _r+(en<<8*(Ye.length-tn-1))},0),ge+=W,or=Kt.subarray(jt,jt+W),ue=(ue=he.root.lookup("easemob.pb.Meta")).decode(or),[4,oe.Z.call(he,ue,0,!0,!0)];case 1:return tr=Pr.sent(),Mt.push(tr),[2]}})},he=this,Ve.label=2;case 2:return ge<Kt.length-1?[5,qt()]:[3,4];case 3:return Ve.sent(),[3,2];case 4:return[2,Ft(Mt)];case 5:return Jt=Ve.sent(),St({type:p.E.PARSE_FILE_ERROR,message:"Parse file failed",data:Jt}),[3,6];case 6:return[3,8];case 7:return[2,St({type:p.E.PARSE_FILE_ERROR,message:"File verification failed"})];case 8:return[2]}})},new((Vt=void 0)||(Vt=Promise))(function(Kt,jt){function ge(ct){try{lt(ut.next(ct))}catch(It){jt(It)}}function W(ct){try{lt(ut.throw(ct))}catch(It){jt(It)}}function lt(ct){var It;ct.done?Kt(ct.value):(It=ct.value,It instanceof Vt?It:new Vt(function(Ct){Ct(It)})).then(ge,W)}lt((ut=ut.apply(bt,rt||[])).next())});var bt,rt,Vt,ut};if(Gt){var X=Xt.global.getFileSystemManager(),_t=pe.tempFilePath;X.readFile({filePath:_t,success:I,fail:Je})}else if(pe instanceof Blob){var K=new FileReader;K.readAsArrayBuffer(pe),K.onerror=Je,K.onload=I}},Re=function(pe){St({type:p.E.WEBIM_DOWNLOADFILE_ERROR,message:"Download failed, please try again",data:pe})};Gt?Xt.global.downloadFile({url:Dt,success:ne,fail:Re}):E.P6.download.call(nt,{url:Dt,headers:{Accept:"application/json"},onFileDownloadComplete:ne,onFileDownloadError:Re,secret:B,accessToken:nt.context.accessToken})})},ot.prototype.stopHeartBeat=function(){clearInterval(this.heartBeatID)},ot.prototype.clear=function(){this.restTotal=0,this.restIndex=0,this.hostIndex=0,this.hostTotal=0},ot.prototype.heartBeat=function(){},ot.prototype.renewToken=function(Et){var nt=this;return this.isOpened()?this.getTokenExpireTimestamp(Et).then(function(Dt){var B=Dt.expire_timestamp,Ft=Date.now();return nt.expirationTime=B,nt.expiresIn=B-Ft,nt.token=Et,nt.context.accessToken=Et,nt.clearTokenTimeout(),nt.tokenExpireTimeCountDown(nt.expiresIn),{status:!0,token:Et,expire:B}}):Promise.reject({status:!1})},ot.prototype.clearTokenTimeout=function(){R.kg.info("clearTokenTimeout"),this.tokenWillExpireTimer&&clearTimeout(this.tokenWillExpireTimer),this.tokenExpiredTimer&&clearTimeout(this.tokenExpiredTimer),this.tokenWillExpireTimer=null,this.tokenExpiredTimer=null},ot.prototype.tokenExpireTimeCountDown=function(Et){var nt=this;R.kg.info("tokenExpireTimeCountDown",Et),Et>Math.pow(2,31)-1&&(Et=Math.pow(2,31)-1),this.tokenWillExpireTimer=setTimeout(function(){var Dt;nt.onTokenWillExpire&&nt.onTokenWillExpire(),(Dt=nt.eventHandler)===null||Dt===void 0||Dt.dispatch("onTokenWillExpire"),R.kg.info("onTokenWillExpire",Math.floor(Et/2))},Et/2),this.tokenExpiredTimer=setTimeout(function(){var Dt;R.kg.info("onTokenExpired",0),nt.onTokenExpired&&nt.onTokenExpired(),(Dt=nt.eventHandler)===null||Dt===void 0||Dt.dispatch("onTokenExpired"),nt.close()},Et)},ot.prototype.compareTokenExpireTime=function(Et,nt){var Dt,B=Number(nt)-Number(Et);R.kg.debug("compareTokenExpireTime",B),B<=this.expiresIn/2&&B>0?(this.onTokenWillExpire&&this.onTokenWillExpire(),(Dt=this.eventHandler)===null||Dt===void 0||Dt.dispatch("onTokenWillExpire"),R.kg.info("onTokenWillExpire",B)):B<=0&&(this.closeByTokenExpired(),R.kg.info("closeByTokenExpired",B))},ot.prototype.closeByTokenExpired=function(){var Et;R.kg.info("closed By TokenExpired"),this.onTokenExpired&&this.onTokenExpired(),(Et=this.eventHandler)===null||Et===void 0||Et.dispatch("onTokenExpired"),this.close()},ot.prototype.rejectMessage=function(){var Et=this,nt=Object.keys(this._msgHash);if(nt.length>0){var Dt=_.Z.create({type:p.E.MESSAGE_WEBSOCKET_DISCONNECTED,message:"websocket disconnected"});nt.forEach(function(B){var Ft,St,Nt;!((Ft=Et.unMSyncSendMsgMap)===null||Ft===void 0)&&Ft.has(B)||(Et._msgHash[B].reject instanceof Function&&Et._msgHash[B].reject(Dt),(Nt=(St=Et._localCache)===null||St===void 0?void 0:St.getInstance())===null||Nt===void 0||Nt.updateLocalMessage(B,{serverMsgId:B,status:zt.r.FAIL}),Et._msgHash[B].fail instanceof Function&&Et._msgHash[B].fail(Dt),delete Et._msgHash[B])})}},ot.prototype.resetConnState=function(){this.mSync.stopHeartBeat(),this.times=1,this.autoReconnectNumTotal=0,this.hostIndex=0},ot.prototype.reconnect=function(){var Et,nt=this;R.kg.debug("socket reconnect readyState",this.sock.readyState),this.sock.readyState!==xe.CONNECTING&&this.sock.readyState!==xe.OPEN&&(R.kg.info("reconnect: time",this.times),R.kg.info("reconnect sock.readyState: ",this.sock.readyState),this.reconnecting===!1&&(this.reconnecting=!0),(Et=this.eventHandler)===null||Et===void 0||Et.dispatch("onReconnecting"),this.rejectMessage(),this.isHttpDNS&&(this.hostIndex<this.socketHost.length-1?this.hostIndex++:this.hostIndex=this.socketHost.length-1),setTimeout(function(){nt.sock.readyState!==xe.OPEN&&(R.kg.info("login sock.readyState: ",nt.sock.readyState),nt.sock.close(),ee.call(nt,{access_token:nt.context.accessToken}),nt.times++)},500*this.times),this.autoReconnectNumTotal++)},ot.prototype.send=function(Et){return Promise.resolve(null)},ot.prototype.setLoginInfoCustomExt=function(Et){if(R.kg.debug("setLoginInfoCustomExt","params:",Et),Et){if(typeof Et!="string")throw new Error("ext must be a string");if(Et.length>1024)throw new Error("ext length must be less than 1024")}this.loginInfoCustomExt=Et},ot._getSock=function(){},ot}();function He(ot,Et){var nt=this,Dt=Et.rpt,B=Et.isRetry,Ft=ot.promise,St=this.apiUrl+"/"+this.orgName+"/"+this.appName+"/users",Nt={requestName:M.c.RESISTER,requestUrl:St},Ut=ot.error||je;if(!this.orgName&&!this.appName){var Xt=_.Z.create({type:p.E.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR,message:"signup error"});Ut(Xt)}var Gt={headers:{"Content-type":"application/json"},url:St,dataType:"json",data:JSON.stringify({username:ot.username,password:ot.password,nickname:ot.nickname||""}),success:function(ne){ot.success&&ot.success(ne);var Re=le(le({},ne),{type:p.E.REQUEST_SUCCESS});Ft.resolve&&Ft.resolve(Re);var pe=ne.extraInfo,Je=pe.httpCode,I=pe.elapse;Dt({isEndApi:!0,isRetry:B,data:le(le({},{requestElapse:I,isSuccess:1,code:Je}),Nt)})},error:function(ne){var Re=ne.extraInfo,pe=Re.elapse,Je=Re.httpCode,I=Re.errDesc;return Dt({isRetry:B,data:le(le({},{requestElapse:pe,isSuccess:0,code:Je,codeDesc:I}),Nt)}),nt.isHttpDNS&&nt.restIndex+1<nt.restTotal?(nt.restIndex++,Ee.call(nt),He.call(nt,ot,{rpt:Dt,isRetry:B}),Promise.reject(ne)):(Dt({data:{isLastApi:1,isSuccess:0}}),nt.clear(),Ft.reject&&Ft.reject(ne),Ut(ne))}};return E.P6.ajax(Gt).catch(function(ne){Ft.reject&&Ft.reject(ne)})}function ae(ot,Et){var nt,Dt=this;if(!be.call(this,ot))if(R.kg.debug("socket readyState",(nt=this.sock)===null||nt===void 0?void 0:nt.readyState),this.isOpened())R.kg.debug("socket is already opened");else{var B=Et.rpt,Ft=Et.isRetry;We.call(this,ot),this.user=ot.user;var St=ot.promise,Nt=this.context.appName,Ut=this.context.orgName,Xt=this.apiUrl+"/"+Ut+"/"+Nt+"/token";if(ot.accessToken)R.kg.debug("login with accessToken"),this.grantType="accessToken",this.token=ot.accessToken,this.context.accessToken=ot.accessToken,this.context.restTokenData=ot.accessToken,St.resolve({accessToken:ot.accessToken}),ee.call(this,ot,B),R.kg.initReport({report:this._reportLogs,reportInterval:this._reportInterval,connection:this});else if(ot.agoraToken)R.kg.debug("login with agoraToken"),this.grantType="agoraToken",this.token=ot.agoraToken,this.context.accessToken=ot.agoraToken,this.context.restTokenData=ot.agoraToken,St.resolve({accessToken:ot.agoraToken}),ee.call(this,ot,B),R.kg.initReport({report:this._reportLogs,reportInterval:this._reportInterval,connection:this});else{R.kg.debug("login with password"),this.grantType="password";var Gt={grant_type:"password",username:ot.user,password:ot.pwd,timestamp:+new Date},ne=JSON.stringify(Gt),Re={headers:{"Content-type":"application/json"},url:Xt,dataType:"json",data:ne,success:function(pe){R.kg.debug("get token success"),typeof ot.success=="function"&&ot.success(pe),Dt.token=pe.access_token,Dt.context.restTokenData=pe.access_token,Dt.context.accessToken=pe.access_token,Dt.expiresIn=pe.expires_in,St.resolve({accessToken:pe.access_token,duration:pe.expires_in});var Je=pe.extraInfo,I=Je.httpCode,X=Je.elapse,_t={requestName:M.c.LOGIN_BY_PWD,requestElapse:X,requestUrl:Xt,isSuccess:1,code:I};B({isRetry:Ft,data:_t}),ee.call(Dt,pe,B),R.kg.initReport({report:Dt._reportLogs,reportInterval:Dt._reportInterval,connection:Dt})},error:function(pe){var Je,I=pe.extraInfo,X=I.elapse,_t=I.httpCode,K=I.errDesc,dt={requestName:M.c.LOGIN_BY_PWD,requestElapse:X,requestUrl:Xt,isSuccess:0,code:_t,codeDesc:K};if(B({isRetry:Ft,data:dt}),Dt.isHttpDNS&&Dt.restIndex+1<Dt.restTotal)return Dt.restIndex++,Ee.call(Dt),void ae.call(Dt,ot,{rpt:B,isRetry:!0});B({data:{isLastApi:1,isSuccess:0}}),Dt.clear(),pe.error&&pe.error_description?(Je=_.Z.create({type:p.E.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,message:pe.error_description,data:pe}),Dt.onError&&Dt.onError(Je)):(Je=_.Z.create({type:p.E.WEBIM_CONNCTION_OPEN_ERROR,message:pe.error_description,data:pe}),Dt.onError&&Dt.onError(Je)),typeof ot.error=="function"&&ot.error(Je),St.reject(Je)},version:this.version};R.kg.debug("start get token"),E.P6.ajax(Re).catch(function(pe){console.warn(pe)})}R.kg.debug("grantType",this.grantType),E.P6.listenNetwork(Ne.bind(this),Ze.bind(this)),E.P6.listenBrowserVisibility(function(){R.kg.debug("visibility true")},function(){R.kg.debug("visibility false")})}}function Ne(){var ot;R.kg.debug("online"),this.onOnline&&this.onOnline(),(ot=this.eventHandler)===null||ot===void 0||ot.dispatch("onOnline"),this.sock&&this.sock.readyState!==1&&(R.kg.debug("sock.readyState:",this.sock.readyState),this.logOut||this.reconnecting||this.reconnect())}function Ze(){var ot,Et;R.kg.debug("offline"),(ot=this.sock)===null||ot===void 0||ot.close(),this.onOffline&&this.onOffline(),(Et=this.eventHandler)===null||Et===void 0||Et.dispatch("onOffline")}function ee(ot,Et){var nt=this,Dt=this._getSock();this.sock=Dt,R.kg.debug("start connect ws");var B=function(){var Nt;R.kg.debug("websocket onOpen"),Et&&Et({data:{isLastApi:1,isSuccess:1,accessChannel:(Nt=nt.socketHost[nt.hostIndex])===null||Nt===void 0?void 0:Nt.channel}});var Ut=E.P6.flow([nt.mSync.generateProvision,nt.mSync.base64transform])();try{Dt.send(Ut)}catch(Gt){var Xt=_.Z.create({type:p.E.SDK_RUNTIME_ERROR,message:"send message error",data:Gt});nt.onError&&nt.onError(Xt)}},Ft=function(Nt){setTimeout(function(){var Ut,Xt,Gt,ne,Re,pe,Je;if(R.kg.debug("websocket onClose",Nt),me.platform!=="zfb"&&me.platform!=="dd"||(nt.sock.readyState=xe.CLOSED),nt.logOut)nt.clear(),nt.resetConnState(),(Xt=(Ut=nt?._localCache)===null||Ut===void 0?void 0:Ut.getInstance())===null||Xt===void 0||Xt.close(),nt.onClosed&&nt.onClosed(),(Gt=nt.eventHandler)===null||Gt===void 0||Gt.dispatch("onDisconnected",nt.disconnectedReason);else if(nt.autoReconnectNumTotal<nt.autoReconnectNumMax){nt.reconnect();var I={type:p.E.WEBIM_CONNCTION_DISCONNECTED,message:"websocket has been disconnected"};nt.onError&&nt.onError(I),nt.autoReconnectNumTotal%nt.refreshDNSIntervals==0&&me.platform==="web"&&nt.isHttpDNS&&(R.kg.debug("refresh dns config when websocket close"),Pe.call(nt,"refresh",{},{}))}else(ne=nt.unMSyncSendMsgMap)===null||ne===void 0||ne.clear(),nt.rejectMessage(),I={type:p.E.WEBIM_CONNCTION_DISCONNECTED,message:"websocket has been disconnected"},nt.disconnectedReason=_.Z.create({type:p.E.WEBIM_CONNCTION_DISCONNECTED,message:"reconnection failed"}),nt.onError&&nt.onError(I),(pe=(Re=nt?._localCache)===null||Re===void 0?void 0:Re.getInstance())===null||pe===void 0||pe.close(),nt.onClosed&&nt.onClosed(),(Je=nt.eventHandler)===null||Je===void 0||Je.dispatch("onDisconnected",nt.disconnectedReason),nt.resetConnState(),nt.reconnecting=!1,R.kg.debug("reconnect fail")},0)},St=function(Nt){var Ut=nt.mSync,Xt=Ut.decodeMSync,Gt=Ut.distributeMSync;E.P6.flow([Xt,Gt])(Nt)};me.platform==="web"?(Dt.onopen=B,Dt.onclose=Ft,Dt.onmessage=St):(Dt.onOpen(B),Dt.onMessage(St),Dt.onClose(Ft),typeof window<"u"&&window.WebSocket||Dt.onError(function(Nt){var Ut,Xt,Gt,ne,Re;if(R.kg.debug("mini program sock on error",Nt),nt.sock.readyState!==xe.CLOSED&&(nt.sock=le(le({},nt.sock),{close:nt.sock.close,send:nt.sock.send,readyState:xe.CLOSED})),nt.onError&&nt.onError({type:p.E.WEBIM_CONNECTION_ERROR,message:"on socket error",data:Nt}),!nt.logOut)if(nt.autoReconnectNumTotal<nt.autoReconnectNumMax)R.kg.debug("sock.onError reconnect",nt.autoReconnectNumTotal,nt.autoReconnectNumMax),nt.reconnect(),nt.autoReconnectNumTotal%nt.refreshDNSIntervals==0&&me.platform==="web"&&nt.isHttpDNS&&(R.kg.debug("refresh dns config when websocket error"),Pe.call(nt,"refresh",{},{}));else{var pe={type:p.E.WEBIM_CONNCTION_DISCONNECTED,message:"websocket has been disconnected"};nt.disconnectedReason=_.Z.create({type:p.E.WEBIM_CONNCTION_DISCONNECTED,message:"reconnection failed"}),(Ut=nt.unMSyncSendMsgMap)===null||Ut===void 0||Ut.clear(),nt.rejectMessage(),nt.onError&&nt.onError(pe),(Gt=(Xt=nt?._localCache)===null||Xt===void 0?void 0:Xt.getInstance())===null||Gt===void 0||Gt.close(),nt.onClosed&&nt.onClosed(),(ne=nt.eventHandler)===null||ne===void 0||ne.dispatch("onDisconnected",nt.disconnectedReason),nt.resetConnState(),nt.reconnecting=!1,R.kg.debug("reconnect fail")}Et&&Et({data:{isLastApi:1,isSuccess:0,accessChannel:(Re=nt.socketHost[nt.hostIndex])===null||Re===void 0?void 0:Re.channel}})}))}function be(ot){if(fe(ot)!=="object"||ot===null)return _.Z.create({type:p.E.WEBIM_CONNCTION_OPEN_ERROR,message:"the param is illegal"});if(!ot.user||typeof ot.user!="string"){var Et=_.Z.create({type:p.E.WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR,message:"the user is empty or type is not string"});return R.kg.debug("open params error",Et),Et}return!("agoraToken"in ot)||ot.agoraToken&&typeof ot.agoraToken=="string"?!("accessToken"in ot)||ot.accessToken&&typeof ot.accessToken=="string"?"accessToken"in ot||"agoraToken"in ot||ot.pwd?void 0:(Et=_.Z.create({type:p.E.WEBIM_CONNCTION_OPEN_ERROR,message:"the accessToken or pwd is illegal"}),R.kg.debug("open params error",Et),Et):(Et=_.Z.create({type:p.E.WEBIM_CONNCTION_OPEN_ERROR,message:"the accessToken is illegal"}),R.kg.debug("open params error",Et),Et):(Et=_.Z.create({type:p.E.WEBIM_CONNCTION_OPEN_ERROR,message:"the agoraToken is illegal"}),R.kg.debug("open params error",Et),console.warn("agoraToken is deprecated, please use accessToken instead"),Et)}function We(ot){this.context.jid={appKey:this.appKey,name:ot.user,domain:this.domain,clientResource:this.clientResource},this.context.root=this.root,this.context.userId=ot.user,this.context.appKey=this.appKey,this.context.appName=this.appName,this.context.orgName=this.orgName}function Pe(ot,Et,nt){var Dt=this,B=nt.rpt,Ft=nt.isRetry,St=this.dnsIndex<this.dnsTotal?this.dnsIndex:0,Nt=this.dnsArr[St]+"/easemob/server.json";R.kg.debug("call getHttpDNS: "+this.dnsIndex);var Ut={url:Nt,dataType:"json",type:"GET",data:{app_key:encodeURIComponent(this.appKey)},success:function(Xt){R.kg.debug("getHttpDNS success");var Gt=Xt.extraInfo,ne=Gt.elapse,Re=Gt.httpCode,pe={requestUrl:Nt,requestName:M.c.GET_DNS,requestElapse:ne,isSuccess:1,code:Re};Dt._reportLogs=Xt.enableReportLogs==="true",Dt._reportInterval=Number(Xt.reportInterval||3e5),Xt?.enableDataReport==="true"?(Dt.dataReport.setIsCollectDt(!0),Dt.dataReport.setIsReportDt(!0)):(Dt.dataReport.setIsReportDt(!1),Dt.dataReport.setIsCollectDt(!1)),Xt?.uploadinparts_enable==="false"&&(Dt.uploadPartEnable=!1),B&&B({isRetry:Ft,data:pe});var Je=Xt.rest.hosts,I=Dt.https?"https":"http";if(R.kg.info("httpType: "+I),!Je){var X=_.Z.create({type:p.E.SERVER_GET_DNSLIST_FAILED,message:"DNS hosts resolution failed",data:Xt.rest});Et.error&&Et.error(X),Et.promise.reject&&Et.promise.reject(X)}for(var _t=Je.filter(function(ut){if(ut.protocol===I)return ut}),K=0;K<_t.length;K++)if(_t[K].protocol===I){var dt=_t[K];_t.splice(K,1),_t.unshift(dt)}Dt.restHosts=_t,Dt.restTotal=_t.length;var bt=Xt["msync-ws"].hosts;if(!bt){var rt=_.Z.create({type:p.E.SERVER_GET_DNSLIST_FAILED,message:"DNS msync-ws resolution failed",data:Xt["msync-ws"]});Et.error&&Et.error(rt),Et.promise.reject&&Et.promise.reject(rt)}var Vt=bt.filter(function(ut){return ut.protocol===I&&ut});Dt.socketHost=Vt,Dt.hostTotal=Vt.length,Ee.call(Dt),ot!=="refresh"&&(ot==="login"?ae.call(Dt,Et,{rpt:B}):He.call(Dt,Et,{rpt:B}))},error:function(Xt){var Gt=Xt.extraInfo,ne=Gt.elapse,Re=Gt.httpCode,pe=Gt.errDesc,Je={requestUrl:Nt,requestName:M.c.GET_DNS,isSuccess:0,code:Re,codeDesc:pe,requestElapse:ne};if(B&&B({isRetry:Ft,data:Je}),R.kg.debug("getHttpDNS fail: "+Dt.dnsIndex),Dt.dnsIndex++,Dt.dnsIndex<Dt.dnsTotal)Pe.call(Dt,ot,Et,{rpt:B,isRetry:!0});else if(ot==="login"||ot==="signup"){var I=_.Z.create({type:p.E.SERVER_GET_DNSLIST_FAILED,message:"get DNS failed",data:Xt});Et.error&&Et.error(I),Et.promise.reject&&Et.promise.reject(I)}}};return E.P6.ajax(Ut).catch(function(Xt){console.warn(Xt)})}function Ee(){var ot,Et;if(this.restIndex>this.restTotal)return R.kg.debug("restIndex > restTotal"),"";var nt="",Dt=this.restHosts[this.restIndex],B=Dt.domain,Ft=Dt.ip,St=Dt.port,Nt=this.https?"https:":"http:";return Ft&&typeof window<"u"&&((ot=window?.location)===null||ot===void 0?void 0:ot.protocol)==="http:"?nt=Nt+"//"+Ft+":"+St:(nt=Nt+"//"+B,St&&St!=="80"&&St!=="443"&&(nt+=":".concat(St)),typeof window>"u"||window.location||(nt="https://"+B),typeof window<"u"&&window.location&&((Et=window.location)===null||Et===void 0?void 0:Et.protocol)==="file:"&&(nt="https://"+B)),typeof window>"u"&&(nt=Nt+"//"+B),this.apiUrl=nt,nt}var te=ke(2449);f().util.Long=g(),f().configure();var Ae=f().Root.fromJSON({nested:{easemob:{nested:{pb:{nested:{MessageBody:{fields:{type:{type:"Type",id:1},from:{type:"JID",id:2},to:{type:"JID",id:3},contents:{rule:"repeated",type:"Content",id:4},ext:{rule:"repeated",type:"KeyValue",id:5},ackMessageId:{type:"uint64",id:6},msgConfig:{type:"MessageConfig",id:7},ackContent:{type:"string",id:8},meta:{type:"string",id:9},editMessageId:{type:"uint64",id:11}},nested:{Content:{fields:{type:{type:"Type",id:1},text:{type:"string",id:2},latitude:{type:"double",id:3},longitude:{type:"double",id:4},address:{type:"string",id:5},displayName:{type:"string",id:6},remotePath:{type:"string",id:7},secretKey:{type:"string",id:8},fileLength:{type:"int32",id:9},action:{type:"string",id:10},params:{rule:"repeated",type:"KeyValue",id:11},duration:{type:"int32",id:12},size:{type:"Size",id:13},thumbnailRemotePath:{type:"string",id:14},thumbnailSecretKey:{type:"string",id:15},thumbnailDisplayName:{type:"string",id:16},thumbnailFileLength:{type:"int32",id:17},thumbnailSize:{type:"Size",id:18},customEvent:{type:"string",id:19},customExts:{rule:"repeated",type:"KeyValue",id:20},buildingName:{type:"string",id:21},subType:{type:"SubType",id:22},title:{type:"string",id:23},summary:{type:"string",id:24},combineLevel:{type:"int32",id:25}},nested:{Type:{values:{TEXT:0,IMAGE:1,VIDEO:2,LOCATION:3,VOICE:4,FILE:5,COMMAND:6,CUSTOM:7,COMBINE:8}},Size:{fields:{width:{type:"double",id:1},height:{type:"double",id:2}}},SubType:{values:{COMBINE:0}}}},Type:{values:{NORMAL:0,CHAT:1,GROUPCHAT:2,CHATROOM:3,READ_ACK:4,DELIVER_ACK:5,RECALL:6,CHANNEL_ACK:7,EDIT:8}},MessageConfig:{fields:{allowGroupAck:{type:"bool",id:1}}}}},KeyValue:{oneofs:{value:{oneof:["varintValue","floatValue","doubleValue","stringValue"]}},fields:{key:{type:"string",id:1},type:{type:"ValueType",id:2},varintValue:{type:"int64",id:3},floatValue:{type:"float",id:4},doubleValue:{type:"double",id:5},stringValue:{type:"string",id:6}},nested:{ValueType:{values:{BOOL:1,INT:2,UINT:3,LLINT:4,FLOAT:5,DOUBLE:6,STRING:7,JSON_STRING:8}}}},JID:{fields:{appKey:{type:"string",id:1},name:{type:"string",id:2},domain:{type:"string",id:3},clientResource:{type:"string",id:4}}},ConferenceBody:{fields:{sessionId:{type:"string",id:1},operation:{type:"Operation",id:2},conferenceId:{type:"string",id:3},type:{type:"Type",id:4},content:{type:"string",id:5},network:{type:"string",id:6},version:{type:"string",id:7},identity:{type:"Identity",id:8},duration:{type:"string",id:9},peerName:{type:"string",id:10},endReason:{type:"EndReason",id:11},status:{type:"Status",id:12},isDirect:{type:"bool",id:13},controlType:{type:"StreamControlType",id:14},routeFlag:{type:"int32",id:15},routeKey:{type:"string",id:16}},nested:{Status:{fields:{errorCode:{type:"int32",id:1}}},Operation:{values:{JOIN:0,INITIATE:1,ACCEPT_INITIATE:2,ANSWER:3,TERMINATE:4,REMOVE:5,STREAM_CONTROL:6,MEDIA_REQUEST:7}},Type:{values:{VOICE:0,VIDEO:1}},Identity:{values:{CALLER:0,CALLEE:1}},EndReason:{values:{HANGUP:0,NORESPONSE:1,REJECT:2,BUSY:3,FAIL:4,UNSUPPORTED:5,OFFLINE:6}},StreamControlType:{values:{PAUSE_VOICE:0,RESUME_VOICE:1,PAUSE_VIDEO:2,RESUME_VIDEO:3}}}},MSync:{fields:{version:{type:"Version",id:1,options:{default:"MSYNC_V1"}},guid:{type:"JID",id:2},auth:{type:"string",id:3},compressAlgorimth:{type:"uint32",id:4},crypto:{type:"uint32",id:5},userAgent:{type:"string",id:6},pov:{type:"uint64",id:7},command:{type:"Command",id:8},deviceId:{type:"uint32",id:10},encryptType:{rule:"repeated",type:"EncryptType",id:11,options:{packed:!1}},encryptKey:{type:"string",id:12},payload:{type:"bytes",id:9}},nested:{Version:{values:{MSYNC_V1:0,MSYNC_V2:1}},Command:{values:{SYNC:0,UNREAD:1,NOTICE:2,PROVISION:3}}}},EncryptType:{values:{ENCRYPT_NONE:0,ENCRYPT_AES_128_CBC:1,ENCRYPT_AES_256_CBC:2}},CommSyncUL:{fields:{meta:{type:"Meta",id:1},key:{type:"uint64",id:2},queue:{type:"JID",id:3},isRoam:{type:"bool",id:4},lastFullRoamKey:{type:"uint64",id:5}}},CommSyncDL:{fields:{status:{type:"Status",id:1},metaId:{type:"uint64",id:2},serverId:{type:"uint64",id:3},metas:{rule:"repeated",type:"Meta",id:4},nextKey:{type:"uint64",id:5},queue:{type:"JID",id:6},isLast:{type:"bool",id:7},timestamp:{type:"uint64",id:8},isRoam:{type:"bool",id:9}}},CommNotice:{fields:{queue:{type:"JID",id:1}}},CommUnreadUL:{fields:{}},CommUnreadDL:{fields:{status:{type:"Status",id:1},unread:{rule:"repeated",type:"MetaQueue",id:2},timestamp:{type:"uint64",id:3}}},MetaQueue:{fields:{queue:{type:"JID",id:1},n:{type:"uint32",id:2}}},Meta:{fields:{id:{type:"uint64",id:1},from:{type:"JID",id:2},to:{type:"JID",id:3},timestamp:{type:"uint64",id:4},ns:{type:"NameSpace",id:5},payload:{type:"bytes",id:6},routetype:{type:"RouteType",id:7},ext:{rule:"repeated",type:"KeyValue",id:8},meta:{type:"bytes",id:9},directedUsers:{rule:"repeated",type:"string",id:10}},nested:{NameSpace:{values:{STATISTIC:0,CHAT:1,MUC:2,ROSTER:3,CONFERENCE:4,NOTIFY:5,QUERY:6}},RouteType:{values:{ROUTE_ALL:0,ROUTE_ONLINE:1,ROUTE_DIRECT:2}}}},Status:{fields:{errorCode:{type:"ErrorCode",id:1},reason:{type:"string",id:2},redirectInfo:{rule:"repeated",type:"RedirectInfo",id:3}},nested:{ErrorCode:{values:{OK:0,FAIL:1,UNAUTHORIZED:2,MISSING_PARAMETER:3,WRONG_PARAMETER:4,REDIRECT:5,TOKEN_EXPIRED:6,PERMISSION_DENIED:7,NO_ROUTE:8,UNKNOWN_COMMAND:9,PB_PARSER_ERROR:10,BIND_ANOTHER_DEVICE:11,IM_FORBIDDEN:12,TOO_MANY_DEVICES:13,PLATFORM_LIMIT:14,USER_MUTED:15,ENCRYPT_DISABLE:16,ENCRYPT_ENABLE:17,DECRYPT_FAILURE:18,PERMISSION_DENIED_EXTERNAL:19}}}},RedirectInfo:{fields:{host:{type:"string",id:1},port:{type:"uint32",id:2}}},Provision:{fields:{osType:{type:"OsType",id:1},version:{type:"string",id:2},networkType:{type:"NetworkType",id:3},appSign:{type:"string",id:4},compressType:{rule:"repeated",type:"CompressType",id:5,options:{packed:!1}},encryptType:{rule:"repeated",type:"EncryptType",id:6,options:{packed:!1}},encryptKey:{type:"string",id:7},status:{type:"Status",id:8},deviceUuid:{type:"string",id:9},isManualLogin:{type:"bool",id:10},password:{type:"string",id:11},deviceName:{type:"string",id:12},resource:{type:"string",id:13},auth:{type:"string",id:14},serviceId:{type:"string",id:16},actionVersion:{type:"string",id:17},authToken:{type:"string",id:18},sessionId:{type:"string",id:20},reason:{type:"string",id:21}},nested:{OsType:{values:{OS_IOS:0,OS_ANDROID:1,OS_LINUX:2,OS_OSX:3,OS_WIN:4,OS_OTHER:16}},NetworkType:{values:{NETWORK_NONE:0,NETWORK_WIFI:1,NETWORK_4G:2,NETWORK_3G:3,NETWORK_2G:4,NETWORK_WIRE:5}},CompressType:{values:{COMPRESS_NONE:0,COMPRESS_ZLIB:1}}}},MUCBody:{fields:{mucId:{type:"JID",id:1},operation:{type:"Operation",id:2},from:{type:"JID",id:3},to:{rule:"repeated",type:"JID",id:4},setting:{type:"Setting",id:5},reason:{type:"string",id:6},isChatroom:{type:"bool",id:7},status:{type:"Status",id:8},isThread:{type:"bool",id:9},mucParentId:{type:"JID",id:10},mucName:{type:"string",id:11},eventInfo:{type:"EventInfo",id:12},mucMemberCount:{type:"int32",id:13},ext:{type:"string",id:14},leaveOtherRooms:{type:"bool",id:15}},nested:{Operation:{values:{CREATE:0,DESTROY:1,JOIN:2,LEAVE:3,APPLY:4,APPLY_ACCEPT:5,APPLY_DECLINE:6,INVITE:7,INVITE_ACCEPT:8,INVITE_DECLINE:9,KICK:10,GET_BLACKLIST:11,BAN:12,ALLOW:13,UPDATE:14,BLOCK:15,UNBLOCK:16,PRESENCE:17,ABSENCE:18,DIRECT_JOINED:19,ASSIGN_OWNER:20,ADD_ADMIN:21,REMOVE_ADMIN:22,ADD_MUTE:23,REMOVE_MUTE:24,UPDATE_ANNOUNCEMENT:25,DELETE_ANNOUNCEMENT:26,UPLOAD_FILE:27,DELETE_FILE:28,ADD_USER_WHITE_LIST:29,REMOVE_USER_WHITE_LIST:30,BAN_GROUP:31,REMOVE_BAN_GROUP:32,THREAD_CREATE:33,THREAD_DESTROY:34,THREAD_JOIN:35,THREAD_LEAVE:36,THREAD_KICK:37,THREAD_UPDATE:38,THREAD_PRESENCE:39,THREAD_ABSENCE:40,DISABLE_GROUP:41,ABLE_GROUP:42,SET_METADATA:43,DELETE_METADATA:44,GROUP_MEMBER_METADATA_UPDATE:45}},Setting:{fields:{name:{type:"string",id:1},desc:{type:"string",id:2},type:{type:"Type",id:3},maxUsers:{type:"int32",id:4},owner:{type:"string",id:5}},nested:{Type:{values:{PRIVATE_OWNER_INVITE:0,PRIVATE_MEMBER_INVITE:1,PUBLIC_JOIN_APPROVAL:2,PUBLIC_JOIN_OPEN:3,PUBLIC_ANONYMOUS:4}}}},Status:{fields:{errorCode:{type:"ErrorCode",id:1},description:{type:"string",id:2}},nested:{ErrorCode:{values:{OK:0,PERMISSION_DENIED:1,WRONG_PARAMETER:2,MUC_NOT_EXIST:3,USER_NOT_EXIST:4,UNKNOWN:5}}}},EventInfo:{fields:{eventType:{type:"EventType",id:1,options:{default:"EVENT_NONE"}},ext:{type:"string",id:2}},nested:{EventType:{values:{EVENT_NONE:0,CIRCLE_CHANNEL:1}}}}}},RosterBody:{fields:{operation:{type:"Operation",id:1},status:{type:"Status",id:2},from:{type:"JID",id:3},to:{rule:"repeated",type:"JID",id:4},reason:{type:"string",id:5},rosterVer:{type:"string",id:6},biDirection:{type:"bool",id:7}},nested:{Operation:{values:{GET_ROSTER:0,GET_BLACKLIST:1,ADD:2,REMOVE:3,ACCEPT:4,DECLINE:5,BAN:6,ALLOW:7,REMOTE_ACCEPT:8,REMOTE_DECLINE:9}},Status:{fields:{errorCode:{type:"ErrorCode",id:1},description:{type:"string",id:2}},nested:{ErrorCode:{values:{OK:0,USER_NOT_EXIST:1,USER_ALREADY_FRIEND:2,USER_ALREADY_BLACKLIST:3}}}}}},StatisticsBody:{fields:{operation:{type:"Operation",id:1},os:{type:"OsType",id:2},version:{type:"string",id:3},network:{type:"NetworkType",id:4},imTime:{type:"uint32",id:5},chatTime:{type:"uint32",id:6},location:{type:"string",id:7},reason:{type:"string",id:10}},nested:{Operation:{values:{INFORMATION:0,USER_REMOVED:1,USER_LOGIN_ANOTHER_DEVICE:2,USER_KICKED_BY_CHANGE_PASSWORD:3,USER_KICKED_BY_OTHER_DEVICE:4}},OsType:{values:{OS_IOS:0,OS_ANDROID:1,OS_LINUX:2,OS_OSX:3,OS_WIN:4,OS_OTHER:16}},NetworkType:{values:{NETWORK_NONE:0,NETWORK_WIFI:1,NETWORK_4G:2,NETWORK_3G:3,NETWORK_2G:4,NETWORK_WIRE:5}}}}}}}}}});ir.prototype.root=Ae;var Xe=R.kg.getLogger("defaultLogger");Xe.setConfig({useCache:!1,maxCache:3145728,color:"",background:""}),Xe.enableAll(),ir.prototype._getSock=function(){if(this.isHttpDNS){var ot=this.socketHost[this.hostIndex];if(!ot)throw this.times=1,this.autoReconnectNumTotal=0,this.hostIndex=0,this.onClosed&&this.onClosed(),new Error("No connected domain name when get websocket.");var Et=ot.domain,nt=ot.ip,Dt="",B=ot.port;Dt=Et||nt,B&&B!=="80"&&B!=="443"&&(Dt+=":"+B),Dt&&(this.url="//"+Dt+"/ws");var Ft=this.https?"https:":"http:";this.url=Ft+this.url}return new(H())(this.url,null,{timeout:3e4})},ir.prototype.getUniqueId=E.P6.getUniqueId;var Be={connection:ir,message:te.Message,utils:E.P6,logger:Xe,statusCode:p.E};typeof window<"u"&&(window.WebIM=Be);var ze=Be}(),on}()})})(xD);var _7=xD.exports;const E7=kD(_7),DD="C2RSMGZWEfCkNc9kyA0nVw/y2iAQJUULwmNlA";class g7{constructor(){this.client=null,this.rtmClient=null,this.localAudioTrack=null,this.localVideoTrack=null,this.screenTrack=null,this.isJoined=!1,this.uid=null,this.channel=null}async initRTCClient(){return this.client=Yf.createClient({mode:"rtc",codec:"vp8"}),this.client}async initRTMClient(Bn){return this.rtmClient=new E7.connection({appKey:DD}),this.uid=Bn.toString(),await new Promise((Yi,xn)=>{this.rtmClient.open({user:this.uid,pwd:"default_password",success:Yi,error:xn})}),this.rtmClient}async joinChannel(Bn,Yi,xn){try{return this.channel=Bn,await this.client.join(DD,Bn,Yi,xn),[this.localAudioTrack,this.localVideoTrack]=await Promise.all([Yf.createMicrophoneAudioTrack(),Yf.createCameraVideoTrack()]),await this.client.publish([this.localAudioTrack,this.localVideoTrack]),this.rtmChannel=Bn,this.isJoined=!0,{audioTrack:this.localAudioTrack,videoTrack:this.localVideoTrack}}catch(ke){throw console.error("Failed to join channel:",ke),ke}}async leaveChannel(){try{this.localAudioTrack&&(this.localAudioTrack.stop(),this.localAudioTrack.close()),this.localVideoTrack&&(this.localVideoTrack.stop(),this.localVideoTrack.close()),await this.client.leave(),this.rtmClient&&this.rtmClient.close(),this.isJoined=!1,this.channel=null}catch(Bn){throw console.error("Error leaving channel:",Bn),Bn}}async startScreenShare(){try{return this.screenTrack=await Yf.createScreenVideoTrack({},"disable"),await this.client.unpublish([this.localVideoTrack]),await this.client.publish([this.screenTrack]),this.screenTrack}catch(Bn){throw console.error("Failed to start screen share:",Bn),Bn}}async stopScreenShare(){this.screenTrack&&(await this.client.unpublish([this.screenTrack]),this.screenTrack.close(),this.screenTrack=null,this.localVideoTrack&&await this.client.publish([this.localVideoTrack]))}toggleAudio(){return this.localAudioTrack?(this.localAudioTrack.setEnabled(!this.localAudioTrack.enabled),this.localAudioTrack.enabled):!1}toggleVideo(){return this.localVideoTrack?(this.localVideoTrack.setEnabled(!this.localVideoTrack.enabled),this.localVideoTrack.enabled):!1}setupRemoteUserHandlers(Bn,Yi){this.client.on("user-published",async(xn,ke)=>{await this.client.subscribe(xn,ke),Bn&&Bn(xn,ke)}),this.client.on("user-unpublished",(xn,ke)=>{Yi&&Yi(xn,ke)})}}const qo=new g7;function y7(){const{meetingId:Ka}=l7(),[Bn,Yi]=qi.useState(null),[xn,ke]=qi.useState(!0),[on,O]=qi.useState(""),[H,a]=qi.useState(!1),[f,h]=qi.useState(!1),g=qi.useRef(null),[_,E]=qi.useState([]),[m,p]=qi.useState(!0),[A,R]=qi.useState(!0),[D,P]=qi.useState(!1),[k,b]=qi.useState(!1),j=qi.useRef(null),z=qi.useRef(!1);qi.useEffect(()=>{(async()=>{try{ke(!0);const{data:wt,error:yt}=await qf.from("meetings").select("*").eq("id",Ka).maybeSingle();if(yt)throw yt;Yi(wt)}catch(wt){O(wt.message||"Falha ao carregar reuniÃ£o")}finally{ke(!1)}})()},[Ka]),qi.useEffect(()=>()=>{f&&qo.leaveChannel().catch(()=>{})},[f]);const S=async()=>{if(qo.client||await qo.initRTCClient(),!qo.rtmClient){const{data:mt}=await qf.auth.getUser(),wt=mt?.user?.id||Math.floor(Math.random()*1e9);await qo.initRTMClient(wt)}},F=async()=>{try{if(!Bn)return;a(!0),await S();const mt=Bn.agora_channel||Bn.id,{data:wt}=await qf.auth.getUser(),yt=wt?.user?.id||Math.floor(Math.random()*1e9),{data:Ht,error:Yt}=await qf.functions.invoke("generate-agora-token",{body:{channel:mt,uid:yt}});if(Yt)throw Yt;const At=Ht?.token||Ht;qo.setupRemoteUserHandlers(async(zt,re)=>{const de=`remote-${zt.uid}`;let ft=document.getElementById(de);if(!ft){ft=document.createElement("div"),ft.id=de,ft.className="w-full h-48 bg-black rounded-md overflow-hidden";const gt=document.getElementById("remote-grid");gt&&gt.appendChild(ft),E(Zt=>Zt.find(Pt=>Pt.uid===zt.uid)?Zt:[...Zt,{uid:zt.uid,videoContainerId:de}])}re==="video"?zt.videoTrack?.play(de):re==="audio"&&zt.audioTrack?.play()},zt=>{E(de=>de.filter(ft=>ft.uid!==zt.uid));const re=document.getElementById(`remote-${zt.uid}`);re?.parentNode&&re.parentNode.removeChild(re)});const{videoTrack:Lt}=await qo.joinChannel(mt,At,yt);h(!0),setTimeout(()=>{g.current&&Lt?.play(g.current)},0)}catch(mt){O(mt?.message||"Falha ao entrar na reuniÃ£o")}finally{a(!1)}},M=async()=>{try{await qo.leaveChannel(),h(!1),E([]),P(!1)}catch(mt){O(mt?.message||"Falha ao sair da reuniÃ£o")}},Z=()=>{const mt=qo.toggleAudio();p(mt)},U=()=>{const mt=qo.toggleVideo();R(mt)},Y=async()=>{try{D?(await qo.stopScreenShare(),P(!1)):(await qo.startScreenShare(),P(!0))}catch(mt){O(mt?.message||"Falha ao alternar compartilhamento de tela")}},q=mt=>{z.current=!0;const wt=j.current.getContext("2d"),yt=j.current.getBoundingClientRect();wt.beginPath(),wt.moveTo(mt.clientX-yt.left,mt.clientY-yt.top)},V=mt=>{if(!z.current)return;const wt=j.current.getContext("2d"),yt=j.current.getBoundingClientRect();wt.lineTo(mt.clientX-yt.left,mt.clientY-yt.top),wt.strokeStyle="#1f2937",wt.lineWidth=2,wt.stroke()},it=()=>{z.current=!1};return xn?jr.jsxs("div",{className:"p-6",children:[jr.jsx(ND,{className:"w-5 h-5 animate-spin inline-block mr-2"})," Carregandoâ¦"]}):on||!Bn?jr.jsxs("div",{className:"p-6 space-y-4",children:[jr.jsx("div",{className:"text-red-600 text-sm",children:on||"ReuniÃ£o nÃ£o encontrada"}),jr.jsx(PD,{to:"/dashboard/meetings",className:"text-blue-600 underline",children:"Voltar para ReuniÃµes"})]}):jr.jsxs("div",{className:"p-6 space-y-4",children:[jr.jsx("div",{className:"flex items-center justify-between",children:jr.jsxs("div",{className:"flex items-center gap-2",children:[jr.jsxs(PD,{to:"/dashboard/meetings",className:"inline-flex items-center text-sm text-muted-foreground hover:text-foreground",children:[jr.jsx(f7,{className:"w-4 h-4 mr-1"})," Voltar"]}),jr.jsx("h1",{className:"text-xl font-semibold",children:Bn.title||"ReuniÃ£o"})]})}),jr.jsxs(h7,{className:"p-4 space-y-4",children:[jr.jsxs("div",{className:"flex items-center justify-between",children:[jr.jsxs("div",{children:[jr.jsx("div",{className:"text-sm text-muted-foreground",children:"Canal"}),jr.jsx("div",{className:"font-mono text-sm",children:Bn.agora_channel||Bn.id})]}),jr.jsx("div",{className:"flex gap-2",children:f?jr.jsx(eu,{variant:"outline",onClick:M,children:"Sair"}):jr.jsx(eu,{onClick:F,disabled:H,children:H?jr.jsxs(jr.Fragment,{children:[jr.jsx(ND,{className:"w-4 h-4 mr-2 animate-spin"}),"Entrandoâ¦"]}):jr.jsxs(jr.Fragment,{children:[jr.jsx(p7,{className:"w-4 h-4 mr-2"})," Entrar"]})})})]}),jr.jsx("div",{className:"flex items-center gap-2",children:f&&jr.jsxs(jr.Fragment,{children:[jr.jsxs(eu,{size:"sm",variant:m?"outline":"destructive",onClick:Z,children:[m?"Mutar":"Desmutar"," Ã¡udio"]}),jr.jsxs(eu,{size:"sm",variant:A?"outline":"destructive",onClick:U,children:[A?"Desligar":"Ligar"," cÃ¢mera"]}),jr.jsx(eu,{size:"sm",onClick:Y,children:D?"Parar Compart.":"Compartilhar Tela"}),jr.jsx(eu,{size:"sm",variant:k?"secondary":"outline",onClick:()=>b(mt=>!mt),children:k?"Fechar Lousa":"Abrir Lousa"})]})}),jr.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[jr.jsxs("div",{children:[jr.jsx("div",{className:"text-sm mb-1",children:"Seu vÃ­deo"}),jr.jsx("div",{ref:g,className:"w-full h-48 bg-black rounded-md overflow-hidden"})]}),jr.jsxs("div",{children:[jr.jsx("div",{className:"text-sm mb-1",children:"Participantes"}),jr.jsx("div",{id:"remote-grid",className:"grid grid-cols-1 gap-2",children:_.length===0&&jr.jsx("div",{className:"w-full h-48 border rounded-md flex items-center justify-center text-xs text-muted-foreground",children:"Aguardando participantesâ¦"})})]})]}),k&&jr.jsxs("div",{className:"space-y-2",children:[jr.jsx("div",{className:"text-sm",children:"Lousa"}),jr.jsx("canvas",{ref:j,width:960,height:540,className:"border rounded-md bg-white",onMouseDown:q,onMouseMove:V,onMouseUp:it,onMouseLeave:it})]}),jr.jsx("div",{className:"text-xs text-muted-foreground",children:"VÃ­deo e lousa bÃ¡sicos. IntegraÃ§Ã£o com whiteboard e mais controles virÃ£o na prÃ³xima etapa."})]})]})}export{y7 as default};
