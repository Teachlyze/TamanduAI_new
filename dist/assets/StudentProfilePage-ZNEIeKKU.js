import{f as O,j as e,T as Q,ar as W,ak as X,g as Y,r as l,D as J,c as L,i as o,x as m,y as x,am as K,ao as Z,U as ee,d as F,Q as se,W as ae,X as v,B as f,ag as b,Y as w,F as P,H as R,A as y,l as te,s as k}from"./main-NgjJy_CG.js";import{B as re}from"./badge-DS8upoqS.js";import{T as le}from"./trending-down-BrWkQQvc.js";import{u as ie}from"./use-toast-GUBWlXfL.js";import{A as de}from"./arrow-left-MOSQdYvL.js";import{M as ne}from"./message-circle-D1KOXgTu.js";import{C}from"./chart-no-axes-column-Ds0A47fU.js";import{C as ce}from"./circle-check-big-dDW7KbJv.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}],["path",{d:"m9 9.5 2 2 4-4",key:"1dth82"}]],z=O("book-check",oe),p=({icon:r,label:h,value:i,description:a,progress:d,trend:n,trendValue:u})=>e.jsxs("div",{className:"p-4 border rounded-lg bg-card",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center justify-center h-10 w-10 rounded-lg bg-primary/10 text-primary",children:r}),n&&e.jsxs("span",{className:`inline-flex items-center text-xs px-2 py-1 rounded-full ${n==="up"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"}`,children:[n==="up"?e.jsx(Q,{className:"h-3 w-3 mr-1"}):e.jsx(le,{className:"h-3 w-3 mr-1"}),u,"%"]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:h}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:i}),d!==void 0?e.jsxs("div",{className:"mt-3 space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"Progresso"}),e.jsxs("span",{children:[d,"%"]})]}),e.jsx(W,{value:d,className:"h-2"})]}):e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a})]})]}),ve=()=>{const{id:r}=X(),h=Y(),{toast:i}=ie(),[a,d]=l.useState(null),[n,u]=l.useState(!0),[A,_]=l.useState(null),[me,V]=l.useState("overview"),[T,H]=l.useState([]),[g,U]=l.useState([]);if(l.useEffect(()=>{r&&(async()=>{try{u(!0),_(null);const{data:t,error:j}=await k.from("profiles").select("*").eq("id",r).single();if(j)throw j;const{data:S,error:E}=await k.from("class_members").select(`
            class_id,
            joined_at,
            classes (
              id,
              name,
              subject,
              grade_level,
              color,
              created_by
            )
          `).eq("user_id",r).eq("role","student");E&&(console.warn("⚠️ Erro ao buscar turmas:",E),i({variant:"warning",title:"Aviso",description:"Não foi possível carregar todas as turmas do aluno"}));const{data:B,error:M}=await k.from("submissions").select(`
            id,
            grade,
            submitted_at,
            status,
            feedback,
            activities (
              id,
              title,
              max_score,
              due_date,
              activity_type,
              classes (
                name,
                subject
              )
            )
          `).eq("student_id",r).order("submitted_at",{ascending:!1});M&&(console.warn("⚠️ Erro ao buscar submissões:",M),i({variant:"warning",title:"Aviso",description:"Não foi possível carregar todas as atividades do aluno"})),d(t),U(S?.map(I=>I.classes)||[]),H(B||[]),console.log("📊 Dados do aluno carregados:",{nome:t.full_name||t.email,turmas:S?.length||0,submissões:B?.length||0})}catch(t){console.error("❌ Erro ao buscar dados do aluno:",t),_(t.message),i({variant:"destructive",title:"Erro ao carregar dados",description:"Não foi possível carregar os dados do aluno. Tente novamente."})}finally{u(!1)}})()},[r,i]),n)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(J,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-muted-foreground",children:"Carregando dados do aluno..."})]})});if(A||!a)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(L,{className:"h-12 w-12 text-destructive"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Erro ao carregar dados"}),e.jsx("p",{className:"text-muted-foreground",children:A||"Aluno não encontrado"}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(o,{onClick:()=>h("/dashboard/students"),variant:"outline",children:"Voltar para Alunos"}),e.jsx(o,{onClick:()=>window.location.reload(),children:"Tentar novamente"})]})]})]})});const N=T.length,c=T.filter(s=>s.grade!==null),q=c.length>0?(c.reduce((s,t)=>s+(t.grade||0),0)/c.length).toFixed(1):0,$=N>0?Math.round(c.length/N*100):0,D=a.full_name||a.email?.split("@")[0]||"Aluno",G=a.email||"Email não disponível";return e.jsxs("div",{className:"w-full h-full p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>h(-1),className:"h-8 w-8 p-0",children:e.jsx(de,{className:"h-4 w-4"})}),e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Perfil do Aluno"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 pl-10 sm:pl-0",children:"Visualize e gerencie as informações do aluno"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(o,{variant:"outline",size:"sm",className:"bg-white dark:bg-slate-900 text-foreground border-border gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Enviar Mensagem"})]})})]}),e.jsx(m,{className:"mb-6 border-border/50 shadow-sm",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsxs("div",{className:"flex flex-col items-center md:items-start gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"h-24 w-24 border-2 border-primary/20 shadow-sm",children:e.jsx(Z,{className:"text-2xl font-medium bg-gradient-to-br from-primary/10 to-primary/20 text-primary",children:D.split(" ").map(s=>s[0]).join("").toUpperCase()})}),e.jsx("div",{className:"absolute -bottom-1 -right-1 h-6 w-6 rounded-full bg-green-500 border-2 border-background flex items-center justify-center",children:e.jsx("div",{className:"h-2 w-2 rounded-full bg-white"})})]}),e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("h2",{className:"text-xl font-bold",children:D}),e.jsx("p",{className:"text-sm text-muted-foreground",children:G}),e.jsx(re,{variant:"outline",className:"bg-white dark:bg-slate-900 text-foreground border-border mt-2",children:a.role==="student"?"Aluno":"Usuário"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 flex-1",children:[e.jsx(p,{icon:e.jsx(C,{className:"h-5 w-5"}),label:"Média Geral",value:q||"0.0",description:"de 10.0 pontos"}),e.jsx(p,{icon:e.jsx(z,{className:"h-5 w-5"}),label:"Atividades",value:`${c.length}/${N}`,description:`${$}% concluído`,progress:$}),e.jsx(p,{icon:e.jsx(ee,{className:"h-5 w-5"}),label:"Turmas",value:g.length,description:`${g.length} turma${g.length!==1?"s":""} ativa${g.length!==1?"s":""}`}),e.jsx(p,{icon:e.jsx(F,{className:"h-5 w-5"}),label:"Membro desde",value:a.created_at?new Date(a.created_at).toLocaleDateString("pt-BR"):"N/A",description:a.created_at?`${Math.floor((new Date-new Date(a.created_at))/(1e3*60*60*24*30))} meses`:""})]})]})})}),e.jsxs(se,{defaultValue:"overview",className:"w-full",onValueChange:V,children:[e.jsxs(ae,{className:"grid w-full sm:w-auto grid-cols-3 mb-6",children:[e.jsxs(v,{value:"overview",className:"flex items-center justify-center gap-2",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx("span",{children:"Visão Geral"})]}),e.jsxs(v,{value:"classes",className:"flex items-center justify-center gap-2",children:[e.jsx(f,{className:"h-4 w-4"}),e.jsx("span",{children:"Turmas"})]}),e.jsxs(v,{value:"activities",className:"flex items-center justify-center gap-2",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx("span",{children:"Atividades"})]})]}),e.jsx(w,{value:"overview",className:"space-y-6",children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(m,{className:"border-border/50 shadow-sm",children:[e.jsx(P,{children:e.jsxs(R,{className:"text-lg flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5 text-primary"}),"Desempenho por Matéria"]})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-4",children:a.classes?.length>0?a.classes.map(s=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:s.name}),e.jsx("span",{className:"text-sm font-medium",children:s.average.toFixed(1)})]}),e.jsx("div",{className:"h-2 w-full bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${s.average>=8?"bg-green-500":s.average>=6?"bg-yellow-500":"bg-red-500"} rounded-full`,style:{width:`${s.average*10}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Progresso: ",s.progress,"%"]}),e.jsxs("span",{children:[s.completed,"/",s.total," atividades"]})]})]},s.id)):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(f,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Nenhuma turma encontrada"})]})})})]}),e.jsxs(m,{className:"border-border/50 shadow-sm",children:[e.jsx(P,{children:e.jsxs(R,{className:"text-lg flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5 text-amber-500"}),"Últimas Atividades"]})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-4",children:a.grades?.length>0?a.grades.slice(0,3).map(s=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsx("div",{className:`flex-shrink-0 h-10 w-10 rounded-lg ${s.grade>=8?"bg-green-100 dark:bg-green-900/30":"bg-amber-100 dark:bg-amber-900/30"} flex items-center justify-center`,children:e.jsx(b,{className:`h-5 w-5 ${s.grade>=8?"text-green-600 dark:text-green-400":"text-amber-600 dark:text-amber-400"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-sm",children:s.subject}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.activity}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${s.grade>=8?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400"}`,children:s.grade.toFixed(1)}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(s.date).toLocaleDateString("pt-BR")})]})]})]},s.id)):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(y,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Nenhuma atividade encontrada"})]})})})]})]})}),e.jsx(w,{value:"classes",children:e.jsx(m,{className:"border-border/50 shadow-sm",children:e.jsx(x,{className:"p-0",children:e.jsx("div",{className:"divide-y divide-border",children:a.classes?.length>0?a.classes.map(s=>{const t=s.progress||0,j=t>=80?"bg-green-500":t>=50?"bg-yellow-500":"bg-red-500";return e.jsxs("div",{className:"p-4 hover:bg-muted/30 transition-colors",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(f,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-muted-foreground mt-1",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(y,{className:"mr-1.5 h-3.5 w-3.5 text-amber-500"}),"Média: ",s.average.toFixed(1)]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(z,{className:"mr-1.5 h-3.5 w-3.5 text-blue-500"}),s.completed,"/",s.total," atividades"]})]})]})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right min-w-[80px]",children:[e.jsxs("div",{className:"text-sm font-medium",children:[t,"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Concluído"})]}),e.jsxs(o,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Ver detalhes"})]})]})]}),e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"h-2 w-full bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${j} rounded-full transition-all duration-500`,style:{width:`${t}%`}})})})]},s.id)}):e.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[e.jsx(f,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Nenhuma turma encontrada"})]})})})})}),e.jsx(w,{value:"activities",children:e.jsx(m,{className:"border-border/50 shadow-sm",children:e.jsx(x,{className:"p-0",children:e.jsx("div",{className:"divide-y divide-border",children:a.grades?.length>0?a.grades.map(s=>{const t=s.grade>=7;return e.jsx("div",{className:"p-4 hover:bg-muted/30 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`flex-shrink-0 h-10 w-10 rounded-lg ${t?"bg-green-100 dark:bg-green-900/30":"bg-amber-100 dark:bg-amber-900/30"} flex items-center justify-center`,children:t?e.jsx(ce,{className:"h-5 w-5 text-green-600 dark:text-green-400"}):e.jsx(L,{className:"h-5 w-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.subject}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.activity}),e.jsxs("div",{className:"mt-1 flex items-center text-xs text-muted-foreground",children:[e.jsx(F,{className:"mr-1 h-3 w-3 opacity-70"}),new Date(s.date).toLocaleDateString("pt-BR"),e.jsx("span",{className:"mx-1.5",children:"•"}),e.jsx("span",{className:"capitalize",children:s.type.toLowerCase()})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-xl font-bold ${t?"text-green-600 dark:text-green-400":"text-amber-600 dark:text-amber-400"}`,children:s.grade.toFixed(1)}),e.jsx("div",{className:`text-xs font-medium ${t?"text-green-600 dark:text-green-400":"text-amber-600 dark:text-amber-400"}`,children:t?"Aprovado":"Recuperação"})]})]})},s.id)}):e.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[e.jsx(b,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Nenhuma atividade encontrada"})]})})})})})]})]})};export{ve as default};
