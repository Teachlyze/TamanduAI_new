import{g as D,u as U,r as l,s as b,z as E,j as e,o as V,m,A as H,T as I,C as J,k as K,a1 as L,a2 as O,W as X,a8 as Y,a9 as Z,aa as ee,w as ae,M as T}from"./main-Bujpyeg-.js";import{P as N}from"./PremiumCard-BaDWg06v.js";import{P as y}from"./PremiumButton-skKgx_xy.js";import{E as z}from"./EmptyState-CpVlA95H.js";import{B}from"./badge-BFkPUQ-P.js";import{G as w}from"./graduation-cap-Ch-mLRIV.js";import{F as se}from"./funnel-BoelNdGr.js";import{T as te}from"./trending-down-DPq5oMKG.js";const ue=()=>{const S=D(),{user:g}=U(),[F,h]=l.useState(!0),[t,C]=l.useState([]),[G,f]=l.useState([]),[n,$]=l.useState(""),[u,q]=l.useState("all");l.useEffect(()=>{g&&M()},[g]),l.useEffect(()=>{let a=t;n&&(a=a.filter(s=>s.name?.toLowerCase().includes(n.toLowerCase())||s.email?.toLowerCase().includes(n.toLowerCase())||s.className?.toLowerCase().includes(n.toLowerCase()))),u!=="all"&&(a=a.filter(s=>{const r=s.averageGrade||0;switch(u){case"excellent":return r>=9;case"good":return r>=7&&r<9;case"attention":return r<7;default:return!0}})),f(a)},[n,u,t]);const M=async()=>{try{h(!0);const{data:a}=await b.from("classes").select("id, name, subject").eq("created_by",g.id);if(!a||a.length===0){C([]),f([]),h(!1);return}const s=a.map(i=>i.id),{data:r,error:P}=await b.from("class_members").select(`
          user_id,
          class_id,
          classes(id, name, subject),
          profiles:user_id(id, name, email, avatar_url)
        `).in("class_id",s).eq("role","student");if(P)throw P;const _=await Promise.all((r||[]).map(async i=>{const A=i.user_id,{data:k}=await b.from("submissions").select("grade, submitted_at, activity_id, activities(max_score)").eq("student_id",A).not("grade","is",null),c=k?.map(d=>d.grade)||[],W=c.length>0?c.reduce((d,x)=>d+x,0)/c.length:0;let p="neutral";if(c.length>=6){const d=c.slice(-3).reduce((v,j)=>v+j,0)/3,x=c.slice(-6,-3).reduce((v,j)=>v+j,0)/3;d>x+.5?p="up":d<x-.5&&(p="down")}return{id:A,name:i.profiles?.name||"Sem nome",email:i.profiles?.email||"",avatar_url:i.profiles?.avatar_url,className:i.classes?.name||"",classSubject:i.classes?.subject||"",classId:i.class_id,totalSubmissions:k?.length||0,averageGrade:W,trend:p}}));C(_),f(_)}catch(a){console.error("Erro ao carregar alunos:",a),E.error("Erro ao carregar alunos")}finally{h(!1)}},Q=a=>a>=9?"from-green-500 to-emerald-500":a>=7?"from-blue-500 to-cyan-500":a>=5?"from-yellow-500 to-orange-500":"from-red-500 to-pink-500",R=a=>a>=9?"Excelente":a>=7?"Bom":a>=5?"Regular":"Precisa AtenÃ§Ã£o";if(F)return e.jsx(V,{message:"Carregando alunos..."});const o={total:t.length,excellent:t.filter(a=>a.averageGrade>=9).length,good:t.filter(a=>a.averageGrade>=7&&a.averageGrade<9).length,attention:t.filter(a=>a.averageGrade<7).length,averageClass:t.length>0?t.reduce((a,s)=>a+s.averageGrade,0)/t.length:0};return e.jsxs("div",{className:"space-y-6 pb-8",children:[e.jsxs(m.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-green-500 via-emerald-500 to-teal-500 p-8 text-white",children:[e.jsx("div",{className:"absolute inset-0 opacity-10",children:e.jsx("div",{className:"absolute inset-0",style:{backgroundImage:"radial-gradient(circle at 2px 2px, white 1px, transparent 0)",backgroundSize:"32px 32px"}})}),e.jsx("div",{className:"relative z-10 flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs(m.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",delay:.2},className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm rounded-full px-4 py-2 mb-4",children:[e.jsx(w,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"GestÃ£o de Alunos"})]}),e.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Meus Alunos ðŸŽ“"}),e.jsx("p",{className:"text-white/90 text-lg",children:"Acompanhe o desempenho e evoluÃ§Ã£o dos seus alunos"})]})}),e.jsx(m.div,{animate:{y:[0,-15,0],rotate:[0,5,0]},transition:{duration:4,repeat:1/0},className:"absolute top-10 right-20 text-6xl opacity-20",children:"ðŸŽ“"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[{title:"Total de Alunos",value:o.total,icon:w,gradient:"from-green-500 to-emerald-500"},{title:"Excelentes (â‰¥9)",value:o.excellent,icon:H,gradient:"from-yellow-500 to-orange-500"},{title:"Bons (7-9)",value:o.good,icon:I,gradient:"from-blue-500 to-cyan-500"},{title:"Precisam AtenÃ§Ã£o (<7)",value:o.attention,icon:J,gradient:"from-red-500 to-pink-500",urgent:o.attention>0},{title:"MÃ©dia Geral",value:o.averageClass.toFixed(1),icon:K,gradient:"from-purple-500 to-indigo-500"}].map((a,s)=>e.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.1},children:e.jsxs(N,{variant:"elevated",className:`relative overflow-hidden group hover:scale-105 transition-transform ${a.urgent?"border-2 border-red-300 dark:border-red-700":""}`,children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${a.gradient} opacity-5 group-hover:opacity-10 transition-opacity`}),e.jsxs("div",{className:"relative p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("div",{className:`p-3 rounded-xl bg-gradient-to-br ${a.gradient} text-white`,children:e.jsx(a.icon,{className:"w-6 h-6"})})}),e.jsx("div",{className:"text-3xl font-bold mb-1",children:a.value}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.title})]})]})},a.title))}),e.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsx(N,{variant:"elevated",className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(L,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),e.jsx(O,{placeholder:"Buscar alunos por nome, email ou turma...",value:n,onChange:a=>$(a.target.value),className:"pl-10"})]}),e.jsx("div",{className:"flex gap-2",children:["all","excellent","good","attention"].map(a=>e.jsx(y,{variant:u===a?"default":"outline",size:"sm",onClick:()=>q(a),leftIcon:se,children:a==="all"?"Todos":a==="excellent"?"Excelentes":a==="good"?"Bons":"AtenÃ§Ã£o"},a))})]})})}),G.length===0?t.length===0?e.jsx(z,{icon:w,title:"Nenhum aluno cadastrado",description:"Seus alunos aparecerÃ£o aqui quando se matricularem nas turmas"}):e.jsx(z,{icon:L,title:"Nenhum aluno encontrado",description:"Tente ajustar sua busca ou filtros"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.jsx(X,{children:G.map((a,s)=>e.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.9},transition:{delay:s*.05},layout:!0,children:e.jsx(N,{variant:"elevated",className:"group relative overflow-hidden hover:scale-105 transition-all cursor-pointer",onClick:()=>S(`/dashboard/teacher/students/${a.id}`),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsxs(Y,{className:"w-16 h-16",children:[e.jsx(Z,{src:a.avatar_url}),e.jsx(ee,{className:"bg-gradient-to-br from-green-500 to-emerald-500 text-white text-lg font-bold",children:a.name?.charAt(0)||"?"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-lg truncate group-hover:text-primary transition-colors",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:a.email}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsx(B,{variant:"outline",className:"text-xs",children:a.className})})]})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"MÃ©dia"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`px-3 py-1 rounded-full text-sm font-bold text-white bg-gradient-to-r ${Q(a.averageGrade)}`,children:a.averageGrade.toFixed(1)}),a.trend==="up"&&e.jsx(I,{className:"w-4 h-4 text-green-600"}),a.trend==="down"&&e.jsx(te,{className:"w-4 h-4 text-red-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Status"}),e.jsx(B,{className:`${a.averageGrade>=9?"bg-green-100 text-green-700":a.averageGrade>=7?"bg-blue-100 text-blue-700":"bg-red-100 text-red-700"}`,children:R(a.averageGrade)})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"SubmissÃµes"}),e.jsx("span",{className:"font-medium",children:a.totalSubmissions})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4 border-t border-border",children:[e.jsx(y,{size:"sm",variant:"outline",leftIcon:ae,onClick:r=>{r.stopPropagation(),S(`/dashboard/teacher/students/${a.id}`)},className:"flex-1",children:"Ver Perfil"}),e.jsx(y,{size:"sm",variant:"outline",leftIcon:T,onClick:r=>{r.stopPropagation(),E.info("Chat em desenvolvimento")},children:e.jsx(T,{className:"w-4 h-4"})})]})]})})},a.id))})})]})};export{ue as default};
