import{u as k,g as S,r as d,s as n,ar as l,j as e,o as _,K as r,bE as A,A as u,U as q,aN as E,aO as I,aP as M,aQ as R,aR as P,d as g,br as T}from"./main-Cv3DLBs1.js";import{P as h}from"./PremiumCard-C8PJt07T.js";import{P as b}from"./PremiumButton-DEtqLbhG.js";import{A as L}from"./arrow-left-Bz9GyE2M.js";import{S as B}from"./save-DIxQy3Yi.js";import{T as F}from"./target-BazIADWF.js";const K=()=>{const{user:o}=k(),m=S(),[j,v]=d.useState(!0),[p,x]=d.useState(!1),[f,N]=d.useState([]),[s,t]=d.useState({title:"",description:"",objective:"",xpReward:50,classId:"",startDate:"",endDate:"",isActive:!0,requirements:{minActivities:0,minGrade:0,specificActivities:[]}});d.useEffect(()=>{w()},[o?.id]);const w=async()=>{try{const{data:a,error:i}=await n.from("classes").select("id, name, subject").eq("created_by",o.id).eq("is_active",!0);if(i)throw i;N(a||[])}catch(a){console.error("Erro ao carregar turmas:",a),l({title:"Erro",description:"N√£o foi poss√≠vel carregar turmas.",variant:"destructive"})}finally{v(!1)}},y=async()=>{if(!s.title.trim()){l({title:"Erro",description:"T√≠tulo √© obrigat√≥rio.",variant:"destructive"});return}if(!s.classId){l({title:"Erro",description:"Selecione uma turma.",variant:"destructive"});return}x(!0);try{const{data:a,error:i}=await n.from("missions").insert({title:s.title,description:s.description,objective:s.objective,xp_reward:s.xpReward,class_id:s.classId,start_date:s.startDate||null,end_date:s.endDate||null,is_active:s.isActive,requirements:s.requirements,created_by:o.id}).select().single();if(i)throw i;const{data:c}=await n.from("class_members").select("user_id").eq("class_id",s.classId).eq("role","student");if(c&&c.length>0){const C=c.map(D=>({mission_id:a.id,user_id:D.user_id,progress:{},status:"active",reset_at:null}));await n.from("user_missions").upsert(C,{onConflict:"user_id,mission_id"})}l({title:"Sucesso",description:"Miss√£o criada com sucesso!"}),m("/dashboard/missions")}catch(a){console.error("Erro ao criar miss√£o:",a),l({title:"Erro",description:"N√£o foi poss√≠vel criar a miss√£o.",variant:"destructive"})}finally{x(!1)}};return j?e.jsx(_,{message:"Carregando..."}):e.jsxs("div",{className:"p-6 max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>m("/dashboard/missions"),className:"whitespace-nowrap inline-flex items-center gap-2 bg-white dark:bg-slate-900 text-foreground border-border rounded-lg",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{children:"Voltar"})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent",children:"Nova Miss√£o"}),e.jsx("p",{className:"text-muted-foreground",children:"Crie desafios para engajar seus alunos"})]})]}),e.jsxs(b,{onClick:y,loading:p,className:"bg-gradient-to-r from-orange-600 to-red-600 text-white whitespace-nowrap inline-flex items-center gap-2 shadow-lg font-semibold rounded-xl",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{children:"Criar Miss√£o"})]})]}),e.jsx(h,{variant:"elevated",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-orange-500 to-red-500 rounded-xl flex items-center justify-center",children:e.jsx(F,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Informa√ß√µes da Miss√£o"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure os detalhes do desafio"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"T√≠tulo da Miss√£o *"}),e.jsx(r,{value:s.title,onChange:a=>t({...s,title:a.target.value}),placeholder:"Ex: Completar 5 atividades esta semana",className:"bg-white dark:bg-slate-900 text-foreground border-border rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Descri√ß√£o"}),e.jsx(A,{value:s.description,onChange:a=>t({...s,description:a.target.value}),placeholder:"Descreva o desafio...",className:"min-h-[100px] bg-white dark:bg-slate-900 text-foreground border-border rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Objetivo (vis√≠vel para alunos)"}),e.jsx(r,{value:s.objective,onChange:a=>t({...s,objective:a.target.value}),placeholder:"Ex: Entregar todas as atividades no prazo",className:"bg-white dark:bg-slate-900 text-foreground border-border rounded-lg"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4 text-yellow-500"}),"Recompensa XP"]}),e.jsx(r,{type:"number",min:"1",max:"1000",value:s.xpReward,onChange:a=>t({...s,xpReward:parseInt(a.target.value)||50}),className:"bg-white dark:bg-slate-900 text-foreground border-border rounded-lg"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4 text-blue-500"}),"Turma *"]}),e.jsxs(E,{value:s.classId,onValueChange:a=>t({...s,classId:a}),children:[e.jsx(I,{className:"bg-white dark:bg-slate-900 text-foreground border-border rounded-lg",children:e.jsx(M,{placeholder:"Selecione uma turma"})}),e.jsx(R,{children:f.map(a=>e.jsxs(P,{value:a.id,children:[a.name," - ",a.subject]},a.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(g,{className:"w-4 h-4 text-green-500"}),"Data de In√≠cio"]}),e.jsx(r,{type:"date",value:s.startDate,onChange:a=>t({...s,startDate:a.target.value}),className:"bg-white dark:bg-slate-900 text-foreground border-border rounded-lg"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(g,{className:"w-4 h-4 text-red-500"}),"Data de T√©rmino"]}),e.jsx(r,{type:"date",value:s.endDate,onChange:a=>t({...s,endDate:a.target.value}),className:"bg-white dark:bg-slate-900 text-foreground border-border rounded-lg"})]})]}),e.jsxs("div",{className:"border-t border-border pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Requisitos (opcional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"M√≠nimo de Atividades"}),e.jsx(r,{type:"number",min:"0",value:s.requirements.minActivities,onChange:a=>t({...s,requirements:{...s.requirements,minActivities:parseInt(a.target.value)||0}})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Nota M√≠nima"}),e.jsx(r,{type:"number",min:"0",max:"10",step:"0.1",value:s.requirements.minGrade,onChange:a=>t({...s,requirements:{...s.requirements,minGrade:parseFloat(a.target.value)||0}})})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border border-border rounded-lg bg-green-50 dark:bg-green-950/20",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Miss√£o Ativa"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Alunos podem come√ßar a trabalhar nesta miss√£o"})]}),e.jsx(T,{checked:s.isActive,onCheckedChange:a=>t({...s,isActive:a})})]})]})]})}),e.jsx(h,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Preview da Miss√£o"}),e.jsxs("div",{className:"p-6 bg-gradient-to-br from-orange-500/10 to-red-500/10 rounded-xl border-2 border-orange-200 dark:border-orange-800",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-xl font-bold text-orange-600",children:s.title||"T√≠tulo da Miss√£o"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.description||"Descri√ß√£o da miss√£o..."})]}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-yellow-500/20 rounded-lg",children:[e.jsx(u,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("span",{className:"font-bold text-yellow-600",children:[s.xpReward," XP"]})]})]}),s.objective&&e.jsxs("div",{className:"bg-white/50 dark:bg-black/20 p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium",children:"üéØ Objetivo:"}),e.jsx("div",{className:"text-sm mt-1",children:s.objective})]}),(s.startDate||s.endDate)&&e.jsxs("div",{className:"mt-3 flex items-center gap-4 text-sm text-muted-foreground",children:[s.startDate&&e.jsxs("span",{children:["In√≠cio: ",new Date(s.startDate).toLocaleDateString("pt-BR")]}),s.endDate&&e.jsxs("span",{children:["Fim: ",new Date(s.endDate).toLocaleDateString("pt-BR")]})]})]})]})})]})};export{K as default};
