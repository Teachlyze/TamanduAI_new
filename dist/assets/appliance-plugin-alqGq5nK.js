const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BZCUBik5-DQfgFNwz.js","assets/Whiteboard-Bt5ZMH01.js","assets/main-BBAlbGLj.js","assets/main-DjUI_5r2.css","assets/es.string.trim-BBX5KnYe.js","assets/extends-BFqQA52f.js","assets/typeof-CPR7xHyo.js","assets/asyncToGenerator-Ds6Qpe_-.js","assets/popper-B_2vCoY7.js","assets/assertThisInitialized-b-KHx1rs.js","assets/inheritsLoose-CMRHYPv0.js","assets/index-CL7e-2tA.js","assets/apiSupabase-CoV1_a5J.js","assets/Whiteboard-hmh_jMwf.css","assets/eventemitter2-B4k4W4Xh.js"])))=>i.map(i=>d[i]);
import{bg as Hi,bV as l0,c5 as u0,r as Zr,bj as Vu,bc as Nd,j as yo,_ as c0}from"./main-BBAlbGLj.js";import{o as Ad,w as Ft,l as Pt}from"./Whiteboard-Bt5ZMH01.js";import{y as jl}from"./eventemitter2-B4k4W4Xh.js";var fe=function(n){var t={};function e(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return n[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=n,e.c=t,e.d=function(r,i,o){e.o(r,i)||Object.defineProperty(r,i,{enumerable:!0,get:o})},e.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},e.t=function(r,i){if(i&1&&(r=e(r)),i&8||i&4&&typeof r=="object"&&r&&r.__esModule)return r;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:r}),i&2&&typeof r!="string")for(var s in r)e.d(o,s,function(a){return r[a]}.bind(null,s));return o},e.n=function(r){var i=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(i,"a",i),i},e.o=function(r,i){return Object.prototype.hasOwnProperty.call(r,i)},e.p="/js/",e(e.s=0)}([function(n,t,e){e.r(t),e.d(t,"version",function(){return Q}),e.d(t,"helpers",function(){return k}),e.d(t,"createElement",function(){return j}),e.d(t,"isSpriteNode",function(){return O}),e.d(t,"registerNode",function(){return L});var r=e(12);e.d(t,"ENV",function(){return r.ENV});var i=e(68);e.d(t,"requestAnimationFrame",function(){return i.requestAnimationFrame}),e.d(t,"cancelAnimationFrame",function(){return i.cancelAnimationFrame});var o=e(70);e.d(t,"Node",function(){return o.default});var s=e(217);e.d(t,"Cloud",function(){return s.default});var a=e(219);e.d(t,"Block",function(){return a.default});var l=e(224);e.d(t,"Sprite",function(){return l.default});var u=e(226);e.d(t,"Path",function(){return u.default});var p=e(229);e.d(t,"Rect",function(){return p.default});var c=e(231);e.d(t,"Triangle",function(){return c.default});var g=e(236);e.d(t,"Parallel",function(){return g.default});var v=e(238);e.d(t,"Regular",function(){return v.default});var I=e(240);e.d(t,"Star",function(){return I.default});var w=e(242);e.d(t,"Ellipse",function(){return w.default});var y=e(244);e.d(t,"Arc",function(){return y.default});var T=e(246);e.d(t,"Ring",function(){return T.default});var h=e(232);e.d(t,"Polyline",function(){return h.default});var m=e(248);e.d(t,"Label",function(){return m.default});var d=e(250);e.d(t,"Group",function(){return d.default});var M=e(286);e.d(t,"Layer",function(){return M.default});var x=e(287);e.d(t,"SpriteSvg",function(){return x.default});var E=e(289);e.d(t,"LayerWorker",function(){return E.default});var P=e(290);e.d(t,"Scene",function(){return P.default});var R=e(213),N=e(221);e.d(t,"Color",function(){return N.Color}),e.d(t,"Gradient",function(){return N.Gradient});var b=e(72);e(1).glMatrix.setMatrixArrayType(Array);const j=R.default.createElement,O=R.default.isSpriteNode,L=R.default.registerNode,k={parseColor:N.parseColor,sizeToPixel:b.sizeToPixel,toArray:b.toArray,toString:b.toString,toNumber:b.toNumber};let H;H="3.8.3";const Q=H},function(n,t,e){e.r(t);var r=e(2);e.d(t,"glMatrix",function(){return r});var i=e(3);e.d(t,"mat2",function(){return i});var o=e(4);e.d(t,"mat2d",function(){return o});var s=e(5);e.d(t,"mat3",function(){return s});var a=e(6);e.d(t,"mat4",function(){return a});var l=e(7);e.d(t,"quat",function(){return l});var u=e(10);e.d(t,"quat2",function(){return u});var p=e(11);e.d(t,"vec2",function(){return p});var c=e(8);e.d(t,"vec3",function(){return c});var g=e(9);e.d(t,"vec4",function(){return g})},function(n,t,e){e.r(t),e.d(t,"EPSILON",function(){return r}),e.d(t,"ARRAY_TYPE",function(){return i}),e.d(t,"RANDOM",function(){return o}),e.d(t,"setMatrixArrayType",function(){return s}),e.d(t,"toRadian",function(){return l}),e.d(t,"equals",function(){return u});var r=1e-6,i=typeof Float32Array<"u"?Float32Array:Array,o=Math.random;function s(p){i=p}var a=Math.PI/180;function l(p){return p*a}function u(p,c){return Math.abs(p-c)<=r*Math.max(1,Math.abs(p),Math.abs(c))}Math.hypot||(Math.hypot=function(){for(var p=0,c=arguments.length;c--;)p+=arguments[c]*arguments[c];return Math.sqrt(p)})},function(n,t,e){e.r(t),e.d(t,"create",function(){return i}),e.d(t,"clone",function(){return o}),e.d(t,"copy",function(){return s}),e.d(t,"identity",function(){return a}),e.d(t,"fromValues",function(){return l}),e.d(t,"set",function(){return u}),e.d(t,"transpose",function(){return p}),e.d(t,"invert",function(){return c}),e.d(t,"adjoint",function(){return g}),e.d(t,"determinant",function(){return v}),e.d(t,"multiply",function(){return I}),e.d(t,"rotate",function(){return w}),e.d(t,"scale",function(){return y}),e.d(t,"fromRotation",function(){return T}),e.d(t,"fromScaling",function(){return h}),e.d(t,"str",function(){return m}),e.d(t,"frob",function(){return d}),e.d(t,"LDU",function(){return M}),e.d(t,"add",function(){return x}),e.d(t,"subtract",function(){return E}),e.d(t,"exactEquals",function(){return P}),e.d(t,"equals",function(){return R}),e.d(t,"multiplyScalar",function(){return N}),e.d(t,"multiplyScalarAndAdd",function(){return b}),e.d(t,"mul",function(){return j}),e.d(t,"sub",function(){return O});var r=e(2);function i(){var L=new r.ARRAY_TYPE(4);return r.ARRAY_TYPE!=Float32Array&&(L[1]=0,L[2]=0),L[0]=1,L[3]=1,L}function o(L){var k=new r.ARRAY_TYPE(4);return k[0]=L[0],k[1]=L[1],k[2]=L[2],k[3]=L[3],k}function s(L,k){return L[0]=k[0],L[1]=k[1],L[2]=k[2],L[3]=k[3],L}function a(L){return L[0]=1,L[1]=0,L[2]=0,L[3]=1,L}function l(L,k,H,Q){var _=new r.ARRAY_TYPE(4);return _[0]=L,_[1]=k,_[2]=H,_[3]=Q,_}function u(L,k,H,Q,_){return L[0]=k,L[1]=H,L[2]=Q,L[3]=_,L}function p(L,k){if(L===k){var H=k[1];L[1]=k[2],L[2]=H}else L[0]=k[0],L[1]=k[2],L[2]=k[1],L[3]=k[3];return L}function c(L,k){var H=k[0],Q=k[1],_=k[2],st=k[3],F=H*st-_*Q;return F?(F=1/F,L[0]=st*F,L[1]=-Q*F,L[2]=-_*F,L[3]=H*F,L):null}function g(L,k){var H=k[0];return L[0]=k[3],L[1]=-k[1],L[2]=-k[2],L[3]=H,L}function v(L){return L[0]*L[3]-L[2]*L[1]}function I(L,k,H){var Q=k[0],_=k[1],st=k[2],F=k[3],Z=H[0],tt=H[1],ct=H[2],at=H[3];return L[0]=Q*Z+st*tt,L[1]=_*Z+F*tt,L[2]=Q*ct+st*at,L[3]=_*ct+F*at,L}function w(L,k,H){var Q=k[0],_=k[1],st=k[2],F=k[3],Z=Math.sin(H),tt=Math.cos(H);return L[0]=Q*tt+st*Z,L[1]=_*tt+F*Z,L[2]=Q*-Z+st*tt,L[3]=_*-Z+F*tt,L}function y(L,k,H){var Q=k[0],_=k[1],st=k[2],F=k[3],Z=H[0],tt=H[1];return L[0]=Q*Z,L[1]=_*Z,L[2]=st*tt,L[3]=F*tt,L}function T(L,k){var H=Math.sin(k),Q=Math.cos(k);return L[0]=Q,L[1]=H,L[2]=-H,L[3]=Q,L}function h(L,k){return L[0]=k[0],L[1]=0,L[2]=0,L[3]=k[1],L}function m(L){return"mat2("+L[0]+", "+L[1]+", "+L[2]+", "+L[3]+")"}function d(L){return Math.hypot(L[0],L[1],L[2],L[3])}function M(L,k,H,Q){return L[2]=Q[2]/Q[0],H[0]=Q[0],H[1]=Q[1],H[3]=Q[3]-L[2]*H[1],[L,k,H]}function x(L,k,H){return L[0]=k[0]+H[0],L[1]=k[1]+H[1],L[2]=k[2]+H[2],L[3]=k[3]+H[3],L}function E(L,k,H){return L[0]=k[0]-H[0],L[1]=k[1]-H[1],L[2]=k[2]-H[2],L[3]=k[3]-H[3],L}function P(L,k){return L[0]===k[0]&&L[1]===k[1]&&L[2]===k[2]&&L[3]===k[3]}function R(L,k){var H=L[0],Q=L[1],_=L[2],st=L[3],F=k[0],Z=k[1],tt=k[2],ct=k[3];return Math.abs(H-F)<=r.EPSILON*Math.max(1,Math.abs(H),Math.abs(F))&&Math.abs(Q-Z)<=r.EPSILON*Math.max(1,Math.abs(Q),Math.abs(Z))&&Math.abs(_-tt)<=r.EPSILON*Math.max(1,Math.abs(_),Math.abs(tt))&&Math.abs(st-ct)<=r.EPSILON*Math.max(1,Math.abs(st),Math.abs(ct))}function N(L,k,H){return L[0]=k[0]*H,L[1]=k[1]*H,L[2]=k[2]*H,L[3]=k[3]*H,L}function b(L,k,H,Q){return L[0]=k[0]+H[0]*Q,L[1]=k[1]+H[1]*Q,L[2]=k[2]+H[2]*Q,L[3]=k[3]+H[3]*Q,L}var j=I,O=E},function(n,t,e){e.r(t),e.d(t,"create",function(){return i}),e.d(t,"clone",function(){return o}),e.d(t,"copy",function(){return s}),e.d(t,"identity",function(){return a}),e.d(t,"fromValues",function(){return l}),e.d(t,"set",function(){return u}),e.d(t,"invert",function(){return p}),e.d(t,"determinant",function(){return c}),e.d(t,"multiply",function(){return g}),e.d(t,"rotate",function(){return v}),e.d(t,"scale",function(){return I}),e.d(t,"translate",function(){return w}),e.d(t,"fromRotation",function(){return y}),e.d(t,"fromScaling",function(){return T}),e.d(t,"fromTranslation",function(){return h}),e.d(t,"str",function(){return m}),e.d(t,"frob",function(){return d}),e.d(t,"add",function(){return M}),e.d(t,"subtract",function(){return x}),e.d(t,"multiplyScalar",function(){return E}),e.d(t,"multiplyScalarAndAdd",function(){return P}),e.d(t,"exactEquals",function(){return R}),e.d(t,"equals",function(){return N}),e.d(t,"mul",function(){return b}),e.d(t,"sub",function(){return j});var r=e(2);function i(){var O=new r.ARRAY_TYPE(6);return r.ARRAY_TYPE!=Float32Array&&(O[1]=0,O[2]=0,O[4]=0,O[5]=0),O[0]=1,O[3]=1,O}function o(O){var L=new r.ARRAY_TYPE(6);return L[0]=O[0],L[1]=O[1],L[2]=O[2],L[3]=O[3],L[4]=O[4],L[5]=O[5],L}function s(O,L){return O[0]=L[0],O[1]=L[1],O[2]=L[2],O[3]=L[3],O[4]=L[4],O[5]=L[5],O}function a(O){return O[0]=1,O[1]=0,O[2]=0,O[3]=1,O[4]=0,O[5]=0,O}function l(O,L,k,H,Q,_){var st=new r.ARRAY_TYPE(6);return st[0]=O,st[1]=L,st[2]=k,st[3]=H,st[4]=Q,st[5]=_,st}function u(O,L,k,H,Q,_,st){return O[0]=L,O[1]=k,O[2]=H,O[3]=Q,O[4]=_,O[5]=st,O}function p(O,L){var k=L[0],H=L[1],Q=L[2],_=L[3],st=L[4],F=L[5],Z=k*_-H*Q;return Z?(Z=1/Z,O[0]=_*Z,O[1]=-H*Z,O[2]=-Q*Z,O[3]=k*Z,O[4]=(Q*F-_*st)*Z,O[5]=(H*st-k*F)*Z,O):null}function c(O){return O[0]*O[3]-O[1]*O[2]}function g(O,L,k){var H=L[0],Q=L[1],_=L[2],st=L[3],F=L[4],Z=L[5],tt=k[0],ct=k[1],at=k[2],dt=k[3],it=k[4],ft=k[5];return O[0]=H*tt+_*ct,O[1]=Q*tt+st*ct,O[2]=H*at+_*dt,O[3]=Q*at+st*dt,O[4]=H*it+_*ft+F,O[5]=Q*it+st*ft+Z,O}function v(O,L,k){var H=L[0],Q=L[1],_=L[2],st=L[3],F=L[4],Z=L[5],tt=Math.sin(k),ct=Math.cos(k);return O[0]=H*ct+_*tt,O[1]=Q*ct+st*tt,O[2]=H*-tt+_*ct,O[3]=Q*-tt+st*ct,O[4]=F,O[5]=Z,O}function I(O,L,k){var H=L[0],Q=L[1],_=L[2],st=L[3],F=L[4],Z=L[5],tt=k[0],ct=k[1];return O[0]=H*tt,O[1]=Q*tt,O[2]=_*ct,O[3]=st*ct,O[4]=F,O[5]=Z,O}function w(O,L,k){var H=L[0],Q=L[1],_=L[2],st=L[3],F=L[4],Z=L[5],tt=k[0],ct=k[1];return O[0]=H,O[1]=Q,O[2]=_,O[3]=st,O[4]=H*tt+_*ct+F,O[5]=Q*tt+st*ct+Z,O}function y(O,L){var k=Math.sin(L),H=Math.cos(L);return O[0]=H,O[1]=k,O[2]=-k,O[3]=H,O[4]=0,O[5]=0,O}function T(O,L){return O[0]=L[0],O[1]=0,O[2]=0,O[3]=L[1],O[4]=0,O[5]=0,O}function h(O,L){return O[0]=1,O[1]=0,O[2]=0,O[3]=1,O[4]=L[0],O[5]=L[1],O}function m(O){return"mat2d("+O[0]+", "+O[1]+", "+O[2]+", "+O[3]+", "+O[4]+", "+O[5]+")"}function d(O){return Math.hypot(O[0],O[1],O[2],O[3],O[4],O[5],1)}function M(O,L,k){return O[0]=L[0]+k[0],O[1]=L[1]+k[1],O[2]=L[2]+k[2],O[3]=L[3]+k[3],O[4]=L[4]+k[4],O[5]=L[5]+k[5],O}function x(O,L,k){return O[0]=L[0]-k[0],O[1]=L[1]-k[1],O[2]=L[2]-k[2],O[3]=L[3]-k[3],O[4]=L[4]-k[4],O[5]=L[5]-k[5],O}function E(O,L,k){return O[0]=L[0]*k,O[1]=L[1]*k,O[2]=L[2]*k,O[3]=L[3]*k,O[4]=L[4]*k,O[5]=L[5]*k,O}function P(O,L,k,H){return O[0]=L[0]+k[0]*H,O[1]=L[1]+k[1]*H,O[2]=L[2]+k[2]*H,O[3]=L[3]+k[3]*H,O[4]=L[4]+k[4]*H,O[5]=L[5]+k[5]*H,O}function R(O,L){return O[0]===L[0]&&O[1]===L[1]&&O[2]===L[2]&&O[3]===L[3]&&O[4]===L[4]&&O[5]===L[5]}function N(O,L){var k=O[0],H=O[1],Q=O[2],_=O[3],st=O[4],F=O[5],Z=L[0],tt=L[1],ct=L[2],at=L[3],dt=L[4],it=L[5];return Math.abs(k-Z)<=r.EPSILON*Math.max(1,Math.abs(k),Math.abs(Z))&&Math.abs(H-tt)<=r.EPSILON*Math.max(1,Math.abs(H),Math.abs(tt))&&Math.abs(Q-ct)<=r.EPSILON*Math.max(1,Math.abs(Q),Math.abs(ct))&&Math.abs(_-at)<=r.EPSILON*Math.max(1,Math.abs(_),Math.abs(at))&&Math.abs(st-dt)<=r.EPSILON*Math.max(1,Math.abs(st),Math.abs(dt))&&Math.abs(F-it)<=r.EPSILON*Math.max(1,Math.abs(F),Math.abs(it))}var b=g,j=x},function(n,t,e){e.r(t),e.d(t,"create",function(){return i}),e.d(t,"fromMat4",function(){return o}),e.d(t,"clone",function(){return s}),e.d(t,"copy",function(){return a}),e.d(t,"fromValues",function(){return l}),e.d(t,"set",function(){return u}),e.d(t,"identity",function(){return p}),e.d(t,"transpose",function(){return c}),e.d(t,"invert",function(){return g}),e.d(t,"adjoint",function(){return v}),e.d(t,"determinant",function(){return I}),e.d(t,"multiply",function(){return w}),e.d(t,"translate",function(){return y}),e.d(t,"rotate",function(){return T}),e.d(t,"scale",function(){return h}),e.d(t,"fromTranslation",function(){return m}),e.d(t,"fromRotation",function(){return d}),e.d(t,"fromScaling",function(){return M}),e.d(t,"fromMat2d",function(){return x}),e.d(t,"fromQuat",function(){return E}),e.d(t,"normalFromMat4",function(){return P}),e.d(t,"projection",function(){return R}),e.d(t,"str",function(){return N}),e.d(t,"frob",function(){return b}),e.d(t,"add",function(){return j}),e.d(t,"subtract",function(){return O}),e.d(t,"multiplyScalar",function(){return L}),e.d(t,"multiplyScalarAndAdd",function(){return k}),e.d(t,"exactEquals",function(){return H}),e.d(t,"equals",function(){return Q}),e.d(t,"mul",function(){return _}),e.d(t,"sub",function(){return st});var r=e(2);function i(){var F=new r.ARRAY_TYPE(9);return r.ARRAY_TYPE!=Float32Array&&(F[1]=0,F[2]=0,F[3]=0,F[5]=0,F[6]=0,F[7]=0),F[0]=1,F[4]=1,F[8]=1,F}function o(F,Z){return F[0]=Z[0],F[1]=Z[1],F[2]=Z[2],F[3]=Z[4],F[4]=Z[5],F[5]=Z[6],F[6]=Z[8],F[7]=Z[9],F[8]=Z[10],F}function s(F){var Z=new r.ARRAY_TYPE(9);return Z[0]=F[0],Z[1]=F[1],Z[2]=F[2],Z[3]=F[3],Z[4]=F[4],Z[5]=F[5],Z[6]=F[6],Z[7]=F[7],Z[8]=F[8],Z}function a(F,Z){return F[0]=Z[0],F[1]=Z[1],F[2]=Z[2],F[3]=Z[3],F[4]=Z[4],F[5]=Z[5],F[6]=Z[6],F[7]=Z[7],F[8]=Z[8],F}function l(F,Z,tt,ct,at,dt,it,ft,wt){var U=new r.ARRAY_TYPE(9);return U[0]=F,U[1]=Z,U[2]=tt,U[3]=ct,U[4]=at,U[5]=dt,U[6]=it,U[7]=ft,U[8]=wt,U}function u(F,Z,tt,ct,at,dt,it,ft,wt,U){return F[0]=Z,F[1]=tt,F[2]=ct,F[3]=at,F[4]=dt,F[5]=it,F[6]=ft,F[7]=wt,F[8]=U,F}function p(F){return F[0]=1,F[1]=0,F[2]=0,F[3]=0,F[4]=1,F[5]=0,F[6]=0,F[7]=0,F[8]=1,F}function c(F,Z){if(F===Z){var tt=Z[1],ct=Z[2],at=Z[5];F[1]=Z[3],F[2]=Z[6],F[3]=tt,F[5]=Z[7],F[6]=ct,F[7]=at}else F[0]=Z[0],F[1]=Z[3],F[2]=Z[6],F[3]=Z[1],F[4]=Z[4],F[5]=Z[7],F[6]=Z[2],F[7]=Z[5],F[8]=Z[8];return F}function g(F,Z){var tt=Z[0],ct=Z[1],at=Z[2],dt=Z[3],it=Z[4],ft=Z[5],wt=Z[6],U=Z[7],Y=Z[8],K=Y*it-ft*U,et=-Y*dt+ft*wt,W=U*dt-it*wt,$=tt*K+ct*et+at*W;return $?($=1/$,F[0]=K*$,F[1]=(-Y*ct+at*U)*$,F[2]=(ft*ct-at*it)*$,F[3]=et*$,F[4]=(Y*tt-at*wt)*$,F[5]=(-ft*tt+at*dt)*$,F[6]=W*$,F[7]=(-U*tt+ct*wt)*$,F[8]=(it*tt-ct*dt)*$,F):null}function v(F,Z){var tt=Z[0],ct=Z[1],at=Z[2],dt=Z[3],it=Z[4],ft=Z[5],wt=Z[6],U=Z[7],Y=Z[8];return F[0]=it*Y-ft*U,F[1]=at*U-ct*Y,F[2]=ct*ft-at*it,F[3]=ft*wt-dt*Y,F[4]=tt*Y-at*wt,F[5]=at*dt-tt*ft,F[6]=dt*U-it*wt,F[7]=ct*wt-tt*U,F[8]=tt*it-ct*dt,F}function I(F){var Z=F[0],tt=F[1],ct=F[2],at=F[3],dt=F[4],it=F[5],ft=F[6],wt=F[7],U=F[8];return Z*(U*dt-it*wt)+tt*(-U*at+it*ft)+ct*(wt*at-dt*ft)}function w(F,Z,tt){var ct=Z[0],at=Z[1],dt=Z[2],it=Z[3],ft=Z[4],wt=Z[5],U=Z[6],Y=Z[7],K=Z[8],et=tt[0],W=tt[1],$=tt[2],C=tt[3],D=tt[4],B=tt[5],X=tt[6],q=tt[7],rt=tt[8];return F[0]=et*ct+W*it+$*U,F[1]=et*at+W*ft+$*Y,F[2]=et*dt+W*wt+$*K,F[3]=C*ct+D*it+B*U,F[4]=C*at+D*ft+B*Y,F[5]=C*dt+D*wt+B*K,F[6]=X*ct+q*it+rt*U,F[7]=X*at+q*ft+rt*Y,F[8]=X*dt+q*wt+rt*K,F}function y(F,Z,tt){var ct=Z[0],at=Z[1],dt=Z[2],it=Z[3],ft=Z[4],wt=Z[5],U=Z[6],Y=Z[7],K=Z[8],et=tt[0],W=tt[1];return F[0]=ct,F[1]=at,F[2]=dt,F[3]=it,F[4]=ft,F[5]=wt,F[6]=et*ct+W*it+U,F[7]=et*at+W*ft+Y,F[8]=et*dt+W*wt+K,F}function T(F,Z,tt){var ct=Z[0],at=Z[1],dt=Z[2],it=Z[3],ft=Z[4],wt=Z[5],U=Z[6],Y=Z[7],K=Z[8],et=Math.sin(tt),W=Math.cos(tt);return F[0]=W*ct+et*it,F[1]=W*at+et*ft,F[2]=W*dt+et*wt,F[3]=W*it-et*ct,F[4]=W*ft-et*at,F[5]=W*wt-et*dt,F[6]=U,F[7]=Y,F[8]=K,F}function h(F,Z,tt){var ct=tt[0],at=tt[1];return F[0]=ct*Z[0],F[1]=ct*Z[1],F[2]=ct*Z[2],F[3]=at*Z[3],F[4]=at*Z[4],F[5]=at*Z[5],F[6]=Z[6],F[7]=Z[7],F[8]=Z[8],F}function m(F,Z){return F[0]=1,F[1]=0,F[2]=0,F[3]=0,F[4]=1,F[5]=0,F[6]=Z[0],F[7]=Z[1],F[8]=1,F}function d(F,Z){var tt=Math.sin(Z),ct=Math.cos(Z);return F[0]=ct,F[1]=tt,F[2]=0,F[3]=-tt,F[4]=ct,F[5]=0,F[6]=0,F[7]=0,F[8]=1,F}function M(F,Z){return F[0]=Z[0],F[1]=0,F[2]=0,F[3]=0,F[4]=Z[1],F[5]=0,F[6]=0,F[7]=0,F[8]=1,F}function x(F,Z){return F[0]=Z[0],F[1]=Z[1],F[2]=0,F[3]=Z[2],F[4]=Z[3],F[5]=0,F[6]=Z[4],F[7]=Z[5],F[8]=1,F}function E(F,Z){var tt=Z[0],ct=Z[1],at=Z[2],dt=Z[3],it=tt+tt,ft=ct+ct,wt=at+at,U=tt*it,Y=ct*it,K=ct*ft,et=at*it,W=at*ft,$=at*wt,C=dt*it,D=dt*ft,B=dt*wt;return F[0]=1-K-$,F[3]=Y-B,F[6]=et+D,F[1]=Y+B,F[4]=1-U-$,F[7]=W-C,F[2]=et-D,F[5]=W+C,F[8]=1-U-K,F}function P(F,Z){var tt=Z[0],ct=Z[1],at=Z[2],dt=Z[3],it=Z[4],ft=Z[5],wt=Z[6],U=Z[7],Y=Z[8],K=Z[9],et=Z[10],W=Z[11],$=Z[12],C=Z[13],D=Z[14],B=Z[15],X=tt*ft-ct*it,q=tt*wt-at*it,rt=tt*U-dt*it,lt=ct*wt-at*ft,gt=ct*U-dt*ft,yt=at*U-dt*wt,xt=Y*C-K*$,Et=Y*D-et*$,St=Y*B-W*$,Mt=K*D-et*C,Ct=K*B-W*C,Ot=et*B-W*D,bt=X*Ot-q*Ct+rt*Mt+lt*St-gt*Et+yt*xt;return bt?(bt=1/bt,F[0]=(ft*Ot-wt*Ct+U*Mt)*bt,F[1]=(wt*St-it*Ot-U*Et)*bt,F[2]=(it*Ct-ft*St+U*xt)*bt,F[3]=(at*Ct-ct*Ot-dt*Mt)*bt,F[4]=(tt*Ot-at*St+dt*Et)*bt,F[5]=(ct*St-tt*Ct-dt*xt)*bt,F[6]=(C*yt-D*gt+B*lt)*bt,F[7]=(D*rt-$*yt-B*q)*bt,F[8]=($*gt-C*rt+B*X)*bt,F):null}function R(F,Z,tt){return F[0]=2/Z,F[1]=0,F[2]=0,F[3]=0,F[4]=-2/tt,F[5]=0,F[6]=-1,F[7]=1,F[8]=1,F}function N(F){return"mat3("+F[0]+", "+F[1]+", "+F[2]+", "+F[3]+", "+F[4]+", "+F[5]+", "+F[6]+", "+F[7]+", "+F[8]+")"}function b(F){return Math.hypot(F[0],F[1],F[2],F[3],F[4],F[5],F[6],F[7],F[8])}function j(F,Z,tt){return F[0]=Z[0]+tt[0],F[1]=Z[1]+tt[1],F[2]=Z[2]+tt[2],F[3]=Z[3]+tt[3],F[4]=Z[4]+tt[4],F[5]=Z[5]+tt[5],F[6]=Z[6]+tt[6],F[7]=Z[7]+tt[7],F[8]=Z[8]+tt[8],F}function O(F,Z,tt){return F[0]=Z[0]-tt[0],F[1]=Z[1]-tt[1],F[2]=Z[2]-tt[2],F[3]=Z[3]-tt[3],F[4]=Z[4]-tt[4],F[5]=Z[5]-tt[5],F[6]=Z[6]-tt[6],F[7]=Z[7]-tt[7],F[8]=Z[8]-tt[8],F}function L(F,Z,tt){return F[0]=Z[0]*tt,F[1]=Z[1]*tt,F[2]=Z[2]*tt,F[3]=Z[3]*tt,F[4]=Z[4]*tt,F[5]=Z[5]*tt,F[6]=Z[6]*tt,F[7]=Z[7]*tt,F[8]=Z[8]*tt,F}function k(F,Z,tt,ct){return F[0]=Z[0]+tt[0]*ct,F[1]=Z[1]+tt[1]*ct,F[2]=Z[2]+tt[2]*ct,F[3]=Z[3]+tt[3]*ct,F[4]=Z[4]+tt[4]*ct,F[5]=Z[5]+tt[5]*ct,F[6]=Z[6]+tt[6]*ct,F[7]=Z[7]+tt[7]*ct,F[8]=Z[8]+tt[8]*ct,F}function H(F,Z){return F[0]===Z[0]&&F[1]===Z[1]&&F[2]===Z[2]&&F[3]===Z[3]&&F[4]===Z[4]&&F[5]===Z[5]&&F[6]===Z[6]&&F[7]===Z[7]&&F[8]===Z[8]}function Q(F,Z){var tt=F[0],ct=F[1],at=F[2],dt=F[3],it=F[4],ft=F[5],wt=F[6],U=F[7],Y=F[8],K=Z[0],et=Z[1],W=Z[2],$=Z[3],C=Z[4],D=Z[5],B=Z[6],X=Z[7],q=Z[8];return Math.abs(tt-K)<=r.EPSILON*Math.max(1,Math.abs(tt),Math.abs(K))&&Math.abs(ct-et)<=r.EPSILON*Math.max(1,Math.abs(ct),Math.abs(et))&&Math.abs(at-W)<=r.EPSILON*Math.max(1,Math.abs(at),Math.abs(W))&&Math.abs(dt-$)<=r.EPSILON*Math.max(1,Math.abs(dt),Math.abs($))&&Math.abs(it-C)<=r.EPSILON*Math.max(1,Math.abs(it),Math.abs(C))&&Math.abs(ft-D)<=r.EPSILON*Math.max(1,Math.abs(ft),Math.abs(D))&&Math.abs(wt-B)<=r.EPSILON*Math.max(1,Math.abs(wt),Math.abs(B))&&Math.abs(U-X)<=r.EPSILON*Math.max(1,Math.abs(U),Math.abs(X))&&Math.abs(Y-q)<=r.EPSILON*Math.max(1,Math.abs(Y),Math.abs(q))}var _=w,st=O},function(n,t,e){e.r(t),e.d(t,"create",function(){return i}),e.d(t,"clone",function(){return o}),e.d(t,"copy",function(){return s}),e.d(t,"fromValues",function(){return a}),e.d(t,"set",function(){return l}),e.d(t,"identity",function(){return u}),e.d(t,"transpose",function(){return p}),e.d(t,"invert",function(){return c}),e.d(t,"adjoint",function(){return g}),e.d(t,"determinant",function(){return v}),e.d(t,"multiply",function(){return I}),e.d(t,"translate",function(){return w}),e.d(t,"scale",function(){return y}),e.d(t,"rotate",function(){return T}),e.d(t,"rotateX",function(){return h}),e.d(t,"rotateY",function(){return m}),e.d(t,"rotateZ",function(){return d}),e.d(t,"fromTranslation",function(){return M}),e.d(t,"fromScaling",function(){return x}),e.d(t,"fromRotation",function(){return E}),e.d(t,"fromXRotation",function(){return P}),e.d(t,"fromYRotation",function(){return R}),e.d(t,"fromZRotation",function(){return N}),e.d(t,"fromRotationTranslation",function(){return b}),e.d(t,"fromQuat2",function(){return j}),e.d(t,"getTranslation",function(){return O}),e.d(t,"getScaling",function(){return L}),e.d(t,"getRotation",function(){return k}),e.d(t,"fromRotationTranslationScale",function(){return H}),e.d(t,"fromRotationTranslationScaleOrigin",function(){return Q}),e.d(t,"fromQuat",function(){return _}),e.d(t,"frustum",function(){return st}),e.d(t,"perspective",function(){return F}),e.d(t,"perspectiveFromFieldOfView",function(){return Z}),e.d(t,"ortho",function(){return tt}),e.d(t,"lookAt",function(){return ct}),e.d(t,"targetTo",function(){return at}),e.d(t,"str",function(){return dt}),e.d(t,"frob",function(){return it}),e.d(t,"add",function(){return ft}),e.d(t,"subtract",function(){return wt}),e.d(t,"multiplyScalar",function(){return U}),e.d(t,"multiplyScalarAndAdd",function(){return Y}),e.d(t,"exactEquals",function(){return K}),e.d(t,"equals",function(){return et}),e.d(t,"mul",function(){return W}),e.d(t,"sub",function(){return $});var r=e(2);function i(){var C=new r.ARRAY_TYPE(16);return r.ARRAY_TYPE!=Float32Array&&(C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[11]=0,C[12]=0,C[13]=0,C[14]=0),C[0]=1,C[5]=1,C[10]=1,C[15]=1,C}function o(C){var D=new r.ARRAY_TYPE(16);return D[0]=C[0],D[1]=C[1],D[2]=C[2],D[3]=C[3],D[4]=C[4],D[5]=C[5],D[6]=C[6],D[7]=C[7],D[8]=C[8],D[9]=C[9],D[10]=C[10],D[11]=C[11],D[12]=C[12],D[13]=C[13],D[14]=C[14],D[15]=C[15],D}function s(C,D){return C[0]=D[0],C[1]=D[1],C[2]=D[2],C[3]=D[3],C[4]=D[4],C[5]=D[5],C[6]=D[6],C[7]=D[7],C[8]=D[8],C[9]=D[9],C[10]=D[10],C[11]=D[11],C[12]=D[12],C[13]=D[13],C[14]=D[14],C[15]=D[15],C}function a(C,D,B,X,q,rt,lt,gt,yt,xt,Et,St,Mt,Ct,Ot,bt){var At=new r.ARRAY_TYPE(16);return At[0]=C,At[1]=D,At[2]=B,At[3]=X,At[4]=q,At[5]=rt,At[6]=lt,At[7]=gt,At[8]=yt,At[9]=xt,At[10]=Et,At[11]=St,At[12]=Mt,At[13]=Ct,At[14]=Ot,At[15]=bt,At}function l(C,D,B,X,q,rt,lt,gt,yt,xt,Et,St,Mt,Ct,Ot,bt,At){return C[0]=D,C[1]=B,C[2]=X,C[3]=q,C[4]=rt,C[5]=lt,C[6]=gt,C[7]=yt,C[8]=xt,C[9]=Et,C[10]=St,C[11]=Mt,C[12]=Ct,C[13]=Ot,C[14]=bt,C[15]=At,C}function u(C){return C[0]=1,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=1,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[10]=1,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C}function p(C,D){if(C===D){var B=D[1],X=D[2],q=D[3],rt=D[6],lt=D[7],gt=D[11];C[1]=D[4],C[2]=D[8],C[3]=D[12],C[4]=B,C[6]=D[9],C[7]=D[13],C[8]=X,C[9]=rt,C[11]=D[14],C[12]=q,C[13]=lt,C[14]=gt}else C[0]=D[0],C[1]=D[4],C[2]=D[8],C[3]=D[12],C[4]=D[1],C[5]=D[5],C[6]=D[9],C[7]=D[13],C[8]=D[2],C[9]=D[6],C[10]=D[10],C[11]=D[14],C[12]=D[3],C[13]=D[7],C[14]=D[11],C[15]=D[15];return C}function c(C,D){var B=D[0],X=D[1],q=D[2],rt=D[3],lt=D[4],gt=D[5],yt=D[6],xt=D[7],Et=D[8],St=D[9],Mt=D[10],Ct=D[11],Ot=D[12],bt=D[13],At=D[14],Yt=D[15],re=B*gt-X*lt,Zt=B*yt-q*lt,Qt=B*xt-rt*lt,te=X*yt-q*gt,qt=X*xt-rt*gt,Ee=q*xt-rt*yt,Te=Et*bt-St*Ot,Se=Et*At-Mt*Ot,xe=Et*Yt-Ct*Ot,Ae=St*At-Mt*bt,De=St*Yt-Ct*bt,be=Mt*Yt-Ct*At,ue=re*be-Zt*De+Qt*Ae+te*xe-qt*Se+Ee*Te;return ue?(ue=1/ue,C[0]=(gt*be-yt*De+xt*Ae)*ue,C[1]=(q*De-X*be-rt*Ae)*ue,C[2]=(bt*Ee-At*qt+Yt*te)*ue,C[3]=(Mt*qt-St*Ee-Ct*te)*ue,C[4]=(yt*xe-lt*be-xt*Se)*ue,C[5]=(B*be-q*xe+rt*Se)*ue,C[6]=(At*Qt-Ot*Ee-Yt*Zt)*ue,C[7]=(Et*Ee-Mt*Qt+Ct*Zt)*ue,C[8]=(lt*De-gt*xe+xt*Te)*ue,C[9]=(X*xe-B*De-rt*Te)*ue,C[10]=(Ot*qt-bt*Qt+Yt*re)*ue,C[11]=(St*Qt-Et*qt-Ct*re)*ue,C[12]=(gt*Se-lt*Ae-yt*Te)*ue,C[13]=(B*Ae-X*Se+q*Te)*ue,C[14]=(bt*Zt-Ot*te-At*re)*ue,C[15]=(Et*te-St*Zt+Mt*re)*ue,C):null}function g(C,D){var B=D[0],X=D[1],q=D[2],rt=D[3],lt=D[4],gt=D[5],yt=D[6],xt=D[7],Et=D[8],St=D[9],Mt=D[10],Ct=D[11],Ot=D[12],bt=D[13],At=D[14],Yt=D[15];return C[0]=gt*(Mt*Yt-Ct*At)-St*(yt*Yt-xt*At)+bt*(yt*Ct-xt*Mt),C[1]=-(X*(Mt*Yt-Ct*At)-St*(q*Yt-rt*At)+bt*(q*Ct-rt*Mt)),C[2]=X*(yt*Yt-xt*At)-gt*(q*Yt-rt*At)+bt*(q*xt-rt*yt),C[3]=-(X*(yt*Ct-xt*Mt)-gt*(q*Ct-rt*Mt)+St*(q*xt-rt*yt)),C[4]=-(lt*(Mt*Yt-Ct*At)-Et*(yt*Yt-xt*At)+Ot*(yt*Ct-xt*Mt)),C[5]=B*(Mt*Yt-Ct*At)-Et*(q*Yt-rt*At)+Ot*(q*Ct-rt*Mt),C[6]=-(B*(yt*Yt-xt*At)-lt*(q*Yt-rt*At)+Ot*(q*xt-rt*yt)),C[7]=B*(yt*Ct-xt*Mt)-lt*(q*Ct-rt*Mt)+Et*(q*xt-rt*yt),C[8]=lt*(St*Yt-Ct*bt)-Et*(gt*Yt-xt*bt)+Ot*(gt*Ct-xt*St),C[9]=-(B*(St*Yt-Ct*bt)-Et*(X*Yt-rt*bt)+Ot*(X*Ct-rt*St)),C[10]=B*(gt*Yt-xt*bt)-lt*(X*Yt-rt*bt)+Ot*(X*xt-rt*gt),C[11]=-(B*(gt*Ct-xt*St)-lt*(X*Ct-rt*St)+Et*(X*xt-rt*gt)),C[12]=-(lt*(St*At-Mt*bt)-Et*(gt*At-yt*bt)+Ot*(gt*Mt-yt*St)),C[13]=B*(St*At-Mt*bt)-Et*(X*At-q*bt)+Ot*(X*Mt-q*St),C[14]=-(B*(gt*At-yt*bt)-lt*(X*At-q*bt)+Ot*(X*yt-q*gt)),C[15]=B*(gt*Mt-yt*St)-lt*(X*Mt-q*St)+Et*(X*yt-q*gt),C}function v(C){var D=C[0],B=C[1],X=C[2],q=C[3],rt=C[4],lt=C[5],gt=C[6],yt=C[7],xt=C[8],Et=C[9],St=C[10],Mt=C[11],Ct=C[12],Ot=C[13],bt=C[14],At=C[15],Yt=D*lt-B*rt,re=D*gt-X*rt,Zt=D*yt-q*rt,Qt=B*gt-X*lt,te=B*yt-q*lt,qt=X*yt-q*gt,Ee=xt*Ot-Et*Ct,Te=xt*bt-St*Ct,Se=xt*At-Mt*Ct,xe=Et*bt-St*Ot,Ae=Et*At-Mt*Ot,De=St*At-Mt*bt;return Yt*De-re*Ae+Zt*xe+Qt*Se-te*Te+qt*Ee}function I(C,D,B){var X=D[0],q=D[1],rt=D[2],lt=D[3],gt=D[4],yt=D[5],xt=D[6],Et=D[7],St=D[8],Mt=D[9],Ct=D[10],Ot=D[11],bt=D[12],At=D[13],Yt=D[14],re=D[15],Zt=B[0],Qt=B[1],te=B[2],qt=B[3];return C[0]=Zt*X+Qt*gt+te*St+qt*bt,C[1]=Zt*q+Qt*yt+te*Mt+qt*At,C[2]=Zt*rt+Qt*xt+te*Ct+qt*Yt,C[3]=Zt*lt+Qt*Et+te*Ot+qt*re,Zt=B[4],Qt=B[5],te=B[6],qt=B[7],C[4]=Zt*X+Qt*gt+te*St+qt*bt,C[5]=Zt*q+Qt*yt+te*Mt+qt*At,C[6]=Zt*rt+Qt*xt+te*Ct+qt*Yt,C[7]=Zt*lt+Qt*Et+te*Ot+qt*re,Zt=B[8],Qt=B[9],te=B[10],qt=B[11],C[8]=Zt*X+Qt*gt+te*St+qt*bt,C[9]=Zt*q+Qt*yt+te*Mt+qt*At,C[10]=Zt*rt+Qt*xt+te*Ct+qt*Yt,C[11]=Zt*lt+Qt*Et+te*Ot+qt*re,Zt=B[12],Qt=B[13],te=B[14],qt=B[15],C[12]=Zt*X+Qt*gt+te*St+qt*bt,C[13]=Zt*q+Qt*yt+te*Mt+qt*At,C[14]=Zt*rt+Qt*xt+te*Ct+qt*Yt,C[15]=Zt*lt+Qt*Et+te*Ot+qt*re,C}function w(C,D,B){var X=B[0],q=B[1],rt=B[2],lt,gt,yt,xt,Et,St,Mt,Ct,Ot,bt,At,Yt;return D===C?(C[12]=D[0]*X+D[4]*q+D[8]*rt+D[12],C[13]=D[1]*X+D[5]*q+D[9]*rt+D[13],C[14]=D[2]*X+D[6]*q+D[10]*rt+D[14],C[15]=D[3]*X+D[7]*q+D[11]*rt+D[15]):(lt=D[0],gt=D[1],yt=D[2],xt=D[3],Et=D[4],St=D[5],Mt=D[6],Ct=D[7],Ot=D[8],bt=D[9],At=D[10],Yt=D[11],C[0]=lt,C[1]=gt,C[2]=yt,C[3]=xt,C[4]=Et,C[5]=St,C[6]=Mt,C[7]=Ct,C[8]=Ot,C[9]=bt,C[10]=At,C[11]=Yt,C[12]=lt*X+Et*q+Ot*rt+D[12],C[13]=gt*X+St*q+bt*rt+D[13],C[14]=yt*X+Mt*q+At*rt+D[14],C[15]=xt*X+Ct*q+Yt*rt+D[15]),C}function y(C,D,B){var X=B[0],q=B[1],rt=B[2];return C[0]=D[0]*X,C[1]=D[1]*X,C[2]=D[2]*X,C[3]=D[3]*X,C[4]=D[4]*q,C[5]=D[5]*q,C[6]=D[6]*q,C[7]=D[7]*q,C[8]=D[8]*rt,C[9]=D[9]*rt,C[10]=D[10]*rt,C[11]=D[11]*rt,C[12]=D[12],C[13]=D[13],C[14]=D[14],C[15]=D[15],C}function T(C,D,B,X){var q=X[0],rt=X[1],lt=X[2],gt=Math.hypot(q,rt,lt),yt,xt,Et,St,Mt,Ct,Ot,bt,At,Yt,re,Zt,Qt,te,qt,Ee,Te,Se,xe,Ae,De,be,ue,hn;return gt<r.EPSILON?null:(gt=1/gt,q*=gt,rt*=gt,lt*=gt,yt=Math.sin(B),xt=Math.cos(B),Et=1-xt,St=D[0],Mt=D[1],Ct=D[2],Ot=D[3],bt=D[4],At=D[5],Yt=D[6],re=D[7],Zt=D[8],Qt=D[9],te=D[10],qt=D[11],Ee=q*q*Et+xt,Te=rt*q*Et+lt*yt,Se=lt*q*Et-rt*yt,xe=q*rt*Et-lt*yt,Ae=rt*rt*Et+xt,De=lt*rt*Et+q*yt,be=q*lt*Et+rt*yt,ue=rt*lt*Et-q*yt,hn=lt*lt*Et+xt,C[0]=St*Ee+bt*Te+Zt*Se,C[1]=Mt*Ee+At*Te+Qt*Se,C[2]=Ct*Ee+Yt*Te+te*Se,C[3]=Ot*Ee+re*Te+qt*Se,C[4]=St*xe+bt*Ae+Zt*De,C[5]=Mt*xe+At*Ae+Qt*De,C[6]=Ct*xe+Yt*Ae+te*De,C[7]=Ot*xe+re*Ae+qt*De,C[8]=St*be+bt*ue+Zt*hn,C[9]=Mt*be+At*ue+Qt*hn,C[10]=Ct*be+Yt*ue+te*hn,C[11]=Ot*be+re*ue+qt*hn,D!==C&&(C[12]=D[12],C[13]=D[13],C[14]=D[14],C[15]=D[15]),C)}function h(C,D,B){var X=Math.sin(B),q=Math.cos(B),rt=D[4],lt=D[5],gt=D[6],yt=D[7],xt=D[8],Et=D[9],St=D[10],Mt=D[11];return D!==C&&(C[0]=D[0],C[1]=D[1],C[2]=D[2],C[3]=D[3],C[12]=D[12],C[13]=D[13],C[14]=D[14],C[15]=D[15]),C[4]=rt*q+xt*X,C[5]=lt*q+Et*X,C[6]=gt*q+St*X,C[7]=yt*q+Mt*X,C[8]=xt*q-rt*X,C[9]=Et*q-lt*X,C[10]=St*q-gt*X,C[11]=Mt*q-yt*X,C}function m(C,D,B){var X=Math.sin(B),q=Math.cos(B),rt=D[0],lt=D[1],gt=D[2],yt=D[3],xt=D[8],Et=D[9],St=D[10],Mt=D[11];return D!==C&&(C[4]=D[4],C[5]=D[5],C[6]=D[6],C[7]=D[7],C[12]=D[12],C[13]=D[13],C[14]=D[14],C[15]=D[15]),C[0]=rt*q-xt*X,C[1]=lt*q-Et*X,C[2]=gt*q-St*X,C[3]=yt*q-Mt*X,C[8]=rt*X+xt*q,C[9]=lt*X+Et*q,C[10]=gt*X+St*q,C[11]=yt*X+Mt*q,C}function d(C,D,B){var X=Math.sin(B),q=Math.cos(B),rt=D[0],lt=D[1],gt=D[2],yt=D[3],xt=D[4],Et=D[5],St=D[6],Mt=D[7];return D!==C&&(C[8]=D[8],C[9]=D[9],C[10]=D[10],C[11]=D[11],C[12]=D[12],C[13]=D[13],C[14]=D[14],C[15]=D[15]),C[0]=rt*q+xt*X,C[1]=lt*q+Et*X,C[2]=gt*q+St*X,C[3]=yt*q+Mt*X,C[4]=xt*q-rt*X,C[5]=Et*q-lt*X,C[6]=St*q-gt*X,C[7]=Mt*q-yt*X,C}function M(C,D){return C[0]=1,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=1,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[10]=1,C[11]=0,C[12]=D[0],C[13]=D[1],C[14]=D[2],C[15]=1,C}function x(C,D){return C[0]=D[0],C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=D[1],C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[10]=D[2],C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C}function E(C,D,B){var X=B[0],q=B[1],rt=B[2],lt=Math.hypot(X,q,rt),gt,yt,xt;return lt<r.EPSILON?null:(lt=1/lt,X*=lt,q*=lt,rt*=lt,gt=Math.sin(D),yt=Math.cos(D),xt=1-yt,C[0]=X*X*xt+yt,C[1]=q*X*xt+rt*gt,C[2]=rt*X*xt-q*gt,C[3]=0,C[4]=X*q*xt-rt*gt,C[5]=q*q*xt+yt,C[6]=rt*q*xt+X*gt,C[7]=0,C[8]=X*rt*xt+q*gt,C[9]=q*rt*xt-X*gt,C[10]=rt*rt*xt+yt,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C)}function P(C,D){var B=Math.sin(D),X=Math.cos(D);return C[0]=1,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=X,C[6]=B,C[7]=0,C[8]=0,C[9]=-B,C[10]=X,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C}function R(C,D){var B=Math.sin(D),X=Math.cos(D);return C[0]=X,C[1]=0,C[2]=-B,C[3]=0,C[4]=0,C[5]=1,C[6]=0,C[7]=0,C[8]=B,C[9]=0,C[10]=X,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C}function N(C,D){var B=Math.sin(D),X=Math.cos(D);return C[0]=X,C[1]=B,C[2]=0,C[3]=0,C[4]=-B,C[5]=X,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[10]=1,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C}function b(C,D,B){var X=D[0],q=D[1],rt=D[2],lt=D[3],gt=X+X,yt=q+q,xt=rt+rt,Et=X*gt,St=X*yt,Mt=X*xt,Ct=q*yt,Ot=q*xt,bt=rt*xt,At=lt*gt,Yt=lt*yt,re=lt*xt;return C[0]=1-(Ct+bt),C[1]=St+re,C[2]=Mt-Yt,C[3]=0,C[4]=St-re,C[5]=1-(Et+bt),C[6]=Ot+At,C[7]=0,C[8]=Mt+Yt,C[9]=Ot-At,C[10]=1-(Et+Ct),C[11]=0,C[12]=B[0],C[13]=B[1],C[14]=B[2],C[15]=1,C}function j(C,D){var B=new r.ARRAY_TYPE(3),X=-D[0],q=-D[1],rt=-D[2],lt=D[3],gt=D[4],yt=D[5],xt=D[6],Et=D[7],St=X*X+q*q+rt*rt+lt*lt;return St>0?(B[0]=(gt*lt+Et*X+yt*rt-xt*q)*2/St,B[1]=(yt*lt+Et*q+xt*X-gt*rt)*2/St,B[2]=(xt*lt+Et*rt+gt*q-yt*X)*2/St):(B[0]=(gt*lt+Et*X+yt*rt-xt*q)*2,B[1]=(yt*lt+Et*q+xt*X-gt*rt)*2,B[2]=(xt*lt+Et*rt+gt*q-yt*X)*2),b(C,D,B),C}function O(C,D){return C[0]=D[12],C[1]=D[13],C[2]=D[14],C}function L(C,D){var B=D[0],X=D[1],q=D[2],rt=D[4],lt=D[5],gt=D[6],yt=D[8],xt=D[9],Et=D[10];return C[0]=Math.hypot(B,X,q),C[1]=Math.hypot(rt,lt,gt),C[2]=Math.hypot(yt,xt,Et),C}function k(C,D){var B=new r.ARRAY_TYPE(3);L(B,D);var X=1/B[0],q=1/B[1],rt=1/B[2],lt=D[0]*X,gt=D[1]*q,yt=D[2]*rt,xt=D[4]*X,Et=D[5]*q,St=D[6]*rt,Mt=D[8]*X,Ct=D[9]*q,Ot=D[10]*rt,bt=lt+Et+Ot,At=0;return bt>0?(At=Math.sqrt(bt+1)*2,C[3]=.25*At,C[0]=(St-Ct)/At,C[1]=(Mt-yt)/At,C[2]=(gt-xt)/At):lt>Et&&lt>Ot?(At=Math.sqrt(1+lt-Et-Ot)*2,C[3]=(St-Ct)/At,C[0]=.25*At,C[1]=(gt+xt)/At,C[2]=(Mt+yt)/At):Et>Ot?(At=Math.sqrt(1+Et-lt-Ot)*2,C[3]=(Mt-yt)/At,C[0]=(gt+xt)/At,C[1]=.25*At,C[2]=(St+Ct)/At):(At=Math.sqrt(1+Ot-lt-Et)*2,C[3]=(gt-xt)/At,C[0]=(Mt+yt)/At,C[1]=(St+Ct)/At,C[2]=.25*At),C}function H(C,D,B,X){var q=D[0],rt=D[1],lt=D[2],gt=D[3],yt=q+q,xt=rt+rt,Et=lt+lt,St=q*yt,Mt=q*xt,Ct=q*Et,Ot=rt*xt,bt=rt*Et,At=lt*Et,Yt=gt*yt,re=gt*xt,Zt=gt*Et,Qt=X[0],te=X[1],qt=X[2];return C[0]=(1-(Ot+At))*Qt,C[1]=(Mt+Zt)*Qt,C[2]=(Ct-re)*Qt,C[3]=0,C[4]=(Mt-Zt)*te,C[5]=(1-(St+At))*te,C[6]=(bt+Yt)*te,C[7]=0,C[8]=(Ct+re)*qt,C[9]=(bt-Yt)*qt,C[10]=(1-(St+Ot))*qt,C[11]=0,C[12]=B[0],C[13]=B[1],C[14]=B[2],C[15]=1,C}function Q(C,D,B,X,q){var rt=D[0],lt=D[1],gt=D[2],yt=D[3],xt=rt+rt,Et=lt+lt,St=gt+gt,Mt=rt*xt,Ct=rt*Et,Ot=rt*St,bt=lt*Et,At=lt*St,Yt=gt*St,re=yt*xt,Zt=yt*Et,Qt=yt*St,te=X[0],qt=X[1],Ee=X[2],Te=q[0],Se=q[1],xe=q[2],Ae=(1-(bt+Yt))*te,De=(Ct+Qt)*te,be=(Ot-Zt)*te,ue=(Ct-Qt)*qt,hn=(1-(Mt+Yt))*qt,Fr=(At+re)*qt,Vr=(Ot+Zt)*Ee,ss=(At-re)*Ee,as=(1-(Mt+bt))*Ee;return C[0]=Ae,C[1]=De,C[2]=be,C[3]=0,C[4]=ue,C[5]=hn,C[6]=Fr,C[7]=0,C[8]=Vr,C[9]=ss,C[10]=as,C[11]=0,C[12]=B[0]+Te-(Ae*Te+ue*Se+Vr*xe),C[13]=B[1]+Se-(De*Te+hn*Se+ss*xe),C[14]=B[2]+xe-(be*Te+Fr*Se+as*xe),C[15]=1,C}function _(C,D){var B=D[0],X=D[1],q=D[2],rt=D[3],lt=B+B,gt=X+X,yt=q+q,xt=B*lt,Et=X*lt,St=X*gt,Mt=q*lt,Ct=q*gt,Ot=q*yt,bt=rt*lt,At=rt*gt,Yt=rt*yt;return C[0]=1-St-Ot,C[1]=Et+Yt,C[2]=Mt-At,C[3]=0,C[4]=Et-Yt,C[5]=1-xt-Ot,C[6]=Ct+bt,C[7]=0,C[8]=Mt+At,C[9]=Ct-bt,C[10]=1-xt-St,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C}function st(C,D,B,X,q,rt,lt){var gt=1/(B-D),yt=1/(q-X),xt=1/(rt-lt);return C[0]=rt*2*gt,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=rt*2*yt,C[6]=0,C[7]=0,C[8]=(B+D)*gt,C[9]=(q+X)*yt,C[10]=(lt+rt)*xt,C[11]=-1,C[12]=0,C[13]=0,C[14]=lt*rt*2*xt,C[15]=0,C}function F(C,D,B,X,q){var rt=1/Math.tan(D/2),lt;return C[0]=rt/B,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=rt,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[11]=-1,C[12]=0,C[13]=0,C[15]=0,q!=null&&q!==1/0?(lt=1/(X-q),C[10]=(q+X)*lt,C[14]=2*q*X*lt):(C[10]=-1,C[14]=-2*X),C}function Z(C,D,B,X){var q=Math.tan(D.upDegrees*Math.PI/180),rt=Math.tan(D.downDegrees*Math.PI/180),lt=Math.tan(D.leftDegrees*Math.PI/180),gt=Math.tan(D.rightDegrees*Math.PI/180),yt=2/(lt+gt),xt=2/(q+rt);return C[0]=yt,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=xt,C[6]=0,C[7]=0,C[8]=-((lt-gt)*yt*.5),C[9]=(q-rt)*xt*.5,C[10]=X/(B-X),C[11]=-1,C[12]=0,C[13]=0,C[14]=X*B/(B-X),C[15]=0,C}function tt(C,D,B,X,q,rt,lt){var gt=1/(D-B),yt=1/(X-q),xt=1/(rt-lt);return C[0]=-2*gt,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=-2*yt,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[10]=2*xt,C[11]=0,C[12]=(D+B)*gt,C[13]=(q+X)*yt,C[14]=(lt+rt)*xt,C[15]=1,C}function ct(C,D,B,X){var q,rt,lt,gt,yt,xt,Et,St,Mt,Ct,Ot=D[0],bt=D[1],At=D[2],Yt=X[0],re=X[1],Zt=X[2],Qt=B[0],te=B[1],qt=B[2];return Math.abs(Ot-Qt)<r.EPSILON&&Math.abs(bt-te)<r.EPSILON&&Math.abs(At-qt)<r.EPSILON?u(C):(Et=Ot-Qt,St=bt-te,Mt=At-qt,Ct=1/Math.hypot(Et,St,Mt),Et*=Ct,St*=Ct,Mt*=Ct,q=re*Mt-Zt*St,rt=Zt*Et-Yt*Mt,lt=Yt*St-re*Et,Ct=Math.hypot(q,rt,lt),Ct?(Ct=1/Ct,q*=Ct,rt*=Ct,lt*=Ct):(q=0,rt=0,lt=0),gt=St*lt-Mt*rt,yt=Mt*q-Et*lt,xt=Et*rt-St*q,Ct=Math.hypot(gt,yt,xt),Ct?(Ct=1/Ct,gt*=Ct,yt*=Ct,xt*=Ct):(gt=0,yt=0,xt=0),C[0]=q,C[1]=gt,C[2]=Et,C[3]=0,C[4]=rt,C[5]=yt,C[6]=St,C[7]=0,C[8]=lt,C[9]=xt,C[10]=Mt,C[11]=0,C[12]=-(q*Ot+rt*bt+lt*At),C[13]=-(gt*Ot+yt*bt+xt*At),C[14]=-(Et*Ot+St*bt+Mt*At),C[15]=1,C)}function at(C,D,B,X){var q=D[0],rt=D[1],lt=D[2],gt=X[0],yt=X[1],xt=X[2],Et=q-B[0],St=rt-B[1],Mt=lt-B[2],Ct=Et*Et+St*St+Mt*Mt;Ct>0&&(Ct=1/Math.sqrt(Ct),Et*=Ct,St*=Ct,Mt*=Ct);var Ot=yt*Mt-xt*St,bt=xt*Et-gt*Mt,At=gt*St-yt*Et;return Ct=Ot*Ot+bt*bt+At*At,Ct>0&&(Ct=1/Math.sqrt(Ct),Ot*=Ct,bt*=Ct,At*=Ct),C[0]=Ot,C[1]=bt,C[2]=At,C[3]=0,C[4]=St*At-Mt*bt,C[5]=Mt*Ot-Et*At,C[6]=Et*bt-St*Ot,C[7]=0,C[8]=Et,C[9]=St,C[10]=Mt,C[11]=0,C[12]=q,C[13]=rt,C[14]=lt,C[15]=1,C}function dt(C){return"mat4("+C[0]+", "+C[1]+", "+C[2]+", "+C[3]+", "+C[4]+", "+C[5]+", "+C[6]+", "+C[7]+", "+C[8]+", "+C[9]+", "+C[10]+", "+C[11]+", "+C[12]+", "+C[13]+", "+C[14]+", "+C[15]+")"}function it(C){return Math.hypot(C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15])}function ft(C,D,B){return C[0]=D[0]+B[0],C[1]=D[1]+B[1],C[2]=D[2]+B[2],C[3]=D[3]+B[3],C[4]=D[4]+B[4],C[5]=D[5]+B[5],C[6]=D[6]+B[6],C[7]=D[7]+B[7],C[8]=D[8]+B[8],C[9]=D[9]+B[9],C[10]=D[10]+B[10],C[11]=D[11]+B[11],C[12]=D[12]+B[12],C[13]=D[13]+B[13],C[14]=D[14]+B[14],C[15]=D[15]+B[15],C}function wt(C,D,B){return C[0]=D[0]-B[0],C[1]=D[1]-B[1],C[2]=D[2]-B[2],C[3]=D[3]-B[3],C[4]=D[4]-B[4],C[5]=D[5]-B[5],C[6]=D[6]-B[6],C[7]=D[7]-B[7],C[8]=D[8]-B[8],C[9]=D[9]-B[9],C[10]=D[10]-B[10],C[11]=D[11]-B[11],C[12]=D[12]-B[12],C[13]=D[13]-B[13],C[14]=D[14]-B[14],C[15]=D[15]-B[15],C}function U(C,D,B){return C[0]=D[0]*B,C[1]=D[1]*B,C[2]=D[2]*B,C[3]=D[3]*B,C[4]=D[4]*B,C[5]=D[5]*B,C[6]=D[6]*B,C[7]=D[7]*B,C[8]=D[8]*B,C[9]=D[9]*B,C[10]=D[10]*B,C[11]=D[11]*B,C[12]=D[12]*B,C[13]=D[13]*B,C[14]=D[14]*B,C[15]=D[15]*B,C}function Y(C,D,B,X){return C[0]=D[0]+B[0]*X,C[1]=D[1]+B[1]*X,C[2]=D[2]+B[2]*X,C[3]=D[3]+B[3]*X,C[4]=D[4]+B[4]*X,C[5]=D[5]+B[5]*X,C[6]=D[6]+B[6]*X,C[7]=D[7]+B[7]*X,C[8]=D[8]+B[8]*X,C[9]=D[9]+B[9]*X,C[10]=D[10]+B[10]*X,C[11]=D[11]+B[11]*X,C[12]=D[12]+B[12]*X,C[13]=D[13]+B[13]*X,C[14]=D[14]+B[14]*X,C[15]=D[15]+B[15]*X,C}function K(C,D){return C[0]===D[0]&&C[1]===D[1]&&C[2]===D[2]&&C[3]===D[3]&&C[4]===D[4]&&C[5]===D[5]&&C[6]===D[6]&&C[7]===D[7]&&C[8]===D[8]&&C[9]===D[9]&&C[10]===D[10]&&C[11]===D[11]&&C[12]===D[12]&&C[13]===D[13]&&C[14]===D[14]&&C[15]===D[15]}function et(C,D){var B=C[0],X=C[1],q=C[2],rt=C[3],lt=C[4],gt=C[5],yt=C[6],xt=C[7],Et=C[8],St=C[9],Mt=C[10],Ct=C[11],Ot=C[12],bt=C[13],At=C[14],Yt=C[15],re=D[0],Zt=D[1],Qt=D[2],te=D[3],qt=D[4],Ee=D[5],Te=D[6],Se=D[7],xe=D[8],Ae=D[9],De=D[10],be=D[11],ue=D[12],hn=D[13],Fr=D[14],Vr=D[15];return Math.abs(B-re)<=r.EPSILON*Math.max(1,Math.abs(B),Math.abs(re))&&Math.abs(X-Zt)<=r.EPSILON*Math.max(1,Math.abs(X),Math.abs(Zt))&&Math.abs(q-Qt)<=r.EPSILON*Math.max(1,Math.abs(q),Math.abs(Qt))&&Math.abs(rt-te)<=r.EPSILON*Math.max(1,Math.abs(rt),Math.abs(te))&&Math.abs(lt-qt)<=r.EPSILON*Math.max(1,Math.abs(lt),Math.abs(qt))&&Math.abs(gt-Ee)<=r.EPSILON*Math.max(1,Math.abs(gt),Math.abs(Ee))&&Math.abs(yt-Te)<=r.EPSILON*Math.max(1,Math.abs(yt),Math.abs(Te))&&Math.abs(xt-Se)<=r.EPSILON*Math.max(1,Math.abs(xt),Math.abs(Se))&&Math.abs(Et-xe)<=r.EPSILON*Math.max(1,Math.abs(Et),Math.abs(xe))&&Math.abs(St-Ae)<=r.EPSILON*Math.max(1,Math.abs(St),Math.abs(Ae))&&Math.abs(Mt-De)<=r.EPSILON*Math.max(1,Math.abs(Mt),Math.abs(De))&&Math.abs(Ct-be)<=r.EPSILON*Math.max(1,Math.abs(Ct),Math.abs(be))&&Math.abs(Ot-ue)<=r.EPSILON*Math.max(1,Math.abs(Ot),Math.abs(ue))&&Math.abs(bt-hn)<=r.EPSILON*Math.max(1,Math.abs(bt),Math.abs(hn))&&Math.abs(At-Fr)<=r.EPSILON*Math.max(1,Math.abs(At),Math.abs(Fr))&&Math.abs(Yt-Vr)<=r.EPSILON*Math.max(1,Math.abs(Yt),Math.abs(Vr))}var W=I,$=wt},function(n,t,e){e.r(t),e.d(t,"create",function(){return a}),e.d(t,"identity",function(){return l}),e.d(t,"setAxisAngle",function(){return u}),e.d(t,"getAxisAngle",function(){return p}),e.d(t,"getAngle",function(){return c}),e.d(t,"multiply",function(){return g}),e.d(t,"rotateX",function(){return v}),e.d(t,"rotateY",function(){return I}),e.d(t,"rotateZ",function(){return w}),e.d(t,"calculateW",function(){return y}),e.d(t,"exp",function(){return T}),e.d(t,"ln",function(){return h}),e.d(t,"pow",function(){return m}),e.d(t,"slerp",function(){return d}),e.d(t,"random",function(){return M}),e.d(t,"invert",function(){return x}),e.d(t,"conjugate",function(){return E}),e.d(t,"fromMat3",function(){return P}),e.d(t,"fromEuler",function(){return R}),e.d(t,"str",function(){return N}),e.d(t,"clone",function(){return b}),e.d(t,"fromValues",function(){return j}),e.d(t,"copy",function(){return O}),e.d(t,"set",function(){return L}),e.d(t,"add",function(){return k}),e.d(t,"mul",function(){return H}),e.d(t,"scale",function(){return Q}),e.d(t,"dot",function(){return _}),e.d(t,"lerp",function(){return st}),e.d(t,"length",function(){return F}),e.d(t,"len",function(){return Z}),e.d(t,"squaredLength",function(){return tt}),e.d(t,"sqrLen",function(){return ct}),e.d(t,"normalize",function(){return at}),e.d(t,"exactEquals",function(){return dt}),e.d(t,"equals",function(){return it}),e.d(t,"rotationTo",function(){return ft}),e.d(t,"sqlerp",function(){return wt}),e.d(t,"setAxes",function(){return U});var r=e(2),i=e(5),o=e(8),s=e(9);function a(){var Y=new r.ARRAY_TYPE(4);return r.ARRAY_TYPE!=Float32Array&&(Y[0]=0,Y[1]=0,Y[2]=0),Y[3]=1,Y}function l(Y){return Y[0]=0,Y[1]=0,Y[2]=0,Y[3]=1,Y}function u(Y,K,et){et=et*.5;var W=Math.sin(et);return Y[0]=W*K[0],Y[1]=W*K[1],Y[2]=W*K[2],Y[3]=Math.cos(et),Y}function p(Y,K){var et=Math.acos(K[3])*2,W=Math.sin(et/2);return W>r.EPSILON?(Y[0]=K[0]/W,Y[1]=K[1]/W,Y[2]=K[2]/W):(Y[0]=1,Y[1]=0,Y[2]=0),et}function c(Y,K){var et=_(Y,K);return Math.acos(2*et*et-1)}function g(Y,K,et){var W=K[0],$=K[1],C=K[2],D=K[3],B=et[0],X=et[1],q=et[2],rt=et[3];return Y[0]=W*rt+D*B+$*q-C*X,Y[1]=$*rt+D*X+C*B-W*q,Y[2]=C*rt+D*q+W*X-$*B,Y[3]=D*rt-W*B-$*X-C*q,Y}function v(Y,K,et){et*=.5;var W=K[0],$=K[1],C=K[2],D=K[3],B=Math.sin(et),X=Math.cos(et);return Y[0]=W*X+D*B,Y[1]=$*X+C*B,Y[2]=C*X-$*B,Y[3]=D*X-W*B,Y}function I(Y,K,et){et*=.5;var W=K[0],$=K[1],C=K[2],D=K[3],B=Math.sin(et),X=Math.cos(et);return Y[0]=W*X-C*B,Y[1]=$*X+D*B,Y[2]=C*X+W*B,Y[3]=D*X-$*B,Y}function w(Y,K,et){et*=.5;var W=K[0],$=K[1],C=K[2],D=K[3],B=Math.sin(et),X=Math.cos(et);return Y[0]=W*X+$*B,Y[1]=$*X-W*B,Y[2]=C*X+D*B,Y[3]=D*X-C*B,Y}function y(Y,K){var et=K[0],W=K[1],$=K[2];return Y[0]=et,Y[1]=W,Y[2]=$,Y[3]=Math.sqrt(Math.abs(1-et*et-W*W-$*$)),Y}function T(Y,K){var et=K[0],W=K[1],$=K[2],C=K[3],D=Math.sqrt(et*et+W*W+$*$),B=Math.exp(C),X=D>0?B*Math.sin(D)/D:0;return Y[0]=et*X,Y[1]=W*X,Y[2]=$*X,Y[3]=B*Math.cos(D),Y}function h(Y,K){var et=K[0],W=K[1],$=K[2],C=K[3],D=Math.sqrt(et*et+W*W+$*$),B=D>0?Math.atan2(D,C)/D:0;return Y[0]=et*B,Y[1]=W*B,Y[2]=$*B,Y[3]=.5*Math.log(et*et+W*W+$*$+C*C),Y}function m(Y,K,et){return h(Y,K),Q(Y,Y,et),T(Y,Y),Y}function d(Y,K,et,W){var $=K[0],C=K[1],D=K[2],B=K[3],X=et[0],q=et[1],rt=et[2],lt=et[3],gt,yt,xt,Et,St;return yt=$*X+C*q+D*rt+B*lt,yt<0&&(yt=-yt,X=-X,q=-q,rt=-rt,lt=-lt),1-yt>r.EPSILON?(gt=Math.acos(yt),xt=Math.sin(gt),Et=Math.sin((1-W)*gt)/xt,St=Math.sin(W*gt)/xt):(Et=1-W,St=W),Y[0]=Et*$+St*X,Y[1]=Et*C+St*q,Y[2]=Et*D+St*rt,Y[3]=Et*B+St*lt,Y}function M(Y){var K=r.RANDOM(),et=r.RANDOM(),W=r.RANDOM(),$=Math.sqrt(1-K),C=Math.sqrt(K);return Y[0]=$*Math.sin(2*Math.PI*et),Y[1]=$*Math.cos(2*Math.PI*et),Y[2]=C*Math.sin(2*Math.PI*W),Y[3]=C*Math.cos(2*Math.PI*W),Y}function x(Y,K){var et=K[0],W=K[1],$=K[2],C=K[3],D=et*et+W*W+$*$+C*C,B=D?1/D:0;return Y[0]=-et*B,Y[1]=-W*B,Y[2]=-$*B,Y[3]=C*B,Y}function E(Y,K){return Y[0]=-K[0],Y[1]=-K[1],Y[2]=-K[2],Y[3]=K[3],Y}function P(Y,K){var et=K[0]+K[4]+K[8],W;if(et>0)W=Math.sqrt(et+1),Y[3]=.5*W,W=.5/W,Y[0]=(K[5]-K[7])*W,Y[1]=(K[6]-K[2])*W,Y[2]=(K[1]-K[3])*W;else{var $=0;K[4]>K[0]&&($=1),K[8]>K[$*3+$]&&($=2);var C=($+1)%3,D=($+2)%3;W=Math.sqrt(K[$*3+$]-K[C*3+C]-K[D*3+D]+1),Y[$]=.5*W,W=.5/W,Y[3]=(K[C*3+D]-K[D*3+C])*W,Y[C]=(K[C*3+$]+K[$*3+C])*W,Y[D]=(K[D*3+$]+K[$*3+D])*W}return Y}function R(Y,K,et,W){var $=.5*Math.PI/180;K*=$,et*=$,W*=$;var C=Math.sin(K),D=Math.cos(K),B=Math.sin(et),X=Math.cos(et),q=Math.sin(W),rt=Math.cos(W);return Y[0]=C*X*rt-D*B*q,Y[1]=D*B*rt+C*X*q,Y[2]=D*X*q-C*B*rt,Y[3]=D*X*rt+C*B*q,Y}function N(Y){return"quat("+Y[0]+", "+Y[1]+", "+Y[2]+", "+Y[3]+")"}var b=s.clone,j=s.fromValues,O=s.copy,L=s.set,k=s.add,H=g,Q=s.scale,_=s.dot,st=s.lerp,F=s.length,Z=F,tt=s.squaredLength,ct=tt,at=s.normalize,dt=s.exactEquals,it=s.equals,ft=function(){var Y=o.create(),K=o.fromValues(1,0,0),et=o.fromValues(0,1,0);return function(W,$,C){var D=o.dot($,C);return D<-.999999?(o.cross(Y,K,$),o.len(Y)<1e-6&&o.cross(Y,et,$),o.normalize(Y,Y),u(W,Y,Math.PI),W):D>.999999?(W[0]=0,W[1]=0,W[2]=0,W[3]=1,W):(o.cross(Y,$,C),W[0]=Y[0],W[1]=Y[1],W[2]=Y[2],W[3]=1+D,at(W,W))}}(),wt=function(){var Y=a(),K=a();return function(et,W,$,C,D,B){return d(Y,W,D,B),d(K,$,C,B),d(et,Y,K,2*B*(1-B)),et}}(),U=function(){var Y=i.create();return function(K,et,W,$){return Y[0]=W[0],Y[3]=W[1],Y[6]=W[2],Y[1]=$[0],Y[4]=$[1],Y[7]=$[2],Y[2]=-et[0],Y[5]=-et[1],Y[8]=-et[2],at(K,P(K,Y))}}()},function(n,t,e){e.r(t),e.d(t,"create",function(){return i}),e.d(t,"clone",function(){return o}),e.d(t,"length",function(){return s}),e.d(t,"fromValues",function(){return a}),e.d(t,"copy",function(){return l}),e.d(t,"set",function(){return u}),e.d(t,"add",function(){return p}),e.d(t,"subtract",function(){return c}),e.d(t,"multiply",function(){return g}),e.d(t,"divide",function(){return v}),e.d(t,"ceil",function(){return I}),e.d(t,"floor",function(){return w}),e.d(t,"min",function(){return y}),e.d(t,"max",function(){return T}),e.d(t,"round",function(){return h}),e.d(t,"scale",function(){return m}),e.d(t,"scaleAndAdd",function(){return d}),e.d(t,"distance",function(){return M}),e.d(t,"squaredDistance",function(){return x}),e.d(t,"squaredLength",function(){return E}),e.d(t,"negate",function(){return P}),e.d(t,"inverse",function(){return R}),e.d(t,"normalize",function(){return N}),e.d(t,"dot",function(){return b}),e.d(t,"cross",function(){return j}),e.d(t,"lerp",function(){return O}),e.d(t,"hermite",function(){return L}),e.d(t,"bezier",function(){return k}),e.d(t,"random",function(){return H}),e.d(t,"transformMat4",function(){return Q}),e.d(t,"transformMat3",function(){return _}),e.d(t,"transformQuat",function(){return st}),e.d(t,"rotateX",function(){return F}),e.d(t,"rotateY",function(){return Z}),e.d(t,"rotateZ",function(){return tt}),e.d(t,"angle",function(){return ct}),e.d(t,"zero",function(){return at}),e.d(t,"str",function(){return dt}),e.d(t,"exactEquals",function(){return it}),e.d(t,"equals",function(){return ft}),e.d(t,"sub",function(){return wt}),e.d(t,"mul",function(){return U}),e.d(t,"div",function(){return Y}),e.d(t,"dist",function(){return K}),e.d(t,"sqrDist",function(){return et}),e.d(t,"len",function(){return W}),e.d(t,"sqrLen",function(){return $}),e.d(t,"forEach",function(){return C});var r=e(2);function i(){var D=new r.ARRAY_TYPE(3);return r.ARRAY_TYPE!=Float32Array&&(D[0]=0,D[1]=0,D[2]=0),D}function o(D){var B=new r.ARRAY_TYPE(3);return B[0]=D[0],B[1]=D[1],B[2]=D[2],B}function s(D){var B=D[0],X=D[1],q=D[2];return Math.hypot(B,X,q)}function a(D,B,X){var q=new r.ARRAY_TYPE(3);return q[0]=D,q[1]=B,q[2]=X,q}function l(D,B){return D[0]=B[0],D[1]=B[1],D[2]=B[2],D}function u(D,B,X,q){return D[0]=B,D[1]=X,D[2]=q,D}function p(D,B,X){return D[0]=B[0]+X[0],D[1]=B[1]+X[1],D[2]=B[2]+X[2],D}function c(D,B,X){return D[0]=B[0]-X[0],D[1]=B[1]-X[1],D[2]=B[2]-X[2],D}function g(D,B,X){return D[0]=B[0]*X[0],D[1]=B[1]*X[1],D[2]=B[2]*X[2],D}function v(D,B,X){return D[0]=B[0]/X[0],D[1]=B[1]/X[1],D[2]=B[2]/X[2],D}function I(D,B){return D[0]=Math.ceil(B[0]),D[1]=Math.ceil(B[1]),D[2]=Math.ceil(B[2]),D}function w(D,B){return D[0]=Math.floor(B[0]),D[1]=Math.floor(B[1]),D[2]=Math.floor(B[2]),D}function y(D,B,X){return D[0]=Math.min(B[0],X[0]),D[1]=Math.min(B[1],X[1]),D[2]=Math.min(B[2],X[2]),D}function T(D,B,X){return D[0]=Math.max(B[0],X[0]),D[1]=Math.max(B[1],X[1]),D[2]=Math.max(B[2],X[2]),D}function h(D,B){return D[0]=Math.round(B[0]),D[1]=Math.round(B[1]),D[2]=Math.round(B[2]),D}function m(D,B,X){return D[0]=B[0]*X,D[1]=B[1]*X,D[2]=B[2]*X,D}function d(D,B,X,q){return D[0]=B[0]+X[0]*q,D[1]=B[1]+X[1]*q,D[2]=B[2]+X[2]*q,D}function M(D,B){var X=B[0]-D[0],q=B[1]-D[1],rt=B[2]-D[2];return Math.hypot(X,q,rt)}function x(D,B){var X=B[0]-D[0],q=B[1]-D[1],rt=B[2]-D[2];return X*X+q*q+rt*rt}function E(D){var B=D[0],X=D[1],q=D[2];return B*B+X*X+q*q}function P(D,B){return D[0]=-B[0],D[1]=-B[1],D[2]=-B[2],D}function R(D,B){return D[0]=1/B[0],D[1]=1/B[1],D[2]=1/B[2],D}function N(D,B){var X=B[0],q=B[1],rt=B[2],lt=X*X+q*q+rt*rt;return lt>0&&(lt=1/Math.sqrt(lt)),D[0]=B[0]*lt,D[1]=B[1]*lt,D[2]=B[2]*lt,D}function b(D,B){return D[0]*B[0]+D[1]*B[1]+D[2]*B[2]}function j(D,B,X){var q=B[0],rt=B[1],lt=B[2],gt=X[0],yt=X[1],xt=X[2];return D[0]=rt*xt-lt*yt,D[1]=lt*gt-q*xt,D[2]=q*yt-rt*gt,D}function O(D,B,X,q){var rt=B[0],lt=B[1],gt=B[2];return D[0]=rt+q*(X[0]-rt),D[1]=lt+q*(X[1]-lt),D[2]=gt+q*(X[2]-gt),D}function L(D,B,X,q,rt,lt){var gt=lt*lt,yt=gt*(2*lt-3)+1,xt=gt*(lt-2)+lt,Et=gt*(lt-1),St=gt*(3-2*lt);return D[0]=B[0]*yt+X[0]*xt+q[0]*Et+rt[0]*St,D[1]=B[1]*yt+X[1]*xt+q[1]*Et+rt[1]*St,D[2]=B[2]*yt+X[2]*xt+q[2]*Et+rt[2]*St,D}function k(D,B,X,q,rt,lt){var gt=1-lt,yt=gt*gt,xt=lt*lt,Et=yt*gt,St=3*lt*yt,Mt=3*xt*gt,Ct=xt*lt;return D[0]=B[0]*Et+X[0]*St+q[0]*Mt+rt[0]*Ct,D[1]=B[1]*Et+X[1]*St+q[1]*Mt+rt[1]*Ct,D[2]=B[2]*Et+X[2]*St+q[2]*Mt+rt[2]*Ct,D}function H(D,B){B=B||1;var X=r.RANDOM()*2*Math.PI,q=r.RANDOM()*2-1,rt=Math.sqrt(1-q*q)*B;return D[0]=Math.cos(X)*rt,D[1]=Math.sin(X)*rt,D[2]=q*B,D}function Q(D,B,X){var q=B[0],rt=B[1],lt=B[2],gt=X[3]*q+X[7]*rt+X[11]*lt+X[15];return gt=gt||1,D[0]=(X[0]*q+X[4]*rt+X[8]*lt+X[12])/gt,D[1]=(X[1]*q+X[5]*rt+X[9]*lt+X[13])/gt,D[2]=(X[2]*q+X[6]*rt+X[10]*lt+X[14])/gt,D}function _(D,B,X){var q=B[0],rt=B[1],lt=B[2];return D[0]=q*X[0]+rt*X[3]+lt*X[6],D[1]=q*X[1]+rt*X[4]+lt*X[7],D[2]=q*X[2]+rt*X[5]+lt*X[8],D}function st(D,B,X){var q=X[0],rt=X[1],lt=X[2],gt=X[3],yt=B[0],xt=B[1],Et=B[2],St=rt*Et-lt*xt,Mt=lt*yt-q*Et,Ct=q*xt-rt*yt,Ot=rt*Ct-lt*Mt,bt=lt*St-q*Ct,At=q*Mt-rt*St,Yt=gt*2;return St*=Yt,Mt*=Yt,Ct*=Yt,Ot*=2,bt*=2,At*=2,D[0]=yt+St+Ot,D[1]=xt+Mt+bt,D[2]=Et+Ct+At,D}function F(D,B,X,q){var rt=[],lt=[];return rt[0]=B[0]-X[0],rt[1]=B[1]-X[1],rt[2]=B[2]-X[2],lt[0]=rt[0],lt[1]=rt[1]*Math.cos(q)-rt[2]*Math.sin(q),lt[2]=rt[1]*Math.sin(q)+rt[2]*Math.cos(q),D[0]=lt[0]+X[0],D[1]=lt[1]+X[1],D[2]=lt[2]+X[2],D}function Z(D,B,X,q){var rt=[],lt=[];return rt[0]=B[0]-X[0],rt[1]=B[1]-X[1],rt[2]=B[2]-X[2],lt[0]=rt[2]*Math.sin(q)+rt[0]*Math.cos(q),lt[1]=rt[1],lt[2]=rt[2]*Math.cos(q)-rt[0]*Math.sin(q),D[0]=lt[0]+X[0],D[1]=lt[1]+X[1],D[2]=lt[2]+X[2],D}function tt(D,B,X,q){var rt=[],lt=[];return rt[0]=B[0]-X[0],rt[1]=B[1]-X[1],rt[2]=B[2]-X[2],lt[0]=rt[0]*Math.cos(q)-rt[1]*Math.sin(q),lt[1]=rt[0]*Math.sin(q)+rt[1]*Math.cos(q),lt[2]=rt[2],D[0]=lt[0]+X[0],D[1]=lt[1]+X[1],D[2]=lt[2]+X[2],D}function ct(D,B){var X=D[0],q=D[1],rt=D[2],lt=B[0],gt=B[1],yt=B[2],xt=Math.sqrt(X*X+q*q+rt*rt),Et=Math.sqrt(lt*lt+gt*gt+yt*yt),St=xt*Et,Mt=St&&b(D,B)/St;return Math.acos(Math.min(Math.max(Mt,-1),1))}function at(D){return D[0]=0,D[1]=0,D[2]=0,D}function dt(D){return"vec3("+D[0]+", "+D[1]+", "+D[2]+")"}function it(D,B){return D[0]===B[0]&&D[1]===B[1]&&D[2]===B[2]}function ft(D,B){var X=D[0],q=D[1],rt=D[2],lt=B[0],gt=B[1],yt=B[2];return Math.abs(X-lt)<=r.EPSILON*Math.max(1,Math.abs(X),Math.abs(lt))&&Math.abs(q-gt)<=r.EPSILON*Math.max(1,Math.abs(q),Math.abs(gt))&&Math.abs(rt-yt)<=r.EPSILON*Math.max(1,Math.abs(rt),Math.abs(yt))}var wt=c,U=g,Y=v,K=M,et=x,W=s,$=E,C=function(){var D=i();return function(B,X,q,rt,lt,gt){var yt,xt;for(X||(X=3),q||(q=0),rt?xt=Math.min(rt*X+q,B.length):xt=B.length,yt=q;yt<xt;yt+=X)D[0]=B[yt],D[1]=B[yt+1],D[2]=B[yt+2],lt(D,D,gt),B[yt]=D[0],B[yt+1]=D[1],B[yt+2]=D[2];return B}}()},function(n,t,e){e.r(t),e.d(t,"create",function(){return i}),e.d(t,"clone",function(){return o}),e.d(t,"fromValues",function(){return s}),e.d(t,"copy",function(){return a}),e.d(t,"set",function(){return l}),e.d(t,"add",function(){return u}),e.d(t,"subtract",function(){return p}),e.d(t,"multiply",function(){return c}),e.d(t,"divide",function(){return g}),e.d(t,"ceil",function(){return v}),e.d(t,"floor",function(){return I}),e.d(t,"min",function(){return w}),e.d(t,"max",function(){return y}),e.d(t,"round",function(){return T}),e.d(t,"scale",function(){return h}),e.d(t,"scaleAndAdd",function(){return m}),e.d(t,"distance",function(){return d}),e.d(t,"squaredDistance",function(){return M}),e.d(t,"length",function(){return x}),e.d(t,"squaredLength",function(){return E}),e.d(t,"negate",function(){return P}),e.d(t,"inverse",function(){return R}),e.d(t,"normalize",function(){return N}),e.d(t,"dot",function(){return b}),e.d(t,"cross",function(){return j}),e.d(t,"lerp",function(){return O}),e.d(t,"random",function(){return L}),e.d(t,"transformMat4",function(){return k}),e.d(t,"transformQuat",function(){return H}),e.d(t,"zero",function(){return Q}),e.d(t,"str",function(){return _}),e.d(t,"exactEquals",function(){return st}),e.d(t,"equals",function(){return F}),e.d(t,"sub",function(){return Z}),e.d(t,"mul",function(){return tt}),e.d(t,"div",function(){return ct}),e.d(t,"dist",function(){return at}),e.d(t,"sqrDist",function(){return dt}),e.d(t,"len",function(){return it}),e.d(t,"sqrLen",function(){return ft}),e.d(t,"forEach",function(){return wt});var r=e(2);function i(){var U=new r.ARRAY_TYPE(4);return r.ARRAY_TYPE!=Float32Array&&(U[0]=0,U[1]=0,U[2]=0,U[3]=0),U}function o(U){var Y=new r.ARRAY_TYPE(4);return Y[0]=U[0],Y[1]=U[1],Y[2]=U[2],Y[3]=U[3],Y}function s(U,Y,K,et){var W=new r.ARRAY_TYPE(4);return W[0]=U,W[1]=Y,W[2]=K,W[3]=et,W}function a(U,Y){return U[0]=Y[0],U[1]=Y[1],U[2]=Y[2],U[3]=Y[3],U}function l(U,Y,K,et,W){return U[0]=Y,U[1]=K,U[2]=et,U[3]=W,U}function u(U,Y,K){return U[0]=Y[0]+K[0],U[1]=Y[1]+K[1],U[2]=Y[2]+K[2],U[3]=Y[3]+K[3],U}function p(U,Y,K){return U[0]=Y[0]-K[0],U[1]=Y[1]-K[1],U[2]=Y[2]-K[2],U[3]=Y[3]-K[3],U}function c(U,Y,K){return U[0]=Y[0]*K[0],U[1]=Y[1]*K[1],U[2]=Y[2]*K[2],U[3]=Y[3]*K[3],U}function g(U,Y,K){return U[0]=Y[0]/K[0],U[1]=Y[1]/K[1],U[2]=Y[2]/K[2],U[3]=Y[3]/K[3],U}function v(U,Y){return U[0]=Math.ceil(Y[0]),U[1]=Math.ceil(Y[1]),U[2]=Math.ceil(Y[2]),U[3]=Math.ceil(Y[3]),U}function I(U,Y){return U[0]=Math.floor(Y[0]),U[1]=Math.floor(Y[1]),U[2]=Math.floor(Y[2]),U[3]=Math.floor(Y[3]),U}function w(U,Y,K){return U[0]=Math.min(Y[0],K[0]),U[1]=Math.min(Y[1],K[1]),U[2]=Math.min(Y[2],K[2]),U[3]=Math.min(Y[3],K[3]),U}function y(U,Y,K){return U[0]=Math.max(Y[0],K[0]),U[1]=Math.max(Y[1],K[1]),U[2]=Math.max(Y[2],K[2]),U[3]=Math.max(Y[3],K[3]),U}function T(U,Y){return U[0]=Math.round(Y[0]),U[1]=Math.round(Y[1]),U[2]=Math.round(Y[2]),U[3]=Math.round(Y[3]),U}function h(U,Y,K){return U[0]=Y[0]*K,U[1]=Y[1]*K,U[2]=Y[2]*K,U[3]=Y[3]*K,U}function m(U,Y,K,et){return U[0]=Y[0]+K[0]*et,U[1]=Y[1]+K[1]*et,U[2]=Y[2]+K[2]*et,U[3]=Y[3]+K[3]*et,U}function d(U,Y){var K=Y[0]-U[0],et=Y[1]-U[1],W=Y[2]-U[2],$=Y[3]-U[3];return Math.hypot(K,et,W,$)}function M(U,Y){var K=Y[0]-U[0],et=Y[1]-U[1],W=Y[2]-U[2],$=Y[3]-U[3];return K*K+et*et+W*W+$*$}function x(U){var Y=U[0],K=U[1],et=U[2],W=U[3];return Math.hypot(Y,K,et,W)}function E(U){var Y=U[0],K=U[1],et=U[2],W=U[3];return Y*Y+K*K+et*et+W*W}function P(U,Y){return U[0]=-Y[0],U[1]=-Y[1],U[2]=-Y[2],U[3]=-Y[3],U}function R(U,Y){return U[0]=1/Y[0],U[1]=1/Y[1],U[2]=1/Y[2],U[3]=1/Y[3],U}function N(U,Y){var K=Y[0],et=Y[1],W=Y[2],$=Y[3],C=K*K+et*et+W*W+$*$;return C>0&&(C=1/Math.sqrt(C)),U[0]=K*C,U[1]=et*C,U[2]=W*C,U[3]=$*C,U}function b(U,Y){return U[0]*Y[0]+U[1]*Y[1]+U[2]*Y[2]+U[3]*Y[3]}function j(U,Y,K,et){var W=K[0]*et[1]-K[1]*et[0],$=K[0]*et[2]-K[2]*et[0],C=K[0]*et[3]-K[3]*et[0],D=K[1]*et[2]-K[2]*et[1],B=K[1]*et[3]-K[3]*et[1],X=K[2]*et[3]-K[3]*et[2],q=Y[0],rt=Y[1],lt=Y[2],gt=Y[3];return U[0]=rt*X-lt*B+gt*D,U[1]=-(q*X)+lt*C-gt*$,U[2]=q*B-rt*C+gt*W,U[3]=-(q*D)+rt*$-lt*W,U}function O(U,Y,K,et){var W=Y[0],$=Y[1],C=Y[2],D=Y[3];return U[0]=W+et*(K[0]-W),U[1]=$+et*(K[1]-$),U[2]=C+et*(K[2]-C),U[3]=D+et*(K[3]-D),U}function L(U,Y){Y=Y||1;var K,et,W,$,C,D;do K=r.RANDOM()*2-1,et=r.RANDOM()*2-1,C=K*K+et*et;while(C>=1);do W=r.RANDOM()*2-1,$=r.RANDOM()*2-1,D=W*W+$*$;while(D>=1);var B=Math.sqrt((1-C)/D);return U[0]=Y*K,U[1]=Y*et,U[2]=Y*W*B,U[3]=Y*$*B,U}function k(U,Y,K){var et=Y[0],W=Y[1],$=Y[2],C=Y[3];return U[0]=K[0]*et+K[4]*W+K[8]*$+K[12]*C,U[1]=K[1]*et+K[5]*W+K[9]*$+K[13]*C,U[2]=K[2]*et+K[6]*W+K[10]*$+K[14]*C,U[3]=K[3]*et+K[7]*W+K[11]*$+K[15]*C,U}function H(U,Y,K){var et=Y[0],W=Y[1],$=Y[2],C=K[0],D=K[1],B=K[2],X=K[3],q=X*et+D*$-B*W,rt=X*W+B*et-C*$,lt=X*$+C*W-D*et,gt=-C*et-D*W-B*$;return U[0]=q*X+gt*-C+rt*-B-lt*-D,U[1]=rt*X+gt*-D+lt*-C-q*-B,U[2]=lt*X+gt*-B+q*-D-rt*-C,U[3]=Y[3],U}function Q(U){return U[0]=0,U[1]=0,U[2]=0,U[3]=0,U}function _(U){return"vec4("+U[0]+", "+U[1]+", "+U[2]+", "+U[3]+")"}function st(U,Y){return U[0]===Y[0]&&U[1]===Y[1]&&U[2]===Y[2]&&U[3]===Y[3]}function F(U,Y){var K=U[0],et=U[1],W=U[2],$=U[3],C=Y[0],D=Y[1],B=Y[2],X=Y[3];return Math.abs(K-C)<=r.EPSILON*Math.max(1,Math.abs(K),Math.abs(C))&&Math.abs(et-D)<=r.EPSILON*Math.max(1,Math.abs(et),Math.abs(D))&&Math.abs(W-B)<=r.EPSILON*Math.max(1,Math.abs(W),Math.abs(B))&&Math.abs($-X)<=r.EPSILON*Math.max(1,Math.abs($),Math.abs(X))}var Z=p,tt=c,ct=g,at=d,dt=M,it=x,ft=E,wt=function(){var U=i();return function(Y,K,et,W,$,C){var D,B;for(K||(K=4),et||(et=0),W?B=Math.min(W*K+et,Y.length):B=Y.length,D=et;D<B;D+=K)U[0]=Y[D],U[1]=Y[D+1],U[2]=Y[D+2],U[3]=Y[D+3],$(U,U,C),Y[D]=U[0],Y[D+1]=U[1],Y[D+2]=U[2],Y[D+3]=U[3];return Y}}()},function(n,t,e){e.r(t),e.d(t,"create",function(){return s}),e.d(t,"clone",function(){return a}),e.d(t,"fromValues",function(){return l}),e.d(t,"fromRotationTranslationValues",function(){return u}),e.d(t,"fromRotationTranslation",function(){return p}),e.d(t,"fromTranslation",function(){return c}),e.d(t,"fromRotation",function(){return g}),e.d(t,"fromMat4",function(){return v}),e.d(t,"copy",function(){return I}),e.d(t,"identity",function(){return w}),e.d(t,"set",function(){return y}),e.d(t,"getReal",function(){return T}),e.d(t,"getDual",function(){return h}),e.d(t,"setReal",function(){return m}),e.d(t,"setDual",function(){return d}),e.d(t,"getTranslation",function(){return M}),e.d(t,"translate",function(){return x}),e.d(t,"rotateX",function(){return E}),e.d(t,"rotateY",function(){return P}),e.d(t,"rotateZ",function(){return R}),e.d(t,"rotateByQuatAppend",function(){return N}),e.d(t,"rotateByQuatPrepend",function(){return b}),e.d(t,"rotateAroundAxis",function(){return j}),e.d(t,"add",function(){return O}),e.d(t,"multiply",function(){return L}),e.d(t,"mul",function(){return k}),e.d(t,"scale",function(){return H}),e.d(t,"dot",function(){return Q}),e.d(t,"lerp",function(){return _}),e.d(t,"invert",function(){return st}),e.d(t,"conjugate",function(){return F}),e.d(t,"length",function(){return Z}),e.d(t,"len",function(){return tt}),e.d(t,"squaredLength",function(){return ct}),e.d(t,"sqrLen",function(){return at}),e.d(t,"normalize",function(){return dt}),e.d(t,"str",function(){return it}),e.d(t,"exactEquals",function(){return ft}),e.d(t,"equals",function(){return wt});var r=e(2),i=e(7),o=e(6);function s(){var U=new r.ARRAY_TYPE(8);return r.ARRAY_TYPE!=Float32Array&&(U[0]=0,U[1]=0,U[2]=0,U[4]=0,U[5]=0,U[6]=0,U[7]=0),U[3]=1,U}function a(U){var Y=new r.ARRAY_TYPE(8);return Y[0]=U[0],Y[1]=U[1],Y[2]=U[2],Y[3]=U[3],Y[4]=U[4],Y[5]=U[5],Y[6]=U[6],Y[7]=U[7],Y}function l(U,Y,K,et,W,$,C,D){var B=new r.ARRAY_TYPE(8);return B[0]=U,B[1]=Y,B[2]=K,B[3]=et,B[4]=W,B[5]=$,B[6]=C,B[7]=D,B}function u(U,Y,K,et,W,$,C){var D=new r.ARRAY_TYPE(8);D[0]=U,D[1]=Y,D[2]=K,D[3]=et;var B=W*.5,X=$*.5,q=C*.5;return D[4]=B*et+X*K-q*Y,D[5]=X*et+q*U-B*K,D[6]=q*et+B*Y-X*U,D[7]=-B*U-X*Y-q*K,D}function p(U,Y,K){var et=K[0]*.5,W=K[1]*.5,$=K[2]*.5,C=Y[0],D=Y[1],B=Y[2],X=Y[3];return U[0]=C,U[1]=D,U[2]=B,U[3]=X,U[4]=et*X+W*B-$*D,U[5]=W*X+$*C-et*B,U[6]=$*X+et*D-W*C,U[7]=-et*C-W*D-$*B,U}function c(U,Y){return U[0]=0,U[1]=0,U[2]=0,U[3]=1,U[4]=Y[0]*.5,U[5]=Y[1]*.5,U[6]=Y[2]*.5,U[7]=0,U}function g(U,Y){return U[0]=Y[0],U[1]=Y[1],U[2]=Y[2],U[3]=Y[3],U[4]=0,U[5]=0,U[6]=0,U[7]=0,U}function v(U,Y){var K=i.create();o.getRotation(K,Y);var et=new r.ARRAY_TYPE(3);return o.getTranslation(et,Y),p(U,K,et),U}function I(U,Y){return U[0]=Y[0],U[1]=Y[1],U[2]=Y[2],U[3]=Y[3],U[4]=Y[4],U[5]=Y[5],U[6]=Y[6],U[7]=Y[7],U}function w(U){return U[0]=0,U[1]=0,U[2]=0,U[3]=1,U[4]=0,U[5]=0,U[6]=0,U[7]=0,U}function y(U,Y,K,et,W,$,C,D,B){return U[0]=Y,U[1]=K,U[2]=et,U[3]=W,U[4]=$,U[5]=C,U[6]=D,U[7]=B,U}var T=i.copy;function h(U,Y){return U[0]=Y[4],U[1]=Y[5],U[2]=Y[6],U[3]=Y[7],U}var m=i.copy;function d(U,Y){return U[4]=Y[0],U[5]=Y[1],U[6]=Y[2],U[7]=Y[3],U}function M(U,Y){var K=Y[4],et=Y[5],W=Y[6],$=Y[7],C=-Y[0],D=-Y[1],B=-Y[2],X=Y[3];return U[0]=(K*X+$*C+et*B-W*D)*2,U[1]=(et*X+$*D+W*C-K*B)*2,U[2]=(W*X+$*B+K*D-et*C)*2,U}function x(U,Y,K){var et=Y[0],W=Y[1],$=Y[2],C=Y[3],D=K[0]*.5,B=K[1]*.5,X=K[2]*.5,q=Y[4],rt=Y[5],lt=Y[6],gt=Y[7];return U[0]=et,U[1]=W,U[2]=$,U[3]=C,U[4]=C*D+W*X-$*B+q,U[5]=C*B+$*D-et*X+rt,U[6]=C*X+et*B-W*D+lt,U[7]=-et*D-W*B-$*X+gt,U}function E(U,Y,K){var et=-Y[0],W=-Y[1],$=-Y[2],C=Y[3],D=Y[4],B=Y[5],X=Y[6],q=Y[7],rt=D*C+q*et+B*$-X*W,lt=B*C+q*W+X*et-D*$,gt=X*C+q*$+D*W-B*et,yt=q*C-D*et-B*W-X*$;return i.rotateX(U,Y,K),et=U[0],W=U[1],$=U[2],C=U[3],U[4]=rt*C+yt*et+lt*$-gt*W,U[5]=lt*C+yt*W+gt*et-rt*$,U[6]=gt*C+yt*$+rt*W-lt*et,U[7]=yt*C-rt*et-lt*W-gt*$,U}function P(U,Y,K){var et=-Y[0],W=-Y[1],$=-Y[2],C=Y[3],D=Y[4],B=Y[5],X=Y[6],q=Y[7],rt=D*C+q*et+B*$-X*W,lt=B*C+q*W+X*et-D*$,gt=X*C+q*$+D*W-B*et,yt=q*C-D*et-B*W-X*$;return i.rotateY(U,Y,K),et=U[0],W=U[1],$=U[2],C=U[3],U[4]=rt*C+yt*et+lt*$-gt*W,U[5]=lt*C+yt*W+gt*et-rt*$,U[6]=gt*C+yt*$+rt*W-lt*et,U[7]=yt*C-rt*et-lt*W-gt*$,U}function R(U,Y,K){var et=-Y[0],W=-Y[1],$=-Y[2],C=Y[3],D=Y[4],B=Y[5],X=Y[6],q=Y[7],rt=D*C+q*et+B*$-X*W,lt=B*C+q*W+X*et-D*$,gt=X*C+q*$+D*W-B*et,yt=q*C-D*et-B*W-X*$;return i.rotateZ(U,Y,K),et=U[0],W=U[1],$=U[2],C=U[3],U[4]=rt*C+yt*et+lt*$-gt*W,U[5]=lt*C+yt*W+gt*et-rt*$,U[6]=gt*C+yt*$+rt*W-lt*et,U[7]=yt*C-rt*et-lt*W-gt*$,U}function N(U,Y,K){var et=K[0],W=K[1],$=K[2],C=K[3],D=Y[0],B=Y[1],X=Y[2],q=Y[3];return U[0]=D*C+q*et+B*$-X*W,U[1]=B*C+q*W+X*et-D*$,U[2]=X*C+q*$+D*W-B*et,U[3]=q*C-D*et-B*W-X*$,D=Y[4],B=Y[5],X=Y[6],q=Y[7],U[4]=D*C+q*et+B*$-X*W,U[5]=B*C+q*W+X*et-D*$,U[6]=X*C+q*$+D*W-B*et,U[7]=q*C-D*et-B*W-X*$,U}function b(U,Y,K){var et=Y[0],W=Y[1],$=Y[2],C=Y[3],D=K[0],B=K[1],X=K[2],q=K[3];return U[0]=et*q+C*D+W*X-$*B,U[1]=W*q+C*B+$*D-et*X,U[2]=$*q+C*X+et*B-W*D,U[3]=C*q-et*D-W*B-$*X,D=K[4],B=K[5],X=K[6],q=K[7],U[4]=et*q+C*D+W*X-$*B,U[5]=W*q+C*B+$*D-et*X,U[6]=$*q+C*X+et*B-W*D,U[7]=C*q-et*D-W*B-$*X,U}function j(U,Y,K,et){if(Math.abs(et)<r.EPSILON)return I(U,Y);var W=Math.hypot(K[0],K[1],K[2]);et=et*.5;var $=Math.sin(et),C=$*K[0]/W,D=$*K[1]/W,B=$*K[2]/W,X=Math.cos(et),q=Y[0],rt=Y[1],lt=Y[2],gt=Y[3];U[0]=q*X+gt*C+rt*B-lt*D,U[1]=rt*X+gt*D+lt*C-q*B,U[2]=lt*X+gt*B+q*D-rt*C,U[3]=gt*X-q*C-rt*D-lt*B;var yt=Y[4],xt=Y[5],Et=Y[6],St=Y[7];return U[4]=yt*X+St*C+xt*B-Et*D,U[5]=xt*X+St*D+Et*C-yt*B,U[6]=Et*X+St*B+yt*D-xt*C,U[7]=St*X-yt*C-xt*D-Et*B,U}function O(U,Y,K){return U[0]=Y[0]+K[0],U[1]=Y[1]+K[1],U[2]=Y[2]+K[2],U[3]=Y[3]+K[3],U[4]=Y[4]+K[4],U[5]=Y[5]+K[5],U[6]=Y[6]+K[6],U[7]=Y[7]+K[7],U}function L(U,Y,K){var et=Y[0],W=Y[1],$=Y[2],C=Y[3],D=K[4],B=K[5],X=K[6],q=K[7],rt=Y[4],lt=Y[5],gt=Y[6],yt=Y[7],xt=K[0],Et=K[1],St=K[2],Mt=K[3];return U[0]=et*Mt+C*xt+W*St-$*Et,U[1]=W*Mt+C*Et+$*xt-et*St,U[2]=$*Mt+C*St+et*Et-W*xt,U[3]=C*Mt-et*xt-W*Et-$*St,U[4]=et*q+C*D+W*X-$*B+rt*Mt+yt*xt+lt*St-gt*Et,U[5]=W*q+C*B+$*D-et*X+lt*Mt+yt*Et+gt*xt-rt*St,U[6]=$*q+C*X+et*B-W*D+gt*Mt+yt*St+rt*Et-lt*xt,U[7]=C*q-et*D-W*B-$*X+yt*Mt-rt*xt-lt*Et-gt*St,U}var k=L;function H(U,Y,K){return U[0]=Y[0]*K,U[1]=Y[1]*K,U[2]=Y[2]*K,U[3]=Y[3]*K,U[4]=Y[4]*K,U[5]=Y[5]*K,U[6]=Y[6]*K,U[7]=Y[7]*K,U}var Q=i.dot;function _(U,Y,K,et){var W=1-et;return Q(Y,K)<0&&(et=-et),U[0]=Y[0]*W+K[0]*et,U[1]=Y[1]*W+K[1]*et,U[2]=Y[2]*W+K[2]*et,U[3]=Y[3]*W+K[3]*et,U[4]=Y[4]*W+K[4]*et,U[5]=Y[5]*W+K[5]*et,U[6]=Y[6]*W+K[6]*et,U[7]=Y[7]*W+K[7]*et,U}function st(U,Y){var K=ct(Y);return U[0]=-Y[0]/K,U[1]=-Y[1]/K,U[2]=-Y[2]/K,U[3]=Y[3]/K,U[4]=-Y[4]/K,U[5]=-Y[5]/K,U[6]=-Y[6]/K,U[7]=Y[7]/K,U}function F(U,Y){return U[0]=-Y[0],U[1]=-Y[1],U[2]=-Y[2],U[3]=Y[3],U[4]=-Y[4],U[5]=-Y[5],U[6]=-Y[6],U[7]=Y[7],U}var Z=i.length,tt=Z,ct=i.squaredLength,at=ct;function dt(U,Y){var K=ct(Y);if(K>0){K=Math.sqrt(K);var et=Y[0]/K,W=Y[1]/K,$=Y[2]/K,C=Y[3]/K,D=Y[4],B=Y[5],X=Y[6],q=Y[7],rt=et*D+W*B+$*X+C*q;U[0]=et,U[1]=W,U[2]=$,U[3]=C,U[4]=(D-et*rt)/K,U[5]=(B-W*rt)/K,U[6]=(X-$*rt)/K,U[7]=(q-C*rt)/K}return U}function it(U){return"quat2("+U[0]+", "+U[1]+", "+U[2]+", "+U[3]+", "+U[4]+", "+U[5]+", "+U[6]+", "+U[7]+")"}function ft(U,Y){return U[0]===Y[0]&&U[1]===Y[1]&&U[2]===Y[2]&&U[3]===Y[3]&&U[4]===Y[4]&&U[5]===Y[5]&&U[6]===Y[6]&&U[7]===Y[7]}function wt(U,Y){var K=U[0],et=U[1],W=U[2],$=U[3],C=U[4],D=U[5],B=U[6],X=U[7],q=Y[0],rt=Y[1],lt=Y[2],gt=Y[3],yt=Y[4],xt=Y[5],Et=Y[6],St=Y[7];return Math.abs(K-q)<=r.EPSILON*Math.max(1,Math.abs(K),Math.abs(q))&&Math.abs(et-rt)<=r.EPSILON*Math.max(1,Math.abs(et),Math.abs(rt))&&Math.abs(W-lt)<=r.EPSILON*Math.max(1,Math.abs(W),Math.abs(lt))&&Math.abs($-gt)<=r.EPSILON*Math.max(1,Math.abs($),Math.abs(gt))&&Math.abs(C-yt)<=r.EPSILON*Math.max(1,Math.abs(C),Math.abs(yt))&&Math.abs(D-xt)<=r.EPSILON*Math.max(1,Math.abs(D),Math.abs(xt))&&Math.abs(B-Et)<=r.EPSILON*Math.max(1,Math.abs(B),Math.abs(Et))&&Math.abs(X-St)<=r.EPSILON*Math.max(1,Math.abs(X),Math.abs(St))}},function(n,t,e){e.r(t),e.d(t,"create",function(){return i}),e.d(t,"clone",function(){return o}),e.d(t,"fromValues",function(){return s}),e.d(t,"copy",function(){return a}),e.d(t,"set",function(){return l}),e.d(t,"add",function(){return u}),e.d(t,"subtract",function(){return p}),e.d(t,"multiply",function(){return c}),e.d(t,"divide",function(){return g}),e.d(t,"ceil",function(){return v}),e.d(t,"floor",function(){return I}),e.d(t,"min",function(){return w}),e.d(t,"max",function(){return y}),e.d(t,"round",function(){return T}),e.d(t,"scale",function(){return h}),e.d(t,"scaleAndAdd",function(){return m}),e.d(t,"distance",function(){return d}),e.d(t,"squaredDistance",function(){return M}),e.d(t,"length",function(){return x}),e.d(t,"squaredLength",function(){return E}),e.d(t,"negate",function(){return P}),e.d(t,"inverse",function(){return R}),e.d(t,"normalize",function(){return N}),e.d(t,"dot",function(){return b}),e.d(t,"cross",function(){return j}),e.d(t,"lerp",function(){return O}),e.d(t,"random",function(){return L}),e.d(t,"transformMat2",function(){return k}),e.d(t,"transformMat2d",function(){return H}),e.d(t,"transformMat3",function(){return Q}),e.d(t,"transformMat4",function(){return _}),e.d(t,"rotate",function(){return st}),e.d(t,"angle",function(){return F}),e.d(t,"zero",function(){return Z}),e.d(t,"str",function(){return tt}),e.d(t,"exactEquals",function(){return ct}),e.d(t,"equals",function(){return at}),e.d(t,"len",function(){return dt}),e.d(t,"sub",function(){return it}),e.d(t,"mul",function(){return ft}),e.d(t,"div",function(){return wt}),e.d(t,"dist",function(){return U}),e.d(t,"sqrDist",function(){return Y}),e.d(t,"sqrLen",function(){return K}),e.d(t,"forEach",function(){return et});var r=e(2);function i(){var W=new r.ARRAY_TYPE(2);return r.ARRAY_TYPE!=Float32Array&&(W[0]=0,W[1]=0),W}function o(W){var $=new r.ARRAY_TYPE(2);return $[0]=W[0],$[1]=W[1],$}function s(W,$){var C=new r.ARRAY_TYPE(2);return C[0]=W,C[1]=$,C}function a(W,$){return W[0]=$[0],W[1]=$[1],W}function l(W,$,C){return W[0]=$,W[1]=C,W}function u(W,$,C){return W[0]=$[0]+C[0],W[1]=$[1]+C[1],W}function p(W,$,C){return W[0]=$[0]-C[0],W[1]=$[1]-C[1],W}function c(W,$,C){return W[0]=$[0]*C[0],W[1]=$[1]*C[1],W}function g(W,$,C){return W[0]=$[0]/C[0],W[1]=$[1]/C[1],W}function v(W,$){return W[0]=Math.ceil($[0]),W[1]=Math.ceil($[1]),W}function I(W,$){return W[0]=Math.floor($[0]),W[1]=Math.floor($[1]),W}function w(W,$,C){return W[0]=Math.min($[0],C[0]),W[1]=Math.min($[1],C[1]),W}function y(W,$,C){return W[0]=Math.max($[0],C[0]),W[1]=Math.max($[1],C[1]),W}function T(W,$){return W[0]=Math.round($[0]),W[1]=Math.round($[1]),W}function h(W,$,C){return W[0]=$[0]*C,W[1]=$[1]*C,W}function m(W,$,C,D){return W[0]=$[0]+C[0]*D,W[1]=$[1]+C[1]*D,W}function d(W,$){var C=$[0]-W[0],D=$[1]-W[1];return Math.hypot(C,D)}function M(W,$){var C=$[0]-W[0],D=$[1]-W[1];return C*C+D*D}function x(W){var $=W[0],C=W[1];return Math.hypot($,C)}function E(W){var $=W[0],C=W[1];return $*$+C*C}function P(W,$){return W[0]=-$[0],W[1]=-$[1],W}function R(W,$){return W[0]=1/$[0],W[1]=1/$[1],W}function N(W,$){var C=$[0],D=$[1],B=C*C+D*D;return B>0&&(B=1/Math.sqrt(B)),W[0]=$[0]*B,W[1]=$[1]*B,W}function b(W,$){return W[0]*$[0]+W[1]*$[1]}function j(W,$,C){var D=$[0]*C[1]-$[1]*C[0];return W[0]=W[1]=0,W[2]=D,W}function O(W,$,C,D){var B=$[0],X=$[1];return W[0]=B+D*(C[0]-B),W[1]=X+D*(C[1]-X),W}function L(W,$){$=$||1;var C=r.RANDOM()*2*Math.PI;return W[0]=Math.cos(C)*$,W[1]=Math.sin(C)*$,W}function k(W,$,C){var D=$[0],B=$[1];return W[0]=C[0]*D+C[2]*B,W[1]=C[1]*D+C[3]*B,W}function H(W,$,C){var D=$[0],B=$[1];return W[0]=C[0]*D+C[2]*B+C[4],W[1]=C[1]*D+C[3]*B+C[5],W}function Q(W,$,C){var D=$[0],B=$[1];return W[0]=C[0]*D+C[3]*B+C[6],W[1]=C[1]*D+C[4]*B+C[7],W}function _(W,$,C){var D=$[0],B=$[1];return W[0]=C[0]*D+C[4]*B+C[12],W[1]=C[1]*D+C[5]*B+C[13],W}function st(W,$,C,D){var B=$[0]-C[0],X=$[1]-C[1],q=Math.sin(D),rt=Math.cos(D);return W[0]=B*rt-X*q+C[0],W[1]=B*q+X*rt+C[1],W}function F(W,$){var C=W[0],D=W[1],B=$[0],X=$[1],q=Math.sqrt(C*C+D*D)*Math.sqrt(B*B+X*X),rt=q&&(C*B+D*X)/q;return Math.acos(Math.min(Math.max(rt,-1),1))}function Z(W){return W[0]=0,W[1]=0,W}function tt(W){return"vec2("+W[0]+", "+W[1]+")"}function ct(W,$){return W[0]===$[0]&&W[1]===$[1]}function at(W,$){var C=W[0],D=W[1],B=$[0],X=$[1];return Math.abs(C-B)<=r.EPSILON*Math.max(1,Math.abs(C),Math.abs(B))&&Math.abs(D-X)<=r.EPSILON*Math.max(1,Math.abs(D),Math.abs(X))}var dt=x,it=p,ft=c,wt=g,U=d,Y=M,K=E,et=function(){var W=i();return function($,C,D,B,X,q){var rt,lt;for(C||(C=2),D||(D=0),B?lt=Math.min(B*C+D,$.length):lt=$.length,rt=D;rt<lt;rt+=C)W[0]=$[rt],W[1]=$[rt+1],X(W,W,q),$[rt]=W[0],$[rt+1]=W[1];return $}}()},function(n,t,e){e.r(t);var r=e(13);e.d(t,"Renderer",function(){return r.default});var i=e(40);e.d(t,"Figure2D",function(){return i.default});var o=e(56);e.d(t,"Mesh2D",function(){return o.default});var s=e(29);e.d(t,"MeshCloud",function(){return s.default});var a=e(23);e.d(t,"parseFont",function(){return a.default});var l=e(31);e.d(t,"parseColor",function(){return l.default});var u=e(21);e.d(t,"ENV",function(){return u.default}),e(1).glMatrix.setMatrixArrayType(Array)},function(n,t,e){e.r(t),e.d(t,"default",function(){return R});var r=e(14),i=e(1),o=e(20),s=e(27),a=e(25),l=e(40),u=e(56),p=e(29),c=e(59),g=e(21),v=e(63);e(1).glMatrix.setMatrixArrayType(Array);const I={autoUpdate:!1,preserveDrawingBuffer:!1,bufferSize:1500},w=`attribute vec3 a_vertexPosition;
attribute vec3 a_vertexTextureCoord;
varying vec3 vTextureCoord;
uniform mat3 viewMatrix;
uniform mat3 projectionMatrix;

void main() {
  gl_PointSize = 1.0;
  vec3 pos = projectionMatrix * viewMatrix * vec3(a_vertexPosition.xy, 1.0);
  gl_Position = vec4(pos.xy, 1.0, 1.0);    
  vTextureCoord = a_vertexTextureCoord;              
}
`,y=`precision mediump float;
varying vec3 vTextureCoord;
uniform sampler2D u_texSampler;
void main() {
  gl_FragColor = texture2D(u_texSampler, vTextureCoord.xy);
}
`,T=Symbol("glRenderer"),h=Symbol("canvasRenderer"),m=Symbol("options"),d=Symbol("globalTransform"),M=Symbol("applyGlobalTransform"),x=Symbol("canvas");function E(N){const b=N.gl,j=N.fbo;j&&b.bindFramebuffer(b.FRAMEBUFFER,j),N._draw(),j&&b.bindFramebuffer(b.FRAMEBUFFER,null)}function P(N,b,j,O){const L=N.createTexture(b.canvas),k=[[[0,0],[j,0],[j,O],[0,O],[0,0]]];k.closed=!0;const H=new u.default({contours:k});H.setTexture(L),N.setMeshData([H.meshData]),E(N),L.delete(),b.clearRect(0,0,j,O),delete b._filter}class R{constructor(b,j={}){let O=j.contextType;if(O||(typeof WebGL2RenderingContext=="function"?O="webgl2":typeof WebGLRenderingContext=="function"?O="webgl":O="2d"),!b.getContext){const L=b;b={getContext(){return L},width:j.width,height:j.height},L.canvas=b,O="2d"}if(this[x]=b,O!=="webgl"&&O!=="webgl2"&&O!=="2d")throw new Error(`Unknown context type ${O}`);if(j.contextType=O,this[m]=Object.assign({},I,j),O==="webgl"||O==="webgl2"){O==="webgl2"&&(this[m].webgl2=!0);const L=new r.default(b,this[m]);O==="webgl2"&&!L.isWebGL2&&(j.contextType="webgl"),Object(v.createShaders)(L),Object(v.applyShader)(L),Object(v.createCloudShaders)(L);const k=L.gl;k.clearColor(0,0,0,0),k.blendFuncSeparate(k.SRC_ALPHA,k.ONE_MINUS_SRC_ALPHA,k.ONE,k.ONE_MINUS_SRC_ALPHA),this[T]=L}else this[h]=new o.default(b,this[m]);this[d]=[1,0,0,0,1,0,0,0,1],this.updateResolution()}get canvas(){return this[x]}get canvasRenderer(){return this[h]}get glRenderer(){return this[T]}get isWebGL2(){return this[T]&&this[T].isWebGL2}get options(){return this[m]}get globalTransformMatrix(){const b=this[d];return[b[0],b[1],b[3],b[4],b[6],b[7]]}get viewMatrix(){return this[d]}[M](){const b=this[T]||this[h];if(this[T]){const{width:j,height:O}=this.canvas;b.uniforms.viewMatrix=this.viewMatrix,b.uniforms.projectionMatrix=this.projectionMatrix,b.uniforms.u_resolution=[j,O]}}updateResolution(){const{width:b,height:j}=this.canvas,O=[1,0,0,0,1,0,-b/2,-j/2,1],L=[2/b,0,0,0,-2/j,0,0,0,1],k=i.mat3.multiply(Array.of(0,0,0,0,0,0,0,0,0),L,O);this.projectionMatrix=k,this[T]&&this[T].gl.viewport(0,0,b,j)}createTexture(b,j){return(this[T]||this[h]).createTexture(b,j)}loadTexture(b,{useImageBitmap:j=!1}={}){return(this[T]||this[h]).loadTexture(b,{useImageBitmap:j})}createText(b,{font:j="16px arial",fillColor:O=null,strokeColor:L=null,strokeWidth:k=1}={}){if(this[T]){const H=g.default.createText(b,{font:j,fillColor:O,strokeColor:L,strokeWidth:k});return{image:this.createTexture(H.image),rect:H.rect}}return{_img:{font:j,fillColor:O,strokeColor:L,strokeWidth:k,text:b}}}createProgram({vertex:b,fragment:j,options:O}={}){if(this[T]){const L=this[T].compileSync(j,b);return L._attribOpts=O,L}throw new Error("Context 2D cannot create webgl program.")}createPassProgram({vertex:b=w,fragment:j=y,options:O}={}){return this.createProgram({vertex:b,fragment:j,options:O})}useProgram(b,j={}){if(this[T]){const O=Object.assign({},b._attribOpts,j);return this[T].useProgram(b,O)}throw new Error("Context 2D cannot use webgl program.")}deleteTexture(b){return(this[T]||this[h]).deleteTexture(b)}clear(...b){if(this[T]){const j=this[T].gl;j.clear(j.COLOR_BUFFER_BIT)}else this[h].clear(...b)}drawMeshCloud(b,{clear:j=!1,program:O=null}={}){const L=this[T]||this[h],k=O||b.program;if(this[T]){const H=L.gl;if(j&&H.clear(H.COLOR_BUFFER_BIT),k)L.program!==k&&this.useProgram(k,{a_color:{type:"UNSIGNED_BYTE",normalize:!0},a_fillCloudColor:{type:"UNSIGNED_BYTE",normalize:!0},a_strokeCloudColor:{type:"UNSIGNED_BYTE",normalize:!0},a_frameIndex:{type:"UNSIGNED_BYTE",normalize:!1}});else{const Q=b.mesh.meshData,_=!!Q.uniforms.u_texSampler,st=!!Q.uniforms.u_filterFlag,F=!!Q.uniforms.u_radialGradientVector,Z=b.hasCloudColor,tt=b.hasCloudFilter,ct=!!Q.uniforms.u_clipSampler;Object(v.applyCloudShader)(L,{hasTexture:_,hasFilter:st,hasGradient:F,hasCloudColor:Z,hasCloudFilter:tt,hasClipPath:ct})}this[M](),L.setMeshData([b.meshData]),b.beforeRender&&b.beforeRender(H,b),E(L),b.afterRender&&b.afterRender(H,b)}else L.setTransform(this.globalTransformMatrix),L.drawMeshCloud(b,{clear:j,hook:!1})}drawMeshes(b,{clear:j=!1,program:O=null}={}){const L=this[T]||this[h];if(this[T]){const k=L.fbo,H=Object(s.default)(this,b,O==null),Q=L.gl;j&&Q.clear(Q.COLOR_BUFFER_BIT);const _=!Object(c.isUnitTransform)(this.globalTransformMatrix);this._drawCalls=0;for(const st of H){this._drawCalls++;const F=O||st.program;if(st instanceof p.default)this.drawMeshCloud(st,{clear:j,program:F});else{const{width:Z,height:tt}=this.canvas;if(st.beforeRender&&st.beforeRender(Q,st),st.pass.length&&((!this.fbo||this.fbo.width!==Z||this.fbo.height!==tt)&&(this.fbo={width:Z,height:tt,target:L.createFBO(),buffer:L.createFBO(),swap(){[this.target,this.buffer]=[this.buffer,this.target]}}),L.bindFBO(this.fbo.target)),!F&&st.filterCanvas){Object(v.applyShader)(L,{hasTexture:!0});let ct=this.filterContext;ct||(ct=g.default.createCanvas(Z,tt).getContext("2d"),this.filterContext=ct);const at=b[st.packIndex],dt=at.filter,it=b[st.packIndex+1],ft=b[st.packIndex-1];(!ft||!ft.filterCanvas||ft.filter!==dt)&&(!it||!it.filterCanvas||it.filter!==dt)?(_?(ct.save(),Object(a.drawMesh2D)(at,ct,!1),ct.restore(),Object(a.applyFilter)(ct,dt)):Object(a.drawMesh2D)(at,ct,!0),this[M](),P(L,ct,Z,tt)):(_&&ct.save(),Object(a.drawMesh2D)(at,ct,!1),_&&ct.restore(),(!it||!it.filterCanvas||at.filter!==it.filter)&&(Object(a.applyFilter)(ct,dt),this[M](),P(L,ct,Z,tt)))}else{if(F)L.program!==F&&this.useProgram(F,{a_color:{type:"UNSIGNED_BYTE",normalize:!0}});else{const ct=!!st.uniforms.u_texSampler,at=!!st.uniforms.u_filterFlag,dt=!!st.uniforms.u_radialGradientVector,it=!!st.uniforms.u_clipSampler;Object(v.applyShader)(L,{hasTexture:ct,hasFilter:at,hasGradient:dt,hasClipPath:it})}st.filterCanvas&&console.warn("User program ignored some filter effects."),this[M](),L.setMeshData([st]),E(L)}if(st.pass.length){const ct=st.pass.length;st.pass.forEach((at,dt)=>{at.blend=st.enableBlend,at.setTexture(L.fbo.texture),dt===ct-1?L.bindFBO(k):(this.fbo.swap(),L.bindFBO(this.fbo.target)),at.program?L.useProgram(at.program):(this.defaultPassProgram=this.defaultPassProgram||this.createPassProgram(),L.useProgram(this.defaultPassProgram)),L.setMeshData([at.meshData]),Q.clear(Q.COLOR_BUFFER_BIT),E(L)})}st.afterRender&&st.afterRender(Q,st)}}}else L.setTransform(this.globalTransformMatrix),L.drawMeshes(b,{clear:j})}drawImage(b,...j){const O=j.length;if(O<2)throw new TypeError(`Failed to execute 'drawImage' on 'Renderer': 3 arguments required, but only ${j.length+1} present.`);if(O!==2&&O!==4&&O!==8)throw new TypeError(`Failed to execute 'drawImage' on 'Renderer': Valid arities are: [3, 5, 9], but ${j.length+1} arguments provided.`);let L=null,k=null;O===2?L=[j[0],j[1],b.width,b.height]:O===4?L=j:O===8&&(k=j.slice(0,4),L=j.slice(4));const H=this.createTexture(b),{width:Q,height:_}=this.canvas,st=new l.default;st.rect(L[0],L[1],Q,_);const F=new u.default(st,{width:Q,height:_});F.setTexture(H,{rect:L,srcRect:k}),this.drawMeshes([F]),this.deleteTexture(H)}setGlobalTransform(...b){return this[d]=[b[0],b[1],0,b[2],b[3],0,b[4],b[5],1],this}globalTransform(...b){const j=this[d];return this[d]=i.mat3.multiply(Array.of(0,0,0,0,0,0,0,0,0),j,b),this}globalTranslate(b,j){let O=i.mat3.create();return O=i.mat3.translate(Array.of(0,0,0,0,0,0,0,0,0),O,[b,j]),this.globalTransform(...O)}globalRotate(b,[j,O]=[0,0]){let L=i.mat3.create();return L=i.mat3.translate(Array.of(0,0,0,0,0,0,0,0,0),L,[j,O]),L=i.mat3.rotate(Array.of(0,0,0,0,0,0,0,0,0),L,b),L=i.mat3.translate(Array.of(0,0,0,0,0,0,0,0,0),L,[-j,-O]),this.globalTransform(...L)}globalScale(b,j=b,[O,L]=[0,0]){let k=i.mat3.create();return k=i.mat3.translate(Array.of(0,0,0,0,0,0,0,0,0),k,[O,L]),k=i.mat3.scale(Array.of(0,0,0,0,0,0,0,0,0),k,[b,j]),k=i.mat3.translate(Array.of(0,0,0,0,0,0,0,0,0),k,[-O,-L]),this.globalTransform(...k)}globalSkew(b,j=b,[O,L]=[0,0]){let k=i.mat3.create();return k=i.mat3.translate(Array.of(0,0,0,0,0,0,0,0,0),k,[O,L]),k=i.mat3.multiply(Array.of(0,0,0,0,0,0,0,0,0),k,i.mat3.fromValues(1,Math.tan(j),Math.tan(b),1,0,0)),k=i.mat3.translate(Array.of(0,0,0,0,0,0,0,0,0),k,[-O,-L]),this.globalTransform(...k)}transformPoint(b,j,O){let L=this.globalTransformMatrix;O&&(L=i.mat3.multiply(Array.of(0,0,0,0,0,0,0,0,0),L,O));const k=b*L[0]+j*L[2]+L[4],H=b*L[1]+j*L[3]+L[5];return[k,H]}}},function(n,t,e){e.r(t);var r=e(15);e(1).glMatrix.setMatrixArrayType(Array),t.default=r.default},function(n,t,e){e.r(t),e.d(t,"default",function(){return v});var r=e(16),i=e(17),o=e(18),s=e(19);e(1).glMatrix.setMatrixArrayType(Array);function a(I,w,y){return w in I?Object.defineProperty(I,w,{value:y,enumerable:!0,configurable:!0,writable:!0}):I[w]=y,I}const l={};function u(I,w=3){const y=[],T=I.length;for(let h=0;h<T;h++)h%w<2&&y.push(.5*(I[h]+1));return y}function p(I,w){const y=w._buffers;Object.values(y).forEach(T=>{I.deleteBuffer(T)}),w._buffers={}}function c(I,w,y){return I.activeTexture(I.TEXTURE0+y),Array.isArray(w._img)?I.bindTexture(I.TEXTURE_CUBE_MAP,w):I.bindTexture(I.TEXTURE_2D,w),w}const g={int:"1i",ivec2:"2i",ivec3:"3i",ivec4:"4i",float:"1f",vec2:"2f",vec3:"3f",vec4:"4f",mat2:"Matrix2fv",mat3:"Matrix3fv",mat4:"Matrix4fv",sampler1D:"sampler1D",sampler2D:"sampler2D",sampler3D:"sampler3D",samplerCube:"samplerCube",sampler1DShadow:"sampler1DShadow",sampler2DShadow:"sampler2DShadow",sampler2DRect:"sampler2DRect",sampler2DRectShadow:"sampler2DRectShadow"};class v{static addLibs(w={}){Object.assign(l,w)}static FLOAT(w,y){return Object(r.pointsToBuffer)(w,Float32Array,y)}static UNSIGNED_BYTE(w,y){return Object(r.pointsToBuffer)(w,Uint8Array,y)}static UNSIGNED_SHORT(w,y){return Object(r.pointsToBuffer)(w,Uint16Array,y)}static BYTE(w,y){return Object(r.pointsToBuffer)(w,Int8Array,y)}static SHORT(w,y){return Object(r.pointsToBuffer)(w,Int16Array,y)}constructor(w,y={}){this.options=Object.assign({},v.defaultOptions,y),this.canvas=w;let T;this.options.webgl2&&(T=w.getContext("webgl2",this.options)),T==null&&(T=Object(r.setupWebGL)(w,this.options),this.aia_ext=T.getExtension("ANGLE_instanced_arrays")),this.gl=T,T.viewport(0,0,w.width,w.height),T.clearColor(0,0,0,0),T.blendFuncSeparate(T.SRC_ALPHA,T.ONE_MINUS_SRC_ALPHA,T.ONE,T.ONE_MINUS_SRC_ALPHA),this.programs=[],this._events={}}get program(){const w=this.gl;return w.getParameter(w.CURRENT_PROGRAM)}_declareUniform(w,y,T="1f"){const h=this.gl,m=h.getUniformLocation(w,y);let d;const M=this;if(/^sampler/.test(T)){const x=w._samplerMap,E=w._bindTextures;Object.defineProperty(w.uniforms,y,{get(){return d},set(P){d=P;const R=x[y]!=null?x[y]:E.length;E[R]=P,c(h,P,R),x[y]||(x[y]=R,h.uniform1i(m,R)),M.options.autoUpdate&&M.update()},configurable:!1,enumerable:!0})}else{const x=T.indexOf("Matrix")===0,E=!x&&/v$/.test(T),P=h[`uniform${T}`].bind(h);Object.defineProperty(w.uniforms,y,{get(){return d},set(R){d=R,typeof R=="number"&&(R=[R]),x?P(m,!1,R):E?P(m,R):P(m,...R),M.options.autoUpdate&&M.update()},configurable:!1,enumerable:!0})}}_draw(){const w=this.program;w.meshData.forEach((y,T)=>{const{positions:h,cells:m,instanceCount:d,cellsCount:M,attributes:x,uniforms:E,textureCoord:P,enableBlend:R}=y,N=this.gl;let b=y.mode!=null?y.mode:N.TRIANGLES;typeof b=="string"&&(b=N[b]),R?N.enable(N.BLEND):N.disable(N.BLEND),N.bindBuffer(N.ARRAY_BUFFER,w._buffers.verticesBuffer),N.bufferData(N.ARRAY_BUFFER,h,N.STATIC_DRAW),m&&(N.bindBuffer(N.ELEMENT_ARRAY_BUFFER,w._buffers.cellsBuffer),N.bufferData(N.ELEMENT_ARRAY_BUFFER,m,N.STATIC_DRAW));const j=[];x&&Object.values(x).forEach(({name:L,data:k,divisor:H})=>{if(N.bindBuffer(N.ARRAY_BUFFER,w._buffers[L]),N.bufferData(N.ARRAY_BUFFER,k,N.STATIC_DRAW),H!=null){const Q=N.getAttribLocation(w,L);Q>=0&&(N.enableVertexAttribArray(Q),j.push(Q),N.vertexAttribDivisor?N.vertexAttribDivisor(Q,H):this.aia_ext&&this.aia_ext.vertexAttribDivisorANGLE(Q,H))}}),E&&Object.entries(E).forEach(([L,k])=>{this.uniforms[L]=k});let O;if(!m){const L=w._dimension;O=h.length/L}if(w._enableTextures&&w._buffers.texCoordBuffer){const L=P||u(h,w._dimension);N.bindBuffer(N.ARRAY_BUFFER,w._buffers.texCoordBuffer),N.bufferData(N.ARRAY_BUFFER,v.FLOAT(L),N.STATIC_DRAW)}d!=null?(m?N.drawElementsInstanced?N.drawElementsInstanced(b,M,N.UNSIGNED_SHORT,0,d):this.aia_ext&&this.aia_ext.drawElementsInstancedANGLE(b,M,N.UNSIGNED_SHORT,0,d):N.drawArraysInstanced?N.drawArraysInstanced(b,0,O,d):this.aia_ext.drawArraysInstancedANGLE(b,0,O,d),j.forEach(L=>{N.vertexAttribDivisor?N.vertexAttribDivisor(L,null):this.aia_ext&&this.aia_ext.vertexAttribDivisorANGLE(L,null)})):m?N.drawElements(b,M,N.UNSIGNED_SHORT,0):N.drawArrays(b,0,O)})}get isWebGL2(){return typeof WebGL2RenderingContext<"u"&&this.gl instanceof WebGL2RenderingContext}get enableTextures(){return this.program&&this.program._enableTextures}get uniforms(){const w=this.program;if(!w||!w.uniforms)throw Error("No avaliable program.");return w.uniforms}deleteProgram(w){const y=this.gl;this.program===w&&(this.startRender=!1,this._renderFrameID&&(cancelAnimationFrame(this._renderFrameID),delete this._renderFrameID),y.useProgram(null));const T=this.programs.indexOf(w);T>=0&&this.programs.splice(T,1),p(y,w),y.deleteProgram(w)}setMeshData(w){Array.isArray(w)||(w=[w]);const y=this.program;y.meshData=w.map(({mode:T,positions:h,instanceCount:m,cells:d,cellsCount:M,attributes:x,uniforms:E,textureCoord:P,enableBlend:R})=>{const N={positions:v.FLOAT(h),uniforms:E,enableBlend:!!R,textureCoord:v.FLOAT(P)};if(d&&(N.cells=v.USHORT(d),N.cellsCount=M||N.cells.length),T!=null&&(N.mode=T),m!=null){if(!this.isWebGL2&&!this.aia_ext)throw new Error("Cannot use instanceCount in this rendering context, use webgl2 context instead.");N.instanceCount=m}if(x){const b={};Object.entries(x).forEach(([j,O])=>{if(!y._attribute[j])y._attribute[j]="ignored";else if(y._attribute[j]!=="ignored"){const{name:L,type:k}=y._attribute[j];let H=O.data||O;if(Array.isArray(H)&&(H=v[k](H)),b[j]={name:L,data:H},O.divisor!=null){if(!this.isWebGL2&&!this.aia_ext)throw new Error("Cannot use divisor in this rendering context, use webgl2 context instead.");b[j].divisor=O.divisor}}}),N.attributes=b}return N}),this.options.autoUpdate&&this.update()}createProgram(w,y){const T=/^\s*uniform\s+sampler/mg.test(w);w==null&&(w=o.default),y==null&&(y=T?s.default:i.default);const h=this.gl,m=Object(r.createProgram)(h,y,w);m.shaderText={vertexShader:y,fragmentShader:w},m._buffers={},m._attribute={},m.uniforms={},m._samplerMap={},m._bindTextures=[];const d=new RegExp(`(?:attribute|in) vec(\\d) ${this.options.vertexPosition}`,"im");let M=y.match(d);M&&(m._dimension=Number(M[1]));const x=new RegExp(`(?:attribute|in) vec(\\d) ${this.options.vertexTextureCoord}`,"im");M=y.match(x),M&&(m._texCoordSize=Number(M[1]));const E=/^\s*(?:attribute|in) (\w+?)(\d*) (\w+)/gim;if(M=y.match(E),M)for(let N=0;N<M.length;N++){const b=/^\s*(?:attribute|in) (\w+?)(\d*) (\w+)/im,j=M[N].match(b);if(j&&j[3]!==this.options.vertexPosition&&j[3]!==this.options.vertexTextureCoord){let[,O,L,k]=j;O==="mat"&&(L**=2),m._buffers[k]=h.createBuffer(),m._attribute[k]={name:k,type:O,size:Number(L)||1}}}const P=/^\s*uniform\s+(\w+)\s+(\w+)(\[\d+\])?/mg;M=y.match(P)||[],M=M.concat(w.match(P)||[]),M.forEach(N=>{const b=N.match(/^\s*uniform\s+(\w+)\s+(\w+)(\[\d+\])?/);let[j,O,L]=b.slice(1);j=g[j],L=!!L,j.indexOf("Matrix")!==0&&L&&(j+="v"),this._declareUniform(m,O,j)}),m._buffers.verticesBuffer=h.createBuffer(),m._buffers.cellsBuffer=h.createBuffer();const R=h.getAttribLocation(m,this.options.vertexTextureCoord);return m._enableTextures=R>=0,m._enableTextures&&(m._buffers.texCoordBuffer=h.createBuffer()),this.programs.push(m),m}useProgram(w,y={}){this.startRender=!1,this._renderFrameID&&(cancelAnimationFrame(this._renderFrameID),delete this._renderFrameID);const T=this.gl;T.useProgram(w);const h=w._dimension;T.bindBuffer(T.ARRAY_BUFFER,w._buffers.verticesBuffer);const m=T.getAttribLocation(w,this.options.vertexPosition);if(T.vertexAttribPointer(m,h,T.FLOAT,!1,0,0),T.enableVertexAttribArray(m),w._enableTextures){T.bindBuffer(T.ARRAY_BUFFER,w._buffers.texCoordBuffer);const d=T.getAttribLocation(w,this.options.vertexTextureCoord);T.vertexAttribPointer(d,w._texCoordSize||2,T.FLOAT,!1,0,0),T.enableVertexAttribArray(d)}if(Object.entries(w._attribute).forEach(([d,M])=>{if(M!=="ignored"){const x=M.size,E=y[d]||{},P=!!E.normalize;let R=E.type||"FLOAT";const N=E.key||d;R==="UBYTE"&&(R="UNSIGNED_BYTE"),R==="USHORT"&&(R="UNSIGNED_SHORT"),M.type=R,N&&N!==d&&(w._attribute[N]=M),T.bindBuffer(T.ARRAY_BUFFER,w._buffers[d]);const b=T.getAttribLocation(w,d);b>=0&&(T.vertexAttribPointer(b,x,T[R],P,0,0),T.enableVertexAttribArray(b))}}),!w.meshData){const d=[[-1,-1,0,1].slice(0,h),[1,-1,0,1].slice(0,h),[1,1,0,1].slice(0,h),[-1,1,0,1].slice(0,h)],M=[[0,1,3],[3,1,2]];this.setMeshData({positions:d,cells:M})}return w}compileSync(w,y){w=w||o.default;const T={};function h(x){x=x.replace(/^\s*/mg,"");const E=[],P=x.match(/^#pragma\s+include\s+.*/mg);if(P){for(let R=0;R<P.length;R++){const b=P[R].match(/(?:<|")(.*)(?:>|")/);if(b){const j=b[0].indexOf("<")===0?"lib":"link";let O=b[1];if(O==="graph"&&(O="graphics"),T[O])E.push(`/* included ${O} */`);else if(T[O]=!0,j==="lib"){const L=h(l[O]);E.push(L)}else if(j==="link")throw new Error("Cannot load external links synchronously. Use compile instead of compileSync.")}}E.forEach(R=>{x=x.replace(/^#pragma\s+include\s+.*/m,R)})}return x}const m=h(w),d=y?h(y):null;return this.createProgram(m,d)}async compile(w,y){w=w||o.default;const T={};async function h(x){x=x.replace(/^\s*/mg,"");const E=[],P=x.match(/^#pragma\s+include\s+.*/mg);if(P){for(let R=0;R<P.length;R++){const b=P[R].match(/(?:<|")(.*)(?:>|")/);if(b){const j=b[0].indexOf("<")===0?"lib":"link";let O=b[1];if(O==="graph"&&(O="graphics"),T[O])E.push(`/* included ${O} */`);else if(T[O]=!0,j==="lib"){const L=await h(l[O]);E.push(L)}else if(j==="link"){let L=await v.fetchShader(O);L=await h(L),E.push(L)}}}E.forEach(R=>{x=x.replace(/^#pragma\s+include\s+.*/m,R)})}return x}const m=await h(w),d=y?await h(y):null;return this.createProgram(m,d)}async load(w,y=null){return w=await v.fetchShader(w),y&&(y=await v.fetchShader(y)),this.compile(w,y)}createTexture(w=null,{wrapS:y=this.gl.CLAMP_TO_EDGE,wrapT:T=this.gl.CLAMP_TO_EDGE,minFilter:h=this.gl.LINEAR,magFilter:m=this.gl.LINEAR}={}){const d=this.gl,M=Array.isArray(w)?d.TEXTURE_CUBE_MAP:d.TEXTURE_2D;this._max_texture_image_units=this._max_texture_image_units||d.getParameter(d.MAX_COMBINED_TEXTURE_IMAGE_UNITS),d.activeTexture(d.TEXTURE0+this._max_texture_image_units-1);const x=d.createTexture();d.bindTexture(M,x),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!0);const{width:E,height:P}=this.canvas;if(w)if(M===d.TEXTURE_CUBE_MAP)for(let R=0;R<6;R++)d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+R,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,w[R]);else d.texImage2D(M,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,w);else if(M===d.TEXTURE_CUBE_MAP)for(let R=0;R<6;R++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+R,0,d.RGBA,E,P,0,d.RGBA,d.UNSIGNED_BYTE,null);else d.texImage2D(M,0,d.RGBA,E,P,0,d.RGBA,d.UNSIGNED_BYTE,null);return d.texParameteri(M,d.TEXTURE_MIN_FILTER,h),d.texParameteri(M,d.TEXTURE_MAG_FILTER,m),d.texParameteri(M,d.TEXTURE_WRAP_S,y),d.texParameteri(M,d.TEXTURE_WRAP_T,T),M===d.TEXTURE_CUBE_MAP&&(w.width=w[0].width,w.height=w[0].height),d.bindTexture(M,null),x._img=w||{width:E,height:P},x.delete=()=>{this.deleteTexture(x)},x}deleteTexture(w){const y=w._img;this.gl.deleteTexture(w),typeof y.close=="function"&&y.close()}async loadTexture(w,{useImageBitmap:y=!0}={}){const T=await v.loadImage(w,{useImageBitmap:y});return this.createTexture(T)}createFBO({color:w=1,blend:y=!1,depth:T=this.options.depth!==!1,stencil:h=!!this.options.stencil}={}){const m=this.gl,d=m.createFramebuffer();m.bindFramebuffer(m.FRAMEBUFFER,d);const M=[];for(let P=0;P<w;P++){const R=this.createTexture();m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0+P,m.TEXTURE_2D,R,0),M.push(R)}d.textures=M,d.texture=M[0],d.blend=y;const{width:x,height:E}=this.canvas;return T&&!h&&(d.depthBuffer=m.createRenderbuffer(),m.bindRenderbuffer(m.RENDERBUFFER,d.depthBuffer),m.renderbufferStorage(m.RENDERBUFFER,m.DEPTH_COMPONENT16,x,E),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,d.depthBuffer)),h&&!T&&(d.stencilBuffer=m.createRenderbuffer(),m.bindRenderbuffer(m.RENDERBUFFER,d.stencilBuffer),m.renderbufferStorage(m.RENDERBUFFER,m.STENCIL_INDEX8,x,E),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.STENCIL_ATTACHMENT,m.RENDERBUFFER,d.stencilBuffer)),T&&h&&(d.depthStencilBuffer=m.createRenderbuffer(),m.bindRenderbuffer(m.RENDERBUFFER,d.depthStencilBuffer),m.renderbufferStorage(m.RENDERBUFFER,m.DEPTH_STENCIL,x,E),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_STENCIL_ATTACHMENT,m.RENDERBUFFER,d.depthStencilBuffer)),m.bindFramebuffer(m.FRAMEBUFFER,null),d}bindFBO(w=null){this.fbo=w}render({clearBuffer:w=!0}={}){this.startRender=!0;const y=this.gl;let T=this.program;T||(T=this.createProgram(),this.useProgram(T)),this.fbo&&y.bindFramebuffer(y.FRAMEBUFFER,this.fbo);const h=this.options.depth;h&&y.enable(y.DEPTH_TEST),this.gl.clear(this.gl.COLOR_BUFFER_BIT|(h?this.gl.DEPTH_BUFFER_BIT:0)|(this.options.stencil?this.gl.STENCIL_BUFFER_BIT:0));const m=this._renderFrameID;this._draw(),this.fbo&&y.bindFramebuffer(y.FRAMEBUFFER,null),this._renderFrameID===m&&(this._renderFrameID=null)}update(){this.startRender&&this._renderFrameID==null&&(this._renderFrameID=requestAnimationFrame(this.render.bind(this)))}}a(v,"defaultOptions",{preserveDrawingBuffer:!0,autoUpdate:!0,vertexPosition:"a_vertexPosition",vertexTextureCoord:"a_vertexTextureCoord",webgl2:!1}),a(v,"UBYTE",v.UNSIGNED_BYTE),a(v,"USHORT",v.UNSIGNED_SHORT),a(v,"fetchShader",r.fetchShader),a(v,"loadImage",r.loadImage)},function(n,t,e){e.r(t),e.d(t,"setupWebGL",function(){return i}),e.d(t,"createProgram",function(){return o}),e.d(t,"pointsToBuffer",function(){return s}),e.d(t,"loadImage",function(){return l}),e.d(t,"fetchShader",function(){return p}),e(1).glMatrix.setMatrixArrayType(Array);function r(c,g){const v=["webgl","experimental-webgl","webkit-3d","moz-webgl"];let I=null;for(let w=0;w<v.length;++w){try{I=c.getContext(v[w],g)}catch{}if(I)break}return I}function i(c,g){const v=r(c,g);if(!v)throw new Error("Sorry, your browser doesn't support WebGL.");return v}function o(c,g,v){const I=c.createShader(c.VERTEX_SHADER);if(c.shaderSource(I,g),c.compileShader(I),!c.getShaderParameter(I,c.COMPILE_STATUS)){const T=`Vertex shader failed to compile.  The error log is:${c.getShaderInfoLog(I)}`;throw new Error(T)}const w=c.createShader(c.FRAGMENT_SHADER);if(c.shaderSource(w,v),c.compileShader(w),!c.getShaderParameter(w,c.COMPILE_STATUS)){const T=`Fragment shader failed to compile.  The error log is:${c.getShaderInfoLog(w)}`;throw new Error(T)}const y=c.createProgram();if(c.attachShader(y,I),c.attachShader(y,w),c.linkProgram(y),!c.getProgramParameter(y,c.LINK_STATUS)){const T=`Shader program failed to link.  The error log is:${c.getProgramInfoLog(y)}`;throw new Error(T)}return c.deleteShader(I),c.deleteShader(w),y}function s(c,g=Float32Array,v=null){if(v&&!(v instanceof g))throw new TypeError("Wrong buffer type.");if(c==null||c instanceof g)return c;if(c[0]==null||c[0].length==null)return v?(v.set(c,0),v):new g(c);const I=c[0].length,w=c.length;v||(v=new g(I*w));let y=0;for(let T=0;T<w;T++)for(let h=0;h<I;h++)v[y++]=c[T][h];return v}const a={};function l(c,{useImageBitmap:g=!0,alias:v=null}={}){if(!a[c]){if(typeof Image=="function"){const I=new Image;typeof c=="string"&&!(typeof location=="object"&&/^file:/.test(location.href))&&!/^data:/.test(c)&&(I.crossOrigin="anonymous"),a[c]=new Promise(w=>{I.onload=function(){g&&typeof createImageBitmap=="function"?createImageBitmap(I,{imageOrientation:"flipY"}).then(y=>{a[c]=y,v&&(a[v]=y),w(y)}):(a[c]=I,v&&(a[v]=I),w(I))},I.src=c}),v&&(a[v]=a[c])}else if(typeof fetch=="function")return fetch(c,{method:"GET",mode:"cors",cache:"default"}).then(I=>I.blob()).then(I=>createImageBitmap(I,{imageOrientation:"flipY"}).then(w=>(a[c]=w,v&&(a[v]=w),w)))}return a[c]}const u={};async function p(c){if(u[c])return u[c];const g=await fetch(c);if(g.status>=200&&g.status<300){const v=await g.text();return u[c]=v,v}throw new Error("Shader loaded error.")}},function(n,t,e){e.r(t),t.default=`attribute vec3 a_vertexPosition;

void main() {
  gl_PointSize = 1.0;
  gl_Position = vec4(a_vertexPosition, 1);
}`},function(n,t,e){e.r(t),t.default=`#ifdef GL_ES
precision mediump float;
#endif

void main() {
  gl_FragColor = vec4(0.0, 0.0, 0.0, 0.1);
}`},function(n,t,e){e.r(t),t.default=`attribute vec4 a_vertexPosition;
attribute vec2 a_vertexTextureCoord;
varying vec2 vTextureCoord;

void main() {
  gl_PointSize = 1.0;
  gl_Position = a_vertexPosition;
  vTextureCoord = a_vertexTextureCoord;
}`},function(n,t,e){e.r(t),e.d(t,"default",function(){return s});var r=e(21),i=e(25);e(1).glMatrix.setMatrixArrayType(Array);const o=Symbol("transform");class s{constructor(l,u){this.context=l.getContext("2d"),this.options=u,this[o]=[1,0,0,1,0,0]}createTexture(l){return{_img:l}}async loadTexture(l){const u=await r.default.loadImage(l,{useImageBitmap:!1});return this.createTexture(u)}deleteTexture(l){return l}clear(l,u,p,c){const g=this.context;l=l||0,u=u||0,p=p||g.canvas.width-l,c=c||g.canvas.height-u,g.clearRect(l,u,p,c)}drawMeshCloud(l,{clear:u=!1}={}){const p=[];for(let c=0;c<l.amount;c++){const g=l.getTransform(c);let v=l.getTextureFrame(c);v&&(v=v._img);const I=l.getFilter(c),{fill:w,stroke:y}=l.getCloudRGBA(c);p.push({mesh:l.mesh,_cloudOptions:[w,y,v,g,I]})}l.beforeRender&&l.beforeRender(this.context,l),this.drawMeshes(p,{clear:u,hook:!1}),l.afterRender&&l.afterRender(this.context,l)}drawMeshes(l,{clear:u=!1,hook:p=!0}={}){const c=this.context;u&&c.clearRect(0,0,c.canvas.width,c.canvas.height);let g=null;const{width:v,height:I}=c.canvas,w=l.length;l.forEach((y,T)=>{let h,m,d,M,x;p&&y.beforeRender&&y.beforeRender(c,y),y._cloudOptions&&([h,m,d,M,x]=y._cloudOptions,y=y.mesh);let E=y.filter;if(x&&(E=E?`${E} ${x}`:x),E&&!this.filterBuffer&&this.filterBuffer!==!1){const P=r.default.createCanvas(v,I);P?this.filterBuffer=P.getContext("2d"):this.filterBuffer=!1}g&&g!==E&&(Object(i.applyFilter)(this.filterBuffer,g),c.drawImage(this.filterBuffer.canvas,0,0,v,I),this.filterBuffer.clearRect(0,0,v,I),g=null),E&&this.filterBuffer?(this.filterBuffer.save(),this.filterBuffer.transform(...this[o]),Object(i.drawMesh2D)(y,this.filterBuffer,!1,h,m,d,M),this.filterBuffer.restore(),T===w-1?(Object(i.applyFilter)(this.filterBuffer,E),c.drawImage(this.filterBuffer.canvas,0,0,v,I),this.filterBuffer.clearRect(0,0,v,I)):g=E):(c.save(),c.transform(...this[o]),Object(i.drawMesh2D)(y,c,!1,h,m,d,M),c.restore()),p&&y.afterRender&&y.afterRender(c,y)})}setTransform(l){this[o]=l}}},function(n,t,e){e.r(t),function(r){var i=e(14),o=e(23),s=e(24);e(1).glMatrix.setMatrixArrayType(Array);const a={};function l(v,I){const{style:w,variant:y,weight:T,stretch:h,size:m,pxLineHeight:d,family:M}=v;return h==="normal"?`${w} ${y} ${T} ${m*I}px/${d*I}px ${M}`:`${w} ${y} ${T} ${h} ${m*I}px/${d*I}px ${M}`}function u(v,{font:I,fillColor:w,strokeColor:y,strokeWidth:T,ratio:h=1,textCanvas:m,cachable:d=!1}){let M;if(d){M=[v,I,String(w),String(y),String(T)].join("###");const H=a[M];if(H)return H}m||(m=c(1,1));const x=m.getContext("2d");x.save(),x.font=I;let{width:E}=x.measureText(v);x.restore();const P=Object(o.default)(I),R=Math.max(P.pxLineHeight,P.pxHeight*1.13);/italic|oblique/.test(I)&&(E+=R*Math.tan(15*Math.PI/180)),!w&&!y&&(w="#000");const N=x.canvas,b=Math.ceil(E),j=Math.ceil(R);N.width=Math.round(b*h),N.height=Math.round(j*h),x.save(),x.font=l(P,h),x.textAlign="center",x.textBaseline="middle";const O=N.height*.5+P.pxHeight*.05*h,L=N.width*.5;if(w){if(Array.isArray(w))w=Object(s.default)(w);else if(w.vector){let H;const{vector:Q,colors:_}=w;Q.length===6?H=x.createRadialGradient(...Q):H=x.createLinearGradient(...Q),_.forEach(({offset:st,color:F})=>{H.addColorStop(st,F)}),w=H}x.fillStyle=w,x.fillText(v,L,O)}if(y){if(x.lineWidth=T*h,Array.isArray(y))y=Object(s.default)(y);else if(y.vector){let H;const{vector:Q,colors:_}=y;Q.length===6?H=x.createRadialGradient(...Q):H=x.createLinearGradient(...Q),_.forEach(({offset:st,color:F})=>{H.addColorStop(st,F)}),y=H}x.strokeStyle=y,x.strokeText(v,L,O)}x.restore();const k={image:m,rect:[0,0,b,j]};return d&&(a[M]=k),k}let p=!1;if(typeof navigator=="object"&&typeof navigator.userAgent=="string"){const v=navigator.userAgent.toLowerCase().match(/chrome\/(\d+)/);v&&(p=Number(v[1])<70)}function c(v,I,w={}){const y=w.offscreen||!p&&w.offscreen!==!1;let T;return typeof r<"u"&&typeof r.createCanvas=="function"?T=r.createCanvas(v,I,w):y&&typeof OffscreenCanvas=="function"?T=new OffscreenCanvas(v,I):(T=document.createElement("canvas"),T.width=v,T.height=I),T}const g={createCanvas:c,createText:u,loadImage:i.default.loadImage};t.default=g}.call(this,e(22))},function(n,t){var e;e=function(){return this}();try{e=e||new Function("return this")()}catch{typeof window=="object"&&(e=window)}n.exports=e},function(n,t,e){e.r(t),e.d(t,"default",function(){return w}),e(1).glMatrix.setMatrixArrayType(Array);function r(y,T){if(typeof y=="string"){const d=y.trim().match(/^([\d.]+)(px|pt|pc|in|cm|mm|em|ex|rem|q|vw|vh|vmax|vmin|%)$/);d?y={size:parseFloat(d[1]),unit:d[2]}:y={size:parseInt(y,10),unit:"px"}}let{size:h,unit:m}=y;if(m==="pt")h/=.75;else if(m==="pc")h*=16;else if(m==="in")h*=96;else if(m==="cm")h*=96/2.54;else if(m==="mm")h*=96/25.4;else if(m==="em"||m==="rem"||m==="ex"){if(!T&&typeof getComputedStyle=="function"&&typeof document<"u"){const d=getComputedStyle(document.documentElement).fontSize;T=r(d,16)}h*=T,m==="ex"&&(h/=2)}else if(m==="q")h*=96/25.4/4;else if(m==="vw"||m==="vh"){if(typeof document<"u"){const d=m==="vw"?document.documentElement.clientWidth:document.documentElement.clientHeight;h*=d/100}}else if((m==="vmax"||m==="vmin")&&typeof document<"u"){const d=document.documentElement.clientWidth,M=document.documentElement.clientHeight;m==="vmax"?h*=Math.max(d,M)/100:h*=Math.min(d,M)/100}return h}const i="bold|bolder|lighter|[1-9]00",o="italic|oblique",s="small-caps",a="ultra-condensed|extra-condensed|condensed|semi-condensed|semi-expanded|expanded|extra-expanded|ultra-expanded",l="px|pt|pc|in|cm|mm|em|ex|rem|q|vw|vh|vmax|vmin|%",u=`'([^']+)'|"([^"]+)"|([\\w-]|[-])+`,p=new RegExp(`(${i}) +`,"i"),c=new RegExp(`(${o}) +`,"i"),g=new RegExp(`(${s}) +`,"i"),v=new RegExp(`(${a}) +`,"i"),I=new RegExp("([\\d\\.]+)("+l+")(?:\\/([\\d\\.]+)("+l+"))? *((?:"+u+")( *, *(?:"+u+"))*)");function w(y,T){const h=I.exec(y);if(!h)return;const m=parseFloat(h[3]),d={weight:"normal",style:"normal",stretch:"normal",variant:"normal",size:parseFloat(h[1]),unit:h[2],lineHeight:Number.isFinite(m)?m:void 0,lineHeightUnit:h[4],family:h[5].replace(/ *, */g,",")},M=y.substring(0,h.index),x=p.exec(M),E=c.exec(M),P=g.exec(M),R=v.exec(M);return x&&(d.weight=x[1]),E&&(d.style=E[1]),P&&(d.variant=P[1]),R&&(d.stretch=R[1]),d.pxHeight=r({size:d.size,unit:d.unit},T),d.pxLineHeight=r({size:d.lineHeight||d.size,unit:d.lineHeightUnit||d.unit},T),d}},function(n,t,e){e.r(t),e.d(t,"default",function(){return r}),e(1).glMatrix.setMatrixArrayType(Array);function r(i){return`rgba(${i.map((o,s)=>s<3?Math.round(o*255):o).join()})`}},function(n,t,e){e.r(t),e.d(t,"applyFilter",function(){return a}),e.d(t,"drawMesh2D",function(){return u});var r=e(1),i=e(24),o=e(23),s=e(26);e(1).glMatrix.setMatrixArrayType(Array);function a(p,c){const g=p.canvas;p.save(),p.filter=c,p.drawImage(g,0,0,g.width,g.height),p.restore()}function l(p,c){const g=/rgba\((\d+),(\d+),(\d+),(\d+)\)/;p=p.match(g).slice(1,5).map(Number),c=c.match(g).slice(1,5).map(Number);const v=[],I=c[3];for(let w=0;w<4;w++)v[w]=Object(s.mix)(p[w],c[w],I);return`rgba(${v.join()})`}function u(p,c,g=!0,v=null,I=null,w=null,y=null){c.save();let T=!1,h=!1;if(c.globalAlpha=p.getOpacity(),p._updateMatrix&&p.transformScale/p.contours.scale>1.5&&p.accurate(p.transformScale),p.lineWidth){let M=p.gradient&&p.gradient.stroke;if(M){const{vector:x,colors:E}=M;if(x.length===6)M=c.createRadialGradient(...x);else if(x.length===4)M=c.createLinearGradient(...x);else if(x.length===3)M=c.createCircularGradient(...x);else throw new TypeError("Invalid vector dimension.");E.forEach(({offset:P,color:R})=>{let N=Object(i.default)(R);I&&(N=l(N,I)),M.addColorStop(P,N)}),c.strokeStyle=M,T=!0}else p.strokeStyle&&(I?c.strokeStyle=l(p.strokeStyle,I):c.strokeStyle=p.strokeStyle,T=!0)}T&&(c.lineWidth=p.lineWidth,c.lineJoin=p.lineJoin,c.lineCap=p.lineCap,c.miterLimit=p.miterLimit,p.lineDash&&(c.setLineDash(p.lineDash),p.lineDashOffset&&(c.lineDashOffset=p.lineDashOffset)));let m=p.gradient&&p.gradient.fill;if(m){const{vector:M,colors:x}=m;if(M.length===6)m=c.createRadialGradient(...M);else if(M.length===4)m=c.createLinearGradient(...M);else if(M.length===3)m=c.createCircularGradient(...M);else throw new TypeError("Invalid vector dimension.");x.forEach(({offset:E,color:P})=>{let R=Object(i.default)(P);I&&(R=l(R,I)),m.addColorStop(E,R)}),c.fillStyle=m,h=!0}else p.fillStyle&&(v?c.fillStyle=l(p.fillStyle,v):c.fillStyle=p.fillStyle,h=!0);if(y&&c.transform(...y),c.transform(...p.transformMatrix),p.clipPath){const M=p.clipPath,x=new Path2D(M);c.clip(x)}const d=p.contours.length;if(p.contours.forEach((M,x)=>{const E=M.length,P=E>1&&r.vec2.equals(M[0],M[E-1]),R=x===d-1&&p.texture;if(M&&E>0){if(h||T||R){c.beginPath(),c.moveTo(...M[0]);for(let N=1;N<E;N++)N===E-1&&P?c.closePath():c.lineTo(...M[N])}if(h&&c.fill(p.fillRule),R){c.save(),c.clip();let{image:N,options:b}=p.texture;if(w&&(N=w),b.repeat&&console.warn("Context 2D not supported image repeat yet."),N.font){b.scale&&console.warn("Context 2D not supported text scale yet."),b.srcRect&&console.warn("Context 2D not supported text srcRect yet.");let{font:j,fillColor:O,strokeColor:L,strokeWidth:k,text:H}=N;!O&&!L&&(O="#000"),Array.isArray(O)&&(O=Object(i.default)(O)),Array.isArray(L)&&(L=Object(i.default)(L)),c.font=j;const{width:Q}=c.measureText(H),_=Object(o.default)(j),st=Math.max(_.pxLineHeight,_.pxHeight*1.13);c.textAlign="center",c.textBaseline="middle";const F=b.rect,Z=F[0]+st*.5+_.pxHeight*.06,tt=F[1]+Q*.5;F[2]!=null&&c.scale(F[2]/Q,F[3]/st),O&&(c.fillStyle=O,c.fillText(H,tt,Z)),L&&(c.lineWidth=k,c.strokeStyle=L,c.strokeText(H,tt,Z))}else{let j=b.rect;const O=b.srcRect;b.scale&&(j=[0,0,c.canvas.width,c.canvas.height]),b.rotated&&j&&(j=[-j[1],j[0],j[3],j[2]]),O&&(j=j||[0,0,O[2],O[3]]),b.rotated&&(c.translate(0,j?j[2]:N.width),c.rotate(-.5*Math.PI)),O?c.drawImage(N,...O,...j):j?c.drawImage(N,...j):c.drawImage(N,0,0)}c.restore()}T&&c.stroke()}}),c.restore(),g){const M=p.filter;M&&a(c,M)}}},function(n,t,e){e.r(t),e.d(t,"clamp",function(){return r}),e.d(t,"mix",function(){return i}),e.d(t,"transformPoint",function(){return o}),e(1).glMatrix.setMatrixArrayType(Array);function r(s,a,l){return a>l&&([a,l]=[l,a]),s<a?a:s>l?l:s}function i(s,a,l){return s*(1-l)+a*l}function o(s,a){const[l,u]=s;return[l*a[0]+u*a[2]+a[4],l*a[1]+u*a[3]+a[5]]}},function(n,t,e){e.r(t),e.d(t,"default",function(){return l});var r=e(28),i=e(29);e(1).glMatrix.setMatrixArrayType(Array);function o(u,p,c){const g=u.uniforms||{},v=p.uniforms||{};if(g.u_texSampler&&v.u_texSampler&&g.u_texSampler!==v.u_texSampler)return!1;const I=Object.keys(g),w=Object.keys(v),y=I.indexOf("u_texSampler"),T=w.indexOf("u_texSampler");if(y>=0&&I.splice(y,1),T>=0&&w.splice(T,1),I.length!==w.length)return!1;const h=I.every(m=>{const d=g[m],M=v[m];if(d===M)return!0;if(d.length&&M.length&&d.length===M.length){for(let x=0;x<d.length;x++)if(d[x]!==M[x])return!1;return!0}return!1});if(h){if(g.u_texSampler&&!v.u_texSampler)p.setTexture(g.u_texSampler,{hidden:!0});else if(!g.u_texSampler&&v.u_texSampler)for(let m=0;m<c.length;m++)c[m].setTexture(v.u_texSampler,{hidden:!0})}return h}const s={};function a(u,p){if(u.length){const c=Object(r.default)(u,s);return c.enableBlend=p,u[0].filterCanvas&&(c.filterCanvas=!0),c.packIndex=u[0].packIndex,c.packLength=u.length,c.beforeRender=u[0].beforeRender,c.pass=u[0].pass,c.afterRender=u[u.length-1].afterRender,u.length=0,c}}function*l(u,p,c=!1){const g=[],v=u.options.bufferSize;let I=0,w=!1;for(let y=0;y<p.length;y++){const T=p[y];if(T instanceof i.default)g.length&&(yield a(g,w)),I=0,w=!1,yield T;else{const h=T.meshData;if(h.clipPath&&!h.uniforms.u_clipSampler){const d=u.createTexture(h.clipPath);h.uniforms.u_clipSampler=d}let m=0;if((!c||!T.canIgnore())&&h&&h.positions.length){T.packIndex=y;const d=T.filterCanvas;if(m=h.positions.length,d||I+m>v)g.length&&(yield a(g,w)),I=0,w=!1;else if(I){const M=g[g.length-1];M&&(M.filterCanvas||M.afterRender||T.beforeRender||M.pass.length||T.pass.length||M.program!==T.program||!o(M,T,g))&&(yield a(g,w),I=0,w=!1)}g.push(T),w=w||T.enableBlend,I+=m}y===p.length-1&&g.length&&(yield a(g,w))}}}},function(n,t,e){e.r(t),e.d(t,"default",function(){return o}),e(1).glMatrix.setMatrixArrayType(Array);const r={UNSIGNED_BYTE:Uint8Array,UNSIGNED_SHORT:Uint16Array,BYTE:Int8Array,SHORT:Int16Array,FLOAT:Float32Array};function i(s,a){let l=0,u=0,p=0,c=0,g=0,v=0,I=0;const w=s[0].program;for(let y=0;y<s.length;y++){const T=s[y].meshData;if(T){I+=T.positions.length;const h=T.positions[0].length;l+=T.positions.length*h,u+=T.cells.length*3,v+=T.attributes.a_color.length*4;const m=T.textureCoord;m&&(p+=m.length*m[0].length);const d=T.attributes.a_sourceRect;d&&(c+=d.length*4);const M=T.attributes.a_clipUV;M&&(g+=M.length*2)}}if((!a.positions||a.positions.length<l)&&(a.positions=new Float32Array(l)),(!a.cells||a.cells.length<u)&&(a.cells=new Uint16Array(u)),p&&(!a.textureCoord||a.textureCoord.length<p)&&(a.textureCoord=new Float32Array(p)),(!a.a_color||a.a_color.length<v)&&(a.a_color=new Uint8Array(v)),c&&(!a.a_sourceRect||a.a_sourceRect.length<c)&&(a.a_sourceRect=new Float32Array(c)),g&&(!a.a_clipUV||a.a_clipUV.length<g)&&(a.a_clipUV=new Float32Array(g)),w){const y=Object.entries(w._attribute),T=w._attribOpts||{};for(let h=0;h<y.length;h++){const[m,d]=y[h];if(m!=="a_color"&&m!=="a_sourceRect"&&d!=="ignored"){const M=T[m]?T[m].type:"FLOAT",x=r[M],E=d.size*I;(!a[m]||a[m].length<E)&&(a[m]=new x(E))}}}return a}function o(s,a){let l=[],u=[],p=[],c=[],g=[],v=[],I=0,w=0;const y=s[0]?s[0].uniforms||{}:{},T=s[0]?s[0].program:null;a&&(i(s,a),u=a.cells,l=a.positions,p=a.textureCoord,c=a.a_color,g=a.a_sourceRect,v=a.a_clipUV);let h=!1,m=!1;const d={};for(let x=0;x<s.length;x++){let E=s[x];if(E){if(E.meshData&&(E=E.meshData),a){const R=E.positions;for(let N=0;N<R.length;N++){const b=R[N],j=3*(I+N);for(let O=0;O<b.length;O++)l[j+O]=b[O]}}else l.push(...E.positions);const P=E.cells;for(let R=0;R<P.length;R++){const N=P[R];if(a){const b=3*(w+R);u[b]=N[0]+I,u[b+1]=N[1]+I,u[b+2]=N[2]+I}else u.push([N[0]+I,N[1]+I,N[2]+I])}if(a){const R=E.attributes.a_color;for(let N=0;N<R.length;N++){const b=R[N],j=4*(I+N);c[j]=b[0],c[j+1]=b[1],c[j+2]=b[2],c[j+3]=b[3]}}else c.push(...E.attributes.a_color);if(E.attributes.a_sourceRect)if(h=!0,a){const R=E.attributes.a_sourceRect;for(let N=0;N<R.length;N++){const b=R[N],j=4*(I+N);g[j]=b[0],g[j+1]=b[1],g[j+2]=b[2],g[j+3]=b[3]}}else g.push(...E.attributes.a_sourceRect);if(E.attributes.a_clipUV)if(m=!0,a){const R=E.attributes.a_clipUV;for(let N=0;N<R.length;N++){const b=R[N],j=2*(I+N);v[j]=b[0],v[j+1]=b[1]}}else v.push(...E.attributes.a_clipUV);if(E.textureCoord)if(a){const R=E.textureCoord;for(let N=0;N<R.length;N++){const b=R[N],j=3*(I+N);for(let O=0;O<b.length;O++)p[j+O]=b[O]}}else p.push(...E.textureCoord);if(T){const R=Object.entries(T._attribute);for(let N=0;N<R.length;N++){const[b,j]=R[N];if(b!=="a_color"&&b!=="a_sourceRect"&&j!=="ignored")if(d[b]=[],a){d[b]=a[b];const O=E.attributes[b],L=O[0].length;for(let k=0;k<O.length;k++){const H=O[k],Q=L*(I+k);for(let _=0;_<H.length;_++)d[b][Q+_]=H[_]}}else d[b].push(...E.attributes[b])}}I+=E.positions.length,w+=E.cells.length}}d.a_color=c,h&&g&&g.length>0&&(d.a_sourceRect=g);const M={positions:l,cells:u,attributes:d,uniforms:y,cellsCount:w*3,program:T};return p&&p.length&&(M.textureCoord=p),m&&v.length>0&&(d.a_clipUV=v),M}},function(n,t,e){e.r(t);var r=e(1),i=e(30),o=e(26),s=e(31);e(1).glMatrix.setMatrixArrayType(Array);function a(d,M){var x=Object.keys(d);if(Object.getOwnPropertySymbols){var E=Object.getOwnPropertySymbols(d);M&&(E=E.filter(function(P){return Object.getOwnPropertyDescriptor(d,P).enumerable})),x.push.apply(x,E)}return x}function l(d){for(var M=1;M<arguments.length;M++){var x=arguments[M]!=null?arguments[M]:{};M%2?a(Object(x),!0).forEach(function(E){u(d,E,x[E])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(x)):a(Object(x)).forEach(function(E){Object.defineProperty(d,E,Object.getOwnPropertyDescriptor(x,E))})}return d}function u(d,M,x){return M in d?Object.defineProperty(d,M,{value:x,enumerable:!0,configurable:!0,writable:!0}):d[M]=x,d}const p=Symbol("mesh"),c=Symbol("count"),g=Symbol("blend"),v=Symbol("filter"),I=Symbol("textures"),w=Symbol("textureOptions"),y=Symbol("cloudColor"),T=Symbol("cloudFilter"),h=Symbol("buffer");function m(d,M=null){const x=new Float32Array(3*d),E=new Float32Array(3*d),P=new Float32Array(4*d),R=new Float32Array(4*d),N=new Float32Array(4*d),b=new Float32Array(4*d),j=new Float32Array(4*d),O=new Uint8Array(d),L=new Uint8Array(4*d),k=new Uint8Array(4*d);return M&&(x.set(M.transform0,0),E.set(M.transform1,0),P.set(M.color0,0),R.set(M.color1,0),N.set(M.color2,0),b.set(M.color3,0),j.set(M.color4,0),O.set(M.frameIndex,0),L.set(M.fillColor,0),k.set(M.strokeColor,0)),{bufferSize:d,transform0:x,transform1:E,color0:P,color1:R,color2:N,color3:b,color4:j,frameIndex:O,fillColor:L,strokeColor:k}}t.default=class{constructor(d,M=1,{buffer:x=1e3}={}){x=Math.max(x,M),this[c]=M,this[p]=d,this[h]=m(x),this[I]=[],this[v]=[],this[y]=!1,this[T]=!1,this[g]=!1,this.initBuffer()}initBuffer(d=0){const M=this[c];for(let x=d;x<M;x++)this[h].transform0.set([1,0,0],x*3),this[h].transform1.set([0,1,0],x*3),this[h].frameIndex.set([-1],x),this[h].fillColor.set([0,0,0,0],x*4),this[h].strokeColor.set([0,0,0,0],x*4),this.setColorTransform(x,null)}get bufferSize(){return this[h].bufferSize}get mesh(){return this[p]}set mesh(d){this[p]=d,this[I]&&this.setTextureFrames(this[I],this[w])}get hasCloudColor(){return this[y]}get hasCloudFilter(){return this[T]}_getFilter(d){return this[v][d]=this[v][d]||[],this[v][d]}getFilter(d){return this._getFilter(d).join(" ")}get enableBlend(){return this[p].enableBlend||this[g]}canIgnore(){return this[p].canIgnore()}delete(d){if(d>=this[c]||d<0)throw new Error("Out of range.");const{transform0:M,transform1:x,color0:E,color1:P,color2:R,color3:N,color4:b,frameIndex:j,fillColor:O,strokeColor:L}=this[h];M.set(M.subarray(3*(d+1)),3*d),x.set(x.subarray(3*(d+1)),3*d),E.set(E.subarray(4*(d+1)),4*d),P.set(P.subarray(4*(d+1)),4*d),R.set(R.subarray(4*(d+1)),4*d),N.set(N.subarray(4*(d+1)),4*d),b.set(b.subarray(4*(d+1)),4*d),j.set(j.subarray(d+1),d),O.set(O.subarray(4*(d+1)),4*d),L.set(L.subarray(4*(d+1)),4*d);for(const k in this[v])k===d?delete this[v][k]:k>d&&(this[v][k-1]=this[v][k],delete this[v][k]);this[c]--}setColorTransform(d,M){if(d>=this[c]||d<0)throw new Error("Out of range.");d*=4;const{color0:x,color1:E,color2:P,color3:R,color4:N}=this[h];return M!=null?(x.set([M[0],M[5],M[10],M[15]],d),E.set([M[1],M[6],M[11],M[16]],d),P.set([M[2],M[7],M[12],M[17]],d),R.set([M[3],M[8],M[13],M[18]],d),N.set([M[4],M[9],M[14],M[19]],d),this[g]=this[g]||M[18]<1,this[T]=!0):(x.set([1,0,0,0],d),E.set([0,1,0,0],d),P.set([0,0,1,0],d),R.set([0,0,0,1],d),N.set([0,0,0,0],d)),this}getColorTransform(d){if(d>=this[c]||d<0)throw new Error("Out of range.");d*=4;const{color0:M,color1:x,color2:E,color3:P,color4:R}=this[h];return[M[d],x[d],E[d],P[d],R[d],M[d+1],x[d+1],E[d+1],P[d+1],R[d+1],M[d+2],x[d+2],E[d+2],P[d+2],R[d+2],M[d+3],x[d+3],E[d+3],P[d+3],R[d+3]]}transformColor(d,M){let x=this.getColorTransform(d);return x=Object(i.multiply)(x,M),this.setColorTransform(d,x),this}setFillColor(d,M){if(d>=this[c]||d<0)throw new Error("Out of range.");typeof M=="string"&&(M=Object(s.default)(M)),M[3]>0&&(this[y]=!0),this[h].fillColor.set(M.map(x=>Math.round(255*x)),4*d)}setStrokeColor(d,M){if(d>=this[c]||d<0)throw new Error("Out of range.");typeof M=="string"&&(M=Object(s.default)(M)),M[3]>0&&(this[y]=!0),this[h].strokeColor.set(M.map(x=>Math.round(255*x)),4*d)}getCloudRGBA(d){if(d>=this[c]||d<0)throw new Error("Out of range.");d*=4;const{fillColor:M,strokeColor:x}=this[h],E=[M[d],M[d+1],M[d+2],M[d+3]],P=[x[d],x[d+1],x[d+2],x[d+3]];return E[3]/=255,P[3]/=255,{fill:`rgba(${E.join()})`,stroke:`rgba(${P.join()})`}}grayscale(d,M){this.transformColor(d,Object(i.grayscale)(M)),this._getFilter(d).push(`grayscale(${100*M}%)`)}brightness(d,M){this.transformColor(d,Object(i.brightness)(M)),this._getFilter(d).push(`brightness(${100*M}%)`)}saturate(d,M){this.transformColor(d,Object(i.saturate)(M)),this._getFilter(d).push(`saturate(${100*M}%)`)}contrast(d,M){this.transformColor(d,Object(i.contrast)(M)),this._getFilter(d).push(`contrast(${100*M}%)`)}invert(d,M){this.transformColor(d,Object(i.invert)(M)),this._getFilter(d).push(`invert(${100*M}%)`)}sepia(d,M){this.transformColor(d,Object(i.sepia)(M)),this._getFilter(d).push(`sepia(${100*M}%)`)}opacity(d,M){this.transformColor(d,Object(i.opacity)(M)),this._getFilter(d).push(`opacity(${100*M}%)`)}hueRotate(d,M){this.transformColor(d,Object(i.hueRotate)(M)),this._getFilter(d).push(`hue-rotate(${M}deg)`)}setTransform(d,M){if(d>=this[c]||d<0)throw new Error("Out of range.");d*=3,M==null&&(M=[1,0,0,1,0,0]);const{transform0:x,transform1:E}=this[h];return x.set([M[0],M[2],M[4]],d),E.set([M[1],M[3],M[5]],d),this}getTransform(d){if(d>=this[c]||d<0)throw new Error("Out of range.");d*=3;const{transform0:M,transform1:x}=this[h];return[M[d],x[d],M[d+1],x[d+1],M[d+2],x[d+2]]}getTextureFrame(d){return this[I][this[h].frameIndex[d]]}setTextureFrames(d=[],M={}){if(d.length>12)throw new Error("Max frames exceed. Allow 12 frames.");d.length&&this[p].setTexture(d[0],M),this[I]=d,this[w]=M}setFrameIndex(d,M){if(d>=this[c]||d<0)throw new Error("Out of range.");const x=this[I].length;if(x<=0)throw new Error("No frames");this[h].frameIndex[d]=M%x}get amount(){return this[c]}set amount(d){const M=this[c];d!==M&&(d>this[h].bufferSize&&(this[h]=m(Math.max(d,this[h].bufferSize+1e3),this[h])),this[c]=d,d>M&&this.initBuffer(M))}get meshData(){const{attributes:d,cells:M,positions:x,textureCoord:E,uniforms:P}=this[p].meshData,R=this[I],N={attributes:l({},d),cells:M,positions:x,textureCoord:E,uniforms:l({},P),instanceCount:this[c],enableBlend:this.enableBlend};R.length&&R.forEach((Z,tt)=>{N.uniforms[`u_texFrame${tt}`]=Z});const{transform0:b,transform1:j,color0:O,color1:L,color2:k,color3:H,color4:Q,fillColor:_,strokeColor:st,frameIndex:F}=this[h];return this[p].uniforms.u_texSampler&&(N.attributes.a_frameIndex={data:F,divisor:1}),N.attributes.a_transform0={data:b,divisor:1},N.attributes.a_transform1={data:j,divisor:1},N.attributes.a_colorCloud0={data:O,divisor:1},N.attributes.a_colorCloud1={data:L,divisor:1},N.attributes.a_colorCloud2={data:k,divisor:1},N.attributes.a_colorCloud3={data:H,divisor:1},N.attributes.a_colorCloud4={data:Q,divisor:1},this.hasCloudColor&&(N.attributes.a_fillCloudColor={data:_,divisor:1},N.attributes.a_strokeCloudColor={data:st,divisor:1}),N}setProgram(d){this[p].setProgram(d)}get program(){return this[p].program}transform(d,M){const x=this.getTransform(d);return M=r.mat2d.multiply(Array.of(0,0,0,0,0,0),x,M),this.setTransform(d,M),this}translate(d,[M,x]){let E=r.mat2d.create();return E=r.mat2d.translate(Array.of(0,0,0,0,0,0),E,[M,x]),this.transform(d,E)}rotate(d,M,[x,E]=[0,0]){let P=r.mat2d.create();return P=r.mat2d.translate(Array.of(0,0,0,0,0,0),P,[x,E]),P=r.mat2d.rotate(Array.of(0,0,0,0,0,0),P,M),P=r.mat2d.translate(Array.of(0,0,0,0,0,0),P,[-x,-E]),this.transform(d,P)}scale(d,[M,x=M],[E,P]=[0,0]){let R=r.mat2d.create();return R=r.mat2d.translate(Array.of(0,0,0,0,0,0),R,[E,P]),R=r.mat2d.scale(Array.of(0,0,0,0,0,0),R,[M,x]),R=r.mat2d.translate(Array.of(0,0,0,0,0,0),R,[-E,-P]),this.transform(d,R)}skew(d,[M,x=M],[E,P]=[0,0]){let R=r.mat2d.create();return R=r.mat2d.translate(Array.of(0,0,0,0,0,0),R,[E,P]),R=r.mat2d.multiply(Array.of(0,0,0,0,0,0),R,r.mat2d.fromValues(1,Math.tan(x),Math.tan(M),1,0,0)),R=r.mat2d.translate(Array.of(0,0,0,0,0,0),R,[-E,-P]),this.transform(d,R)}isPointCollision(d,[M,x],E="both"){const P=this.getTransform(d),R=Object(o.transformPoint)([M,x],r.mat2d.invert(Array.of(0,0,0,0,0,0),P));return this[p].isPointCollision(...R,E)}isPointInFill(d,[M,x]){return this.isPointCollision(d,[M,x],"fill")}isPointInStroke(d,[M,x]){return this.isPointCollision(d,[M,x],"stroke")}}},function(n,t,e){e.r(t),e.d(t,"multiply",function(){return i}),e.d(t,"grayscale",function(){return o}),e.d(t,"brightness",function(){return s}),e.d(t,"saturate",function(){return a}),e.d(t,"contrast",function(){return l}),e.d(t,"invert",function(){return u}),e.d(t,"sepia",function(){return p}),e.d(t,"opacity",function(){return c}),e.d(t,"hueRotate",function(){return g});var r=e(26);e(1).glMatrix.setMatrixArrayType(Array);function i(v,I){const w=[],y=v[0],T=v[1],h=v[2],m=v[3],d=v[4],M=v[5],x=v[6],E=v[7],P=v[8],R=v[9],N=v[10],b=v[11],j=v[12],O=v[13],L=v[14],k=v[15],H=v[16],Q=v[17],_=v[18],st=v[19];let F=I[0],Z=I[1],tt=I[2],ct=I[3],at=I[4];return w[0]=F*y+Z*M+tt*N+ct*k,w[1]=F*T+Z*x+tt*b+ct*H,w[2]=F*h+Z*E+tt*j+ct*Q,w[3]=F*m+Z*P+tt*O+ct*_,w[4]=F*d+Z*R+tt*L+ct*st+at,F=I[5],Z=I[6],tt=I[7],ct=I[8],at=I[9],w[5]=F*y+Z*M+tt*N+ct*k,w[6]=F*T+Z*x+tt*b+ct*H,w[7]=F*h+Z*E+tt*j+ct*Q,w[8]=F*m+Z*P+tt*O+ct*_,w[9]=F*d+Z*R+tt*L+ct*st+at,F=I[10],Z=I[11],tt=I[12],ct=I[13],at=I[14],w[10]=F*y+Z*M+tt*N+ct*k,w[11]=F*T+Z*x+tt*b+ct*H,w[12]=F*h+Z*E+tt*j+ct*Q,w[13]=F*m+Z*P+tt*O+ct*_,w[14]=F*d+Z*R+tt*L+ct*st+at,F=I[15],Z=I[16],tt=I[17],ct=I[18],at=I[19],w[15]=F*y+Z*M+tt*N+ct*k,w[16]=F*T+Z*x+tt*b+ct*H,w[17]=F*h+Z*E+tt*j+ct*Q,w[18]=F*m+Z*P+tt*O+ct*_,w[19]=F*d+Z*R+tt*L+ct*st+at,w}function o(v){v=Object(r.clamp)(0,1,v);const I=.2126*v,w=.7152*v,y=.0722*v;return[I+1-v,w,y,0,0,I,w+1-v,y,0,0,I,w,y+1-v,0,0,0,0,0,1,0]}function s(v){return[v,0,0,0,0,0,v,0,0,0,0,0,v,0,0,0,0,0,1,0]}function a(v){const I=.2126*(1-v),w=.7152*(1-v),y=.0722*(1-v);return[I+v,w,y,0,0,I,w+v,y,0,0,I,w,y+v,0,0,0,0,0,1,0]}function l(v){const I=.5*(1-v);return[v,0,0,0,I,0,v,0,0,I,0,0,v,0,I,0,0,0,1,0]}function u(v){const I=1-2*v;return[I,0,0,0,v,0,I,0,0,v,0,0,I,0,v,0,0,0,1,0]}function p(v){return[1-.607*v,.769*v,.189*v,0,0,.349*v,1-.314*v,.168*v,0,0,.272*v,.534*v,1-.869*v,0,0,0,0,0,1,0]}function c(v){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,v,0]}function g(v){const I=v/180*Math.PI,w=Math.cos(I),y=Math.sin(I),T=.2126,h=.7152,m=.0722;return[T+w*(1-T)+y*-T,h+w*-h+y*-h,m+w*-m+y*(1-m),0,0,T+w*-T+y*.143,h+w*(1-h)+y*.14,m+w*-m+y*-.283,0,0,T+w*-T+y*-.7874,h+w*-h+y*h,m+w*(1-m)+y*m,0,0,0,0,0,1,0]}},function(n,t,e){e.r(t),e.d(t,"default",function(){return o});var r=e(32),i=e.n(r);e(1).glMatrix.setMatrixArrayType(Array);function o(s){const a=i()(s);if(!a||!a.length)throw new TypeError("Invalid color value.");return[a[0]/255,a[1]/255,a[2]/255,a[3]]}},function(n,t,e){var r=e(33),i=e(37),o=e(39);n.exports=function(a){var l,u=r(a);return u.space?(l=Array(3),l[0]=o(u.values[0],0,255),l[1]=o(u.values[1],0,255),l[2]=o(u.values[2],0,255),u.space[0]==="h"&&(l=i.rgb(l)),l.push(o(u.alpha,0,1)),l):[]}},function(n,t,e){(function(r){var i=e(34),o=e(35),s=e(36);n.exports=l;var a={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function l(u){var p,c=[],g=1,v;if(typeof u=="string")if(i[u])c=i[u].slice(),v="rgb";else if(u==="transparent")g=0,v="rgb",c=[0,0,0];else if(/^#[A-Fa-f0-9]+$/.test(u)){var I=u.slice(1),w=I.length,y=w<=4;g=1,y?(c=[parseInt(I[0]+I[0],16),parseInt(I[1]+I[1],16),parseInt(I[2]+I[2],16)],w===4&&(g=parseInt(I[3]+I[3],16)/255)):(c=[parseInt(I[0]+I[1],16),parseInt(I[2]+I[3],16),parseInt(I[4]+I[5],16)],w===8&&(g=parseInt(I[6]+I[7],16)/255)),c[0]||(c[0]=0),c[1]||(c[1]=0),c[2]||(c[2]=0),v="rgb"}else if(p=/^((?:rgb|hs[lvb]|hwb|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms)a?)\s*\(([^\)]*)\)/.exec(u)){var T=p[1],h=T==="rgb",I=T.replace(/a$/,"");v=I;var w=I==="cmyk"?4:I==="gray"?1:3;c=p[2].trim().split(/\s*,\s*/).map(function(x,E){if(/%$/.test(x))return E===w?parseFloat(x)/100:I==="rgb"?parseFloat(x)*255/100:parseFloat(x);if(I[E]==="h"){if(/deg$/.test(x))return parseFloat(x);if(a[x]!==void 0)return a[x]}return parseFloat(x)}),T===I&&c.push(1),g=h||c[w]===void 0?1:c[w],c=c.slice(0,w)}else u.length>10&&/[0-9](?:\s|\/)/.test(u)&&(c=u.match(/([0-9]+)/g).map(function(d){return parseFloat(d)}),v=u.match(/([a-z])/ig).join("").toLowerCase());else if(!isNaN(u))v="rgb",c=[u>>>16,(u&65280)>>>8,u&255];else if(o(u)){var m=s(u.r,u.red,u.R,null);m!==null?(v="rgb",c=[m,s(u.g,u.green,u.G),s(u.b,u.blue,u.B)]):(v="hsl",c=[s(u.h,u.hue,u.H),s(u.s,u.saturation,u.S),s(u.l,u.lightness,u.L,u.b,u.brightness)]),g=s(u.a,u.alpha,u.opacity,1),u.opacity!=null&&(g/=100)}else(Array.isArray(u)||r.ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(u))&&(c=[u[0],u[1],u[2]],v="rgb",g=u.length===4?u[3]:1);return{space:v,values:c,alpha:g}}}).call(this,e(22))},function(n,t,e){n.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},function(n,t,e){var r=Object.prototype.toString;n.exports=function(i){var o;return r.call(i)==="[object Object]"&&(o=Object.getPrototypeOf(i),o===null||o===Object.getPrototypeOf({}))}},function(n,t){n.exports=function(){for(var e=0;e<arguments.length;e++)if(arguments[e]!==void 0)return arguments[e]}},function(n,t,e){var r=e(38);n.exports={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(i){var o=i[0]/360,s=i[1]/100,a=i[2]/100,l,u,p,c,g;if(s===0)return g=a*255,[g,g,g];a<.5?u=a*(1+s):u=a+s-a*s,l=2*a-u,c=[0,0,0];for(var v=0;v<3;v++)p=o+1/3*-(v-1),p<0?p++:p>1&&p--,6*p<1?g=l+(u-l)*6*p:2*p<1?g=u:3*p<2?g=l+(u-l)*(2/3-p)*6:g=l,c[v]=g*255;return c}},r.hsl=function(i){var o=i[0]/255,s=i[1]/255,a=i[2]/255,l=Math.min(o,s,a),u=Math.max(o,s,a),p=u-l,c,g,v;return u===l?c=0:o===u?c=(s-a)/p:s===u?c=2+(a-o)/p:a===u&&(c=4+(o-s)/p),c=Math.min(c*60,360),c<0&&(c+=360),v=(l+u)/2,u===l?g=0:v<=.5?g=p/(u+l):g=p/(2-u-l),[c,g*100,v*100]}},function(n,t,e){n.exports={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]}},function(n,t){n.exports=e;function e(r,i,o){return i<o?r<i?i:r>o?o:r:r<o?o:r>i?i:r}},function(n,t,e){e.r(t),e.d(t,"default",function(){return m});var r=e(41),i=e.n(r),o=e(42),s=e.n(o),a=e(43),l=e.n(a),u=e(44),p=e(46),c=e.n(p),g=e(53),v=e(55);e(1).glMatrix.setMatrixArrayType(Array);const I=Symbol("contours"),w=Symbol("path"),y=Symbol("simplify"),T=Symbol("scale"),h=2*Math.PI;class m{constructor(M={}){typeof M=="string"&&(M={path:M}),M.path?this[w]=i()(M.path):this[w]=[],this[I]=null,this[y]=M.simplify!=null?M.simplify:0,this[T]=M.scale!=null?M.scale:2}get contours(){let M=null;if(!this[I]&&this[w]){const x=Object(u.default)(l()(this[w]));this[I]=c()(x,this[T],this[y]),this[I].path=x,this[I].simplify=this[y],this[I].scale=this[T]}return this[I]&&(M=this[I].map(x=>[...x]),M.path=this[I].path,M.simplify=this[I].simplify,M.scale=this[I].scale),M}get path(){return this[w]}get simplify(){return this[y]}get boundingBox(){const M=this.contours;if(M&&M.length){const x=M.reduce((E,P)=>[...E,...P]);return s()(x)}return[[0,0],[0,0]]}get boundingCenter(){const M=this.boundingBox;return M?[.5*(M[0][0]+M[1][0]),.5*(M[0][1]+M[1][1])]:[0,0]}normalize(M=0,x=0){const E=Object(u.default)(l()(this[w])).map(([P,...R])=>{const N=[P];for(let b=0;b<R.length;b+=2){const j=R[b]-M,O=R[b+1]-x;N.push(j,O)}return N});return this.beginPath(),this[w].push(...E),this}getPointAtLength(M){return this.contours?Object(g.getPointAtLength)(this[I],M):null}getTotalLength(){return this.contours?Object(g.getTotalLength)(this[I]):0}addPath(M){this[I]=null,typeof M=="string"&&(M=i()(M)),this[w].push(...M)}beginPath(){this[w]=[],this[I]=null}clear(){this.beginPath()}ellipse(M,x,E,P,R,N,b,j=0){if(N+=R,b+=R,E<=0||P<=0||b===N)return;b<N&&(b=N+h+(b-N)%h),b-N>h&&(b=N+h);const O=b-N;O>=h&&(b-=.001);let L=this[w].length>0&&O<h?"L":"M";const k=Object(v.getPoint)(M,x,E,P,N),H=Object(v.getPoint)(M,x,E,P,b),Q=+!j;let _=O>Math.PI?1:0;j&&(_=1-_),L+=k.join(" "),L+=`A${E} ${P} 0 ${_} ${Q} ${H.join(" ")}`,O>=h&&(L+="Z"),this.addPath(L)}arc(M,x,E,P,R,N=0){return this.ellipse(M,x,E,E,0,P,R,N)}arcTo(M,x,E,P,R,N,b){this[I]=null,this[w].push(["A",M,x,E,P,R,N,b])}moveTo(M,x){this[I]=null,this[w].push(["M",M,x])}lineTo(M,x){this[I]=null,this[w].push(["L",M,x])}bezierCurveTo(M,x,E,P,R,N){this[I]=null,this[w].push(["C",M,x,E,P,R,N])}quadraticCurveTo(M,x,E,P){this[I]=null,this[w].push(["Q",M,x,E,P])}rect(M,x,E,P){const R=`M${M} ${x}L${M+E} ${x}L${M+E} ${x+P}L${M} ${x+P}Z`;this.addPath(R)}closePath(){this[I]=null;let M=[];const x=this[w].length;x>0&&(M=this[w][x-1]),M[0]!=="Z"&&M[0]!=="z"&&this[w].push(["Z"])}}},function(n,t){n.exports=i;var e={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},r=/([astvzqmhlc])([^astvzqmhlc]*)/ig;function i(a){var l=[];return a.replace(r,function(u,p,c){var g=p.toLowerCase();for(c=s(c),g=="m"&&c.length>2&&(l.push([p].concat(c.splice(0,2))),g="l",p=p=="m"?"l":"L");;){if(c.length==e[g])return c.unshift(p),l.push(c);if(c.length<e[g])throw new Error("malformed path data");l.push([p].concat(c.splice(0,e[g])))}}),l}var o=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function s(a){var l=a.match(o);return l?l.map(Number):[]}},function(n,t,e){n.exports=r;function r(i){var o=i.length;if(o===0)return[[],[]];for(var s=i[0].length,a=i[0].slice(),l=i[0].slice(),u=1;u<o;++u)for(var p=i[u],c=0;c<s;++c){var g=p[c];a[c]=Math.min(a[c],g),l[c]=Math.max(l[c],g)}return[a,l]}},function(n,t){n.exports=e;function e(r){var i=0,o=0,s=0,a=0;return r.map(function(l){l=l.slice();var u=l[0],p=u.toUpperCase();if(u!=p)switch(l[0]=p,u){case"a":l[6]+=s,l[7]+=a;break;case"v":l[1]+=a;break;case"h":l[1]+=s;break;default:for(var c=1;c<l.length;)l[c++]+=s,l[c++]+=a}switch(p){case"Z":s=i,a=o;break;case"H":s=l[1];break;case"V":a=l[1];break;case"M":s=i=l[1],a=o=l[2];break;default:s=l[l.length-2],a=l[l.length-1]}return l})}},function(n,t,e){e.r(t),e.d(t,"default",function(){return i});var r=e(45);e(1).glMatrix.setMatrixArrayType(Array);function i(a){for(var l,u=[],p=0,c=0,g=0,v=0,I=null,w=null,y=0,T=0,h=0,m=a.length;h<m;h++){var d=a[h],M=d[0];switch(M){case"M":g=d[1],v=d[2];break;case"A":var x=Object(r.default)(y,T,d[6],d[7],d[4],d[5],d[1],d[2],d[3]);if(!x.length)continue;x=x.map(b=>{const[j,O,L,k,H,Q,_,st]=b;return{x1:L,y1:k,x2:H,y2:Q,x:_,y:st}});for(var E=0,P;E<x.length;E++)P=x[E],d=["C",P.x1,P.y1,P.x2,P.y2,P.x,P.y],E<x.length-1&&u.push(d);break;case"S":var R=y,N=T;(l=="C"||l=="S")&&(R+=R-p,N+=N-c),d=["C",R,N,d[1],d[2],d[3],d[4]];break;case"T":l=="Q"||l=="T"?(I=y*2-I,w=T*2-w):(I=y,w=T),d=s(y,T,I,w,d[1],d[2]);break;case"Q":I=d[1],w=d[2],d=s(y,T,d[1],d[2],d[3],d[4]);break;case"L":d=o(y,T,d[1],d[2]);break;case"H":d=o(y,T,d[1],T);break;case"V":d=o(y,T,y,d[1]);break;case"Z":d=o(y,T,g,v);break}l=M,y=d[d.length-2],T=d[d.length-1],d.length>4?(p=d[d.length-4],c=d[d.length-3]):(p=y,c=T),u.push(d)}return u}function o(a,l,u,p){return["C",a,l,u,p,u,p]}function s(a,l,u,p,c,g){return["C",a/3+2/3*u,l/3+2/3*p,c/3+2/3*u,g/3+2/3*p,c,g]}},function(n,t,e){e.r(t),e.d(t,"default",function(){return a}),e(1).glMatrix.setMatrixArrayType(Array);const r=Math.PI*2;function i(l,u,p,c){const g=l*c-u*p<0?-1:1;let v=l*p+u*c;return v>1&&(v=1),v<-1&&(v=-1),g*Math.acos(v)}function o(l,u,p,c,g,v,I,w,y,T){const h=T*(l-p)/2+y*(u-c)/2,m=-y*(l-p)/2+T*(u-c)/2,d=I*I,M=w*w,x=h*h,E=m*m;let P=d*M-d*E-M*x;P<0&&(P=0),P/=d*E+M*x,P=Math.sqrt(P)*(g===v?-1:1);const R=P*I/w*m,N=P*-w/I*h,b=T*R-y*N+(l+p)/2,j=y*R+T*N+(u+c)/2,O=(h-R)/I,L=(m-N)/w,k=(-h-R)/I,H=(-m-N)/w,Q=i(1,0,O,L);let _=i(O,L,k,H);return v===0&&_>0&&(_-=r),v===1&&_<0&&(_+=r),[b,j,Q,_]}function s(l,u){const p=1.3333333333333333*Math.tan(u/4),c=Math.cos(l),g=Math.sin(l),v=Math.cos(l+u),I=Math.sin(l+u);return[c,g,c-g*p,g+c*p,v+I*p,I-v*p,v,I]}function a(l,u,p,c,g,v,I,w,y){const T=Math.sin(y*r/360),h=Math.cos(y*r/360),m=h*(l-p)/2+T*(u-c)/2,d=-T*(l-p)/2+h*(u-c)/2;if(m===0&&d===0)return[];if(I===0||w===0)return[];I=Math.abs(I),w=Math.abs(w);const M=m*m/(I*I)+d*d/(w*w);M>1&&(I*=Math.sqrt(M),w*=Math.sqrt(M));const x=o(l,u,p,c,g,v,I,w,T,h),E=[];let P=x[2],R=x[3];const N=Math.max(Math.ceil(Math.abs(R)/(r/4)),1);R/=N;for(let b=0;b<N;b++)E.push(s(P,R)),P+=R;return E.map(b=>{for(let j=0;j<b.length;j+=2){let O=b[j+0],L=b[j+1];O*=I,L*=w;const k=h*O-T*L,H=T*O+h*L;b[j+0]=k+x[0],b[j+1]=H+x[1]}return b})}},function(n,t,e){e(1).glMatrix.setMatrixArrayType(Array);var r=e(47),{copy:i}=e(49),o=e(50);function s(c,g,v){return c[0]=g,c[1]=v,c}var a=[0,0],l=[0,0],u=[0,0];function p(c,g,v,I){r(v,s(a,I[1],I[2]),s(l,I[3],I[4]),s(u,I[5],I[6]),g,c)}n.exports=function(g,v,I){var w=[],y=[],T=[0,0];return g.forEach(function(h,m,d){if(h[0]==="M")i(T,h.slice(1)),y.length>0&&(w.push(y),y=[]);else if(h[0]==="C")p(y,v,T,h),s(T,h[5],h[6]);else throw new Error("illegal type in SVG: "+h[0])}),y.length>0&&w.push(y),w.map(function(h){return o(h,I||0)})}},function(n,t,e){n.exports=e(48)()},function(n,t){function e(i){return[i[0],i[1]]}function r(i,o){return[i,o]}n.exports=function(o){o=o||{};var s=typeof o.recursion=="number"?o.recursion:8,a=typeof o.epsilon=="number"?o.epsilon:11920929e-14,l=typeof o.pathEpsilon=="number"?o.pathEpsilon:1,u=typeof o.angleEpsilon=="number"?o.angleEpsilon:.01,p=o.angleTolerance||0,c=o.cuspLimit||0;return function(w,y,T,h,m,d){d||(d=[]),m=typeof m=="number"?m:1;var M=l/m;return M*=M,g(w,y,T,h,d,M),d};function g(I,w,y,T,h,m){h.push(e(I));var d=I[0],M=I[1],x=w[0],E=w[1],P=y[0],R=y[1],N=T[0],b=T[1];v(d,M,x,E,P,R,N,b,h,m,0),h.push(e(T))}function v(I,w,y,T,h,m,d,M,x,E,P){if(!(P>s)){var R=Math.PI,N=(I+y)/2,b=(w+T)/2,j=(y+h)/2,O=(T+m)/2,L=(h+d)/2,k=(m+M)/2,H=(N+j)/2,Q=(b+O)/2,_=(j+L)/2,st=(O+k)/2,F=(H+_)/2,Z=(Q+st)/2;if(P>0){var tt=d-I,ct=M-w,at=Math.abs((y-d)*ct-(T-M)*tt),dt=Math.abs((h-d)*ct-(m-M)*tt),it,ft;if(at>a&&dt>a){if((at+dt)*(at+dt)<=E*(tt*tt+ct*ct)){if(p<u){x.push(r(F,Z));return}var wt=Math.atan2(m-T,h-y);if(it=Math.abs(wt-Math.atan2(T-w,y-I)),ft=Math.abs(Math.atan2(M-m,d-h)-wt),it>=R&&(it=2*R-it),ft>=R&&(ft=2*R-ft),it+ft<p){x.push(r(F,Z));return}if(c!==0){if(it>c){x.push(r(y,T));return}if(ft>c){x.push(r(h,m));return}}}}else if(at>a){if(at*at<=E*(tt*tt+ct*ct)){if(p<u){x.push(r(F,Z));return}if(it=Math.abs(Math.atan2(m-T,h-y)-Math.atan2(T-w,y-I)),it>=R&&(it=2*R-it),it<p){x.push(r(y,T)),x.push(r(h,m));return}if(c!==0&&it>c){x.push(r(y,T));return}}}else if(dt>a){if(dt*dt<=E*(tt*tt+ct*ct)){if(p<u){x.push(r(F,Z));return}if(it=Math.abs(Math.atan2(M-m,d-h)-Math.atan2(m-T,h-y)),it>=R&&(it=2*R-it),it<p){x.push(r(y,T)),x.push(r(h,m));return}if(c!==0&&it>c){x.push(r(h,m));return}}}else if(tt=F-(I+d)/2,ct=Z-(w+M)/2,tt*tt+ct*ct<=E){x.push(r(F,Z));return}}v(I,w,N,b,H,Q,F,Z,x,E,P+1),v(F,Z,_,st,L,k,d,M,x,E,P+1)}}}},function(n,t,e){e.r(t),e.d(t,"create",function(){return o}),e.d(t,"clone",function(){return i}),e.d(t,"copy",function(){return s}),e.d(t,"scaleAndAdd",function(){return a}),e.d(t,"dot",function(){return l}),e.d(t,"rotate",function(){return u}),e.d(t,"cross",function(){return p}),e.d(t,"sub",function(){return c}),e.d(t,"add",function(){return g}),e.d(t,"computeMiter",function(){return y}),e.d(t,"normal",function(){return T}),e.d(t,"direction",function(){return h});var r=e(1);e(1).glMatrix.setMatrixArrayType(Array);function i(m){return[m[0],m[1]]}function o(){return[0,0]}const s=r.vec2.copy,a=r.vec2.scaleAndAdd,l=r.vec2.dot,u=r.vec2.rotate,p=r.vec2.cross,c=r.vec2.sub,g=r.vec2.add,v=r.vec2.normalize,I=r.vec2.set,w=o();function y(m,d,M,x,E){g(m,M,x),v(m,m),I(d,-m[1],m[0]),I(w,-M[1],M[0]);const P=E/l(d,w);return Math.abs(P)}function T(m,d){return I(m,-d[1],d[0]),m}function h(m,d,M){return c(m,d,M),v(m,m),m}},function(n,t,e){var r=e(51),i=e(52);n.exports=function(s,a){return s=r(s,a),s=i(s,a),s},n.exports.radialDistance=r,n.exports.douglasPeucker=i},function(n,t){function e(r,i){var o=r[0]-i[0],s=r[1]-i[1];return o*o+s*s}n.exports=function(i,o){if(i.length<=1)return i;o=typeof o=="number"?o:1;for(var s=o*o,a=i[0],l=[a],u,p=1,c=i.length;p<c;p++)u=i[p],e(u,a)>s&&(l.push(u),a=u);return a!==u&&l.push(u),l}},function(n,t){function e(i,o,s){var a=o[0],l=o[1],u=s[0]-a,p=s[1]-l;if(u!==0||p!==0){var c=((i[0]-a)*u+(i[1]-l)*p)/(u*u+p*p);c>1?(a=s[0],l=s[1]):c>0&&(a+=u*c,l+=p*c)}return u=i[0]-a,p=i[1]-l,u*u+p*p}function r(i,o,s,a,l){for(var u=a,p,c=o+1;c<s;c++){var g=e(i[c],i[o],i[s]);g>u&&(p=c,u=g)}u>a&&(p-o>1&&r(i,o,p,a,l),l.push(i[p]),s-p>1&&r(i,p,s,a,l))}n.exports=function(o,s){if(o.length<=1)return o;s=typeof s=="number"?s:1;var a=s*s,l=o.length-1,u=[o[0]];return r(o,0,l,a,u),u.push(o[l]),u}},function(n,t,e){e.r(t),e.d(t,"getTotalLength",function(){return i}),e.d(t,"getPointAtLength",function(){return s}),e.d(t,"getDashContours",function(){return a});var r=e(54);e(1).glMatrix.setMatrixArrayType(Array);function i(l){if(l.totalLength!=null)return l.totalLength;let u=0;return l.forEach(p=>{let c=p[0];for(let g=1;g<p.length;g++){const v=p[g];u+=Object(r.distance)(c,v),c=v}}),l.totalLength=u,u}function o(l,u,p=!0){if(u=Number(u),!Number.isFinite(u))throw new TypeError("Failed to execute 'getPointAtLength' on figure: The provided float value is non-finite.");if(u<=0)throw new TypeError("Length must > 0");const c=i(l);if(u>=c){const v=l[l.length-1],I=v[v.length-2],w=v[v.length-1],y=Math.atan2(w[1]-I[1],w[0]-I[0]);return{current:l.map(T=>[...T]),point:{x:w[0],y:w[1],angle:y}}}const g=[];for(let v=0;v<l.length;v++){g[v]=[];const I=l[v];let w=I[0];for(let y=1;y<I.length;y++){const T=I[y],h=Object(r.distance)(w,T);if(u<h){const m=u/h,d=Math.atan2(T[1]-w[1],T[0]-w[0]),M={x:w[0]*(1-m)+T[0]*m,y:w[1]*(1-m)+T[1]*m,angle:d};if(g[v].push(w),u>0&&g[v].push([M.x,M.y]),!p)return{current:g,point:M};const x=[],E=v;for(;v<l.length;v++){for(x[v-E]=[],v===E&&x[0].push([M.x,M.y]);y<I.length;y++)x[v-E].push(I[y]);y=0}return{current:g,point:M,rest:x}}u-=h,g[v].push(w),w=T}}}function s(l,u){if(u=Number(u),!Number.isFinite(u))throw new TypeError("Failed to execute 'getPointAtLength' on figure: The provided float value is non-finite.");if(l.length<=0)return{x:0,y:0,angle:0};if(u<=0){const p=l[0][0],c=l[0][1],g=Math.atan2(c[1]-p[1],c[0]-p[0]);return{x:p[0],y:p[1],angle:g}}return o(l,u,!1).point}function a(l,u,p){let c=0,g=u[0],v=l;const I=[],w=u.length;if(p>0){do p-=u[c%w],c++;while(p>0);p<0&&(g=-p,c--)}else if(p<0){c=-1;do p+=u[c%w+w-1],c--;while(p<0);p>=0&&(c++,g=u[c%w+w-1]-p)}do{const y=o(v,g);v=y.rest,++c%2&&I.push(...y.current);let T=c%w;T<0&&(T+=w),g=u[T]}while(v);return I}},function(n,t,e){e.r(t),e.d(t,"normalize",function(){return r}),e.d(t,"distance",function(){return i}),e(1).glMatrix.setMatrixArrayType(Array);function r([o,s,a],l,u,p){return o=o*2/l-1,s=1-s*2/u,Number.isFinite(p)?(a=a*2/p-1,[o,s,a]):[o,s]}function i([o,s,a=0],[l,u,p=0]){return Math.hypot(l-o,u-s,p-a)}},function(n,t,e){e.r(t),e.d(t,"getPoint",function(){return i}),e(1).glMatrix.setMatrixArrayType(Array);const r=Math.PI*2;function i(o,s,a,l,u){u%=r,u<0&&(u+=r);const p=Math.tan(u);if(Math.abs(p)<1e5){const c=s-p*o,g=1/a**2+p**2/l**2;let v=-1;(u<=Math.PI/2||u>3*Math.PI/2)&&(v=1);const I=v*Math.sqrt(1/g)+o,w=p*I+c;return[I,w]}return u<Math.PI?[o,s+l]:[o,s-l]}},function(n,t,e){e.r(t),e.d(t,"default",function(){return K});var r=e(1),i=e(42),o=e.n(i),s=e(57),a=e(28),l=e(24),u=e(30),p=e(59),c=e(53),g=e(60),v=e.n(g),I=e(46),w=e.n(I),y=e(31),T=e(40),h=e(21);e(1).glMatrix.setMatrixArrayType(Array);function m(et,W){if(et==null)return{};var $=d(et,W),C,D;if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(et);for(D=0;D<B.length;D++)C=B[D],!(W.indexOf(C)>=0)&&Object.prototype.propertyIsEnumerable.call(et,C)&&($[C]=et[C])}return $}function d(et,W){if(et==null)return{};var $={},C=Object.keys(et),D,B;for(B=0;B<C.length;B++)D=C[B],!(W.indexOf(D)>=0)&&($[D]=et[D]);return $}const M=Symbol("mesh"),x=Symbol("contours"),E=Symbol("stroke"),P=Symbol("fill"),R=Symbol("strokeColor"),N=Symbol("fillColor"),b=Symbol("transform"),j=Symbol("invertTransform"),O=Symbol("uniforms"),L=Symbol("texOptions"),k=Symbol("blend"),H=Symbol("applyTexture"),Q=Symbol("applyTransform"),_=Symbol("applyGradientTransform"),st=Symbol("applyProgram"),F=Symbol("gradient"),Z=Symbol("filter"),tt=Symbol("opacity"),ct=Symbol("program"),at=Symbol("attributes"),dt=Symbol("pass"),it=Symbol("clipContext"),ft=Symbol("applyClipPath");function wt(et,W){const[$,C]=[et[1][0]-et[0][0],et[1][1]-et[0][1]],D=[];for(let B=0;B<W.length;B++){const X=W[B],q=[(X[0]-et[0][0])/$,1-(X[1]-et[0][1])/C];D.push(q)}return D}function U([et,W],[$,C,D,B],{scale:X}){return X||(et/=D,W=1-W/B,et-=$,W+=C),[et,W,0]}function Y(et,W,$){const C=w()(et,W,$);return C.path=et,C.simplify=$,C.scale=W,C}class K{constructor(W){this[E]=null,this[P]=null,this[b]=[1,0,0,1,0,0],this[tt]=1,this[O]={},this[Z]=[],this[k]=null,this[L]={},this.contours=W.contours,this[ct]=null,this[at]={},this[dt]=[]}get contours(){return this[x]}set contours(W){this[M]=null,this[x]=W;const $=W.scale;this.transformScale/$>1.5&&this.accurate(this.transformScale)}setProgram(W){this[ct]=W,this[M]&&this[st](W)}get program(){return this[ct]}setAttribute(W,$){$==null?delete this[at][W]:this[at][W]=$}getOpacity(){return this[tt]}setOpacity(W){if(W<0||W>1)throw new TypeError("Invalid opacity value.");this[M]&&this[M].positions.forEach($=>{$[2]=1/$[2]>0?W:-W}),this[tt]=W}setClipPath(W){this.clipPath=W,this[O].u_clipSampler&&this[O].u_clipSampler.delete(),this.setUniforms({u_clipSampler:null}),this[M]&&delete this[M].attributes.a_clipUV,W&&this[M]&&this[ft]()}[ft](){if(this.clipPath){this[it]||(this[it]=h.default.createCanvas(1,1));const[[W,$],[C,D]]=this.boundingBox;C&&D&&(this[it].width=C-W,this[it].height=D-$);const B=this[it].getContext("2d"),X=new Path2D(this.clipPath);B.clearRect(0,0,this[it].width,this[it].height),B.save(),B.translate(-W,-$),B.fillStyle="white",B.fill(X),B.restore(),this[M].clipPath=this[it];const q=wt(this.boundingBox,this[M].position0);this[M].attributes.a_clipUV=q}}getPointAtLength(W){return Object(c.getPointAtLength)(this[x],W)}getTotalLength(){return Object(c.getTotalLength)(this[x])}get blend(){return this[k]==null?"auto":this[k]}set blend(W){this[k]=W,this[M]&&(this[M].enableBlend=this.enableBlend)}get boundingBox(){if(this[M]&&this[M].boundingBox)return this[M].boundingBox;const W=this.meshData;if(W){const $=W.position0;if($.length)W.boundingBox=o()($);else return[[0,0],[0,0]];return W.boundingBox}return[[0,0],[0,0]]}get boundingCenter(){const W=this.boundingBox;return W?[.5*(W[0][0]+W[1][0]),.5*(W[0][1]+W[1][1])]:[0,0]}get fillRule(){return this[P]?this[P].rule:"nonzero"}get lineWidth(){return this[E]?this[E].lineWidth:0}get lineCap(){return this[E]?this[E].lineCap:""}get lineJoin(){return this[E]?this[E].lineJoin:""}get miterLimit(){return this[E]?this[E].miterLimit:0}get strokeStyle(){return this[R]&&this[R][3]!==0?Object(l.default)(this[R]):""}get lineDash(){return this[E]?this[E].lineDash:null}get lineDashOffset(){return this[E]?this[E].lineDashOffset:0}get fillStyle(){return this[N]&&this[N][3]!==0?Object(l.default)(this[N]):""}get gradient(){return this[F]}get texture(){return this[O].u_texSampler?{image:this[O].u_texSampler._img,options:this[L]}:null}get enableBlend(){return this[k]===!0||this[k]===!1?this[k]:this[tt]<1||this[R]!=null&&this[R][3]<1||this[N]!=null&&this[N][3]<1||this[O].u_colorMatrix!=null&&this[O].u_colorMatrix[18]<1||this[O].u_radialGradientVector!=null||this.beforeRender||this.afterRender}get filterCanvas(){return/blur|drop-shadow|url/.test(this.filter)}get filter(){return this[Z].join(" ")}get transformMatrix(){return this[b]}get invertMatrix(){if(!this[j]){const W=r.mat2d.invert(Array.of(0,0,0,0,0,0),this[b]);this[j]=W}return this[j]}get transformScale(){const W=this[b];return Math.max(Math.hypot(W[0],W[1]),Math.hypot(W[2],W[3]))}get uniforms(){return this[O]}get pass(){return this[dt]}[st](W){const $=this[at],C=this[M].position0,D=Object.entries(W._attribute);for(let B=0;B<D.length;B++){const[X,q]=D[B];if(X!=="a_color"&&X!=="a_sourceRect"&&q!=="ignored"){const rt=$[X];if(X==="uv"&&!rt){const lt=this[M].boundingBox||o()(C);this[M].attributes[X]=wt(lt,C)}else{this[M].attributes[X]=[];for(let lt=0;lt<C.length;lt++){const gt=C[lt];this[M].attributes[X].push(rt?rt(gt,B,C):Array(q.size).fill(0))}}}}}get meshData(){if(this._updateMatrix&&this.transformScale/this.contours.scale>1.5&&this.accurate(this.transformScale),!this[M]){!this[P]&&!this[E]&&this.setFill();const W=this[x],$={};if(W&&W.length){if(this[P])try{const B=v()(W,this[P]);B.positions=B.positions.map(X=>(X.push(this[tt]),X)),B.attributes={a_color:Array.from({length:B.positions.length}).map(()=>this[N].map(X=>Math.round(255*X)))},$.fill=B}catch{}if(this[E]){const B=this[E].lineDash;let X=W;if(B){const rt=this[E].lineDashOffset;X=Object(c.getDashContours)(W,B,rt)}const q=X.map((rt,lt)=>{const gt=rt.length>1&&r.vec2.equals(rt[0],rt[rt.length-1]),yt=this[E].build(rt,gt);return v()([yt])});q.forEach(rt=>{rt.positions=rt.positions.map(lt=>(lt.push(-this[tt]),lt)),rt.attributes={a_color:Array.from({length:rt.positions.length}).map(()=>this[R].map(lt=>Math.round(255*lt)))}}),$.stroke=Object(a.default)(q)}}const C=Object(a.default)([$.fill,$.stroke]);C.fillPointCount=$.fill?$.fill.positions.length:0,C.enableBlend=this.enableBlend,C.position0=C.positions.map(([B,X,q])=>[B,X,q]),C.uniforms=this[O],this[M]=C,this[O].u_texSampler&&this[H](C,this[L]);const D=this[b];Object(p.isUnitTransform)(D)||(this[Q](C,D),this[O].u_radialGradientVector&&this[_]()),this.clipPath&&this[ft](),this[ct]&&this[st](this[ct])}return this._updateMatrix&&(this[M].matrix=this[b],this[Q](this[M],this[b]),this[O].u_radialGradientVector&&this[_]()),this[M]}[Q](W,$){const{positions:C,position0:D}=W;for(let B=0;B<C.length;B++){const[X,q]=D[B],rt=C[B];rt[0]=X*$[0]+q*$[2]+$[4],rt[1]=X*$[1]+q*$[3]+$[5]}this._updateMatrix=!1}[_](){const W=this[b],$=[...this._radialGradientVector];if($){const[C,D,,B,X]=$;$[0]=C*W[0]+D*W[2]+W[4],$[1]=C*W[1]+D*W[3]+W[5],$[3]=B*W[0]+X*W[2]+W[4],$[4]=B*W[1]+X*W[3]+W[5],this[O].u_radialGradientVector=$}}[H](W,$){function C(lt,gt){return lt==null&&gt==null?!0:lt==null||gt==null?!1:lt[0]===gt[0]&&lt[1]===gt[1]&&lt[2]===gt[2]&&lt[3]===gt[3]}const D=this[O].u_texSampler;if(!D)return;const{width:B,height:X}=D._img,q=$.srcRect;let rt=$.rect||[0,0];if($.rotated&&(rt=[-rt[1],rt[0],rt[3],rt[2]]),rt[2]==null&&(rt[2]=q?q[2]:B),rt[3]==null&&(rt[3]=q?q[3]:X),$.hidden)W.textureCoord=W.positions.map(()=>[-1,-1,-1]);else if(!W.textureCoord||!C(this[L].rect,$.rect)||this[L].hidden!==$.hidden||this[L].rotated!==$.rotated){let lt=null;$.rotated&&(lt=r.mat2d.rotate(Array.of(0,0,0,0,0,0),r.mat2d.fromValues(1,0,0,1,0,0),.5*Math.PI),lt=r.mat2d.translate(Array.of(0,0,0,0,0,0),lt,[0,-rt[2]])),W.textureCoord=W.position0.map(([gt,yt,xt])=>{if(1/xt>0){if($.rotated){const St=gt*lt[0]+yt*lt[2]+lt[4],Mt=gt*lt[1]+yt*lt[3]+lt[5];[gt,yt]=[St,Mt]}const Et=U([gt,yt],[rt[0]/rt[2],rt[1]/rt[3],rt[2],rt[3]],$);return $.repeat&&(Et[2]=1),Et}return[-1,-1,-1]})}if(q){const lt=[q[0]/B,q[1]/X,q[2]/B,q[3]/X];W.attributes.a_sourceRect=W.positions.map(()=>[...lt])}else W.attributes.a_sourceRect=W.positions.map(()=>[0,0,0,0])}accurate(W){if(!this.contours)return;if(this.contours.path){const C=this.contours.simplify,D=Y(this.contours.path,2*W,C);this[M]=null,this[x]=D}}canIgnore(){const W=this[E]==null||this[E].lineWidth===0||this[R][3]===0,$=this[P]==null||this[N][3]===0,C=this[O].u_radialGradientVector==null,D=this[O].u_texSampler==null;return this[tt]===0||this[ct]==null&&W&&$&&C&&D&&!this.beforeRender&&!this.afterRender}setStroke({thickness:W=1,cap:$="butt",join:C="miter",miterLimit:D=10,color:B=[0,0,0,0],lineDash:X=null,lineDashOffset:q=0,roundSegments:rt=20}={}){return this[M]=null,this[E]=new s.default({lineWidth:W,lineCap:$,lineJoin:C,miterLimit:D,roundSegments:rt}),typeof B=="string"&&(B=Object(y.default)(B)),this[R]=B,this[E].lineDash=X,this[E].lineDashOffset=q,this}setFill({rule:W=this.fillRule,color:$=[0,0,0,0]}={}){return this[M]=null,this[P]={rule:W},typeof $=="string"&&($=Object(y.default)($)),this[N]=$,this}setTexture(W,$={}){if(W&&W.image){const{image:C,rect:D}=W;if(W=C,$.rect)for(let B=0;B<$.rect.length;B++)D[B]=$.rect[B];$.rect=D}return this[P]||this.setFill(),this.setUniforms({u_texSampler:W}),this[M]&&this[H](this[M],$),this[L]=$,this}setCircularGradient({vector:W,colors:$,type:C="fill"}={}){if(W.length!==3)throw new TypeError("Invalid linearGradient.");this.setGradient({vector:W,colors:$,type:C})}setLinearGradient({vector:W,colors:$,type:C="fill"}={}){if(W.length!==4)throw new TypeError("Invalid linearGradient.");this.setGradient({vector:W,colors:$,type:C})}setRadialGradient({vector:W,colors:$,type:C="fill"}={}){if(W.length!==6)throw new TypeError("Invalid radialGradient.");this.setGradient({vector:W,colors:$,type:C})}setGradient({vector:W,colors:$,type:C="fill"}={}){$=$.map(({offset:X,color:q})=>(typeof q=="string"&&(q=Object(y.default)(q)),{offset:X,color:q})),this[F]=this[F]||{},this[F][C]={vector:W,colors:$},$.sort((X,q)=>X.offset-q.offset);const D=[];$.forEach(({offset:X,color:q})=>{D.push(X,...q)});let B;if(W.length===4?B=[W[0],W[1],0,W[2],W[3],0]:B=[...W],D.length<40&&D.push(-1),D.length>40)throw new Error("Too many colors, should be less than 8 colors");return this._radialGradientVector=B,this[O].u_colorSteps=D,C==="fill"?this[O].u_gradientType=1:this[O].u_gradientType=0,this[_](),this}setUniforms(W={}){return Object.assign(this[O],W),this}setTransform(...W){const $=this[b];return r.mat2d.equals(W,$)||(this[b]=W,delete this[j],this._updateMatrix=!0),this}transform(...W){const $=this[b];return this[b]=r.mat2d.multiply(Array.of(0,0,0,0,0,0),$,W),delete this[j],this._updateMatrix=!0,this}translate(W,$){let C=r.mat2d.create();return C=r.mat2d.translate(Array.of(0,0,0,0,0,0),C,[W,$]),this.transform(...C)}rotate(W,[$,C]=[0,0]){let D=r.mat2d.create();return D=r.mat2d.translate(Array.of(0,0,0,0,0,0),D,[$,C]),D=r.mat2d.rotate(Array.of(0,0,0,0,0,0),D,W),D=r.mat2d.translate(Array.of(0,0,0,0,0,0),D,[-$,-C]),this.transform(...D)}scale(W,$=W,[C,D]=[0,0]){let B=r.mat2d.create();return B=r.mat2d.translate(Array.of(0,0,0,0,0,0),B,[C,D]),B=r.mat2d.scale(Array.of(0,0,0,0,0,0),B,[W,$]),B=r.mat2d.translate(Array.of(0,0,0,0,0,0),B,[-C,-D]),this.transform(...B)}skew(W,$=W,[C,D]=[0,0]){let B=r.mat2d.create();return B=r.mat2d.translate(Array.of(0,0,0,0,0,0),B,[C,D]),B=r.mat2d.multiply(Array.of(0,0,0,0,0,0),B,r.mat2d.fromValues(1,Math.tan($),Math.tan(W),1,0,0)),B=r.mat2d.translate(Array.of(0,0,0,0,0,0),B,[-C,-D]),this.transform(...B)}clearFilter(){return this.setColorTransform(null),this[Z].length=0,this}setColorTransform(...W){return W[0]===null?this.setUniforms({u_filterFlag:0,u_colorMatrix:0}):this.setUniforms({u_filterFlag:1,u_colorMatrix:W}),this}transformColor(...W){let $=this.uniforms.u_colorMatrix;return $?$=Object(u.multiply)($,W):$=W,this.setColorTransform(...$),this}blur(W){return this[Z].push(`blur(${W}px)`),this}brightness(W=1){return this[Z].push(`brightness(${100*W}%)`),this.transformColor(...Object(u.brightness)(W))}contrast(W=1){return this[Z].push(`contrast(${100*W}%)`),this.transformColor(...Object(u.contrast)(W))}dropShadow(W,$,C=0,D=[0,0,0,1]){return Array.isArray(D)&&(D=Object(l.default)(D)),this[Z].push(`drop-shadow(${W}px ${$}px ${C}px ${D})`),this}grayscale(W=1){return this[Z].push(`grayscale(${100*W}%)`),this.transformColor(...Object(u.grayscale)(W))}hueRotate(W=0){return this[Z].push(`hue-rotate(${W}deg)`),this.transformColor(...Object(u.hueRotate)(W))}invert(W=1){return this[Z].push(`invert(${100*W}%)`),this.transformColor(...Object(u.invert)(W))}opacity(W=1){return this[Z].push(`opacity(${100*W}%)`),this.transformColor(...Object(u.opacity)(W))}saturate(W=1){return this[Z].push(`saturate(${100*W}%)`),this.transformColor(...Object(u.saturate)(W))}sepia(W=1){return this[Z].push(`sepia(${100*W}%)`),this.transformColor(...Object(u.sepia)(W))}url(W){return this[Z].push(`url(${W})`),this}isPointCollision(W,$,C="both"){const D=this.meshData,{positions:B,cells:X}=D,q=this.invertMatrix,rt=q[0]*W+q[2]*$+q[4],lt=q[1]*W+q[3]*$+q[5],gt=this.boundingBox;if(rt<gt[0][0]||rt>gt[1][0]||lt<gt[0][1]||lt>gt[1][1])return!1;function yt([xt,Et],[St,Mt],[Ct,Ot]){const bt=Ct-St,At=Ot-Mt,Yt=((xt-St)*bt+(Et-Mt)*At)/(bt**2+At**2);return Yt>=0&&Yt<=1}for(let xt=0;xt<X.length;xt++){const Et=X[xt];if(C==="fill"&&Et[0]>=D.fillPointCount)break;if(C==="stroke"&&Et[0]<D.fillPointCount)continue;const[[St,Mt],[Ct,Ot],[bt,At]]=Et.map(Qt=>B[Qt]),Yt=Math.sign((W-St)*(Ot-Mt)-(Ct-St)*($-Mt));if(Yt===0&&yt([W,$],[St,Mt],[Ct,Ot]))return!0;const re=Math.sign((W-Ct)*(At-Ot)-(bt-Ct)*($-Ot));if(re===0&&yt([W,$],[Ct,Ot],[bt,At]))return!0;const Zt=Math.sign((W-bt)*(Mt-At)-(St-bt)*($-At));if(Zt===0&&yt([W,$],[bt,At],[St,Mt])||Yt===1&&re===1&&Zt===1||Yt===-1&&re===-1&&Zt===-1)return!0}return!1}isPointInFill(W,$){return this.isPointCollision(W,$,"fill")}isPointInStroke(W,$){return this.isPointCollision(W,$,"stroke")}addPass(W,$={}){let{width:C,height:D}=$,B=m($,["width","height"]);const X=new T.default;X.rect(0,0,C,D);const q=new K(X,{width:C,height:D});q.setUniforms(B),q.setProgram(W),this[dt].push(q)}}},function(n,t,e){e.r(t);var r=e(58);e(1).glMatrix.setMatrixArrayType(Array),t.default=r.Stroke},function(n,t,e){e.r(t),e.d(t,"Stroke",function(){return p});var r=e(49);e(1).glMatrix.setMatrixArrayType(Array);const i=Object(r.create)(),o=Object(r.create)(),s=Object(r.create)(),a=Object(r.create)(),l=Object(r.create)(),u=1e20;class p{constructor({lineWidth:w=1,lineJoin:y="miter",miterLimit:T=10,lineCap:h="butt",roundSegments:m=20}={}){this.lineWidth=w,this.lineJoin=y,this.miterLimit=T,this.lineCap=h,this.roundSegments=m,this._normal=null}build(w,y=!1){let T=w.length;if(w=[...w],T<2)return w;y&&((w[0][0]!==w[T-1][0]||w[0][1]!==w[T-1][1])&&w.push([...w[0]]),w.push([...w[1]])),T=w.length,this._normal=null;const h={left:[],right:[]},m=this.lineWidth/2,d=this.lineCap;if(!y&&d==="square"){Object(r.direction)(o,w[0],w[1]),Object(r.scaleAndAdd)(w[0],w[0],o,m);const x=w.length-1;Object(r.direction)(o,w[x],w[x-1]),Object(r.scaleAndAdd)(w[x],w[x],o,m)}for(let x=1;x<T;x++){const E=w[x-1],P=w[x],R=w[x+1];this._seg(h,E,P,R,m,y)}return!y&&d==="round"&&v(h,this.roundSegments),[...h.left,...h.right.reverse()]}_seg(w,y,T,h,m,d){const M=this.lineJoin==="bevel",x=this.lineJoin==="round";if(Object(r.direction)(o,T,y),this._normal||(this._normal=Object(r.create)(),Object(r.normal)(this._normal,o)),w.left.length||g(w,y,this._normal,m),!h)Object(r.normal)(this._normal,o),d?g(w,y,this._normal,m):g(w,T,this._normal,m);else{Object(r.direction)(s,h,T);let E=Object(r.computeMiter)(a,l,o,s,m);E=Math.min(E,u);const P=Object(r.dot)(a,this._normal)<0?-1:1;let R=M||x;if(!R&&this.lineJoin==="miter"&&E/m>this.miterLimit&&(R=!0),R){Object(r.scaleAndAdd)(i,T,this._normal,-m*P),c(w,i,P);let N=1/0;y&&(N=Math.min(N,Math.hypot(T[0]-y[0],T[1]-y[1]))),h&&(N=Math.min(N,Math.hypot(h[0]-T[0],h[1]-T[1])));const b=Math.max(m,Math.min(E,N));if(Object(r.scaleAndAdd)(i,T,l,b*P),c(w,i,-P),h)if(Object(r.normal)(i,s),Object(r.copy)(this._normal,i),Object(r.scaleAndAdd)(i,T,i,-m*P),x){const j=Object(r.clone)(i),O=P>0?w.left[w.left.length-1]:w.right[w.right.length-1],L=Object(r.clone)(T),k=Object(r.sub)(Object(r.create)(),O,L),H=Object(r.sub)(Object(r.create)(),j,L),Q=Math.PI/this.roundSegments;for(let _=0;_<this.roundSegments&&(Object(r.rotate)(k,k,[0,0],P*Q),Math.sign(Object(r.cross)(i,k,H)[2])===P);_++)Object(r.add)(i,k,L),c(w,i,P);c(w,j,P)}else c(w,i,P)}else g(w,T,l,E),Object(r.copy)(this._normal,l)}}}function c(I,w,y){y>0?I.left.push(Object(r.clone)(w)):I.right.push(Object(r.clone)(w))}function g(I,w,y,T,h=-1){Object(r.scaleAndAdd)(i,w,y,-T),c(I,i,-h),Object(r.scaleAndAdd)(i,w,y,T),c(I,i,h)}function v({left:I,right:w},y){const T=Object(r.create)(),h=Object(r.create)();let m=I[0],d=w[0],M=[.5*(m[0]+d[0]),.5*(m[1]+d[1])];Object(r.sub)(h,m,M);for(let x=1;x<=y;x++){const E=-1*Math.PI*x/y;Object(r.rotate)(T,h,[0,0],E),Object(r.add)(i,M,T),I.unshift(Object(r.clone)(i))}m=w[w.length-1],d=I[I.length-1],M=[.5*(m[0]+d[0]),.5*(m[1]+d[1])],Object(r.sub)(h,m,M);for(let x=1;x<=y;x++){const E=-1*Math.PI*x/y;Object(r.rotate)(T,h,[0,0],E),Object(r.add)(i,M,T),w.push(Object(r.clone)(i))}}},function(n,t,e){e.r(t),e.d(t,"isUnitTransform",function(){return r}),e(1).glMatrix.setMatrixArrayType(Array);function r(i){return i[0]===1&&i[1]===0&&i[2]===0&&i[3]===1&&i[4]===0&&i[5]===0}},function(n,t,e){e(1).glMatrix.setMatrixArrayType(Array);var r=e(61),i=e(62);n.exports=function(o,s){if(s=s||{},o=o.filter(function(y){return y.length>2}),o.length===0)return{positions:[],cells:[]};typeof s.vertexSize!="number"&&(s.vertexSize=o[0][0].length),o=o.map(function(y){return y.reduce(function(T,h){return T.concat(h)})});const a=s.rule==="evenodd"?r.WINDING_ODD:r.WINDING_NONZERO;for(var l=r.tesselate(i({contours:o,windingRule:a,elementType:r.POLYGONS,polySize:3,vertexSize:2},s)),u=[],p=0;p<l.vertices.length;p+=s.vertexSize){var c=l.vertices.slice(p,p+s.vertexSize);u.push(c)}var g=[];for(p=0;p<l.elements.length;p+=3){var v=l.elements[p],I=l.elements[p+1],w=l.elements[p+2];g.push([v,I,w])}return{positions:u,cells:g}}},function(n,t,e){e(1).glMatrix.setMatrixArrayType(Array);var r={},i={};n.exports=r,r.WINDING_ODD=0,r.WINDING_NONZERO=1,r.WINDING_POSITIVE=2,r.WINDING_NEGATIVE=3,r.WINDING_ABS_GEQ_TWO=4,r.POLYGONS=0,r.CONNECTED_POLYGONS=1,r.BOUNDARY_CONTOURS=2,r.tesselate=function(h){for(var m=h.debug||!1,d=new T,M=0;M<h.contours.length;M++)d.addContour(h.vertexSize||2,h.contours[M]);return d.tesselate(h.windingRule||r.WINDING_ODD,h.elementType||r.POLYGONS,h.polySize||3,h.vertexSize||2,h.normal||[0,0,1]),{vertices:d.vertices,vertexIndices:d.vertexIndices,vertexCount:d.vertexCount,elements:d.elements,elementCount:d.elementCount,mesh:m?d.mesh:void 0}};var o=function(h){if(!h)throw"Assertion Failed!"};function s(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}function a(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}function l(h){this.next=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Org=null,this.Lface=null,this.activeRegion=null,this.winding=0,this.side=h}l.prototype={get Rface(){return this.Sym.Lface},set Rface(h){this.Sym.Lface=h},get Dst(){return this.Sym.Org},set Dst(h){this.Sym.Org=h},get Oprev(){return this.Sym.Lnext},set Oprev(h){this.Sym.Lnext=h},get Lprev(){return this.Onext.Sym},set Lprev(h){this.Onext.Sym=h},get Dprev(){return this.Lnext.Sym},set Dprev(h){this.Lnext.Sym=h},get Rprev(){return this.Sym.Onext},set Rprev(h){this.Sym.Onext=h},get Dnext(){return this.Sym.Onext.Sym},set Dnext(h){this.Sym.Onext.Sym=h},get Rnext(){return this.Sym.Lnext.Sym},set Rnext(h){this.Sym.Lnext.Sym=h}};function u(){var h=new s,m=new a,d=new l(0),M=new l(1);h.next=h.prev=h,h.anEdge=null,m.next=m.prev=m,m.anEdge=null,m.trail=null,m.marked=!1,m.inside=!1,d.next=d,d.Sym=M,d.Onext=null,d.Lnext=null,d.Org=null,d.Lface=null,d.winding=0,d.activeRegion=null,M.next=M,M.Sym=d,M.Onext=null,M.Lnext=null,M.Org=null,M.Lface=null,M.winding=0,M.activeRegion=null,this.vHead=h,this.fHead=m,this.eHead=d,this.eHeadSym=M}u.prototype={makeEdge_:function(h){var m=new l(0),d=new l(1);h.Sym.side<h.side&&(h=h.Sym);var M=h.Sym.next;return d.next=M,M.Sym.next=m,m.next=h,h.Sym.next=d,m.Sym=d,m.Onext=m,m.Lnext=d,m.Org=null,m.Lface=null,m.winding=0,m.activeRegion=null,d.Sym=m,d.Onext=d,d.Lnext=m,d.Org=null,d.Lface=null,d.winding=0,d.activeRegion=null,m},splice_:function(h,m){var d=h.Onext,M=m.Onext;d.Sym.Lnext=m,M.Sym.Lnext=h,h.Onext=M,m.Onext=d},makeVertex_:function(h,m,d){var M=h;o(M!==null);var x=d.prev;M.prev=x,x.next=M,M.next=d,d.prev=M,M.anEdge=m;var E=m;do E.Org=M,E=E.Onext;while(E!==m)},makeFace_:function(h,m,d){var M=h;o(M!==null);var x=d.prev;M.prev=x,x.next=M,M.next=d,d.prev=M,M.anEdge=m,M.trail=null,M.marked=!1,M.inside=d.inside;var E=m;do E.Lface=M,E=E.Lnext;while(E!==m)},killEdge_:function(h){h.Sym.side<h.side&&(h=h.Sym);var m=h.next,d=h.Sym.next;m.Sym.next=d,d.Sym.next=m},killVertex_:function(h,m){var d=h.anEdge,M=d;do M.Org=m,M=M.Onext;while(M!==d);var x=h.prev,E=h.next;E.prev=x,x.next=E},killFace_:function(h,m){var d=h.anEdge,M=d;do M.Lface=m,M=M.Lnext;while(M!==d);var x=h.prev,E=h.next;E.prev=x,x.next=E},makeEdge:function(){var h=new s,m=new s,d=new a,M=this.makeEdge_(this.eHead);return this.makeVertex_(h,M,this.vHead),this.makeVertex_(m,M.Sym,this.vHead),this.makeFace_(d,M,this.fHead),M},splice:function(h,m){var d=!1,M=!1;if(h!==m){if(m.Org!==h.Org&&(M=!0,this.killVertex_(m.Org,h.Org)),m.Lface!==h.Lface&&(d=!0,this.killFace_(m.Lface,h.Lface)),this.splice_(m,h),!M){var x=new s;this.makeVertex_(x,m,h.Org),h.Org.anEdge=h}if(!d){var E=new a;this.makeFace_(E,m,h.Lface),h.Lface.anEdge=h}}},delete:function(h){var m=h.Sym,d=!1;if(h.Lface!==h.Rface&&(d=!0,this.killFace_(h.Lface,h.Rface)),h.Onext===h)this.killVertex_(h.Org,null);else if(h.Rface.anEdge=h.Oprev,h.Org.anEdge=h.Onext,this.splice_(h,h.Oprev),!d){var M=new a;this.makeFace_(M,h,h.Lface)}m.Onext===m?(this.killVertex_(m.Org,null),this.killFace_(m.Lface,null)):(h.Lface.anEdge=m.Oprev,m.Org.anEdge=m.Onext,this.splice_(m,m.Oprev)),this.killEdge_(h)},addEdgeVertex:function(h){var m=this.makeEdge_(h),d=m.Sym;this.splice_(m,h.Lnext),m.Org=h.Dst;var M=new s;return this.makeVertex_(M,d,m.Org),m.Lface=d.Lface=h.Lface,m},splitEdge:function(h,m){var d=this.addEdgeVertex(h),M=d.Sym;return this.splice_(h.Sym,h.Sym.Oprev),this.splice_(h.Sym,M),h.Dst=M.Org,M.Dst.anEdge=M.Sym,M.Rface=h.Rface,M.winding=h.winding,M.Sym.winding=h.Sym.winding,M},connect:function(h,m){var d=!1,M=this.makeEdge_(h),x=M.Sym;if(m.Lface!==h.Lface&&(d=!0,this.killFace_(m.Lface,h.Lface)),this.splice_(M,h.Lnext),this.splice_(x,m),M.Org=h.Dst,x.Org=m.Org,M.Lface=x.Lface=h.Lface,h.Lface.anEdge=x,!d){var E=new a;this.makeFace_(E,M,h.Lface)}return M},zapFace:function(h){var m=h.anEdge,d,M,x,E,P;M=m.Lnext;do d=M,M=d.Lnext,d.Lface=null,d.Rface===null&&(d.Onext===d?this.killVertex_(d.Org,null):(d.Org.anEdge=d.Onext,this.splice_(d,d.Oprev)),x=d.Sym,x.Onext===x?this.killVertex_(x.Org,null):(x.Org.anEdge=x.Onext,this.splice_(x,x.Oprev)),this.killEdge_(d));while(d!=m);E=h.prev,P=h.next,P.prev=E,E.next=P},countFaceVerts_:function(h){var m=h.anEdge,d=0;do d++,m=m.Lnext;while(m!==h.anEdge);return d},mergeConvexFaces:function(h){var m,d,M,x,E,P,R;for(m=this.fHead.next;m!==this.fHead;m=m.next)if(m.inside)for(d=m.anEdge,E=d.Org;M=d.Lnext,x=d.Sym,x&&x.Lface&&x.Lface.inside&&(P=this.countFaceVerts_(m),R=this.countFaceVerts_(x.Lface),P+R-2<=h&&i.vertCCW(d.Lprev.Org,d.Org,x.Lnext.Lnext.Org)&&i.vertCCW(x.Lprev.Org,x.Org,d.Lnext.Lnext.Org)&&(M=x.Lnext,this.delete(x),d=null,x=null)),!(d&&d.Lnext.Org===E);)d=M;return!0},check:function(){var h=this.fHead,m=this.vHead,d=this.eHead,M,x,E,P,R,N;for(x=h,x=h;(M=x.next)!==h;x=M){o(M.prev===x),R=M.anEdge;do o(R.Sym!==R),o(R.Sym.Sym===R),o(R.Lnext.Onext.Sym===R),o(R.Onext.Sym.Lnext===R),o(R.Lface===M),R=R.Lnext;while(R!==M.anEdge)}for(o(M.prev===x&&M.anEdge===null),P=m,P=m;(E=P.next)!==m;P=E){o(E.prev===P),R=E.anEdge;do o(R.Sym!==R),o(R.Sym.Sym===R),o(R.Lnext.Onext.Sym===R),o(R.Onext.Sym.Lnext===R),o(R.Org===E),R=R.Onext;while(R!==E.anEdge)}for(o(E.prev===P&&E.anEdge===null),N=d,N=d;(R=N.next)!==d;N=R)o(R.Sym.next===N.Sym),o(R.Sym!==R),o(R.Sym.Sym===R),o(R.Org!==null),o(R.Dst!==null),o(R.Lnext.Onext.Sym===R),o(R.Onext.Sym.Lnext===R);o(R.Sym.next===N.Sym&&R.Sym===this.eHeadSym&&R.Sym.Sym===R&&R.Org===null&&R.Dst===null&&R.Lface===null&&R.Rface===null)}},i.vertEq=function(h,m){return h.s===m.s&&h.t===m.t},i.vertLeq=function(h,m){return h.s<m.s||h.s===m.s&&h.t<=m.t},i.transLeq=function(h,m){return h.t<m.t||h.t===m.t&&h.s<=m.s},i.edgeGoesLeft=function(h){return i.vertLeq(h.Dst,h.Org)},i.edgeGoesRight=function(h){return i.vertLeq(h.Org,h.Dst)},i.vertL1dist=function(h,m){return Math.abs(h.s-m.s)+Math.abs(h.t-m.t)},i.edgeEval=function(h,m,d){o(i.vertLeq(h,m)&&i.vertLeq(m,d));var M=m.s-h.s,x=d.s-m.s;return M+x>0?M<x?m.t-h.t+(h.t-d.t)*(M/(M+x)):m.t-d.t+(d.t-h.t)*(x/(M+x)):0},i.edgeSign=function(h,m,d){o(i.vertLeq(h,m)&&i.vertLeq(m,d));var M=m.s-h.s,x=d.s-m.s;return M+x>0?(m.t-d.t)*M+(m.t-h.t)*x:0},i.transEval=function(h,m,d){o(i.transLeq(h,m)&&i.transLeq(m,d));var M=m.t-h.t,x=d.t-m.t;return M+x>0?M<x?m.s-h.s+(h.s-d.s)*(M/(M+x)):m.s-d.s+(d.s-h.s)*(x/(M+x)):0},i.transSign=function(h,m,d){o(i.transLeq(h,m)&&i.transLeq(m,d));var M=m.t-h.t,x=d.t-m.t;return M+x>0?(m.s-d.s)*M+(m.s-h.s)*x:0},i.vertCCW=function(h,m,d){return h.s*(m.t-d.t)+m.s*(d.t-h.t)+d.s*(h.t-m.t)>=0},i.interpolate=function(h,m,d,M){return h=h<0?0:h,d=d<0?0:d,h<=d?d===0?(m+M)/2:m+(M-m)*(h/(h+d)):M+(m-M)*(d/(h+d))},i.intersect=function(h,m,d,M,x){var E,P,R;i.vertLeq(h,m)||(R=h,h=m,m=R),i.vertLeq(d,M)||(R=d,d=M,M=R),i.vertLeq(h,d)||(R=h,h=d,d=R,R=m,m=M,M=R),i.vertLeq(d,m)?i.vertLeq(m,M)?(E=i.edgeEval(h,d,m),P=i.edgeEval(d,m,M),E+P<0&&(E=-E,P=-P),x.s=i.interpolate(E,d.s,P,m.s)):(E=i.edgeSign(h,d,m),P=-i.edgeSign(h,M,m),E+P<0&&(E=-E,P=-P),x.s=i.interpolate(E,d.s,P,M.s)):x.s=(d.s+m.s)/2,i.transLeq(h,m)||(R=h,h=m,m=R),i.transLeq(d,M)||(R=d,d=M,M=R),i.transLeq(h,d)||(R=h,h=d,d=R,R=m,m=M,M=R),i.transLeq(d,m)?i.transLeq(m,M)?(E=i.transEval(h,d,m),P=i.transEval(d,m,M),E+P<0&&(E=-E,P=-P),x.t=i.interpolate(E,d.t,P,m.t)):(E=i.transSign(h,d,m),P=-i.transSign(h,M,m),E+P<0&&(E=-E,P=-P),x.t=i.interpolate(E,d.t,P,M.t)):x.t=(d.t+m.t)/2};function p(){this.key=null,this.next=null,this.prev=null}function c(h,m){this.head=new p,this.head.next=this.head,this.head.prev=this.head,this.frame=h,this.leq=m}c.prototype={min:function(){return this.head.next},max:function(){return this.head.prev},insert:function(h){return this.insertBefore(this.head,h)},search:function(h){var m=this.head;do m=m.next;while(m.key!==null&&!this.leq(this.frame,h,m.key));return m},insertBefore:function(h,m){do h=h.prev;while(h.key!==null&&!this.leq(this.frame,h.key,m));var d=new p;return d.key=m,d.next=h.next,h.next.prev=d,d.prev=h,h.next=d,d},delete:function(h){h.next.prev=h.prev,h.prev.next=h.next}};function g(){this.handle=null}function v(){this.key=null,this.node=null}function I(h,m){this.size=0,this.max=h,this.nodes=[],this.nodes.length=h+1;var d;for(d=0;d<this.nodes.length;d++)this.nodes[d]=new g;for(this.handles=[],this.handles.length=h+1,d=0;d<this.handles.length;d++)this.handles[d]=new v;this.initialized=!1,this.freeList=0,this.leq=m,this.nodes[1].handle=1,this.handles[1].key=null}I.prototype={floatDown_:function(h){var m=this.nodes,d=this.handles,M,x,E;for(M=m[h].handle;;){if(E=h<<1,E<this.size&&this.leq(d[m[E+1].handle].key,d[m[E].handle].key)&&++E,o(E<=this.max),x=m[E].handle,E>this.size||this.leq(d[M].key,d[x].key)){m[h].handle=M,d[M].node=h;break}m[h].handle=x,d[x].node=h,h=E}},floatUp_:function(h){var m=this.nodes,d=this.handles,M,x,E;for(M=m[h].handle;;){if(E=h>>1,x=m[E].handle,E===0||this.leq(d[x].key,d[M].key)){m[h].handle=M,d[M].node=h;break}m[h].handle=x,d[x].node=h,h=E}},init:function(){for(var h=this.size;h>=1;--h)this.floatDown_(h);this.initialized=!0},min:function(){return this.handles[this.nodes[1].handle].key},insert:function(h){var m,d;if(m=++this.size,m*2>this.max){this.max*=2;var M,x;for(x=this.nodes.length,this.nodes.length=this.max+1,M=x;M<this.nodes.length;M++)this.nodes[M]=new g;for(x=this.handles.length,this.handles.length=this.max+1,M=x;M<this.handles.length;M++)this.handles[M]=new v}return this.freeList===0?d=m:(d=this.freeList,this.freeList=this.handles[d].node),this.nodes[m].handle=d,this.handles[d].node=m,this.handles[d].key=h,this.initialized&&this.floatUp_(m),d},extractMin:function(){var h=this.nodes,m=this.handles,d=h[1].handle,M=m[d].key;return this.size>0&&(h[1].handle=h[this.size].handle,m[h[1].handle].node=1,m[d].key=null,m[d].node=this.freeList,this.freeList=d,--this.size,this.size>0&&this.floatDown_(1)),M},delete:function(h){var m=this.nodes,d=this.handles,M;o(h>=1&&h<=this.max&&d[h].key!==null),M=d[h].node,m[M].handle=m[this.size].handle,d[m[M].handle].node=M,--this.size,M<=this.size&&(M<=1||this.leq(d[m[M>>1].handle].key,d[m[M].handle].key)?this.floatDown_(M):this.floatUp_(M)),d[h].key=null,d[h].node=this.freeList,this.freeList=h}};function w(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}var y={};y.regionBelow=function(h){return h.nodeUp.prev.key},y.regionAbove=function(h){return h.nodeUp.next.key},y.debugEvent=function(h){},y.addWinding=function(h,m){h.winding+=m.winding,h.Sym.winding+=m.Sym.winding},y.edgeLeq=function(h,m,d){var M=h.event,P,R,x=m.eUp,E=d.eUp;if(x.Dst===M)return E.Dst===M?i.vertLeq(x.Org,E.Org)?i.edgeSign(E.Dst,x.Org,E.Org)<=0:i.edgeSign(x.Dst,E.Org,x.Org)>=0:i.edgeSign(E.Dst,M,E.Org)<=0;if(E.Dst===M)return i.edgeSign(x.Dst,M,x.Org)>=0;var P=i.edgeEval(x.Dst,M,x.Org),R=i.edgeEval(E.Dst,M,E.Org);return P>=R},y.deleteRegion=function(h,m){m.fixUpperEdge&&o(m.eUp.winding===0),m.eUp.activeRegion=null,h.dict.delete(m.nodeUp)},y.fixUpperEdge=function(h,m,d){o(m.fixUpperEdge),h.mesh.delete(m.eUp),m.fixUpperEdge=!1,m.eUp=d,d.activeRegion=m},y.topLeftRegion=function(h,m){var d=m.eUp.Org,M;do m=y.regionAbove(m);while(m.eUp.Org===d);if(m.fixUpperEdge){if(M=h.mesh.connect(y.regionBelow(m).eUp.Sym,m.eUp.Lnext),M===null)return null;y.fixUpperEdge(h,m,M),m=y.regionAbove(m)}return m},y.topRightRegion=function(h){var m=h.eUp.Dst;do h=y.regionAbove(h);while(h.eUp.Dst===m);return h},y.addRegionBelow=function(h,m,d){var M=new w;return M.eUp=d,M.nodeUp=h.dict.insertBefore(m.nodeUp,M),M.fixUpperEdge=!1,M.sentinel=!1,M.dirty=!1,d.activeRegion=M,M},y.isWindingInside=function(h,m){switch(h.windingRule){case r.WINDING_ODD:return(m&1)!==0;case r.WINDING_NONZERO:return m!==0;case r.WINDING_POSITIVE:return m>0;case r.WINDING_NEGATIVE:return m<0;case r.WINDING_ABS_GEQ_TWO:return m>=2||m<=-2}return o(!1),!1},y.computeWinding=function(h,m){m.windingNumber=y.regionAbove(m).windingNumber+m.eUp.winding,m.inside=y.isWindingInside(h,m.windingNumber)},y.finishRegion=function(h,m){var d=m.eUp,M=d.Lface;M.inside=m.inside,M.anEdge=d,y.deleteRegion(h,m)},y.finishLeftRegions=function(h,m,d){for(var M,P,x=null,E=m,P=m.eUp;E!==d;){if(E.fixUpperEdge=!1,x=y.regionBelow(E),M=x.eUp,M.Org!=P.Org){if(!x.fixUpperEdge){y.finishRegion(h,E);break}M=h.mesh.connect(P.Lprev,M.Sym),y.fixUpperEdge(h,x,M)}P.Onext!==M&&(h.mesh.splice(M.Oprev,M),h.mesh.splice(P,M)),y.finishRegion(h,E),P=x.eUp,E=x}return P},y.addRightEdges=function(h,m,d,M,x,E){var P,R,N,b,j=!0;N=d;do o(i.vertLeq(N.Org,N.Dst)),y.addRegionBelow(h,m,N.Sym),N=N.Onext;while(N!==M);for(x===null&&(x=y.regionBelow(m).eUp.Rprev),R=m,b=x;P=y.regionBelow(R),N=P.eUp.Sym,N.Org===b.Org;)N.Onext!==b&&(h.mesh.splice(N.Oprev,N),h.mesh.splice(b.Oprev,N)),P.windingNumber=R.windingNumber-N.winding,P.inside=y.isWindingInside(h,P.windingNumber),R.dirty=!0,!j&&y.checkForRightSplice(h,R)&&(y.addWinding(N,b),y.deleteRegion(h,R),h.mesh.delete(b)),j=!1,R=P,b=N;R.dirty=!0,o(R.windingNumber-N.winding===P.windingNumber),E&&y.walkDirtyRegions(h,R)},y.spliceMergeVertices=function(h,m,d){h.mesh.splice(m,d)},y.vertexWeights=function(h,m,d){var M=i.vertL1dist(m,h),x=i.vertL1dist(d,h),E=.5*x/(M+x),P=.5*M/(M+x);h.coords[0]+=E*m.coords[0]+P*d.coords[0],h.coords[1]+=E*m.coords[1]+P*d.coords[1],h.coords[2]+=E*m.coords[2]+P*d.coords[2]},y.getIntersectData=function(h,m,d,M,x,E){m.coords[0]=m.coords[1]=m.coords[2]=0,m.idx=-1,y.vertexWeights(m,d,M),y.vertexWeights(m,x,E)},y.checkForRightSplice=function(h,m){var d=y.regionBelow(m),M=m.eUp,x=d.eUp;if(i.vertLeq(M.Org,x.Org)){if(i.edgeSign(x.Dst,M.Org,x.Org)>0)return!1;i.vertEq(M.Org,x.Org)?M.Org!==x.Org&&(h.pq.delete(M.Org.pqHandle),y.spliceMergeVertices(h,x.Oprev,M)):(h.mesh.splitEdge(x.Sym),h.mesh.splice(M,x.Oprev),m.dirty=d.dirty=!0)}else{if(i.edgeSign(M.Dst,x.Org,M.Org)<0)return!1;y.regionAbove(m).dirty=m.dirty=!0,h.mesh.splitEdge(M.Sym),h.mesh.splice(x.Oprev,M)}return!0},y.checkForLeftSplice=function(h,m){var d=y.regionBelow(m),M=m.eUp,x=d.eUp,E;if(o(!i.vertEq(M.Dst,x.Dst)),i.vertLeq(M.Dst,x.Dst)){if(i.edgeSign(M.Dst,x.Dst,M.Org)<0)return!1;y.regionAbove(m).dirty=m.dirty=!0,E=h.mesh.splitEdge(M),h.mesh.splice(x.Sym,E),E.Lface.inside=m.inside}else{if(i.edgeSign(x.Dst,M.Dst,x.Org)>0)return!1;m.dirty=d.dirty=!0,E=h.mesh.splitEdge(x),h.mesh.splice(M.Lnext,x.Sym),E.Rface.inside=m.inside}return!0},y.checkForIntersect=function(h,m){var d=y.regionBelow(m),M=m.eUp,x=d.eUp,E=M.Org,P=x.Org,R=M.Dst,N=x.Dst,b,j,O=new s,L,k;if(o(!i.vertEq(N,R)),o(i.edgeSign(R,h.event,E)<=0),o(i.edgeSign(N,h.event,P)>=0),o(E!==h.event&&P!==h.event),o(!m.fixUpperEdge&&!d.fixUpperEdge),E===P||(b=Math.min(E.t,R.t),j=Math.max(P.t,N.t),b>j))return!1;if(i.vertLeq(E,P)){if(i.edgeSign(N,E,P)>0)return!1}else if(i.edgeSign(R,P,E)<0)return!1;return y.debugEvent(h),i.intersect(R,E,N,P,O),o(Math.min(E.t,R.t)<=O.t),o(O.t<=Math.max(P.t,N.t)),o(Math.min(N.s,R.s)<=O.s),o(O.s<=Math.max(P.s,E.s)),i.vertLeq(O,h.event)&&(O.s=h.event.s,O.t=h.event.t),L=i.vertLeq(E,P)?E:P,i.vertLeq(L,O)&&(O.s=L.s,O.t=L.t),i.vertEq(O,E)||i.vertEq(O,P)?(y.checkForRightSplice(h,m),!1):!i.vertEq(R,h.event)&&i.edgeSign(R,h.event,O)>=0||!i.vertEq(N,h.event)&&i.edgeSign(N,h.event,O)<=0?N===h.event?(h.mesh.splitEdge(M.Sym),h.mesh.splice(x.Sym,M),m=y.topLeftRegion(h,m),M=y.regionBelow(m).eUp,y.finishLeftRegions(h,y.regionBelow(m),d),y.addRightEdges(h,m,M.Oprev,M,M,!0),!0):R===h.event?(h.mesh.splitEdge(x.Sym),h.mesh.splice(M.Lnext,x.Oprev),d=m,m=y.topRightRegion(m),k=y.regionBelow(m).eUp.Rprev,d.eUp=x.Oprev,x=y.finishLeftRegions(h,d,null),y.addRightEdges(h,m,x.Onext,M.Rprev,k,!0),!0):(i.edgeSign(R,h.event,O)>=0&&(y.regionAbove(m).dirty=m.dirty=!0,h.mesh.splitEdge(M.Sym),M.Org.s=h.event.s,M.Org.t=h.event.t),i.edgeSign(N,h.event,O)<=0&&(m.dirty=d.dirty=!0,h.mesh.splitEdge(x.Sym),x.Org.s=h.event.s,x.Org.t=h.event.t),!1):(h.mesh.splitEdge(M.Sym),h.mesh.splitEdge(x.Sym),h.mesh.splice(x.Oprev,M),M.Org.s=O.s,M.Org.t=O.t,M.Org.pqHandle=h.pq.insert(M.Org),y.getIntersectData(h,M.Org,E,R,P,N),y.regionAbove(m).dirty=m.dirty=d.dirty=!0,!1)},y.walkDirtyRegions=function(h,m){for(var d=y.regionBelow(m),M,x;;){for(;d.dirty;)m=d,d=y.regionBelow(d);if(!m.dirty&&(d=m,m=y.regionAbove(m),m===null||!m.dirty))return;if(m.dirty=!1,M=m.eUp,x=d.eUp,M.Dst!==x.Dst&&y.checkForLeftSplice(h,m)&&(d.fixUpperEdge?(y.deleteRegion(h,d),h.mesh.delete(x),d=y.regionBelow(m),x=d.eUp):m.fixUpperEdge&&(y.deleteRegion(h,m),h.mesh.delete(M),m=y.regionAbove(d),M=m.eUp)),M.Org!==x.Org)if(M.Dst!==x.Dst&&!m.fixUpperEdge&&!d.fixUpperEdge&&(M.Dst===h.event||x.Dst===h.event)){if(y.checkForIntersect(h,m))return}else y.checkForRightSplice(h,m);M.Org===x.Org&&M.Dst===x.Dst&&(y.addWinding(x,M),y.deleteRegion(h,m),h.mesh.delete(M),m=y.regionAbove(d))}},y.connectRightVertex=function(h,m,d){var M,x=d.Onext,E=y.regionBelow(m),P=m.eUp,R=E.eUp,N=!1;if(P.Dst!==R.Dst&&y.checkForIntersect(h,m),i.vertEq(P.Org,h.event)&&(h.mesh.splice(x.Oprev,P),m=y.topLeftRegion(h,m),x=y.regionBelow(m).eUp,y.finishLeftRegions(h,y.regionBelow(m),E),N=!0),i.vertEq(R.Org,h.event)&&(h.mesh.splice(d,R.Oprev),d=y.finishLeftRegions(h,E,null),N=!0),N){y.addRightEdges(h,m,d.Onext,x,x,!0);return}i.vertLeq(R.Org,P.Org)?M=R.Oprev:M=P,M=h.mesh.connect(d.Lprev,M),y.addRightEdges(h,m,M,M.Onext,M.Onext,!1),M.Sym.activeRegion.fixUpperEdge=!0,y.walkDirtyRegions(h,m)},y.connectLeftDegenerate=function(h,m,d){var M,x,E,P,R;if(M=m.eUp,i.vertEq(M.Org,d)){o(!1),y.spliceMergeVertices(h,M,d.anEdge);return}if(!i.vertEq(M.Dst,d)){h.mesh.splitEdge(M.Sym),m.fixUpperEdge&&(h.mesh.delete(M.Onext),m.fixUpperEdge=!1),h.mesh.splice(d.anEdge,M),y.sweepEvent(h,d);return}o(!1),m=y.topRightRegion(m),R=y.regionBelow(m),E=R.eUp.Sym,x=P=E.Onext,R.fixUpperEdge&&(o(x!==E),y.deleteRegion(h,R),h.mesh.delete(E),E=x.Oprev),h.mesh.splice(d.anEdge,E),i.edgeGoesLeft(x)||(x=null),y.addRightEdges(h,m,E.Onext,P,x,!0)},y.connectLeftVertex=function(h,m){var d,M,x,E,P,R,N=new w;if(N.eUp=m.anEdge.Sym,d=h.dict.search(N).key,M=y.regionBelow(d),!!M){if(E=d.eUp,P=M.eUp,i.edgeSign(E.Dst,m,E.Org)===0){y.connectLeftDegenerate(h,d,m);return}if(x=i.vertLeq(P.Dst,E.Dst)?d:M,d.inside||x.fixUpperEdge){if(x===d)R=h.mesh.connect(m.anEdge.Sym,E.Lnext);else{var b=h.mesh.connect(P.Dnext,m.anEdge);R=b.Sym}x.fixUpperEdge?y.fixUpperEdge(h,x,R):y.computeWinding(h,y.addRegionBelow(h,d,R)),y.sweepEvent(h,m)}else y.addRightEdges(h,d,m.anEdge,m.anEdge,null,!0)}},y.sweepEvent=function(h,m){h.event=m,y.debugEvent(h);for(var d=m.anEdge;d.activeRegion===null;)if(d=d.Onext,d===m.anEdge){y.connectLeftVertex(h,m);return}var M=y.topLeftRegion(h,d.activeRegion);o(M!==null);var x=y.regionBelow(M),E=x.eUp,P=y.finishLeftRegions(h,x,null);P.Onext===E?y.connectRightVertex(h,M,P):y.addRightEdges(h,M,P.Onext,E,E,!0)},y.addSentinel=function(h,m,d,M){var x=new w,E=h.mesh.makeEdge();E.Org.s=d,E.Org.t=M,E.Dst.s=m,E.Dst.t=M,h.event=E.Dst,x.eUp=E,x.windingNumber=0,x.inside=!1,x.fixUpperEdge=!1,x.sentinel=!0,x.dirty=!1,x.nodeUp=h.dict.insert(x)},y.initEdgeDict=function(h){h.dict=new c(h,y.edgeLeq);var m=h.bmax[0]-h.bmin[0],d=h.bmax[1]-h.bmin[1],M=h.bmin[0]-m,x=h.bmax[0]+m,E=h.bmin[1]-d,P=h.bmax[1]+d;y.addSentinel(h,M,x,E),y.addSentinel(h,M,x,P)},y.doneEdgeDict=function(h){for(var m,d=0;(m=h.dict.min().key)!==null;)m.sentinel||(o(m.fixUpperEdge),o(++d===1)),o(m.windingNumber===0),y.deleteRegion(h,m)},y.removeDegenerateEdges=function(h){var m,d,M,x=h.mesh.eHead;for(m=x.next;m!==x;m=d)d=m.next,M=m.Lnext,i.vertEq(m.Org,m.Dst)&&m.Lnext.Lnext!==m&&(y.spliceMergeVertices(h,M,m),h.mesh.delete(m),m=M,M=m.Lnext),M.Lnext===m&&(M!==m&&((M===d||M===d.Sym)&&(d=d.next),h.mesh.delete(M)),(m===d||m===d.Sym)&&(d=d.next),h.mesh.delete(m))},y.initPriorityQ=function(h){var m,d,M,x=0;for(M=h.mesh.vHead,d=M.next;d!==M;d=d.next)x++;for(x+=8,m=h.pq=new I(x,i.vertLeq),M=h.mesh.vHead,d=M.next;d!==M;d=d.next)d.pqHandle=m.insert(d);return d!==M?!1:(m.init(),!0)},y.donePriorityQ=function(h){h.pq=null},y.removeDegenerateFaces=function(h,m){var d,M,x;for(d=m.fHead.next;d!==m.fHead;d=M)M=d.next,x=d.anEdge,o(x.Lnext!==x),x.Lnext.Lnext===x&&(y.addWinding(x.Onext,x),h.mesh.delete(x));return!0},y.computeInterior=function(h){var m,d;if(y.removeDegenerateEdges(h),!y.initPriorityQ(h))return!1;for(y.initEdgeDict(h);(m=h.pq.extractMin())!==null;){for(;d=h.pq.min(),!(d===null||!i.vertEq(d,m));)d=h.pq.extractMin(),y.spliceMergeVertices(h,m.anEdge,d.anEdge);y.sweepEvent(h,m)}return h.event=h.dict.min().key.eUp.Org,y.debugEvent(h),y.doneEdgeDict(h),y.donePriorityQ(h),y.removeDegenerateFaces(h,h.mesh)?(h.mesh.check(),!0):!1};function T(){this.mesh=null,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=r.WINDING_ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}T.prototype={dot_:function(h,m){return h[0]*m[0]+h[1]*m[1]+h[2]*m[2]},normalize_:function(h){var m=h[0]*h[0]+h[1]*h[1]+h[2]*h[2];o(m>0),m=Math.sqrt(m),h[0]/=m,h[1]/=m,h[2]/=m},longAxis_:function(h){var m=0;return Math.abs(h[1])>Math.abs(h[0])&&(m=1),Math.abs(h[2])>Math.abs(h[m])&&(m=2),m},computeNormal_:function(h){var m,d,M,x,E,P,R=[0,0,0],N=[0,0,0],b=[0,0,0],j=[0,0,0],O=[0,0,0],L=[null,null,null],k=[null,null,null],H=this.mesh.vHead,Q;for(m=H.next,Q=0;Q<3;++Q)x=m.coords[Q],N[Q]=x,k[Q]=m,R[Q]=x,L[Q]=m;for(m=H.next;m!==H;m=m.next)for(Q=0;Q<3;++Q)x=m.coords[Q],x<N[Q]&&(N[Q]=x,k[Q]=m),x>R[Q]&&(R[Q]=x,L[Q]=m);if(Q=0,R[1]-N[1]>R[0]-N[0]&&(Q=1),R[2]-N[2]>R[Q]-N[Q]&&(Q=2),N[Q]>=R[Q]){h[0]=0,h[1]=0,h[2]=1;return}for(P=0,d=k[Q],M=L[Q],b[0]=d.coords[0]-M.coords[0],b[1]=d.coords[1]-M.coords[1],b[2]=d.coords[2]-M.coords[2],m=H.next;m!==H;m=m.next)j[0]=m.coords[0]-M.coords[0],j[1]=m.coords[1]-M.coords[1],j[2]=m.coords[2]-M.coords[2],O[0]=b[1]*j[2]-b[2]*j[1],O[1]=b[2]*j[0]-b[0]*j[2],O[2]=b[0]*j[1]-b[1]*j[0],E=O[0]*O[0]+O[1]*O[1]+O[2]*O[2],E>P&&(P=E,h[0]=O[0],h[1]=O[1],h[2]=O[2]);P<=0&&(h[0]=h[1]=h[2]=0,h[this.longAxis_(b)]=1)},checkOrientation_:function(){var h,m,d=this.mesh.fHead,M,x=this.mesh.vHead,E;for(h=0,m=d.next;m!==d;m=m.next)if(E=m.anEdge,!(E.winding<=0))do h+=(E.Org.s-E.Dst.s)*(E.Org.t+E.Dst.t),E=E.Lnext;while(E!==m.anEdge);if(h<0){for(M=x.next;M!==x;M=M.next)M.t=-M.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},projectPolygon_:function(){var h,m=this.mesh.vHead,d=[0,0,0],M,x,E,P,R=!1;for(d[0]=this.normal[0],d[1]=this.normal[1],d[2]=this.normal[2],d[0]===0&&d[1]===0&&d[2]===0&&(this.computeNormal_(d),R=!0),M=this.sUnit,x=this.tUnit,E=this.longAxis_(d),M[E]=0,M[(E+1)%3]=1,M[(E+2)%3]=0,x[E]=0,x[(E+1)%3]=0,x[(E+2)%3]=d[E]>0?1:-1,h=m.next;h!==m;h=h.next)h.s=this.dot_(h.coords,M),h.t=this.dot_(h.coords,x);for(R&&this.checkOrientation_(),P=!0,h=m.next;h!==m;h=h.next)P?(this.bmin[0]=this.bmax[0]=h.s,this.bmin[1]=this.bmax[1]=h.t,P=!1):(h.s<this.bmin[0]&&(this.bmin[0]=h.s),h.s>this.bmax[0]&&(this.bmax[0]=h.s),h.t<this.bmin[1]&&(this.bmin[1]=h.t),h.t>this.bmax[1]&&(this.bmax[1]=h.t))},addWinding_:function(h,m){h.winding+=m.winding,h.Sym.winding+=m.Sym.winding},tessellateMonoRegion_:function(h,m){var d,M;for(d=m.anEdge,o(d.Lnext!==d&&d.Lnext.Lnext!==d);i.vertLeq(d.Dst,d.Org);d=d.Lprev);for(;i.vertLeq(d.Org,d.Dst);d=d.Lnext);for(M=d.Lprev;d.Lnext!==M;)if(i.vertLeq(d.Dst,M.Org)){for(;M.Lnext!==d&&(i.edgeGoesLeft(M.Lnext)||i.edgeSign(M.Org,M.Dst,M.Lnext.Dst)<=0);){var x=h.connect(M.Lnext,M);M=x.Sym}M=M.Lprev}else{for(;M.Lnext!==d&&(i.edgeGoesRight(d.Lprev)||i.edgeSign(d.Dst,d.Org,d.Lprev.Org)>=0);){var x=h.connect(d,d.Lprev);d=x.Sym}d=d.Lnext}for(o(M.Lnext!==d);M.Lnext.Lnext!==d;){var x=h.connect(M.Lnext,M);M=x.Sym}return!0},tessellateInterior_:function(h){var m,d;for(m=h.fHead.next;m!==h.fHead;m=d)if(d=m.next,m.inside&&!this.tessellateMonoRegion_(h,m))return!1;return!0},discardExterior_:function(h){var m,d;for(m=h.fHead.next;m!==h.fHead;m=d)d=m.next,m.inside||h.zapFace(m)},setWindingNumber_:function(h,m,d){var M,x;for(M=h.eHead.next;M!==h.eHead;M=x)x=M.next,M.Rface.inside!==M.Lface.inside?M.winding=M.Lface.inside?m:-m:d?h.delete(M):M.winding=0},getNeighbourFace_:function(h){return!h.Rface||!h.Rface.inside?-1:h.Rface.n},outputPolymesh_:function(h,m,d,M){var x,E,P,R=0,N=0,b,j;for(d>3&&h.mergeConvexFaces(d),x=h.vHead.next;x!==h.vHead;x=x.next)x.n=-1;for(E=h.fHead.next;E!==h.fHead;E=E.next)if(E.n=-1,!!E.inside){P=E.anEdge,b=0;do x=P.Org,x.n===-1&&(x.n=N,N++),b++,P=P.Lnext;while(P!==E.anEdge);o(b<=d),E.n=R,++R}for(this.elementCount=R,m===r.CONNECTED_POLYGONS&&(R*=2),this.elements=[],this.elements.length=R*d,this.vertexCount=N,this.vertices=[],this.vertices.length=N*M,this.vertexIndices=[],this.vertexIndices.length=N,x=h.vHead.next;x!==h.vHead;x=x.next)if(x.n!==-1){var O=x.n*M;this.vertices[O+0]=x.coords[0],this.vertices[O+1]=x.coords[1],M>2&&(this.vertices[O+2]=x.coords[2]),this.vertexIndices[x.n]=x.idx}var L=0;for(E=h.fHead.next;E!==h.fHead;E=E.next)if(E.inside){P=E.anEdge,b=0;do x=P.Org,this.elements[L++]=x.n,b++,P=P.Lnext;while(P!==E.anEdge);for(j=b;j<d;++j)this.elements[L++]=-1;if(m===r.CONNECTED_POLYGONS){P=E.anEdge;do this.elements[L++]=this.getNeighbourFace_(P),P=P.Lnext;while(P!==E.anEdge);for(j=b;j<d;++j)this.elements[L++]=-1}}},outputContours_:function(h,m){var d,M,x,E=0,P=0;for(this.vertexCount=0,this.elementCount=0,d=h.fHead.next;d!==h.fHead;d=d.next)if(d.inside){x=M=d.anEdge;do this.vertexCount++,M=M.Lnext;while(M!==x);this.elementCount++}this.elements=[],this.elements.length=this.elementCount*2,this.vertices=[],this.vertices.length=this.vertexCount*m,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var R=0,N=0,b=0;for(E=0,d=h.fHead.next;d!==h.fHead;d=d.next)if(d.inside){P=0,x=M=d.anEdge;do this.vertices[R++]=M.Org.coords[0],this.vertices[R++]=M.Org.coords[1],m>2&&(this.vertices[R++]=M.Org.coords[2]),this.vertexIndices[N++]=M.Org.idx,P++,M=M.Lnext;while(M!==x);this.elements[b++]=E,this.elements[b++]=P,E+=P}},addContour:function(h,m){var d,M;for(this.mesh===null&&(this.mesh=new u),h<2&&(h=2),h>3&&(h=3),d=null,M=0;M<m.length;M+=h)d===null?(d=this.mesh.makeEdge(),this.mesh.splice(d,d.Sym)):(this.mesh.splitEdge(d),d=d.Lnext),d.Org.coords[0]=m[M+0],d.Org.coords[1]=m[M+1],h>2?d.Org.coords[2]=m[M+2]:d.Org.coords[2]=0,d.Org.idx=this.vertexIndexCounter++,d.winding=1,d.Sym.winding=-1},tesselate:function(h,m,d,M,x){if(this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,x&&(this.normal[0]=x[0],this.normal[1]=x[1],this.normal[2]=x[2]),this.windingRule=h,M<2&&(M=2),M>3&&(M=3),!this.mesh)return!1;this.projectPolygon_(),y.computeInterior(this);var E=this.mesh;return m===r.BOUNDARY_CONTOURS?this.setWindingNumber_(E,1,!0):this.tessellateInterior_(E),E.check(),m===r.BOUNDARY_CONTOURS?this.outputContours_(E,M):this.outputPolymesh_(E,m,d,M),!0}}},function(n,t){n.exports=r;var e=Object.prototype.hasOwnProperty;function r(){for(var i={},o=0;o<arguments.length;o++){var s=arguments[o];for(var a in s)e.call(s,a)&&(i[a]=s[a])}return i}},function(n,t,e){e.r(t),e.d(t,"createShaders",function(){return l}),e.d(t,"applyShader",function(){return u}),e.d(t,"createCloudShaders",function(){return c}),e.d(t,"applyCloudShader",function(){return g});var r=e(64),i=e(65),o=e(66),s=e(67);e(1).glMatrix.setMatrixArrayType(Array);const a=Symbol("shaders");function l(v){v[a]=[];for(let I=0;I<16;I++){const w=[],y=!!(I&1),T=!!(I&2),h=!!(I&4),m=!!(I&8);y&&w.push("#define TEXTURE 1"),T&&w.push("#define FILTER 1"),h&&w.push("#define GRADIENT 1"),m&&w.push("#define CLIPPATH 1");const d=`${w.join(`
`)}
`,M=[];y&&M.push("uniform sampler2D u_texSampler;"),m&&M.push("uniform sampler2D u_clipSampler;"),v[a][I]=[d+M.join(`
`)+i.default,d+r.default]}}function u(v,{hasTexture:I=!1,hasFilter:w=!1,hasGradient:y=!1,hasClipPath:T=!1}={}){const h=I|w<<1|y<<2|T<<3;let m=v[a][h];Array.isArray(m)&&(m=v.createProgram(...m),v[a][h]=m),v.program!==m&&v.useProgram(m,{a_color:{type:"UNSIGNED_BYTE",normalize:!0}})}const p=[];function c(v){for(let I=0;I<64;I++){const w=[],y=!!(I&1),T=!!(I&2),h=!!(I&4),m=!!(I&8),d=!!(I&16),M=!!(I&32);y&&w.push("#define TEXTURE 1"),T&&w.push("#define FILTER 1"),h&&w.push("#define GRADIENT 1"),m&&w.push("#define CLOUDCOLOR 1"),d&&w.push("#define CLOUDFILTER 1"),M&&w.push("#define CLIPPATH 1");const x=`${w.join(`
`)}
`,E=[];if(y){E.push("uniform sampler2D u_texSampler;");for(let P=0;P<12;P++)E.push(`uniform sampler2D u_texFrame${P};`)}M&&E.push("uniform sampler2D u_clipSampler;"),p[I]=[x+E.join(`
`)+s.default,x+o.default]}}function g(v,{hasTexture:I=!1,hasFilter:w=!1,hasGradient:y=!1,hasCloudColor:T=!1,hasCloudFilter:h=!1,hasClipPath:m=!1}={}){const d=I|w<<1|y<<2|T<<3|h<<4|m<<5;let M=p[d];Array.isArray(M)&&(M=v.createProgram(...M),p[d]=M),v.program!==M&&v.useProgram(M,{a_color:{type:"UNSIGNED_BYTE",normalize:!0},a_fillCloudColor:{type:"UNSIGNED_BYTE",normalize:!0},a_strokeCloudColor:{type:"UNSIGNED_BYTE",normalize:!0},a_frameIndex:{type:"UNSIGNED_BYTE",normalize:!1}})}},function(n,t,e){e.r(t),t.default=`attribute vec3 a_vertexPosition;
attribute vec4 a_color;
varying vec4 vColor;
varying float flagBackground;
uniform vec2 u_resolution;
uniform mat3 viewMatrix;
uniform mat3 projectionMatrix;

#ifdef TEXTURE
attribute vec3 a_vertexTextureCoord;
varying vec3 vTextureCoord;
attribute vec4 a_sourceRect;
varying vec4 vSourceRect;
#endif

#ifdef CLIPPATH
attribute vec2 a_clipUV;
varying vec2 vClipUV;
#endif

#ifdef GRADIENT
uniform float u_radialGradientVector[6];
varying vec3 vGradientVector1;
varying vec3 vGradientVector2;
#endif

void main() {
  gl_PointSize = 1.0;

  vec3 pos = projectionMatrix * viewMatrix * vec3(a_vertexPosition.xy, 1.0);
  gl_Position = vec4(pos.xy, 1.0, 1.0);

#ifdef GRADIENT
  vec3 vg1 = viewMatrix * vec3(u_radialGradientVector[0], u_radialGradientVector[1], 1.0);
  vec3 vg2 = viewMatrix * vec3(u_radialGradientVector[3], u_radialGradientVector[4], 1.0);
  float h = u_resolution.y;
  vg1.y = h - vg1.y;
  vg2.y = h - vg2.y;
  vGradientVector1 = vec3(vg1.xy, u_radialGradientVector[2]);
  vGradientVector2 = vec3(vg2.xy, u_radialGradientVector[5]);
#endif
  
  flagBackground = a_vertexPosition.z;
  vColor = a_color;

#ifdef TEXTURE
  vTextureCoord = a_vertexTextureCoord;
  vSourceRect = a_sourceRect;
#endif

#ifdef CLIPPATH
  vClipUV = a_clipUV;
#endif
}`},function(n,t,e){e.r(t),t.default=`precision mediump float;

varying vec4 vColor;
varying float flagBackground;

#ifdef TEXTURE
varying vec3 vTextureCoord;
varying vec4 vSourceRect;
#endif

#ifdef CLIPPATH
varying vec2 vClipUV;
#endif

#ifdef FILTER
uniform int u_filterFlag;
uniform float u_colorMatrix[20];
#endif

#ifdef GRADIENT
varying vec3 vGradientVector1;
varying vec3 vGradientVector2;
uniform float u_colorSteps[40];
uniform int u_gradientType;
// uniform float u_radialGradientVector[6];

void gradient(inout vec4 color, vec3 gv1, vec3 gv2, float colorSteps[40]) {
  float t;
  // center circle radius
  float cr = gv1.z;
  // focal circle radius
  float fr = gv2.z;

  if(cr > 0.0 || fr > 0.0) {
    // radial gradient
    vec2 center = gv1.xy;
    vec2 focal = gv2.xy;
    float x = focal.x - gl_FragCoord.x;
    float y = focal.y - gl_FragCoord.y;
    float dx = focal.x - center.x;
    float dy = focal.y - center.y;
    float dr = cr - fr;
    float a = dx * dx + dy * dy - dr * dr;
    float b = -2.0 * (y * dy + x * dx + fr * dr);
    float c = x * x + y * y - fr * fr;
    t = 1.0 - 0.5 * (1.0 / a) * (-b + sqrt(b * b - 4.0 * a * c));
  } else {
    // linear gradient
    vec2 v1 = gl_FragCoord.xy - gv1.xy;
    vec2 v2 = gv2.xy - gv1.xy;
    t = (v1.x * v2.x + v1.y * v2.y) / (v2.x * v2.x + v2.y * v2.y);
  }

  vec4 colors[8];
  colors[0] = vec4(colorSteps[1], colorSteps[2], colorSteps[3], colorSteps[4]);
  colors[1] = vec4(colorSteps[6], colorSteps[7], colorSteps[8], colorSteps[9]);
  colors[2] = vec4(colorSteps[11], colorSteps[12], colorSteps[13], colorSteps[14]);
  colors[3] = vec4(colorSteps[16], colorSteps[17], colorSteps[18], colorSteps[19]);
  colors[4] = vec4(colorSteps[21], colorSteps[22], colorSteps[23], colorSteps[24]);
  colors[5] = vec4(colorSteps[26], colorSteps[27], colorSteps[28], colorSteps[29]);
  colors[6] = vec4(colorSteps[31], colorSteps[32], colorSteps[33], colorSteps[34]);
  colors[7] = vec4(colorSteps[36], colorSteps[37], colorSteps[38], colorSteps[39]);
  
  float steps[8];
  steps[0] = colorSteps[0];
  steps[1] = colorSteps[5];
  steps[2] = colorSteps[10];
  steps[3] = colorSteps[15];
  steps[4] = colorSteps[20];
  steps[5] = colorSteps[25];
  steps[6] = colorSteps[30];
  steps[7] = colorSteps[35];

  color = colors[0];
  for (int i = 1; i < 8; i++) {
    if (steps[i] < 0.0 || steps[i] > 1.0) {
      break;
    }
    if(steps[i] == steps[i - 1]) {
      color = colors[i];
    } else {
      color = mix(color, colors[i], clamp((t - steps[i - 1]) / (steps[i] - steps[i - 1]), 0.0, 1.0));
    }
    if (steps[i] >= t) {
      break;
    }
  }
}
#endif

#ifdef FILTER
void transformColor(inout vec4 color, in float colorMatrix[20]) {
  float r = color.r, g = color.g, b = color.b, a = color.a;
  color[0] = colorMatrix[0] * r + colorMatrix[1] * g + colorMatrix[2] * b + colorMatrix[3] * a + colorMatrix[4];
  color[1] = colorMatrix[5] * r + colorMatrix[6] * g + colorMatrix[7] * b + colorMatrix[8] * a + colorMatrix[9];
  color[2] = colorMatrix[10] * r + colorMatrix[11] * g + colorMatrix[12] * b + colorMatrix[13] * a + colorMatrix[14];
  color[3] = colorMatrix[15] * r + colorMatrix[16] * g + colorMatrix[17] * b + colorMatrix[18] * a + colorMatrix[19];
}
#endif

void main() {
  vec4 color = vColor;
  float opacity = abs(flagBackground);

#ifdef GRADIENT
  if(u_gradientType > 0 && flagBackground > 0.0 || u_gradientType == 0 && flagBackground <= 0.0) {
    gradient(color, vGradientVector1, vGradientVector2, u_colorSteps);
  }
#endif

  if(opacity < 1.0) {
    color.a *= opacity;
  }

#ifdef TEXTURE
  if(flagBackground > 0.0) {
    vec3 texCoord = vTextureCoord;

    if(texCoord.z == 1.0) {
      texCoord = fract(texCoord);
    }

    if(texCoord.x <= 1.0 && texCoord.x >= 0.0
      && texCoord.y <= 1.0 && texCoord.y >= 0.0) {
      if(vSourceRect.z > 0.0) {
        texCoord.x = vSourceRect.x + texCoord.x * vSourceRect.z;
        texCoord.y = 1.0 - (vSourceRect.y + (1.0 - texCoord.y) * vSourceRect.w);
      }
      vec4 texColor = texture2D(u_texSampler, texCoord.xy);
      float alpha = texColor.a;
      if(opacity < 1.0) {
        texColor.a *= opacity;
        alpha *= mix(0.465, 1.0, opacity);
      }
      // color = mix(color, texColor, texColor.a);
      color.rgb = mix(color.rgb, texColor.rgb, alpha);
      // color.rgb = mix(texColor.rgb, color.rgb, color.a);
      color.rgb = mix(texColor.rgb, color.rgb, clamp(color.a / max(0.0001, texColor.a), 0.0, 1.0));
      color.a = texColor.a + (1.0 - texColor.a) * color.a;
    }
  }
#endif

#ifdef FILTER
  if(u_filterFlag > 0) {
    transformColor(color, u_colorMatrix);
  }
#endif

#ifdef CLIPPATH
  float clip = texture2D(u_clipSampler, vClipUV).r;
  color *= clip;
#endif

  gl_FragColor = color;
}`},function(n,t,e){e.r(t),t.default=`attribute vec3 a_vertexPosition;
attribute vec4 a_color;
varying vec4 vColor;
varying float flagBackground;
attribute vec3 a_transform0;
attribute vec3 a_transform1;
uniform vec2 u_resolution;
uniform mat3 viewMatrix;
uniform mat3 projectionMatrix;

#ifdef TEXTURE
attribute vec3 a_vertexTextureCoord;
varying vec3 vTextureCoord;
attribute float a_frameIndex;
varying float frameIndex;
attribute vec4 a_sourceRect;
varying vec4 vSourceRect;
#endif

#ifdef CLIPPATH
attribute vec2 a_clipUV;
varying vec2 vClipUV;
#endif

#ifdef CLOUDFILTER
attribute vec4 a_colorCloud0;
attribute vec4 a_colorCloud1;
attribute vec4 a_colorCloud2;
attribute vec4 a_colorCloud3;
attribute vec4 a_colorCloud4;
varying vec4 colorCloud0;
varying vec4 colorCloud1;
varying vec4 colorCloud2;
varying vec4 colorCloud3;
varying vec4 colorCloud4;
#endif

#ifdef CLOUDCOLOR
attribute vec4 a_fillCloudColor;
attribute vec4 a_strokeCloudColor;
#endif

#ifdef GRADIENT
uniform float u_radialGradientVector[6];
varying vec3 vGradientVector1;
varying vec3 vGradientVector2;
#endif

void main() {
  gl_PointSize = 1.0;

  mat3 modelMatrix = mat3(
    a_transform0.x, a_transform1.x, 0, 
    a_transform0.y, a_transform1.y, 0,
    a_transform0.z, a_transform1.z, 1
  );

  vec3 pos = projectionMatrix * viewMatrix * modelMatrix * vec3(a_vertexPosition.xy, 1.0);
  gl_Position = vec4(pos.xy, 1.0, 1.0);

#ifdef GRADIENT
  vec3 vg1 = viewMatrix * vec3(u_radialGradientVector[0], u_radialGradientVector[1], 1.0);
  vec3 vg2 = viewMatrix * vec3(u_radialGradientVector[3], u_radialGradientVector[4], 1.0);
  float h = u_resolution.y;
  vg1.y = h - vg1.y;
  vg2.y = h - vg2.y;
  vGradientVector1 = vec3(vg1.xy, u_radialGradientVector[2]);
  vGradientVector2 = vec3(vg2.xy, u_radialGradientVector[5]);
#endif
  
  flagBackground = a_vertexPosition.z;

#ifdef CLOUDCOLOR
  if(flagBackground > 0.0) {
    vColor = mix(a_color, a_fillCloudColor, a_fillCloudColor.a);
  } else {
    vColor = mix(a_color, a_strokeCloudColor, a_strokeCloudColor.a);
  }
#else
  vColor = a_color;
#endif

#ifdef TEXTURE
  vTextureCoord = a_vertexTextureCoord;
  frameIndex = a_frameIndex;
  vSourceRect = a_sourceRect;
#endif

#ifdef CLIPPATH
  vClipUV = a_clipUV;
#endif

#ifdef CLOUDFILTER
  colorCloud0 = a_colorCloud0;
  colorCloud1 = a_colorCloud1;
  colorCloud2 = a_colorCloud2;
  colorCloud3 = a_colorCloud3;
  colorCloud4 = a_colorCloud4;
#endif
}`},function(n,t,e){e.r(t),t.default=`precision mediump float;

varying vec4 vColor;
varying float flagBackground;

#ifdef TEXTURE
varying float frameIndex;
varying vec3 vTextureCoord;
varying vec4 vSourceRect;
#endif

#ifdef CLIPPATH
varying vec2 vClipUV;
#endif

#ifdef FILTER
uniform int u_filterFlag;
uniform float u_colorMatrix[20];
#endif

#ifdef CLOUDFILTER
varying vec4 colorCloud0;
varying vec4 colorCloud1;
varying vec4 colorCloud2;
varying vec4 colorCloud3;
varying vec4 colorCloud4;
#endif

#ifdef GRADIENT
varying vec3 vGradientVector1;
varying vec3 vGradientVector2;
uniform float u_colorSteps[40];
uniform int u_gradientType;

void gradient(inout vec4 color, vec3 gv1, vec3 gv2, float colorSteps[40]) {
  float t;
  // center circle radius
  float cr = gv1.z;
  // focal circle radius
  float fr = gv2.z;

  if(cr > 0.0 || fr > 0.0) {
    // radial gradient
    vec2 center = gv1.xy;
    vec2 focal = gv2.xy;
    float x = focal.x - gl_FragCoord.x;
    float y = focal.y - gl_FragCoord.y;
    float dx = focal.x - center.x;
    float dy = focal.y - center.y;
    float dr = cr - fr;
    float a = dx * dx + dy * dy - dr * dr;
    float b = -2.0 * (y * dy + x * dx + fr * dr);
    float c = x * x + y * y - fr * fr;
    t = 1.0 - 0.5 * (1.0 / a) * (-b + sqrt(b * b - 4.0 * a * c));
  } else {
    // linear gradient
    vec2 v1 = gl_FragCoord.xy - gv1.xy;
    vec2 v2 = gv2.xy - gv1.xy;
    t = (v1.x * v2.x + v1.y * v2.y) / (v2.x * v2.x + v2.y * v2.y);
  }

  vec4 colors[8];
  colors[0] = vec4(colorSteps[1], colorSteps[2], colorSteps[3], colorSteps[4]);
  colors[1] = vec4(colorSteps[6], colorSteps[7], colorSteps[8], colorSteps[9]);
  colors[2] = vec4(colorSteps[11], colorSteps[12], colorSteps[13], colorSteps[14]);
  colors[3] = vec4(colorSteps[16], colorSteps[17], colorSteps[18], colorSteps[19]);
  colors[4] = vec4(colorSteps[21], colorSteps[22], colorSteps[23], colorSteps[24]);
  colors[5] = vec4(colorSteps[26], colorSteps[27], colorSteps[28], colorSteps[29]);
  colors[6] = vec4(colorSteps[31], colorSteps[32], colorSteps[33], colorSteps[34]);
  colors[7] = vec4(colorSteps[36], colorSteps[37], colorSteps[38], colorSteps[39]);
  
  float steps[8];
  steps[0] = colorSteps[0];
  steps[1] = colorSteps[5];
  steps[2] = colorSteps[10];
  steps[3] = colorSteps[15];
  steps[4] = colorSteps[20];
  steps[5] = colorSteps[25];
  steps[6] = colorSteps[30];
  steps[7] = colorSteps[35];

  color = colors[0];
  for (int i = 1; i < 8; i++) {
    if (steps[i] < 0.0 || steps[i] > 1.0) {
      break;
    }
    if(steps[i] == steps[i - 1]) {
      color = colors[i];
    } else {
      color = mix(color, colors[i], clamp((t - steps[i - 1]) / (steps[i] - steps[i - 1]), 0.0, 1.0));
    }
    if (steps[i] >= t) {
      break;
    }
  }
}
#endif

void transformColor(inout vec4 color, in float colorMatrix[20]) {
  float r = color.r, g = color.g, b = color.b, a = color.a;
  color[0] = colorMatrix[0] * r + colorMatrix[1] * g + colorMatrix[2] * b + colorMatrix[3] * a + colorMatrix[4];
  color[1] = colorMatrix[5] * r + colorMatrix[6] * g + colorMatrix[7] * b + colorMatrix[8] * a + colorMatrix[9];
  color[2] = colorMatrix[10] * r + colorMatrix[11] * g + colorMatrix[12] * b + colorMatrix[13] * a + colorMatrix[14];
  color[3] = colorMatrix[15] * r + colorMatrix[16] * g + colorMatrix[17] * b + colorMatrix[18] * a + colorMatrix[19];
}

#ifdef CLOUDFILTER
void buildCloudColor(inout float colorCloudMatrix[20]) {
  colorCloudMatrix[0] = colorCloud0[0];
  colorCloudMatrix[1] = colorCloud1[0];
  colorCloudMatrix[2] = colorCloud2[0];
  colorCloudMatrix[3] = colorCloud3[0];
  colorCloudMatrix[4] = colorCloud4[0];

  colorCloudMatrix[5] = colorCloud0[1];
  colorCloudMatrix[6] = colorCloud1[1];
  colorCloudMatrix[7] = colorCloud2[1];
  colorCloudMatrix[8] = colorCloud3[1];
  colorCloudMatrix[9] = colorCloud4[1];

  colorCloudMatrix[10] = colorCloud0[2];
  colorCloudMatrix[11] = colorCloud1[2];
  colorCloudMatrix[12] = colorCloud2[2];
  colorCloudMatrix[13] = colorCloud3[2];
  colorCloudMatrix[14] = colorCloud4[2];

  colorCloudMatrix[15] = colorCloud0[3];
  colorCloudMatrix[16] = colorCloud1[3];
  colorCloudMatrix[17] = colorCloud2[3];
  colorCloudMatrix[18] = colorCloud3[3];
  colorCloudMatrix[19] = colorCloud4[3];
}
#endif

void main() {
  vec4 color = vColor;
  float opacity = abs(flagBackground);

#ifdef GRADIENT
  if(u_gradientType > 0 && flagBackground > 0.0 || u_gradientType == 0 && flagBackground <= 0.0) {
    gradient(color, vGradientVector1, vGradientVector2, u_colorSteps);
  }
#endif

  if(opacity < 1.0) {
    color.a *= opacity;
  }

#ifdef TEXTURE
  if(flagBackground > 0.0) {
    vec3 texCoord = vTextureCoord;

    if(texCoord.z == 1.0) {
      texCoord = fract(texCoord);
    }

    if(texCoord.x <= 1.0 && texCoord.x >= 0.0
      && texCoord.y <= 1.0 && texCoord.y >= 0.0) {
      if(vSourceRect.z > 0.0) {
        texCoord.x = vSourceRect.x + texCoord.x * vSourceRect.z;
        texCoord.y = 1.0 - (vSourceRect.y + (1.0 - texCoord.y) * vSourceRect.w);
      }
      if(frameIndex < 0.0) {
        vec4 texColor = texture2D(u_texSampler, texCoord.xy);
        color = mix(color, texColor, texColor.a);
      } else {
        int index = int(floor(clamp(0.0, 11.0, frameIndex)));
        vec4 texColor;
        if(index == 0) texColor = texture2D(u_texFrame0, texCoord.xy);
        else if(index == 1) texColor = texture2D(u_texFrame1, texCoord.xy);
        else if(index == 2) texColor = texture2D(u_texFrame2, texCoord.xy);
        else if(index == 3) texColor = texture2D(u_texFrame3, texCoord.xy);
        else if(index == 4) texColor = texture2D(u_texFrame4, texCoord.xy);
        else if(index == 5) texColor = texture2D(u_texFrame5, texCoord.xy);
        else if(index == 6) texColor = texture2D(u_texFrame6, texCoord.xy);
        else if(index == 7) texColor = texture2D(u_texFrame7, texCoord.xy);
        else if(index == 8) texColor = texture2D(u_texFrame8, texCoord.xy);
        else if(index == 9) texColor = texture2D(u_texFrame9, texCoord.xy);
        else if(index == 10) texColor = texture2D(u_texFrame10, texCoord.xy);
        else texColor = texture2D(u_texFrame11, texCoord.xy);
        float alpha = texColor.a;
        if(opacity < 1.0) {
          texColor.a *= opacity;
          alpha *= mix(0.465, 1.0, opacity);
        }
        // color = mix(color, texColor, texColor.a);
        color.rgb = mix(color.rgb, texColor.rgb, alpha);
        // color.rgb = mix(texColor.rgb, color.rgb, color.a);
        color.rgb = mix(texColor.rgb, color.rgb, clamp(color.a / max(0.0001, texColor.a), 0.0, 1.0));
        color.a = texColor.a + (1.0 - texColor.a) * color.a;
      }
    }
  }
#endif

#ifdef FILTER
  if(u_filterFlag > 0) {
    transformColor(color, u_colorMatrix);
  }
#endif

#ifdef CLOUDFILTER
  float colorCloudMatrix[20];
  buildCloudColor(colorCloudMatrix);
  transformColor(color, colorCloudMatrix);
#endif

#ifdef CLIPPATH
  float clip = texture2D(u_clipSampler, vClipUV).r;
  color *= clip;
#endif

  gl_FragColor = color;
}`},function(n,t,e){e.r(t),function(r,i){e.d(t,"requestAnimationFrame",function(){return s}),e.d(t,"cancelAnimationFrame",function(){return a}),e(1).glMatrix.setMatrixArrayType(Array);function o(){if(typeof performance<"u"&&performance.now)return performance.now();if(typeof r<"u"&&r.hrtime){const[l,u]=r.hrtime();return l*1e3+u*1e-6}return Date.now?Date.now():new Date().getTime()}let s,a;typeof i<"u"&&typeof i.requestAnimationFrame=="function"?(s=i.requestAnimationFrame,a=i.cancelAnimationFrame):(s=function(l){return setTimeout(()=>{l(o())},16)},a=function(l){return clearTimeout(l)})}.call(this,e(69),e(22))},function(n,t){var e=n.exports={},r,i;function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?r=setTimeout:r=o}catch{r=o}try{typeof clearTimeout=="function"?i=clearTimeout:i=s}catch{i=s}})();function a(T){if(r===setTimeout)return setTimeout(T,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(T,0);try{return r(T,0)}catch{try{return r.call(null,T,0)}catch{return r.call(this,T,0)}}}function l(T){if(i===clearTimeout)return clearTimeout(T);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(T);try{return i(T)}catch{try{return i.call(null,T)}catch{return i.call(this,T)}}}var u=[],p=!1,c,g=-1;function v(){!p||!c||(p=!1,c.length?u=c.concat(u):g=-1,u.length&&I())}function I(){if(!p){var T=a(v);p=!0;for(var h=u.length;h;){for(c=u,u=[];++g<h;)c&&c[g].run();g=-1,h=u.length}c=null,p=!1,l(T)}}e.nextTick=function(T){var h=new Array(arguments.length-1);if(arguments.length>1)for(var m=1;m<arguments.length;m++)h[m-1]=arguments[m];u.push(new w(T,h)),u.length===1&&!p&&a(I)};function w(T,h){this.fun=T,this.array=h}w.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={};function y(){}e.on=y,e.addListener=y,e.once=y,e.off=y,e.removeListener=y,e.removeAllListeners=y,e.emit=y,e.prependListener=y,e.prependOnceListener=y,e.listeners=function(T){return[]},e.binding=function(T){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(T){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},function(n,t,e){e.r(t),e.d(t,"default",function(){return P});var r=e(1),i=e(71),o=e(73),s=e(213),a=e(214),l=e(215),u=e(216);e(1).glMatrix.setMatrixArrayType(Array);function p(R,N){var b=Object.keys(R);if(Object.getOwnPropertySymbols){var j=Object.getOwnPropertySymbols(R);N&&(j=j.filter(function(O){return Object.getOwnPropertyDescriptor(R,O).enumerable})),b.push.apply(b,j)}return b}function c(R){for(var N=1;N<arguments.length;N++){var b=arguments[N]!=null?arguments[N]:{};N%2?p(Object(b),!0).forEach(function(j){g(R,j,b[j])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(b)):p(Object(b)).forEach(function(j){Object.defineProperty(R,j,Object.getOwnPropertyDescriptor(b,j))})}return R}function g(R,N,b){return N in R?Object.defineProperty(R,N,{value:b,enumerable:!0,configurable:!0,writable:!0}):R[N]=b,R}const v=Symbol.for("spritejs_changedAttrs"),I=Symbol.for("spritejs_attributes"),w=Symbol("resolution"),y=Symbol("animations"),T=Symbol("eventListeners"),h=Symbol("captureEventListeners"),m=Symbol("filters"),d=Symbol("display"),M=Symbol("program"),x=Symbol("shaderAttrs"),E=Symbol("uniforms");class P{constructor(N={}){this.attributes=new this.constructor.Attr(this),this[w]={width:300,height:150},Object.assign(this.attributes,N),this[y]=new Set,this[T]={},this[h]={}}get ancestors(){let N=this.parent;const b=[];for(;N;)b.push(N),N=N.parent;return b}get animations(){return this[y]}get filters(){return this[m]||this.parent&&this.parent.filters}get isVisible(){return!1}get layer(){return this.parent?this.parent.layer:null}get localMatrix(){const N=this.transformMatrix,{x:b,y:j}=this.attributes;return N[4]+=b,N[5]+=j,N}get opacity(){let N=this.attributes.opacity;return this.parent&&this.parent.opacity!=null&&(N*=this.parent.opacity),N}get parentNode(){return this.parent}get nextSibling(){return this.getNodeNearBy(1)}get previousSibling(){return this.getNodeNearBy(-1)}get program(){return this[M]}get renderer(){return this.parent?this.parent.renderer:null}get renderMatrix(){if(this.__cacheRenderMatrix)return this.__cacheRenderMatrix;let N=this.localMatrix;const b=this.parent;if(b){const j=b.__cacheRenderMatrix||b.renderMatrix;j&&(N=r.mat2d.multiply(Array.of(0,0,0,0,0,0),j,N))}return N}get worldScaling(){const N=this.renderMatrix;return[Math.hypot(N[0],N[1]),Math.hypot(N[2],N[3])]}get worldRotation(){const N=this.renderMatrix;return Math.atan2(N[1],N[3])}get worldPosition(){const N=this.renderMatrix;return[N[4],N[5]]}get uniforms(){return this[E]}get className(){return this.attributes.className}set className(N){this.attributes.className=N}get id(){return this.attributes.id}set id(N){this.attributes.id=N}get name(){return this.attributes.name}set name(N){this.attributes.name=N}get zIndex(){return this.attributes.zIndex}set zIndex(N){this.attributes.zIndex=N}get mesh(){return null}get shaderAttrs(){return this[x]||{}}activateAnimations(){const N=this.layer;if(N){const b=this[y];b.forEach(O=>{O.baseTimeline=N.timeline,O.play(),O.finished.then(()=>{b.delete(O)})});const j=this.children;j&&j.forEach(O=>{O.activateAnimations&&O.activateAnimations()})}}addEventListener(N,b,j={}){N==="mousewheel"&&(N="wheel"),typeof j=="boolean"&&(j={capture:j});const{capture:O,once:L}=j,k=O?h:T;return this[k][N]=this[k][N]||[],this[k][N].push({listener:b,once:L}),this}animate(N,b){const j=new o.default(this,N,b);return this.effects&&j.applyEffects(this.effects),this.layer&&(j.baseTimeline=this.layer.timeline,j.play(),j.finished.then(()=>{this[y].delete(j)})),this[y].add(j),j}attr(...N){if(N.length===0)return this.attributes[I];if(N.length>1){let[b,j]=N;return typeof j=="function"&&(j=j(this.attr(b))),this.setAttribute(b,j),this}return typeof N[0]=="string"?this.getAttribute(N[0]):(Object.assign(this.attributes,N[0]),this)}cloneNode(){const N=new this.constructor,b=this.attributes[v];return N.attr(b),N}connect(N,b){Object.defineProperty(this,"parent",{value:N,writable:!1,configurable:!0}),Object.defineProperty(this,"zOrder",{value:b,writable:!1,configurable:!0}),N.timeline&&this.activateAnimations(),this.setResolution(N.getResolution()),this.forceUpdate(),this.dispatchEvent({type:"append",detail:{parent:N,zOrder:b}})}contains(N){for(;N&&this!==N;)N=N.parent;return!!N}deactivateAnimations(){this[y].forEach(b=>b.cancel());const N=this.children;N&&N.forEach(b=>{b.deactivateAnimations&&b.deactivateAnimations()})}disconnect(){const{parent:N,zOrder:b}=this;delete this.parent,delete this.zOrder,this.deactivateAnimations(),this.dispatchEvent({type:"remove",detail:{parent:N,zOrder:b}}),N&&N.forceUpdate()}dispatchEvent(N){N instanceof a.default||(N=new a.default(N)),N.target=this;let b=N.type;b==="mousewheel"&&(b="wheel");const j=[this];let O=this.parent;for(;N.bubbles&&O;)j.push(O),O=O.parent;for(let L=j.length-1;L>=0;L--){const k=j[L],H=k[h]&&k[h][b];if(H&&H.length&&(N.currentTarget=k,H.forEach(({listener:Q,once:_})=>{Q.call(this,N),_&&j.removeEventListener(Q)}),delete N.currentTarget),!N.bubbles&&N.cancelBubble)break}if(!N.cancelBubble)for(let L=0;L<j.length;L++){const k=j[L],H=k[T]&&k[T][b];if(H&&H.length&&(N.currentTarget=k,H.forEach(({listener:Q,once:_})=>{Q.call(this,N),_&&j.removeEventListener(Q)}),delete N.currentTarget),!N.bubbles||N.cancelBubble)break}}dispatchPointerEvent(N){const{layerX:b,layerY:j}=N;return this.isPointCollision(b,j)?(this.dispatchEvent(N),!0):!1}draw(N=[]){const b=this.mesh;if(b){if(Object(l.applyFilters)(b,this.filters),N.push(b),this[M]){b.setProgram(this[M]);const j=this[x];j&&Object.entries(j).forEach(([L,k])=>{b.setAttribute(L,k)});const O=this[E];if(this[E]){const L={};Object.entries(O).forEach(([k,H])=>{typeof H=="function"&&(H=H(this,k)),L[k]=H}),b.setUniforms(L)}}Object(u.default)(this,b)}return N}forceUpdate(){this.parent&&this.parent.forceUpdate()}getAttribute(N){return this.attributes[N]}getListeners(N,{capture:b=!1}={}){return[...this[b?h:T][N]||[]]}getNodeNearBy(N=1){if(!this.parent)return null;if(N===0)return this;const b=this.parent.children,j=b.indexOf(this);return b[j+N]}getWorldPosition(N,b){const j=this.renderMatrix,O=N*j[0]+b*j[2]+j[4],L=N*j[1]+b*j[3]+j[5];return[O,L]}getOffsetPosition(N,b){const j=r.mat2d.invert(Array.of(0,0,0,0,0,0),this.renderMatrix),O=N*j[0]+b*j[2]+j[4],L=N*j[1]+b*j[3]+j[5];return[O,L]}getResolution(){return c({},this[w])}isPointCollision(N,b){if(!this.mesh)return!1;const j=this.attributes.pointerEvents;if(j==="none"||j!=="all"&&!this.isVisible)return!1;let O="both";return j==="visibleFill"&&(O="fill"),j==="visibleStroke"&&(O="stroke"),this.mesh.isPointCollision(N,b,O)}onPropertyChange(N,b,j){N!=="id"&&N!=="name"&&N!=="className"&&N!=="pointerEvents"&&N!=="passEvents"&&this.forceUpdate(),N==="filter"&&(this[m]=Object(l.parseFilterString)(b)),N==="zIndex"&&this.parent&&this.parent.reorder()}setAttribute(N,b){N==="attrs"&&this.attr(b),this.attributes[N]=b}setMouseCapture(){this.layer&&(this.layer.__mouseCapturedTarget=this)}setProgram(N){this[M]=N,this.forceUpdate()}setShaderAttribute(N,b){this[x]=this[x]||{},this[x][N]=b,this.forceUpdate()}setUniforms(N){this[E]=this[E]||{},Object.assign(this[E],N),this.forceUpdate()}setResolution({width:N,height:b}){const{width:j,height:O}=this[w];(j!==N||O!==b)&&(this[w]={width:N,height:b},this.forceUpdate(),this.dispatchEvent({type:"resolutionchange",detail:{width:N,height:b}}))}show(){this.attributes.display==="none"&&(this.attributes.display=this[d]||"")}hide(){this.attributes.display!=="none"&&(this[d]=this.attributes.display,this.attributes.display="none")}releaseMouseCapture(){this.layer&&this.layer.__mouseCapturedTarget===this&&(this.layer.__mouseCapturedTarget=null)}remove(){return this.parent&&this.parent.removeChild?(this.parent.removeChild(this),!0):!1}removeAllListeners(N,b={}){typeof b=="boolean"&&(b={capture:b});const O=b.capture?h:T;return this[O][N]&&(this[O][N]=[]),this}removeAttribute(N){this.setAttribute(N,null)}removeEventListener(N,b,j={}){typeof j=="boolean"&&(j={capture:j});const L=j.capture?h:T;if(this[L][N]){const k=this[L][N];if(k)for(let H=0;H<k.length;H++){const{listener:Q}=k[H];if(Q===b){this[L][N].splice(H,1);break}}}return this}transition(N,b="linear"){const j=this,O=Symbol("animation");b=b||"linear";let L=0;return typeof N=="object"&&(L=N.delay||0,N=N.duration),{[O]:null,cancel(k=!1){const H=this[O];H&&H.cancel(k)},end(){const k=this[O];k&&(k.playState==="running"||k.playState==="pending")&&k.finish()},reverse(){const k=this[O];if(k)if(k.playState==="running"||k.playState==="pending")k.playbackRate=-k.playbackRate;else{const H=k.timing.direction;k.timing.direction=H==="reverse"?"normal":"reverse",k.play()}return k.finished},attr(k,H){return this.end(),typeof k=="string"&&(k={[k]:H}),Object.entries(k).forEach(([Q,_])=>{typeof _=="function"&&(k[Q]=_(j.attr(Q)))}),this[O]=j.animate([k],{duration:N*1e3,delay:L*1e3,fill:"forwards",easing:b}),this[O].finished}}}updateContours(){}}g(P,"Attr",i.default),s.default.registerNode(P,"node")},function(n,t,e){e.r(t),e.d(t,"default",function(){return P});var r=e(1),i=e(12),o=e(72);e(1).glMatrix.setMatrixArrayType(Array);const s=Symbol.for("spritejs_setAttributeDefault"),a=Symbol.for("spritejs_declareAlias"),l=Symbol.for("spritejs_setAttribute"),u=Symbol.for("spritejs_getAttribute"),p=Symbol.for("spritejs_attributes"),c=Symbol.for("spritejs_changedAttrs"),g=Symbol("subject"),v=Symbol("attr"),I=Symbol("default"),w=Symbol("alias");function y(R,[N,b]){let j=r.mat2d.fromValues(1,0,0,1,0,0);return[...R].forEach(([O,L])=>{if((N||b)&&(j=r.mat2d.translate(Array.of(0,0,0,0,0,0),j,[N,b])),O==="matrix")j=r.mat2d.multiply(j,j,L);else if(O==="offsetTranslate")j[4]+=L[0],j[5]+=L[1];else if(O==="offsetRotate")j=r.mat2d.rotate(Array.of(0,0,0,0,0,0),j,L);else if(O==="skew"){const[k,H]=L;j=r.mat2d.multiply(j,j,r.mat2d.fromValues(1,Math.tan(H),Math.tan(k),1,0,0))}else r.mat2d[O](j,j,L);(N||b)&&(j=r.mat2d.translate(Array.of(0,0,0,0,0,0),j,[-N,-b]))}),j}const T=Symbol("transformMatrix"),h=Symbol("transforms"),m=Symbol("changedAttrs"),d=Symbol("lastChangedAttr"),M=Symbol("offsetFigure");function x(R,N,b){const j=R[v][N];if(R[l](N,b,!1)||R[d]!==N){const L=R[h];L.has(N)&&L.delete(N),b&&(N==="rotate"&&(b=Math.PI*b/180),N==="scale"&&(b=b.map(k=>Math.abs(k)>1e-5?k:1/k>0?1e-5:-1e-5)),L.set(N,b)),R[T]=null,R[g].onPropertyChange(N,b,j,R)}}function E(R){const N=R[M],b=R.offsetDistance*N.getTotalLength(),j=N.getPointAtLength(b);if(j){const O=R[h];let L=R.offsetRotate;L==="auto"?L=j.angle:L==="reverse"?L=Math.PI+j.angle:L=Math.PI*L/180,O.set("offsetRotate",L),O.set("offsetTranslate",[j.x,j.y]),R[T]=null}}class P{static setDefault(N,...b){return N[s](...b)}static declareAlias(N,...b){return N[a](...b)}static setAttribute(N,...b){return N[l](...b)}static getAttribute(N,...b){return N[u](...b)}static getAttributes(N){return N[p]}static getChangedAttributes(N){return N[c]}constructor(N){this[g]=N,this[v]={},this[T]=r.mat2d.fromValues(1,0,0,1,0,0),this[h]=new Map,this[I]={},this[w]=[],Object.defineProperty(N,"transformMatrix",{get:()=>(this[T]||(this[T]=y(this[h],this.transformOrigin)),[...this[T]])}),this[s]({id:"",name:"",className:"",x:0,y:0,transformOrigin:[0,0],transform:"",translate:[0,0],rotate:0,scale:[1,1],skew:[0,0],opacity:1,zIndex:0,offsetPath:void 0,offsetDistance:0,offsetRotate:"auto",pointerEvents:"visible",filter:"none",display:""}),this[a]("class","pos"),this[m]=new Set,this[M]=new i.Figure2D({scale:5,simplify:0})}get[c](){const N={};return[...this[m]].forEach(b=>{N[b]=this[v][b]}),N}get[p](){const N=Object.assign({},this[v]);for(let b=0;b<this[w].length;b++){const j=this[w][b];N[j]=this[j]}return N}[s](N){Object.assign(this[I],N),Object.assign(this[v],N)}[a](...N){this[w].push(...N)}[l](N,b,j=!0){const O=this[v][N],L=this[g];return b==null&&(b=this[I][N]),Object(o.compareValue)(O,b)?!1:(this[v][N]=b,this[m].has(N)&&this[m].delete(N),this[m].add(N),this[d]=N,j&&L.onPropertyChange(N,b,O,this),!0)}[u](N){return this[v][N]}set id(N){this[l]("id",N)}get id(){return this[u]("id")}set name(N){this[l]("name",N)}get name(){return this[u]("name")}set className(N){this[l]("className",N)}get className(){return this[u]("className")}set class(N){this.className=N}get class(){return this.className}get x(){return this[u]("x")}set x(N){this[l]("x",Object(o.toNumber)(N))}get y(){return this[u]("y")}set y(N){this[l]("y",Object(o.toNumber)(N))}get pos(){return[this.x,this.y]}set pos(N){N=Object(o.toArray)(N),Array.isArray(N)||(N=[N,N]),this.x=N[0],this.y=N[1]}get transform(){return this[u]("transform")}set transform(N){let b=null;if(Array.isArray(N)&&(b=N,N=`matrix(${N.map(o.toNumber).join()})`),typeof N=="string")N=N.replace(/\s*,\s*/g,",");else if(N!=null)throw new TypeError("Invalid transform value.");const j=this[v].transform;if(this[l]("transform",N,!1)){const O=this[h];if(O.has("matrix")&&O.delete("matrix"),b)O.set("matrix",b);else if(N){const L=N.match(/(matrix|translate|rotate|scale|skew)\([^()]+\)/g);if(L){let k=r.mat2d.fromValues(1,0,0,1,0,0);for(let H=0;H<L.length;H++){const _=L[H].match(/^(matrix|translate|rotate|scale|skew)\(([^()]+)\)/);if(_){let[,st,F]=_;st==="rotate"?F=Math.PI*parseFloat(F)/180:F=F.trim().split(/[\s,]+/).map(Z=>Object(o.toNumber)(Z)),st==="matrix"?k=r.mat2d.multiply(k,k,F):st==="skew"?k=r.mat2d.multiply(k,k,r.mat2d.fromValues(1,Math.tan(F[1]),Math.tan(F[0]),1,0,0)):r.mat2d[st](k,k,F),O.set("matrix",k)}}}else throw new TypeError("Invalid transform value.")}this[T]=null,this[g].onPropertyChange("transform",N,j,this)}}get transformOrigin(){return this[u]("transformOrigin")}set transformOrigin(N){N=Object(o.toArray)(N,!0),N!=null&&!Array.isArray(N)&&(N=[N,N]),this[l]("transformOrigin",N)&&(this[T]=null)}get rotate(){return this[u]("rotate")}set rotate(N){x(this,"rotate",N)}get translate(){return this[u]("translate")}set translate(N){N=Object(o.toArray)(N,!0),N!=null&&!Array.isArray(N)&&(N=[N,N]),x(this,"translate",N)}get scale(){return this[u]("scale")}set scale(N){N=Object(o.toArray)(N,!0),N!=null&&!Array.isArray(N)&&(N=[N,N]),x(this,"scale",N)}get skew(){return this[u]("skew")}set skew(N){N=Object(o.toArray)(N,!0),N!=null&&!Array.isArray(N)&&(N=[N,N]),x(this,"skew",N)}get opacity(){return this[u]("opacity")}set opacity(N){N!=null&&(N=Number(N)),this[l]("opacity",N)}get zIndex(){return this[u]("zIndex")}set zIndex(N){N!=null&&(N=Number(N)),this[l]("zIndex",N)}get offsetPath(){return this[u]("offsetPath")}set offsetPath(N){this[l]("offsetPath",N)&&(this[M].beginPath(),N!=null&&this[M].addPath(N),E(this))}get offsetDistance(){return this[u]("offsetDistance")}set offsetDistance(N){this[l]("offsetDistance",Object(o.toNumber)(N))&&E(this)}get offsetRotate(){return this[u]("offsetRotate")}set offsetRotate(N){this[l]("offsetRotate",N),E(this)}get pointerEvents(){return this[u]("pointerEvents")}set pointerEvents(N){if(N!=null&&N!=="none"&&N!=="visible"&&N!=="visibleFill"&&N!=="visibleStroke"&&N!=="all")throw new TypeError("Invalid pointerEvents type.");this[l]("pointerEvents",N)}get filter(){return this[u]("filter")}set filter(N){this[l]("filter",N)}get display(){return this[u]("display")}set display(N){this[l]("display",N)}set offset(N){}}},function(n,t,e){e.r(t),e.d(t,"sizeToPixel",function(){return r}),e.d(t,"toString",function(){return i}),e.d(t,"toNumber",function(){return o}),e.d(t,"toArray",function(){return s}),e.d(t,"compareValue",function(){return a}),e(1).glMatrix.setMatrixArrayType(Array);function r(l,u){const p=l.trim().match(/^([\d.]+)(px|pt|pc|in|cm|mm|em|ex|rem|q|vw|vh|vmax|vmin)$/);p?l={size:parseFloat(p[1]),unit:p[2]}:l={size:parseFloat(l),unit:"px"};let{size:c,unit:g}=l;if(g==="pt")c/=.75;else if(g==="pc")c*=16;else if(g==="in")c*=96;else if(g==="cm")c*=96/2.54;else if(g==="mm")c*=96/25.4;else if(g==="em"||g==="rem"||g==="ex"){if(!u&&typeof getComputedStyle=="function"&&typeof document<"u"){const v=getComputedStyle(document.documentElement).fontSize;v?u=r(v,16):u=16}c*=u,g==="ex"&&(c/=2)}else if(g==="q")c*=96/25.4/4;else if(g==="vw"||g==="vh"){if(typeof document<"u"){const v=g==="vw"?window.innerWidth||document.documentElement.clientWidth:window.innerHeight||document.documentElement.clientHeight;c*=v/100}}else if((g==="vmax"||g==="vmin")&&typeof document<"u"){const v=window.innerWidth||document.documentElement.clientWidth,I=window.innerHeight||document.documentElement.clientHeight;g==="vmax"?c*=Math.max(v,I)/100:c*=Math.min(v,I)/100}return c}function i(l){return l==null?l:String(l)}function o(l){if(l==null)return l;if(typeof l=="string"&&(l=r(l)),!Number.isFinite(l))throw new TypeError("Invalid value");return l}function s(l,u=!1){return l===""?null:(typeof l=="string"&&(l=l.split(/[\s,]+/g)),Array.isArray(l)&&(u&&(l=l.map(o)),l.length===1)?l[0]:l)}function a(l,u){if(Array.isArray(l)&&Array.isArray(u)){if(l.length!==u.length)return!1;for(let p=0;p<l.length;p++)if(l[p]!==u[p])return!1;return!0}return l==null&&u==null||l===u}},function(n,t,e){e.r(t),e.d(t,"default",function(){return g});var r=e(74),i=e(32),o=e.n(i),s=e(68),a=e(72);e(1).glMatrix.setMatrixArrayType(Array);function l(){return l=Object.assign||function(v){for(var I=1;I<arguments.length;I++){var w=arguments[I];for(var y in w)Object.prototype.hasOwnProperty.call(w,y)&&(v[y]=w[y])}return v},l.apply(this,arguments)}function u(v){if(typeof v=="string"){if(v=v.trim(),/^[0-9.]+%$/.test(v))return parseFloat(v)/100;if(/^([\d.]+)(px|pt|pc|in|cm|mm|em|ex|rem|q|vw|vh|vmax|vmin)$/.test(v))return Object(a.sizeToPixel)(v)}return v}function p(v,I,w,y,T){return typeof v=="string"&&(v=o()(v)),typeof I=="string"&&(I=o()(I)),r.Effects.default(v,I,w,y,T)}function c(v,I,w,y,T){return r.Effects.default(v,I,w,y,T)}r.Effects.default=function(v,I,w,y,T){return Array.isArray(v)&&Array.isArray(I)?v.map((h,m)=>h+(w-y)/(T-y)*(I[m]-h)):typeof v=="number"&&typeof I=="number"?v+(w-y)/(T-y)*(I-v):w-y>T-w?I:v},r.Effects.fillColor=p,r.Effects.strokeColor=p,r.Effects.bgcolor=p,r.Effects.borderColor=p,r.Effects.text=c;class g extends r.Animator{constructor(I,w,y){const T=I.attr();Object.entries(T).forEach(([h,m])=>{T[h]=r.Effects[h]?m:u(m)}),w=w.map(h=>{let m=l({},h);const d={};return Object.entries(m).forEach(([M,x])=>{d[M]=r.Effects[M]?x:u(x)}),d}),super(T,w,y),this.target=I,this.setter=function(h,m){m.attr(h)}}get playState(){return this.target.parent?super.playState:"idle"}get finished(){return super.finished.then(()=>{const I=this;return new Promise(w=>{function y(){I.setter(I.frame,I.target);const T=I.playState;T==="finished"||T==="idle"?(Object(s.cancelAnimationFrame)(I.requestId),w()):Object(s.requestAnimationFrame)(y)}y()})})}finish(){super.finish(),Object(s.cancelAnimationFrame)(this.requestId),this.setter(this.frame,this.target)}play(){if(!this.target.parent||this.playState==="running")return;super.play(),this.setter(this.frame,this.target);const I=this;this.ready.then(()=>{I.setter(I.frame,I.target),I.requestId=Object(s.requestAnimationFrame)(function w(){const y=I.target;if(typeof document<"u"&&document.documentElement&&document.documentElement.contains&&y.layer&&y.layer.canvas&&!document.documentElement.contains(y.layer.canvas)){I.cancel();return}const T=I.playState;I.setter(I.frame,I.target),T!=="idle"&&(T==="running"?I.requestId=Object(s.requestAnimationFrame)(w):(T==="paused"||T==="pending"&&I.timeline.currentTime<0)&&I.ready.then(()=>{I.setter(I.frame,I.target),I.requestId=Object(s.requestAnimationFrame)(w)}))})})}cancel(I=!1){Object(s.cancelAnimationFrame)(this.requestId),I?(this.setter(this.frame,this.target),super.cancel()):(super.cancel(),this.setter(this.frame,this.target))}}},function(n,t,e){Object.defineProperty(t,"__esModule",{value:!0}),t.Timeline=t.Effects=t.Easings=t.Animator=void 0;var r=e(75),i=p(r),o=e(187),s=p(o),a=e(188),l=e(190),u=p(l);function p(c){return c&&c.__esModule?c:{default:c}}t.Animator=u.default,t.Easings=a.Easings,t.Effects=s.default,t.Timeline=i.default},function(n,t,e){Object.defineProperty(t,"__esModule",{value:!0});var r=e(76),i=h(r),o=e(133),s=h(o),a=e(141),l=h(a),u=e(164),p=h(u),c=e(170),g=h(c),v=e(171),I=h(v),w=e(175),y=h(w),T=e(186);function h(j){return j&&j.__esModule?j:{default:j}}var m=(0,T.createNowTime)(),d={originTime:0,playbackRate:1},M=(0,y.default)("timeMark"),x=(0,y.default)("playbackRate"),E=(0,y.default)("timers"),P=(0,y.default)("originTime"),R=(0,y.default)("setTimer"),N=(0,y.default)("parent"),b=function(){function j(O,L){(0,g.default)(this,j),O instanceof j&&(L=O,O={}),O=(0,p.default)({},d,O),L&&(this[N]=L);var k=O.nowtime||m;if(L)Object.defineProperty(this,"globalTime",{get:function(){return L.currentTime}});else{var H=k();Object.defineProperty(this,"globalTime",{get:function(){return k()-H}})}this[M]=[{globalTime:this.globalTime,localTime:-O.originTime,entropy:-O.originTime,playbackRate:O.playbackRate,globalEntropy:0}],this[N]&&(this[M][0].globalEntropy=this[N].entropy),this[P]=O.originTime,this[x]=O.playbackRate,this[E]=new l.default}return(0,I.default)(j,[{key:"markTime",value:function(){var L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},k=L.time,H=k===void 0?this.currentTime:k,Q=L.entropy,_=Q===void 0?this.entropy:Q,st=L.playbackRate,F=st===void 0?this.playbackRate:st,Z={globalTime:this.globalTime,localTime:H,entropy:_,playbackRate:F,globalEntropy:this.globalEntropy};this[M].push(Z)}},{key:"fork",value:function(L){return new j(L,this)}},{key:"seekGlobalTime",value:function(L){var k=this.seekTimeMark(L),H=this[M][k],Q=H.entropy,_=H.playbackRate,st=H.globalTime;return st+(L-Q)/Math.abs(_)}},{key:"seekLocalTime",value:function(L){var k=this.seekTimeMark(L),H=this[M][k],Q=H.localTime,_=H.entropy,st=H.playbackRate;return st>0?Q+(L-_):Q-(L-_)}},{key:"seekTimeMark",value:function(L){var k=this[M],H=0,Q=k.length-1;if(L<=k[H].entropy)return H;if(L>=k[Q].entropy)return Q;for(var _=Math.floor((H+Q)/2);_>H&&_<Q;){if(L===k[_].entropy)return _;L<k[_].entropy?Q=_:L>k[_].entropy&&(H=_),_=Math.floor((H+Q)/2)}return H}},{key:"updateTimers",value:function(){var L=this,k=[].concat((0,s.default)(this[E]));k.forEach(function(H){var Q=(0,i.default)(H,2),_=Q[0],st=Q[1];L[R](st.handler,st.time,_)})}},{key:"clearTimeout",value:function(O){function L(k){return O.apply(this,arguments)}return L.toString=function(){return O.toString()},L}(function(O){var L=this[E].get(O);L&&L.timerID!=null&&(this[N]?this[N].clearTimeout(L.timerID):clearTimeout(L.timerID)),this[E].delete(O)})},{key:"clearInterval",value:function(L){return this.clearTimeout(L)}},{key:"clear",value:function(){var L=this,k=this[E];[].concat((0,s.default)(k.keys())).forEach(function(H){L.clearTimeout(H)})}},{key:"setTimeout",value:function(L){var k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{delay:0};return this[R](L,k)}},{key:"setInterval",value:function(L){var k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{delay:0},H=this,Q=this[R](function _(){H[R](_,k,Q),L()},k);return Q}},{key:R,value:function(L,k){var H=this,Q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(0,y.default)("timerID");k=(0,T.formatDelay)(k);var _=this[E].get(Q),st=void 0,F=null,Z=void 0,tt=void 0;_?(this.clearTimeout(Q),k.isEntropy?st=(k.delay-(this.entropy-_.startEntropy))/Math.abs(this.playbackRate):st=(k.delay-(this.currentTime-_.startTime))/this.playbackRate,Z=_.startTime,tt=_.startEntropy):(st=k.delay/(k.isEntropy?Math.abs(this.playbackRate):this.playbackRate),Z=this.currentTime,tt=this.entropy);var ct=this[N],at=ct?ct.setTimeout.bind(ct):setTimeout,dt=k.heading;return!ct&&dt===!1&&st<0&&(st=1/0),(isFinite(st)||ct)&&(st=Math.ceil(st),at!==setTimeout&&(st={delay:st,heading:dt}),F=at(function(){H[E].delete(Q),L()},st)),this[E].set(Q,{timerID:F,handler:L,time:k,startTime:Z,startEntropy:tt}),Q}},{key:"parent",get:function(){return this[N]}},{key:"lastTimeMark",get:function(){return this[M][this[M].length-1]}},{key:"currentTime",get:function(){var L=this.lastTimeMark,k=L.localTime,H=L.globalTime;return k+(this.globalTime-H)*this.playbackRate},set:function(L){var k=this,H=this.currentTime,Q=L,_=this[E];this.markTime({time:L}),[].concat((0,s.default)(_)).forEach(function(st){var F=(0,i.default)(st,2),Z=F[0],tt=F[1];if(_.has(Z)){var ct=tt.time,at=ct.isEntropy,dt=ct.delay,it=ct.heading,ft=tt.handler,wt=tt.startTime;if(at)dt===0&&(ft(),k.clearTimeout(Z));else{var U=wt+dt;(dt===0||it!==!1&&(Q-H)*dt<=0||H<=U&&U<=Q||H>=U&&U>=Q)&&(ft(),k.clearTimeout(Z))}}}),this.updateTimers()}},{key:"entropy",get:function(){var L=this.lastTimeMark,k=L.entropy,H=L.globalEntropy;return k+Math.abs((this.globalEntropy-H)*this.playbackRate)},set:function(L){if(this.entropy>L){var k=this.seekTimeMark(L);this[M].length=k+1}this.markTime({entropy:L}),this.updateTimers()}},{key:"globalEntropy",get:function(){return this[N]?this[N].entropy:this.globalTime}},{key:"playbackRate",get:function(){return this[x]},set:function(L){L!==this.playbackRate&&(this.markTime({playbackRate:L}),this[x]=L,this.updateTimers())}},{key:"paused",get:function(){if(this.playbackRate===0)return!0;for(var L=this.parent;L;){if(L.playbackRate===0)return!0;L=L.parent}return!1}}]),j}();t.default=b},function(n,t,e){t.__esModule=!0;var r=e(77),i=a(r),o=e(129),s=a(o);function a(l){return l&&l.__esModule?l:{default:l}}t.default=function(){function l(u,p){var c=[],g=!0,v=!1,I=void 0;try{for(var w=(0,s.default)(u),y;!(g=(y=w.next()).done)&&(c.push(y.value),!(p&&c.length===p));g=!0);}catch(T){v=!0,I=T}finally{try{!g&&w.return&&w.return()}finally{if(v)throw I}}return c}return function(u,p){if(Array.isArray(u))return u;if((0,i.default)(Object(u)))return l(u,p);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},function(n,t,e){n.exports={default:e(78),__esModule:!0}},function(n,t,e){e(79),e(125),n.exports=e(127)},function(n,t,e){e(80);for(var r=e(91),i=e(95),o=e(83),s=e(122)("toStringTag"),a="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),l=0;l<a.length;l++){var u=a[l],p=r[u],c=p&&p.prototype;c&&!c[s]&&i(c,s,u),o[u]=o.Array}},function(n,t,e){var r=e(81),i=e(82),o=e(83),s=e(84);n.exports=e(88)(Array,"Array",function(a,l){this._t=s(a),this._i=0,this._k=l},function(){var a=this._t,l=this._k,u=this._i++;return!a||u>=a.length?(this._t=void 0,i(1)):l=="keys"?i(0,u):l=="values"?i(0,a[u]):i(0,[u,a[u]])},"values"),o.Arguments=o.Array,r("keys"),r("values"),r("entries")},function(n,t){n.exports=function(){}},function(n,t){n.exports=function(e,r){return{value:r,done:!!e}}},function(n,t){n.exports={}},function(n,t,e){var r=e(85),i=e(87);n.exports=function(o){return r(i(o))}},function(n,t,e){var r=e(86);n.exports=Object("z").propertyIsEnumerable(0)?Object:function(i){return r(i)=="String"?i.split(""):Object(i)}},function(n,t){var e={}.toString;n.exports=function(r){return e.call(r).slice(8,-1)}},function(n,t){n.exports=function(e){if(e==null)throw TypeError("Can't call method on  "+e);return e}},function(n,t,e){var r=e(89),i=e(90),o=e(106),s=e(95),a=e(83),l=e(107),u=e(121),p=e(123),c=e(122)("iterator"),g=!([].keys&&"next"in[].keys()),v="@@iterator",I="keys",w="values",y=function(){return this};n.exports=function(T,h,m,d,M,x,E){l(m,h,d);var P=function(F){if(!g&&F in j)return j[F];switch(F){case I:return function(){return new m(this,F)};case w:return function(){return new m(this,F)}}return function(){return new m(this,F)}},R=h+" Iterator",N=M==w,b=!1,j=T.prototype,O=j[c]||j[v]||M&&j[M],L=O||P(M),k=M?N?P("entries"):L:void 0,H=h=="Array"&&j.entries||O,Q,_,st;if(H&&(st=p(H.call(new T)),st!==Object.prototype&&st.next&&(u(st,R,!0),!r&&typeof st[c]!="function"&&s(st,c,y))),N&&O&&O.name!==w&&(b=!0,L=function(){return O.call(this)}),(!r||E)&&(g||b||!j[c])&&s(j,c,L),a[h]=L,a[R]=y,M)if(Q={values:N?L:P(w),keys:x?L:P(I),entries:k},E)for(_ in Q)_ in j||o(j,_,Q[_]);else i(i.P+i.F*(g||b),h,Q);return Q}},function(n,t){n.exports=!0},function(n,t,e){var r=e(91),i=e(92),o=e(93),s=e(95),a=e(105),l="prototype",u=function(p,c,g){var v=p&u.F,I=p&u.G,w=p&u.S,y=p&u.P,T=p&u.B,h=p&u.W,m=I?i:i[c]||(i[c]={}),d=m[l],M=I?r:w?r[c]:(r[c]||{})[l],x,E,P;I&&(g=c);for(x in g)E=!v&&M&&M[x]!==void 0,!(E&&a(m,x))&&(P=E?M[x]:g[x],m[x]=I&&typeof M[x]!="function"?g[x]:T&&E?o(P,r):h&&M[x]==P?function(R){var N=function(b,j,O){if(this instanceof R){switch(arguments.length){case 0:return new R;case 1:return new R(b);case 2:return new R(b,j)}return new R(b,j,O)}return R.apply(this,arguments)};return N[l]=R[l],N}(P):y&&typeof P=="function"?o(Function.call,P):P,y&&((m.virtual||(m.virtual={}))[x]=P,p&u.R&&d&&!d[x]&&s(d,x,P)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,n.exports=u},function(n,t){var e=n.exports=typeof window<"u"&&window.Math==Math?window:typeof self<"u"&&self.Math==Math?self:Function("return this")();typeof __g=="number"&&(__g=e)},function(n,t){var e=n.exports={version:"2.6.11"};typeof __e=="number"&&(__e=e)},function(n,t,e){var r=e(94);n.exports=function(i,o,s){if(r(i),o===void 0)return i;switch(s){case 1:return function(a){return i.call(o,a)};case 2:return function(a,l){return i.call(o,a,l)};case 3:return function(a,l,u){return i.call(o,a,l,u)}}return function(){return i.apply(o,arguments)}}},function(n,t){n.exports=function(e){if(typeof e!="function")throw TypeError(e+" is not a function!");return e}},function(n,t,e){var r=e(96),i=e(104);n.exports=e(100)?function(o,s,a){return r.f(o,s,i(1,a))}:function(o,s,a){return o[s]=a,o}},function(n,t,e){var r=e(97),i=e(99),o=e(103),s=Object.defineProperty;t.f=e(100)?Object.defineProperty:function(l,u,p){if(r(l),u=o(u,!0),r(p),i)try{return s(l,u,p)}catch{}if("get"in p||"set"in p)throw TypeError("Accessors not supported!");return"value"in p&&(l[u]=p.value),l}},function(n,t,e){var r=e(98);n.exports=function(i){if(!r(i))throw TypeError(i+" is not an object!");return i}},function(n,t){n.exports=function(e){return typeof e=="object"?e!==null:typeof e=="function"}},function(n,t,e){n.exports=!e(100)&&!e(101)(function(){return Object.defineProperty(e(102)("div"),"a",{get:function(){return 7}}).a!=7})},function(n,t,e){n.exports=!e(101)(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7})},function(n,t){n.exports=function(e){try{return!!e()}catch{return!0}}},function(n,t,e){var r=e(98),i=e(91).document,o=r(i)&&r(i.createElement);n.exports=function(s){return o?i.createElement(s):{}}},function(n,t,e){var r=e(98);n.exports=function(i,o){if(!r(i))return i;var s,a;if(o&&typeof(s=i.toString)=="function"&&!r(a=s.call(i))||typeof(s=i.valueOf)=="function"&&!r(a=s.call(i))||!o&&typeof(s=i.toString)=="function"&&!r(a=s.call(i)))return a;throw TypeError("Can't convert object to primitive value")}},function(n,t){n.exports=function(e,r){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:r}}},function(n,t){var e={}.hasOwnProperty;n.exports=function(r,i){return e.call(r,i)}},function(n,t,e){n.exports=e(95)},function(n,t,e){var r=e(108),i=e(104),o=e(121),s={};e(95)(s,e(122)("iterator"),function(){return this}),n.exports=function(a,l,u){a.prototype=r(s,{next:i(1,u)}),o(a,l+" Iterator")}},function(n,t,e){var r=e(97),i=e(109),o=e(119),s=e(116)("IE_PROTO"),a=function(){},l="prototype",u=function(){var p=e(102)("iframe"),c=o.length,g="<",v=">",I;for(p.style.display="none",e(120).appendChild(p),p.src="javascript:",I=p.contentWindow.document,I.open(),I.write(g+"script"+v+"document.F=Object"+g+"/script"+v),I.close(),u=I.F;c--;)delete u[l][o[c]];return u()};n.exports=Object.create||function(c,g){var v;return c!==null?(a[l]=r(c),v=new a,a[l]=null,v[s]=c):v=u(),g===void 0?v:i(v,g)}},function(n,t,e){var r=e(96),i=e(97),o=e(110);n.exports=e(100)?Object.defineProperties:function(a,l){i(a);for(var u=o(l),p=u.length,c=0,g;p>c;)r.f(a,g=u[c++],l[g]);return a}},function(n,t,e){var r=e(111),i=e(119);n.exports=Object.keys||function(s){return r(s,i)}},function(n,t,e){var r=e(105),i=e(84),o=e(112)(!1),s=e(116)("IE_PROTO");n.exports=function(a,l){var u=i(a),p=0,c=[],g;for(g in u)g!=s&&r(u,g)&&c.push(g);for(;l.length>p;)r(u,g=l[p++])&&(~o(c,g)||c.push(g));return c}},function(n,t,e){var r=e(84),i=e(113),o=e(115);n.exports=function(s){return function(a,l,u){var p=r(a),c=i(p.length),g=o(u,c),v;if(s&&l!=l){for(;c>g;)if(v=p[g++],v!=v)return!0}else for(;c>g;g++)if((s||g in p)&&p[g]===l)return s||g||0;return!s&&-1}}},function(n,t,e){var r=e(114),i=Math.min;n.exports=function(o){return o>0?i(r(o),9007199254740991):0}},function(n,t){var e=Math.ceil,r=Math.floor;n.exports=function(i){return isNaN(i=+i)?0:(i>0?r:e)(i)}},function(n,t,e){var r=e(114),i=Math.max,o=Math.min;n.exports=function(s,a){return s=r(s),s<0?i(s+a,0):o(s,a)}},function(n,t,e){var r=e(117)("keys"),i=e(118);n.exports=function(o){return r[o]||(r[o]=i(o))}},function(n,t,e){var r=e(92),i=e(91),o="__core-js_shared__",s=i[o]||(i[o]={});(n.exports=function(a,l){return s[a]||(s[a]=l!==void 0?l:{})})("versions",[]).push({version:r.version,mode:e(89)?"pure":"global",copyright:" 2019 Denis Pushkarev (zloirock.ru)"})},function(n,t){var e=0,r=Math.random();n.exports=function(i){return"Symbol(".concat(i===void 0?"":i,")_",(++e+r).toString(36))}},function(n,t){n.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(n,t,e){var r=e(91).document;n.exports=r&&r.documentElement},function(n,t,e){var r=e(96).f,i=e(105),o=e(122)("toStringTag");n.exports=function(s,a,l){s&&!i(s=l?s:s.prototype,o)&&r(s,o,{configurable:!0,value:a})}},function(n,t,e){var r=e(117)("wks"),i=e(118),o=e(91).Symbol,s=typeof o=="function",a=n.exports=function(l){return r[l]||(r[l]=s&&o[l]||(s?o:i)("Symbol."+l))};a.store=r},function(n,t,e){var r=e(105),i=e(124),o=e(116)("IE_PROTO"),s=Object.prototype;n.exports=Object.getPrototypeOf||function(a){return a=i(a),r(a,o)?a[o]:typeof a.constructor=="function"&&a instanceof a.constructor?a.constructor.prototype:a instanceof Object?s:null}},function(n,t,e){var r=e(87);n.exports=function(i){return Object(r(i))}},function(n,t,e){var r=e(126)(!0);e(88)(String,"String",function(i){this._t=String(i),this._i=0},function(){var i=this._t,o=this._i,s;return o>=i.length?{value:void 0,done:!0}:(s=r(i,o),this._i+=s.length,{value:s,done:!1})})},function(n,t,e){var r=e(114),i=e(87);n.exports=function(o){return function(s,a){var l=String(i(s)),u=r(a),p=l.length,c,g;return u<0||u>=p?o?"":void 0:(c=l.charCodeAt(u),c<55296||c>56319||u+1===p||(g=l.charCodeAt(u+1))<56320||g>57343?o?l.charAt(u):c:o?l.slice(u,u+2):(c-55296<<10)+(g-56320)+65536)}}},function(n,t,e){var r=e(128),i=e(122)("iterator"),o=e(83);n.exports=e(92).isIterable=function(s){var a=Object(s);return a[i]!==void 0||"@@iterator"in a||o.hasOwnProperty(r(a))}},function(n,t,e){var r=e(86),i=e(122)("toStringTag"),o=r(function(){return arguments}())=="Arguments",s=function(a,l){try{return a[l]}catch{}};n.exports=function(a){var l,u,p;return a===void 0?"Undefined":a===null?"Null":typeof(u=s(l=Object(a),i))=="string"?u:o?r(l):(p=r(l))=="Object"&&typeof l.callee=="function"?"Arguments":p}},function(n,t,e){n.exports={default:e(130),__esModule:!0}},function(n,t,e){e(79),e(125),n.exports=e(131)},function(n,t,e){var r=e(97),i=e(132);n.exports=e(92).getIterator=function(o){var s=i(o);if(typeof s!="function")throw TypeError(o+" is not iterable!");return r(s.call(o))}},function(n,t,e){var r=e(128),i=e(122)("iterator"),o=e(83);n.exports=e(92).getIteratorMethod=function(s){if(s!=null)return s[i]||s["@@iterator"]||o[r(s)]}},function(n,t,e){t.__esModule=!0;var r=e(134),i=o(r);function o(s){return s&&s.__esModule?s:{default:s}}t.default=function(s){if(Array.isArray(s)){for(var a=0,l=Array(s.length);a<s.length;a++)l[a]=s[a];return l}else return(0,i.default)(s)}},function(n,t,e){n.exports={default:e(135),__esModule:!0}},function(n,t,e){e(125),e(136),n.exports=e(92).Array.from},function(n,t,e){var r=e(93),i=e(90),o=e(124),s=e(137),a=e(138),l=e(113),u=e(139),p=e(132);i(i.S+i.F*!e(140)(function(c){Array.from(c)}),"Array",{from:function(g){var v=o(g),I=typeof this=="function"?this:Array,w=arguments.length,y=w>1?arguments[1]:void 0,T=y!==void 0,h=0,m=p(v),d,M,x,E;if(T&&(y=r(y,w>2?arguments[2]:void 0,2)),m!=null&&!(I==Array&&a(m)))for(E=m.call(v),M=new I;!(x=E.next()).done;h++)u(M,h,T?s(E,y,[x.value,h],!0):x.value);else for(d=l(v.length),M=new I(d);d>h;h++)u(M,h,T?y(v[h],h):v[h]);return M.length=h,M}})},function(n,t,e){var r=e(97);n.exports=function(i,o,s,a){try{return a?o(r(s)[0],s[1]):o(s)}catch(u){var l=i.return;throw l!==void 0&&r(l.call(i)),u}}},function(n,t,e){var r=e(83),i=e(122)("iterator"),o=Array.prototype;n.exports=function(s){return s!==void 0&&(r.Array===s||o[i]===s)}},function(n,t,e){var r=e(96),i=e(104);n.exports=function(o,s,a){s in o?r.f(o,s,i(0,a)):o[s]=a}},function(n,t,e){var r=e(122)("iterator"),i=!1;try{var o=[7][r]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch{}n.exports=function(s,a){if(!a&&!i)return!1;var l=!1;try{var u=[7],p=u[r]();p.next=function(){return{done:l=!0}},u[r]=function(){return p},s(u)}catch{}return l}},function(n,t,e){n.exports={default:e(142),__esModule:!0}},function(n,t,e){e(143),e(125),e(79),e(144),e(157),e(160),e(162),n.exports=e(92).Map},function(n,t){},function(n,t,e){var r=e(145),i=e(151),o="Map";n.exports=e(152)(o,function(s){return function(){return s(this,arguments.length>0?arguments[0]:void 0)}},{get:function(a){var l=r.getEntry(i(this,o),a);return l&&l.v},set:function(a,l){return r.def(i(this,o),a===0?0:a,l)}},r,!0)},function(n,t,e){var r=e(96).f,i=e(108),o=e(146),s=e(93),a=e(147),l=e(148),u=e(88),p=e(82),c=e(149),g=e(100),v=e(150).fastKey,I=e(151),w=g?"_s":"size",y=function(T,h){var m=v(h),d;if(m!=="F")return T._i[m];for(d=T._f;d;d=d.n)if(d.k==h)return d};n.exports={getConstructor:function(T,h,m,d){var M=T(function(x,E){a(x,M,h,"_i"),x._t=h,x._i=i(null),x._f=void 0,x._l=void 0,x[w]=0,E!=null&&l(E,m,x[d],x)});return o(M.prototype,{clear:function(){for(var E=I(this,h),P=E._i,R=E._f;R;R=R.n)R.r=!0,R.p&&(R.p=R.p.n=void 0),delete P[R.i];E._f=E._l=void 0,E[w]=0},delete:function(x){var E=I(this,h),P=y(E,x);if(P){var R=P.n,N=P.p;delete E._i[P.i],P.r=!0,N&&(N.n=R),R&&(R.p=N),E._f==P&&(E._f=R),E._l==P&&(E._l=N),E[w]--}return!!P},forEach:function(E){I(this,h);for(var P=s(E,arguments.length>1?arguments[1]:void 0,3),R;R=R?R.n:this._f;)for(P(R.v,R.k,this);R&&R.r;)R=R.p},has:function(E){return!!y(I(this,h),E)}}),g&&r(M.prototype,"size",{get:function(){return I(this,h)[w]}}),M},def:function(T,h,m){var d=y(T,h),M,x;return d?d.v=m:(T._l=d={i:x=v(h,!0),k:h,v:m,p:M=T._l,n:void 0,r:!1},T._f||(T._f=d),M&&(M.n=d),T[w]++,x!=="F"&&(T._i[x]=d)),T},getEntry:y,setStrong:function(T,h,m){u(T,h,function(d,M){this._t=I(d,h),this._k=M,this._l=void 0},function(){for(var d=this,M=d._k,x=d._l;x&&x.r;)x=x.p;return!d._t||!(d._l=x=x?x.n:d._t._f)?(d._t=void 0,p(1)):M=="keys"?p(0,x.k):M=="values"?p(0,x.v):p(0,[x.k,x.v])},m?"entries":"values",!m,!0),c(h)}}},function(n,t,e){var r=e(95);n.exports=function(i,o,s){for(var a in o)s&&i[a]?i[a]=o[a]:r(i,a,o[a]);return i}},function(n,t){n.exports=function(e,r,i,o){if(!(e instanceof r)||o!==void 0&&o in e)throw TypeError(i+": incorrect invocation!");return e}},function(n,c,e){var r=e(93),i=e(137),o=e(138),s=e(97),a=e(113),l=e(132),u={},p={},c=n.exports=function(g,v,I,w,y){var T=y?function(){return g}:l(g),h=r(I,w,v?2:1),m=0,d,M,x,E;if(typeof T!="function")throw TypeError(g+" is not iterable!");if(o(T)){for(d=a(g.length);d>m;m++)if(E=v?h(s(M=g[m])[0],M[1]):h(g[m]),E===u||E===p)return E}else for(x=T.call(g);!(M=x.next()).done;)if(E=i(x,h,M.value,v),E===u||E===p)return E};c.BREAK=u,c.RETURN=p},function(n,t,e){var r=e(91),i=e(92),o=e(96),s=e(100),a=e(122)("species");n.exports=function(l){var u=typeof i[l]=="function"?i[l]:r[l];s&&u&&!u[a]&&o.f(u,a,{configurable:!0,get:function(){return this}})}},function(n,t,e){var r=e(118)("meta"),i=e(98),o=e(105),s=e(96).f,a=0,l=Object.isExtensible||function(){return!0},u=!e(101)(function(){return l(Object.preventExtensions({}))}),p=function(w){s(w,r,{value:{i:"O"+ ++a,w:{}}})},c=function(w,y){if(!i(w))return typeof w=="symbol"?w:(typeof w=="string"?"S":"P")+w;if(!o(w,r)){if(!l(w))return"F";if(!y)return"E";p(w)}return w[r].i},g=function(w,y){if(!o(w,r)){if(!l(w))return!0;if(!y)return!1;p(w)}return w[r].w},v=function(w){return u&&I.NEED&&l(w)&&!o(w,r)&&p(w),w},I=n.exports={KEY:r,NEED:!1,fastKey:c,getWeak:g,onFreeze:v}},function(n,t,e){var r=e(98);n.exports=function(i,o){if(!r(i)||i._t!==o)throw TypeError("Incompatible receiver, "+o+" required!");return i}},function(n,t,e){var r=e(91),i=e(90),o=e(150),s=e(101),a=e(95),l=e(146),u=e(148),p=e(147),c=e(98),g=e(121),v=e(96).f,I=e(153)(0),w=e(100);n.exports=function(y,T,h,m,d,M){var x=r[y],E=x,P=d?"set":"add",R=E&&E.prototype,N={};return!w||typeof E!="function"||!(M||R.forEach&&!s(function(){new E().entries().next()}))?(E=m.getConstructor(T,y,d,P),l(E.prototype,h),o.NEED=!0):(E=T(function(b,j){p(b,E,y,"_c"),b._c=new x,j!=null&&u(j,d,b[P],b)}),I("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(b){var j=b=="add"||b=="set";b in R&&!(M&&b=="clear")&&a(E.prototype,b,function(O,L){if(p(this,E,b),!j&&M&&!c(O))return b=="get"?void 0:!1;var k=this._c[b](O===0?0:O,L);return j?this:k})}),M||v(E.prototype,"size",{get:function(){return this._c.size}})),g(E,y),N[y]=E,i(i.G+i.W+i.F,N),M||m.setStrong(E,y,d),E}},function(n,t,e){var r=e(93),i=e(85),o=e(124),s=e(113),a=e(154);n.exports=function(l,u){var p=l==1,c=l==2,g=l==3,v=l==4,I=l==6,w=l==5||I,y=u||a;return function(T,h,m){for(var d=o(T),M=i(d),x=r(h,m,3),E=s(M.length),P=0,R=p?y(T,E):c?y(T,0):void 0,N,b;E>P;P++)if((w||P in M)&&(N=M[P],b=x(N,P,d),l)){if(p)R[P]=b;else if(b)switch(l){case 3:return!0;case 5:return N;case 6:return P;case 2:R.push(N)}else if(v)return!1}return I?-1:g||v?v:R}}},function(n,t,e){var r=e(155);n.exports=function(i,o){return new(r(i))(o)}},function(n,t,e){var r=e(98),i=e(156),o=e(122)("species");n.exports=function(s){var a;return i(s)&&(a=s.constructor,typeof a=="function"&&(a===Array||i(a.prototype))&&(a=void 0),r(a)&&(a=a[o],a===null&&(a=void 0))),a===void 0?Array:a}},function(n,t,e){var r=e(86);n.exports=Array.isArray||function(o){return r(o)=="Array"}},function(n,t,e){var r=e(90);r(r.P+r.R,"Map",{toJSON:e(158)("Map")})},function(n,t,e){var r=e(128),i=e(159);n.exports=function(o){return function(){if(r(this)!=o)throw TypeError(o+"#toJSON isn't generic");return i(this)}}},function(n,t,e){var r=e(148);n.exports=function(i,o){var s=[];return r(i,!1,s.push,s,o),s}},function(n,t,e){e(161)("Map")},function(n,t,e){var r=e(90);n.exports=function(i){r(r.S,i,{of:function(){for(var s=arguments.length,a=new Array(s);s--;)a[s]=arguments[s];return new this(a)}})}},function(n,t,e){e(163)("Map")},function(n,t,e){var r=e(90),i=e(94),o=e(93),s=e(148);n.exports=function(a){r(r.S,a,{from:function(u){var p=arguments[1],c,g,v,I;return i(this),c=p!==void 0,c&&i(p),u==null?new this:(g=[],c?(v=0,I=o(p,arguments[2],2),s(u,!1,function(w){g.push(I(w,v++))})):s(u,!1,g.push,g),new this(g))}})}},function(n,t,e){n.exports={default:e(165),__esModule:!0}},function(n,t,e){e(166),n.exports=e(92).Object.assign},function(n,t,e){var r=e(90);r(r.S+r.F,"Object",{assign:e(167)})},function(n,t,e){var r=e(100),i=e(110),o=e(168),s=e(169),a=e(124),l=e(85),u=Object.assign;n.exports=!u||e(101)(function(){var p={},c={},g=Symbol(),v="abcdefghijklmnopqrst";return p[g]=7,v.split("").forEach(function(I){c[I]=I}),u({},p)[g]!=7||Object.keys(u({},c)).join("")!=v})?function(c,g){for(var v=a(c),I=arguments.length,w=1,y=o.f,T=s.f;I>w;)for(var h=l(arguments[w++]),m=y?i(h).concat(y(h)):i(h),d=m.length,M=0,x;d>M;)x=m[M++],(!r||T.call(h,x))&&(v[x]=h[x]);return v}:u},function(n,t){t.f=Object.getOwnPropertySymbols},function(n,t){t.f={}.propertyIsEnumerable},function(n,t,e){t.__esModule=!0,t.default=function(r,i){if(!(r instanceof i))throw new TypeError("Cannot call a class as a function")}},function(n,t,e){t.__esModule=!0;var r=e(172),i=o(r);function o(s){return s&&s.__esModule?s:{default:s}}t.default=function(){function s(a,l){for(var u=0;u<l.length;u++){var p=l[u];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),(0,i.default)(a,p.key,p)}}return function(a,l,u){return l&&s(a.prototype,l),u&&s(a,u),a}}()},function(n,t,e){n.exports={default:e(173),__esModule:!0}},function(n,t,e){e(174);var r=e(92).Object;n.exports=function(o,s,a){return r.defineProperty(o,s,a)}},function(n,t,e){var r=e(90);r(r.S+r.F*!e(100),"Object",{defineProperty:e(96).f})},function(n,t,e){n.exports={default:e(176),__esModule:!0}},function(n,t,e){e(177),e(143),e(184),e(185),n.exports=e(92).Symbol},function(n,t,e){var r=e(91),i=e(105),o=e(100),s=e(90),a=e(106),l=e(150).KEY,u=e(101),p=e(117),c=e(121),g=e(118),v=e(122),I=e(178),w=e(179),y=e(180),T=e(156),h=e(97),m=e(98),d=e(124),M=e(84),x=e(103),E=e(104),P=e(108),R=e(181),N=e(183),b=e(168),j=e(96),O=e(110),L=N.f,k=j.f,H=R.f,Q=r.Symbol,_=r.JSON,st=_&&_.stringify,F="prototype",Z=v("_hidden"),tt=v("toPrimitive"),ct={}.propertyIsEnumerable,at=p("symbol-registry"),dt=p("symbols"),it=p("op-symbols"),ft=Object[F],wt=typeof Q=="function"&&!!b.f,U=r.QObject,Y=!U||!U[F]||!U[F].findChild,K=o&&u(function(){return P(k({},"a",{get:function(){return k(this,"a",{value:7}).a}})).a!=7})?function(St,Mt,Ct){var Ot=L(ft,Mt);Ot&&delete ft[Mt],k(St,Mt,Ct),Ot&&St!==ft&&k(ft,Mt,Ot)}:k,et=function(St){var Mt=dt[St]=P(Q[F]);return Mt._k=St,Mt},W=wt&&typeof Q.iterator=="symbol"?function(St){return typeof St=="symbol"}:function(St){return St instanceof Q},$=function(Mt,Ct,Ot){return Mt===ft&&$(it,Ct,Ot),h(Mt),Ct=x(Ct,!0),h(Ot),i(dt,Ct)?(Ot.enumerable?(i(Mt,Z)&&Mt[Z][Ct]&&(Mt[Z][Ct]=!1),Ot=P(Ot,{enumerable:E(0,!1)})):(i(Mt,Z)||k(Mt,Z,E(1,{})),Mt[Z][Ct]=!0),K(Mt,Ct,Ot)):k(Mt,Ct,Ot)},C=function(Mt,Ct){h(Mt);for(var Ot=y(Ct=M(Ct)),bt=0,At=Ot.length,Yt;At>bt;)$(Mt,Yt=Ot[bt++],Ct[Yt]);return Mt},D=function(Mt,Ct){return Ct===void 0?P(Mt):C(P(Mt),Ct)},B=function(Mt){var Ct=ct.call(this,Mt=x(Mt,!0));return this===ft&&i(dt,Mt)&&!i(it,Mt)?!1:Ct||!i(this,Mt)||!i(dt,Mt)||i(this,Z)&&this[Z][Mt]?Ct:!0},X=function(Mt,Ct){if(Mt=M(Mt),Ct=x(Ct,!0),!(Mt===ft&&i(dt,Ct)&&!i(it,Ct))){var Ot=L(Mt,Ct);return Ot&&i(dt,Ct)&&!(i(Mt,Z)&&Mt[Z][Ct])&&(Ot.enumerable=!0),Ot}},q=function(Mt){for(var Ct=H(M(Mt)),Ot=[],bt=0,At;Ct.length>bt;)!i(dt,At=Ct[bt++])&&At!=Z&&At!=l&&Ot.push(At);return Ot},rt=function(Mt){for(var Ct=Mt===ft,Ot=H(Ct?it:M(Mt)),bt=[],At=0,Yt;Ot.length>At;)i(dt,Yt=Ot[At++])&&(!Ct||i(ft,Yt))&&bt.push(dt[Yt]);return bt};wt||(Q=function(){if(this instanceof Q)throw TypeError("Symbol is not a constructor!");var Mt=g(arguments.length>0?arguments[0]:void 0),Ct=function(Ot){this===ft&&Ct.call(it,Ot),i(this,Z)&&i(this[Z],Mt)&&(this[Z][Mt]=!1),K(this,Mt,E(1,Ot))};return o&&Y&&K(ft,Mt,{configurable:!0,set:Ct}),et(Mt)},a(Q[F],"toString",function(){return this._k}),N.f=X,j.f=$,e(182).f=R.f=q,e(169).f=B,b.f=rt,o&&!e(89)&&a(ft,"propertyIsEnumerable",B,!0),I.f=function(St){return et(v(St))}),s(s.G+s.W+s.F*!wt,{Symbol:Q});for(var lt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),gt=0;lt.length>gt;)v(lt[gt++]);for(var yt=O(v.store),xt=0;yt.length>xt;)w(yt[xt++]);s(s.S+s.F*!wt,"Symbol",{for:function(St){return i(at,St+="")?at[St]:at[St]=Q(St)},keyFor:function(Mt){if(!W(Mt))throw TypeError(Mt+" is not a symbol!");for(var Ct in at)if(at[Ct]===Mt)return Ct},useSetter:function(){Y=!0},useSimple:function(){Y=!1}}),s(s.S+s.F*!wt,"Object",{create:D,defineProperty:$,defineProperties:C,getOwnPropertyDescriptor:X,getOwnPropertyNames:q,getOwnPropertySymbols:rt});var Et=u(function(){b.f(1)});s(s.S+s.F*Et,"Object",{getOwnPropertySymbols:function(Mt){return b.f(d(Mt))}}),_&&s(s.S+s.F*(!wt||u(function(){var St=Q();return st([St])!="[null]"||st({a:St})!="{}"||st(Object(St))!="{}"})),"JSON",{stringify:function(Mt){for(var Ct=[Mt],Ot=1,bt,At;arguments.length>Ot;)Ct.push(arguments[Ot++]);if(At=bt=Ct[1],!(!m(bt)&&Mt===void 0||W(Mt)))return T(bt)||(bt=function(Yt,re){if(typeof At=="function"&&(re=At.call(this,Yt,re)),!W(re))return re}),Ct[1]=bt,st.apply(_,Ct)}}),Q[F][tt]||e(95)(Q[F],tt,Q[F].valueOf),c(Q,"Symbol"),c(Math,"Math",!0),c(r.JSON,"JSON",!0)},function(n,t,e){t.f=e(122)},function(n,t,e){var r=e(91),i=e(92),o=e(89),s=e(178),a=e(96).f;n.exports=function(l){var u=i.Symbol||(i.Symbol=o?{}:r.Symbol||{});l.charAt(0)!="_"&&!(l in u)&&a(u,l,{value:s.f(l)})}},function(n,t,e){var r=e(110),i=e(168),o=e(169);n.exports=function(s){var a=r(s),l=i.f;if(l)for(var u=l(s),p=o.f,c=0,g;u.length>c;)p.call(s,g=u[c++])&&a.push(g);return a}},function(n,t,e){var r=e(84),i=e(182).f,o={}.toString,s=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],a=function(l){try{return i(l)}catch{return s.slice()}};n.exports.f=function(u){return s&&o.call(u)=="[object Window]"?a(u):i(r(u))}},function(n,t,e){var r=e(111),i=e(119).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(s){return r(s,i)}},function(n,t,e){var r=e(169),i=e(104),o=e(84),s=e(103),a=e(105),l=e(99),u=Object.getOwnPropertyDescriptor;t.f=e(100)?u:function(c,g){if(c=o(c),g=s(g,!0),l)try{return u(c,g)}catch{}if(a(c,g))return i(!r.f.call(c,g),c[g])}},function(n,t,e){e(179)("asyncIterator")},function(n,t,e){e(179)("observable")},function(n,t,e){Object.defineProperty(t,"__esModule",{value:!0}),t.createNowTime=r,t.formatDelay=i;function r(){var o=null;return Date.now?o=Date.now:o=function(){return new Date().getTime()},o}function i(o){return typeof o=="number"?o={delay:o}:"entropy"in o&&(o={delay:o.entropy,isEntropy:!0}),o}},function(n,t,e){Object.defineProperty(t,"__esModule",{value:!0}),t.default={default:function(i,o,s,a,l){return typeof i=="number"&&typeof o=="number"?i+(s-a)/(l-a)*(o-i):s-a>l-s?o:i}}},function(n,t,e){Object.defineProperty(t,"__esModule",{value:!0}),t.parseEasing=t.Easings=void 0;var r=e(76),i=u(r),o=e(133),s=u(o),a=e(141),l=u(a);function u(T){return T&&T.__esModule?T:{default:T}}var p=e(189),c=new l.default;function g(){for(var T=arguments.length,h=Array(T),m=0;m<T;m++)h[m]=arguments[m];var d=c.get(h);return d||(d=p.apply(void 0,h),c.set(h,d),d)}function v(T){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"end";return function(m,d){for(var M=1;M<d.length;M++){var x=d[M].offset;if(m<=x){var E=d[M-1].offset,P=x,R=(m-E)/(P-E),N=1/T,b=R/N;return h==="end"?b=Math.floor(b):b=Math.ceil(b),N*b*(P-E)+E}}return 0}}function I(T){var h=/^cubic-bezier\((.*)\)/,m=T.match(h);if(m){var d=m[1].trim();return d=d.split(",").map(function(N){return parseFloat(N.trim())}),g.apply(void 0,(0,s.default)(d))}if(h=/^steps\((.*)\)/,m=T.match(h),m){var M=m[1].trim();M=M.split(",").map(function(N){return N.trim()});var x=M,E=(0,i.default)(x,2),P=E[0],R=E[1];return v(parseInt(P,10),R)}return T}var w={linear:function(h){return h},ease:g(.25,.1,.25,1),"ease-in":g(.42,0,1,1),"ease-out":g(0,0,.58,1),"ease-in-out":g(.42,0,.58,1),"step-start":v(1,"start"),"step-end":v(1,"end")};function y(T){return typeof T=="string"?w[T]?T=w[T]:T=I(T):T.type==="cubic-bezier"?T=g.apply(void 0,(0,s.default)(T.value)):T.type==="steps"&&(T=v(T.step,T.pos)),T}t.Easings=w,t.parseEasing=y},function(n,t){var e=4,r=.001,i=1e-7,o=10,s=11,a=1/(s-1),l=typeof Float32Array=="function";function u(T,h){return 1-3*h+3*T}function p(T,h){return 3*h-6*T}function c(T){return 3*T}function g(T,h,m){return((u(h,m)*T+p(h,m))*T+c(h))*T}function v(T,h,m){return 3*u(h,m)*T*T+2*p(h,m)*T+c(h)}function I(T,h,m,d,M){var x,E,P=0;do E=h+(m-h)/2,x=g(E,d,M)-T,x>0?m=E:h=E;while(Math.abs(x)>i&&++P<o);return E}function w(T,h,m,d){for(var M=0;M<e;++M){var x=v(h,m,d);if(x===0)return h;var E=g(h,m,d)-T;h-=E/x}return h}function y(T){return T}n.exports=function(h,m,d,M){if(!(0<=h&&h<=1&&0<=d&&d<=1))throw new Error("bezier x values must be in [0, 1] range");if(h===m&&d===M)return y;for(var x=l?new Float32Array(s):new Array(s),E=0;E<s;++E)x[E]=g(E*a,h,d);function P(R){for(var N=0,b=1,j=s-1;b!==j&&x[b]<=R;++b)N+=a;--b;var O=(R-x[b])/(x[b+1]-x[b]),L=N+O*a,k=v(L,h,d);return k>=r?w(R,L,h,d):k===0?L:I(R,N,N+a,h,d)}return function(N){return N===0?0:N===1?1:g(P(N),m,M)}}},function(n,t,e){Object.defineProperty(t,"__esModule",{value:!0});var r=e(191),i=m(r),o=e(204),s=m(o),a=e(164),l=m(a),u=e(170),p=m(u),c=e(171),g=m(c),v=e(175),I=m(v),w=e(75),y=m(w),T=e(208),h=e(188);function m(k){return k&&k.__esModule?k:{default:k}}var d=(0,I.default)("timing"),M=(0,I.default)("keyframes"),x=(0,I.default)("initState"),E=(0,I.default)("readyDefer"),P=(0,I.default)("finishedDefer"),R=(0,I.default)("effects"),N=(0,I.default)("activeReadyTimer"),b=(0,I.default)("activeFinishTimer"),j=(0,I.default)("removeDefer"),O={delay:0,endDelay:0,fill:"auto",iterations:1,playbackRate:1,direction:"normal",easing:"linear",effect:null},L=function(){function k(H,Q,_){var st=this;if((0,p.default)(this,k),Array.isArray(H)){var F=[H[0],H,Q];H=F[0],Q=F[1],_=F[2]}typeof _=="number"&&(_={duration:_}),this[d]=(0,l.default)({},O,_),this[d].easing=(0,h.parseEasing)(this[d].easing),this[M]=(0,T.calculateFramesOffset)(Q);var Z=this[M][this[M].length-1];this[x]={},(0,s.default)(Z).forEach(function(tt){Object.prototype.hasOwnProperty.call(H,tt)&&tt!=="easing"&&tt!=="offset"&&(st[x][tt]=H[tt])}),this[M]=this[M].map(function(tt){return(0,l.default)({},st[x],tt)}),this[M][0].offset!==0&&this[M].unshift((0,l.default)({},this[x],{offset:0})),Z.offset<1&&this[M].push((0,l.default)({},Z,{offset:1})),this[R]={},this.timeline=null}return(0,g.default)(k,[{key:"pause",value:function(){this.timeline.playbackRate=0}},{key:N,value:function(){var Q=this;this[E]&&!this[E].timerID&&(this.timeline.currentTime<0?this[E].timerID=this.timeline.setTimeout(function(){Q[E].resolve(),delete Q[E]},{delay:-this.timeline.currentTime,heading:!1}):this[E].timerID=this.timeline.setTimeout(function(){Q[E].resolve(),delete Q[E]},{delay:0,isEntropy:!0}))}},{key:b,value:function(){var Q=this,_=this[d],st=_.duration,F=_.iterations,Z=_.endDelay,tt=Math.ceil(st*F+Z-this.timeline.currentTime)+1;this[P]&&!this[P].timerID&&(this[P].timerID=this.timeline.setTimeout(function(){Q[P].resolve(),Q[j](E),Q[j](P)},{delay:tt,heading:!1}),this[P].reverseTimerID=this.timeline.setTimeout(function(){Q[P].resolve(),Q[j](E),Q[j](P),Q.timeline=null},{delay:-this[d].delay-1,heading:!1}))}},{key:"play",value:function(){if(this.playState==="finished"&&this.cancel(),this.playState==="idle"){if(this.playbackRate<=0)return;var Q=this[d],_=Q.delay,st=Q.playbackRate,F=Q.timeline;this.timeline=new y.default({originTime:_,playbackRate:st},F),this[N](),this[b]()}else this.playState==="paused"&&(this.timeline.playbackRate=this.playbackRate,this[N]())}},{key:j,value:function(Q){var _=this[Q],st=this.timeline;_&&st&&(st.clearTimeout(_.timerID),_.reverseTimerID&&st.clearTimeout(_.reverseTimerID)),delete this[Q]}},{key:"cancel",value:function(){this[j](E),this[j](P),this.timeline=null}},{key:"finish",value:function(){this.timeline&&(this.timeline.currentTime=1/0/this.playbackRate),this[j](E),this[j](P)}},{key:"applyEffects",value:function(Q){return(0,l.default)(this[R],Q)}},{key:"playbackRate",get:function(){return this[d].playbackRate},set:function(Q){this.timeline&&(this.timeline.playbackRate=Q),this[d].playbackRate=Q}},{key:"playState",get:function(){var Q=this.timeline,_=this[d],st=_.iterations,F=_.duration,Z=_.endDelay,tt="running";if(Q==null)tt="idle";else if(Q.paused)tt="paused";else if(Q.currentTime<0)tt="pending";else{var ct=Q.currentTime-st*F;ct>0&&ct<Z?tt="pending":ct>=Z&&(tt="finished")}return tt}},{key:"progress",get:function(){if(!this.timeline)return 0;var Q=this[d],_=Q.duration,st=Q.iterations,F=this.timeline,Z=this.playState,tt=void 0;if(Z==="idle")tt=0;else if(Z==="paused"&&F.currentTime<0)tt=0;else if(Z==="pending")if(F.currentTime<0)tt=0;else{var ct=F.seekLocalTime(st*_);tt=(0,T.periodicity)(ct,_)[1]/_}else(Z==="running"||Z==="paused")&&(tt=(0,T.periodicity)(F.currentTime,_)[1]/_);return Z==="finished"&&(tt=(0,T.periodicity)(st,1)[1]),tt}},{key:"frame",get:function(){var Q=this.playState,_=this[x],st=this[d].fill;if(Q==="idle")return _;var F=this.timeline.currentTime,Z=this[M].slice(0),tt=(0,T.getProgress)(this.timeline,this[d],this.progress),ct=tt.p,at=tt.inverted,dt=_;return F<0&&Q==="pending"?(st==="backwards"||st==="both")&&(dt=at?Z[Z.length-1]:Z[0]):(Q!=="pending"&&Q!=="finished"||st==="forwards"||st==="both")&&(dt=(0,T.getCurrentFrame)(this[d],Z,this[R],ct)),dt}},{key:"timing",get:function(){return this[d]}},{key:"effects",get:function(){return this[R]}},{key:"baseTimeline",set:function(Q){this[d].timeline=Q},get:function(){return this[d].timeline}},{key:"ready",get:function(){return this[E]?this[E].promise:this.timeline&&this.timeline.currentTime>=0&&this.playState!=="paused"?i.default.resolve():(this[E]=(0,T.defer)(),this.timeline&&this[N](),this[E]?this[E].promise:i.default.resolve())}},{key:"finished",get:function(){return this.playState==="finished"?i.default.resolve():(this[P]||(this[P]=(0,T.defer)(),this.timeline&&this[b]()),this[P].promise)}}]),k}();t.default=L},function(n,t,e){n.exports={default:e(192),__esModule:!0}},function(n,t,e){e(143),e(125),e(79),e(193),e(202),e(203),n.exports=e(92).Promise},function(n,t,e){var r=e(89),i=e(91),o=e(93),s=e(128),a=e(90),l=e(98),u=e(94),p=e(147),c=e(148),g=e(194),v=e(195).set,I=e(197)(),w=e(198),y=e(199),T=e(200),h=e(201),m="Promise",d=i.TypeError,M=i.process,x=M&&M.versions,E=x&&x.v8||"",P=i[m],R=s(M)=="process",N=function(){},b,j,O,L,k=j=w.f,H=!!function(){try{var at=P.resolve(1),dt=(at.constructor={})[e(122)("species")]=function(it){it(N,N)};return(R||typeof PromiseRejectionEvent=="function")&&at.then(N)instanceof dt&&E.indexOf("6.6")!==0&&T.indexOf("Chrome/66")===-1}catch{}}(),Q=function(at){var dt;return l(at)&&typeof(dt=at.then)=="function"?dt:!1},_=function(at,dt){if(!at._n){at._n=!0;var it=at._c;I(function(){for(var ft=at._v,wt=at._s==1,U=0,Y=function(K){var et=wt?K.ok:K.fail,W=K.resolve,$=K.reject,C=K.domain,D,B,X;try{et?(wt||(at._h==2&&Z(at),at._h=1),et===!0?D=ft:(C&&C.enter(),D=et(ft),C&&(C.exit(),X=!0)),D===K.promise?$(d("Promise-chain cycle")):(B=Q(D))?B.call(D,W,$):W(D)):$(ft)}catch(q){C&&!X&&C.exit(),$(q)}};it.length>U;)Y(it[U++]);at._c=[],at._n=!1,dt&&!at._h&&st(at)})}},st=function(at){v.call(i,function(){var dt=at._v,it=F(at),ft,wt,U;if(it&&(ft=y(function(){R?M.emit("unhandledRejection",dt,at):(wt=i.onunhandledrejection)?wt({promise:at,reason:dt}):(U=i.console)&&U.error&&U.error("Unhandled promise rejection",dt)}),at._h=R||F(at)?2:1),at._a=void 0,it&&ft.e)throw ft.v})},F=function(at){return at._h!==1&&(at._a||at._c).length===0},Z=function(at){v.call(i,function(){var dt;R?M.emit("rejectionHandled",at):(dt=i.onrejectionhandled)&&dt({promise:at,reason:at._v})})},tt=function(at){var dt=this;dt._d||(dt._d=!0,dt=dt._w||dt,dt._v=at,dt._s=2,dt._a||(dt._a=dt._c.slice()),_(dt,!0))},ct=function(at){var dt=this,it;if(!dt._d){dt._d=!0,dt=dt._w||dt;try{if(dt===at)throw d("Promise can't be resolved itself");(it=Q(at))?I(function(){var ft={_w:dt,_d:!1};try{it.call(at,o(ct,ft,1),o(tt,ft,1))}catch(wt){tt.call(ft,wt)}}):(dt._v=at,dt._s=1,_(dt,!1))}catch(ft){tt.call({_w:dt,_d:!1},ft)}}};H||(P=function(dt){p(this,P,m,"_h"),u(dt),b.call(this);try{dt(o(ct,this,1),o(tt,this,1))}catch(it){tt.call(this,it)}},b=function(dt){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},b.prototype=e(146)(P.prototype,{then:function(dt,it){var ft=k(g(this,P));return ft.ok=typeof dt=="function"?dt:!0,ft.fail=typeof it=="function"&&it,ft.domain=R?M.domain:void 0,this._c.push(ft),this._a&&this._a.push(ft),this._s&&_(this,!1),ft.promise},catch:function(at){return this.then(void 0,at)}}),O=function(){var at=new b;this.promise=at,this.resolve=o(ct,at,1),this.reject=o(tt,at,1)},w.f=k=function(at){return at===P||at===L?new O(at):j(at)}),a(a.G+a.W+a.F*!H,{Promise:P}),e(121)(P,m),e(149)(m),L=e(92)[m],a(a.S+a.F*!H,m,{reject:function(dt){var it=k(this),ft=it.reject;return ft(dt),it.promise}}),a(a.S+a.F*(r||!H),m,{resolve:function(dt){return h(r&&this===L?P:this,dt)}}),a(a.S+a.F*!(H&&e(140)(function(at){P.all(at).catch(N)})),m,{all:function(dt){var it=this,ft=k(it),wt=ft.resolve,U=ft.reject,Y=y(function(){var K=[],et=0,W=1;c(dt,!1,function($){var C=et++,D=!1;K.push(void 0),W++,it.resolve($).then(function(B){D||(D=!0,K[C]=B,--W||wt(K))},U)}),--W||wt(K)});return Y.e&&U(Y.v),ft.promise},race:function(dt){var it=this,ft=k(it),wt=ft.reject,U=y(function(){c(dt,!1,function(Y){it.resolve(Y).then(ft.resolve,wt)})});return U.e&&wt(U.v),ft.promise}})},function(n,t,e){var r=e(97),i=e(94),o=e(122)("species");n.exports=function(s,a){var l=r(s).constructor,u;return l===void 0||(u=r(l)[o])==null?a:i(u)}},function(n,t,e){var r=e(93),i=e(196),o=e(120),s=e(102),a=e(91),l=a.process,u=a.setImmediate,p=a.clearImmediate,c=a.MessageChannel,g=a.Dispatch,v=0,I={},w="onreadystatechange",y,T,h,m=function(){var M=+this;if(I.hasOwnProperty(M)){var x=I[M];delete I[M],x()}},d=function(M){m.call(M.data)};(!u||!p)&&(u=function(x){for(var E=[],P=1;arguments.length>P;)E.push(arguments[P++]);return I[++v]=function(){i(typeof x=="function"?x:Function(x),E)},y(v),v},p=function(x){delete I[x]},e(86)(l)=="process"?y=function(M){l.nextTick(r(m,M,1))}:g&&g.now?y=function(M){g.now(r(m,M,1))}:c?(T=new c,h=T.port2,T.port1.onmessage=d,y=r(h.postMessage,h,1)):a.addEventListener&&typeof postMessage=="function"&&!a.importScripts?(y=function(M){a.postMessage(M+"","*")},a.addEventListener("message",d,!1)):w in s("script")?y=function(M){o.appendChild(s("script"))[w]=function(){o.removeChild(this),m.call(M)}}:y=function(M){setTimeout(r(m,M,1),0)}),n.exports={set:u,clear:p}},function(n,t){n.exports=function(e,r,i){var o=i===void 0;switch(r.length){case 0:return o?e():e.call(i);case 1:return o?e(r[0]):e.call(i,r[0]);case 2:return o?e(r[0],r[1]):e.call(i,r[0],r[1]);case 3:return o?e(r[0],r[1],r[2]):e.call(i,r[0],r[1],r[2]);case 4:return o?e(r[0],r[1],r[2],r[3]):e.call(i,r[0],r[1],r[2],r[3])}return e.apply(i,r)}},function(n,t,e){var r=e(91),i=e(195).set,o=r.MutationObserver||r.WebKitMutationObserver,s=r.process,a=r.Promise,l=e(86)(s)=="process";n.exports=function(){var u,p,c,g=function(){var y,T;for(l&&(y=s.domain)&&y.exit();u;){T=u.fn,u=u.next;try{T()}catch(h){throw u?c():p=void 0,h}}p=void 0,y&&y.enter()};if(l)c=function(){s.nextTick(g)};else if(o&&!(r.navigator&&r.navigator.standalone)){var v=!0,I=document.createTextNode("");new o(g).observe(I,{characterData:!0}),c=function(){I.data=v=!v}}else if(a&&a.resolve){var w=a.resolve(void 0);c=function(){w.then(g)}}else c=function(){i.call(r,g)};return function(y){var T={fn:y,next:void 0};p&&(p.next=T),u||(u=T,c()),p=T}}},function(n,t,e){var r=e(94);function i(o){var s,a;this.promise=new o(function(l,u){if(s!==void 0||a!==void 0)throw TypeError("Bad Promise constructor");s=l,a=u}),this.resolve=r(s),this.reject=r(a)}n.exports.f=function(o){return new i(o)}},function(n,t){n.exports=function(e){try{return{e:!1,v:e()}}catch(r){return{e:!0,v:r}}}},function(n,t,e){var r=e(91),i=r.navigator;n.exports=i&&i.userAgent||""},function(n,t,e){var r=e(97),i=e(98),o=e(198);n.exports=function(s,a){if(r(s),i(a)&&a.constructor===s)return a;var l=o.f(s),u=l.resolve;return u(a),l.promise}},function(n,t,e){var r=e(90),i=e(92),o=e(91),s=e(194),a=e(201);r(r.P+r.R,"Promise",{finally:function(l){var u=s(this,i.Promise||o.Promise),p=typeof l=="function";return this.then(p?function(c){return a(u,l()).then(function(){return c})}:l,p?function(c){return a(u,l()).then(function(){throw c})}:l)}})},function(n,t,e){var r=e(90),i=e(198),o=e(199);r(r.S,"Promise",{try:function(s){var a=i.f(this),l=o(s);return(l.e?a.reject:a.resolve)(l.v),a.promise}})},function(n,t,e){n.exports={default:e(205),__esModule:!0}},function(n,t,e){e(206),n.exports=e(92).Object.keys},function(n,t,e){var r=e(124),i=e(110);e(207)("keys",function(){return function(s){return i(r(s))}})},function(n,t,e){var r=e(90),i=e(92),o=e(101);n.exports=function(s,a){var l=(i.Object||{})[s]||Object[s],u={};u[s]=a(l),r(r.S+r.F*o(function(){l(1)}),"Object",u)}},function(n,t,e){Object.defineProperty(t,"__esModule",{value:!0});var r=e(76),i=I(r),o=e(209),s=I(o),a=e(164),l=I(a),u=e(191),p=I(u);t.defer=w,t.periodicity=y,t.calculateFramesOffset=T,t.getProgress=h,t.getCurrentFrame=d;var c=e(188),g=e(187),v=I(g);function I(M){return M&&M.__esModule?M:{default:M}}function w(){var M={};return M.promise=new p.default(function(x,E){M.resolve=x,M.reject=E}),M}function y(M,x){var E=Math.floor(M/x),P=M-E*x;return P===0&&E>0&&(P=x,E--),[E,P]}function T(M){M=M.slice(0);var x=M[0],E=M[M.length-1];E.offset=E.offset||1,x.offset=x.offset||0;for(var P=0,R=-1,N=0;N<M.length;N++){var b=M[N];if(b.offset!=null){var j=N-R;if(j>1)for(var O=(b.offset-P)/j,L=0;L<j-1;L++)M[R+L+1].offset=P+O*(L+1);P=b.offset,R=N}if(b.easing!=null&&(b.easing=(0,c.parseEasing)(b.easing)),N>0){var k=M[N].easing!=null;M[N]=(0,l.default)({},M[N-1],M[N]),k||delete M[N].easing}}return M}function h(M,x,E){var P=M.currentTime,R=x.direction,N=x.duration,b=!1;if(R==="reverse")E=1-E,b=!0;else if(R==="alternate"||R==="alternate-reverse"){var j=Math.floor(P/N);E===1&&j--,j%2^R==="alternate-reverse"&&(E=1-E,b=!0)}return{p:E,inverted:b}}function m(M,x,E,P){var R={};return(0,s.default)(x).forEach(function(N){var b=(0,i.default)(N,2),j=b[0],O=b[1];if(j!=="offset"&&j!=="easing"){var L=E[j]||E.default,k=L(M[j],O,P,M.offset,x.offset);k!=null&&(R[j]=k)}}),R}function d(M,x,E,P){var R=M.easing,N=M.effect;N||(E=(0,l.default)({},v.default,E));var b={};P=R(P,x);for(var j=1;j<x.length;j++){var O=x[j],L=O.offset;if(L>=P||j===x.length-1){var k=x[j-1],H=k.offset,Q=k.easing,_=P;if(Q){var st=L-H;_=Q((P-H)/st)*st+H}N?b=N(k,O,_,H,L):b=m(k,O,E,_);break}}return b}},function(n,t,e){n.exports={default:e(210),__esModule:!0}},function(n,t,e){e(211),n.exports=e(92).Object.entries},function(n,t,e){var r=e(90),i=e(212)(!0);r(r.S,"Object",{entries:function(s){return i(s)}})},function(n,t,e){var r=e(100),i=e(110),o=e(84),s=e(169).f;n.exports=function(a){return function(l){for(var u=o(l),p=i(u),c=p.length,g=0,v=[],I;c>g;)I=p[g++],(!r||s.call(u,I))&&v.push(a?[I,u[I]]:u[I]);return v}}},function(n,t,e){e.r(t),e(1).glMatrix.setMatrixArrayType(Array);const r=new Map;function i(s,a={},l=[]){s=s.toLowerCase();const u=r.get(s);if(!u)throw new TypeError(`Invalid node: ${s}`);const p=new u(a);return l.forEach(c=>{p.appendChild(c)}),p}const o={registerNode(s,a,l=100){if(a=a.toLowerCase(),r.has(a))throw new TypeError(`Cannot registerNode, ${a} has been taken.`);r.set(a,s),Object.defineProperties(s.prototype,{nodeType:{value:l},tagName:{value:a.toUpperCase()},nodeName:{value:a},ownerDocument:{value:o},namespaceURI:{value:`http://spritejs.com/${a}`}})},createElement:i,createElementNS(s,a){return i(a)},isSpriteNode(s){return r.has(s.toLowerCase())}};t.default=o},function(n,t,e){e.r(t),e.d(t,"default",function(){return a}),e(1).glMatrix.setMatrixArrayType(Array);const r=Symbol("type"),i=Symbol("bubbles"),o=Symbol("originalEvent"),s=Symbol("detail");class a{constructor(u,{bubbles:p=null}={}){if(typeof u=="string"?(this[r]=u,this[i]=!!p):(this[r]=u.type,this[o]=u,this[i]=p!=null?!!p:!!u.bubbles,u.detail&&(this[s]=u.detail)),!this[r])throw new TypeError("Invalid event type.");this.cancelBubble=!1}setOriginalEvent(u){this[o]=u}get originalEvent(){return this[o]}get type(){return this[r]}get bubbles(){return this[i]}get detail(){return this[s]}stopPropagation(){this.cancelBubble=!0}}},function(n,t,e){e.r(t),e.d(t,"parseFilterString",function(){return i}),e.d(t,"applyFilters",function(){return o});var r=e(72);e(1).glMatrix.setMatrixArrayType(Array);function i(s){if(s=s.trim(),!s||s==="none")return null;const a=/^(?:(url|blur|brightness|contrast|drop-shadow|grayscale|hue-rotate|invert|opacity|saturate|sepia)\(([^()]*(?:\(.*\))*[^()]*)\))+$/i,l=s.match(/(?:(url|blur|brightness|contrast|drop-shadow|grayscale|hue-rotate|invert|opacity|saturate|sepia)\(([^()]*(?:\(.*\))*[^()]*)\))+?/ig),u=[];return l&&l.forEach(p=>{const c=p.match(a);if(!c)throw new TypeError("Invalid fitler string.");let[,g,v]=c;g=g.toLowerCase(),v=v.trim().match(/([^( )]+|([^( )]+\(.*\)))(?=\s|$)/g).map((I,w)=>{let y;return g==="url"||g==="drop-shadow"&&w===3?y=I:y=Object(r.toNumber)(I),/%$/.test(I)&&(y/=100),y}),u.push({type:g,args:v})}),u}function o(s,a){s.clearFilter(),a&&a.forEach(({type:l,args:u})=>{let p=l;p==="drop-shadow"?p="dropShadow":p==="hue-rotate"&&(p="hueRotate"),s[p](...u)})}},function(n,t,e){e.r(t),e.d(t,"default",function(){return r}),e(1).glMatrix.setMatrixArrayType(Array);function r(i,o){if(!o)return;const s=i.getListeners("beforerender"),a=i.getListeners("afterrender");s.length&&!o.beforeRender?o.beforeRender=l=>{i.dispatchEvent({type:"beforerender",detail:{context:l}})}:s.length||(o.beforeRender=null),a.length&&!o.afterRender?o.afterRender=l=>{i.dispatchEvent({type:"afterrender",detail:{context:l}})}:a.length||(o.afterRender=null)}},function(n,t,e){e.r(t),e.d(t,"default",function(){return u});var r=e(12),i=e(218),o=e(70),s=e(213);e(1).glMatrix.setMatrixArrayType(Array);const a=Symbol("amount"),l=Symbol("meshCloud");class u extends o.default{constructor(c,g=1){super(),this.meshNode=c,c.connect(this),this[a]=g,this[l]=null}get meshCloud(){const c=this.meshNode,g=this[a];return!this[l]&&c.mesh&&(this[l]=new r.MeshCloud(c.mesh,g)),this[l]}get isVisible(){return!!this.meshNode&&this.meshNode.isVisible}get amount(){return this[a]}set amount(c){this[a]=c,this[l]&&(this[l].amount=c)}brightness(c,g){this.meshCloud&&(this.meshCloud.brightness(c,g),this.forceUpdate())}contrast(c,g){this.meshCloud&&(this.meshCloud.contrast(c,g),this.forceUpdate())}delete(c){this.meshCloud&&(this.meshCloud.delete(c),this[a]--,this.forceUpdate())}draw(c=[]){if(super.draw(c),this.meshCloud){if(this.program){this.meshCloud.setProgram(this.program);const g=this.shaderAttrs;g&&Object.entries(g).forEach(([I,w])=>{this.meshCloud.mesh.setAttribute(I,w)});const v=this.uniforms;if(this.uniforms){const I={};Object.entries(v).forEach(([w,y])=>{typeof y=="function"&&(y=y(this,w)),I[w]=y}),this.meshCloud.mesh.setUniforms(I)}}this.meshNode.textureImage&&Object(i.drawTexture)(this.meshNode,this.meshNode.mesh),c.push(this.meshCloud)}return c}getTransform(c){if(this.meshCloud)return this.meshCloud.getTransform(c)}grayscale(c,g){this.meshCloud&&(this.meshCloud.grayscale(c,g),this.forceUpdate())}hueRotate(c,g){this.meshCloud&&(this.meshCloud.hueRotate(c,g),this.forceUpdate())}invert(c,g){this.meshCloud&&(this.meshCloud.invert(c,g),this.forceUpdate())}isPointCollision(c,g){if(!this.meshCloud)return!1;const v=this.attributes.pointerEvents;if(v==="none"||v!=="all"&&!this.isVisible)return!1;let I="both";v==="visibleFill"&&(I="fill"),v==="visibleStroke"&&(I="stroke");for(let w=0;w<this[a];w++)if(!this.meshCloud.isPointCollision(w,[c,g],I))return!1;return!0}setOpacity(c,g){this.meshCloud&&(this.meshCloud.opacity(c,g),this.forceUpdate())}rotate(c,g,[v,I]=[0,0]){const w=Math.PI*g/180;if(this.meshCloud){const{x:y,y:T}=this.meshNode.attributes;this.meshCloud.rotate(c,w,[v+y,I+T]),this.forceUpdate()}}saturate(c,g){this.meshCloud&&(this.meshCloud.saturate(c,g),this.forceUpdate())}scale(c,[g,v=g],[I,w]=[0,0]){if(this.meshCloud){const{x:y,y:T}=this.meshNode.attributes,h=1e-5;Math.abs(g)<h&&(g=1/g>0?h:-h),Math.abs(v)<h&&(v=1/v>0?h:-h),this.meshCloud.scale(c,[g,v],[I+y,w+T]),this.forceUpdate()}}setColorTransform(c,g){this.meshCloud&&(this.meshCloud.setColorTransform(c,g),this.forceUpdate())}setFillColor(c,g){this.meshCloud&&(Array.isArray(g)&&(g=[...g],g[0]/=255,g[1]/=255,g[2]/=255),this.meshCloud.setFillColor(c,g),this.forceUpdate())}sepia(c,g){this.meshCloud&&(this.meshCloud.sepia(c,g),this.forceUpdate())}setResolution({width:c,height:g}){super.setResolution({width:c,height:g}),this.meshNode.setResolution({width:c,height:g})}setStrokeColor(c,g){this.meshCloud&&(Array.isArray(g)&&(g=[...g],g[0]/=255,g[1]/=255,g[2]/=255),this.meshCloud.setStrokeColor(c,g),this.forceUpdate())}setTransform(c,g){this.meshCloud&&(this.meshCloud.setTransform(c,g),this.forceUpdate())}skew(c,[g,v=g],[I,w]=[0,0]){if(this.meshCloud){const{x:y,y:T}=this.meshNode.attributes;this.meshCloud.skew(c,[g,v],[I+y,w+T]),this.forceUpdate()}}transform(c,g){this.meshCloud&&(this.meshCloud.transform(c,g),this.forceUpdate())}transformColor(c,g){this.meshCloud&&(this.meshCloud.transformColor(c,g),this.forceUpdate())}translate(c,[g,v]){this.meshCloud&&(this.meshCloud.translate(c,[g,v]),this.forceUpdate())}updateMesh(){this[l]&&(this[l].mesh=this.meshNode.mesh,this.forceUpdate())}}s.default.registerNode(u,"cloud")},function(n,t,e){e.r(t),e.d(t,"loadTexture",function(){return s}),e.d(t,"applyTexture",function(){return a}),e.d(t,"createTexture",function(){return u}),e.d(t,"deleteTexture",function(){return p}),e.d(t,"drawTexture",function(){return g}),e.d(t,"loadFrames",function(){return v});var r=e(12),i=e(72);e(1).glMatrix.setMatrixArrayType(Array);const o={};function s(I,w){if(o[I])return o[I];const y=r.ENV.loadImage(I,{alias:w,useImageBitmap:!1});return y??I}async function a(I,w,y){let T=w;if(typeof w=="string"&&(T=s(w)),T&&typeof T.then=="function"&&(T=await T),w===I.attributes.texture){T&&T.image&&(T.sourceRect&&(I.attributes.sourceRect=T.sourceRect),I.textureImageRotated=!!T.rotated,T=T.image);const{width:h,height:m,textureRect:d}=I.attributes,M=I.textureImage;I.textureImage=T,y&&M!==T&&!d&&(h==null||m==null)&&I.updateContours(),I.forceUpdate()}return T}const l=Symbol("textureMap");function u(I,w){if(w[l]=w[l]||new Map,w[l].has(I))return w[l].get(I);const y=w.createTexture(I);return!/^blob:/.test(I.src)&&typeof I.getContext!="function"&&w[l].set(I,y),y}function p(I,w){if(w[l]&&w[l].has(I)){const y=w[l].get(I);return w.deleteTexture(y),w[l].delete(I),!0}return!1}const c=Symbol("textureContext");function g(I,w){const y=I.textureImage instanceof String?String(I.textureImage):I.textureImage,T=I.textureImageRotated,h=w.texture,m=I.renderer;if(y){const d=I.originalContentRect;let M=I.attributes.textureRect;const x=I.attributes.textureRepeat,E=I.attributes.sourceRect;if(!h||I[c]&&I[c]!==m||h.image!==y||h.options.repeat!==x||!Object(i.compareValue)(h.options.rect,M)||!Object(i.compareValue)(h.options.srcRect,E)){const P=u(y,m);M?(M[0]+=d[0],M[1]+=d[1]):M=d;let R=null;h&&!m[l].has(h.image)&&(!h.options||!h.options.hidden)&&(R=w.uniforms.u_texSampler),w.setTexture(P,{rect:M,repeat:x,srcRect:E,rotated:T}),R&&R.delete&&R.delete(),I[c]=m}}else if(h){let d=null;!m[l].has(h.image)&&(!h.options||!h.options.hidden)&&(d=w.uniforms.u_texSampler),w.setTexture(null),d&&d.delete&&d.delete()}}async function v(I,w){typeof w=="string"&&(w=await(await fetch(w,{method:"GET",mode:"cors",cache:"default"})).json());const y=await s(I),T=w.frames;return Object.entries(T).forEach(([h,m])=>{const{x:d,y:M,w:x,h:E}=m.frame;let P=[d,M,x,E];const R=m.rotated;R&&(P=[P[0],P[1],P[3],P[2]]),o[h]={image:y,sourceRect:P,rotated:R}}),y}},function(n,t,e){e.r(t),e.d(t,"default",function(){return v});var r=e(1),i=e(12),o=e(70),s=e(220),a=e(221),l=e(222),u=e(213),p=e(223);e(1).glMatrix.setMatrixArrayType(Array);function c(I,w,y){return w in I?Object.defineProperty(I,w,{value:y,enumerable:!0,configurable:!0,writable:!0}):I[w]=y,I}const g=Symbol("mesh");class v extends o.default{constructor(w={}){super(w)}get borderSize(){const{paddingTop:w,paddingRight:y,paddingBottom:T,paddingLeft:h,borderWidth:m}=this.attributes,[d,M]=this.contentSize;return[h+d+y+m,w+M+T+m]}get clientSize(){const{paddingTop:w,paddingRight:y,paddingBottom:T,paddingLeft:h}=this.attributes,[m,d]=this.contentSize;return[h+m+y,w+d+T]}get contentSize(){let{width:w,height:y,boxSizing:T,paddingTop:h,paddingRight:m,paddingBottom:d,paddingLeft:M}=this.attributes;if(w=w||0,y=y||0,T==="border-box"){const x=2*this.attributes.borderWidth;w-=x+m+M,y-=x+h+d,w=Math.max(0,w),y=Math.max(0,y)}return[w,y]}get hasBorder(){return this.attributes.borderWidth>0}get isVisible(){const[w,y]=this.borderSize;return w>0&&y>0}get mesh(){if(this.attributes.display==="none")return null;const w=this.clientBox;if(w){let y=this[g];if(y)y.box!==w&&(y.contours=w.contours,y.box=w);else{y=new i.Mesh2D(w),y.box=w;const h=this.attributes.bgcolor;if(Object(a.setFillColor)(y,{color:h}),this.hasBorder){const{borderColor:d,borderWidth:M,borderDash:x,borderDashOffset:E}=this.attributes;Object(a.setStrokeColor)(y,{color:d,lineWidth:M,lineDash:x,lineDashOffset:E})}this[g]=y;const m=this.attributes.clipPath;m&&this[g].setClipPath(m)}const T=this.opacity;return y.getOpacity()!==T&&y.setOpacity(T),y.setTransform(...this.renderMatrix),y}return null}get offsetSize(){const{paddingTop:w,paddingRight:y,paddingBottom:T,paddingLeft:h,borderWidth:m}=this.attributes,[d,M]=this.contentSize,x=2*m;return[h+d+y+x,w+M+T+x]}get originalClientRect(){if(this.mesh){const w=this.mesh.boundingBox;return[w[0][0],w[0][1],w[1][0]-w[0][0],w[1][1]-w[0][1]]}return[0,0,0,0]}get originalContentRect(){const[w,y,T,h]=this.originalClientRect,m=this.attributes.padding;return[w+m[0],y+m[1],T-m[0]-m[2],h-m[1]-m[3]]}getBoundingClientRect(){let w=this.renderMatrix;this.layer&&this.layer.layerTransformInvert&&(w=r.mat2d.multiply(Array.of(0,0,0,0,0,0),this.layer.transformMatrix,w));let y=null;if(this.mesh){y=[...this.mesh.boundingBox];const T=this.attributes.borderWidth;T&&(y[0]=[y[0][0]-T,y[0][1]-T],y[1]=[y[1][0]+T,y[1][1]+T])}return Object(p.default)(y,w)}onPropertyChange(w,y,T){if(super.onPropertyChange(w,y,T),(w==="anchorX"||w==="anchorY"||w==="boxSizing"||w==="width"||w==="height"||w==="borderWidth"||w==="paddingLeft"||w==="paddingRight"||w==="paddingTop"||w==="paddingBottom"||/^border(TopLeft|TopRight|BottomRight|BottomLeft)Radius$/.test(w))&&this.updateContours(),this[g]&&w==="clipPath"&&this[g].setClipPath(y),this[g]&&w==="bgcolor"&&Object(a.setFillColor)(this[g],{color:y}),this[g]&&(w==="borderColor"||w==="borderWidth"||w==="borderDash"||w==="borderDashOffset")){const{borderColor:h,borderWidth:m,borderDash:d,borderDashOffset:M}=this.attributes;Object(a.setStrokeColor)(this[g],{color:h,lineWidth:m,lineDash:m?d:0,lineDashOffset:M})}}updateContours(){const{anchorX:w,anchorY:y,borderWidth:T,borderRadius:h}=this.attributes,[m,d]=this.borderSize,M=this.offsetSize,x=.5*T,E=-w*M[0]+x,P=-y*M[1]+x;this.clientBox=new i.Figure2D,Object(l.createRadiusBox)(this.clientBox,[E,P,m,d],h)}}c(v,"Attr",s.default),u.default.registerNode(v,"block")},function(n,t,e){e.r(t),e.d(t,"default",function(){return p});var r=e(71),i=e(72),o=e(221);e(1).glMatrix.setMatrixArrayType(Array);const s=Symbol.for("spritejs_setAttribute"),a=Symbol.for("spritejs_getAttribute"),l=Symbol.for("spritejs_setAttributeDefault"),u=Symbol.for("spritejs_declareAlias");class p extends r.default{constructor(g){super(g),this[l]({anchorX:0,anchorY:0,width:void 0,height:void 0,borderWidth:0,borderColor:"rgba(0,0,0,1)",borderDash:void 0,borderDashOffset:0,borderTopLeftRadius:[0,0],borderTopRightRadius:[0,0],borderBottomRightRadius:[0,0],borderBottomLeftRadius:[0,0],bgcolor:"rgba(0,0,0,0)",paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0,boxSizing:"content-box",clipPath:void 0}),this[u]("anchor","size","border","borderRadius","padding")}get anchorX(){return this[a]("anchorX")}set anchorX(g){this[s]("anchorX",Object(i.toNumber)(g))}get anchorY(){return this[a]("anchorY")}set anchorY(g){this[s]("anchorY",Object(i.toNumber)(g))}get anchor(){return[this.anchorX,this.anchorY]}set anchor(g){g=Object(i.toArray)(g),Array.isArray(g)||(g=[g,g]),this.anchorX=g[0],this.anchorY=g[1]}get width(){return this[a]("width")}set width(g){this[s]("width",Object(i.toNumber)(g))}get height(){return this[a]("height")}set height(g){this[s]("height",Object(i.toNumber)(g))}get size(){return[this.width,this.height]}set size(g){g=Object(i.toArray)(g),Array.isArray(g)||(g=[g,g]),this.width=g[0],this.height=g[1]}get borderWidth(){return this[a]("borderWidth")}set borderWidth(g){this[s]("borderWidth",Object(i.toNumber)(g))}get borderColor(){return this[a]("borderColor")}set borderColor(g){this[s]("borderColor",Object(o.parseColor)(g))}get border(){return[this.borderWidth,this.borderColor]}set border(g){g=Object(i.toArray)(g),Array.isArray(g)||(g=[g]),this.borderWidth=g[0],g[1]!=null&&(this.borderColor=g[1])}get borderDash(){return this[a]("borderDash")}set borderDash(g){g=Object(i.toArray)(g,!0),g!=null&&!Array.isArray(g)&&(g=[g]),this[s]("borderDash",g?g.map(i.toNumber):null)}get borderDashOffset(){return this[a]("borderDashOffset")}set borderDashOffset(g){this[s]("borderDashOffset",Object(i.toNumber)(g))}get borderTopLeftRadius(){return this[a]("borderTopLeftRadius")}set borderTopLeftRadius(g){g=Object(i.toArray)(g,!0),Array.isArray(g)||(g=[g,g]),this[s]("borderTopLeftRadius",g.map(i.toNumber))}get borderTopRightRadius(){return this[a]("borderTopRightRadius")}set borderTopRightRadius(g){g=Object(i.toArray)(g,!0),Array.isArray(g)||(g=[g,g]),this[s]("borderTopRightRadius",g.map(i.toNumber))}get borderBottomRightRadius(){return this[a]("borderBottomRightRadius")}set borderBottomRightRadius(g){g=Object(i.toArray)(g,!0),Array.isArray(g)||(g=[g,g]),this[s]("borderBottomRightRadius",g.map(i.toNumber))}get borderBottomLeftRadius(){return this[a]("borderBottomLeftRadius")}set borderBottomLeftRadius(g){g=Object(i.toArray)(g,!0),Array.isArray(g)||(g=[g,g]),this[s]("borderBottomLeftRadius",g.map(i.toNumber))}get borderRadius(){return[...this.borderTopLeftRadius,...this.borderTopRightRadius,...this.borderBottomRightRadius,...this.borderBottomLeftRadius]}set borderRadius(g){if(g=Object(i.toArray)(g),!Array.isArray(g))g=Array(8).fill(g);else if(g.length===2)g=[g[0],g[1],g[0],g[1],g[0],g[1],g[0],g[1]];else if(g.length===4)g=[g[0],g[1],g[2],g[3],g[0],g[1],g[2],g[3]];else if(g.length===6)g=[g[0],g[1],g[2],g[3],g[4],g[5],g[2],g[3]];else if(g.length!==8)throw new TypeError("Invalid borderRadius value.");this.borderTopLeftRadius=[g[0],g[1]],this.borderTopRightRadius=[g[2],g[3]],this.borderBottomRightRadius=[g[4],g[5]],this.borderBottomLeftRadius=[g[6],g[7]]}get bgcolor(){return this[a]("bgcolor")}set bgcolor(g){this[s]("bgcolor",Object(o.parseColor)(g))}get paddingTop(){return this[a]("paddingTop")}set paddingTop(g){this[s]("paddingTop",Object(i.toNumber)(g))}get paddingRight(){return this[a]("paddingRight")}set paddingRight(g){this[s]("paddingRight",Object(i.toNumber)(g))}get paddingBottom(){return this[a]("paddingBottom")}set paddingBottom(g){this[s]("paddingBottom",Object(i.toNumber)(g))}get paddingLeft(){return this[a]("paddingLeft")}set paddingLeft(g){this[s]("paddingLeft",Object(i.toNumber)(g))}get padding(){return[this.paddingTop,this.paddingRight,this.paddingBottom,this.paddingLeft]}set padding(g){g=Object(i.toArray)(g),Array.isArray(g)?g.length===2?g=[g[0],g[1],g[0],g[1]]:g.length===3&&(g=[g[0],g[1],g[2],g[1]]):g=[g,g,g,g],this.paddingTop=g[0],this.paddingRight=g[1],this.paddingBottom=g[2],this.paddingLeft=g[3]}get clipPath(){return this[a]("clipPath")}set clipPath(g){this[s]("clipPath",g)}get boxSizing(){return this[a]("boxSizing")}set boxSizing(g){if(g!=null&&g!=="border-box"&&g!=="content-box")throw new TypeError("Invalid boxSizing type.");this[s]("boxSizing",g)}}},function(n,t,e){e.r(t),e.d(t,"Gradient",function(){return o}),e.d(t,"isTransparent",function(){return s}),e.d(t,"parseColor",function(){return a}),e.d(t,"setFillColor",function(){return u}),e.d(t,"setStrokeColor",function(){return p}),e.d(t,"Color",function(){return c});var r=e(32),i=e.n(r);e(1).glMatrix.setMatrixArrayType(Array);class o{constructor({vector:v,colors:I}){if(!Array.isArray(v)||v.length!==4&&v.length!==6&&v.length!==3)throw new TypeError("Invalid gradient");this.vector=v,this.colors=I.map(({offset:w,color:y})=>({offset:w,color:a(y)}))}toString(){return JSON.stringify({vector:this.vector,colors:this.colors})}}function s(g){return g instanceof o?!1:g==null?!0:i()(g)[3]===0}function a(g){if(g==null||(g||(g="transparent"),g instanceof o))return g;const v=i()(g);if(!v||!v.length)throw new TypeError("Invalid color value.");return`rgba(${v.join()})`}function l(g,v,I){const w=g.boundingBox[0];if(I.vector){let{vector:y,colors:T}=I;y.length===4?(y=[y[0]+w[0],y[1]+w[1],y[2]+w[0],y[3]+w[1]],g.setLinearGradient({vector:y,colors:T,type:v})):y.length===3?(y=[y[0]+w[0],y[1]+w[1],y[2]],g.setCircularGradient({vector:y,colors:T,type:v})):(y=[y[0]+w[0],y[1]+w[1],y[2],y[3]+w[0],y[4]+w[1],y[5]],g.setRadialGradient({vector:y,colors:T,type:v}))}else g.gradient&&g.gradient[v]&&(delete g.gradient[v],delete g.uniforms.u_radialGradientVector)}function u(g,{color:v,rule:I="nonzero"}){return l(g,"fill",v),v.vector||g.setFill({color:v,rule:I}),g}function p(g,{color:v,lineWidth:I,lineCap:w,lineJoin:y,lineDash:T,lineDashOffset:h,miterLimit:m,roundSegments:d}){l(g,"stroke",v),v.vector&&(v=[0,0,0,1]),g.setStroke({color:v,thickness:I,cap:w,join:y,miterLimit:m,lineDash:T,lineDashOffset:h,roundSegments:d})}class c extends Array{constructor(v=0,I=0,w=0,y=0){return Array.isArray(v)&&([v,I,w,y]=v),typeof v=="string"&&([v,I,w,y]=i()(v),v/=255,I/=255,w/=255),super(v,I,w,y),this}get r(){return Math.round(this[0]*255)}set r(v){this[0]=v/255}get g(){return Math.round(this[1]*255)}set g(v){this[1]=v/255}get b(){return Math.round(this[2]*255)}set b(v){this[2]=v/255}get a(){return this[3]}set a(v){this[3]=v}get hex(){const v=`0${this.r.toString(16)}`.slice(-2),I=`0${this.g.toString(16)}`.slice(-2),w=`0${this.b.toString(16)}`.slice(-2);let y;return this.a<1&&(y=Math.round(this[3]*255),y=`0${y.toString(16)}`.slice(-2)),`#${v}${I}${w}${y||""}`}get rgba(){return`rgba(${this.r},${this.g},${this.b},${this.a})`}fromColor(v){return typeof v=="string"&&(v=i()(v),v[0]/=255,v[1]/=255,v[2]/=255),this[0]=v[0],this[1]=v[1],this[2]=v[2],this[3]=v[3],this}}},function(n,t,e){e.r(t),e.d(t,"createRadiusBox",function(){return i}),e(1).glMatrix.setMatrixArrayType(Array);function r(o,s,a,l,u,p="leftTop"){const c=.5522848,g=l/2*c,v=u/2*c,I=s+l,w=a+u,y=s+l/2,T=a+u/2;p==="leftTop"?(o.moveTo(s,T),o.bezierCurveTo(s,T-v,y-g,a,y,a)):p==="rightTop"?o.bezierCurveTo(y+g,a,I,T-v,I,T):p==="rightBottom"?o.bezierCurveTo(I,T+v,y+g,w,y,w):p==="leftBottom"&&o.bezierCurveTo(y-g,w,s,T+v,s,T)}function i(o,[s,a,l,u],p){if(!p||Array.isArray(p)&&p.every(c=>c===0))o.beginPath(),o.rect(s,a,l,u);else{typeof p=="number"&&(p=Array(8).fill(p));const[c,g,v,I,w,y,T,h]=p.map((m,d)=>d%2?Math.min(m,u/2):Math.min(m,l/2));o.beginPath(),o.moveTo(s,a+g),r(o,s,a,c*2,g*2,"leftTop"),o.lineTo(s+l-v,a),r(o,s+l-v*2,a,v*2,I*2,"rightTop"),o.lineTo(s+l,a+u-y),r(o,s+l-w*2,a+u-y*2,w*2,y*2,"rightBottom"),o.lineTo(s+T,a+u),r(o,s,a+u-h*2,T*2,h*2,"leftBottom"),o.closePath()}return o}},function(n,t,e){e.r(t),e(1).glMatrix.setMatrixArrayType(Array),t.default=function(r,i){if(!r)return{x:0,y:0,width:0,height:0,left:0,top:0,right:0,bottom:0};const[[o,s],[a,l]]=r,u=o*i[0]+s*i[2]+i[4],p=o*i[1]+s*i[3]+i[5],c=a*i[0]+s*i[2]+i[4],g=a*i[1]+s*i[3]+i[5],v=a*i[0]+l*i[2]+i[4],I=a*i[1]+l*i[3]+i[5],w=o*i[0]+l*i[2]+i[4],y=o*i[1]+l*i[3]+i[5],T=Math.min(u,c,v,w),h=Math.min(p,g,I,y),m=Math.max(u,c,v,w),d=Math.max(p,g,I,y);return{x:T,y:h,width:m-T,height:d-h,left:T,top:h,right:m,bottom:d}}},function(n,t,e){e.r(t),e.d(t,"default",function(){return u});var r=e(218),i=e(219),o=e(225),s=e(213);e(1).glMatrix.setMatrixArrayType(Array);function a(p,c,g){return c in p?Object.defineProperty(p,c,{value:g,enumerable:!0,configurable:!0,writable:!0}):p[c]=g,p}const l=Symbol("textureTask");class u extends i.default{constructor(c={}){typeof c=="string"&&(c={texture:c}),super(c)}get contentSize(){let[c,g]=super.contentSize;const{width:v,height:I}=this.attributes;if(v==null||I==null){const w=this.textureImage,y=this.attributes.textureRect,T=this.attributes.sourceRect;if(y)v==null&&(c=y[0]+y[2]),I==null&&(g=y[1]+y[3]);else if(T){const h=this.layer?this.layer.displayRatio:1;v==null&&(c=T[2]/h),I==null&&(g=T[3]/h)}else if(w){const h=this.layer?this.layer.displayRatio:1;v==null&&(c=w.width/h),I==null&&(g=w.height/h)}}return[c,g]}get textureImageReady(){return this[l]||Promise.resolve()}draw(c=[]){super.draw(c);const g=this.mesh;return g&&Object(r.drawTexture)(this,g),c}onPropertyChange(c,g,v){if(super.onPropertyChange(c,g,v),c==="texture"&&(this[l]=Object(r.applyTexture)(this,g,!0)),c==="textureRect"){const{width:I,height:w}=this.attributes;(I==null||w==null)&&this.updateContours()}}}a(u,"Attr",o.default),s.default.registerNode(u,"sprite")},function(n,t,e){e.r(t),e.d(t,"default",function(){return a});var r=e(220);e(1).glMatrix.setMatrixArrayType(Array);const i=Symbol.for("spritejs_setAttributeDefault"),o=Symbol.for("spritejs_setAttribute"),s=Symbol.for("spritejs_getAttribute");class a extends r.default{constructor(u){super(u),this[i]({texture:void 0,textureRect:void 0,textureRepeat:!1,sourceRect:void 0})}get texture(){return this[s]("texture")}set texture(u){this[o]("texture",u)}get textureRect(){return this[s]("textureRect")}set textureRect(u){this[o]("textureRect",u)}get sourceRect(){return this[s]("sourceRect")}set sourceRect(u){this[o]("sourceRect",u)}get textureRepeat(){return this[s]("textureRepeat")}set textureRepeat(u){this[o]("textureRepeat",!!u)}}},function(n,t,e){e.r(t),e.d(t,"default",function(){return I});var r=e(12),i=e(227),o=e.n(i),s=e(70),a=e(228),l=e(221),u=e(218),p=e(213),c=e(223);e(1).glMatrix.setMatrixArrayType(Array);function g(w,y,T){return y in w?Object.defineProperty(w,y,{value:T,enumerable:!0,configurable:!0,writable:!0}):w[y]=T,w}const v=Symbol("mesh");class I extends s.default{constructor(y={}){typeof y=="string"&&(y={d:y}),super(y),this.effects={d(T,h,m,d,M){const x=(m-d)/(M-d);if(x<=0)return T;if(x>=1)return h;const E=o.a._preprocessing(o.a.path2shapes(T),o.a.path2shapes(h)),P=o.a._lerp(...E,x)[0];return P.reduce((N,b)=>`${N}${b.slice(2).join(" ")} `,`M${P[0][0]} ${P[0][1]}C`).trim()}}}get isVisible(){return!!this.d}get mesh(){if(this.attributes.display==="none")return null;const y=this.path;if(y){let T=this[v];if(T)T.path!==y&&(T.contours=y.contours,T.path=y);else{T=new r.Mesh2D(this.path),T.path=y;const m=this.attributes.fillColor,d=this.attributes.fillRule;m&&Object(l.setFillColor)(T,{color:m,rule:d});const M=this.attributes.lineWidth,x=this.attributes.strokeColor;if(x&&M>0){const{lineCap:P,lineJoin:R,miterLimit:N,lineDash:b,lineDashOffset:j,roundSegments:O}=this.attributes;Object(l.setStrokeColor)(T,{color:x,lineWidth:M,lineCap:P,lineJoin:R,miterLimit:N,lineDash:b,lineDashOffset:j,roundSegments:O})}this[v]=T;const E=this.attributes.clipPath;E&&this[v].setClipPath(E)}const h=this.opacity;return T.getOpacity()!==h&&T.setOpacity(h),T.setTransform(...this.renderMatrix),T}return null}get originalContentRect(){if(this.path){const y=this.path.boundingBox;return[y[0][0],y[0][1],y[1][0]-y[0][0],y[1][1]-y[0][1]]}return[0,0,0,0]}get originalClientRect(){if(this.mesh){const y=this.mesh.boundingBox;return[y[0][0],y[0][1],y[1][0]-y[0][0],y[1][1]-y[0][1]]}return[0,0,0,0]}get originalClientCenter(){return this.mesh?this.mesh.boundingCenter:[0,0]}set d(y){this.attributes.d=y}get d(){return this.attributes.d}draw(y=[]){super.draw(y);const T=this.mesh;return T&&Object(u.drawTexture)(this,T),y}getBoundingClientRect(){let y=null;return this.mesh&&(y=this.mesh.boundingBox),Object(c.default)(y,this.renderMatrix)}getPathLength(){return this.mesh?this.mesh.getTotalLength():0}getPointAtLength(y){if(this.mesh){const T=this.mesh.getPointAtLength(y);if(T)return[T.x,T.y]}return[0,0]}onPropertyChange(y,T,h){if(super.onPropertyChange(y,T,h),(y==="d"||y==="normalize")&&this.updateContours(),this[v]&&(y==="fillColor"||y==="fillRule")){const{fillColor:m,fillRule:d}=this.attributes;Object(l.setFillColor)(this[v],{color:m,rule:d})}if(this[v]&&(y==="strokeColor"||y==="lineWidth"||y==="lineCap"||y==="lineJoin"||y==="lineDash"||y==="lineDashOffset"||y==="roundSegments")){const{strokeColor:m,lineWidth:d}=this.attributes;if(m&&d>0){const{lineCap:M,lineJoin:x,lineDash:E,lineDashOffset:P,miterLimit:R,roundSegments:N}=this.attributes;Object(l.setStrokeColor)(this[v],{color:m,lineCap:M,lineJoin:x,lineWidth:d,lineDash:E,lineDashOffset:P,miterLimit:R,roundSegments:N})}}this[v]&&y==="clipPath"&&this[v].setClipPath(T),y==="texture"&&Object(u.applyTexture)(this,T)}updateContours(){this.path=new r.Figure2D,this.path.addPath(this.attributes.d),this.attributes.normalize&&this.path.normalize(...this.path.boundingCenter)}}g(I,"Attr",a.default),p.default.registerNode(I,"path")},function(n,t,e){(function(r,i){n.exports=i()})(this,function(){var r=function(){function b(j,O){var L=[],k=!0,H=!1,Q=void 0;try{for(var _=j[Symbol.iterator](),st;!(k=(st=_.next()).done)&&(L.push(st.value),!(O&&L.length===O));k=!0);}catch(F){H=!0,Q=F}finally{try{!k&&_.return&&_.return()}finally{if(H)throw Q}}return L}return function(j,O){if(Array.isArray(j))return j;if(Symbol.iterator in Object(j))return b(j,O);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=Math.PI*2,o=function(j,O,L,k,H,Q,_){var st=j.x,F=j.y;st*=O,F*=L;var Z=k*st-H*F,tt=H*st+k*F;return{x:Z+Q,y:tt+_}},s=function(j,O){var L=1.3333333333333333*Math.tan(O/4),k=Math.cos(j),H=Math.sin(j),Q=Math.cos(j+O),_=Math.sin(j+O);return[{x:k-H*L,y:H+k*L},{x:Q+_*L,y:_-Q*L},{x:Q,y:_}]},a=function(j,O,L,k){var H=j*k-O*L<0?-1:1,Q=Math.sqrt(j*j+O*O),_=Math.sqrt(j*j+O*O),st=j*L+O*k,F=st/(Q*_);return F>1&&(F=1),F<-1&&(F=-1),H*Math.acos(F)},l=function(j,O,L,k,H,Q,_,st,F,Z,tt,ct){var at=Math.pow(H,2),dt=Math.pow(Q,2),it=Math.pow(tt,2),ft=Math.pow(ct,2),wt=at*dt-at*ft-dt*it;wt<0&&(wt=0),wt/=at*ft+dt*it,wt=Math.sqrt(wt)*(_===st?-1:1);var U=wt*H/Q*ct,Y=wt*-Q/H*tt,K=Z*U-F*Y+(j+L)/2,et=F*U+Z*Y+(O+k)/2,W=(tt-U)/H,$=(ct-Y)/Q,C=(-tt-U)/H,D=(-ct-Y)/Q,B=a(1,0,W,$),X=a(W,$,C,D);return st===0&&X>0&&(X-=i),st===1&&X<0&&(X+=i),[K,et,B,X]},u=function(j){var O=j.px,L=j.py,k=j.cx,H=j.cy,Q=j.rx,_=j.ry,st=j.xAxisRotation,F=st===void 0?0:st,Z=j.largeArcFlag,tt=Z===void 0?0:Z,ct=j.sweepFlag,at=ct===void 0?0:ct,dt=[];if(Q===0||_===0)return[];var it=Math.sin(F*i/360),ft=Math.cos(F*i/360),wt=ft*(O-k)/2+it*(L-H)/2,U=-it*(O-k)/2+ft*(L-H)/2;if(wt===0&&U===0)return[];Q=Math.abs(Q),_=Math.abs(_);var Y=Math.pow(wt,2)/Math.pow(Q,2)+Math.pow(U,2)/Math.pow(_,2);Y>1&&(Q*=Math.sqrt(Y),_*=Math.sqrt(Y));var K=l(O,L,k,H,Q,_,tt,at,it,ft,wt,U),et=r(K,4),W=et[0],$=et[1],C=et[2],D=et[3],B=Math.max(Math.ceil(Math.abs(D)/(i/4)),1);D/=B;for(var X=0;X<B;X++)dt.push(s(C,D)),C+=D;return dt.map(function(q){var rt=o(q[0],Q,_,ft,it,W,$),lt=rt.x,gt=rt.y,yt=o(q[1],Q,_,ft,it,W,$),xt=yt.x,Et=yt.y,St=o(q[2],Q,_,ft,it,W,$),Mt=St.x,Ct=St.y;return{x1:lt,y1:gt,x2:xt,y2:Et,x:Mt,y:Ct}})},p={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},c=/([astvzqmhlc])([^astvzqmhlc]*)/ig;function g(b){var j=[];return b.replace(c,function(O,L,k){var H=L.toLowerCase();for(k=I(k),H=="m"&&k.length>2&&(j.push([L].concat(k.splice(0,2))),H="l",L=L=="m"?"l":"L");;){if(k.length==p[H])return k.unshift(L),j.push(k);if(k.length<p[H])throw new Error("malformed path data");j.push([L].concat(k.splice(0,p[H])))}}),j}var v=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function I(b){var j=b.match(v);return j?j.map(Number):[]}function w(b){var j=b[0][0],O=b[0][1],L=j,k=O;return b.forEach(function(H){var Q=H[0],_=H[2],st=H[4],F=H[6],Z=H[1],tt=H[3],ct=H[5],at=H[7];j=Math.min(j,Q,_,st,F),O=Math.min(O,Z,tt,ct,at),L=Math.max(L,Q,_,st,F),k=Math.max(k,Z,tt,ct,at)}),[j,O,L,k]}function y(b,j){return Math.sqrt(Math.pow(b[0]-j[0],2)+Math.pow(b[1]-j[1],2))+Math.sqrt(Math.pow(b[2]-j[2],2)+Math.pow(b[3]-j[3],2))}function T(b,j){var O=b[0],L=b[2],k=b[4],H=b[6],Q=b[1],_=b[3],st=b[5],F=b[7],Z=j[0],tt=j[2],ct=j[4],at=j[6],dt=j[1],it=j[3],ft=j[5],wt=j[7];return Math.sqrt(Math.pow(Z-O,2)+Math.pow(dt-Q,2))+Math.sqrt(Math.pow(tt-L,2)+Math.pow(it-_,2))+Math.sqrt(Math.pow(ct-k,2)+Math.pow(ft-st,2))+Math.sqrt(Math.pow(at-H,2)+Math.pow(wt-F,2))}function h(b,j){var O=d(b.length),L=[];O.forEach(function(H){var Q=0,_=0;H.forEach(function(st){Q+=T(b[st],j[_++])}),L.push({index:H,distance:Q})}),L.sort(function(H,Q){return H.distance-Q.distance});var k=[];return L[0].index.forEach(function(H){k.push(b[H])}),k}function m(b,j){var O=M(b.length),L=[];O.forEach(function(H){var Q=0;H.forEach(function(_){Q+=y(w(b[_]),w(j[_]))}),L.push({index:H,distance:Q})}),L.sort(function(H,Q){return H.distance-Q.distance});var k=[];return L[0].index.forEach(function(H){k.push(b[H])}),k}function d(b){for(var j=[],O=0;O<b;O++){for(var L=[],k=0;k<b;k++){var H=k+O;H>b-1&&(H-=b),L[H]=k}j.push(L)}return j}function M(b){for(var j=[],O=0;O<b;O++)j.push(O);return x(j)}function x(b){var j=[],O=[];function L(k){var H,Q;for(H=0;H<k.length;H++)Q=k.splice(H,1)[0],O.push(Q),k.length==0&&j.push(O.slice()),L(k),k.splice(H,0,Q),O.pop();return j}return L(b)}var E={};E.parser=g,E.lerpCurve=function(b,j,O){return E.lerpPoints(b[0],b[1],j[0],j[1],O).concat(E.lerpPoints(b[2],b[3],j[2],j[3],O)).concat(E.lerpPoints(b[4],b[5],j[4],j[5],O)).concat(E.lerpPoints(b[6],b[7],j[6],j[7],O))},E.lerpPoints=function(b,j,O,L,k){return[b+(O-b)*k,j+(L-j)*k]},E.q2b=function(b,j,O,L,k,H){return[b,j,(b+2*O)/3,(j+2*L)/3,(k+2*O)/3,(H+2*L)/3,k,H]},E.path2shapes=function(b){for(var j=E.parser(b),O=0,L=0,k=0,H=j.length,Q=[],_=null,st=void 0,F=void 0,Z=void 0,tt=void 0,ct=void 0,at=void 0,dt=void 0;k<H;k++){var it=j[k],ft=it[0],wt=j[k-1];switch(ft){case"m":ct=Q.length,Q[ct]=[],_=Q[ct],O=O+it[1],L=L+it[2];break;case"M":ct=Q.length,Q[ct]=[],_=Q[ct],O=it[1],L=it[2];break;case"l":_.push([O,L,O,L,O,L,O+it[1],L+it[2]]),O+=it[1],L+=it[2];break;case"L":_.push([O,L,it[1],it[2],it[1],it[2],it[1],it[2]]),O=it[1],L=it[2];break;case"h":_.push([O,L,O,L,O,L,O+it[1],L]),O+=it[1];break;case"H":_.push([O,L,it[1],L,it[1],L,it[1],L]),O=it[1];break;case"v":_.push([O,L,O,L,O,L,O,L+it[1]]),L+=it[1];break;case"V":_.push([O,L,O,it[1],O,it[1],O,it[1]]),L=it[1];break;case"C":_.push([O,L,it[1],it[2],it[3],it[4],it[5],it[6]]),O=it[5],L=it[6];break;case"S":wt[0]==="C"||wt[0]==="c"?_.push([O,L,O+wt[5]-wt[3],L+wt[6]-wt[4],it[1],it[2],it[3],it[4]]):(wt[0]==="S"||wt[0]==="s")&&_.push([O,L,O+wt[3]-wt[1],L+wt[4]-wt[2],it[1],it[2],it[3],it[4]]),O=it[3],L=it[4];break;case"c":_.push([O,L,O+it[1],L+it[2],O+it[3],L+it[4],O+it[5],L+it[6]]),O=O+it[5],L=L+it[6];break;case"s":wt[0]==="C"||wt[0]==="c"?_.push([O,L,O+wt[5]-wt[3],L+wt[6]-wt[4],O+it[1],L+it[2],O+it[3],L+it[4]]):(wt[0]==="S"||wt[0]==="s")&&_.push([O,L,O+wt[3]-wt[1],L+wt[4]-wt[2],O+it[1],L+it[2],O+it[3],L+it[4]]),O=O+it[3],L=L+it[4];break;case"a":at=u({rx:it[1],ry:it[2],px:O,py:L,xAxisRotation:it[3],largeArcFlag:it[4],sweepFlag:it[5],cx:O+it[6],cy:L+it[7]}),dt=at[at.length-1],at.forEach(function(U,Y){Y===0?_.push([O,L,U.x1,U.y1,U.x2,U.y2,U.x,U.y]):_.push([at[Y-1].x,at[Y-1].y,U.x1,U.y1,U.x2,U.y2,U.x,U.y])}),O=dt.x,L=dt.y;break;case"A":at=u({rx:it[1],ry:it[2],px:O,py:L,xAxisRotation:it[3],largeArcFlag:it[4],sweepFlag:it[5],cx:it[6],cy:it[7]}),dt=at[at.length-1],at.forEach(function(U,Y){Y===0?_.push([O,L,U.x1,U.y1,U.x2,U.y2,U.x,U.y]):_.push([at[Y-1].x,at[Y-1].y,U.x1,U.y1,U.x2,U.y2,U.x,U.y])}),O=dt.x,L=dt.y;break;case"Q":_.push(E.q2b(O,L,it[1],it[2],it[3],it[4])),O=it[3],L=it[4];break;case"q":_.push(E.q2b(O,L,O+it[1],L+it[2],it[3]+O,it[4]+L)),O+=it[3],L+=it[4];break;case"T":wt[0]==="Q"||wt[0]==="q"?(Z=O+wt[3]-wt[1],tt=L+wt[4]-wt[2],_.push(E.q2b(O,L,Z,tt,it[1],it[2]))):(wt[0]==="T"||wt[0]==="t")&&(_.push(E.q2b(O,L,O+O-Z,L+L-tt,it[1],it[2])),Z=O+O-Z,tt=L+L-tt),O=it[1],L=it[2];break;case"t":wt[0]==="Q"||wt[0]==="q"?(Z=O+wt[3]-wt[1],tt=L+wt[4]-wt[2],_.push(E.q2b(O,L,Z,tt,O+it[1],L+it[2]))):(wt[0]==="T"||wt[0]==="t")&&(_.push(E.q2b(O,L,O+O-Z,L+L-tt,O+it[1],L+it[2])),Z=O+O-Z,tt=L+L-tt),O+=it[1],L+=it[2];break;case"Z":st=_[0][0],F=_[0][1],_.push([O,L,st,F,st,F,st,F]);break;case"z":st=_[0][0],F=_[0][1],_.push([O,L,st,F,st,F,st,F]);break}}return Q},E._upCurves=function(b,j){for(var O=0,L=0,k=b.length;O<j;O++)b.push(b[L].slice(0)),L++,L>k-1&&(L-=k)};function P(b,j,O,L,k,H,Q,_,st){return{left:R(b,j,O,L,k,H,Q,_,st),right:R(Q,_,k,H,O,L,b,j,1-st,!0)}}function R(b,j,O,L,k,H,Q,_,st,F){var Z=(O-b)*st+b,tt=(L-j)*st+j,ct=(k-O)*st+O,at=(H-L)*st+L,dt=(Q-k)*st+k,it=(_-H)*st+H,ft=(ct-Z)*st+Z,wt=(at-tt)*st+tt,U=(dt-ct)*st+ct,Y=(it-at)*st+at,K=(U-ft)*st+ft,et=(Y-wt)*st+wt;return F?[K,et,ft,wt,Z,tt,b,j]:[b,j,Z,tt,ft,wt,K,et]}E._splitCurves=function(b,j){for(var O=0,L=0;O<j;O++){var k=b[L],H=P(k[0],k[1],k[2],k[3],k[4],k[5],k[6],k[7],.5);b.splice(L,1),b.splice(L,0,H.left,H.right),L+=2,L>=b.length-1&&(L=0)}};function N(b,j){for(var O=function(H){var Q=b[b.length-1],_=[];Q.forEach(function(st){_.push(st.slice(0))}),b.push(_)},L=0;L<j;L++)O()}return E.lerp=function(b,j,O){return E._lerp(E.path2shapes(b),E.path2shapes(j),O)},E.MIM_CURVES_COUNT=100,E._preprocessing=function(b,j){var O=b.length,L=j.length,k=JSON.parse(JSON.stringify(b)),H=JSON.parse(JSON.stringify(j));return O>L?N(H,O-L):O<L&&N(k,L-O),k=m(k,H),k.forEach(function(Q,_){var st=Q.length,F=H[_].length;st>F?st<E.MIM_CURVES_COUNT?(E._splitCurves(Q,E.MIM_CURVES_COUNT-st),E._splitCurves(H[_],E.MIM_CURVES_COUNT-F)):E._splitCurves(H[_],st-F):st<F&&(F<E.MIM_CURVES_COUNT?(E._splitCurves(Q,E.MIM_CURVES_COUNT-st),E._splitCurves(H[_],E.MIM_CURVES_COUNT-F)):E._splitCurves(Q,F-st))}),k.forEach(function(Q,_){k[_]=h(Q,H[_])}),[k,H]},E._lerp=function(b,j,O){var L=[];return b.forEach(function(k,H){var Q=[];k.forEach(function(_,st){Q.push(E.lerpCurve(_,j[H][st],O))}),L.push(Q)}),L},E.animate=function(b){var j=E.path2shapes(b.from),O=E.path2shapes(b.to),L=E._preprocessing(j,O),k=new Date,H=b.end||function(){},Q=b.progress||function(){},_=b.begin||function(){},st=b.easing||function(at){return at},F=null,Z=null,tt=b.time;_(j);var ct=function at(){var dt=new Date-k;if(dt>=tt){Z=O,Q(Z,1),H(Z),cancelAnimationFrame(F);return}var it=st(dt/tt);Z=E._lerp(L[0],L[1],it),Q(Z,it),F=requestAnimationFrame(at)};ct()},E})},function(n,t,e){e.r(t),e.d(t,"default",function(){return u});var r=e(71),i=e(221),o=e(72);e(1).glMatrix.setMatrixArrayType(Array);const s=Symbol.for("spritejs_setAttributeDefault"),a=Symbol.for("spritejs_setAttribute"),l=Symbol.for("spritejs_getAttribute");class u extends r.default{constructor(c){super(c),this[s]({d:"",normalize:!1,fillColor:void 0,fillRule:"nonzero",strokeColor:void 0,lineWidth:1,lineJoin:"miter",lineCap:"butt",roundSegments:20,lineDash:void 0,lineDashOffset:0,miterLimit:10,texture:void 0,textureRect:void 0,textureRepeat:!1,sourceRect:void 0,clipPath:void 0})}get d(){return this[l]("d")}set d(c){this[a]("d",c)}get normalize(){return this[l]("normalize")}set normalize(c){this[a]("normalize",!!c)}get fillColor(){return this[l]("fillColor")}set fillColor(c){this[a]("fillColor",Object(i.parseColor)(c))}get fillRule(){return this[l]("fillRule")}set fillRule(c){if(c!=null&&c!=="nonzero"&&c!=="evenodd")throw new TypeError("Invalid fill rule.");this[a]("fillRule",c)}get strokeColor(){return this[l]("strokeColor")}set strokeColor(c){this[a]("strokeColor",Object(i.parseColor)(c))}get lineWidth(){return this[l]("lineWidth")}set lineWidth(c){this[a]("lineWidth",Object(o.toNumber)(c))}get lineJoin(){return this[l]("lineJoin")}set lineJoin(c){if(c!=null&&c!=="miter"&&c!=="bevel"&&c!=="round")throw new TypeError("Invalid lineJoin type.");this[a]("lineJoin",c)}get lineCap(){return this[l]("lineCap")}set lineCap(c){if(c!=null&&c!=="butt"&&c!=="square"&&c!=="round")throw new TypeError("Invalid lineCap type.");this[a]("lineCap",c)}get lineDash(){return this[l]("lineDash")}set lineDash(c){c=Object(o.toArray)(c,!0),c!=null&&!Array.isArray(c)&&(c=[c]),this[a]("lineDash",c?c.map(o.toNumber):null)}get lineDashOffset(){return this[l]("lineDashOffset")}set lineDashOffset(c){this[a]("lineDashOffset",Object(o.toNumber)(c))}get miterLimit(){return this[l]("miterLimit")}set miterLimit(c){this[a]("miterLimit",Object(o.toNumber)(c))}get roundSegments(){return this[l]("roundSegments")}set roundSegments(c){this[a]("roundSegments",c)}get texture(){return this[l]("texture")}set texture(c){this[a]("texture",c)}get textureRect(){return this[l]("textureRect")}set textureRect(c){this[a]("textureRect",c)}get sourceRect(){return this[l]("sourceRect")}set sourceRect(c){this[a]("sourceRect",c)}get textureRepeat(){return this[l]("textureRepeat")}set textureRepeat(c){this[a]("textureRepeat",!!c)}get clipPath(){return this[l]("clipPath")}set clipPath(c){this[a]("clipPath",c)}}},function(n,t,e){e.r(t),e.d(t,"default",function(){return a});var r=e(226),i=e(213),o=e(230);e(1).glMatrix.setMatrixArrayType(Array);function s(l,u,p){return u in l?Object.defineProperty(l,u,{value:p,enumerable:!0,configurable:!0,writable:!0}):l[u]=p,l}class a extends r.default{get isVisible(){const{width:u,height:p}=this.attributes;return u>0&&p>0&&super.isVisible}}s(a,"Attr",o.default),i.default.registerNode(a,"rect")},function(n,t,e){e.r(t),e.d(t,"default",function(){return p});var r=e(228),i=e(72);e(1).glMatrix.setMatrixArrayType(Array);const o=Symbol.for("spritejs_setAttributeDefault"),s=Symbol.for("spritejs_setAttribute"),a=Symbol.for("spritejs_getAttribute"),l=Symbol.for("spritejs_declareAlias");function u(c){const{width:g,height:v}=c;return`M0 0L${g} 0L${g} ${v}L0 ${v}Z`}class p extends r.default{constructor(g){super(g),this[o]({width:0,height:0}),this[l]("size")}get d(){return this[a]("d")}set d(g){}get width(){return this[a]("width")}set width(g){if(g=Object(i.toNumber)(g),this[s]("width",g)){const v=u(this);this[s]("d",v)}}get height(){return this[a]("height")}set height(g){if(g=Object(i.toNumber)(g),this[s]("height",g)){const v=u(this);this[s]("d",v)}}get size(){return[this.width,this.height]}set size(g){g=Object(i.toArray)(g),Array.isArray(g)||(g=[g,g]),this.width=g[0],this.height=g[1]}}},function(n,t,e){e.r(t),e.d(t,"default",function(){return a});var r=e(232),i=e(213),o=e(235);e(1).glMatrix.setMatrixArrayType(Array);function s(l,u,p){return u in l?Object.defineProperty(l,u,{value:p,enumerable:!0,configurable:!0,writable:!0}):l[u]=p,l}class a extends r.default{get isVisible(){const{sides:u}=this.attributes;return u[0]>0&&u[1]>0&&super.isVisible}}s(a,"Attr",o.default),i.default.registerNode(a,"triangle")},function(n,t,e){e.r(t),e.d(t,"default",function(){return a});var r=e(226),i=e(213),o=e(233);e(1).glMatrix.setMatrixArrayType(Array);function s(l,u,p){return u in l?Object.defineProperty(l,u,{value:p,enumerable:!0,configurable:!0,writable:!0}):l[u]=p,l}class a extends r.default{get isVisible(){const{points:u}=this.attributes;return u.length>0&&super.isVisible}}s(a,"Attr",o.default),i.default.registerNode(a,"polyline")},function(n,t,e){e.r(t),e.d(t,"default",function(){return c});var r=e(228),i=e(72),o=e(234);e(1).glMatrix.setMatrixArrayType(Array);const s=Symbol.for("spritejs_setAttributeDefault"),a=Symbol.for("spritejs_setAttribute"),l=Symbol.for("spritejs_getAttribute"),u=Symbol.for("spritejs_declareAlias");function p(g){const{points:v,smooth:I,smoothRange:w,close:y}=g,T=[];for(let m=0;m<v.length;m+=2)T.push([v[m],v[m+1]]);let h="";return I?h=Object(o.makeSmoothCurveLine)(T,w):T.length&&(h=`M${T.map(m=>m.join(" ")).join("L")}`),h&&y&&(h+="Z"),h}class c extends r.default{constructor(v){super(v),this[s]({points:[],smooth:!1,smoothRange:[0],closeType:"none"}),this[u]("close")}get d(){return this[l]("d")}set d(v){}get close(){return this.closeType!=="none"}set close(v){v=v?"normal":"none",this.closeType=v}get closeType(){return this[l]("closeType")}set closeType(v){if(v!=null&&v!=="none"&&v!=="normal")throw new TypeError("Invalid closeType type.");if(this[a]("closeType",v)){const I=p(this);this[a]("d",I)}}get smooth(){return this[l]("smooth")}set smooth(v){if(this[a]("smooth",v)){const I=p(this);this[a]("d",I)}}get smoothRange(){return this[l]("smoothRange")}set smoothRange(v){if(v&&!Array.isArray(v)&&(v=[v]),this[a]("smoothRange",v)&&this.smooth){const I=p(this);this[a]("d",I)}}get points(){return this[l]("points")}set points(v){if(v=Object(i.toArray)(v),Array.isArray(v)&&(v=v.reduce((I,w)=>Array.isArray(w)?[...I,...w.map(y=>Object(i.toNumber)(y))]:[...I,Object(i.toNumber)(w)],[])),this[a]("points",v)){const I=p(this);this[a]("d",I)}}}},function(n,t,e){e.r(t),e.d(t,"makeSmoothCurveLine",function(){return r}),e(1).glMatrix.setMatrixArrayType(Array);function r(i,o=[0]){function s(u,p=.168,c=.168){let g,v,I,w;if((i[u].x===i[u+1].x||i[u].y===i[u+1].y)&&(p=0,c=0),u<1?(g=i[0].x+(i[1].x-i[0].x)*p,v=i[0].y+(i[1].y-i[0].y)*p):(g=i[u].x+(i[u+1].x-i[u-1].x)*p,v=i[u].y+(i[u+1].y-i[u-1].y)*p),u>i.length-3){const y=i.length-1;I=i[y].x-(i[y].x-i[y-1].x)*c,w=i[y].y-(i[y].y-i[y-1].y)*c}else I=i[u+1].x-(i[u+2].x-i[u].x)*c,w=i[u+1].y-(i[u+2].y-i[u].y)*c;return[{x:g,y:v},{x:I,y:w}]}i=i.map(([u,p])=>({x:u,y:p}));let a="",l=0;return i.forEach((u,p)=>{if(p===0)a+=`M${u.x} ${u.y}`;else{for(;p>o[l];)l++;if(l%2){const[c,g]=s(p-1);a+=`C${[c.x,c.y,g.x,g.y,u.x,u.y].join(" ")}`}else a+=`L${u.x} ${u.y}`}}),a}},function(n,t,e){e.r(t),e.d(t,"default",function(){return u});var r=e(233),i=e(72);e(1).glMatrix.setMatrixArrayType(Array);const o=Symbol.for("spritejs_setAttributeDefault"),s=Symbol.for("spritejs_setAttribute"),a=Symbol.for("spritejs_getAttribute");function l(p){const[c,g]=p.sides;let v=p.angle%360;return v<0&&(v+=360),v=Math.PI*v/180,[0,0,c,0,g*Math.cos(v),g*Math.sin(v)]}class u extends r.default{constructor(c){super(c),this[o]({sides:[0,0],angle:60,closeType:"normal"})}get points(){return super.points}set points(c){}get sides(){return this[a]("sides")}set sides(c){if(c=Object(i.toArray)(c,!0),c!=null&&!Array.isArray(c)&&(c=[c,c]),this[s]("sides",c)){const g=l(this);super.points=g}}get angle(){return this[a]("angle")}set angle(c){if(c=Object(i.toNumber)(c),this[s]("angle",c)){const g=l(this);super.points=g}}}},function(n,t,e){e.r(t),e.d(t,"default",function(){return a});var r=e(232),i=e(213),o=e(237);e(1).glMatrix.setMatrixArrayType(Array);function s(l,u,p){return u in l?Object.defineProperty(l,u,{value:p,enumerable:!0,configurable:!0,writable:!0}):l[u]=p,l}class a extends r.default{get isVisible(){const{sides:u}=this.attributes;return u[0]>0&&u[1]>0&&super.isVisible}}s(a,"Attr",o.default),i.default.registerNode(a,"parallel")},function(n,t,e){e.r(t),e.d(t,"default",function(){return u});var r=e(233),i=e(72);e(1).glMatrix.setMatrixArrayType(Array);const o=Symbol.for("spritejs_setAttributeDefault"),s=Symbol.for("spritejs_setAttribute"),a=Symbol.for("spritejs_getAttribute");function l(p){const[c,g]=p.sides;let v=p.angle%360;v<0&&(v+=360),v=Math.PI*v/180;const I=g*Math.cos(v),w=g*Math.sin(v);return[0,0,c,0,I+c,w,I,w]}class u extends r.default{constructor(c){super(c),this[o]({sides:[0,0],angle:90,closeType:"normal"})}get points(){return super.points}set points(c){}get sides(){return this[a]("sides")}set sides(c){if(c=Object(i.toArray)(c,!0),c!=null&&!Array.isArray(c)&&(c=[c,c]),this[s]("sides",c)){const g=l(this);super.points=g}}get angle(){return this[a]("angle")}set angle(c){if(c=Object(i.toNumber)(c),this[s]("angle",c)){const g=l(this);super.points=g}}}},function(n,t,e){e.r(t),e.d(t,"default",function(){return a});var r=e(232),i=e(213),o=e(239);e(1).glMatrix.setMatrixArrayType(Array);function s(l,u,p){return u in l?Object.defineProperty(l,u,{value:p,enumerable:!0,configurable:!0,writable:!0}):l[u]=p,l}class a extends r.default{}s(a,"Attr",o.default),i.default.registerNode(a,"regular")},function(n,t,e){e.r(t),e.d(t,"default",function(){return u});var r=e(233),i=e(72);e(1).glMatrix.setMatrixArrayType(Array);const o=Symbol.for("spritejs_setAttributeDefault"),s=Symbol.for("spritejs_setAttribute"),a=Symbol.for("spritejs_getAttribute");function l(p){const{edges:c,radius:g,offsetAngle:v}=p,I=Math.PI*v/180-.5*Math.PI;if(c<3||g<=0)return[];const w=[];for(let y=0;y<c;y++){const T=y*2*Math.PI/c+I,h=g*Math.cos(T),m=g*Math.sin(T);w.push(h,m)}return w}class u extends r.default{constructor(c){super(c),this[o]({edges:3,radius:0,offsetAngle:0,closeType:"normal"})}get points(){return super.points}set points(c){}get edges(){return this[a]("edges")}set edges(c){if(c=Object(i.toNumber)(c),this[s]("edges",c)){const g=l(this);super.points=g}}get radius(){return this[a]("radius")}set radius(c){if(c=Object(i.toNumber)(c),this[s]("radius",c)){const g=l(this);super.points=g}}get offsetAngle(){return this[a]("offsetAngle")}set offsetAngle(c){if(c=Object(i.toNumber)(c),this[s]("offsetAngle",c)){const g=l(this);super.points=g}}}},function(n,t,e){e.r(t),e.d(t,"default",function(){return a});var r=e(232),i=e(213),o=e(241);e(1).glMatrix.setMatrixArrayType(Array);function s(l,u,p){return u in l?Object.defineProperty(l,u,{value:p,enumerable:!0,configurable:!0,writable:!0}):l[u]=p,l}class a extends r.default{}s(a,"Attr",o.default),i.default.registerNode(a,"star")},function(n,t,e){e.r(t),e.d(t,"default",function(){return u});var r=e(233),i=e(72);e(1).glMatrix.setMatrixArrayType(Array);const o=Symbol.for("spritejs_setAttributeDefault"),s=Symbol.for("spritejs_setAttribute"),a=Symbol.for("spritejs_getAttribute");function l(p){const{angles:c,innerRadius:g,outerRadius:v,offsetAngle:I}=p,w=Math.PI*I/180-.5*Math.PI;if(c<3||g<=0||v<=0)return[];const y=[];for(let T=0;T<c*2;T++){const h=T*Math.PI/c+w,m=T%2?g:v,d=m*Math.cos(h),M=m*Math.sin(h);y.push(d,M)}return y}class u extends r.default{constructor(c){super(c),this[o]({angles:5,innerRadius:0,outerRadius:0,offsetAngle:0,closeType:"normal"})}get points(){return super.points}set points(c){}get angles(){return this[a]("angles")}set angles(c){if(c=Object(i.toNumber)(c),this[s]("angles",c)){const g=l(this);super.points=g}}get innerRadius(){return this[a]("innerRadius")}set innerRadius(c){if(c=Object(i.toNumber)(c),this[s]("innerRadius",c)){const g=l(this);super.points=g}}get outerRadius(){return this[a]("outerRadius")}set outerRadius(c){if(c=Object(i.toNumber)(c),this[s]("outerRadius",c)){const g=l(this);super.points=g}}get radius(){return[this.innerRadius,this.outerRadius]}set radius(c){c=Object(i.toArray)(c,!0),Array.isArray(c)||(c=[c,c]),this.innerRadius=c[0],this.outerRadius=c[1]}get offsetAngle(){return this[a]("offsetAngle")}set offsetAngle(c){if(c=Object(i.toNumber)(c),this[s]("offsetAngle",c)){const g=l(this);super.points=g}}}},function(n,t,e){e.r(t),e.d(t,"default",function(){return a});var r=e(226),i=e(213),o=e(243);e(1).glMatrix.setMatrixArrayType(Array);function s(l,u,p){return u in l?Object.defineProperty(l,u,{value:p,enumerable:!0,configurable:!0,writable:!0}):l[u]=p,l}class a extends r.default{get isVisible(){const{radiusX:u,radiusY:p,startAngle:c,endAngle:g}=this.attributes;return u>0&&p>0&&c!==g&&super.isVisible}}s(a,"Attr",o.default),i.default.registerNode(a,"ellipse")},function(n,t,e){e.r(t),e.d(t,"default",function(){return c});var r=e(12),i=e(228),o=e(72);e(1).glMatrix.setMatrixArrayType(Array);const s=Symbol.for("spritejs_setAttributeDefault"),a=Symbol.for("spritejs_setAttribute"),l=Symbol.for("spritejs_getAttribute"),u=Symbol.for("spritejs_declareAlias");function p(g){const{radiusX:v,radiusY:I,startAngle:w,endAngle:y,direction:T,closeType:h}=g,m=T==="anitclockwise",d=new r.Figure2D;return h==="sector"&&d.moveTo(0,0),d.ellipse(0,0,v,I,0,Math.PI*w/180,Math.PI*y/180,m),h!=="none"&&d.closePath(),d.path.reduce((E,P)=>E+P.join(" "),"")}class c extends i.default{constructor(v){super(v),this[s]({radiusX:0,radiusY:0,startAngle:0,endAngle:360,direction:"clockwise",closeType:"none"}),this[u]("radius","angle")}get d(){return this[l]("d")}set d(v){}get radiusX(){return this[l]("radiusX")}set radiusX(v){if(v=Object(o.toNumber)(v),this[a]("radiusX",v)){const I=p(this);this[a]("d",I)}}get radiusY(){return this[l]("radiusY")}set radiusY(v){if(v=Object(o.toNumber)(v),this[a]("radiusY",v)){const I=p(this);this[a]("d",I)}}get radius(){return[this.radiusX,this.radiusY]}set radius(v){v=Object(o.toArray)(v,!0),Array.isArray(v)||(v=[v,v]),this.radiusX=v[0],this.radiusY=v[1]}get angle(){return[this.startAngle,this.endAngle]}set angle(v){v=Object(o.toArray)(v),Array.isArray(v)||(v=[v,v]),this.startAngle=v[0],this.endAngle=v[1]}get direction(){return this[l]("direction")}set direction(v){if(v!=null&&v!=="clockwise"&&v!=="anticlockwise")throw new TypeError("Invalid direction type.");this[a]("direction",v)}get startAngle(){return this[l]("startAngle")}set startAngle(v){if(v=Object(o.toNumber)(v),this[a]("startAngle",v)){const I=p(this);this[a]("d",I)}}get endAngle(){return this[l]("endAngle")}set endAngle(v){if(v=Object(o.toNumber)(v),this[a]("endAngle",v)){const I=p(this);this[a]("d",I)}}get closeType(){return this[l]("closeType")}set closeType(v){if(v!=null&&v!=="none"&&v!=="sector"&&v!=="normal")throw new TypeError("Invalid closeType type.");if(this[a]("closeType",v)){const I=p(this);this[a]("d",I)}}}},function(n,t,e){e.r(t),e.d(t,"default",function(){return a});var r=e(242),i=e(213),o=e(245);e(1).glMatrix.setMatrixArrayType(Array);function s(l,u,p){return u in l?Object.defineProperty(l,u,{value:p,enumerable:!0,configurable:!0,writable:!0}):l[u]=p,l}class a extends r.default{}s(a,"Attr",o.default),i.default.registerNode(a,"arc")},function(n,t,e){e.r(t),e.d(t,"default",function(){return o});var r=e(243),i=e(72);e(1).glMatrix.setMatrixArrayType(Array);class o extends r.default{get radius(){return super.radiusX}set radius(a){a=Object(i.toNumber)(a),super.radiusX=a,super.radiusY=a}}},function(n,t,e){e.r(t),e.d(t,"default",function(){return a});var r=e(226),i=e(213),o=e(247);e(1).glMatrix.setMatrixArrayType(Array);function s(l,u,p){return u in l?Object.defineProperty(l,u,{value:p,enumerable:!0,configurable:!0,writable:!0}):l[u]=p,l}class a extends r.default{get isVisible(){const{innerRadius:u,outerRadius:p,startAngle:c,endAngle:g}=this.attributes;return(u>0||p>0)&&c!==g&&super.isVisible}}s(a,"Attr",o.default),i.default.registerNode(a,"ring")},function(n,t,e){e.r(t),e.d(t,"default",function(){return c});var r=e(12),i=e(228),o=e(72);e(1).glMatrix.setMatrixArrayType(Array);const s=Symbol.for("spritejs_setAttributeDefault"),a=Symbol.for("spritejs_setAttribute"),l=Symbol.for("spritejs_getAttribute"),u=Symbol.for("spritejs_declareAlias");function p(g){let{innerRadius:v,outerRadius:I,startAngle:w,endAngle:y}=g;const T=new r.Figure2D;if(w=Math.PI*w/180,y=Math.PI*y/180,v>I&&([v,I]=[I,v]),v<=0&&T.moveTo(0,0),T.arc(0,0,I,w,y,!1),v>0){const d=Math.PI*2;y<w&&(y=w+d+(y-w)%d),y-w>=d&&(y=w+d-1e-6),T.arc(0,0,v,y,w,!0)}return T.closePath(),T.path.reduce((d,M)=>d+M.join(" "),"")}class c extends i.default{constructor(v){super(v),this[s]({innerRadius:0,outerRadius:0,startAngle:0,endAngle:360}),this[u]("radius","angle")}get d(){return this[l]("d")}set d(v){}get innerRadius(){return this[l]("innerRadius")}set innerRadius(v){if(v=Object(o.toNumber)(v),this[a]("innerRadius",v)){const I=p(this);this[a]("d",I)}}get outerRadius(){return this[l]("outerRadius")}set outerRadius(v){if(v=Object(o.toNumber)(v),this[a]("outerRadius",v)){const I=p(this);this[a]("d",I)}}get radius(){return[this.innerRadius,this.outerRadius]}set radius(v){v=Object(o.toArray)(v,!0),Array.isArray(v)||(v=[v,v]),this.innerRadius=v[0],this.outerRadius=v[1]}get startAngle(){return this[l]("startAngle")}set startAngle(v){if(v=Object(o.toNumber)(v),this[a]("startAngle",v)){const I=p(this);this[a]("d",I)}}get endAngle(){return this[l]("endAngle")}set endAngle(v){if(v=Object(o.toNumber)(v),this[a]("endAngle",v)){const I=p(this);this[a]("d",I)}}get angle(){return[this.startAngle,this.endAngle]}set angle(v){v=Object(o.toArray)(v),Array.isArray(v)||(v=[v,v]),this.startAngle=v[0],this.endAngle=v[1]}}},function(n,t,e){e.r(t),e.d(t,"default",function(){return I});var r=e(12),i=e(218),o=e(219),s=e(249),a=e(213);e(1).glMatrix.setMatrixArrayType(Array);function l(w,y,T){return y in w?Object.defineProperty(w,y,{value:T,enumerable:!0,configurable:!0,writable:!0}):w[y]=T,w}const u=Symbol("textImage"),p=Symbol("textImageTask"),c=Symbol("textureContext"),g=Symbol("updateTextureRect"),v=Symbol("textCanvas");class I extends o.default{constructor(y={}){typeof y=="string"&&(y={text:y}),super(y)}get contentSize(){let[y,T]=super.contentSize;const{width:h,height:m}=this.attributes;if(h==null||m==null){const d=this[u];d&&(h==null&&(y=d.rect[2]),m==null&&(T=d.rect[3]))}return[y,T]}get text(){return this.attributes.text}set text(y){this.attributes.text=y}get textContent(){return this.attributes.text}set textContent(y){this.attributes.text=y}get textImage(){return this[u]||{}}get textImageReady(){return this[p]||Promise.resolve()}draw(y){super.draw(y);const T=this.mesh;if(T){const h=this[u];if(h){let m=T.texture;if(!m||this[c]&&this[c]!==this.renderer||h.needsUpdate?(h.needsUpdate=!1,Object(i.deleteTexture)(h.image,this.renderer),m=Object(i.createTexture)(h.image,this.renderer),this[g]=!0):m=T.uniforms.u_texSampler,this[g]){const[d,M]=h.rect.slice(2),[x,E]=this.contentSize,P=this.attributes.textAlign,R=this.attributes.verticalAlign;let N=0;P==="center"?N=(x-d)/2:(P==="right"||P==="end")&&(N=x-d);const b=this.attributes.fontSize,j=this.attributes.lineHeight;let O=0;R==="top"?O=(b-j)/2:R==="bottom"&&(O=(j-b)/2);const{paddingLeft:L,paddingTop:k}=this.attributes,{borderWidth:H}=this.attributes;N+=L+H,O+=k+H;const{anchorX:Q,anchorY:_}=this.attributes;N-=this.offsetSize[0]*Q,O-=this.offsetSize[1]*_,T.setTexture(m,{rect:[N,O,d,M]}),this[g]=!1,this[c]=this.renderer}}}return y}onPropertyChange(y,T,h){y==="text"||y==="fontSize"||y==="fontFamily"||y==="fontStyle"||y==="fontVariant"||y==="fontWeight"||y==="fontStretch"||y==="lineHeight"||y==="strokeColor"||y==="fillColor"||y==="strokeWidth"?this.updateText():((y==="textAlign"||y==="verticalAlign")&&(this[g]=!0),super.onPropertyChange(y,T,h))}updateContours(){super.updateContours(),this[g]=!0}updateText(){this[p]||(this[p]=Promise.resolve().then(()=>{this[p]=null;const{text:y,font:T,fillColor:h,strokeColor:m,strokeWidth:d}=this.attributes,M=this.layer?this.layer.displayRatio:1;return this[v]=this[v]||r.ENV.createCanvas(1,1),this[u]=r.ENV.createText(y,{font:T,fillColor:h,strokeColor:m,strokeWidth:d,parseFont:r.parseFont,ratio:M,textCanvas:this[v]}),this[u].needsUpdate=!0,this.updateContours(),this.forceUpdate(),this[u]}))}}l(I,"Attr",s.default),a.default.registerNode(I,"label")},function(n,t,e){e.r(t),e.d(t,"default",function(){return c});var r=e(12),i=e(72),o=e(221),s=e(220);e(1).glMatrix.setMatrixArrayType(Array);const a=Symbol.for("spritejs_setAttributeDefault"),l=Symbol.for("spritejs_setAttribute"),u=Symbol.for("spritejs_getAttribute"),p=Symbol.for("spritejs_declareAlias");class c extends s.default{constructor(v){super(v),this[a]({text:"",fontSize:16,fontFamily:"Helvetica,Arial,sans-serif",fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",fontStretch:"normal",lineHeight:"",textAlign:"left",strokeColor:void 0,strokeWidth:1,fillColor:void 0,verticalAlign:"middle"}),this[p]("font")}get text(){return this[u]("text")||" "}set text(v){this[l]("text",v)}get fontSize(){return this[u]("fontSize")}set fontSize(v){this[l]("fontSize",Object(i.toNumber)(v))}get fontFamily(){return this[u]("fontFamily")}set fontFamily(v){this[l]("fontFamily",v)}get fontStyle(){return this[u]("fontStyle")}set fontStyle(v){this[l]("fontStyle",v)}get fontVariant(){return this[u]("fontVariant")}set fontVariant(v){this[l]("fontVariant",v)}get fontWeight(){return this[u]("fontWeight")}set fontWeight(v){this[l]("fontWeight",v)}get fontStretch(){return this[u]("fontStretch")}set fontStretch(v){this[l]("fontStretch",v)}get lineHeight(){return this[u]("lineHeight")||this.fontSize}set lineHeight(v){this[l]("lineHeight",Object(i.toNumber)(v))}get textAlign(){return this[u]("textAlign")}set textAlign(v){this[l]("textAlign",v)}get strokeColor(){return this[u]("strokeColor")}set strokeColor(v){this[l]("strokeColor",Object(o.parseColor)(v))}get strokeWidth(){return this[u]("strokeWidth")}set strokeWidth(v){this[l]("strokeWidth",Object(i.toNumber)(v))}get verticalAlign(){return this[u]("verticalAlign")}set verticalAlign(v){this[l]("verticalAlign",v)}get fillColor(){return this[u]("fillColor")}set fillColor(v){this[l]("fillColor",Object(o.parseColor)(v))}get font(){const{fontStyle:v,fontVariant:I,fontWeight:w,fontStretch:y,fontSize:T,lineHeight:h,fontFamily:m}=this;return`${v} ${I} ${w} ${y} ${T}px/${h}px ${m}`}set font(v){if(v==null)this.fontStyle=null,this.fontVariant=null,this.fontWeight=null,this.fontStretch=null,this.fontSize=null,this.lineHeight=null,this.fontFamily=null;else{const I=Object(r.parseFont)(v);this.fontStyle=I.style,this.fontVariant=I.variant,this.fontWeight=I.weight,this.fontStretch=I.stretch,this.fontSize=Object(i.toNumber)(`${I.size}${I.unit}`),I.lineHeight&&(this.lineHeight=I.pxLineHeight),this.fontFamily=I.family}}}},function(n,t,e){e.r(t),e.d(t,"default",function(){return v});var r=e(12),i=e(219),o=e(251),s=e(213),a=e(252);e(1).glMatrix.setMatrixArrayType(Array);function l(I,w,y){return w in I?Object.defineProperty(I,w,{value:y,enumerable:!0,configurable:!0,writable:!0}):I[w]=y,I}const u=Symbol("zOrder"),p=Symbol("ordered"),c=Symbol("children"),g=Symbol("sealed");class v extends i.default{constructor(w={}){super(w),this[c]=[],this[p]=null,this[u]=0}get childNodes(){return this[c]}get children(){return this[c]}get orderedChildren(){return this[p]||(this[p]=[...this[c]],this[p].sort((w,y)=>w.zIndex-y.zIndex||w.zOrder-y.zOrder)),this[p]}append(...w){return w.map(y=>this.appendChild(y))}appendChild(w){return w.remove(),this[c].push(w),w.connect(this,this[u]++),this[p]&&(this[p].length&&w.zIndex<this[p][this[p].length-1].zIndex?this.reorder():this[p].push(w)),w}cloneNode(w=!1){const y=super.cloneNode();return w&&this[c].forEach(T=>{const h=T.cloneNode(w);y.appendChild(h)}),y}dispatchPointerEvent(w){const y=this.orderedChildren;for(let T=y.length-1;T>=0;T--)if(y[T].dispatchPointerEvent(w))return!0;return super.dispatchPointerEvent(w)}draw(w=[]){if(this.__cacheRenderMatrix=this.renderMatrix,super.draw(w),!this[g]&&this.attributes.display!=="none"){const y=this.orderedChildren;for(let T=0;T<y.length;T++)y[T].draw(w)}return this.__cacheRenderMatrix=null,w}getElementById(w){return Object(a.querySelector)(`#${w}`,this)}getElementsByClassName(w){return Object(a.querySelectorAll)(`.${w}`,this)}getElementsByName(w){return Object(a.querySelectorAll)(`[name="${w}"]`,this)}getElementsByTagName(w){return Object(a.querySelectorAll)(w,this)}insertBefore(w,y){if(y==null)return this.appendChild(w);w.remove();const T=this[c].indexOf(y);if(T<0)throw new Error("Invalid reference node.");const h=y.zOrder;for(let m=T;m<this[c].length;m++){const d=this[c][m].zOrder,M=this[c][m];delete M.zOrder,Object.defineProperty(M,"zOrder",{value:d+1,writable:!1,configurable:!0})}if(this[c].splice(T,0,w),w.connect(this,h),this[p])if(w.zIndex!==y.zIndex)this.reorder();else{const m=this[p].indexOf(y);this[p].splice(m,0,w)}return w}querySelector(w){return Object(a.querySelector)(w,this)}querySelectorAll(w){return Object(a.querySelectorAll)(w,this)}replaceChild(w,y){w.remove();const T=this[c].indexOf(y);if(T<0)throw new Error("Invalid reference node.");if(this[c][T]=w,w.connect(this,y.zOrder),this[p])if(w.zIndex!==y.zIndex)this.reorder();else{const h=this[p].indexOf(y);this[p][h]=w}return y.disconnect(this),w}removeAllChildren(){const w=this[c];for(let y=w.length-1;y>=0;y--)w[y].remove()}removeChild(w){const y=this[c].indexOf(w);if(y>=0){if(this[c].splice(y,1),this[p]){const T=this[p].indexOf(w);this[p].splice(T,1)}return w.disconnect(this),w}return null}reorder(){this[p]=null}seal(){function w(m,d){const M=[];for(let x=0;x<m.length;x++){const E=[...m[x]];for(let P=1;P<E.length;P+=2){const R=E[P],N=E[P+1];E[P]=R*d[0]+N*d[2]+d[4],E[P+1]=R*d[1]+N*d[3]+d[5]}M.push(E)}return M}const y=this.orderedChildren,T=new r.Figure2D,h=this.localMatrix;for(let m=0;m<y.length;m++){let d=y[m];if(d instanceof v&&(d=d.seal()),d.clientBox){let M=d.clientBox.contours.path;M=w(M,d.localMatrix),T.addPath(M)}if(d.path){let M=d.path.contours.path;M=w(M,d.localMatrix),T.addPath(M)}}return this[g]=!0,this.clientBox=T,{clientBox:T,localMatrix:h}}setResolution({width:w,height:y}){super.setResolution({width:w,height:y}),this[c].forEach(T=>{T.setResolution({width:w,height:y})})}updateContours(){this[g]||super.updateContours()}}l(v,"Attr",o.default),s.default.registerNode(v,"group")},function(n,t,e){e.r(t),e.d(t,"default",function(){return i});var r=e(220);e(1).glMatrix.setMatrixArrayType(Array);class i extends r.default{}},function(n,t,e){e.r(t),e.d(t,"querySelectorAll",function(){return g}),e.d(t,"querySelector",function(){return v}),e.d(t,"isMatched",function(){return I}),e.d(t,"compile",function(){return w});var r=e(221),i=e(213);e(1).glMatrix.setMatrixArrayType(Array);const o=e(253);function s(y){return y.nodeType===1||i.default.isSpriteNode(y.nodeName)}function a(y){return Array.from(y.childNodes||[])}function l(y){return i.default.isSpriteNode(y.nodeName)?y.parent||y.canvas||y.container:y.parentElement}function u(y){let T=y.length,h,m,d;for(;--T>-1;){for(h=m=y[T],y[T]=null,d=!0;m;){if(y.indexOf(m)>-1){d=!1,y.splice(T,1);break}m=l(m)}d&&(y[T]=h)}return y}const p={isTag:s,existsOne(y,T){return T.some(h=>s(h)?y(h)||p.existsOne(y,a(h)):!1)},getSiblings(y){const T=l(y);return T&&a(T)},getChildren:a,getParent:l,getAttributeValue(y,T){if(y.nodeType===1&&T==="class"||T==="id")return y[T];if(this.hasAttrib(y,T)){let h=y.attributes[T];return Array.isArray(h)&&(h=`[${h.join()}]`),String(h)}},hasAttrib(y,T){return y.attributes[T]!=null},removeSubsets:u,getName(y){return y.tagName?y.tagName.toLowerCase():null},findOne:function y(T,h){let m=null;for(let d=0,M=h.length;d<M&&!m;d++)if(T(h[d]))m=h[d];else{const x=a(h[d]);x&&x.length>0&&(m=y(T,x))}return m},findAll:function y(T,h){let m=[];for(let d=0,M=h.length;d<M;d++){if(!s(h[d]))continue;T(h[d])&&m.push(h[d]);const x=a(h[d]);x&&(m=m.concat(y(T,x)))}return m},getText:function y(T){return Array.isArray(T)?T.map(y).join(""):s(T)?y(a(T)):T.nodeType===3?T.nodeValue:i.default.isSpriteNode(T.nodeName)?T.text:""}};function c(y){if(typeof y!="string")return y;let T=y.match(/\[(bgcolor|fillColor|strokeColor|color)\s*=\s*['"]?\w+['"]?\]/g);return T&&(T=T.map(h=>{const m=h.slice(1,-1).split("="),d=Object(r.parseColor)(m[1].replace(/['"]/g,""));return[h,`[${m[0]}="${d}"]`]}),T.forEach(([h,m])=>{y=y.replace(h,m)})),T=y.match(/\[\w+\s*=\s*['"]\[.+?\]['"]\]/g),T&&(T=T.map(h=>{const m=h.slice(1,-1).split("="),d=m[1].slice(2,-2).split(/,/g).map(M=>M.trim());return[h,`[${m[0]}="[${d}]"]`]}),T.forEach(([h,m])=>{y=y.replace(h,m)})),y}function g(y,T){return o.selectAll(c(y),T,{adapter:p})}function v(y,T){return o.selectOne(c(y),T,{adapter:p})}function I(y,T){return o.is(y,c(T),{adapter:p})}function w(y){return o.compile(c(y),{adapter:p})}},function(n,t,e){n.exports=w;var r=e(254),i=e(273).falseFunc,o=e(274);function s(y){return function(h,m,d){return m=m||{},m.adapter=m.adapter||r,y(h,m,d)}}var a=s(o),l=s(o.compileUnsafe);function u(y){return function(h,m,d){return d=d||{},d.adapter=d.adapter||r,typeof h!="function"&&(h=l(h,d,m)),h.shouldTestNextSiblings&&(m=c(d&&d.context||m,d.adapter)),Array.isArray(m)?m=d.adapter.removeSubsets(m):m=d.adapter.getChildren(m),y(h,m,d)}}function p(y,T){var h=T.getSiblings(y);if(!Array.isArray(h))return[];for(h=h.slice(0);h.shift()!==y;);return h}function c(y,T){Array.isArray(y)||(y=[y]);for(var h=y.slice(0),m=0,d=y.length;m<d;m++){var M=p(h[m],T);h.push.apply(h,M)}return h}var g=u(function(T,h,m){return T===i||!h||h.length===0?[]:m.adapter.findAll(T,h)}),v=u(function(T,h,m){return T===i||!h||h.length===0?null:m.adapter.findOne(T,h)});function I(y,T,h){return h=h||{},h.adapter=h.adapter||r,(typeof T=="function"?T:a(T,h))(y)}function w(y,T,h){return g(y,T,h)}w.compile=a,w.filters=o.Pseudos.filters,w.pseudos=o.Pseudos.pseudos,w.selectAll=g,w.selectOne=v,w.is=I,w.parse=a,w.iterate=g,w._compileUnsafe=l,w._compileToken=o.compileToken},function(n,t,e){var r=n.exports;[e(255),e(268),e(269),e(270),e(271),e(272)].forEach(function(i){Object.keys(i).forEach(function(o){r[o]=i[o].bind(r)})})},function(n,t,e){var r=e(256),i=e(257),o=r.isTag;n.exports={getInnerHTML:s,getOuterHTML:i,getText:a};function s(l,u){return l.children?l.children.map(function(p){return i(p,u)}).join(""):""}function a(l){return Array.isArray(l)?l.map(a).join(""):o(l)?l.name==="br"?`
`:a(l.children):l.type===r.CDATA?a(l.children):l.type===r.Text?l.data:""}},function(n,t){n.exports={Text:"text",Directive:"directive",Comment:"comment",Script:"script",Style:"style",Tag:"tag",CDATA:"cdata",Doctype:"doctype",isTag:function(e){return e.type==="tag"||e.type==="script"||e.type==="style"}}},function(n,t,e){var r=e(258),i=e(259),o=e(267);o.elementNames.__proto__=null,o.attributeNames.__proto__=null;var s={__proto__:null,style:!0,script:!0,xmp:!0,iframe:!0,noembed:!0,noframes:!0,plaintext:!0,noscript:!0};function a(y,T){if(y){var h="",m;for(var d in y)m=y[d],h&&(h+=" "),T.xmlMode==="foreign"&&(d=o.attributeNames[d]||d),h+=d,(m!==null&&m!==""||T.xmlMode)&&(h+='="'+(T.decodeEntities?i.encodeXML(m):m.replace(/\"/g,"&quot;"))+'"');return h}}var l={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},u=n.exports=function(y,T){!Array.isArray(y)&&!y.cheerio&&(y=[y]),T=T||{};for(var h="",m=0;m<y.length;m++){var d=y[m];d.type==="root"?h+=u(d.children,T):r.isTag(d)?h+=c(d,T):d.type===r.Directive?h+=g(d):d.type===r.Comment?h+=w(d):d.type===r.CDATA?h+=I(d):h+=v(d,T)}return h},p=["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"];function c(y,T){T.xmlMode==="foreign"&&(y.name=o.elementNames[y.name]||y.name,y.parent&&p.indexOf(y.parent.name)>=0&&(T=Object.assign({},T,{xmlMode:!1}))),!T.xmlMode&&["svg","math"].indexOf(y.name)>=0&&(T=Object.assign({},T,{xmlMode:"foreign"}));var h="<"+y.name,m=a(y.attribs,T);return m&&(h+=" "+m),T.xmlMode&&(!y.children||y.children.length===0)?h+="/>":(h+=">",y.children&&(h+=u(y.children,T)),(!l[y.name]||T.xmlMode)&&(h+="</"+y.name+">")),h}function g(y){return"<"+y.data+">"}function v(y,T){var h=y.data||"";return T.decodeEntities&&!(y.parent&&y.parent.name in s)&&(h=i.encodeXML(h)),h}function I(y){return"<![CDATA["+y.children[0].data+"]]>"}function w(y){return"<!--"+y.data+"-->"}},function(n,t,e){Object.defineProperty(t,"__esModule",{value:!0});function r(i){return i.type==="tag"||i.type==="script"||i.type==="style"}t.isTag=r,t.Text="text",t.Directive="directive",t.Comment="comment",t.Script="script",t.Style="style",t.Tag="tag",t.CDATA="cdata",t.Doctype="doctype"},function(n,t,e){Object.defineProperty(t,"__esModule",{value:!0}),t.encode=t.decodeStrict=t.decode=void 0;var r=e(260),i=e(266);function o(p,c){return(!c||c<=0?r.decodeXML:r.decodeHTML)(p)}t.decode=o;function s(p,c){return(!c||c<=0?r.decodeXML:r.decodeHTMLStrict)(p)}t.decodeStrict=s;function a(p,c){return(!c||c<=0?i.encodeXML:i.encodeHTML)(p)}t.encode=a;var l=e(266);Object.defineProperty(t,"encodeXML",{enumerable:!0,get:function(){return l.encodeXML}}),Object.defineProperty(t,"encodeHTML",{enumerable:!0,get:function(){return l.encodeHTML}}),Object.defineProperty(t,"escape",{enumerable:!0,get:function(){return l.escape}}),Object.defineProperty(t,"encodeHTML4",{enumerable:!0,get:function(){return l.encodeHTML}}),Object.defineProperty(t,"encodeHTML5",{enumerable:!0,get:function(){return l.encodeHTML}});var u=e(260);Object.defineProperty(t,"decodeXML",{enumerable:!0,get:function(){return u.decodeXML}}),Object.defineProperty(t,"decodeHTML",{enumerable:!0,get:function(){return u.decodeHTML}}),Object.defineProperty(t,"decodeHTMLStrict",{enumerable:!0,get:function(){return u.decodeHTMLStrict}}),Object.defineProperty(t,"decodeHTML4",{enumerable:!0,get:function(){return u.decodeHTML}}),Object.defineProperty(t,"decodeHTML5",{enumerable:!0,get:function(){return u.decodeHTML}}),Object.defineProperty(t,"decodeHTML4Strict",{enumerable:!0,get:function(){return u.decodeHTMLStrict}}),Object.defineProperty(t,"decodeHTML5Strict",{enumerable:!0,get:function(){return u.decodeHTMLStrict}}),Object.defineProperty(t,"decodeXMLStrict",{enumerable:!0,get:function(){return u.decodeXML}})},function(n,t,e){var r=this&&this.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(t,"__esModule",{value:!0}),t.decodeHTML=t.decodeHTMLStrict=t.decodeXML=void 0;var i=r(e(261)),o=r(e(262)),s=r(e(263)),a=r(e(264));t.decodeXML=l(s.default),t.decodeHTMLStrict=l(i.default);function l(c){var g=Object.keys(c).join("|"),v=p(c);g+="|#[xX][\\da-fA-F]+|#\\d+";var I=new RegExp("&(?:"+g+");","g");return function(w){return String(w).replace(I,v)}}var u=function(c,g){return c<g?1:-1};t.decodeHTML=function(){for(var c=Object.keys(o.default).sort(u),g=Object.keys(i.default).sort(u),v=0,I=0;v<g.length;v++)c[I]===g[v]?(g[v]+=";?",I++):g[v]+=";";var w=new RegExp("&(?:"+g.join("|")+"|#[xX][\\da-fA-F]+;?|#\\d+;?)","g"),y=p(i.default);function T(h){return h.substr(-1)!==";"&&(h+=";"),y(h)}return function(h){return String(h).replace(w,T)}}();function p(c){return function(v){if(v.charAt(1)==="#"){var I=v.charAt(2);return I==="X"||I==="x"?a.default(parseInt(v.substr(3),16)):a.default(parseInt(v.substr(2),10))}return c[v.slice(1,-1)]}}},function(n){n.exports=JSON.parse('{"Aacute":"","aacute":"","Abreve":"","abreve":"","ac":"","acd":"","acE":"","Acirc":"","acirc":"","acute":"","Acy":"","acy":"","AElig":"","aelig":"","af":"","Afr":"","afr":"","Agrave":"","agrave":"","alefsym":"","aleph":"","Alpha":"","alpha":"","Amacr":"","amacr":"","amalg":"","amp":"&","AMP":"&","andand":"","And":"","and":"","andd":"","andslope":"","andv":"","ang":"","ange":"","angle":"","angmsdaa":"","angmsdab":"","angmsdac":"","angmsdad":"","angmsdae":"","angmsdaf":"","angmsdag":"","angmsdah":"","angmsd":"","angrt":"","angrtvb":"","angrtvbd":"","angsph":"","angst":"","angzarr":"","Aogon":"","aogon":"","Aopf":"","aopf":"","apacir":"","ap":"","apE":"","ape":"","apid":"","apos":"\'","ApplyFunction":"","approx":"","approxeq":"","Aring":"","aring":"","Ascr":"","ascr":"","Assign":"","ast":"*","asymp":"","asympeq":"","Atilde":"","atilde":"","Auml":"","auml":"","awconint":"","awint":"","backcong":"","backepsilon":"","backprime":"","backsim":"","backsimeq":"","Backslash":"","Barv":"","barvee":"","barwed":"","Barwed":"","barwedge":"","bbrk":"","bbrktbrk":"","bcong":"","Bcy":"","bcy":"","bdquo":"","becaus":"","because":"","Because":"","bemptyv":"","bepsi":"","bernou":"","Bernoullis":"","Beta":"","beta":"","beth":"","between":"","Bfr":"","bfr":"","bigcap":"","bigcirc":"","bigcup":"","bigodot":"","bigoplus":"","bigotimes":"","bigsqcup":"","bigstar":"","bigtriangledown":"","bigtriangleup":"","biguplus":"","bigvee":"","bigwedge":"","bkarow":"","blacklozenge":"","blacksquare":"","blacktriangle":"","blacktriangledown":"","blacktriangleleft":"","blacktriangleright":"","blank":"","blk12":"","blk14":"","blk34":"","block":"","bne":"=","bnequiv":"","bNot":"","bnot":"","Bopf":"","bopf":"","bot":"","bottom":"","bowtie":"","boxbox":"","boxdl":"","boxdL":"","boxDl":"","boxDL":"","boxdr":"","boxdR":"","boxDr":"","boxDR":"","boxh":"","boxH":"","boxhd":"","boxHd":"","boxhD":"","boxHD":"","boxhu":"","boxHu":"","boxhU":"","boxHU":"","boxminus":"","boxplus":"","boxtimes":"","boxul":"","boxuL":"","boxUl":"","boxUL":"","boxur":"","boxuR":"","boxUr":"","boxUR":"","boxv":"","boxV":"","boxvh":"","boxvH":"","boxVh":"","boxVH":"","boxvl":"","boxvL":"","boxVl":"","boxVL":"","boxvr":"","boxvR":"","boxVr":"","boxVR":"","bprime":"","breve":"","Breve":"","brvbar":"","bscr":"","Bscr":"","bsemi":"","bsim":"","bsime":"","bsolb":"","bsol":"\\\\","bsolhsub":"","bull":"","bullet":"","bump":"","bumpE":"","bumpe":"","Bumpeq":"","bumpeq":"","Cacute":"","cacute":"","capand":"","capbrcup":"","capcap":"","cap":"","Cap":"","capcup":"","capdot":"","CapitalDifferentialD":"","caps":"","caret":"","caron":"","Cayleys":"","ccaps":"","Ccaron":"","ccaron":"","Ccedil":"","ccedil":"","Ccirc":"","ccirc":"","Cconint":"","ccups":"","ccupssm":"","Cdot":"","cdot":"","cedil":"","Cedilla":"","cemptyv":"","cent":"","centerdot":"","CenterDot":"","cfr":"","Cfr":"","CHcy":"","chcy":"","check":"","checkmark":"","Chi":"","chi":"","circ":"","circeq":"","circlearrowleft":"","circlearrowright":"","circledast":"","circledcirc":"","circleddash":"","CircleDot":"","circledR":"","circledS":"","CircleMinus":"","CirclePlus":"","CircleTimes":"","cir":"","cirE":"","cire":"","cirfnint":"","cirmid":"","cirscir":"","ClockwiseContourIntegral":"","CloseCurlyDoubleQuote":"","CloseCurlyQuote":"","clubs":"","clubsuit":"","colon":":","Colon":"","Colone":"","colone":"","coloneq":"","comma":",","commat":"@","comp":"","compfn":"","complement":"","complexes":"","cong":"","congdot":"","Congruent":"","conint":"","Conint":"","ContourIntegral":"","copf":"","Copf":"","coprod":"","Coproduct":"","copy":"","COPY":"","copysr":"","CounterClockwiseContourIntegral":"","crarr":"","cross":"","Cross":"","Cscr":"","cscr":"","csub":"","csube":"","csup":"","csupe":"","ctdot":"","cudarrl":"","cudarrr":"","cuepr":"","cuesc":"","cularr":"","cularrp":"","cupbrcap":"","cupcap":"","CupCap":"","cup":"","Cup":"","cupcup":"","cupdot":"","cupor":"","cups":"","curarr":"","curarrm":"","curlyeqprec":"","curlyeqsucc":"","curlyvee":"","curlywedge":"","curren":"","curvearrowleft":"","curvearrowright":"","cuvee":"","cuwed":"","cwconint":"","cwint":"","cylcty":"","dagger":"","Dagger":"","daleth":"","darr":"","Darr":"","dArr":"","dash":"","Dashv":"","dashv":"","dbkarow":"","dblac":"","Dcaron":"","dcaron":"","Dcy":"","dcy":"","ddagger":"","ddarr":"","DD":"","dd":"","DDotrahd":"","ddotseq":"","deg":"","Del":"","Delta":"","delta":"","demptyv":"","dfisht":"","Dfr":"","dfr":"","dHar":"","dharl":"","dharr":"","DiacriticalAcute":"","DiacriticalDot":"","DiacriticalDoubleAcute":"","DiacriticalGrave":"`","DiacriticalTilde":"","diam":"","diamond":"","Diamond":"","diamondsuit":"","diams":"","die":"","DifferentialD":"","digamma":"","disin":"","div":"","divide":"","divideontimes":"","divonx":"","DJcy":"","djcy":"","dlcorn":"","dlcrop":"","dollar":"$","Dopf":"","dopf":"","Dot":"","dot":"","DotDot":"","doteq":"","doteqdot":"","DotEqual":"","dotminus":"","dotplus":"","dotsquare":"","doublebarwedge":"","DoubleContourIntegral":"","DoubleDot":"","DoubleDownArrow":"","DoubleLeftArrow":"","DoubleLeftRightArrow":"","DoubleLeftTee":"","DoubleLongLeftArrow":"","DoubleLongLeftRightArrow":"","DoubleLongRightArrow":"","DoubleRightArrow":"","DoubleRightTee":"","DoubleUpArrow":"","DoubleUpDownArrow":"","DoubleVerticalBar":"","DownArrowBar":"","downarrow":"","DownArrow":"","Downarrow":"","DownArrowUpArrow":"","DownBreve":"","downdownarrows":"","downharpoonleft":"","downharpoonright":"","DownLeftRightVector":"","DownLeftTeeVector":"","DownLeftVectorBar":"","DownLeftVector":"","DownRightTeeVector":"","DownRightVectorBar":"","DownRightVector":"","DownTeeArrow":"","DownTee":"","drbkarow":"","drcorn":"","drcrop":"","Dscr":"","dscr":"","DScy":"","dscy":"","dsol":"","Dstrok":"","dstrok":"","dtdot":"","dtri":"","dtrif":"","duarr":"","duhar":"","dwangle":"","DZcy":"","dzcy":"","dzigrarr":"","Eacute":"","eacute":"","easter":"","Ecaron":"","ecaron":"","Ecirc":"","ecirc":"","ecir":"","ecolon":"","Ecy":"","ecy":"","eDDot":"","Edot":"","edot":"","eDot":"","ee":"","efDot":"","Efr":"","efr":"","eg":"","Egrave":"","egrave":"","egs":"","egsdot":"","el":"","Element":"","elinters":"","ell":"","els":"","elsdot":"","Emacr":"","emacr":"","empty":"","emptyset":"","EmptySmallSquare":"","emptyv":"","EmptyVerySmallSquare":"","emsp13":"","emsp14":"","emsp":"","ENG":"","eng":"","ensp":"","Eogon":"","eogon":"","Eopf":"","eopf":"","epar":"","eparsl":"","eplus":"","epsi":"","Epsilon":"","epsilon":"","epsiv":"","eqcirc":"","eqcolon":"","eqsim":"","eqslantgtr":"","eqslantless":"","Equal":"","equals":"=","EqualTilde":"","equest":"","Equilibrium":"","equiv":"","equivDD":"","eqvparsl":"","erarr":"","erDot":"","escr":"","Escr":"","esdot":"","Esim":"","esim":"","Eta":"","eta":"","ETH":"","eth":"","Euml":"","euml":"","euro":"","excl":"!","exist":"","Exists":"","expectation":"","exponentiale":"","ExponentialE":"","fallingdotseq":"","Fcy":"","fcy":"","female":"","ffilig":"","fflig":"","ffllig":"","Ffr":"","ffr":"","filig":"","FilledSmallSquare":"","FilledVerySmallSquare":"","fjlig":"fj","flat":"","fllig":"","fltns":"","fnof":"","Fopf":"","fopf":"","forall":"","ForAll":"","fork":"","forkv":"","Fouriertrf":"","fpartint":"","frac12":"","frac13":"","frac14":"","frac15":"","frac16":"","frac18":"","frac23":"","frac25":"","frac34":"","frac35":"","frac38":"","frac45":"","frac56":"","frac58":"","frac78":"","frasl":"","frown":"","fscr":"","Fscr":"","gacute":"","Gamma":"","gamma":"","Gammad":"","gammad":"","gap":"","Gbreve":"","gbreve":"","Gcedil":"","Gcirc":"","gcirc":"","Gcy":"","gcy":"","Gdot":"","gdot":"","ge":"","gE":"","gEl":"","gel":"","geq":"","geqq":"","geqslant":"","gescc":"","ges":"","gesdot":"","gesdoto":"","gesdotol":"","gesl":"","gesles":"","Gfr":"","gfr":"","gg":"","Gg":"","ggg":"","gimel":"","GJcy":"","gjcy":"","gla":"","gl":"","glE":"","glj":"","gnap":"","gnapprox":"","gne":"","gnE":"","gneq":"","gneqq":"","gnsim":"","Gopf":"","gopf":"","grave":"`","GreaterEqual":"","GreaterEqualLess":"","GreaterFullEqual":"","GreaterGreater":"","GreaterLess":"","GreaterSlantEqual":"","GreaterTilde":"","Gscr":"","gscr":"","gsim":"","gsime":"","gsiml":"","gtcc":"","gtcir":"","gt":">","GT":">","Gt":"","gtdot":"","gtlPar":"","gtquest":"","gtrapprox":"","gtrarr":"","gtrdot":"","gtreqless":"","gtreqqless":"","gtrless":"","gtrsim":"","gvertneqq":"","gvnE":"","Hacek":"","hairsp":"","half":"","hamilt":"","HARDcy":"","hardcy":"","harrcir":"","harr":"","hArr":"","harrw":"","Hat":"^","hbar":"","Hcirc":"","hcirc":"","hearts":"","heartsuit":"","hellip":"","hercon":"","hfr":"","Hfr":"","HilbertSpace":"","hksearow":"","hkswarow":"","hoarr":"","homtht":"","hookleftarrow":"","hookrightarrow":"","hopf":"","Hopf":"","horbar":"","HorizontalLine":"","hscr":"","Hscr":"","hslash":"","Hstrok":"","hstrok":"","HumpDownHump":"","HumpEqual":"","hybull":"","hyphen":"","Iacute":"","iacute":"","ic":"","Icirc":"","icirc":"","Icy":"","icy":"","Idot":"","IEcy":"","iecy":"","iexcl":"","iff":"","ifr":"","Ifr":"","Igrave":"","igrave":"","ii":"","iiiint":"","iiint":"","iinfin":"","iiota":"","IJlig":"","ijlig":"","Imacr":"","imacr":"","image":"","ImaginaryI":"","imagline":"","imagpart":"","imath":"","Im":"","imof":"","imped":"","Implies":"","incare":"","in":"","infin":"","infintie":"","inodot":"","intcal":"","int":"","Int":"","integers":"","Integral":"","intercal":"","Intersection":"","intlarhk":"","intprod":"","InvisibleComma":"","InvisibleTimes":"","IOcy":"","iocy":"","Iogon":"","iogon":"","Iopf":"","iopf":"","Iota":"","iota":"","iprod":"","iquest":"","iscr":"","Iscr":"","isin":"","isindot":"","isinE":"","isins":"","isinsv":"","isinv":"","it":"","Itilde":"","itilde":"","Iukcy":"","iukcy":"","Iuml":"","iuml":"","Jcirc":"","jcirc":"","Jcy":"","jcy":"","Jfr":"","jfr":"","jmath":"","Jopf":"","jopf":"","Jscr":"","jscr":"","Jsercy":"","jsercy":"","Jukcy":"","jukcy":"","Kappa":"","kappa":"","kappav":"","Kcedil":"","kcedil":"","Kcy":"","kcy":"","Kfr":"","kfr":"","kgreen":"","KHcy":"","khcy":"","KJcy":"","kjcy":"","Kopf":"","kopf":"","Kscr":"","kscr":"","lAarr":"","Lacute":"","lacute":"","laemptyv":"","lagran":"","Lambda":"","lambda":"","lang":"","Lang":"","langd":"","langle":"","lap":"","Laplacetrf":"","laquo":"","larrb":"","larrbfs":"","larr":"","Larr":"","lArr":"","larrfs":"","larrhk":"","larrlp":"","larrpl":"","larrsim":"","larrtl":"","latail":"","lAtail":"","lat":"","late":"","lates":"","lbarr":"","lBarr":"","lbbrk":"","lbrace":"{","lbrack":"[","lbrke":"","lbrksld":"","lbrkslu":"","Lcaron":"","lcaron":"","Lcedil":"","lcedil":"","lceil":"","lcub":"{","Lcy":"","lcy":"","ldca":"","ldquo":"","ldquor":"","ldrdhar":"","ldrushar":"","ldsh":"","le":"","lE":"","LeftAngleBracket":"","LeftArrowBar":"","leftarrow":"","LeftArrow":"","Leftarrow":"","LeftArrowRightArrow":"","leftarrowtail":"","LeftCeiling":"","LeftDoubleBracket":"","LeftDownTeeVector":"","LeftDownVectorBar":"","LeftDownVector":"","LeftFloor":"","leftharpoondown":"","leftharpoonup":"","leftleftarrows":"","leftrightarrow":"","LeftRightArrow":"","Leftrightarrow":"","leftrightarrows":"","leftrightharpoons":"","leftrightsquigarrow":"","LeftRightVector":"","LeftTeeArrow":"","LeftTee":"","LeftTeeVector":"","leftthreetimes":"","LeftTriangleBar":"","LeftTriangle":"","LeftTriangleEqual":"","LeftUpDownVector":"","LeftUpTeeVector":"","LeftUpVectorBar":"","LeftUpVector":"","LeftVectorBar":"","LeftVector":"","lEg":"","leg":"","leq":"","leqq":"","leqslant":"","lescc":"","les":"","lesdot":"","lesdoto":"","lesdotor":"","lesg":"","lesges":"","lessapprox":"","lessdot":"","lesseqgtr":"","lesseqqgtr":"","LessEqualGreater":"","LessFullEqual":"","LessGreater":"","lessgtr":"","LessLess":"","lesssim":"","LessSlantEqual":"","LessTilde":"","lfisht":"","lfloor":"","Lfr":"","lfr":"","lg":"","lgE":"","lHar":"","lhard":"","lharu":"","lharul":"","lhblk":"","LJcy":"","ljcy":"","llarr":"","ll":"","Ll":"","llcorner":"","Lleftarrow":"","llhard":"","lltri":"","Lmidot":"","lmidot":"","lmoustache":"","lmoust":"","lnap":"","lnapprox":"","lne":"","lnE":"","lneq":"","lneqq":"","lnsim":"","loang":"","loarr":"","lobrk":"","longleftarrow":"","LongLeftArrow":"","Longleftarrow":"","longleftrightarrow":"","LongLeftRightArrow":"","Longleftrightarrow":"","longmapsto":"","longrightarrow":"","LongRightArrow":"","Longrightarrow":"","looparrowleft":"","looparrowright":"","lopar":"","Lopf":"","lopf":"","loplus":"","lotimes":"","lowast":"","lowbar":"_","LowerLeftArrow":"","LowerRightArrow":"","loz":"","lozenge":"","lozf":"","lpar":"(","lparlt":"","lrarr":"","lrcorner":"","lrhar":"","lrhard":"","lrm":"","lrtri":"","lsaquo":"","lscr":"","Lscr":"","lsh":"","Lsh":"","lsim":"","lsime":"","lsimg":"","lsqb":"[","lsquo":"","lsquor":"","Lstrok":"","lstrok":"","ltcc":"","ltcir":"","lt":"<","LT":"<","Lt":"","ltdot":"","lthree":"","ltimes":"","ltlarr":"","ltquest":"","ltri":"","ltrie":"","ltrif":"","ltrPar":"","lurdshar":"","luruhar":"","lvertneqq":"","lvnE":"","macr":"","male":"","malt":"","maltese":"","Map":"","map":"","mapsto":"","mapstodown":"","mapstoleft":"","mapstoup":"","marker":"","mcomma":"","Mcy":"","mcy":"","mdash":"","mDDot":"","measuredangle":"","MediumSpace":"","Mellintrf":"","Mfr":"","mfr":"","mho":"","micro":"","midast":"*","midcir":"","mid":"","middot":"","minusb":"","minus":"","minusd":"","minusdu":"","MinusPlus":"","mlcp":"","mldr":"","mnplus":"","models":"","Mopf":"","mopf":"","mp":"","mscr":"","Mscr":"","mstpos":"","Mu":"","mu":"","multimap":"","mumap":"","nabla":"","Nacute":"","nacute":"","nang":"","nap":"","napE":"","napid":"","napos":"","napprox":"","natural":"","naturals":"","natur":"","nbsp":"","nbump":"","nbumpe":"","ncap":"","Ncaron":"","ncaron":"","Ncedil":"","ncedil":"","ncong":"","ncongdot":"","ncup":"","Ncy":"","ncy":"","ndash":"","nearhk":"","nearr":"","neArr":"","nearrow":"","ne":"","nedot":"","NegativeMediumSpace":"","NegativeThickSpace":"","NegativeThinSpace":"","NegativeVeryThinSpace":"","nequiv":"","nesear":"","nesim":"","NestedGreaterGreater":"","NestedLessLess":"","NewLine":"\\n","nexist":"","nexists":"","Nfr":"","nfr":"","ngE":"","nge":"","ngeq":"","ngeqq":"","ngeqslant":"","nges":"","nGg":"","ngsim":"","nGt":"","ngt":"","ngtr":"","nGtv":"","nharr":"","nhArr":"","nhpar":"","ni":"","nis":"","nisd":"","niv":"","NJcy":"","njcy":"","nlarr":"","nlArr":"","nldr":"","nlE":"","nle":"","nleftarrow":"","nLeftarrow":"","nleftrightarrow":"","nLeftrightarrow":"","nleq":"","nleqq":"","nleqslant":"","nles":"","nless":"","nLl":"","nlsim":"","nLt":"","nlt":"","nltri":"","nltrie":"","nLtv":"","nmid":"","NoBreak":"","NonBreakingSpace":"","nopf":"","Nopf":"","Not":"","not":"","NotCongruent":"","NotCupCap":"","NotDoubleVerticalBar":"","NotElement":"","NotEqual":"","NotEqualTilde":"","NotExists":"","NotGreater":"","NotGreaterEqual":"","NotGreaterFullEqual":"","NotGreaterGreater":"","NotGreaterLess":"","NotGreaterSlantEqual":"","NotGreaterTilde":"","NotHumpDownHump":"","NotHumpEqual":"","notin":"","notindot":"","notinE":"","notinva":"","notinvb":"","notinvc":"","NotLeftTriangleBar":"","NotLeftTriangle":"","NotLeftTriangleEqual":"","NotLess":"","NotLessEqual":"","NotLessGreater":"","NotLessLess":"","NotLessSlantEqual":"","NotLessTilde":"","NotNestedGreaterGreater":"","NotNestedLessLess":"","notni":"","notniva":"","notnivb":"","notnivc":"","NotPrecedes":"","NotPrecedesEqual":"","NotPrecedesSlantEqual":"","NotReverseElement":"","NotRightTriangleBar":"","NotRightTriangle":"","NotRightTriangleEqual":"","NotSquareSubset":"","NotSquareSubsetEqual":"","NotSquareSuperset":"","NotSquareSupersetEqual":"","NotSubset":"","NotSubsetEqual":"","NotSucceeds":"","NotSucceedsEqual":"","NotSucceedsSlantEqual":"","NotSucceedsTilde":"","NotSuperset":"","NotSupersetEqual":"","NotTilde":"","NotTildeEqual":"","NotTildeFullEqual":"","NotTildeTilde":"","NotVerticalBar":"","nparallel":"","npar":"","nparsl":"","npart":"","npolint":"","npr":"","nprcue":"","nprec":"","npreceq":"","npre":"","nrarrc":"","nrarr":"","nrArr":"","nrarrw":"","nrightarrow":"","nRightarrow":"","nrtri":"","nrtrie":"","nsc":"","nsccue":"","nsce":"","Nscr":"","nscr":"","nshortmid":"","nshortparallel":"","nsim":"","nsime":"","nsimeq":"","nsmid":"","nspar":"","nsqsube":"","nsqsupe":"","nsub":"","nsubE":"","nsube":"","nsubset":"","nsubseteq":"","nsubseteqq":"","nsucc":"","nsucceq":"","nsup":"","nsupE":"","nsupe":"","nsupset":"","nsupseteq":"","nsupseteqq":"","ntgl":"","Ntilde":"","ntilde":"","ntlg":"","ntriangleleft":"","ntrianglelefteq":"","ntriangleright":"","ntrianglerighteq":"","Nu":"","nu":"","num":"#","numero":"","numsp":"","nvap":"","nvdash":"","nvDash":"","nVdash":"","nVDash":"","nvge":"","nvgt":">","nvHarr":"","nvinfin":"","nvlArr":"","nvle":"","nvlt":"<","nvltrie":"","nvrArr":"","nvrtrie":"","nvsim":"","nwarhk":"","nwarr":"","nwArr":"","nwarrow":"","nwnear":"","Oacute":"","oacute":"","oast":"","Ocirc":"","ocirc":"","ocir":"","Ocy":"","ocy":"","odash":"","Odblac":"","odblac":"","odiv":"","odot":"","odsold":"","OElig":"","oelig":"","ofcir":"","Ofr":"","ofr":"","ogon":"","Ograve":"","ograve":"","ogt":"","ohbar":"","ohm":"","oint":"","olarr":"","olcir":"","olcross":"","oline":"","olt":"","Omacr":"","omacr":"","Omega":"","omega":"","Omicron":"","omicron":"","omid":"","ominus":"","Oopf":"","oopf":"","opar":"","OpenCurlyDoubleQuote":"","OpenCurlyQuote":"","operp":"","oplus":"","orarr":"","Or":"","or":"","ord":"","order":"","orderof":"","ordf":"","ordm":"","origof":"","oror":"","orslope":"","orv":"","oS":"","Oscr":"","oscr":"","Oslash":"","oslash":"","osol":"","Otilde":"","otilde":"","otimesas":"","Otimes":"","otimes":"","Ouml":"","ouml":"","ovbar":"","OverBar":"","OverBrace":"","OverBracket":"","OverParenthesis":"","para":"","parallel":"","par":"","parsim":"","parsl":"","part":"","PartialD":"","Pcy":"","pcy":"","percnt":"%","period":".","permil":"","perp":"","pertenk":"","Pfr":"","pfr":"","Phi":"","phi":"","phiv":"","phmmat":"","phone":"","Pi":"","pi":"","pitchfork":"","piv":"","planck":"","planckh":"","plankv":"","plusacir":"","plusb":"","pluscir":"","plus":"+","plusdo":"","plusdu":"","pluse":"","PlusMinus":"","plusmn":"","plussim":"","plustwo":"","pm":"","Poincareplane":"","pointint":"","popf":"","Popf":"","pound":"","prap":"","Pr":"","pr":"","prcue":"","precapprox":"","prec":"","preccurlyeq":"","Precedes":"","PrecedesEqual":"","PrecedesSlantEqual":"","PrecedesTilde":"","preceq":"","precnapprox":"","precneqq":"","precnsim":"","pre":"","prE":"","precsim":"","prime":"","Prime":"","primes":"","prnap":"","prnE":"","prnsim":"","prod":"","Product":"","profalar":"","profline":"","profsurf":"","prop":"","Proportional":"","Proportion":"","propto":"","prsim":"","prurel":"","Pscr":"","pscr":"","Psi":"","psi":"","puncsp":"","Qfr":"","qfr":"","qint":"","qopf":"","Qopf":"","qprime":"","Qscr":"","qscr":"","quaternions":"","quatint":"","quest":"?","questeq":"","quot":"\\"","QUOT":"\\"","rAarr":"","race":"","Racute":"","racute":"","radic":"","raemptyv":"","rang":"","Rang":"","rangd":"","range":"","rangle":"","raquo":"","rarrap":"","rarrb":"","rarrbfs":"","rarrc":"","rarr":"","Rarr":"","rArr":"","rarrfs":"","rarrhk":"","rarrlp":"","rarrpl":"","rarrsim":"","Rarrtl":"","rarrtl":"","rarrw":"","ratail":"","rAtail":"","ratio":"","rationals":"","rbarr":"","rBarr":"","RBarr":"","rbbrk":"","rbrace":"}","rbrack":"]","rbrke":"","rbrksld":"","rbrkslu":"","Rcaron":"","rcaron":"","Rcedil":"","rcedil":"","rceil":"","rcub":"}","Rcy":"","rcy":"","rdca":"","rdldhar":"","rdquo":"","rdquor":"","rdsh":"","real":"","realine":"","realpart":"","reals":"","Re":"","rect":"","reg":"","REG":"","ReverseElement":"","ReverseEquilibrium":"","ReverseUpEquilibrium":"","rfisht":"","rfloor":"","rfr":"","Rfr":"","rHar":"","rhard":"","rharu":"","rharul":"","Rho":"","rho":"","rhov":"","RightAngleBracket":"","RightArrowBar":"","rightarrow":"","RightArrow":"","Rightarrow":"","RightArrowLeftArrow":"","rightarrowtail":"","RightCeiling":"","RightDoubleBracket":"","RightDownTeeVector":"","RightDownVectorBar":"","RightDownVector":"","RightFloor":"","rightharpoondown":"","rightharpoonup":"","rightleftarrows":"","rightleftharpoons":"","rightrightarrows":"","rightsquigarrow":"","RightTeeArrow":"","RightTee":"","RightTeeVector":"","rightthreetimes":"","RightTriangleBar":"","RightTriangle":"","RightTriangleEqual":"","RightUpDownVector":"","RightUpTeeVector":"","RightUpVectorBar":"","RightUpVector":"","RightVectorBar":"","RightVector":"","ring":"","risingdotseq":"","rlarr":"","rlhar":"","rlm":"","rmoustache":"","rmoust":"","rnmid":"","roang":"","roarr":"","robrk":"","ropar":"","ropf":"","Ropf":"","roplus":"","rotimes":"","RoundImplies":"","rpar":")","rpargt":"","rppolint":"","rrarr":"","Rrightarrow":"","rsaquo":"","rscr":"","Rscr":"","rsh":"","Rsh":"","rsqb":"]","rsquo":"","rsquor":"","rthree":"","rtimes":"","rtri":"","rtrie":"","rtrif":"","rtriltri":"","RuleDelayed":"","ruluhar":"","rx":"","Sacute":"","sacute":"","sbquo":"","scap":"","Scaron":"","scaron":"","Sc":"","sc":"","sccue":"","sce":"","scE":"","Scedil":"","scedil":"","Scirc":"","scirc":"","scnap":"","scnE":"","scnsim":"","scpolint":"","scsim":"","Scy":"","scy":"","sdotb":"","sdot":"","sdote":"","searhk":"","searr":"","seArr":"","searrow":"","sect":"","semi":";","seswar":"","setminus":"","setmn":"","sext":"","Sfr":"","sfr":"","sfrown":"","sharp":"","SHCHcy":"","shchcy":"","SHcy":"","shcy":"","ShortDownArrow":"","ShortLeftArrow":"","shortmid":"","shortparallel":"","ShortRightArrow":"","ShortUpArrow":"","shy":"","Sigma":"","sigma":"","sigmaf":"","sigmav":"","sim":"","simdot":"","sime":"","simeq":"","simg":"","simgE":"","siml":"","simlE":"","simne":"","simplus":"","simrarr":"","slarr":"","SmallCircle":"","smallsetminus":"","smashp":"","smeparsl":"","smid":"","smile":"","smt":"","smte":"","smtes":"","SOFTcy":"","softcy":"","solbar":"","solb":"","sol":"/","Sopf":"","sopf":"","spades":"","spadesuit":"","spar":"","sqcap":"","sqcaps":"","sqcup":"","sqcups":"","Sqrt":"","sqsub":"","sqsube":"","sqsubset":"","sqsubseteq":"","sqsup":"","sqsupe":"","sqsupset":"","sqsupseteq":"","square":"","Square":"","SquareIntersection":"","SquareSubset":"","SquareSubsetEqual":"","SquareSuperset":"","SquareSupersetEqual":"","SquareUnion":"","squarf":"","squ":"","squf":"","srarr":"","Sscr":"","sscr":"","ssetmn":"","ssmile":"","sstarf":"","Star":"","star":"","starf":"","straightepsilon":"","straightphi":"","strns":"","sub":"","Sub":"","subdot":"","subE":"","sube":"","subedot":"","submult":"","subnE":"","subne":"","subplus":"","subrarr":"","subset":"","Subset":"","subseteq":"","subseteqq":"","SubsetEqual":"","subsetneq":"","subsetneqq":"","subsim":"","subsub":"","subsup":"","succapprox":"","succ":"","succcurlyeq":"","Succeeds":"","SucceedsEqual":"","SucceedsSlantEqual":"","SucceedsTilde":"","succeq":"","succnapprox":"","succneqq":"","succnsim":"","succsim":"","SuchThat":"","sum":"","Sum":"","sung":"","sup1":"","sup2":"","sup3":"","sup":"","Sup":"","supdot":"","supdsub":"","supE":"","supe":"","supedot":"","Superset":"","SupersetEqual":"","suphsol":"","suphsub":"","suplarr":"","supmult":"","supnE":"","supne":"","supplus":"","supset":"","Supset":"","supseteq":"","supseteqq":"","supsetneq":"","supsetneqq":"","supsim":"","supsub":"","supsup":"","swarhk":"","swarr":"","swArr":"","swarrow":"","swnwar":"","szlig":"","Tab":"\\t","target":"","Tau":"","tau":"","tbrk":"","Tcaron":"","tcaron":"","Tcedil":"","tcedil":"","Tcy":"","tcy":"","tdot":"","telrec":"","Tfr":"","tfr":"","there4":"","therefore":"","Therefore":"","Theta":"","theta":"","thetasym":"","thetav":"","thickapprox":"","thicksim":"","ThickSpace":"","ThinSpace":"","thinsp":"","thkap":"","thksim":"","THORN":"","thorn":"","tilde":"","Tilde":"","TildeEqual":"","TildeFullEqual":"","TildeTilde":"","timesbar":"","timesb":"","times":"","timesd":"","tint":"","toea":"","topbot":"","topcir":"","top":"","Topf":"","topf":"","topfork":"","tosa":"","tprime":"","trade":"","TRADE":"","triangle":"","triangledown":"","triangleleft":"","trianglelefteq":"","triangleq":"","triangleright":"","trianglerighteq":"","tridot":"","trie":"","triminus":"","TripleDot":"","triplus":"","trisb":"","tritime":"","trpezium":"","Tscr":"","tscr":"","TScy":"","tscy":"","TSHcy":"","tshcy":"","Tstrok":"","tstrok":"","twixt":"","twoheadleftarrow":"","twoheadrightarrow":"","Uacute":"","uacute":"","uarr":"","Uarr":"","uArr":"","Uarrocir":"","Ubrcy":"","ubrcy":"","Ubreve":"","ubreve":"","Ucirc":"","ucirc":"","Ucy":"","ucy":"","udarr":"","Udblac":"","udblac":"","udhar":"","ufisht":"","Ufr":"","ufr":"","Ugrave":"","ugrave":"","uHar":"","uharl":"","uharr":"","uhblk":"","ulcorn":"","ulcorner":"","ulcrop":"","ultri":"","Umacr":"","umacr":"","uml":"","UnderBar":"_","UnderBrace":"","UnderBracket":"","UnderParenthesis":"","Union":"","UnionPlus":"","Uogon":"","uogon":"","Uopf":"","uopf":"","UpArrowBar":"","uparrow":"","UpArrow":"","Uparrow":"","UpArrowDownArrow":"","updownarrow":"","UpDownArrow":"","Updownarrow":"","UpEquilibrium":"","upharpoonleft":"","upharpoonright":"","uplus":"","UpperLeftArrow":"","UpperRightArrow":"","upsi":"","Upsi":"","upsih":"","Upsilon":"","upsilon":"","UpTeeArrow":"","UpTee":"","upuparrows":"","urcorn":"","urcorner":"","urcrop":"","Uring":"","uring":"","urtri":"","Uscr":"","uscr":"","utdot":"","Utilde":"","utilde":"","utri":"","utrif":"","uuarr":"","Uuml":"","uuml":"","uwangle":"","vangrt":"","varepsilon":"","varkappa":"","varnothing":"","varphi":"","varpi":"","varpropto":"","varr":"","vArr":"","varrho":"","varsigma":"","varsubsetneq":"","varsubsetneqq":"","varsupsetneq":"","varsupsetneqq":"","vartheta":"","vartriangleleft":"","vartriangleright":"","vBar":"","Vbar":"","vBarv":"","Vcy":"","vcy":"","vdash":"","vDash":"","Vdash":"","VDash":"","Vdashl":"","veebar":"","vee":"","Vee":"","veeeq":"","vellip":"","verbar":"|","Verbar":"","vert":"|","Vert":"","VerticalBar":"","VerticalLine":"|","VerticalSeparator":"","VerticalTilde":"","VeryThinSpace":"","Vfr":"","vfr":"","vltri":"","vnsub":"","vnsup":"","Vopf":"","vopf":"","vprop":"","vrtri":"","Vscr":"","vscr":"","vsubnE":"","vsubne":"","vsupnE":"","vsupne":"","Vvdash":"","vzigzag":"","Wcirc":"","wcirc":"","wedbar":"","wedge":"","Wedge":"","wedgeq":"","weierp":"","Wfr":"","wfr":"","Wopf":"","wopf":"","wp":"","wr":"","wreath":"","Wscr":"","wscr":"","xcap":"","xcirc":"","xcup":"","xdtri":"","Xfr":"","xfr":"","xharr":"","xhArr":"","Xi":"","xi":"","xlarr":"","xlArr":"","xmap":"","xnis":"","xodot":"","Xopf":"","xopf":"","xoplus":"","xotime":"","xrarr":"","xrArr":"","Xscr":"","xscr":"","xsqcup":"","xuplus":"","xutri":"","xvee":"","xwedge":"","Yacute":"","yacute":"","YAcy":"","yacy":"","Ycirc":"","ycirc":"","Ycy":"","ycy":"","yen":"","Yfr":"","yfr":"","YIcy":"","yicy":"","Yopf":"","yopf":"","Yscr":"","yscr":"","YUcy":"","yucy":"","yuml":"","Yuml":"","Zacute":"","zacute":"","Zcaron":"","zcaron":"","Zcy":"","zcy":"","Zdot":"","zdot":"","zeetrf":"","ZeroWidthSpace":"","Zeta":"","zeta":"","zfr":"","Zfr":"","ZHcy":"","zhcy":"","zigrarr":"","zopf":"","Zopf":"","Zscr":"","zscr":"","zwj":"","zwnj":""}')},function(n){n.exports=JSON.parse('{"Aacute":"","aacute":"","Acirc":"","acirc":"","acute":"","AElig":"","aelig":"","Agrave":"","agrave":"","amp":"&","AMP":"&","Aring":"","aring":"","Atilde":"","atilde":"","Auml":"","auml":"","brvbar":"","Ccedil":"","ccedil":"","cedil":"","cent":"","copy":"","COPY":"","curren":"","deg":"","divide":"","Eacute":"","eacute":"","Ecirc":"","ecirc":"","Egrave":"","egrave":"","ETH":"","eth":"","Euml":"","euml":"","frac12":"","frac14":"","frac34":"","gt":">","GT":">","Iacute":"","iacute":"","Icirc":"","icirc":"","iexcl":"","Igrave":"","igrave":"","iquest":"","Iuml":"","iuml":"","laquo":"","lt":"<","LT":"<","macr":"","micro":"","middot":"","nbsp":"","not":"","Ntilde":"","ntilde":"","Oacute":"","oacute":"","Ocirc":"","ocirc":"","Ograve":"","ograve":"","ordf":"","ordm":"","Oslash":"","oslash":"","Otilde":"","otilde":"","Ouml":"","ouml":"","para":"","plusmn":"","pound":"","quot":"\\"","QUOT":"\\"","raquo":"","reg":"","REG":"","sect":"","shy":"","sup1":"","sup2":"","sup3":"","szlig":"","THORN":"","thorn":"","times":"","Uacute":"","uacute":"","Ucirc":"","ucirc":"","Ugrave":"","ugrave":"","uml":"","Uuml":"","uuml":"","Yacute":"","yacute":"","yen":"","yuml":""}')},function(n){n.exports=JSON.parse(`{"amp":"&","apos":"'","gt":">","lt":"<","quot":"\\""}`)},function(n,t,e){var r=this&&this.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(e(265));function o(s){if(s>=55296&&s<=57343||s>1114111)return"";s in i.default&&(s=i.default[s]);var a="";return s>65535&&(s-=65536,a+=String.fromCharCode(s>>>10&1023|55296),s=56320|s&1023),a+=String.fromCharCode(s),a}t.default=o},function(n){n.exports=JSON.parse('{"0":65533,"128":8364,"130":8218,"131":402,"132":8222,"133":8230,"134":8224,"135":8225,"136":710,"137":8240,"138":352,"139":8249,"140":338,"142":381,"145":8216,"146":8217,"147":8220,"148":8221,"149":8226,"150":8211,"151":8212,"152":732,"153":8482,"154":353,"155":8250,"156":339,"158":382,"159":376}')},function(n,t,e){var r=this&&this.__importDefault||function(T){return T&&T.__esModule?T:{default:T}};Object.defineProperty(t,"__esModule",{value:!0}),t.escape=t.encodeHTML=t.encodeXML=void 0;var i=r(e(263)),o=p(i.default),s=c(o);t.encodeXML=I(o,s);var a=r(e(261)),l=p(a.default),u=c(l);t.encodeHTML=I(l,u);function p(T){return Object.keys(T).sort().reduce(function(h,m){return h[T[m]]="&"+m+";",h},{})}function c(T){for(var h=[],m=[],d=0,M=Object.keys(T);d<M.length;d++){var x=M[d];x.length===1?h.push("\\"+x):m.push(x)}h.sort();for(var E=0;E<h.length-1;E++){for(var P=E;P<h.length-1&&h[P].charCodeAt(1)+1===h[P+1].charCodeAt(1);)P+=1;var R=1+P-E;R<3||h.splice(E,R,h[E]+"-"+h[P])}return m.unshift("["+h.join("")+"]"),new RegExp(m.join("|"),"g")}var g=/(?:[\x80-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/g;function v(T){return"&#x"+T.codePointAt(0).toString(16).toUpperCase()+";"}function I(T,h){return function(m){return m.replace(h,function(d){return T[d]}).replace(g,v)}}var w=c(o);function y(T){return T.replace(w,v).replace(g,v)}t.escape=y},function(n){n.exports=JSON.parse('{"elementNames":{"altglyph":"altGlyph","altglyphdef":"altGlyphDef","altglyphitem":"altGlyphItem","animatecolor":"animateColor","animatemotion":"animateMotion","animatetransform":"animateTransform","clippath":"clipPath","feblend":"feBlend","fecolormatrix":"feColorMatrix","fecomponenttransfer":"feComponentTransfer","fecomposite":"feComposite","feconvolvematrix":"feConvolveMatrix","fediffuselighting":"feDiffuseLighting","fedisplacementmap":"feDisplacementMap","fedistantlight":"feDistantLight","fedropshadow":"feDropShadow","feflood":"feFlood","fefunca":"feFuncA","fefuncb":"feFuncB","fefuncg":"feFuncG","fefuncr":"feFuncR","fegaussianblur":"feGaussianBlur","feimage":"feImage","femerge":"feMerge","femergenode":"feMergeNode","femorphology":"feMorphology","feoffset":"feOffset","fepointlight":"fePointLight","fespecularlighting":"feSpecularLighting","fespotlight":"feSpotLight","fetile":"feTile","feturbulence":"feTurbulence","foreignobject":"foreignObject","glyphref":"glyphRef","lineargradient":"linearGradient","radialgradient":"radialGradient","textpath":"textPath"},"attributeNames":{"definitionurl":"definitionURL","attributename":"attributeName","attributetype":"attributeType","basefrequency":"baseFrequency","baseprofile":"baseProfile","calcmode":"calcMode","clippathunits":"clipPathUnits","diffuseconstant":"diffuseConstant","edgemode":"edgeMode","filterunits":"filterUnits","glyphref":"glyphRef","gradienttransform":"gradientTransform","gradientunits":"gradientUnits","kernelmatrix":"kernelMatrix","kernelunitlength":"kernelUnitLength","keypoints":"keyPoints","keysplines":"keySplines","keytimes":"keyTimes","lengthadjust":"lengthAdjust","limitingconeangle":"limitingConeAngle","markerheight":"markerHeight","markerunits":"markerUnits","markerwidth":"markerWidth","maskcontentunits":"maskContentUnits","maskunits":"maskUnits","numoctaves":"numOctaves","pathlength":"pathLength","patterncontentunits":"patternContentUnits","patterntransform":"patternTransform","patternunits":"patternUnits","pointsatx":"pointsAtX","pointsaty":"pointsAtY","pointsatz":"pointsAtZ","preservealpha":"preserveAlpha","preserveaspectratio":"preserveAspectRatio","primitiveunits":"primitiveUnits","refx":"refX","refy":"refY","repeatcount":"repeatCount","repeatdur":"repeatDur","requiredextensions":"requiredExtensions","requiredfeatures":"requiredFeatures","specularconstant":"specularConstant","specularexponent":"specularExponent","spreadmethod":"spreadMethod","startoffset":"startOffset","stddeviation":"stdDeviation","stitchtiles":"stitchTiles","surfacescale":"surfaceScale","systemlanguage":"systemLanguage","tablevalues":"tableValues","targetx":"targetX","targety":"targetY","textlength":"textLength","viewbox":"viewBox","viewtarget":"viewTarget","xchannelselector":"xChannelSelector","ychannelselector":"yChannelSelector","zoomandpan":"zoomAndPan"}}')},function(n,t){var e=t.getChildren=function(i){return i.children},r=t.getParent=function(i){return i.parent};t.getSiblings=function(i){var o=r(i);return o?e(o):[i]},t.getAttributeValue=function(i,o){return i.attribs&&i.attribs[o]},t.hasAttrib=function(i,o){return!!i.attribs&&hasOwnProperty.call(i.attribs,o)},t.getName=function(i){return i.name}},function(n,t){t.removeElement=function(e){if(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.parent){var r=e.parent.children;r.splice(r.lastIndexOf(e),1)}},t.replaceElement=function(e,r){var i=r.prev=e.prev;i&&(i.next=r);var o=r.next=e.next;o&&(o.prev=r);var s=r.parent=e.parent;if(s){var a=s.children;a[a.lastIndexOf(e)]=r}},t.appendChild=function(e,r){if(r.parent=e,e.children.push(r)!==1){var i=e.children[e.children.length-2];i.next=r,r.prev=i,r.next=null}},t.append=function(e,r){var i=e.parent,o=e.next;if(r.next=o,r.prev=e,e.next=r,r.parent=i,o){if(o.prev=r,i){var s=i.children;s.splice(s.lastIndexOf(o),0,r)}}else i&&i.children.push(r)},t.prepend=function(e,r){var i=e.parent;if(i){var o=i.children;o.splice(o.lastIndexOf(e),0,r)}e.prev&&(e.prev.next=r),r.parent=i,r.prev=e.prev,r.next=e,e.prev=r}},function(n,t,e){var r=e(256).isTag;n.exports={filter:i,find:o,findOneChild:s,findOne:a,existsOne:l,findAll:u};function i(p,c,g,v){return Array.isArray(c)||(c=[c]),(typeof v!="number"||!isFinite(v))&&(v=1/0),o(p,c,g!==!1,v)}function o(p,c,g,v){for(var I=[],w,y=0,T=c.length;y<T&&!(p(c[y])&&(I.push(c[y]),--v<=0)||(w=c[y].children,g&&w&&w.length>0&&(w=o(p,w,g,v),I=I.concat(w),v-=w.length,v<=0)));y++);return I}function s(p,c){for(var g=0,v=c.length;g<v;g++)if(p(c[g]))return c[g];return null}function a(p,c){for(var g=null,v=0,I=c.length;v<I&&!g;v++)if(r(c[v]))p(c[v])?g=c[v]:c[v].children.length>0&&(g=a(p,c[v].children));else continue;return g}function l(p,c){for(var g=0,v=c.length;g<v;g++)if(r(c[g])&&(p(c[g])||c[g].children.length>0&&l(p,c[g].children)))return!0;return!1}function u(p,c){for(var g=[],v=c.slice();v.length;){var I=v.shift();r(I)&&(I.children&&I.children.length>0&&v.unshift.apply(v,I.children),p(I)&&g.push(I))}return g}},function(n,t,e){var r=e(256),i=t.isTag=r.isTag;t.testElement=function(l,u){for(var p in l)if(l.hasOwnProperty(p)){if(p==="tag_name"){if(!i(u)||!l.tag_name(u.name))return!1}else if(p==="tag_type"){if(!l.tag_type(u.type))return!1}else if(p==="tag_contains"){if(i(u)||!l.tag_contains(u.data))return!1}else if(!u.attribs||!l[p](u.attribs[p]))return!1}return!0};var o={tag_name:function(l){return typeof l=="function"?function(u){return i(u)&&l(u.name)}:l==="*"?i:function(u){return i(u)&&u.name===l}},tag_type:function(l){return typeof l=="function"?function(u){return l(u.type)}:function(u){return u.type===l}},tag_contains:function(l){return typeof l=="function"?function(u){return!i(u)&&l(u.data)}:function(u){return!i(u)&&u.data===l}}};function s(l,u){return typeof u=="function"?function(p){return p.attribs&&u(p.attribs[l])}:function(p){return p.attribs&&p.attribs[l]===u}}function a(l,u){return function(p){return l(p)||u(p)}}t.getElements=function(l,u,p,c){var g=Object.keys(l).map(function(v){var I=l[v];return v in o?o[v](I):s(v,I)});return g.length===0?[]:this.filter(g.reduce(a),u,p,c)},t.getElementById=function(l,u,p){return Array.isArray(u)||(u=[u]),this.findOne(s("id",l),u,p!==!1)},t.getElementsByTagName=function(l,u,p,c){return this.filter(o.tag_name(l),u,p,c)},t.getElementsByTagType=function(l,u,p,c){return this.filter(o.tag_type(l),u,p,c)}},function(n,t){t.removeSubsets=function(i){for(var o=i.length,s,a,l;--o>-1;){for(s=a=i[o],i[o]=null,l=!0;a;){if(i.indexOf(a)>-1){l=!1,i.splice(o,1);break}a=a.parent}l&&(i[o]=s)}return i};var e={DISCONNECTED:1,PRECEDING:2,FOLLOWING:4,CONTAINS:8,CONTAINED_BY:16},r=t.compareDocumentPosition=function(i,o){var s=[],a=[],l,u,p,c,g,v;if(i===o)return 0;for(l=i;l;)s.unshift(l),l=l.parent;for(l=o;l;)a.unshift(l),l=l.parent;for(v=0;s[v]===a[v];)v++;return v===0?e.DISCONNECTED:(u=s[v-1],p=u.children,c=s[v],g=a[v],p.indexOf(c)>p.indexOf(g)?u===o?e.FOLLOWING|e.CONTAINED_BY:e.FOLLOWING:u===i?e.PRECEDING|e.CONTAINS:e.PRECEDING)};t.uniqueSort=function(i){var o=i.length,s,a;for(i=i.slice();--o>-1;)s=i[o],a=i.indexOf(s),a>-1&&a<o&&i.splice(o,1);return i.sort(function(l,u){var p=r(l,u);return p&e.PRECEDING?-1:p&e.FOLLOWING?1:0}),i}},function(n,t){n.exports={trueFunc:function(){return!0},falseFunc:function(){return!1}}},function(n,t,e){n.exports=g;var r=e(275).parse,i=e(273),o=e(278),s=e(279),a=e(280),l=e(282),u=i.trueFunc,p=i.falseFunc,c=l.filters;function g(N,b,j){var O=I(N,b,j);return v(O,b)}function v(N,b){var j=b.adapter;return function(L){return j.isTag(L)&&N(L)}}function I(N,b,j){var O=r(N,b);return M(O,b,j)}function w(N){return N.type==="pseudo"&&(N.name==="scope"||Array.isArray(N.data)&&N.data.some(function(b){return b.some(w)}))}var y={type:"descendant"},T={type:"_flexibleDescendant"},h={type:"pseudo",name:"scope"},m={};function d(N,b,j){var O=b.adapter,L=!!j&&!!j.length&&j.every(function(k){return k===m||!!O.getParent(k)});N.forEach(function(k){if(!(k.length>0&&x(k[0])&&k[0].type!=="descendant"))if(L&&!(Array.isArray(k)?k.some(w):w(k)))k.unshift(y);else return;k.unshift(h)})}function M(N,b,j){N=N.filter(function(H){return H.length>0}),N.forEach(o);var O=Array.isArray(j);j=b&&b.context||j,j&&!O&&(j=[j]),d(N,b,j);var L=!1,k=N.map(function(H){if(H[0]&&H[1]&&H[0].name==="scope"){var Q=H[1].type;O&&Q==="descendant"?H[1]=T:(Q==="adjacent"||Q==="sibling")&&(L=!0)}return E(H,b,j)}).reduce(P,p);return k.shouldTestNextSiblings=L,k}function x(N){return s[N.type]<0}function E(N,b,j){return N.reduce(function(O,L){if(O===p)return O;if(!(L.type in a))throw new Error("Rule type "+L.type+" is not supported by css-select");return a[L.type](O,L,b,j)},b&&b.rootFunc||u)}function P(N,b){return b===p||N===u?N:N===p||b===u?b:function(O){return N(O)||b(O)}}function R(N){return N.some(x)}c.not=function(N,b,j,O){var L={xmlMode:!!(j&&j.xmlMode),strict:!!(j&&j.strict),adapter:j.adapter};if(L.strict&&(b.length>1||b.some(R)))throw new Error("complex selectors in :not aren't allowed in strict mode");var k=M(b,L,O);return k===p?N:k===u?p:function(Q){return!k(Q)&&N(Q)}},c.has=function(N,b,j){var O=j.adapter,L={xmlMode:!!(j&&j.xmlMode),strict:!!(j&&j.strict),adapter:O},k=b.some(R)?[m]:null,H=M(b,L,k);return H===p?p:H===u?function(_){return O.getChildren(_).some(O.isTag)&&N(_)}:(H=v(H,j),k?function(_){return N(_)&&(k[0]=_,O.existsOne(H,O.getChildren(_)))}:function(_){return N(_)&&O.existsOne(H,O.getChildren(_))})},c.matches=function(N,b,j,O){var L={xmlMode:!!(j&&j.xmlMode),strict:!!(j&&j.strict),rootFunc:N,adapter:j.adapter};return M(b,L,O)},g.compileToken=M,g.compileUnsafe=I,g.Pseudos=l},function(n,t,e){var r=this&&this.__createBinding||(Object.create?function(a,l,u,p){p===void 0&&(p=u),Object.defineProperty(a,p,{enumerable:!0,get:function(){return l[u]}})}:function(a,l,u,p){p===void 0&&(p=u),a[p]=l[u]}),i=this&&this.__exportStar||function(a,l){for(var u in a)u!=="default"&&!l.hasOwnProperty(u)&&r(l,a,u)};Object.defineProperty(t,"__esModule",{value:!0}),i(e(276),t);var o=e(276);Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return o.default}});var s=e(277);Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return s.default}})},function(n,t,e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=w;var r=/^[^\\]?(?:\\(?:[\da-f]{1,6}\s?|.)|[\w\-\u00b0-\uFFFF])+/,i=/\\([\da-f]{1,6}\s?|(\s)|.)/gi,o=/^\s*((?:\\.|[\w\u00b0-\uFFFF-])+)\s*(?:(\S?)=\s*(?:(['"])([^]*?)\3|(#?(?:\\.|[\w\u00b0-\uFFFF-])*)|)|)\s*(i)?\]/,s={undefined:"exists","":"equals","~":"element","^":"start",$:"end","*":"any","!":"not","|":"hyphen"},a={">":"child","<":"parent","~":"sibling","+":"adjacent"},l={"#":["id","equals"],".":["class","element"]},u=new Set(["has","not","matches"]),p=new Set(["contains","icontains"]),c=new Set(['"',"'"]);function g(h,m,d){var M=parseInt(m,16)-65536;return M!==M||d?m:M<0?String.fromCharCode(M+65536):String.fromCharCode(M>>10|55296,M&1023|56320)}function v(h){return h.replace(i,g)}function I(h){return h===" "||h===`
`||h==="	"||h==="\f"||h==="\r"}function w(h,m){var d=[];if(h=y(d,""+h,m),h!=="")throw new Error("Unmatched selector: "+h);return d}function y(h,m,d){var M=[],x=!1;function E(){var tt=m.match(r);if(!tt)throw new Error("Expected name, found "+m);var ct=tt[0];return m=m.substr(ct.length),v(ct)}function P(tt){for(;I(m.charAt(tt));)tt++;m=m.substr(tt)}function R(tt){for(var ct=0;m.charAt(--tt)==="\\";)ct++;return(ct&1)===1}for(P(0);m!=="";){var N=m.charAt(0);if(I(N))x=!0,P(1);else if(N in a)M.push({type:a[N]}),x=!1,P(1);else if(N===","){if(M.length===0)throw new Error("Empty sub-selector");h.push(M),M=[],x=!1,P(1)}else if(x&&(M.length>0&&M.push({type:"descendant"}),x=!1),N==="*")m=m.substr(1),M.push({type:"universal"});else if(N in l){var b=l[N],j=b[0],O=b[1];m=m.substr(1),M.push({type:"attribute",name:j,action:O,value:E(),ignoreCase:!1})}else if(N==="["){m=m.substr(1);var L=m.match(o);if(!L)throw new Error("Malformed attribute selector: "+m);m=m.substr(L[0].length);var k=v(L[1]);(!d||("lowerCaseAttributeNames"in d?d.lowerCaseAttributeNames:!d.xmlMode))&&(k=k.toLowerCase()),M.push({type:"attribute",name:k,action:s[L[2]],value:v(L[4]||L[5]||""),ignoreCase:!!L[6]})}else if(N===":"){if(m.charAt(1)===":"){m=m.substr(2),M.push({type:"pseudo-element",name:E().toLowerCase()});continue}m=m.substr(1);var H=E().toLowerCase(),L=null;if(m.charAt(0)==="(")if(u.has(H)){var Q=m.charAt(1),_=c.has(Q);if(m=m.substr(_?2:1),L=[],m=y(L,m,d),_){if(m.charAt(0)!==Q)throw new Error("Unmatched quotes in :"+H);m=m.substr(1)}if(m.charAt(0)!==")")throw new Error("Missing closing parenthesis in :"+H+" ("+m+")");m=m.substr(1)}else{for(var st=1,F=1;F>0&&st<m.length;st++)m.charAt(st)==="("&&!R(st)?F++:m.charAt(st)===")"&&!R(st)&&F--;if(F)throw new Error("Parenthesis not matched");if(L=m.substr(1,st-2),m=m.substr(st),p.has(H)){var Q=L.charAt(0);Q===L.slice(-1)&&c.has(Q)&&(L=L.slice(1,-1)),L=v(L)}}M.push({type:"pseudo",name:H,data:L})}else if(r.test(m)){var Z=E();(!d||("lowerCaseTags"in d?d.lowerCaseTags:!d.xmlMode))&&(Z=Z.toLowerCase()),M.push({type:"tag",name:Z})}else return M.length&&M[M.length-1].type==="descendant"&&M.pop(),T(h,M),m}return T(h,M),m}function T(h,m){if(h.length>0&&m.length===0)throw new Error("Empty sub-selector");h.push(m)}},function(n,t,e){Object.defineProperty(t,"__esModule",{value:!0});var r={equals:"",element:"~",start:"^",end:"$",any:"*",not:"!",hyphen:"|"};function i(l){return l.map(o).join(", ")}t.default=i;function o(l){return l.map(s).join("")}function s(l){switch(l.type){case"child":return" > ";case"parent":return" < ";case"sibling":return" ~ ";case"adjacent":return" + ";case"descendant":return" ";case"universal":return"*";case"tag":return l.name;case"pseudo-element":return"::"+l.name;case"pseudo":return l.data===null?":"+l.name:typeof l.data=="string"?":"+l.name+"("+l.data+")":":"+l.name+"("+i(l.data)+")";case"attribute":return l.action==="exists"?"["+l.name+"]":l.name==="id"&&l.action==="equals"&&!l.ignoreCase?"#"+l.value:l.name==="class"&&l.action==="element"&&!l.ignoreCase?"."+l.value:"["+l.name+r[l.action]+"='"+l.value+"'"+(l.ignoreCase?"i":"")+"]";default:throw new Error("Unknown type")}}function a(l){return l}},function(n,t,e){n.exports=o;var r=e(279),i={__proto__:null,exists:10,equals:8,not:7,start:6,end:6,any:5,hyphen:4,element:4};function o(a){for(var l=a.map(s),u=1;u<a.length;u++){var p=l[u];if(!(p<0))for(var c=u-1;c>=0&&p<l[c];c--){var g=a[c+1];a[c+1]=a[c],a[c]=g,l[c+1]=l[c],l[c]=p}}}function s(a){var l=r[a.type];if(l===r.attribute)l=i[a.action],l===i.equals&&a.name==="id"&&(l=9),a.ignoreCase&&(l>>=1);else if(l===r.pseudo)if(!a.data)l=3;else if(a.name==="has"||a.name==="contains")l=0;else if(a.name==="matches"||a.name==="not"){l=0;for(var u=0;u<a.data.length;u++)if(a.data[u].length===1){var p=s(a.data[u][0]);if(p===0){l=0;break}p>l&&(l=p)}a.data.length>1&&l>0&&(l-=1)}else l=1;return l}},function(n){n.exports=JSON.parse('{"universal":50,"tag":30,"attribute":1,"pseudo":0,"descendant":-1,"child":-1,"parent":-1,"sibling":-1,"adjacent":-1}')},function(n,t,e){var r=e(281),i=e(282);n.exports={__proto__:null,attribute:r.compile,pseudo:i.compile,tag:function(o,s,a){var l=s.name,u=a.adapter;return function(c){return u.getName(c)===l&&o(c)}},descendant:function(o,s,a){var l=typeof WeakSet<"u"?new WeakSet:null,u=a.adapter;return function(c){for(var g=!1;!g&&(c=u.getParent(c));)(!l||!l.has(c))&&(g=o(c),!g&&l&&l.add(c));return g}},_flexibleDescendant:function(o,s,a){var l=a.adapter;return function(p){for(var c=o(p);!c&&(p=l.getParent(p));)c=o(p);return c}},parent:function(o,s,a){if(a&&a.strict)throw new Error("Parent selector isn't part of CSS3");var l=a.adapter;return function(c){return l.getChildren(c).some(u)};function u(p){return l.isTag(p)&&o(p)}},child:function(o,s,a){var l=a.adapter;return function(p){var c=l.getParent(p);return!!c&&o(c)}},sibling:function(o,s,a){var l=a.adapter;return function(p){for(var c=l.getSiblings(p),g=0;g<c.length;g++)if(l.isTag(c[g])){if(c[g]===p)break;if(o(c[g]))return!0}return!1}},adjacent:function(o,s,a){var l=a.adapter;return function(p){for(var c=l.getSiblings(p),g,v=0;v<c.length;v++)if(l.isTag(c[v])){if(c[v]===p)break;g=c[v]}return!!g&&o(g)}},universal:function(o){return o}}},function(n,t,e){var r=e(273).falseFunc,i=/[-[\]{}()*+?.,\\^$|#\s]/g,o={__proto__:null,equals:function(s,a,l){var u=a.name,p=a.value,c=l.adapter;return a.ignoreCase?(p=p.toLowerCase(),function(v){var I=c.getAttributeValue(v,u);return I!=null&&I.toLowerCase()===p&&s(v)}):function(v){return c.getAttributeValue(v,u)===p&&s(v)}},hyphen:function(s,a,l){var u=a.name,p=a.value,c=p.length,g=l.adapter;return a.ignoreCase?(p=p.toLowerCase(),function(I){var w=g.getAttributeValue(I,u);return w!=null&&(w.length===c||w.charAt(c)==="-")&&w.substr(0,c).toLowerCase()===p&&s(I)}):function(I){var w=g.getAttributeValue(I,u);return w!=null&&w.substr(0,c)===p&&(w.length===c||w.charAt(c)==="-")&&s(I)}},element:function(s,a,l){var u=a.name,p=a.value,c=l.adapter;if(/\s/.test(p))return r;p=p.replace(i,"\\$&");var g="(?:^|\\s)"+p+"(?:$|\\s)",v=a.ignoreCase?"i":"",I=new RegExp(g,v);return function(y){var T=c.getAttributeValue(y,u);return T!=null&&I.test(T)&&s(y)}},exists:function(s,a,l){var u=a.name,p=l.adapter;return function(g){return p.hasAttrib(g,u)&&s(g)}},start:function(s,a,l){var u=a.name,p=a.value,c=p.length,g=l.adapter;return c===0?r:a.ignoreCase?(p=p.toLowerCase(),function(I){var w=g.getAttributeValue(I,u);return w!=null&&w.substr(0,c).toLowerCase()===p&&s(I)}):function(I){var w=g.getAttributeValue(I,u);return w!=null&&w.substr(0,c)===p&&s(I)}},end:function(s,a,l){var u=a.name,p=a.value,c=-p.length,g=l.adapter;return c===0?r:a.ignoreCase?(p=p.toLowerCase(),function(I){var w=g.getAttributeValue(I,u);return w!=null&&w.substr(c).toLowerCase()===p&&s(I)}):function(I){var w=g.getAttributeValue(I,u);return w!=null&&w.substr(c)===p&&s(I)}},any:function(s,a,l){var u=a.name,p=a.value,c=l.adapter;if(p==="")return r;if(a.ignoreCase){var g=new RegExp(p.replace(i,"\\$&"),"i");return function(I){var w=c.getAttributeValue(I,u);return w!=null&&g.test(w)&&s(I)}}return function(I){var w=c.getAttributeValue(I,u);return w!=null&&w.indexOf(p)>=0&&s(I)}},not:function(s,a,l){var u=a.name,p=a.value,c=l.adapter;return p===""?function(v){return!!c.getAttributeValue(v,u)&&s(v)}:a.ignoreCase?(p=p.toLowerCase(),function(v){var I=c.getAttributeValue(v,u);return I!=null&&I.toLowerCase()!==p&&s(v)}):function(v){return c.getAttributeValue(v,u)!==p&&s(v)}}};n.exports={compile:function(s,a,l){if(l&&l.strict&&(a.ignoreCase||a.action==="not"))throw new Error("Unsupported attribute selector");return o[a.action](s,a,l)},rules:o}},function(n,t,e){var r=e(283),i=e(273),o=e(281),s=i.trueFunc,a=i.falseFunc,l=o.rules.equals;function u(T,h){var m={name:T,value:h};return function(M,x,E){return l(M,m,E)}}function p(T,h){return function(m){return!!h.getParent(m)&&T(m)}}var c={contains:function(T,h,m){var d=m.adapter;return function(x){return T(x)&&d.getText(x).indexOf(h)>=0}},icontains:function(T,h,m){var d=h.toLowerCase(),M=m.adapter;return function(E){return T(E)&&M.getText(E).toLowerCase().indexOf(d)>=0}},"nth-child":function(T,h,m){var d=r(h),M=m.adapter;return d===a?d:d===s?p(T,M):function(E){for(var P=M.getSiblings(E),R=0,N=0;R<P.length;R++)if(M.isTag(P[R])){if(P[R]===E)break;N++}return d(N)&&T(E)}},"nth-last-child":function(T,h,m){var d=r(h),M=m.adapter;return d===a?d:d===s?p(T,M):function(E){for(var P=M.getSiblings(E),R=0,N=P.length-1;N>=0;N--)if(M.isTag(P[N])){if(P[N]===E)break;R++}return d(R)&&T(E)}},"nth-of-type":function(T,h,m){var d=r(h),M=m.adapter;return d===a?d:d===s?p(T,M):function(E){for(var P=M.getSiblings(E),R=0,N=0;N<P.length;N++)if(M.isTag(P[N])){if(P[N]===E)break;M.getName(P[N])===M.getName(E)&&R++}return d(R)&&T(E)}},"nth-last-of-type":function(T,h,m){var d=r(h),M=m.adapter;return d===a?d:d===s?p(T,M):function(E){for(var P=M.getSiblings(E),R=0,N=P.length-1;N>=0;N--)if(M.isTag(P[N])){if(P[N]===E)break;M.getName(P[N])===M.getName(E)&&R++}return d(R)&&T(E)}},root:function(T,h,m){var d=m.adapter;return function(M){return!d.getParent(M)&&T(M)}},scope:function(T,h,m,d){var M=m.adapter;if(!d||d.length===0)return c.root(T,h,m);function x(E,P){return typeof M.equals=="function"?M.equals(E,P):E===P}return d.length===1?function(E){return x(d[0],E)&&T(E)}:function(E){return d.indexOf(E)>=0&&T(E)}},checkbox:u("type","checkbox"),file:u("type","file"),password:u("type","password"),radio:u("type","radio"),reset:u("type","reset"),image:u("type","image"),submit:u("type","submit"),hover:function(T,h,m){var d=m.adapter;return typeof d.isHovered=="function"?function(x){return T(x)&&d.isHovered(x)}:a},visited:function(T,h,m){var d=m.adapter;return typeof d.isVisited=="function"?function(x){return T(x)&&d.isVisited(x)}:a},active:function(T,h,m){var d=m.adapter;return typeof d.isActive=="function"?function(x){return T(x)&&d.isActive(x)}:a}};function g(T,h){for(var m=0;T&&m<T.length;m++)if(h.isTag(T[m]))return T[m]}var v={empty:function(T,h){return!h.getChildren(T).some(function(m){return h.isTag(m)||m.type==="text"})},"first-child":function(T,h){return g(h.getSiblings(T),h)===T},"last-child":function(T,h){for(var m=h.getSiblings(T),d=m.length-1;d>=0;d--){if(m[d]===T)return!0;if(h.isTag(m[d]))break}return!1},"first-of-type":function(T,h){for(var m=h.getSiblings(T),d=0;d<m.length;d++)if(h.isTag(m[d])){if(m[d]===T)return!0;if(h.getName(m[d])===h.getName(T))break}return!1},"last-of-type":function(T,h){for(var m=h.getSiblings(T),d=m.length-1;d>=0;d--)if(h.isTag(m[d])){if(m[d]===T)return!0;if(h.getName(m[d])===h.getName(T))break}return!1},"only-of-type":function(T,h){for(var m=h.getSiblings(T),d=0,M=m.length;d<M;d++)if(h.isTag(m[d])){if(m[d]===T)continue;if(h.getName(m[d])===h.getName(T))return!1}return!0},"only-child":function(T,h){for(var m=h.getSiblings(T),d=0;d<m.length;d++)if(h.isTag(m[d])&&m[d]!==T)return!1;return!0},link:function(T,h){return h.hasAttrib(T,"href")},selected:function(T,h){if(h.hasAttrib(T,"selected"))return!0;if(h.getName(T)!=="option")return!1;var m=h.getParent(T);if(!m||h.getName(m)!=="select"||h.hasAttrib(m,"multiple"))return!1;for(var d=h.getChildren(m),M=!1,x=0;x<d.length;x++)if(h.isTag(d[x]))if(d[x]===T)M=!0;else if(M){if(h.hasAttrib(d[x],"selected"))return!1}else return!1;return M},disabled:function(T,h){return h.hasAttrib(T,"disabled")},enabled:function(T,h){return!h.hasAttrib(T,"disabled")},checked:function(T,h){return h.hasAttrib(T,"checked")||v.selected(T,h)},required:function(T,h){return h.hasAttrib(T,"required")},optional:function(T,h){return!h.hasAttrib(T,"required")},parent:function(T,h){return!v.empty(T,h)},header:I(["h1","h2","h3","h4","h5","h6"]),button:function(T,h){var m=h.getName(T);return m==="button"||m==="input"&&h.getAttributeValue(T,"type")==="button"},input:I(["input","textarea","select","button"]),text:function(T,h){var m;return h.getName(T)==="input"&&(!(m=h.getAttributeValue(T,"type"))||m.toLowerCase()==="text")}};function I(T){if(typeof Set<"u"){var h=new Set(T);return function(m,d){return h.has(d.getName(m))}}return function(m,d){return T.indexOf(d.getName(m))>=0}}function w(T,h,m){if(m===null){if(T.length>2&&h!=="scope")throw new Error("pseudo-selector :"+h+" requires an argument")}else if(T.length===2)throw new Error("pseudo-selector :"+h+" doesn't have any arguments")}var y=/^(?:(?:nth|last|first|only)-(?:child|of-type)|root|empty|(?:en|dis)abled|checked|not)$/;n.exports={compile:function(T,h,m,d){var M=h.name,x=h.data,E=m.adapter;if(m&&m.strict&&!y.test(M))throw new Error(":"+M+" isn't part of CSS3");if(typeof c[M]=="function")return c[M](T,x,m,d);if(typeof v[M]=="function"){var P=v[M];return w(P,M,x),P===a?P:T===s?function(N){return P(N,E,x)}:function(N){return P(N,E,x)&&T(N)}}else throw new Error("unmatched pseudo-class :"+M)},filters:c,pseudos:v}},function(n,t,e){var r=e(284),i=e(285);n.exports=function(s){return i(r(s))},n.exports.parse=r,n.exports.compile=i},function(n,t){n.exports=r;var e=/^([+\-]?\d*n)?\s*(?:([+\-]?)\s*(\d+))?$/;function r(i){if(i=i.trim().toLowerCase(),i==="even")return[2,0];if(i==="odd")return[2,1];var o=i.match(e);if(!o)throw new SyntaxError("n-th rule couldn't be parsed ('"+i+"')");var s;return o[1]?(s=parseInt(o[1],10),isNaN(s)&&(o[1].charAt(0)==="-"?s=-1:s=1)):s=0,[s,o[3]?parseInt((o[2]||"")+o[3],10):0]}},function(n,t,e){n.exports=s;var r=e(273),i=r.trueFunc,o=r.falseFunc;function s(a){var l=a[0],u=a[1]-1;if(u<0&&l<=0)return o;if(l===-1)return function(c){return c<=u};if(l===0)return function(c){return c===u};if(l===1)return u<0?i:function(c){return c>=u};var p=u%l;return p<0&&(p+=l),l>1?function(c){return c>=u&&c%l===p}:(l*=-1,function(c){return c<=u&&c%l===p})}},function(n,t,e){e.r(t),e.d(t,"default",function(){return x});var r=e(12),i=e(74),o=e(1),s=e(68),a=e(250),l=e(213),u=e(218);e(1).glMatrix.setMatrixArrayType(Array);function p(E,P){if(E==null)return{};var R=c(E,P),N,b;if(Object.getOwnPropertySymbols){var j=Object.getOwnPropertySymbols(E);for(b=0;b<j.length;b++)N=j[b],!(P.indexOf(N)>=0)&&Object.prototype.propertyIsEnumerable.call(E,N)&&(R[N]=E[N])}return R}function c(E,P){if(E==null)return{};var R={},N=Object.keys(E),b,j;for(j=0;j<N.length;j++)b=N[j],!(P.indexOf(b)>=0)&&(R[b]=E[b]);return R}const g={antialias:!0,autoRender:!0,alpha:!0},v=Symbol("autoRender"),I=Symbol("renderer"),w=Symbol("timeline"),y=Symbol("prepareRender"),T=Symbol("tickRender"),h=Symbol("pass"),m=Symbol("fbo"),d=Symbol("tickers"),M=Symbol("layerTransformInvert");class x extends a.default{constructor(P={}){if(super(),!P.canvas){const{width:j,height:O}=this.getResolution(),L=r.ENV.createCanvas(j,O,{offscreen:!!P.offscreen,id:P.id,extra:P.extra});L.style&&(L.style.position="absolute"),L.dataset&&(L.dataset.layerId=P.id),L.contextType&&(P.contextType=L.contextType),P.canvas=L}const R=P.canvas,N=Object.assign({},g,P);this[v]=N.autoRender,delete P.autoRender;const b=N.Renderer||r.Renderer;this[I]=new b(R,N),this.options=P,this.id=P.id,this[h]=[],this.setResolution(R),this.canvas=R,this[w]=new i.Timeline,this.__mouseCapturedTarget=null,this[M]=null}get autoRender(){return this[v]}get displayRatio(){return this.parent&&this.parent.options?this.parent.options.displayRatio:1}get height(){const{height:P}=this.getResolution();return P/this.displayRatio}get gl(){return this.renderer.glRenderer?this.renderer.glRenderer.gl:null}get layer(){return this}get offscreen(){return!!this.options.offscreen||this.canvas._offscreen}get pass(){return this[h]}get prepareRender(){return this[y]?this[y]:Promise.resolve()}get renderer(){return this[I]}get renderOffset(){if(this.parent&&this.parent.options){const{left:P,top:R}=this.parent.options;return[P,R]}return[this.options.left|0,this.options.top|0]}get timeline(){return this[w]}get width(){const{width:P}=this.getResolution();return P/this.displayRatio}get localMatrix(){const{x:P,y:R}=this.attributes;return[1,0,0,1,P,R]}get layerTransformInvert(){if(this[M])return this[M];const P=this.transformMatrix;return P[0]===1&&P[1]===0&&P[2]===0&&P[3]===1&&P[4]===0&&P[5]===0?null:(this[M]=o.mat2d.invert(Array.of(0,0,0,0,0,0),P),this[M])}forceContextLoss(){const P=this.renderer.glRenderer;if(P){const R=P.getExtension("WEBGL_lose_context");if(R)return R.loseContext(),!0}return!1}addPass({vertex:P,fragment:R,options:N,uniforms:b}={}){if(this.renderer.glRenderer){const{width:j,height:O}=this.getResolution(),L=this.renderer.createPassProgram({vertex:P,fragment:R,options:N}),k=new r.Figure2D;k.rect(0,0,j/this.displayRatio,O/this.displayRatio);const H=new r.Mesh2D(k);return H.setUniforms(b),H.setProgram(L),this[h].push(H),this.forceUpdate(),H}return null}deleteTexture(P){return Object(u.deleteTexture)(P,this.renderer)}dispatchPointerEvent(P){const R=P.type;if(R==="mousedown"||R==="mouseup"||R==="mousemove"){const L=this.__mouseCapturedTarget;if(L){if(L.layer===this)return L.dispatchEvent(P),!0;this.__mouseCapturedTarget=null}}let N,b;const j=this.layerTransformInvert;if(j){N=P.x,b=P.y;const L=j,k=L[0]*N+L[2]*b+L[4],H=L[1]*N+L[3]*b+L[5];delete P.x,delete P.y,delete P.layerX,delete P.layerY,Object.defineProperties(P,{layerX:{value:k,configurable:!0},layerY:{value:H,configurable:!0},x:{value:k,configurable:!0},y:{value:H,configurable:!0}})}const O=super.dispatchPointerEvent(P);return j&&Object.defineProperties(P,{layerX:{value:N,configurable:!0},layerY:{value:b,configurable:!0},x:{value:N,configurable:!0},y:{value:b,configurable:!0}}),O}forceUpdate(){if(!this[y])if(this.parent&&this.parent.hasOffscreenCanvas){this.parent.forceUpdate();let P=null;const R=new Promise(N=>{P=N});R._resolve=P,this[y]=R}else{let P=null,R=null;const N=new Promise(b=>{P=b,this[v]&&(R=Object(s.requestAnimationFrame)(()=>{delete N._requestID,this.render()}))});N._resolve=P,N._requestID=R,this[y]=N}}getFBO(){const P=this.renderer.glRenderer,{width:R,height:N}=this.getResolution();return P&&(!this[m]||this[m].width!==R||this[m].height!==N)?(this[m]={width:R,height:N,target:P.createFBO(),buffer:P.createFBO(),swap(){[this.target,this.buffer]=[this.buffer,this.target]}},this[m]):this[m]?this[m]:null}updateGlobalTransform(){if(this.layerTransformInvert){const P=this.renderer,R=P.__globalTransformMatrix||P.globalTransformMatrix;P.__globalTransformMatrix=R;const N=o.mat2d.fromValues(1,0,0,1,0,0);P.setGlobalTransform(...o.mat2d.multiply(N,R,this.transformMatrix))}}onPropertyChange(P,R,N){if(super.onPropertyChange(P,R,N),P==="zIndex"&&(this.canvas.style.zIndex=R),P==="transform"||P==="translate"||P==="rotate"||P==="scale"||P==="skew"){const b=this[M];if(this[M]=null,this.updateGlobalTransform(),b&&!this.layerTransformInvert){const j=this.renderer,O=j.__globalTransformMatrix||j.globalTransformMatrix;j.setGlobalTransform(...O)}}}_prepareRenderFinished(){this[y]&&(this[y]._requestID&&Object(s.cancelAnimationFrame)(this[y]._requestID),this[y]._resolve(),delete this[y])}render({clear:P=!0}={}){const R=this[h].length?this.getFBO():null;R&&this.renderer.glRenderer.bindFBO(R.target),P&&this[I].clear();const N=this.draw();if(N&&N.length&&(this.renderer.drawMeshes(N),this.canvas.draw&&this.canvas.draw()),R){const b=this.renderer.glRenderer,j=this[h].length,{width:O,height:L}=this.getResolution(),k=[0,0,O/this.displayRatio,L/this.displayRatio];this[h].forEach((H,Q)=>{H.blend=!0,H.setTexture(R.target.texture,{rect:k}),Q===j-1?b.bindFBO(null):(R.swap(),b.bindFBO(R.target)),this[I].clear(),this.renderer.drawMeshes([H])})}this._prepareRenderFinished()}setResolution({width:P,height:R}){const N=this.renderer,b=N.__globalTransformMatrix||N.globalTransformMatrix,j=b[4],O=b[5],L=b[0],{width:k,height:H}=this.getResolution();(k!==P||H!==R)&&(super.setResolution({width:P,height:R}),this.canvas&&(this.canvas.width=P,this.canvas.height=R,N.updateResolution&&N.updateResolution()),this.attributes.size=[P,R],this[h].length&&this[h].forEach(F=>{const Z=new r.Figure2D;Z.rect(0,0,P/this.displayRatio,R/this.displayRatio),F.contours=Z.contours}));const[Q,_]=this.renderOffset,st=this.displayRatio;(j!==Q||O!==_||L!==st)&&(N.setGlobalTransform(st,0,0,st,Q,_),N.__globalTransformMatrix=null,this[M]=null,this.updateGlobalTransform(),this.forceUpdate())}tick(P=null,R={}){let{duration:N=1/0}=R,b=p(R,["duration"]);const j=this.timeline.fork(b),O=this;this[d]=this[d]||[],this[d].push({handler:P,duration:N});const L=()=>{let k=null,H=null;const Q=()=>{const _=this[d].map(({handler:st,duration:F})=>{const Z=Math.min(1,j.currentTime/F);return{value:st?st(j.currentTime,Z):null,p:Z}});O[T]||(O[T]=Promise.resolve().then(()=>{O[v]&&O.render(),delete O[T];for(let st=_.length-1;st>=0;st--){const{value:F,p:Z}=_[st];(F===!1||Z>=1)&&this[d].splice(st,1)}this[d].length>0&&L()}))};if(this[y]&&this[y]._type!=="ticker"&&(Object(s.cancelAnimationFrame)(this[y]._requestID),delete this[y]),!this[y]){const _=new Promise(st=>{k=st,H=Object(s.requestAnimationFrame)(Q)});_._resolve=k,_._requestID=H,_._type="ticker",this[y]=_}};L()}toGlobalPos(P,R){if(this.layerTransformInvert){const k=this.transformMatrix;P=k[0]*P+k[2]*R+k[4],R=k[1]*P+k[3]*R+k[5]}const{width:N,height:b}=this.getResolution(),j=this.renderOffset,O=[this.canvas.clientWidth,this.canvas.clientHeight];P=P*O[0]/N+j[0],R=R*O[1]/b+j[1];const L=this.displayRatio;return P*=L,R*=L,[P,R]}toLocalPos(P,R){const{width:N,height:b}=this.getResolution(),j=this.renderOffset,O=[this.canvas.clientWidth,this.canvas.clientHeight];P=P*N/O[0]-j[0],R=R*b/O[1]-j[1];const L=this.displayRatio;P/=L,R/=L;const k=this.layerTransformInvert;return k&&(P=k[0]*P+k[2]*R+k[4],R=k[1]*P+k[3]*R+k[5]),[P,R]}}l.default.registerNode(x,"layer")},function(n,t,e){e.r(t),e.d(t,"default",function(){return y});var r=e(224),i=e(288),o=e(213),s=e(252),a=e(72);e(1).glMatrix.setMatrixArrayType(Array);function l(T,h){if(T==null)return{};var m=u(T,h),d,M;if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(T);for(M=0;M<x.length;M++)d=x[M],!(h.indexOf(d)>=0)&&Object.prototype.propertyIsEnumerable.call(T,d)&&(m[d]=T[d])}return m}function u(T,h){if(T==null)return{};var m={},d=Object.keys(T),M,x;for(x=0;x<d.length;x++)M=d[x],!(h.indexOf(M)>=0)&&(m[M]=T[M]);return m}function p(T,h,m){return h in T?Object.defineProperty(T,h,{value:m,enumerable:!0,configurable:!0,writable:!0}):T[h]=m,T}const c="http://www.w3.org/2000/svg",g=Symbol.for("spritejs_setAttribute"),v=Symbol("root"),I=Symbol("task");function w(T,h=!0){const m=T[v];if(m&&m.children[0]){const d=T.svg,M=T.layer?T.layer.displayRatio:1;if(!d.hasAttribute("data-original-width")){let P=d.getAttribute("width");P=P?Object(a.sizeToPixel)(P):300;let R=d.getAttribute("height");R=R?Object(a.sizeToPixel)(R):150,d.hasAttribute("viewBox")||d.setAttribute("viewBox",`0 0 ${Math.round(P)} ${Math.round(R)}`),d.setAttribute("data-original-width",P),d.setAttribute("data-original-height",R)}let x=T.attributes.width||Number(d.getAttribute("data-original-width")),E=T.attributes.height||Number(d.getAttribute("data-original-height"));if(x*=M,E*=M,h&&T.attributes.flexible){const P=T.attributes.scale[0];if(x*=P,E*=P,d.setAttribute("width",x),d.setAttribute("height",E),x&&E&&T.textureImage){const R=T.textureImage.width,N=T.textureImage.height,b=T.clientSize;T.attributes.textureRect=[0,0,Math.round(b[0]*R/x),Math.round(b[1]*N/E)]}}else T[I]||(d.setAttribute("width",x),d.setAttribute("height",E),T[I]=Promise.resolve().then(()=>{delete T[I];const P=m.innerHTML,R=new Blob([P],{type:"image/svg+xml"}),N=URL.createObjectURL(R),b=new Image;b.onload=function(){b.width&&b.height?(T.attributes[g]("texture",b),T.attributes.flexible&&(T.attributes.textureRect=null)):T.attributes[g]("texture",null)},b.src=N}))}}class y extends r.default{constructor(h={}){typeof h=="string"&&(h={svgText:h});let{svgText:m}=h,d=l(h,["svgText"]);if(super(d),this[v]=document.createElement("div"),m){this[v].innerHTML=m;const M=this[v].children[0];M?M.setAttribute("xmlns",c):(fetch(m).then(x=>x.text()).then(x=>{this[v].innerHTML=x,(!this.observer||this.attributes.flexible)&&w(this)}),m=null)}if(!m){const M=document.createElementNS(c,"svg");M.setAttribute("xmlns",c),this[v].appendChild(M)}if(typeof MutationObserver=="function"){const M=new MutationObserver(x=>{w(this,!1)});M.observe(this[v],{attributes:!0,subtree:!0,characterData:!0,childList:!0}),this.observer=M}}get children(){return[this.svg]}get childNodes(){return[this.svg]}get svg(){return this[v]?this[v].children[0]:null}setResolution({width:h,height:m}){super.setResolution({width:h,height:m}),w(this)}dispatchPointerEvent(h){const m=super.dispatchPointerEvent(h);if(m&&this.attributes.passEvents&&typeof MouseEvent=="function"){const{x:d,y:M}=h;let[x,E]=this.getOffsetPosition(d,M);const P=h.originalEvent,R=this.attributes.anchor,N=this.clientSize;x=(x+R[0]*N[0])/2,E=(E+R[1]*N[1])/2;const b=h.type;if(b===P.type){let j=null;if(P instanceof MouseEvent)j=new MouseEvent(b,{screenX:x,screenY:E,clientX:x,clientY:E,bubbles:P.bubbles,button:P.button,buttons:P.buttons,cancelBubble:P.cancelBubble,cancelable:P.cancelable,currentTarget:P.currentTarget,fromElement:P.fromElement,relatedTarget:P.relatedTarget,returnValue:P.returnValue,srcElement:P.srcElement,target:P.target,toElement:P.toElement,which:P.witch});else if(P instanceof TouchEvent){let O=null;const L=P.changedTouches||[P];for(let k=0;k<L.length;k++){const H=L[k];if(h.identifier===H.identifier){O=H;break}}if(O){const k=new Touch({identifier:O.identifier,target:O.target,clientX:x,clientY:E,screenX:x,screenY:E,pageX:x,pageY:E,radiusX:O.radiusX,radiusY:O.radiusY,rotationAngle:O.rotationAngle,force:O.force});j=new TouchEvent(b,{cancelable:P.cancelable,bubbles:P.bubbles,composed:P.composed,touches:[k],targetTouches:[k],changedTouches:[k]})}}else j=P;j&&this.svg.dispatchEvent(j)}}return m}getElementById(h){return Object(s.querySelector)(`#${h}`,this)}getElementsByClassName(h){return Object(s.querySelectorAll)(`.${h}`,this)}getElementsByName(h){return Object(s.querySelectorAll)(`[name="${h}"]`,this)}getElementsByTagName(h){return Object(s.querySelectorAll)(h,this)}querySelector(h){return Object(s.querySelector)(h,this)}querySelectorAll(h){return Object(s.querySelectorAll)(h,this)}onPropertyChange(h,m,d){super.onPropertyChange(h,m,d),h==="flexible"&&w(this),this.attributes.flexible&&(h==="width"||h==="height"||h==="scale"||h==="transform")&&w(this)}}p(y,"Attr",i.default),o.default.registerNode(y,"spritesvg")},function(n,t,e){e.r(t),e.d(t,"default",function(){return a});var r=e(225);e(1).glMatrix.setMatrixArrayType(Array);const i=Symbol.for("spritejs_getAttribute"),o=Symbol.for("spritejs_setAttribute"),s=Symbol.for("spritejs_setAttributeDefault");class a extends r.default{constructor(u){super(u),this[s]({passEvents:!1,flexible:!1})}get texture(){return this[i]("texture")}set texture(u){}get passEvents(){return this[i]("passEvents")}set passEvents(u){return this[o]("passEvents",u)}get flexible(){return this[i]("flexible")}set flexible(u){return this[o]("flexible",u)}}},function(n,t,e){e.r(t);var r=e(12);e(1).glMatrix.setMatrixArrayType(Array);function i(u,p){var c=Object.keys(u);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(u);p&&(g=g.filter(function(v){return Object.getOwnPropertyDescriptor(u,v).enumerable})),c.push.apply(c,g)}return c}function o(u){for(var p=1;p<arguments.length;p++){var c=arguments[p]!=null?arguments[p]:{};p%2?i(Object(c),!0).forEach(function(g){s(u,g,c[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(c)):i(Object(c)).forEach(function(g){Object.defineProperty(u,g,Object.getOwnPropertyDescriptor(c,g))})}return u}function s(u,p,c){return p in u?Object.defineProperty(u,p,{value:c,enumerable:!0,configurable:!0,writable:!0}):u[p]=c,u}const a=Symbol("inited");let l=null;typeof Worker=="function"&&(l=class extends Worker{constructor(u){if(u.worker===!0&&(u.worker=`./${u.id}.worker.js`),super(u.worker),this.options=u,!u.canvas){const{width:p,height:c}=this.getResolution(),g=r.ENV.createCanvas(p,c,{offscreen:!1});g.style&&(g.style.position="absolute"),g.dataset&&(g.dataset.layerId=u.id),u.canvas=g}this.canvas=u.canvas}get id(){return this.options.id}setResolution({width:u,height:p}){if(this[a])this.postMessage({type:"resolution_change",width:u,height:p});else{this.canvas.width=u,this.canvas.height=p;const c=this.options,g=c.canvas.transferControlToOffscreen(),v=o({},c);delete v.container,v.canvas=g,this.postMessage({type:"create",options:v},[g]),this[a]=!0}}getResolution(){if(this.canvas){const{width:u,height:p}=this.canvas;return{width:u,height:p}}return{width:300,height:150}}remove(){return this.parent&&this.parent.removeChild?(this.parent.removeChild(this),!0):!1}connect(u,p){Object.defineProperty(this,"parent",{value:u,writable:!1,configurable:!0}),Object.defineProperty(this,"zOrder",{value:p,writable:!1,configurable:!0})}disconnect(){delete this.parent,delete this.zOrder}dispatchPointerEvent(u){this.postMessage({type:"event",event:{cancelBubble:u.cancelBubble,bubbles:u.bubbles,detail:u.detail,identifier:u.identifier,layerX:u.layerX,layerY:u.layerY,originalX:u.originalX,originalY:u.originalY,type:u.type,x:u.x,y:u.y}})}}),t.default=l},function(n,t,e){e.r(t),function(r){e.d(t,"default",function(){return x});var i=e(12),o=e(68),s=e(70),a=e(286),l=e(289),u=e(250),p=e(291),c=e(214),g=e(218),v=e(213);e(1).glMatrix.setMatrixArrayType(Array);const I=Symbol("enteredTargets");function w(E){return E.id=E.id||`_layer${Math.random().toString(36).slice(2,12)}`,E.dataset||(E.dataset={}),E.dataset.layerId=E.id,E.connect=(P,R)=>{E.parent=P,Object.defineProperty(E,"zOrder",{value:R,writable:!1,configurable:!0})},E.disconnect=P=>{delete E.zOrder},E.canvas=E,E.getResolution=()=>({width:0,height:0}),E.setResolution=()=>!1,E.options={handleEvent:!1},E}function y(E,P){const R=E.children;let N=null;for(let b=0;b<R.length;b++){const j=R[b];if((P===j||N!=null)&&(N=j),N&&N!==P&&!N.offscreen)return N.canvas}return null}function T(E,P){const[R,N]=E.renderOffset,{width:b,height:j}=E.getResolution(),O=E.displayRatio;E.renderer.drawImage(P.canvas,-R/O,-N/O,b/O,j/O)}const h={};function m(E){const P=["mousedown","mouseup","mousemove","mousewheel","wheel","touchstart","touchend","touchmove","touchcancel","click","dblclick","longpress","tap","contextmenu"],R=E.container;R.addEventListener("mouseleave",N=>{const b=E[I];if(b.size){const j=new c.default("mouseleave");j.setOriginalEvent(N),[...b].forEach(O=>{O.dispatchEvent(j)}),E[I].clear()}},{passive:!0}),P.forEach(N=>{R.addEventListener(N,b=>{const{left:j,top:O,displayRatio:L}=E.options,k=E.orderedChildren;Object(p.default)(b,{offsetLeft:j,offsetTop:O,displayRatio:L}).forEach(Q=>{const _=Q.identifier;if(Q.type==="touchmove"||Q.type==="touchend"){const F=h[_];F&&F.dispatchEvent(Q),Q.type==="touchend"&&delete h[_]}else{for(let F=k.length-1;F>=0;F--){const Z=k[F];if(Z.options.handleEvent!==!1){if(Z.dispatchPointerEvent(Q)&&Q.target!==Z)break;Q.cancelBubble=!1}}if(Q.target===k[0])for(let F=k.length-1;F>=0;F--){const Z=k[F];if(Z.options.handleEvent!==!1){Q.target=Z;break}}}const st=Q.target;if(Q.type==="touchstart"&&(h[_]=Q.target),Q.type==="mousemove"){const F=E[I];let Z;if(st){const at=st.ancestors||[];Z=new Set([st,...at])}else Z=new Set;const tt=Object.entries(b);if(!F.has(st)&&st){const at=new c.default("mouseenter");at.setOriginalEvent(b),tt.forEach(([it,ft])=>{at[it]=ft}),F.add(st),st.dispatchEvent(at);const dt=st.ancestors;dt&&dt.forEach(it=>{it instanceof s.default&&!F.has(it)&&(F.add(it),it.dispatchEvent(at))})}const ct=new c.default("mouseleave");ct.setOriginalEvent(b),tt.forEach(([at,dt])=>{ct[at]=dt}),[...F].forEach(at=>{Z.has(at)||(F.delete(at),at.dispatchEvent(ct))})}})},{passive:N!=="contextmenu"})})}function d(E,P){if(P&&P.style){let{width:R,height:N,mode:b,container:j}=E;const{clientWidth:O,clientHeight:L}=j;R=R||O,N=N||L,b==="static"?(P.style.width=`${R}px`,P.style.height=`${N}px`):(P.style.top="0",P.style.left="0",P.style.width=`${O}px`,P.style.height=`${L}px`,P.style.transform="",P.style.webkitTransform="")}}const M=Symbol("offscreenLayerCount");class x extends u.default{constructor(P={}){if(super(),!P.container)if(typeof i.ENV.Container=="function")P.container=new i.ENV.Container(P.width||300,P.height||150);else throw new Error("No container specified.");if(this.container=P.container,this.container.style&&(this.container.style.overflow||(this.container.style.overflow="hidden"),this.container.style.position||(this.container.style.position="relative")),this.options=P,P.displayRatio=P.displayRatio||1,P.mode=P.mode||"scale",P.left=0,P.top=0,P.autoResize=P.autoResize!==!1,P.autoResize){let R;if(typeof globalThis<"u"?R=globalThis:R=typeof window<"u"?window:r,R.addEventListener){const N=this;R.addEventListener("resize",function b(){typeof document<"u"&&document.contains(N.container)?N.resize():R.removeEventListener("resize",b)})}}this[I]=new Set,this.setResolution(P),m(this),this[M]=0}get hasOffscreenCanvas(){return this[M]>0}set displayRatio(P){this.options.displayRatio!==P&&(this.options.displayRatio=P,this.resize())}get displayRatio(){return this.options.displayRatio}set height(P){this.options.height!==P&&(this.options.height=P,this.resize())}get height(){return this.options.height}set mode(P){this.options.mode!==P&&(this.options.mode=P,this.resize())}get mode(){return this.options.mode}set width(P){this.options.width!==P&&(this.options.width=P,this.resize())}get width(){return this.options.width}appendChild(P){!(P instanceof a.default)&&!(P instanceof l.default)&&w(P);const R=super.appendChild(P),N=P.canvas;return P.offscreen?this[M]++:this.container.appendChild(N),d(this.options,N),P.setResolution(this.getResolution()),R}forceUpdate(){this.hasOffscreenCanvas&&!this._requestID&&(this._requestID=Object(o.requestAnimationFrame)(()=>{delete this._requestID,this.render()}))}insertBefore(P,R){!(P instanceof a.default)&&!(P instanceof l.default)&&w(P);const N=super.insertBefore(P,R),b=P.canvas;if(!P.offscreen){const j=y(this,P);this.container.insertBefore(b,j)}return d(this.options,b),P.setResolution(this.getResolution()),N}layer(P="default",R={}){R=Object.assign({},this.options,R),R.id=P;const N=this.orderedChildren;for(let O=0;O<N.length;O++)if(N[O].id===P)return N[O];const b=R.worker;let j;return b?j=new l.default(R):j=new a.default(R),this.appendChild(j),j}async preload(...P){const R=[],N=[],b=[];for(let j=0;j<P.length;j++){const O=P[j];let L;if(typeof O=="string")L=Object(g.loadTexture)(O);else if(Array.isArray(O))L=Object(g.loadFrames)(...O);else{const{id:k,src:H}=O;L=Object(g.loadTexture)(H,k)}L instanceof Promise||(L=Promise.resolve(L)),N.push(L.then(k=>{R.push(k),b[j]=k;const H=new c.default({type:"preload",detail:{current:k,loaded:R,resources:P}});this.dispatchEvent(H)}))}return await Promise.all(N),b}removeChild(P){const R=super.removeChild(P);if(R){P._prepareRenderFinished&&P._prepareRenderFinished();const N=P.canvas;N&&N.remove&&N.remove(),P.offscreen&&this[M]--}return R}render(){const P=this.orderedChildren;let R=null;const N=[];for(let b=0;b<P.length;b++){const j=P[b],O=N.length>0;if(j instanceof a.default&&!j.offscreen)if(!j.autoRender)O&&(console.warn("Some offscreen canvas will not be rendered."),N.length=0);else if(R=j,O){j.renderer.clear();for(let L=0;L<N.length;L++){const k=N[L];k.render(),T(j,k)}N.length=0,j.render({clear:!1})}else j.prepareRender&&j.render();else j.offscreen?R?(j.prepareRender&&j.render(),T(R,j)):N.push(j):j instanceof l.default&&O&&(console.warn("Some offscreen canvas will not be rendered."),N.length=0)}}replaceChild(P,R){const N=super.replaceChild(P,R);R.canvas.remove&&R.canvas.remove(),R.offscreen&&this[M]--;const b=P.canvas;if(!P.offscreen){const j=y(this,P);this.container.insertBefore(b,j)}return d(this.options,b),P.setResolution(this.getResolution()),N}resize(){const P=this.options;this.children.forEach(R=>{d(P,R.canvas)}),this.setResolution(P),this.dispatchEvent({type:"resize"})}setResolution({width:P,height:R}={}){const N=this.container,{clientWidth:b,clientHeight:j}=N;(P==null||R==null)&&(P=P??b,R=R??j);const{mode:O,displayRatio:L}=this.options;if(P*=L,R*=L,this.options.left=0,this.options.top=0,O==="stickyHeight"||O==="stickyLeft"||O==="stickyRight"){const k=P;P=b*R/j,O==="stickyHeight"&&(this.options.left=.5*(P-k)),O==="stickyRight"&&(this.options.left=P-k)}else if(O==="stickyWidth"||O==="stickyTop"||O==="stickyBottom"){const k=R;R=j*P/b,O==="stickyWidth"&&(this.options.top=.5*(R-k)),O==="stickyBottom"&&(this.options.top=R-k)}super.setResolution({width:P,height:R})}snapshot({offscreen:P=!1,layers:R}={}){const N=P?"snapshotOffScreenCanvas":"snapshotCanvas",{width:b,height:j}=this.getResolution();this[N]=this[N]||i.ENV.createCanvas(b,j,{offscreen:P});const O=this[N].getContext("2d");R=R||this.orderedChildren,this[N].width=b,this[N].height=j;for(let L=0;L<R.length;L++){const k=R[L];if(!k.options.ignoreSnapshot){k.render&&k.render();const H=k.canvas;H&&H!==k&&O.drawImage(H,0,0,b,j)}}return this[N]}}typeof document<"u"&&(x.prototype.layer3d=function(E,P={}){const R=P.url||"https://unpkg.com/sprite-extend-3d/dist/sprite-extend-3d.min.js";return new Promise((N,b)=>{const j=document.createElement("script");j.async=!1,j.src=R,j.onload=()=>{try{N(this.layer3d(E,P))}catch(O){b(O)}},document.documentElement.appendChild(j)})}),v.default.registerNode(x,"scene")}.call(this,e(22))},function(n,t,e){e.r(t),e.d(t,"default",function(){return i});var r=e(214);e(1).glMatrix.setMatrixArrayType(Array);function i(o,{offsetTop:s=0,offsetLeft:a=0,displayRatio:l=1}={}){let u,p;const c=[],{left:g,top:v,width:I,height:w}=o.target.getBoundingClientRect(),y=o.target.width,T=o.target.height,h=o.changedTouches||[o];for(let d=0;d<h.length;d++){const M=h[d],x=M.identifier,{clientX:E,clientY:P}=M;E!=null&&P!=null&&c.push({x:Math.round((E|0)-g),y:Math.round((P|0)-v),identifier:x})}c.length<=0&&c.push({x:u,y:p});const m=[];return c.forEach(d=>{d.x!=null&&d.y!=null&&(u=(d.x*y/I-a)/l,p=(d.y*T/w-s)/l);const M=new r.default(o);Object.defineProperties(M,{layerX:{value:u,configurable:!0},layerY:{value:p,configurable:!0},originalX:{value:d.x},originalY:{value:d.y},x:{value:u,configurable:!0},y:{value:p,configurable:!0},identifier:{value:d.identifier}}),m.push(M)}),m}}]);fe.version;fe.Arc;fe.Block;fe.Cloud;fe.Color;const h0=fe.Ellipse;fe.Gradient;const Ze=fe.Group,f0=fe.Label,d0=fe.Layer;fe.LayerWorker;fe.Node;fe.Parallel;const Wr=fe.Path,gr=fe.Polyline,mh=fe.Rect;fe.Regular;fe.Ring;const Dd=fe.Scene,Ld=fe.Sprite;fe.SpriteSvg;fe.Star;fe.Triangle;fe.helpers;fe.createElement;fe.isSpriteNode;fe.registerNode;fe.requestAnimationFrame;fe.cancelAnimationFrame;fe.ENV;var Od={exports:{}};(function(n){var t=function(){var e=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",o={};function s(l,u){if(!o[l]){o[l]={};for(var p=0;p<l.length;p++)o[l][l.charAt(p)]=p}return o[l][u]}var a={compressToBase64:function(l){if(l==null)return"";var u=a._compress(l,6,function(p){return r.charAt(p)});switch(u.length%4){default:case 0:return u;case 1:return u+"===";case 2:return u+"==";case 3:return u+"="}},decompressFromBase64:function(l){return l==null?"":l==""?null:a._decompress(l.length,32,function(u){return s(r,l.charAt(u))})},compressToUTF16:function(l){return l==null?"":a._compress(l,15,function(u){return e(u+32)})+" "},decompressFromUTF16:function(l){return l==null?"":l==""?null:a._decompress(l.length,16384,function(u){return l.charCodeAt(u)-32})},compressToUint8Array:function(l){for(var u=a.compress(l),p=new Uint8Array(u.length*2),c=0,g=u.length;c<g;c++){var v=u.charCodeAt(c);p[c*2]=v>>>8,p[c*2+1]=v%256}return p},decompressFromUint8Array:function(l){if(l==null)return a.decompress(l);for(var u=new Array(l.length/2),p=0,c=u.length;p<c;p++)u[p]=l[p*2]*256+l[p*2+1];var g=[];return u.forEach(function(v){g.push(e(v))}),a.decompress(g.join(""))},compressToEncodedURIComponent:function(l){return l==null?"":a._compress(l,6,function(u){return i.charAt(u)})},decompressFromEncodedURIComponent:function(l){return l==null?"":l==""?null:(l=l.replace(/ /g,"+"),a._decompress(l.length,32,function(u){return s(i,l.charAt(u))}))},compress:function(l){return a._compress(l,16,function(u){return e(u)})},_compress:function(l,u,p){if(l==null)return"";var c,g,v={},I={},w="",y="",T="",h=2,m=3,d=2,M=[],x=0,E=0,P;for(P=0;P<l.length;P+=1)if(w=l.charAt(P),Object.prototype.hasOwnProperty.call(v,w)||(v[w]=m++,I[w]=!0),y=T+w,Object.prototype.hasOwnProperty.call(v,y))T=y;else{if(Object.prototype.hasOwnProperty.call(I,T)){if(T.charCodeAt(0)<256){for(c=0;c<d;c++)x=x<<1,E==u-1?(E=0,M.push(p(x)),x=0):E++;for(g=T.charCodeAt(0),c=0;c<8;c++)x=x<<1|g&1,E==u-1?(E=0,M.push(p(x)),x=0):E++,g=g>>1}else{for(g=1,c=0;c<d;c++)x=x<<1|g,E==u-1?(E=0,M.push(p(x)),x=0):E++,g=0;for(g=T.charCodeAt(0),c=0;c<16;c++)x=x<<1|g&1,E==u-1?(E=0,M.push(p(x)),x=0):E++,g=g>>1}h--,h==0&&(h=Math.pow(2,d),d++),delete I[T]}else for(g=v[T],c=0;c<d;c++)x=x<<1|g&1,E==u-1?(E=0,M.push(p(x)),x=0):E++,g=g>>1;h--,h==0&&(h=Math.pow(2,d),d++),v[y]=m++,T=String(w)}if(T!==""){if(Object.prototype.hasOwnProperty.call(I,T)){if(T.charCodeAt(0)<256){for(c=0;c<d;c++)x=x<<1,E==u-1?(E=0,M.push(p(x)),x=0):E++;for(g=T.charCodeAt(0),c=0;c<8;c++)x=x<<1|g&1,E==u-1?(E=0,M.push(p(x)),x=0):E++,g=g>>1}else{for(g=1,c=0;c<d;c++)x=x<<1|g,E==u-1?(E=0,M.push(p(x)),x=0):E++,g=0;for(g=T.charCodeAt(0),c=0;c<16;c++)x=x<<1|g&1,E==u-1?(E=0,M.push(p(x)),x=0):E++,g=g>>1}h--,h==0&&(h=Math.pow(2,d),d++),delete I[T]}else for(g=v[T],c=0;c<d;c++)x=x<<1|g&1,E==u-1?(E=0,M.push(p(x)),x=0):E++,g=g>>1;h--,h==0&&(h=Math.pow(2,d),d++)}for(g=2,c=0;c<d;c++)x=x<<1|g&1,E==u-1?(E=0,M.push(p(x)),x=0):E++,g=g>>1;for(;;)if(x=x<<1,E==u-1){M.push(p(x));break}else E++;return M.join("")},decompress:function(l){return l==null?"":l==""?null:a._decompress(l.length,32768,function(u){return l.charCodeAt(u)})},_decompress:function(l,u,p){var c=[],g=4,v=4,I=3,w="",y=[],T,h,m,d,M,x,E,P={val:p(0),position:u,index:1};for(T=0;T<3;T+=1)c[T]=T;for(m=0,M=Math.pow(2,2),x=1;x!=M;)d=P.val&P.position,P.position>>=1,P.position==0&&(P.position=u,P.val=p(P.index++)),m|=(d>0?1:0)*x,x<<=1;switch(m){case 0:for(m=0,M=Math.pow(2,8),x=1;x!=M;)d=P.val&P.position,P.position>>=1,P.position==0&&(P.position=u,P.val=p(P.index++)),m|=(d>0?1:0)*x,x<<=1;E=e(m);break;case 1:for(m=0,M=Math.pow(2,16),x=1;x!=M;)d=P.val&P.position,P.position>>=1,P.position==0&&(P.position=u,P.val=p(P.index++)),m|=(d>0?1:0)*x,x<<=1;E=e(m);break;case 2:return""}for(c[3]=E,h=E,y.push(E);;){if(P.index>l)return"";for(m=0,M=Math.pow(2,I),x=1;x!=M;)d=P.val&P.position,P.position>>=1,P.position==0&&(P.position=u,P.val=p(P.index++)),m|=(d>0?1:0)*x,x<<=1;switch(E=m){case 0:for(m=0,M=Math.pow(2,8),x=1;x!=M;)d=P.val&P.position,P.position>>=1,P.position==0&&(P.position=u,P.val=p(P.index++)),m|=(d>0?1:0)*x,x<<=1;c[v++]=e(m),E=v-1,g--;break;case 1:for(m=0,M=Math.pow(2,16),x=1;x!=M;)d=P.val&P.position,P.position>>=1,P.position==0&&(P.position=u,P.val=p(P.index++)),m|=(d>0?1:0)*x,x<<=1;c[v++]=e(m),E=v-1,g--;break;case 2:return y.join("")}if(g==0&&(g=Math.pow(2,I),I++),c[E])w=c[E];else if(E===v)w=h+h.charAt(0);else return null;y.push(w),c[v++]=h+w.charAt(0),g--,h=w,g==0&&(g=Math.pow(2,I),I++)}}};return a}();n!=null?n.exports=t:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return t})})(Od);var bd=Od.exports,Rd={exports:{}};(function(n){(function(){var t={};t.version="6.4.2.2",t.use_lines=!0,t.use_xyz=!1;var e=!1;n.exports?(n.exports=t,e=!0):typeof document<"u"?window.ClipperLib=t:self.ClipperLib=t;var r;if(e){var i="chrome";r="Netscape"}else{var i=navigator.userAgent.toString().toLowerCase();r=navigator.appName}var o={};i.indexOf("chrome")!=-1&&i.indexOf("chromium")==-1?o.chrome=1:o.chrome=0,i.indexOf("chromium")!=-1?o.chromium=1:o.chromium=0,i.indexOf("safari")!=-1&&i.indexOf("chrome")==-1&&i.indexOf("chromium")==-1?o.safari=1:o.safari=0,i.indexOf("firefox")!=-1?o.firefox=1:o.firefox=0,i.indexOf("firefox/17")!=-1?o.firefox17=1:o.firefox17=0,i.indexOf("firefox/15")!=-1?o.firefox15=1:o.firefox15=0,i.indexOf("firefox/3")!=-1?o.firefox3=1:o.firefox3=0,i.indexOf("opera")!=-1?o.opera=1:o.opera=0,i.indexOf("msie 10")!=-1?o.msie10=1:o.msie10=0,i.indexOf("msie 9")!=-1?o.msie9=1:o.msie9=0,i.indexOf("msie 8")!=-1?o.msie8=1:o.msie8=0,i.indexOf("msie 7")!=-1?o.msie7=1:o.msie7=0,i.indexOf("msie ")!=-1?o.msie=1:o.msie=0,t.biginteger_used=null;var s;function a(f,S,A){t.biginteger_used=1,f!=null&&(typeof f=="number"&&typeof S>"u"?this.fromInt(f):typeof f=="number"?this.fromNumber(f,S,A):S==null&&typeof f!="string"?this.fromString(f,256):this.fromString(f,S))}function l(){return new a(null,void 0,void 0)}function u(f,S,A,z,V,J){for(;--J>=0;){var ot=S*this[f++]+A[z]+V;V=Math.floor(ot/67108864),A[z++]=ot&67108863}return V}function p(f,S,A,z,V,J){for(var ot=S&32767,mt=S>>15;--J>=0;){var vt=this[f]&32767,Nt=this[f++]>>15,Bt=mt*vt+Nt*ot;vt=ot*vt+((Bt&32767)<<15)+A[z]+(V&1073741823),V=(vt>>>30)+(Bt>>>15)+mt*Nt+(V>>>30),A[z++]=vt&1073741823}return V}function c(f,S,A,z,V,J){for(var ot=S&16383,mt=S>>14;--J>=0;){var vt=this[f]&16383,Nt=this[f++]>>14,Bt=mt*vt+Nt*ot;vt=ot*vt+((Bt&16383)<<14)+A[z]+V,V=(vt>>28)+(Bt>>14)+mt*Nt,A[z++]=vt&268435455}return V}r=="Microsoft Internet Explorer"?(a.prototype.am=p,s=30):r!="Netscape"?(a.prototype.am=u,s=26):(a.prototype.am=c,s=28),a.prototype.DB=s,a.prototype.DM=(1<<s)-1,a.prototype.DV=1<<s;var g=52;a.prototype.FV=Math.pow(2,g),a.prototype.F1=g-s,a.prototype.F2=2*s-g;var v="0123456789abcdefghijklmnopqrstuvwxyz",I=new Array,w,y;for(w=48,y=0;y<=9;++y)I[w++]=y;for(w=97,y=10;y<36;++y)I[w++]=y;for(w=65,y=10;y<36;++y)I[w++]=y;function T(f){return v.charAt(f)}function h(f,S){var A=I[f.charCodeAt(S)];return A??-1}function m(f){for(var S=this.t-1;S>=0;--S)f[S]=this[S];f.t=this.t,f.s=this.s}function d(f){this.t=1,this.s=f<0?-1:0,f>0?this[0]=f:f<-1?this[0]=f+this.DV:this.t=0}function M(f){var S=l();return S.fromInt(f),S}function x(f,S){var A;if(S==16)A=4;else if(S==8)A=3;else if(S==256)A=8;else if(S==2)A=1;else if(S==32)A=5;else if(S==4)A=2;else{this.fromRadix(f,S);return}this.t=0,this.s=0;for(var z=f.length,V=!1,J=0;--z>=0;){var ot=A==8?f[z]&255:h(f,z);if(ot<0){f.charAt(z)=="-"&&(V=!0);continue}V=!1,J==0?this[this.t++]=ot:J+A>this.DB?(this[this.t-1]|=(ot&(1<<this.DB-J)-1)<<J,this[this.t++]=ot>>this.DB-J):this[this.t-1]|=ot<<J,J+=A,J>=this.DB&&(J-=this.DB)}A==8&&f[0]&128&&(this.s=-1,J>0&&(this[this.t-1]|=(1<<this.DB-J)-1<<J)),this.clamp(),V&&a.ZERO.subTo(this,this)}function E(){for(var f=this.s&this.DM;this.t>0&&this[this.t-1]==f;)--this.t}function P(f){if(this.s<0)return"-"+this.negate().toString(f);var S;if(f==16)S=4;else if(f==8)S=3;else if(f==2)S=1;else if(f==32)S=5;else if(f==4)S=2;else return this.toRadix(f);var A=(1<<S)-1,z,V=!1,J="",ot=this.t,mt=this.DB-ot*this.DB%S;if(ot-- >0)for(mt<this.DB&&(z=this[ot]>>mt)>0&&(V=!0,J=T(z));ot>=0;)mt<S?(z=(this[ot]&(1<<mt)-1)<<S-mt,z|=this[--ot]>>(mt+=this.DB-S)):(z=this[ot]>>(mt-=S)&A,mt<=0&&(mt+=this.DB,--ot)),z>0&&(V=!0),V&&(J+=T(z));return V?J:"0"}function R(){var f=l();return a.ZERO.subTo(this,f),f}function N(){return this.s<0?this.negate():this}function b(f){var S=this.s-f.s;if(S!=0)return S;var A=this.t;if(S=A-f.t,S!=0)return this.s<0?-S:S;for(;--A>=0;)if((S=this[A]-f[A])!=0)return S;return 0}function j(f){var S=1,A;return(A=f>>>16)!=0&&(f=A,S+=16),(A=f>>8)!=0&&(f=A,S+=8),(A=f>>4)!=0&&(f=A,S+=4),(A=f>>2)!=0&&(f=A,S+=2),(A=f>>1)!=0&&(f=A,S+=1),S}function O(){return this.t<=0?0:this.DB*(this.t-1)+j(this[this.t-1]^this.s&this.DM)}function L(f,S){var A;for(A=this.t-1;A>=0;--A)S[A+f]=this[A];for(A=f-1;A>=0;--A)S[A]=0;S.t=this.t+f,S.s=this.s}function k(f,S){for(var A=f;A<this.t;++A)S[A-f]=this[A];S.t=Math.max(this.t-f,0),S.s=this.s}function H(f,S){var A=f%this.DB,z=this.DB-A,V=(1<<z)-1,J=Math.floor(f/this.DB),ot=this.s<<A&this.DM,mt;for(mt=this.t-1;mt>=0;--mt)S[mt+J+1]=this[mt]>>z|ot,ot=(this[mt]&V)<<A;for(mt=J-1;mt>=0;--mt)S[mt]=0;S[J]=ot,S.t=this.t+J+1,S.s=this.s,S.clamp()}function Q(f,S){S.s=this.s;var A=Math.floor(f/this.DB);if(A>=this.t){S.t=0;return}var z=f%this.DB,V=this.DB-z,J=(1<<z)-1;S[0]=this[A]>>z;for(var ot=A+1;ot<this.t;++ot)S[ot-A-1]|=(this[ot]&J)<<V,S[ot-A]=this[ot]>>z;z>0&&(S[this.t-A-1]|=(this.s&J)<<V),S.t=this.t-A,S.clamp()}function _(f,S){for(var A=0,z=0,V=Math.min(f.t,this.t);A<V;)z+=this[A]-f[A],S[A++]=z&this.DM,z>>=this.DB;if(f.t<this.t){for(z-=f.s;A<this.t;)z+=this[A],S[A++]=z&this.DM,z>>=this.DB;z+=this.s}else{for(z+=this.s;A<f.t;)z-=f[A],S[A++]=z&this.DM,z>>=this.DB;z-=f.s}S.s=z<0?-1:0,z<-1?S[A++]=this.DV+z:z>0&&(S[A++]=z),S.t=A,S.clamp()}function st(f,S){var A=this.abs(),z=f.abs(),V=A.t;for(S.t=V+z.t;--V>=0;)S[V]=0;for(V=0;V<z.t;++V)S[V+A.t]=A.am(0,z[V],S,V,0,A.t);S.s=0,S.clamp(),this.s!=f.s&&a.ZERO.subTo(S,S)}function F(f){for(var S=this.abs(),A=f.t=2*S.t;--A>=0;)f[A]=0;for(A=0;A<S.t-1;++A){var z=S.am(A,S[A],f,2*A,0,1);(f[A+S.t]+=S.am(A+1,2*S[A],f,2*A+1,z,S.t-A-1))>=S.DV&&(f[A+S.t]-=S.DV,f[A+S.t+1]=1)}f.t>0&&(f[f.t-1]+=S.am(A,S[A],f,2*A,0,1)),f.s=0,f.clamp()}function Z(f,S,A){var z=f.abs();if(!(z.t<=0)){var V=this.abs();if(V.t<z.t){S?.fromInt(0),A!=null&&this.copyTo(A);return}A==null&&(A=l());var J=l(),ot=this.s,mt=f.s,vt=this.DB-j(z[z.t-1]);vt>0?(z.lShiftTo(vt,J),V.lShiftTo(vt,A)):(z.copyTo(J),V.copyTo(A));var Nt=J.t,Bt=J[Nt-1];if(Bt!=0){var Rt=Bt*(1<<this.F1)+(Nt>1?J[Nt-2]>>this.F2:0),Vt=this.FV/Rt,Kt=(1<<this.F1)/Rt,ae=1<<this.F2,le=A.t,ge=le-Nt,on=S??l();for(J.dlShiftTo(ge,on),A.compareTo(on)>=0&&(A[A.t++]=1,A.subTo(on,A)),a.ONE.dlShiftTo(Nt,on),on.subTo(J,J);J.t<Nt;)J[J.t++]=0;for(;--ge>=0;){var Un=A[--le]==Bt?this.DM:Math.floor(A[le]*Vt+(A[le-1]+ae)*Kt);if((A[le]+=J.am(0,Un,A,ge,0,Nt))<Un)for(J.dlShiftTo(ge,on),A.subTo(on,A);A[le]<--Un;)A.subTo(on,A)}S!=null&&(A.drShiftTo(Nt,S),ot!=mt&&a.ZERO.subTo(S,S)),A.t=Nt,A.clamp(),vt>0&&A.rShiftTo(vt,A),ot<0&&a.ZERO.subTo(A,A)}}}function tt(f){var S=l();return this.abs().divRemTo(f,null,S),this.s<0&&S.compareTo(a.ZERO)>0&&f.subTo(S,S),S}function ct(f){this.m=f}function at(f){return f.s<0||f.compareTo(this.m)>=0?f.mod(this.m):f}function dt(f){return f}function it(f){f.divRemTo(this.m,null,f)}function ft(f,S,A){f.multiplyTo(S,A),this.reduce(A)}function wt(f,S){f.squareTo(S),this.reduce(S)}ct.prototype.convert=at,ct.prototype.revert=dt,ct.prototype.reduce=it,ct.prototype.mulTo=ft,ct.prototype.sqrTo=wt;function U(){if(this.t<1)return 0;var f=this[0];if(!(f&1))return 0;var S=f&3;return S=S*(2-(f&15)*S)&15,S=S*(2-(f&255)*S)&255,S=S*(2-((f&65535)*S&65535))&65535,S=S*(2-f*S%this.DV)%this.DV,S>0?this.DV-S:-S}function Y(f){this.m=f,this.mp=f.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<f.DB-15)-1,this.mt2=2*f.t}function K(f){var S=l();return f.abs().dlShiftTo(this.m.t,S),S.divRemTo(this.m,null,S),f.s<0&&S.compareTo(a.ZERO)>0&&this.m.subTo(S,S),S}function et(f){var S=l();return f.copyTo(S),this.reduce(S),S}function W(f){for(;f.t<=this.mt2;)f[f.t++]=0;for(var S=0;S<this.m.t;++S){var A=f[S]&32767,z=A*this.mpl+((A*this.mph+(f[S]>>15)*this.mpl&this.um)<<15)&f.DM;for(A=S+this.m.t,f[A]+=this.m.am(0,z,f,S,0,this.m.t);f[A]>=f.DV;)f[A]-=f.DV,f[++A]++}f.clamp(),f.drShiftTo(this.m.t,f),f.compareTo(this.m)>=0&&f.subTo(this.m,f)}function $(f,S){f.squareTo(S),this.reduce(S)}function C(f,S,A){f.multiplyTo(S,A),this.reduce(A)}Y.prototype.convert=K,Y.prototype.revert=et,Y.prototype.reduce=W,Y.prototype.mulTo=C,Y.prototype.sqrTo=$;function D(){return(this.t>0?this[0]&1:this.s)==0}function B(f,S){if(f>4294967295||f<1)return a.ONE;var A=l(),z=l(),V=S.convert(this),J=j(f)-1;for(V.copyTo(A);--J>=0;)if(S.sqrTo(A,z),(f&1<<J)>0)S.mulTo(z,V,A);else{var ot=A;A=z,z=ot}return S.revert(A)}function X(f,S){var A;return f<256||S.isEven()?A=new ct(S):A=new Y(S),this.exp(f,A)}a.prototype.copyTo=m,a.prototype.fromInt=d,a.prototype.fromString=x,a.prototype.clamp=E,a.prototype.dlShiftTo=L,a.prototype.drShiftTo=k,a.prototype.lShiftTo=H,a.prototype.rShiftTo=Q,a.prototype.subTo=_,a.prototype.multiplyTo=st,a.prototype.squareTo=F,a.prototype.divRemTo=Z,a.prototype.invDigit=U,a.prototype.isEven=D,a.prototype.exp=B,a.prototype.toString=P,a.prototype.negate=R,a.prototype.abs=N,a.prototype.compareTo=b,a.prototype.bitLength=O,a.prototype.mod=tt,a.prototype.modPowInt=X,a.ZERO=M(0),a.ONE=M(1);function q(){var f=l();return this.copyTo(f),f}function rt(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function lt(){return this.t==0?this.s:this[0]<<24>>24}function gt(){return this.t==0?this.s:this[0]<<16>>16}function yt(f){return Math.floor(Math.LN2*this.DB/Math.log(f))}function xt(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function Et(f){if(f==null&&(f=10),this.signum()==0||f<2||f>36)return"0";var S=this.chunkSize(f),A=Math.pow(f,S),z=M(A),V=l(),J=l(),ot="";for(this.divRemTo(z,V,J);V.signum()>0;)ot=(A+J.intValue()).toString(f).substr(1)+ot,V.divRemTo(z,V,J);return J.intValue().toString(f)+ot}function St(f,S){this.fromInt(0),S==null&&(S=10);for(var A=this.chunkSize(S),z=Math.pow(S,A),V=!1,J=0,ot=0,mt=0;mt<f.length;++mt){var vt=h(f,mt);if(vt<0){f.charAt(mt)=="-"&&this.signum()==0&&(V=!0);continue}ot=S*ot+vt,++J>=A&&(this.dMultiply(z),this.dAddOffset(ot,0),J=0,ot=0)}J>0&&(this.dMultiply(Math.pow(S,J)),this.dAddOffset(ot,0)),V&&a.ZERO.subTo(this,this)}function Mt(f,S,A){if(typeof S=="number")if(f<2)this.fromInt(1);else for(this.fromNumber(f,A),this.testBit(f-1)||this.bitwiseTo(a.ONE.shiftLeft(f-1),Qt,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(S);)this.dAddOffset(2,0),this.bitLength()>f&&this.subTo(a.ONE.shiftLeft(f-1),this);else{var z=new Array,V=f&7;z.length=(f>>3)+1,S.nextBytes(z),V>0?z[0]&=(1<<V)-1:z[0]=0,this.fromString(z,256)}}function Ct(){var f=this.t,S=new Array;S[0]=this.s;var A=this.DB-f*this.DB%8,z,V=0;if(f-- >0)for(A<this.DB&&(z=this[f]>>A)!=(this.s&this.DM)>>A&&(S[V++]=z|this.s<<this.DB-A);f>=0;)A<8?(z=(this[f]&(1<<A)-1)<<8-A,z|=this[--f]>>(A+=this.DB-8)):(z=this[f]>>(A-=8)&255,A<=0&&(A+=this.DB,--f)),z&128&&(z|=-256),V==0&&(this.s&128)!=(z&128)&&++V,(V>0||z!=this.s)&&(S[V++]=z);return S}function Ot(f){return this.compareTo(f)==0}function bt(f){return this.compareTo(f)<0?this:f}function At(f){return this.compareTo(f)>0?this:f}function Yt(f,S,A){var z,V,J=Math.min(f.t,this.t);for(z=0;z<J;++z)A[z]=S(this[z],f[z]);if(f.t<this.t){for(V=f.s&this.DM,z=J;z<this.t;++z)A[z]=S(this[z],V);A.t=this.t}else{for(V=this.s&this.DM,z=J;z<f.t;++z)A[z]=S(V,f[z]);A.t=f.t}A.s=S(this.s,f.s),A.clamp()}function re(f,S){return f&S}function Zt(f){var S=l();return this.bitwiseTo(f,re,S),S}function Qt(f,S){return f|S}function te(f){var S=l();return this.bitwiseTo(f,Qt,S),S}function qt(f,S){return f^S}function Ee(f){var S=l();return this.bitwiseTo(f,qt,S),S}function Te(f,S){return f&~S}function Se(f){var S=l();return this.bitwiseTo(f,Te,S),S}function xe(){for(var f=l(),S=0;S<this.t;++S)f[S]=this.DM&~this[S];return f.t=this.t,f.s=~this.s,f}function Ae(f){var S=l();return f<0?this.rShiftTo(-f,S):this.lShiftTo(f,S),S}function De(f){var S=l();return f<0?this.lShiftTo(-f,S):this.rShiftTo(f,S),S}function be(f){if(f==0)return-1;var S=0;return f&65535||(f>>=16,S+=16),f&255||(f>>=8,S+=8),f&15||(f>>=4,S+=4),f&3||(f>>=2,S+=2),f&1||++S,S}function ue(){for(var f=0;f<this.t;++f)if(this[f]!=0)return f*this.DB+be(this[f]);return this.s<0?this.t*this.DB:-1}function hn(f){for(var S=0;f!=0;)f&=f-1,++S;return S}function Fr(){for(var f=0,S=this.s&this.DM,A=0;A<this.t;++A)f+=hn(this[A]^S);return f}function Vr(f){var S=Math.floor(f/this.DB);return S>=this.t?this.s!=0:(this[S]&1<<f%this.DB)!=0}function ss(f,S){var A=a.ONE.shiftLeft(f);return this.bitwiseTo(A,S,A),A}function as(f){return this.changeBit(f,Qt)}function Pv(f){return this.changeBit(f,Te)}function Nv(f){return this.changeBit(f,qt)}function Av(f,S){for(var A=0,z=0,V=Math.min(f.t,this.t);A<V;)z+=this[A]+f[A],S[A++]=z&this.DM,z>>=this.DB;if(f.t<this.t){for(z+=f.s;A<this.t;)z+=this[A],S[A++]=z&this.DM,z>>=this.DB;z+=this.s}else{for(z+=this.s;A<f.t;)z+=f[A],S[A++]=z&this.DM,z>>=this.DB;z+=f.s}S.s=z<0?-1:0,z>0?S[A++]=z:z<-1&&(S[A++]=this.DV+z),S.t=A,S.clamp()}function Dv(f){var S=l();return this.addTo(f,S),S}function Lv(f){var S=l();return this.subTo(f,S),S}function Ov(f){var S=l();return this.multiplyTo(f,S),S}function bv(){var f=l();return this.squareTo(f),f}function Rv(f){var S=l();return this.divRemTo(f,S,null),S}function jv(f){var S=l();return this.divRemTo(f,null,S),S}function zv(f){var S=l(),A=l();return this.divRemTo(f,S,A),new Array(S,A)}function kv(f){this[this.t]=this.am(0,f-1,this,0,0,this.t),++this.t,this.clamp()}function Bv(f,S){if(f!=0){for(;this.t<=S;)this[this.t++]=0;for(this[S]+=f;this[S]>=this.DV;)this[S]-=this.DV,++S>=this.t&&(this[this.t++]=0),++this[S]}}function oo(){}function ph(f){return f}function Wv(f,S,A){f.multiplyTo(S,A)}function Uv(f,S){f.squareTo(S)}oo.prototype.convert=ph,oo.prototype.revert=ph,oo.prototype.mulTo=Wv,oo.prototype.sqrTo=Uv;function Yv(f){return this.exp(f,new oo)}function Fv(f,S,A){var z=Math.min(this.t+f.t,S);for(A.s=0,A.t=z;z>0;)A[--z]=0;var V;for(V=A.t-this.t;z<V;++z)A[z+this.t]=this.am(0,f[z],A,z,0,this.t);for(V=Math.min(f.t,S);z<V;++z)this.am(0,f[z],A,z,0,S-z);A.clamp()}function Vv(f,S,A){--S;var z=A.t=this.t+f.t-S;for(A.s=0;--z>=0;)A[z]=0;for(z=Math.max(S-this.t,0);z<f.t;++z)A[this.t+z-S]=this.am(S-z,f[z],A,0,0,this.t+z-S);A.clamp(),A.drShiftTo(1,A)}function yi(f){this.r2=l(),this.q3=l(),a.ONE.dlShiftTo(2*f.t,this.r2),this.mu=this.r2.divide(f),this.m=f}function Xv(f){if(f.s<0||f.t>2*this.m.t)return f.mod(this.m);if(f.compareTo(this.m)<0)return f;var S=l();return f.copyTo(S),this.reduce(S),S}function Gv(f){return f}function $v(f){for(f.drShiftTo(this.m.t-1,this.r2),f.t>this.m.t+1&&(f.t=this.m.t+1,f.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);f.compareTo(this.r2)<0;)f.dAddOffset(1,this.m.t+1);for(f.subTo(this.r2,f);f.compareTo(this.m)>=0;)f.subTo(this.m,f)}function Hv(f,S){f.squareTo(S),this.reduce(S)}function Qv(f,S,A){f.multiplyTo(S,A),this.reduce(A)}yi.prototype.convert=Xv,yi.prototype.revert=Gv,yi.prototype.reduce=$v,yi.prototype.mulTo=Qv,yi.prototype.sqrTo=Hv;function Zv(f,S){var A=f.bitLength(),z,V=M(1),J;if(A<=0)return V;A<18?z=1:A<48?z=3:A<144?z=4:A<768?z=5:z=6,A<8?J=new ct(S):S.isEven()?J=new yi(S):J=new Y(S);var ot=new Array,mt=3,vt=z-1,Nt=(1<<z)-1;if(ot[1]=J.convert(this),z>1){var Bt=l();for(J.sqrTo(ot[1],Bt);mt<=Nt;)ot[mt]=l(),J.mulTo(Bt,ot[mt-2],ot[mt]),mt+=2}var Rt=f.t-1,Vt,Kt=!0,ae=l(),le;for(A=j(f[Rt])-1;Rt>=0;){for(A>=vt?Vt=f[Rt]>>A-vt&Nt:(Vt=(f[Rt]&(1<<A+1)-1)<<vt-A,Rt>0&&(Vt|=f[Rt-1]>>this.DB+A-vt)),mt=z;!(Vt&1);)Vt>>=1,--mt;if((A-=mt)<0&&(A+=this.DB,--Rt),Kt)ot[Vt].copyTo(V),Kt=!1;else{for(;mt>1;)J.sqrTo(V,ae),J.sqrTo(ae,V),mt-=2;mt>0?J.sqrTo(V,ae):(le=V,V=ae,ae=le),J.mulTo(ae,ot[Vt],V)}for(;Rt>=0&&!(f[Rt]&1<<A);)J.sqrTo(V,ae),le=V,V=ae,ae=le,--A<0&&(A=this.DB-1,--Rt)}return J.revert(V)}function Kv(f){var S=this.s<0?this.negate():this.clone(),A=f.s<0?f.negate():f.clone();if(S.compareTo(A)<0){var z=S;S=A,A=z}var V=S.getLowestSetBit(),J=A.getLowestSetBit();if(J<0)return S;for(V<J&&(J=V),J>0&&(S.rShiftTo(J,S),A.rShiftTo(J,A));S.signum()>0;)(V=S.getLowestSetBit())>0&&S.rShiftTo(V,S),(V=A.getLowestSetBit())>0&&A.rShiftTo(V,A),S.compareTo(A)>=0?(S.subTo(A,S),S.rShiftTo(1,S)):(A.subTo(S,A),A.rShiftTo(1,A));return J>0&&A.lShiftTo(J,A),A}function Jv(f){if(f<=0)return 0;var S=this.DV%f,A=this.s<0?f-1:0;if(this.t>0)if(S==0)A=this[0]%f;else for(var z=this.t-1;z>=0;--z)A=(S*A+this[z])%f;return A}function qv(f){var S=f.isEven();if(this.isEven()&&S||f.signum()==0)return a.ZERO;for(var A=f.clone(),z=this.clone(),V=M(1),J=M(0),ot=M(0),mt=M(1);A.signum()!=0;){for(;A.isEven();)A.rShiftTo(1,A),S?((!V.isEven()||!J.isEven())&&(V.addTo(this,V),J.subTo(f,J)),V.rShiftTo(1,V)):J.isEven()||J.subTo(f,J),J.rShiftTo(1,J);for(;z.isEven();)z.rShiftTo(1,z),S?((!ot.isEven()||!mt.isEven())&&(ot.addTo(this,ot),mt.subTo(f,mt)),ot.rShiftTo(1,ot)):mt.isEven()||mt.subTo(f,mt),mt.rShiftTo(1,mt);A.compareTo(z)>=0?(A.subTo(z,A),S&&V.subTo(ot,V),J.subTo(mt,J)):(z.subTo(A,z),S&&ot.subTo(V,ot),mt.subTo(J,mt))}if(z.compareTo(a.ONE)!=0)return a.ZERO;if(mt.compareTo(f)>=0)return mt.subtract(f);if(mt.signum()<0)mt.addTo(f,mt);else return mt;return mt.signum()<0?mt.add(f):mt}var Je=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],_v=(1<<26)/Je[Je.length-1];function t0(f){var S,A=this.abs();if(A.t==1&&A[0]<=Je[Je.length-1]){for(S=0;S<Je.length;++S)if(A[0]==Je[S])return!0;return!1}if(A.isEven())return!1;for(S=1;S<Je.length;){for(var z=Je[S],V=S+1;V<Je.length&&z<_v;)z*=Je[V++];for(z=A.modInt(z);S<V;)if(z%Je[S++]==0)return!1}return A.millerRabin(f)}function e0(f){var S=this.subtract(a.ONE),A=S.getLowestSetBit();if(A<=0)return!1;var z=S.shiftRight(A);f=f+1>>1,f>Je.length&&(f=Je.length);for(var V=l(),J=0;J<f;++J){V.fromInt(Je[Math.floor(Math.random()*Je.length)]);var ot=V.modPow(z,this);if(ot.compareTo(a.ONE)!=0&&ot.compareTo(S)!=0){for(var mt=1;mt++<A&&ot.compareTo(S)!=0;)if(ot=ot.modPowInt(2,this),ot.compareTo(a.ONE)==0)return!1;if(ot.compareTo(S)!=0)return!1}}return!0}a.prototype.chunkSize=yt,a.prototype.toRadix=Et,a.prototype.fromRadix=St,a.prototype.fromNumber=Mt,a.prototype.bitwiseTo=Yt,a.prototype.changeBit=ss,a.prototype.addTo=Av,a.prototype.dMultiply=kv,a.prototype.dAddOffset=Bv,a.prototype.multiplyLowerTo=Fv,a.prototype.multiplyUpperTo=Vv,a.prototype.modInt=Jv,a.prototype.millerRabin=e0,a.prototype.clone=q,a.prototype.intValue=rt,a.prototype.byteValue=lt,a.prototype.shortValue=gt,a.prototype.signum=xt,a.prototype.toByteArray=Ct,a.prototype.equals=Ot,a.prototype.min=bt,a.prototype.max=At,a.prototype.and=Zt,a.prototype.or=te,a.prototype.xor=Ee,a.prototype.andNot=Se,a.prototype.not=xe,a.prototype.shiftLeft=Ae,a.prototype.shiftRight=De,a.prototype.getLowestSetBit=ue,a.prototype.bitCount=Fr,a.prototype.testBit=Vr,a.prototype.setBit=as,a.prototype.clearBit=Pv,a.prototype.flipBit=Nv,a.prototype.add=Dv,a.prototype.subtract=Lv,a.prototype.multiply=Ov,a.prototype.divide=Rv,a.prototype.remainder=jv,a.prototype.divideAndRemainder=zv,a.prototype.modPow=Zv,a.prototype.modInverse=qv,a.prototype.pow=Yv,a.prototype.gcd=Kv,a.prototype.isProbablePrime=t0,a.prototype.square=bv;var se=a;se.prototype.IsNegative=function(){return this.compareTo(se.ZERO)==-1},se.op_Equality=function(f,S){return f.compareTo(S)==0},se.op_Inequality=function(f,S){return f.compareTo(S)!=0},se.op_GreaterThan=function(f,S){return f.compareTo(S)>0},se.op_LessThan=function(f,S){return f.compareTo(S)<0},se.op_Addition=function(f,S){return new se(f,void 0,void 0).add(new se(S,void 0,void 0))},se.op_Subtraction=function(f,S){return new se(f,void 0,void 0).subtract(new se(S,void 0,void 0))},se.Int128Mul=function(f,S){return new se(f,void 0,void 0).multiply(new se(S,void 0,void 0))},se.op_Division=function(f,S){return f.divide(S)},se.prototype.ToDouble=function(){return parseFloat(this.toString())};var gh=function(f,S){var A;if(typeof Object.getOwnPropertyNames>"u"){for(A in S.prototype)(typeof f.prototype[A]>"u"||f.prototype[A]===Object.prototype[A])&&(f.prototype[A]=S.prototype[A]);for(A in S)typeof f[A]>"u"&&(f[A]=S[A]);f.$baseCtor=S}else{for(var z=Object.getOwnPropertyNames(S.prototype),V=0;V<z.length;V++)typeof Object.getOwnPropertyDescriptor(f.prototype,z[V])>"u"&&Object.defineProperty(f.prototype,z[V],Object.getOwnPropertyDescriptor(S.prototype,z[V]));for(A in S)typeof f[A]>"u"&&(f[A]=S[A]);f.$baseCtor=S}};t.Path=function(){return[]},t.Path.prototype.push=Array.prototype.push,t.Paths=function(){return[]},t.Paths.prototype.push=Array.prototype.push,t.DoublePoint=function(){var f=arguments;this.X=0,this.Y=0,f.length===1?(this.X=f[0].X,this.Y=f[0].Y):f.length===2&&(this.X=f[0],this.Y=f[1])},t.DoublePoint0=function(){this.X=0,this.Y=0},t.DoublePoint0.prototype=t.DoublePoint.prototype,t.DoublePoint1=function(f){this.X=f.X,this.Y=f.Y},t.DoublePoint1.prototype=t.DoublePoint.prototype,t.DoublePoint2=function(f,S){this.X=f,this.Y=S},t.DoublePoint2.prototype=t.DoublePoint.prototype,t.PolyNode=function(){this.m_Parent=null,this.m_polygon=new t.Path,this.m_Index=0,this.m_jointype=0,this.m_endtype=0,this.m_Childs=[],this.IsOpen=!1},t.PolyNode.prototype.IsHoleNode=function(){for(var f=!0,S=this.m_Parent;S!==null;)f=!f,S=S.m_Parent;return f},t.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length},t.PolyNode.prototype.Contour=function(){return this.m_polygon},t.PolyNode.prototype.AddChild=function(f){var S=this.m_Childs.length;this.m_Childs.push(f),f.m_Parent=this,f.m_Index=S},t.PolyNode.prototype.GetNext=function(){return this.m_Childs.length>0?this.m_Childs[0]:this.GetNextSiblingUp()},t.PolyNode.prototype.GetNextSiblingUp=function(){return this.m_Parent===null?null:this.m_Index===this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]},t.PolyNode.prototype.Childs=function(){return this.m_Childs},t.PolyNode.prototype.Parent=function(){return this.m_Parent},t.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()},t.PolyTree=function(){this.m_AllPolys=[],t.PolyNode.call(this)},t.PolyTree.prototype.Clear=function(){for(var f=0,S=this.m_AllPolys.length;f<S;f++)this.m_AllPolys[f]=null;this.m_AllPolys.length=0,this.m_Childs.length=0},t.PolyTree.prototype.GetFirst=function(){return this.m_Childs.length>0?this.m_Childs[0]:null},t.PolyTree.prototype.Total=function(){var f=this.m_AllPolys.length;return f>0&&this.m_Childs[0]!==this.m_AllPolys[0]&&f--,f},gh(t.PolyTree,t.PolyNode),t.Math_Abs_Int64=t.Math_Abs_Int32=t.Math_Abs_Double=function(f){return Math.abs(f)},t.Math_Max_Int32_Int32=function(f,S){return Math.max(f,S)},o.msie||o.opera||o.safari?t.Cast_Int32=function(f){return f|0}:t.Cast_Int32=function(f){return~~f},typeof Number.toInteger>"u"&&(Number.toInteger=null),o.chrome?t.Cast_Int64=function(f){return f<-2147483648||f>2147483647?f<0?Math.ceil(f):Math.floor(f):~~f}:o.firefox&&typeof Number.toInteger=="function"?t.Cast_Int64=function(f){return Number.toInteger(f)}:o.msie7||o.msie8?t.Cast_Int64=function(f){return parseInt(f,10)}:o.msie?t.Cast_Int64=function(f){return f<-2147483648||f>2147483647?f<0?Math.ceil(f):Math.floor(f):f|0}:t.Cast_Int64=function(f){return f<0?Math.ceil(f):Math.floor(f)},t.Clear=function(f){f.length=0},t.PI=3.141592653589793,t.PI2=2*3.141592653589793,t.IntPoint=function(){var f=arguments,S=f.length;if(this.X=0,this.Y=0,t.use_xyz)if(this.Z=0,S===3)this.X=f[0],this.Y=f[1],this.Z=f[2];else if(S===2)this.X=f[0],this.Y=f[1],this.Z=0;else if(S===1)if(f[0]instanceof t.DoublePoint){var A=f[0];this.X=t.Clipper.Round(A.X),this.Y=t.Clipper.Round(A.Y),this.Z=0}else{var z=f[0];typeof z.Z>"u"&&(z.Z=0),this.X=z.X,this.Y=z.Y,this.Z=z.Z}else this.X=0,this.Y=0,this.Z=0;else if(S===2)this.X=f[0],this.Y=f[1];else if(S===1)if(f[0]instanceof t.DoublePoint){var A=f[0];this.X=t.Clipper.Round(A.X),this.Y=t.Clipper.Round(A.Y)}else{var z=f[0];this.X=z.X,this.Y=z.Y}else this.X=0,this.Y=0},t.IntPoint.op_Equality=function(f,S){return f.X===S.X&&f.Y===S.Y},t.IntPoint.op_Inequality=function(f,S){return f.X!==S.X||f.Y!==S.Y},t.IntPoint0=function(){this.X=0,this.Y=0,t.use_xyz&&(this.Z=0)},t.IntPoint0.prototype=t.IntPoint.prototype,t.IntPoint1=function(f){this.X=f.X,this.Y=f.Y,t.use_xyz&&(typeof f.Z>"u"?this.Z=0:this.Z=f.Z)},t.IntPoint1.prototype=t.IntPoint.prototype,t.IntPoint1dp=function(f){this.X=t.Clipper.Round(f.X),this.Y=t.Clipper.Round(f.Y),t.use_xyz&&(this.Z=0)},t.IntPoint1dp.prototype=t.IntPoint.prototype,t.IntPoint2=function(f,S,A){this.X=f,this.Y=S,t.use_xyz&&(typeof A>"u"?this.Z=0:this.Z=A)},t.IntPoint2.prototype=t.IntPoint.prototype,t.IntRect=function(){var f=arguments,S=f.length;if(S===4)this.left=f[0],this.top=f[1],this.right=f[2],this.bottom=f[3];else if(S===1){var A=f[0];this.left=A.left,this.top=A.top,this.right=A.right,this.bottom=A.bottom}else this.left=0,this.top=0,this.right=0,this.bottom=0},t.IntRect0=function(){this.left=0,this.top=0,this.right=0,this.bottom=0},t.IntRect0.prototype=t.IntRect.prototype,t.IntRect1=function(f){this.left=f.left,this.top=f.top,this.right=f.right,this.bottom=f.bottom},t.IntRect1.prototype=t.IntRect.prototype,t.IntRect4=function(f,S,A,z){this.left=f,this.top=S,this.right=A,this.bottom=z},t.IntRect4.prototype=t.IntRect.prototype,t.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3},t.PolyType={ptSubject:0,ptClip:1},t.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3},t.JoinType={jtSquare:0,jtRound:1,jtMiter:2},t.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4},t.EdgeSide={esLeft:0,esRight:1},t.Direction={dRightToLeft:0,dLeftToRight:1},t.TEdge=function(){this.Bot=new t.IntPoint0,this.Curr=new t.IntPoint0,this.Top=new t.IntPoint0,this.Delta=new t.IntPoint0,this.Dx=0,this.PolyTyp=t.PolyType.ptSubject,this.Side=t.EdgeSide.esLeft,this.WindDelta=0,this.WindCnt=0,this.WindCnt2=0,this.OutIdx=0,this.Next=null,this.Prev=null,this.NextInLML=null,this.NextInAEL=null,this.PrevInAEL=null,this.NextInSEL=null,this.PrevInSEL=null},t.IntersectNode=function(){this.Edge1=null,this.Edge2=null,this.Pt=new t.IntPoint0},t.MyIntersectNodeSort=function(){},t.MyIntersectNodeSort.Compare=function(f,S){var A=S.Pt.Y-f.Pt.Y;return A>0?1:A<0?-1:0},t.LocalMinima=function(){this.Y=0,this.LeftBound=null,this.RightBound=null,this.Next=null},t.Scanbeam=function(){this.Y=0,this.Next=null},t.Maxima=function(){this.X=0,this.Next=null,this.Prev=null},t.OutRec=function(){this.Idx=0,this.IsHole=!1,this.IsOpen=!1,this.FirstLeft=null,this.Pts=null,this.BottomPt=null,this.PolyNode=null},t.OutPt=function(){this.Idx=0,this.Pt=new t.IntPoint0,this.Next=null,this.Prev=null},t.Join=function(){this.OutPt1=null,this.OutPt2=null,this.OffPt=new t.IntPoint0},t.ClipperBase=function(){this.m_MinimaList=null,this.m_CurrentLM=null,this.m_edges=new Array,this.m_UseFullRange=!1,this.m_HasOpenPaths=!1,this.PreserveCollinear=!1,this.m_Scanbeam=null,this.m_PolyOuts=null,this.m_ActiveEdges=null},t.ClipperBase.horizontal=-9007199254740992,t.ClipperBase.Skip=-2,t.ClipperBase.Unassigned=-1,t.ClipperBase.tolerance=1e-20,t.ClipperBase.loRange=47453132,t.ClipperBase.hiRange=0xfffffffffffff,t.ClipperBase.near_zero=function(f){return f>-t.ClipperBase.tolerance&&f<t.ClipperBase.tolerance},t.ClipperBase.IsHorizontal=function(f){return f.Delta.Y===0},t.ClipperBase.prototype.PointIsVertex=function(f,S){var A=S;do{if(t.IntPoint.op_Equality(A.Pt,f))return!0;A=A.Next}while(A!==S);return!1},t.ClipperBase.prototype.PointOnLineSegment=function(f,S,A,z){return z?f.X===S.X&&f.Y===S.Y||f.X===A.X&&f.Y===A.Y||f.X>S.X==f.X<A.X&&f.Y>S.Y==f.Y<A.Y&&se.op_Equality(se.Int128Mul(f.X-S.X,A.Y-S.Y),se.Int128Mul(A.X-S.X,f.Y-S.Y)):f.X===S.X&&f.Y===S.Y||f.X===A.X&&f.Y===A.Y||f.X>S.X==f.X<A.X&&f.Y>S.Y==f.Y<A.Y&&(f.X-S.X)*(A.Y-S.Y)===(A.X-S.X)*(f.Y-S.Y)},t.ClipperBase.prototype.PointOnPolygon=function(f,S,A){for(var z=S;;){if(this.PointOnLineSegment(f,z.Pt,z.Next.Pt,A))return!0;if(z=z.Next,z===S)break}return!1},t.ClipperBase.prototype.SlopesEqual=t.ClipperBase.SlopesEqual=function(){var f=arguments,S=f.length,A,z,V,J,ot,mt,vt;return S===3?(A=f[0],z=f[1],vt=f[2],vt?se.op_Equality(se.Int128Mul(A.Delta.Y,z.Delta.X),se.Int128Mul(A.Delta.X,z.Delta.Y)):t.Cast_Int64(A.Delta.Y*z.Delta.X)===t.Cast_Int64(A.Delta.X*z.Delta.Y)):S===4?(V=f[0],J=f[1],ot=f[2],vt=f[3],vt?se.op_Equality(se.Int128Mul(V.Y-J.Y,J.X-ot.X),se.Int128Mul(V.X-J.X,J.Y-ot.Y)):t.Cast_Int64((V.Y-J.Y)*(J.X-ot.X))-t.Cast_Int64((V.X-J.X)*(J.Y-ot.Y))===0):(V=f[0],J=f[1],ot=f[2],mt=f[3],vt=f[4],vt?se.op_Equality(se.Int128Mul(V.Y-J.Y,ot.X-mt.X),se.Int128Mul(V.X-J.X,ot.Y-mt.Y)):t.Cast_Int64((V.Y-J.Y)*(ot.X-mt.X))-t.Cast_Int64((V.X-J.X)*(ot.Y-mt.Y))===0)},t.ClipperBase.SlopesEqual3=function(f,S,A){return A?se.op_Equality(se.Int128Mul(f.Delta.Y,S.Delta.X),se.Int128Mul(f.Delta.X,S.Delta.Y)):t.Cast_Int64(f.Delta.Y*S.Delta.X)===t.Cast_Int64(f.Delta.X*S.Delta.Y)},t.ClipperBase.SlopesEqual4=function(f,S,A,z){return z?se.op_Equality(se.Int128Mul(f.Y-S.Y,S.X-A.X),se.Int128Mul(f.X-S.X,S.Y-A.Y)):t.Cast_Int64((f.Y-S.Y)*(S.X-A.X))-t.Cast_Int64((f.X-S.X)*(S.Y-A.Y))===0},t.ClipperBase.SlopesEqual5=function(f,S,A,z,V){return V?se.op_Equality(se.Int128Mul(f.Y-S.Y,A.X-z.X),se.Int128Mul(f.X-S.X,A.Y-z.Y)):t.Cast_Int64((f.Y-S.Y)*(A.X-z.X))-t.Cast_Int64((f.X-S.X)*(A.Y-z.Y))===0},t.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var f=0,S=this.m_edges.length;f<S;++f){for(var A=0,z=this.m_edges[f].length;A<z;++A)this.m_edges[f][A]=null;t.Clear(this.m_edges[f])}t.Clear(this.m_edges),this.m_UseFullRange=!1,this.m_HasOpenPaths=!1},t.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;this.m_MinimaList!==null;){var f=this.m_MinimaList.Next;this.m_MinimaList=null,this.m_MinimaList=f}this.m_CurrentLM=null},t.ClipperBase.prototype.RangeTest=function(f,S){S.Value?(f.X>t.ClipperBase.hiRange||f.Y>t.ClipperBase.hiRange||-f.X>t.ClipperBase.hiRange||-f.Y>t.ClipperBase.hiRange)&&t.Error("Coordinate outside allowed range in RangeTest()."):(f.X>t.ClipperBase.loRange||f.Y>t.ClipperBase.loRange||-f.X>t.ClipperBase.loRange||-f.Y>t.ClipperBase.loRange)&&(S.Value=!0,this.RangeTest(f,S))},t.ClipperBase.prototype.InitEdge=function(f,S,A,z){f.Next=S,f.Prev=A,f.Curr.X=z.X,f.Curr.Y=z.Y,t.use_xyz&&(f.Curr.Z=z.Z),f.OutIdx=-1},t.ClipperBase.prototype.InitEdge2=function(f,S){f.Curr.Y>=f.Next.Curr.Y?(f.Bot.X=f.Curr.X,f.Bot.Y=f.Curr.Y,t.use_xyz&&(f.Bot.Z=f.Curr.Z),f.Top.X=f.Next.Curr.X,f.Top.Y=f.Next.Curr.Y,t.use_xyz&&(f.Top.Z=f.Next.Curr.Z)):(f.Top.X=f.Curr.X,f.Top.Y=f.Curr.Y,t.use_xyz&&(f.Top.Z=f.Curr.Z),f.Bot.X=f.Next.Curr.X,f.Bot.Y=f.Next.Curr.Y,t.use_xyz&&(f.Bot.Z=f.Next.Curr.Z)),this.SetDx(f),f.PolyTyp=S},t.ClipperBase.prototype.FindNextLocMin=function(f){for(var S;;){for(;t.IntPoint.op_Inequality(f.Bot,f.Prev.Bot)||t.IntPoint.op_Equality(f.Curr,f.Top);)f=f.Next;if(f.Dx!==t.ClipperBase.horizontal&&f.Prev.Dx!==t.ClipperBase.horizontal)break;for(;f.Prev.Dx===t.ClipperBase.horizontal;)f=f.Prev;for(S=f;f.Dx===t.ClipperBase.horizontal;)f=f.Next;if(f.Top.Y!==f.Prev.Bot.Y){S.Prev.Bot.X<f.Bot.X&&(f=S);break}}return f},t.ClipperBase.prototype.ProcessBound=function(f,S){var A,z=f,V;if(z.OutIdx===t.ClipperBase.Skip){if(f=z,S){for(;f.Top.Y===f.Next.Bot.Y;)f=f.Next;for(;f!==z&&f.Dx===t.ClipperBase.horizontal;)f=f.Prev}else{for(;f.Top.Y===f.Prev.Bot.Y;)f=f.Prev;for(;f!==z&&f.Dx===t.ClipperBase.horizontal;)f=f.Next}if(f===z)S?z=f.Next:z=f.Prev;else{S?f=z.Next:f=z.Prev;var J=new t.LocalMinima;J.Next=null,J.Y=f.Bot.Y,J.LeftBound=null,J.RightBound=f,f.WindDelta=0,z=this.ProcessBound(f,S),this.InsertLocalMinima(J)}return z}if(f.Dx===t.ClipperBase.horizontal&&(S?A=f.Prev:A=f.Next,A.Dx===t.ClipperBase.horizontal?A.Bot.X!==f.Bot.X&&A.Top.X!==f.Bot.X&&this.ReverseHorizontal(f):A.Bot.X!==f.Bot.X&&this.ReverseHorizontal(f)),A=f,S){for(;z.Top.Y===z.Next.Bot.Y&&z.Next.OutIdx!==t.ClipperBase.Skip;)z=z.Next;if(z.Dx===t.ClipperBase.horizontal&&z.Next.OutIdx!==t.ClipperBase.Skip){for(V=z;V.Prev.Dx===t.ClipperBase.horizontal;)V=V.Prev;V.Prev.Top.X>z.Next.Top.X&&(z=V.Prev)}for(;f!==z;)f.NextInLML=f.Next,f.Dx===t.ClipperBase.horizontal&&f!==A&&f.Bot.X!==f.Prev.Top.X&&this.ReverseHorizontal(f),f=f.Next;f.Dx===t.ClipperBase.horizontal&&f!==A&&f.Bot.X!==f.Prev.Top.X&&this.ReverseHorizontal(f),z=z.Next}else{for(;z.Top.Y===z.Prev.Bot.Y&&z.Prev.OutIdx!==t.ClipperBase.Skip;)z=z.Prev;if(z.Dx===t.ClipperBase.horizontal&&z.Prev.OutIdx!==t.ClipperBase.Skip){for(V=z;V.Next.Dx===t.ClipperBase.horizontal;)V=V.Next;(V.Next.Top.X===z.Prev.Top.X||V.Next.Top.X>z.Prev.Top.X)&&(z=V.Next)}for(;f!==z;)f.NextInLML=f.Prev,f.Dx===t.ClipperBase.horizontal&&f!==A&&f.Bot.X!==f.Next.Top.X&&this.ReverseHorizontal(f),f=f.Prev;f.Dx===t.ClipperBase.horizontal&&f!==A&&f.Bot.X!==f.Next.Top.X&&this.ReverseHorizontal(f),z=z.Prev}return z},t.ClipperBase.prototype.AddPath=function(f,S,A){t.use_lines?!A&&S===t.PolyType.ptClip&&t.Error("AddPath: Open paths must be subject."):A||t.Error("AddPath: Open paths have been disabled.");var z=f.length-1;if(A)for(;z>0&&t.IntPoint.op_Equality(f[z],f[0]);)--z;for(;z>0&&t.IntPoint.op_Equality(f[z],f[z-1]);)--z;if(A&&z<2||!A&&z<1)return!1;for(var V=new Array,J=0;J<=z;J++)V.push(new t.TEdge);var ot=!0;V[1].Curr.X=f[1].X,V[1].Curr.Y=f[1].Y,t.use_xyz&&(V[1].Curr.Z=f[1].Z);var mt={Value:this.m_UseFullRange};this.RangeTest(f[0],mt),this.m_UseFullRange=mt.Value,mt.Value=this.m_UseFullRange,this.RangeTest(f[z],mt),this.m_UseFullRange=mt.Value,this.InitEdge(V[0],V[1],V[z],f[0]),this.InitEdge(V[z],V[0],V[z-1],f[z]);for(var J=z-1;J>=1;--J)mt.Value=this.m_UseFullRange,this.RangeTest(f[J],mt),this.m_UseFullRange=mt.Value,this.InitEdge(V[J],V[J+1],V[J-1],f[J]);for(var vt=V[0],Nt=vt,Bt=vt;;){if(Nt.Curr===Nt.Next.Curr&&(A||Nt.Next!==vt)){if(Nt===Nt.Next)break;Nt===vt&&(vt=Nt.Next),Nt=this.RemoveEdge(Nt),Bt=Nt;continue}if(Nt.Prev===Nt.Next)break;if(A&&t.ClipperBase.SlopesEqual4(Nt.Prev.Curr,Nt.Curr,Nt.Next.Curr,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(Nt.Prev.Curr,Nt.Curr,Nt.Next.Curr))){Nt===vt&&(vt=Nt.Next),Nt=this.RemoveEdge(Nt),Nt=Nt.Prev,Bt=Nt;continue}if(Nt=Nt.Next,Nt===Bt||!A&&Nt.Next===vt)break}if(!A&&Nt===Nt.Next||A&&Nt.Prev===Nt.Next)return!1;A||(this.m_HasOpenPaths=!0,vt.Prev.OutIdx=t.ClipperBase.Skip),Nt=vt;do this.InitEdge2(Nt,S),Nt=Nt.Next,ot&&Nt.Curr.Y!==vt.Curr.Y&&(ot=!1);while(Nt!==vt);if(ot){if(A)return!1;Nt.Prev.OutIdx=t.ClipperBase.Skip;var Rt=new t.LocalMinima;for(Rt.Next=null,Rt.Y=Nt.Bot.Y,Rt.LeftBound=null,Rt.RightBound=Nt,Rt.RightBound.Side=t.EdgeSide.esRight,Rt.RightBound.WindDelta=0;Nt.Bot.X!==Nt.Prev.Top.X&&this.ReverseHorizontal(Nt),Nt.Next.OutIdx!==t.ClipperBase.Skip;)Nt.NextInLML=Nt.Next,Nt=Nt.Next;return this.InsertLocalMinima(Rt),this.m_edges.push(V),!0}this.m_edges.push(V);var Vt,Kt=null;for(t.IntPoint.op_Equality(Nt.Prev.Bot,Nt.Prev.Top)&&(Nt=Nt.Next);Nt=this.FindNextLocMin(Nt),Nt!==Kt;){Kt===null&&(Kt=Nt);var Rt=new t.LocalMinima;Rt.Next=null,Rt.Y=Nt.Bot.Y,Nt.Dx<Nt.Prev.Dx?(Rt.LeftBound=Nt.Prev,Rt.RightBound=Nt,Vt=!1):(Rt.LeftBound=Nt,Rt.RightBound=Nt.Prev,Vt=!0),Rt.LeftBound.Side=t.EdgeSide.esLeft,Rt.RightBound.Side=t.EdgeSide.esRight,A?Rt.LeftBound.Next===Rt.RightBound?Rt.LeftBound.WindDelta=-1:Rt.LeftBound.WindDelta=1:Rt.LeftBound.WindDelta=0,Rt.RightBound.WindDelta=-Rt.LeftBound.WindDelta,Nt=this.ProcessBound(Rt.LeftBound,Vt),Nt.OutIdx===t.ClipperBase.Skip&&(Nt=this.ProcessBound(Nt,Vt));var ae=this.ProcessBound(Rt.RightBound,!Vt);ae.OutIdx===t.ClipperBase.Skip&&(ae=this.ProcessBound(ae,!Vt)),Rt.LeftBound.OutIdx===t.ClipperBase.Skip?Rt.LeftBound=null:Rt.RightBound.OutIdx===t.ClipperBase.Skip&&(Rt.RightBound=null),this.InsertLocalMinima(Rt),Vt||(Nt=ae)}return!0},t.ClipperBase.prototype.AddPaths=function(f,S,A){for(var z=!1,V=0,J=f.length;V<J;++V)this.AddPath(f[V],S,A)&&(z=!0);return z},t.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(f,S,A){return t.IntPoint.op_Equality(f,A)||t.IntPoint.op_Equality(f,S)||t.IntPoint.op_Equality(A,S)?!1:f.X!==A.X?S.X>f.X==S.X<A.X:S.Y>f.Y==S.Y<A.Y},t.ClipperBase.prototype.RemoveEdge=function(f){f.Prev.Next=f.Next,f.Next.Prev=f.Prev;var S=f.Next;return f.Prev=null,S},t.ClipperBase.prototype.SetDx=function(f){f.Delta.X=f.Top.X-f.Bot.X,f.Delta.Y=f.Top.Y-f.Bot.Y,f.Delta.Y===0?f.Dx=t.ClipperBase.horizontal:f.Dx=f.Delta.X/f.Delta.Y},t.ClipperBase.prototype.InsertLocalMinima=function(f){if(this.m_MinimaList===null)this.m_MinimaList=f;else if(f.Y>=this.m_MinimaList.Y)f.Next=this.m_MinimaList,this.m_MinimaList=f;else{for(var S=this.m_MinimaList;S.Next!==null&&f.Y<S.Next.Y;)S=S.Next;f.Next=S.Next,S.Next=f}},t.ClipperBase.prototype.PopLocalMinima=function(f,S){return S.v=this.m_CurrentLM,this.m_CurrentLM!==null&&this.m_CurrentLM.Y===f?(this.m_CurrentLM=this.m_CurrentLM.Next,!0):!1},t.ClipperBase.prototype.ReverseHorizontal=function(f){var S=f.Top.X;f.Top.X=f.Bot.X,f.Bot.X=S,t.use_xyz&&(S=f.Top.Z,f.Top.Z=f.Bot.Z,f.Bot.Z=S)},t.ClipperBase.prototype.Reset=function(){if(this.m_CurrentLM=this.m_MinimaList,this.m_CurrentLM!==null){this.m_Scanbeam=null;for(var f=this.m_MinimaList;f!==null;){this.InsertScanbeam(f.Y);var S=f.LeftBound;S!==null&&(S.Curr.X=S.Bot.X,S.Curr.Y=S.Bot.Y,t.use_xyz&&(S.Curr.Z=S.Bot.Z),S.OutIdx=t.ClipperBase.Unassigned),S=f.RightBound,S!==null&&(S.Curr.X=S.Bot.X,S.Curr.Y=S.Bot.Y,t.use_xyz&&(S.Curr.Z=S.Bot.Z),S.OutIdx=t.ClipperBase.Unassigned),f=f.Next}this.m_ActiveEdges=null}},t.ClipperBase.prototype.InsertScanbeam=function(f){if(this.m_Scanbeam===null)this.m_Scanbeam=new t.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=f;else if(f>this.m_Scanbeam.Y){var S=new t.Scanbeam;S.Y=f,S.Next=this.m_Scanbeam,this.m_Scanbeam=S}else{for(var A=this.m_Scanbeam;A.Next!==null&&f<=A.Next.Y;)A=A.Next;if(f===A.Y)return;var z=new t.Scanbeam;z.Y=f,z.Next=A.Next,A.Next=z}},t.ClipperBase.prototype.PopScanbeam=function(f){return this.m_Scanbeam===null?(f.v=0,!1):(f.v=this.m_Scanbeam.Y,this.m_Scanbeam=this.m_Scanbeam.Next,!0)},t.ClipperBase.prototype.LocalMinimaPending=function(){return this.m_CurrentLM!==null},t.ClipperBase.prototype.CreateOutRec=function(){var f=new t.OutRec;return f.Idx=t.ClipperBase.Unassigned,f.IsHole=!1,f.IsOpen=!1,f.FirstLeft=null,f.Pts=null,f.BottomPt=null,f.PolyNode=null,this.m_PolyOuts.push(f),f.Idx=this.m_PolyOuts.length-1,f},t.ClipperBase.prototype.DisposeOutRec=function(f){var S=this.m_PolyOuts[f];S.Pts=null,S=null,this.m_PolyOuts[f]=null},t.ClipperBase.prototype.UpdateEdgeIntoAEL=function(f){f.NextInLML===null&&t.Error("UpdateEdgeIntoAEL: invalid call");var S=f.PrevInAEL,A=f.NextInAEL;return f.NextInLML.OutIdx=f.OutIdx,S!==null?S.NextInAEL=f.NextInLML:this.m_ActiveEdges=f.NextInLML,A!==null&&(A.PrevInAEL=f.NextInLML),f.NextInLML.Side=f.Side,f.NextInLML.WindDelta=f.WindDelta,f.NextInLML.WindCnt=f.WindCnt,f.NextInLML.WindCnt2=f.WindCnt2,f=f.NextInLML,f.Curr.X=f.Bot.X,f.Curr.Y=f.Bot.Y,f.PrevInAEL=S,f.NextInAEL=A,t.ClipperBase.IsHorizontal(f)||this.InsertScanbeam(f.Top.Y),f},t.ClipperBase.prototype.SwapPositionsInAEL=function(f,S){if(!(f.NextInAEL===f.PrevInAEL||S.NextInAEL===S.PrevInAEL)){if(f.NextInAEL===S){var A=S.NextInAEL;A!==null&&(A.PrevInAEL=f);var z=f.PrevInAEL;z!==null&&(z.NextInAEL=S),S.PrevInAEL=z,S.NextInAEL=f,f.PrevInAEL=S,f.NextInAEL=A}else if(S.NextInAEL===f){var V=f.NextInAEL;V!==null&&(V.PrevInAEL=S);var J=S.PrevInAEL;J!==null&&(J.NextInAEL=f),f.PrevInAEL=J,f.NextInAEL=S,S.PrevInAEL=f,S.NextInAEL=V}else{var ot=f.NextInAEL,mt=f.PrevInAEL;f.NextInAEL=S.NextInAEL,f.NextInAEL!==null&&(f.NextInAEL.PrevInAEL=f),f.PrevInAEL=S.PrevInAEL,f.PrevInAEL!==null&&(f.PrevInAEL.NextInAEL=f),S.NextInAEL=ot,S.NextInAEL!==null&&(S.NextInAEL.PrevInAEL=S),S.PrevInAEL=mt,S.PrevInAEL!==null&&(S.PrevInAEL.NextInAEL=S)}f.PrevInAEL===null?this.m_ActiveEdges=f:S.PrevInAEL===null&&(this.m_ActiveEdges=S)}},t.ClipperBase.prototype.DeleteFromAEL=function(f){var S=f.PrevInAEL,A=f.NextInAEL;S===null&&A===null&&f!==this.m_ActiveEdges||(S!==null?S.NextInAEL=A:this.m_ActiveEdges=A,A!==null&&(A.PrevInAEL=S),f.NextInAEL=null,f.PrevInAEL=null)},t.Clipper=function(f){typeof f>"u"&&(f=0),this.m_PolyOuts=null,this.m_ClipType=t.ClipType.ctIntersection,this.m_Scanbeam=null,this.m_Maxima=null,this.m_ActiveEdges=null,this.m_SortedEdges=null,this.m_IntersectList=null,this.m_IntersectNodeComparer=null,this.m_ExecuteLocked=!1,this.m_ClipFillType=t.PolyFillType.pftEvenOdd,this.m_SubjFillType=t.PolyFillType.pftEvenOdd,this.m_Joins=null,this.m_GhostJoins=null,this.m_UsingPolyTree=!1,this.ReverseSolution=!1,this.StrictlySimple=!1,t.ClipperBase.call(this),this.m_Scanbeam=null,this.m_Maxima=null,this.m_ActiveEdges=null,this.m_SortedEdges=null,this.m_IntersectList=new Array,this.m_IntersectNodeComparer=t.MyIntersectNodeSort.Compare,this.m_ExecuteLocked=!1,this.m_UsingPolyTree=!1,this.m_PolyOuts=new Array,this.m_Joins=new Array,this.m_GhostJoins=new Array,this.ReverseSolution=(1&f)!==0,this.StrictlySimple=(2&f)!==0,this.PreserveCollinear=(4&f)!==0,t.use_xyz&&(this.ZFillFunction=null)},t.Clipper.ioReverseSolution=1,t.Clipper.ioStrictlySimple=2,t.Clipper.ioPreserveCollinear=4,t.Clipper.prototype.Clear=function(){this.m_edges.length!==0&&(this.DisposeAllPolyPts(),t.ClipperBase.prototype.Clear.call(this))},t.Clipper.prototype.InsertMaxima=function(f){var S=new t.Maxima;if(S.X=f,this.m_Maxima===null)this.m_Maxima=S,this.m_Maxima.Next=null,this.m_Maxima.Prev=null;else if(f<this.m_Maxima.X)S.Next=this.m_Maxima,S.Prev=null,this.m_Maxima=S;else{for(var A=this.m_Maxima;A.Next!==null&&f>=A.Next.X;)A=A.Next;if(f===A.X)return;S.Next=A.Next,S.Prev=A,A.Next!==null&&(A.Next.Prev=S),A.Next=S}},t.Clipper.prototype.Execute=function(){var f=arguments,S=f.length,A=f[1]instanceof t.PolyTree;if(S===4&&!A){var z=f[0],V=f[1],J=f[2],ot=f[3];if(this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&t.Error("Error: PolyTree struct is needed for open path clipping."),this.m_ExecuteLocked=!0,t.Clear(V),this.m_SubjFillType=J,this.m_ClipFillType=ot,this.m_ClipType=z,this.m_UsingPolyTree=!1;try{var mt=this.ExecuteInternal();mt&&this.BuildResult(V)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return mt}else if(S===4&&A){var z=f[0],vt=f[1],J=f[2],ot=f[3];if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0,this.m_SubjFillType=J,this.m_ClipFillType=ot,this.m_ClipType=z,this.m_UsingPolyTree=!0;try{var mt=this.ExecuteInternal();mt&&this.BuildResult2(vt)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return mt}else if(S===2&&!A){var z=f[0],V=f[1];return this.Execute(z,V,t.PolyFillType.pftEvenOdd,t.PolyFillType.pftEvenOdd)}else if(S===2&&A){var z=f[0],vt=f[1];return this.Execute(z,vt,t.PolyFillType.pftEvenOdd,t.PolyFillType.pftEvenOdd)}},t.Clipper.prototype.FixHoleLinkage=function(f){if(!(f.FirstLeft===null||f.IsHole!==f.FirstLeft.IsHole&&f.FirstLeft.Pts!==null)){for(var S=f.FirstLeft;S!==null&&(S.IsHole===f.IsHole||S.Pts===null);)S=S.FirstLeft;f.FirstLeft=S}},t.Clipper.prototype.ExecuteInternal=function(){try{this.Reset(),this.m_SortedEdges=null,this.m_Maxima=null;var f={},S={};if(!this.PopScanbeam(f))return!1;for(this.InsertLocalMinimaIntoAEL(f.v);this.PopScanbeam(S)||this.LocalMinimaPending();){if(this.ProcessHorizontals(),this.m_GhostJoins.length=0,!this.ProcessIntersections(S.v))return!1;this.ProcessEdgesAtTopOfScanbeam(S.v),f.v=S.v,this.InsertLocalMinimaIntoAEL(f.v)}var A,z,V;for(z=0,V=this.m_PolyOuts.length;z<V;z++)A=this.m_PolyOuts[z],!(A.Pts===null||A.IsOpen)&&(A.IsHole^this.ReverseSolution)==this.Area$1(A)>0&&this.ReversePolyPtLinks(A.Pts);for(this.JoinCommonEdges(),z=0,V=this.m_PolyOuts.length;z<V;z++)A=this.m_PolyOuts[z],A.Pts!==null&&(A.IsOpen?this.FixupOutPolyline(A):this.FixupOutPolygon(A));return this.StrictlySimple&&this.DoSimplePolygons(),!0}finally{this.m_Joins.length=0,this.m_GhostJoins.length=0}},t.Clipper.prototype.DisposeAllPolyPts=function(){for(var f=0,S=this.m_PolyOuts.length;f<S;++f)this.DisposeOutRec(f);t.Clear(this.m_PolyOuts)},t.Clipper.prototype.AddJoin=function(f,S,A){var z=new t.Join;z.OutPt1=f,z.OutPt2=S,z.OffPt.X=A.X,z.OffPt.Y=A.Y,t.use_xyz&&(z.OffPt.Z=A.Z),this.m_Joins.push(z)},t.Clipper.prototype.AddGhostJoin=function(f,S){var A=new t.Join;A.OutPt1=f,A.OffPt.X=S.X,A.OffPt.Y=S.Y,t.use_xyz&&(A.OffPt.Z=S.Z),this.m_GhostJoins.push(A)},t.Clipper.prototype.SetZ=function(f,S,A){if(this.ZFillFunction!==null){if(f.Z!==0||this.ZFillFunction===null)return;t.IntPoint.op_Equality(f,S.Bot)?f.Z=S.Bot.Z:t.IntPoint.op_Equality(f,S.Top)?f.Z=S.Top.Z:t.IntPoint.op_Equality(f,A.Bot)?f.Z=A.Bot.Z:t.IntPoint.op_Equality(f,A.Top)?f.Z=A.Top.Z:this.ZFillFunction(S.Bot,S.Top,A.Bot,A.Top,f)}},t.Clipper.prototype.InsertLocalMinimaIntoAEL=function(f){for(var S={},A,z;this.PopLocalMinima(f,S);){A=S.v.LeftBound,z=S.v.RightBound;var V=null;if(A===null?(this.InsertEdgeIntoAEL(z,null),this.SetWindingCount(z),this.IsContributing(z)&&(V=this.AddOutPt(z,z.Bot))):z===null?(this.InsertEdgeIntoAEL(A,null),this.SetWindingCount(A),this.IsContributing(A)&&(V=this.AddOutPt(A,A.Bot)),this.InsertScanbeam(A.Top.Y)):(this.InsertEdgeIntoAEL(A,null),this.InsertEdgeIntoAEL(z,A),this.SetWindingCount(A),z.WindCnt=A.WindCnt,z.WindCnt2=A.WindCnt2,this.IsContributing(A)&&(V=this.AddLocalMinPoly(A,z,A.Bot)),this.InsertScanbeam(A.Top.Y)),z!==null&&(t.ClipperBase.IsHorizontal(z)?(z.NextInLML!==null&&this.InsertScanbeam(z.NextInLML.Top.Y),this.AddEdgeToSEL(z)):this.InsertScanbeam(z.Top.Y)),!(A===null||z===null)){if(V!==null&&t.ClipperBase.IsHorizontal(z)&&this.m_GhostJoins.length>0&&z.WindDelta!==0)for(var J=0,ot=this.m_GhostJoins.length;J<ot;J++){var mt=this.m_GhostJoins[J];this.HorzSegmentsOverlap(mt.OutPt1.Pt.X,mt.OffPt.X,z.Bot.X,z.Top.X)&&this.AddJoin(mt.OutPt1,V,mt.OffPt)}if(A.OutIdx>=0&&A.PrevInAEL!==null&&A.PrevInAEL.Curr.X===A.Bot.X&&A.PrevInAEL.OutIdx>=0&&t.ClipperBase.SlopesEqual5(A.PrevInAEL.Curr,A.PrevInAEL.Top,A.Curr,A.Top,this.m_UseFullRange)&&A.WindDelta!==0&&A.PrevInAEL.WindDelta!==0){var vt=this.AddOutPt(A.PrevInAEL,A.Bot);this.AddJoin(V,vt,A.Top)}if(A.NextInAEL!==z){if(z.OutIdx>=0&&z.PrevInAEL.OutIdx>=0&&t.ClipperBase.SlopesEqual5(z.PrevInAEL.Curr,z.PrevInAEL.Top,z.Curr,z.Top,this.m_UseFullRange)&&z.WindDelta!==0&&z.PrevInAEL.WindDelta!==0){var vt=this.AddOutPt(z.PrevInAEL,z.Bot);this.AddJoin(V,vt,z.Top)}var Nt=A.NextInAEL;if(Nt!==null)for(;Nt!==z;)this.IntersectEdges(z,Nt,A.Curr),Nt=Nt.NextInAEL}}}},t.Clipper.prototype.InsertEdgeIntoAEL=function(f,S){if(this.m_ActiveEdges===null)f.PrevInAEL=null,f.NextInAEL=null,this.m_ActiveEdges=f;else if(S===null&&this.E2InsertsBeforeE1(this.m_ActiveEdges,f))f.PrevInAEL=null,f.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges.PrevInAEL=f,this.m_ActiveEdges=f;else{for(S===null&&(S=this.m_ActiveEdges);S.NextInAEL!==null&&!this.E2InsertsBeforeE1(S.NextInAEL,f);)S=S.NextInAEL;f.NextInAEL=S.NextInAEL,S.NextInAEL!==null&&(S.NextInAEL.PrevInAEL=f),f.PrevInAEL=S,S.NextInAEL=f}},t.Clipper.prototype.E2InsertsBeforeE1=function(f,S){return S.Curr.X===f.Curr.X?S.Top.Y>f.Top.Y?S.Top.X<t.Clipper.TopX(f,S.Top.Y):f.Top.X>t.Clipper.TopX(S,f.Top.Y):S.Curr.X<f.Curr.X},t.Clipper.prototype.IsEvenOddFillType=function(f){return f.PolyTyp===t.PolyType.ptSubject?this.m_SubjFillType===t.PolyFillType.pftEvenOdd:this.m_ClipFillType===t.PolyFillType.pftEvenOdd},t.Clipper.prototype.IsEvenOddAltFillType=function(f){return f.PolyTyp===t.PolyType.ptSubject?this.m_ClipFillType===t.PolyFillType.pftEvenOdd:this.m_SubjFillType===t.PolyFillType.pftEvenOdd},t.Clipper.prototype.IsContributing=function(f){var S,A;switch(f.PolyTyp===t.PolyType.ptSubject?(S=this.m_SubjFillType,A=this.m_ClipFillType):(S=this.m_ClipFillType,A=this.m_SubjFillType),S){case t.PolyFillType.pftEvenOdd:if(f.WindDelta===0&&f.WindCnt!==1)return!1;break;case t.PolyFillType.pftNonZero:if(Math.abs(f.WindCnt)!==1)return!1;break;case t.PolyFillType.pftPositive:if(f.WindCnt!==1)return!1;break;default:if(f.WindCnt!==-1)return!1;break}switch(this.m_ClipType){case t.ClipType.ctIntersection:switch(A){case t.PolyFillType.pftEvenOdd:case t.PolyFillType.pftNonZero:return f.WindCnt2!==0;case t.PolyFillType.pftPositive:return f.WindCnt2>0;default:return f.WindCnt2<0}case t.ClipType.ctUnion:switch(A){case t.PolyFillType.pftEvenOdd:case t.PolyFillType.pftNonZero:return f.WindCnt2===0;case t.PolyFillType.pftPositive:return f.WindCnt2<=0;default:return f.WindCnt2>=0}case t.ClipType.ctDifference:if(f.PolyTyp===t.PolyType.ptSubject)switch(A){case t.PolyFillType.pftEvenOdd:case t.PolyFillType.pftNonZero:return f.WindCnt2===0;case t.PolyFillType.pftPositive:return f.WindCnt2<=0;default:return f.WindCnt2>=0}else switch(A){case t.PolyFillType.pftEvenOdd:case t.PolyFillType.pftNonZero:return f.WindCnt2!==0;case t.PolyFillType.pftPositive:return f.WindCnt2>0;default:return f.WindCnt2<0}case t.ClipType.ctXor:if(f.WindDelta===0)switch(A){case t.PolyFillType.pftEvenOdd:case t.PolyFillType.pftNonZero:return f.WindCnt2===0;case t.PolyFillType.pftPositive:return f.WindCnt2<=0;default:return f.WindCnt2>=0}else return!0}return!0},t.Clipper.prototype.SetWindingCount=function(f){for(var S=f.PrevInAEL;S!==null&&(S.PolyTyp!==f.PolyTyp||S.WindDelta===0);)S=S.PrevInAEL;if(S===null){var A=f.PolyTyp===t.PolyType.ptSubject?this.m_SubjFillType:this.m_ClipFillType;f.WindDelta===0?f.WindCnt=A===t.PolyFillType.pftNegative?-1:1:f.WindCnt=f.WindDelta,f.WindCnt2=0,S=this.m_ActiveEdges}else if(f.WindDelta===0&&this.m_ClipType!==t.ClipType.ctUnion)f.WindCnt=1,f.WindCnt2=S.WindCnt2,S=S.NextInAEL;else if(this.IsEvenOddFillType(f)){if(f.WindDelta===0){for(var z=!0,V=S.PrevInAEL;V!==null;)V.PolyTyp===S.PolyTyp&&V.WindDelta!==0&&(z=!z),V=V.PrevInAEL;f.WindCnt=z?0:1}else f.WindCnt=f.WindDelta;f.WindCnt2=S.WindCnt2,S=S.NextInAEL}else S.WindCnt*S.WindDelta<0?Math.abs(S.WindCnt)>1?S.WindDelta*f.WindDelta<0?f.WindCnt=S.WindCnt:f.WindCnt=S.WindCnt+f.WindDelta:f.WindCnt=f.WindDelta===0?1:f.WindDelta:f.WindDelta===0?f.WindCnt=S.WindCnt<0?S.WindCnt-1:S.WindCnt+1:S.WindDelta*f.WindDelta<0?f.WindCnt=S.WindCnt:f.WindCnt=S.WindCnt+f.WindDelta,f.WindCnt2=S.WindCnt2,S=S.NextInAEL;if(this.IsEvenOddAltFillType(f))for(;S!==f;)S.WindDelta!==0&&(f.WindCnt2=f.WindCnt2===0?1:0),S=S.NextInAEL;else for(;S!==f;)f.WindCnt2+=S.WindDelta,S=S.NextInAEL},t.Clipper.prototype.AddEdgeToSEL=function(f){this.m_SortedEdges===null?(this.m_SortedEdges=f,f.PrevInSEL=null,f.NextInSEL=null):(f.NextInSEL=this.m_SortedEdges,f.PrevInSEL=null,this.m_SortedEdges.PrevInSEL=f,this.m_SortedEdges=f)},t.Clipper.prototype.PopEdgeFromSEL=function(f){if(f.v=this.m_SortedEdges,f.v===null)return!1;var S=f.v;return this.m_SortedEdges=f.v.NextInSEL,this.m_SortedEdges!==null&&(this.m_SortedEdges.PrevInSEL=null),S.NextInSEL=null,S.PrevInSEL=null,!0},t.Clipper.prototype.CopyAELToSEL=function(){var f=this.m_ActiveEdges;for(this.m_SortedEdges=f;f!==null;)f.PrevInSEL=f.PrevInAEL,f.NextInSEL=f.NextInAEL,f=f.NextInAEL},t.Clipper.prototype.SwapPositionsInSEL=function(f,S){if(!(f.NextInSEL===null&&f.PrevInSEL===null)&&!(S.NextInSEL===null&&S.PrevInSEL===null)){if(f.NextInSEL===S){var A=S.NextInSEL;A!==null&&(A.PrevInSEL=f);var z=f.PrevInSEL;z!==null&&(z.NextInSEL=S),S.PrevInSEL=z,S.NextInSEL=f,f.PrevInSEL=S,f.NextInSEL=A}else if(S.NextInSEL===f){var A=f.NextInSEL;A!==null&&(A.PrevInSEL=S);var z=S.PrevInSEL;z!==null&&(z.NextInSEL=f),f.PrevInSEL=z,f.NextInSEL=S,S.PrevInSEL=f,S.NextInSEL=A}else{var A=f.NextInSEL,z=f.PrevInSEL;f.NextInSEL=S.NextInSEL,f.NextInSEL!==null&&(f.NextInSEL.PrevInSEL=f),f.PrevInSEL=S.PrevInSEL,f.PrevInSEL!==null&&(f.PrevInSEL.NextInSEL=f),S.NextInSEL=A,S.NextInSEL!==null&&(S.NextInSEL.PrevInSEL=S),S.PrevInSEL=z,S.PrevInSEL!==null&&(S.PrevInSEL.NextInSEL=S)}f.PrevInSEL===null?this.m_SortedEdges=f:S.PrevInSEL===null&&(this.m_SortedEdges=S)}},t.Clipper.prototype.AddLocalMaxPoly=function(f,S,A){this.AddOutPt(f,A),S.WindDelta===0&&this.AddOutPt(S,A),f.OutIdx===S.OutIdx?(f.OutIdx=-1,S.OutIdx=-1):f.OutIdx<S.OutIdx?this.AppendPolygon(f,S):this.AppendPolygon(S,f)},t.Clipper.prototype.AddLocalMinPoly=function(f,S,A){var z,V,J;if(t.ClipperBase.IsHorizontal(S)||f.Dx>S.Dx?(z=this.AddOutPt(f,A),S.OutIdx=f.OutIdx,f.Side=t.EdgeSide.esLeft,S.Side=t.EdgeSide.esRight,V=f,V.PrevInAEL===S?J=S.PrevInAEL:J=V.PrevInAEL):(z=this.AddOutPt(S,A),f.OutIdx=S.OutIdx,f.Side=t.EdgeSide.esRight,S.Side=t.EdgeSide.esLeft,V=S,V.PrevInAEL===f?J=f.PrevInAEL:J=V.PrevInAEL),J!==null&&J.OutIdx>=0&&J.Top.Y<A.Y&&V.Top.Y<A.Y){var ot=t.Clipper.TopX(J,A.Y),mt=t.Clipper.TopX(V,A.Y);if(ot===mt&&V.WindDelta!==0&&J.WindDelta!==0&&t.ClipperBase.SlopesEqual5(new t.IntPoint2(ot,A.Y),J.Top,new t.IntPoint2(mt,A.Y),V.Top,this.m_UseFullRange)){var vt=this.AddOutPt(J,A);this.AddJoin(z,vt,V.Top)}}return z},t.Clipper.prototype.AddOutPt=function(f,S){if(f.OutIdx<0){var A=this.CreateOutRec();A.IsOpen=f.WindDelta===0;var z=new t.OutPt;return A.Pts=z,z.Idx=A.Idx,z.Pt.X=S.X,z.Pt.Y=S.Y,t.use_xyz&&(z.Pt.Z=S.Z),z.Next=z,z.Prev=z,A.IsOpen||this.SetHoleState(f,A),f.OutIdx=A.Idx,z}else{var A=this.m_PolyOuts[f.OutIdx],V=A.Pts,J=f.Side===t.EdgeSide.esLeft;if(J&&t.IntPoint.op_Equality(S,V.Pt))return V;if(!J&&t.IntPoint.op_Equality(S,V.Prev.Pt))return V.Prev;var z=new t.OutPt;return z.Idx=A.Idx,z.Pt.X=S.X,z.Pt.Y=S.Y,t.use_xyz&&(z.Pt.Z=S.Z),z.Next=V,z.Prev=V.Prev,z.Prev.Next=z,V.Prev=z,J&&(A.Pts=z),z}},t.Clipper.prototype.GetLastOutPt=function(f){var S=this.m_PolyOuts[f.OutIdx];return f.Side===t.EdgeSide.esLeft?S.Pts:S.Pts.Prev},t.Clipper.prototype.SwapPoints=function(f,S){var A=new t.IntPoint1(f.Value);f.Value.X=S.Value.X,f.Value.Y=S.Value.Y,t.use_xyz&&(f.Value.Z=S.Value.Z),S.Value.X=A.X,S.Value.Y=A.Y,t.use_xyz&&(S.Value.Z=A.Z)},t.Clipper.prototype.HorzSegmentsOverlap=function(f,S,A,z){var V;return f>S&&(V=f,f=S,S=V),A>z&&(V=A,A=z,z=V),f<z&&A<S},t.Clipper.prototype.SetHoleState=function(f,S){for(var A=f.PrevInAEL,z=null;A!==null;)A.OutIdx>=0&&A.WindDelta!==0&&(z===null?z=A:z.OutIdx===A.OutIdx&&(z=null)),A=A.PrevInAEL;z===null?(S.FirstLeft=null,S.IsHole=!1):(S.FirstLeft=this.m_PolyOuts[z.OutIdx],S.IsHole=!S.FirstLeft.IsHole)},t.Clipper.prototype.GetDx=function(f,S){return f.Y===S.Y?t.ClipperBase.horizontal:(S.X-f.X)/(S.Y-f.Y)},t.Clipper.prototype.FirstIsBottomPt=function(f,S){for(var A=f.Prev;t.IntPoint.op_Equality(A.Pt,f.Pt)&&A!==f;)A=A.Prev;var z=Math.abs(this.GetDx(f.Pt,A.Pt));for(A=f.Next;t.IntPoint.op_Equality(A.Pt,f.Pt)&&A!==f;)A=A.Next;var V=Math.abs(this.GetDx(f.Pt,A.Pt));for(A=S.Prev;t.IntPoint.op_Equality(A.Pt,S.Pt)&&A!==S;)A=A.Prev;var J=Math.abs(this.GetDx(S.Pt,A.Pt));for(A=S.Next;t.IntPoint.op_Equality(A.Pt,S.Pt)&&A!==S;)A=A.Next;var ot=Math.abs(this.GetDx(S.Pt,A.Pt));return Math.max(z,V)===Math.max(J,ot)&&Math.min(z,V)===Math.min(J,ot)?this.Area(f)>0:z>=J&&z>=ot||V>=J&&V>=ot},t.Clipper.prototype.GetBottomPt=function(f){for(var S=null,A=f.Next;A!==f;)A.Pt.Y>f.Pt.Y?(f=A,S=null):A.Pt.Y===f.Pt.Y&&A.Pt.X<=f.Pt.X&&(A.Pt.X<f.Pt.X?(S=null,f=A):A.Next!==f&&A.Prev!==f&&(S=A)),A=A.Next;if(S!==null)for(;S!==A;)for(this.FirstIsBottomPt(A,S)||(f=S),S=S.Next;t.IntPoint.op_Inequality(S.Pt,f.Pt);)S=S.Next;return f},t.Clipper.prototype.GetLowermostRec=function(f,S){f.BottomPt===null&&(f.BottomPt=this.GetBottomPt(f.Pts)),S.BottomPt===null&&(S.BottomPt=this.GetBottomPt(S.Pts));var A=f.BottomPt,z=S.BottomPt;return A.Pt.Y>z.Pt.Y?f:A.Pt.Y<z.Pt.Y?S:A.Pt.X<z.Pt.X?f:A.Pt.X>z.Pt.X||A.Next===A?S:z.Next===z||this.FirstIsBottomPt(A,z)?f:S},t.Clipper.prototype.OutRec1RightOfOutRec2=function(f,S){do if(f=f.FirstLeft,f===S)return!0;while(f!==null);return!1},t.Clipper.prototype.GetOutRec=function(f){for(var S=this.m_PolyOuts[f];S!==this.m_PolyOuts[S.Idx];)S=this.m_PolyOuts[S.Idx];return S},t.Clipper.prototype.AppendPolygon=function(f,S){var A=this.m_PolyOuts[f.OutIdx],z=this.m_PolyOuts[S.OutIdx],V;this.OutRec1RightOfOutRec2(A,z)?V=z:this.OutRec1RightOfOutRec2(z,A)?V=A:V=this.GetLowermostRec(A,z);var J=A.Pts,ot=J.Prev,mt=z.Pts,vt=mt.Prev;f.Side===t.EdgeSide.esLeft?S.Side===t.EdgeSide.esLeft?(this.ReversePolyPtLinks(mt),mt.Next=J,J.Prev=mt,ot.Next=vt,vt.Prev=ot,A.Pts=vt):(vt.Next=J,J.Prev=vt,mt.Prev=ot,ot.Next=mt,A.Pts=mt):S.Side===t.EdgeSide.esRight?(this.ReversePolyPtLinks(mt),ot.Next=vt,vt.Prev=ot,mt.Next=J,J.Prev=mt):(ot.Next=mt,mt.Prev=ot,J.Prev=vt,vt.Next=J),A.BottomPt=null,V===z&&(z.FirstLeft!==A&&(A.FirstLeft=z.FirstLeft),A.IsHole=z.IsHole),z.Pts=null,z.BottomPt=null,z.FirstLeft=A;var Nt=f.OutIdx,Bt=S.OutIdx;f.OutIdx=-1,S.OutIdx=-1;for(var Rt=this.m_ActiveEdges;Rt!==null;){if(Rt.OutIdx===Bt){Rt.OutIdx=Nt,Rt.Side=f.Side;break}Rt=Rt.NextInAEL}z.Idx=A.Idx},t.Clipper.prototype.ReversePolyPtLinks=function(f){if(f!==null){var S,A;S=f;do A=S.Next,S.Next=S.Prev,S.Prev=A,S=A;while(S!==f)}},t.Clipper.SwapSides=function(f,S){var A=f.Side;f.Side=S.Side,S.Side=A},t.Clipper.SwapPolyIndexes=function(f,S){var A=f.OutIdx;f.OutIdx=S.OutIdx,S.OutIdx=A},t.Clipper.prototype.IntersectEdges=function(f,S,A){var z=f.OutIdx>=0,V=S.OutIdx>=0;if(t.use_xyz&&this.SetZ(A,f,S),t.use_lines&&(f.WindDelta===0||S.WindDelta===0)){if(f.WindDelta===0&&S.WindDelta===0)return;f.PolyTyp===S.PolyTyp&&f.WindDelta!==S.WindDelta&&this.m_ClipType===t.ClipType.ctUnion?f.WindDelta===0?V&&(this.AddOutPt(f,A),z&&(f.OutIdx=-1)):z&&(this.AddOutPt(S,A),V&&(S.OutIdx=-1)):f.PolyTyp!==S.PolyTyp&&(f.WindDelta===0&&Math.abs(S.WindCnt)===1&&(this.m_ClipType!==t.ClipType.ctUnion||S.WindCnt2===0)?(this.AddOutPt(f,A),z&&(f.OutIdx=-1)):S.WindDelta===0&&Math.abs(f.WindCnt)===1&&(this.m_ClipType!==t.ClipType.ctUnion||f.WindCnt2===0)&&(this.AddOutPt(S,A),V&&(S.OutIdx=-1)));return}if(f.PolyTyp===S.PolyTyp)if(this.IsEvenOddFillType(f)){var J=f.WindCnt;f.WindCnt=S.WindCnt,S.WindCnt=J}else f.WindCnt+S.WindDelta===0?f.WindCnt=-f.WindCnt:f.WindCnt+=S.WindDelta,S.WindCnt-f.WindDelta===0?S.WindCnt=-S.WindCnt:S.WindCnt-=f.WindDelta;else this.IsEvenOddFillType(S)?f.WindCnt2=f.WindCnt2===0?1:0:f.WindCnt2+=S.WindDelta,this.IsEvenOddFillType(f)?S.WindCnt2=S.WindCnt2===0?1:0:S.WindCnt2-=f.WindDelta;var ot,mt,vt,Nt;f.PolyTyp===t.PolyType.ptSubject?(ot=this.m_SubjFillType,vt=this.m_ClipFillType):(ot=this.m_ClipFillType,vt=this.m_SubjFillType),S.PolyTyp===t.PolyType.ptSubject?(mt=this.m_SubjFillType,Nt=this.m_ClipFillType):(mt=this.m_ClipFillType,Nt=this.m_SubjFillType);var Bt,Rt;switch(ot){case t.PolyFillType.pftPositive:Bt=f.WindCnt;break;case t.PolyFillType.pftNegative:Bt=-f.WindCnt;break;default:Bt=Math.abs(f.WindCnt);break}switch(mt){case t.PolyFillType.pftPositive:Rt=S.WindCnt;break;case t.PolyFillType.pftNegative:Rt=-S.WindCnt;break;default:Rt=Math.abs(S.WindCnt);break}if(z&&V)Bt!==0&&Bt!==1||Rt!==0&&Rt!==1||f.PolyTyp!==S.PolyTyp&&this.m_ClipType!==t.ClipType.ctXor?this.AddLocalMaxPoly(f,S,A):(this.AddOutPt(f,A),this.AddOutPt(S,A),t.Clipper.SwapSides(f,S),t.Clipper.SwapPolyIndexes(f,S));else if(z)(Rt===0||Rt===1)&&(this.AddOutPt(f,A),t.Clipper.SwapSides(f,S),t.Clipper.SwapPolyIndexes(f,S));else if(V)(Bt===0||Bt===1)&&(this.AddOutPt(S,A),t.Clipper.SwapSides(f,S),t.Clipper.SwapPolyIndexes(f,S));else if((Bt===0||Bt===1)&&(Rt===0||Rt===1)){var Vt,Kt;switch(vt){case t.PolyFillType.pftPositive:Vt=f.WindCnt2;break;case t.PolyFillType.pftNegative:Vt=-f.WindCnt2;break;default:Vt=Math.abs(f.WindCnt2);break}switch(Nt){case t.PolyFillType.pftPositive:Kt=S.WindCnt2;break;case t.PolyFillType.pftNegative:Kt=-S.WindCnt2;break;default:Kt=Math.abs(S.WindCnt2);break}if(f.PolyTyp!==S.PolyTyp)this.AddLocalMinPoly(f,S,A);else if(Bt===1&&Rt===1)switch(this.m_ClipType){case t.ClipType.ctIntersection:Vt>0&&Kt>0&&this.AddLocalMinPoly(f,S,A);break;case t.ClipType.ctUnion:Vt<=0&&Kt<=0&&this.AddLocalMinPoly(f,S,A);break;case t.ClipType.ctDifference:(f.PolyTyp===t.PolyType.ptClip&&Vt>0&&Kt>0||f.PolyTyp===t.PolyType.ptSubject&&Vt<=0&&Kt<=0)&&this.AddLocalMinPoly(f,S,A);break;case t.ClipType.ctXor:this.AddLocalMinPoly(f,S,A);break}else t.Clipper.SwapSides(f,S)}},t.Clipper.prototype.DeleteFromSEL=function(f){var S=f.PrevInSEL,A=f.NextInSEL;S===null&&A===null&&f!==this.m_SortedEdges||(S!==null?S.NextInSEL=A:this.m_SortedEdges=A,A!==null&&(A.PrevInSEL=S),f.NextInSEL=null,f.PrevInSEL=null)},t.Clipper.prototype.ProcessHorizontals=function(){for(var f={};this.PopEdgeFromSEL(f);)this.ProcessHorizontal(f.v)},t.Clipper.prototype.GetHorzDirection=function(f,S){f.Bot.X<f.Top.X?(S.Left=f.Bot.X,S.Right=f.Top.X,S.Dir=t.Direction.dLeftToRight):(S.Left=f.Top.X,S.Right=f.Bot.X,S.Dir=t.Direction.dRightToLeft)},t.Clipper.prototype.ProcessHorizontal=function(f){var S={Dir:null,Left:null,Right:null};this.GetHorzDirection(f,S);for(var A=S.Dir,z=S.Left,V=S.Right,J=f.WindDelta===0,ot=f,mt=null;ot.NextInLML!==null&&t.ClipperBase.IsHorizontal(ot.NextInLML);)ot=ot.NextInLML;ot.NextInLML===null&&(mt=this.GetMaximaPair(ot));var vt=this.m_Maxima;if(vt!==null)if(A===t.Direction.dLeftToRight){for(;vt!==null&&vt.X<=f.Bot.X;)vt=vt.Next;vt!==null&&vt.X>=ot.Top.X&&(vt=null)}else{for(;vt.Next!==null&&vt.Next.X<f.Bot.X;)vt=vt.Next;vt.X<=ot.Top.X&&(vt=null)}for(var Nt=null;;){for(var Bt=f===ot,Rt=this.GetNextInAEL(f,A);Rt!==null;){if(vt!==null)if(A===t.Direction.dLeftToRight)for(;vt!==null&&vt.X<Rt.Curr.X;)f.OutIdx>=0&&!J&&this.AddOutPt(f,new t.IntPoint2(vt.X,f.Bot.Y)),vt=vt.Next;else for(;vt!==null&&vt.X>Rt.Curr.X;)f.OutIdx>=0&&!J&&this.AddOutPt(f,new t.IntPoint2(vt.X,f.Bot.Y)),vt=vt.Prev;if(A===t.Direction.dLeftToRight&&Rt.Curr.X>V||A===t.Direction.dRightToLeft&&Rt.Curr.X<z||Rt.Curr.X===f.Top.X&&f.NextInLML!==null&&Rt.Dx<f.NextInLML.Dx)break;if(f.OutIdx>=0&&!J){t.use_xyz&&(A===t.Direction.dLeftToRight?this.SetZ(Rt.Curr,f,Rt):this.SetZ(Rt.Curr,Rt,f)),Nt=this.AddOutPt(f,Rt.Curr);for(var Vt=this.m_SortedEdges;Vt!==null;){if(Vt.OutIdx>=0&&this.HorzSegmentsOverlap(f.Bot.X,f.Top.X,Vt.Bot.X,Vt.Top.X)){var Kt=this.GetLastOutPt(Vt);this.AddJoin(Kt,Nt,Vt.Top)}Vt=Vt.NextInSEL}this.AddGhostJoin(Nt,f.Bot)}if(Rt===mt&&Bt){f.OutIdx>=0&&this.AddLocalMaxPoly(f,mt,f.Top),this.DeleteFromAEL(f),this.DeleteFromAEL(mt);return}if(A===t.Direction.dLeftToRight){var ae=new t.IntPoint2(Rt.Curr.X,f.Curr.Y);this.IntersectEdges(f,Rt,ae)}else{var ae=new t.IntPoint2(Rt.Curr.X,f.Curr.Y);this.IntersectEdges(Rt,f,ae)}var le=this.GetNextInAEL(Rt,A);this.SwapPositionsInAEL(f,Rt),Rt=le}if(f.NextInLML===null||!t.ClipperBase.IsHorizontal(f.NextInLML))break;f=this.UpdateEdgeIntoAEL(f),f.OutIdx>=0&&this.AddOutPt(f,f.Bot),S={Dir:A,Left:z,Right:V},this.GetHorzDirection(f,S),A=S.Dir,z=S.Left,V=S.Right}if(f.OutIdx>=0&&Nt===null){Nt=this.GetLastOutPt(f);for(var Vt=this.m_SortedEdges;Vt!==null;){if(Vt.OutIdx>=0&&this.HorzSegmentsOverlap(f.Bot.X,f.Top.X,Vt.Bot.X,Vt.Top.X)){var Kt=this.GetLastOutPt(Vt);this.AddJoin(Kt,Nt,Vt.Top)}Vt=Vt.NextInSEL}this.AddGhostJoin(Nt,f.Top)}if(f.NextInLML!==null)if(f.OutIdx>=0){if(Nt=this.AddOutPt(f,f.Top),f=this.UpdateEdgeIntoAEL(f),f.WindDelta===0)return;var ge=f.PrevInAEL,le=f.NextInAEL;if(ge!==null&&ge.Curr.X===f.Bot.X&&ge.Curr.Y===f.Bot.Y&&ge.WindDelta===0&&ge.OutIdx>=0&&ge.Curr.Y>ge.Top.Y&&t.ClipperBase.SlopesEqual3(f,ge,this.m_UseFullRange)){var Kt=this.AddOutPt(ge,f.Bot);this.AddJoin(Nt,Kt,f.Top)}else if(le!==null&&le.Curr.X===f.Bot.X&&le.Curr.Y===f.Bot.Y&&le.WindDelta!==0&&le.OutIdx>=0&&le.Curr.Y>le.Top.Y&&t.ClipperBase.SlopesEqual3(f,le,this.m_UseFullRange)){var Kt=this.AddOutPt(le,f.Bot);this.AddJoin(Nt,Kt,f.Top)}}else f=this.UpdateEdgeIntoAEL(f);else f.OutIdx>=0&&this.AddOutPt(f,f.Top),this.DeleteFromAEL(f)},t.Clipper.prototype.GetNextInAEL=function(f,S){return S===t.Direction.dLeftToRight?f.NextInAEL:f.PrevInAEL},t.Clipper.prototype.IsMinima=function(f){return f!==null&&f.Prev.NextInLML!==f&&f.Next.NextInLML!==f},t.Clipper.prototype.IsMaxima=function(f,S){return f!==null&&f.Top.Y===S&&f.NextInLML===null},t.Clipper.prototype.IsIntermediate=function(f,S){return f.Top.Y===S&&f.NextInLML!==null},t.Clipper.prototype.GetMaximaPair=function(f){return t.IntPoint.op_Equality(f.Next.Top,f.Top)&&f.Next.NextInLML===null?f.Next:t.IntPoint.op_Equality(f.Prev.Top,f.Top)&&f.Prev.NextInLML===null?f.Prev:null},t.Clipper.prototype.GetMaximaPairEx=function(f){var S=this.GetMaximaPair(f);return S===null||S.OutIdx===t.ClipperBase.Skip||S.NextInAEL===S.PrevInAEL&&!t.ClipperBase.IsHorizontal(S)?null:S},t.Clipper.prototype.ProcessIntersections=function(f){if(this.m_ActiveEdges===null)return!0;try{if(this.BuildIntersectList(f),this.m_IntersectList.length===0)return!0;if(this.m_IntersectList.length===1||this.FixupIntersectionOrder())this.ProcessIntersectList();else return!1}catch{this.m_SortedEdges=null,this.m_IntersectList.length=0,t.Error("ProcessIntersections error")}return this.m_SortedEdges=null,!0},t.Clipper.prototype.BuildIntersectList=function(f){if(this.m_ActiveEdges!==null){var S=this.m_ActiveEdges;for(this.m_SortedEdges=S;S!==null;)S.PrevInSEL=S.PrevInAEL,S.NextInSEL=S.NextInAEL,S.Curr.X=t.Clipper.TopX(S,f),S=S.NextInAEL;for(var A=!0;A&&this.m_SortedEdges!==null;){for(A=!1,S=this.m_SortedEdges;S.NextInSEL!==null;){var z=S.NextInSEL,V=new t.IntPoint0;if(S.Curr.X>z.Curr.X){this.IntersectPoint(S,z,V),V.Y<f&&(V=new t.IntPoint2(t.Clipper.TopX(S,f),f));var J=new t.IntersectNode;J.Edge1=S,J.Edge2=z,J.Pt.X=V.X,J.Pt.Y=V.Y,t.use_xyz&&(J.Pt.Z=V.Z),this.m_IntersectList.push(J),this.SwapPositionsInSEL(S,z),A=!0}else S=z}if(S.PrevInSEL!==null)S.PrevInSEL.NextInSEL=null;else break}this.m_SortedEdges=null}},t.Clipper.prototype.EdgesAdjacent=function(f){return f.Edge1.NextInSEL===f.Edge2||f.Edge1.PrevInSEL===f.Edge2},t.Clipper.IntersectNodeSort=function(f,S){return S.Pt.Y-f.Pt.Y},t.Clipper.prototype.FixupIntersectionOrder=function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer),this.CopyAELToSEL();for(var f=this.m_IntersectList.length,S=0;S<f;S++){if(!this.EdgesAdjacent(this.m_IntersectList[S])){for(var A=S+1;A<f&&!this.EdgesAdjacent(this.m_IntersectList[A]);)A++;if(A===f)return!1;var z=this.m_IntersectList[S];this.m_IntersectList[S]=this.m_IntersectList[A],this.m_IntersectList[A]=z}this.SwapPositionsInSEL(this.m_IntersectList[S].Edge1,this.m_IntersectList[S].Edge2)}return!0},t.Clipper.prototype.ProcessIntersectList=function(){for(var f=0,S=this.m_IntersectList.length;f<S;f++){var A=this.m_IntersectList[f];this.IntersectEdges(A.Edge1,A.Edge2,A.Pt),this.SwapPositionsInAEL(A.Edge1,A.Edge2)}this.m_IntersectList.length=0};var n0=function(f){return f<0?Math.ceil(f-.5):Math.round(f)},r0=function(f){return f<0?Math.ceil(f-.5):Math.floor(f+.5)},i0=function(f){return f<0?-Math.round(Math.abs(f)):Math.round(f)},o0=function(f){return f<0?(f-=.5,f<-2147483648?Math.ceil(f):f|0):(f+=.5,f>2147483647?Math.floor(f):f|0)};o.msie?t.Clipper.Round=n0:o.chromium?t.Clipper.Round=i0:o.safari?t.Clipper.Round=o0:t.Clipper.Round=r0,t.Clipper.TopX=function(f,S){return S===f.Top.Y?f.Top.X:f.Bot.X+t.Clipper.Round(f.Dx*(S-f.Bot.Y))},t.Clipper.prototype.IntersectPoint=function(f,S,A){A.X=0,A.Y=0;var z,V;if(f.Dx===S.Dx){A.Y=f.Curr.Y,A.X=t.Clipper.TopX(f,A.Y);return}if(f.Delta.X===0)A.X=f.Bot.X,t.ClipperBase.IsHorizontal(S)?A.Y=S.Bot.Y:(V=S.Bot.Y-S.Bot.X/S.Dx,A.Y=t.Clipper.Round(A.X/S.Dx+V));else if(S.Delta.X===0)A.X=S.Bot.X,t.ClipperBase.IsHorizontal(f)?A.Y=f.Bot.Y:(z=f.Bot.Y-f.Bot.X/f.Dx,A.Y=t.Clipper.Round(A.X/f.Dx+z));else{z=f.Bot.X-f.Bot.Y*f.Dx,V=S.Bot.X-S.Bot.Y*S.Dx;var J=(V-z)/(f.Dx-S.Dx);A.Y=t.Clipper.Round(J),Math.abs(f.Dx)<Math.abs(S.Dx)?A.X=t.Clipper.Round(f.Dx*J+z):A.X=t.Clipper.Round(S.Dx*J+V)}if(A.Y<f.Top.Y||A.Y<S.Top.Y){if(f.Top.Y>S.Top.Y)return A.Y=f.Top.Y,A.X=t.Clipper.TopX(S,f.Top.Y),A.X<f.Top.X;A.Y=S.Top.Y,Math.abs(f.Dx)<Math.abs(S.Dx)?A.X=t.Clipper.TopX(f,A.Y):A.X=t.Clipper.TopX(S,A.Y)}A.Y>f.Curr.Y&&(A.Y=f.Curr.Y,Math.abs(f.Dx)>Math.abs(S.Dx)?A.X=t.Clipper.TopX(S,A.Y):A.X=t.Clipper.TopX(f,A.Y))},t.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(f){for(var S=this.m_ActiveEdges;S!==null;){var A=this.IsMaxima(S,f);if(A){var z=this.GetMaximaPairEx(S);A=z===null||!t.ClipperBase.IsHorizontal(z)}if(A){this.StrictlySimple&&this.InsertMaxima(S.Top.X);var V=S.PrevInAEL;this.DoMaxima(S),V===null?S=this.m_ActiveEdges:S=V.NextInAEL}else{if(this.IsIntermediate(S,f)&&t.ClipperBase.IsHorizontal(S.NextInLML)?(S=this.UpdateEdgeIntoAEL(S),S.OutIdx>=0&&this.AddOutPt(S,S.Bot),this.AddEdgeToSEL(S)):(S.Curr.X=t.Clipper.TopX(S,f),S.Curr.Y=f),t.use_xyz&&(S.Top.Y===f?S.Curr.Z=S.Top.Z:S.Bot.Y===f?S.Curr.Z=S.Bot.Z:S.Curr.Z=0),this.StrictlySimple){var V=S.PrevInAEL;if(S.OutIdx>=0&&S.WindDelta!==0&&V!==null&&V.OutIdx>=0&&V.Curr.X===S.Curr.X&&V.WindDelta!==0){var J=new t.IntPoint1(S.Curr);t.use_xyz&&this.SetZ(J,V,S);var ot=this.AddOutPt(V,J),mt=this.AddOutPt(S,J);this.AddJoin(ot,mt,J)}}S=S.NextInAEL}}for(this.ProcessHorizontals(),this.m_Maxima=null,S=this.m_ActiveEdges;S!==null;){if(this.IsIntermediate(S,f)){var ot=null;S.OutIdx>=0&&(ot=this.AddOutPt(S,S.Top)),S=this.UpdateEdgeIntoAEL(S);var V=S.PrevInAEL,vt=S.NextInAEL;if(V!==null&&V.Curr.X===S.Bot.X&&V.Curr.Y===S.Bot.Y&&ot!==null&&V.OutIdx>=0&&V.Curr.Y===V.Top.Y&&t.ClipperBase.SlopesEqual5(S.Curr,S.Top,V.Curr,V.Top,this.m_UseFullRange)&&S.WindDelta!==0&&V.WindDelta!==0){var mt=this.AddOutPt(ePrev2,S.Bot);this.AddJoin(ot,mt,S.Top)}else if(vt!==null&&vt.Curr.X===S.Bot.X&&vt.Curr.Y===S.Bot.Y&&ot!==null&&vt.OutIdx>=0&&vt.Curr.Y===vt.Top.Y&&t.ClipperBase.SlopesEqual5(S.Curr,S.Top,vt.Curr,vt.Top,this.m_UseFullRange)&&S.WindDelta!==0&&vt.WindDelta!==0){var mt=this.AddOutPt(vt,S.Bot);this.AddJoin(ot,mt,S.Top)}}S=S.NextInAEL}},t.Clipper.prototype.DoMaxima=function(f){var S=this.GetMaximaPairEx(f);if(S===null){f.OutIdx>=0&&this.AddOutPt(f,f.Top),this.DeleteFromAEL(f);return}for(var A=f.NextInAEL;A!==null&&A!==S;)this.IntersectEdges(f,A,f.Top),this.SwapPositionsInAEL(f,A),A=f.NextInAEL;f.OutIdx===-1&&S.OutIdx===-1?(this.DeleteFromAEL(f),this.DeleteFromAEL(S)):f.OutIdx>=0&&S.OutIdx>=0?(f.OutIdx>=0&&this.AddLocalMaxPoly(f,S,f.Top),this.DeleteFromAEL(f),this.DeleteFromAEL(S)):t.use_lines&&f.WindDelta===0?(f.OutIdx>=0&&(this.AddOutPt(f,f.Top),f.OutIdx=t.ClipperBase.Unassigned),this.DeleteFromAEL(f),S.OutIdx>=0&&(this.AddOutPt(S,f.Top),S.OutIdx=t.ClipperBase.Unassigned),this.DeleteFromAEL(S)):t.Error("DoMaxima error")},t.Clipper.ReversePaths=function(f){for(var S=0,A=f.length;S<A;S++)f[S].reverse()},t.Clipper.Orientation=function(f){return t.Clipper.Area(f)>=0},t.Clipper.prototype.PointCount=function(f){if(f===null)return 0;var S=0,A=f;do S++,A=A.Next;while(A!==f);return S},t.Clipper.prototype.BuildResult=function(f){t.Clear(f);for(var S=0,A=this.m_PolyOuts.length;S<A;S++){var z=this.m_PolyOuts[S];if(z.Pts!==null){var V=z.Pts.Prev,J=this.PointCount(V);if(!(J<2)){for(var ot=new Array(J),mt=0;mt<J;mt++)ot[mt]=V.Pt,V=V.Prev;f.push(ot)}}}},t.Clipper.prototype.BuildResult2=function(f){f.Clear();for(var S=0,A=this.m_PolyOuts.length;S<A;S++){var z=this.m_PolyOuts[S],V=this.PointCount(z.Pts);if(!(z.IsOpen&&V<2||!z.IsOpen&&V<3)){this.FixHoleLinkage(z);var J=new t.PolyNode;f.m_AllPolys.push(J),z.PolyNode=J,J.m_polygon.length=V;for(var ot=z.Pts.Prev,mt=0;mt<V;mt++)J.m_polygon[mt]=ot.Pt,ot=ot.Prev}}for(var S=0,A=this.m_PolyOuts.length;S<A;S++){var z=this.m_PolyOuts[S];z.PolyNode!==null&&(z.IsOpen?(z.PolyNode.IsOpen=!0,f.AddChild(z.PolyNode)):z.FirstLeft!==null&&z.FirstLeft.PolyNode!==null?z.FirstLeft.PolyNode.AddChild(z.PolyNode):f.AddChild(z.PolyNode))}},t.Clipper.prototype.FixupOutPolyline=function(f){for(var S=f.Pts,A=S.Prev;S!==A;)if(S=S.Next,t.IntPoint.op_Equality(S.Pt,S.Prev.Pt)){S===A&&(A=S.Prev);var z=S.Prev;z.Next=S.Next,S.Next.Prev=z,S=z}S===S.Prev&&(f.Pts=null)},t.Clipper.prototype.FixupOutPolygon=function(f){var S=null;f.BottomPt=null;for(var A=f.Pts,z=this.PreserveCollinear||this.StrictlySimple;;){if(A.Prev===A||A.Prev===A.Next){f.Pts=null;return}if(t.IntPoint.op_Equality(A.Pt,A.Next.Pt)||t.IntPoint.op_Equality(A.Pt,A.Prev.Pt)||t.ClipperBase.SlopesEqual4(A.Prev.Pt,A.Pt,A.Next.Pt,this.m_UseFullRange)&&(!z||!this.Pt2IsBetweenPt1AndPt3(A.Prev.Pt,A.Pt,A.Next.Pt)))S=null,A.Prev.Next=A.Next,A.Next.Prev=A.Prev,A=A.Prev;else{if(A===S)break;S===null&&(S=A),A=A.Next}}f.Pts=A},t.Clipper.prototype.DupOutPt=function(f,S){var A=new t.OutPt;return A.Pt.X=f.Pt.X,A.Pt.Y=f.Pt.Y,t.use_xyz&&(A.Pt.Z=f.Pt.Z),A.Idx=f.Idx,S?(A.Next=f.Next,A.Prev=f,f.Next.Prev=A,f.Next=A):(A.Prev=f.Prev,A.Next=f,f.Prev.Next=A,f.Prev=A),A},t.Clipper.prototype.GetOverlap=function(f,S,A,z,V){return f<S?A<z?(V.Left=Math.max(f,A),V.Right=Math.min(S,z)):(V.Left=Math.max(f,z),V.Right=Math.min(S,A)):A<z?(V.Left=Math.max(S,A),V.Right=Math.min(f,z)):(V.Left=Math.max(S,z),V.Right=Math.min(f,A)),V.Left<V.Right},t.Clipper.prototype.JoinHorz=function(f,S,A,z,V,J){var ot=f.Pt.X>S.Pt.X?t.Direction.dRightToLeft:t.Direction.dLeftToRight,mt=A.Pt.X>z.Pt.X?t.Direction.dRightToLeft:t.Direction.dLeftToRight;if(ot===mt)return!1;if(ot===t.Direction.dLeftToRight){for(;f.Next.Pt.X<=V.X&&f.Next.Pt.X>=f.Pt.X&&f.Next.Pt.Y===V.Y;)f=f.Next;J&&f.Pt.X!==V.X&&(f=f.Next),S=this.DupOutPt(f,!J),t.IntPoint.op_Inequality(S.Pt,V)&&(f=S,f.Pt.X=V.X,f.Pt.Y=V.Y,t.use_xyz&&(f.Pt.Z=V.Z),S=this.DupOutPt(f,!J))}else{for(;f.Next.Pt.X>=V.X&&f.Next.Pt.X<=f.Pt.X&&f.Next.Pt.Y===V.Y;)f=f.Next;!J&&f.Pt.X!==V.X&&(f=f.Next),S=this.DupOutPt(f,J),t.IntPoint.op_Inequality(S.Pt,V)&&(f=S,f.Pt.X=V.X,f.Pt.Y=V.Y,t.use_xyz&&(f.Pt.Z=V.Z),S=this.DupOutPt(f,J))}if(mt===t.Direction.dLeftToRight){for(;A.Next.Pt.X<=V.X&&A.Next.Pt.X>=A.Pt.X&&A.Next.Pt.Y===V.Y;)A=A.Next;J&&A.Pt.X!==V.X&&(A=A.Next),z=this.DupOutPt(A,!J),t.IntPoint.op_Inequality(z.Pt,V)&&(A=z,A.Pt.X=V.X,A.Pt.Y=V.Y,t.use_xyz&&(A.Pt.Z=V.Z),z=this.DupOutPt(A,!J))}else{for(;A.Next.Pt.X>=V.X&&A.Next.Pt.X<=A.Pt.X&&A.Next.Pt.Y===V.Y;)A=A.Next;!J&&A.Pt.X!==V.X&&(A=A.Next),z=this.DupOutPt(A,J),t.IntPoint.op_Inequality(z.Pt,V)&&(A=z,A.Pt.X=V.X,A.Pt.Y=V.Y,t.use_xyz&&(A.Pt.Z=V.Z),z=this.DupOutPt(A,J))}return ot===t.Direction.dLeftToRight===J?(f.Prev=A,A.Next=f,S.Next=z,z.Prev=S):(f.Next=A,A.Prev=f,S.Prev=z,z.Next=S),!0},t.Clipper.prototype.JoinPoints=function(f,S,A){var z=f.OutPt1,V=new t.OutPt,J=f.OutPt2,ot=new t.OutPt,mt=f.OutPt1.Pt.Y===f.OffPt.Y;if(mt&&t.IntPoint.op_Equality(f.OffPt,f.OutPt1.Pt)&&t.IntPoint.op_Equality(f.OffPt,f.OutPt2.Pt)){if(S!==A)return!1;for(V=f.OutPt1.Next;V!==z&&t.IntPoint.op_Equality(V.Pt,f.OffPt);)V=V.Next;var vt=V.Pt.Y>f.OffPt.Y;for(ot=f.OutPt2.Next;ot!==J&&t.IntPoint.op_Equality(ot.Pt,f.OffPt);)ot=ot.Next;var Nt=ot.Pt.Y>f.OffPt.Y;return vt===Nt?!1:vt?(V=this.DupOutPt(z,!1),ot=this.DupOutPt(J,!0),z.Prev=J,J.Next=z,V.Next=ot,ot.Prev=V,f.OutPt1=z,f.OutPt2=V,!0):(V=this.DupOutPt(z,!0),ot=this.DupOutPt(J,!1),z.Next=J,J.Prev=z,V.Prev=ot,ot.Next=V,f.OutPt1=z,f.OutPt2=V,!0)}else if(mt){for(V=z;z.Prev.Pt.Y===z.Pt.Y&&z.Prev!==V&&z.Prev!==J;)z=z.Prev;for(;V.Next.Pt.Y===V.Pt.Y&&V.Next!==z&&V.Next!==J;)V=V.Next;if(V.Next===z||V.Next===J)return!1;for(ot=J;J.Prev.Pt.Y===J.Pt.Y&&J.Prev!==ot&&J.Prev!==V;)J=J.Prev;for(;ot.Next.Pt.Y===ot.Pt.Y&&ot.Next!==J&&ot.Next!==z;)ot=ot.Next;if(ot.Next===J||ot.Next===z)return!1;var Bt={Left:null,Right:null};if(!this.GetOverlap(z.Pt.X,V.Pt.X,J.Pt.X,ot.Pt.X,Bt))return!1;var Rt=Bt.Left,Vt=Bt.Right,Kt=new t.IntPoint0,ae;return z.Pt.X>=Rt&&z.Pt.X<=Vt?(Kt.X=z.Pt.X,Kt.Y=z.Pt.Y,t.use_xyz&&(Kt.Z=z.Pt.Z),ae=z.Pt.X>V.Pt.X):J.Pt.X>=Rt&&J.Pt.X<=Vt?(Kt.X=J.Pt.X,Kt.Y=J.Pt.Y,t.use_xyz&&(Kt.Z=J.Pt.Z),ae=J.Pt.X>ot.Pt.X):V.Pt.X>=Rt&&V.Pt.X<=Vt?(Kt.X=V.Pt.X,Kt.Y=V.Pt.Y,t.use_xyz&&(Kt.Z=V.Pt.Z),ae=V.Pt.X>z.Pt.X):(Kt.X=ot.Pt.X,Kt.Y=ot.Pt.Y,t.use_xyz&&(Kt.Z=ot.Pt.Z),ae=ot.Pt.X>J.Pt.X),f.OutPt1=z,f.OutPt2=J,this.JoinHorz(z,V,J,ot,Kt,ae)}else{for(V=z.Next;t.IntPoint.op_Equality(V.Pt,z.Pt)&&V!==z;)V=V.Next;var le=V.Pt.Y>z.Pt.Y||!t.ClipperBase.SlopesEqual4(z.Pt,V.Pt,f.OffPt,this.m_UseFullRange);if(le){for(V=z.Prev;t.IntPoint.op_Equality(V.Pt,z.Pt)&&V!==z;)V=V.Prev;if(V.Pt.Y>z.Pt.Y||!t.ClipperBase.SlopesEqual4(z.Pt,V.Pt,f.OffPt,this.m_UseFullRange))return!1}for(ot=J.Next;t.IntPoint.op_Equality(ot.Pt,J.Pt)&&ot!==J;)ot=ot.Next;var ge=ot.Pt.Y>J.Pt.Y||!t.ClipperBase.SlopesEqual4(J.Pt,ot.Pt,f.OffPt,this.m_UseFullRange);if(ge){for(ot=J.Prev;t.IntPoint.op_Equality(ot.Pt,J.Pt)&&ot!==J;)ot=ot.Prev;if(ot.Pt.Y>J.Pt.Y||!t.ClipperBase.SlopesEqual4(J.Pt,ot.Pt,f.OffPt,this.m_UseFullRange))return!1}return V===z||ot===J||V===ot||S===A&&le===ge?!1:le?(V=this.DupOutPt(z,!1),ot=this.DupOutPt(J,!0),z.Prev=J,J.Next=z,V.Next=ot,ot.Prev=V,f.OutPt1=z,f.OutPt2=V,!0):(V=this.DupOutPt(z,!0),ot=this.DupOutPt(J,!1),z.Next=J,J.Prev=z,V.Prev=ot,ot.Next=V,f.OutPt1=z,f.OutPt2=V,!0)}},t.Clipper.GetBounds=function(f){for(var S=0,A=f.length;S<A&&f[S].length===0;)S++;if(S===A)return new t.IntRect(0,0,0,0);var z=new t.IntRect;for(z.left=f[S][0].X,z.right=z.left,z.top=f[S][0].Y,z.bottom=z.top;S<A;S++)for(var V=0,J=f[S].length;V<J;V++)f[S][V].X<z.left?z.left=f[S][V].X:f[S][V].X>z.right&&(z.right=f[S][V].X),f[S][V].Y<z.top?z.top=f[S][V].Y:f[S][V].Y>z.bottom&&(z.bottom=f[S][V].Y);return z},t.Clipper.prototype.GetBounds2=function(f){var S=f,A=new t.IntRect;for(A.left=f.Pt.X,A.right=f.Pt.X,A.top=f.Pt.Y,A.bottom=f.Pt.Y,f=f.Next;f!==S;)f.Pt.X<A.left&&(A.left=f.Pt.X),f.Pt.X>A.right&&(A.right=f.Pt.X),f.Pt.Y<A.top&&(A.top=f.Pt.Y),f.Pt.Y>A.bottom&&(A.bottom=f.Pt.Y),f=f.Next;return A},t.Clipper.PointInPolygon=function(f,S){var A=0,z=S.length;if(z<3)return 0;for(var V=S[0],J=1;J<=z;++J){var ot=J===z?S[0]:S[J];if(ot.Y===f.Y&&(ot.X===f.X||V.Y===f.Y&&ot.X>f.X==V.X<f.X))return-1;if(V.Y<f.Y!=ot.Y<f.Y){if(V.X>=f.X)if(ot.X>f.X)A=1-A;else{var mt=(V.X-f.X)*(ot.Y-f.Y)-(ot.X-f.X)*(V.Y-f.Y);if(mt===0)return-1;mt>0==ot.Y>V.Y&&(A=1-A)}else if(ot.X>f.X){var mt=(V.X-f.X)*(ot.Y-f.Y)-(ot.X-f.X)*(V.Y-f.Y);if(mt===0)return-1;mt>0==ot.Y>V.Y&&(A=1-A)}}V=ot}return A},t.Clipper.prototype.PointInPolygon=function(f,S){var A=0,z=S,V=f.X,J=f.Y,ot=S.Pt.X,mt=S.Pt.Y;do{S=S.Next;var vt=S.Pt.X,Nt=S.Pt.Y;if(Nt===J&&(vt===V||mt===J&&vt>V==ot<V))return-1;if(mt<J!=Nt<J){if(ot>=V)if(vt>V)A=1-A;else{var Bt=(ot-V)*(Nt-J)-(vt-V)*(mt-J);if(Bt===0)return-1;Bt>0==Nt>mt&&(A=1-A)}else if(vt>V){var Bt=(ot-V)*(Nt-J)-(vt-V)*(mt-J);if(Bt===0)return-1;Bt>0==Nt>mt&&(A=1-A)}}ot=vt,mt=Nt}while(z!==S);return A},t.Clipper.prototype.Poly2ContainsPoly1=function(f,S){var A=f;do{var z=this.PointInPolygon(A.Pt,S);if(z>=0)return z>0;A=A.Next}while(A!==f);return!0},t.Clipper.prototype.FixupFirstLefts1=function(f,S){for(var A,z,V=0,J=this.m_PolyOuts.length;V<J;V++)A=this.m_PolyOuts[V],z=t.Clipper.ParseFirstLeft(A.FirstLeft),A.Pts!==null&&z===f&&this.Poly2ContainsPoly1(A.Pts,S.Pts)&&(A.FirstLeft=S)},t.Clipper.prototype.FixupFirstLefts2=function(f,S){for(var A=S.FirstLeft,z,V,J=0,ot=this.m_PolyOuts.length;J<ot;J++)z=this.m_PolyOuts[J],!(z.Pts===null||z===S||z===f)&&(V=t.Clipper.ParseFirstLeft(z.FirstLeft),!(V!==A&&V!==f&&V!==S)&&(this.Poly2ContainsPoly1(z.Pts,f.Pts)?z.FirstLeft=f:this.Poly2ContainsPoly1(z.Pts,S.Pts)?z.FirstLeft=S:(z.FirstLeft===f||z.FirstLeft===S)&&(z.FirstLeft=A)))},t.Clipper.prototype.FixupFirstLefts3=function(f,S){for(var A,z,V=0,J=this.m_PolyOuts.length;V<J;V++)A=this.m_PolyOuts[V],z=t.Clipper.ParseFirstLeft(A.FirstLeft),A.Pts!==null&&z===f&&(A.FirstLeft=S)},t.Clipper.ParseFirstLeft=function(f){for(;f!==null&&f.Pts===null;)f=f.FirstLeft;return f},t.Clipper.prototype.JoinCommonEdges=function(){for(var f=0,S=this.m_Joins.length;f<S;f++){var A=this.m_Joins[f],z=this.GetOutRec(A.OutPt1.Idx),V=this.GetOutRec(A.OutPt2.Idx);if(!(z.Pts===null||V.Pts===null)&&!(z.IsOpen||V.IsOpen)){var J;z===V?J=z:this.OutRec1RightOfOutRec2(z,V)?J=V:this.OutRec1RightOfOutRec2(V,z)?J=z:J=this.GetLowermostRec(z,V),this.JoinPoints(A,z,V)&&(z===V?(z.Pts=A.OutPt1,z.BottomPt=null,V=this.CreateOutRec(),V.Pts=A.OutPt2,this.UpdateOutPtIdxs(V),this.Poly2ContainsPoly1(V.Pts,z.Pts)?(V.IsHole=!z.IsHole,V.FirstLeft=z,this.m_UsingPolyTree&&this.FixupFirstLefts2(V,z),(V.IsHole^this.ReverseSolution)==this.Area$1(V)>0&&this.ReversePolyPtLinks(V.Pts)):this.Poly2ContainsPoly1(z.Pts,V.Pts)?(V.IsHole=z.IsHole,z.IsHole=!V.IsHole,V.FirstLeft=z.FirstLeft,z.FirstLeft=V,this.m_UsingPolyTree&&this.FixupFirstLefts2(z,V),(z.IsHole^this.ReverseSolution)==this.Area$1(z)>0&&this.ReversePolyPtLinks(z.Pts)):(V.IsHole=z.IsHole,V.FirstLeft=z.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(z,V))):(V.Pts=null,V.BottomPt=null,V.Idx=z.Idx,z.IsHole=J.IsHole,J===V&&(z.FirstLeft=V.FirstLeft),V.FirstLeft=z,this.m_UsingPolyTree&&this.FixupFirstLefts3(V,z)))}}},t.Clipper.prototype.UpdateOutPtIdxs=function(f){var S=f.Pts;do S.Idx=f.Idx,S=S.Prev;while(S!==f.Pts)},t.Clipper.prototype.DoSimplePolygons=function(){for(var f=0;f<this.m_PolyOuts.length;){var S=this.m_PolyOuts[f++],A=S.Pts;if(!(A===null||S.IsOpen))do{for(var z=A.Next;z!==S.Pts;){if(t.IntPoint.op_Equality(A.Pt,z.Pt)&&z.Next!==A&&z.Prev!==A){var V=A.Prev,J=z.Prev;A.Prev=J,J.Next=A,z.Prev=V,V.Next=z,S.Pts=A;var ot=this.CreateOutRec();ot.Pts=z,this.UpdateOutPtIdxs(ot),this.Poly2ContainsPoly1(ot.Pts,S.Pts)?(ot.IsHole=!S.IsHole,ot.FirstLeft=S,this.m_UsingPolyTree&&this.FixupFirstLefts2(ot,S)):this.Poly2ContainsPoly1(S.Pts,ot.Pts)?(ot.IsHole=S.IsHole,S.IsHole=!ot.IsHole,ot.FirstLeft=S.FirstLeft,S.FirstLeft=ot,this.m_UsingPolyTree&&this.FixupFirstLefts2(S,ot)):(ot.IsHole=S.IsHole,ot.FirstLeft=S.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(S,ot)),z=A}z=z.Next}A=A.Next}while(A!==S.Pts)}},t.Clipper.Area=function(f){if(!Array.isArray(f))return 0;var S=f.length;if(S<3)return 0;for(var A=0,z=0,V=S-1;z<S;++z)A+=(f[V].X+f[z].X)*(f[V].Y-f[z].Y),V=z;return-A*.5},t.Clipper.prototype.Area=function(f){var S=f;if(f===null)return 0;var A=0;do A=A+(f.Prev.Pt.X+f.Pt.X)*(f.Prev.Pt.Y-f.Pt.Y),f=f.Next;while(f!==S);return A*.5},t.Clipper.prototype.Area$1=function(f){return this.Area(f.Pts)},t.Clipper.SimplifyPolygon=function(f,S){var A=new Array,z=new t.Clipper(0);return z.StrictlySimple=!0,z.AddPath(f,t.PolyType.ptSubject,!0),z.Execute(t.ClipType.ctUnion,A,S,S),A},t.Clipper.SimplifyPolygons=function(f,S){typeof S>"u"&&(S=t.PolyFillType.pftEvenOdd);var A=new Array,z=new t.Clipper(0);return z.StrictlySimple=!0,z.AddPaths(f,t.PolyType.ptSubject,!0),z.Execute(t.ClipType.ctUnion,A,S,S),A},t.Clipper.DistanceSqrd=function(f,S){var A=f.X-S.X,z=f.Y-S.Y;return A*A+z*z},t.Clipper.DistanceFromLineSqrd=function(f,S,A){var z=S.Y-A.Y,V=A.X-S.X,J=z*S.X+V*S.Y;return J=z*f.X+V*f.Y-J,J*J/(z*z+V*V)},t.Clipper.SlopesNearCollinear=function(f,S,A,z){return Math.abs(f.X-S.X)>Math.abs(f.Y-S.Y)?f.X>S.X==f.X<A.X?t.Clipper.DistanceFromLineSqrd(f,S,A)<z:S.X>f.X==S.X<A.X?t.Clipper.DistanceFromLineSqrd(S,f,A)<z:t.Clipper.DistanceFromLineSqrd(A,f,S)<z:f.Y>S.Y==f.Y<A.Y?t.Clipper.DistanceFromLineSqrd(f,S,A)<z:S.Y>f.Y==S.Y<A.Y?t.Clipper.DistanceFromLineSqrd(S,f,A)<z:t.Clipper.DistanceFromLineSqrd(A,f,S)<z},t.Clipper.PointsAreClose=function(f,S,A){var z=f.X-S.X,V=f.Y-S.Y;return z*z+V*V<=A},t.Clipper.ExcludeOp=function(f){var S=f.Prev;return S.Next=f.Next,f.Next.Prev=S,S.Idx=0,S},t.Clipper.CleanPolygon=function(f,S){typeof S>"u"&&(S=1.415);var A=f.length;if(A===0)return new Array;for(var z=new Array(A),V=0;V<A;++V)z[V]=new t.OutPt;for(var V=0;V<A;++V)z[V].Pt=f[V],z[V].Next=z[(V+1)%A],z[V].Next.Prev=z[V],z[V].Idx=0;for(var J=S*S,ot=z[0];ot.Idx===0&&ot.Next!==ot.Prev;)t.Clipper.PointsAreClose(ot.Pt,ot.Prev.Pt,J)?(ot=t.Clipper.ExcludeOp(ot),A--):t.Clipper.PointsAreClose(ot.Prev.Pt,ot.Next.Pt,J)?(t.Clipper.ExcludeOp(ot.Next),ot=t.Clipper.ExcludeOp(ot),A-=2):t.Clipper.SlopesNearCollinear(ot.Prev.Pt,ot.Pt,ot.Next.Pt,J)?(ot=t.Clipper.ExcludeOp(ot),A--):(ot.Idx=1,ot=ot.Next);A<3&&(A=0);for(var mt=new Array(A),V=0;V<A;++V)mt[V]=new t.IntPoint1(ot.Pt),ot=ot.Next;return z=null,mt},t.Clipper.CleanPolygons=function(f,S){for(var A=new Array(f.length),z=0,V=f.length;z<V;z++)A[z]=t.Clipper.CleanPolygon(f[z],S);return A},t.Clipper.Minkowski=function(f,S,A,z){var V=z?1:0,J=f.length,ot=S.length,mt=new Array;if(A)for(var vt=0;vt<ot;vt++){for(var Nt=new Array(J),Bt=0,Rt=f.length,Vt=f[Bt];Bt<Rt;Bt++,Vt=f[Bt])Nt[Bt]=new t.IntPoint2(S[vt].X+Vt.X,S[vt].Y+Vt.Y);mt.push(Nt)}else for(var vt=0;vt<ot;vt++){for(var Nt=new Array(J),Bt=0,Rt=f.length,Vt=f[Bt];Bt<Rt;Bt++,Vt=f[Bt])Nt[Bt]=new t.IntPoint2(S[vt].X-Vt.X,S[vt].Y-Vt.Y);mt.push(Nt)}for(var Kt=new Array,vt=0;vt<ot-1+V;vt++)for(var Bt=0;Bt<J;Bt++){var ae=new Array;ae.push(mt[vt%ot][Bt%J]),ae.push(mt[(vt+1)%ot][Bt%J]),ae.push(mt[(vt+1)%ot][(Bt+1)%J]),ae.push(mt[vt%ot][(Bt+1)%J]),t.Clipper.Orientation(ae)||ae.reverse(),Kt.push(ae)}return Kt},t.Clipper.MinkowskiSum=function(f,S,A){if(S[0]instanceof Array){for(var V=S,ot=new t.Paths,J=new t.Clipper,mt=0;mt<V.length;++mt){var vt=t.Clipper.Minkowski(f,V[mt],!0,A);if(J.AddPaths(vt,t.PolyType.ptSubject,!0),A){var z=t.Clipper.TranslatePath(V[mt],f[0]);J.AddPath(z,t.PolyType.ptClip,!0)}}return J.Execute(t.ClipType.ctUnion,ot,t.PolyFillType.pftNonZero,t.PolyFillType.pftNonZero),ot}else{var z=S,V=t.Clipper.Minkowski(f,z,!0,A),J=new t.Clipper;return J.AddPaths(V,t.PolyType.ptSubject,!0),J.Execute(t.ClipType.ctUnion,V,t.PolyFillType.pftNonZero,t.PolyFillType.pftNonZero),V}},t.Clipper.TranslatePath=function(f,S){for(var A=new t.Path,z=0;z<f.length;z++)A.push(new t.IntPoint2(f[z].X+S.X,f[z].Y+S.Y));return A},t.Clipper.MinkowskiDiff=function(f,S){var A=t.Clipper.Minkowski(f,S,!1,!0),z=new t.Clipper;return z.AddPaths(A,t.PolyType.ptSubject,!0),z.Execute(t.ClipType.ctUnion,A,t.PolyFillType.pftNonZero,t.PolyFillType.pftNonZero),A},t.Clipper.PolyTreeToPaths=function(f){var S=new Array;return t.Clipper.AddPolyNodeToPaths(f,t.Clipper.NodeType.ntAny,S),S},t.Clipper.AddPolyNodeToPaths=function(f,S,A){var z=!0;switch(S){case t.Clipper.NodeType.ntOpen:return;case t.Clipper.NodeType.ntClosed:z=!f.IsOpen;break}f.m_polygon.length>0&&z&&A.push(f.m_polygon);for(var V=0,J=f.Childs(),ot=J.length,mt=J[V];V<ot;V++,mt=J[V])t.Clipper.AddPolyNodeToPaths(mt,S,A)},t.Clipper.OpenPathsFromPolyTree=function(f){for(var S=new t.Paths,A=0,z=f.ChildCount();A<z;A++)f.Childs()[A].IsOpen&&S.push(f.Childs()[A].m_polygon);return S},t.Clipper.ClosedPathsFromPolyTree=function(f){var S=new t.Paths;return t.Clipper.AddPolyNodeToPaths(f,t.Clipper.NodeType.ntClosed,S),S},gh(t.Clipper,t.ClipperBase),t.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2},t.ClipperOffset=function(f,S){typeof f>"u"&&(f=2),typeof S>"u"&&(S=t.ClipperOffset.def_arc_tolerance),this.m_destPolys=new t.Paths,this.m_srcPoly=new t.Path,this.m_destPoly=new t.Path,this.m_normals=new Array,this.m_delta=0,this.m_sinA=0,this.m_sin=0,this.m_cos=0,this.m_miterLim=0,this.m_StepsPerRad=0,this.m_lowest=new t.IntPoint0,this.m_polyNodes=new t.PolyNode,this.MiterLimit=f,this.ArcTolerance=S,this.m_lowest.X=-1},t.ClipperOffset.two_pi=6.28318530717959,t.ClipperOffset.def_arc_tolerance=.25,t.ClipperOffset.prototype.Clear=function(){t.Clear(this.m_polyNodes.Childs()),this.m_lowest.X=-1},t.ClipperOffset.Round=t.Clipper.Round,t.ClipperOffset.prototype.AddPath=function(f,S,A){var z=f.length-1;if(!(z<0)){var V=new t.PolyNode;if(V.m_jointype=S,V.m_endtype=A,A===t.EndType.etClosedLine||A===t.EndType.etClosedPolygon)for(;z>0&&t.IntPoint.op_Equality(f[0],f[z]);)z--;V.m_polygon.push(f[0]);for(var J=0,ot=0,mt=1;mt<=z;mt++)t.IntPoint.op_Inequality(V.m_polygon[J],f[mt])&&(J++,V.m_polygon.push(f[mt]),(f[mt].Y>V.m_polygon[ot].Y||f[mt].Y===V.m_polygon[ot].Y&&f[mt].X<V.m_polygon[ot].X)&&(ot=J));if(!(A===t.EndType.etClosedPolygon&&J<2)&&(this.m_polyNodes.AddChild(V),A===t.EndType.etClosedPolygon))if(this.m_lowest.X<0)this.m_lowest=new t.IntPoint2(this.m_polyNodes.ChildCount()-1,ot);else{var vt=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y];(V.m_polygon[ot].Y>vt.Y||V.m_polygon[ot].Y===vt.Y&&V.m_polygon[ot].X<vt.X)&&(this.m_lowest=new t.IntPoint2(this.m_polyNodes.ChildCount()-1,ot))}}},t.ClipperOffset.prototype.AddPaths=function(f,S,A){for(var z=0,V=f.length;z<V;z++)this.AddPath(f[z],S,A)},t.ClipperOffset.prototype.FixOrientations=function(){if(this.m_lowest.X>=0&&!t.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var f=0;f<this.m_polyNodes.ChildCount();f++){var S=this.m_polyNodes.Childs()[f];(S.m_endtype===t.EndType.etClosedPolygon||S.m_endtype===t.EndType.etClosedLine&&t.Clipper.Orientation(S.m_polygon))&&S.m_polygon.reverse()}else for(var f=0;f<this.m_polyNodes.ChildCount();f++){var S=this.m_polyNodes.Childs()[f];S.m_endtype===t.EndType.etClosedLine&&!t.Clipper.Orientation(S.m_polygon)&&S.m_polygon.reverse()}},t.ClipperOffset.GetUnitNormal=function(f,S){var A=S.X-f.X,z=S.Y-f.Y;if(A===0&&z===0)return new t.DoublePoint2(0,0);var V=1/Math.sqrt(A*A+z*z);return A*=V,z*=V,new t.DoublePoint2(z,-A)},t.ClipperOffset.prototype.DoOffset=function(f){if(this.m_destPolys=new Array,this.m_delta=f,t.ClipperBase.near_zero(f)){for(var S=0;S<this.m_polyNodes.ChildCount();S++){var A=this.m_polyNodes.Childs()[S];A.m_endtype===t.EndType.etClosedPolygon&&this.m_destPolys.push(A.m_polygon)}return}this.MiterLimit>2?this.m_miterLim=2/(this.MiterLimit*this.MiterLimit):this.m_miterLim=.5;var z;this.ArcTolerance<=0?z=t.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(f)*t.ClipperOffset.def_arc_tolerance?z=Math.abs(f)*t.ClipperOffset.def_arc_tolerance:z=this.ArcTolerance;var V=3.14159265358979/Math.acos(1-z/Math.abs(f));this.m_sin=Math.sin(t.ClipperOffset.two_pi/V),this.m_cos=Math.cos(t.ClipperOffset.two_pi/V),this.m_StepsPerRad=V/t.ClipperOffset.two_pi,f<0&&(this.m_sin=-this.m_sin);for(var S=0;S<this.m_polyNodes.ChildCount();S++){var A=this.m_polyNodes.Childs()[S];this.m_srcPoly=A.m_polygon;var J=this.m_srcPoly.length;if(!(J===0||f<=0&&(J<3||A.m_endtype!==t.EndType.etClosedPolygon))){if(this.m_destPoly=new Array,J===1){if(A.m_jointype===t.JoinType.jtRound)for(var ot=1,mt=0,vt=1;vt<=V;vt++){this.m_destPoly.push(new t.IntPoint2(t.ClipperOffset.Round(this.m_srcPoly[0].X+ot*f),t.ClipperOffset.Round(this.m_srcPoly[0].Y+mt*f)));var Nt=ot;ot=ot*this.m_cos-this.m_sin*mt,mt=Nt*this.m_sin+mt*this.m_cos}else for(var ot=-1,mt=-1,vt=0;vt<4;++vt)this.m_destPoly.push(new t.IntPoint2(t.ClipperOffset.Round(this.m_srcPoly[0].X+ot*f),t.ClipperOffset.Round(this.m_srcPoly[0].Y+mt*f))),ot<0?ot=1:mt<0?mt=1:ot=-1;this.m_destPolys.push(this.m_destPoly);continue}this.m_normals.length=0;for(var vt=0;vt<J-1;vt++)this.m_normals.push(t.ClipperOffset.GetUnitNormal(this.m_srcPoly[vt],this.m_srcPoly[vt+1]));if(A.m_endtype===t.EndType.etClosedLine||A.m_endtype===t.EndType.etClosedPolygon?this.m_normals.push(t.ClipperOffset.GetUnitNormal(this.m_srcPoly[J-1],this.m_srcPoly[0])):this.m_normals.push(new t.DoublePoint1(this.m_normals[J-2])),A.m_endtype===t.EndType.etClosedPolygon){for(var Bt=J-1,vt=0;vt<J;vt++)Bt=this.OffsetPoint(vt,Bt,A.m_jointype);this.m_destPolys.push(this.m_destPoly)}else if(A.m_endtype===t.EndType.etClosedLine){for(var Bt=J-1,vt=0;vt<J;vt++)Bt=this.OffsetPoint(vt,Bt,A.m_jointype);this.m_destPolys.push(this.m_destPoly),this.m_destPoly=new Array;for(var Rt=this.m_normals[J-1],vt=J-1;vt>0;vt--)this.m_normals[vt]=new t.DoublePoint2(-this.m_normals[vt-1].X,-this.m_normals[vt-1].Y);this.m_normals[0]=new t.DoublePoint2(-Rt.X,-Rt.Y),Bt=0;for(var vt=J-1;vt>=0;vt--)Bt=this.OffsetPoint(vt,Bt,A.m_jointype);this.m_destPolys.push(this.m_destPoly)}else{for(var Bt=0,vt=1;vt<J-1;++vt)Bt=this.OffsetPoint(vt,Bt,A.m_jointype);var Vt;if(A.m_endtype===t.EndType.etOpenButt){var vt=J-1;Vt=new t.IntPoint2(t.ClipperOffset.Round(this.m_srcPoly[vt].X+this.m_normals[vt].X*f),t.ClipperOffset.Round(this.m_srcPoly[vt].Y+this.m_normals[vt].Y*f)),this.m_destPoly.push(Vt),Vt=new t.IntPoint2(t.ClipperOffset.Round(this.m_srcPoly[vt].X-this.m_normals[vt].X*f),t.ClipperOffset.Round(this.m_srcPoly[vt].Y-this.m_normals[vt].Y*f)),this.m_destPoly.push(Vt)}else{var vt=J-1;Bt=J-2,this.m_sinA=0,this.m_normals[vt]=new t.DoublePoint2(-this.m_normals[vt].X,-this.m_normals[vt].Y),A.m_endtype===t.EndType.etOpenSquare?this.DoSquare(vt,Bt):this.DoRound(vt,Bt)}for(var vt=J-1;vt>0;vt--)this.m_normals[vt]=new t.DoublePoint2(-this.m_normals[vt-1].X,-this.m_normals[vt-1].Y);this.m_normals[0]=new t.DoublePoint2(-this.m_normals[1].X,-this.m_normals[1].Y),Bt=J-1;for(var vt=Bt-1;vt>0;--vt)Bt=this.OffsetPoint(vt,Bt,A.m_jointype);A.m_endtype===t.EndType.etOpenButt?(Vt=new t.IntPoint2(t.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*f),t.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*f)),this.m_destPoly.push(Vt),Vt=new t.IntPoint2(t.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*f),t.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*f)),this.m_destPoly.push(Vt)):(Bt=1,this.m_sinA=0,A.m_endtype===t.EndType.etOpenSquare?this.DoSquare(0,1):this.DoRound(0,1)),this.m_destPolys.push(this.m_destPoly)}}}},t.ClipperOffset.prototype.Execute=function(){var f=arguments,S=f[0]instanceof t.PolyTree;if(S){var A=f[0],z=f[1];A.Clear(),this.FixOrientations(),this.DoOffset(z);var V=new t.Clipper(0);if(V.AddPaths(this.m_destPolys,t.PolyType.ptSubject,!0),z>0)V.Execute(t.ClipType.ctUnion,A,t.PolyFillType.pftPositive,t.PolyFillType.pftPositive);else{var J=t.Clipper.GetBounds(this.m_destPolys),ot=new t.Path;if(ot.push(new t.IntPoint2(J.left-10,J.bottom+10)),ot.push(new t.IntPoint2(J.right+10,J.bottom+10)),ot.push(new t.IntPoint2(J.right+10,J.top-10)),ot.push(new t.IntPoint2(J.left-10,J.top-10)),V.AddPath(ot,t.PolyType.ptSubject,!0),V.ReverseSolution=!0,V.Execute(t.ClipType.ctUnion,A,t.PolyFillType.pftNegative,t.PolyFillType.pftNegative),A.ChildCount()===1&&A.Childs()[0].ChildCount()>0){var mt=A.Childs()[0];A.Childs()[0]=mt.Childs()[0],A.Childs()[0].m_Parent=A;for(var vt=1;vt<mt.ChildCount();vt++)A.AddChild(mt.Childs()[vt])}else A.Clear()}}else{var A=f[0],z=f[1];t.Clear(A),this.FixOrientations(),this.DoOffset(z);var V=new t.Clipper(0);if(V.AddPaths(this.m_destPolys,t.PolyType.ptSubject,!0),z>0)V.Execute(t.ClipType.ctUnion,A,t.PolyFillType.pftPositive,t.PolyFillType.pftPositive);else{var J=t.Clipper.GetBounds(this.m_destPolys),ot=new t.Path;ot.push(new t.IntPoint2(J.left-10,J.bottom+10)),ot.push(new t.IntPoint2(J.right+10,J.bottom+10)),ot.push(new t.IntPoint2(J.right+10,J.top-10)),ot.push(new t.IntPoint2(J.left-10,J.top-10)),V.AddPath(ot,t.PolyType.ptSubject,!0),V.ReverseSolution=!0,V.Execute(t.ClipType.ctUnion,A,t.PolyFillType.pftNegative,t.PolyFillType.pftNegative),A.length>0&&A.splice(0,1)}}},t.ClipperOffset.prototype.OffsetPoint=function(f,S,A){if(this.m_sinA=this.m_normals[S].X*this.m_normals[f].Y-this.m_normals[f].X*this.m_normals[S].Y,Math.abs(this.m_sinA*this.m_delta)<1){var z=this.m_normals[S].X*this.m_normals[f].X+this.m_normals[f].Y*this.m_normals[S].Y;if(z>0)return this.m_destPoly.push(new t.IntPoint2(t.ClipperOffset.Round(this.m_srcPoly[f].X+this.m_normals[S].X*this.m_delta),t.ClipperOffset.Round(this.m_srcPoly[f].Y+this.m_normals[S].Y*this.m_delta))),S}else this.m_sinA>1?this.m_sinA=1:this.m_sinA<-1&&(this.m_sinA=-1);if(this.m_sinA*this.m_delta<0)this.m_destPoly.push(new t.IntPoint2(t.ClipperOffset.Round(this.m_srcPoly[f].X+this.m_normals[S].X*this.m_delta),t.ClipperOffset.Round(this.m_srcPoly[f].Y+this.m_normals[S].Y*this.m_delta))),this.m_destPoly.push(new t.IntPoint1(this.m_srcPoly[f])),this.m_destPoly.push(new t.IntPoint2(t.ClipperOffset.Round(this.m_srcPoly[f].X+this.m_normals[f].X*this.m_delta),t.ClipperOffset.Round(this.m_srcPoly[f].Y+this.m_normals[f].Y*this.m_delta)));else switch(A){case t.JoinType.jtMiter:{var V=1+(this.m_normals[f].X*this.m_normals[S].X+this.m_normals[f].Y*this.m_normals[S].Y);V>=this.m_miterLim?this.DoMiter(f,S,V):this.DoSquare(f,S);break}case t.JoinType.jtSquare:this.DoSquare(f,S);break;case t.JoinType.jtRound:this.DoRound(f,S);break}return S=f,S},t.ClipperOffset.prototype.DoSquare=function(f,S){var A=Math.tan(Math.atan2(this.m_sinA,this.m_normals[S].X*this.m_normals[f].X+this.m_normals[S].Y*this.m_normals[f].Y)/4);this.m_destPoly.push(new t.IntPoint2(t.ClipperOffset.Round(this.m_srcPoly[f].X+this.m_delta*(this.m_normals[S].X-this.m_normals[S].Y*A)),t.ClipperOffset.Round(this.m_srcPoly[f].Y+this.m_delta*(this.m_normals[S].Y+this.m_normals[S].X*A)))),this.m_destPoly.push(new t.IntPoint2(t.ClipperOffset.Round(this.m_srcPoly[f].X+this.m_delta*(this.m_normals[f].X+this.m_normals[f].Y*A)),t.ClipperOffset.Round(this.m_srcPoly[f].Y+this.m_delta*(this.m_normals[f].Y-this.m_normals[f].X*A))))},t.ClipperOffset.prototype.DoMiter=function(f,S,A){var z=this.m_delta/A;this.m_destPoly.push(new t.IntPoint2(t.ClipperOffset.Round(this.m_srcPoly[f].X+(this.m_normals[S].X+this.m_normals[f].X)*z),t.ClipperOffset.Round(this.m_srcPoly[f].Y+(this.m_normals[S].Y+this.m_normals[f].Y)*z)))},t.ClipperOffset.prototype.DoRound=function(f,S){for(var A=Math.atan2(this.m_sinA,this.m_normals[S].X*this.m_normals[f].X+this.m_normals[S].Y*this.m_normals[f].Y),z=Math.max(t.Cast_Int32(t.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(A))),1),V=this.m_normals[S].X,J=this.m_normals[S].Y,ot,mt=0;mt<z;++mt)this.m_destPoly.push(new t.IntPoint2(t.ClipperOffset.Round(this.m_srcPoly[f].X+V*this.m_delta),t.ClipperOffset.Round(this.m_srcPoly[f].Y+J*this.m_delta))),ot=V,V=V*this.m_cos-this.m_sin*J,J=ot*this.m_sin+J*this.m_cos;this.m_destPoly.push(new t.IntPoint2(t.ClipperOffset.Round(this.m_srcPoly[f].X+this.m_normals[f].X*this.m_delta),t.ClipperOffset.Round(this.m_srcPoly[f].Y+this.m_normals[f].Y*this.m_delta)))},t.Error=function(f){try{throw new Error(f)}catch(S){alert(S.message)}},t.JS={},t.JS.AreaOfPolygon=function(f,S){return S||(S=1),t.Clipper.Area(f)/(S*S)},t.JS.AreaOfPolygons=function(f,S){S||(S=1);for(var A=0,z=0;z<f.length;z++)A+=t.Clipper.Area(f[z]);return A/(S*S)},t.JS.BoundsOfPath=function(f,S){return t.JS.BoundsOfPaths([f],S)},t.JS.BoundsOfPaths=function(f,S){S||(S=1);var A=t.Clipper.GetBounds(f);return A.left/=S,A.bottom/=S,A.right/=S,A.top/=S,A},t.JS.Clean=function(z,S){if(!(z instanceof Array))return[];var A=z[0]instanceof Array,z=t.JS.Clone(z);if(typeof S!="number"||S===null)return t.Error("Delta is not a number in Clean()."),z;if(z.length===0||z.length===1&&z[0].length===0||S<0)return z;A||(z=[z]);for(var V=z.length,J,ot,mt,vt,Nt,Bt,Rt,Vt=[],Kt=0;Kt<V;Kt++)if(ot=z[Kt],J=ot.length,J!==0){if(J<3){mt=ot,Vt.push(mt);continue}for(mt=ot,vt=S*S,Nt=ot[0],Bt=1,Rt=1;Rt<J;Rt++)(ot[Rt].X-Nt.X)*(ot[Rt].X-Nt.X)+(ot[Rt].Y-Nt.Y)*(ot[Rt].Y-Nt.Y)<=vt||(mt[Bt]=ot[Rt],Nt=ot[Rt],Bt++);Nt=ot[Bt-1],(ot[0].X-Nt.X)*(ot[0].X-Nt.X)+(ot[0].Y-Nt.Y)*(ot[0].Y-Nt.Y)<=vt&&Bt--,Bt<J&&mt.splice(Bt,J-Bt),mt.length&&Vt.push(mt)}return!A&&Vt.length?Vt=Vt[0]:!A&&Vt.length===0?Vt=[]:A&&Vt.length===0&&(Vt=[[]]),Vt},t.JS.Clone=function(f){if(!(f instanceof Array))return[];if(f.length===0)return[];if(f.length===1&&f[0].length===0)return[[]];var S=f[0]instanceof Array;S||(f=[f]);var A=f.length,z,V,J,ot,mt=new Array(A);for(V=0;V<A;V++){for(z=f[V].length,ot=new Array(z),J=0;J<z;J++)ot[J]={X:f[V][J].X,Y:f[V][J].Y};mt[V]=ot}return S||(mt=mt[0]),mt},t.JS.Lighten=function(f,S){if(!(f instanceof Array))return[];if(typeof S!="number"||S===null)return t.Error("Tolerance is not a number in Lighten()."),t.JS.Clone(f);if(f.length===0||f.length===1&&f[0].length===0||S<0)return t.JS.Clone(f);var A=f[0]instanceof Array;A||(f=[f]);var z,V,J,ot,mt,vt,Nt,Bt,Rt,Vt,Kt,ae,le,ge,on,Un,Mi,s0=f.length,a0=S*S,Ti=[];for(z=0;z<s0;z++)if(J=f[z],vt=J.length,vt!==0){for(ot=0;ot<1e6;ot++){for(mt=[],vt=J.length,J[vt-1].X!==J[0].X||J[vt-1].Y!==J[0].Y?(ae=1,J.push({X:J[0].X,Y:J[0].Y}),vt=J.length):ae=0,Kt=[],V=0;V<vt-2;V++)Nt=J[V],Rt=J[V+1],Bt=J[V+2],Un=Nt.X,Mi=Nt.Y,le=Bt.X-Un,ge=Bt.Y-Mi,(le!==0||ge!==0)&&(on=((Rt.X-Un)*le+(Rt.Y-Mi)*ge)/(le*le+ge*ge),on>1?(Un=Bt.X,Mi=Bt.Y):on>0&&(Un+=le*on,Mi+=ge*on)),le=Rt.X-Un,ge=Rt.Y-Mi,Vt=le*le+ge*ge,Vt<=a0&&(Kt[V+1]=1,V++);for(mt.push({X:J[0].X,Y:J[0].Y}),V=1;V<vt-1;V++)Kt[V]||mt.push({X:J[V].X,Y:J[V].Y});if(mt.push({X:J[vt-1].X,Y:J[vt-1].Y}),ae&&J.pop(),Kt.length)J=mt;else break}vt=mt.length,mt[vt-1].X===mt[0].X&&mt[vt-1].Y===mt[0].Y&&mt.pop(),mt.length>2&&Ti.push(mt)}return A||(Ti=Ti[0]),typeof Ti>"u"&&(Ti=[]),Ti},t.JS.PerimeterOfPath=function(f,S,A){if(typeof f>"u")return 0;var z=Math.sqrt,V=0,J,ot,mt=0,vt=0,Nt=0,Bt=0,Rt=f.length;if(Rt<2)return 0;for(S&&(f[Rt]=f[0],Rt++);--Rt;)J=f[Rt],mt=J.X,vt=J.Y,ot=f[Rt-1],Nt=ot.X,Bt=ot.Y,V+=z((mt-Nt)*(mt-Nt)+(vt-Bt)*(vt-Bt));return S&&f.pop(),V/A},t.JS.PerimeterOfPaths=function(f,S,A){A||(A=1);for(var z=0,V=0;V<f.length;V++)z+=t.JS.PerimeterOfPath(f[V],S,A);return z},t.JS.ScaleDownPath=function(f,S){var A,z;for(S||(S=1),A=f.length;A--;)z=f[A],z.X=z.X/S,z.Y=z.Y/S},t.JS.ScaleDownPaths=function(f,S){var A,z,V;for(S||(S=1),A=f.length;A--;)for(z=f[A].length;z--;)V=f[A][z],V.X=V.X/S,V.Y=V.Y/S},t.JS.ScaleUpPath=function(f,S){var A,z,V=Math.round;for(S||(S=1),A=f.length;A--;)z=f[A],z.X=V(z.X*S),z.Y=V(z.Y*S)},t.JS.ScaleUpPaths=function(f,S){var A,z,V,J=Math.round;for(S||(S=1),A=f.length;A--;)for(z=f[A].length;z--;)V=f[A][z],V.X=J(V.X*S),V.Y=J(V.Y*S)},t.ExPolygons=function(){return[]},t.ExPolygon=function(){this.outer=null,this.holes=null},t.JS.AddOuterPolyNodeToExPolygons=function(f,S){var A=new t.ExPolygon;A.outer=f.Contour();var z=f.Childs(),V=z.length;A.holes=new Array(V);var J,ot,mt,vt,Nt,Bt;for(mt=0;mt<V;mt++)for(J=z[mt],A.holes[mt]=J.Contour(),vt=0,Nt=J.Childs(),Bt=Nt.length;vt<Bt;vt++)ot=Nt[vt],t.JS.AddOuterPolyNodeToExPolygons(ot,S);S.push(A)},t.JS.ExPolygonsToPaths=function(f){var S,A,z,V,J=new t.Paths;for(S=0,z=f.length;S<z;S++)for(J.push(f[S].outer),A=0,V=f[S].holes.length;A<V;A++)J.push(f[S].holes[A]);return J},t.JS.PolyTreeToExPolygons=function(f){var S=new t.ExPolygons,A,z,V,J;for(z=0,V=f.Childs(),J=V.length;z<J;z++)A=V[z],t.JS.AddOuterPolyNodeToExPolygons(A,S);return S}})()})(Rd);var p0=Rd.exports;const Yn=Hi(p0);var g0=_s;_s.polyline=_s;_s.polygon=m0;function _s(n,t,e){var r=n.length,i=Ci(n[0],t),o=[],s,a,l,u,p;for(e||(e=[]),s=1;s<r;s++){for(a=n[s-1],l=n[s],u=p=Ci(l,t);;)if(i|u){if(i&u)break;i?(a=zl(a,l,i,t),i=Ci(a,t)):(l=zl(a,l,u,t),u=Ci(l,t))}else{o.push(a),u!==p?(o.push(l),s<r-1&&(e.push(o),o=[])):s===r-1&&o.push(l);break}i=p}return o.length&&e.push(o),e}function m0(n,t){var e,r,i,o,s,a,l;for(r=1;r<=8;r*=2){for(e=[],i=n[n.length-1],o=!(Ci(i,t)&r),s=0;s<n.length;s++)a=n[s],l=!(Ci(a,t)&r),l!==o&&e.push(zl(i,a,r,t)),l&&e.push(a),i=a,o=l;if(n=e,!n.length)break}return e}function zl(n,t,e,r){return e&8?[n[0]+(t[0]-n[0])*(r[3]-n[1])/(t[1]-n[1]),r[3]]:e&4?[n[0]+(t[0]-n[0])*(r[1]-n[1])/(t[1]-n[1]),r[1]]:e&2?[r[2],n[1]+(t[1]-n[1])*(r[2]-n[0])/(t[0]-n[0])]:e&1?[r[0],n[1]+(t[1]-n[1])*(r[0]-n[0])/(t[0]-n[0])]:null}function Ci(n,t){var e=0;return n[0]<t[0]?e|=1:n[0]>t[2]&&(e|=2),n[1]<t[1]?e|=4:n[1]>t[3]&&(e|=8),e}const Xu=Hi(g0);var kl={exports:{}},we={},Bl={exports:{}},di={};function jd(){var n={};return n["align-content"]=!1,n["align-items"]=!1,n["align-self"]=!1,n["alignment-adjust"]=!1,n["alignment-baseline"]=!1,n.all=!1,n["anchor-point"]=!1,n.animation=!1,n["animation-delay"]=!1,n["animation-direction"]=!1,n["animation-duration"]=!1,n["animation-fill-mode"]=!1,n["animation-iteration-count"]=!1,n["animation-name"]=!1,n["animation-play-state"]=!1,n["animation-timing-function"]=!1,n.azimuth=!1,n["backface-visibility"]=!1,n.background=!0,n["background-attachment"]=!0,n["background-clip"]=!0,n["background-color"]=!0,n["background-image"]=!0,n["background-origin"]=!0,n["background-position"]=!0,n["background-repeat"]=!0,n["background-size"]=!0,n["baseline-shift"]=!1,n.binding=!1,n.bleed=!1,n["bookmark-label"]=!1,n["bookmark-level"]=!1,n["bookmark-state"]=!1,n.border=!0,n["border-bottom"]=!0,n["border-bottom-color"]=!0,n["border-bottom-left-radius"]=!0,n["border-bottom-right-radius"]=!0,n["border-bottom-style"]=!0,n["border-bottom-width"]=!0,n["border-collapse"]=!0,n["border-color"]=!0,n["border-image"]=!0,n["border-image-outset"]=!0,n["border-image-repeat"]=!0,n["border-image-slice"]=!0,n["border-image-source"]=!0,n["border-image-width"]=!0,n["border-left"]=!0,n["border-left-color"]=!0,n["border-left-style"]=!0,n["border-left-width"]=!0,n["border-radius"]=!0,n["border-right"]=!0,n["border-right-color"]=!0,n["border-right-style"]=!0,n["border-right-width"]=!0,n["border-spacing"]=!0,n["border-style"]=!0,n["border-top"]=!0,n["border-top-color"]=!0,n["border-top-left-radius"]=!0,n["border-top-right-radius"]=!0,n["border-top-style"]=!0,n["border-top-width"]=!0,n["border-width"]=!0,n.bottom=!1,n["box-decoration-break"]=!0,n["box-shadow"]=!0,n["box-sizing"]=!0,n["box-snap"]=!0,n["box-suppress"]=!0,n["break-after"]=!0,n["break-before"]=!0,n["break-inside"]=!0,n["caption-side"]=!1,n.chains=!1,n.clear=!0,n.clip=!1,n["clip-path"]=!1,n["clip-rule"]=!1,n.color=!0,n["color-interpolation-filters"]=!0,n["column-count"]=!1,n["column-fill"]=!1,n["column-gap"]=!1,n["column-rule"]=!1,n["column-rule-color"]=!1,n["column-rule-style"]=!1,n["column-rule-width"]=!1,n["column-span"]=!1,n["column-width"]=!1,n.columns=!1,n.contain=!1,n.content=!1,n["counter-increment"]=!1,n["counter-reset"]=!1,n["counter-set"]=!1,n.crop=!1,n.cue=!1,n["cue-after"]=!1,n["cue-before"]=!1,n.cursor=!1,n.direction=!1,n.display=!0,n["display-inside"]=!0,n["display-list"]=!0,n["display-outside"]=!0,n["dominant-baseline"]=!1,n.elevation=!1,n["empty-cells"]=!1,n.filter=!1,n.flex=!1,n["flex-basis"]=!1,n["flex-direction"]=!1,n["flex-flow"]=!1,n["flex-grow"]=!1,n["flex-shrink"]=!1,n["flex-wrap"]=!1,n.float=!1,n["float-offset"]=!1,n["flood-color"]=!1,n["flood-opacity"]=!1,n["flow-from"]=!1,n["flow-into"]=!1,n.font=!0,n["font-family"]=!0,n["font-feature-settings"]=!0,n["font-kerning"]=!0,n["font-language-override"]=!0,n["font-size"]=!0,n["font-size-adjust"]=!0,n["font-stretch"]=!0,n["font-style"]=!0,n["font-synthesis"]=!0,n["font-variant"]=!0,n["font-variant-alternates"]=!0,n["font-variant-caps"]=!0,n["font-variant-east-asian"]=!0,n["font-variant-ligatures"]=!0,n["font-variant-numeric"]=!0,n["font-variant-position"]=!0,n["font-weight"]=!0,n.grid=!1,n["grid-area"]=!1,n["grid-auto-columns"]=!1,n["grid-auto-flow"]=!1,n["grid-auto-rows"]=!1,n["grid-column"]=!1,n["grid-column-end"]=!1,n["grid-column-start"]=!1,n["grid-row"]=!1,n["grid-row-end"]=!1,n["grid-row-start"]=!1,n["grid-template"]=!1,n["grid-template-areas"]=!1,n["grid-template-columns"]=!1,n["grid-template-rows"]=!1,n["hanging-punctuation"]=!1,n.height=!0,n.hyphens=!1,n.icon=!1,n["image-orientation"]=!1,n["image-resolution"]=!1,n["ime-mode"]=!1,n["initial-letters"]=!1,n["inline-box-align"]=!1,n["justify-content"]=!1,n["justify-items"]=!1,n["justify-self"]=!1,n.left=!1,n["letter-spacing"]=!0,n["lighting-color"]=!0,n["line-box-contain"]=!1,n["line-break"]=!1,n["line-grid"]=!1,n["line-height"]=!1,n["line-snap"]=!1,n["line-stacking"]=!1,n["line-stacking-ruby"]=!1,n["line-stacking-shift"]=!1,n["line-stacking-strategy"]=!1,n["list-style"]=!0,n["list-style-image"]=!0,n["list-style-position"]=!0,n["list-style-type"]=!0,n.margin=!0,n["margin-bottom"]=!0,n["margin-left"]=!0,n["margin-right"]=!0,n["margin-top"]=!0,n["marker-offset"]=!1,n["marker-side"]=!1,n.marks=!1,n.mask=!1,n["mask-box"]=!1,n["mask-box-outset"]=!1,n["mask-box-repeat"]=!1,n["mask-box-slice"]=!1,n["mask-box-source"]=!1,n["mask-box-width"]=!1,n["mask-clip"]=!1,n["mask-image"]=!1,n["mask-origin"]=!1,n["mask-position"]=!1,n["mask-repeat"]=!1,n["mask-size"]=!1,n["mask-source-type"]=!1,n["mask-type"]=!1,n["max-height"]=!0,n["max-lines"]=!1,n["max-width"]=!0,n["min-height"]=!0,n["min-width"]=!0,n["move-to"]=!1,n["nav-down"]=!1,n["nav-index"]=!1,n["nav-left"]=!1,n["nav-right"]=!1,n["nav-up"]=!1,n["object-fit"]=!1,n["object-position"]=!1,n.opacity=!1,n.order=!1,n.orphans=!1,n.outline=!1,n["outline-color"]=!1,n["outline-offset"]=!1,n["outline-style"]=!1,n["outline-width"]=!1,n.overflow=!1,n["overflow-wrap"]=!1,n["overflow-x"]=!1,n["overflow-y"]=!1,n.padding=!0,n["padding-bottom"]=!0,n["padding-left"]=!0,n["padding-right"]=!0,n["padding-top"]=!0,n.page=!1,n["page-break-after"]=!1,n["page-break-before"]=!1,n["page-break-inside"]=!1,n["page-policy"]=!1,n.pause=!1,n["pause-after"]=!1,n["pause-before"]=!1,n.perspective=!1,n["perspective-origin"]=!1,n.pitch=!1,n["pitch-range"]=!1,n["play-during"]=!1,n.position=!1,n["presentation-level"]=!1,n.quotes=!1,n["region-fragment"]=!1,n.resize=!1,n.rest=!1,n["rest-after"]=!1,n["rest-before"]=!1,n.richness=!1,n.right=!1,n.rotation=!1,n["rotation-point"]=!1,n["ruby-align"]=!1,n["ruby-merge"]=!1,n["ruby-position"]=!1,n["shape-image-threshold"]=!1,n["shape-outside"]=!1,n["shape-margin"]=!1,n.size=!1,n.speak=!1,n["speak-as"]=!1,n["speak-header"]=!1,n["speak-numeral"]=!1,n["speak-punctuation"]=!1,n["speech-rate"]=!1,n.stress=!1,n["string-set"]=!1,n["tab-size"]=!1,n["table-layout"]=!1,n["text-align"]=!0,n["text-align-last"]=!0,n["text-combine-upright"]=!0,n["text-decoration"]=!0,n["text-decoration-color"]=!0,n["text-decoration-line"]=!0,n["text-decoration-skip"]=!0,n["text-decoration-style"]=!0,n["text-emphasis"]=!0,n["text-emphasis-color"]=!0,n["text-emphasis-position"]=!0,n["text-emphasis-style"]=!0,n["text-height"]=!0,n["text-indent"]=!0,n["text-justify"]=!0,n["text-orientation"]=!0,n["text-overflow"]=!0,n["text-shadow"]=!0,n["text-space-collapse"]=!0,n["text-transform"]=!0,n["text-underline-position"]=!0,n["text-wrap"]=!0,n.top=!1,n.transform=!1,n["transform-origin"]=!1,n["transform-style"]=!1,n.transition=!1,n["transition-delay"]=!1,n["transition-duration"]=!1,n["transition-property"]=!1,n["transition-timing-function"]=!1,n["unicode-bidi"]=!1,n["vertical-align"]=!1,n.visibility=!1,n["voice-balance"]=!1,n["voice-duration"]=!1,n["voice-family"]=!1,n["voice-pitch"]=!1,n["voice-range"]=!1,n["voice-rate"]=!1,n["voice-stress"]=!1,n["voice-volume"]=!1,n.volume=!1,n["white-space"]=!1,n.widows=!1,n.width=!0,n["will-change"]=!1,n["word-break"]=!0,n["word-spacing"]=!0,n["word-wrap"]=!0,n["wrap-flow"]=!1,n["wrap-through"]=!1,n["writing-mode"]=!1,n["z-index"]=!1,n}function v0(n,t,e){}function y0(n,t,e){}var M0=/javascript\s*\:/img;function T0(n,t){return M0.test(t)?"":t}di.whiteList=jd();di.getDefaultWhiteList=jd;di.onAttr=v0;di.onIgnoreAttr=y0;di.safeAttrValue=T0;var I0={indexOf:function(n,t){var e,r;if(Array.prototype.indexOf)return n.indexOf(t);for(e=0,r=n.length;e<r;e++)if(n[e]===t)return e;return-1},forEach:function(n,t,e){var r,i;if(Array.prototype.forEach)return n.forEach(t,e);for(r=0,i=n.length;r<i;r++)t.call(e,n[r],r,n)},trim:function(n){return String.prototype.trim?n.trim():n.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(n){return String.prototype.trimRight?n.trimRight():n.replace(/(\s*$)/g,"")}},so=I0;function w0(n,t){n=so.trimRight(n),n[n.length-1]!==";"&&(n+=";");var e=n.length,r=!1,i=0,o=0,s="";function a(){if(!r){var p=so.trim(n.slice(i,o)),c=p.indexOf(":");if(c!==-1){var g=so.trim(p.slice(0,c)),v=so.trim(p.slice(c+1));if(g){var I=t(i,s.length,g,v,p);I&&(s+=I+"; ")}}}i=o+1}for(;o<e;o++){var l=n[o];if(l==="/"&&n[o+1]==="*"){var u=n.indexOf("*/",o+2);if(u===-1)break;o=u+1,i=o+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||a():l===`
`&&a()}return so.trim(s)}var S0=w0,ls=di,x0=S0;function vh(n){return n==null}function C0(n){var t={};for(var e in n)t[e]=n[e];return t}function zd(n){n=C0(n||{}),n.whiteList=n.whiteList||ls.whiteList,n.onAttr=n.onAttr||ls.onAttr,n.onIgnoreAttr=n.onIgnoreAttr||ls.onIgnoreAttr,n.safeAttrValue=n.safeAttrValue||ls.safeAttrValue,this.options=n}zd.prototype.process=function(n){if(n=n||"",n=n.toString(),!n)return"";var t=this,e=t.options,r=e.whiteList,i=e.onAttr,o=e.onIgnoreAttr,s=e.safeAttrValue,a=x0(n,function(l,u,p,c,g){var v=r[p],I=!1;if(v===!0?I=v:typeof v=="function"?I=v(c):v instanceof RegExp&&(I=v.test(c)),I!==!0&&(I=!1),c=s(p,c),!!c){var w={position:u,sourcePosition:l,source:g,isWhite:I};if(I){var y=i(p,c,w);return vh(y)?p+":"+c:y}else{var y=o(p,c,w);if(!vh(y))return y}}});return a};var E0=zd;(function(n,t){var e=di,r=E0;function i(s,a){var l=new r(a);return l.process(s)}t=n.exports=i,t.FilterCSS=r;for(var o in e)t[o]=e[o];typeof window<"u"&&(window.filterCSS=n.exports)})(Bl,Bl.exports);var Gu=Bl.exports,$u={indexOf:function(n,t){var e,r;if(Array.prototype.indexOf)return n.indexOf(t);for(e=0,r=n.length;e<r;e++)if(n[e]===t)return e;return-1},forEach:function(n,t,e){var r,i;if(Array.prototype.forEach)return n.forEach(t,e);for(r=0,i=n.length;r<i;r++)t.call(e,n[r],r,n)},trim:function(n){return String.prototype.trim?n.trim():n.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(n){var t=/\s|\n|\t/,e=t.exec(n);return e?e.index:-1}},P0=Gu.FilterCSS,N0=Gu.getDefaultWhiteList,ta=$u;function kd(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height","loading"],ins:["datetime"],kbd:[],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var Bd=new P0;function A0(n,t,e){}function D0(n,t,e){}function L0(n,t,e){}function O0(n,t,e){}function Wd(n){return n.replace(R0,"&lt;").replace(j0,"&gt;")}function b0(n,t,e,r){if(e=Gd(e),t==="href"||t==="src"){if(e=ta.trim(e),e==="#")return"#";if(!(e.substr(0,7)==="http://"||e.substr(0,8)==="https://"||e.substr(0,7)==="mailto:"||e.substr(0,4)==="tel:"||e.substr(0,11)==="data:image/"||e.substr(0,6)==="ftp://"||e.substr(0,2)==="./"||e.substr(0,3)==="../"||e[0]==="#"||e[0]==="/"))return""}else if(t==="background"){if(us.lastIndex=0,us.test(e))return""}else if(t==="style"){if(yh.lastIndex=0,yh.test(e)||(Mh.lastIndex=0,Mh.test(e)&&(us.lastIndex=0,us.test(e))))return"";r!==!1&&(r=r||Bd,e=r.process(e))}return e=$d(e),e}var R0=/</g,j0=/>/g,z0=/"/g,k0=/&quot;/g,B0=/&#([a-zA-Z0-9]*);?/gim,W0=/&colon;?/gim,U0=/&newline;?/gim,us=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,yh=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,Mh=/u\s*r\s*l\s*\(.*/gi;function Ud(n){return n.replace(z0,"&quot;")}function Yd(n){return n.replace(k0,'"')}function Fd(n){return n.replace(B0,function(e,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function Vd(n){return n.replace(W0,":").replace(U0," ")}function Xd(n){for(var t="",e=0,r=n.length;e<r;e++)t+=n.charCodeAt(e)<32?" ":n.charAt(e);return ta.trim(t)}function Gd(n){return n=Yd(n),n=Fd(n),n=Vd(n),n=Xd(n),n}function $d(n){return n=Ud(n),n=Wd(n),n}function Y0(){return""}function F0(n,t){typeof t!="function"&&(t=function(){});var e=!Array.isArray(n);function r(s){return e?!0:ta.indexOf(n,s)!==-1}var i=[],o=!1;return{onIgnoreTag:function(s,a,l){if(r(s))if(l.isClosing){var u="[/removed]",p=l.position+u.length;return i.push([o!==!1?o:l.position,p]),o=!1,u}else return o||(o=l.position),"[removed]";else return t(s,a,l)},remove:function(s){var a="",l=0;return ta.forEach(i,function(u){a+=s.slice(l,u[0]),l=u[1]}),a+=s.slice(l),a}}}function V0(n){for(var t="",e=0;e<n.length;){var r=n.indexOf("<!--",e);if(r===-1){t+=n.slice(e);break}t+=n.slice(e,r);var i=n.indexOf("-->",r);if(i===-1)break;e=i+3}return t}function X0(n){var t=n.split("");return t=t.filter(function(e){var r=e.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),t.join("")}we.whiteList=kd();we.getDefaultWhiteList=kd;we.onTag=A0;we.onIgnoreTag=D0;we.onTagAttr=L0;we.onIgnoreTagAttr=O0;we.safeAttrValue=b0;we.escapeHtml=Wd;we.escapeQuote=Ud;we.unescapeQuote=Yd;we.escapeHtmlEntities=Fd;we.escapeDangerHtml5Entities=Vd;we.clearNonPrintableCharacter=Xd;we.friendlyAttrValue=Gd;we.escapeAttrValue=$d;we.onIgnoreTagStripAll=Y0;we.StripTagBody=F0;we.stripCommentTag=V0;we.stripBlankChar=X0;we.attributeWrapSign='"';we.cssFilter=Bd;we.getDefaultCSSWhiteList=N0;var ba={},Tr=$u;function G0(n){var t=Tr.spaceIndex(n),e;return t===-1?e=n.slice(1,-1):e=n.slice(1,t+1),e=Tr.trim(e).toLowerCase(),e.slice(0,1)==="/"&&(e=e.slice(1)),e.slice(-1)==="/"&&(e=e.slice(0,-1)),e}function $0(n){return n.slice(0,2)==="</"}function H0(n,t,e){var r="",i=0,o=!1,s=!1,a=0,l=n.length,u="",p="";t:for(a=0;a<l;a++){var c=n.charAt(a);if(o===!1){if(c==="<"){o=a;continue}}else if(s===!1){if(c==="<"){r+=e(n.slice(i,a)),o=a,i=a;continue}if(c===">"||a===l-1){r+=e(n.slice(i,o)),p=n.slice(o,a+1),u=G0(p),r+=t(o,r.length,u,p,$0(p)),i=a+1,o=!1;continue}if(c==='"'||c==="'")for(var g=1,v=n.charAt(a-g);v.trim()===""||v==="=";){if(v==="="){s=c;continue t}v=n.charAt(a-++g)}}else if(c===s){s=!1;continue}}return i<l&&(r+=e(n.substr(i))),r}var Q0=/[^a-zA-Z0-9\\_:.-]/gim;function Z0(n,t){var e=0,r=0,i=[],o=!1,s=n.length;function a(g,v){if(g=Tr.trim(g),g=g.replace(Q0,"").toLowerCase(),!(g.length<1)){var I=t(g,v||"");I&&i.push(I)}}for(var l=0;l<s;l++){var u=n.charAt(l),p,c;if(o===!1&&u==="="){o=n.slice(e,l),e=l+1,r=n.charAt(e)==='"'||n.charAt(e)==="'"?e:J0(n,l+1);continue}if(o!==!1&&l===r){if(c=n.indexOf(u,l+1),c===-1)break;p=Tr.trim(n.slice(r+1,c)),a(o,p),o=!1,l=c,e=l+1;continue}if(/\s|\n|\t/.test(u))if(n=n.replace(/\s|\n|\t/g," "),o===!1)if(c=K0(n,l),c===-1){p=Tr.trim(n.slice(e,l)),a(p),o=!1,e=l+1;continue}else{l=c-1;continue}else if(c=q0(n,l-1),c===-1){p=Tr.trim(n.slice(e,l)),p=Th(p),a(o,p),o=!1,e=l+1;continue}else continue}return e<n.length&&(o===!1?a(n.slice(e)):a(o,Th(Tr.trim(n.slice(e))))),Tr.trim(i.join(" "))}function K0(n,t){for(;t<n.length;t++){var e=n[t];if(e!==" ")return e==="="?t:-1}}function J0(n,t){for(;t<n.length;t++){var e=n[t];if(e!==" ")return e==="'"||e==='"'?t:-1}}function q0(n,t){for(;t>0;t--){var e=n[t];if(e!==" ")return e==="="?t:-1}}function _0(n){return n[0]==='"'&&n[n.length-1]==='"'||n[0]==="'"&&n[n.length-1]==="'"}function Th(n){return _0(n)?n.substr(1,n.length-2):n}ba.parseTag=H0;ba.parseAttr=Z0;var ty=Gu.FilterCSS,wn=we,Hd=ba,ey=Hd.parseTag,ny=Hd.parseAttr,As=$u;function cs(n){return n==null}function ry(n){var t=As.spaceIndex(n);if(t===-1)return{html:"",closing:n[n.length-2]==="/"};n=As.trim(n.slice(t+1,-1));var e=n[n.length-1]==="/";return e&&(n=As.trim(n.slice(0,-1))),{html:n,closing:e}}function iy(n){var t={};for(var e in n)t[e]=n[e];return t}function oy(n){var t={};for(var e in n)Array.isArray(n[e])?t[e.toLowerCase()]=n[e].map(function(r){return r.toLowerCase()}):t[e.toLowerCase()]=n[e];return t}function Qd(n){n=iy(n||{}),n.stripIgnoreTag&&(n.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),n.onIgnoreTag=wn.onIgnoreTagStripAll),n.whiteList||n.allowList?n.whiteList=oy(n.whiteList||n.allowList):n.whiteList=wn.whiteList,this.attributeWrapSign=n.singleQuotedAttributeValue===!0?"'":wn.attributeWrapSign,n.onTag=n.onTag||wn.onTag,n.onTagAttr=n.onTagAttr||wn.onTagAttr,n.onIgnoreTag=n.onIgnoreTag||wn.onIgnoreTag,n.onIgnoreTagAttr=n.onIgnoreTagAttr||wn.onIgnoreTagAttr,n.safeAttrValue=n.safeAttrValue||wn.safeAttrValue,n.escapeHtml=n.escapeHtml||wn.escapeHtml,this.options=n,n.css===!1?this.cssFilter=!1:(n.css=n.css||{},this.cssFilter=new ty(n.css))}Qd.prototype.process=function(n){if(n=n||"",n=n.toString(),!n)return"";var t=this,e=t.options,r=e.whiteList,i=e.onTag,o=e.onIgnoreTag,s=e.onTagAttr,a=e.onIgnoreTagAttr,l=e.safeAttrValue,u=e.escapeHtml,p=t.attributeWrapSign,c=t.cssFilter;e.stripBlankChar&&(n=wn.stripBlankChar(n)),e.allowCommentTag||(n=wn.stripCommentTag(n));var g=!1;e.stripIgnoreTagBody&&(g=wn.StripTagBody(e.stripIgnoreTagBody,o),o=g.onIgnoreTag);var v=ey(n,function(I,w,y,T,h){var m={sourcePosition:I,position:w,isClosing:h,isWhite:Object.prototype.hasOwnProperty.call(r,y)},d=i(y,T,m);if(!cs(d))return d;if(m.isWhite){if(m.isClosing)return"</"+y+">";var M=ry(T),x=r[y],E=ny(M.html,function(P,R){var N=As.indexOf(x,P)!==-1,b=s(y,P,R,N);return cs(b)?N?(R=l(y,P,R,c),R?P+"="+p+R+p:P):(b=a(y,P,R,N),cs(b)?void 0:b):b});return T="<"+y,E&&(T+=" "+E),M.closing&&(T+=" /"),T+=">",T}else return d=o(y,T,m),cs(d)?u(T):d},u);return g&&(v=g.remove(v)),v};var sy=Qd;(function(n,t){var e=we,r=ba,i=sy;function o(a,l){var u=new i(l);return u.process(a)}t=n.exports=o,t.filterXSS=o,t.FilterXSS=i,function(){for(var a in e)t[a]=e[a];for(var l in r)t[l]=r[l]}(),typeof window<"u"&&(window.filterXSS=n.exports);function s(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}s()&&(self.filterXSS=n.exports)})(kl,kl.exports);var ay=kl.exports;const Wl=Hi(ay);var Zd={exports:{}},pe={};/** @license React v16.14.0
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hu=Ad,Bn=typeof Symbol=="function"&&Symbol.for,Ho=Bn?Symbol.for("react.element"):60103,ly=Bn?Symbol.for("react.portal"):60106,uy=Bn?Symbol.for("react.fragment"):60107,cy=Bn?Symbol.for("react.strict_mode"):60108,hy=Bn?Symbol.for("react.profiler"):60114,fy=Bn?Symbol.for("react.provider"):60109,dy=Bn?Symbol.for("react.context"):60110,py=Bn?Symbol.for("react.forward_ref"):60112,gy=Bn?Symbol.for("react.suspense"):60113,my=Bn?Symbol.for("react.memo"):60115,vy=Bn?Symbol.for("react.lazy"):60116,Ih=typeof Symbol=="function"&&Symbol.iterator;function Qo(n){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+n,e=1;e<arguments.length;e++)t+="&args[]="+encodeURIComponent(arguments[e]);return"Minified React error #"+n+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Kd={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Jd={};function Qi(n,t,e){this.props=n,this.context=t,this.refs=Jd,this.updater=e||Kd}Qi.prototype.isReactComponent={};Qi.prototype.setState=function(n,t){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error(Qo(85));this.updater.enqueueSetState(this,n,t,"setState")};Qi.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function qd(){}qd.prototype=Qi.prototype;function Qu(n,t,e){this.props=n,this.context=t,this.refs=Jd,this.updater=e||Kd}var Zu=Qu.prototype=new qd;Zu.constructor=Qu;Hu(Zu,Qi.prototype);Zu.isPureReactComponent=!0;var Ku={current:null},_d=Object.prototype.hasOwnProperty,tp={key:!0,ref:!0,__self:!0,__source:!0};function ep(n,t,e){var r,i={},o=null,s=null;if(t!=null)for(r in t.ref!==void 0&&(s=t.ref),t.key!==void 0&&(o=""+t.key),t)_d.call(t,r)&&!tp.hasOwnProperty(r)&&(i[r]=t[r]);var a=arguments.length-2;if(a===1)i.children=e;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];i.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:Ho,type:n,key:o,ref:s,props:i,_owner:Ku.current}}function yy(n,t){return{$$typeof:Ho,type:n.type,key:t,ref:n.ref,props:n.props,_owner:n._owner}}function Ju(n){return typeof n=="object"&&n!==null&&n.$$typeof===Ho}function My(n){var t={"=":"=0",":":"=2"};return"$"+(""+n).replace(/[=:]/g,function(e){return t[e]})}var np=/\/+/g,ea=[];function rp(n,t,e,r){if(ea.length){var i=ea.pop();return i.result=n,i.keyPrefix=t,i.func=e,i.context=r,i.count=0,i}return{result:n,keyPrefix:t,func:e,context:r,count:0}}function ip(n){n.result=null,n.keyPrefix=null,n.func=null,n.context=null,n.count=0,10>ea.length&&ea.push(n)}function Ul(n,t,e,r){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case Ho:case ly:o=!0}}if(o)return e(r,n,t===""?"."+ll(n,0):t),1;if(o=0,t=t===""?".":t+":",Array.isArray(n))for(var s=0;s<n.length;s++){i=n[s];var a=t+ll(i,s);o+=Ul(i,a,e,r)}else if(n===null||typeof n!="object"?a=null:(a=Ih&&n[Ih]||n["@@iterator"],a=typeof a=="function"?a:null),typeof a=="function")for(n=a.call(n),s=0;!(i=n.next()).done;)i=i.value,a=t+ll(i,s++),o+=Ul(i,a,e,r);else if(i==="object")throw e=""+n,Error(Qo(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e,""));return o}function Yl(n,t,e){return n==null?0:Ul(n,"",t,e)}function ll(n,t){return typeof n=="object"&&n!==null&&n.key!=null?My(n.key):t.toString(36)}function Ty(n,t){n.func.call(n.context,t,n.count++)}function Iy(n,t,e){var r=n.result,i=n.keyPrefix;n=n.func.call(n.context,t,n.count++),Array.isArray(n)?Fl(n,r,e,function(o){return o}):n!=null&&(Ju(n)&&(n=yy(n,i+(!n.key||t&&t.key===n.key?"":(""+n.key).replace(np,"$&/")+"/")+e)),r.push(n))}function Fl(n,t,e,r,i){var o="";e!=null&&(o=(""+e).replace(np,"$&/")+"/"),t=rp(t,o,r,i),Yl(n,Iy,t),ip(t)}var op={current:null};function mr(){var n=op.current;if(n===null)throw Error(Qo(321));return n}var wy={ReactCurrentDispatcher:op,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:Ku,IsSomeRendererActing:{current:!1},assign:Hu};pe.Children={map:function(n,t,e){if(n==null)return n;var r=[];return Fl(n,r,null,t,e),r},forEach:function(n,t,e){if(n==null)return n;t=rp(null,null,t,e),Yl(n,Ty,t),ip(t)},count:function(n){return Yl(n,function(){return null},null)},toArray:function(n){var t=[];return Fl(n,t,null,function(e){return e}),t},only:function(n){if(!Ju(n))throw Error(Qo(143));return n}};pe.Component=Qi;pe.Fragment=uy;pe.Profiler=hy;pe.PureComponent=Qu;pe.StrictMode=cy;pe.Suspense=gy;pe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=wy;pe.cloneElement=function(n,t,e){if(n==null)throw Error(Qo(267,n));var r=Hu({},n.props),i=n.key,o=n.ref,s=n._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,s=Ku.current),t.key!==void 0&&(i=""+t.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in t)_d.call(t,l)&&!tp.hasOwnProperty(l)&&(r[l]=t[l]===void 0&&a!==void 0?a[l]:t[l])}var l=arguments.length-2;if(l===1)r.children=e;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:Ho,type:n.type,key:i,ref:o,props:r,_owner:s}};pe.createContext=function(n,t){return t===void 0&&(t=null),n={$$typeof:dy,_calculateChangedBits:t,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null},n.Provider={$$typeof:fy,_context:n},n.Consumer=n};pe.createElement=ep;pe.createFactory=function(n){var t=ep.bind(null,n);return t.type=n,t};pe.createRef=function(){return{current:null}};pe.forwardRef=function(n){return{$$typeof:py,render:n}};pe.isValidElement=Ju;pe.lazy=function(n){return{$$typeof:vy,_ctor:n,_status:-1,_result:null}};pe.memo=function(n,t){return{$$typeof:my,type:n,compare:t===void 0?null:t}};pe.useCallback=function(n,t){return mr().useCallback(n,t)};pe.useContext=function(n,t){return mr().useContext(n,t)};pe.useDebugValue=function(){};pe.useEffect=function(n,t){return mr().useEffect(n,t)};pe.useImperativeHandle=function(n,t,e){return mr().useImperativeHandle(n,t,e)};pe.useLayoutEffect=function(n,t){return mr().useLayoutEffect(n,t)};pe.useMemo=function(n,t){return mr().useMemo(n,t)};pe.useReducer=function(n,t,e){return mr().useReducer(n,t,e)};pe.useRef=function(n){return mr().useRef(n)};pe.useState=function(n){return mr().useState(n)};pe.version="16.14.0";Zd.exports=pe;var It=Zd.exports;const ut=Hi(It);var sp={exports:{}},Pn={},ap={exports:{}},lp={};/** @license React v0.19.1
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){var t,e,r,i,o;if(typeof window>"u"||typeof MessageChannel!="function"){var s=null,a=null,l=function(){if(s!==null)try{var at=n.unstable_now();s(!0,at),s=null}catch(dt){throw setTimeout(l,0),dt}},u=Date.now();n.unstable_now=function(){return Date.now()-u},t=function(at){s!==null?setTimeout(t,0,at):(s=at,setTimeout(l,0))},e=function(at,dt){a=setTimeout(at,dt)},r=function(){clearTimeout(a)},i=function(){return!1},o=n.unstable_forceFrameRate=function(){}}else{var p=window.performance,c=window.Date,g=window.setTimeout,v=window.clearTimeout;if(typeof console<"u"){var I=window.cancelAnimationFrame;typeof window.requestAnimationFrame!="function"&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),typeof I!="function"&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills")}if(typeof p=="object"&&typeof p.now=="function")n.unstable_now=function(){return p.now()};else{var w=c.now();n.unstable_now=function(){return c.now()-w}}var y=!1,T=null,h=-1,m=5,d=0;i=function(){return n.unstable_now()>=d},o=function(){},n.unstable_forceFrameRate=function(at){0>at||125<at?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):m=0<at?Math.floor(1e3/at):5};var M=new MessageChannel,x=M.port2;M.port1.onmessage=function(){if(T!==null){var at=n.unstable_now();d=at+m;try{T(!0,at)?x.postMessage(null):(y=!1,T=null)}catch(dt){throw x.postMessage(null),dt}}else y=!1},t=function(at){T=at,y||(y=!0,x.postMessage(null))},e=function(at,dt){h=g(function(){at(n.unstable_now())},dt)},r=function(){v(h),h=-1}}function E(at,dt){var it=at.length;at.push(dt);t:for(;;){var ft=it-1>>>1,wt=at[ft];if(wt!==void 0&&0<N(wt,dt))at[ft]=dt,at[it]=wt,it=ft;else break t}}function P(at){return at=at[0],at===void 0?null:at}function R(at){var dt=at[0];if(dt!==void 0){var it=at.pop();if(it!==dt){at[0]=it;t:for(var ft=0,wt=at.length;ft<wt;){var U=2*(ft+1)-1,Y=at[U],K=U+1,et=at[K];if(Y!==void 0&&0>N(Y,it))et!==void 0&&0>N(et,Y)?(at[ft]=et,at[K]=it,ft=K):(at[ft]=Y,at[U]=it,ft=U);else if(et!==void 0&&0>N(et,it))at[ft]=et,at[K]=it,ft=K;else break t}}return dt}return null}function N(at,dt){var it=at.sortIndex-dt.sortIndex;return it!==0?it:at.id-dt.id}var b=[],j=[],O=1,L=null,k=3,H=!1,Q=!1,_=!1;function st(at){for(var dt=P(j);dt!==null;){if(dt.callback===null)R(j);else if(dt.startTime<=at)R(j),dt.sortIndex=dt.expirationTime,E(b,dt);else break;dt=P(j)}}function F(at){if(_=!1,st(at),!Q)if(P(b)!==null)Q=!0,t(Z);else{var dt=P(j);dt!==null&&e(F,dt.startTime-at)}}function Z(at,dt){Q=!1,_&&(_=!1,r()),H=!0;var it=k;try{for(st(dt),L=P(b);L!==null&&(!(L.expirationTime>dt)||at&&!i());){var ft=L.callback;if(ft!==null){L.callback=null,k=L.priorityLevel;var wt=ft(L.expirationTime<=dt);dt=n.unstable_now(),typeof wt=="function"?L.callback=wt:L===P(b)&&R(b),st(dt)}else R(b);L=P(b)}if(L!==null)var U=!0;else{var Y=P(j);Y!==null&&e(F,Y.startTime-dt),U=!1}return U}finally{L=null,k=it,H=!1}}function tt(at){switch(at){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;default:return 5e3}}var ct=o;n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(at){at.callback=null},n.unstable_continueExecution=function(){Q||H||(Q=!0,t(Z))},n.unstable_getCurrentPriorityLevel=function(){return k},n.unstable_getFirstCallbackNode=function(){return P(b)},n.unstable_next=function(at){switch(k){case 1:case 2:case 3:var dt=3;break;default:dt=k}var it=k;k=dt;try{return at()}finally{k=it}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=ct,n.unstable_runWithPriority=function(at,dt){switch(at){case 1:case 2:case 3:case 4:case 5:break;default:at=3}var it=k;k=at;try{return dt()}finally{k=it}},n.unstable_scheduleCallback=function(at,dt,it){var ft=n.unstable_now();if(typeof it=="object"&&it!==null){var wt=it.delay;wt=typeof wt=="number"&&0<wt?ft+wt:ft,it=typeof it.timeout=="number"?it.timeout:tt(at)}else it=tt(at),wt=ft;return it=wt+it,at={id:O++,callback:dt,priorityLevel:at,startTime:wt,expirationTime:it,sortIndex:-1},wt>ft?(at.sortIndex=wt,E(j,at),P(b)===null&&at===P(j)&&(_?r():_=!0,e(F,wt-ft))):(at.sortIndex=it,E(b,at),Q||H||(Q=!0,t(Z))),at},n.unstable_shouldYield=function(){var at=n.unstable_now();st(at);var dt=P(b);return dt!==L&&L!==null&&dt!==null&&dt.callback!==null&&dt.startTime<=at&&dt.expirationTime<L.expirationTime||i()},n.unstable_wrapCallback=function(at){var dt=k;return function(){var it=k;k=dt;try{return at.apply(this,arguments)}finally{k=it}}}})(lp);ap.exports=lp;var Sy=ap.exports;/** @license React v16.14.0
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ra=It,en=Ad,Xe=Sy;function Ut(n){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+n,e=1;e<arguments.length;e++)t+="&args[]="+encodeURIComponent(arguments[e]);return"Minified React error #"+n+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!Ra)throw Error(Ut(227));function xy(n,t,e,r,i,o,s,a,l){var u=Array.prototype.slice.call(arguments,3);try{t.apply(e,u)}catch(p){this.onError(p)}}var xo=!1,na=null,ra=!1,Vl=null,Cy={onError:function(n){xo=!0,na=n}};function Ey(n,t,e,r,i,o,s,a,l){xo=!1,na=null,xy.apply(Cy,arguments)}function Py(n,t,e,r,i,o,s,a,l){if(Ey.apply(this,arguments),xo){if(xo){var u=na;xo=!1,na=null}else throw Error(Ut(198));ra||(ra=!0,Vl=u)}}var qu=null,up=null,cp=null;function wh(n,t,e){var r=n.type||"unknown-event";n.currentTarget=cp(e),Py(r,t,void 0,n),n.currentTarget=null}var ia=null,Ei={};function hp(){if(ia)for(var n in Ei){var t=Ei[n],e=ia.indexOf(n);if(!(-1<e))throw Error(Ut(96,n));if(!oa[e]){if(!t.extractEvents)throw Error(Ut(97,n));oa[e]=t,e=t.eventTypes;for(var r in e){var i=void 0,o=e[r],s=t,a=r;if(Xl.hasOwnProperty(a))throw Error(Ut(99,a));Xl[a]=o;var l=o.phasedRegistrationNames;if(l){for(i in l)l.hasOwnProperty(i)&&Sh(l[i],s,a);i=!0}else o.registrationName?(Sh(o.registrationName,s,a),i=!0):i=!1;if(!i)throw Error(Ut(98,r,n))}}}}function Sh(n,t,e){if(Yi[n])throw Error(Ut(100,n));Yi[n]=t,_u[n]=t.eventTypes[e].dependencies}var oa=[],Xl={},Yi={},_u={};function fp(n){var t=!1,e;for(e in n)if(n.hasOwnProperty(e)){var r=n[e];if(!Ei.hasOwnProperty(e)||Ei[e]!==r){if(Ei[e])throw Error(Ut(102,e));Ei[e]=r,t=!0}}t&&hp()}var Ur=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Gl=null,ji=null,zi=null;function xh(n){if(n=up(n)){if(typeof Gl!="function")throw Error(Ut(280));var t=n.stateNode;t&&(t=qu(t),Gl(n.stateNode,n.type,t))}}function dp(n){ji?zi?zi.push(n):zi=[n]:ji=n}function pp(){if(ji){var n=ji,t=zi;if(zi=ji=null,xh(n),t)for(n=0;n<t.length;n++)xh(t[n])}}function tc(n,t){return n(t)}function gp(n,t,e,r,i){return n(t,e,r,i)}function ec(){}var mp=tc,Kr=!1,ul=!1;function nc(){(ji!==null||zi!==null)&&(ec(),pp())}function vp(n,t,e){if(ul)return n(t,e);ul=!0;try{return mp(n,t,e)}finally{ul=!1,nc()}}var Ny=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Ch=Object.prototype.hasOwnProperty,Eh={},Ph={};function Ay(n){return Ch.call(Ph,n)?!0:Ch.call(Eh,n)?!1:Ny.test(n)?Ph[n]=!0:(Eh[n]=!0,!1)}function Dy(n,t,e,r){if(e!==null&&e.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:e!==null?!e.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function Ly(n,t,e,r){if(t===null||typeof t>"u"||Dy(n,t,e,r))return!0;if(r)return!1;if(e!==null)switch(e.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function rn(n,t,e,r,i,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=e,this.propertyName=n,this.type=t,this.sanitizeURL=o}var Ge={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Ge[n]=new rn(n,0,!1,n,null,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var t=n[0];Ge[t]=new rn(t,1,!1,n[1],null,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Ge[n]=new rn(n,2,!1,n.toLowerCase(),null,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Ge[n]=new rn(n,2,!1,n,null,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Ge[n]=new rn(n,3,!1,n.toLowerCase(),null,!1)});["checked","multiple","muted","selected"].forEach(function(n){Ge[n]=new rn(n,3,!0,n,null,!1)});["capture","download"].forEach(function(n){Ge[n]=new rn(n,4,!1,n,null,!1)});["cols","rows","size","span"].forEach(function(n){Ge[n]=new rn(n,6,!1,n,null,!1)});["rowSpan","start"].forEach(function(n){Ge[n]=new rn(n,5,!1,n.toLowerCase(),null,!1)});var rc=/[\-:]([a-z])/g;function ic(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var t=n.replace(rc,ic);Ge[t]=new rn(t,1,!1,n,null,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var t=n.replace(rc,ic);Ge[t]=new rn(t,1,!1,n,"http://www.w3.org/1999/xlink",!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var t=n.replace(rc,ic);Ge[t]=new rn(t,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1)});["tabIndex","crossOrigin"].forEach(function(n){Ge[n]=new rn(n,1,!1,n.toLowerCase(),null,!1)});Ge.xlinkHref=new rn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0);["src","href","action","formAction"].forEach(function(n){Ge[n]=new rn(n,1,!1,n.toLowerCase(),null,!0)});var zn=Ra.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;zn.hasOwnProperty("ReactCurrentDispatcher")||(zn.ReactCurrentDispatcher={current:null});zn.hasOwnProperty("ReactCurrentBatchConfig")||(zn.ReactCurrentBatchConfig={suspense:null});function oc(n,t,e,r){var i=Ge.hasOwnProperty(t)?Ge[t]:null,o=i!==null?i.type===0:r?!1:!(!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N");o||(Ly(t,e,i,r)&&(e=null),r||i===null?Ay(t)&&(e===null?n.removeAttribute(t):n.setAttribute(t,""+e)):i.mustUseProperty?n[i.propertyName]=e===null?i.type===3?!1:"":e:(t=i.attributeName,r=i.attributeNamespace,e===null?n.removeAttribute(t):(i=i.type,e=i===3||i===4&&e===!0?"":""+e,r?n.setAttributeNS(r,t,e):n.setAttribute(t,e))))}var Oy=/^(.*)[\\\/]/,cn=typeof Symbol=="function"&&Symbol.for,hs=cn?Symbol.for("react.element"):60103,Pi=cn?Symbol.for("react.portal"):60106,Hr=cn?Symbol.for("react.fragment"):60107,yp=cn?Symbol.for("react.strict_mode"):60108,Ds=cn?Symbol.for("react.profiler"):60114,Mp=cn?Symbol.for("react.provider"):60109,Tp=cn?Symbol.for("react.context"):60110,by=cn?Symbol.for("react.concurrent_mode"):60111,sc=cn?Symbol.for("react.forward_ref"):60112,Ls=cn?Symbol.for("react.suspense"):60113,$l=cn?Symbol.for("react.suspense_list"):60120,ac=cn?Symbol.for("react.memo"):60115,Ip=cn?Symbol.for("react.lazy"):60116,wp=cn?Symbol.for("react.block"):60121,Nh=typeof Symbol=="function"&&Symbol.iterator;function ao(n){return n===null||typeof n!="object"?null:(n=Nh&&n[Nh]||n["@@iterator"],typeof n=="function"?n:null)}function Ry(n){if(n._status===-1){n._status=0;var t=n._ctor;t=t(),n._result=t,t.then(function(e){n._status===0&&(e=e.default,n._status=1,n._result=e)},function(e){n._status===0&&(n._status=2,n._result=e)})}}function dr(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Hr:return"Fragment";case Pi:return"Portal";case Ds:return"Profiler";case yp:return"StrictMode";case Ls:return"Suspense";case $l:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Tp:return"Context.Consumer";case Mp:return"Context.Provider";case sc:var t=n.render;return t=t.displayName||t.name||"",n.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case ac:return dr(n.type);case wp:return dr(n.render);case Ip:if(n=n._status===1?n._result:null)return dr(n)}return null}function lc(n){var t="";do{t:switch(n.tag){case 3:case 4:case 6:case 7:case 10:case 9:var e="";break t;default:var r=n._debugOwner,i=n._debugSource,o=dr(n.type);e=null,r&&(e=dr(r.type)),r=o,o="",i?o=" (at "+i.fileName.replace(Oy,"")+":"+i.lineNumber+")":e&&(o=" (created by "+e+")"),e=`
    in `+(r||"Unknown")+o}t+=e,n=n.return}while(n);return t}function zr(n){switch(typeof n){case"boolean":case"number":case"object":case"string":case"undefined":return n;default:return""}}function Sp(n){var t=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function jy(n){var t=Sp(n)?"checked":"value",e=Object.getOwnPropertyDescriptor(n.constructor.prototype,t),r=""+n[t];if(!n.hasOwnProperty(t)&&typeof e<"u"&&typeof e.get=="function"&&typeof e.set=="function"){var i=e.get,o=e.set;return Object.defineProperty(n,t,{configurable:!0,get:function(){return i.call(this)},set:function(s){r=""+s,o.call(this,s)}}),Object.defineProperty(n,t,{enumerable:e.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){n._valueTracker=null,delete n[t]}}}}function fs(n){n._valueTracker||(n._valueTracker=jy(n))}function xp(n){if(!n)return!1;var t=n._valueTracker;if(!t)return!0;var e=t.getValue(),r="";return n&&(r=Sp(n)?n.checked?"true":"false":n.value),n=r,n!==e?(t.setValue(n),!0):!1}function Hl(n,t){var e=t.checked;return en({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:e??n._wrapperState.initialChecked})}function Ah(n,t){var e=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;e=zr(t.value!=null?t.value:e),n._wrapperState={initialChecked:r,initialValue:e,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Cp(n,t){t=t.checked,t!=null&&oc(n,"checked",t,!1)}function Ql(n,t){Cp(n,t);var e=zr(t.value),r=t.type;if(e!=null)r==="number"?(e===0&&n.value===""||n.value!=e)&&(n.value=""+e):n.value!==""+e&&(n.value=""+e);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}t.hasOwnProperty("value")?Zl(n,t.type,e):t.hasOwnProperty("defaultValue")&&Zl(n,t.type,zr(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(n.defaultChecked=!!t.defaultChecked)}function Dh(n,t,e){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+n._wrapperState.initialValue,e||t===n.value||(n.value=t),n.defaultValue=t}e=n.name,e!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,e!==""&&(n.name=e)}function Zl(n,t,e){(t!=="number"||n.ownerDocument.activeElement!==n)&&(e==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+e&&(n.defaultValue=""+e))}function zy(n){var t="";return Ra.Children.forEach(n,function(e){e!=null&&(t+=e)}),t}function Kl(n,t){return n=en({children:void 0},t),(t=zy(t.children))&&(n.children=t),n}function ki(n,t,e,r){if(n=n.options,t){t={};for(var i=0;i<e.length;i++)t["$"+e[i]]=!0;for(e=0;e<n.length;e++)i=t.hasOwnProperty("$"+n[e].value),n[e].selected!==i&&(n[e].selected=i),i&&r&&(n[e].defaultSelected=!0)}else{for(e=""+zr(e),t=null,i=0;i<n.length;i++){if(n[i].value===e){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}t!==null||n[i].disabled||(t=n[i])}t!==null&&(t.selected=!0)}}function Jl(n,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Ut(91));return en({},t,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function Lh(n,t){var e=t.value;if(e==null){if(e=t.children,t=t.defaultValue,e!=null){if(t!=null)throw Error(Ut(92));if(Array.isArray(e)){if(!(1>=e.length))throw Error(Ut(93));e=e[0]}t=e}t==null&&(t=""),e=t}n._wrapperState={initialValue:zr(e)}}function Ep(n,t){var e=zr(t.value),r=zr(t.defaultValue);e!=null&&(e=""+e,e!==n.value&&(n.value=e),t.defaultValue==null&&n.defaultValue!==e&&(n.defaultValue=e)),r!=null&&(n.defaultValue=""+r)}function Oh(n){var t=n.textContent;t===n._wrapperState.initialValue&&t!==""&&t!==null&&(n.value=t)}var Pp={html:"http://www.w3.org/1999/xhtml",svg:"http://www.w3.org/2000/svg"};function Np(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ql(n,t){return n==null||n==="http://www.w3.org/1999/xhtml"?Np(t):n==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var ds,Ap=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,e,r,i){MSApp.execUnsafeLocalFunction(function(){return n(t,e,r,i)})}:n}(function(n,t){if(n.namespaceURI!==Pp.svg||"innerHTML"in n)n.innerHTML=t;else{for(ds=ds||document.createElement("div"),ds.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ds.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;t.firstChild;)n.appendChild(t.firstChild)}});function Ro(n,t){if(t){var e=n.firstChild;if(e&&e===n.lastChild&&e.nodeType===3){e.nodeValue=t;return}}n.textContent=t}function ps(n,t){var e={};return e[n.toLowerCase()]=t.toLowerCase(),e["Webkit"+n]="webkit"+t,e["Moz"+n]="moz"+t,e}var Ni={animationend:ps("Animation","AnimationEnd"),animationiteration:ps("Animation","AnimationIteration"),animationstart:ps("Animation","AnimationStart"),transitionend:ps("Transition","TransitionEnd")},cl={},Dp={};Ur&&(Dp=document.createElement("div").style,"AnimationEvent"in window||(delete Ni.animationend.animation,delete Ni.animationiteration.animation,delete Ni.animationstart.animation),"TransitionEvent"in window||delete Ni.transitionend.transition);function ja(n){if(cl[n])return cl[n];if(!Ni[n])return n;var t=Ni[n],e;for(e in t)if(t.hasOwnProperty(e)&&e in Dp)return cl[n]=t[e];return n}var Lp=ja("animationend"),Op=ja("animationiteration"),bp=ja("animationstart"),Rp=ja("transitionend"),Mo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),bh=new(typeof WeakMap=="function"?WeakMap:Map);function uc(n){var t=bh.get(n);return t===void 0&&(t=new Map,bh.set(n,t)),t}function pi(n){var t=n,e=n;if(n.alternate)for(;t.return;)t=t.return;else{n=t;do t=n,t.effectTag&1026&&(e=t.return),n=t.return;while(n)}return t.tag===3?e:null}function jp(n){if(n.tag===13){var t=n.memoizedState;if(t===null&&(n=n.alternate,n!==null&&(t=n.memoizedState)),t!==null)return t.dehydrated}return null}function Rh(n){if(pi(n)!==n)throw Error(Ut(188))}function ky(n){var t=n.alternate;if(!t){if(t=pi(n),t===null)throw Error(Ut(188));return t!==n?null:n}for(var e=n,r=t;;){var i=e.return;if(i===null)break;var o=i.alternate;if(o===null){if(r=i.return,r!==null){e=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===e)return Rh(i),n;if(o===r)return Rh(i),t;o=o.sibling}throw Error(Ut(188))}if(e.return!==r.return)e=i,r=o;else{for(var s=!1,a=i.child;a;){if(a===e){s=!0,e=i,r=o;break}if(a===r){s=!0,r=i,e=o;break}a=a.sibling}if(!s){for(a=o.child;a;){if(a===e){s=!0,e=o,r=i;break}if(a===r){s=!0,r=o,e=i;break}a=a.sibling}if(!s)throw Error(Ut(189))}}if(e.alternate!==r)throw Error(Ut(190))}if(e.tag!==3)throw Error(Ut(188));return e.stateNode.current===e?n:t}function zp(n){if(n=ky(n),!n)return null;for(var t=n;;){if(t.tag===5||t.tag===6)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===n)break;for(;!t.sibling;){if(!t.return||t.return===n)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function Fi(n,t){if(t==null)throw Error(Ut(30));return n==null?t:Array.isArray(n)?Array.isArray(t)?(n.push.apply(n,t),n):(n.push(t),n):Array.isArray(t)?[n].concat(t):[n,t]}function cc(n,t,e){Array.isArray(n)?n.forEach(t,e):n&&t.call(e,n)}var lo=null;function By(n){if(n){var t=n._dispatchListeners,e=n._dispatchInstances;if(Array.isArray(t))for(var r=0;r<t.length&&!n.isPropagationStopped();r++)wh(n,t[r],e[r]);else t&&wh(n,t,e);n._dispatchListeners=null,n._dispatchInstances=null,n.isPersistent()||n.constructor.release(n)}}function za(n){if(n!==null&&(lo=Fi(lo,n)),n=lo,lo=null,n){if(cc(n,By),lo)throw Error(Ut(95));if(ra)throw n=Vl,ra=!1,Vl=null,n}}function hc(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}function kp(n){if(!Ur)return!1;n="on"+n;var t=n in document;return t||(t=document.createElement("div"),t.setAttribute(n,"return;"),t=typeof t[n]=="function"),t}var sa=[];function Bp(n){n.topLevelType=null,n.nativeEvent=null,n.targetInst=null,n.ancestors.length=0,10>sa.length&&sa.push(n)}function Wp(n,t,e,r){if(sa.length){var i=sa.pop();return i.topLevelType=n,i.eventSystemFlags=r,i.nativeEvent=t,i.targetInst=e,i}return{topLevelType:n,eventSystemFlags:r,nativeEvent:t,targetInst:e,ancestors:[]}}function Up(n){var t=n.targetInst,e=t;do{if(!e){n.ancestors.push(e);break}var r=e;if(r.tag===3)r=r.stateNode.containerInfo;else{for(;r.return;)r=r.return;r=r.tag!==3?null:r.stateNode.containerInfo}if(!r)break;t=e.tag,t!==5&&t!==6||n.ancestors.push(e),e=Ko(r)}while(e);for(e=0;e<n.ancestors.length;e++){t=n.ancestors[e];var i=hc(n.nativeEvent);r=n.topLevelType;var o=n.nativeEvent,s=n.eventSystemFlags;e===0&&(s|=64);for(var a=null,l=0;l<oa.length;l++){var u=oa[l];u&&(u=u.extractEvents(r,t,o,i,s))&&(a=Fi(a,u))}za(a)}}function _l(n,t,e){if(!e.has(n)){switch(n){case"scroll":To(t,"scroll",!0);break;case"focus":case"blur":To(t,"focus",!0),To(t,"blur",!0),e.set("blur",null),e.set("focus",null);break;case"cancel":case"close":kp(n)&&To(t,n,!0);break;case"invalid":case"submit":case"reset":break;default:Mo.indexOf(n)===-1&&Ce(n,t)}e.set(n,null)}}var Yp,fc,Fp,tu=!1,$n=[],Nr=null,Ar=null,Dr=null,jo=new Map,zo=new Map,uo=[],eu="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),Wy="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function Uy(n,t){var e=uc(t);eu.forEach(function(r){_l(r,t,e)}),Wy.forEach(function(r){_l(r,t,e)})}function nu(n,t,e,r,i){return{blockedOn:n,topLevelType:t,eventSystemFlags:e|32,nativeEvent:i,container:r}}function jh(n,t){switch(n){case"focus":case"blur":Nr=null;break;case"dragenter":case"dragleave":Ar=null;break;case"mouseover":case"mouseout":Dr=null;break;case"pointerover":case"pointerout":jo.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":zo.delete(t.pointerId)}}function co(n,t,e,r,i,o){return n===null||n.nativeEvent!==o?(n=nu(t,e,r,i,o),t!==null&&(t=Jo(t),t!==null&&fc(t)),n):(n.eventSystemFlags|=r,n)}function Yy(n,t,e,r,i){switch(t){case"focus":return Nr=co(Nr,n,t,e,r,i),!0;case"dragenter":return Ar=co(Ar,n,t,e,r,i),!0;case"mouseover":return Dr=co(Dr,n,t,e,r,i),!0;case"pointerover":var o=i.pointerId;return jo.set(o,co(jo.get(o)||null,n,t,e,r,i)),!0;case"gotpointercapture":return o=i.pointerId,zo.set(o,co(zo.get(o)||null,n,t,e,r,i)),!0}return!1}function Fy(n){var t=Ko(n.target);if(t!==null){var e=pi(t);if(e!==null){if(t=e.tag,t===13){if(t=jp(e),t!==null){n.blockedOn=t,Xe.unstable_runWithPriority(n.priority,function(){Fp(e)});return}}else if(t===3&&e.stateNode.hydrate){n.blockedOn=e.tag===3?e.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Os(n){if(n.blockedOn!==null)return!1;var t=gc(n.topLevelType,n.eventSystemFlags,n.container,n.nativeEvent);if(t!==null){var e=Jo(t);return e!==null&&fc(e),n.blockedOn=t,!1}return!0}function zh(n,t,e){Os(n)&&e.delete(t)}function Vy(){for(tu=!1;0<$n.length;){var n=$n[0];if(n.blockedOn!==null){n=Jo(n.blockedOn),n!==null&&Yp(n);break}var t=gc(n.topLevelType,n.eventSystemFlags,n.container,n.nativeEvent);t!==null?n.blockedOn=t:$n.shift()}Nr!==null&&Os(Nr)&&(Nr=null),Ar!==null&&Os(Ar)&&(Ar=null),Dr!==null&&Os(Dr)&&(Dr=null),jo.forEach(zh),zo.forEach(zh)}function ho(n,t){n.blockedOn===t&&(n.blockedOn=null,tu||(tu=!0,Xe.unstable_scheduleCallback(Xe.unstable_NormalPriority,Vy)))}function Vp(n){function t(i){return ho(i,n)}if(0<$n.length){ho($n[0],n);for(var e=1;e<$n.length;e++){var r=$n[e];r.blockedOn===n&&(r.blockedOn=null)}}for(Nr!==null&&ho(Nr,n),Ar!==null&&ho(Ar,n),Dr!==null&&ho(Dr,n),jo.forEach(t),zo.forEach(t),e=0;e<uo.length;e++)r=uo[e],r.blockedOn===n&&(r.blockedOn=null);for(;0<uo.length&&(e=uo[0],e.blockedOn===null);)Fy(e),e.blockedOn===null&&uo.shift()}var Xp={},Gp=new Map,dc=new Map,Xy=["abort","abort",Lp,"animationEnd",Op,"animationIteration",bp,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Rp,"transitionEnd","waiting","waiting"];function pc(n,t){for(var e=0;e<n.length;e+=2){var r=n[e],i=n[e+1],o="on"+(i[0].toUpperCase()+i.slice(1));o={phasedRegistrationNames:{bubbled:o,captured:o+"Capture"},dependencies:[r],eventPriority:t},dc.set(r,t),Gp.set(r,o),Xp[i]=o}}pc("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0);pc("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);pc(Xy,2);for(var kh="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),hl=0;hl<kh.length;hl++)dc.set(kh[hl],0);var Gy=Xe.unstable_UserBlockingPriority,$y=Xe.unstable_runWithPriority,bs=!0;function Ce(n,t){To(t,n,!1)}function To(n,t,e){var r=dc.get(t);switch(r===void 0?2:r){case 0:r=Hy.bind(null,t,1,n);break;case 1:r=Qy.bind(null,t,1,n);break;default:r=ka.bind(null,t,1,n)}e?n.addEventListener(t,r,!0):n.addEventListener(t,r,!1)}function Hy(n,t,e,r){Kr||ec();var i=ka,o=Kr;Kr=!0;try{gp(i,n,t,e,r)}finally{(Kr=o)||nc()}}function Qy(n,t,e,r){$y(Gy,ka.bind(null,n,t,e,r))}function ka(n,t,e,r){if(bs)if(0<$n.length&&-1<eu.indexOf(n))n=nu(null,n,t,e,r),$n.push(n);else{var i=gc(n,t,e,r);if(i===null)jh(n,r);else if(-1<eu.indexOf(n))n=nu(i,n,t,e,r),$n.push(n);else if(!Yy(i,n,t,e,r)){jh(n,r),n=Wp(n,r,null,t);try{vp(Up,n)}finally{Bp(n)}}}}function gc(n,t,e,r){if(e=hc(r),e=Ko(e),e!==null){var i=pi(e);if(i===null)e=null;else{var o=i.tag;if(o===13){if(e=jp(i),e!==null)return e;e=null}else if(o===3){if(i.stateNode.hydrate)return i.tag===3?i.stateNode.containerInfo:null;e=null}else i!==e&&(e=null)}}n=Wp(n,r,e,t);try{vp(Up,n)}finally{Bp(n)}return null}var Co={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Zy=["Webkit","ms","Moz","O"];Object.keys(Co).forEach(function(n){Zy.forEach(function(t){t=t+n.charAt(0).toUpperCase()+n.substring(1),Co[t]=Co[n]})});function $p(n,t,e){return t==null||typeof t=="boolean"||t===""?"":e||typeof t!="number"||t===0||Co.hasOwnProperty(n)&&Co[n]?(""+t).trim():t+"px"}function Hp(n,t){n=n.style;for(var e in t)if(t.hasOwnProperty(e)){var r=e.indexOf("--")===0,i=$p(e,t[e],r);e==="float"&&(e="cssFloat"),r?n.setProperty(e,i):n[e]=i}}var Ky=en({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ru(n,t){if(t){if(Ky[n]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Ut(137,n,""));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Ut(60));if(!(typeof t.dangerouslySetInnerHTML=="object"&&"__html"in t.dangerouslySetInnerHTML))throw Error(Ut(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Ut(62,""))}}function iu(n,t){if(n.indexOf("-")===-1)return typeof t.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Bh=Pp.html;function ir(n,t){n=n.nodeType===9||n.nodeType===11?n:n.ownerDocument;var e=uc(n);t=_u[t];for(var r=0;r<t.length;r++)_l(t[r],n,e)}function aa(){}function ou(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Wh(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Uh(n,t){var e=Wh(n);n=0;for(var r;e;){if(e.nodeType===3){if(r=n+e.textContent.length,n<=t&&r>=t)return{node:e,offset:t-n};n=r}t:{for(;e;){if(e.nextSibling){e=e.nextSibling;break t}e=e.parentNode}e=void 0}e=Wh(e)}}function Qp(n,t){return n&&t?n===t?!0:n&&n.nodeType===3?!1:t&&t.nodeType===3?Qp(n,t.parentNode):"contains"in n?n.contains(t):n.compareDocumentPosition?!!(n.compareDocumentPosition(t)&16):!1:!1}function Yh(){for(var n=window,t=ou();t instanceof n.HTMLIFrameElement;){try{var e=typeof t.contentWindow.location.href=="string"}catch{e=!1}if(e)n=t.contentWindow;else break;t=ou(n.document)}return t}function su(n){var t=n&&n.nodeName&&n.nodeName.toLowerCase();return t&&(t==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||t==="textarea"||n.contentEditable==="true")}var Zp="$",Kp="/$",mc="$?",vc="$!",fl=null,dl=null;function Jp(n,t){switch(n){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function au(n,t){return n==="textarea"||n==="option"||n==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var pl=typeof setTimeout=="function"?setTimeout:void 0,Jy=typeof clearTimeout=="function"?clearTimeout:void 0;function Bi(n){for(;n!=null;n=n.nextSibling){var t=n.nodeType;if(t===1||t===3)break}return n}function Fh(n){n=n.previousSibling;for(var t=0;n;){if(n.nodeType===8){var e=n.data;if(e===Zp||e===vc||e===mc){if(t===0)return n;t--}else e===Kp&&t++}n=n.previousSibling}return null}var yc=Math.random().toString(36).slice(2),wr="__reactInternalInstance$"+yc,la="__reactEventHandlers$"+yc,Zo="__reactContainere$"+yc;function Ko(n){var t=n[wr];if(t)return t;for(var e=n.parentNode;e;){if(t=e[Zo]||e[wr]){if(e=t.alternate,t.child!==null||e!==null&&e.child!==null)for(n=Fh(n);n!==null;){if(e=n[wr])return e;n=Fh(n)}return t}n=e,e=n.parentNode}return null}function Jo(n){return n=n[wr]||n[Zo],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function ui(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Ut(33))}function Mc(n){return n[la]||null}function or(n){do n=n.return;while(n&&n.tag!==5);return n||null}function qp(n,t){var e=n.stateNode;if(!e)return null;var r=qu(e);if(!r)return null;e=r[t];t:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break t;default:n=!1}if(n)return null;if(e&&typeof e!="function")throw Error(Ut(231,t,typeof e));return e}function Vh(n,t,e){(t=qp(n,e.dispatchConfig.phasedRegistrationNames[t]))&&(e._dispatchListeners=Fi(e._dispatchListeners,t),e._dispatchInstances=Fi(e._dispatchInstances,n))}function qy(n){if(n&&n.dispatchConfig.phasedRegistrationNames){for(var t=n._targetInst,e=[];t;)e.push(t),t=or(t);for(t=e.length;0<t--;)Vh(e[t],"captured",n);for(t=0;t<e.length;t++)Vh(e[t],"bubbled",n)}}function lu(n,t,e){n&&e&&e.dispatchConfig.registrationName&&(t=qp(n,e.dispatchConfig.registrationName))&&(e._dispatchListeners=Fi(e._dispatchListeners,t),e._dispatchInstances=Fi(e._dispatchInstances,n))}function _y(n){n&&n.dispatchConfig.registrationName&&lu(n._targetInst,null,n)}function Vi(n){cc(n,qy)}var Sr=null,Tc=null,Rs=null;function _p(){if(Rs)return Rs;var n,t=Tc,e=t.length,r,i="value"in Sr?Sr.value:Sr.textContent,o=i.length;for(n=0;n<e&&t[n]===i[n];n++);var s=e-n;for(r=1;r<=s&&t[e-r]===i[o-r];r++);return Rs=i.slice(n,1<r?1-r:void 0)}function js(){return!0}function ua(){return!1}function Tn(n,t,e,r){this.dispatchConfig=n,this._targetInst=t,this.nativeEvent=e,n=this.constructor.Interface;for(var i in n)n.hasOwnProperty(i)&&((t=n[i])?this[i]=t(e):i==="target"?this.target=r:this[i]=e[i]);return this.isDefaultPrevented=(e.defaultPrevented!=null?e.defaultPrevented:e.returnValue===!1)?js:ua,this.isPropagationStopped=ua,this}en(Tn.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=js)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=js)},persist:function(){this.isPersistent=js},isPersistent:ua,destructor:function(){var n=this.constructor.Interface,t;for(t in n)this[t]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=ua,this._dispatchInstances=this._dispatchListeners=null}});Tn.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null};Tn.extend=function(n){function t(){}function e(){return r.apply(this,arguments)}var r=this;t.prototype=r.prototype;var i=new t;return en(i,e.prototype),e.prototype=i,e.prototype.constructor=e,e.Interface=en({},r.Interface,n),e.extend=r.extend,tg(e),e};tg(Tn);function tM(n,t,e,r){if(this.eventPool.length){var i=this.eventPool.pop();return this.call(i,n,t,e,r),i}return new this(n,t,e,r)}function eM(n){if(!(n instanceof this))throw Error(Ut(279));n.destructor(),10>this.eventPool.length&&this.eventPool.push(n)}function tg(n){n.eventPool=[],n.getPooled=tM,n.release=eM}var nM=Tn.extend({data:null}),rM=Tn.extend({data:null}),iM=[9,13,27,32],Ic=Ur&&"CompositionEvent"in window,Eo=null;Ur&&"documentMode"in document&&(Eo=document.documentMode);var oM=Ur&&"TextEvent"in window&&!Eo,eg=Ur&&(!Ic||Eo&&8<Eo&&11>=Eo),Xh=" ",nr={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},Gh=!1;function ng(n,t){switch(n){case"keyup":return iM.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function rg(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Ai=!1;function sM(n,t){switch(n){case"compositionend":return rg(t);case"keypress":return t.which!==32?null:(Gh=!0,Xh);case"textInput":return n=t.data,n===Xh&&Gh?null:n;default:return null}}function aM(n,t){if(Ai)return n==="compositionend"||!Ic&&ng(n,t)?(n=_p(),Rs=Tc=Sr=null,Ai=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return eg&&t.locale!=="ko"?null:t.data;default:return null}}var lM={eventTypes:nr,extractEvents:function(n,t,e,r){var i;if(Ic)t:{switch(n){case"compositionstart":var o=nr.compositionStart;break t;case"compositionend":o=nr.compositionEnd;break t;case"compositionupdate":o=nr.compositionUpdate;break t}o=void 0}else Ai?ng(n,e)&&(o=nr.compositionEnd):n==="keydown"&&e.keyCode===229&&(o=nr.compositionStart);return o?(eg&&e.locale!=="ko"&&(Ai||o!==nr.compositionStart?o===nr.compositionEnd&&Ai&&(i=_p()):(Sr=r,Tc="value"in Sr?Sr.value:Sr.textContent,Ai=!0)),o=nM.getPooled(o,t,e,r),i?o.data=i:(i=rg(e),i!==null&&(o.data=i)),Vi(o),i=o):i=null,(n=oM?sM(n,e):aM(n,e))?(t=rM.getPooled(nr.beforeInput,t,e,r),t.data=n,Vi(t)):t=null,i===null?t:t===null?i:[i,t]}},uM={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ig(n){var t=n&&n.nodeName&&n.nodeName.toLowerCase();return t==="input"?!!uM[n.type]:t==="textarea"}var og={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function sg(n,t,e){return n=Tn.getPooled(og.change,n,t,e),n.type="change",dp(e),Vi(n),n}var Po=null,ko=null;function cM(n){za(n)}function Ba(n){var t=ui(n);if(xp(t))return n}function hM(n,t){if(n==="change")return t}var uu=!1;Ur&&(uu=kp("input")&&(!document.documentMode||9<document.documentMode));function $h(){Po&&(Po.detachEvent("onpropertychange",ag),ko=Po=null)}function ag(n){if(n.propertyName==="value"&&Ba(ko))if(n=sg(ko,n,hc(n)),Kr)za(n);else{Kr=!0;try{tc(cM,n)}finally{Kr=!1,nc()}}}function fM(n,t,e){n==="focus"?($h(),Po=t,ko=e,Po.attachEvent("onpropertychange",ag)):n==="blur"&&$h()}function dM(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Ba(ko)}function pM(n,t){if(n==="click")return Ba(t)}function gM(n,t){if(n==="input"||n==="change")return Ba(t)}var mM={eventTypes:og,_isInputEventSupported:uu,extractEvents:function(n,t,e,r){var i=t?ui(t):window,o=i.nodeName&&i.nodeName.toLowerCase();if(o==="select"||o==="input"&&i.type==="file")var s=hM;else if(ig(i))if(uu)s=gM;else{s=dM;var a=fM}else(o=i.nodeName)&&o.toLowerCase()==="input"&&(i.type==="checkbox"||i.type==="radio")&&(s=pM);if(s&&(s=s(n,t)))return sg(s,e,r);a&&a(n,i,t),n==="blur"&&(n=i._wrapperState)&&n.controlled&&i.type==="number"&&Zl(i,"number",i.value)}},qo=Tn.extend({view:null,detail:null}),vM={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function yM(n){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(n):(n=vM[n])?!!t[n]:!1}function wc(){return yM}var Hh=0,Qh=0,Zh=!1,Kh=!1,_o=qo.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:wc,button:null,buttons:null,relatedTarget:function(n){return n.relatedTarget||(n.fromElement===n.srcElement?n.toElement:n.fromElement)},movementX:function(n){if("movementX"in n)return n.movementX;var t=Hh;return Hh=n.screenX,Zh?n.type==="mousemove"?n.screenX-t:0:(Zh=!0,0)},movementY:function(n){if("movementY"in n)return n.movementY;var t=Qh;return Qh=n.screenY,Kh?n.type==="mousemove"?n.screenY-t:0:(Kh=!0,0)}}),lg=_o.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),fo={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},MM={eventTypes:fo,extractEvents:function(n,t,e,r,i){var o=n==="mouseover"||n==="pointerover",s=n==="mouseout"||n==="pointerout";if(o&&!(i&32)&&(e.relatedTarget||e.fromElement)||!s&&!o)return null;if(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,s){if(s=t,t=(t=e.relatedTarget||e.toElement)?Ko(t):null,t!==null){var a=pi(t);(t!==a||t.tag!==5&&t.tag!==6)&&(t=null)}}else s=null;if(s===t)return null;if(n==="mouseout"||n==="mouseover")var l=_o,u=fo.mouseLeave,p=fo.mouseEnter,c="mouse";else(n==="pointerout"||n==="pointerover")&&(l=lg,u=fo.pointerLeave,p=fo.pointerEnter,c="pointer");if(n=s==null?o:ui(s),o=t==null?o:ui(t),u=l.getPooled(u,s,e,r),u.type=c+"leave",u.target=n,u.relatedTarget=o,e=l.getPooled(p,t,e,r),e.type=c+"enter",e.target=o,e.relatedTarget=n,r=s,c=t,r&&c)t:{for(l=r,p=c,s=0,n=l;n;n=or(n))s++;for(n=0,t=p;t;t=or(t))n++;for(;0<s-n;)l=or(l),s--;for(;0<n-s;)p=or(p),n--;for(;s--;){if(l===p||l===p.alternate)break t;l=or(l),p=or(p)}l=null}else l=null;for(p=l,l=[];r&&r!==p&&(s=r.alternate,!(s!==null&&s===p));)l.push(r),r=or(r);for(r=[];c&&c!==p&&(s=c.alternate,!(s!==null&&s===p));)r.push(c),c=or(c);for(c=0;c<l.length;c++)lu(l[c],"bubbled",u);for(c=r.length;0<c--;)lu(r[c],"captured",e);return i&64?[u,e]:[u]}};function TM(n,t){return n===t&&(n!==0||1/n===1/t)||n!==n&&t!==t}var ci=typeof Object.is=="function"?Object.is:TM,IM=Object.prototype.hasOwnProperty;function Bo(n,t){if(ci(n,t))return!0;if(typeof n!="object"||n===null||typeof t!="object"||t===null)return!1;var e=Object.keys(n),r=Object.keys(t);if(e.length!==r.length)return!1;for(r=0;r<e.length;r++)if(!IM.call(t,e[r])||!ci(n[e[r]],t[e[r]]))return!1;return!0}var wM=Ur&&"documentMode"in document&&11>=document.documentMode,ug={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},Di=null,cu=null,No=null,hu=!1;function Jh(n,t){var e=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;return hu||Di==null||Di!==ou(e)?null:(e=Di,"selectionStart"in e&&su(e)?e={start:e.selectionStart,end:e.selectionEnd}:(e=(e.ownerDocument&&e.ownerDocument.defaultView||window).getSelection(),e={anchorNode:e.anchorNode,anchorOffset:e.anchorOffset,focusNode:e.focusNode,focusOffset:e.focusOffset}),No&&Bo(No,e)?null:(No=e,n=Tn.getPooled(ug.select,cu,n,t),n.type="select",n.target=Di,Vi(n),n))}var SM={eventTypes:ug,extractEvents:function(n,t,e,r,i,o){if(i=o||(r.window===r?r.document:r.nodeType===9?r:r.ownerDocument),!(o=!i)){t:{i=uc(i),o=_u.onSelect;for(var s=0;s<o.length;s++)if(!i.has(o[s])){i=!1;break t}i=!0}o=!i}if(o)return null;switch(i=t?ui(t):window,n){case"focus":(ig(i)||i.contentEditable==="true")&&(Di=i,cu=t,No=null);break;case"blur":No=cu=Di=null;break;case"mousedown":hu=!0;break;case"contextmenu":case"mouseup":case"dragend":return hu=!1,Jh(e,r);case"selectionchange":if(wM)break;case"keydown":case"keyup":return Jh(e,r)}return null}},xM=Tn.extend({animationName:null,elapsedTime:null,pseudoElement:null}),CM=Tn.extend({clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),EM=qo.extend({relatedTarget:null});function zs(n){var t=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&t===13&&(n=13)):n=t,n===10&&(n=13),32<=n||n===13?n:0}var PM={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},NM={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},AM=qo.extend({key:function(n){if(n.key){var t=PM[n.key]||n.key;if(t!=="Unidentified")return t}return n.type==="keypress"?(n=zs(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?NM[n.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:wc,charCode:function(n){return n.type==="keypress"?zs(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?zs(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),DM=_o.extend({dataTransfer:null}),LM=qo.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:wc}),OM=Tn.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),bM=_o.extend({deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:null,deltaMode:null}),RM={eventTypes:Xp,extractEvents:function(n,t,e,r){var i=Gp.get(n);if(!i)return null;switch(n){case"keypress":if(zs(e)===0)return null;case"keydown":case"keyup":n=AM;break;case"blur":case"focus":n=EM;break;case"click":if(e.button===2)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":n=_o;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":n=DM;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":n=LM;break;case Lp:case Op:case bp:n=xM;break;case Rp:n=OM;break;case"scroll":n=qo;break;case"wheel":n=bM;break;case"copy":case"cut":case"paste":n=CM;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":n=lg;break;default:n=Tn}return t=n.getPooled(i,t,e,r),Vi(t),t}};if(ia)throw Error(Ut(101));ia=Array.prototype.slice.call("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" "));hp();var jM=Jo;qu=Mc;up=jM;cp=ui;fp({SimpleEventPlugin:RM,EnterLeaveEventPlugin:MM,ChangeEventPlugin:mM,SelectEventPlugin:SM,BeforeInputEventPlugin:lM});var fu=[],Li=-1;function Ie(n){0>Li||(n.current=fu[Li],fu[Li]=null,Li--)}function Le(n,t){Li++,fu[Li]=n.current,n.current=t}var kr={},Ke={current:kr},an={current:!1},hi=kr;function Xi(n,t){var e=n.type.contextTypes;if(!e)return kr;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in e)i[o]=t[o];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=t,n.__reactInternalMemoizedMaskedChildContext=i),i}function ln(n){return n=n.childContextTypes,n!=null}function ca(){Ie(an),Ie(Ke)}function qh(n,t,e){if(Ke.current!==kr)throw Error(Ut(168));Le(Ke,t),Le(an,e)}function cg(n,t,e){var r=n.stateNode;if(n=t.childContextTypes,typeof r.getChildContext!="function")return e;r=r.getChildContext();for(var i in r)if(!(i in n))throw Error(Ut(108,dr(t)||"Unknown",i));return en({},e,{},r)}function ks(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||kr,hi=Ke.current,Le(Ke,n),Le(an,an.current),!0}function _h(n,t,e){var r=n.stateNode;if(!r)throw Error(Ut(169));e?(n=cg(n,t,hi),r.__reactInternalMemoizedMergedChildContext=n,Ie(an),Ie(Ke),Le(Ke,n)):Ie(an),Le(an,e)}var zM=Xe.unstable_runWithPriority,Sc=Xe.unstable_scheduleCallback,hg=Xe.unstable_cancelCallback,tf=Xe.unstable_requestPaint,du=Xe.unstable_now,kM=Xe.unstable_getCurrentPriorityLevel,Wa=Xe.unstable_ImmediatePriority,fg=Xe.unstable_UserBlockingPriority,dg=Xe.unstable_NormalPriority,pg=Xe.unstable_LowPriority,gg=Xe.unstable_IdlePriority,mg={},BM=Xe.unstable_shouldYield,WM=tf!==void 0?tf:function(){},ur=null,Bs=null,gl=!1,ef=du(),xn=1e4>ef?du:function(){return du()-ef};function Ua(){switch(kM()){case Wa:return 99;case fg:return 98;case dg:return 97;case pg:return 96;case gg:return 95;default:throw Error(Ut(332))}}function vg(n){switch(n){case 99:return Wa;case 98:return fg;case 97:return dg;case 96:return pg;case 95:return gg;default:throw Error(Ut(332))}}function Br(n,t){return n=vg(n),zM(n,t)}function yg(n,t,e){return n=vg(n),Sc(n,t,e)}function nf(n){return ur===null?(ur=[n],Bs=Sc(Wa,Mg)):ur.push(n),mg}function qn(){if(Bs!==null){var n=Bs;Bs=null,hg(n)}Mg()}function Mg(){if(!gl&&ur!==null){gl=!0;var n=0;try{var t=ur;Br(99,function(){for(;n<t.length;n++){var e=t[n];do e=e(!0);while(e!==null)}}),ur=null}catch(e){throw ur!==null&&(ur=ur.slice(n+1)),Sc(Wa,qn),e}finally{gl=!1}}}function Ws(n,t,e){return e/=10,1073741821-(((1073741821-n+t/10)/e|0)+1)*e}function On(n,t){if(n&&n.defaultProps){t=en({},t),n=n.defaultProps;for(var e in n)t[e]===void 0&&(t[e]=n[e])}return t}var ha={current:null},fa=null,Oi=null,da=null;function xc(){da=Oi=fa=null}function Cc(n){var t=ha.current;Ie(ha),n.type._context._currentValue=t}function Tg(n,t){for(;n!==null;){var e=n.alternate;if(n.childExpirationTime<t)n.childExpirationTime=t,e!==null&&e.childExpirationTime<t&&(e.childExpirationTime=t);else if(e!==null&&e.childExpirationTime<t)e.childExpirationTime=t;else break;n=n.return}}function Wi(n,t){fa=n,da=Oi=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.expirationTime>=t&&(Hn=!0),n.firstContext=null)}function En(n,t){if(da!==n&&t!==!1&&t!==0)if((typeof t!="number"||t===1073741823)&&(da=n,t=1073741823),t={context:n,observedBits:t,next:null},Oi===null){if(fa===null)throw Error(Ut(308));Oi=t,fa.dependencies={expirationTime:0,firstContext:t,responders:null}}else Oi=Oi.next=t;return n._currentValue}var Ir=!1;function Ec(n){n.updateQueue={baseState:n.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function Pc(n,t){n=n.updateQueue,t.updateQueue===n&&(t.updateQueue={baseState:n.baseState,baseQueue:n.baseQueue,shared:n.shared,effects:n.effects})}function Lr(n,t){return n={expirationTime:n,suspenseConfig:t,tag:0,payload:null,callback:null,next:null},n.next=n}function Or(n,t){if(n=n.updateQueue,n!==null){n=n.shared;var e=n.pending;e===null?t.next=t:(t.next=e.next,e.next=t),n.pending=t}}function rf(n,t){var e=n.alternate;e!==null&&Pc(e,n),n=n.updateQueue,e=n.baseQueue,e===null?(n.baseQueue=t.next=t,t.next=t):(t.next=e.next,e.next=t)}function Wo(n,t,e,r){var i=n.updateQueue;Ir=!1;var o=i.baseQueue,s=i.shared.pending;if(s!==null){if(o!==null){var a=o.next;o.next=s.next,s.next=a}o=s,i.shared.pending=null,a=n.alternate,a!==null&&(a=a.updateQueue,a!==null&&(a.baseQueue=s))}if(o!==null){a=o.next;var l=i.baseState,u=0,p=null,c=null,g=null;if(a!==null){var v=a;do{if(s=v.expirationTime,s<r){var I={expirationTime:v.expirationTime,suspenseConfig:v.suspenseConfig,tag:v.tag,payload:v.payload,callback:v.callback,next:null};g===null?(c=g=I,p=l):g=g.next=I,s>u&&(u=s)}else{g!==null&&(g=g.next={expirationTime:1073741823,suspenseConfig:v.suspenseConfig,tag:v.tag,payload:v.payload,callback:v.callback,next:null}),Kg(s,v.suspenseConfig);t:{var w=n,y=v;switch(s=t,I=e,y.tag){case 1:if(w=y.payload,typeof w=="function"){l=w.call(I,l,s);break t}l=w;break t;case 3:w.effectTag=w.effectTag&-4097|64;case 0:if(w=y.payload,s=typeof w=="function"?w.call(I,l,s):w,s==null)break t;l=en({},l,s);break t;case 2:Ir=!0}}v.callback!==null&&(n.effectTag|=32,s=i.effects,s===null?i.effects=[v]:s.push(v))}if(v=v.next,v===null||v===a){if(s=i.shared.pending,s===null)break;v=o.next=s.next,s.next=a,i.baseQueue=o=s,i.shared.pending=null}}while(!0)}g===null?p=l:g.next=c,i.baseState=p,i.baseQueue=g,Ga(u),n.expirationTime=u,n.memoizedState=l}}function of(n,t,e){if(n=t.effects,t.effects=null,n!==null)for(t=0;t<n.length;t++){var r=n[t],i=r.callback;if(i!==null){if(r.callback=null,r=i,i=e,typeof r!="function")throw Error(Ut(191,r));r.call(i)}}}var Ao=zn.ReactCurrentBatchConfig,Ig=new Ra.Component().refs;function pa(n,t,e,r){t=n.memoizedState,e=e(r,t),e=e==null?t:en({},t,e),n.memoizedState=e,n.expirationTime===0&&(n.updateQueue.baseState=e)}var Ya={isMounted:function(n){return(n=n._reactInternalFiber)?pi(n)===n:!1},enqueueSetState:function(n,t,e){n=n._reactInternalFiber;var r=Kn(),i=Ao.suspense;r=ii(r,n,i),i=Lr(r,i),i.payload=t,e!=null&&(i.callback=e),Or(n,i),Rr(n,r)},enqueueReplaceState:function(n,t,e){n=n._reactInternalFiber;var r=Kn(),i=Ao.suspense;r=ii(r,n,i),i=Lr(r,i),i.tag=1,i.payload=t,e!=null&&(i.callback=e),Or(n,i),Rr(n,r)},enqueueForceUpdate:function(n,t){n=n._reactInternalFiber;var e=Kn(),r=Ao.suspense;e=ii(e,n,r),r=Lr(e,r),r.tag=2,t!=null&&(r.callback=t),Or(n,r),Rr(n,e)}};function sf(n,t,e,r,i,o,s){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,o,s):t.prototype&&t.prototype.isPureReactComponent?!Bo(e,r)||!Bo(i,o):!0}function wg(n,t,e){var r=!1,i=kr,o=t.contextType;return typeof o=="object"&&o!==null?o=En(o):(i=ln(t)?hi:Ke.current,r=t.contextTypes,o=(r=r!=null)?Xi(n,i):kr),t=new t(e,o),n.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Ya,n.stateNode=t,t._reactInternalFiber=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=o),t}function af(n,t,e,r){n=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(e,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(e,r),t.state!==n&&Ya.enqueueReplaceState(t,t.state,null)}function pu(n,t,e,r){var i=n.stateNode;i.props=e,i.state=n.memoizedState,i.refs=Ig,Ec(n);var o=t.contextType;typeof o=="object"&&o!==null?i.context=En(o):(o=ln(t)?hi:Ke.current,i.context=Xi(n,o)),Wo(n,e,i,r),i.state=n.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(pa(n,t,o,e),i.state=n.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(t=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),t!==i.state&&Ya.enqueueReplaceState(i,i.state,null),Wo(n,e,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.effectTag|=4)}var gs=Array.isArray;function po(n,t,e){if(n=e.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(e._owner){if(e=e._owner,e){if(e.tag!==1)throw Error(Ut(309));var r=e.stateNode}if(!r)throw Error(Ut(147,n));var i=""+n;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(o){var s=r.refs;s===Ig&&(s=r.refs={}),o===null?delete s[i]:s[i]=o},t._stringRef=i,t)}if(typeof n!="string")throw Error(Ut(284));if(!e._owner)throw Error(Ut(290,n))}return n}function ms(n,t){if(n.type!=="textarea")throw Error(Ut(31,Object.prototype.toString.call(t)==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":t,""))}function Sg(n){function t(y,T){if(n){var h=y.lastEffect;h!==null?(h.nextEffect=T,y.lastEffect=T):y.firstEffect=y.lastEffect=T,T.nextEffect=null,T.effectTag=8}}function e(y,T){if(!n)return null;for(;T!==null;)t(y,T),T=T.sibling;return null}function r(y,T){for(y=new Map;T!==null;)T.key!==null?y.set(T.key,T):y.set(T.index,T),T=T.sibling;return y}function i(y,T){return y=fi(y,T),y.index=0,y.sibling=null,y}function o(y,T,h){return y.index=h,n?(h=y.alternate,h!==null?(h=h.index,h<T?(y.effectTag=2,T):h):(y.effectTag=2,T)):T}function s(y){return n&&y.alternate===null&&(y.effectTag=2),y}function a(y,T,h,m){return T===null||T.tag!==6?(T=Il(h,y.mode,m),T.return=y,T):(T=i(T,h),T.return=y,T)}function l(y,T,h,m){return T!==null&&T.elementType===h.type?(m=i(T,h.props),m.ref=po(y,T,h),m.return=y,m):(m=Vs(h.type,h.key,h.props,null,y.mode,m),m.ref=po(y,T,h),m.return=y,m)}function u(y,T,h,m){return T===null||T.tag!==4||T.stateNode.containerInfo!==h.containerInfo||T.stateNode.implementation!==h.implementation?(T=wl(h,y.mode,m),T.return=y,T):(T=i(T,h.children||[]),T.return=y,T)}function p(y,T,h,m,d){return T===null||T.tag!==7?(T=Er(h,y.mode,m,d),T.return=y,T):(T=i(T,h),T.return=y,T)}function c(y,T,h){if(typeof T=="string"||typeof T=="number")return T=Il(""+T,y.mode,h),T.return=y,T;if(typeof T=="object"&&T!==null){switch(T.$$typeof){case hs:return h=Vs(T.type,T.key,T.props,null,y.mode,h),h.ref=po(y,null,T),h.return=y,h;case Pi:return T=wl(T,y.mode,h),T.return=y,T}if(gs(T)||ao(T))return T=Er(T,y.mode,h,null),T.return=y,T;ms(y,T)}return null}function g(y,T,h,m){var d=T!==null?T.key:null;if(typeof h=="string"||typeof h=="number")return d!==null?null:a(y,T,""+h,m);if(typeof h=="object"&&h!==null){switch(h.$$typeof){case hs:return h.key===d?h.type===Hr?p(y,T,h.props.children,m,d):l(y,T,h,m):null;case Pi:return h.key===d?u(y,T,h,m):null}if(gs(h)||ao(h))return d!==null?null:p(y,T,h,m,null);ms(y,h)}return null}function v(y,T,h,m,d){if(typeof m=="string"||typeof m=="number")return y=y.get(h)||null,a(T,y,""+m,d);if(typeof m=="object"&&m!==null){switch(m.$$typeof){case hs:return y=y.get(m.key===null?h:m.key)||null,m.type===Hr?p(T,y,m.props.children,d,m.key):l(T,y,m,d);case Pi:return y=y.get(m.key===null?h:m.key)||null,u(T,y,m,d)}if(gs(m)||ao(m))return y=y.get(h)||null,p(T,y,m,d,null);ms(T,m)}return null}function I(y,T,h,m){for(var d=null,M=null,x=T,E=T=0,P=null;x!==null&&E<h.length;E++){x.index>E?(P=x,x=null):P=x.sibling;var R=g(y,x,h[E],m);if(R===null){x===null&&(x=P);break}n&&x&&R.alternate===null&&t(y,x),T=o(R,T,E),M===null?d=R:M.sibling=R,M=R,x=P}if(E===h.length)return e(y,x),d;if(x===null){for(;E<h.length;E++)x=c(y,h[E],m),x!==null&&(T=o(x,T,E),M===null?d=x:M.sibling=x,M=x);return d}for(x=r(y,x);E<h.length;E++)P=v(x,y,E,h[E],m),P!==null&&(n&&P.alternate!==null&&x.delete(P.key===null?E:P.key),T=o(P,T,E),M===null?d=P:M.sibling=P,M=P);return n&&x.forEach(function(N){return t(y,N)}),d}function w(y,T,h,m){var d=ao(h);if(typeof d!="function")throw Error(Ut(150));if(h=d.call(h),h==null)throw Error(Ut(151));for(var M=d=null,x=T,E=T=0,P=null,R=h.next();x!==null&&!R.done;E++,R=h.next()){x.index>E?(P=x,x=null):P=x.sibling;var N=g(y,x,R.value,m);if(N===null){x===null&&(x=P);break}n&&x&&N.alternate===null&&t(y,x),T=o(N,T,E),M===null?d=N:M.sibling=N,M=N,x=P}if(R.done)return e(y,x),d;if(x===null){for(;!R.done;E++,R=h.next())R=c(y,R.value,m),R!==null&&(T=o(R,T,E),M===null?d=R:M.sibling=R,M=R);return d}for(x=r(y,x);!R.done;E++,R=h.next())R=v(x,y,E,R.value,m),R!==null&&(n&&R.alternate!==null&&x.delete(R.key===null?E:R.key),T=o(R,T,E),M===null?d=R:M.sibling=R,M=R);return n&&x.forEach(function(b){return t(y,b)}),d}return function(y,T,h,m){var d=typeof h=="object"&&h!==null&&h.type===Hr&&h.key===null;d&&(h=h.props.children);var M=typeof h=="object"&&h!==null;if(M)switch(h.$$typeof){case hs:t:{for(M=h.key,d=T;d!==null;){if(d.key===M){switch(d.tag){case 7:if(h.type===Hr){e(y,d.sibling),T=i(d,h.props.children),T.return=y,y=T;break t}break;default:if(d.elementType===h.type){e(y,d.sibling),T=i(d,h.props),T.ref=po(y,d,h),T.return=y,y=T;break t}}e(y,d);break}else t(y,d);d=d.sibling}h.type===Hr?(T=Er(h.props.children,y.mode,m,h.key),T.return=y,y=T):(m=Vs(h.type,h.key,h.props,null,y.mode,m),m.ref=po(y,T,h),m.return=y,y=m)}return s(y);case Pi:t:{for(d=h.key;T!==null;){if(T.key===d)if(T.tag===4&&T.stateNode.containerInfo===h.containerInfo&&T.stateNode.implementation===h.implementation){e(y,T.sibling),T=i(T,h.children||[]),T.return=y,y=T;break t}else{e(y,T);break}else t(y,T);T=T.sibling}T=wl(h,y.mode,m),T.return=y,y=T}return s(y)}if(typeof h=="string"||typeof h=="number")return h=""+h,T!==null&&T.tag===6?(e(y,T.sibling),T=i(T,h),T.return=y,y=T):(e(y,T),T=Il(h,y.mode,m),T.return=y,y=T),s(y);if(gs(h))return I(y,T,h,m);if(ao(h))return w(y,T,h,m);if(M&&ms(y,h),typeof h>"u"&&!d)switch(y.tag){case 1:case 0:throw y=y.type,Error(Ut(152,y.displayName||y.name||"Component"))}return e(y,T)}}var Gi=Sg(!0),Nc=Sg(!1),ts={},Zn={current:ts},Uo={current:ts},Yo={current:ts};function Jr(n){if(n===ts)throw Error(Ut(174));return n}function gu(n,t){switch(Le(Yo,t),Le(Uo,n),Le(Zn,ts),n=t.nodeType,n){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ql(null,"");break;default:n=n===8?t.parentNode:t,t=n.namespaceURI||null,n=n.tagName,t=ql(t,n)}Ie(Zn),Le(Zn,t)}function $i(){Ie(Zn),Ie(Uo),Ie(Yo)}function lf(n){Jr(Yo.current);var t=Jr(Zn.current),e=ql(t,n.type);t!==e&&(Le(Uo,n),Le(Zn,e))}function Ac(n){Uo.current===n&&(Ie(Zn),Ie(Uo))}var Pe={current:0};function ga(n){for(var t=n;t!==null;){if(t.tag===13){var e=t.memoizedState;if(e!==null&&(e=e.dehydrated,e===null||e.data===mc||e.data===vc))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.effectTag&64)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===n)break;for(;t.sibling===null;){if(t.return===null||t.return===n)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function Dc(n,t){return{responder:n,props:t}}var Us=zn.ReactCurrentDispatcher,Cn=zn.ReactCurrentBatchConfig,xr=0,je=null,He=null,Qe=null,ma=!1;function fn(){throw Error(Ut(321))}function Lc(n,t){if(t===null)return!1;for(var e=0;e<t.length&&e<n.length;e++)if(!ci(n[e],t[e]))return!1;return!0}function Oc(n,t,e,r,i,o){if(xr=o,je=t,t.memoizedState=null,t.updateQueue=null,t.expirationTime=0,Us.current=n===null||n.memoizedState===null?UM:YM,n=e(r,i),t.expirationTime===xr){o=0;do{if(t.expirationTime=0,!(25>o))throw Error(Ut(301));o+=1,Qe=He=null,t.updateQueue=null,Us.current=FM,n=e(r,i)}while(t.expirationTime===xr)}if(Us.current=Ma,t=He!==null&&He.next!==null,xr=0,Qe=He=je=null,ma=!1,t)throw Error(Ut(300));return n}function Ui(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qe===null?je.memoizedState=Qe=n:Qe=Qe.next=n,Qe}function Zi(){if(He===null){var n=je.alternate;n=n!==null?n.memoizedState:null}else n=He.next;var t=Qe===null?je.memoizedState:Qe.next;if(t!==null)Qe=t,He=n;else{if(n===null)throw Error(Ut(310));He=n,n={memoizedState:He.memoizedState,baseState:He.baseState,baseQueue:He.baseQueue,queue:He.queue,next:null},Qe===null?je.memoizedState=Qe=n:Qe=Qe.next=n}return Qe}function ei(n,t){return typeof t=="function"?t(n):t}function vs(n){var t=Zi(),e=t.queue;if(e===null)throw Error(Ut(311));e.lastRenderedReducer=n;var r=He,i=r.baseQueue,o=e.pending;if(o!==null){if(i!==null){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,e.pending=null}if(i!==null){i=i.next,r=r.baseState;var a=s=o=null,l=i;do{var u=l.expirationTime;if(u<xr){var p={expirationTime:l.expirationTime,suspenseConfig:l.suspenseConfig,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null};a===null?(s=a=p,o=r):a=a.next=p,u>je.expirationTime&&(je.expirationTime=u,Ga(u))}else a!==null&&(a=a.next={expirationTime:1073741823,suspenseConfig:l.suspenseConfig,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null}),Kg(u,l.suspenseConfig),r=l.eagerReducer===n?l.eagerState:n(r,l.action);l=l.next}while(l!==null&&l!==i);a===null?o=r:a.next=s,ci(r,t.memoizedState)||(Hn=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=a,e.lastRenderedState=r}return[t.memoizedState,e.dispatch]}function ys(n){var t=Zi(),e=t.queue;if(e===null)throw Error(Ut(311));e.lastRenderedReducer=n;var r=e.dispatch,i=e.pending,o=t.memoizedState;if(i!==null){e.pending=null;var s=i=i.next;do o=n(o,s.action),s=s.next;while(s!==i);ci(o,t.memoizedState)||(Hn=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),e.lastRenderedState=o}return[o,r]}function ml(n){var t=Ui();return typeof n=="function"&&(n=n()),t.memoizedState=t.baseState=n,n=t.queue={pending:null,dispatch:null,lastRenderedReducer:ei,lastRenderedState:n},n=n.dispatch=Ag.bind(null,je,n),[t.memoizedState,n]}function mu(n,t,e,r){return n={tag:n,create:t,destroy:e,deps:r,next:null},t=je.updateQueue,t===null?(t={lastEffect:null},je.updateQueue=t,t.lastEffect=n.next=n):(e=t.lastEffect,e===null?t.lastEffect=n.next=n:(r=e.next,e.next=n,n.next=r,t.lastEffect=n)),n}function xg(){return Zi().memoizedState}function vu(n,t,e,r){var i=Ui();je.effectTag|=n,i.memoizedState=mu(1|t,e,void 0,r===void 0?null:r)}function bc(n,t,e,r){var i=Zi();r=r===void 0?null:r;var o=void 0;if(He!==null){var s=He.memoizedState;if(o=s.destroy,r!==null&&Lc(r,s.deps)){mu(t,e,o,r);return}}je.effectTag|=n,i.memoizedState=mu(1|t,e,o,r)}function uf(n,t){return vu(516,4,n,t)}function va(n,t){return bc(516,4,n,t)}function Cg(n,t){return bc(4,2,n,t)}function Eg(n,t){if(typeof t=="function")return n=n(),t(n),function(){t(null)};if(t!=null)return n=n(),t.current=n,function(){t.current=null}}function Pg(n,t,e){return e=e!=null?e.concat([n]):null,bc(4,2,Eg.bind(null,t,n),e)}function Rc(){}function cf(n,t){return Ui().memoizedState=[n,t===void 0?null:t],n}function ya(n,t){var e=Zi();t=t===void 0?null:t;var r=e.memoizedState;return r!==null&&t!==null&&Lc(t,r[1])?r[0]:(e.memoizedState=[n,t],n)}function Ng(n,t){var e=Zi();t=t===void 0?null:t;var r=e.memoizedState;return r!==null&&t!==null&&Lc(t,r[1])?r[0]:(n=n(),e.memoizedState=[n,t],n)}function jc(n,t,e){var r=Ua();Br(98>r?98:r,function(){n(!0)}),Br(97<r?97:r,function(){var i=Cn.suspense;Cn.suspense=t===void 0?null:t;try{n(!1),e()}finally{Cn.suspense=i}})}function Ag(n,t,e){var r=Kn(),i=Ao.suspense;r=ii(r,n,i),i={expirationTime:r,suspenseConfig:i,action:e,eagerReducer:null,eagerState:null,next:null};var o=t.pending;if(o===null?i.next=i:(i.next=o.next,o.next=i),t.pending=i,o=n.alternate,n===je||o!==null&&o===je)ma=!0,i.expirationTime=xr,je.expirationTime=xr;else{if(n.expirationTime===0&&(o===null||o.expirationTime===0)&&(o=t.lastRenderedReducer,o!==null))try{var s=t.lastRenderedState,a=o(s,e);if(i.eagerReducer=o,i.eagerState=a,ci(a,s))return}catch{}finally{}Rr(n,r)}}var Ma={readContext:En,useCallback:fn,useContext:fn,useEffect:fn,useImperativeHandle:fn,useLayoutEffect:fn,useMemo:fn,useReducer:fn,useRef:fn,useState:fn,useDebugValue:fn,useResponder:fn,useDeferredValue:fn,useTransition:fn},UM={readContext:En,useCallback:cf,useContext:En,useEffect:uf,useImperativeHandle:function(n,t,e){return e=e!=null?e.concat([n]):null,vu(4,2,Eg.bind(null,t,n),e)},useLayoutEffect:function(n,t){return vu(4,2,n,t)},useMemo:function(n,t){var e=Ui();return t=t===void 0?null:t,n=n(),e.memoizedState=[n,t],n},useReducer:function(n,t,e){var r=Ui();return t=e!==void 0?e(t):t,r.memoizedState=r.baseState=t,n=r.queue={pending:null,dispatch:null,lastRenderedReducer:n,lastRenderedState:t},n=n.dispatch=Ag.bind(null,je,n),[r.memoizedState,n]},useRef:function(n){var t=Ui();return n={current:n},t.memoizedState=n},useState:ml,useDebugValue:Rc,useResponder:Dc,useDeferredValue:function(n,t){var e=ml(n),r=e[0],i=e[1];return uf(function(){var o=Cn.suspense;Cn.suspense=t===void 0?null:t;try{i(n)}finally{Cn.suspense=o}},[n,t]),r},useTransition:function(n){var t=ml(!1),e=t[0];return t=t[1],[cf(jc.bind(null,t,n),[t,n]),e]}},YM={readContext:En,useCallback:ya,useContext:En,useEffect:va,useImperativeHandle:Pg,useLayoutEffect:Cg,useMemo:Ng,useReducer:vs,useRef:xg,useState:function(){return vs(ei)},useDebugValue:Rc,useResponder:Dc,useDeferredValue:function(n,t){var e=vs(ei),r=e[0],i=e[1];return va(function(){var o=Cn.suspense;Cn.suspense=t===void 0?null:t;try{i(n)}finally{Cn.suspense=o}},[n,t]),r},useTransition:function(n){var t=vs(ei),e=t[0];return t=t[1],[ya(jc.bind(null,t,n),[t,n]),e]}},FM={readContext:En,useCallback:ya,useContext:En,useEffect:va,useImperativeHandle:Pg,useLayoutEffect:Cg,useMemo:Ng,useReducer:ys,useRef:xg,useState:function(){return ys(ei)},useDebugValue:Rc,useResponder:Dc,useDeferredValue:function(n,t){var e=ys(ei),r=e[0],i=e[1];return va(function(){var o=Cn.suspense;Cn.suspense=t===void 0?null:t;try{i(n)}finally{Cn.suspense=o}},[n,t]),r},useTransition:function(n){var t=ys(ei),e=t[0];return t=t[1],[ya(jc.bind(null,t,n),[t,n]),e]}},hr=null,Cr=null,ni=!1;function Dg(n,t){var e=Qn(5,null,null,0);e.elementType="DELETED",e.type="DELETED",e.stateNode=t,e.return=n,e.effectTag=8,n.lastEffect!==null?(n.lastEffect.nextEffect=e,n.lastEffect=e):n.firstEffect=n.lastEffect=e}function hf(n,t){switch(n.tag){case 5:var e=n.type;return t=t.nodeType!==1||e.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(n.stateNode=t,!0):!1;case 6:return t=n.pendingProps===""||t.nodeType!==3?null:t,t!==null?(n.stateNode=t,!0):!1;case 13:return!1;default:return!1}}function yu(n){if(ni){var t=Cr;if(t){var e=t;if(!hf(n,t)){if(t=Bi(e.nextSibling),!t||!hf(n,t)){n.effectTag=n.effectTag&-1025|2,ni=!1,hr=n;return}Dg(hr,e)}hr=n,Cr=Bi(t.firstChild)}else n.effectTag=n.effectTag&-1025|2,ni=!1,hr=n}}function ff(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;hr=n}function Ms(n){if(n!==hr)return!1;if(!ni)return ff(n),ni=!0,!1;var t=n.type;if(n.tag!==5||t!=="head"&&t!=="body"&&!au(t,n.memoizedProps))for(t=Cr;t;)Dg(n,t),t=Bi(t.nextSibling);if(ff(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Ut(317));t:{for(n=n.nextSibling,t=0;n;){if(n.nodeType===8){var e=n.data;if(e===Kp){if(t===0){Cr=Bi(n.nextSibling);break t}t--}else e!==Zp&&e!==vc&&e!==mc||t++}n=n.nextSibling}Cr=null}}else Cr=hr?Bi(n.stateNode.nextSibling):null;return!0}function vl(){Cr=hr=null,ni=!1}var VM=zn.ReactCurrentOwner,Hn=!1;function pn(n,t,e,r){t.child=n===null?Nc(t,null,e,r):Gi(t,n.child,e,r)}function df(n,t,e,r,i){e=e.render;var o=t.ref;return Wi(t,i),r=Oc(n,t,e,r,o,i),n!==null&&!Hn?(t.updateQueue=n.updateQueue,t.effectTag&=-517,n.expirationTime<=i&&(n.expirationTime=0),fr(n,t,i)):(t.effectTag|=1,pn(n,t,r,i),t.child)}function pf(n,t,e,r,i,o){if(n===null){var s=e.type;return typeof s=="function"&&!Uc(s)&&s.defaultProps===void 0&&e.compare===null&&e.defaultProps===void 0?(t.tag=15,t.type=s,Lg(n,t,s,r,i,o)):(n=Vs(e.type,null,r,null,t.mode,o),n.ref=t.ref,n.return=t,t.child=n)}return s=n.child,i<o&&(i=s.memoizedProps,e=e.compare,e=e!==null?e:Bo,e(i,r)&&n.ref===t.ref)?fr(n,t,o):(t.effectTag|=1,n=fi(s,r),n.ref=t.ref,n.return=t,t.child=n)}function Lg(n,t,e,r,i,o){return n!==null&&Bo(n.memoizedProps,r)&&n.ref===t.ref&&(Hn=!1,i<o)?(t.expirationTime=n.expirationTime,fr(n,t,o)):Mu(n,t,e,r,o)}function Og(n,t){var e=t.ref;(n===null&&e!==null||n!==null&&n.ref!==e)&&(t.effectTag|=128)}function Mu(n,t,e,r,i){var o=ln(e)?hi:Ke.current;return o=Xi(t,o),Wi(t,i),e=Oc(n,t,e,r,o,i),n!==null&&!Hn?(t.updateQueue=n.updateQueue,t.effectTag&=-517,n.expirationTime<=i&&(n.expirationTime=0),fr(n,t,i)):(t.effectTag|=1,pn(n,t,e,i),t.child)}function gf(n,t,e,r,i){if(ln(e)){var o=!0;ks(t)}else o=!1;if(Wi(t,i),t.stateNode===null)n!==null&&(n.alternate=null,t.alternate=null,t.effectTag|=2),wg(t,e,r),pu(t,e,r,i),r=!0;else if(n===null){var s=t.stateNode,a=t.memoizedProps;s.props=a;var l=s.context,u=e.contextType;typeof u=="object"&&u!==null?u=En(u):(u=ln(e)?hi:Ke.current,u=Xi(t,u));var p=e.getDerivedStateFromProps,c=typeof p=="function"||typeof s.getSnapshotBeforeUpdate=="function";c||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==r||l!==u)&&af(t,s,r,u),Ir=!1;var g=t.memoizedState;s.state=g,Wo(t,r,s,i),l=t.memoizedState,a!==r||g!==l||an.current||Ir?(typeof p=="function"&&(pa(t,e,p,r),l=t.memoizedState),(a=Ir||sf(t,e,a,r,g,l,u))?(c||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(t.effectTag|=4)):(typeof s.componentDidMount=="function"&&(t.effectTag|=4),t.memoizedProps=r,t.memoizedState=l),s.props=r,s.state=l,s.context=u,r=a):(typeof s.componentDidMount=="function"&&(t.effectTag|=4),r=!1)}else s=t.stateNode,Pc(n,t),a=t.memoizedProps,s.props=t.type===t.elementType?a:On(t.type,a),l=s.context,u=e.contextType,typeof u=="object"&&u!==null?u=En(u):(u=ln(e)?hi:Ke.current,u=Xi(t,u)),p=e.getDerivedStateFromProps,(c=typeof p=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==r||l!==u)&&af(t,s,r,u),Ir=!1,l=t.memoizedState,s.state=l,Wo(t,r,s,i),g=t.memoizedState,a!==r||l!==g||an.current||Ir?(typeof p=="function"&&(pa(t,e,p,r),g=t.memoizedState),(p=Ir||sf(t,e,a,r,l,g,u))?(c||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,g,u),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,g,u)),typeof s.componentDidUpdate=="function"&&(t.effectTag|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(t.effectTag|=256)):(typeof s.componentDidUpdate!="function"||a===n.memoizedProps&&l===n.memoizedState||(t.effectTag|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&l===n.memoizedState||(t.effectTag|=256),t.memoizedProps=r,t.memoizedState=g),s.props=r,s.state=g,s.context=u,r=p):(typeof s.componentDidUpdate!="function"||a===n.memoizedProps&&l===n.memoizedState||(t.effectTag|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&l===n.memoizedState||(t.effectTag|=256),r=!1);return Tu(n,t,e,r,o,i)}function Tu(n,t,e,r,i,o){Og(n,t);var s=(t.effectTag&64)!==0;if(!r&&!s)return i&&_h(t,e,!1),fr(n,t,o);r=t.stateNode,VM.current=t;var a=s&&typeof e.getDerivedStateFromError!="function"?null:r.render();return t.effectTag|=1,n!==null&&s?(t.child=Gi(t,n.child,null,o),t.child=Gi(t,null,a,o)):pn(n,t,a,o),t.memoizedState=r.state,i&&_h(t,e,!0),t.child}function mf(n){var t=n.stateNode;t.pendingContext?qh(n,t.pendingContext,t.pendingContext!==t.context):t.context&&qh(n,t.context,!1),gu(n,t.containerInfo)}var yl={dehydrated:null,retryTime:0};function vf(n,t,e){var r=t.mode,i=t.pendingProps,o=Pe.current,s=!1,a;if((a=(t.effectTag&64)!==0)||(a=(o&2)!==0&&(n===null||n.memoizedState!==null)),a?(s=!0,t.effectTag&=-65):n!==null&&n.memoizedState===null||i.fallback===void 0||i.unstable_avoidThisFallback===!0||(o|=1),Le(Pe,o&1),n===null){if(i.fallback!==void 0&&yu(t),s){if(s=i.fallback,i=Er(null,r,0,null),i.return=t,!(t.mode&2))for(n=t.memoizedState!==null?t.child.child:t.child,i.child=n;n!==null;)n.return=i,n=n.sibling;return e=Er(s,r,e,null),e.return=t,i.sibling=e,t.memoizedState=yl,t.child=i,e}return r=i.children,t.memoizedState=null,t.child=Nc(t,null,r,e)}if(n.memoizedState!==null){if(n=n.child,r=n.sibling,s){if(i=i.fallback,e=fi(n,n.pendingProps),e.return=t,!(t.mode&2)&&(s=t.memoizedState!==null?t.child.child:t.child,s!==n.child))for(e.child=s;s!==null;)s.return=e,s=s.sibling;return r=fi(r,i),r.return=t,e.sibling=r,e.childExpirationTime=0,t.memoizedState=yl,t.child=e,r}return e=Gi(t,n.child,i.children,e),t.memoizedState=null,t.child=e}if(n=n.child,s){if(s=i.fallback,i=Er(null,r,0,null),i.return=t,i.child=n,n!==null&&(n.return=i),!(t.mode&2))for(n=t.memoizedState!==null?t.child.child:t.child,i.child=n;n!==null;)n.return=i,n=n.sibling;return e=Er(s,r,e,null),e.return=t,i.sibling=e,e.effectTag|=2,i.childExpirationTime=0,t.memoizedState=yl,t.child=i,e}return t.memoizedState=null,t.child=Gi(t,n,i.children,e)}function yf(n,t){n.expirationTime<t&&(n.expirationTime=t);var e=n.alternate;e!==null&&e.expirationTime<t&&(e.expirationTime=t),Tg(n.return,t)}function Ml(n,t,e,r,i,o){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:e,tailExpiration:0,tailMode:i,lastEffect:o}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=e,s.tailExpiration=0,s.tailMode=i,s.lastEffect=o)}function Mf(n,t,e){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(pn(n,t,r.children,e),r=Pe.current,r&2)r=r&1|2,t.effectTag|=64;else{if(n!==null&&n.effectTag&64)t:for(n=t.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&yf(n,e);else if(n.tag===19)yf(n,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break t;for(;n.sibling===null;){if(n.return===null||n.return===t)break t;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Le(Pe,r),!(t.mode&2))t.memoizedState=null;else switch(i){case"forwards":for(e=t.child,i=null;e!==null;)n=e.alternate,n!==null&&ga(n)===null&&(i=e),e=e.sibling;e=i,e===null?(i=t.child,t.child=null):(i=e.sibling,e.sibling=null),Ml(t,!1,i,e,o,t.lastEffect);break;case"backwards":for(e=null,i=t.child,t.child=null;i!==null;){if(n=i.alternate,n!==null&&ga(n)===null){t.child=i;break}n=i.sibling,i.sibling=e,e=i,i=n}Ml(t,!0,e,null,o,t.lastEffect);break;case"together":Ml(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function fr(n,t,e){n!==null&&(t.dependencies=n.dependencies);var r=t.expirationTime;if(r!==0&&Ga(r),t.childExpirationTime<e)return null;if(n!==null&&t.child!==n.child)throw Error(Ut(153));if(t.child!==null){for(n=t.child,e=fi(n,n.pendingProps),t.child=e,e.return=t;n.sibling!==null;)n=n.sibling,e=e.sibling=fi(n,n.pendingProps),e.return=t;e.sibling=null}return t.child}var bg,Iu,Rg,jg;bg=function(n,t){for(var e=t.child;e!==null;){if(e.tag===5||e.tag===6)n.appendChild(e.stateNode);else if(e.tag!==4&&e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return;e=e.return}e.sibling.return=e.return,e=e.sibling}};Iu=function(){};Rg=function(n,t,e,r,i){var o=n.memoizedProps;if(o!==r){var s=t.stateNode;switch(Jr(Zn.current),n=null,e){case"input":o=Hl(s,o),r=Hl(s,r),n=[];break;case"option":o=Kl(s,o),r=Kl(s,r),n=[];break;case"select":o=en({},o,{value:void 0}),r=en({},r,{value:void 0}),n=[];break;case"textarea":o=Jl(s,o),r=Jl(s,r),n=[];break;default:typeof o.onClick!="function"&&typeof r.onClick=="function"&&(s.onclick=aa)}ru(e,r);var a,l;e=null;for(a in o)if(!r.hasOwnProperty(a)&&o.hasOwnProperty(a)&&o[a]!=null)if(a==="style")for(l in s=o[a],s)s.hasOwnProperty(l)&&(e||(e={}),e[l]="");else a!=="dangerouslySetInnerHTML"&&a!=="children"&&a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(Yi.hasOwnProperty(a)?n||(n=[]):(n=n||[]).push(a,null));for(a in r){var u=r[a];if(s=o?.[a],r.hasOwnProperty(a)&&u!==s&&(u!=null||s!=null))if(a==="style")if(s){for(l in s)!s.hasOwnProperty(l)||u&&u.hasOwnProperty(l)||(e||(e={}),e[l]="");for(l in u)u.hasOwnProperty(l)&&s[l]!==u[l]&&(e||(e={}),e[l]=u[l])}else e||(n||(n=[]),n.push(a,e)),e=u;else a==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,s=s?s.__html:void 0,u!=null&&s!==u&&(n=n||[]).push(a,u)):a==="children"?s===u||typeof u!="string"&&typeof u!="number"||(n=n||[]).push(a,""+u):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&(Yi.hasOwnProperty(a)?(u!=null&&ir(i,a),n||s===u||(n=[])):(n=n||[]).push(a,u))}e&&(n=n||[]).push("style",e),i=n,(t.updateQueue=i)&&(t.effectTag|=4)}};jg=function(n,t,e,r){e!==r&&(t.effectTag|=4)};function Ts(n,t){switch(n.tailMode){case"hidden":t=n.tail;for(var e=null;t!==null;)t.alternate!==null&&(e=t),t=t.sibling;e===null?n.tail=null:e.sibling=null;break;case"collapsed":e=n.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function XM(n,t,e){var r=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return ln(t.type)&&ca(),null;case 3:return $i(),Ie(an),Ie(Ke),e=t.stateNode,e.pendingContext&&(e.context=e.pendingContext,e.pendingContext=null),n!==null&&n.child!==null||!Ms(t)||(t.effectTag|=4),Iu(t),null;case 5:Ac(t),e=Jr(Yo.current);var i=t.type;if(n!==null&&t.stateNode!=null)Rg(n,t,i,r,e),n.ref!==t.ref&&(t.effectTag|=128);else{if(!r){if(t.stateNode===null)throw Error(Ut(166));return null}if(n=Jr(Zn.current),Ms(t)){r=t.stateNode,i=t.type;var o=t.memoizedProps;switch(r[wr]=t,r[la]=o,i){case"iframe":case"object":case"embed":Ce("load",r);break;case"video":case"audio":for(n=0;n<Mo.length;n++)Ce(Mo[n],r);break;case"source":Ce("error",r);break;case"img":case"image":case"link":Ce("error",r),Ce("load",r);break;case"form":Ce("reset",r),Ce("submit",r);break;case"details":Ce("toggle",r);break;case"input":Ah(r,o),Ce("invalid",r),ir(e,"onChange");break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Ce("invalid",r),ir(e,"onChange");break;case"textarea":Lh(r,o),Ce("invalid",r),ir(e,"onChange")}ru(i,o),n=null;for(var s in o)if(o.hasOwnProperty(s)){var a=o[s];s==="children"?typeof a=="string"?r.textContent!==a&&(n=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(n=["children",""+a]):Yi.hasOwnProperty(s)&&a!=null&&ir(e,s)}switch(i){case"input":fs(r),Dh(r,o,!0);break;case"textarea":fs(r),Oh(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=aa)}e=n,t.updateQueue=e,e!==null&&(t.effectTag|=4)}else{switch(s=e.nodeType===9?e:e.ownerDocument,n===Bh&&(n=Np(i)),n===Bh?i==="script"?(n=s.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=s.createElement(i,{is:r.is}):(n=s.createElement(i),i==="select"&&(s=n,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):n=s.createElementNS(n,i),n[wr]=t,n[la]=r,bg(n,t,!1,!1),t.stateNode=n,s=iu(i,r),i){case"iframe":case"object":case"embed":Ce("load",n),a=r;break;case"video":case"audio":for(a=0;a<Mo.length;a++)Ce(Mo[a],n);a=r;break;case"source":Ce("error",n),a=r;break;case"img":case"image":case"link":Ce("error",n),Ce("load",n),a=r;break;case"form":Ce("reset",n),Ce("submit",n),a=r;break;case"details":Ce("toggle",n),a=r;break;case"input":Ah(n,r),a=Hl(n,r),Ce("invalid",n),ir(e,"onChange");break;case"option":a=Kl(n,r);break;case"select":n._wrapperState={wasMultiple:!!r.multiple},a=en({},r,{value:void 0}),Ce("invalid",n),ir(e,"onChange");break;case"textarea":Lh(n,r),a=Jl(n,r),Ce("invalid",n),ir(e,"onChange");break;default:a=r}ru(i,a);var l=a;for(o in l)if(l.hasOwnProperty(o)){var u=l[o];o==="style"?Hp(n,u):o==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&Ap(n,u)):o==="children"?typeof u=="string"?(i!=="textarea"||u!=="")&&Ro(n,u):typeof u=="number"&&Ro(n,""+u):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Yi.hasOwnProperty(o)?u!=null&&ir(e,o):u!=null&&oc(n,o,u,s))}switch(i){case"input":fs(n),Dh(n,r,!1);break;case"textarea":fs(n),Oh(n);break;case"option":r.value!=null&&n.setAttribute("value",""+zr(r.value));break;case"select":n.multiple=!!r.multiple,e=r.value,e!=null?ki(n,!!r.multiple,e,!1):r.defaultValue!=null&&ki(n,!!r.multiple,r.defaultValue,!0);break;default:typeof a.onClick=="function"&&(n.onclick=aa)}Jp(i,r)&&(t.effectTag|=4)}t.ref!==null&&(t.effectTag|=128)}return null;case 6:if(n&&t.stateNode!=null)jg(n,t,n.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(Ut(166));e=Jr(Yo.current),Jr(Zn.current),Ms(t)?(e=t.stateNode,r=t.memoizedProps,e[wr]=t,e.nodeValue!==r&&(t.effectTag|=4)):(e=(e.nodeType===9?e:e.ownerDocument).createTextNode(r),e[wr]=t,t.stateNode=e)}return null;case 13:return Ie(Pe),r=t.memoizedState,t.effectTag&64?(t.expirationTime=e,t):(e=r!==null,r=!1,n===null?t.memoizedProps.fallback!==void 0&&Ms(t):(i=n.memoizedState,r=i!==null,e||i===null||(i=n.child.sibling,i!==null&&(o=t.firstEffect,o!==null?(t.firstEffect=i,i.nextEffect=o):(t.firstEffect=t.lastEffect=i,i.nextEffect=null),i.effectTag=8))),e&&!r&&t.mode&2&&(n===null&&t.memoizedProps.unstable_avoidThisFallback!==!0||Pe.current&1?ke===ri&&(ke=wa):((ke===ri||ke===wa)&&(ke=Fa),Vo!==0&&vn!==null&&(ti(vn,un),em(vn,Vo)))),(e||r)&&(t.effectTag|=4),null);case 4:return $i(),Iu(t),null;case 10:return Cc(t),null;case 17:return ln(t.type)&&ca(),null;case 19:if(Ie(Pe),r=t.memoizedState,r===null)return null;if(i=(t.effectTag&64)!==0,o=r.rendering,o===null){if(i)Ts(r,!1);else if(ke!==ri||n!==null&&n.effectTag&64)for(o=t.child;o!==null;){if(n=ga(o),n!==null){for(t.effectTag|=64,Ts(r,!1),i=n.updateQueue,i!==null&&(t.updateQueue=i,t.effectTag|=4),r.lastEffect===null&&(t.firstEffect=null),t.lastEffect=r.lastEffect,r=t.child;r!==null;)i=r,o=e,i.effectTag&=2,i.nextEffect=null,i.firstEffect=null,i.lastEffect=null,n=i.alternate,n===null?(i.childExpirationTime=0,i.expirationTime=o,i.child=null,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null):(i.childExpirationTime=n.childExpirationTime,i.expirationTime=n.expirationTime,i.child=n.child,i.memoizedProps=n.memoizedProps,i.memoizedState=n.memoizedState,i.updateQueue=n.updateQueue,o=n.dependencies,i.dependencies=o===null?null:{expirationTime:o.expirationTime,firstContext:o.firstContext,responders:o.responders}),r=r.sibling;return Le(Pe,Pe.current&1|2),t.child}o=o.sibling}}else{if(!i)if(n=ga(o),n!==null){if(t.effectTag|=64,i=!0,e=n.updateQueue,e!==null&&(t.updateQueue=e,t.effectTag|=4),Ts(r,!0),r.tail===null&&r.tailMode==="hidden"&&!o.alternate)return t=t.lastEffect=r.lastEffect,t!==null&&(t.nextEffect=null),null}else 2*xn()-r.renderingStartTime>r.tailExpiration&&1<e&&(t.effectTag|=64,i=!0,Ts(r,!1),t.expirationTime=t.childExpirationTime=e-1);r.isBackwards?(o.sibling=t.child,t.child=o):(e=r.last,e!==null?e.sibling=o:t.child=o,r.last=o)}return r.tail!==null?(r.tailExpiration===0&&(r.tailExpiration=xn()+500),e=r.tail,r.rendering=e,r.tail=e.sibling,r.lastEffect=t.lastEffect,r.renderingStartTime=xn(),e.sibling=null,t=Pe.current,Le(Pe,i?t&1|2:t&1),e):null}throw Error(Ut(156,t.tag))}function GM(n){switch(n.tag){case 1:ln(n.type)&&ca();var t=n.effectTag;return t&4096?(n.effectTag=t&-4097|64,n):null;case 3:if($i(),Ie(an),Ie(Ke),t=n.effectTag,t&64)throw Error(Ut(285));return n.effectTag=t&-4097|64,n;case 5:return Ac(n),null;case 13:return Ie(Pe),t=n.effectTag,t&4096?(n.effectTag=t&-4097|64,n):null;case 19:return Ie(Pe),null;case 4:return $i(),null;case 10:return Cc(n),null;default:return null}}function zc(n,t){return{value:n,source:t,stack:lc(t)}}var $M=typeof WeakSet=="function"?WeakSet:Set;function wu(n,t){var e=t.source,r=t.stack;r===null&&e!==null&&(r=lc(e)),e!==null&&dr(e.type),t=t.value,n!==null&&n.tag===1&&dr(n.type);try{console.error(t)}catch(i){setTimeout(function(){throw i})}}function HM(n,t){try{t.props=n.memoizedProps,t.state=n.memoizedState,t.componentWillUnmount()}catch(e){oi(n,e)}}function Tf(n){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(e){oi(n,e)}else t.current=null}function QM(n,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(t.effectTag&256&&n!==null){var e=n.memoizedProps,r=n.memoizedState;n=t.stateNode,t=n.getSnapshotBeforeUpdate(t.elementType===t.type?e:On(t.type,e),r),n.__reactInternalSnapshotBeforeUpdate=t}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(Ut(163))}function zg(n,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var e=t=t.next;do{if((e.tag&n)===n){var r=e.destroy;e.destroy=void 0,r!==void 0&&r()}e=e.next}while(e!==t)}}function kg(n,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var e=t=t.next;do{if((e.tag&n)===n){var r=e.create;e.destroy=r()}e=e.next}while(e!==t)}}function ZM(n,t,e){switch(e.tag){case 0:case 11:case 15:case 22:kg(3,e);return;case 1:if(n=e.stateNode,e.effectTag&4)if(t===null)n.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:On(e.type,t.memoizedProps);n.componentDidUpdate(r,t.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}t=e.updateQueue,t!==null&&of(e,t,n);return;case 3:if(t=e.updateQueue,t!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}of(e,t,n)}return;case 5:n=e.stateNode,t===null&&e.effectTag&4&&Jp(e.type,e.memoizedProps)&&n.focus();return;case 6:return;case 4:return;case 12:return;case 13:e.memoizedState===null&&(e=e.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&Vp(e))));return;case 19:case 17:case 20:case 21:return}throw Error(Ut(163))}function If(n,t,e){switch(typeof Du=="function"&&Du(t),t.tag){case 0:case 11:case 14:case 15:case 22:if(n=t.updateQueue,n!==null&&(n=n.lastEffect,n!==null)){var r=n.next;Br(97<e?97:e,function(){var i=r;do{var o=i.destroy;if(o!==void 0){var s=t;try{o()}catch(a){oi(s,a)}}i=i.next}while(i!==r)})}break;case 1:Tf(t),e=t.stateNode,typeof e.componentWillUnmount=="function"&&HM(t,e);break;case 5:Tf(t);break;case 4:Wg(n,t,e)}}function Bg(n){var t=n.alternate;n.return=null,n.child=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.alternate=null,n.firstEffect=null,n.lastEffect=null,n.pendingProps=null,n.memoizedProps=null,n.stateNode=null,t!==null&&Bg(t)}function wf(n){return n.tag===5||n.tag===3||n.tag===4}function Sf(n){t:{for(var t=n.return;t!==null;){if(wf(t)){var e=t;break t}t=t.return}throw Error(Ut(160))}switch(t=e.stateNode,e.tag){case 5:var r=!1;break;case 3:t=t.containerInfo,r=!0;break;case 4:t=t.containerInfo,r=!0;break;default:throw Error(Ut(161))}e.effectTag&16&&(Ro(t,""),e.effectTag&=-17);t:e:for(e=n;;){for(;e.sibling===null;){if(e.return===null||wf(e.return)){e=null;break t}e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.effectTag&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.effectTag&2)){e=e.stateNode;break t}}r?Su(n,e,t):xu(n,e,t)}function Su(n,t,e){var r=n.tag,i=r===5||r===6;if(i)n=i?n.stateNode:n.stateNode.instance,t?e.nodeType===8?e.parentNode.insertBefore(n,t):e.insertBefore(n,t):(e.nodeType===8?(t=e.parentNode,t.insertBefore(n,e)):(t=e,t.appendChild(n)),e=e._reactRootContainer,e!=null||t.onclick!==null||(t.onclick=aa));else if(r!==4&&(n=n.child,n!==null))for(Su(n,t,e),n=n.sibling;n!==null;)Su(n,t,e),n=n.sibling}function xu(n,t,e){var r=n.tag,i=r===5||r===6;if(i)n=i?n.stateNode:n.stateNode.instance,t?e.insertBefore(n,t):e.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(xu(n,t,e),n=n.sibling;n!==null;)xu(n,t,e),n=n.sibling}function Wg(n,t,e){for(var r=t,i=!1,o,s;;){if(!i){i=r.return;t:for(;;){if(i===null)throw Error(Ut(160));switch(o=i.stateNode,i.tag){case 5:s=!1;break t;case 3:o=o.containerInfo,s=!0;break t;case 4:o=o.containerInfo,s=!0;break t}i=i.return}i=!0}if(r.tag===5||r.tag===6){t:for(var a=n,l=r,u=e,p=l;;)if(If(a,p,u),p.child!==null&&p.tag!==4)p.child.return=p,p=p.child;else{if(p===l)break t;for(;p.sibling===null;){if(p.return===null||p.return===l)break t;p=p.return}p.sibling.return=p.return,p=p.sibling}s?(a=o,l=r.stateNode,a.nodeType===8?a.parentNode.removeChild(l):a.removeChild(l)):o.removeChild(r.stateNode)}else if(r.tag===4){if(r.child!==null){o=r.stateNode.containerInfo,s=!0,r.child.return=r,r=r.child;continue}}else if(If(n,r,e),r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return,r.tag===4&&(i=!1)}r.sibling.return=r.return,r=r.sibling}}function Tl(n,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:zg(3,t);return;case 1:return;case 5:var e=t.stateNode;if(e!=null){var r=t.memoizedProps,i=n!==null?n.memoizedProps:r;n=t.type;var o=t.updateQueue;if(t.updateQueue=null,o!==null){for(e[la]=r,n==="input"&&r.type==="radio"&&r.name!=null&&Cp(e,r),iu(n,i),t=iu(n,r),i=0;i<o.length;i+=2){var s=o[i],a=o[i+1];s==="style"?Hp(e,a):s==="dangerouslySetInnerHTML"?Ap(e,a):s==="children"?Ro(e,a):oc(e,s,a,t)}switch(n){case"input":Ql(e,r);break;case"textarea":Ep(e,r);break;case"select":t=e._wrapperState.wasMultiple,e._wrapperState.wasMultiple=!!r.multiple,n=r.value,n!=null?ki(e,!!r.multiple,n,!1):t!==!!r.multiple&&(r.defaultValue!=null?ki(e,!!r.multiple,r.defaultValue,!0):ki(e,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(t.stateNode===null)throw Error(Ut(162));t.stateNode.nodeValue=t.memoizedProps;return;case 3:t=t.stateNode,t.hydrate&&(t.hydrate=!1,Vp(t.containerInfo));return;case 12:return;case 13:if(e=t,t.memoizedState===null?r=!1:(r=!0,e=t.child,Wc=xn()),e!==null)t:for(n=e;;){if(n.tag===5)o=n.stateNode,r?(o=o.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(o=n.stateNode,i=n.memoizedProps.style,i=i!=null&&i.hasOwnProperty("display")?i.display:null,o.style.display=$p("display",i));else if(n.tag===6)n.stateNode.nodeValue=r?"":n.memoizedProps;else if(n.tag===13&&n.memoizedState!==null&&n.memoizedState.dehydrated===null){o=n.child.sibling,o.return=n,n=o;continue}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)break t;n=n.return}n.sibling.return=n.return,n=n.sibling}xf(t);return;case 19:xf(t);return;case 17:return}throw Error(Ut(163))}function xf(n){var t=n.updateQueue;if(t!==null){n.updateQueue=null;var e=n.stateNode;e===null&&(e=n.stateNode=new $M),t.forEach(function(r){var i=o1.bind(null,n,r);e.has(r)||(e.add(r),r.then(i,i))})}}var KM=typeof WeakMap=="function"?WeakMap:Map;function Ug(n,t,e){e=Lr(e,null),e.tag=3,e.payload={element:null};var r=t.value;return e.callback=function(){Ca||(Ca=!0,Cu=r),wu(n,t)},e}function Yg(n,t,e){e=Lr(e,null),e.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=t.value;e.payload=function(){return wu(n,t),r(i)}}var o=n.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(e.callback=function(){typeof r!="function"&&(br===null?br=new Set([this]):br.add(this),wu(n,t));var s=t.stack;this.componentDidCatch(t.value,{componentStack:s!==null?s:""})}),e}var JM=Math.ceil,Ta=zn.ReactCurrentDispatcher,Fg=zn.ReactCurrentOwner,Be=0,kc=8,kn=16,Jn=32,ri=0,Ia=1,Vg=2,wa=3,Fa=4,Bc=5,ne=Be,vn=null,ie=null,un=0,ke=ri,Va=null,cr=1073741823,Fo=1073741823,Sa=null,Vo=0,xa=!1,Wc=0,Xg=500,Gt=null,Ca=!1,Cu=null,br=null,Ea=!1,Do=null,Io=90,qr=null,Lo=0,Eu=null,Ys=0;function Kn(){return(ne&(kn|Jn))!==Be?1073741821-(xn()/10|0):Ys!==0?Ys:Ys=1073741821-(xn()/10|0)}function ii(n,t,e){if(t=t.mode,!(t&2))return 1073741823;var r=Ua();if(!(t&4))return r===99?1073741823:1073741822;if((ne&kn)!==Be)return un;if(e!==null)n=Ws(n,e.timeoutMs|0||5e3,250);else switch(r){case 99:n=1073741823;break;case 98:n=Ws(n,150,100);break;case 97:case 96:n=Ws(n,5e3,250);break;case 95:n=2;break;default:throw Error(Ut(326))}return vn!==null&&n===un&&--n,n}function Rr(n,t){if(50<Lo)throw Lo=0,Eu=null,Error(Ut(185));if(n=Xa(n,t),n!==null){var e=Ua();t===1073741823?(ne&kc)!==Be&&(ne&(kn|Jn))===Be?Pu(n):(yn(n),ne===Be&&qn()):yn(n),(ne&4)===Be||e!==98&&e!==99||(qr===null?qr=new Map([[n,t]]):(e=qr.get(n),(e===void 0||e>t)&&qr.set(n,t)))}}function Xa(n,t){n.expirationTime<t&&(n.expirationTime=t);var e=n.alternate;e!==null&&e.expirationTime<t&&(e.expirationTime=t);var r=n.return,i=null;if(r===null&&n.tag===3)i=n.stateNode;else for(;r!==null;){if(e=r.alternate,r.childExpirationTime<t&&(r.childExpirationTime=t),e!==null&&e.childExpirationTime<t&&(e.childExpirationTime=t),r.return===null&&r.tag===3){i=r.stateNode;break}r=r.return}return i!==null&&(vn===i&&(Ga(t),ke===Fa&&ti(i,un)),em(i,t)),i}function Fs(n){var t=n.lastExpiredTime;if(t!==0||(t=n.firstPendingTime,!tm(n,t)))return t;var e=n.lastPingedTime;return n=n.nextKnownPendingLevel,n=e>n?e:n,2>=n&&t!==n?0:n}function yn(n){if(n.lastExpiredTime!==0)n.callbackExpirationTime=1073741823,n.callbackPriority=99,n.callbackNode=nf(Pu.bind(null,n));else{var t=Fs(n),e=n.callbackNode;if(t===0)e!==null&&(n.callbackNode=null,n.callbackExpirationTime=0,n.callbackPriority=90);else{var r=Kn();if(t===1073741823?r=99:t===1||t===2?r=95:(r=10*(1073741821-t)-10*(1073741821-r),r=0>=r?99:250>=r?98:5250>=r?97:95),e!==null){var i=n.callbackPriority;if(n.callbackExpirationTime===t&&i>=r)return;e!==mg&&hg(e)}n.callbackExpirationTime=t,n.callbackPriority=r,t=t===1073741823?nf(Pu.bind(null,n)):yg(r,Gg.bind(null,n),{timeout:10*(1073741821-t)-xn()}),n.callbackNode=t}}}function Gg(n,t){if(Ys=0,t)return t=Kn(),Lu(n,t),yn(n),null;var e=Fs(n);if(e!==0){if(t=n.callbackNode,(ne&(kn|Jn))!==Be)throw Error(Ut(327));if(Ki(),n===vn&&e===un||_r(n,e),ie!==null){var r=ne;ne|=kn;var i=Zg();do try{t1();break}catch(a){Qg(n,a)}while(!0);if(xc(),ne=r,Ta.current=i,ke===Ia)throw t=Va,_r(n,e),ti(n,e),yn(n),t;if(ie===null)switch(i=n.finishedWork=n.current.alternate,n.finishedExpirationTime=e,r=ke,vn=null,r){case ri:case Ia:throw Error(Ut(345));case Vg:Lu(n,2<e?2:e);break;case wa:if(ti(n,e),r=n.lastSuspendedTime,e===r&&(n.nextKnownPendingLevel=Nu(i)),cr===1073741823&&(i=Wc+Xg-xn(),10<i)){if(xa){var o=n.lastPingedTime;if(o===0||o>=e){n.lastPingedTime=e,_r(n,e);break}}if(o=Fs(n),o!==0&&o!==e)break;if(r!==0&&r!==e){n.lastPingedTime=r;break}n.timeoutHandle=pl(Xr.bind(null,n),i);break}Xr(n);break;case Fa:if(ti(n,e),r=n.lastSuspendedTime,e===r&&(n.nextKnownPendingLevel=Nu(i)),xa&&(i=n.lastPingedTime,i===0||i>=e)){n.lastPingedTime=e,_r(n,e);break}if(i=Fs(n),i!==0&&i!==e)break;if(r!==0&&r!==e){n.lastPingedTime=r;break}if(Fo!==1073741823?r=10*(1073741821-Fo)-xn():cr===1073741823?r=0:(r=10*(1073741821-cr)-5e3,i=xn(),e=10*(1073741821-e)-i,r=i-r,0>r&&(r=0),r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*JM(r/1960))-r,e<r&&(r=e)),10<r){n.timeoutHandle=pl(Xr.bind(null,n),r);break}Xr(n);break;case Bc:if(cr!==1073741823&&Sa!==null){o=cr;var s=Sa;if(r=s.busyMinDurationMs|0,0>=r?r=0:(i=s.busyDelayMs|0,o=xn()-(10*(1073741821-o)-(s.timeoutMs|0||5e3)),r=o<=i?0:i+r-o),10<r){ti(n,e),n.timeoutHandle=pl(Xr.bind(null,n),r);break}}Xr(n);break;default:throw Error(Ut(329))}if(yn(n),n.callbackNode===t)return Gg.bind(null,n)}}return null}function Pu(n){var t=n.lastExpiredTime;if(t=t!==0?t:1073741823,(ne&(kn|Jn))!==Be)throw Error(Ut(327));if(Ki(),n===vn&&t===un||_r(n,t),ie!==null){var e=ne;ne|=kn;var r=Zg();do try{_M();break}catch(i){Qg(n,i)}while(!0);if(xc(),ne=e,Ta.current=r,ke===Ia)throw e=Va,_r(n,t),ti(n,t),yn(n),e;if(ie!==null)throw Error(Ut(261));n.finishedWork=n.current.alternate,n.finishedExpirationTime=t,vn=null,Xr(n),yn(n)}return null}function qM(){if(qr!==null){var n=qr;qr=null,n.forEach(function(t,e){Lu(e,t),yn(e)}),qn()}}function $g(n,t){var e=ne;ne|=1;try{return n(t)}finally{ne=e,ne===Be&&qn()}}function Hg(n,t){var e=ne;ne&=-2,ne|=kc;try{return n(t)}finally{ne=e,ne===Be&&qn()}}function _r(n,t){n.finishedWork=null,n.finishedExpirationTime=0;var e=n.timeoutHandle;if(e!==-1&&(n.timeoutHandle=-1,Jy(e)),ie!==null)for(e=ie.return;e!==null;){var r=e;switch(r.tag){case 1:r=r.type.childContextTypes,r!=null&&ca();break;case 3:$i(),Ie(an),Ie(Ke);break;case 5:Ac(r);break;case 4:$i();break;case 13:Ie(Pe);break;case 19:Ie(Pe);break;case 10:Cc(r)}e=e.return}vn=n,ie=fi(n.current,null),un=t,ke=ri,Va=null,Fo=cr=1073741823,Sa=null,Vo=0,xa=!1}function Qg(n,t){do{try{if(xc(),Us.current=Ma,ma)for(var e=je.memoizedState;e!==null;){var r=e.queue;r!==null&&(r.pending=null),e=e.next}if(xr=0,Qe=He=je=null,ma=!1,ie===null||ie.return===null)return ke=Ia,Va=t,ie=null;t:{var i=n,o=ie.return,s=ie,a=t;if(t=un,s.effectTag|=2048,s.firstEffect=s.lastEffect=null,a!==null&&typeof a=="object"&&typeof a.then=="function"){var l=a;if(!(s.mode&2)){var u=s.alternate;u?(s.updateQueue=u.updateQueue,s.memoizedState=u.memoizedState,s.expirationTime=u.expirationTime):(s.updateQueue=null,s.memoizedState=null)}var p=(Pe.current&1)!==0,c=o;do{var g;if(g=c.tag===13){var v=c.memoizedState;if(v!==null)g=v.dehydrated!==null;else{var I=c.memoizedProps;g=I.fallback===void 0?!1:I.unstable_avoidThisFallback!==!0?!0:!p}}if(g){var w=c.updateQueue;if(w===null){var y=new Set;y.add(l),c.updateQueue=y}else w.add(l);if(!(c.mode&2)){if(c.effectTag|=64,s.effectTag&=-2981,s.tag===1)if(s.alternate===null)s.tag=17;else{var T=Lr(1073741823,null);T.tag=2,Or(s,T)}s.expirationTime=1073741823;break t}a=void 0,s=t;var h=i.pingCache;if(h===null?(h=i.pingCache=new KM,a=new Set,h.set(l,a)):(a=h.get(l),a===void 0&&(a=new Set,h.set(l,a))),!a.has(s)){a.add(s);var m=i1.bind(null,i,l,s);l.then(m,m)}c.effectTag|=4096,c.expirationTime=t;break t}c=c.return}while(c!==null);a=Error((dr(s.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`+lc(s))}ke!==Bc&&(ke=Vg),a=zc(a,s),c=o;do{switch(c.tag){case 3:l=a,c.effectTag|=4096,c.expirationTime=t;var d=Ug(c,l,t);rf(c,d);break t;case 1:l=a;var M=c.type,x=c.stateNode;if(!(c.effectTag&64)&&(typeof M.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(br===null||!br.has(x)))){c.effectTag|=4096,c.expirationTime=t;var E=Yg(c,l,t);rf(c,E);break t}}c=c.return}while(c!==null)}ie=qg(ie)}catch(P){t=P;continue}break}while(!0)}function Zg(){var n=Ta.current;return Ta.current=Ma,n===null?Ma:n}function Kg(n,t){n<cr&&2<n&&(cr=n),t!==null&&n<Fo&&2<n&&(Fo=n,Sa=t)}function Ga(n){n>Vo&&(Vo=n)}function _M(){for(;ie!==null;)ie=Jg(ie)}function t1(){for(;ie!==null&&!BM();)ie=Jg(ie)}function Jg(n){var t=_g(n.alternate,n,un);return n.memoizedProps=n.pendingProps,t===null&&(t=qg(n)),Fg.current=null,t}function qg(n){ie=n;do{var t=ie.alternate;if(n=ie.return,ie.effectTag&2048){if(t=GM(ie),t!==null)return t.effectTag&=2047,t;n!==null&&(n.firstEffect=n.lastEffect=null,n.effectTag|=2048)}else{if(t=XM(t,ie,un),un===1||ie.childExpirationTime!==1){for(var e=0,r=ie.child;r!==null;){var i=r.expirationTime,o=r.childExpirationTime;i>e&&(e=i),o>e&&(e=o),r=r.sibling}ie.childExpirationTime=e}if(t!==null)return t;n!==null&&!(n.effectTag&2048)&&(n.firstEffect===null&&(n.firstEffect=ie.firstEffect),ie.lastEffect!==null&&(n.lastEffect!==null&&(n.lastEffect.nextEffect=ie.firstEffect),n.lastEffect=ie.lastEffect),1<ie.effectTag&&(n.lastEffect!==null?n.lastEffect.nextEffect=ie:n.firstEffect=ie,n.lastEffect=ie))}if(t=ie.sibling,t!==null)return t;ie=n}while(ie!==null);return ke===ri&&(ke=Bc),null}function Nu(n){var t=n.expirationTime;return n=n.childExpirationTime,t>n?t:n}function Xr(n){var t=Ua();return Br(99,e1.bind(null,n,t)),null}function e1(n,t){do Ki();while(Do!==null);if((ne&(kn|Jn))!==Be)throw Error(Ut(327));var e=n.finishedWork,r=n.finishedExpirationTime;if(e===null)return null;if(n.finishedWork=null,n.finishedExpirationTime=0,e===n.current)throw Error(Ut(177));n.callbackNode=null,n.callbackExpirationTime=0,n.callbackPriority=90,n.nextKnownPendingLevel=0;var i=Nu(e);if(n.firstPendingTime=i,r<=n.lastSuspendedTime?n.firstSuspendedTime=n.lastSuspendedTime=n.nextKnownPendingLevel=0:r<=n.firstSuspendedTime&&(n.firstSuspendedTime=r-1),r<=n.lastPingedTime&&(n.lastPingedTime=0),r<=n.lastExpiredTime&&(n.lastExpiredTime=0),n===vn&&(ie=vn=null,un=0),1<e.effectTag?e.lastEffect!==null?(e.lastEffect.nextEffect=e,i=e.firstEffect):i=e:i=e.firstEffect,i!==null){var o=ne;ne|=Jn,Fg.current=null,fl=bs;var s=Yh();if(su(s)){if("selectionStart"in s)var a={start:s.selectionStart,end:s.selectionEnd};else t:{a=(a=s.ownerDocument)&&a.defaultView||window;var l=a.getSelection&&a.getSelection();if(l&&l.rangeCount!==0){a=l.anchorNode;var u=l.anchorOffset,p=l.focusNode;l=l.focusOffset;try{a.nodeType,p.nodeType}catch{a=null;break t}var c=0,g=-1,v=-1,I=0,w=0,y=s,T=null;e:for(;;){for(var h;y!==a||u!==0&&y.nodeType!==3||(g=c+u),y!==p||l!==0&&y.nodeType!==3||(v=c+l),y.nodeType===3&&(c+=y.nodeValue.length),(h=y.firstChild)!==null;)T=y,y=h;for(;;){if(y===s)break e;if(T===a&&++I===u&&(g=c),T===p&&++w===l&&(v=c),(h=y.nextSibling)!==null)break;y=T,T=y.parentNode}y=h}a=g===-1||v===-1?null:{start:g,end:v}}else a=null}a=a||{start:0,end:0}}else a=null;dl={activeElementDetached:null,focusedElem:s,selectionRange:a},bs=!1,Gt=i;do try{n1()}catch(R){if(Gt===null)throw Error(Ut(330));oi(Gt,R),Gt=Gt.nextEffect}while(Gt!==null);Gt=i;do try{for(s=n,a=t;Gt!==null;){var m=Gt.effectTag;if(m&16&&Ro(Gt.stateNode,""),m&128){var d=Gt.alternate;if(d!==null){var M=d.ref;M!==null&&(typeof M=="function"?M(null):M.current=null)}}switch(m&1038){case 2:Sf(Gt),Gt.effectTag&=-3;break;case 6:Sf(Gt),Gt.effectTag&=-3,Tl(Gt.alternate,Gt);break;case 1024:Gt.effectTag&=-1025;break;case 1028:Gt.effectTag&=-1025,Tl(Gt.alternate,Gt);break;case 4:Tl(Gt.alternate,Gt);break;case 8:u=Gt,Wg(s,u,a),Bg(u)}Gt=Gt.nextEffect}}catch(R){if(Gt===null)throw Error(Ut(330));oi(Gt,R),Gt=Gt.nextEffect}while(Gt!==null);if(M=dl,d=Yh(),m=M.focusedElem,a=M.selectionRange,d!==m&&m&&m.ownerDocument&&Qp(m.ownerDocument.documentElement,m)){for(a!==null&&su(m)&&(d=a.start,M=a.end,M===void 0&&(M=d),"selectionStart"in m?(m.selectionStart=d,m.selectionEnd=Math.min(M,m.value.length)):(M=(d=m.ownerDocument||document)&&d.defaultView||window,M.getSelection&&(M=M.getSelection(),u=m.textContent.length,s=Math.min(a.start,u),a=a.end===void 0?s:Math.min(a.end,u),!M.extend&&s>a&&(u=a,a=s,s=u),u=Uh(m,s),p=Uh(m,a),u&&p&&(M.rangeCount!==1||M.anchorNode!==u.node||M.anchorOffset!==u.offset||M.focusNode!==p.node||M.focusOffset!==p.offset)&&(d=d.createRange(),d.setStart(u.node,u.offset),M.removeAllRanges(),s>a?(M.addRange(d),M.extend(p.node,p.offset)):(d.setEnd(p.node,p.offset),M.addRange(d)))))),d=[],M=m;M=M.parentNode;)M.nodeType===1&&d.push({element:M,left:M.scrollLeft,top:M.scrollTop});for(typeof m.focus=="function"&&m.focus(),m=0;m<d.length;m++)M=d[m],M.element.scrollLeft=M.left,M.element.scrollTop=M.top}bs=!!fl,dl=fl=null,n.current=e,Gt=i;do try{for(m=n;Gt!==null;){var x=Gt.effectTag;if(x&36&&ZM(m,Gt.alternate,Gt),x&128){d=void 0;var E=Gt.ref;if(E!==null){var P=Gt.stateNode;switch(Gt.tag){case 5:d=P;break;default:d=P}typeof E=="function"?E(d):E.current=d}}Gt=Gt.nextEffect}}catch(R){if(Gt===null)throw Error(Ut(330));oi(Gt,R),Gt=Gt.nextEffect}while(Gt!==null);Gt=null,WM(),ne=o}else n.current=e;if(Ea)Ea=!1,Do=n,Io=t;else for(Gt=i;Gt!==null;)t=Gt.nextEffect,Gt.nextEffect=null,Gt=t;if(t=n.firstPendingTime,t===0&&(br=null),t===1073741823?n===Eu?Lo++:(Lo=0,Eu=n):Lo=0,typeof Au=="function"&&Au(e.stateNode,r),yn(n),Ca)throw Ca=!1,n=Cu,Cu=null,n;return(ne&kc)!==Be||qn(),null}function n1(){for(;Gt!==null;){var n=Gt.effectTag;n&256&&QM(Gt.alternate,Gt),!(n&512)||Ea||(Ea=!0,yg(97,function(){return Ki(),null})),Gt=Gt.nextEffect}}function Ki(){if(Io!==90){var n=97<Io?97:Io;return Io=90,Br(n,r1)}}function r1(){if(Do===null)return!1;var n=Do;if(Do=null,(ne&(kn|Jn))!==Be)throw Error(Ut(331));var t=ne;for(ne|=Jn,n=n.current.firstEffect;n!==null;){try{var e=n;if(e.effectTag&512)switch(e.tag){case 0:case 11:case 15:case 22:zg(5,e),kg(5,e)}}catch(r){if(n===null)throw Error(Ut(330));oi(n,r)}e=n.nextEffect,n.nextEffect=null,n=e}return ne=t,qn(),!0}function Cf(n,t,e){t=zc(e,t),t=Ug(n,t,1073741823),Or(n,t),n=Xa(n,1073741823),n!==null&&yn(n)}function oi(n,t){if(n.tag===3)Cf(n,n,t);else for(var e=n.return;e!==null;){if(e.tag===3){Cf(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(br===null||!br.has(r))){n=zc(t,n),n=Yg(e,n,1073741823),Or(e,n),e=Xa(e,1073741823),e!==null&&yn(e);break}}e=e.return}}function i1(n,t,e){var r=n.pingCache;r!==null&&r.delete(t),vn===n&&un===e?ke===Fa||ke===wa&&cr===1073741823&&xn()-Wc<Xg?_r(n,un):xa=!0:tm(n,e)&&(t=n.lastPingedTime,t!==0&&t<e||(n.lastPingedTime=e,yn(n)))}function o1(n,t){var e=n.stateNode;e!==null&&e.delete(t),t=0,t===0&&(t=Kn(),t=ii(t,n,null)),n=Xa(n,t),n!==null&&yn(n)}var _g;_g=function(n,t,e){var r=t.expirationTime;if(n!==null){var i=t.pendingProps;if(n.memoizedProps!==i||an.current)Hn=!0;else{if(r<e){switch(Hn=!1,t.tag){case 3:mf(t),vl();break;case 5:if(lf(t),t.mode&4&&e!==1&&i.hidden)return t.expirationTime=t.childExpirationTime=1,null;break;case 1:ln(t.type)&&ks(t);break;case 4:gu(t,t.stateNode.containerInfo);break;case 10:r=t.memoizedProps.value,i=t.type._context,Le(ha,i._currentValue),i._currentValue=r;break;case 13:if(t.memoizedState!==null)return r=t.child.childExpirationTime,r!==0&&r>=e?vf(n,t,e):(Le(Pe,Pe.current&1),t=fr(n,t,e),t!==null?t.sibling:null);Le(Pe,Pe.current&1);break;case 19:if(r=t.childExpirationTime>=e,n.effectTag&64){if(r)return Mf(n,t,e);t.effectTag|=64}if(i=t.memoizedState,i!==null&&(i.rendering=null,i.tail=null),Le(Pe,Pe.current),!r)return null}return fr(n,t,e)}Hn=!1}}else Hn=!1;switch(t.expirationTime=0,t.tag){case 2:if(r=t.type,n!==null&&(n.alternate=null,t.alternate=null,t.effectTag|=2),n=t.pendingProps,i=Xi(t,Ke.current),Wi(t,e),i=Oc(null,t,r,n,i,e),t.effectTag|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,ln(r)){var o=!0;ks(t)}else o=!1;t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Ec(t);var s=r.getDerivedStateFromProps;typeof s=="function"&&pa(t,r,s,n),i.updater=Ya,t.stateNode=i,i._reactInternalFiber=t,pu(t,r,n,e),t=Tu(null,t,r,!0,o,e)}else t.tag=0,pn(null,t,i,e),t=t.child;return t;case 16:t:{if(i=t.elementType,n!==null&&(n.alternate=null,t.alternate=null,t.effectTag|=2),n=t.pendingProps,Ry(i),i._status!==1)throw i._result;switch(i=i._result,t.type=i,o=t.tag=l1(i),n=On(i,n),o){case 0:t=Mu(null,t,i,n,e);break t;case 1:t=gf(null,t,i,n,e);break t;case 11:t=df(null,t,i,n,e);break t;case 14:t=pf(null,t,i,On(i.type,n),r,e);break t}throw Error(Ut(306,i,""))}return t;case 0:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:On(r,i),Mu(n,t,r,i,e);case 1:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:On(r,i),gf(n,t,r,i,e);case 3:if(mf(t),r=t.updateQueue,n===null||r===null)throw Error(Ut(282));if(r=t.pendingProps,i=t.memoizedState,i=i!==null?i.element:null,Pc(n,t),Wo(t,r,null,e),r=t.memoizedState.element,r===i)vl(),t=fr(n,t,e);else{if((i=t.stateNode.hydrate)&&(Cr=Bi(t.stateNode.containerInfo.firstChild),hr=t,i=ni=!0),i)for(e=Nc(t,null,r,e),t.child=e;e;)e.effectTag=e.effectTag&-3|1024,e=e.sibling;else pn(n,t,r,e),vl();t=t.child}return t;case 5:return lf(t),n===null&&yu(t),r=t.type,i=t.pendingProps,o=n!==null?n.memoizedProps:null,s=i.children,au(r,i)?s=null:o!==null&&au(r,o)&&(t.effectTag|=16),Og(n,t),t.mode&4&&e!==1&&i.hidden?(t.expirationTime=t.childExpirationTime=1,t=null):(pn(n,t,s,e),t=t.child),t;case 6:return n===null&&yu(t),null;case 13:return vf(n,t,e);case 4:return gu(t,t.stateNode.containerInfo),r=t.pendingProps,n===null?t.child=Gi(t,null,r,e):pn(n,t,r,e),t.child;case 11:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:On(r,i),df(n,t,r,i,e);case 7:return pn(n,t,t.pendingProps,e),t.child;case 8:return pn(n,t,t.pendingProps.children,e),t.child;case 12:return pn(n,t,t.pendingProps.children,e),t.child;case 10:t:{r=t.type._context,i=t.pendingProps,s=t.memoizedProps,o=i.value;var a=t.type._context;if(Le(ha,a._currentValue),a._currentValue=o,s!==null)if(a=s.value,o=ci(a,o)?0:(typeof r._calculateChangedBits=="function"?r._calculateChangedBits(a,o):1073741823)|0,o===0){if(s.children===i.children&&!an.current){t=fr(n,t,e);break t}}else for(a=t.child,a!==null&&(a.return=t);a!==null;){var l=a.dependencies;if(l!==null){s=a.child;for(var u=l.firstContext;u!==null;){if(u.context===r&&u.observedBits&o){a.tag===1&&(u=Lr(e,null),u.tag=2,Or(a,u)),a.expirationTime<e&&(a.expirationTime=e),u=a.alternate,u!==null&&u.expirationTime<e&&(u.expirationTime=e),Tg(a.return,e),l.expirationTime<e&&(l.expirationTime=e);break}u=u.next}}else s=a.tag===10&&a.type===t.type?null:a.child;if(s!==null)s.return=a;else for(s=a;s!==null;){if(s===t){s=null;break}if(a=s.sibling,a!==null){a.return=s.return,s=a;break}s=s.return}a=s}pn(n,t,i.children,e),t=t.child}return t;case 9:return i=t.type,o=t.pendingProps,r=o.children,Wi(t,e),i=En(i,o.unstable_observedBits),r=r(i),t.effectTag|=1,pn(n,t,r,e),t.child;case 14:return i=t.type,o=On(i,t.pendingProps),o=On(i.type,o),pf(n,t,i,o,r,e);case 15:return Lg(n,t,t.type,t.pendingProps,r,e);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:On(r,i),n!==null&&(n.alternate=null,t.alternate=null,t.effectTag|=2),t.tag=1,ln(r)?(n=!0,ks(t)):n=!1,Wi(t,e),wg(t,r,i),pu(t,r,i,e),Tu(null,t,r,!0,n,e);case 19:return Mf(n,t,e)}throw Error(Ut(156,t.tag))};var Au=null,Du=null;function s1(n){if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)return!0;try{var e=t.inject(n);Au=function(r){try{t.onCommitFiberRoot(e,r,void 0,(r.current.effectTag&64)===64)}catch{}},Du=function(r){try{t.onCommitFiberUnmount(e,r)}catch{}}}catch{}return!0}function a1(n,t,e,r){this.tag=n,this.key=e,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function Qn(n,t,e,r){return new a1(n,t,e,r)}function Uc(n){return n=n.prototype,!(!n||!n.isReactComponent)}function l1(n){if(typeof n=="function")return Uc(n)?1:0;if(n!=null){if(n=n.$$typeof,n===sc)return 11;if(n===ac)return 14}return 2}function fi(n,t){var e=n.alternate;return e===null?(e=Qn(n.tag,t,n.key,n.mode),e.elementType=n.elementType,e.type=n.type,e.stateNode=n.stateNode,e.alternate=n,n.alternate=e):(e.pendingProps=t,e.effectTag=0,e.nextEffect=null,e.firstEffect=null,e.lastEffect=null),e.childExpirationTime=n.childExpirationTime,e.expirationTime=n.expirationTime,e.child=n.child,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,t=n.dependencies,e.dependencies=t===null?null:{expirationTime:t.expirationTime,firstContext:t.firstContext,responders:t.responders},e.sibling=n.sibling,e.index=n.index,e.ref=n.ref,e}function Vs(n,t,e,r,i,o){var s=2;if(r=n,typeof n=="function")Uc(n)&&(s=1);else if(typeof n=="string")s=5;else t:switch(n){case Hr:return Er(e.children,i,o,t);case by:s=8,i|=7;break;case yp:s=8,i|=1;break;case Ds:return n=Qn(12,e,t,i|8),n.elementType=Ds,n.type=Ds,n.expirationTime=o,n;case Ls:return n=Qn(13,e,t,i),n.type=Ls,n.elementType=Ls,n.expirationTime=o,n;case $l:return n=Qn(19,e,t,i),n.elementType=$l,n.expirationTime=o,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Mp:s=10;break t;case Tp:s=9;break t;case sc:s=11;break t;case ac:s=14;break t;case Ip:s=16,r=null;break t;case wp:s=22;break t}throw Error(Ut(130,n==null?n:typeof n,""))}return t=Qn(s,e,t,i),t.elementType=n,t.type=r,t.expirationTime=o,t}function Er(n,t,e,r){return n=Qn(7,n,r,t),n.expirationTime=e,n}function Il(n,t,e){return n=Qn(6,n,null,t),n.expirationTime=e,n}function wl(n,t,e){return t=Qn(4,n.children!==null?n.children:[],n.key,t),t.expirationTime=e,t.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},t}function u1(n,t,e){this.tag=t,this.current=null,this.containerInfo=n,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=e,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function tm(n,t){var e=n.firstSuspendedTime;return n=n.lastSuspendedTime,e!==0&&e>=t&&n<=t}function ti(n,t){var e=n.firstSuspendedTime,r=n.lastSuspendedTime;e<t&&(n.firstSuspendedTime=t),(r>t||e===0)&&(n.lastSuspendedTime=t),t<=n.lastPingedTime&&(n.lastPingedTime=0),t<=n.lastExpiredTime&&(n.lastExpiredTime=0)}function em(n,t){t>n.firstPendingTime&&(n.firstPendingTime=t);var e=n.firstSuspendedTime;e!==0&&(t>=e?n.firstSuspendedTime=n.lastSuspendedTime=n.nextKnownPendingLevel=0:t>=n.lastSuspendedTime&&(n.lastSuspendedTime=t+1),t>n.nextKnownPendingLevel&&(n.nextKnownPendingLevel=t))}function Lu(n,t){var e=n.lastExpiredTime;(e===0||e>t)&&(n.lastExpiredTime=t)}function Pa(n,t,e,r){var i=t.current,o=Kn(),s=Ao.suspense;o=ii(o,i,s);t:if(e){e=e._reactInternalFiber;e:{if(pi(e)!==e||e.tag!==1)throw Error(Ut(170));var a=e;do{switch(a.tag){case 3:a=a.stateNode.context;break e;case 1:if(ln(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break e}}a=a.return}while(a!==null);throw Error(Ut(171))}if(e.tag===1){var l=e.type;if(ln(l)){e=cg(e,l,a);break t}}e=a}else e=kr;return t.context===null?t.context=e:t.pendingContext=e,t=Lr(o,s),t.payload={element:n},r=r===void 0?null:r,r!==null&&(t.callback=r),Or(i,t),Rr(i,o),o}function Sl(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Ef(n,t){n=n.memoizedState,n!==null&&n.dehydrated!==null&&n.retryTime<t&&(n.retryTime=t)}function Yc(n,t){Ef(n,t),(n=n.alternate)&&Ef(n,t)}function Fc(n,t,e){e=e!=null&&e.hydrate===!0;var r=new u1(n,t,e),i=Qn(3,null,null,t===2?7:t===1?3:0);r.current=i,i.stateNode=r,Ec(i),n[Zo]=r.current,e&&t!==0&&Uy(n,n.nodeType===9?n:n.ownerDocument),this._internalRoot=r}Fc.prototype.render=function(n){Pa(n,this._internalRoot,null,null)};Fc.prototype.unmount=function(){var n=this._internalRoot,t=n.containerInfo;Pa(null,n,null,function(){t[Zo]=null})};function es(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function c1(n,t){if(t||(t=n?n.nodeType===9?n.documentElement:n.firstChild:null,t=!(!t||t.nodeType!==1||!t.hasAttribute("data-reactroot"))),!t)for(var e;e=n.lastChild;)n.removeChild(e);return new Fc(n,0,t?{hydrate:!0}:void 0)}function $a(n,t,e,r,i){var o=e._reactRootContainer;if(o){var s=o._internalRoot;if(typeof i=="function"){var a=i;i=function(){var u=Sl(s);a.call(u)}}Pa(t,s,n,i)}else{if(o=e._reactRootContainer=c1(e,r),s=o._internalRoot,typeof i=="function"){var l=i;i=function(){var u=Sl(s);l.call(u)}}Hg(function(){Pa(t,s,n,i)})}return Sl(s)}function h1(n,t,e){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Pi,key:r==null?null:""+r,children:n,containerInfo:t,implementation:e}}Yp=function(n){if(n.tag===13){var t=Ws(Kn(),150,100);Rr(n,t),Yc(n,t)}};fc=function(n){n.tag===13&&(Rr(n,3),Yc(n,3))};Fp=function(n){if(n.tag===13){var t=Kn();t=ii(t,n,null),Rr(n,t),Yc(n,t)}};Gl=function(n,t,e){switch(t){case"input":if(Ql(n,e),t=e.name,e.type==="radio"&&t!=null){for(e=n;e.parentNode;)e=e.parentNode;for(e=e.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<e.length;t++){var r=e[t];if(r!==n&&r.form===n.form){var i=Mc(r);if(!i)throw Error(Ut(90));xp(r),Ql(r,i)}}}break;case"textarea":Ep(n,e);break;case"select":t=e.value,t!=null&&ki(n,!!e.multiple,t,!1)}};tc=$g;gp=function(n,t,e,r,i){var o=ne;ne|=4;try{return Br(98,n.bind(null,t,e,r,i))}finally{ne=o,ne===Be&&qn()}};ec=function(){(ne&(1|kn|Jn))===Be&&(qM(),Ki())};mp=function(n,t){var e=ne;ne|=2;try{return n(t)}finally{ne=e,ne===Be&&qn()}};function nm(n,t){var e=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!es(t))throw Error(Ut(200));return h1(n,t,null,e)}var f1={Events:[Jo,ui,Mc,fp,Xl,Vi,function(n){cc(n,_y)},dp,pp,ka,za,Ki,{current:!1}]};(function(n){var t=n.findFiberByHostInstance;return s1(en({},n,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:zn.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=zp(e),e===null?null:e.stateNode},findFiberByHostInstance:function(e){return t?t(e):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))})({findFiberByHostInstance:Ko,bundleType:0,version:"16.14.0",rendererPackageName:"react-dom"});Pn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=f1;Pn.createPortal=nm;Pn.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var t=n._reactInternalFiber;if(t===void 0)throw typeof n.render=="function"?Error(Ut(188)):Error(Ut(268,Object.keys(n)));return n=zp(t),n=n===null?null:n.stateNode,n};Pn.flushSync=function(n,t){if((ne&(kn|Jn))!==Be)throw Error(Ut(187));var e=ne;ne|=1;try{return Br(99,n.bind(null,t))}finally{ne=e,qn()}};Pn.hydrate=function(n,t,e){if(!es(t))throw Error(Ut(200));return $a(null,n,t,!0,e)};Pn.render=function(n,t,e){if(!es(t))throw Error(Ut(200));return $a(null,n,t,!1,e)};Pn.unmountComponentAtNode=function(n){if(!es(n))throw Error(Ut(40));return n._reactRootContainer?(Hg(function(){$a(null,null,n,!1,function(){n._reactRootContainer=null,n[Zo]=null})}),!0):!1};Pn.unstable_batchedUpdates=$g;Pn.unstable_createPortal=function(n,t){return nm(n,t,2<arguments.length&&arguments[2]!==void 0?arguments[2]:null)};Pn.unstable_renderSubtreeIntoContainer=function(n,t,e,r){if(!es(e))throw Error(Ut(200));if(n==null||n._reactInternalFiber===void 0)throw Error(Ut(38));return $a(n,t,e,!1,r)};Pn.version="16.14.0";function rm(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(rm)}catch(n){console.error(n)}}rm(),sp.exports=Pn;var im=sp.exports;const Vc=Hi(im);var Ha={exports:{}},om={};const d1=l0(u0);var Ne={},_n={};Object.defineProperty(_n,"__esModule",{value:!0});_n.dontSetMe=y1;_n.findInArray=p1;_n.int=v1;_n.isFunction=g1;_n.isNum=m1;function p1(n,t){for(let e=0,r=n.length;e<r;e++)if(t.apply(t,[n[e],e,n]))return n[e]}function g1(n){return typeof n=="function"||Object.prototype.toString.call(n)==="[object Function]"}function m1(n){return typeof n=="number"&&!isNaN(n)}function v1(n){return parseInt(n,10)}function y1(n,t,e){if(n[t])return new Error(`Invalid prop ${t} passed to ${e} - do not set this, set it on the child.`)}var gi={};Object.defineProperty(gi,"__esModule",{value:!0});gi.browserPrefixToKey=am;gi.browserPrefixToStyle=M1;gi.default=void 0;gi.getPrefix=sm;const xl=["Moz","Webkit","O","ms"];function sm(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"transform";if(typeof window>"u")return"";const t=window.document?.documentElement?.style;if(!t||n in t)return"";for(let e=0;e<xl.length;e++)if(am(n,xl[e])in t)return xl[e];return""}function am(n,t){return t?`${t}${T1(n)}`:n}function M1(n,t){return t?`-${t.toLowerCase()}-${n}`:n}function T1(n){let t="",e=!0;for(let r=0;r<n.length;r++)e?(t+=n[r].toUpperCase(),e=!1):n[r]==="-"?e=!0:t+=n[r];return t}gi.default=sm();Object.defineProperty(Ne,"__esModule",{value:!0});Ne.addClassName=cm;Ne.addEvent=w1;Ne.addUserSelectStyles=b1;Ne.createCSSTransform=A1;Ne.createSVGTransform=D1;Ne.getTouch=L1;Ne.getTouchIdentifier=O1;Ne.getTranslation=Xc;Ne.innerHeight=E1;Ne.innerWidth=P1;Ne.matchesSelector=um;Ne.matchesSelectorAndParentsTo=I1;Ne.offsetXYFromParent=N1;Ne.outerHeight=x1;Ne.outerWidth=C1;Ne.removeClassName=hm;Ne.removeEvent=S1;Ne.scheduleRemoveUserSelectStyles=R1;var Mn=_n,Pf=lm(gi);function lm(n,t){if(typeof WeakMap=="function")var e=new WeakMap,r=new WeakMap;return(lm=function(i,o){if(!o&&i&&i.__esModule)return i;var s,a,l={__proto__:null,default:i};if(i===null||typeof i!="object"&&typeof i!="function")return l;if(s=o?r:e){if(s.has(i))return s.get(i);s.set(i,l)}for(const u in i)u!=="default"&&{}.hasOwnProperty.call(i,u)&&((a=(s=Object.defineProperty)&&Object.getOwnPropertyDescriptor(i,u))&&(a.get||a.set)?s(l,u,a):l[u]=i[u]);return l})(n,t)}let Is="";function um(n,t){return Is||(Is=(0,Mn.findInArray)(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"],function(e){return(0,Mn.isFunction)(n[e])})),(0,Mn.isFunction)(n[Is])?n[Is](t):!1}function I1(n,t,e){let r=n;do{if(um(r,t))return!0;if(r===e)return!1;r=r.parentNode}while(r);return!1}function w1(n,t,e,r){if(!n)return;const i={capture:!0,...r};n.addEventListener?n.addEventListener(t,e,i):n.attachEvent?n.attachEvent("on"+t,e):n["on"+t]=e}function S1(n,t,e,r){if(!n)return;const i={capture:!0,...r};n.removeEventListener?n.removeEventListener(t,e,i):n.detachEvent?n.detachEvent("on"+t,e):n["on"+t]=null}function x1(n){let t=n.clientHeight;const e=n.ownerDocument.defaultView.getComputedStyle(n);return t+=(0,Mn.int)(e.borderTopWidth),t+=(0,Mn.int)(e.borderBottomWidth),t}function C1(n){let t=n.clientWidth;const e=n.ownerDocument.defaultView.getComputedStyle(n);return t+=(0,Mn.int)(e.borderLeftWidth),t+=(0,Mn.int)(e.borderRightWidth),t}function E1(n){let t=n.clientHeight;const e=n.ownerDocument.defaultView.getComputedStyle(n);return t-=(0,Mn.int)(e.paddingTop),t-=(0,Mn.int)(e.paddingBottom),t}function P1(n){let t=n.clientWidth;const e=n.ownerDocument.defaultView.getComputedStyle(n);return t-=(0,Mn.int)(e.paddingLeft),t-=(0,Mn.int)(e.paddingRight),t}function N1(n,t,e){const i=t===t.ownerDocument.body?{left:0,top:0}:t.getBoundingClientRect(),o=(n.clientX+t.scrollLeft-i.left)/e,s=(n.clientY+t.scrollTop-i.top)/e;return{x:o,y:s}}function A1(n,t){const e=Xc(n,t,"px");return{[(0,Pf.browserPrefixToKey)("transform",Pf.default)]:e}}function D1(n,t){return Xc(n,t,"")}function Xc(n,t,e){let{x:r,y:i}=n,o=`translate(${r}${e},${i}${e})`;if(t){const s=`${typeof t.x=="string"?t.x:t.x+e}`,a=`${typeof t.y=="string"?t.y:t.y+e}`;o=`translate(${s}, ${a})`+o}return o}function L1(n,t){return n.targetTouches&&(0,Mn.findInArray)(n.targetTouches,e=>t===e.identifier)||n.changedTouches&&(0,Mn.findInArray)(n.changedTouches,e=>t===e.identifier)}function O1(n){if(n.targetTouches&&n.targetTouches[0])return n.targetTouches[0].identifier;if(n.changedTouches&&n.changedTouches[0])return n.changedTouches[0].identifier}function b1(n){if(!n)return;let t=n.getElementById("react-draggable-style-el");t||(t=n.createElement("style"),t.type="text/css",t.id="react-draggable-style-el",t.innerHTML=`.react-draggable-transparent-selection *::-moz-selection {all: inherit;}
`,t.innerHTML+=`.react-draggable-transparent-selection *::selection {all: inherit;}
`,n.getElementsByTagName("head")[0].appendChild(t)),n.body&&cm(n.body,"react-draggable-transparent-selection")}function R1(n){window.requestAnimationFrame?window.requestAnimationFrame(()=>{Nf(n)}):Nf(n)}function Nf(n){if(n)try{if(n.body&&hm(n.body,"react-draggable-transparent-selection"),n.selection)n.selection.empty();else{const t=(n.defaultView||window).getSelection();t&&t.type!=="Caret"&&t.removeAllRanges()}}catch{}}function cm(n,t){n.classList?n.classList.add(t):n.className.match(new RegExp(`(?:^|\\s)${t}(?!\\S)`))||(n.className+=` ${t}`)}function hm(n,t){n.classList?n.classList.remove(t):n.className=n.className.replace(new RegExp(`(?:^|\\s)${t}(?!\\S)`,"g"),"")}var tr={};Object.defineProperty(tr,"__esModule",{value:!0});tr.canDragX=k1;tr.canDragY=B1;tr.createCoreData=U1;tr.createDraggableData=Y1;tr.getBoundPosition=j1;tr.getControlPosition=W1;tr.snapToGrid=z1;var dn=_n,bi=Ne;function j1(n,t,e){if(!n.props.bounds)return[t,e];let{bounds:r}=n.props;r=typeof r=="string"?r:F1(r);const i=Gc(n);if(typeof r=="string"){const{ownerDocument:o}=i,s=o.defaultView;let a;if(r==="parent"?a=i.parentNode:a=i.getRootNode().querySelector(r),!(a instanceof s.HTMLElement))throw new Error('Bounds selector "'+r+'" could not find an element.');const l=a,u=s.getComputedStyle(i),p=s.getComputedStyle(l);r={left:-i.offsetLeft+(0,dn.int)(p.paddingLeft)+(0,dn.int)(u.marginLeft),top:-i.offsetTop+(0,dn.int)(p.paddingTop)+(0,dn.int)(u.marginTop),right:(0,bi.innerWidth)(l)-(0,bi.outerWidth)(i)-i.offsetLeft+(0,dn.int)(p.paddingRight)-(0,dn.int)(u.marginRight),bottom:(0,bi.innerHeight)(l)-(0,bi.outerHeight)(i)-i.offsetTop+(0,dn.int)(p.paddingBottom)-(0,dn.int)(u.marginBottom)}}return(0,dn.isNum)(r.right)&&(t=Math.min(t,r.right)),(0,dn.isNum)(r.bottom)&&(e=Math.min(e,r.bottom)),(0,dn.isNum)(r.left)&&(t=Math.max(t,r.left)),(0,dn.isNum)(r.top)&&(e=Math.max(e,r.top)),[t,e]}function z1(n,t,e){const r=Math.round(t/n[0])*n[0],i=Math.round(e/n[1])*n[1];return[r,i]}function k1(n){return n.props.axis==="both"||n.props.axis==="x"}function B1(n){return n.props.axis==="both"||n.props.axis==="y"}function W1(n,t,e){const r=typeof t=="number"?(0,bi.getTouch)(n,t):null;if(typeof t=="number"&&!r)return null;const i=Gc(e),o=e.props.offsetParent||i.offsetParent||i.ownerDocument.body;return(0,bi.offsetXYFromParent)(r||n,o,e.props.scale)}function U1(n,t,e){const r=!(0,dn.isNum)(n.lastX),i=Gc(n);return r?{node:i,deltaX:0,deltaY:0,lastX:t,lastY:e,x:t,y:e}:{node:i,deltaX:t-n.lastX,deltaY:e-n.lastY,lastX:n.lastX,lastY:n.lastY,x:t,y:e}}function Y1(n,t){const e=n.props.scale;return{node:t.node,x:n.state.x+t.deltaX/e,y:n.state.y+t.deltaY/e,deltaX:t.deltaX/e,deltaY:t.deltaY/e,lastX:n.state.x,lastY:n.state.y}}function F1(n){return{left:n.left,top:n.top,right:n.right,bottom:n.bottom}}function Gc(n){const t=n.findDOMNode();if(!t)throw new Error("<DraggableCore>: Unmounted during event!");return t}var Qa={},Za={};Object.defineProperty(Za,"__esModule",{value:!0});Za.default=V1;function V1(){}Object.defineProperty(Qa,"__esModule",{value:!0});Qa.default=void 0;var Cl=fm(Zr),qe=$c(Nd),X1=$c(Vu),$e=Ne,vr=tr,El=_n,go=$c(Za);function $c(n){return n&&n.__esModule?n:{default:n}}function fm(n,t){if(typeof WeakMap=="function")var e=new WeakMap,r=new WeakMap;return(fm=function(i,o){if(!o&&i&&i.__esModule)return i;var s,a,l={__proto__:null,default:i};if(i===null||typeof i!="object"&&typeof i!="function")return l;if(s=o?r:e){if(s.has(i))return s.get(i);s.set(i,l)}for(const u in i)u!=="default"&&{}.hasOwnProperty.call(i,u)&&((a=(s=Object.defineProperty)&&Object.getOwnPropertyDescriptor(i,u))&&(a.get||a.set)?s(l,u,a):l[u]=i[u]);return l})(n,t)}function _e(n,t,e){return(t=G1(t))in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function G1(n){var t=$1(n,"string");return typeof t=="symbol"?t:t+""}function $1(n,t){if(typeof n!="object"||!n)return n;var e=n[Symbol.toPrimitive];if(e!==void 0){var r=e.call(n,t);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}const An={touch:{start:"touchstart",move:"touchmove",stop:"touchend"},mouse:{start:"mousedown",move:"mousemove",stop:"mouseup"}};let yr=An.mouse,Ka=class extends Cl.Component{constructor(){super(...arguments),_e(this,"dragging",!1),_e(this,"lastX",NaN),_e(this,"lastY",NaN),_e(this,"touchIdentifier",null),_e(this,"mounted",!1),_e(this,"handleDragStart",t=>{if(this.props.onMouseDown(t),!this.props.allowAnyClick&&typeof t.button=="number"&&t.button!==0)return!1;const e=this.findDOMNode();if(!e||!e.ownerDocument||!e.ownerDocument.body)throw new Error("<DraggableCore> not mounted on DragStart!");const{ownerDocument:r}=e;if(this.props.disabled||!(t.target instanceof r.defaultView.Node)||this.props.handle&&!(0,$e.matchesSelectorAndParentsTo)(t.target,this.props.handle,e)||this.props.cancel&&(0,$e.matchesSelectorAndParentsTo)(t.target,this.props.cancel,e))return;t.type==="touchstart"&&!this.props.allowMobileScroll&&t.preventDefault();const i=(0,$e.getTouchIdentifier)(t);this.touchIdentifier=i;const o=(0,vr.getControlPosition)(t,i,this);if(o==null)return;const{x:s,y:a}=o,l=(0,vr.createCoreData)(this,s,a);(0,go.default)("DraggableCore: handleDragStart: %j",l),(0,go.default)("calling",this.props.onStart),!(this.props.onStart(t,l)===!1||this.mounted===!1)&&(this.props.enableUserSelectHack&&(0,$e.addUserSelectStyles)(r),this.dragging=!0,this.lastX=s,this.lastY=a,(0,$e.addEvent)(r,yr.move,this.handleDrag),(0,$e.addEvent)(r,yr.stop,this.handleDragStop))}),_e(this,"handleDrag",t=>{const e=(0,vr.getControlPosition)(t,this.touchIdentifier,this);if(e==null)return;let{x:r,y:i}=e;if(Array.isArray(this.props.grid)){let a=r-this.lastX,l=i-this.lastY;if([a,l]=(0,vr.snapToGrid)(this.props.grid,a,l),!a&&!l)return;r=this.lastX+a,i=this.lastY+l}const o=(0,vr.createCoreData)(this,r,i);if((0,go.default)("DraggableCore: handleDrag: %j",o),this.props.onDrag(t,o)===!1||this.mounted===!1){try{this.handleDragStop(new MouseEvent("mouseup"))}catch{const l=document.createEvent("MouseEvents");l.initMouseEvent("mouseup",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),this.handleDragStop(l)}return}this.lastX=r,this.lastY=i}),_e(this,"handleDragStop",t=>{if(!this.dragging)return;const e=(0,vr.getControlPosition)(t,this.touchIdentifier,this);if(e==null)return;let{x:r,y:i}=e;if(Array.isArray(this.props.grid)){let l=r-this.lastX||0,u=i-this.lastY||0;[l,u]=(0,vr.snapToGrid)(this.props.grid,l,u),r=this.lastX+l,i=this.lastY+u}const o=(0,vr.createCoreData)(this,r,i);if(this.props.onStop(t,o)===!1||this.mounted===!1)return!1;const a=this.findDOMNode();a&&this.props.enableUserSelectHack&&(0,$e.scheduleRemoveUserSelectStyles)(a.ownerDocument),(0,go.default)("DraggableCore: handleDragStop: %j",o),this.dragging=!1,this.lastX=NaN,this.lastY=NaN,a&&((0,go.default)("DraggableCore: Removing handlers"),(0,$e.removeEvent)(a.ownerDocument,yr.move,this.handleDrag),(0,$e.removeEvent)(a.ownerDocument,yr.stop,this.handleDragStop))}),_e(this,"onMouseDown",t=>(yr=An.mouse,this.handleDragStart(t))),_e(this,"onMouseUp",t=>(yr=An.mouse,this.handleDragStop(t))),_e(this,"onTouchStart",t=>(yr=An.touch,this.handleDragStart(t))),_e(this,"onTouchEnd",t=>(yr=An.touch,this.handleDragStop(t)))}componentDidMount(){this.mounted=!0;const t=this.findDOMNode();t&&(0,$e.addEvent)(t,An.touch.start,this.onTouchStart,{passive:!1})}componentWillUnmount(){this.mounted=!1;const t=this.findDOMNode();if(t){const{ownerDocument:e}=t;(0,$e.removeEvent)(e,An.mouse.move,this.handleDrag),(0,$e.removeEvent)(e,An.touch.move,this.handleDrag),(0,$e.removeEvent)(e,An.mouse.stop,this.handleDragStop),(0,$e.removeEvent)(e,An.touch.stop,this.handleDragStop),(0,$e.removeEvent)(t,An.touch.start,this.onTouchStart,{passive:!1}),this.props.enableUserSelectHack&&(0,$e.scheduleRemoveUserSelectStyles)(e)}}findDOMNode(){return this.props?.nodeRef?this.props?.nodeRef?.current:X1.default.findDOMNode(this)}render(){return Cl.cloneElement(Cl.Children.only(this.props.children),{onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onTouchEnd:this.onTouchEnd})}};Qa.default=Ka;_e(Ka,"displayName","DraggableCore");_e(Ka,"propTypes",{allowAnyClick:qe.default.bool,allowMobileScroll:qe.default.bool,children:qe.default.node.isRequired,disabled:qe.default.bool,enableUserSelectHack:qe.default.bool,offsetParent:function(n,t){if(n[t]&&n[t].nodeType!==1)throw new Error("Draggable's offsetParent must be a DOM Node.")},grid:qe.default.arrayOf(qe.default.number),handle:qe.default.string,cancel:qe.default.string,nodeRef:qe.default.object,onStart:qe.default.func,onDrag:qe.default.func,onStop:qe.default.func,onMouseDown:qe.default.func,scale:qe.default.number,className:El.dontSetMe,style:El.dontSetMe,transform:El.dontSetMe});_e(Ka,"defaultProps",{allowAnyClick:!1,allowMobileScroll:!1,disabled:!1,enableUserSelectHack:!0,onStart:function(){},onDrag:function(){},onStop:function(){},onMouseDown:function(){},scale:1});(function(n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"DraggableCore",{enumerable:!0,get:function(){return l.default}}),n.default=void 0;var t=c(Zr),e=p(Nd),r=p(Vu),i=d1,o=Ne,s=tr,a=_n,l=p(Qa),u=p(Za);function p(T){return T&&T.__esModule?T:{default:T}}function c(T,h){if(typeof WeakMap=="function")var m=new WeakMap,d=new WeakMap;return(c=function(M,x){if(!x&&M&&M.__esModule)return M;var E,P,R={__proto__:null,default:M};if(M===null||typeof M!="object"&&typeof M!="function")return R;if(E=x?d:m){if(E.has(M))return E.get(M);E.set(M,R)}for(const N in M)N!=="default"&&{}.hasOwnProperty.call(M,N)&&((P=(E=Object.defineProperty)&&Object.getOwnPropertyDescriptor(M,N))&&(P.get||P.set)?E(R,N,P):R[N]=M[N]);return R})(T,h)}function g(){return g=Object.assign?Object.assign.bind():function(T){for(var h=1;h<arguments.length;h++){var m=arguments[h];for(var d in m)({}).hasOwnProperty.call(m,d)&&(T[d]=m[d])}return T},g.apply(null,arguments)}function v(T,h,m){return(h=I(h))in T?Object.defineProperty(T,h,{value:m,enumerable:!0,configurable:!0,writable:!0}):T[h]=m,T}function I(T){var h=w(T,"string");return typeof h=="symbol"?h:h+""}function w(T,h){if(typeof T!="object"||!T)return T;var m=T[Symbol.toPrimitive];if(m!==void 0){var d=m.call(T,h);if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(h==="string"?String:Number)(T)}class y extends t.Component{static getDerivedStateFromProps(h,m){let{position:d}=h,{prevPropsPosition:M}=m;return d&&(!M||d.x!==M.x||d.y!==M.y)?((0,u.default)("Draggable: getDerivedStateFromProps %j",{position:d,prevPropsPosition:M}),{x:d.x,y:d.y,prevPropsPosition:{...d}}):null}constructor(h){super(h),v(this,"onDragStart",(m,d)=>{if((0,u.default)("Draggable: onDragStart: %j",d),this.props.onStart(m,(0,s.createDraggableData)(this,d))===!1)return!1;this.setState({dragging:!0,dragged:!0})}),v(this,"onDrag",(m,d)=>{if(!this.state.dragging)return!1;(0,u.default)("Draggable: onDrag: %j",d);const M=(0,s.createDraggableData)(this,d),x={x:M.x,y:M.y,slackX:0,slackY:0};if(this.props.bounds){const{x:P,y:R}=x;x.x+=this.state.slackX,x.y+=this.state.slackY;const[N,b]=(0,s.getBoundPosition)(this,x.x,x.y);x.x=N,x.y=b,x.slackX=this.state.slackX+(P-x.x),x.slackY=this.state.slackY+(R-x.y),M.x=x.x,M.y=x.y,M.deltaX=x.x-this.state.x,M.deltaY=x.y-this.state.y}if(this.props.onDrag(m,M)===!1)return!1;this.setState(x)}),v(this,"onDragStop",(m,d)=>{if(!this.state.dragging||this.props.onStop(m,(0,s.createDraggableData)(this,d))===!1)return!1;(0,u.default)("Draggable: onDragStop: %j",d);const x={dragging:!1,slackX:0,slackY:0};if(!!this.props.position){const{x:P,y:R}=this.props.position;x.x=P,x.y=R}this.setState(x)}),this.state={dragging:!1,dragged:!1,x:h.position?h.position.x:h.defaultPosition.x,y:h.position?h.position.y:h.defaultPosition.y,prevPropsPosition:{...h.position},slackX:0,slackY:0,isElementSVG:!1},h.position&&!(h.onDrag||h.onStop)&&console.warn("A `position` was applied to this <Draggable>, without drag handlers. This will make this component effectively undraggable. Please attach `onDrag` or `onStop` handlers so you can adjust the `position` of this element.")}componentDidMount(){typeof window.SVGElement<"u"&&this.findDOMNode()instanceof window.SVGElement&&this.setState({isElementSVG:!0})}componentWillUnmount(){this.state.dragging&&this.setState({dragging:!1})}findDOMNode(){return this.props?.nodeRef?.current??r.default.findDOMNode(this)}render(){const{axis:h,bounds:m,children:d,defaultPosition:M,defaultClassName:x,defaultClassNameDragging:E,defaultClassNameDragged:P,position:R,positionOffset:N,scale:b,...j}=this.props;let O={},L=null;const H=!!!R||this.state.dragging,Q=R||M,_={x:(0,s.canDragX)(this)&&H?this.state.x:Q.x,y:(0,s.canDragY)(this)&&H?this.state.y:Q.y};this.state.isElementSVG?L=(0,o.createSVGTransform)(_,N):O=(0,o.createCSSTransform)(_,N);const st=(0,i.clsx)(d.props.className||"",x,{[E]:this.state.dragging,[P]:this.state.dragged});return t.createElement(l.default,g({},j,{onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop}),t.cloneElement(t.Children.only(d),{className:st,style:{...d.props.style,...O},transform:L}))}}n.default=y,v(y,"displayName","Draggable"),v(y,"propTypes",{...l.default.propTypes,axis:e.default.oneOf(["both","x","y","none"]),bounds:e.default.oneOfType([e.default.shape({left:e.default.number,right:e.default.number,top:e.default.number,bottom:e.default.number}),e.default.string,e.default.oneOf([!1])]),defaultClassName:e.default.string,defaultClassNameDragging:e.default.string,defaultClassNameDragged:e.default.string,defaultPosition:e.default.shape({x:e.default.number,y:e.default.number}),positionOffset:e.default.shape({x:e.default.oneOfType([e.default.number,e.default.string]),y:e.default.oneOfType([e.default.number,e.default.string])}),position:e.default.shape({x:e.default.number,y:e.default.number}),className:a.dontSetMe,style:a.dontSetMe,transform:a.dontSetMe}),v(y,"defaultProps",{...l.default.defaultProps,axis:"both",bounds:!1,defaultClassName:"react-draggable",defaultClassNameDragging:"react-draggable-dragging",defaultClassNameDragged:"react-draggable-dragged",defaultPosition:{x:0,y:0},scale:1})})(om);const{default:dm,DraggableCore:H1}=om;Ha.exports=dm;Ha.exports.default=dm;Ha.exports.DraggableCore=H1;var Q1=Ha.exports;const Ji=Hi(Q1);var Oe=function(){return Oe=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Oe.apply(this,arguments)},Af={width:"100%",height:"10px",top:"0px",left:"0px",cursor:"row-resize"},Df={width:"10px",height:"100%",top:"0px",left:"0px",cursor:"col-resize"},ws={width:"20px",height:"20px",position:"absolute",zIndex:1},Z1={top:Oe(Oe({},Af),{top:"-5px"}),right:Oe(Oe({},Df),{left:void 0,right:"-5px"}),bottom:Oe(Oe({},Af),{top:void 0,bottom:"-5px"}),left:Oe(Oe({},Df),{left:"-5px"}),topRight:Oe(Oe({},ws),{right:"-10px",top:"-10px",cursor:"ne-resize"}),bottomRight:Oe(Oe({},ws),{right:"-10px",bottom:"-10px",cursor:"se-resize"}),bottomLeft:Oe(Oe({},ws),{left:"-10px",bottom:"-10px",cursor:"sw-resize"}),topLeft:Oe(Oe({},ws),{left:"-10px",top:"-10px",cursor:"nw-resize"})},K1=Zr.memo(function(n){var t=n.onResizeStart,e=n.direction,r=n.children,i=n.replaceStyles,o=n.className,s=Zr.useCallback(function(u){t(u,e)},[t,e]),a=Zr.useCallback(function(u){t(u,e)},[t,e]),l=Zr.useMemo(function(){return Oe(Oe({position:"absolute",userSelect:"none"},Z1[e]),i??{})},[i,e]);return yo.jsx("div",{className:o||void 0,style:l,onMouseDown:s,onTouchStart:a,children:r})}),J1=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),Xn=function(){return Xn=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Xn.apply(this,arguments)},q1={width:"auto",height:"auto"},Ss=function(n,t,e){return Math.max(Math.min(n,e),t)},Lf=function(n,t,e){var r=Math.round(n/t);return r*t+e*(r-1)},Ii=function(n,t){return new RegExp(n,"i").test(t)},xs=function(n){return!!(n.touches&&n.touches.length)},_1=function(n){return!!((n.clientX||n.clientX===0)&&(n.clientY||n.clientY===0))},Of=function(n,t,e){e===void 0&&(e=0);var r=t.reduce(function(o,s,a){return Math.abs(s-n)<Math.abs(t[o]-n)?a:o},0),i=Math.abs(t[r]-n);return e===0||i<e?t[r]:n},Pl=function(n){return n=n.toString(),n==="auto"||n.endsWith("px")||n.endsWith("%")||n.endsWith("vh")||n.endsWith("vw")||n.endsWith("vmax")||n.endsWith("vmin")?n:"".concat(n,"px")},Cs=function(n,t,e,r){if(n&&typeof n=="string"){if(n.endsWith("px"))return Number(n.replace("px",""));if(n.endsWith("%")){var i=Number(n.replace("%",""))/100;return t*i}if(n.endsWith("vw")){var i=Number(n.replace("vw",""))/100;return e*i}if(n.endsWith("vh")){var i=Number(n.replace("vh",""))/100;return r*i}}return n},tT=function(n,t,e,r,i,o,s){return r=Cs(r,n.width,t,e),i=Cs(i,n.height,t,e),o=Cs(o,n.width,t,e),s=Cs(s,n.height,t,e),{maxWidth:typeof r>"u"?void 0:Number(r),maxHeight:typeof i>"u"?void 0:Number(i),minWidth:typeof o>"u"?void 0:Number(o),minHeight:typeof s>"u"?void 0:Number(s)}},eT=function(n){return Array.isArray(n)?n:[n,n]},nT=["as","ref","style","className","grid","gridGap","snap","bounds","boundsByDirection","size","defaultSize","minWidth","minHeight","maxWidth","maxHeight","lockAspectRatio","lockAspectRatioExtraWidth","lockAspectRatioExtraHeight","enable","handleStyles","handleClasses","handleWrapperStyle","handleWrapperClass","children","onResizeStart","onResize","onResizeStop","handleComponent","scale","resizeRatio","snapGap"],bf="__resizable_base__",rT=function(n){J1(t,n);function t(e){var r,i,o,s,a=n.call(this,e)||this;return a.ratio=1,a.resizable=null,a.parentLeft=0,a.parentTop=0,a.resizableLeft=0,a.resizableRight=0,a.resizableTop=0,a.resizableBottom=0,a.targetLeft=0,a.targetTop=0,a.delta={width:0,height:0},a.appendBase=function(){if(!a.resizable||!a.window)return null;var l=a.parentNode;if(!l)return null;var u=a.window.document.createElement("div");return u.style.width="100%",u.style.height="100%",u.style.position="absolute",u.style.transform="scale(0, 0)",u.style.left="0",u.style.flex="0 0 100%",u.classList?u.classList.add(bf):u.className+=bf,l.appendChild(u),u},a.removeBase=function(l){var u=a.parentNode;u&&u.removeChild(l)},a.state={isResizing:!1,width:(i=(r=a.propsSize)===null||r===void 0?void 0:r.width)!==null&&i!==void 0?i:"auto",height:(s=(o=a.propsSize)===null||o===void 0?void 0:o.height)!==null&&s!==void 0?s:"auto",direction:"right",original:{x:0,y:0,width:0,height:0},backgroundStyle:{height:"100%",width:"100%",backgroundColor:"rgba(0,0,0,0)",cursor:"auto",opacity:0,position:"fixed",zIndex:9999,top:"0",left:"0",bottom:"0",right:"0"},flexBasis:void 0},a.onResizeStart=a.onResizeStart.bind(a),a.onMouseMove=a.onMouseMove.bind(a),a.onMouseUp=a.onMouseUp.bind(a),a}return Object.defineProperty(t.prototype,"parentNode",{get:function(){return this.resizable?this.resizable.parentNode:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"window",{get:function(){return!this.resizable||!this.resizable.ownerDocument?null:this.resizable.ownerDocument.defaultView},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"propsSize",{get:function(){return this.props.size||this.props.defaultSize||q1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){var e=0,r=0;if(this.resizable&&this.window){var i=this.resizable.offsetWidth,o=this.resizable.offsetHeight,s=this.resizable.style.position;s!=="relative"&&(this.resizable.style.position="relative"),e=this.resizable.style.width!=="auto"?this.resizable.offsetWidth:i,r=this.resizable.style.height!=="auto"?this.resizable.offsetHeight:o,this.resizable.style.position=s}return{width:e,height:r}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sizeStyle",{get:function(){var e=this,r=this.props.size,i=function(a){var l;if(typeof e.state[a]>"u"||e.state[a]==="auto")return"auto";if(e.propsSize&&e.propsSize[a]&&(!((l=e.propsSize[a])===null||l===void 0)&&l.toString().endsWith("%"))){if(e.state[a].toString().endsWith("%"))return e.state[a].toString();var u=e.getParentSize(),p=Number(e.state[a].toString().replace("px","")),c=p/u[a]*100;return"".concat(c,"%")}return Pl(e.state[a])},o=r&&typeof r.width<"u"&&!this.state.isResizing?Pl(r.width):i("width"),s=r&&typeof r.height<"u"&&!this.state.isResizing?Pl(r.height):i("height");return{width:o,height:s}},enumerable:!1,configurable:!0}),t.prototype.getParentSize=function(){if(!this.parentNode)return this.window?{width:this.window.innerWidth,height:this.window.innerHeight}:{width:0,height:0};var e=this.appendBase();if(!e)return{width:0,height:0};var r=!1,i=this.parentNode.style.flexWrap;i!=="wrap"&&(r=!0,this.parentNode.style.flexWrap="wrap"),e.style.position="relative",e.style.minWidth="100%",e.style.minHeight="100%";var o={width:e.offsetWidth,height:e.offsetHeight};return r&&(this.parentNode.style.flexWrap=i),this.removeBase(e),o},t.prototype.bindEvents=function(){this.window&&(this.window.addEventListener("mouseup",this.onMouseUp),this.window.addEventListener("mousemove",this.onMouseMove),this.window.addEventListener("mouseleave",this.onMouseUp),this.window.addEventListener("touchmove",this.onMouseMove,{capture:!0,passive:!1}),this.window.addEventListener("touchend",this.onMouseUp))},t.prototype.unbindEvents=function(){this.window&&(this.window.removeEventListener("mouseup",this.onMouseUp),this.window.removeEventListener("mousemove",this.onMouseMove),this.window.removeEventListener("mouseleave",this.onMouseUp),this.window.removeEventListener("touchmove",this.onMouseMove,!0),this.window.removeEventListener("touchend",this.onMouseUp))},t.prototype.componentDidMount=function(){if(!(!this.resizable||!this.window)){var e=this.window.getComputedStyle(this.resizable);this.setState({width:this.state.width||this.size.width,height:this.state.height||this.size.height,flexBasis:e.flexBasis!=="auto"?e.flexBasis:void 0})}},t.prototype.componentWillUnmount=function(){this.window&&this.unbindEvents()},t.prototype.createSizeForCssProperty=function(e,r){var i=this.propsSize&&this.propsSize[r];return this.state[r]==="auto"&&this.state.original[r]===e&&(typeof i>"u"||i==="auto")?"auto":e},t.prototype.calculateNewMaxFromBoundary=function(e,r){var i=this.props.boundsByDirection,o=this.state.direction,s=i&&Ii("left",o),a=i&&Ii("top",o),l,u;if(this.props.bounds==="parent"){var p=this.parentNode;p&&(l=s?this.resizableRight-this.parentLeft:p.offsetWidth+(this.parentLeft-this.resizableLeft),u=a?this.resizableBottom-this.parentTop:p.offsetHeight+(this.parentTop-this.resizableTop))}else this.props.bounds==="window"?this.window&&(l=s?this.resizableRight:this.window.innerWidth-this.resizableLeft,u=a?this.resizableBottom:this.window.innerHeight-this.resizableTop):this.props.bounds&&(l=s?this.resizableRight-this.targetLeft:this.props.bounds.offsetWidth+(this.targetLeft-this.resizableLeft),u=a?this.resizableBottom-this.targetTop:this.props.bounds.offsetHeight+(this.targetTop-this.resizableTop));return l&&Number.isFinite(l)&&(e=e&&e<l?e:l),u&&Number.isFinite(u)&&(r=r&&r<u?r:u),{maxWidth:e,maxHeight:r}},t.prototype.calculateNewSizeFromDirection=function(e,r){var i=this.props.scale||1,o=eT(this.props.resizeRatio||1),s=o[0],a=o[1],l=this.state,u=l.direction,p=l.original,c=this.props,g=c.lockAspectRatio,v=c.lockAspectRatioExtraHeight,I=c.lockAspectRatioExtraWidth,w=p.width,y=p.height,T=v||0,h=I||0;return Ii("right",u)&&(w=p.width+(e-p.x)*s/i,g&&(y=(w-h)/this.ratio+T)),Ii("left",u)&&(w=p.width-(e-p.x)*s/i,g&&(y=(w-h)/this.ratio+T)),Ii("bottom",u)&&(y=p.height+(r-p.y)*a/i,g&&(w=(y-T)*this.ratio+h)),Ii("top",u)&&(y=p.height-(r-p.y)*a/i,g&&(w=(y-T)*this.ratio+h)),{newWidth:w,newHeight:y}},t.prototype.calculateNewSizeFromAspectRatio=function(e,r,i,o){var s=this.props,a=s.lockAspectRatio,l=s.lockAspectRatioExtraHeight,u=s.lockAspectRatioExtraWidth,p=typeof o.width>"u"?10:o.width,c=typeof i.width>"u"||i.width<0?e:i.width,g=typeof o.height>"u"?10:o.height,v=typeof i.height>"u"||i.height<0?r:i.height,I=l||0,w=u||0;if(a){var y=(g-I)*this.ratio+w,T=(v-I)*this.ratio+w,h=(p-w)/this.ratio+I,m=(c-w)/this.ratio+I,d=Math.max(p,y),M=Math.min(c,T),x=Math.max(g,h),E=Math.min(v,m);e=Ss(e,d,M),r=Ss(r,x,E)}else e=Ss(e,p,c),r=Ss(r,g,v);return{newWidth:e,newHeight:r}},t.prototype.setBoundingClientRect=function(){var e=1/(this.props.scale||1);if(this.props.bounds==="parent"){var r=this.parentNode;if(r){var i=r.getBoundingClientRect();this.parentLeft=i.left*e,this.parentTop=i.top*e}}if(this.props.bounds&&typeof this.props.bounds!="string"){var o=this.props.bounds.getBoundingClientRect();this.targetLeft=o.left*e,this.targetTop=o.top*e}if(this.resizable){var s=this.resizable.getBoundingClientRect(),a=s.left,l=s.top,u=s.right,p=s.bottom;this.resizableLeft=a*e,this.resizableRight=u*e,this.resizableTop=l*e,this.resizableBottom=p*e}},t.prototype.onResizeStart=function(e,r){if(!(!this.resizable||!this.window)){var i=0,o=0;if(e.nativeEvent&&_1(e.nativeEvent)?(i=e.nativeEvent.clientX,o=e.nativeEvent.clientY):e.nativeEvent&&xs(e.nativeEvent)&&(i=e.nativeEvent.touches[0].clientX,o=e.nativeEvent.touches[0].clientY),this.props.onResizeStart&&this.resizable){var s=this.props.onResizeStart(e,r,this.resizable);if(s===!1)return}this.props.size&&(typeof this.props.size.height<"u"&&this.props.size.height!==this.state.height&&this.setState({height:this.props.size.height}),typeof this.props.size.width<"u"&&this.props.size.width!==this.state.width&&this.setState({width:this.props.size.width})),this.ratio=typeof this.props.lockAspectRatio=="number"?this.props.lockAspectRatio:this.size.width/this.size.height;var a,l=this.window.getComputedStyle(this.resizable);if(l.flexBasis!=="auto"){var u=this.parentNode;if(u){var p=this.window.getComputedStyle(u).flexDirection;this.flexDir=p.startsWith("row")?"row":"column",a=l.flexBasis}}this.setBoundingClientRect(),this.bindEvents();var c={original:{x:i,y:o,width:this.size.width,height:this.size.height},isResizing:!0,backgroundStyle:Xn(Xn({},this.state.backgroundStyle),{cursor:this.window.getComputedStyle(e.target).cursor||"auto"}),direction:r,flexBasis:a};this.setState(c)}},t.prototype.onMouseMove=function(e){var r=this;if(!(!this.state.isResizing||!this.resizable||!this.window)){if(this.window.TouchEvent&&xs(e))try{e.preventDefault(),e.stopPropagation()}catch{}var i=this.props,o=i.maxWidth,s=i.maxHeight,a=i.minWidth,l=i.minHeight,u=xs(e)?e.touches[0].clientX:e.clientX,p=xs(e)?e.touches[0].clientY:e.clientY,c=this.state,g=c.direction,v=c.original,I=c.width,w=c.height,y=this.getParentSize(),T=tT(y,this.window.innerWidth,this.window.innerHeight,o,s,a,l);o=T.maxWidth,s=T.maxHeight,a=T.minWidth,l=T.minHeight;var h=this.calculateNewSizeFromDirection(u,p),m=h.newHeight,d=h.newWidth,M=this.calculateNewMaxFromBoundary(o,s);this.props.snap&&this.props.snap.x&&(d=Of(d,this.props.snap.x,this.props.snapGap)),this.props.snap&&this.props.snap.y&&(m=Of(m,this.props.snap.y,this.props.snapGap));var x=this.calculateNewSizeFromAspectRatio(d,m,{width:M.maxWidth,height:M.maxHeight},{width:a,height:l});if(d=x.newWidth,m=x.newHeight,this.props.grid){var E=Lf(d,this.props.grid[0],this.props.gridGap?this.props.gridGap[0]:0),P=Lf(m,this.props.grid[1],this.props.gridGap?this.props.gridGap[1]:0),R=this.props.snapGap||0,N=R===0||Math.abs(E-d)<=R?E:d,b=R===0||Math.abs(P-m)<=R?P:m;d=N,m=b}var j={width:d-v.width,height:m-v.height};if(this.delta=j,I&&typeof I=="string"){if(I.endsWith("%")){var O=d/y.width*100;d="".concat(O,"%")}else if(I.endsWith("vw")){var L=d/this.window.innerWidth*100;d="".concat(L,"vw")}else if(I.endsWith("vh")){var k=d/this.window.innerHeight*100;d="".concat(k,"vh")}}if(w&&typeof w=="string"){if(w.endsWith("%")){var O=m/y.height*100;m="".concat(O,"%")}else if(w.endsWith("vw")){var L=m/this.window.innerWidth*100;m="".concat(L,"vw")}else if(w.endsWith("vh")){var k=m/this.window.innerHeight*100;m="".concat(k,"vh")}}var H={width:this.createSizeForCssProperty(d,"width"),height:this.createSizeForCssProperty(m,"height")};this.flexDir==="row"?H.flexBasis=H.width:this.flexDir==="column"&&(H.flexBasis=H.height);var Q=this.state.width!==H.width,_=this.state.height!==H.height,st=this.state.flexBasis!==H.flexBasis,F=Q||_||st;F&&Vu.flushSync(function(){r.setState(H)}),this.props.onResize&&F&&this.props.onResize(e,g,this.resizable,j)}},t.prototype.onMouseUp=function(e){var r,i,o=this.state,s=o.isResizing,a=o.direction;o.original,!(!s||!this.resizable)&&(this.props.onResizeStop&&this.props.onResizeStop(e,a,this.resizable,this.delta),this.props.size&&this.setState({width:(r=this.props.size.width)!==null&&r!==void 0?r:"auto",height:(i=this.props.size.height)!==null&&i!==void 0?i:"auto"}),this.unbindEvents(),this.setState({isResizing:!1,backgroundStyle:Xn(Xn({},this.state.backgroundStyle),{cursor:"auto"})}))},t.prototype.updateSize=function(e){var r,i;this.setState({width:(r=e.width)!==null&&r!==void 0?r:"auto",height:(i=e.height)!==null&&i!==void 0?i:"auto"})},t.prototype.renderResizer=function(){var e=this,r=this.props,i=r.enable,o=r.handleStyles,s=r.handleClasses,a=r.handleWrapperStyle,l=r.handleWrapperClass,u=r.handleComponent;if(!i)return null;var p=Object.keys(i).map(function(c){return i[c]!==!1?yo.jsx(K1,{direction:c,onResizeStart:e.onResizeStart,replaceStyles:o&&o[c],className:s&&s[c],children:u&&u[c]?u[c]:null},c):null});return yo.jsx("div",{className:l,style:a,children:p})},t.prototype.render=function(){var e=this,r=Object.keys(this.props).reduce(function(s,a){return nT.indexOf(a)!==-1||(s[a]=e.props[a]),s},{}),i=Xn(Xn(Xn({position:"relative",userSelect:this.state.isResizing?"none":"auto"},this.props.style),this.sizeStyle),{maxWidth:this.props.maxWidth,maxHeight:this.props.maxHeight,minWidth:this.props.minWidth,minHeight:this.props.minHeight,boxSizing:"border-box",flexShrink:0});this.state.flexBasis&&(i.flexBasis=this.state.flexBasis);var o=this.props.as||"div";return yo.jsxs(o,Xn({style:i,className:this.props.className},r,{ref:function(s){s&&(e.resizable=s)},children:[this.state.isResizing&&yo.jsx("div",{style:this.state.backgroundStyle}),this.props.children,this.renderResizer()]}))},t.defaultProps={as:"div",onResizeStart:function(){},onResize:function(){},onResizeStop:function(){},enable:{top:!0,right:!0,bottom:!0,left:!0,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0},style:{},grid:[1,1],gridGap:[0,0],lockAspectRatio:!1,lockAspectRatioExtraWidth:0,lockAspectRatioExtraHeight:0,scale:1,resizeRatio:1,snapGap:0},t}(Zr.PureComponent),iT=Object.defineProperty,oT=(n,t,e)=>t in n?iT(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,G=(n,t,e)=>oT(n,typeof t!="symbol"?t+"":t,e),Jt=(n=>(n.selector="selector",n.clicker="clicker",n.laserPointer="laserPointer",n.pencil="pencil",n.rectangle="rectangle",n.ellipse="ellipse",n.shape="shape",n.eraser="eraser",n.pencilEraser="pencilEraser",n.text="text",n.straight="straight",n.arrow="arrow",n.hand="hand",n.laserPen="laserPen",n))(Jt||{}),$t=(n=>(n.Normal="Normal",n.Stroke="Stroke",n.Dotted="Dotted",n.LongDotted="LongDotted",n))($t||{}),Ln=(n=>(n.Triangle="triangle",n.Rhombus="rhombus",n.Pentagram="pentagram",n.SpeechBalloon="speechBalloon",n.Star="star",n.Polygon="polygon",n))(Ln||{}),zt=(n=>(n.None="None",n.ShowFloatBar="ShowFloatBar",n.ZIndexFloatBar="ZIndexFloatBar",n.DeleteNode="DeleteNode",n.CopyNode="CopyNode",n.ZIndexActive="ZIndexActive",n.ZIndexNode="ZIndexNode",n.RotateNode="RotateNode",n.SetColorNode="SetColorNode",n.TranslateNode="TranslateNode",n.ScaleNode="ScaleNode",n.OriginalEvent="OriginalEvent",n.CreateScene="CreateScene",n.ActiveCursor="ActiveCursor",n.MoveCursor="MoveCursor",n.CommandEditor="CommandEditor",n.SetEditorData="SetEditorData",n.SetFontStyle="SetFontStyle",n.SetPoint="SetPoint",n.SetLock="SetLock",n.SetShapeOpt="SetShapeOpt",n.CameraChange="CameraChange",n.ActiveMethod="ActiveMethod",n.HidFloatBarBtn="HidFloatBarBtn",n))(zt||{}),Ht=(n=>(n.DisplayState="DisplayState",n.MainEngine="MainEngine",n.Cursor="Cursor",n.BindMainView="BindMainView",n))(Ht||{}),Ja=(n=>(n.longPencil="longPencil",n))(Ja||{}),nt=(n=>(n[n.Pencil=1]="Pencil",n[n.Eraser=2]="Eraser",n[n.PencilEraser=3]="PencilEraser",n[n.BitMapEraser=4]="BitMapEraser",n[n.Selector=5]="Selector",n[n.Clicker=6]="Clicker",n[n.Arrow=7]="Arrow",n[n.Hand=8]="Hand",n[n.LaserPen=9]="LaserPen",n[n.Text=10]="Text",n[n.Straight=11]="Straight",n[n.Rectangle=12]="Rectangle",n[n.Ellipse=13]="Ellipse",n[n.Star=14]="Star",n[n.Triangle=15]="Triangle",n[n.Rhombus=16]="Rhombus",n[n.Polygon=17]="Polygon",n[n.SpeechBalloon=18]="SpeechBalloon",n[n.Image=19]="Image",n))(nt||{}),kt=(n=>(n[n.Local=1]="Local",n[n.Service=2]="Service",n[n.Worker=3]="Worker",n))(kt||{}),Tt=(n=>(n[n.Pending=0]="Pending",n[n.Start=1]="Start",n[n.Doing=2]="Doing",n[n.Done=3]="Done",n[n.Unwritable=4]="Unwritable",n))(Tt||{}),pt=(n=>(n[n.None=0]="None",n[n.Init=1]="Init",n[n.UpdateCamera=2]="UpdateCamera",n[n.UpdateTools=3]="UpdateTools",n[n.CreateWork=4]="CreateWork",n[n.DrawWork=5]="DrawWork",n[n.FullWork=6]="FullWork",n[n.UpdateNode=7]="UpdateNode",n[n.RemoveNode=8]="RemoveNode",n[n.Clear=9]="Clear",n[n.Select=10]="Select",n[n.Destroy=11]="Destroy",n[n.Snapshot=12]="Snapshot",n[n.BoundingBox=13]="BoundingBox",n[n.Cursor=14]="Cursor",n[n.TextUpdate=15]="TextUpdate",n[n.GetTextActive=16]="GetTextActive",n[n.TasksQueue=17]="TasksQueue",n[n.CursorHover=18]="CursorHover",n[n.CursorBlur=19]="CursorBlur",n[n.Console=20]="Console",n[n.PriorityWorker=21]="PriorityWorker",n[n.PriorityMainThreadWorker=22]="PriorityMainThreadWorker",n[n.GetImageBitMap=23]="GetImageBitMap",n[n.AuthWriter=24]="AuthWriter",n[n.AuthReader=25]="AuthReader",n[n.AuthClear=26]="AuthClear",n[n.AuthPage=27]="AuthPage",n[n.GetVNodeInfo=28]="GetVNodeInfo",n[n.UpdateDpr=29]="UpdateDpr",n))(pt||{}),de=(n=>(n[n.None=0]="None",n[n.Bg=1]="Bg",n[n.ServiceFloat=2]="ServiceFloat",n[n.Float=3]="Float",n[n.TopFloat=4]="TopFloat",n))(de||{}),Oo=(n=>(n[n.Cursor=1]="Cursor",n[n.TextCreate=2]="TextCreate",n))(Oo||{}),Xo=(n=>(n[n.Top=1]="Top",n[n.Bottom=2]="Bottom",n))(Xo||{}),ee=(n=>(n[n.none=1]="none",n[n.all=2]="all",n[n.both=3]="both",n[n.proportional=4]="proportional",n))(ee||{}),si=(n=>(n[n.inside=0]="inside",n[n.outside=1]="outside",n[n.intersect=2]="intersect",n))(si||{}),Ve=(n=>(n.renderPage="renderPage",n.addPage="addPage",n.deletePage="deletePage",n.addElement="addElement",n.deleteElement="deleteElement",n.clearPage="clearPage",n.clearViewScenePath="clearViewScenePath",n.clearView="clearView",n))(Ve||{}),Rn=(n=>(n.setAuth="setAuth",n.setShow="addShow",n.setHide="setHide",n.setClear="setClear",n))(Rn||{}),ai=(n=>(n.Image="image",n.Iconify="iconify",n))(ai||{});const sT={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>n*(2-n),easeInOutQuad:n=>n<.5?2*n*n:-1+(4-2*n)*n,easeInCubic:n=>n*n*n,easeOutCubic:n=>--n*n*n+1,easeInOutCubic:n=>n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,easeInQuart:n=>n*n*n*n,easeOutQuart:n=>1- --n*n*n*n,easeInOutQuart:n=>n<.5?8*n*n*n*n:1-8*--n*n*n*n,easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>1+--n*n*n*n*n,easeInOutQuint:n=>n<.5?16*n*n*n*n*n:1+16*--n*n*n*n*n,easeInSine:n=>1-Math.cos(n*Math.PI/2),easeOutSine:n=>Math.sin(n*Math.PI/2),easeInOutSine:n=>-(Math.cos(Math.PI*n)-1)/2,easeInExpo:n=>n<=0?0:Math.pow(2,10*n-10),easeOutExpo:n=>n>=1?1:1-Math.pow(2,-10*n),easeInOutExpo:n=>n<=0?0:n>=1?1:n<.5?Math.pow(2,20*n-10)/2:(2-Math.pow(2,-20*n+10))/2};class ht{constructor(t=0,e=0,r=1){this.x=t,this.y=e,this.z=r}get XY(){return[this.x,this.y]}setz(t){return this.z=t,this}setXY(t=this.x,e=this.y){return this.x=t,this.y=e,this}set(t=this.x,e=this.y,r=this.z){return this.x=t,this.y=e,this.z=r,this}setTo({x:t=0,y:e=0,z:r=1}){return this.x=t,this.y=e,this.z=r,this}rot(t){if(t===0)return this;const{x:e,y:r}=this,i=Math.sin(t),o=Math.cos(t);return this.x=e*o-r*i,this.y=e*i+r*o,this}rotWith(t,e){if(e===0)return this;const r=this.x-t.x,i=this.y-t.y,o=Math.sin(e),s=Math.cos(e);return this.x=t.x+(r*s-i*o),this.y=t.y+(r*o+i*s),this}clone(){const{x:t,y:e,z:r}=this;return new ht(t,e,r)}sub(t){return this.x-=t.x,this.y-=t.y,this}subXY(t,e){return this.x-=t,this.y-=e,this}subScalar(t){return this.x-=t,this.y-=t,this}add(t){return this.x+=t.x,this.y+=t.y,this}addXY(t,e){return this.x+=t,this.y+=e,this}addScalar(t){return this.x+=t,this.y+=t,this}clamp(t,e){return this.x=Math.max(this.x,t),this.y=Math.max(this.y,t),e!==void 0&&(this.x=Math.min(this.x,e),this.y=Math.min(this.y,e)),this}div(t){return this.x/=t,this.y/=t,this}divV(t){return this.x/=t.x,this.y/=t.y,this}mul(t){return this.x*=t,this.y*=t,this}mulV(t){return this.x*=t.x,this.y*=t.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(t,e){const r=ht.Tan(t,this);return this.add(r.mul(e))}neg(){return this.x*=-1,this.y*=-1,this}cross(t){return this.x=this.y*t.z-this.z*t.y,this.y=this.z*t.x-this.x*t.z,this}dpr(t){return ht.Dpr(this,t)}cpr(t){return ht.Cpr(this,t)}len2(){return ht.Len2(this)}len(){return ht.Len(this)}pry(t){return ht.Pry(this,t)}per(){const{x:t,y:e}=this;return this.x=e,this.y=-t,this}uni(){return ht.Uni(this)}tan(t){return ht.Tan(this,t)}dist(t){return ht.Dist(this,t)}distanceToLineSegment(t,e){return ht.DistanceToLineSegment(t,e,this)}slope(t){return ht.Slope(this,t)}snapToGrid(t){return this.x=Math.round(this.x/t)*t,this.y=Math.round(this.y/t)*t,this}angle(t){return ht.Angle(this,t)}toAngle(){return ht.ToAngle(this)}lrp(t,e){return this.x=this.x+(t.x-this.x)*e,this.y=this.y+(t.y-this.y)*e,this}equals(t,e){return ht.Equals(this,t,e)}equalsXY(t,e){return ht.EqualsXY(this,t,e)}norm(){const t=this.len();return this.x=t===0?0:this.x/t,this.y=t===0?0:this.y/t,this}toFixed(){return ht.ToFixed(this)}toString(){return ht.ToString(ht.ToFixed(this))}toJson(){return ht.ToJson(this)}toArray(){return ht.ToArray(this)}static Add(t,e){return new ht(t.x+e.x,t.y+e.y)}static AddXY(t,e,r){return new ht(t.x+e,t.y+r)}static Sub(t,e){return new ht(t.x-e.x,t.y-e.y)}static SubXY(t,e,r){return new ht(t.x-e,t.y-r)}static AddScalar(t,e){return new ht(t.x+e,t.y+e)}static SubScalar(t,e){return new ht(t.x-e,t.y-e)}static Div(t,e){return new ht(t.x/e,t.y/e)}static Mul(t,e){return new ht(t.x*e,t.y*e)}static DivV(t,e){return new ht(t.x/e.x,t.y/e.y)}static MulV(t,e){return new ht(t.x*e.x,t.y*e.y)}static Neg(t){return new ht(-t.x,-t.y)}static Per(t){return new ht(t.y,-t.x)}static Dist2(t,e){return ht.Sub(t,e).len2()}static Abs(t){return new ht(Math.abs(t.x),Math.abs(t.y))}static Dist(t,e){return Math.hypot(t.y-e.y,t.x-e.x)}static Dpr(t,e){return t.x*e.x+t.y*e.y}static Cross(t,e){return new ht(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z)}static Cpr(t,e){return t.x*e.y-e.x*t.y}static Len2(t){return t.x*t.x+t.y*t.y}static Len(t){return Math.hypot(t.x,t.y)}static Pry(t,e){return ht.Dpr(t,e)/ht.Len(e)}static Uni(t){return ht.Div(t,ht.Len(t))}static Tan(t,e){return ht.Uni(ht.Sub(t,e))}static Min(t,e){return new ht(Math.min(t.x,e.x),Math.min(t.y,e.y))}static Max(t,e){return new ht(Math.max(t.x,e.x),Math.max(t.y,e.y))}static From(t){return new ht().add(t)}static FromArray(t){return new ht(t[0],t[1])}static Rot(t,e=0){const r=Math.sin(e),i=Math.cos(e);return new ht(t.x*i-t.y*r,t.x*r+t.y*i)}static RotWith(t,e,r){const i=t.x-e.x,o=t.y-e.y,s=Math.sin(r),a=Math.cos(r);return new ht(e.x+(i*a-o*s),e.y+(i*s+o*a))}static NearestPointOnLineThroughPoint(t,e,r){return ht.Mul(e,ht.Sub(r,t).pry(e)).add(t)}static NearestPointOnLineSegment(t,e,r,i=!0){const o=ht.Tan(e,t),s=ht.Add(t,ht.Mul(o,ht.Sub(r,t).pry(o)));if(i){if(s.x<Math.min(t.x,e.x))return ht.Cast(t.x<e.x?t:e);if(s.x>Math.max(t.x,e.x))return ht.Cast(t.x>e.x?t:e);if(s.y<Math.min(t.y,e.y))return ht.Cast(t.y<e.y?t:e);if(s.y>Math.max(t.y,e.y))return ht.Cast(t.y>e.y?t:e)}return s}static DistanceToLineThroughPoint(t,e,r){return ht.Dist(r,ht.NearestPointOnLineThroughPoint(t,e,r))}static DistanceToLineSegment(t,e,r,i=!0){return ht.Dist(r,ht.NearestPointOnLineSegment(t,e,r,i))}static Snap(t,e=1){return new ht(Math.round(t.x/e)*e,Math.round(t.y/e)*e)}static Cast(t){return t instanceof ht?t:ht.From(t)}static Slope(t,e){return t.x===e.y?NaN:(t.y-e.y)/(t.x-e.x)}static Angle(t,e){return Math.atan2(e.y-t.y,e.x-t.x)}static Lrp(t,e,r){return ht.Sub(e,t).mul(r).add(t)}static Med(t,e){return new ht((t.x+e.x)/2,(t.y+e.y)/2)}static Equals(t,e,r=1e-4){return Math.abs(t.x-e.x)<r&&Math.abs(t.y-e.y)<r}static EqualsXY(t,e,r){return t.x===e&&t.y===r}static EqualsXYZ(t,e,r=1e-4){return ht.Equals(t,e,r)&&Math.abs((t.z||0)-(e.z||0))<r}static Clockwise(t,e,r){return(r.x-t.x)*(e.y-t.y)-(e.x-t.x)*(r.y-t.y)<0}static Rescale(t,e){const r=ht.Len(t);return new ht(e*t.x/r,e*t.y/r)}static ScaleWithOrigin(t,e,r){return ht.Sub(t,r).mul(e).add(r)}static ScaleWOrigin(t,e,r){return ht.Sub(t,r).mulV(e).add(r)}static ToFixed(t,e=2){return new ht(+t.x.toFixed(e),+t.y.toFixed(e),+t.z.toFixed(e))}static Nudge(t,e,r){return ht.Add(t,ht.Tan(e,t).mul(r))}static ToString(t){return`${t.x}, ${t.y}`}static ToAngle(t){let e=Math.atan2(t.y,t.x);return e<0&&(e+=Math.PI*2),e}static FromAngle(t,e=1){return new ht(Math.cos(t)*e,Math.sin(t)*e)}static ToArray(t){return[t.x,t.y,t.z]}static ToJson(t){const{x:e,y:r,z:i}=t;return{x:e,y:r,z:i}}static Average(t){const e=t.length,r=new ht(0,0);for(let i=0;i<e;i++)r.add(t[i]);return r.div(e)}static Clamp(t,e,r){return r===void 0?new ht(Math.min(Math.max(t.x,e)),Math.min(Math.max(t.y,e))):new ht(Math.min(Math.max(t.x,e),r),Math.min(Math.max(t.y,e),r))}static PointsBetween(t,e,r=6){const i=[];for(let o=0;o<r;o++){const s=sT.easeInQuad(o/(r-1)),a=ht.Lrp(t,e,s);a.z=Math.min(1,.5+Math.abs(.5-aT(s))*.65),i.push(a)}return i}static SnapToGrid(t,e=8){return new ht(Math.round(t.x/e)*e,Math.round(t.y/e)*e)}}const aT=n=>n<.5?2*n*n:-1+(4-2*n)*n;class Wt extends ht{constructor(t=0,e=0,r=0,i={x:0,y:0},o=0,s=0){super(t,e,r),this.x=t,this.y=e,this.z=r,this.v=i,this.t=o,this.a=s}get timestamp(){return this.t}get pressure(){return this.z}get angleNum(){return this.a}get XY(){return[this.x,this.y]}setA(t){this.a=t}setT(t){this.t=t}setv(t){return this.v={x:t.x,y:t.y},this}set(t=this.x,e=this.y,r=this.z,i=this.v,o=this.t,s=this.a){return this.x=t,this.y=e,this.z=r,this.v=i,this.t=o,this.a=s,this}clone(){const{x:t,y:e,z:r,v:i,t:o,a:s}=this,a={x:i.x,y:i.y};return new Wt(t,e,r,a,o,s)}distance(t){return Wt.GetDistance(this,t)}isNear(t,e){return Wt.IsNear(this,t,e)}getAngleByPoints(t,e){return Wt.GetAngleByPoints(t,this,e)}static Sub(t,e){return new Wt(t.x-e.x,t.y-e.y)}static Add(t,e){return new Wt(t.x+e.x,t.y+e.y)}static GetDistance(t,e){return Wt.Len(t.clone().sub(e))}static GetAngleByPoints(t,e,r){const i=e.x-t.x,o=r.x-e.x,s=e.y-t.y,a=r.y-e.y;let l=0;const u=Math.sqrt(i*i+s*s),p=Math.sqrt(o*o+a*a);if(u&&p){const c=i*o+s*a;l=Math.acos(c/(u*p)),l=l/Math.PI*180;let g=i*a-s*o;g=g>0?1:-1,l=180+g*l}return l}static IsNear(t,e,r){return Wt.Len(t.clone().sub(e))<r}static RotWith(t,e,r,i=2){const o=t.x-e.x,s=t.y-e.y,a=Math.sin(r),l=Math.cos(r),u=Math.pow(10,i),p=Math.floor((e.x+(o*l-s*a))*u)/u,c=Math.floor((e.y+(o*a+s*l))*u)/u;return new Wt(p,c)}static GetDotStroke(t,e,r=16){const i=new ht(1,1),o=Math.PI+.001,s=Wt.Add(t,Wt.Sub(t,i).uni().per().mul(-e)),a=[];for(let l=1/r,u=l;u<=1;u+=l)a.push(Wt.RotWith(s,t,o*2*u));return a}static GetSemicircleStroke(t,e,r=-1,i=8){const o=r*(Math.PI+.001),s=[];for(let a=1/i,l=a;l<=1;l+=a)s.push(Wt.RotWith(e,t,o*l));return s}}var Es=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function qi(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var lT=typeof Es=="object"&&Es&&Es.Object===Object&&Es,pm=lT,uT=pm,cT=typeof self=="object"&&self&&self.Object===Object&&self,hT=uT||cT||Function("return this")(),Wn=hT,fT=Wn,dT=fT.Symbol,ns=dT,Rf=ns,gm=Object.prototype,pT=gm.hasOwnProperty,gT=gm.toString,mo=Rf?Rf.toStringTag:void 0;function mT(n){var t=pT.call(n,mo),e=n[mo];try{n[mo]=void 0;var r=!0}catch{}var i=gT.call(n);return r&&(t?n[mo]=e:delete n[mo]),i}var vT=mT,yT=Object.prototype,MT=yT.toString;function TT(n){return MT.call(n)}var IT=TT,jf=ns,wT=vT,ST=IT,xT="[object Null]",CT="[object Undefined]",zf=jf?jf.toStringTag:void 0;function ET(n){return n==null?n===void 0?CT:xT:zf&&zf in Object(n)?wT(n):ST(n)}var mi=ET;function PT(n){return n!=null&&typeof n=="object"}var er=PT,NT=mi,AT=er,DT="[object Number]";function LT(n){return typeof n=="number"||AT(n)&&NT(n)==DT}var OT=LT;const tn=qi(OT);function bT(){this.__data__=[],this.size=0}var RT=bT;function jT(n,t){return n===t||n!==n&&t!==t}var Hc=jT,zT=Hc;function kT(n,t){for(var e=n.length;e--;)if(zT(n[e][0],t))return e;return-1}var qa=kT,BT=qa,WT=Array.prototype,UT=WT.splice;function YT(n){var t=this.__data__,e=BT(t,n);if(e<0)return!1;var r=t.length-1;return e==r?t.pop():UT.call(t,e,1),--this.size,!0}var FT=YT,VT=qa;function XT(n){var t=this.__data__,e=VT(t,n);return e<0?void 0:t[e][1]}var GT=XT,$T=qa;function HT(n){return $T(this.__data__,n)>-1}var QT=HT,ZT=qa;function KT(n,t){var e=this.__data__,r=ZT(e,n);return r<0?(++this.size,e.push([n,t])):e[r][1]=t,this}var JT=KT,qT=RT,_T=FT,tI=GT,eI=QT,nI=JT;function _i(n){var t=-1,e=n==null?0:n.length;for(this.clear();++t<e;){var r=n[t];this.set(r[0],r[1])}}_i.prototype.clear=qT;_i.prototype.delete=_T;_i.prototype.get=tI;_i.prototype.has=eI;_i.prototype.set=nI;var _a=_i,rI=_a;function iI(){this.__data__=new rI,this.size=0}var oI=iI;function sI(n){var t=this.__data__,e=t.delete(n);return this.size=t.size,e}var aI=sI;function lI(n){return this.__data__.get(n)}var uI=lI;function cI(n){return this.__data__.has(n)}var hI=cI;function fI(n){var t=typeof n;return n!=null&&(t=="object"||t=="function")}var Yr=fI,dI=mi,pI=Yr,gI="[object AsyncFunction]",mI="[object Function]",vI="[object GeneratorFunction]",yI="[object Proxy]";function MI(n){if(!pI(n))return!1;var t=dI(n);return t==mI||t==vI||t==gI||t==yI}var mm=MI,TI=Wn,II=TI["__core-js_shared__"],wI=II,Nl=wI,kf=function(){var n=/[^.]+$/.exec(Nl&&Nl.keys&&Nl.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function SI(n){return!!kf&&kf in n}var xI=SI,CI=Function.prototype,EI=CI.toString;function PI(n){if(n!=null){try{return EI.call(n)}catch{}try{return n+""}catch{}}return""}var vm=PI,NI=mm,AI=xI,DI=Yr,LI=vm,OI=/[\\^$.*+?()[\]{}|]/g,bI=/^\[object .+?Constructor\]$/,RI=Function.prototype,jI=Object.prototype,zI=RI.toString,kI=jI.hasOwnProperty,BI=RegExp("^"+zI.call(kI).replace(OI,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function WI(n){if(!DI(n)||AI(n))return!1;var t=NI(n)?BI:bI;return t.test(LI(n))}var UI=WI;function YI(n,t){return n?.[t]}var FI=YI,VI=UI,XI=FI;function GI(n,t){var e=XI(n,t);return VI(e)?e:void 0}var vi=GI,$I=vi,HI=Wn,QI=$I(HI,"Map"),Qc=QI,ZI=vi,KI=ZI(Object,"create"),tl=KI,Bf=tl;function JI(){this.__data__=Bf?Bf(null):{},this.size=0}var qI=JI;function _I(n){var t=this.has(n)&&delete this.__data__[n];return this.size-=t?1:0,t}var tw=_I,ew=tl,nw="__lodash_hash_undefined__",rw=Object.prototype,iw=rw.hasOwnProperty;function ow(n){var t=this.__data__;if(ew){var e=t[n];return e===nw?void 0:e}return iw.call(t,n)?t[n]:void 0}var sw=ow,aw=tl,lw=Object.prototype,uw=lw.hasOwnProperty;function cw(n){var t=this.__data__;return aw?t[n]!==void 0:uw.call(t,n)}var hw=cw,fw=tl,dw="__lodash_hash_undefined__";function pw(n,t){var e=this.__data__;return this.size+=this.has(n)?0:1,e[n]=fw&&t===void 0?dw:t,this}var gw=pw,mw=qI,vw=tw,yw=sw,Mw=hw,Tw=gw;function to(n){var t=-1,e=n==null?0:n.length;for(this.clear();++t<e;){var r=n[t];this.set(r[0],r[1])}}to.prototype.clear=mw;to.prototype.delete=vw;to.prototype.get=yw;to.prototype.has=Mw;to.prototype.set=Tw;var Iw=to,Wf=Iw,ww=_a,Sw=Qc;function xw(){this.size=0,this.__data__={hash:new Wf,map:new(Sw||ww),string:new Wf}}var Cw=xw;function Ew(n){var t=typeof n;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?n!=="__proto__":n===null}var Pw=Ew,Nw=Pw;function Aw(n,t){var e=n.__data__;return Nw(t)?e[typeof t=="string"?"string":"hash"]:e.map}var el=Aw,Dw=el;function Lw(n){var t=Dw(this,n).delete(n);return this.size-=t?1:0,t}var Ow=Lw,bw=el;function Rw(n){return bw(this,n).get(n)}var jw=Rw,zw=el;function kw(n){return zw(this,n).has(n)}var Bw=kw,Ww=el;function Uw(n,t){var e=Ww(this,n),r=e.size;return e.set(n,t),this.size+=e.size==r?0:1,this}var Yw=Uw,Fw=Cw,Vw=Ow,Xw=jw,Gw=Bw,$w=Yw;function eo(n){var t=-1,e=n==null?0:n.length;for(this.clear();++t<e;){var r=n[t];this.set(r[0],r[1])}}eo.prototype.clear=Fw;eo.prototype.delete=Vw;eo.prototype.get=Xw;eo.prototype.has=Gw;eo.prototype.set=$w;var ym=eo,Hw=_a,Qw=Qc,Zw=ym,Kw=200;function Jw(n,t){var e=this.__data__;if(e instanceof Hw){var r=e.__data__;if(!Qw||r.length<Kw-1)return r.push([n,t]),this.size=++e.size,this;e=this.__data__=new Zw(r)}return e.set(n,t),this.size=e.size,this}var qw=Jw,_w=_a,tS=oI,eS=aI,nS=uI,rS=hI,iS=qw;function no(n){var t=this.__data__=new _w(n);this.size=t.size}no.prototype.clear=tS;no.prototype.delete=eS;no.prototype.get=nS;no.prototype.has=rS;no.prototype.set=iS;var Mm=no;function oS(n,t){for(var e=-1,r=n==null?0:n.length;++e<r&&t(n[e],e,n)!==!1;);return n}var sS=oS,aS=vi,lS=function(){try{var n=aS(Object,"defineProperty");return n({},"",{}),n}catch{}}(),Tm=lS,Uf=Tm;function uS(n,t,e){t=="__proto__"&&Uf?Uf(n,t,{configurable:!0,enumerable:!0,value:e,writable:!0}):n[t]=e}var Im=uS,cS=Im,hS=Hc,fS=Object.prototype,dS=fS.hasOwnProperty;function pS(n,t,e){var r=n[t];(!(dS.call(n,t)&&hS(r,e))||e===void 0&&!(t in n))&&cS(n,t,e)}var wm=pS,gS=wm,mS=Im;function vS(n,t,e,r){var i=!e;e||(e={});for(var o=-1,s=t.length;++o<s;){var a=t[o],l=r?r(e[a],n[a],a,e,n):void 0;l===void 0&&(l=n[a]),i?mS(e,a,l):gS(e,a,l)}return e}var nl=vS;function yS(n,t){for(var e=-1,r=Array(n);++e<n;)r[e]=t(e);return r}var MS=yS,TS=mi,IS=er,wS="[object Arguments]";function SS(n){return IS(n)&&TS(n)==wS}var xS=SS,Yf=xS,CS=er,Sm=Object.prototype,ES=Sm.hasOwnProperty,PS=Sm.propertyIsEnumerable,NS=Yf(function(){return arguments}())?Yf:function(n){return CS(n)&&ES.call(n,"callee")&&!PS.call(n,"callee")},xm=NS,AS=Array.isArray,rs=AS,Na={exports:{}};function DS(){return!1}var LS=DS;Na.exports;(function(n,t){var e=Wn,r=LS,i=t&&!t.nodeType&&t,o=i&&!0&&n&&!n.nodeType&&n,s=o&&o.exports===i,a=s?e.Buffer:void 0,l=a?a.isBuffer:void 0,u=l||r;n.exports=u})(Na,Na.exports);var Zc=Na.exports,OS=9007199254740991,bS=/^(?:0|[1-9]\d*)$/;function RS(n,t){var e=typeof n;return t=t??OS,!!t&&(e=="number"||e!="symbol"&&bS.test(n))&&n>-1&&n%1==0&&n<t}var jS=RS,zS=9007199254740991;function kS(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=zS}var Cm=kS,BS=mi,WS=Cm,US=er,YS="[object Arguments]",FS="[object Array]",VS="[object Boolean]",XS="[object Date]",GS="[object Error]",$S="[object Function]",HS="[object Map]",QS="[object Number]",ZS="[object Object]",KS="[object RegExp]",JS="[object Set]",qS="[object String]",_S="[object WeakMap]",tx="[object ArrayBuffer]",ex="[object DataView]",nx="[object Float32Array]",rx="[object Float64Array]",ix="[object Int8Array]",ox="[object Int16Array]",sx="[object Int32Array]",ax="[object Uint8Array]",lx="[object Uint8ClampedArray]",ux="[object Uint16Array]",cx="[object Uint32Array]",ye={};ye[nx]=ye[rx]=ye[ix]=ye[ox]=ye[sx]=ye[ax]=ye[lx]=ye[ux]=ye[cx]=!0;ye[YS]=ye[FS]=ye[tx]=ye[VS]=ye[ex]=ye[XS]=ye[GS]=ye[$S]=ye[HS]=ye[QS]=ye[ZS]=ye[KS]=ye[JS]=ye[qS]=ye[_S]=!1;function hx(n){return US(n)&&WS(n.length)&&!!ye[BS(n)]}var fx=hx;function dx(n){return function(t){return n(t)}}var rl=dx,Aa={exports:{}};Aa.exports;(function(n,t){var e=pm,r=t&&!t.nodeType&&t,i=r&&!0&&n&&!n.nodeType&&n,o=i&&i.exports===r,s=o&&e.process,a=function(){try{var l=i&&i.require&&i.require("util").types;return l||s&&s.binding&&s.binding("util")}catch{}}();n.exports=a})(Aa,Aa.exports);var Kc=Aa.exports,px=fx,gx=rl,Ff=Kc,Vf=Ff&&Ff.isTypedArray,mx=Vf?gx(Vf):px,Em=mx,vx=MS,yx=xm,Mx=rs,Tx=Zc,Ix=jS,wx=Em,Sx=Object.prototype,xx=Sx.hasOwnProperty;function Cx(n,t){var e=Mx(n),r=!e&&yx(n),i=!e&&!r&&Tx(n),o=!e&&!r&&!i&&wx(n),s=e||r||i||o,a=s?vx(n.length,String):[],l=a.length;for(var u in n)(t||xx.call(n,u))&&!(s&&(u=="length"||i&&(u=="offset"||u=="parent")||o&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Ix(u,l)))&&a.push(u);return a}var Pm=Cx,Ex=Object.prototype;function Px(n){var t=n&&n.constructor,e=typeof t=="function"&&t.prototype||Ex;return n===e}var Jc=Px;function Nx(n,t){return function(e){return n(t(e))}}var Nm=Nx,Ax=Nm,Dx=Ax(Object.keys,Object),Lx=Dx,Ox=Jc,bx=Lx,Rx=Object.prototype,jx=Rx.hasOwnProperty;function zx(n){if(!Ox(n))return bx(n);var t=[];for(var e in Object(n))jx.call(n,e)&&e!="constructor"&&t.push(e);return t}var kx=zx,Bx=mm,Wx=Cm;function Ux(n){return n!=null&&Wx(n.length)&&!Bx(n)}var qc=Ux,Yx=Pm,Fx=kx,Vx=qc;function Xx(n){return Vx(n)?Yx(n):Fx(n)}var _c=Xx,Gx=nl,$x=_c;function Hx(n,t){return n&&Gx(t,$x(t),n)}var Qx=Hx;function Zx(n){var t=[];if(n!=null)for(var e in Object(n))t.push(e);return t}var Kx=Zx,Jx=Yr,qx=Jc,_x=Kx,tC=Object.prototype,eC=tC.hasOwnProperty;function nC(n){if(!Jx(n))return _x(n);var t=qx(n),e=[];for(var r in n)r=="constructor"&&(t||!eC.call(n,r))||e.push(r);return e}var rC=nC,iC=Pm,oC=rC,sC=qc;function aC(n){return sC(n)?iC(n,!0):oC(n)}var th=aC,lC=nl,uC=th;function cC(n,t){return n&&lC(t,uC(t),n)}var hC=cC,Da={exports:{}};Da.exports;(function(n,t){var e=Wn,r=t&&!t.nodeType&&t,i=r&&!0&&n&&!n.nodeType&&n,o=i&&i.exports===r,s=o?e.Buffer:void 0,a=s?s.allocUnsafe:void 0;function l(u,p){if(p)return u.slice();var c=u.length,g=a?a(c):new u.constructor(c);return u.copy(g),g}n.exports=l})(Da,Da.exports);var fC=Da.exports;function dC(n,t){var e=-1,r=n.length;for(t||(t=Array(r));++e<r;)t[e]=n[e];return t}var pC=dC;function gC(n,t){for(var e=-1,r=n==null?0:n.length,i=0,o=[];++e<r;){var s=n[e];t(s,e,n)&&(o[i++]=s)}return o}var Am=gC;function mC(){return[]}var Dm=mC,vC=Am,yC=Dm,MC=Object.prototype,TC=MC.propertyIsEnumerable,Xf=Object.getOwnPropertySymbols,IC=Xf?function(n){return n==null?[]:(n=Object(n),vC(Xf(n),function(t){return TC.call(n,t)}))}:yC,eh=IC,wC=nl,SC=eh;function xC(n,t){return wC(n,SC(n),t)}var CC=xC;function EC(n,t){for(var e=-1,r=t.length,i=n.length;++e<r;)n[i+e]=t[e];return n}var nh=EC,PC=Nm,NC=PC(Object.getPrototypeOf,Object),Lm=NC,AC=nh,DC=Lm,LC=eh,OC=Dm,bC=Object.getOwnPropertySymbols,RC=bC?function(n){for(var t=[];n;)AC(t,LC(n)),n=DC(n);return t}:OC,Om=RC,jC=nl,zC=Om;function kC(n,t){return jC(n,zC(n),t)}var BC=kC,WC=nh,UC=rs;function YC(n,t,e){var r=t(n);return UC(n)?r:WC(r,e(n))}var bm=YC,FC=bm,VC=eh,XC=_c;function GC(n){return FC(n,XC,VC)}var Rm=GC,$C=bm,HC=Om,QC=th;function ZC(n){return $C(n,QC,HC)}var KC=ZC,JC=vi,qC=Wn,_C=JC(qC,"DataView"),tE=_C,eE=vi,nE=Wn,rE=eE(nE,"Promise"),iE=rE,oE=vi,sE=Wn,aE=oE(sE,"Set"),jm=aE,lE=vi,uE=Wn,cE=lE(uE,"WeakMap"),hE=cE,Ou=tE,bu=Qc,Ru=iE,ju=jm,zu=hE,zm=mi,ro=vm,Gf="[object Map]",fE="[object Object]",$f="[object Promise]",Hf="[object Set]",Qf="[object WeakMap]",Zf="[object DataView]",dE=ro(Ou),pE=ro(bu),gE=ro(Ru),mE=ro(ju),vE=ro(zu),Gr=zm;(Ou&&Gr(new Ou(new ArrayBuffer(1)))!=Zf||bu&&Gr(new bu)!=Gf||Ru&&Gr(Ru.resolve())!=$f||ju&&Gr(new ju)!=Hf||zu&&Gr(new zu)!=Qf)&&(Gr=function(n){var t=zm(n),e=t==fE?n.constructor:void 0,r=e?ro(e):"";if(r)switch(r){case dE:return Zf;case pE:return Gf;case gE:return $f;case mE:return Hf;case vE:return Qf}return t});var il=Gr,yE=Object.prototype,ME=yE.hasOwnProperty;function TE(n){var t=n.length,e=new n.constructor(t);return t&&typeof n[0]=="string"&&ME.call(n,"index")&&(e.index=n.index,e.input=n.input),e}var IE=TE,wE=Wn,SE=wE.Uint8Array,km=SE,Kf=km;function xE(n){var t=new n.constructor(n.byteLength);return new Kf(t).set(new Kf(n)),t}var rh=xE,CE=rh;function EE(n,t){var e=t?CE(n.buffer):n.buffer;return new n.constructor(e,n.byteOffset,n.byteLength)}var PE=EE,NE=/\w*$/;function AE(n){var t=new n.constructor(n.source,NE.exec(n));return t.lastIndex=n.lastIndex,t}var DE=AE,Jf=ns,qf=Jf?Jf.prototype:void 0,_f=qf?qf.valueOf:void 0;function LE(n){return _f?Object(_f.call(n)):{}}var OE=LE,bE=rh;function RE(n,t){var e=t?bE(n.buffer):n.buffer;return new n.constructor(e,n.byteOffset,n.length)}var jE=RE,zE=rh,kE=PE,BE=DE,WE=OE,UE=jE,YE="[object Boolean]",FE="[object Date]",VE="[object Map]",XE="[object Number]",GE="[object RegExp]",$E="[object Set]",HE="[object String]",QE="[object Symbol]",ZE="[object ArrayBuffer]",KE="[object DataView]",JE="[object Float32Array]",qE="[object Float64Array]",_E="[object Int8Array]",tP="[object Int16Array]",eP="[object Int32Array]",nP="[object Uint8Array]",rP="[object Uint8ClampedArray]",iP="[object Uint16Array]",oP="[object Uint32Array]";function sP(n,t,e){var r=n.constructor;switch(t){case ZE:return zE(n);case YE:case FE:return new r(+n);case KE:return kE(n,e);case JE:case qE:case _E:case tP:case eP:case nP:case rP:case iP:case oP:return UE(n,e);case VE:return new r;case XE:case HE:return new r(n);case GE:return BE(n);case $E:return new r;case QE:return WE(n)}}var aP=sP,lP=Yr,td=Object.create,uP=function(){function n(){}return function(t){if(!lP(t))return{};if(td)return td(t);n.prototype=t;var e=new n;return n.prototype=void 0,e}}(),cP=uP,hP=cP,fP=Lm,dP=Jc;function pP(n){return typeof n.constructor=="function"&&!dP(n)?hP(fP(n)):{}}var gP=pP,mP=il,vP=er,yP="[object Map]";function MP(n){return vP(n)&&mP(n)==yP}var TP=MP,IP=TP,wP=rl,ed=Kc,nd=ed&&ed.isMap,SP=nd?wP(nd):IP,xP=SP,CP=il,EP=er,PP="[object Set]";function NP(n){return EP(n)&&CP(n)==PP}var AP=NP,DP=AP,LP=rl,rd=Kc,id=rd&&rd.isSet,OP=id?LP(id):DP,Bm=OP;const bP=qi(Bm);var RP=Mm,jP=sS,zP=wm,kP=Qx,BP=hC,WP=fC,UP=pC,YP=CC,FP=BC,VP=Rm,XP=KC,GP=il,$P=IE,HP=aP,QP=gP,ZP=rs,KP=Zc,JP=xP,qP=Yr,_P=Bm,tN=_c,eN=th,nN=1,rN=2,iN=4,Wm="[object Arguments]",oN="[object Array]",sN="[object Boolean]",aN="[object Date]",lN="[object Error]",Um="[object Function]",uN="[object GeneratorFunction]",cN="[object Map]",hN="[object Number]",Ym="[object Object]",fN="[object RegExp]",dN="[object Set]",pN="[object String]",gN="[object Symbol]",mN="[object WeakMap]",vN="[object ArrayBuffer]",yN="[object DataView]",MN="[object Float32Array]",TN="[object Float64Array]",IN="[object Int8Array]",wN="[object Int16Array]",SN="[object Int32Array]",xN="[object Uint8Array]",CN="[object Uint8ClampedArray]",EN="[object Uint16Array]",PN="[object Uint32Array]",ve={};ve[Wm]=ve[oN]=ve[vN]=ve[yN]=ve[sN]=ve[aN]=ve[MN]=ve[TN]=ve[IN]=ve[wN]=ve[SN]=ve[cN]=ve[hN]=ve[Ym]=ve[fN]=ve[dN]=ve[pN]=ve[gN]=ve[xN]=ve[CN]=ve[EN]=ve[PN]=!0;ve[lN]=ve[Um]=ve[mN]=!1;function Xs(n,t,e,r,i,o){var s,a=t&nN,l=t&rN,u=t&iN;if(e&&(s=i?e(n,r,i,o):e(n)),s!==void 0)return s;if(!qP(n))return n;var p=ZP(n);if(p){if(s=$P(n),!a)return UP(n,s)}else{var c=GP(n),g=c==Um||c==uN;if(KP(n))return WP(n,a);if(c==Ym||c==Wm||g&&!i){if(s=l||g?{}:QP(n),!a)return l?FP(n,BP(s,n)):YP(n,kP(s,n))}else{if(!ve[c])return i?n:{};s=HP(n,c,a)}}o||(o=new RP);var v=o.get(n);if(v)return v;o.set(n,s),_P(n)?n.forEach(function(y){s.add(Xs(y,t,e,y,n,o))}):JP(n)&&n.forEach(function(y,T){s.set(T,Xs(y,t,e,T,n,o))});var I=u?l?XP:VP:l?eN:tN,w=p?void 0:I(n);return jP(w||n,function(y,T){w&&(T=y,y=n[T]),zP(s,T,Xs(y,t,e,T,n,o))}),s}var NN=Xs,AN=NN,DN=1,LN=4;function ON(n){return AN(n,DN|LN)}var bN=ON;const ze=qi(bN),Fm="1.1.21",RN="@netless/appliance-plugin",od=typeof OffscreenCanvas=="function"?"worker":"mainThread";if(typeof window<"u"){let n=window.__netlessUA||"";n+=` ${RN}@${Fm}`,window.__netlessUA=n}const me={useWorker:"auto",syncOpt:{interval:300,smoothSync:!0},cursor:{enable:!0,expirationTime:5e3},bufferSize:{full:2e4,sub:600},bezier:{enable:!0,maxDrawCount:1/0,combineUnitTime:300},pencilEraser:{useBitMap:!0,maxImageWidth:1920,maxImageHeight:1920,maxCombineTime:500},strokeWidth:{min:1,max:10},textEditor:{showFloatBar:!0,canSelectorSwitch:!0,rightBoundBreak:!1}};function jr(n,t=!0){const e=n.length;if(e<2)return"";let r=n[0],i=n[1];if(e===2)return`M${wi(r)}L${wi(i)}`;let o="";for(let s=2,a=e-1;s<a;s++)r=n[s],i=n[s+1],o+=Si(r,i);return t?`M${Si(n[0],n[1])}Q${wi(n[1])}${Si(n[1],n[2])}T${o}${Si(n[e-1],n[0])}${Si(n[0],n[1])}Z`:`M${wi(n[0])}Q${wi(n[1])}${Si(n[1],n[2])}${n.length>3?"T":""}${o}L${wi(n[e-1])}`}const Vm=class Dn{constructor(t){G(this,"maxImageWidth",me.pencilEraser.maxImageWidth),G(this,"maxImageHeight",me.pencilEraser.maxImageHeight),G(this,"syncUnitTime",me.syncOpt.interval),G(this,"vNodes"),G(this,"drawLayer"),G(this,"fullLayer"),G(this,"workId"),G(this,"isDelete",!1);const{vNodes:e,fullLayer:r,drawLayer:i,workId:o,toolsOpt:s}=t;this.vNodes=e,this.fullLayer=r,this.drawLayer=i,this.workId=o,this.syncUnitTime=s.syncUnitTime||this.syncUnitTime}get baseConsumeResult(){return{workId:this.workId,toolsType:this.toolsType,opt:this.workOptions}}filterSamePoints(t,e=.01){return t.reduce((r,i)=>{const o=r[r.length-1];return(i&&!o||i&&o&&!i.isNear(o,e))&&r.push(i),r},[])}setWorkId(t){this.workId=t}getWorkId(){return this.workId}getWorkOptions(){return this.workOptions}setWorkOptions(t){var e,r,i;this.workOptions=t,this.syncUnitTime=t.syncUnitTime||this.syncUnitTime;const o=(e=this.workId)==null?void 0:e.toString(),s=o&&((r=this.vNodes)==null?void 0:r.get(o))||void 0;o&&s&&(s.opt=t,(i=this.vNodes)==null||i.setInfo(o,s))}updataOptService(t){var e,r;let i;const o=(e=this.workId)==null?void 0:e.toString();if(o&&t){const s=this.fullLayer.getElementsByName(o)||this.drawLayer&&this.drawLayer.getElementsByName(o)||[];if(s.length!==1)return;const a=s[0],{pos:l,zIndex:u,scale:p,angle:c,translate:g}=t,v={};tn(u)&&(v.zIndex=u),l&&(v.pos=[l[0],l[1]]),p&&(v.scale=p),c&&(v.rotate=c),g&&(v.translate=g),a.attr(v);const I=a?.getBoundingClientRect();return I&&(i=oe(i,{x:Math.floor(I.x-Dn.SafeBorderPadding),y:Math.floor(I.y-Dn.SafeBorderPadding),w:Math.floor(I.width+Dn.SafeBorderPadding*2),h:Math.floor(I.height+Dn.SafeBorderPadding*2)})),(r=this.vNodes)==null||r.setInfo(o,{rect:i,centerPos:l}),i}}drawEraserlines(t,e){const{group:r,eraserlines:i,pos:o,layer:s}=t,a=s.parent;if(e)try{const l=(s.renderer.glRenderer||s.renderer.canvasRenderer).options.displayRatio,u=r.getBoundingClientRect(),p=u.width*l*s.worldScaling[0],c=u.height*l*s.worldScaling[1];let g=1;(p>this.maxImageWidth||c>this.maxImageHeight)&&(g=Math.min(this.maxImageWidth/p,this.maxImageHeight/c));let v=s.getAttribute("scale");v=[v[0]*g,v[1]*g];const I=s.parent.parent,w=s.getAttribute("translate"),y=this.createVmRenderNode(`${this.workId}_bitMapLayer`,I,{offscreen:a.offscreen,width:a.width,height:a.height,contextType:"2d",autoRender:!1,bufferSize:500},v,w),T=r.cloneNode(!0);if(!i||!i.length)return;this.addEraserlines(T,i,o,!1),y.appendChild(T);const h=y.parent;h.render();const m=y.renderer.canvasRenderer,d=m.context;if(!d)return;const M=m.options.displayRatio,x=T.getBoundingClientRect(),E={x:x.x,y:x.y,w:x.width,h:x.height},P={x:0,y:0,w:I.width,h:I.height};if(wv(E,P)===si.outside){sn(T,h),I.removeChild(h),this.isDelete=!0;return}const R=ze(E);R.x=Math.floor(Math.max(E.x,0)),R.y=Math.floor(Math.max(E.y,0)),R.w=Math.min(E.x+E.w,I.width)-R.x,R.h=Math.min(E.y+E.h,I.height)-R.y;const N=this.getGroupRect(R,M),b=N.x,j=N.y,O=N.w,L=N.h;let k=d.getImageData(b,j,O,L);if(this.isTransparentRectByCanvas(k)){sn(T,h),I.removeChild(h),this.isDelete=!0,k=null;return}sn(r,a);const H=this.createSpriteNode({imageData:k,safariRect:R,originRect:E,worldScaling:y.worldScaling});H&&r.append(H),sn(T,h),I.removeChild(h),a.deleteTexture(k),k=null}catch(l){console.error("[BaseShapeTool] drawEraserlines error:",l);return}}createVmRenderNode(t,e,r,i,o){const{width:s,height:a}=r,l=`bitMap-${t}`,u=e.layer(l,r),p=new Ze({anchor:[.5,.5],pos:[s*.5,a*.5],size:[s,a],name:"viewport",id:t});return p.setAttribute("scale",i),p.setAttribute("translate",o),u.append(p),p}getGroupRect(t,e){const r=Math.floor(t.x*e),i=Math.floor(t.y*e),o=Math.floor(t.w*e),s=Math.floor(t.h*e);return{x:r,y:i,w:o,h:s}}addEraserlines(t,e,r,i=!0){for(const o of e){const{thickness:s,op:a}=o;for(const l of a){const u=l.map((I,w)=>w%2?I-r[1]:I-r[0]),p=this.computEraserPoints(u,s),c=jr(p,!0),g={pos:[0,0],d:c,fillColor:"rgba(0,0,0,1)"},v=new Wr(g);v.addEventListener("beforerender",({detail:I})=>{const w=I.context;i?w.blendFuncSeparate(w.ZERO,w.ZERO,w.ZERO,w.ZERO):w.globalCompositeOperation="destination-out"}),v.addEventListener("afterrender",({detail:I})=>{const w=I.context;i?w.blendFuncSeparate(w.SRC_ALPHA,w.ONE_MINUS_SRC_ALPHA,w.ONE,w.ONE_MINUS_SRC_ALPHA):w.globalCompositeOperation="source-over"}),t.append(v)}}}isTransparentRectByCanvas(t){let e=!0;for(let r=0;r<t.data.length;r+=4)if(t.data[r+3]!==0){e=!1;break}return e}createSpriteNode(t){const{imageData:e,worldScaling:r,safariRect:i,originRect:o}=t;let s;if(typeof OffscreenCanvas=="function"){s=new OffscreenCanvas(e.width,e.height);const p=s.getContext("2d");p&&p.putImageData(e,0,0)}else if(typeof document<"u"){s=document.createElement("canvas"),s.width=e.width,s.height=e.height;const p=s.getContext("2d");p&&p.putImageData(e,0,0)}if(!s)return console.warn("Failed to create imageEraserBitmap Sprite"),null;const a=[Math.floor(o.w/r[0]),Math.floor(o.h/r[1])],l=[Math.floor((i.x-o.x)/r[0]),Math.floor((i.y-o.y)/r[1]),Math.floor(i.w/r[0]),Math.floor(i.h/r[1])],u={name:"eraserTexture",anchor:[.5,.5],pos:[0,0],size:a,texture:s,textureRect:l};return new Ld(u)}computEraserPoints(t,e){const r=Math.ceil(e/2);return t.length===2?this.computDot(t,r):this.computLine(t,r)}computDot(t,e){const r=new Wt(t[0],t[1]);return Wt.GetDotStroke(r,e,8)}computLine(t,e){const r=[],i=[];let o,s;for(let a=0;a<t.length;a+=2){const l=new Wt(t[a],t[a+1]);let u;if(a==t.length-2){const p=new Wt(t[a-2],t[a-1]);u=ht.Sub(l,p).uni(),o=l}else{a===0&&(s=l);const p=new Wt(t[a+2],t[a+3]);u=ht.Sub(p,l).uni()}if(u){const p=ht.Per(u).mul(e);r.push(Wt.Sub(l,p)),i.push(Wt.Add(l,p))}}if(o&&s){const a=Wt.GetSemicircleStroke(o,r[r.length-1],-1,8),l=Wt.GetSemicircleStroke(s,i[0],-1,8);return r.concat(a,i.reverse(),l)}return[]}replace(t,e,r){var i;if(!e){r&&t.append(r);return}const o=t.getElementsByName(e);if(o.length)for(const s of o)r?FD(r,s,t):(s.remove(),mn(s,t.parent));else r&&t.append(r);this.fullLayer!==this.drawLayer&&(this.fullLayer===t?(i=this.drawLayer)==null||i.getElementsByName(e).forEach(s=>{var a;s.remove(),mn(s,(a=this.drawLayer)==null?void 0:a.parent)}):this.fullLayer.getElementsByName(e).forEach(s=>{s.remove(),mn(s,this.fullLayer.parent)}))}removeDrawCountNodes(t,e){const r=[];t.getElementsByName(this.workId).forEach(i=>{i.id&&e&&Number(i.id)<e&&r.push(i)});for(const i of r)i.remove(),mn(i,t.parent)}static updateNodeOpt(t){var e;const{node:r,opt:i,vNodes:o,willSerializeData:s,targetNode:a}=t,{zIndex:l,translate:u,angle:p,originPoint:c,scenePoint:g,scale:v,pointMap:I,thickness:w}=i;let y;const T=a&&ze(a)||o.get(r.name);if(!T)return;tn(l)&&(r.setAttribute("zIndex",l),T.opt.zIndex=l);const h=r.parent;if(h){if(c&&v&&a){const m=[T.op[0],T.op[1]];ch(T.op,g,v,u);const d=[T.op[0],T.op[1]],M=[d[0]-m[0],d[1]-m[1]];if(T.centerPos=[T.centerPos[0]+M[0],T.centerPos[1]+M[1]],T.opt.translate=void 0,T.opt.scale=void 0,T.opt.eraserlines)for(let x=0;x<T.opt.eraserlines.length;x++){const{op:E,thickness:P}=T.opt.eraserlines[x];T.opt.eraserlines[x].thickness=Math.round(P*Math.max(v[0],v[1]));for(let R=0;R<E.length;R++)hh(E[R],g,v,u)}}else if(u)if(r.setAttribute("translate",u),T.opt.translate=u,a){const m=[u[0]*h.worldScaling[0],u[1]*h.worldScaling[1]];y=$o(T.rect,m),T.rect=y}else{const m=Dn.getRectFromLayer(h,r.name);T.rect=m||T.rect}else if(tn(p))if(r.setAttribute("rotate",p),T.opt.rotate=p,a)y=Mv(T.rect,p),T.rect=y;else{const m=Dn.getRectFromLayer(h,r.name);T.rect=m||T.rect}if(I){const m=I.get(r.name);if(m)for(let d=0,M=0;d<T.op.length;d+=3,M++)T.op[d]=m[M][0],T.op[d+1]=m[M][1]}if(w&&(e=T?.opt)!=null&&e.thickness&&(T.opt.thickness=w),s&&!(c&&v&&a)){if(u){const m=T.op.map((d,M)=>{const x=M%3;return x===0?d+u[0]:x===1?d+u[1]:d});if(T.op=m,T.centerPos=[T.centerPos[0]+u[0],T.centerPos[1]+u[1]],T!=null&&T.opt&&(T.opt.translate=void 0),T.opt.eraserlines)for(let d=0;d<T.opt.eraserlines.length;d++){const{op:M}=T.opt.eraserlines[d];for(let x=0;x<M.length;x++){const E=M[x].map((P,R)=>R%2?P+u[1]:P+u[0]);T.opt.eraserlines[d].op[x]=E}}}else if(tn(p)){const m=T.op;if(RD(m,T.centerPos,p),T.op=m,T!=null&&T.opt&&(T.opt.rotate=void 0),T.opt.eraserlines)for(let d=0;d<T.opt.eraserlines.length;d++){const{op:M}=T.opt.eraserlines[d];for(let x=0;x<M.length;x++)jD(M[x],T.centerPos,p)}}}T&&o.setInfo(r.name,T)}}static getCenterPos(t,e){const{worldPosition:r,worldScaling:i}=e;return[(t.x+t.w/2-r[0])/i[0],(t.y+t.h/2-r[1])/i[1]]}static getRectFromLayer(t,e){const r=t.getElementsByName(e)[0];if(r){const i=r.getBoundingClientRect();return{x:Math.floor(i.x-Dn.SafeBorderPadding),y:Math.floor(i.y-Dn.SafeBorderPadding),w:Math.floor(i.width+Dn.SafeBorderPadding*2),h:Math.floor(i.height+Dn.SafeBorderPadding*2)}}}static isWillRefresh(t){const{toolsType:e,opt:r,node:i,updateOpt:o,willSerializeData:s}=t;return!!(s&&(o.angle||o.translate)||o.thickness&&r.thickness&&r.thickness!==o.thickness||o.strokeType&&r.strokeType&&r.strokeType!==o.strokeType||o.originPoint&&o.scenePoint&&o.scale||o.pointMap&&o.pointMap.has(i.name)||e===nt.Text&&(o.fontSize||o.translate||o.textInfos&&o.textInfos.get(i.name))||e===nt.Image&&(o.angle||o.translate||o.scale||o.strokeColor&&o.type===ai.Iconify)||e===o.toolsType&&o.willRefresh||r.eraserlines&&r.eraserlines.length&&(o.strokeColor||o.fillColor))}};G(Vm,"SafeBorderPadding",10);let jt=Vm;const ih=Object.freeze([Object.freeze({width:18,height:26}),Object.freeze({width:26,height:34}),Object.freeze({width:34,height:50}),Object.freeze({width:48,height:74})]);function io(n){return JSON.parse(bd.decompress(n))}function nn(n){return bd.compress(JSON.stringify(n))}const Ye=Object.keys;function Xm(n,t,e=.01){return Math.abs(n[0]-t[0])<e&&Math.abs(n[1]-t[1])<e}function jN(n,t=.01){if(n.length===0)return[];const e=[[n[0][0],n[0][1]]];for(let r=1;r<n.length;r++)Xm([n[r][0],n[r][1]],e[e.length-1],t)||e.push([n[r][0],n[r][1]]);return e}function zN(n,t=.01){if(n.length<=2)return n;const e=n[0],r=n[n.length-1];return Xm(e,r,t)?n.slice(0,-1):n}function kN(n){const t=n.reduce((r,i)=>r+i[0],0)/n.length,e=n.reduce((r,i)=>r+i[1],0)/n.length;return[t,e]}function sd(n,t){return Math.atan2(t[1]-n[1],t[0]-n[0])}function BN(n,t=.01){if(n.length<=2)return n;const e=[];for(const i of n)e.some(o=>Math.abs(o[0]-i[0])<t&&Math.abs(o[1]-i[1])<t)||e.push([i[0],i[1]]);const r=kN(e);return e.sort((i,o)=>{const s=sd(r,i),a=sd(r,o);return s-a})}function WN(n,t){const e=t[0].x<t[t.length-1].x;return n.map(r=>{const i=r.map(o=>{let s=-1,a=1/0,l=0;for(let u=0;u<t.length;u++){const p=t[u],c=Math.sqrt(Math.pow(p.x-o[0],2)+Math.pow(p.y-o[1],2));c<a&&(a=c,s=u,l=p.z)}return{point:o,index:s,bestZ:l}}).sort((o,s)=>o.index-s.index).map(o=>[...o.point,o.bestZ]);return e&&i[0][0]>i[i.length-1][0]||!e&&i[0][0]<i[i.length-1][0]?i.reverse():i}).sort((r,i)=>{const o=r[0][0],s=i[0][0];return e?o-s:s-o})}function UN(n,t,e=.01){const r=n.map(p=>[p.x,p.y]),i=(p,c)=>p.map(([g,v])=>({X:Math.round(g*c),Y:Math.round(v*c)})),o=new Yn.ClipperOffset;o.AddPath(i(r,1e3),Yn.JoinType.jtRound,Yn.EndType.etOpenButt);const s=[];o.Execute(s,1);const a=new Yn.Clipper;a.AddPaths(s,Yn.PolyType.ptSubject,!0),t.forEach(p=>{a.AddPath(i(p,1e3),Yn.PolyType.ptClip,!0)});const l=new Yn.Paths;a.Execute(Yn.ClipType.ctDifference,l,Yn.PolyFillType.pftNonZero,Yn.PolyFillType.pftNonZero);const u=l.map(p=>zN(BN(jN(p.map(c=>[c.X/1e3,c.Y/1e3]),e),e),e)).filter(p=>p.length>=2);return WN(u,n)}class Gm extends jt{constructor(t){super(t),G(this,"canRotate",!0),G(this,"scaleType",ee.all),G(this,"toolsType",nt.Pencil),G(this,"syncTimestamp"),G(this,"syncIndex",0),G(this,"tmpPoints",[]),G(this,"MAX_REPEAR",10),G(this,"uniThickness"),G(this,"workOptions"),G(this,"centerPos",[0,0]),this.workOptions=t.toolsOpt,this.uniThickness=this.MAX_REPEAR/this.workOptions.thickness/10,this.syncTimestamp=0}combineConsume(){var t;const e=(t=this.workId)==null?void 0:t.toString();if(this.tmpPoints.length<2)return{type:pt.None};const r=this.transformDataAll(!0),i={name:e};let o;const s=this.drawLayer||this.fullLayer;return r.length&&(o=this.draw({attrs:i,tasks:r,replaceId:e,layer:s})),{rect:o,type:pt.DrawWork,dataType:kt.Local}}setWorkOptions(t){super.setWorkOptions(t),this.syncTimestamp=Date.now()}consume(t){const{data:e,isFullWork:r,isSubWorker:i,isMainThread:o,drawCount:s,removeDrawCount:a}=t,{workId:l,syncUnitTime:u}=e;u&&(this.syncUnitTime=u);const{tasks:p,effects:c,consumeIndex:g}=this.transformData(e,!1);this.syncIndex=Math.min(this.syncIndex,g,Math.max(0,this.tmpPoints.length-2));const v={name:l,id:tn(s)&&s.toString()||void 0};let I,w=!1;const y=this.syncIndex;if(this.syncTimestamp===0&&(this.syncTimestamp=Date.now()),p.length&&(p[0].taskId-this.syncTimestamp>this.syncUnitTime&&(w=!0,this.syncTimestamp=p[0].taskId,this.syncIndex=this.tmpPoints.length),i||o)){const h=r?this.fullLayer:this.drawLayer||this.fullLayer;I=this.draw({attrs:v,tasks:p,effects:c,layer:h,removeDrawCount:a})}if(i)return g>10&&this.tmpPoints.splice(0,g-10),{rect:I,type:pt.DrawWork,dataType:kt.Local};const T=[];return this.tmpPoints.slice(y).forEach(h=>{T.push(h.x,h.y,this.computRadius(h.z,this.workOptions.thickness))}),{...this.baseConsumeResult,type:pt.DrawWork,dataType:kt.Local,rect:I,op:w?T:void 0,index:w?y*3:void 0,updateNodeOpt:{useAnimation:!0}}}consumeAll(t){var e;const r=this.workId;if(t.data){const{op:p,workState:c}=t.data;p!=null&&p.length&&c===Tt.Done&&this.workOptions.strokeType===$t.Stroke&&this.updateTempPointsWithPressureWhenDone(p)}const i=this.transformDataAll(!0),o={name:r};let s;const a=this.fullLayer;if(i.length&&(s=this.draw({attrs:o,tasks:i,replaceId:r,layer:a})),this.tmpPoints.length<2)return this.replace(a,r),{type:pt.RemoveNode,removeIds:[r],rect:s};const l=[];this.tmpPoints.map(p=>{l.push(p.x,p.y,p.z)}),this.syncTimestamp=0,delete this.workOptions.syncUnitTime;const u=nn(l);return(e=this.vNodes)==null||e.setInfo(r,{rect:s,op:l,opt:this.workOptions,toolsType:this.toolsType,scaleType:this.scaleType,canRotate:this.canRotate,centerPos:s&&jt.getCenterPos(s,a)}),{...this.baseConsumeResult,rect:s,type:pt.FullWork,dataType:kt.Local,ops:u,updateNodeOpt:{pos:this.centerPos,useAnimation:!0}}}clearTmpPoints(){this.tmpPoints.length=0,this.syncTimestamp=0,this.syncIndex=0}consumeService(t){var e,r;const{op:i,isFullWork:o,replaceId:s,workState:a=Tt.Done}=t;this.tmpPoints.length=0;for(let g=0;g<i.length;g+=3){const v=new Wt(i[g],i[g+1],i[g+2]);if(this.tmpPoints.length>0){const I=this.tmpPoints[this.tmpPoints.length-1],w=ht.Sub(v,I).uni();v.setv(w)}this.tmpPoints.push(v)}if(this.tmpPoints.length<2)return;const l=this.transformDataAll(!0),u=(e=this.workId)==null?void 0:e.toString(),p={name:u};let c;if(u&&l.length){const g=o?this.fullLayer:this.drawLayer||this.fullLayer;c=this.draw({attrs:p,tasks:l,replaceId:s,layer:g,isDrawEraserlines:a===Tt.Done}),(r=this.vNodes)==null||r.setInfo(u,{rect:c,op:i,opt:this.workOptions,toolsType:this.toolsType,scaleType:this.scaleType,canRotate:this.canRotate,centerPos:c&&jt.getCenterPos(c,g)})}return c}computPencilPoints(t){const e=[],{op:r,eraserPolylines:i,eraserThickness:o}=t;this.tmpPoints.length=0;for(let a=0;a<r.length;a+=3){const l=new Wt(r[a],r[a+1],r[a+2]);if(this.tmpPoints.length>0){const u=this.tmpPoints[this.tmpPoints.length-1],p=ht.Sub(l,u).uni();l.setv(p)}this.tmpPoints.push(l)}if(this.tmpPoints.length<2)return;const s=this.transformDataAll(!0);if(s.length)for(let a=0;a<s.length;a++){const{pos:l,points:u}=s[a],p=u.map(g=>g.point.addXY(l[0],l[1])),c=[];for(const g of i){const v=[];for(let w=0;w<g.length;w+=2){const y=new Wt(g[w],g[w+1]);if(v.length>0){const T=v[v.length-1].point,h=ht.Sub(y,T).uni();y.setv(h)}v.push({point:y,radius:o})}const{ps:I}=this.computStroke(v,!1);c.push(I.map(w=>w.XY))}UN(p,c,.01).forEach(g=>{e.push(g.map(v=>[v[0],v[1],v[2]]).flat(1))})}return e}transformDataAll(t=!0){const e=this.filterSamePoints(this.tmpPoints,this.workOptions.thickness);return this.getTaskPoints(e,t&&this.workOptions.thickness||void 0)}draw(t){const{attrs:e,tasks:r,replaceId:i,effects:o,layer:s,removeDrawCount:a,isDrawEraserlines:l=!0}=t,{strokeColor:u,strokeType:p,thickness:c,zIndex:g,scale:v,rotate:I,translate:w,eraserlines:y}=this.workOptions;o!=null&&o.size&&(o.forEach(x=>{var E;(E=s.getElementById(x+""))==null||E.remove()}),o.clear()),a&&this.removeDrawCountNodes(s,a);let T;const h=[],m=s.worldPosition,d=s.worldScaling;for(let x=0;x<r.length;x++){const{pos:E,points:P}=r[x],{ps:R,rect:N}=this.computDrawPoints(P);let b;const j=P.length===1;p===$t.Stroke||j?b=jr(R,!0):b=jr(R,!1);const O={pos:E,d:b,fillColor:p===$t.Stroke||j?u:void 0,lineDash:p===$t.Dotted&&!j?[1,c*2]:p===$t.LongDotted&&!j?[c,c*2]:void 0,strokeColor:u,lineCap:p===$t.Stroke||j?void 0:"round",lineWidth:p===$t.Stroke||j?0:c};T=oe(T,{x:Math.floor((N.x+E[0])*d[0]+m[0]-jt.SafeBorderPadding),y:Math.floor((N.y+E[1])*d[1]+m[1]-jt.SafeBorderPadding),w:Math.floor(N.w*d[0]+2*jt.SafeBorderPadding),h:Math.floor(N.h*d[1]+2*jt.SafeBorderPadding)}),h.push(O)}v&&(e.scale=v),I&&(e.rotate=I),w&&(e.translate=w);const M=new Ze;if(T){this.centerPos=jt.getCenterPos(T,s);const x=p===$t.Stroke&&!y;M.attr({...e,normalize:!0,anchor:[.5,.5],bgcolor:x?u:void 0,pos:this.centerPos,size:[(T.w-2*jt.SafeBorderPadding)/d[0],(T.h-2*jt.SafeBorderPadding)/d[1]],zIndex:g});const E=h.map(P=>(P.pos=[P.pos[0]-this.centerPos[0],P.pos[1]-this.centerPos[1]],new Wr(P)));M.append(...E),x&&M.seal(),y&&(this.scaleType=ee.proportional,this.drawEraserlines({group:M,eraserlines:y,pos:this.centerPos,layer:s},l)),this.replace(s,i,M)}if(v||I||w){const x=M?.getBoundingClientRect();x&&(T={x:Math.floor(x.x-jt.SafeBorderPadding),y:Math.floor(x.y-jt.SafeBorderPadding),w:Math.floor(x.width+jt.SafeBorderPadding*2),h:Math.floor(x.height+jt.SafeBorderPadding*2)})}return this.isDelete&&M.setAttribute("opacity",0),T}computDrawPoints(t){return this.workOptions.strokeType===$t.Stroke||t.length===1?this.computStroke(t):this.computNomal(t)}computNomal(t){let e=this.workOptions.thickness;const r=t.map(i=>(e=Math.max(e,i.radius),i.point));return{ps:r,rect:he(r,e)}}computStroke(t,e=!0){return t.length===1?this.computDotStroke(t[0]):this.computLineStroke(t,e)}computLineStroke(t,e=!0){const r=[],i=[];for(let a=0;a<t.length;a++){const{point:l,radius:u}=t[a];let p=l.v;a===0&&t.length>1&&(p=t[a+1].point.v);const c=ht.Per(p).mul(u);r.push(Wt.Sub(l,c)),i.push(Wt.Add(l,c))}const o=t[t.length-1];if(e){const a=Wt.GetSemicircleStroke(o.point,r[r.length-1],-1,8),l=Wt.GetSemicircleStroke(t[0].point,i[0],-1,8),u=r.concat(a,i.reverse(),l);return{ps:u,rect:he(u)}}const s=r.concat(i.reverse());return{ps:s,rect:he(s)}}computDotStroke(t){const{point:e,radius:r}=t,i={x:e.x-r,y:e.y-r,w:r*2,h:r*2};return{ps:Wt.GetDotStroke(e,r,8),rect:i}}transformData(t,e){const{op:r,workState:i}=t;let o=this.tmpPoints.length-1,s=[];if(r!=null&&r.length&&i){const{strokeType:a,thickness:l}=this.workOptions,u=new Set;o=a===$t.Stroke?this.updateTempPointsWithPressure(r,l,u):this.updateTempPoints(r,l,u);const p=e?this.tmpPoints:this.tmpPoints.slice(o);return s=this.getTaskPoints(p,l),{tasks:s,effects:u,consumeIndex:o}}return{tasks:s,consumeIndex:o}}computRadius(t,e){return t*.03*e+e*.5}getMinZ(t,e){return((e||Math.max(1,Math.floor(t*.3)))-t*.5)*100/t/3}getTaskPoints(t,e){var r;const i=[];if(t.length===0)return[];let o=0,s=t[0].x,a=t[0].y,l=[s,a],u=[],p=t[0].t;for(;o<t.length;){const c=t[o],g=c.x-s,v=c.y-a,I=c.z,w=e?this.computRadius(I,e):I;if(u.push({point:new Wt(g,v,I,t[o].v),radius:w}),o>0&&o<t.length-1){const y=t[o].getAngleByPoints(t[o-1],t[o+1]);if(y<60||y>300){const T=(r=u.pop())==null?void 0:r.point.clone();T&&i.push({taskId:p,pos:l,points:[...u,{point:T,radius:w}]}),s=t[o].x,a=t[o].y,l=[s,a];const h=c.x-s,m=c.y-a;u=[{point:new Wt(h,m,I),radius:w}],p=Date.now()}}o++}return i.push({taskId:p,pos:l,points:u}),i}updateTempPointsWithPressure(t,e,r){const i=Date.now(),o=this.tmpPoints.length;let s=o;for(let l=0;l<t.length;l+=2){s=Math.min(s,o);const u=this.tmpPoints.length,p=new Wt(t[l],t[l+1]);if(u===0){this.tmpPoints.push(p);continue}const c=u-1,g=this.tmpPoints[c],v=ht.Sub(p,g).uni();if(p.isNear(g,e)){if(g.z<this.MAX_REPEAR){if(g.setz(Math.min(g.z+1,this.MAX_REPEAR)),s=Math.min(s,c),u>1){let y=u-1;for(;y>0;){const T=this.tmpPoints[y].distance(this.tmpPoints[y-1]),h=Math.max(this.tmpPoints[y].z-this.uniThickness*T,0);if(this.tmpPoints[y-1].z>=h)break;this.tmpPoints[y-1].setz(h),s=Math.min(s,y-1),y--}}}else s=1/0;continue}p.setv(v);const I=p.distance(g),w=Math.max(g.z-this.uniThickness*I,0);u>1&&ht.Equals(v,g.v,.02)&&(w>0||g.z<=0)&&(r&&g.t&&r.add(g.t),this.tmpPoints.pop(),s=Math.min(c,s)),p.setz(w),this.tmpPoints.push(p)}if(s===1/0)return this.tmpPoints.length;let a=o;if(s===o){a=Math.max(a-1,0);const l=this.tmpPoints[a].t;l&&r?.add(l)}else{let l=o-1;for(a=s;l>=0;){const u=this.tmpPoints[l].t;if(u&&(r?.add(u),l<=s)){a=l,l=-1;break}l--}}return this.tmpPoints[a].setT(i),a}updateTempPoints(t,e,r){var i;const o=Date.now(),s=this.tmpPoints.length;let a=s;for(let u=0;u<t.length;u+=2){const p=this.tmpPoints.length,c=new Wt(t[u],t[u+1]);if(p===0){this.tmpPoints.push(c);continue}const g=p-1,v=this.tmpPoints[g],I=ht.Sub(c,v).uni();if(c.isNear(v,e/2)){a=Math.min(g,a);continue}ht.Equals(I,v.v,.02)&&(r&&v.t&&r.add(v.t),this.tmpPoints.pop(),a=Math.min(g,a)),c.setv(I),this.tmpPoints.push(c)}let l=s;if(a===s){l=Math.max(l-1,0);const u=this.tmpPoints[l].t;u&&r?.add(u)}else{let u=Math.min(s-1,a);for(l=a;u>=0;){const p=(i=this.tmpPoints[u])==null?void 0:i.t;if(p&&(r?.add(p),u<=a)){l=u,u=-1;break}u--}}return this.tmpPoints[l].setT(o),l}updateTempPointsWithPressureWhenDone(t){const{thickness:e}=this.workOptions,r=t.length,i=this.getMinZ(e);for(let o=0;o<r;o+=2){const s=this.tmpPoints.length,a=new Wt(t[o],t[o+1]);if(s===0){this.tmpPoints.push(a);continue}const l=s-1,u=this.tmpPoints[l],p=ht.Sub(a,u).uni(),c=a.distance(u);if(s>1&&u.z===i)break;if(a.isNear(u,e/2)){if(r<3&&u.z<this.MAX_REPEAR&&(u.setz(Math.min(u.z+1,this.MAX_REPEAR)),s>1)){let v=s-1;for(;v>0;){const I=this.tmpPoints[v].distance(this.tmpPoints[v-1]),w=Math.max(this.tmpPoints[v].z-this.uniThickness*I,-e/4);if(this.tmpPoints[v-1].z>=w)break;this.tmpPoints[v-1].setz(w),v--}}continue}a.setv(p);const g=Math.max(u.z-this.uniThickness*c,i);s>1&&ht.Equals(p,u.v,.02)&&u.z<=0&&this.tmpPoints.pop(),a.setz(g),this.tmpPoints.push(a)}}static updateNodeOpt(t){var e,r;const{node:i,opt:o,vNodes:s}=t,{strokeColor:a,strokeType:l}=o,u=s.get(i.name);return a&&(i.tagName==="GROUP"?YD(i)?i.setAttribute("bgcolor",a):i.children.forEach(p=>{p.setAttribute("strokeColor",a),p.getAttribute("fillColor")&&p.setAttribute("fillColor",a)}):(i.setAttribute("strokeColor",a),i.setAttribute("fillColor",a)),(e=u?.opt)!=null&&e.strokeColor&&(u.opt.strokeColor=a)),l&&u!=null&&u.opt&&(r=u.opt)!=null&&r.strokeType&&(u.opt.strokeType=l),u&&s.setInfo(i.name,u),jt.updateNodeOpt(t)}}class $m extends jt{constructor(t){super(t),G(this,"toolsType",nt.LaserPen),G(this,"canRotate",!1),G(this,"scaleType",ee.none),G(this,"syncTimestamp"),G(this,"syncIndex",0),G(this,"tmpPoints",[]),G(this,"workOptions"),G(this,"consumeIndex",0),this.workOptions=t.toolsOpt,this.syncTimestamp=0}combineConsume(){}setWorkOptions(t){super.setWorkOptions(t),this.syncTimestamp=Date.now()}consume(t){const{data:e,isSubWorker:r}=t,{workId:i,op:o,syncUnitTime:s}=e;if(o?.length===0)return{type:pt.None};if(s&&(this.syncUnitTime=s),this.updateTempPoints(o||[]),this.consumeIndex>this.tmpPoints.length-4)return{type:pt.None};const{strokeColor:a,thickness:l,strokeType:u}=this.workOptions,p=he(this.tmpPoints,l);let c=!1;const g=this.syncIndex,v=this.tmpPoints.slice(this.consumeIndex);this.consumeIndex=this.tmpPoints.length-1,this.syncTimestamp===0&&(this.syncTimestamp=Date.now());const I={name:i?.toString(),opacity:1,lineDash:u===$t.Dotted?[1,l*2]:u===$t.LongDotted?[l,l*2]:void 0,strokeColor:a,lineCap:"round",lineWidth:l,anchor:[.5,.5]},w=this.getTaskPoints(v);if(w.length){const T=Date.now();T-this.syncTimestamp>this.syncUnitTime&&(c=!0,this.syncTimestamp=T,this.syncIndex=this.tmpPoints.length),r&&this.draw({attrs:I,tasks:w,isDot:!1,layer:this.drawLayer||this.fullLayer})}const y=[];return this.tmpPoints.slice(g).forEach(T=>{y.push(T.x,T.y)}),{rect:{x:p.x*this.fullLayer.worldScaling[0]+this.fullLayer.worldPosition[0],y:p.y*this.fullLayer.worldScaling[1]+this.fullLayer.worldPosition[1],w:p.w*this.fullLayer.worldScaling[0],h:p.h*this.fullLayer.worldScaling[1]},type:pt.DrawWork,dataType:kt.Local,op:c?y:void 0,index:c?g*2:void 0,...this.baseConsumeResult}}consumeAll(){var t;const e=(t=this.workId)==null?void 0:t.toString();let r;if(this.tmpPoints.length-1>this.consumeIndex){let s=this.tmpPoints.slice(this.consumeIndex);const a=s.length===1,{strokeColor:l,thickness:u,strokeType:p}=this.workOptions;if(a){const v=this.computDotStroke({point:s[0],radius:u/2});s=v.ps,r=v.rect}else r=he(this.tmpPoints,u);const c={name:e?.toString(),fillColor:a?l:void 0,opacity:1,lineDash:p===$t.Dotted&&!a?[1,u*2]:p===$t.LongDotted&&!a?[u,u*2]:void 0,strokeColor:l,lineCap:a?void 0:"round",lineWidth:a?0:u,anchor:[.5,.5]},g=this.getTaskPoints(s);g.length&&this.draw({attrs:c,tasks:g,isDot:a,layer:this.drawLayer||this.fullLayer})}const i=[];this.tmpPoints.forEach(s=>{i.push(s.x,s.y)});const o=nn(i);return{rect:r&&{x:r.x*this.fullLayer.worldScaling[0]+this.fullLayer.worldPosition[0],y:r.y*this.fullLayer.worldScaling[1]+this.fullLayer.worldPosition[1],w:r.w*this.fullLayer.worldScaling[0],h:r.h*this.fullLayer.worldScaling[1]},type:pt.FullWork,dataType:kt.Local,ops:o,index:this.syncIndex*2,...this.baseConsumeResult}}clearTmpPoints(){this.tmpPoints.length=0,this.syncTimestamp=0,this.syncIndex=0}consumeService(t){var e;const{op:r,replaceId:i,isFullWork:o}=t,{strokeColor:s,thickness:a,strokeType:l}=this.workOptions;if(!r.length){const w=he(this.tmpPoints,a);return{x:w.x*this.fullLayer.worldScaling[0]+this.fullLayer.worldPosition[0],y:w.y*this.fullLayer.worldScaling[1]+this.fullLayer.worldPosition[1],w:w.w*this.fullLayer.worldScaling[0],h:w.h*this.fullLayer.worldScaling[1]}}const u=Math.max(0,this.tmpPoints.length-1);this.updateTempPoints(r||[]);let p,c=this.tmpPoints.slice(u);const g=c.length===1;if(g){const w=this.computDotStroke({point:c[0],radius:a/2});c=w.ps,p=w.rect}else p=he(this.tmpPoints,a);const v={name:(e=this.workId)==null?void 0:e.toString(),fillColor:g?s:void 0,opacity:1,lineDash:l===$t.Dotted&&!g?[1,a*2]:l===$t.LongDotted&&!g?[a,a*2]:void 0,strokeColor:s,lineCap:g?void 0:"round",lineWidth:g?0:a,anchor:[.5,.5]},I=this.getTaskPoints(c);if(I.length){const w=o?this.fullLayer:this.drawLayer||this.fullLayer;this.draw({attrs:v,tasks:I,isDot:g,replaceId:i,layer:w})}return{x:p.x*this.fullLayer.worldScaling[0]+this.fullLayer.worldPosition[0],y:p.y*this.fullLayer.worldScaling[1]+this.fullLayer.worldPosition[1],w:p.w*this.fullLayer.worldScaling[0],h:p.h*this.fullLayer.worldScaling[1]}}computDotStroke(t){const{point:e,radius:r}=t,i={x:e.x-r,y:e.y-r,w:r*2,h:r*2};return{ps:Wt.GetDotStroke(e,r,8),rect:i}}updateTempPoints(t){const e=this.tmpPoints.length;for(let r=0;r<t.length;r+=2){if(e){const i=this.tmpPoints.slice(-1)[0];i&&i.x===t[r]&&i.y===t[r+1]&&this.tmpPoints.pop()}this.tmpPoints.push(new Wt(t[r],t[r+1]))}}async draw(t){const{attrs:e,tasks:r,isDot:i,layer:o}=t,{duration:s}=this.workOptions;for(const a of r){const l=new Wr,{pos:u,points:p}=a;let c;i?c=jr(p,!0):c=jr(p,!1),l.attr({...e,pos:u,d:c});const{vertex:g,fragment:v}=this.workOptions;if(g&&v){const I=o.renderer.createProgram({vertex:g,fragment:v}),{width:w,height:y}=o.getResolution();l.setUniforms({u_time:0,u_resolution:[w,y]}),l.setProgram(I)}o.appendChild(l),l.transition(s).attr({scale:i?[.1,.1]:[1,1],lineWidth:i?0:1}).then(()=>{l.remove()})}}getTaskPoints(t){var e;const r=[];if(t.length===0)return[];let i=0,o=t[0].x,s=t[0].y,a=[o,s],l=[];for(;i<t.length;){const u=t[i],p=u.x-o,c=u.y-s;if(l.push(new Wt(p,c)),i>0&&i<t.length-1){const g=t[i].getAngleByPoints(t[i-1],t[i+1]);if(g<60||g>300){const v=(e=l.pop())==null?void 0:e.clone();v&&r.push({pos:a,points:[...l,v]}),o=t[i].x,s=t[i].y,a=[o,s];const I=u.x-o,w=u.y-s;l=[new Wt(I,w)]}}i++}return r.push({pos:a,points:l}),r}removeLocal(){}removeService(t){let e;const r=[];return this.fullLayer.getElementsByName(t).forEach(i=>{if(i.name===t){const o=i.getBoundingClientRect();e=oe(e,{x:o.x,y:o.y,w:o.width,h:o.height}),r.push(i)}}),r.length&&r.forEach(i=>i.remove()),e}}const Hm=class Gs extends jt{constructor(t,e){super(t),G(this,"canRotate",!1),G(this,"scaleType",ee.none),G(this,"toolsType",nt.Eraser),G(this,"serviceWork"),G(this,"tmpPoints",[]),G(this,"workOptions"),G(this,"worldPosition"),G(this,"worldScaling"),G(this,"eraserRect"),G(this,"eraserPolyline"),this.serviceWork=e,this.workOptions=t.toolsOpt,this.worldPosition=this.fullLayer.worldPosition,this.worldScaling=this.fullLayer.worldScaling}combineConsume(){}consumeService(){}setWorkOptions(t){super.setWorkOptions(t)}createEraserRect(t){const e=t[0]*this.worldScaling[0]+this.worldPosition[0],r=t[1]*this.worldScaling[1]+this.worldPosition[1],{width:i,height:o}=Gs.eraserSizes[this.workOptions.thickness];this.eraserRect={x:e-i*.5,y:r-o*.5,w:i,h:o},this.eraserPolyline=[this.eraserRect.x,this.eraserRect.y,this.eraserRect.x+this.eraserRect.w,this.eraserRect.y+this.eraserRect.h]}computRectCenterPoints(){const t=this.tmpPoints.slice(-2);if(this.tmpPoints.length===4){const e=new ht(this.tmpPoints[0],this.tmpPoints[1]),r=new ht(this.tmpPoints[2],this.tmpPoints[3]),i=ht.Sub(r,e).uni(),o=ht.Dist(e,r),{width:s,height:a}=Gs.eraserSizes[this.workOptions.thickness],l=Math.min(s,a),u=Math.round(o/l);if(u>1){const p=[];for(let c=0;c<u;c++){const g=ht.Mul(i,c*l);p.push(this.tmpPoints[0]+g.x,this.tmpPoints[1]+g.y)}return p.concat(t)}}return t}isNear(t,e){const r=new ht(t[0],t[1]),i=new ht(e[0],e[1]),{width:o,height:s}=Gs.eraserSizes[this.workOptions.thickness];return ht.Dist(r,i)<Math.hypot(o,s)*.5}remove(t){const{curNodeMap:e,removeIds:r}=t;let i;for(const o of e.values())if(o.rect&&this.eraserRect&&this.eraserPolyline&&Wu(this.eraserRect,o.rect)){const{op:s}=o,a=[],l=[];for(let p=0;p<s.length;p+=3){const c=new ht(s[p]*this.worldScaling[0]+this.worldPosition[0],s[p+1]*this.worldScaling[1]+this.worldPosition[1],s[p+2]);l.push(c),a.push(new Wt(c.x,c.y))}const u=a.length&&he(a)||o.rect;Wu(u,this.eraserRect)&&(l.length>1?Xu.polyline(l.map(p=>p.XY),this.eraserPolyline).length&&r.add(o.name):r.add(o.name),i=oe(i,o.rect||u))}return r.forEach(o=>{var s;const a=this.fullLayer.getElementsByName(o);a[0]&&(a[0].remove(),mn(a[0],this.fullLayer.parent),(s=this.vNodes)==null||s.delete(o))}),i&&(i.x-=jt.SafeBorderPadding,i.y-=jt.SafeBorderPadding,i.w+=jt.SafeBorderPadding*2,i.h+=jt.SafeBorderPadding*2),i}consume(t){const{op:e,disableEraseImage:r,disableEraseText:i}=t.data;if(!e||e.length===0)return{type:pt.None,...this.baseConsumeResult};const o=this.tmpPoints.length;if(o>1&&this.isNear([e[0],e[1]],[this.tmpPoints[o-2],this.tmpPoints[o-1]]))return{type:pt.None,...this.baseConsumeResult};o<3?this.tmpPoints.push(e[0],e[1]):this.tmpPoints.splice(2,2,e[0],e[1]);const s=this.computRectCenterPoints();let a;const l=new Set;if(!this.vNodes)return{type:pt.None,...this.baseConsumeResult};const u=this.getCanEraserNodeMap(this.vNodes.getCanEraserNodes(this.vNodes.curNodeMap,{disableEraseImage:r,disableEraseText:i}));for(let p=0;p<s.length-1;p+=2){this.createEraserRect(s.slice(p,p+2));const c=this.remove({curNodeMap:u,removeIds:l});a=oe(a,c)}return a&&l.size?{type:pt.RemoveNode,rect:a,removeIds:[...l]}:{type:pt.None,...this.baseConsumeResult}}consumeAll(t){return this.consume(t)}clearTmpPoints(){this.tmpPoints.length=0}getCanEraserNodeMap(t){var e;if(this.serviceWork){const r=new Map(t),i=this.serviceWork.selectorWorkShapes,o=this.serviceWork.workShapes;for(const s of i.values())if((e=s.selectIds)!=null&&e.length)for(const a of s.selectIds)r.delete(a);for(const s of o.keys())r.delete(s);return r}return t}};G(Hm,"eraserSizes",ih);let Qm=Hm;const gn="++",Xt="selector",Al="all";var YN="__lodash_hash_undefined__";function FN(n){return this.__data__.set(n,YN),this}var VN=FN;function XN(n){return this.__data__.has(n)}var GN=XN,$N=ym,HN=VN,QN=GN;function La(n){var t=-1,e=n==null?0:n.length;for(this.__data__=new $N;++t<e;)this.add(n[t])}La.prototype.add=La.prototype.push=HN;La.prototype.has=QN;var oh=La;function ZN(n,t){for(var e=-1,r=n==null?0:n.length;++e<r;)if(t(n[e],e,n))return!0;return!1}var KN=ZN;function JN(n,t){return n.has(t)}var sh=JN,qN=oh,_N=KN,t2=sh,e2=1,n2=2;function r2(n,t,e,r,i,o){var s=e&e2,a=n.length,l=t.length;if(a!=l&&!(s&&l>a))return!1;var u=o.get(n),p=o.get(t);if(u&&p)return u==t&&p==n;var c=-1,g=!0,v=e&n2?new qN:void 0;for(o.set(n,t),o.set(t,n);++c<a;){var I=n[c],w=t[c];if(r)var y=s?r(w,I,c,t,n,o):r(I,w,c,n,t,o);if(y!==void 0){if(y)continue;g=!1;break}if(v){if(!_N(t,function(T,h){if(!t2(v,h)&&(I===T||i(I,T,e,r,o)))return v.push(h)})){g=!1;break}}else if(!(I===w||i(I,w,e,r,o))){g=!1;break}}return o.delete(n),o.delete(t),g}var Zm=r2;function i2(n){var t=-1,e=Array(n.size);return n.forEach(function(r,i){e[++t]=[i,r]}),e}var o2=i2;function s2(n){var t=-1,e=Array(n.size);return n.forEach(function(r){e[++t]=r}),e}var ah=s2,ad=ns,ld=km,a2=Hc,l2=Zm,u2=o2,c2=ah,h2=1,f2=2,d2="[object Boolean]",p2="[object Date]",g2="[object Error]",m2="[object Map]",v2="[object Number]",y2="[object RegExp]",M2="[object Set]",T2="[object String]",I2="[object Symbol]",w2="[object ArrayBuffer]",S2="[object DataView]",ud=ad?ad.prototype:void 0,Dl=ud?ud.valueOf:void 0;function x2(n,t,e,r,i,o,s){switch(e){case S2:if(n.byteLength!=t.byteLength||n.byteOffset!=t.byteOffset)return!1;n=n.buffer,t=t.buffer;case w2:return!(n.byteLength!=t.byteLength||!o(new ld(n),new ld(t)));case d2:case p2:case v2:return a2(+n,+t);case g2:return n.name==t.name&&n.message==t.message;case y2:case T2:return n==t+"";case m2:var a=u2;case M2:var l=r&h2;if(a||(a=c2),n.size!=t.size&&!l)return!1;var u=s.get(n);if(u)return u==t;r|=f2,s.set(n,t);var p=l2(a(n),a(t),r,i,o,s);return s.delete(n),p;case I2:if(Dl)return Dl.call(n)==Dl.call(t)}return!1}var C2=x2,cd=Rm,E2=1,P2=Object.prototype,N2=P2.hasOwnProperty;function A2(n,t,e,r,i,o){var s=e&E2,a=cd(n),l=a.length,u=cd(t),p=u.length;if(l!=p&&!s)return!1;for(var c=l;c--;){var g=a[c];if(!(s?g in t:N2.call(t,g)))return!1}var v=o.get(n),I=o.get(t);if(v&&I)return v==t&&I==n;var w=!0;o.set(n,t),o.set(t,n);for(var y=s;++c<l;){g=a[c];var T=n[g],h=t[g];if(r)var m=s?r(h,T,g,t,n,o):r(T,h,g,n,t,o);if(!(m===void 0?T===h||i(T,h,e,r,o):m)){w=!1;break}y||(y=g=="constructor")}if(w&&!y){var d=n.constructor,M=t.constructor;d!=M&&"constructor"in n&&"constructor"in t&&!(typeof d=="function"&&d instanceof d&&typeof M=="function"&&M instanceof M)&&(w=!1)}return o.delete(n),o.delete(t),w}var D2=A2,Ll=Mm,L2=Zm,O2=C2,b2=D2,hd=il,fd=rs,dd=Zc,R2=Em,j2=1,pd="[object Arguments]",gd="[object Array]",Ps="[object Object]",z2=Object.prototype,md=z2.hasOwnProperty;function k2(n,t,e,r,i,o){var s=fd(n),a=fd(t),l=s?gd:hd(n),u=a?gd:hd(t);l=l==pd?Ps:l,u=u==pd?Ps:u;var p=l==Ps,c=u==Ps,g=l==u;if(g&&dd(n)){if(!dd(t))return!1;s=!0,p=!1}if(g&&!p)return o||(o=new Ll),s||R2(n)?L2(n,t,e,r,i,o):O2(n,t,l,e,r,i,o);if(!(e&j2)){var v=p&&md.call(n,"__wrapped__"),I=c&&md.call(t,"__wrapped__");if(v||I){var w=v?n.value():n,y=I?t.value():t;return o||(o=new Ll),i(w,y,e,r,o)}}return g?(o||(o=new Ll),b2(n,t,e,r,i,o)):!1}var B2=k2,W2=B2,vd=er;function Km(n,t,e,r,i){return n===t?!0:n==null||t==null||!vd(n)&&!vd(t)?n!==n&&t!==t:W2(n,t,e,r,Km,i)}var U2=Km,Y2=U2;function F2(n,t){return Y2(n,t)}var V2=F2;const Pr=qi(V2);function is(n,t,e){return"#"+((n<<16)+(t<<8)+e).toString(16).padStart(6,"0")}function Re(n,t=1){return"rgba("+parseInt("0x"+n.slice(1,3))+","+parseInt("0x"+n.slice(3,5))+","+parseInt("0x"+n.slice(5,7))+","+t+")"}function Qr(n,t,e,r=1){return`rgba(${n},${t},${e},${r})`}function ol(n){const t=n.split(","),e=parseInt(t[0].split("(")[1]),r=parseInt(t[1]),i=parseInt(t[2]),o=Number(t[3].split(")")[0]);return[is(e,r,i),o]}function wo(n){const t=n.split(","),e=parseInt(t[0].split("(")[1]),r=parseInt(t[1]),i=parseInt(t[2]),o=Number(t[3].split(")")[0]);return[e,r,i,o]}function Ns(n){return n==="transparent"}const Jm=class qm extends jt{constructor(t){super(t),G(this,"toolsType",nt.Selector),G(this,"tmpPoints",[]),G(this,"workOptions"),G(this,"vNodes"),G(this,"selectIds"),G(this,"selectorColor"),G(this,"strokeColor"),G(this,"fillColor"),G(this,"oldSelectRect"),G(this,"canRotate",!1),G(this,"canTextEdit",!1),G(this,"canLock",!1),G(this,"scaleType",ee.all),G(this,"toolsTypes"),G(this,"shapeOpt"),G(this,"textOpt"),G(this,"isLocked"),G(this,"thickness"),G(this,"strokeType"),G(this,"useStroke"),this.workOptions=t.toolsOpt,this.vNodes=t.vNodes}computSelector(t=!0){const e=he(this.tmpPoints);if(e.w===0||e.h===0)return{selectIds:[],intersectRect:void 0,subNodeMap:new Map};const{rectRange:r,nodeRange:i}=this.vNodes.getRectIntersectRange(e,t);return{selectIds:[...i.keys()],intersectRect:r,subNodeMap:i}}updateTempPoints(t){const e=this.tmpPoints.length,r=t.length;if(r>1){const i=new Wt(t[r-2]*this.fullLayer.worldScaling[0]+this.fullLayer.worldPosition[0],t[r-1]*this.fullLayer.worldScaling[0]+this.fullLayer.worldPosition[1]);e===2?this.tmpPoints.splice(1,1,i):this.tmpPoints.push(i)}}drawSelector(t){const{drawRect:e,subNodeMap:r,selectorId:i,layer:o,isService:s}=t,a=new Ze({pos:[e.x,e.y],anchor:[0,0],size:[e.w,e.h],id:i,name:i,zIndex:9999}),l=[];if(s){const u=new mh({normalize:!0,pos:[e.w/2,e.h/2],lineWidth:1,strokeColor:this.selectorColor||this.workOptions.strokeColor,width:e.w,height:e.h,name:qm.selectorBorderId});l.push(u)}r.forEach((u,p)=>{const c=[u.rect.x+u.rect.w/2-e.x,u.rect.y+u.rect.h/2-e.y],g=new mh({normalize:!0,pos:c,lineWidth:1,strokeColor:r.size>1?this.selectorColor||this.workOptions.strokeColor:void 0,width:u.rect.w,height:u.rect.h,id:`selector-${p}`,name:`selector-${p}`});l.push(g)}),l&&a.append(...l),(o?.parent).appendChild(a)}draw(t,e,r,i=!1){var o,s;const{intersectRect:a,subNodeMap:l}=r;(s=(o=e.parent)==null?void 0:o.getElementById(t))==null||s.remove(),a&&this.drawSelector({drawRect:a,subNodeMap:l,selectorId:t,layer:e,isService:i})}getSelecteorInfo(t){this.scaleType=ee.all,this.canRotate=!1,this.textOpt=void 0,this.strokeColor=void 0,this.fillColor=void 0,this.canTextEdit=!1,this.canLock=!1,this.isLocked=!1,this.toolsTypes=void 0,this.shapeOpt=void 0,this.thickness=void 0,this.strokeType=void 0,this.useStroke=!1;const e=new Set;let r,i=!0;for(const o of t.values()){const{opt:s,canRotate:a,scaleType:l,toolsType:u}=o;this.selectorColor=this.workOptions.strokeColor,s.strokeColor&&(this.strokeColor=s.strokeColor),s.fillColor&&(this.fillColor=s.fillColor),s.textOpt&&(this.textOpt=s.textOpt),s.thickness&&(this.thickness=s.thickness),u!==nt.Pencil&&(i=!1),s.strokeType&&(this.strokeType=s.strokeType),u===nt.SpeechBalloon&&(e.add(u),this.shapeOpt||(this.shapeOpt={}),this.shapeOpt.placement=s.placement),u===nt.Polygon&&(e.add(u),this.shapeOpt||(this.shapeOpt={}),this.shapeOpt.vertices=s.vertices),u===nt.Star&&(e.add(u),this.shapeOpt||(this.shapeOpt={}),this.shapeOpt.vertices=s.vertices,this.shapeOpt.innerRatio=s.innerRatio,this.shapeOpt.innerVerticeStep=s.innerVerticeStep),u===nt.Text&&(this.textOpt=s),t.size===1&&(this.textOpt&&(this.canTextEdit=!0),this.canRotate=a,this.scaleType=l),u===nt.Image&&(r=o),(l===ee.proportional&&this.scaleType!==ee.none||l===ee.none)&&(this.scaleType=l)}i&&(this.useStroke=!0),e.size&&(this.toolsTypes=[...e]),r&&(t.size===1?(this.canLock=!0,r.opt.locked&&(this.isLocked=!0,this.scaleType=ee.none,this.canRotate=!1,this.textOpt=void 0,this.fillColor=void 0,this.selectorColor="rgb(177,177,177)",this.strokeColor=void 0,this.canTextEdit=!1,this.thickness=void 0,this.strokeType=void 0,this.useStroke=void 0)):t.size>1&&!r.opt.locked&&(this.canLock=!1,this.canRotate=!1))}getChildrenPoints(){var t,e;if(this.scaleType===ee.both&&((t=this.selectIds)==null?void 0:t.length)===1){const r=this.selectIds[0],i=(e=this.vNodes.get(r))==null?void 0:e.op;if(i){const o=[];for(let s=0;s<i.length;s+=3)o.push([i[s],i[s+1]]);return o}}}consume(t){if(t.isSubWorker)return this.subWorkerConsume(t);const{op:e,workState:r}=t.data;let i=this.oldSelectRect;if(r===Tt.Start&&(i=this.unSelectedAllIds()),!(e!=null&&e.length)||!this.vNodes.curNodeMap.size)return{type:pt.None};this.updateTempPoints(e);const o=this.computSelector();if(this.selectIds&&Pr(this.selectIds,o.selectIds))return{type:pt.None};this.selectIds=o.selectIds;const s=o.intersectRect;this.getSelecteorInfo(o.subNodeMap),this.draw(Xt,this.fullLayer,o),this.oldSelectRect=s;const a=this.getChildrenPoints();return{type:pt.Select,dataType:kt.Local,rect:oe(s,i),selectIds:o.selectIds,selectRect:s,selectorColor:this.selectorColor,strokeColor:this.strokeColor,fillColor:this.fillColor,textOpt:this.textOpt,canTextEdit:this.canTextEdit,canRotate:this.canRotate,canLock:this.canLock,scaleType:this.scaleType,willSyncService:!0,points:a,isLocked:this.isLocked,toolsTypes:this.toolsTypes,shapeOpt:this.shapeOpt,thickness:this.thickness,useStroke:this.useStroke,strokeType:this.strokeType,...this.baseConsumeResult}}consumeAll(){var t,e;let r=this.oldSelectRect;if(!((t=this.selectIds)!=null&&t.length)&&this.tmpPoints[0]&&this.selectSingleTool(this.tmpPoints[0].XY,Xt,!1),(e=this.selectIds)!=null&&e.length&&(r=this.selectedByIds(this.selectIds)),r){const i=this.getChildrenPoints();return{type:pt.Select,dataType:kt.Local,rect:this.oldSelectRect,selectIds:this.selectIds,selectorColor:this.selectorColor,selectRect:this.oldSelectRect,strokeColor:this.strokeColor,fillColor:this.fillColor,textOpt:this.textOpt,canTextEdit:this.canTextEdit,canRotate:this.canRotate,canLock:this.canLock,scaleType:this.scaleType,willSyncService:!0,points:i,isLocked:this.isLocked,toolsTypes:this.toolsTypes,shapeOpt:this.shapeOpt,thickness:this.thickness,useStroke:this.useStroke,strokeType:this.strokeType,...this.baseConsumeResult}}return{type:pt.None}}consumeService(){}updateTempPointsForSubWorker(t){const e=t.slice(-2),r=new Wt(e[0],e[1]);if(this.tmpPoints[0].isNear(r,1))return!1;if(this.tmpPoints.length===2){if(r.isNear(this.tmpPoints[1],1))return!1;this.tmpPoints[1]=r}else this.tmpPoints.push(r);return!0}computDrawPoints(t){const{thickness:e}=this.workOptions,r=[];for(const s of t)r.push(new ht(...s));const i=he(r,e),o=[i.x+i.w/2,i.y+i.h/2];return{rect:i,pos:o,points:r.map(s=>s.XY).flat(1)}}drawForSubWorker(t){const{workId:e,layer:r,ps:i}=t,{strokeColor:o,scale:s,rotate:a,translate:l}=this.workOptions,u=r.worldPosition,p=r.worldScaling,{points:c,rect:g,pos:v}=this.computDrawPoints(i),I=1/r.worldScaling[0],w=o&&wo(o)||[0,0,0,0],y={close:!0,normalize:!0,points:c,lineWidth:I,fillColor:Qr(w[0],w[1],w[2],.1),strokeColor:Qr(w[0],w[1],w[2],1),lineJoin:"round",lineCap:"round"};let T={x:Math.floor(g.x*p[0]+u[0]-jt.SafeBorderPadding),y:Math.floor(g.y*p[1]+u[1]-jt.SafeBorderPadding),w:Math.floor(g.w*p[0]+2*jt.SafeBorderPadding),h:Math.floor(g.h*p[0]+2*jt.SafeBorderPadding)};const h=new Ze({name:e,id:e,pos:v,anchor:[.5,.5],size:[g.w,g.h],scale:s,rotate:a,translate:l}),m=new gr({...y,pos:[0,0]});if(h.appendChild(m),this.replace(r,e,h),s||a||l){const d=h.getBoundingClientRect();T={x:Math.floor(d.x-jt.SafeBorderPadding),y:Math.floor(d.y-jt.SafeBorderPadding),w:Math.floor(d.width+2*jt.SafeBorderPadding),h:Math.floor(d.height+2*jt.SafeBorderPadding)}}return T}transformData(){const t=he(this.tmpPoints);return[[t.x,t.y,0],[t.x+t.w,t.y,0],[t.x+t.w,t.y+t.h,0],[t.x,t.y+t.h,0]]}subWorkerConsume(t){const{data:e,isFullWork:r}=t,{op:i,syncUnitTime:o}=e;o&&(this.syncUnitTime=o);const s=i?.length;if(!s||s<2)return{type:pt.None};let a;if(this.tmpPoints.length===0?(this.tmpPoints=[new Wt(i[0],i[1])],a=!1):a=this.updateTempPointsForSubWorker(i),!a)return{type:pt.None};const l=this.transformData(),u=r?this.fullLayer:this.drawLayer||this.fullLayer,p=this.drawForSubWorker({ps:l,workId:this.workId,layer:u}),c=oe(p,this.oldSelectRect);return this.oldSelectRect=p,{rect:c,type:pt.DrawWork,dataType:kt.Local,...this.baseConsumeResult}}subWorkerConsumeAll(t){const{isFullWork:e}=t,r=e?this.fullLayer:this.drawLayer||this.fullLayer;return this.replace(r,this.workId),{rect:this.oldSelectRect,type:pt.FullWork,dataType:kt.Local,...this.baseConsumeResult}}clearTmpPoints(){this.tmpPoints.length=0}clearSelectData(){this.selectIds=void 0,this.oldSelectRect=void 0}selectSingleTool(t,e=Xt,r=!1){if(t.length===2){const i=t[0],o=t[1];let s;const{nodeRange:a}=this.vNodes.getRectIntersectRange({x:i,y:o,w:0,h:0},!1),l=[...a.values()].sort((u,p)=>(p.opt.zIndex||0)-(u.opt.zIndex||0));for(const u of l){const p=this.fullLayer.getElementsByName(u.name);if(dv(p).find(c=>c.isPointCollision(i,o))){s=u;break}}if(s){const u=s.name;if(!Pr(this.oldSelectRect,s.rect)){const p=new Map([[u,s]]);this.getSelecteorInfo(p),this.draw(e,this.fullLayer,{intersectRect:s.rect,subNodeMap:p,selectIds:this.selectIds||[]},r)}this.selectIds=[u],this.oldSelectRect=s.rect}}}unSelectedAllIds(){let t;for(const[e,r]of this.vNodes.curNodeMap.entries())r.isSelected&&(t=oe(t,r.rect),this.vNodes.unSelected(e));return t}unSelectedByIds(t){let e;for(const r of t){const i=this.vNodes.get(r);i&&i.isSelected&&(e=oe(e,i.rect),this.vNodes.unSelected(r))}return e}selectedByIds(t){let e;for(const r of t){const i=this.vNodes.get(r);i&&(e=oe(e,i.rect),this.vNodes.selected(r))}return e}getSelectorRect(t,e){var r;let i;const o=(r=t.parent)==null?void 0:r.getElementById(e),s=o?.getBoundingClientRect();return s&&(i=oe(i,{x:Math.floor(s.x),y:Math.floor(s.y),w:Math.floor(s.width+1),h:Math.floor(s.height+1)})),i}isCanFillColor(t){return t===nt.Ellipse||t===nt.Triangle||t===nt.Rectangle||t===nt.Polygon||t===nt.Star||t===nt.SpeechBalloon}async updateSelector(t){const{updateSelectorOpt:e,selectIds:r,vNodes:i,willSerializeData:o,worker:s,offset:a}=t,l=this.fullLayer;if(!l)return;let u;const p=new Map,{originPoint:c,workState:g,angle:v,translate:I,dir:w,scale:y}=e;a&&(I?e.translate=[I[0]+a[0],I[1]+a[1]]:e.translate=a);let T;if(c||I||tn(v)){if(g===Tt.Start&&r)return i.setTargetAssignKeys(r),{type:pt.Select,dataType:kt.Local,selectRect:this.oldSelectRect,rect:this.oldSelectRect};if(T=i.getLastTarget(),!T)return}if(r)for(const d of r){const M=i.get(d);if(M){const{toolsType:x,opt:E}=M,P=(l?.getElementsByName(d))[0];if(P){const R={...e};let N;const b=jt.isWillRefresh({toolsType:x,opt:E,updateOpt:R,vNodes:i,node:P,willSerializeData:o});if(x){N=T?.get(d);const j=fv(x);if(j?.updateNodeOpt({node:P,opt:R,vNodes:i,willSerializeData:o,targetNode:N}),M&&s&&b){const O=s.createWorkShapeNode({workId:d,toolsType:x,toolsOpt:M.opt});O?.setWorkId(d);let L;if(x===nt.Image)L=await O.consumeServiceAsync({isFullWork:!0,replaceId:d,worker:s});else if(x===nt.Text)L=await O.consumeServiceAsync({isFullWork:!0,replaceId:d});else try{L=O?.consumeService({op:M.op,isFullWork:!0,replaceId:d,workState:g})}catch(k){console.error("consumeService error",k);continue}L&&(M.rect=L)}M&&(p.set(d,M),u=oe(u,M.rect))}}}}T&&g===Tt.Done&&(i.deleteLastTarget(),T=void 0);const h=u;if(c&&I&&y&&w&&h&&!a){const d=[[h.x,h.y],[h.x+h.w,h.y],[h.x+h.w,h.y+h.h],[h.x,h.y+h.h]];let M;switch(w){case"top":case"topLeft":case"left":I[0]>0&&I[1]>0?M=d[0]:I[0]>0?M=d[3]:I[1]>0?M=d[1]:M=d[2];break;case"topRight":I[0]<0&&I[1]>0?M=d[1]:I[0]<0?M=d[2]:I[1]>0?M=d[0]:M=d[3];break;case"right":case"bottomRight":case"bottom":I[0]<0&&I[1]<0?M=d[2]:I[0]<0?M=d[1]:I[1]<0?M=d[3]:M=d[0];break;case"bottomLeft":I[0]>0&&I[1]<0?M=d[3]:I[0]>0?M=d[0]:I[1]<0?M=d[2]:M=d[1];break}const x=M&&[c[0]-M[0],c[1]-M[1]]||[0,0];if(!Pr(x,[0,0]))return await this.updateSelector({...t,updateSelectorOpt:{workState:g},offset:x})}this.getSelecteorInfo(p),this.draw(Xt,l,{selectIds:r||[],subNodeMap:p,intersectRect:h});const m=oe(this.oldSelectRect,h);return this.oldSelectRect=h,{type:pt.Select,dataType:kt.Local,selectRect:h,renderRect:u,rect:oe(m,h),selectIds:r}}blurSelector(){const t=this.unSelectedAllIds();return{type:pt.Select,dataType:kt.Local,rect:t,selectIds:[],willSyncService:!0}}getRightServiceId(t){return t.replace(gn,"-")}selectServiceNode(t,e,r){const{selectIds:i}=e,o=this.getRightServiceId(t),s=this.getSelectorRect(this.fullLayer,o);let a;const l=new Map;return i?.forEach(u=>{const p=this.vNodes.get(u);p&&(a=oe(a,p.rect),l.set(u,p))}),this.getSelecteorInfo(l),this.draw(o,this.fullLayer,{intersectRect:a,selectIds:i||[],subNodeMap:l},r),oe(a,s)}reRenderSelector(){var t;let e;const r=new Map;return(t=this.selectIds)==null||t.forEach(i=>{const o=this.vNodes.get(i);o&&(e=oe(e,o.rect),r.set(i,o))},this),this.getSelecteorInfo(r),this.draw(Xt,this.fullLayer,{intersectRect:e,subNodeMap:r,selectIds:this.selectIds||[]}),this.oldSelectRect=e,e}updateSelectIds(t){var e;let r;const i=(e=this.selectIds)==null?void 0:e.filter(s=>!t.includes(s));if(i!=null&&i.length&&(r=this.unSelectedByIds(i)),t.length){const s=this.selectedByIds(t);r=oe(r,s)}this.selectIds=t;const o=this.reRenderSelector();return{bgRect:r,selectRect:o}}cursorHover(t){var e,r;const i=this.oldSelectRect;this.selectIds=[];const o=(e=this.workId)==null?void 0:e.toString(),s=[t[0]*this.fullLayer.worldScaling[0]+this.fullLayer.worldPosition[0],t[1]*this.fullLayer.worldScaling[0]+this.fullLayer.worldPosition[1]];if(this.selectSingleTool(s,o,!0),this.oldSelectRect&&!Pr(i,this.oldSelectRect))return{type:pt.CursorHover,dataType:kt.Local,rect:oe(i,this.oldSelectRect),selectorColor:this.selectorColor,willSyncService:!1};if((r=this.selectIds)!=null&&r.length||(this.oldSelectRect=void 0),i&&!this.oldSelectRect)return this.cursorBlur(),{type:pt.CursorHover,dataType:kt.Local,rect:i,selectorColor:this.selectorColor,willSyncService:!1}}cursorBlur(){var t,e;this.selectIds=[];const r=(t=this.workId)==null?void 0:t.toString();((e=this.fullLayer)==null?void 0:e.parent).children.forEach(i=>{i.name===r&&i.remove()})}};G(Jm,"selectorBorderId","selector-border");let _m=Jm;class tv extends jt{constructor(t){super(t),G(this,"canRotate",!1),G(this,"scaleType",ee.both),G(this,"toolsType",nt.Arrow),G(this,"tmpPoints",[]),G(this,"workOptions"),G(this,"oldRect"),G(this,"arrowTipWidth"),G(this,"syncTimestamp"),this.workOptions=t.toolsOpt,this.arrowTipWidth=this.workOptions.thickness*4,this.syncTimestamp=0,this.syncUnitTime=50}consume(t){const{data:e,isFullWork:r,isSubWorker:i,isMainThread:o,smoothSync:s}=t,a=this.workId,{op:l,syncUnitTime:u}=e;u&&(this.syncUnitTime=u);const p=l?.length;if(!p||p<2)return{type:pt.None};let c;if(this.tmpPoints.length===0?(this.tmpPoints=[new Wt(l[0],l[1])],c=!1):c=this.updateTempPoints(l),!c)return{type:pt.None};let g;if(i||o){const I=r?this.fullLayer:this.drawLayer||this.fullLayer;g=this.draw({workId:a,layer:I})}if(!i&&s){const I=Date.now();return I-this.syncTimestamp>this.syncUnitTime?(this.syncTimestamp=I,{...this.baseConsumeResult,type:pt.DrawWork,dataType:kt.Local,op:this.tmpPoints.map(w=>[...w.XY,0]).flat(1),isSync:!0,index:0}):{type:pt.None}}const v=oe(g,this.oldRect);return this.oldRect=g,{rect:v,...this.baseConsumeResult,type:pt.DrawWork,dataType:kt.Local}}consumeAll(){var t;const e=this.workId;if(this.tmpPoints.length<2)return{type:pt.RemoveNode,removeIds:[e]};const r=this.fullLayer,i=this.draw({workId:e,layer:r});this.oldRect=i;const o=this.tmpPoints.map(a=>[...a.XY,0]).flat(1),s=nn(o);return(t=this.vNodes)==null||t.setInfo(e,{rect:i,op:o,opt:this.workOptions,toolsType:this.toolsType,canRotate:this.canRotate,scaleType:this.scaleType,centerPos:jt.getCenterPos(i,r)}),{rect:i,...this.baseConsumeResult,type:pt.FullWork,dataType:kt.Local,ops:s,isSync:!0,updateNodeOpt:{useAnimation:!0}}}draw(t){const{workId:e,layer:r,isDrawEraserlines:i}=t,{strokeColor:o,thickness:s,zIndex:a,scale:l,rotate:u,translate:p,strokeType:c,eraserlines:g}=this.workOptions,v=r.worldPosition,I=r.worldScaling,{points:w,pos:y,rect:T,isTriangle:h,trianglePoints:m,trianglePos:d}=this.computDrawPoints(s),M=[T.x+T.w/2,T.y+T.h/2],x={pos:M,name:e,id:e,zIndex:a,anchor:[.5,.5],size:[T.w,T.h]};l&&(x.scale=l),u&&(x.rotate=u),p&&(x.translate=p);const E=new Ze(x),P={points:m,pos:[d[0]-M[0],d[1]-M[1]],fillColor:o,strokeColor:o,lineWidth:0,normalize:!1},R=new gr(P);if(E.append(R),!h&&w&&y){const b={points:w,pos:[y[0]-M[0],y[1]-M[1]],fillColor:o,strokeColor:o,lineDash:c===$t.Dotted&&!h?[1,s*2]:c===$t.LongDotted&&!h?[s,s*2]:void 0,lineCap:c===$t.Normal?void 0:"round",lineWidth:s,normalize:!1},j=new gr(b);E.append(j)}g&&(this.scaleType=ee.proportional,this.drawEraserlines({group:E,eraserlines:g,pos:M,layer:r},i)),this.replace(r,e,E);let N={x:Math.floor(T.x*I[0]+v[0]-jt.SafeBorderPadding),y:Math.floor(T.y*I[1]+v[1]-jt.SafeBorderPadding),w:Math.floor(T.w*I[0]+2*jt.SafeBorderPadding),h:Math.floor(T.h*I[1]+2*jt.SafeBorderPadding)};if(l||u||p){const b=E.getBoundingClientRect();N={x:Math.floor(b.x-jt.SafeBorderPadding),y:Math.floor(b.y-jt.SafeBorderPadding),w:Math.floor(b.width+jt.SafeBorderPadding*2),h:Math.floor(b.height+jt.SafeBorderPadding*2)}}return this.isDelete&&E.setAttribute("opacity",0),N}computDrawPoints(t){return this.tmpPoints[1].distance(this.tmpPoints[0])>this.arrowTipWidth?this.computFullArrowPoints(t):this.computTrianglePoints()}computFullArrowPoints(t){const e=ht.Sub(this.tmpPoints[1],this.tmpPoints[0]).uni(),r=ht.Per(e).mul(t/2),i=Wt.Sub(this.tmpPoints[0],r),o=Wt.Add(this.tmpPoints[0],r),s=ht.Mul(e,this.arrowTipWidth),a=ht.Sub(this.tmpPoints[1],s),l=Wt.Sub(a,r),u=Wt.Add(a,r),p=ht.Per(e).mul(t*1.5),c=Wt.Sub(a,p),g=Wt.Add(a,p),v=[this.tmpPoints[0],a],I=[c,this.tmpPoints[1],g],w=[i,o,...I,l,u];return{trianglePoints:I.map(y=>Wt.Sub(y,this.tmpPoints[1]).XY).flat(1),trianglePos:this.tmpPoints[1].XY,points:v.map(y=>Wt.Sub(y,this.tmpPoints[0]).XY).flat(1),rect:he(w),isTriangle:!1,pos:this.tmpPoints[0].XY}}computTrianglePoints(){const t=ht.Sub(this.tmpPoints[1],this.tmpPoints[0]).uni(),e=this.tmpPoints[1].distance(this.tmpPoints[0]),r=ht.Per(t).mul(Math.floor(e*3/8)),i=Wt.Sub(this.tmpPoints[0],r),o=Wt.Add(this.tmpPoints[0],r),s=[i,this.tmpPoints[1],o];return{trianglePoints:s.map(a=>Wt.Sub(a,this.tmpPoints[1]).XY).flat(1),trianglePos:this.tmpPoints[1].XY,rect:he(s),isTriangle:!0}}updateTempPoints(t){const e=t.slice(-2),r=new Wt(e[0],e[1]),i=this.tmpPoints[0],{thickness:o}=this.workOptions;if(i.isNear(r,o))return!1;if(this.tmpPoints.length===2){if(r.isNear(this.tmpPoints[1],1))return!1;this.tmpPoints[1]=r}else this.tmpPoints.push(r);return!0}consumeService(t){var e,r;const{op:i,isFullWork:o,workState:s=Tt.Done}=t,a=(e=this.workId)==null?void 0:e.toString();if(!a)return;this.tmpPoints.length=0;for(let p=0;p<i.length;p+=3)this.tmpPoints.push(new Wt(i[p],i[p+1],i[p+2]));const l=o?this.fullLayer:this.drawLayer||this.fullLayer,u=this.draw({workId:a,layer:l,isDrawEraserlines:s===Tt.Done});return this.oldRect=u,(r=this.vNodes)==null||r.setInfo(a,{rect:u,op:i,opt:this.workOptions,toolsType:this.toolsType,canRotate:this.canRotate,scaleType:this.scaleType,centerPos:jt.getCenterPos(u,l)}),u}clearTmpPoints(){this.tmpPoints.length=0}static updateNodeOpt(t){var e,r;const{node:i,opt:o,vNodes:s}=t,{strokeColor:a,strokeType:l}=o,u=s.get(i.name);return a&&(i.tagName==="GROUP"?i.children.forEach(p=>{p.setAttribute("strokeColor",a),p.getAttribute("fillColor")&&p.setAttribute("fillColor",a)}):(i.setAttribute("strokeColor",a),i.setAttribute("fillColor",a)),(e=u?.opt)!=null&&e.strokeColor&&(u.opt.strokeColor=a)),l&&u!=null&&u.opt&&(r=u.opt)!=null&&r.strokeType&&(u.opt.strokeType=l),u&&s.setInfo(i.name,u),jt.updateNodeOpt(t)}}class ev extends jt{constructor(t){super(t),G(this,"canRotate",!1),G(this,"scaleType",ee.all),G(this,"toolsType",nt.Ellipse),G(this,"tmpPoints",[]),G(this,"workOptions"),G(this,"oldRect"),G(this,"syncTimestamp"),this.workOptions=t.toolsOpt,this.syncTimestamp=0,this.syncUnitTime=50}consume(t){const{data:e,isFullWork:r,isSubWorker:i,isMainThread:o,smoothSync:s}=t,a=this.workId,{op:l,syncUnitTime:u}=e;u&&(this.syncUnitTime=u);const p=l?.length;if(!p||p<2)return{type:pt.None};let c;if(this.tmpPoints.length===0?(this.tmpPoints=[new Wt(l[0],l[1])],c=!1):c=this.updateTempPoints(l),!c)return{type:pt.None};if(!i&&s){const v=Date.now();return v-this.syncTimestamp>this.syncUnitTime?(this.syncTimestamp=v,{type:pt.DrawWork,dataType:kt.Local,...this.baseConsumeResult,op:this.tmpPoints.map(I=>[...I.XY,0]).flat(1),isSync:!0,index:0}):{type:pt.None}}let g;if(i||o){const v=r?this.fullLayer:this.drawLayer||this.fullLayer;g=this.draw({workId:a,layer:v,isDrawing:!0});const I=v.parent.parent,w={x:0,y:0,w:Math.floor(I.width),h:Math.floor(I.height)};if(wv(g,w)!==si.outside){const y=oe(g,this.oldRect);return this.oldRect=g,{rect:y,type:pt.DrawWork,dataType:kt.Local,...this.baseConsumeResult}}return{type:pt.None}}return{type:pt.None}}consumeAll(){var t;const e=this.workId;if(this.tmpPoints.length<2)return{type:pt.RemoveNode,removeIds:[e]};const r=this.fullLayer,i=this.draw({workId:e,layer:r,isDrawing:!1});this.oldRect=i;const o=this.tmpPoints.map(a=>[...a.XY,0]).flat(1),s=nn(o);return(t=this.vNodes)==null||t.setInfo(e,{rect:i,op:o,opt:this.workOptions,toolsType:this.toolsType,canRotate:this.canRotate,scaleType:this.scaleType,centerPos:i&&jt.getCenterPos(i,r)}),{rect:i,type:pt.FullWork,dataType:kt.Local,...this.baseConsumeResult,ops:s,isSync:!0,updateNodeOpt:{useAnimation:!0}}}draw(t){const{workId:e,layer:r,isDrawing:i,isDrawEraserlines:o}=t,{strokeColor:s,fillColor:a,thickness:l,zIndex:u,scale:p,rotate:c,translate:g,strokeType:v,eraserlines:I}=this.workOptions,w=r.worldScaling,{radius:y,rect:T,pos:h}=this.computDrawPoints(l),m={closeType:"normal",radius:y,lineWidth:l,fillColor:a!=="transparent"&&a||void 0,strokeColor:s,normalize:!0,lineJoin:"round",lineCap:"round",lineDash:v===$t.Dotted?[1,l*2]:v===$t.LongDotted?[l,l*2]:void 0},d={name:e,id:e,zIndex:u,pos:h,anchor:[.5,.5],size:[T.w,T.h]};p&&(d.scale=p),c&&(d.rotate=c),g&&(d.translate=g);const M=new Ze(d);if(i){const P=new Wr({d:"M-4,0H4M0,-4V4",normalize:!0,pos:[0,0],strokeColor:s,lineWidth:1,scale:[1/w[0],1/w[1]]});M.append(P)}const x=new h0({...m,pos:[0,0]});M.append(x),I&&(this.scaleType=ee.proportional,this.drawEraserlines({group:M,eraserlines:I,pos:h,layer:r},o)),this.replace(r,e,M);const E=M.getBoundingClientRect();return this.isDelete&&M.setAttribute("opacity",0),{x:Math.floor(E.x-jt.SafeBorderPadding),y:Math.floor(E.y-jt.SafeBorderPadding),w:Math.floor(E.width+jt.SafeBorderPadding*2),h:Math.floor(E.height+jt.SafeBorderPadding*2)}}computDrawPoints(t){const e=he(this.tmpPoints),r=he(this.tmpPoints,t),i=[Math.floor(e.x+e.w/2),Math.floor(e.y+e.h/2)];return{rect:r,pos:i,radius:[Math.floor(e.w/2),Math.floor(e.h/2)]}}updateTempPoints(t){const e=t.slice(-2),r=new Wt(e[0],e[1]),i=this.tmpPoints[0],{thickness:o}=this.workOptions;if(i.isNear(r,o))return!1;if(this.tmpPoints.length===2){if(r.isNear(this.tmpPoints[1],1))return!1;this.tmpPoints[1]=r}else this.tmpPoints.push(r);return!0}consumeService(t){var e,r;const{op:i,isFullWork:o,workState:s=Tt.Done}=t,a=(e=this.workId)==null?void 0:e.toString();if(!a)return;this.tmpPoints.length=0;for(let p=0;p<i.length;p+=3)this.tmpPoints.push(new Wt(i[p],i[p+1],i[p+2]));const l=o?this.fullLayer:this.drawLayer||this.fullLayer,u=this.draw({workId:a,layer:l,isDrawing:!1,isDrawEraserlines:s===Tt.Done});return this.oldRect=u,(r=this.vNodes)==null||r.setInfo(a,{rect:u,op:i,opt:this.workOptions,toolsType:this.toolsType,canRotate:this.canRotate,scaleType:this.scaleType,centerPos:jt.getCenterPos(u,l)}),u}clearTmpPoints(){this.tmpPoints.length=0}static updateNodeOpt(t){var e,r,i;const{node:o,opt:s,vNodes:a}=t,{strokeColor:l,fillColor:u,strokeType:p}=s,c=a.get(o.name);let g=o;return o.tagName==="GROUP"&&(g=o.children[0]),l&&(g.setAttribute("strokeColor",l),(e=c?.opt)!=null&&e.strokeColor&&(c.opt.strokeColor=l)),u&&(u==="transparent"?g.setAttribute("fillColor","rgba(0,0,0,0)"):g.setAttribute("fillColor",u),(r=c?.opt)!=null&&r.fillColor&&(c.opt.fillColor=u)),p&&c!=null&&c.opt&&(i=c.opt)!=null&&i.strokeType&&(c.opt.strokeType=p),c&&a.setInfo(o.name,c),jt.updateNodeOpt(t)}}class nv extends jt{constructor(t){super(t),G(this,"canRotate",!0),G(this,"scaleType",ee.all),G(this,"toolsType",nt.Rectangle),G(this,"tmpPoints",[]),G(this,"workOptions"),G(this,"oldRect"),G(this,"syncTimestamp"),this.workOptions=t.toolsOpt,this.syncTimestamp=0,this.syncUnitTime=50}transformData(){const t=he(this.tmpPoints);return[[t.x,t.y,0],[t.x+t.w,t.y,0],[t.x+t.w,t.y+t.h,0],[t.x,t.y+t.h,0]]}computDrawPoints(t){const{thickness:e}=this.workOptions,r=[];for(const s of t)r.push(new ht(...s));const i=he(r,e),o=[i.x+i.w/2,i.y+i.h/2];return{rect:i,pos:o,points:r.map(s=>s.XY).flat(1)}}consume(t){const{data:e,isFullWork:r,isSubWorker:i,isMainThread:o,smoothSync:s}=t,a=this.workId,{op:l}=e,u=l?.length;if(!u||u<2)return{type:pt.None};let p;if(this.tmpPoints.length===0?(this.tmpPoints=[new Wt(l[0],l[1])],p=!1):p=this.updateTempPoints(l),!p)return{type:pt.None};const c=this.transformData();let g;if(i||o){const I=r?this.fullLayer:this.drawLayer||this.fullLayer;g=this.draw({ps:c,workId:a,layer:I,isDrawing:!0})}if(!i&&s){const I=Date.now();return I-this.syncTimestamp>this.syncUnitTime?(this.syncTimestamp=I,{type:pt.DrawWork,dataType:kt.Local,op:c.flat(1),isSync:!0,index:0,...this.baseConsumeResult}):{type:pt.None}}const v=oe(g,this.oldRect);return this.oldRect=g,{rect:v,type:pt.DrawWork,dataType:kt.Local,...this.baseConsumeResult}}consumeAll(){var t;const e=this.workId;if(this.tmpPoints.length<2)return{type:pt.RemoveNode,removeIds:[e]};const r=this.transformData(),i=this.fullLayer,o=this.draw({ps:r,workId:e,layer:i,isDrawing:!1});this.oldRect=o;const s=r.flat(1),a=nn(s);return(t=this.vNodes)==null||t.setInfo(e,{rect:o,op:s,opt:this.workOptions,toolsType:this.toolsType,scaleType:this.scaleType,canRotate:this.canRotate,centerPos:o&&jt.getCenterPos(o,i)}),{rect:o,type:pt.FullWork,dataType:kt.Local,ops:a,isSync:!0,...this.baseConsumeResult,updateNodeOpt:{useAnimation:!0}}}draw(t){const{workId:e,layer:r,isDrawing:i,ps:o,replaceId:s,isDrawEraserlines:a=!0}=t,{strokeColor:l,fillColor:u,thickness:p,zIndex:c,scale:g,rotate:v,translate:I,strokeType:w,eraserlines:y}=this.workOptions,T=r.worldPosition,h=r.worldScaling,{points:m,rect:d,pos:M}=this.computDrawPoints(o),x={close:!0,normalize:!0,points:m,lineWidth:p,fillColor:u!=="transparent"&&u||void 0,strokeColor:l,lineJoin:"round",lineCap:"round",lineDash:w===$t.Dotted?[1,p*2]:w===$t.LongDotted?[p,p*2]:void 0};let E={x:Math.floor(d.x*h[0]+T[0]-jt.SafeBorderPadding),y:Math.floor(d.y*h[1]+T[1]-jt.SafeBorderPadding),w:Math.floor(d.w*h[0]+2*jt.SafeBorderPadding),h:Math.floor(d.h*h[0]+2*jt.SafeBorderPadding)};const P=new Ze({name:e,id:e,zIndex:c,pos:M,anchor:[.5,.5],size:[d.w,d.h],scale:g,rotate:v,translate:I}),R=new gr({...x,pos:[0,0]});if(P.appendChild(R),i){const N=new Wr({d:"M-4,0H4M0,-4V4",normalize:!0,pos:[0,0],strokeColor:l,lineWidth:1,scale:[1/h[0],1/h[1]]});P.appendChild(N)}if(y&&(this.scaleType=ee.proportional,this.drawEraserlines({group:P,eraserlines:y,pos:M,layer:r},a)),this.replace(r,s||e,P),g||v||I){const N=P.getBoundingClientRect();E={x:Math.floor(N.x-jt.SafeBorderPadding),y:Math.floor(N.y-jt.SafeBorderPadding),w:Math.floor(N.width+2*jt.SafeBorderPadding),h:Math.floor(N.height+2*jt.SafeBorderPadding)}}return this.isDelete&&P.setAttribute("opacity",0),E}updateTempPoints(t){const e=t.slice(-2),r=new Wt(e[0],e[1]),i=this.tmpPoints[0],{thickness:o}=this.workOptions;if(i.isNear(r,o))return!1;if(this.tmpPoints.length===2){if(r.isNear(this.tmpPoints[1],1))return!1;this.tmpPoints[1]=r}else this.tmpPoints.push(r);return!0}consumeService(t){var e,r;const{op:i,isFullWork:o,replaceId:s,workState:a=Tt.Done}=t,l=(e=this.workId)==null?void 0:e.toString();if(!l)return;const u=[];for(let g=0;g<i.length;g+=3)u.push([i[g],i[g+1],i[g+2]]);const p=o?this.fullLayer:this.drawLayer||this.fullLayer,c=this.draw({ps:u,workId:l,layer:p,isDrawing:!1,replaceId:s,isDrawEraserlines:a===Tt.Done});return this.oldRect=c,(r=this.vNodes)==null||r.setInfo(l,{rect:c,op:i,opt:this.workOptions,toolsType:this.toolsType,scaleType:this.scaleType,canRotate:this.canRotate,centerPos:c&&jt.getCenterPos(c,p)}),c}clearTmpPoints(){this.tmpPoints.length=0}static updateNodeOpt(t){var e,r,i;const{node:o,opt:s,vNodes:a}=t,{strokeColor:l,fillColor:u,strokeType:p}=s,c=a.get(o.name);let g=o;return o.tagName==="GROUP"&&(g=o.children[0]),l&&(g.setAttribute("strokeColor",l),(e=c?.opt)!=null&&e.strokeColor&&(c.opt.strokeColor=l)),u&&(u==="transparent"?g.setAttribute("fillColor","rgba(0,0,0,0)"):g.setAttribute("fillColor",u),(r=c?.opt)!=null&&r.fillColor&&(c.opt.fillColor=u)),p&&c!=null&&c.opt&&(i=c.opt)!=null&&i.strokeType&&(c.opt.strokeType=p),c&&a.setInfo(o.name,c),jt.updateNodeOpt(t)}}class rv extends jt{constructor(t){super(t),G(this,"canRotate",!1),G(this,"scaleType",ee.all),G(this,"toolsType",nt.Star),G(this,"tmpPoints",[]),G(this,"workOptions"),G(this,"oldRect"),G(this,"syncTimestamp"),this.workOptions=t.toolsOpt,this.syncTimestamp=0,this.syncUnitTime=50}consume(t){const{data:e,isFullWork:r,isSubWorker:i,isMainThread:o,smoothSync:s}=t,a=this.workId,{op:l,syncUnitTime:u}=e,p=l?.length;if(!p||p<2)return{type:pt.None};u&&(this.syncUnitTime=u);let c;if(this.tmpPoints.length===0?(this.tmpPoints=[new Wt(l[0],l[1])],c=!1):c=this.updateTempPoints(l),!c)return{type:pt.None};let g;if(i||o){const I=r?this.fullLayer:this.drawLayer||this.fullLayer;g=this.draw({workId:a,layer:I,isDrawing:!0})}if(!i&&s){const I=Date.now();return I-this.syncTimestamp>this.syncUnitTime?(this.syncTimestamp=I,{type:pt.DrawWork,dataType:kt.Local,op:this.tmpPoints.map(w=>[...w.XY,0]).flat(1),isSync:!0,index:0,...this.baseConsumeResult}):{type:pt.None}}const v=oe(g,this.oldRect);return this.oldRect=g,{rect:v,type:pt.DrawWork,dataType:kt.Local,...this.baseConsumeResult}}consumeAll(){var t;const e=this.workId;if(this.tmpPoints.length<2)return{type:pt.RemoveNode,removeIds:[e]};const r=this.fullLayer,i=this.draw({workId:e,layer:r,isDrawing:!1});this.oldRect=i;const o=this.tmpPoints.map(a=>[...a.XY,0]).flat(1),s=nn(o);return(t=this.vNodes)==null||t.setInfo(e,{rect:i,op:o,opt:this.workOptions,toolsType:this.toolsType,scaleType:this.scaleType,canRotate:this.canRotate,centerPos:i&&jt.getCenterPos(i,r)}),{rect:i,type:pt.FullWork,dataType:kt.Local,ops:s,isSync:!0,...this.baseConsumeResult,updateNodeOpt:{useAnimation:!0}}}draw(t){const{workId:e,layer:r,isDrawing:i,isDrawEraserlines:o=!0}=t,{strokeColor:s,fillColor:a,thickness:l,zIndex:u,vertices:p,innerVerticeStep:c,innerRatio:g,scale:v,rotate:I,translate:w,strokeType:y,eraserlines:T}=this.workOptions,h=r.worldScaling,{rect:m,pos:d,points:M}=this.computDrawPoints(l,p,c,g),x={close:!0,points:M,lineWidth:l,fillColor:a!=="transparent"&&a||void 0,strokeColor:s,normalize:!0,lineJoin:"round",lineCap:"round",lineDash:y===$t.Dotted?[1,l*2]:y===$t.LongDotted?[l,l*2]:void 0},E={name:e,id:e,zIndex:u,pos:d,anchor:[.5,.5],size:[m.w,m.h]};v&&(E.scale=v),I&&(E.rotate=I),w&&(E.translate=w);const P=new Ze(E);if(i){const b=new Wr({d:"M-4,0H4M0,-4V4",normalize:!0,pos:[0,0],strokeColor:s,lineWidth:1,scale:[1/h[0],1/h[1]]});P.append(b)}const R=new gr({...x,pos:[0,0]});P.append(R),T&&(this.scaleType=ee.proportional,this.drawEraserlines({group:P,eraserlines:T,pos:d,layer:r},o)),this.replace(r,e,P);const N=P.getBoundingClientRect();return this.isDelete&&P.setAttribute("opacity",0),{x:Math.floor(N.x-jt.SafeBorderPadding),y:Math.floor(N.y-jt.SafeBorderPadding),w:Math.floor(N.width+jt.SafeBorderPadding*2),h:Math.floor(N.height+jt.SafeBorderPadding*2)}}computDrawPoints(t,e,r,i){const o=he(this.tmpPoints),s=[Math.floor(o.x+o.w/2),Math.floor(o.y+o.h/2)],a=Iv(o.w,o.h),l=Math.floor(Math.min(o.w,o.h)/2),u=i*l,p=[],c=2*Math.PI/e;for(let g=0;g<e;g++){const v=g*c-.5*Math.PI;let I,w;g%r===1?(I=u*a[0]*Math.cos(v),w=u*a[1]*Math.sin(v)):(I=l*a[0]*Math.cos(v),w=l*a[1]*Math.sin(v),p.push(I,w)),p.push(I,w)}return{rect:he(this.tmpPoints,t),pos:s,points:p}}updateTempPoints(t){const e=t.slice(-2),r=new Wt(e[0],e[1]),i=this.tmpPoints[0],{thickness:o}=this.workOptions;if(i.isNear(r,o)||Wt.Sub(i,r).XY.includes(0))return!1;if(this.tmpPoints.length===2){if(r.isNear(this.tmpPoints[1],1))return!1;this.tmpPoints[1]=r}else this.tmpPoints.push(r);return!0}consumeService(t){var e,r;const{op:i,isFullWork:o,workState:s=Tt.Done}=t,a=(e=this.workId)==null?void 0:e.toString();if(!a)return;this.tmpPoints.length=0;for(let p=0;p<i.length;p+=3)this.tmpPoints.push(new Wt(i[p],i[p+1],i[p+2]));const l=o?this.fullLayer:this.drawLayer||this.fullLayer,u=this.draw({workId:a,layer:l,isDrawing:!1,isDrawEraserlines:s===Tt.Done});return this.oldRect=u,(r=this.vNodes)==null||r.setInfo(a,{rect:u,op:i,opt:this.workOptions,toolsType:this.toolsType,scaleType:this.scaleType,canRotate:this.canRotate,centerPos:u&&jt.getCenterPos(u,l)}),u}clearTmpPoints(){this.tmpPoints.length=0}static updateNodeOpt(t){var e;const{node:r,opt:i,vNodes:o}=t,{strokeColor:s,fillColor:a,toolsType:l,vertices:u,innerVerticeStep:p,innerRatio:c,strokeType:g}=i,v=o.get(r.name),I=v?.opt;let w=r;return r.tagName==="GROUP"&&(w=r.children[0]),s&&(w.setAttribute("strokeColor",s),I!=null&&I.strokeColor&&(I.strokeColor=s)),a&&(a==="transparent"?w.setAttribute("fillColor","rgba(0,0,0,0)"):w.setAttribute("fillColor",a),I!=null&&I.fillColor&&(I.fillColor=a)),l===nt.Star&&(u&&(I.vertices=u),p&&(I.innerVerticeStep=p),c&&(I.innerRatio=c)),g&&v!=null&&v.opt&&(e=v.opt)!=null&&e.strokeType&&(v.opt.strokeType=g),v&&o.setInfo(r.name,{...v,opt:I}),jt.updateNodeOpt(t)}}class iv extends jt{constructor(t){super(t),G(this,"canRotate",!1),G(this,"scaleType",ee.all),G(this,"toolsType",nt.Polygon),G(this,"tmpPoints",[]),G(this,"workOptions"),G(this,"oldRect"),G(this,"syncTimestamp"),this.workOptions=t.toolsOpt,this.syncTimestamp=0,this.syncUnitTime=50}consume(t){const{data:e,isFullWork:r,isSubWorker:i,isMainThread:o,smoothSync:s}=t,{op:a,syncUnitTime:l}=e;l&&(this.syncUnitTime=l);const u=this.workId,p=a?.length;if(!p||p<2)return{type:pt.None};let c;if(this.tmpPoints.length===0?(this.tmpPoints=[new Wt(a[0],a[1])],c=!1):c=this.updateTempPoints(a),!c)return{type:pt.None};let g;if(i||o){const I=r?this.fullLayer:this.drawLayer||this.fullLayer;g=this.draw({workId:u,layer:I,isDrawing:!0})}if(!i&&s){const I=Date.now();return I-this.syncTimestamp>this.syncUnitTime?(this.syncTimestamp=I,{type:pt.DrawWork,dataType:kt.Local,op:this.tmpPoints.map(w=>[...w.XY,0]).flat(1),isSync:!0,index:0,...this.baseConsumeResult}):{type:pt.None}}const v=oe(g,this.oldRect);return this.oldRect=g,{rect:v,type:pt.DrawWork,dataType:kt.Local,...this.baseConsumeResult}}consumeAll(){var t;const e=this.workId;if(this.tmpPoints.length<2)return{type:pt.RemoveNode,removeIds:[e]};const r=this.fullLayer,i=this.draw({workId:e,layer:r,isDrawing:!1});this.oldRect=i;const o=this.tmpPoints.map(a=>[...a.XY,0]).flat(1),s=nn(o);return(t=this.vNodes)==null||t.setInfo(e,{rect:i,op:o,opt:this.workOptions,toolsType:this.toolsType,scaleType:this.scaleType,canRotate:this.canRotate,centerPos:i&&jt.getCenterPos(i,r)}),{rect:i,type:pt.FullWork,dataType:kt.Local,ops:s,isSync:!0,...this.baseConsumeResult,updateNodeOpt:{useAnimation:!0}}}draw(t){const{workId:e,layer:r,isDrawing:i,isDrawEraserlines:o=!0}=t,{strokeColor:s,fillColor:a,thickness:l,zIndex:u,vertices:p,scale:c,rotate:g,translate:v,strokeType:I,eraserlines:w}=this.workOptions,y=r.worldScaling,{rect:T,pos:h,points:m}=this.computDrawPoints(l,p),d={close:!0,points:m,lineWidth:l,fillColor:a!=="transparent"&&a||void 0,strokeColor:s,normalize:!0,lineJoin:"round",lineCap:"round",lineDash:I===$t.Dotted?[1,l*2]:I===$t.LongDotted?[l,l*2]:void 0},M={name:e,id:e,zIndex:u,pos:h,anchor:[.5,.5],size:[T.w,T.h]};c&&(M.scale=c),g&&(M.rotate=g),v&&(M.translate=v);const x=new Ze(M);if(i){const R=new Wr({d:"M-4,0H4M0,-4V4",normalize:!0,pos:[0,0],strokeColor:s,lineWidth:1,scale:[1/y[0],1/y[1]]});x.append(R)}const E=new gr({...d,pos:[0,0]});x.append(E),w&&(this.scaleType=ee.proportional,this.drawEraserlines({group:x,eraserlines:w,pos:h,layer:r},o)),this.replace(r,e,x);const P=x.getBoundingClientRect();return this.isDelete&&x.setAttribute("opacity",0),{x:Math.floor(P.x-jt.SafeBorderPadding),y:Math.floor(P.y-jt.SafeBorderPadding),w:Math.floor(P.width+jt.SafeBorderPadding*2),h:Math.floor(P.height+jt.SafeBorderPadding*2)}}computDrawPoints(t,e){const r=he(this.tmpPoints),i=[Math.floor(r.x+r.w/2),Math.floor(r.y+r.h/2)],o=Iv(r.w,r.h),s=Math.floor(Math.min(r.w,r.h)/2),a=[],l=2*Math.PI/e;for(let u=0;u<e;u++){const p=u*l-.5*Math.PI,c=s*o[0]*Math.cos(p),g=s*o[1]*Math.sin(p);a.push(c,g)}return{rect:he(this.tmpPoints,t),pos:i,points:a}}updateTempPoints(t){const e=t.slice(-2),r=new Wt(e[0],e[1]),i=this.tmpPoints[0],{thickness:o}=this.workOptions;if(i.isNear(r,o)||Wt.Sub(i,r).XY.includes(0))return!1;if(this.tmpPoints.length===2){if(r.isNear(this.tmpPoints[1],1))return!1;this.tmpPoints[1]=r}else this.tmpPoints.push(r);return!0}consumeService(t){var e,r;const{op:i,isFullWork:o,workState:s=Tt.Done}=t,a=(e=this.workId)==null?void 0:e.toString();if(!a)return;this.tmpPoints.length=0;for(let p=0;p<i.length;p+=3)this.tmpPoints.push(new Wt(i[p],i[p+1],i[p+2]));const l=o?this.fullLayer:this.drawLayer||this.fullLayer,u=this.draw({workId:a,layer:l,isDrawing:!1,isDrawEraserlines:s===Tt.Done});return this.oldRect=u,(r=this.vNodes)==null||r.setInfo(a,{rect:u,op:i,opt:this.workOptions,toolsType:this.toolsType,scaleType:this.scaleType,canRotate:this.canRotate,centerPos:u&&jt.getCenterPos(u,l)}),u}clearTmpPoints(){this.tmpPoints.length=0}static updateNodeOpt(t){var e;const{node:r,opt:i,vNodes:o}=t,{strokeColor:s,fillColor:a,toolsType:l,vertices:u,strokeType:p}=i,c=o.get(r.name),g=c?.opt;let v=r;return r.tagName==="GROUP"&&(v=r.children[0]),s&&(v.setAttribute("strokeColor",s),g!=null&&g.strokeColor&&(g.strokeColor=s)),a&&(a==="transparent"?v.setAttribute("fillColor","rgba(0,0,0,0)"):v.setAttribute("fillColor",a),g!=null&&g.fillColor&&(g.fillColor=a)),l===nt.Polygon&&u&&(g.vertices=u),p&&c!=null&&c.opt&&(e=c.opt)!=null&&e.strokeType&&(c.opt.strokeType=p),c&&o.setInfo(r.name,{...c,opt:g}),jt.updateNodeOpt(t)}}class bn{static bezier(t,e){const r=[];for(let i=0;i<e.length;i+=4){const o=e[i],s=e[i+1],a=e[i+2],l=e[i+3];o&&s&&a&&l?r.push(...bn.getBezierPoints(t,o,s,a,l)):o&&s&&a?r.push(...bn.getBezierPoints(t,o,s,a)):o&&s?r.push(...bn.getBezierPoints(t,o,s)):o&&r.push(o)}return r}static getBezierPoints(t=10,e,r,i,o){let s=null;const a=[];!i&&!o?s=bn.oneBezier:i&&!o?s=bn.twoBezier:i&&o&&(s=bn.threeBezier);for(let l=0;l<t;l++)s&&a.push(s(l/t,e,r,i,o));return o?a.push(o):i&&a.push(i),a}static oneBezier(t,e,r){const i=e.x+(r.x-e.x)*t,o=e.y+(r.y-e.y)*t;return new ht(i,o)}static twoBezier(t,e,r,i){const o=(1-t)*(1-t)*e.x+2*t*(1-t)*r.x+t*t*i.x,s=(1-t)*(1-t)*e.y+2*t*(1-t)*r.y+t*t*i.y;return new ht(o,s)}static threeBezier(t,e,r,i,o){const s=e.x*(1-t)*(1-t)*(1-t)+3*r.x*t*(1-t)*(1-t)+3*i.x*t*t*(1-t)+o.x*t*t*t,a=e.y*(1-t)*(1-t)*(1-t)+3*r.y*t*(1-t)*(1-t)+3*i.y*t*t*(1-t)+o.y*t*t*t;return new ht(s,a)}}class ov extends jt{constructor(t){super(t),G(this,"canRotate",!1),G(this,"scaleType",ee.all),G(this,"toolsType",nt.SpeechBalloon),G(this,"ratio",.8),G(this,"tmpPoints",[]),G(this,"workOptions"),G(this,"oldRect"),G(this,"syncTimestamp"),this.workOptions=t.toolsOpt,this.syncTimestamp=0,this.syncUnitTime=50}consume(t){var e;const{data:r,isFullWork:i,isSubWorker:o,isMainThread:s,smoothSync:a}=t,l=(e=r?.workId)==null?void 0:e.toString();if(!l)return{type:pt.None};const{op:u}=r,p=u?.length;if(!p||p<2)return{type:pt.None};let c;if(this.tmpPoints.length===0?(this.tmpPoints=[new Wt(u[0],u[1])],c=!1):c=this.updateTempPoints(u),!c)return{type:pt.None};let g;if(o||s){const I=i?this.fullLayer:this.drawLayer||this.fullLayer;g=this.draw({workId:l,layer:I,isDrawing:!0})}if(!o&&a){const I=Date.now();return I-this.syncTimestamp>this.syncUnitTime?(this.syncTimestamp=I,{type:pt.DrawWork,dataType:kt.Local,op:this.tmpPoints.map(w=>[...w.XY,0]).flat(1),isSync:!0,index:0,...this.baseConsumeResult}):{type:pt.None}}const v=oe(g,this.oldRect);return this.oldRect=g,{rect:v,type:pt.DrawWork,dataType:kt.Local,...this.baseConsumeResult}}consumeAll(){var t;const e=this.workId;if(this.tmpPoints.length<2)return{type:pt.RemoveNode,removeIds:[e]};const r=this.fullLayer,i=this.draw({workId:e,layer:r,isDrawing:!1});this.oldRect=i;const o=this.tmpPoints.map(a=>[...a.XY,0]).flat(1),s=nn(o);return(t=this.vNodes)==null||t.setInfo(e,{rect:i,op:o,opt:this.workOptions,toolsType:this.toolsType,scaleType:this.scaleType,canRotate:this.canRotate,centerPos:i&&jt.getCenterPos(i,r)}),{rect:i,type:pt.FullWork,dataType:kt.Local,ops:s,isSync:!0,...this.baseConsumeResult,updateNodeOpt:{useAnimation:!0}}}draw(t){const{workId:e,layer:r,isDrawEraserlines:i=!0}=t,{strokeColor:o,fillColor:s,thickness:a,zIndex:l,placement:u,scale:p,rotate:c,translate:g,strokeType:v,eraserlines:I}=this.workOptions,{rect:w,pos:y,points:T}=this.computDrawPoints(a,u),h={points:T.map(E=>E.XY),lineWidth:a,fillColor:s!=="transparent"&&s||void 0,strokeColor:o,normalize:!0,className:`${y[0]},${y[1]}`,close:!0,lineJoin:"round",lineCap:"round",lineDash:v===$t.Dotted?[1,a*2]:v===$t.LongDotted?[a,a*2]:void 0},m={name:e,id:e,zIndex:l,pos:y,anchor:[.5,.5],size:[w.w,w.h]};p&&(m.scale=p),c&&(m.rotate=c),g&&(m.translate=g);const d=new Ze(m),M=new gr({...h,pos:[0,0]});d.append(M),I&&(this.scaleType=ee.proportional,this.drawEraserlines({group:d,eraserlines:I,pos:y,layer:r},i)),this.replace(r,e,d);const x=d.getBoundingClientRect();return this.isDelete&&d.setAttribute("opacity",0),{x:Math.floor(x.x-jt.SafeBorderPadding),y:Math.floor(x.y-jt.SafeBorderPadding),w:Math.floor(x.width+jt.SafeBorderPadding*2),h:Math.floor(x.height+jt.SafeBorderPadding*2)}}transformControlPoints(t){const e=he(this.tmpPoints);switch(t){case"bottom":case"bottomLeft":case"bottomRight":{const r=e.y+e.h*this.ratio;return[new ht(e.x,e.y,0),new ht(e.x+e.w,e.y,0),new ht(e.x+e.w,r,0),new ht(e.x,r,0)]}case"top":case"topLeft":case"topRight":{const r=e.y+e.h*(1-this.ratio);return[new ht(e.x,r,0),new ht(e.x+e.w,r,0),new ht(e.x+e.w,e.y+e.h,0),new ht(e.x,e.y+e.h,0)]}case"left":case"leftBottom":case"leftTop":{const r=e.x+e.w*(1-this.ratio);return[new ht(r,e.y,0),new ht(e.x+e.w,e.y,0),new ht(e.x+e.w,e.y+e.h,0),new ht(r,e.y+e.h,0)]}case"right":case"rightBottom":case"rightTop":{const r=e.x+e.w*this.ratio;return[new ht(e.x,e.y,0),new ht(r,e.y,0),new ht(r,e.y+e.h,0),new ht(e.x,e.y+e.h,0)]}}}computDrawPoints(t,e){const r=he(this.tmpPoints),i=this.transformControlPoints(e),o=Math.floor(r.w*.1),s=Math.floor(r.h*.1),a=[],l=ht.Add(i[0],new ht(0,s,0)),u=ht.Add(i[0],new ht(o,0,0)),p=bn.getBezierPoints(10,l,i[0],u),c=ht.Sub(i[1],new ht(o,0,0)),g=ht.Add(i[1],new ht(0,s,0)),v=bn.getBezierPoints(10,c,i[1],g),I=ht.Sub(i[2],new ht(0,s,0)),w=ht.Sub(i[2],new ht(o,0,0)),y=bn.getBezierPoints(10,I,i[2],w),T=ht.Add(i[3],new ht(o,0,0)),h=ht.Sub(i[3],new ht(0,s,0)),m=bn.getBezierPoints(10,T,i[3],h),d=o*(1-this.ratio)*10,M=s*(1-this.ratio)*10;switch(e){case"bottom":{const P=ht.Sub(i[2],new ht(o*5-d/2,0,0)),R=ht.Sub(i[2],new ht(o*5,-M,0)),N=ht.Sub(i[2],new ht(o*5+d/2,0,0));a.push(R,N,...m,...p,...v,...y,P);break}case"bottomRight":{const P=ht.Sub(i[2],new ht(o*1.1,0,0)),R=ht.Sub(i[2],new ht(o*1.1+d/2,-M,0)),N=ht.Sub(i[2],new ht(o*1.1+d,0,0));a.push(R,N,...m,...p,...v,...y,P);break}case"bottomLeft":{const P=ht.Add(i[3],new ht(o*1.1+d,0,0)),R=ht.Add(i[3],new ht(o*1.1+d/2,M,0)),N=ht.Add(i[3],new ht(o*1.1,0,0));a.push(R,N,...m,...p,...v,...y,P);break}case"top":{const P=ht.Sub(i[1],new ht(o*5-d/2,0,0)),R=ht.Sub(i[1],new ht(o*5,M,0)),N=ht.Sub(i[1],new ht(o*5+d/2,0,0));a.push(R,P,...v,...y,...m,...p,N);break}case"topRight":{const P=ht.Sub(i[1],new ht(o*1.1,0,0)),R=ht.Sub(i[1],new ht(o*1.1+d/2,M,0)),N=ht.Sub(i[1],new ht(o*1.1+d,0,0));a.push(R,P,...v,...y,...m,...p,N);break}case"topLeft":{const P=ht.Add(i[0],new ht(o*1.1+d,0,0)),R=ht.Add(i[0],new ht(o*1.1+d/2,-M,0)),N=ht.Add(i[0],new ht(o*1.1,0,0));a.push(R,P,...v,...y,...m,...p,N);break}case"left":{const P=ht.Add(i[0],new ht(0,s*5-M/2,0)),R=ht.Add(i[0],new ht(-d,s*5,0)),N=ht.Add(i[0],new ht(0,s*5+M/2,0));a.push(R,P,...p,...v,...y,...m,N);break}case"leftTop":{const P=ht.Add(i[0],new ht(0,s*1.1,0)),R=ht.Add(i[0],new ht(-d,s*1.1+M/2,0)),N=ht.Add(i[0],new ht(0,s*1.1+M,0));a.push(R,P,...p,...v,...y,...m,N);break}case"leftBottom":{const P=ht.Sub(i[3],new ht(0,s*1.1+M,0)),R=ht.Sub(i[3],new ht(d,s*1.1+M/2,0)),N=ht.Sub(i[3],new ht(0,s*1.1,0));a.push(R,P,...p,...v,...y,...m,N);break}case"right":{const P=ht.Add(i[1],new ht(0,s*5-M/2,0)),R=ht.Add(i[1],new ht(d,s*5,0)),N=ht.Add(i[1],new ht(0,s*5+M/2,0));a.push(R,N,...y,...m,...p,...v,P);break}case"rightTop":{const P=ht.Add(i[1],new ht(0,s*1.1,0)),R=ht.Add(i[1],new ht(d,s*1.1+M/2,0)),N=ht.Add(i[1],new ht(0,s*1.1+M,0));a.push(R,N,...y,...m,...p,...v,P);break}case"rightBottom":{const P=ht.Sub(i[2],new ht(0,s*1.1+M,0)),R=ht.Sub(i[2],new ht(-d,s*1.1+M/2,0)),N=ht.Sub(i[2],new ht(0,s*1.1,0));a.push(R,N,...y,...m,...p,...v,P);break}}const x=he(this.tmpPoints,t),E=[Math.floor(x.x+x.w/2),Math.floor(x.y+x.h/2)];return{rect:x,pos:E,points:a}}updateTempPoints(t){const e=t.slice(-2),r=new Wt(e[0],e[1]),i=this.tmpPoints[0],{thickness:o}=this.workOptions;if(i.isNear(r,o)||Wt.Sub(i,r).XY.includes(0))return!1;if(this.tmpPoints.length===2){if(r.isNear(this.tmpPoints[1],1))return!1;this.tmpPoints[1]=r}else this.tmpPoints.push(r);return!0}consumeService(t){var e,r;const{op:i,isFullWork:o,workState:s=Tt.Done}=t,a=(e=this.workId)==null?void 0:e.toString();if(!a)return;this.tmpPoints.length=0;for(let p=0;p<i.length;p+=3)this.tmpPoints.push(new Wt(i[p],i[p+1],i[p+2]));const l=o?this.fullLayer:this.drawLayer||this.fullLayer,u=this.draw({workId:a,layer:l,isDrawing:!1,isDrawEraserlines:s===Tt.Done});return this.oldRect=u,(r=this.vNodes)==null||r.setInfo(a,{rect:u,op:i,opt:this.workOptions,toolsType:this.toolsType,scaleType:this.scaleType,canRotate:this.canRotate,centerPos:u&&jt.getCenterPos(u,l)}),u}clearTmpPoints(){this.tmpPoints.length=0}static updateNodeOpt(t){var e;const{node:r,opt:i,vNodes:o}=t,{strokeColor:s,fillColor:a,toolsType:l,placement:u,strokeType:p}=i,c=o.get(r.name),g=c?.opt;let v=r;return r.tagName==="GROUP"&&(v=r.children[0]),s&&(v.setAttribute("strokeColor",s),g!=null&&g.strokeColor&&(g.strokeColor=s)),a&&(a==="transparent"?v.setAttribute("fillColor","rgba(0,0,0,0)"):v.setAttribute("fillColor",a),g!=null&&g.fillColor&&(g.fillColor=a)),l===nt.SpeechBalloon&&u&&(g.placement=u),p&&c!=null&&c.opt&&(e=c.opt)!=null&&e.strokeType&&(c.opt.strokeType=p),c&&o.setInfo(r.name,{...c,opt:g}),jt.updateNodeOpt(t)}}var X2=mi,G2=er,$2="[object Boolean]";function H2(n){return n===!0||n===!1||G2(n)&&X2(n)==$2}var Q2=H2;const Ri=qi(Q2);class sv extends jt{constructor(t){super(t),G(this,"canRotate",!1),G(this,"scaleType",ee.both),G(this,"toolsType",nt.Straight),G(this,"tmpPoints",[]),G(this,"workOptions"),G(this,"oldRect"),G(this,"straightTipWidth"),G(this,"syncTimestamp"),this.workOptions=t.toolsOpt,this.straightTipWidth=this.workOptions.thickness/2,this.syncTimestamp=0,this.syncUnitTime=50}consume(t){const{data:e,isFullWork:r,isSubWorker:i,isMainThread:o,smoothSync:s}=t,a=this.workId,{op:l,syncUnitTime:u}=e,p=l?.length;if(!p||p<2)return{type:pt.None};u&&(this.syncUnitTime=u);let c;if(this.tmpPoints.length===0?(this.tmpPoints=[new Wt(l[0],l[1])],c=!1):c=this.updateTempPoints(l),!c)return{type:pt.None};let g;if(i||o){const I=r?this.fullLayer:this.drawLayer||this.fullLayer;g=this.draw({workId:a,layer:I})}if(!i&&s){const I=Date.now();return I-this.syncTimestamp>this.syncUnitTime?(this.syncTimestamp=I,{type:pt.DrawWork,dataType:kt.Local,op:this.tmpPoints.map(w=>[...w.XY,0]).flat(1),isSync:!0,index:0,...this.baseConsumeResult}):{type:pt.None}}const v=oe(g,this.oldRect);return this.oldRect=g,{rect:v,type:pt.DrawWork,dataType:kt.Local,...this.baseConsumeResult}}consumeAll(){var t;const e=this.workId;if(this.tmpPoints.length<2)return{type:pt.RemoveNode,removeIds:[e]};const r=this.fullLayer,i=this.draw({workId:e,layer:r});this.oldRect=i;const o=this.tmpPoints.map(a=>[...a.XY,0]).flat(1),s=nn(o);return(t=this.vNodes)==null||t.setInfo(e,{rect:i,op:o,opt:this.workOptions,toolsType:this.toolsType,scaleType:this.scaleType,canRotate:this.canRotate,centerPos:i&&jt.getCenterPos(i,r)}),{rect:i,type:pt.FullWork,dataType:kt.Local,ops:s,isSync:!0,...this.baseConsumeResult,updateNodeOpt:{useAnimation:!0}}}draw(t){const{workId:e,layer:r,isDrawEraserlines:i=!0}=t,{strokeColor:o,thickness:s,zIndex:a,scale:l,rotate:u,translate:p,strokeType:c,eraserlines:g}=this.workOptions,v=r.worldPosition,I=r.worldScaling,{d:w,rect:y,isDot:T}=this.computDrawPoints(s,c),h=[y.x+y.w/2,y.y+y.h/2],m=new Ze({pos:h,anchor:[.5,.5],size:[y.w,y.h],name:e,id:e,normalize:!0,zIndex:a}),d={pos:[0,0],normalize:!0,d:w,fillColor:o,strokeColor:o,lineDash:c===$t.Dotted&&!T?[1,s*2]:c===$t.LongDotted&&!T?[s,s*2]:void 0,lineCap:c===$t.Normal||T?void 0:"round",lineWidth:c===$t.Normal||T?0:s};l&&(d.scale=l),u&&(d.rotate=u),p&&(d.translate=p);const M=new Wr(d);m.append(M),g&&(this.scaleType=ee.proportional,this.drawEraserlines({group:m,eraserlines:g,pos:h,layer:r},i)),this.replace(r,e,m);let x={x:Math.floor(y.x*I[0]+v[0]-jt.SafeBorderPadding),y:Math.floor(y.y*I[1]+v[1]-jt.SafeBorderPadding),w:Math.floor(y.w*I[0]+2*jt.SafeBorderPadding),h:Math.floor(y.h*I[1]+2*jt.SafeBorderPadding)};if(u||l||p){const E=M.getBoundingClientRect();x={x:Math.floor(E.x-jt.SafeBorderPadding),y:Math.floor(E.y-jt.SafeBorderPadding),w:Math.floor(E.width+jt.SafeBorderPadding*2),h:Math.floor(E.height+jt.SafeBorderPadding*2)}}return this.isDelete&&m.setAttribute("opacity",0),x}computDrawPoints(t,e){return this.tmpPoints[1].distance(this.tmpPoints[0])>this.straightTipWidth?this.computFullPoints(t,e):this.computDotPoints(t)}computFullPoints(t,e){const r=ht.Sub(this.tmpPoints[1],this.tmpPoints[0]).uni(),i=ht.Per(r).mul(t/2),o=Wt.Sub(this.tmpPoints[0],i),s=Wt.Add(this.tmpPoints[0],i),a=Wt.Sub(this.tmpPoints[1],i),l=Wt.Add(this.tmpPoints[1],i),u=Wt.GetSemicircleStroke(this.tmpPoints[1],a,-1,8),p=Wt.GetSemicircleStroke(this.tmpPoints[0],s,-1,8),c=[o,a,...u,l,s,...p];let g;return e!==$t.Normal?g=jr(this.tmpPoints,!1):g=jr(c,!0),{d:g,rect:he(c),isDot:!1,pos:this.tmpPoints[0].XY}}computDotPoints(t){const e=Wt.GetDotStroke(this.tmpPoints[0],t/2,8);return{d:jr(e,!0),rect:he(e),isDot:!0,pos:this.tmpPoints[0].XY}}updateTempPoints(t){const e=t.slice(-2),r=new Wt(e[0],e[1]),i=this.tmpPoints[0],{thickness:o}=this.workOptions;if(i.isNear(r,o))return!1;if(this.tmpPoints.length===2){if(r.isNear(this.tmpPoints[1],1))return!1;this.tmpPoints[1]=r}else this.tmpPoints.push(r);return!0}consumeService(t){var e,r;const{op:i,isFullWork:o,workState:s=Tt.Done}=t,a=(e=this.workId)==null?void 0:e.toString();if(!a)return;this.tmpPoints.length=0;for(let p=0;p<i.length;p+=3)this.tmpPoints.push(new Wt(i[p],i[p+1],i[p+2]));const l=o?this.fullLayer:this.drawLayer||this.fullLayer,u=this.draw({workId:a,layer:l,isDrawEraserlines:s===Tt.Done});return this.oldRect=u,(r=this.vNodes)==null||r.setInfo(a,{rect:u,op:i,opt:this.workOptions,toolsType:this.toolsType,scaleType:this.scaleType,canRotate:this.canRotate,centerPos:u&&jt.getCenterPos(u,l)}),u}clearTmpPoints(){this.tmpPoints.length=0}static updateNodeOpt(t){var e,r;const{node:i,opt:o,vNodes:s}=t,{strokeColor:a,strokeType:l}=o,u=s.get(i.name);return a&&(i.tagName==="GROUP"?i.children.forEach(p=>{p.setAttribute("strokeColor",a),p.getAttribute("fillColor")&&p.setAttribute("fillColor",a)}):(i.setAttribute("strokeColor",a),i.setAttribute("fillColor",a)),(e=u?.opt)!=null&&e.strokeColor&&(u.opt.strokeColor=a)),l&&u!=null&&u.opt&&(r=u.opt)!=null&&r.strokeType&&(u.opt.strokeType=l),u&&s.setInfo(i.name,u),jt.updateNodeOpt(t)}}const ku=class So extends jt{constructor(t){super(t),G(this,"canRotate",!1),G(this,"scaleType",ee.proportional),G(this,"toolsType",nt.Text),G(this,"tmpPoints",[]),G(this,"workOptions"),G(this,"oldRect"),this.workOptions=t.toolsOpt}consume(){return{type:pt.None}}consumeAll(){return{type:pt.None}}consumeService(){}async draw(t){const{workId:e,layer:r,isDrawLabel:i}=t,{boxSize:o,boxPoint:s,zIndex:a}=this.workOptions,l=r.worldPosition,u=r.worldScaling;if(!s||!o)return;const p={name:e,id:e,pos:[s[0],s[1]],anchor:[0,0],size:o,zIndex:a},c=new Ze(p),g={x:s[0],y:s[1],w:o[0],h:o[1]},v={x:Math.floor(g.x*u[0]+l[0]),y:Math.floor(g.y*u[1]+l[1]),w:Math.floor(g.w*u[0])+2,h:Math.floor(g.h*u[1])+2};if(this.replace(r,e,c),i&&r&&this.workOptions.text){const I=await So.createLabels(this.workOptions,r,v),{labels:w,maxWidth:y}=I;c.append(...w),v.w=Math.ceil(Math.max(y*r.worldScaling[0],v.w))}return v}async consumeServiceAsync(t){var e,r,i,o;const s=(e=this.workId)==null?void 0:e.toString();if(!s)return;const{isFullWork:a,replaceId:l,isDrawLabel:u}=t;this.oldRect=l&&((i=(r=this.vNodes)==null?void 0:r.get(l))==null?void 0:i.rect)||void 0;const p=a?this.fullLayer:this.drawLayer||this.fullLayer,c=await this.draw({workId:s,layer:p,isDrawLabel:typeof u>"u"&&this.workOptions.workState===Tt.Done||u});return(o=this.vNodes)==null||o.setInfo(s,{rect:c,op:[],opt:this.workOptions,toolsType:this.toolsType,scaleType:this.scaleType,canRotate:this.canRotate,centerPos:c&&jt.getCenterPos(c,p)}),c}updataOptService(){}async updataOptServiceAsync(t,e){var r,i;if(!this.workId)return;const o=this.workId.toString(),{fontColor:s,fontBgColor:a,bold:l,italic:u,lineThrough:p,underline:c,zIndex:g}=t,v=(r=this.vNodes)==null?void 0:r.get(o);if(!v)return;s&&(v.opt.fontColor=s),a&&(v.opt.fontBgColor=a),l&&(v.opt.bold=l),u&&(v.opt.italic=u),Ri(p)&&(v.opt.lineThrough=p),Ri(c)&&(v.opt.underline=c),tn(g)&&(v.opt.zIndex=g),this.oldRect=v.rect;const I=await this.draw({workId:o,layer:this.fullLayer,isDrawLabel:typeof e>"u"&&this.workOptions.workState===Tt.Done||e});return(i=this.vNodes)==null||i.setInfo(o,{rect:I,op:[],opt:this.workOptions,toolsType:this.toolsType,scaleType:this.scaleType,canRotate:this.canRotate,centerPos:I&&jt.getCenterPos(I,this.fullLayer)}),I}clearTmpPoints(){this.tmpPoints.length=0}static getSafetySnippetRatio(t){const e=(t?.parent).displayRatio||1,r=Math.ceil(t.worldScaling[0]*10)/10;let i=r;return r>=.2&&r<1?i=r*e:r<=2&&r>=1?i=r*e*1.6:r>2&&r<=3?i=r*e*1.4:r>3&&r<=4?i=r*e*.8:r>4&&(i=r*e*.6),Math.floor(i*1e3)/1e3}static getSafetySnippetFontLength(t){return Math.floor(So.textImageSnippetSize*3/4/t)||1}static async createLabels(t,e,r){var i;const o=[],{x:s,y:a}=r,{width:l,height:u}=(i=e.parent)==null?void 0:i.parent,p=io(t.text),c=p.length,{fontSize:g,lineHeight:v,bold:I,textAlign:w,italic:y,fontFamily:T,verticalAlign:h,fontColor:m,fontBgColor:d,underline:M,lineThrough:x}=t,E=So.getSafetySnippetRatio(e)||1,P=Math.floor(g*E),R=So.getSafetySnippetFontLength(P);let N=0;for(let b=0;b<c;b++){const j=p[b],O=v||P*1.5;if(j){const L=XD(j),k=[0,0],H=[0,g*1.2];h==="middle"&&(k[1]=b*g*1.2+5);const Q=[0,-g*.15];k[0]=5;const _=Math.sin(Math.PI/180*20);let st=0;const F=[];let Z=0;for(;Z<L;){w==="left"&&(Q[0]=st),Z===0&&y==="italic"&&(Q[0]=Q[0]-_/2*g);const ct=j.slice(Z,Z+R),at={anchor:[0,0],pos:Q,text:ct,fontFamily:T,fontSize:P,lineHeight:O,strokeColor:m,fontWeight:I,fillColor:m,textAlign:w,fontStyle:y,scale:[1/E,1/E]},dt=new f0(at),it=await dt.textImageReady;let ft=!0;if(it){const wt=it.rect&&it.rect[2],U=it.rect&&it.rect[3];if(wt&&U){const Y=wt/E,K=U/E;st=Y+st,y==="italic"&&(I==="bold"?st=st-_*g*1.2:st=st-_*g),((Q[0]+k[0]+Y)*e.worldScaling[0]+s<=0||(Q[0]+k[0])*e.worldScaling[0]+s>=l||(Q[1]+k[1]+K)*e.worldScaling[1]+a<=0||(Q[1]+k[1])*e.worldScaling[1]+a>=u)&&(dt.disconnect(),ft=!1),ft&&F.push(dt)}}Z+=R}H[0]=st,y==="italic"&&(H[0]=H[0]+_*g),N=Math.max(N,H[0]);let tt=!0;if(((k[0]+H[0])*e.worldScaling[0]+s<=0||k[0]*e.worldScaling[0]+s>=l||(k[1]+H[1])*e.worldScaling[0]+a<=0||k[1]*e.worldScaling[1]+a>=u)&&(tt=!1),tt){if(M){const dt=Math.floor(g/10),it={normalize:!1,pos:[0,g*1.1+dt/2],lineWidth:dt,points:[0,0,Math.ceil(H[0]),0],strokeColor:m,className:"underline"},ft=new gr(it);F.push(ft)}if(x){const dt={normalize:!1,pos:[0,g*1.2/2],lineWidth:Math.floor(g/10),points:[0,0,Math.ceil(H[0]),0],strokeColor:m,className:"lineThrough"},it=new gr(dt);F.push(it)}const ct={pos:k,anchor:[0,0],size:H,bgcolor:d},at=new Ze(ct);at.append(...F),o.push(at)}}}return{labels:o,maxWidth:N}}static updateNodeOpt(t){const{node:e,opt:r,vNodes:i,targetNode:o}=t,{fontBgColor:s,fontColor:a,translate:l,originPoint:u,scenePoint:p,scale:c,bold:g,italic:v,lineThrough:I,underline:w,fontSize:y,textInfos:T,zIndex:h}=r,m=o&&ze(o)||i.get(e.name);if(!m||!e.parent)return;const d=m.opt;if(tn(h)&&(e.setAttribute("zIndex",h),m.opt.zIndex=h),a&&d.fontColor&&(d.fontColor=a,e.children.forEach(M=>{M.tagName==="GROUP"&&M.children.forEach(x=>{x.tagName==="LABEL"?(x.setAttribute("fillColor",a),x.setAttribute("strokeColor",a)):x.tagName==="POLYLINE"&&x.setAttribute("strokeColor",a)})})),s&&d.fontBgColor&&(d.fontBgColor=s,e.children.forEach(M=>{M.tagName==="GROUP"&&M.setAttribute("bgcolor",s)})),g&&(d.bold=g),v&&(d.italic=v),Ri(I)&&(d.lineThrough=I),Ri(w)&&(d.underline=w),y&&(d.fontSize=y),u&&p&&c&&o&&d.boxPoint){const M=T?.get(e.name);if(M){const{fontSize:R,boxSize:N}=M;d.boxSize=N||d.boxSize,d.fontSize=R||d.fontSize}const x=[d.boxPoint[0],d.boxPoint[1]];ch(d.boxPoint,p,c,l);const E=[m.op[0],m.op[1]],P=[E[0]-x[0],E[1]-x[1]];if(m.centerPos=[m.centerPos[0]+P[0],m.centerPos[1]+P[1]],m.opt.eraserlines)for(const R of m.opt.eraserlines){const{op:N,thickness:b}=R;R.thickness=Math.round(b*Math.max(c[0],c[1]));for(let j=0;j<N.length;j++)hh(N[j],p,c,l)}}else if(l&&d.boxPoint&&(d.boxPoint=[d.boxPoint[0]+l[0],d.boxPoint[1]+l[1]],m.centerPos=[m.centerPos[0]+l[0],m.centerPos[1]+l[1]],m.opt.eraserlines))for(const M of m.opt.eraserlines){const{op:x}=M;for(let E=0;E<x.length;E++){const P=x[E].map((R,N)=>N%2?R+l[1]:R+l[0]);M.op[E]=P}}return m&&i.setInfo(e.name,m),m?.rect}static getRectFromLayer(t,e){const r=t.getElementsByName(e)[0];if(r){const i=r.getBoundingClientRect();let o={x:Math.floor(i.x),y:Math.floor(i.y),w:Math.floor(i.width+2),h:Math.floor(i.height+2)};return r.children.forEach(s=>{if(s.tagName==="GROUP"){const a=r.getBoundingClientRect();o=oe(o,{x:Math.floor(a.x),y:Math.floor(a.y),w:Math.floor(a.width+2),h:Math.floor(a.height+2)})}}),o}}};G(ku,"textImageSnippetSize",1024*4),G(ku,"SafeBorderPadding",30);let av=ku;const lv=class $s extends jt{constructor(t){super(t),G(this,"canRotate",!1),G(this,"scaleType",ee.none),G(this,"toolsType",nt.PencilEraser),G(this,"tmpPoints",[]),G(this,"workOptions"),G(this,"worldPosition"),G(this,"worldScaling"),G(this,"eraserRect"),G(this,"eraserPolyline"),this.workOptions=t.toolsOpt,this.worldPosition=this.fullLayer.worldPosition,this.worldScaling=this.fullLayer.worldScaling}combineConsume(t){const{workerEngine:e}=t;if(this.tmpPoints.length<2)return{type:pt.None};const{thickness:r}=this.workOptions,{width:i,height:o}=$s.eraserSizes[r],s=Math.round(Math.max(i,o)/this.worldScaling[0]),{rect:a,willNewNodes:l,willDeleteNodes:u}=this.getChangeNodes(s,e);return{...this.baseConsumeResult,type:pt.DrawWork,rect:a,willNewNodes:l,willDeleteNodes:u}}consumeService(){}updateTempPoints(t,e){let r=this.tmpPoints.length-1;const i=Date.now();for(let o=0;o<t.length;o+=2){const s=this.tmpPoints.length,a=new Wt(t[o],t[o+1]);if(s===0){this.tmpPoints.push(a);continue}const l=s-1,u=this.tmpPoints[l],p=ht.Sub(a,u).uni();a.isNear(u,e/2)||(ht.Equals(p,u.v,.02)&&(this.tmpPoints.pop(),r--),a.setv(p),a.setT(i),this.tmpPoints.push(a))}return Math.max(r,0)}getChangeNodes(t,e){const r=new Map,i=new Set;let o;if(!this.vNodes)return{willDeleteNodes:i,willNewNodes:r,rect:o};const s=this.worldPosition;let a=he(this.tmpPoints,t);a=$o(a,s),a=Tv(a,this.worldScaling,s);const{nodeRange:l}=this.vNodes.getRectIntersectRange(a);if(!l.size)return{willDeleteNodes:i,willNewNodes:r,rect:o};const u=this.computEraserPointLines(this.tmpPoints,90);for(const[p,c]of l.entries()){if(c.toolsType!==nt.Pencil)continue;let g=$o(c.rect,[-s[0],-s[1]]);g={x:g.x/this.worldScaling[0],y:g.y/this.worldScaling[1],w:g.w/this.worldScaling[0],h:g.h/this.worldScaling[1]};const v=[g.x,g.y,g.x+g.w,g.y+g.h],I=[],w=[];for(const y of u)Xu.polyline(y,v,I);if(I.length&&c.opt)for(const y of I){const T=[];for(let h=0;h<y.length;h++)h!==0&&Pr(y[h],y[h-1])||T.push(...y[h]);w.push(T)}if(w.length&&e){const y=e.createWorkShapeNode({workId:p,toolsType:nt.Pencil,toolsOpt:c.opt});y.setWorkId(p);const T=y?.computPencilPoints({op:c.op,eraserPolylines:w,eraserThickness:t});if(o=oe(o,c.rect),i.add(p),e.removeNode(p),T.length)for(let h=0;h<T.length;h++){const m=`${p}_${Date.now()}_${h}`,d=m,M=e.setFullWork({workId:d,opt:c.opt,toolsType:nt.Pencil}).consumeService({op:T[h],isFullWork:!0,replaceId:d});e.clearWorkShapeNodeCache(d),o=oe(o,M),r.set(m,{...c,toolsType:nt.Pencil,rect:M??c.rect,name:m,op:T[h]})}}}return{willNewNodes:r,willDeleteNodes:i,rect:o}}consume(t){const{data:e}=t,{op:r}=e;if(!r||r.length===0)return{type:pt.None,...this.baseConsumeResult};const{thickness:i}=this.workOptions,{width:o,height:s}=$s.eraserSizes[i],a=Math.max(o,s)/this.worldScaling[0];return this.updateTempPoints(r,a),{type:pt.None,...this.baseConsumeResult}}computEraserPointLines(t,e=60){const r=[];let i=0;const o=360-e;for(let s=1;s<t.length;s++){const a=t[s-1],l=t[s];if(s===1&&i===0&&(r[i]=[a.XY]),r[i].push(l.XY),s<t.length-1){const u=l.getAngleByPoints(a,t[s+1]);(u<e||u>o)&&(i++,r[i]=[l.XY])}}return t.length===1&&r.length===0&&r.push([t[0].XY,t[0].XY]),r}consumeAll(t){const{workerEngine:e}=t;if(this.replace(this.fullLayer,this.workId),!this.tmpPoints.length)return{type:pt.None,...this.baseConsumeResult};const{thickness:r}=this.workOptions,{width:i,height:o}=$s.eraserSizes[r],s=Math.max(i,o)/this.worldScaling[0],{willDeleteNodes:a,willNewNodes:l,rect:u}=this.getChangeNodes(s,e);if(a.size===0&&l.size===0)return{type:pt.FullWork,...this.baseConsumeResult,rect:u};const p=[];this.tmpPoints.map(g=>{p.push(g.x,g.y,s/2)});const c=nn(p);return{...this.baseConsumeResult,type:pt.FullWork,dataType:kt.Local,rect:u,ops:c,willNewNodes:l,willDeleteNodes:a}}clearTmpPoints(){this.tmpPoints.length=0}};G(lv,"eraserSizes",ih);let uv=lv;const cv=class Hs extends jt{constructor(t){super(t),G(this,"canRotate",!1),G(this,"scaleType",ee.none),G(this,"toolsType",nt.BitMapEraser),G(this,"tmpPoints",[]),G(this,"workOptions"),G(this,"worldPosition"),G(this,"worldScaling"),G(this,"eraserRect"),G(this,"eraserPolyline"),G(this,"oldRect"),this.workOptions=t.toolsOpt,this.worldPosition=this.fullLayer.worldPosition,this.worldScaling=this.fullLayer.worldScaling}combineConsume(t){const{workerEngine:e}=t;if(this.tmpPoints.length<2)return{type:pt.None};const{thickness:r}=this.workOptions,{width:i,height:o}=Hs.eraserSizes[r],s=Math.round(Math.max(i,o)/this.worldScaling[0]),{willDeleteNodes:a,rect:l}=this.getChangeNodes(s,e);return{...this.baseConsumeResult,type:pt.DrawWork,rect:l,willDeleteNodes:a}}consumeService(){}updateTempPoints(t,e){let r=this.tmpPoints.length-1;const i=Date.now();for(let o=0;o<t.length;o+=2){const s=this.tmpPoints.length,a=new Wt(t[o],t[o+1]);if(s===0){this.tmpPoints.push(a);continue}const l=s-1,u=this.tmpPoints[l],p=ht.Sub(a,u).uni();a.isNear(u,e/2)||(ht.Equals(p,u.v,.02)&&(this.tmpPoints.pop(),r--),a.setv(p),a.setT(i),this.tmpPoints.push(a))}return Math.max(r,0)}getChangeNodes(t,e){const r=new Map,i=new Set;let o;if(!this.vNodes)return{willDeleteNodes:i,willUpdateNodes:r,rect:o};const s=this.worldPosition;let a=he(this.tmpPoints,t);a=$o(a,s),a=Tv(a,this.worldScaling,s);const{nodeRange:l}=this.vNodes.getRectIntersectRange(a);if(!l.size)return{willDeleteNodes:i,willUpdateNodes:r,rect:o};const u=this.computEraserPointLines(this.tmpPoints);for(const[p,c]of l.entries()){if(c.toolsType===nt.Text||c.toolsType===nt.Image)continue;let g=$o(c.rect,[-s[0],-s[1]]);g={x:g.x/this.worldScaling[0],y:g.y/this.worldScaling[1],w:g.w/this.worldScaling[0],h:g.h/this.worldScaling[1]};const v=[g.x,g.y,g.x+g.w,g.y+g.h],I=[],w=[];for(const h of u)Xu.polyline(h,v,I);if(I.length&&c.opt)for(const h of I){const m=[];for(let d=0;d<h.length&&!(isNaN(h[d][0])||isNaN(h[d][1]));d++){const M=h[d].map(x=>Math.round(x*100)/100);if(d!==0){const x=h[d-1].map(E=>Math.round(E*100)/100);if(Pr(M,x))continue}m.push(...M)}m.length!==0&&w.push(m)}if(!w.length)continue;const y=c.opt.eraserlines?c.opt.eraserlines:[],T=y.find(h=>h.workId===this.workId);if(T?T.op=w:y.push({workId:this.workId,op:w,thickness:t}),c.opt.eraserlines=y,e){const{toolsType:h}=c,m=e.createWorkShapeNode({workId:p,toolsType:h,toolsOpt:c.opt});m?.setWorkId(p);const d=m?.consumeService({op:c.op,isFullWork:!0,replaceId:p});if(o=oe(o,d),m!=null&&m.isDelete){e.removeNode(p),i.add(p);continue}}r.set(p,c)}return{willUpdateNodes:r,willDeleteNodes:i,rect:o}}consume(t){const{data:e}=t,{op:r}=e;if(!r||r.length===0)return{type:pt.None,...this.baseConsumeResult};const{thickness:i}=this.workOptions,{width:o,height:s}=Hs.eraserSizes[i],a=Math.round(Math.max(o,s)/this.worldScaling[0]);return this.updateTempPoints(r,a),{type:pt.None,...this.baseConsumeResult}}computEraserPointLines(t,e=60){const r=[];let i=0;const o=360-e;for(let s=1;s<t.length;s++){const a=t[s-1],l=t[s];if(s===1&&i===0&&(r[i]=[a.XY]),r[i].push(l.XY),s<t.length-1){const u=l.getAngleByPoints(a,t[s+1]);(u<e||u>o)&&(i++,r[i]=[l.XY])}}return t.length===1&&r.length===0&&r.push([t[0].XY,t[0].XY]),r}consumeAll(t){const{workerEngine:e}=t;if(this.replace(this.fullLayer,this.workId),!this.tmpPoints.length)return{type:pt.None,...this.baseConsumeResult};const{thickness:r}=this.workOptions,{width:i,height:o}=Hs.eraserSizes[r],s=Math.round(Math.max(i,o)/this.worldScaling[0]),{willDeleteNodes:a,willUpdateNodes:l,rect:u}=this.getChangeNodes(s,e);if(a.size===0&&l.size===0)return{type:pt.FullWork,...this.baseConsumeResult,rect:u};const p=[];this.tmpPoints.map(g=>{p.push(g.x,g.y,s/2)});const c=nn(p);return{...this.baseConsumeResult,type:pt.FullWork,dataType:kt.Local,rect:u,ops:c,willUpdateNodes:l,willDeleteNodes:a}}clearTmpPoints(){this.tmpPoints.length=0}};G(cv,"eraserSizes",ih);let hv=cv;function fv(n){switch(n){case nt.Arrow:return tv;case nt.Pencil:return Gm;case nt.Straight:return sv;case nt.Ellipse:return ev;case nt.Polygon:case nt.Triangle:return iv;case nt.Star:case nt.Rhombus:return rv;case nt.Rectangle:return nv;case nt.SpeechBalloon:return ov;case nt.Text:return av;case nt.LaserPen:return $m;case nt.Eraser:return Qm;case nt.PencilEraser:return uv;case nt.BitMapEraser:return hv;case nt.Selector:return _m;case nt.Image:return Go}}function lh(n,t){const{toolsType:e,...r}=n;switch(e){case nt.Arrow:return new tv(r);case nt.Pencil:return new Gm(r);case nt.Straight:return new sv(r);case nt.Ellipse:return new ev(r);case nt.Polygon:case nt.Triangle:return new iv(r);case nt.Star:case nt.Rhombus:return new rv(r);case nt.Rectangle:return new nv(r);case nt.SpeechBalloon:return new ov(r);case nt.Text:return new av(r);case nt.LaserPen:return new $m(r);case nt.Eraser:return new Qm(r,t);case nt.BitMapEraser:return new hv(r);case nt.PencilEraser:return new uv(r);case nt.Selector:return r.vNodes?new _m({...r,vNodes:r.vNodes,drawLayer:r.fullLayer}):void 0;case nt.Image:return new Go(r);default:return}}function dv(n){const t=[],e=["PATH","SPRITE","POLYLINE","RECT","ELLIPSE","LABEL"];for(const r of n){if(r.tagName==="GROUP"&&r.children.length){const i=dv(r.children);t.push(...i)}r.tagName&&e.includes(r.tagName)&&t.push(r)}return t}const Mb="cursorhover",pv=20,ce="mainView";class Z2{constructor(t,e){G(this,"viewId"),G(this,"scene"),G(this,"fullLayer"),G(this,"curNodeMap",new Map),G(this,"targetNodeMap",[]),G(this,"highLevelIds"),G(this,"canClearUids"),G(this,"localUid"),this.viewId=t,this.scene=e}init(t){this.fullLayer=t}get(t){return this.curNodeMap.get(t)}setLocalUid(t){this.localUid=t}getLocalUid(){return this.localUid}setCanClearUids(t){this.canClearUids=t}getCanClearUids(){return this.canClearUids}getCanEraserNodes(t,e){const r=new Map;for(const[i,o]of t.entries())o.toolsType===nt.Image&&(o.opt.locked||e&&e.disableEraseImage)||o.toolsType===nt.Text&&(o.opt.workState===Tt.Doing||o.opt.workState===Tt.Start||e&&e.disableEraseText)||this.isCanClearWorkId(i)&&r.set(i,o);return r}getNodesByType(t){const e=new Map;return this.curNodeMap.forEach((r,i)=>{r.toolsType===t&&e.set(i,r)}),e}gethasEraserNodes(){const t=new Map;return this.curNodeMap.forEach((e,r)=>{var i;(i=e.opt.eraserlines)!=null&&i.length&&t.set(r,e)}),t}hasRenderNodes(){return!0}has(t){return this.curNodeMap.has(t)}setInfo(t,e){const r=this.curNodeMap.get(t)||{name:t,rect:e.rect};e.rect&&(r.rect=ze(e.rect)),e.op&&kD(e.op)&&(r.op=ze(e.op)),e.canRotate&&(r.canRotate=e.canRotate),e.scaleType&&(r.scaleType=e.scaleType),e.opt&&(r.opt=ze(e.opt)),e.toolsType&&(r.toolsType=e.toolsType),e.centerPos&&(r.centerPos=ze(e.centerPos)),Ri(e.isSelected)&&(r.isSelected=e.isSelected),r.rect?this.curNodeMap.set(t,r):this.curNodeMap.delete(t)}selected(t){this.setInfo(t,{isSelected:!0})}unSelected(t){this.setInfo(t,{isSelected:!1})}delete(t){this.curNodeMap.delete(t)}clear(){this.curNodeMap.clear(),this.targetNodeMap.length=0}getRectIntersectRange(t,e=!0,r=!0){let i;const o=new Map;for(const[s,a]of this.curNodeMap.entries())if(Wu(t,a.rect)){if(e&&a.toolsType===nt.Image&&a.opt.locked||r&&a.toolsType===nt.Text&&(a.opt.workState===Tt.Doing||a.opt.workState===Tt.Start))continue;i=oe(i,a.rect),o.set(s,a)}return{rectRange:i,nodeRange:o}}getNodeRectFormShape(t,e){const r=fv(e.toolsType);return this.fullLayer&&r?.getRectFromLayer(this.fullLayer,t)}updateNodeRect(t){const e=this.curNodeMap.get(t);if(e){const r=this.getNodeRectFormShape(t,e);if(!r){this.curNodeMap.delete(t);return}e.rect=r,this.curNodeMap.set(t,e)}}updateHighLevelNodesRect(t){this.highLevelIds=t;for(const e of this.highLevelIds.keys())this.updateNodeRect(e)}updateLowLevelNodesRect(){var t;for(const e of this.curNodeMap.keys())(t=this.highLevelIds)!=null&&t.has(e)||this.updateNodeRect(e)}clearHighLevelIds(){this.highLevelIds=void 0}setTargetAssignKeys(t){const e=new Map;for(const r of t){const i=this.curNodeMap.get(r);i&&e.set(r,ze(i))}return this.targetNodeMap.push(ze(e)),this.targetNodeMap.length-1}setTarget(){return this.targetNodeMap.push(ze(this.curNodeMap)),this.targetNodeMap.length-1}getLastTarget(){return this.targetNodeMap[this.targetNodeMap.length-1]}deleteLastTarget(){this.targetNodeMap.length&&(this.targetNodeMap.length=this.targetNodeMap.length-1)}getTarget(t){return this.targetNodeMap[t]}deleteTarget(t){this.targetNodeMap.length=t}clearTarget(){this.targetNodeMap.length=0}isLocalWorkId(t){return t.split(gn).length===1}isCanClearWorkId(t){if(this.canClearUids===void 0||this.canClearUids===!0)return!0;if(bP(this.canClearUids)){const e=t.split(gn);if(e.length===1)return this.canClearUids.has("localSelf")||this.localUid&&this.canClearUids.has(this.localUid);if(e.length===2)return this.canClearUids.has(e[0])}return!1}}class K2{constructor(t,e,r){G(this,"viewId"),G(this,"scene"),G(this,"fullLayer"),G(this,"vNodes"),G(this,"dpr"),G(this,"contextType"),G(this,"opt"),G(this,"cameraOpt"),G(this,"isSafari",!1),G(this,"combinePostMsg",new Set),G(this,"workerTaskId"),G(this,"protectedTask"),G(this,"hasPriorityDraw",!0),G(this,"delayPostDoneResolve"),G(this,"cacheImages",new Map),G(this,"imageResolveMap",new Map),G(this,"taskUpdateCameraId"),G(this,"debounceUpdateCameraId");var i,o;if(this.viewId=t,this.opt=e,this.dpr=e.dpr,this.contextType=this.getSupportContextType(r,(i=e?.offscreenCanvasOpt)==null?void 0:i.contextType),!this.contextType)throw new Error("Sorry, your browser doesn't support canvas context type 2d or webgl");try{this.createRenderLayer(e)}catch(s){if(this.contextType!=="2d")this.contextType="2d",(o=this.scene)==null||o.disconnect(),this.createRenderLayer(e);else throw s}this.vNodes=new Z2(t,this.scene)}createRenderLayer(t){this.scene=this.createScene(t.offscreenCanvasOpt);const e=me.bufferSize.full,r=me.bufferSize.sub;this.fullLayer=this.createLayer("fullLayer",this.scene,{...t.layerOpt,bufferSize:this.viewId===ce?e:r*2})}async updateDpr(t){this.dpr=t,this.scene.displayRatio=t}getCachedImages(t){var e;return(e=this.cacheImages.get(t))==null?void 0:e.imageBitmap}getCachedImagesByWorkId(t){for(const[e,r]of this.cacheImages.entries())if(e===t&&r.imageBitmap)return r.imageBitmap}deleteCachedImagesByWorkId(t,e){for(const[r,i]of this.cacheImages.entries())e&&r===e||i.workId===t&&(i.imageBitmap.close(),this.cacheImages.delete(r))}clearCacheImages(){this.cacheImages.forEach(t=>t.imageBitmap.close()),this.cacheImages.clear()}clearImageResolveMap(){this.imageResolveMap.forEach(({timer:t})=>{t&&clearTimeout(t)}),this.imageResolveMap.clear()}setHasPriorityDraw(t){this.hasPriorityDraw=t}getPriorityDraw(){return this.hasPriorityDraw}setIsSafari(t){this.isSafari=t}async on(t){const{msgType:e,toolsType:r,opt:i,imageSrc:o,imageBitmap:s,workId:a,dpr:l}=t;switch(e){case pt.UpdateDpr:tn(l)&&await this.updateDpr(l);break;case pt.UpdateCamera:await this.updateCamera(t);break;case pt.Destroy:this.destroy();break;case pt.Clear:await this.clearAll();break;case pt.UpdateTools:if(r&&i){const u={toolsType:r,toolsOpt:i,combineUnitTime:t.combineUnitTime,maxCombineEraserTime:t.maxCombineEraserTime};this.localWork.setToolsOpt(u)}break;case pt.GetImageBitMap:if(o&&s&&a){const u=a.toString();this.cacheImages.set(o,{imageBitmap:s,workId:u});const p=this.imageResolveMap.get(o);if(p){const{resolve:c,timer:g}=p;g&&clearTimeout(g),c&&c(o)}this.deleteCachedImagesByWorkId(u,o)}break}}getIconSize(t,e,r){const i=t*r,o=e*r;return i<=50||o<=50?[50,50]:i<=100||o<=100?[100,100]:i<=200||o<=200?[200,200]:i<=400||o<=400?[400,400]:i<=800||o<=800?[800,800]:[1600,1600]}async loadImageBitMap(t){const{toolsType:e,opt:r,workId:i,isSubWorker:o}=t;if(e===nt.Image&&r&&i){const s=i.toString(),{src:a,type:l,width:u,height:p,strokeColor:c}=r;if(!a||!l||!u||!p)return;let g=a;if(l===ai.Iconify){const[I,w]=this.getIconSize(u,p,this.dpr);g=`${a}?width=${I}&height=${w}&color=${c}`}if(this.cacheImages.has(g)){const I=this.getCachedImages(g);if(I)return I}if(this.imageResolveMap.has(g)){const I=this.getCachedImagesByWorkId(s);if(I)return I}const v=await new Promise(I=>{const w=this.imageResolveMap.get(g)||{resolve:void 0,timer:void 0};w.timer&&clearTimeout(w.timer),w.resolve=I,w.timer=setTimeout(()=>{const y=this.imageResolveMap.get(g);y!=null&&y.resolve&&y.resolve(g)},5e3),this.imageResolveMap.set(g,w),this._post({sp:[{imageSrc:g,workId:s,viewId:this.viewId,isgl:!!this.fullLayer.parent.gl,isSubWorker:o,type:pt.GetImageBitMap}]})});return this.imageResolveMap.delete(v),this.getCachedImages(g)}}createLocalWork(t){const{workId:e,opt:r,toolsType:i}=t;e&&r&&(!this.localWork.getToolsOpt()&&i&&this.setToolsOpt({toolsType:i,toolsOpt:r}),this.setWorkOpt({workId:e,toolsOpt:r}))}updateScene(t){this.scene.attr({...t});const{width:e,height:r}=t;this.scene.container.width=e,this.scene.container.height=r,this.scene.width=e,this.scene.height=r,this.updateLayer({width:e,height:r})}updateLayer(t){const{width:e,height:r}=t;this.fullLayer&&(this.fullLayer.parent.setAttribute("width",e),this.fullLayer.parent.setAttribute("height",r),this.fullLayer.setAttribute("size",[e,r]),this.fullLayer.setAttribute("pos",[e*.5,r*.5]))}getSupportContextType(t,e){const r=new OffscreenCanvas(100,100);let i=["2d"];t===Bu.Full&&this.viewId===ce&&(i=["webgl2","webgl","2d"],e&&i.unshift(e));for(const o of i)try{if(r.getContext(o))return o}catch(s){throw s}}createScene(t){const{width:e,height:r}=t,i=new OffscreenCanvas(e,r);t.contextType&&delete t.contextType;const o=new Dd({container:i,displayRatio:this.dpr,depth:!1,desynchronized:!0,failIfMajorPerformanceCaveat:!0,...t,contextType:this.contextType,id:this.viewId});return o.setAttribute("id",this.viewId),o}createLayer(t,e,r){const{width:i,height:o}=r,s=`offscreen-${t}`,a=e.layer(s,r),l=new Ze({anchor:[.5,.5],pos:[i*.5,o*.5],size:[i,o],name:"viewport",id:t});return a.append(l),l}async clearAll(){var t;this.fullLayer&&(this.fullLayer.parent.children.forEach(e=>{e.name!=="viewport"&&e.remove()}),sn(this.fullLayer,this.fullLayer.parent)),this.taskUpdateCameraId&&(clearTimeout(this.taskUpdateCameraId),this.taskUpdateCameraId=void 0),this.debounceUpdateCameraId&&(clearTimeout(this.debounceUpdateCameraId),this.debounceUpdateCameraId=void 0),this.clearCacheImages(),this.clearImageResolveMap(),this.localWork.destroy(),(t=this.serviceWork)==null||t.destroy()}setToolsOpt(t){this.localWork.setToolsOpt(t)}setWorkOpt(t){const{workId:e,toolsOpt:r}=t;e&&r&&this.localWork.setWorkOptions(e.toString(),r)}destroy(){var t;this.vNodes.clear(),this.fullLayer.remove(),mn(this.fullLayer,this.fullLayer.parent),this.clearCacheImages(),this.clearImageResolveMap(),this.scene.remove(),this.localWork.destroy(),(t=this.serviceWork)==null||t.destroy()}async post(t){this.combinePostMsg.add(t),await this.runBatchPostData()}async runBatchPostData(){this.workerTaskId||(this.workerTaskId=setTimeout(()=>{this.workerTaskId=void 0,this.combinePost()},16)),this.type===Bu.Full&&!this.delayPostDoneResolve&&await new Promise(t=>{this.delayPostDoneResolve=t})&&(this.delayPostDoneResolve=void 0)}combinePostData(){var t,e;this.workerTaskId=void 0;const r=[],i=[];let o,s,a;const l=new Set;for(const u of this.combinePostMsg.values()){if((t=u.render)!=null&&t.length)for(const p of u.render){let c=!1;if(p.workId&&l.add(p.workId),p.isClearAll&&(p.rect=this.getSceneRect(),p.isClear=!0,delete p.isClearAll),p.drawCanvas){const g=this.getLayer(p.drawCanvas);if(!g||!(g.parent instanceof d0))continue;if(g.parent.render(),p.isDrawAll){const v=this.getSceneRect();p.rect=v,delete p.isDrawAll}}for(const g of r)if(p.viewId===g.viewId){p.isClear&&g.clearCanvas&&g.isClear&&g.clearCanvas===p.clearCanvas&&(g.rect=oe(g.rect,p.rect),c=!0),g.drawCanvas&&g.drawCanvas===p.drawCanvas&&(g.rect=oe(g.rect,p.rect),c=!0);continue}c||(p.isClear&&!p.drawCanvas?r.unshift(p):r.push(p))}if((e=u.sp)!=null&&e.length)for(const p of u.sp){let c=!1;for(const g of i)if(Pr(p,g)){c=!0;break}c||i.push(p)}tn(u.fullWorkerDrawCount)&&(o=u.fullWorkerDrawCount),tn(u.subWorkerDrawCount)&&(s=u.subWorkerDrawCount),tn(u.consumeCount)&&(a=u.consumeCount)}return this.combinePostMsg.clear(),{render:r,sp:i,fullWorkerDrawCount:o,subWorkerDrawCount:s,consumeCount:a,workIds:l,viewId:this.viewId}}getSceneRect(){const{width:t,height:e}=this.scene;return{x:0,y:0,w:Math.floor(t),h:Math.floor(e)}}}class J2{constructor(t){G(this,"viewId"),G(this,"vNodes"),G(this,"thread"),G(this,"fullLayer"),G(this,"drawLayer"),G(this,"_post"),G(this,"tmpOpt"),G(this,"workShapes",new Map),G(this,"drawCount",0),G(this,"consumeCount",0),G(this,"syncUnitTime",me.syncOpt.interval),G(this,"combineUnitTime",me.bezier.combineUnitTime),G(this,"maxCombineEraserTime",me.pencilEraser.maxCombineTime),this.thread=t.thread,this.viewId=t.viewId,this.vNodes=t.vNodes,this.fullLayer=t.fullLayer,this.drawLayer=t.drawLayer,this._post=this.thread.post.bind(t.thread)}setmaxCombineEraserTime(t){this.maxCombineEraserTime=t}setCombineUnitTime(t){this.combineUnitTime=t}setSyncUnitTime(t){this.syncUnitTime=t}destroy(){this.workShapes.clear()}getWorkShapes(){return this.workShapes}getWorkShape(t){return this.workShapes.get(t)}createWorkShape(t,e){if(t&&this.tmpOpt){const r={toolsType:this.tmpOpt.toolsType,toolsOpt:e||this.tmpOpt.toolsOpt},i=this.createWorkShapeNode({...r,workId:t});i&&this.workShapes.set(t,i)}}setWorkOptions(t,e){const r=this.getWorkShape(t);r||this.createWorkShape(t,e),r?.setWorkOptions(e)}createWorkShapeNode(t){var e;return lh({...t,vNodes:this.vNodes,fullLayer:this.fullLayer,drawLayer:this.drawLayer},(e=this.thread)==null?void 0:e.serviceWork)}setToolsOpt(t){var e,r,i;((e=this.tmpOpt)==null?void 0:e.toolsType)!==t.toolsType&&(r=this.tmpOpt)!=null&&r.toolsType&&this.clearAllWorkShapesCache(),this.tmpOpt=t,(i=t.toolsOpt)!=null&&i.syncUnitTime&&(this.syncUnitTime=t.toolsOpt.syncUnitTime),t.combineUnitTime&&(this.combineUnitTime=t.combineUnitTime),t.maxCombineEraserTime&&(this.maxCombineEraserTime=t.maxCombineEraserTime)}getToolsOpt(){return this.tmpOpt}clearWorkShapeNodeCache(t){var e;(e=this.getWorkShape(t))==null||e.clearTmpPoints(),this.workShapes.delete(t)}clearAllWorkShapesCache(){this.workShapes.forEach(t=>t.clearTmpPoints()),this.workShapes.clear()}setFullWork(t){const{workId:e,opt:r,toolsType:i}=t;if(e&&r&&i){const o=e.toString();let s;return e&&this.workShapes.has(o)?(s=this.workShapes.get(o),s?.setWorkOptions(r)):s=this.createWorkShapeNode({toolsOpt:r,toolsType:i,workId:o}),s?(this.workShapes.set(o,s),s):void 0}}}function q2(n){return n}var gv=q2;function _2(n,t,e){switch(e.length){case 0:return n.call(t);case 1:return n.call(t,e[0]);case 2:return n.call(t,e[0],e[1]);case 3:return n.call(t,e[0],e[1],e[2])}return n.apply(t,e)}var tA=_2,eA=tA,yd=Math.max;function nA(n,t,e){return t=yd(t===void 0?n.length-1:t,0),function(){for(var r=arguments,i=-1,o=yd(r.length-t,0),s=Array(o);++i<o;)s[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=e(s),eA(n,this,a)}}var rA=nA;function iA(n){return function(){return n}}var oA=iA,sA=oA,Md=Tm,aA=gv,lA=Md?function(n,t){return Md(n,"toString",{configurable:!0,enumerable:!1,value:sA(t),writable:!0})}:aA,uA=lA,cA=800,hA=16,fA=Date.now;function dA(n){var t=0,e=0;return function(){var r=fA(),i=hA-(r-e);if(e=r,i>0){if(++t>=cA)return arguments[0]}else t=0;return n.apply(void 0,arguments)}}var pA=dA,gA=uA,mA=pA,vA=mA(gA),yA=vA,MA=gv,TA=rA,IA=yA;function wA(n,t){return IA(TA(n,t,MA),n+"")}var SA=wA;function xA(n,t,e,r){for(var i=n.length,o=e+(r?1:-1);r?o--:++o<i;)if(t(n[o],o,n))return o;return-1}var CA=xA;function EA(n){return n!==n}var PA=EA;function NA(n,t,e){for(var r=e-1,i=n.length;++r<i;)if(n[r]===t)return r;return-1}var AA=NA,DA=CA,LA=PA,OA=AA;function bA(n,t,e){return t===t?OA(n,t,e):DA(n,LA,e)}var RA=bA,jA=RA;function zA(n,t){var e=n==null?0:n.length;return!!e&&jA(n,t,0)>-1}var mv=zA;function kA(n,t,e){for(var r=-1,i=n==null?0:n.length;++r<i;)if(e(t,n[r]))return!0;return!1}var vv=kA;function BA(n,t){for(var e=-1,r=n==null?0:n.length,i=Array(r);++e<r;)i[e]=t(n[e],e,n);return i}var WA=BA,UA=oh,YA=mv,FA=vv,VA=WA,XA=rl,GA=sh,$A=200;function HA(n,t,e,r){var i=-1,o=YA,s=!0,a=n.length,l=[],u=t.length;if(!a)return l;e&&(t=VA(t,XA(e))),r?(o=FA,s=!1):t.length>=$A&&(o=GA,s=!1,t=new UA(t));t:for(;++i<a;){var p=n[i],c=e==null?p:e(p);if(p=r||p!==0?p:0,s&&c===c){for(var g=u;g--;)if(t[g]===c)continue t;l.push(p)}else o(t,c,r)||l.push(p)}return l}var QA=HA,Td=ns,ZA=xm,KA=rs,Id=Td?Td.isConcatSpreadable:void 0;function JA(n){return KA(n)||ZA(n)||!!(Id&&n&&n[Id])}var qA=JA,_A=nh,tD=qA;function yv(n,t,e,r,i){var o=-1,s=n.length;for(e||(e=tD),i||(i=[]);++o<s;){var a=n[o];t>0&&e(a)?t>1?yv(a,t-1,e,r,i):_A(i,a):r||(i[i.length]=a)}return i}var eD=yv;function nD(){}var rD=nD,Ol=jm,iD=rD,oD=ah,sD=1/0,aD=Ol&&1/oD(new Ol([,-0]))[1]==sD?function(n){return new Ol(n)}:iD,lD=aD,uD=oh,cD=mv,hD=vv,fD=sh,dD=lD,pD=ah,gD=200;function mD(n,t,e){var r=-1,i=cD,o=n.length,s=!0,a=[],l=a;if(e)s=!1,i=hD;else if(o>=gD){var u=t?null:dD(n);if(u)return pD(u);s=!1,i=fD,l=new uD}else l=t?[]:a;t:for(;++r<o;){var p=n[r],c=t?t(p):p;if(p=e||p!==0?p:0,s&&c===c){for(var g=l.length;g--;)if(l[g]===c)continue t;t&&l.push(c),a.push(p)}else i(l,c,e)||(l!==a&&l.push(c),a.push(p))}return a}var vD=mD,yD=QA,MD=eD,wd=vD;function TD(n,t,e){var r=n.length;if(r<2)return r?wd(n[0]):[];for(var i=-1,o=Array(r);++i<r;)for(var s=n[i],a=-1;++a<r;)a!=i&&(o[i]=yD(o[i]||s,n[a],t,e));return wd(MD(o,1),t,e)}var ID=TD,wD=qc,SD=er;function xD(n){return SD(n)&&wD(n)}var CD=xD,ED=Am,PD=SA,ND=ID,AD=CD;PD(function(n){return ND(ED(n,AD))});class DD extends J2{constructor(t){super(t),G(this,"drawWorkActiveId")}async runFullWork(t){var e;const r=this.setFullWork(t),i=t.ops&&io(t.ops);if(r){let o,s;const a=(e=r.getWorkId())==null?void 0:e.toString();return r.toolsType===nt.Image?o=await r.consumeServiceAsync({isFullWork:!0,worker:this.thread}):r.toolsType===nt.Text?o=await r.consumeServiceAsync({isFullWork:!0,replaceId:a,isDrawLabel:!0}):(o=r.consumeService({op:i,isFullWork:!0,replaceId:a}),s=t?.updateNodeOpt&&r.updataOptService(t.updateNodeOpt)),t.workId&&this.workShapes.delete(t.workId.toString()),oe(o,s)}}runSelectWork(t){var e;const r=this.setFullWork(t);r&&(e=t.selectIds)!=null&&e.length&&t.workId&&r.selectServiceNode(t.workId.toString(),{selectIds:t.selectIds},!1)}workShapesDone(){for(const t of this.workShapes.keys())this.clearWorkShapeNodeCache(t);sn(this.fullLayer,this.fullLayer.parent)}canUseSubWorker(t){const e=this.thread.getPriorityDraw();return e||!e&&t!==nt.Pencil}async consumeDraw(t){const{workId:e,fullWorkerDrawCount:r,postCount:i}=t,o=e?.toString(),s=o&&this.workShapes.get(o);if(!s)return;this.drawWorkActiveId&&this.drawWorkActiveId!==o&&(await this.consumeDrawAll({workId:this.drawWorkActiveId,viewId:this.viewId,msgType:pt.DrawWork,dataType:kt.Local}),this.drawWorkActiveId=void 0),!this.drawWorkActiveId&&o!==Xt&&(this.drawWorkActiveId=o);const a=s.toolsType;tn(i)&&(this.consumeCount=i);const l=s.consume({data:t,drawCount:this.drawCount,isFullWork:!0,isSubWorker:!0,removeDrawCount:r});switch(a){case nt.Selector:l&&(this.drawCount++,await this.drawSelector(l));break;case nt.Ellipse:case nt.Arrow:case nt.Straight:case nt.Rectangle:case nt.Star:case nt.Polygon:case nt.SpeechBalloon:{l&&(this.drawCount++,await this.drawShape(l));break}case nt.Pencil:{l&&(this.drawCount++,await this.drawPencil(l,e?.toString()));break}case nt.BitMapEraser:case nt.PencilEraser:{l&&(this.drawCount++,await this._post({subWorkerDrawCount:this.drawCount,consumeCount:this.consumeCount}));break}}}async consumeDrawAll(t){const{workId:e}=t;if(e){const r=e.toString();this.drawWorkActiveId===r&&(this.drawWorkActiveId=void 0);const i=this.workShapes.get(r);if(!i)return;switch(i.toolsType){case nt.Selector:this.drawCount=0,sn(this.fullLayer,this.fullLayer.parent),this.clearWorkShapeNodeCache(r),this._post({render:[{isClearAll:!0,clearCanvas:de.Float,viewId:this.viewId}]});break;case nt.Arrow:case nt.Straight:case nt.Ellipse:case nt.Pencil:case nt.Rectangle:case nt.Star:case nt.Polygon:case nt.SpeechBalloon:case nt.BitMapEraser:case nt.PencilEraser:this.drawCount=0,sn(this.fullLayer,this.fullLayer.parent),this.clearWorkShapeNodeCache(r);break}}}async removeWork(t){const{workId:e}=t,r=e?.toString();if(r){const i=this.removeNode(r);if(i){const o=[];o.push({rect:$r(i),clearCanvas:de.Float,isClear:!0,viewId:this.viewId},{rect:$r(i),drawCanvas:de.Float,viewId:this.viewId}),await this._post({render:o})}}}removeNode(t){const e=this.workShapes.has(t);let r;return e&&(this.fullLayer.getElementsByName(t).forEach(i=>{const o=i.getBoundingClientRect();r=oe(r,{x:o.x-jt.SafeBorderPadding,y:o.y-jt.SafeBorderPadding,w:o.width+jt.SafeBorderPadding*2,h:o.height+jt.SafeBorderPadding*2}),i.remove(),mn(i,this.fullLayer.parent)}),r&&this.clearWorkShapeNodeCache(t)),r}async drawPencil(t,e){await this._post({subWorkerDrawCount:this.drawCount,consumeCount:this.consumeCount,render:[{rect:t?.rect,workId:e,drawCanvas:de.Float,viewId:this.viewId}],sp:t?.op&&[t]})}async drawShape(t){await this._post({subWorkerDrawCount:this.drawCount,consumeCount:this.consumeCount,render:[{rect:t?.rect&&$r(t.rect),isClear:!0,clearCanvas:de.Float,viewId:this.viewId},{rect:t?.rect&&$r(t.rect),drawCanvas:de.Float,viewId:this.viewId}]})}async drawSelector(t){await this._post({subWorkerDrawCount:this.drawCount,consumeCount:this.consumeCount,render:[{rect:t?.rect&&$r(t.rect),isClear:!0,clearCanvas:de.Float,viewId:this.viewId},{rect:t?.rect&&$r(t.rect),drawCanvas:de.Float,viewId:this.viewId}]})}}class LD{constructor(t){G(this,"viewId"),G(this,"vNodes"),G(this,"topLayer"),G(this,"thread"),G(this,"post"),G(this,"serviceWorkShapes",new Map),G(this,"localWorkShapes",new Map),G(this,"tmpOpt"),G(this,"syncUnitTime",me.syncOpt.interval),G(this,"animationId"),this.viewId=t.viewId,this.vNodes=t.vNodes,this.topLayer=t.topLayer,this.thread=t.thread,this.post=t.thread.post.bind(t.thread)}canUseTopLayer(t){return t===nt.LaserPen}getWorkShape(t){return this.localWorkShapes.get(t)}createWorkShape(t,e){if(t&&this.tmpOpt){const r={toolsType:this.tmpOpt.toolsType,toolsOpt:e||this.tmpOpt.toolsOpt},i=this.createWorkShapeNode({...r,workId:t});return i&&this.localWorkShapes.set(t,{node:i,toolsType:i.toolsType,workState:Tt.Start}),i}}setWorkOptions(t,e){var r;const i=(r=this.localWorkShapes.get(t))==null?void 0:r.node;i||this.createWorkShape(t,e),i?.setWorkOptions(e)}createWorkShapeNode(t){const{toolsType:e}=t;if(e===nt.LaserPen)return lh({...t,vNodes:this.vNodes,fullLayer:this.topLayer,drawLayer:this.topLayer})}clearAllWorkShapesCache(){this.localWorkShapes.forEach(t=>{var e;return(e=t.node)==null?void 0:e.clearTmpPoints()}),this.localWorkShapes.clear()}setToolsOpt(t){var e;this.tmpOpt=t,(e=t.toolsOpt)!=null&&e.syncUnitTime&&(this.syncUnitTime=t.toolsOpt.syncUnitTime)}getToolsOpt(){return this.tmpOpt}consumeDraw(t){const{workId:e,dataType:r}=t;if(r===kt.Service)this.activeServiceWorkShape(t);else{const i=e?.toString(),o=i&&this.localWorkShapes.get(i);if(!o)return;const s=o.node.consume({data:t,isFullWork:!1,isSubWorker:!0});s.rect&&(o.totalRect=oe(s.rect,o.totalRect),o.result=s,o.workState=Tt.Doing,i&&this.localWorkShapes.set(i,o))}this.runAnimation()}consumeDrawAll(t){const{workId:e,dataType:r}=t;if(r===kt.Service)this.activeServiceWorkShape(t);else{const i=e?.toString(),o=i&&this.localWorkShapes.get(i);if(!o)return;const s=o.node.consumeAll({data:t});o.totalRect=oe(s.rect,o.totalRect),o.result=s,o.workState=Tt.Done,i&&this.localWorkShapes.set(i,o)}this.runAnimation()}destroy(){this.serviceWorkShapes.clear(),this.localWorkShapes.clear()}setNodeKey(t,e,r,i){return e.toolsType=r,e.node=this.createWorkShapeNode({workId:t,toolsType:r,toolsOpt:i}),e}activeServiceWorkShape(t){var e,r;const{workId:i,opt:o,toolsType:s,type:a,updateNodeOpt:l,ops:u,op:p}=t;if(!i)return;const c=i.toString(),g=(e=this.vNodes.get(c))==null?void 0:e.rect;if(!((r=this.serviceWorkShapes)!=null&&r.has(c))){let I={toolsType:s,animationWorkData:p||[],animationIndex:0,type:a,updateNodeOpt:l,ops:u,oldRect:g};s&&o&&(I=this.setNodeKey(c,I,s,o)),this.serviceWorkShapes.set(c,I)}const v=this.serviceWorkShapes.get(c);a&&(v.type=a),u&&(v.animationWorkData=io(u),v.ops=u),l&&(v.updateNodeOpt=l),p&&(v.animationWorkData=p),v.node&&v.node.getWorkId()!==c&&v.node.setWorkId(c),g&&(v.oldRect=g),s&&o&&(v.toolsType!==s&&s&&o&&this.setNodeKey(c,v,s,o),v.node&&v.node.setWorkOptions(o))}computNextAnimationIndex(t,e){const r=Math.floor((t.animationWorkData||[]).slice(t.animationIndex).length*32/e/this.syncUnitTime)*e;return Math.min((t.animationIndex||0)+(r||e),(t.animationWorkData||[]).length)}async animationDraw(){var t,e,r,i;this.animationId=void 0;let o=!1;const s=new Map,a=[],l=[],u=[];for(const[p,c]of this.serviceWorkShapes.entries())switch(c.toolsType){case nt.LaserPen:{const g=this.computNextAnimationIndex(c,8),v=Math.max(0,c.animationIndex||0),I=(c.animationWorkData||[]).slice(v,g);if((c.animationIndex||0)<g){const w=(t=c.node)==null?void 0:t.consumeService({op:I,isFullWork:!1});c.totalRect=oe(c.totalRect,w),c.animationIndex=g,I.length&&s.set(p,{workState:v===0?Tt.Start:g===((e=c.animationWorkData)==null?void 0:e.length)?Tt.Done:Tt.Doing,op:I.slice(-2)})}if(l.push({isClear:!0,rect:c.totalRect,clearCanvas:de.TopFloat,viewId:this.viewId}),a.push({rect:c.totalRect,drawCanvas:de.TopFloat,viewId:this.viewId}),c.isDel){(r=c.node)==null||r.clearTmpPoints(),this.serviceWorkShapes.delete(p);break}c.ops&&c.animationIndex===((i=c.animationWorkData)==null?void 0:i.length)&&!c.isDel&&(this.topLayer.getElementsByName(p.toString())[0]||(c.isDel=!0,this.serviceWorkShapes.set(p,c))),o=!0;break}}for(const[p,c]of this.localWorkShapes.entries()){const{result:g,toolsType:v,totalRect:I,isDel:w,workState:y}=c;switch(v){case nt.LaserPen:{if(I&&(l.push({isClear:!0,rect:I,clearCanvas:de.TopFloat,viewId:this.viewId}),a.push({rect:I,drawCanvas:de.TopFloat,viewId:this.viewId})),w){c.node.clearTmpPoints(),this.localWorkShapes.delete(p),u.push({removeIds:[p.toString()],viewId:this.viewId,type:pt.RemoveNode});break}g&&((g.op||g.ops)&&u.push(g),c.result=void 0),!this.topLayer.getElementsByName(p.toString())[0]&&y===Tt.Done&&(c.isDel=!0,this.localWorkShapes.set(p,c)),o=!0;break}}}o&&this.runAnimation(),s.size&&s.forEach((p,c)=>{u.push({type:pt.Cursor,uid:c.split(gn)[0],op:p.op,workState:p.workState,viewId:this.viewId})}),(a.length||l.length||u.length)&&this.post({render:[...l,...a],sp:u})}runAnimation(){this.animationId||(this.animationId=setTimeout(()=>{this.animationId=void 0,this.animationDraw()},16))}}var Bu=(n=>(n.Full="full",n.Sub="sub",n))(Bu||{});class OD extends K2{constructor(t,e,r){super(t,e,"sub"),G(this,"type","sub"),G(this,"_post"),G(this,"topLayer"),G(this,"snapshotFullLayer"),G(this,"serviceWork"),G(this,"localWork"),G(this,"topLayerWork"),this._post=r;const i=me.bufferSize.sub;this.topLayer=this.createLayer("topLayer",this.scene,{...e.layerOpt,bufferSize:i,contextType:"2d"});const o={thread:this,viewId:this.viewId,vNodes:this.vNodes,fullLayer:this.fullLayer,topLayer:this.topLayer};this.localWork=new DD(o),this.topLayerWork=new LD(o),this.vNodes.init(this.fullLayer)}async combinePost(){var t,e;const{render:r,...i}=this.combinePostData();let o;if(r!=null&&r.length){const a=[];for(const l of r)if(l.rect){if(l.rect=VD(ze(l.rect),this.scene,this.dpr),!l.rect)continue;if(l.drawCanvas&&l.rect&&l.rect.w>0&&l.rect.h>0){const u=await this.getRectImageBitmap(l);l.imageBitmap=u,o||(o=[]),o.push(u)}a.push(l)}i.render=a}const s=(t=i.sp)==null?void 0:t.filter(a=>a.type!==pt.None||a.isLockSentEventCursor);s!=null&&s.length?i.sp=s.map(a=>({...a,viewId:this.viewId})):delete i.sp,i.consumeCount===void 0&&delete i.consumeCount,i.subWorkerDrawCount===void 0&&delete i.subWorkerDrawCount,(s!=null&&s.length||i.consumeCount||i.subWorkerDrawCount||(e=i?.render)!=null&&e.length)&&this._post(i,o),this.delayPostDoneResolve&&this.delayPostDoneResolve(!0)}getLayer(t,e){if(e&&this.snapshotFullLayer)return this.snapshotFullLayer;switch(t){case de.TopFloat:return this.topLayer;default:return this.fullLayer}}async on(t){const{msgType:e,toolsType:r,opt:i,dataType:o,workState:s,isLockSentEventCursor:a}=t;switch(e){case pt.UpdateTools:if(r&&this.topLayerWork.canUseTopLayer(r)&&i){const l={toolsType:r,toolsOpt:i};this.topLayerWork.setToolsOpt(l);return}break;case pt.CreateWork:this.createLocalWork(t);return;case pt.DrawWork:s===Tt.Done&&o===kt.Local?(await this.consumeDrawAll(o,t),r===nt.LaserPen&&a&&this.post({sp:[{type:pt.None,isLockSentEventCursor:a}]})):this.consumeDraw(o,t);return;case pt.RemoveNode:await this.removeNode(t);return;case pt.FullWork:r&&this.topLayerWork.canUseTopLayer(r)&&await this.consumeDrawAll(o,t);return;case pt.Snapshot:this.snapshotFullLayer=this.createLayer("snapshotFullLayer",this.scene,{...this.opt.layerOpt,bufferSize:this.viewId===ce?6e3:3e3,contextType:"2d"}),this.snapshotFullLayer&&(await this.getSnapshot(t),this.snapshotFullLayer=void 0);return;case pt.BoundingBox:this.snapshotFullLayer=this.createLayer("snapshotFullLayer",this.scene,{...this.opt.layerOpt,bufferSize:this.viewId===ce?6e3:3e3,contextType:"2d"}),this.snapshotFullLayer&&(await this.getBoundingRect(t),this.snapshotFullLayer=void 0);return}await super.on(t)}createLocalWork(t){const{workId:e,toolsType:r,opt:i}=t;if(r&&this.topLayerWork.canUseTopLayer(r)&&e&&i){this.topLayerWork.getToolsOpt()||this.topLayerWork.setToolsOpt({toolsType:r,toolsOpt:i}),this.topLayerWork.setWorkOptions(e.toString(),i);return}r&&this.localWork.canUseSubWorker(r)&&super.createLocalWork(t)}async removeNode(t){const{dataType:e}=t;e===kt.Local&&await this.localWork.removeWork(t)}getOffscreen(t,e){return this.getLayer(t,e).parent.canvas}async consumeDraw(t,e){const{workId:r,toolsType:i}=e;if(r){if(i&&this.topLayerWork.canUseTopLayer(i)){t===kt.Local&&(this.topLayerWork.getWorkShape(r.toString())||this.createLocalWork(e)),this.topLayerWork.consumeDraw(e);return}i&&this.localWork.canUseSubWorker(i)&&(this.localWork.getWorkShape(r.toString())||this.createLocalWork(e),await this.localWork.consumeDraw(e));return}}async consumeDrawAll(t,e){const{workId:r,toolsType:i,dataType:o}=e;if(r){const s=r.toString();if(i&&this.topLayerWork.canUseTopLayer(i)){o===kt.Local&&(this.topLayerWork.getWorkShape(s)||this.createLocalWork(e)),this.topLayerWork.consumeDrawAll(e);return}i&&this.localWork.canUseSubWorker(i)&&(this.localWork.getWorkShape(s)||super.createLocalWork(e),this.localWork.consumeDrawAll(e));return}}async clearAll(){this.vNodes.clear(),super.clearAll(),this.topLayer&&(this.topLayer.parent.children.forEach(t=>{t.name!=="viewport"&&t.remove()}),sn(this.topLayer,this.topLayer.parent)),await this.post({render:[{isClearAll:!0,clearCanvas:de.TopFloat,viewId:this.viewId}],sp:[{type:pt.Clear}]})}getRectImageBitmap(t,e=!1,r){const{rect:i,drawCanvas:o}=t,s=Math.floor(i.x*this.dpr),a=Math.floor(i.y*this.dpr),l=Math.floor(i.w*this.dpr||1),u=Math.floor(i.h*this.dpr||1);return createImageBitmap(this.getOffscreen(o,e),s,a,l,u,r)}updateLayer(t){const{width:e,height:r}=t;super.updateLayer(t),this.topLayer&&(this.topLayer.parent.setAttribute("width",e),this.topLayer.parent.setAttribute("height",r),this.topLayer.setAttribute("size",[e,r]),this.topLayer.setAttribute("pos",[e*.5,r*.5])),this.snapshotFullLayer&&(this.snapshotFullLayer.parent.setAttribute("width",e),this.snapshotFullLayer.parent.setAttribute("height",r),this.snapshotFullLayer.setAttribute("size",[e,r]),this.snapshotFullLayer.setAttribute("pos",[e*.5,r*.5]))}async updateDpr(t){super.updateDpr(t);const e=!!this.topLayerWork.localWorkShapes.size,r=!!this.localWork.getWorkShapes().size,i=[];r&&i.push({isClearAll:!0,clearCanvas:de.Float,viewId:this.viewId}),e&&i.push({isClearAll:!0,clearCanvas:de.TopFloat,viewId:this.viewId}),i.length&&await this.post({render:i})}async updateCamera(t){const e=[],{cameraOpt:r}=t;if(r&&!Pr(this.cameraOpt,r)){const i=!!this.topLayerWork.localWorkShapes.size,o=!!this.localWork.getWorkShapes().size;if(o&&this.localWork.workShapesDone(),this.setCameraOpt(r),o&&e.push({isClearAll:!0,clearCanvas:de.Float,viewId:this.viewId}),i){e.push({isClearAll:!0,clearCanvas:de.TopFloat,viewId:this.viewId});for(const[s,a]of this.topLayerWork.localWorkShapes.entries())if(a.totalRect){let l;this.topLayer.getElementsByName(s.toString()).forEach(u=>{const p=u.getBoundingClientRect(),c=$r({x:p.x,y:p.y,w:p.width,h:p.height});l=oe(l,c)}),a.totalRect=l,this.topLayerWork.localWorkShapes.set(s,a)}}e.length&&await this.post({render:e})}}setCameraOpt(t,e){this.cameraOpt=t;const{scale:r,centerX:i,centerY:o,width:s,height:a}=t;(s!==this.scene.width||a!==this.scene.height)&&this.updateScene({width:s,height:a}),e?(e.setAttribute("scale",[r,r]),e.setAttribute("translate",[-i,-o])):(this.fullLayer.setAttribute("scale",[r,r]),this.fullLayer.setAttribute("translate",[-i,-o]),this.topLayer.setAttribute("scale",[r,r]),this.topLayer.setAttribute("translate",[-i,-o]))}async getSnapshot(t){const{scenePath:e,scenes:r,cameraOpt:i,w:o,h:s}=t;if(e&&r&&i&&this.snapshotFullLayer){const a=ze(this.cameraOpt);this.setCameraOpt(i,this.snapshotFullLayer),this.localWork.fullLayer=this.snapshotFullLayer,this.localWork.drawLayer=void 0;let l;for(const[p,c]of Object.entries(r))if(c!=null&&c.type)switch(c?.type){case pt.UpdateNode:case pt.FullWork:{const{opt:g}=c,v={...c,opt:g,workId:p,msgType:pt.FullWork,dataType:kt.Service,viewId:this.viewId},I=await this.localWork.runFullWork(v);l=oe(l,I);break}}let u;o&&s&&(u={resizeWidth:o,resizeHeight:s}),await this.getSnapshotRender({scenePath:e,curCameraOpt:a,options:u}),this.localWork.fullLayer=this.fullLayer,this.localWork.drawLayer=void 0}}async getSnapshotRender(t){var e;const{scenePath:r,curCameraOpt:i,options:o}=t;((e=this.snapshotFullLayer)==null?void 0:e.parent).render();const s=await this.getRectImageBitmap({rect:this.getSceneRect(),drawCanvas:de.None},!0,o);s&&(this._post({sp:[{type:pt.Snapshot,scenePath:r,imageBitmap:s,viewId:this.viewId}]},[s]),s.close(),this.snapshotFullLayer&&sn(this.snapshotFullLayer,this.snapshotFullLayer.parent),this.setCameraOpt(i,this.fullLayer))}async getBoundingRect(t){const{scenePath:e,scenes:r,cameraOpt:i}=t;if(e&&r&&i&&this.snapshotFullLayer){const o=ze(this.cameraOpt);this.setCameraOpt(i,this.snapshotFullLayer),this.localWork.fullLayer=this.snapshotFullLayer,this.localWork.drawLayer=void 0;let s;for(const[a,l]of Object.entries(r))if(l!=null&&l.type)switch(l?.type){case pt.UpdateNode:case pt.FullWork:{const u=await this.localWork.runFullWork({...l,workId:a,msgType:pt.FullWork,dataType:kt.Service,viewId:this.viewId});s=oe(s,u);break}}s&&await this.post({sp:[{type:pt.BoundingBox,scenePath:e,rect:s}]}),this.localWork.fullLayer=this.fullLayer,this.localWork.drawLayer=void 0,sn(this.snapshotFullLayer,this.snapshotFullLayer.parent),this.setCameraOpt(o,this.fullLayer)}}}class Go extends jt{constructor(t){super(t),G(this,"canRotate",!0),G(this,"scaleType",ee.all),G(this,"toolsType",nt.Image),G(this,"tmpPoints",[]),G(this,"workOptions"),G(this,"oldRect"),this.workOptions=t.toolsOpt,this.scaleType=Go.getScaleType(this.workOptions)}consume(){return{type:pt.None}}consumeAll(){return{type:pt.None}}draw(t){const{layer:e,workId:r,replaceId:i,imageBitmap:o}=t,{centerX:s,centerY:a,width:l,height:u,rotate:p,zIndex:c,eraserlines:g}=this.workOptions,v=new Ze({anchor:[.5,.5],pos:[s,a],name:r,size:[l,u],zIndex:c,rotate:p}),I={anchor:[.5,.5],pos:[0,0],size:[l,u],texture:o};o||(I.bgcolor="rgba(0,0,0,0.3)");const w=new Ld(I);v.append(w),g&&this.drawEraserlines({group:v,eraserlines:g,pos:[s,a],layer:e}),this.replace(e,i||r,v);const y=v.getBoundingClientRect();if(y)return{x:Math.floor(y.x-jt.SafeBorderPadding),y:Math.floor(y.y-jt.SafeBorderPadding),w:Math.floor(y.width+jt.SafeBorderPadding*2),h:Math.floor(y.height+jt.SafeBorderPadding*2)}}consumeService(){}async consumeServiceAsync(t){var e,r,i,o;const{isFullWork:s,replaceId:a,worker:l}=t,{src:u,uuid:p}=this.workOptions,c=((e=this.workId)==null?void 0:e.toString())||p,g=s?this.fullLayer:this.drawLayer||this.fullLayer;if(u){const v=await l.loadImageBitMap({toolsType:this.toolsType,opt:this.workOptions,workId:c,isSubWorker:l instanceof OD});if(v){const I=this.draw({workId:c,layer:g,replaceId:a,imageBitmap:v});return this.oldRect=c&&((i=(r=this.vNodes)==null?void 0:r.get(c))==null?void 0:i.rect)||void 0,(o=this.vNodes)==null||o.setInfo(c,{rect:I,op:[],opt:this.workOptions,toolsType:this.toolsType,scaleType:this.scaleType,canRotate:this.canRotate,centerPos:I&&jt.getCenterPos(I,g)}),I}}}clearTmpPoints(){this.tmpPoints.length=0}static getScaleType(t){const{uniformScale:e,rotate:r}=t;return e!==!1||r&&Math.abs(r)%90>0?ee.proportional:ee.all}static updateNodeOpt(t){const{node:e,opt:r,vNodes:i,targetNode:o}=t,{translate:s,originPoint:a,scenePoint:l,scale:u,angle:p,isLocked:c,zIndex:g,strokeColor:v}=r,I=o&&ze(o)||i.get(e.name);if(!I)return;const w=e.parent;if(w){if(v&&(I.opt.strokeColor=v),tn(g)&&(e.setAttribute("zIndex",g),I.opt.zIndex=g),Ri(c)&&(I.opt.locked=c),a&&l&&u&&s){const{centerX:y,centerY:T,width:h,height:m,uniformScale:d}=I.opt,M=d!==!1?[u[0],u[0]]:u,x=[y,T],E=[y,T];ch(E,l,M,s);const P=[E[0]-x[0],E[1]-x[1]];if(I.centerPos=[I.centerPos[0]+P[0],I.centerPos[1]+P[1]],I.opt.width=Math.round(h*M[0]),I.opt.height=Math.round(m*M[1]),I.opt.centerX=E[0],I.opt.centerY=E[1],I.opt.eraserlines)for(const R of I.opt.eraserlines){const{op:N,thickness:b}=R;R.thickness=Math.round(b*Math.max(u[0],u[1]));for(let j=0;j<N.length;j++)hh(N[j],l,u,s)}}else if(s){if(I.opt.centerX=I.opt.centerX+s[0],I.opt.centerY=I.opt.centerY+s[1],I.centerPos=[I.centerPos[0]+s[0],I.centerPos[1]+s[1]],I.opt.eraserlines)for(const y of I.opt.eraserlines){const{op:T}=y;for(let h=0;h<T.length;h++){const m=T[h].map((d,M)=>M%2?d+s[1]:d+s[0]);y.op[h]=m}}}else if(tn(p))if(I.opt.rotate=p,I.scaleType=Go.getScaleType(I.opt),o){const y=Mv(I.rect,p);I.rect=y}else{const y=jt.getRectFromLayer(w,e.name);I.rect=y||I.rect}return I&&i.setInfo(e.name,I),I?.rect}}}function oe(n,t){if(n&&t){const e=Math.min(n.x,t.x),r=Math.min(n.y,t.y),i=Math.max(n.x+n.w,t.x+t.w),o=Math.max(n.y+n.h,t.y+t.h),s=i-e,a=o-r;return{x:e,y:r,w:s,h:a}}return t||n}function uh(n,t){if(n&&t){const e=Math.min(n.originX,t.originX),r=Math.min(n.originY,t.originY),i=Math.max(n.originX+n.width,t.originX+t.width),o=Math.max(n.originY+n.height,t.originY+t.height),s=i-e,a=o-r;return{originX:e,originY:r,width:s,height:a}}return t||n}function he(n,t=0){const e={x:0,y:0,w:0,h:0};let r=1/0,i=1/0,o=-1/0,s=-1/0;return n.forEach(a=>{const[l,u]=a.XY;r=Math.min(r,l-t),i=Math.min(i,u-t),o=Math.max(o,l+t),s=Math.max(s,u+t)}),e.x=r,e.y=i,e.w=o-r,e.h=s-i,e}function Wu(n,t){return!(n.x+n.w<t.x||n.x>t.x+t.w||n.y+n.h<t.y||n.y>t.y+t.h)}function $r(n,t=10){return{x:Math.floor(n.x-t),y:Math.floor(n.y-t),w:Math.ceil(n.w+t*2),h:Math.ceil(n.h+t*2)}}function $o(n,t){return{x:n.x+t[0],y:n.y+t[1],w:n.w,h:n.h}}function bD(n,t){const e=new ht(n.x,n.y),r=new ht(n.x+n.w,n.y),i=new ht(n.x+n.w,n.y+n.h),o=new ht(n.x,n.y+n.h),s=new ht(n.x+n.w/2,n.y+n.h/2),a=Math.PI*t/180,l=ht.RotWith(e,s,a),u=ht.RotWith(r,s,a),p=ht.RotWith(i,s,a),c=ht.RotWith(o,s,a);return[l,u,p,c]}function Mv(n,t){const e=bD(n,t);return he(e)}function Tv(n,t,e){const r=new ht(n.x,n.y),i=new ht(n.x+n.w,n.y),o=new ht(n.x+n.w,n.y+n.h),s=new ht(n.x,n.y+n.h),a=new ht(e[0],e[1]),l=new ht(t[0],t[1]),u=ht.ScaleWOrigin(r,l,a),p=ht.ScaleWOrigin(i,l,a),c=ht.ScaleWOrigin(o,l,a),g=ht.ScaleWOrigin(s,l,a);return he([u,p,c,g])}function RD(n,t,e){const r=new ht(t[0],t[1]);for(let i=0;i<n.length;i+=3){const o=new ht(n[i],n[i+1]),s=Math.PI*e/180,a=ht.RotWith(o,r,s);n[i]=a.x,n[i+1]=a.y}}function jD(n,t,e){const r=new ht(t[0],t[1]);for(let i=0;i<n.length;i+=2){const o=new ht(n[i],n[i+1]),s=Math.PI*e/180,a=ht.RotWith(o,r,s);n[i]=a.x,n[i+1]=a.y}}function ch(n,t,e,r=[0,0]){const i=new ht(t[0],t[1]);for(let o=0;o<n.length;o+=3){const s=new ht(n[o],n[o+1]),a=new ht(e[0],e[1]),l=ht.ScaleWOrigin(s,a,i);n[o]=l.x+r[0],n[o+1]=l.y+r[1]}}function hh(n,t,e,r=[0,0]){const i=new ht(t[0],t[1]);for(let o=0;o<n.length;o+=2){const s=new ht(n[o],n[o+1]),a=new ht(e[0],e[1]),l=ht.ScaleWOrigin(s,a,i);n[o]=l.x+r[0],n[o+1]=l.y+r[1]}}function zD(n,t){return n[0]>=t.x&&n[0]<=t.x+t.w&&n[1]>=t.y&&n[1]<=t.y+t.h}function Iv(n,t){const e=n<=t?1:n/t,r=t<=n?1:t/n;return[e,r]}function kD(n){for(const t of n)if(isNaN(t)||t===1/0||t===-1/0)return!1;return!0}function BD(n){return n!==Math.floor(n)}function WD(n){const t=n.toString();return t.indexOf(".")!==-1?t.split(".")[1].length:0}function UD(n,t){for(;t!==0;)[n,t]=[t,n%t];return n}const YD=n=>{if(n.tagName==="GROUP"){const t=Object.getOwnPropertySymbols(n).find(e=>e.toString()==="Symbol(sealed)");if(t&&n[t])return!0}return!1},mn=(n,t)=>{if(n.mesh&&n.mesh.texture&&n.name==="eraserTexture"){const e=n.mesh.texture.image;t.deleteTexture(e)}else if(n.tagName==="GROUP"&&n&&n.children)for(const e of n.children)mn(e,t)},sn=(n,t)=>{mn(n,t),n.removeAllChildren()},FD=(n,t,e)=>{const r=e.parent;if(t){const i=t.children;if(i){for(const o of i)if(mn(o,r),o.tagName==="GROUP")for(const s of o.children)mn(s,r)}}t.parent.replaceChild(n,t)},VD=(n,t,e)=>{if(n.w+n.x<=0||n.h+n.y<=0||n.w<=0||n.h<=0)return;const r=t.width,i=t.height,o={x:Math.floor(Math.max(0,n.x)),y:Math.floor(Math.max(0,n.y)),w:Math.floor(Math.min(r,n.w)),h:Math.floor(Math.min(i,n.h))};if(o.x+o.w>r&&(o.w=Math.floor(r-o.x)),o.y+o.h>i&&(o.h=Math.floor(i-o.y)),BD(e)){const s=WD(e),a=Math.pow(10,s),l=UD(a,e*a),u=o.x%l,p=o.x-u;p>=0?(o.x=p,o.w=o.w+u):(o.x=0,o.w=o.w+u-p);const c=o.y%l,g=o.y-c;g>=0?(o.y=g,o.h=o.h+c):(o.y=0,o.h=o.h+c-g)}return o};function wi(n){return`${Oa(n.x)},${Oa(n.y)} `}function Si(n,t){return`${Oa((n.x+t.x)/2)},${Oa((n.y+t.y)/2)} `}function Oa(n){return+n.toFixed(4)}const Gn=async(n,t,e=!1)=>{let r,i;return new Promise(function(o){if(e&&requestIdleCallback)requestIdleCallback(()=>{o(1)},{timeout:t});else{if(typeof window.requestIdleCallback=="function"){const s=typeof t=="number"&&!isNaN(t)&&t>0?t:0;i=window.requestIdleCallback(()=>{clearTimeout(r),o(1)},{timeout:s})}r=setTimeout(()=>{i&&window.cancelIdleCallback(i),o(1)},t||0)}}).then(function(){n()}).catch(function(){n()})},pr=n=>{const t=n?.webkitBackingStorePixelRatio||n?.mozBackingStorePixelRatio||n?.msBackingStorePixelRatio||n?.oBackingStorePixelRatio||n?.backingStorePixelRatio||1;return Math.max(1,(window.devicePixelRatio||1)/t)},wv=(n,t)=>n.x+n.w<t.x||n.x>t.x+t.w||n.y+n.h<t.y||n.y>t.y+t.h?si.outside:n.x>=t.x&&n.y>=t.y&&n.x+n.w<=t.x+t.w&&n.y+n.h<=t.y+t.h?si.inside:si.intersect;function XD(n){let t=0;for(let e=0;e<n.length;e++){const r=n.charCodeAt(e);r>=1&&r<=126||65376<=r&&r<=65439?t++:t+=2}return t}class GD{constructor(t,e){G(this,"plugin"),G(this,"uid"),G(this,"control"),this.control=t,this.plugin=e,this.uid=e.displayer.uid}getNamespaceData(){var t;return Ft.toJS((t=this.plugin)==null?void 0:t.attributes[this.namespace])||{}}getAuthSpaceData(){var t;return Ft.toJS((t=this.plugin)==null?void 0:t.attributes[this.authSpace])||{}}getUidFromKey(t){return t.split(gn).length===2&&t.split(gn)[0]||this.uid}isLocalId(t){return t.split(gn).length===1}getLocalId(t){return t.split(gn)[1]}isSelector(t){return this.getLocalId(t)===Xt}}const Qs=class sr extends GD{constructor(t,e,r){super(t,e),G(this,"authSpace"),G(this,"namespace"),G(this,"serviceStorage",{}),G(this,"storage",{}),G(this,"authStorage",{}),G(this,"stateDisposer"),G(this,"authDisposer"),G(this,"asyncClockState",!1),G(this,"limitNums",new Map),G(this,"syncInterval"),G(this,"limitComponents",Pt.debounce((i,o)=>{var s,a,l,u,p,c,g,v;const I=((a=(s=this.storage)==null?void 0:s[i])==null?void 0:a[o])&&Object.keys(this.storage[i][o]).length||0;if(I===0)return;let w=this.limitNums.get(`${i}/${o}`);if(!w){const y=this.getLimitNum(I);this.limitNums.set(`${i}/${o}`,y),w=y}if(w>0&&I>=w){const y=sr.componentsLimits.indexOf(w),T=y>=0&&y<sr.componentsLimits.length-1;if((p=(u=(l=this.control.room)==null?void 0:l.callbacks)==null?void 0:u.listeners)!=null&&p.map.onObjectsLimit&&((g=(c=this.control.room)==null?void 0:c.callbacks)==null||g.dispatch("onObjectsLimit",m=>m(w,T))),!T){this.control.room.logger.error(`exceeds the limit of ${w} components, current: ${I}`),(v=this.control.room)==null||v.disconnect().then(()=>{var m,d,M,x,E;(M=(d=(m=this.control.room)==null?void 0:m.callbacks)==null?void 0:d.listeners)!=null&&M.map.onKickedWithReason&&((E=(x=this.control.room)==null?void 0:x.callbacks)==null||E.dispatch("onKickedWithReason",P=>P("kickByAdmin")))});return}console.warn(`exceeds the limit of ${w} components, current: ${I}`);const h=T?sr.componentsLimits[y+1]:0;this.limitNums.set(`${i}/${o}`,h)}},2e3,{maxWait:5e3})),G(this,"clearLimitComponents",(i,o)=>{if(o)this.limitNums.delete(`${i}/${o}`);else for(const s of this.limitNums.keys())`${i}/`.indexOf(s)===0&&this.limitNums.delete(s)}),this.syncInterval=r,this.namespace=sr.namespace,this.authSpace=sr.authSpace,this.serviceStorage=this.getNamespaceData(),this.storage=Pt.cloneDeep(this.serviceStorage),this.authStorage=this.getAuthSpaceData(),this.getLimitNums()}getLimitNum(t){return t>=sr.componentsLimits[0]?sr.componentsLimits[1]:sr.componentsLimits[0]}getLimitNums(){for(const[t,e]of Object.entries(this.storage))if(t&&e){for(const[r,i]of Object.entries(e))if(r&&i){const o=this.getLimitNum(Object.keys(i).length);this.limitNums.set(`${t}/${r}`,o)}}}getViewIdBySecenPath(t){const e=this.getNamespaceData();for(const[r,i]of Object.entries(e))if(i){for(const o of Object.keys(i))if(o===t)return r}}getScenePathData(t){const e=this.getNamespaceData();for(const r of Object.values(e))if(r){for(const i of Object.keys(r))if(i===t)return Pt.cloneDeep(r[i])}}getStorageData(t,e){const r=this.getNamespaceData();return r&&r[t]&&Pt.cloneDeep(r[t][e])||void 0}hasSelector(t,e){const r=this.storage&&this.storage[t]&&this.storage[t][e];return!!(r&&Object.keys(r).find(i=>this.isOwn(i)&&this.getLocalId(i)===Xt))}hasIncludeSelector(t,e,r){for(const i of Object.keys(this.storage))if(!(e&&i!==e)){for(const o of Object.keys(this.storage[i]))if(!(r&&o!==r)){for(const s of Object.keys(this.storage[i][o]))if(this.getLocalId(s)===Xt){const a=this.storage[i][o][s],l=this.isLocalId(t)?this.transformKey(t):t;if(a&&a.selectIds&&a.selectIds.length&&a.selectIds.includes(l))return!0}}}return!1}addStorageStateListener(t){this.stateDisposer=Ft.autorun(async()=>{var e,r,i,o,s,a;const l=this.getNamespaceData(),{diffView:u,diffScenePath:p,diffData:c}=this.diffFunByView(this.serviceStorage,l);this.serviceStorage=l;const g={};if(Object.keys(u).length>0)for(const[v,I]of Object.entries(u))I&&!Pt.isEqual((e=this.storage)==null?void 0:e[v],I.newValue)&&(g.diffView||(g.diffView={}),g.diffView[v]=I,this.storage||(this.storage={}),I.newValue===void 0?delete this.storage[v]:this.storage[v]=Pt.cloneDeep(I.newValue));if(Object.keys(p).length>0){for(const[v,I]of Object.entries(p))if(I){const{viewId:w,newValue:y}=I;I&&!Pt.isEqual((i=(r=this.storage)==null?void 0:r[w])==null?void 0:i[v],y)&&(g.diffScenePath||(g.diffScenePath={}),g.diffScenePath[v]=I,this.storage||(this.storage={}),this.storage[w]||(this.storage[w]={}),I.newValue===void 0?delete this.storage[w][v]:this.storage[w][v]=Pt.cloneDeep(I.newValue))}}if(Object.keys(c).length>0){for(const[v,I]of Object.entries(c))if(I){const{viewId:w,scenePath:y,newValue:T}=I;I&&!Pt.isEqual((a=(s=(o=this.storage)==null?void 0:o[w])==null?void 0:s[y])==null?void 0:a[v],T)&&(g.diffData||(g.diffData={}),g.diffData[v]=I,this.storage||(this.storage={}),this.storage[w]||(this.storage[w]={}),this.storage[w][y]||(this.storage[w][y]={}),I.newValue===void 0?delete this.storage[w][y][v]:this.storage[w][y][v]=Pt.cloneDeep(I.newValue))}}Object.keys(g).length>0&&t(g)})}removeStorageStateListener(){this.stateDisposer&&this.stateDisposer()}diffFunByView(t,e){const r=Ye(t),i=Ye(e),o={},s={},a={};for(const l of i)if(!r.includes(l)||t[l]===void 0){o[l]={newValue:e[l],oldValue:void 0};continue}for(const l of r){if(Pt.isEqual(t[l],e[l]))continue;if(!i.includes(l)||e[l]===void 0){o[l]={newValue:void 0,oldValue:t[l]};continue}const u=this.diffFunByScenePath(t[l],e[l],l);Object.assign(s,u.diffScenePath),Object.assign(a,u.diffData)}return{diffData:a,diffScenePath:s,diffView:o}}diffFunByScenePath(t,e,r){const i=Ye(t),o=Ye(e),s={},a={};for(const l of o)if(!i.includes(l)||t[l]===void 0){s[l]={newValue:e[l],oldValue:void 0,viewId:r};continue}for(const l of i){if(Pt.isEqual(t[l],e[l]))continue;if(!o.includes(l)||e[l]===void 0){s[l]={newValue:void 0,oldValue:t[l],viewId:r};continue}const u=this.diffFunByKeys(t[l],e[l],l,r);Object.assign(a,u)}return{diffScenePath:s,diffData:a}}diffFunByKeys(t,e,r,i){const o=Ye(t),s=Ye(e),a={};for(const l of s)(!o.includes(l)||t[l]===void 0)&&(a[l]={oldValue:void 0,newValue:e[l],viewId:i,scenePath:r});for(const l of o)if(!Pt.isEqual(t[l],e[l])){if(!s.includes(l)||e[l]===void 0){a[l]={newValue:void 0,oldValue:t[l],viewId:i,scenePath:r};continue}s.includes(l)&&(a[l]={oldValue:t[l],newValue:e[l],viewId:i,scenePath:r})}return a}transformKey(t){return this.uid+gn+t}isOwn(t){return t.split(gn)[0]===this.uid}dispatch(t){const{type:e,workId:r,ops:i,index:o,opt:s,toolsType:a,removeIds:l,updateNodeOpt:u,op:p,selectIds:c,isSync:g,scenePath:v,viewId:I}=t;if(I)switch(e){case pt.Clear:const w={};v&&this.storage[I]&&this.storage[I][v]?(delete this.storage[I][v],this.setState(w,{isSync:g,viewId:I,scenePath:v})):this.storage[I]&&(delete this.storage[I],this.setState(w,{isSync:g,viewId:I,scenePath:""})),Gn(()=>{var d;this.control.pluginManager.dispatchPluginEvent("syncStorage",I,v),(d=this.control.miniMapManager)==null||d.updateMiniMapCamera(I),this.clearLimitComponents(I,v)},this.syncInterval,this.control.hasPolyfillMethod("requestIdleCallback"));break;case pt.CreateWork:if(v&&r&&a&&s){const d=this.isLocalId(r.toString())?this.transformKey(r):r;this.control.renderControl.isUsePageAuth(I)&&this.control.renderControl.addRenderPageElementId({viewId:I,scenePath:v,elementId:d.toString()}),this.updateValue(d.toString(),{type:pt.CreateWork,workId:r,toolsType:a,opt:s},{isSync:g,viewId:I,scenePath:v})}break;case pt.DrawWork:if(v&&r&&typeof o=="number"&&p!=null&&p.length){const d=this.isLocalId(r.toString())?this.transformKey(r):r,M=this.storage[I]&&this.storage[I][v]&&this.storage[I][v][d]||void 0;if(M!=null&&M.ops||M?.type===pt.FullWork)return;const x=o?(M?.op||[]).slice(0,o).concat(p):p||M?.op,E=a||M?.toolsType,P=s||M?.opt,R=u||M?.updateNodeOpt;r&&E&&P&&x&&(this.control.renderControl.isUsePageAuth(I)&&this.control.renderControl.addRenderPageElementId({viewId:I,scenePath:v,elementId:d.toString()}),this.updateValue(d.toString(),{...M,type:pt.DrawWork,workId:r,updateNodeOpt:R,toolsType:E,opt:P,op:x,index:o},{isSync:g,viewId:I,scenePath:v}))}break;case pt.FullWork:if(v&&r){const d=this.isLocalId(r.toString())?this.transformKey(r):r,M=this.storage[I]&&this.storage[I][v]&&this.storage[I][v][d]||void 0,x=u||M?.updateNodeOpt,E=a||M?.toolsType,P=s||M?.opt,R=i||M?.ops;E&&P&&(this.control.renderControl.isUsePageAuth(I)&&this.control.renderControl.addRenderPageElementId({viewId:I,scenePath:v,elementId:d.toString()}),this.updateValue(d.toString(),{type:pt.FullWork,updateNodeOpt:x,workId:d,toolsType:E,opt:P,ops:R},{isSync:g,viewId:I,scenePath:v}),Gn(()=>{var N;this.control.pluginManager.dispatchPluginEvent("syncStorage",I,v),(N=this.control.miniMapManager)==null||N.updateMiniMapCamera(I),this.limitComponents(I,v)},this.syncInterval,this.control.hasPolyfillMethod("requestIdleCallback")))}break;case pt.RemoveNode:if(v&&l!=null&&l.length){const d=l.map(M=>this.isLocalId(M+"")?this.transformKey(M):M);this.storage[I]&&this.storage[I][v]&&(Object.keys(this.storage[I][v]).map(M=>{d!=null&&d.includes(M)&&(this.control.renderControl.isUsePageAuth(I)&&this.control.renderControl.delRenderPageElementId({viewId:I,scenePath:v,elementId:M}),this.updateValue(M,void 0,{isSync:g,viewId:I,scenePath:v}))}),Gn(()=>{var M;this.control.pluginManager.dispatchPluginEvent("syncStorage",I,v),(M=this.control.miniMapManager)==null||M.updateMiniMapCamera(I)},this.syncInterval,this.control.hasPolyfillMethod("requestIdleCallback")))}break;case pt.UpdateNode:if(v&&r&&(u||i||s)){const d=this.isLocalId(r.toString())?this.transformKey(r):r,M=this.storage[I]&&this.storage[I][v]&&this.storage[I][v][d]||void 0;M&&(M.updateNodeOpt=u,(i||p)&&(M.ops=i,M.op=p),s&&(M.opt=s),M.type=pt.FullWork,this.updateValue(d.toString(),M,{isSync:g,viewId:I,scenePath:v}),Gn(()=>{var x;(x=this.control.miniMapManager)==null||x.updateMiniMapCamera(I)},this.syncInterval,this.control.hasPolyfillMethod("requestIdleCallback")))}break;case pt.Select:if(!v)return;let y;c!=null&&c.length&&(y=c.map(d=>this.isLocalId(d+"")?this.transformKey(d):d));const T=this.transformKey(Xt),h=this.storage[I]&&this.storage[I][v]&&this.storage[I][v][T]||void 0,m=s||h?.opt;y&&this.checkOtherSelector(T,y,{isSync:g,viewId:I,scenePath:v}),this.updateValue(T,y&&{type:pt.Select,toolsType:nt.Selector,opt:m,selectIds:y},{isSync:g,viewId:I,scenePath:v});break}}checkOtherSelector(t,e,r){const{viewId:i,scenePath:o}=r;for(const s of Object.keys(this.storage[i][o]))if(s!==t&&this.getLocalId(s)===Xt){const a=this.storage[i][o][s];if(a&&a.selectIds){const l=a.selectIds.filter(u=>!e.includes(u));l.length>0&&(a.selectIds=l),this.updateValue(s,l.length&&a||void 0,r)}}}setState(t,e){const{viewId:r,scenePath:i}=e,o=Ye(t);for(let s=0;s<o.length;s++){const a=o[s],l=t[a];typeof l<"u"?(this.storage[r]||(this.storage[r]={}),this.storage[r][i]||(this.storage[r][i]={}),this.storage[r][i][a]=l):delete this.storage[r][i][a]}this.runSyncService(e)}updateValue(t,e,r){const{viewId:i,scenePath:o,storage:s}=r,a=s||this.storage;e===void 0?delete a[i][o][t]:(a[i]||(a[i]={}),a[i][o]||(a[i][o]={}),a[i][o][t]=e),this.runSyncService(r)}runSyncService(t){if(!this.control.renderControl.isWritable){console.warn("The current state is not writable and synchronization cannot be synchronized");return}this.asyncClockState||(this.asyncClockState=!0,t.isSync?(this.asyncClockState=!1,this.syncSerivice(t)):Gn(()=>{this.asyncClockState=!1,this.syncSerivice(t)},this.syncInterval,this.control.hasPolyfillMethod("requestIdleCallback")))}syncSerivice(t={storage:this.storage}){const{storage:e}=t,r=e||this.storage,i=Ye(this.serviceStorage),o=Ye(r),s=new Map;for(const a of i){if(!o.includes(a)){s.set(a,void 0);continue}Pt.isEqual(this.serviceStorage[a],r[a])||this.syncViewData(r,a)}for(const a of o)i.includes(a)||s.set(a,r[a]);if(s.size>5)this.syncStorageView(r);else for(const[a,l]of s.entries())this.syncUpdataView(r,a,l)}syncViewData(t,e){const r=Ye(this.serviceStorage[e]),i=Ye(t[e]),o=new Map;for(const s of r){if(!i.includes(s)){o.set(s,void 0);continue}Pt.isEqual(this.serviceStorage[e][s],t[e][s])||this.syncScenePathData(t,e,s)}for(const s of i)r.includes(s)||o.set(s,t[e][s]);if(o.size>5)this.syncStorageScenePath(e,t[e]);else for(const[s,a]of o.entries())this.syncUpdataScenePath(t,e,s,a)}syncScenePathData(t,e,r){const i=Ye(this.serviceStorage[e][r]),o=Ye(t[e][r]),s=new Map;for(const a of i){if(!o.includes(a)){s.set(a,void 0);continue}Pt.isEqual(this.serviceStorage[e][r][a],t[e][r][a])||s.set(a,t[e][r][a])}for(const a of o)i.includes(a)||s.set(a,t[e][r][a]);if(s.size>5)this.syncStorageKey(e,r,t[e][r]);else for(const[a,l]of s.entries())this.syncUpdataKey(t,e,r,a,l)}syncUpdataView(t,e,r){var i;Object.keys(this.serviceStorage).length?(i=this.plugin)==null||i.updateAttributes([this.namespace,e],r):this.syncStorageView(t)}syncStorageView(t){var e;(e=this.plugin)==null||e.updateAttributes([this.namespace],t)}syncUpdataScenePath(t,e,r,i){var o;Object.keys(this.serviceStorage[e]).length?(o=this.plugin)==null||o.updateAttributes([this.namespace,e,r],i):this.syncStorageScenePath(e,t[e])}syncStorageScenePath(t,e){var r;(r=this.plugin)==null||r.updateAttributes([this.namespace,t],e)}syncUpdataKey(t,e,r,i,o){var s;Object.keys(this.serviceStorage[e][r]).length?(s=this.plugin)==null||s.updateAttributes([this.namespace,e,r,i],o):this.syncStorageKey(e,r,t[e][r])}syncStorageKey(t,e,r){var i;(i=this.plugin)==null||i.updateAttributes([this.namespace,t,e],r)}keyTransformWorkId(t){const e=t.split(gn);return e.length===2?e[1]:t}destroy(){this.removeStorageStateListener(),this.serviceStorage={},this.storage={},this.removeAuthStateListener(),this.authStorage={}}dispatchPageAuth(t,e=!0){var r,i,o,s,a,l,u,p,c,g,v,I,w,y,T,h,m,d,M,x,E,P,R,N,b,j,O,L,k,H,Q,_,st,F,Z,tt,ct,at;const{operation:dt,viewId:it,scenePath:ft,pageId:wt,pageData:U}=t;switch(dt){case Ve.addPage:{if(!it||!ft||!wt)return;const Y=[this.authSpace];Object.keys(this.authStorage).length&&Y.push("pageAuth");const K=this.authStorage.pageAuth||{};this.authStorage.pageAuth=K,Object.keys(K).length&&Y.push(it),K[it]=K[it]||{},Object.keys(K[it]).length&&Y.push(ft),K[it][ft]=K[it][ft]||{render:U?.render||"localSelf",pages:{}},Object.keys(K[it][ft].pages).length&&Y.push("pages",wt);const et={};if(U!=null&&U.elementIds)for(const W of U.elementIds.keys())et[W]=!0;K[it][ft].pages[wt]=et,e&&(Y.length===1?(r=this.plugin)==null||r.updateAttributes(Y,Pt.cloneDeep(this.authStorage)):Y.length===2?(i=this.plugin)==null||i.updateAttributes(Y,Pt.cloneDeep(K)):Y.length===3?(o=this.plugin)==null||o.updateAttributes(Y,Pt.cloneDeep(K[it])):Y.length===4?(s=this.plugin)==null||s.updateAttributes(Y,Pt.cloneDeep(K[it][ft])):(a=this.plugin)==null||a.updateAttributes(Y,Pt.cloneDeep(et)));return}case Ve.renderPage:{if(!it||!ft||!(U!=null&&U.render))return;this.authStorage.pageAuth&&this.authStorage.pageAuth[it]&&this.authStorage.pageAuth[it][ft]&&U.render!==this.authStorage.pageAuth[it][ft].render&&(this.authStorage.pageAuth[it][ft].render=U.render,e&&((l=this.plugin)==null||l.updateAttributes([this.authSpace,"pageAuth",it,ft,"render"],U.render)));return}case Ve.deletePage:{if(!it||!ft||!wt)return;(v=(g=(c=(p=(u=this.authStorage)==null?void 0:u.pageAuth)==null?void 0:p[it])==null?void 0:c[ft])==null?void 0:g.pages)!=null&&v[wt]&&(delete this.authStorage.pageAuth[it][ft].pages[wt],e&&((I=this.plugin)==null||I.updateAttributes([this.authSpace,"pageAuth",it,ft,"pages",wt],void 0)));return}case Ve.clearPage:{if(!it||!ft||!wt)return;(m=(h=(T=(y=(w=this.authStorage)==null?void 0:w.pageAuth)==null?void 0:y[it])==null?void 0:T[ft])==null?void 0:h.pages)!=null&&m[wt]&&(delete this.authStorage.pageAuth[it][ft].pages[wt],e&&((d=this.plugin)==null||d.updateAttributes([this.authSpace,"pageAuth",it,ft,"pages",wt],{})));return}case Ve.addElement:{if(!it||!ft||!wt||!(U!=null&&U.elementId))return;(R=(P=(E=(x=(M=this.authStorage)==null?void 0:M.pageAuth)==null?void 0:x[it])==null?void 0:E[ft])==null?void 0:P.pages)!=null&&R[wt]&&(this.authStorage.pageAuth[it][ft].pages[wt][U.elementId]=!0,e&&((N=this.plugin)==null||N.updateAttributes([this.authSpace,"pageAuth",it,ft,"pages",wt,U.elementId],!0)));return}case Ve.deleteElement:{if(!it||!ft||!wt||!(U!=null&&U.elementId))return;(H=(k=(L=(O=(j=(b=this.authStorage)==null?void 0:b.pageAuth)==null?void 0:j[it])==null?void 0:O[ft])==null?void 0:L.pages)==null?void 0:k[wt])!=null&&H[U.elementId]&&(delete this.authStorage.pageAuth[it][ft].pages[wt][U.elementId],e&&((Q=this.plugin)==null||Q.updateAttributes([this.authSpace,"pageAuth",it,ft,"pages",wt,U.elementId],void 0)));return}case Ve.clearViewScenePath:{if(!it||!ft)return;(F=(st=(_=this.authStorage)==null?void 0:_.pageAuth)==null?void 0:st[it])!=null&&F[ft]&&(delete this.authStorage.pageAuth[it][ft],e&&((Z=this.plugin)==null||Z.updateAttributes([this.authSpace,"pageAuth",it,ft],void 0)));return}case Ve.clearView:{if(!it)return;(ct=(tt=this.authStorage)==null?void 0:tt.pageAuth)!=null&&ct[it]&&(delete this.authStorage.pageAuth[it],e&&((at=this.plugin)==null||at.updateAttributes([this.authSpace,"pageAuth",it],void 0)));return}}}dispatchRenderAuth(t,e=!0){var r,i,o,s,a,l,u,p,c,g,v,I,w,y,T,h,m,d,M,x;const{operation:E,viewId:P,uid:R,renderData:N,isClear:b}=t;if(P)switch(E){case Rn.setAuth:{if(!N||N.render===void 0&&N.hide===void 0&&N.clear===void 0){this.authStorage.renderAuth&&this.authStorage.renderAuth[P]&&(delete this.authStorage.renderAuth[P],e&&((r=this.plugin)==null||r.updateAttributes([this.authSpace,"renderAuth",P],void 0)));return}const j=[this.authSpace];Object.keys(this.authStorage).length&&j.push("renderAuth");const O=this.authStorage.renderAuth||{};Object.keys(O).length&&j.push(P),O[P]={},this.authStorage.renderAuth=O;const{render:L,hide:k,clear:H}=N;if(L===!0)O[P].render=!0;else if(Pt.isSet(L)){O[P].render={};for(const Q of L.keys())O[P].render[Q]=!0}if(k===!0)O[P].hide=!0;else if(Pt.isSet(k)){O[P].hide={};for(const Q of k.keys())O[P].hide[Q]=!0}if(H===!0)O[P].clear=!0;else if(Pt.isSet(H)){O[P].clear={};for(const Q of H.keys())O[P].clear[Q]=!0}e&&(j.length===1?(i=this.plugin)==null||i.updateAttributes(j,Pt.cloneDeep(this.authStorage)):j.length===2?(o=this.plugin)==null||o.updateAttributes(j,Pt.cloneDeep(O)):(s=this.plugin)==null||s.updateAttributes(j,Pt.cloneDeep(O[P])));return}case Rn.setShow:{if(!R)return;const j=[this.authSpace];Object.keys(this.authStorage).length&&j.push("renderAuth");const O=this.authStorage.renderAuth||{};Object.keys(O).length&&j.push(P),O[P]=O[P]||{},this.authStorage.renderAuth=O,Object.keys(O[P]).length&&j.push("render"),O[P].render=O[P].render||{},O[P].render!==!0&&(Object.keys(O[P].render).length&&j.push(R),O[P].render[R]=!0),O[P].hide!==!0&&(a=O[P].hide)!=null&&a[R]&&(delete O[P].hide[R],e&&((l=this.plugin)==null||l.updateAttributes([this.authSpace,"renderAuth",P,"hide",R],void 0))),e&&(j.length===1?(u=this.plugin)==null||u.updateAttributes(j,Pt.cloneDeep(this.authStorage)):j.length===2?(p=this.plugin)==null||p.updateAttributes(j,Pt.cloneDeep(O)):j.length===3?(c=this.plugin)==null||c.updateAttributes(j,Pt.cloneDeep(O[P])):(g=this.plugin)==null||g.updateAttributes(j,!0));return}case Rn.setHide:{if(!R)return;const j=[this.authSpace];Object.keys(this.authStorage).length&&j.push("renderAuth");const O=this.authStorage.renderAuth||{};Object.keys(O).length&&j.push(P),O[P]=O[P]||{},this.authStorage.renderAuth=O,Object.keys(O[P]).length&&j.push("hide"),O[P].hide=O[P].hide||{},O[P].hide!==!0&&(Object.keys(O[P].hide).length&&j.push(R),O[P].hide[R]=!0),O[P].render!==!0&&(v=O[P].render)!=null&&v[R]&&(delete O[P].render[R],e&&((I=this.plugin)==null||I.updateAttributes([this.authSpace,"renderAuth",P,"render",R],void 0))),e&&(j.length===1?(w=this.plugin)==null||w.updateAttributes(j,Pt.cloneDeep(this.authStorage)):j.length===2?(y=this.plugin)==null||y.updateAttributes(j,Pt.cloneDeep(O)):j.length===3?(T=this.plugin)==null||T.updateAttributes(j,Pt.cloneDeep(O[P])):(h=this.plugin)==null||h.updateAttributes(j,!0));return}case Rn.setClear:{if(!R)return;const j=[this.authSpace];Object.keys(this.authStorage).length&&j.push("renderAuth");const O=this.authStorage.renderAuth||{};Object.keys(O).length&&j.push(P),O[P]=O[P]||{},this.authStorage.renderAuth=O,Object.keys(O[P]).length&&j.push("clear"),O[P].clear=O[P].clear||{},O[P].clear!==!0&&(Object.keys(O[P].clear).length&&j.push(R),b?O[P].clear[R]=!0:delete O[P].clear[R]),e&&(j.length===1?(m=this.plugin)==null||m.updateAttributes(j,Pt.cloneDeep(this.authStorage)):j.length===2?(d=this.plugin)==null||d.updateAttributes(j,Pt.cloneDeep(O)):j.length===3?(M=this.plugin)==null||M.updateAttributes(j,Pt.cloneDeep(O[P])):(x=this.plugin)==null||x.updateAttributes(j,b?!0:void 0));return}}}addAuthStateListener(t){this.authDisposer=Ft.autorun(async()=>{const e=this.getAuthSpaceData(),{renderAuth:r,pageAuth:i}=e;let o,s;Pt.isEqual(r,this.authStorage.renderAuth)||(o=this.diffAuthFun(this.authStorage.renderAuth||{},r||{}),this.authStorage.renderAuth=r),Pt.isEqual(i,this.authStorage.pageAuth)||(s=this.diffAuthPageFun(this.authStorage.pageAuth||{},i||{}),this.authStorage.pageAuth=i),(o||s)&&t(o,s)})}removeAuthStateListener(){this.authDisposer&&this.authDisposer()}diffAuthFun(t,e){const r=Ye(t),i=Ye(e),o={};for(const s of i)if(!r.includes(s)||t[s]===void 0){o[s]={newValue:e[s],oldValue:void 0};continue}for(const s of r)if(!Pt.isEqual(t[s],e[s])){if(!i.includes(s)||e[s]===void 0){o[s]={newValue:void 0,oldValue:t[s]};continue}o[s]={newValue:e[s],oldValue:t[s]}}return o}diffAuthPageFun(t,e){const r=Ye(t),i=Ye(e),o={};for(const s of i)if(!r.includes(s)||t[s]===void 0){o[s]={newValue:e[s],oldValue:void 0};continue}for(const s of r)if(!Pt.isEqual(t[s],e[s])){if(!i.includes(s)||e[s]===void 0){o[s]={newValue:void 0,oldValue:t[s]};continue}o[s]={newValue:e[s],oldValue:t[s]}}return o}};G(Qs,"namespace","PluginState"),G(Qs,"authSpace","PluginAuth"),G(Qs,"componentsLimits",[500,1e3]);let $D=Qs;class HD{constructor(){G(this,"roomMembers",[]),G(this,"onChangeHooks",new Set)}setRoomMembers(t){this.executChangeUidHook(this.roomMembers,t),this.roomMembers=t}executChangeUidHook(t,e){const r={online:e.map(i=>{var o;return((o=i.payload)==null?void 0:o.uid)||i.session}),offline:t.map(i=>{var o;return((o=i.payload)==null?void 0:o.uid)||i.session})};this.onChangeHooks.forEach(i=>i(r))}getAllRoomMembers(){return this.roomMembers}getRoomMember(t){return this.roomMembers.find(e=>{var r;return((r=e.payload)==null?void 0:r.uid)===t})}isOnLine(t){return!!this.getRoomMember(t)}onUidChangeHook(t){this.onChangeHooks.add(t)}destroy(){this.onChangeHooks.clear()}}var jn=(n=>(n[n.Text=1]="Text",n[n.Shape=2]="Shape",n))(jn||{});const Fn=class Zs{createProxy(t){const e=new Proxy(t,{get(r,i,o){const s=Zs.interceptors.hasOwnProperty(i)?Zs.interceptors:r;return Reflect.get(s,i,o)}});return Zs.proxyToRaw.set(e,t),e}};G(Fn,"proxyToRaw",new WeakMap),G(Fn,"interceptors",{entries(...n){return Fn.proxyToRaw.get(this).entries(...n)},forEach(...n){return Fn.proxyToRaw.get(this).forEach(...n)},size(){return Fn.proxyToRaw.get(this).size},get(n){return Fn.proxyToRaw.get(this).get(n)},set(n,t){return Fn.proxyToRaw.get(this).set(n,t)},delete(n){return Fn.proxyToRaw.get(this).delete(n)},clear(){return Fn.proxyToRaw.get(this).clear()}});let vo=Fn;class QD{constructor(t){G(this,"internalMsgEmitter"),G(this,"publicMsgEmitter"),G(this,"control"),G(this,"editors"),G(this,"activeId"),G(this,"proxyMap"),G(this,"taskqueue",new Map);const{control:e,internalMsgEmitter:r,publicMsgEmitter:i}=t;this.control=e,this.internalMsgEmitter=r,this.publicMsgEmitter=i;const o=new Map;this.proxyMap=new vo;const s=this,a=vo.interceptors.set;vo.interceptors.set=function(u,p){return s.interceptors.set(u,p),a.call(this,u,p)};const l=vo.interceptors.delete;vo.interceptors.delete=function(u){return s.interceptors.delete(u),l.call(this,u)},this.editors=this.proxyMap.createProxy(o)}get collector(){return this.control.collector}filterEditor(t){const e=new Map;return this.editors.forEach((r,i)=>{r.viewId===t&&e.set(i,r)}),e}get interceptors(){return{set:(t,e)=>{var r,i,o,s,a,l,u,p;if(!this.collector)return!0;const{viewId:c,scenePath:g,canSync:v,canWorker:I,type:w,opt:y,dataType:T,updateNodeOpt:h}=e;if(!I&&!v)return!0;const m=(r=this.collector)!=null&&r.isLocalId(t)?(i=this.collector)==null?void 0:i.transformKey(t):t,d=((o=this.collector)==null?void 0:o.storage[c])&&this.collector.storage[c][g]&&this.collector.storage[c][g][m]||void 0;d?d.toolsType===nt.Text&&(I&&(this.control.worker.queryTaskBatchData({workId:t,msgType:pt.UpdateNode}).forEach(M=>{var x;(x=this.control.worker)==null||x.taskBatchData.delete(M)}),(u=this.control.worker)==null||u.taskBatchData.add({workId:t,msgType:pt.UpdateNode,dataType:T||kt.Local,toolsType:nt.Text,opt:y,viewId:c,scenePath:g,willRefresh:!0}),(p=this.control.worker)==null||p.runAnimation()),v&&(Gn(()=>{var M;(M=this.collector)==null||M.dispatch({type:pt.UpdateNode,workId:t,toolsType:nt.Text,opt:y,viewId:c,scenePath:g,updateNodeOpt:h})},this.control.worker.maxLastSyncTime,this.control.hasPolyfillMethod("requestIdleCallback")),y.workState===Tt.Done&&this.control.runEffectWork(()=>{this.control.worker.setShapeSelectorByWorkId(t,c)}))):w===jn.Text&&(v&&((s=this.collector)==null||s.dispatch({type:y.text&&pt.FullWork||pt.CreateWork,workId:t,toolsType:nt.Text,opt:y,isSync:!0,viewId:c,scenePath:g,updateNodeOpt:h})),I&&((a=this.control.worker)==null||a.taskBatchData.add({workId:t,msgType:y.text&&pt.FullWork||pt.CreateWork,dataType:T||kt.Local,toolsType:nt.Text,opt:y,viewId:c,scenePath:g,willRefresh:!0}),(l=this.control.worker)==null||l.runAnimation()))},delete:t=>{var e,r;if(!this.collector)return!0;const i=this.editors.get(t);if(!i)return!0;const{viewId:o,scenePath:s,canSync:a,canWorker:l}=i;if(!l&&!a)return!0;l&&((e=this.control.worker)==null||e.taskBatchData.add({workId:t,toolsType:nt.Text,msgType:pt.RemoveNode,dataType:kt.Local,viewId:o,scenePath:s,willRefresh:!0}),(r=this.control.worker)==null||r.runAnimation()),a&&Gn(()=>{var u;(u=this.collector)==null||u.dispatch({type:pt.RemoveNode,removeIds:[t],toolsType:nt.Text,viewId:o,scenePath:s})},this.control.worker.maxLastSyncTime,this.control.hasPolyfillMethod("requestIdleCallback"))},clear(){return!0}}}computeTextActive(t,e){var r,i,o,s;const a=(r=this.control.viewContainerManager)==null?void 0:r.transformToScenePoint(t,e),l=(i=this.control.viewContainerManager)==null?void 0:i.getCurScenePath(e);e&&l&&((o=this.control.worker)==null||o.taskBatchData.add({msgType:pt.GetTextActive,dataType:kt.Local,op:a,viewId:e,scenePath:l}),(s=this.control.worker)==null||s.runAnimation())}checkEmptyTextBlur(){var t;let e=this.activeId;for(const[r,i]of this.editors.entries())if(i.opt.uid&&i.opt.uid===((t=this.collector)==null?void 0:t.uid)){e=r;break}if(e){const r=this.editors.get(e);r?.opt.text&&r?.opt.text.replace(/\s*,/g,"")?this.unActive(e):this.delete(e,!0,!0)}}onCameraChange(t,e){var r,i;for(const[o,s]of this.editors.entries())if(s.viewId===e){const{boxPoint:a,boxSize:l}=s.opt,u=a&&((r=this.control.viewContainerManager)==null?void 0:r.transformToOriginPoint(a,s.viewId)),p=(i=this.control.viewContainerManager)==null?void 0:i.getCurScenePath(e);if(p&&e){const c={x:u&&u[0]||0,y:u&&u[1]||0,w:l&&l[0]||0,h:l&&l[1]||0,opt:s.opt,scale:t.scale,type:jn.Text,viewId:e,scenePath:p,canWorker:!1,canSync:!1};this.editors.set(o,c),this.control.viewContainerManager.updateTextEditorInfo(e,this.activeId)}}}onServiceDerive(t){var e,r,i;const{workId:o,opt:s,msgType:a,viewId:l,scenePath:u,dataType:p,updateNodeOpt:c}=t;if(!o||!l||!u)return;const g=o.toString();if(a===pt.RemoveNode){this.delete(g,!0,!0);return}const{boxPoint:v,boxSize:I}=s,w=v&&((e=this.control.viewContainerManager)==null?void 0:e.transformToOriginPoint(v,l)),y=this.control.viewContainerManager.getView(l),T={x:w&&w[0]||0,y:w&&w[1]||0,w:I&&I[0]||0,h:I&&I[1]||0,opt:s,type:jn.Text,canWorker:!0,canSync:!1,dataType:p,scale:((r=y?.cameraOpt)==null?void 0:r.scale)||1,viewId:l,scenePath:u};if(s&&s.workState===Tt.Done&&!this.control.cursor.isEnableCursor&&v&&I){let h=c?.uid;if(!h){const m=this.editors.get(g);h=m&&((i=m.opt)==null?void 0:i.uid)}h&&this.control.cursor.collectServiceCursor({op:v&&[v[0]+I[0],v[1]+I[1]],uid:h,workState:Tt.Done,viewId:l,type:pt.Cursor})}this.editors.set(g,T),p===kt.Service&&s.workState===Tt.Done&&this.activeId===g&&(this.activeId=void 0),this.control.viewContainerManager.updateTextEditorInfo(l,this.activeId)}updateForViewEdited(t,e){var r;this.editors.set(t,e);const i=(r=this.taskqueue.get(t))==null?void 0:r.resolve;i&&i(e)}active(t){var e;const r=this.editors.get(t);r&&r.viewId&&(r.opt.workState=Tt.Start,r.opt.uid=(e=this.collector)==null?void 0:e.uid,this.activeId=t,r.canWorker=!0,r.canSync=!0,this.editors.set(t,r),this.control.viewContainerManager.updateTextEditorInfo(r.viewId,this.activeId))}unActive(t){const e=this.editors.get(t);e&&e.viewId&&(e.opt.workState=Tt.Done,e.opt.uid=void 0,e.canWorker=!0,e.canSync=!0,this.editors.set(t,e),this.activeId=void 0,this.control.viewContainerManager.updateTextEditorInfo(e.viewId,this.activeId))}createTextForMasterController(t,e){var r;const{workId:i,isActive:o,...s}=t;e&&this.internalMsgEmitter.emit("addUndoTicker",e,s.viewId),s.opt.uid=(r=this.collector)==null?void 0:r.uid,o&&(this.activeId=i),s.dataType=kt.Local,s.canWorker=!0,s.canSync=!0,this.editors.set(i,s),this.control.viewContainerManager.updateTextEditorInfo(s.viewId,this.activeId)}updateTextForMasterController(t,e){var r;const{workId:i,...o}=t;e&&this.internalMsgEmitter.emit("addUndoTicker",e,o.viewId);const s=this.editors.get(i)||{};o.opt&&(o.opt.uid=(r=this.collector)==null?void 0:r.uid),o.dataType=kt.Local,this.editors.set(i,{...s,...o}),this.control.viewContainerManager.updateTextEditorInfo(o.viewId,this.activeId)}async updateTextControllerWithEffectAsync(t,e){var r;const{workId:i,...o}=t;e&&this.internalMsgEmitter.emit("addUndoTicker",e,o.viewId);const s=this.editors.get(i)||{};o.opt&&(o.opt.uid=(r=this.collector)==null?void 0:r.uid),o.dataType=kt.Local;const a={...s,...o};if(this.editors.set(i,a),this.control.viewContainerManager.updateTextEditorInfo(o.viewId,this.activeId),this.taskqueue.has(i)){const c=this.taskqueue.get(i);return c&&(c.clocker&&clearTimeout(c.clocker),this.taskqueue.delete(i)),await this.updateTextControllerWithEffectAsync(t)}const l=setTimeout(()=>{var c;const g=(c=this.taskqueue.get(i))==null?void 0:c.resolve;g&&g(a)},50),u=await new Promise(c=>{this.taskqueue.set(i,{resolve:c,clocker:l})}),p=this.taskqueue.get(i);return p&&(p.clocker&&clearTimeout(p.clocker),this.taskqueue.delete(i)),u}updateTextForWorker(t,e){const{workId:r,isActive:i,...o}=t,s={...this.editors.get(r)||{},...o};if(i){s.canWorker=!1,s.canSync=!1,this.editors.set(r,s),this.active(r);return}this.editors.set(r,s),this.control.viewContainerManager.updateTextEditorInfo(o.viewId,this.activeId),e&&this.internalMsgEmitter.emit("addUndoTicker",e,o.viewId)}get(t){return this.editors.get(t)}delete(t,e,r){const i=this.editors.get(t);if(i){const o=i.viewId;i.canSync=e,i.canWorker=r,this.editors.delete(t),this.activeId===t&&(this.activeId=void 0),this.control.viewContainerManager.updateTextEditorInfo(o,this.activeId)}}deleteBatch(t,e,r){const i=new Set;for(const o of t){const s=this.editors.get(o);if(s){const a=s.viewId;s.canSync=e,s.canWorker=r,this.editors.delete(o),this.activeId===o&&(this.activeId=void 0),i.add(a)}}for(const o of i)this.control.viewContainerManager.updateTextEditorInfo(o,this.activeId)}clear(t,e){this.editors.forEach((r,i)=>{r.viewId===t&&(e&&(r.canSync=!1),r.canWorker=!1,this.editors.delete(i))}),this.activeId=void 0,this.control.viewContainerManager.updateTextEditorInfo(t,this.activeId)}destory(){this.editors.clear(),this.activeId=void 0}insertText(t,e,r,i){var o,s;const a=(o=this.control.room)==null?void 0:o.state.memberState;if(!a)return;const l=this.control.viewContainerManager.getView(t);if(!(l!=null&&l.focusScenePath))return;const u=l?.cameraOpt,p=this.control.getToolsOpt(nt.Text,a);if(!p)return;const c=(s=this.control.viewContainerManager)==null?void 0:s.transformToOriginPoint([e,r],t),g=Wl(i,{whiteList:{},stripIgnoreTag:!0,stripIgnoreTagBody:["script"]}).split(/\n/),v=p.toolsOpt;v.text=nn(g),v.workState=Tt.Doing,v.boxPoint=[e,r],v.boxSize=[v.fontSize,v.fontSize];const I=this.control.worker.now;return this.control.textEditorManager.checkEmptyTextBlur(),this.control.textEditorManager.createTextForMasterController({workId:I.toString(),x:c&&c[0]||0,y:c&&c[1]||0,scale:u?.scale||1,opt:v,type:jn.Text,isActive:!0,viewId:t,scenePath:l.focusScenePath},I),I.toString()}updateText(t,e){const r=this.editors.get(t.toString());if(!r)return;const i=Wl(e,{whiteList:{},stripIgnoreTag:!0,stripIgnoreTagBody:["script"]}).split(/\n/);r.opt.text=nn(i),this.control.textEditorManager.updateTextForMasterController({workId:t,opt:r.opt,viewId:r.viewId,canSync:!0,canWorker:!0},this.control.worker.now)}}class ZD{constructor(t){G(this,"expirationTime",me.cursor.expirationTime),G(this,"isEnableCursor"),G(this,"internalMsgEmitter"),G(this,"publicMsgEmitter"),G(this,"control"),G(this,"eventName","applianc-cursor"),G(this,"displayer"),G(this,"roomMember"),G(this,"animationId"),G(this,"maxLastSyncTime"),G(this,"willSendEventWorkers",[]),G(this,"willConsumeEventWorkers",new Map),G(this,"sendEventTimerId"),G(this,"animationDrawWorkers",new Map),G(this,"animationEventWorkers",new Map),G(this,"cursorInfoMap",new Map),G(this,"doneRenderCursorInfoMap",new Map);const{control:e,internalMsgEmitter:r,publicMsgEmitter:i}=t;this.internalMsgEmitter=r,this.publicMsgEmitter=i,this.expirationTime=Pt.isNumber(e.pluginOptions.extras.cursor.expirationTime)?e.pluginOptions.extras.cursor.expirationTime:this.expirationTime,this.control=e,this.roomMember=e.roomMember,this.maxLastSyncTime=this.control.pluginOptions.extras.syncOpt.interval,this.isEnableCursor=this.control.pluginOptions.extras.cursor.enable}activeCollector(){this.control.plugin&&this.isEnableCursor&&(this.displayer=this.control.room||this.control.play,this.displayer.addMagixEventListener(this.eventName,this.mainMagixEventListener.bind(this)))}mainMagixEventListener(t){var e;const{event:r,payload:i}=t;if(r!==this.eventName)return;const{uid:o,op:s,type:a}=i;if(((e=this.control.collector)==null?void 0:e.uid)!==o&&a===Oo.Cursor&&s!=null&&s.length){const l=this.willConsumeEventWorkers.get(o)||[];for(const u of s){const{viewId:p}=u;Pt.isNumber(u.consumPoint[0])&&Pt.isNumber(u.consumPoint[1])&&(u.consumPoint=this.control.viewContainerManager.transformToOriginPoint(u.consumPoint,p)),this.control.renderControl.isFilterCursor(p)&&l.unshift({...u,timestamp:Date.now()})}this.willConsumeEventWorkers.set(o,l),this.runAnimation()}}onFocusViewChange(){this.isEnableCursor&&(this.checkDrawWorks(),this.runAnimation())}updateRoomMembers(t){const{offline:e}=t;for(const r of this.cursorInfoMap.keys())r&&e.includes(r)&&this.cursorInfoMap.delete(r)}getKey(t,e){return`${t}${gn}${e}`}getUidAndviewId(t){const[e,r]=t.split(gn);return{uid:e,viewId:r}}runAnimation(){this.animationId||(this.animationId=requestAnimationFrame(this.animationCursor.bind(this)))}checkDrawWorks(){var t;const e=this.control.viewContainerManager.focuedViewId;for(const[r,i]of this.animationDrawWorkers.entries()){const{viewId:o,uid:s}=this.getUidAndviewId(r);s!==((t=this.control.collector)==null?void 0:t.uid)&&o!==e&&i.workState===Tt.Done&&(i.consumPoint=[void 0,void 0])}}animationCursor(){this.animationId=void 0;const t=Date.now();for(const[r,i]of this.animationDrawWorkers.entries()){const{uid:o,viewId:s}=this.getUidAndviewId(r),a=this.roomMember.getRoomMember(o);if(!a){this.animationDrawWorkers.delete(r);continue}const{consumPoint:l,timestamp:u,workState:p}=i,c=this.cursorInfoMap.get(s)||new Map;l&&Pt.isNumber(l[0])&&Pt.isNumber(l[1])&&u+this.expirationTime>t?c.set(a.memberId,{x:l[0],y:l[1],roomMember:a,timestamp:u,type:1,workState:p}):c.delete(a.memberId),c.size?this.cursorInfoMap.set(s,c):this.cursorInfoMap.delete(s),this.animationDrawWorkers.delete(r)}const e=new Set;for(const[r,i]of this.cursorInfoMap.entries())if(i)for(const[o,s]of i.entries())s.type===1&&s.workState!==Tt.Done&&e.add(o);else this.cursorInfoMap.delete(r);for(const[r,i]of this.willConsumeEventWorkers.entries()){const o=this.roomMember.getRoomMember(r);if(Pt.isNumber(o?.memberId)&&!e.has(o.memberId)){const s=i.pop();s?this.animationEventWorkers.set(r,s):this.willConsumeEventWorkers.delete(r)}}for(const[r,i]of this.animationEventWorkers.entries()){const o=this.roomMember.getRoomMember(r);if(!o){this.animationEventWorkers.delete(r);continue}const{viewId:s,consumPoint:a,timestamp:l}=i,u=this.cursorInfoMap.get(s)||new Map;a&&Pt.isNumber(a[0])&&Pt.isNumber(a[1])&&l+this.expirationTime>t?u.set(o.memberId,{x:a[0],y:a[1],roomMember:o,timestamp:l,type:0}):u.delete(o.memberId),u.size?this.cursorInfoMap.set(s,u):this.cursorInfoMap.delete(s),this.animationEventWorkers.delete(r)}for(const r of this.doneRenderCursorInfoMap.keys())this.cursorInfoMap.has(r)||(this.doneRenderCursorInfoMap.delete(r),this.internalMsgEmitter.emit([Ht.Cursor,r],[]));for(const[r,i]of this.cursorInfoMap.entries())if(i!=null&&i.size){const o=[];for(const[a,l]of i.entries()){const{timestamp:u,...p}=l;u+this.expirationTime>t?o.push(p):(i.delete(a),i.size===0&&(this.cursorInfoMap.delete(r),this.doneRenderCursorInfoMap.delete(r),this.internalMsgEmitter.emit([Ht.Cursor,r],[])))}const s=this.doneRenderCursorInfoMap.get(r);Pt.isEqual(s,o)||(this.doneRenderCursorInfoMap.set(r,o),this.internalMsgEmitter.emit([Ht.Cursor,r],o))}else this.cursorInfoMap.delete(r),this.doneRenderCursorInfoMap.delete(r),this.internalMsgEmitter.emit([Ht.Cursor,r],[]);(this.willConsumeEventWorkers.size||this.cursorInfoMap.size)&&this.runAnimation()}sendEvent(t,e){if(this.displayer&&Ft.isRoom(this.displayer)){const r=Pt.isNumber(t[0])&&Pt.isNumber(t[1])&&this.control.viewContainerManager.transformToScenePoint(t,e)||[void 0,void 0];this.willSendEventWorkers.push({consumPoint:r,viewId:e}),this.sendEventTimerId||(this.sendEventTimerId=setTimeout(()=>{this.dispatchMagixEvent()},this.maxLastSyncTime))}}dispatchMagixEvent(){var t;this.displayer&&Ft.isRoom(this.displayer)&&this.displayer.isWritable&&this.displayer.dispatchMagixEvent(this.eventName,{type:Oo.Cursor,op:Pt.cloneDeep(this.willSendEventWorkers),uid:(t=this.control.collector)==null?void 0:t.uid}),this.willSendEventWorkers.length=0,this.sendEventTimerId&&(clearTimeout(this.sendEventTimerId),this.sendEventTimerId=void 0)}collectServiceCursor(t){var e;if(!this.isEnableCursor&&!this.control.renderControl.isWritable)return;const{op:r,uid:i,workState:o,viewId:s}=t;if(i&&r&&o&&s){const a=this.roomMember.getRoomMember(i);if(!a||i===((e=this.control.collector)==null?void 0:e.uid))return;const l=this.getKey(i,s);let u=[void 0,void 0];if(Pt.isNumber(r[0])&&Pt.isNumber(r[1])){const[c,g]=this.control.viewContainerManager.transformToOriginPoint(r,s);u=[c,g]}if(o===Tt.Start){for(const c of this.cursorInfoMap.values())if(c!=null&&c.size)for(const g of c.keys())g===a.memberId&&c.delete(g)}const p={consumPoint:u,workState:o,viewId:s,timestamp:Date.now()};if(o===Tt.Start||o===Tt.Done){const c=this.willConsumeEventWorkers.get(i);o===Tt.Start&&c&&this.willConsumeEventWorkers.delete(i),c&&o===Tt.Done&&(p.timestamp=p.timestamp-this.expirationTime)}this.animationDrawWorkers.set(l,p),this.runAnimation()}}unabled(){var t;this.displayer&&Ft.isRoom(this.displayer)&&(this.willSendEventWorkers.length=0,this.displayer.dispatchMagixEvent(this.eventName,{type:Oo.Cursor,op:[{viewId:this.control.viewContainerManager.focuedViewId,consumPoint:[void 0,void 0]}],uid:(t=this.control.collector)==null?void 0:t.uid}),this.sendEventTimerId&&(clearTimeout(this.sendEventTimerId),this.sendEventTimerId=void 0)),this.isEnableCursor||this.stopAnimation()}clearViewCursor(t){var e,r,i;for(const[o]of this.animationDrawWorkers.entries()){const{uid:s}=this.getUidAndviewId(o);s===((e=this.control.collector)==null?void 0:e.uid)&&t===t&&this.animationDrawWorkers.delete(o)}for(const[o]of this.willConsumeEventWorkers.entries())o===((r=this.control.collector)==null?void 0:r.uid)&&this.willConsumeEventWorkers.delete(o);for(const[o]of this.animationEventWorkers.entries())o===((i=this.control.collector)==null?void 0:i.uid)&&this.animationEventWorkers.delete(o);for(const[o]of this.cursorInfoMap.entries())o===o&&(this.cursorInfoMap.delete(o),this.doneRenderCursorInfoMap.delete(o),this.internalMsgEmitter.emit([Ht.Cursor,o],[]))}stopAnimation(){this.animationDrawWorkers.clear(),this.willConsumeEventWorkers.clear(),this.cursorInfoMap.clear()}destroy(){var t;(t=this.displayer)==null||t.removeMagixEventListener(this.eventName),this.stopAnimation()}}class Nn{constructor(){G(this,"useEmtMsg"),G(this,"emtType"),G(this,"control"),G(this,"mainEngine"),G(this,"collectListener",(t,e)=>{this.collect(t,e)})}static dispatch(t,e,r){var i;(i=We.InternalMsgEmitter)==null||i.emit([t,e],r)}get serviceColloctor(){return this.control.collector}registerForMainEngine(t,e){return this.emtType=t,this.control=e,this.mainEngine=e.worker,this.mainEngine.internalMsgEmitter.on([this.emtType,this.emitEventType],this.collectListener),this}destroy(){this.emtType&&this.mainEngine&&this.mainEngine.internalMsgEmitter.off([this.emtType,this.emitEventType],this.collectListener)}collectForLocalWorker(t,e){var r,i,o;for(const[s,a]of t)(r=this.mainEngine)==null||r.queryTaskBatchData(a).forEach(l=>{var u;(u=this.mainEngine)==null||u.taskBatchData.delete(l)}),(i=this.mainEngine)==null||i.taskBatchData.add(s);if(e){this.mainEngine.consume();return}(o=this.mainEngine)==null||o.runAnimation()}collectForServiceWorker(t){Gn(()=>{t.forEach(e=>{var r;(r=this.serviceColloctor)==null||r.dispatch(e)})},this.mainEngine.maxLastSyncTime,this.control.hasPolyfillMethod("requestIdleCallback"))}pause(){var t;if(this.lastEmtData){this.useEmtMsg=!0;const e={...this.lastEmtData,workState:Tt.Done};this.collect(e,!0),(t=We.InternalMsgEmitter)==null||t.emit(zt.ActiveMethod,!1)}}recover(){var t;this.useEmtMsg&&We.InternalMsgEmitter.hasListeners(zt.ActiveMethod)&&((t=We.InternalMsgEmitter)==null||t.emit(zt.ActiveMethod,!0))}}class KD extends Nn{constructor(){super(...arguments),G(this,"lastEmtData"),G(this,"emitEventType",zt.CopyNode)}collect(t){var e;if(!this.serviceColloctor||!this.mainEngine)return;const{workIds:r,viewId:i}=t,o=this.control.viewContainerManager.getView(i);if(!(o!=null&&o.displayer))return;const s=o.focusScenePath,a=this.mainEngine.now;this.mainEngine.internalMsgEmitter.emit("addUndoTicker",a,i);for(const l of r){const u=l.toString(),p=this.serviceColloctor.isLocalId(u)?this.serviceColloctor.transformKey(l):u,c=(e=this.serviceColloctor.getStorageData(i,s))==null?void 0:e[p];if(c){if(l===Xt){const g=c&&this.copySelector({viewId:i,store:c});g&&this.pasteSelector({...g,viewId:i,scenePath:s,undoTickerId:a});break}if(c.toolsType===nt.Text&&c.opt&&c.opt.workState&&c.opt.workState!==Tt.Done){const g=c&&this.copyText({viewId:i,store:c});g&&this.pasteText({...g,viewId:i,scenePath:s,key:p,store:c,undoTickerId:a});break}}}}copyText(t){const{viewId:e,store:r}=t,i=this.control.viewContainerManager.getView(e);if(!this.serviceColloctor||!i)return;const o=i?.cameraOpt,s=o&&[o.centerX,o.centerY],a=r.opt,l=a.boxPoint&&a.boxSize&&[a.boxPoint[0]+a.boxSize[0]/2,a.boxPoint[1]+a.boxSize[1]/2];return{bgCenter:s,textCenter:l}}pasteText(t){var e,r;const{bgCenter:i,textCenter:o,store:s,key:a,viewId:l,scenePath:u,undoTickerId:p}=t,c=this.control.viewContainerManager.getView(l);if(!this.serviceColloctor||!c)return;const g=Math.floor(Math.random()*30+1),v=((e=c.cameraOpt)==null?void 0:e.scale)||1,I=i&&o&&[i[0]-o[0]+g,i[1]-o[1]+g]||[g/v,g/v],w=(this.serviceColloctor.isLocalId(a)?a:this.serviceColloctor.getLocalId(a.toString()))+"-"+p;if(s.toolsType===nt.Text&&s.opt){const y=s.opt;if(y&&y.boxPoint&&y.text){y.workState=Tt.Done;const T=y.boxPoint;y.boxPoint=[T[0]+I[0],T[1]+I[1]],y.workState=Tt.Done;const h=this.control.viewContainerManager.transformToOriginPoint(y.boxPoint,l);this.control.textEditorManager.createTextForMasterController({workId:w,x:h[0],y:h[1],opt:y,scale:((r=c.cameraOpt)==null?void 0:r.scale)||1,type:jn.Text,isActive:!1,viewId:l,scenePath:u}),this.collectForServiceWorker([{...s,opt:y,type:pt.FullWork,workId:w,viewId:l,scenePath:u}])}}}copySelector(t){var e,r,i,o,s,a,l,u,p;const{viewId:c,store:g}=t,v=this.control.viewContainerManager.getView(c),I=g.selectIds;if(!this.serviceColloctor||!(I!=null&&I.length)||!v)return;const w=new Map,y={offset:{x:0,y:0},cameraOpt:{centerX:((e=v.cameraOpt)==null?void 0:e.centerX)||0,centerY:((r=v.cameraOpt)==null?void 0:r.centerY)||0,scale:((i=v.cameraOpt)==null?void 0:i.scale)||1}},T=this.control.hasOffscreenCanvas()&&((o=v.displayer.canvasBgRef.current)==null?void 0:o.getBoundingClientRect())||((s=v.displayer.canvasContainerRef.current)==null?void 0:s.getBoundingClientRect()),h=(l=(a=v.displayer)==null?void 0:a.floatBarRef.current)==null?void 0:l.getBoundingClientRect(),m=T&&[T.x+T.width/2,T.y+T.height/2],d=h&&[h.x+h.width/2,h.y+h.height/2],M=m&&v.viewData&&v.viewData.convertToPointInWorld({x:m[0],y:m[1]}),x=d&&v.viewData&&v.viewData.convertToPointInWorld({x:d[0],y:d[1]});M&&x&&(y.offset={x:M.x-x.x,y:M.y-x.y});for(const E of I){const P=(p=(u=this.serviceColloctor)==null?void 0:u.getStorageData(v.id,v.focusScenePath))==null?void 0:p[E];P&&w.set(E,P)}return{copyStores:w,copyCoordInfo:y}}pasteSelector(t){var e,r,i,o;const{copyStores:s,copyCoordInfo:a,viewId:l,scenePath:u,undoTickerId:p}=t,c=this.control.viewContainerManager.getView(l);if(!s.size||!this.serviceColloctor||!c)return;const{offset:g,cameraOpt:v}=a,{scale:I}=v,w=Math.floor(Math.random()*30+1),y=g&&[g.x+w,g.y+w]||[w/I,w/I],T=[],h=[];for(const[m,d]of s.entries()){const M=(this.serviceColloctor.isLocalId(m)?m:this.serviceColloctor.getLocalId(m.toString()))+"-"+p,x={useAnimation:!1};if(d.toolsType===nt.Text&&d.opt){const E=d.opt;if(E&&E.boxPoint&&E.text){E.workState=Tt.Done;const P=E.boxPoint;E.boxPoint=[P[0]+y[0],P[1]+y[1]],E.workState=Tt.Done;const R=this.control.viewContainerManager.transformToOriginPoint(E.boxPoint,l);this.control.textEditorManager.createTextForMasterController({workId:M,x:R[0],y:R[1],opt:E,scale:((e=c.cameraOpt)==null?void 0:e.scale)||1,type:jn.Text,isActive:!1,viewId:l,scenePath:u})}h.push({...d,opt:E,type:pt.FullWork,workId:M,viewId:l,scenePath:u});continue}if(d.toolsType===nt.Image&&(d.opt.uuid=M,d.opt.centerX=d.opt.centerX+y[0],d.opt.centerY=d.opt.centerY+y[1]),d.ops){const E=io(d.ops).map((R,N)=>{const b=N%3;return b===0?R+y[0]:b===1?R+y[1]:R}),P=nn(E);d.ops=P}if((r=d?.opt)!=null&&r.eraserlines&&(i=d?.opt)!=null&&i.eraserlines.length)for(const E of(o=d?.opt)==null?void 0:o.eraserlines){const{op:P}=E;for(let R=0;R<P.length;R++){const N=P[R].map((b,j)=>j%2?b+y[1]:b+y[0]);E.op[R]=N}}h.push({...d,updateNodeOpt:x,type:pt.FullWork,workId:M,viewId:l,scenePath:u}),T.push([{...d,updateNodeOpt:x,workId:M,msgType:pt.FullWork,dataType:kt.Local,emitEventType:zt.CopyNode,willSyncService:!1,willRefresh:!0,viewId:l},{workId:M,msgType:pt.FullWork,emitEventType:zt.CopyNode}])}T.length&&this.collectForLocalWorker(T),h.length&&this.collectForServiceWorker(h)}}class JD extends Nn{constructor(){super(...arguments),G(this,"lastEmtData"),G(this,"emitEventType",zt.SetColorNode),G(this,"undoTickerId")}setTextColor(t,e,r,i){const{fontColor:o,fontBgColor:s}=r;e.opt&&(o&&(e.opt.fontColor=o),s&&(e.opt.fontBgColor=s),this.control.textEditorManager.updateTextForMasterController({workId:t,opt:e.opt,viewId:i,canSync:!0,canWorker:!0}))}collect(t){var e,r;if(!this.serviceColloctor||!this.mainEngine)return;const{workIds:i,strokeColor:o,fillColor:s,fontColor:a,fontBgColor:l,viewId:u,workState:p,thickness:c,strokeType:g}=t,v=this.control.viewContainerManager.getView(u);if(!(v!=null&&v.displayer))return;const I=v.focusScenePath,w=[...i],y=this.serviceColloctor.storage,T=[],h={};for((p===Tt.Start||!this.undoTickerId&&p===Tt.Done)&&(this.undoTickerId=this.mainEngine.now,this.mainEngine.internalMsgEmitter.emit("addUndoTicker",this.undoTickerId,u));w.length;){const m=w.pop();if(!m)continue;const d=m.toString(),M=this.serviceColloctor.isLocalId(d),x=M?this.serviceColloctor.transformKey(m):d;let E=d;!M&&this.serviceColloctor.isOwn(E)&&(E=this.serviceColloctor.getLocalId(E));const P=(r=(e=y?.[u])==null?void 0:e[I])==null?void 0:r[x];if(P){const R=P.updateNodeOpt||{};if(a||l){if(a){R.fontColor=a;const[b,j,O,L]=wo(a);h.textColor=[b,j,O],h.textOpacity=L}if(l)if(R.fontBgColor=Ns(l)?"transparent":l,Ns(l))h.textBgColor=void 0,h.textBgOpacity=void 0;else{const[b,j,O,L]=wo(l);h.textBgColor=[b,j,O],h.textBgOpacity=L}if(P.toolsType===nt.Text&&P.opt&&p!==Tt.Start){this.setTextColor(E,ze(P),R,u),p===Tt.Done&&(this.undoTickerId=void 0);continue}}if(o){R.strokeColor=o;const[b,j,O,L]=wo(o);h.strokeColor=[b,j,O],h.strokeOpacity=L}if(s)if(R.fillColor=Ns(s)?"transparent":s,Ns(s))h.fillColor=void 0,h.fillOpacity=void 0;else{const[b,j,O,L]=wo(s);h.fillColor=[b,j,O],h.fillOpacity=L}c&&(R.thickness=c,h.strokeWidth=c),g&&(R.strokeType=g,h.strokeType=g);const N={workId:E,msgType:pt.UpdateNode,dataType:kt.Local,updateNodeOpt:R,emitEventType:this.emitEventType,willRefresh:!0,willRefreshSelector:!0,willSyncService:!0,textUpdateForWoker:!0,viewId:u};T.push([N,{workId:E,msgType:pt.UpdateNode,emitEventType:this.emitEventType}])}}T.length&&(p===Tt.Done&&(this.undoTickerId=void 0),this.collectForLocalWorker(T)),Object.keys(h).length&&setTimeout(()=>{var m;(m=this.control.room)==null||m.setMemberState(h)},0)}}class qD extends Nn{constructor(){super(...arguments),G(this,"lastEmtData"),G(this,"emitEventType",zt.ZIndexNode),G(this,"zIndexMap",new Map)}clearZIndex(t){this.zIndexMap.delete(t)}getMinZIndex(t){var e;return((e=this.zIndexMap.get(t))==null?void 0:e.min)||0}getMaxZIndex(t){var e;return((e=this.zIndexMap.get(t))==null?void 0:e.max)||0}setMaxZIndex(t,e){const r=this.getMinZIndex(e);this.zIndexMap.set(e,{min:r,max:t})}setMinZIndex(t,e){const r=this.getMaxZIndex(e);this.zIndexMap.set(e,{min:t,max:r})}addMaxLayer(t){const e=this.getMaxZIndex(t)+1;this.setMaxZIndex(e,t)}addMinLayer(t){const e=this.getMinZIndex(t)-1;this.setMinZIndex(e,t)}correct(t){const e=t.sort((r,i)=>r[1]-i[1]);for(let r=1;r<e.length;r++){const i=e[r][1],o=e[r-1][1];i<=o&&(e[r][1]=o+1)}return e}collect(t){if(!this.serviceColloctor||!this.mainEngine)return;const{workIds:e,layer:r,viewId:i}=t,o=this.control.viewContainerManager.getView(i);if(!(o!=null&&o.displayer))return;const s=o.focusScenePath,a=[...e],l=this.serviceColloctor.storage,u=[],p=[];for(;a.length;){const g=a.pop();if(!g)continue;const v=g.toString(),I=this.serviceColloctor.isLocalId(v),w=I?this.serviceColloctor.transformKey(g):v;let y=v;!I&&this.serviceColloctor.isOwn(y)&&(y=this.serviceColloctor.getLocalId(y));const T=ze(l[i][s][w]);let h;if(T&&y===Xt){if(T.selectIds){p.push(...T.selectIds),p.sort((x,E)=>{var P,R,N,b;const j=((R=(P=l[c(x,this.serviceColloctor)])==null?void 0:P.opt)==null?void 0:R.zIndex)||0,O=((b=(N=l[c(x,this.serviceColloctor)])==null?void 0:N.opt)==null?void 0:b.zIndex)||0;return j>O?1:x<E?-1:0});const m=T.updateNodeOpt||{};m.zIndexLayer=r;const d={workId:g,msgType:pt.UpdateNode,dataType:kt.Local,updateNodeOpt:m,emitEventType:this.emitEventType,willRefreshSelector:!0,willSyncService:!0,viewId:i},M=new Map;r===Xo.Top?(this.addMaxLayer(i),h=this.getMaxZIndex(i)):(this.addMinLayer(i),h=this.getMinZIndex(i)),p.forEach(x=>{var E,P,R,N,b;const j=(E=this.serviceColloctor)==null?void 0:E.isLocalId(x);let O=j&&((P=this.serviceColloctor)==null?void 0:P.transformKey(x))||x;const L=(N=(R=l?.[i])==null?void 0:R[s])==null?void 0:N[O];L&&(!j&&(b=this.serviceColloctor)!=null&&b.isOwn(O)&&(O=this.serviceColloctor.getLocalId(O)),m.zIndex=h,L!=null&&L.opt&&(L.opt.zIndex=h),L!=null&&L.opt&&M.set(O,{updateNodeOpt:L.updateNodeOpt,opt:L.opt}))}),d.selectStore=M,d.willSerializeData=!0,u.push([d,{workId:g,msgType:pt.UpdateNode,emitEventType:this.emitEventType}])}continue}}u.length&&this.collectForLocalWorker(u);function c(g,v){return v.isLocalId(g)&&v.transformKey(g)||g}}}class _D extends Nn{constructor(){super(...arguments),G(this,"lastEmtData"),G(this,"emitEventType",zt.TranslateNode),G(this,"cachePosition")}collect(t,e){var r,i,o;if(!this.serviceColloctor||!this.mainEngine)return;const{workIds:s,position:a,workState:l,viewId:u}=t;this.lastEmtData=t;const p=this.control.viewContainerManager.getView(u);if(!(p!=null&&p.displayer))return;const c=p.focusScenePath,g=[...s],v=(r=this.serviceColloctor)==null?void 0:r.storage,I=[],w=l===Tt.Start&&this.mainEngine.now||void 0;for(w&&this.mainEngine.internalMsgEmitter.emit("addUndoTicker",w,u);g.length;){const y=g.pop();if(!y)continue;const T=y.toString(),h=this.serviceColloctor.isLocalId(T),m=h&&this.serviceColloctor.transformKey(y)||T;let d=T;!h&&this.serviceColloctor.isOwn(d)&&(d=this.serviceColloctor.getLocalId(d));const M=(o=(i=v?.[u])==null?void 0:i[c])==null?void 0:o[m];if(M&&d===Xt){if(M.selectIds){const x=this.control.viewContainerManager.transformToScenePoint([a.x,a.y],u);if(l===Tt.Start&&(this.cachePosition=x),this.cachePosition){const E=M.updateNodeOpt||{};E.translate=[x[0]-this.cachePosition[0],x[1]-this.cachePosition[1]],E.workState=l,this.control.cursor.isEnableCursor?E.useAnimation=!1:(E.uid=this.serviceColloctor.uid,l===Tt.Start?E.useAnimation=!1:l===Tt.Done&&(E.useAnimation=!0));const P={workId:y,msgType:pt.UpdateNode,dataType:kt.Local,updateNodeOpt:E,emitEventType:this.emitEventType,willSyncService:!0,textUpdateForWoker:!0,viewId:u,smoothSync:this.mainEngine.smoothSync};l===Tt.Done&&(P.textUpdateForWoker=!0,P.willSerializeData=!0,this.cachePosition=void 0),I.push([P,{workId:y,msgType:pt.UpdateNode,emitEventType:this.emitEventType,workState:l}])}}continue}}l===Tt.Start?this.mainEngine.unWritable():l===Tt.Done&&(this.mainEngine.abled(),this.lastEmtData=void 0),I.length&&this.collectForLocalWorker(I,e)}}class tL extends Nn{constructor(){super(...arguments),G(this,"lastEmtData"),G(this,"emitEventType",zt.DeleteNode)}collect(t){var e,r;if(!this.serviceColloctor||!this.mainEngine)return;const{workIds:i,viewId:o}=t,s=this.control.viewContainerManager.getView(o);if(!(s!=null&&s.displayer))return;const a=s.focusScenePath,l=this.serviceColloctor.storage,u=[...i],p=[],c=[],g=this.mainEngine.now;for(;u.length;){const v=u.pop();if(!v)continue;const I=v.toString(),w=this.serviceColloctor.isLocalId(I),y=w?this.serviceColloctor.transformKey(v):I,T=(r=(e=l?.[o])==null?void 0:e[a])==null?void 0:r[y];if(T){let h=I;if(!w&&this.serviceColloctor.isOwn(h)&&(h=this.serviceColloctor.getLocalId(h)),T.toolsType===nt.Text){this.control.textEditorManager.delete(h,!0,!0);continue}c.push(h)}}c.length&&(p.push([{msgType:pt.RemoveNode,emitEventType:zt.DeleteNode,removeIds:c,dataType:kt.Local,willSyncService:!0,willRefresh:!0,viewId:o},void 0]),this.mainEngine.internalMsgEmitter.emit("addUndoTicker",g,o),this.collectForLocalWorker(p))}}class eL extends Nn{constructor(){super(...arguments),G(this,"lastEmtData"),G(this,"emitEventType",zt.ScaleNode),G(this,"targetText",new Map),G(this,"cacheTextInfo",new Map)}async setTextStyle(t,e,r){const i=await this.control.textEditorManager.updateTextControllerWithEffectAsync({workId:t,opt:e,viewId:r,canSync:!1,canWorker:!1});return{key:t,textInfo:i}}async collect(t,e){var r,i,o,s,a,l,u;if(!this.serviceColloctor||!this.mainEngine)return;const{workIds:p,workState:c,viewId:g,originPoint:v,scenePoint:I,dir:w,scale:y,translate:T}=t;this.lastEmtData=t;const h=this.control.viewContainerManager.getView(g);if(!(h!=null&&h.displayer))return;const m=h.focusScenePath,d=[...p],M=(r=this.serviceColloctor)==null?void 0:r.storage,x=[],E=c===Tt.Start&&this.mainEngine.now||void 0;for(E&&this.mainEngine.internalMsgEmitter.emit("addUndoTicker",E,g);d.length;){const P=d.pop();if(!P)continue;const R=P.toString(),N=this.serviceColloctor.isLocalId(R),b=N&&this.serviceColloctor.transformKey(P)||R;let j=R;!N&&this.serviceColloctor.isOwn(j)&&(j=this.serviceColloctor.getLocalId(j));const O=(o=(i=M?.[g])==null?void 0:i[m])==null?void 0:o[b];if(O&&j===Xt&&O.selectIds){const L=O.updateNodeOpt||{};if(L.dir=w,L.originPoint=v,L.scenePoint=I,L.workState=c,L.scale=y,L.translate=T,c===Tt.Start){this.cacheTextInfo.clear();for(const H of O.selectIds){const Q=(s=this.serviceColloctor)==null?void 0:s.isLocalId(H),_=Q&&((a=this.serviceColloctor)==null?void 0:a.transformKey(H))||H;let st=_;!Q&&(l=this.serviceColloctor)!=null&&l.isOwn(_)&&(st=this.serviceColloctor.getLocalId(_));const F=this.control.textEditorManager.get(st);F&&c===Tt.Start&&this.targetText.set(st,ze(F))}}if(this.targetText.size&&c!==Tt.Start&&y){const H=[];for(const[_,st]of this.targetText.entries()){const{opt:F}=st,Z=Math.floor(F.fontSize*y[0]),tt=this.cacheTextInfo.get(_),ct=!tt&&F.fontSize!==Z||tt&&tt.fontSize!==Z||!1,at=(u=this.control.textEditorManager.get(_))==null?void 0:u.opt;if(ct&&at&&F.boxSize&&F.boxPoint){const dt=this.setTextStyle(_,{...at,fontSize:Z},g);H.push(dt)}}const Q=await Promise.all(H);for(const _ of Q)if(_){const{key:st,textInfo:F}=_;this.cacheTextInfo.set(st,{fontSize:F.opt.fontSize,boxSize:F.opt.boxSize,boxPoint:F.opt.boxPoint})}L.textInfos=this.cacheTextInfo}this.control.cursor.isEnableCursor?L.useAnimation=!1:(L.uid=this.serviceColloctor.uid,c===Tt.Start?L.useAnimation=!1:c===Tt.Done&&(L.useAnimation=!0));const k={workId:P,msgType:pt.UpdateNode,dataType:kt.Local,updateNodeOpt:L,emitEventType:this.emitEventType,willRefreshSelector:!0,willSyncService:!0,viewId:g,smoothSync:this.mainEngine.smoothSync};c===Tt.Done&&(k.willSerializeData=!0,this.targetText.clear()),x.push([k,{workId:P,msgType:pt.UpdateNode,emitEventType:this.emitEventType,workState:c}]);continue}}c===Tt.Start?this.mainEngine.unWritable():c===Tt.Done&&(this.mainEngine.abled(),this.lastEmtData=void 0),x.length&&this.collectForLocalWorker(x,e)}}class nL extends Nn{constructor(){super(...arguments),G(this,"lastEmtData"),G(this,"emitEventType",zt.RotateNode),G(this,"cacheOriginRotate",0)}collect(t,e){var r,i,o,s,a,l,u;if(!this.serviceColloctor||!this.mainEngine)return;const{workIds:p,angle:c,workState:g,viewId:v}=t;this.lastEmtData=t;const I=this.control.viewContainerManager.getView(v);if(!(I!=null&&I.displayer))return;const w=I.focusScenePath,y=[...p],T=(r=this.serviceColloctor)==null?void 0:r.storage,h=[],m=g===Tt.Start&&this.mainEngine.now||void 0;for(m&&this.mainEngine.internalMsgEmitter.emit("addUndoTicker",m,v);y.length;){const d=y.pop();if(!d)continue;const M=d.toString(),x=this.serviceColloctor.isLocalId(M),E=x&&this.serviceColloctor.transformKey(d)||M;let P=M;!x&&this.serviceColloctor.isOwn(P)&&(P=this.serviceColloctor.getLocalId(P));const R=(o=(i=T?.[v])==null?void 0:i[w])==null?void 0:o[E];if(R&&P===Xt){if(((s=R.selectIds)==null?void 0:s.length)===1){const N=R.selectIds[0];if(g===Tt.Start){const O=((a=this.serviceColloctor)==null?void 0:a.isLocalId(N))&&((l=this.serviceColloctor)==null?void 0:l.transformKey(N))||N,L=T[v][w][O];this.cacheOriginRotate=((u=L?.opt)==null?void 0:u.rotate)||0}const b=R.updateNodeOpt||{};b.angle=(c+this.cacheOriginRotate)%360,b.workState=g,this.control.cursor.isEnableCursor?b.useAnimation=!1:(b.uid=this.serviceColloctor.uid,g===Tt.Start?b.useAnimation=!1:g===Tt.Done&&(b.useAnimation=!0));const j={workId:d,msgType:pt.UpdateNode,dataType:kt.Local,updateNodeOpt:b,emitEventType:this.emitEventType,willRefreshSelector:!1,willSyncService:!0,viewId:v,smoothSync:this.mainEngine.smoothSync};g===Tt.Done&&(j.willRefreshSelector=!0,j.willSerializeData=!0,this.cacheOriginRotate=0),h.push([j,{workId:d,msgType:pt.UpdateNode,emitEventType:this.emitEventType,workState:g}])}continue}}g===Tt.Start?this.mainEngine.unWritable():g===Tt.Done&&(this.mainEngine.abled(),this.lastEmtData=void 0),h.length&&this.collectForLocalWorker(h,e)}}function rL(n){switch(n){case nt.Text:return jn.Text;case nt.SpeechBalloon:case nt.Star:case nt.Ellipse:case nt.Rectangle:case nt.Triangle:case nt.Rhombus:case nt.Polygon:return jn.Shape}}class iL extends Nn{constructor(){super(...arguments),G(this,"lastEmtData"),G(this,"emitEventType",zt.SetFontStyle),G(this,"timerId")}async setTextStyle(t,e,r,i){const{bold:o,underline:s,lineThrough:a,italic:l,fontSize:u}=r;if(e.toolsType&&rL(e.toolsType)===jn.Text){e.opt&&(o&&(e.opt.bold=o),Pt.isBoolean(s)&&(e.opt.underline=s),Pt.isBoolean(a)&&(e.opt.lineThrough=a),l&&(e.opt.italic=l),u&&(e.opt.fontSize=u));const p=await this.control.textEditorManager.updateTextControllerWithEffectAsync({workId:t,opt:e.opt,viewId:i,canSync:!1,canWorker:!1});return{key:t,textInfo:p}}}async collect(t){var e,r,i,o,s,a;if(!this.serviceColloctor||!this.mainEngine)return;const{workIds:l,bold:u,italic:p,lineThrough:c,underline:g,viewId:v,fontSize:I}=t,w=this.control.viewContainerManager.getView(v);if(!(w!=null&&w.displayer))return;const y=w.focusScenePath,T=[...l],h=this.serviceColloctor.storage,m={},d=this.mainEngine.now;this.mainEngine.internalMsgEmitter.emit("addUndoTicker",d,v);const M=[];for(;T.length;){const E=T.pop();if(!E)continue;const P=E.toString(),R=this.serviceColloctor.isLocalId(P),N=R?this.serviceColloctor.transformKey(E):P;let b=P;!R&&this.serviceColloctor.isOwn(b)&&(b=this.serviceColloctor.getLocalId(b));const j=(r=(e=h?.[v])==null?void 0:e[y])==null?void 0:r[N];if(j){const O=j.updateNodeOpt||{};if(u&&(O.bold=u,m.bold=u==="bold"),p&&(O.italic=p,m.italic=p==="italic"),Pt.isBoolean(c)&&(O.lineThrough=c,m.lineThrough=c),Pt.isBoolean(g)&&(O.underline=g,m.underline=g),I&&(O.fontSize=I,m.textSize=I),j.toolsType===nt.Text&&j.opt){const L=this.setTextStyle(b,Pt.cloneDeep(j),O,v);M.push(L);continue}if(j&&b===Xt&&(i=j.selectIds)!=null&&i.length)for(const L of j.selectIds){const k=(o=this.serviceColloctor)==null?void 0:o.isLocalId(L);let H=k&&((s=this.serviceColloctor)==null?void 0:s.transformKey(L))||L;const Q=h[v][y][H]||void 0;if(!k&&(a=this.serviceColloctor)!=null&&a.isOwn(H)&&(H=this.serviceColloctor.getLocalId(H)),Q&&Q.toolsType===nt.Text&&j.opt){const _=this.setTextStyle(H,Pt.cloneDeep(Q),O,v);M.push(_);continue}}}}const x=await Promise.all(M);for(const E of x)if(E){const{key:P,textInfo:R}=E;R&&(R.canSync=!0,R.canWorker=!0,this.control.textEditorManager.updateForViewEdited(P,R))}Object.keys(m).length&&(this.timerId&&(clearTimeout(this.timerId),this.timerId=void 0),this.timerId=setTimeout(()=>{var E;this.timerId=void 0,(E=this.control.room)==null||E.setMemberState(m)},0))}}class oL extends Nn{constructor(){super(...arguments),G(this,"lastEmtData"),G(this,"emitEventType",zt.SetPoint),G(this,"undoTickerId")}collect(t){var e,r,i;if(!this.serviceColloctor||!this.mainEngine)return;const{workId:o,pointMap:s,workState:a,viewId:l}=t,u=this.control.viewContainerManager.getView(l);if(!(u!=null&&u.displayer))return;const p=u.focusScenePath,c=(e=this.serviceColloctor)==null?void 0:e.storage,g=[],v=a===Tt.Start&&this.mainEngine.now||void 0;v&&(this.undoTickerId=v,this.mainEngine.internalMsgEmitter.emit("addUndoTicker",v,l));const I=o;if(!I)return;const w=I.toString(),y=this.serviceColloctor.isLocalId(w),T=y&&this.serviceColloctor.transformKey(I)||w;let h=w;!y&&this.serviceColloctor.isOwn(h)&&(h=this.serviceColloctor.getLocalId(h));const m=(i=(r=c?.[l])==null?void 0:r[p])==null?void 0:i[T];if(m&&h===Xt&&m.selectIds){const d=m.updateNodeOpt||{};d.pointMap=s,d.workState=a;const M={workId:I,msgType:pt.UpdateNode,dataType:kt.Local,updateNodeOpt:d,emitEventType:this.emitEventType,willRefreshSelector:!0,willSyncService:!0,viewId:l};a===Tt.Done&&(M.undoTickerId=this.undoTickerId),g.push([M,{workId:I,msgType:pt.UpdateNode,emitEventType:this.emitEventType}])}a===Tt.Start?this.mainEngine.unWritable():a===Tt.Done&&this.mainEngine.abled(),g.length&&this.collectForLocalWorker(g)}}class sL extends Nn{constructor(){super(...arguments),G(this,"lastEmtData"),G(this,"emitEventType",zt.SetLock)}collect(t){var e,r;if(!this.serviceColloctor||!this.mainEngine)return;const{workIds:i,isLocked:o,viewId:s}=t,a=this.control.viewContainerManager.getView(s);if(!(a!=null&&a.displayer))return;const l=a.focusScenePath,u=[...i],p=this.serviceColloctor.storage,c=[],g=this.mainEngine.now;for(;u.length;){const v=u.pop();if(!v)continue;const I=v.toString(),w=this.serviceColloctor.isLocalId(I),y=w?this.serviceColloctor.transformKey(v):I;let T=I;!w&&this.serviceColloctor.isOwn(T)&&(T=this.serviceColloctor.getLocalId(T));const h=(r=(e=p?.[s])==null?void 0:e[l])==null?void 0:r[y];if(h){const m=h.updateNodeOpt||{};m.isLocked=o;const d={workId:T,msgType:pt.UpdateNode,dataType:kt.Local,updateNodeOpt:m,emitEventType:this.emitEventType,willRefresh:!0,willRefreshSelector:!0,willSyncService:!0,viewId:s};c.push([d,{workId:T,msgType:pt.UpdateNode,emitEventType:this.emitEventType}])}}this.mainEngine.internalMsgEmitter.emit("addUndoTicker",g,s),c.length&&this.collectForLocalWorker(c)}}class aL extends Nn{constructor(){super(...arguments),G(this,"lastEmtData"),G(this,"emitEventType",zt.SetShapeOpt)}collect(t){var e,r;if(!this.serviceColloctor||!this.mainEngine)return;const{workIds:i,viewId:o,...s}=t,a=this.control.viewContainerManager.getView(o);if(!(a!=null&&a.displayer))return;const l=a.focusScenePath,u=[...i],p=this.serviceColloctor.storage,c=[],g=this.mainEngine.now;for(;u.length;){const v=u.pop();if(!v)continue;const I=v.toString(),w=this.serviceColloctor.isLocalId(I),y=w?this.serviceColloctor.transformKey(v):I;let T=I;!w&&this.serviceColloctor.isOwn(T)&&(T=this.serviceColloctor.getLocalId(T));const h=(r=(e=p?.[o])==null?void 0:e[l])==null?void 0:r[y];if(h){const m={...h.updateNodeOpt,...s,willRefresh:!0};if(h&&T===Xt){const d={workId:T,msgType:pt.UpdateNode,dataType:kt.Local,updateNodeOpt:m,emitEventType:this.emitEventType,willRefresh:!0,willRefreshSelector:!0,willSyncService:!0,viewId:o};c.push([d,{workId:T,msgType:pt.UpdateNode,emitEventType:this.emitEventType}])}}}c.length&&(this.mainEngine.internalMsgEmitter.emit("addUndoTicker",g,o),this.collectForLocalWorker(c))}}class _t{constructor(t){G(this,"builders",new Map),this.builders=new Map(t.map(e=>[e,this.build(e)]))}build(t){switch(t){case zt.TranslateNode:return new _D;case zt.ZIndexNode:return new qD;case zt.CopyNode:return new KD;case zt.SetColorNode:return new JD;case zt.DeleteNode:return new tL;case zt.ScaleNode:return new eL;case zt.RotateNode:return new nL;case zt.SetFontStyle:return new iL;case zt.SetPoint:return new oL;case zt.SetLock:return new sL;case zt.SetShapeOpt:return new aL}}getBuilder(t){return this.builders.get(t)}registerForMainEngine(t,e){return this.builders.forEach(r=>{r&&r.registerForMainEngine(t,e)}),this}destroy(){this.builders.forEach(t=>{t&&t.destroy()}),this.builders.clear()}pause(){return this.builders.forEach(t=>{t&&t.pause()}),this}recover(){return this.builders.forEach(t=>{t&&t.recover()}),this}static emitMethod(t,e,r){Nn.dispatch(t,e,r)}static activeListener(t){We.InternalMsgEmitter.on(zt.ActiveMethod,t)}static unmountActiveListener(t){We.InternalMsgEmitter.off(zt.ActiveMethod,t)}}class lL{constructor(t){G(this,"master"),G(this,"mainThreadWorkerMap",new Map),this.master=t}updateCamera(){for(const[t,e]of this.mainThreadWorkerMap.entries()){const r=this.master.control.viewContainerManager.getView(t);if(r){const{cameraOpt:i}=r;e.updateCamera({cameraOpt:i,viewId:r.viewId,msgType:pt.UpdateCamera,dataType:kt.Local})}}}notifyDrawCount(t){const e=this.master.getFullWorkDrawCount(),r=this.mainThreadWorkerMap.get(t);r&&r.clearDrawLayer(e)}clearDrawCount(t){const e=this.mainThreadWorkerMap.get(t);e&&e.clearDrawLayer(1/0)}createMainThreadWorker(t,e){return new uL(t,e,this)}consume(t){var e;for(const r of t.values()){const{msgType:i,viewId:o,layerOpt:s,offscreenCanvasOpt:a,cameraOpt:l}=r;if(i===pt.Console){console.log(this);continue}if(i===pt.Init){const p=(e=this.master.control.viewContainerManager.getView(o))==null?void 0:e.displayer,c=p?.subLocalCanvasContainerRef.current;if(p&&c&&s&&a){const g=this.createMainThreadWorker(o,{displayer:p,container:c,layerOpt:s,master:this.master,canvasOpt:a,post:this.post.bind(this)});this.mainThreadWorkerMap.set(o,g),g&&l&&g.setCameraOpt(l)}continue}if(i===pt.TasksQueue)continue;const u=this.mainThreadWorkerMap.get(o);u&&(u.on(r),i===pt.Destroy&&(u.destroy(),this.mainThreadWorkerMap.delete(o)))}}post(t){const{sp:e}=t;e&&this.master.collectorSyncData(e)}destroy(){for(const t of this.mainThreadWorkerMap.values())t.destroy();this.mainThreadWorkerMap.clear()}active(){}}class uL{constructor(t,e,r){G(this,"viewId"),G(this,"opt"),G(this,"manager"),G(this,"subLocalLayer"),G(this,"subLocalWork"),G(this,"scene"),G(this,"cameraOpt"),this.viewId=t,this.opt=e,this.manager=r,this.scene=this.createScene({...e.canvasOpt,container:e.container});const i=me.bufferSize.full,o=me.bufferSize.sub;this.subLocalLayer=this.createLayer("subLocalLayer",this.scene,{...e.layerOpt,bufferSize:this.viewId===ce?i:o,contextType:"2d"});const s={thread:this};this.subLocalWork=new cL(s)}createScene(t){return new Dd({displayRatio:this.opt.displayer.dpr,depth:!1,desynchronized:!0,...t,contextType:"2d",autoRender:!0,id:this.viewId})}createLayer(t,e,r){const{width:i,height:o}=r,s=`canvas-${t}`,a=e.layer(s,{...r,offscreen:!1}),l=new Ze({anchor:[.5,.5],pos:[i*.5,o*.5],size:[i,o],name:"viewport",id:t});return a.append(l),l}updateScene(t){this.scene.attr({...t});const{width:e,height:r}=t;this.scene.width=e,this.scene.height=r,this.updateLayer({width:e,height:r})}updateLayer(t){const{width:e,height:r}=t;this.subLocalLayer.parent.setAttribute("width",e),this.subLocalLayer.parent.setAttribute("height",r),this.subLocalLayer.setAttribute("size",[e,r]),this.subLocalLayer.setAttribute("pos",[e*.5,r*.5])}updateDpr(t){this.scene.displayRatio=t}on(t){const{msgType:e,toolsType:r,opt:i,dataType:o,workId:s,workState:a}=t,l=s?.toString();switch(e){case pt.Destroy:this.destroy();break;case pt.Clear:this.clearAll();break;case pt.UpdateDpr:Pt.isNumber(t.dpr)&&this.updateDpr(t.dpr);break;case pt.UpdateCamera:this.updateCamera(t);break;case pt.UpdateTools:if(r&&this.subLocalWork.canUseSubWorkerLayer(r)&&i){const u={toolsType:r,toolsOpt:i};this.subLocalWork.setToolsOpt(u)}break;case pt.CreateWork:l&&i&&r&&this.subLocalWork.canUseSubWorkerLayer(r)&&(this.subLocalWork.getToolsOpt()||this.subLocalWork.setToolsOpt({toolsType:r,toolsOpt:i}),this.subLocalWork.setWorkOptions(l,i));break;case pt.DrawWork:r&&this.subLocalWork.canUseSubWorkerLayer(r)&&(a===Tt.Done&&o===kt.Local?this.subLocalWork.consumeDrawAll(t):this.subLocalWork.consumeDraw(t));break;case pt.RemoveNode:this.subLocalWork.removeNode(t);return}}setCameraOpt(t){this.cameraOpt=t;const{scale:e,centerX:r,centerY:i,width:o,height:s}=t;(o!==this.scene.width||s!==this.scene.height)&&this.updateScene({width:o,height:s}),this.subLocalLayer&&(this.subLocalLayer.setAttribute("scale",[e,e]),this.subLocalLayer.setAttribute("translate",[-r,-i]))}updateCamera(t){const{cameraOpt:e}=t;e&&!Pt.isEqual(this.cameraOpt,e)&&(this.subLocalWork.workShapes.size&&this.clearAll(),this.setCameraOpt(e))}clearAll(){this.subLocalLayer.children.length&&(this.subLocalLayer.parent.children.forEach(t=>{t.name!=="viewport"&&t.remove()}),sn(this.subLocalLayer,this.subLocalLayer.parent)),this.subLocalWork.clearAll()}destroy(){this.subLocalLayer.remove(),mn(this.subLocalLayer,this.subLocalLayer.parent),this.scene.remove(),this.subLocalWork.destroy()}clearDrawLayer(t){if(t===1/0){this.clearAll();return}const e=this.subLocalLayer.children.filter(r=>r.id&&Pt.isNumber(parseInt(r.id))&&parseInt(r.id)<t);for(const r of e)r.remove(),mn(r,this.subLocalLayer.parent)}}class cL{constructor(t){G(this,"thread"),G(this,"workShapes",new Map),G(this,"tmpOpt"),G(this,"syncUnitTime",me.syncOpt.interval),G(this,"subWorkerDrawCount",0),this.thread=t.thread}getToolsOpt(){return this.tmpOpt}consumeDrawAll(t){const{workId:e}=t,r=e?.toString();r&&this.workShapes.get(r)&&(this.subWorkerDrawCount=0,sn(this.thread.subLocalLayer,this.thread.subLocalLayer.parent),this.clearWorkShapeNodeCache(r))}consumeDraw(t){const{workId:e,toolsType:r,postCount:i}=t;e&&r&&this.canUseSubWorkerLayer(r)&&(this.getWorkShape(e.toString())||this.createLocalWork(t));const o=e?.toString(),s=o&&this.workShapes.get(o);if(!s)return;s.consume({data:t,drawCount:this.subWorkerDrawCount,isFullWork:!1,isSubWorker:!0}),this.subWorkerDrawCount++;const a=this.thread.manager.master;a.setSubWorkerDrawCount(this.subWorkerDrawCount);const l=Math.max(a.getMaxDrawCount(),this.subWorkerDrawCount);a.setMaxDrawCount(l),Pt.isNumber(i)&&a.setConsumeCount(i)}removeNode(t){const{workId:e}=t,r=e?.toString();r&&this.workShapes.has(r)&&(this.thread.subLocalLayer.getElementsByName(r).forEach(i=>{i.remove()}),this.clearWorkShapeNodeCache(r))}createLocalWork(t){const{workId:e,toolsType:r,opt:i}=t,o=e?.toString();r&&this.canUseSubWorkerLayer(r)&&o&&i&&(this.getToolsOpt()||this.setToolsOpt({toolsType:r,toolsOpt:i}),this.setWorkOptions(o,i))}setWorkOptions(t,e){let r=this.workShapes.get(t);if(!r&&this.tmpOpt){const{toolsType:i}=this.tmpOpt;this.tmpOpt.toolsOpt=e,r=this.createWorkShapeNode({workId:t,toolsType:i,toolsOpt:e}),r&&this.workShapes.set(t,r),this.setToolsOpt(this.tmpOpt)}e!=null&&e.syncUnitTime||(e.syncUnitTime=this.syncUnitTime),r&&r.setWorkOptions(e)}destroy(){this.clearAll()}clearAll(){sn(this.thread.subLocalLayer,this.thread.subLocalLayer.parent),this.workShapes.clear()}canUseSubWorkerLayer(t){return t===nt.Pencil}setToolsOpt(t){var e;this.tmpOpt=t,(e=t.toolsOpt)!=null&&e.syncUnitTime&&(this.syncUnitTime=t.toolsOpt.syncUnitTime)}createWorkShapeNode(t){return lh({...t,fullLayer:this.thread.subLocalLayer,drawLayer:this.thread.subLocalLayer})}clearWorkShapeNodeCache(t){this.workShapes.delete(t)}getWorkShape(t){return this.workShapes.get(t)}}const hL=async(n,t)=>{const{src:e,isgl:r}=n;if(typeof Image=="function"){const i=new Image;return typeof e=="string"&&(i.crossOrigin="anonymous"),new Promise(o=>{i.onload=function(){createImageBitmap(i,{imageOrientation:r?"flipY":"none"}).then(s=>{o(s)})},i.onerror=function(){o(void 0)},i.src=e})}else return fetch(e,{method:"GET",mode:"cors",cache:"default"}).then(i=>i.blob()).then(i=>createImageBitmap(i,{imageOrientation:r?"flipY":"none"}).then(o=>o))};class fL{get now(){var t;return((t=this.control.room)==null?void 0:t.calibrationTimestamp)||Date.now()}get newWorkId(){return this.now.toString()}setCurrentToolsData(t){this.currentToolsData=t}getCurrentToolsData(){return this.currentToolsData}setCurrentLocalWorkData(t){this.currentLocalWorkData=t}getWorkId(){return this.currentLocalWorkData.workId}get workState(){return this.currentLocalWorkData.workState}}class dL extends fL{constructor(t){super(),G(this,"maxLastSyncTime",me.syncOpt.interval),G(this,"combineUnitTime",me.bezier.combineUnitTime),G(this,"maxCombineEraserTime",me.pencilEraser.maxCombineTime),G(this,"smoothSync",me.syncOpt.smoothSync),G(this,"isActive",!1),G(this,"currentToolsData"),G(this,"currentLocalWorkData"),G(this,"control"),G(this,"internalMsgEmitter"),G(this,"publicMsgEmitter"),G(this,"taskBatchData",new Set),G(this,"fullWorker"),G(this,"subWorker"),G(this,"fullWorkerUrl"),G(this,"subWorkerUrl"),G(this,"methodBuilder"),G(this,"zIndexNodeMethod"),G(this,"subWorkerDrawCount",0),G(this,"fullWorkerDrawCount",0),G(this,"maxDrawCount",0),G(this,"_consumeCount",0),G(this,"_postCount",0),G(this,"reRenders",new Map),G(this,"localWorkViewId"),G(this,"localPointsBatchData",new Map),G(this,"tasksqueue",new Map),G(this,"useTasksqueue",!1),G(this,"useTasksClockId"),G(this,"mainTasksqueueCount"),G(this,"workerTasksqueueCount"),G(this,"snapshotMap",new Map),G(this,"boundingRectMap",new Map),G(this,"clearAllResolveMap",new Map),G(this,"delayWorkStateToDoneResolve"),G(this,"animationId"),G(this,"tmpImageConfigMap",new Map),G(this,"mainThread"),G(this,"willSelectorWorkId"),G(this,"isLockSentEventCursor",!1),G(this,"subMainThreadWorker"),G(this,"getVNodeInfoResolveMap",new Map),G(this,"isLocalWorkActive",!1);const{control:e,internalMsgEmitter:r,publicMsgEmitter:i}=t;this.control=e,this.maxLastSyncTime=this.control.pluginOptions.extras.syncOpt.interval,this.combineUnitTime=this.control.pluginOptions.extras.bezier.combineUnitTime||this.combineUnitTime,this.smoothSync=Pt.isBoolean(this.control.pluginOptions.extras.syncOpt.smoothSync)?this.control.pluginOptions.extras.syncOpt.smoothSync:this.smoothSync,this.maxCombineEraserTime=this.control.pluginOptions.extras.pencilEraser.maxCombineTime||this.maxCombineEraserTime,this.fullWorkerUrl=this.control.pluginOptions.cdn.fullWorkerUrl||"",this.subWorkerUrl=this.control.pluginOptions.cdn.subWorkerUrl||"",this.internalMsgEmitter=r,this.publicMsgEmitter=i,this.currentLocalWorkData={workState:Tt.Pending}}get isBezier(){return this.control.pluginOptions.extras.bezier.enable}destroy(){var t,e,r;(t=this.methodBuilder)==null||t.destroy(),this.unWritable(),this.taskBatchData.clear(),this.tasksqueue.clear(),this.tmpImageConfigMap.clear(),this.localPointsBatchData.clear(),this.isActive=!1,this.clearAllResolveMap.clear(),this.snapshotMap.clear(),this.boundingRectMap.clear(),(e=this.fullWorker)==null||e.terminate(),(r=this.subWorker)==null||r.terminate()}get consumeCount(){return this._consumeCount}set consumeCount(t){this._consumeCount=t}get postCount(){return this._postCount}set postCount(t){this._postCount=t}get viewContainerManager(){return this.control.viewContainerManager}get collector(){return this.control.collector}get isRunSubWork(){var t;const e=(t=this.currentToolsData)==null?void 0:t.toolsType;return e===nt.Pencil||e===nt.PencilEraser||e===nt.BitMapEraser||e===nt.LaserPen||e===nt.Arrow||e===nt.Straight||e===nt.Ellipse||e===nt.Rectangle||e===nt.Star||e===nt.Polygon||e===nt.SpeechBalloon||e===nt.Selector}get isCanDrawWork(){var t;const e=(t=this.currentToolsData)==null?void 0:t.toolsType;return e===nt.Pencil||e===nt.LaserPen||e===nt.Arrow||e===nt.Straight||e===nt.Ellipse||e===nt.Rectangle||e===nt.Star||e===nt.Polygon||e===nt.SpeechBalloon||e===nt.Triangle||e===nt.Rhombus||e===nt.BitMapEraser||e===nt.PencilEraser}get isUseZIndex(){var t;const e=(t=this.currentToolsData)==null?void 0:t.toolsType;return e===nt.Pencil||e===nt.Arrow||e===nt.Straight||e===nt.Ellipse||e===nt.Rectangle||e===nt.Star||e===nt.Polygon||e===nt.SpeechBalloon||e===nt.Text||e===nt.Image}get isCanRecordUndoRedo(){var t;const e=(t=this.currentToolsData)==null?void 0:t.toolsType;return e===nt.Pencil||e===nt.Eraser||e===nt.PencilEraser||e===nt.BitMapEraser||e===nt.Arrow||e===nt.Straight||e===nt.Ellipse||e===nt.Rectangle||e===nt.Star||e===nt.Polygon||e===nt.SpeechBalloon||e===nt.Text||e===nt.Image}get isCanSentCursor(){var t;const e=(t=this.currentToolsData)==null?void 0:t.toolsType;return e===nt.Pencil||e===nt.Text||e===nt.LaserPen||e===nt.Arrow||e===nt.Straight||e===nt.Ellipse||e===nt.Rectangle||e===nt.Star||e===nt.Polygon||e===nt.SpeechBalloon||e===nt.Triangle||e===nt.Rhombus||e===nt.Eraser||e===nt.PencilEraser||e===nt.BitMapEraser||e===nt.Selector}get isPostCountType(){var t;const e=(t=this.currentToolsData)==null?void 0:t.toolsType;return e===nt.Pencil||e===nt.Arrow||e===nt.Straight||e===nt.Ellipse||e===nt.Rectangle||e===nt.Star||e===nt.Polygon||e===nt.SpeechBalloon||e===nt.Triangle||e===nt.Rhombus||e===nt.Eraser||e===nt.PencilEraser||e===nt.BitMapEraser||e===nt.Selector}get isCanPostDraw(){var t;const e=(t=this.currentToolsData)==null?void 0:t.toolsType;return e===nt.Pencil||e===nt.PencilEraser||e===nt.BitMapEraser}get isCanStartEventConsum(){var t;const e=(t=this.currentToolsData)==null?void 0:t.toolsType;return e===nt.Selector||e===nt.Eraser||e===nt.PencilEraser||e===nt.BitMapEraser}async init(){this.destroy(),await this.on(),this.internalMsgEmitterListener(),this.isActive=!0}async useMainThread(){console.info("no OffscreenCanvas");const{MainThreadManagerImpl:t}=await c0(async()=>{const{MainThreadManagerImpl:e}=await import("./index-BZCUBik5-DQfgFNwz.js");return{MainThreadManagerImpl:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]));this.mainThread=new t(this)}async on(){if(!this.control.hasOffscreenCanvas()){await this.useMainThread();return}if(!this.fullWorkerUrl||!this.subWorkerUrl){console.error("no worker url config");return}this.fullWorker=new Worker(this.fullWorkerUrl,{type:"classic"}),this.subWorker=new Worker(this.subWorkerUrl,{type:"classic"}),this.subMainThreadWorker=new lL(this),this.fullWorker.onmessage=t=>{var e,r;if(t.data){const{render:i,sp:o,fullWorkerDrawCount:s,workerTasksqueueCount:a,viewId:l,consumeCount:u}=t.data;u&&(this.consumeCount=u),this.isBusy&&a&&this.setWorkerTasksqueueCount(a),o!=null&&o.length&&this.collectorSyncData(o);const p=i?.length&&i||[];if(s&&l){if(this.fullWorkerDrawCount=s,this.fullWorkerDrawCount<1/0){const c=Math.max(this.maxDrawCount,this.fullWorkerDrawCount);this.setMaxDrawCount(c),this.control.priority==="ui"?(e=this.subMainThreadWorker)==null||e.notifyDrawCount(l):this.clearReRenders(this.fullWorkerDrawCount)}else this.setMaxDrawCount(0),this.control.priority==="ui"?(r=this.subMainThreadWorker)==null||r.clearDrawCount(l):this.clearReRenders(1/0);if(this.reRenders.size)for(const c of this.reRenders.values())p.push(...c)}p.length&&this.viewContainerManager.render(p)}},this.subWorker.onmessage=t=>{if(t.data){const{render:e,sp:r,subWorkerDrawCount:i,consumeCount:o}=t.data;o&&(this.consumeCount=o),r!=null&&r.length&&this.collectorSyncData(r);const s=e?.length&&e||[];if(this.control.priority==="cpu"&&Pt.isNumber(i)){if(this.subWorkerDrawCount=i,this.fullWorkerDrawCount<1/0){const a=Math.max(this.maxDrawCount,this.subWorkerDrawCount);this.setMaxDrawCount(a)}if(e!=null&&e.length)if(this.subWorkerDrawCount>this.fullWorkerDrawCount){const a=[];for(const l of e)l.imageBitmap&&(l.isUnClose=!0,a.push(l));this.reRenders.set(this.subWorkerDrawCount,a)}else this.reRenders.size&&this.clearReRenders(this.subWorkerDrawCount)}s.length&&this.viewContainerManager.render(s)}}}clearReRenders(t=1/0){for(const e of this.reRenders.keys())if(Pt.isNumber(Number(e))&&Number(e)<=t){const r=this.reRenders.get(Number(e));r?.forEach(i=>{var o;(o=i.imageBitmap)==null||o.close()}),this.reRenders.delete(e)}}get isBusy(){return this.getTasksqueueState()===Tt.Doing}getLockSentEventCursor(){return this.isLockSentEventCursor}setLockSentEventCursor(t){this.isLockSentEventCursor=t}getTasksqueueState(){return this.useTasksqueue&&Tt.Doing||Tt.Done}setMaxDrawCount(t){this.maxDrawCount=t}getFullWorkDrawCount(){return this.fullWorkerDrawCount}getMaxDrawCount(){return this.maxDrawCount}setSubWorkerDrawCount(t){this.subWorkerDrawCount=t}setConsumeCount(t){this.consumeCount=t}getConsumeCount(){return this.consumeCount}setWorkerTasksqueueCount(t){const e=Math.max(this.workerTasksqueueCount||0,t);this.workerTasksqueueCount=e}collectorSyncData(t){var e,r,i,o;let s=!1;for(const a of t){const{type:l,selectIds:u,opt:p,selectRect:c,strokeColor:g,fillColor:v,willSyncService:I,isSync:w,imageBitmap:y,canvasHeight:T,canvasWidth:h,rect:m,op:d,canTextEdit:M,points:x,selectorColor:E,canRotate:P,scaleType:R,textOpt:N,toolsType:b,workId:j,viewId:O,dataType:L,canLock:k,isLocked:H,shapeOpt:Q,toolsTypes:_,thickness:st,strokeType:F,useStroke:Z,isgl:tt,imageSrc:ct,isSubWorker:at,updateNodeOpt:dt}=a;if(!O)return;const it=a.scenePath||this.viewContainerManager.getCurScenePath(O);switch(l){case pt.Select:{const ft=u!=null&&u.length?{...c,selectIds:u,canvasHeight:T,canvasWidth:h,points:x}:void 0;ft&&p!=null&&p.strokeColor&&(ft.selectorColor=p.strokeColor),ft&&E&&(ft.selectorColor=E),ft&&g&&(ft.strokeColor=g),ft&&p!=null&&p.fillColor&&(ft.fillColor=p.fillColor),ft&&v&&(ft.fillColor=v),ft&&Pt.isBoolean(P)&&(ft.canRotate=P),ft&&R&&(ft.scaleType=R),ft&&M&&(ft.canTextEdit=M),ft&&N&&(ft.textOpt=N),ft&&Pt.isBoolean(k)&&(ft.canLock=k),ft&&Pt.isBoolean(H)&&(ft.isLocked=H),ft&&Q&&(ft.shapeOpt=Q),ft&&_&&(ft.toolsTypes=_),ft&&st&&(ft.thickness=st),ft&&F&&(ft.strokeType=F),ft&&Pt.isBoolean(Z)&&(ft.useStroke=Z),O&&this.viewContainerManager.showFloatBar(O,!!ft,ft),I&&((e=this.collector)==null||e.dispatch({type:l,selectIds:u,opt:p,isSync:w,viewId:O,scenePath:it}));break}case pt.Snapshot:if(y&&it){const ft=this.snapshotMap.get(it);ft&&ft(y)}break;case pt.BoundingBox:if(m&&it){const ft=this.boundingRectMap.get(it);ft&&ft(m)}break;case pt.Cursor:d&&this.control.cursor.collectServiceCursor({...a});break;case pt.Clear:if(O){this.viewContainerManager.showFloatBar(O,!1);const ft=(r=this.clearAllResolveMap.get(O))==null?void 0:r.resolve;ft&&ft(O)}break;case pt.TextUpdate:if(b===nt.Text&&j&&O){const ft=this.viewContainerManager.transformToOriginPoint(p?.boxPoint||[0,0],O),wt=p?.boxSize||[0,0],U=(i=this.viewContainerManager.getView(O))==null?void 0:i.cameraOpt;p?this.control.textEditorManager.updateTextForWorker({x:ft[0],y:ft[1],w:wt[0],h:wt[1],scale:U?.scale||1,workId:j,opt:p,dataType:L,viewId:O,canSync:I||!1,canWorker:!1,updateNodeOpt:dt}):this.control.textEditorManager.delete(j,I||!1,!1)}break;case pt.GetTextActive:b===nt.Text&&j&&O&&this.control.textEditorManager.updateTextForWorker({workId:j,isActive:!0,viewId:O,dataType:kt.Local,canWorker:!1,canSync:!0},this.now);break;case pt.GetImageBitMap:ct&&O&&j&&hL({src:ct,isgl:tt}).then(ft=>{var wt;const U=new Set;if(U.add({msgType:pt.GetImageBitMap,dataType:kt.Local,workId:j,viewId:O,imageSrc:ct,isSubWorker:at,imageBitmap:ft}),!this.control.hasOffscreenCanvas())(wt=this.mainThread)==null||wt.consume(U);else{const Y=at?this.subWorker:this.fullWorker;ft?Y.postMessage(U,[ft]):Y.postMessage(U)}});break;case pt.GetVNodeInfo:if(j){const ft=j.toString(),wt=(o=this.getVNodeInfoResolveMap.get(ft))==null?void 0:o.resolve,U={...a,uuid:ft};wt&&wt(U)}break;default:s=!0;break}}s&&this.collectorAsyncData(t)}collectorAsyncData(t){var e,r,i,o;for(const s of t){const{type:a,op:l,workId:u,index:p,removeIds:c,ops:g,opt:v,updateNodeOpt:I,toolsType:w,isSync:y,viewId:T,isLockSentEventCursor:h,nextTasks:m}=s;if(!T){console.error("[MasterControlForWorker] collectorAsyncData on viewId in",s);return}const d=s.scenePath||this.viewContainerManager.getCurScenePath(T);switch(a){case pt.None:{h&&Gn(()=>{this.setLockSentEventCursor(!1)},this.maxLastSyncTime);break}case pt.DrawWork:{(e=this.collector)==null||e.dispatch({type:a,op:l,opt:v,toolsType:w,workId:u,index:p,isSync:y,viewId:T,scenePath:d,updateNodeOpt:I});break}case pt.FullWork:{(r=this.collector)==null||r.dispatch({type:a,ops:g,workId:u,updateNodeOpt:I,opt:v,toolsType:w,isSync:y,viewId:T,scenePath:d}),this.willSelectorWorkId&&u&&u.toString()===this.willSelectorWorkId&&this.control.runEffectWork(()=>{this.setShapeSelectorByWorkId(this.willSelectorWorkId,T),this.willSelectorWorkId=void 0});break}case pt.UpdateNode:{(i=this.collector)==null||i.dispatch({type:a,updateNodeOpt:I,workId:u,opt:v,ops:g,op:l,isSync:y,viewId:T,scenePath:d});break}case pt.RemoveNode:{c&&this.control.textEditorManager.deleteBatch(c,!1,!1),(o=this.collector)==null||o.dispatch({type:a,removeIds:c,isSync:y,viewId:T,scenePath:d}),this.willSelectorWorkId&&c!=null&&c.includes(this.willSelectorWorkId)&&(this.willSelectorWorkId=void 0);break}}m&&this.collectorAsyncData(m)}}async onLocalEventEnd(t,e){var r;const i=this.viewContainerManager.getView(e);if(!i)return;const{focusScenePath:o,cameraOpt:s}=i,a=this.viewContainerManager.transformToScenePoint(t,e),l=[];for(const u of this.localPointsBatchData.keys())if(((r=this.currentToolsData)==null?void 0:r.toolsType)===nt.Text){const p=this.getLocalPointInfo(u),c=p?.state;if(c&&c===Tt.Start){const g=this.currentLocalWorkData.toolsOpt;g.workState=Tt.Doing,g.boxPoint=a,g.boxSize=[g.fontSize,g.fontSize],this.control.textEditorManager.checkEmptyTextBlur(),this.control.textEditorManager.createTextForMasterController({workId:this.newWorkId,x:t[0],y:t[1],scale:s?.scale||1,opt:g,type:jn.Text,isActive:!0,viewId:e,scenePath:o},this.now)}this.deleteLocalPoint(u);continue}else this.pushLocalPoint(u,a,Tt.Done,e),l.push(u);if(l.length){try{if(await new Promise(u=>{setTimeout(async()=>{l.forEach(p=>{this.setLocalPointIsFullWork(p)}),this.delayWorkStateToDoneResolve=u,this.consume()},0)})&&l[0]){const u=l[0];l.forEach(p=>{this.deleteLocalPoint(p)}),this.willSelectorWorkId=u.toString()}}catch(u){console.error("[MasterControlForWorker] onLocalEventEnd error:",u)}this.delayWorkStateToDoneResolve=void 0,l.length=0}}onLocalEventDoing(t,e){var r;if(((r=this.currentToolsData)==null?void 0:r.toolsType)===nt.Text)return;this.currentLocalWorkData.workState===Tt.Start&&this.setCurrentLocalWorkData({...this.currentLocalWorkData,workState:Tt.Doing});let i=!1;for(const[o,{state:s}]of this.localPointsBatchData.entries())if(this.isAbled()&&s!==Tt.Pending){const a=this.viewContainerManager.transformToScenePoint(t,e);this.pushLocalPoint(o,a,s===Tt.Start?Tt.Doing:s,e),i=!0}if(i){this.runAnimation();return}}onLocalEventStart(t,e){var r,i,o;this.viewContainerManager.focuedViewId!==e&&this.viewContainerManager.setFocuedViewId(e),this.isCanDrawWork&&this.control.room&&!this.control.room.disableDeviceInputs&&(this.control.room.disableDeviceInputs=!0);const s=(r=this.currentToolsData)==null?void 0:r.toolsType,a=s===nt.Selector?Xt:this.newWorkId,l=this.setZIndex(e);this.setCurrentLocalWorkData({workState:Tt.Start,toolsOpt:l,viewId:e});const u=this.viewContainerManager.transformToScenePoint(t,e);if(this.pushLocalPoint(a,u,Tt.Start,e,l),s!==nt.Text){if(this.control.textEditorManager.checkEmptyTextBlur(),this.isCanRecordUndoRedo&&this.internalMsgEmitter.emit("addUndoTicker",a,e),a&&l&&s&&this.isCanStartEventConsum&&this.prepareOnceWork({workId:a,toolsOpt:l,viewId:e},s),this.consumeCount=0,this.postCount=0,this.maxDrawCount=0,this.fullWorkerDrawCount=0,this.subWorkerDrawCount=0,this.clearReRenders(1/0),(i=this.subMainThreadWorker)==null||i.clearDrawCount(e),this.isCanDrawWork){const p=this.viewContainerManager.getCurScenePath(e);p&&(o=this.collector)!=null&&o.hasSelector(e,p)&&this.blurSelector(e,p)}this.consume()}}setLocalPointIsFullWork(t){const e=this.getLocalPointInfo(t);e&&(e.isFullWork=!0,this.localPointsBatchData.set(t,e))}pushLocalPoint(t,e,r,i,o){let s=this.getLocalPointInfo(t);r===Tt.Start?s={state:Tt.Start,points:e,opt:o||this.currentLocalWorkData.toolsOpt,isFullWork:!1,viewId:i}:s&&(s.state=r,s.points.push(e[0],e[1])),s&&this.localPointsBatchData.set(t,s)}deleteLocalPoint(t){this.localPointsBatchData.delete(t)}getLocalPointInfo(t){return this.localPointsBatchData.get(t)}getLocalPointsInfo(){return this.localPointsBatchData}correctStorage(t,e,r){var i;const o=new Map,s=[];Object.keys(t).forEach(l=>{var u,p;const c=(p=(u=t[l])==null?void 0:u.opt)==null?void 0:p.zIndex;Pt.isNumber(c)&&s.push([l,c])});const a=s.length&&((i=this.zIndexNodeMethod)==null?void 0:i.correct(s))||[];this.zIndexNodeMethod&&a.length&&(this.zIndexNodeMethod.setMinZIndex(a[0][1]||0,e),this.zIndexNodeMethod.setMaxZIndex(a[a.length-1][1]||0,e));for(const[l,u]of a){if(!t[l])continue;const p=t[l];p.opt&&Pt.isNumber(p.opt.zIndex)&&p.opt.zIndex!==u&&(p.opt.zIndex=u,o.set(l,p))}return o.size&&o.forEach((l,u)=>{var p;(p=this.collector)==null||p.updateValue(u,l,{viewId:e,scenePath:r,isSync:!0}),t[u]=l}),t}async originalEventLintener(t,e,r){var i,o,s;if(!this.isAbled())return;const a=(i=this.collector)==null?void 0:i.uid,l=this.viewContainerManager.getCurScenePath(r);if(a&&!this.control.renderControl.isWritable)return;const u=((o=this.currentToolsData)==null?void 0:o.toolsType)===nt.Selector;switch((s=this.currentToolsData)==null?void 0:s.toolsType){case nt.Eraser:case nt.PencilEraser:case nt.BitMapEraser:{if(a&&!this.control.renderControl.isClearAble({uid:a,viewId:r,scenePath:l}))return;break}default:{if(a&&!this.control.renderControl.isRenderAble({uid:a,viewId:r,scenePath:l}))return;break}}switch(Gn(()=>{this.control.pluginManager.dispatchPluginEvent("localEvent",r,t,e)},pv,this.control.hasPolyfillMethod("requestIdleCallback")),t){case Tt.Start:this.isLocalWorkActive=!0,this.setLocalWorkViewId(r),r&&this.onLocalEventStart(e,r),u&&this.viewContainerManager.showFloatBarBtn(r,!1);break;case Tt.Doing:r&&r===this.getLocalWorkViewId()&&this.onLocalEventDoing(e,r);break;case Tt.Done:r&&r===this.getLocalWorkViewId()&&(this.setCurrentLocalWorkData({...this.currentLocalWorkData,workState:Tt.Done}),await this.onLocalEventEnd(e,r),setTimeout(()=>{this.isLocalWorkActive=!1,this.setCurrentLocalWorkData({workState:Tt.Pending}),u&&this.viewContainerManager.showFloatBarBtn(r,!0),this.setLocalWorkViewId(void 0)},0));break}this.isLocalWorkActive&&this.viewContainerManager.focuedViewId===r&&this.publicMsgEmitter.emit("workState",t,r)}getLocalWorkViewId(){return this.localWorkViewId}setLocalWorkViewId(t){this.localWorkViewId=t}setCurrentToolsData(t){var e,r,i;const o=t.toolsType,s=((e=this.currentToolsData)==null?void 0:e.toolsType)!==t.toolsType;if(super.setCurrentToolsData(t),s){const a=(r=this.viewContainerManager)==null?void 0:r.getAllViews();for(const l of a)if(l){const{id:u,focusScenePath:p}=l;s&&u&&p&&((i=this.collector)!=null&&i.hasSelector(u,p)&&this.blurSelector(u,p),this.control.textEditorManager.checkEmptyTextBlur())}this.taskBatchData.add({msgType:pt.UpdateTools,dataType:kt.Local,toolsType:o,opt:{...t.toolsOpt,syncUnitTime:this.maxLastSyncTime},combineUnitTime:this.isBezier?this.combineUnitTime:1/0,maxCombineEraserTime:this.maxCombineEraserTime,isRunSubWork:this.isRunSubWork,viewId:Al}),this.runAnimation()}}prepareOnceWork(t,e){const{workId:r,toolsOpt:i,viewId:o}=t,s={msgType:pt.CreateWork,dataType:kt.Local,viewId:o,toolsType:e};this.queryTaskBatchData(s).forEach(a=>{this.taskBatchData.delete(a)}),this.taskBatchData.add({...s,workId:r,opt:{...i,syncUnitTime:this.maxLastSyncTime},dataType:kt.Local,isRunSubWork:this.isRunSubWork}),this.runAnimation()}createViewWorker(t,e){const{offscreenCanvasOpt:r,layerOpt:i,dpr:o,cameraOpt:s}=e;this.taskBatchData.add({msgType:pt.Init,dataType:kt.Local,viewId:t,offscreenCanvasOpt:r,layerOpt:i,dpr:o,cameraOpt:s,isRunSubWork:!0,isSafari:navigator.userAgent.indexOf("Safari")!==-1&&navigator.userAgent.indexOf("Chrome")===-1,combineUnitTime:this.isBezier?this.combineUnitTime:1/0,maxCombineEraserTime:this.maxCombineEraserTime,syncUnitTime:this.maxLastSyncTime}),this.isBusy&&this.destroyTaskQueue(),this.consume()}destroyViewWorker(t,e=!1){var r;this.getLocalWorkViewId()===t&&this.setLocalWorkViewId(void 0),this.zIndexNodeMethod&&this.zIndexNodeMethod.clearZIndex(t),this.taskBatchData.add({msgType:pt.Destroy,dataType:kt.Local,viewId:t,isRunSubWork:!0}),this.consume(),e||(r=this.collector)==null||r.dispatch({type:pt.Clear,viewId:t}),this.control.renderControl.destoryByViewId(t,e)}onServiceDerive(t,e){var r,i,o,s,a,l,u,p;const{newValue:c,oldValue:g,viewId:v,scenePath:I}=e,w=Pt.cloneDeep(c)||{},y=t;let T=w.type;if(!c&&g){if(y&&((r=this.collector)==null?void 0:r.getLocalId(y))===Xt){this.collector.isOwn(y)?this.blurSelector(v,I):this.blurSelector(v,I,y);return}if(T=pt.RemoveNode,g.toolsType===nt.LaserPen)return}const h=(i=this.viewContainerManager.getView(v))==null?void 0:i.focusScenePath;if(h&&h!==I)return;if((o=this.collector)!=null&&o.isSelector(t)){const d=(s=this.collector)==null?void 0:s.getUidFromKey(t);if(d&&!this.control.roomMember.isOnLine(d))return}if(T&&y){if(!this.control.renderControl.isFilterAble({viewId:v,elementId:t,scenePath:I},T))return;const d=w;if(d.workId=(a=this.collector)!=null&&a.isOwn(y)?(l=this.collector)==null?void 0:l.getLocalId(y):y,d.msgType=T,d.toolsType===nt.LaserPen&&(d.isRunSubWork=!0),d.dataType=kt.Service,d.viewId=v,d.scenePath=I,d.useAnimation=this.smoothSync&&((u=d.updateNodeOpt)==null?void 0:u.useAnimation)||!1,d.selectIds&&(d.selectIds=d.selectIds.map(M=>{var x,E;return(x=this.collector)!=null&&x.isOwn(M)?(E=this.collector)==null?void 0:E.getLocalId(M):M})),d&&d.toolsType===nt.Text||g?.toolsType===nt.Text){this.control.textEditorManager.onServiceDerive(d);return}d.isEnableCursor=this.control.cursor.isEnableCursor,this.taskBatchData.add(d)}this.runAnimation();const m=e.newValue&&((p=e.newValue.opt)==null?void 0:p.zIndex);if(this.zIndexNodeMethod&&Pt.isNumber(m)){const d=this.zIndexNodeMethod.getMinZIndex(v);this.zIndexNodeMethod.getMaxZIndex(v)<m&&this.zIndexNodeMethod.setMaxZIndex(m,v),d>m&&this.zIndexNodeMethod.setMinZIndex(m,v)}}pullServiceData(t,e,r={isAsync:!1,useAnimation:!1}){var i,o,s,a,l,u,p;let c=(i=this.collector)==null?void 0:i.getStorageData(t,e);const{isAsync:g,useAnimation:v}=r;if(c){this.control.renderControl.isWritable&&(c=this.correctStorage(c,t,e));const I=Object.keys(c);for(const w of I){if((o=this.collector)!=null&&o.isSelector(w)){const T=(s=this.collector)==null?void 0:s.getUidFromKey(w);if(T&&!this.control.roomMember.isOnLine(T))continue}const y=(a=c[w])==null?void 0:a.type;if(y&&w){if(!this.control.renderControl.isFilterAble({viewId:t,elementId:w,scenePath:e},y))continue;const T=c[w];if(T.workId=(l=this.collector)!=null&&l.isOwn(w)?(u=this.collector)==null?void 0:u.getLocalId(w):w,T.msgType=y,T.dataType=kt.Service,T.viewId=t,T.scenePath=e,T.useAnimation=this.smoothSync&&(T.ops?!!v:(p=T.updateNodeOpt)==null?void 0:p.useAnimation)||!1,T.selectIds&&(T.selectIds=T.selectIds.map(h=>{var m,d;return(m=this.collector)!=null&&m.isOwn(h)?(d=this.collector)==null?void 0:d.getLocalId(h):h})),T.toolsType===nt.Text){this.control.textEditorManager.onServiceDerive(T);continue}g&&T.updateNodeOpt&&T.updateNodeOpt.useAnimation&&(T.updateNodeOpt.useAnimation=!1),T.isEnableCursor=this.control.cursor.isEnableCursor,this.taskBatchData.add(T)}this.internalMsgEmitter.emit("excludeIds",I,t)}g?this.consume():this.runAnimation()}}runAnimation(){!this.animationId&&!this.isBusy&&(this.animationId=requestAnimationFrame(this.consume.bind(this)))}consume(){var t;this.animationId=void 0;const{viewId:e}=this.currentLocalWorkData;if(this.tasksqueue.size){const r=this.consumeQueue(),i=!!r.size;if(this.taskBatchData.size)for(const o of this.taskBatchData.values())o.dataType===kt.Service&&(r.add(o),this.taskBatchData.delete(o));r.size?(this.post(r),i&&this.tasksqueue.clear()):this.tasksqueue.size&&(this.animationId=requestAnimationFrame(this.consume.bind(this)));return}if(this.isAbled()&&this.localPointsBatchData.size&&e)for(const[r,{state:i,isFullWork:o,points:s,opt:a}]of this.localPointsBatchData.entries()){if(i===Tt.Done&&!o||i===Tt.Start&&!this.isCanStartEventConsum)continue;const l=s.map(u=>u);if(l.length){if(this.isPostCountType&&i===Tt.Doing){if(this.postCount>this.consumeCount)continue;this.postCount++}this.delayWorkStateToDoneResolve&&i===Tt.Done&&(this.delayWorkStateToDoneResolve(!0),this.setLockSentEventCursor(!0)),this.taskBatchData.add({op:l,workState:i,workId:r,dataType:kt.Local,msgType:pt.DrawWork,isRunSubWork:this.isRunSubWork,toolsType:(t=this.currentToolsData)==null?void 0:t.toolsType,viewId:e,scenePath:e&&this.viewContainerManager.getCurScenePath(e),opt:a,smoothSync:this.smoothSync,isLockSentEventCursor:this.getLockSentEventCursor(),syncUnitTime:this.maxLastSyncTime,disableEraseImage:this.control.disableEraseImage,disableEraseText:this.control.disableEraseText,postCount:this.isPostCountType&&this.postCount||void 0,fullWorkerDrawCount:this.isCanPostDraw&&this.fullWorkerDrawCount||void 0}),s.length=0}}this.taskBatchData.size&&(this.post(this.taskBatchData),this.taskBatchData.clear()),this.taskBatchData.size&&(this.animationId=requestAnimationFrame(this.consume.bind(this)))}unWritable(){this.setCurrentLocalWorkData({workState:Tt.Unwritable}),this.setLockSentEventCursor(!0)}abled(){this.setCurrentLocalWorkData({workState:Tt.Pending}),this.setLockSentEventCursor(!1)}isAbled(){return this.currentLocalWorkData.workState!==Tt.Unwritable}post(t){var e;if(!this.control.hasOffscreenCanvas()){if(!this.mainThread){let i=[];i=Pt.cloneDeep([...t]),setTimeout(()=>{for(const o of i)this.taskBatchData.add(o)},0);return}this.mainThread.consume(t);return}this.fullWorker.postMessage(t);const r=new Set;for(const i of t.values()){const o=i.msgType;(o===pt.Init||o===pt.Clear||o===pt.Destroy||o===pt.UpdateCamera||i.isRunSubWork)&&r.add(i)}r.size&&(this.subWorker.postMessage(r),this.control.priority==="ui"&&((e=this.subMainThreadWorker)==null||e.consume(r)))}updateNode(t,e,r,i){this.taskBatchData.add({msgType:pt.UpdateNode,workId:t,updateNodeOpt:e,viewId:r,scenePath:i,dataType:kt.Local}),this.runAnimation()}destroyTaskQueue(){this.useTasksqueue=!1,this.useTasksClockId&&(clearTimeout(this.useTasksClockId),this.useTasksClockId=void 0),this.mainTasksqueueCount=void 0,this.workerTasksqueueCount=void 0}updateDpr(t,e){this.queryTaskBatchData({msgType:pt.UpdateDpr,dataType:kt.Local,viewId:t}).forEach(r=>{this.taskBatchData.delete(r)}),this.taskBatchData.add({dataType:kt.Local,msgType:pt.UpdateDpr,viewId:t,dpr:e,isRunSubWork:!0}),this.runAnimation()}updateCamera(t,e){var r;this.useTasksqueue||((r=this.methodBuilder)==null||r.pause(),this.blurCursor(t),this.checkDrawingWork(t),this.useTasksqueue=!0,this.mainTasksqueueCount=1,this.workerTasksqueueCount=1),this.useTasksqueue&&(this.tasksqueue.set(t,{msgType:pt.UpdateCamera,dataType:kt.Local,cameraOpt:{...e,width:e.width,height:e.height},scenePath:this.viewContainerManager.getCurScenePath(t),isRunSubWork:!0,viewId:t}),this.consume(),this.useTasksClockId&&clearTimeout(this.useTasksClockId),this.updateCameraDone())}updateCameraDone(){this.useTasksClockId=setTimeout(()=>{var t,e;this.useTasksClockId=void 0,this.mainTasksqueueCount===this.workerTasksqueueCount?(this.tasksqueue.size&&this.consume(),this.useTasksqueue=!1,this.mainTasksqueueCount=void 0,this.workerTasksqueueCount=void 0,this.control.priority==="ui"&&((t=this.subMainThreadWorker)==null||t.updateCamera()),(e=this.methodBuilder)==null||e.recover(),this.runAnimation()):this.updateCameraDone()},this.maxLastSyncTime)}consumeQueue(){const t=new Set;let e=!this.isBusy;if(this.isBusy&&this.mainTasksqueueCount&&this.workerTasksqueueCount&&this.mainTasksqueueCount<=this.workerTasksqueueCount&&(e=!0),e){this.mainTasksqueueCount&&this.workerTasksqueueCount&&this.mainTasksqueueCount++,t.add({msgType:pt.TasksQueue,dataType:kt.Local,isRunSubWork:!0,mainTasksqueueCount:this.mainTasksqueueCount,tasksqueue:this.tasksqueue,viewId:""});for(const[r,i]of this.tasksqueue.entries())i.cameraOpt&&this.control.textEditorManager.onCameraChange(i.cameraOpt,r)}return t}async clearViewScenePath(t,e,r){var i,o;const s=this.viewContainerManager.getCurScenePath(t);if(r){const a=(i=this.collector)==null?void 0:i.uid;if(a&&!this.control.renderControl.isClearAble({uid:a,viewId:t,scenePath:s}))return}this.control.textEditorManager.clear(t,e),this.queryTaskBatchData({msgType:pt.Clear,dataType:kt.Local,viewId:t}).forEach(a=>{this.taskBatchData.delete(a)}),this.taskBatchData.add({dataType:kt.Local,msgType:pt.Clear,viewId:t}),this.runAnimation(),e||(this.control.renderControl.isUsePageAuth(t)&&s?this.control.renderControl.clearRenderPage(t,s):(o=this.collector)==null||o.dispatch({type:pt.Clear,viewId:t,scenePath:s})),this.zIndexNodeMethod&&this.zIndexNodeMethod.clearZIndex(t);for(const[a,l]of this.localPointsBatchData.entries())l.viewId===t&&this.localPointsBatchData.delete(a);await new Promise(a=>{const l=this.clearAllResolveMap.get(t)||{resolve:void 0,timer:void 0};l.timer&&clearTimeout(l.timer),l.resolve=a,l.timer=setTimeout(()=>{const u=this.clearAllResolveMap.get(t);u!=null&&u.resolve&&u.resolve(t)},this.maxLastSyncTime),this.clearAllResolveMap.set(t,l)}).then(a=>{this.clearAllResolveMap.delete(a)})}internalMsgEmitterListener(){var t;this.methodBuilder=new _t([zt.CopyNode,zt.SetColorNode,zt.DeleteNode,zt.RotateNode,zt.ScaleNode,zt.TranslateNode,zt.ZIndexNode,zt.SetFontStyle,zt.SetPoint,zt.SetLock,zt.SetShapeOpt]).registerForMainEngine(Ht.MainEngine,this.control),this.zIndexNodeMethod=(t=this.methodBuilder)==null?void 0:t.getBuilder(zt.ZIndexNode)}setZIndex(t){const e=this.currentToolsData&&Pt.cloneDeep(this.currentToolsData.toolsOpt);return e&&this.zIndexNodeMethod&&this.isUseZIndex&&(this.zIndexNodeMethod.addMaxLayer(t),e.zIndex=this.zIndexNodeMethod.getMaxZIndex(t)),e}checkDrawingWork(t){var e,r,i;let o=!1;const s=[];for(const[a,{state:l,viewId:u,points:p,opt:c}]of this.localPointsBatchData.entries())if(t===u&&l===Tt.Start||l===Tt.Doing){if(l===Tt.Doing&&this.isCanDrawWork){Number(a)&&Number(a)+60>this.now&&(s.push(a.toString()),this.taskBatchData.add({msgType:pt.RemoveNode,workId:a,viewId:u,dataType:kt.Local,isRunSubWork:!0}));const g=p.map(v=>v);this.taskBatchData.add({op:g,workState:Tt.Done,workId:a,dataType:kt.Local,msgType:pt.DrawWork,isRunSubWork:this.isRunSubWork,toolsType:(e=this.currentToolsData)==null?void 0:e.toolsType,viewId:u,opt:c,scenePath:u&&this.viewContainerManager.getCurScenePath(u)}),o=!0}this.deleteLocalPoint(a)}if((o||s.length)&&(this.consume(),s.length)){const a=(r=this.viewContainerManager.getView(t))==null?void 0:r.focusScenePath;(i=this.collector)==null||i.dispatch({type:pt.RemoveNode,removeIds:s,viewId:t,scenePath:a})}}removeDrawingWork(t){var e,r;const i=[];for(const[o,{state:s,viewId:a}]of this.localPointsBatchData.entries())(t===a&&s===Tt.Start||s===Tt.Doing)&&(this.deleteLocalPoint(o),s===Tt.Doing&&this.isCanDrawWork&&(i.push(o.toString()),this.taskBatchData.add({msgType:pt.RemoveNode,workId:o,viewId:a,dataType:kt.Local,isRunSubWork:!0})));if(i.length){this.consume();const o=(e=this.viewContainerManager.getView(t))==null?void 0:e.focusScenePath;(r=this.collector)==null||r.dispatch({type:pt.RemoveNode,removeIds:i,viewId:t,scenePath:o})}}removeNodes(t,e){var r,i;const o=(r=this.viewContainerManager.getView(t))==null?void 0:r.focusScenePath;if(o&&e.length){for(const s of e)this.taskBatchData.add({msgType:pt.RemoveNode,workId:s,viewId:t,dataType:kt.Local,isRunSubWork:!1});this.consume(),(i=this.collector)==null||i.dispatch({type:pt.RemoveNode,removeIds:e,viewId:t,scenePath:o})}}hoverCursor(t,e){var r;if(((r=this.currentToolsData)==null?void 0:r.toolsType)===nt.Selector&&!this.isBusy){const i=this.viewContainerManager.getView(e);if(i&&i.displayer&&i.displayer.vDom){const a=i.displayer.vDom.state.floatBarData;if(a){const{x:l,y:u,w:p,h:c}=a;if(zD(t,{x:l,y:u,w:p,h:c}))return}}const o=this.viewContainerManager.transformToScenePoint(t,e),s={msgType:pt.CursorHover,dataType:kt.Local,point:o,toolsType:this.currentToolsData.toolsType,opt:this.currentToolsData.toolsOpt,isRunSubWork:!1,viewId:e};this.queryTaskBatchData({msgType:pt.CursorHover,dataType:kt.Local,toolsType:this.currentToolsData.toolsType,viewId:e}).forEach(a=>{this.taskBatchData.delete(a)}),this.taskBatchData.add(s),this.runAnimation()}}blurCursor(t){var e;if(((e=this.currentToolsData)==null?void 0:e.toolsType)!==nt.Selector)return;const r={msgType:pt.CursorBlur,dataType:kt.Local,isRunSubWork:!1,viewId:t};this.queryTaskBatchData({msgType:pt.CursorHover,dataType:kt.Local,viewId:t}).forEach(i=>{this.taskBatchData.delete(i)}),this.taskBatchData.add(r),this.consume()}sendCursorEvent(t,e){var r,i,o;if(!this.currentLocalWorkData||this.currentLocalWorkData.workState===Tt.Unwritable||this.isBusy)return;const s=(r=this.currentToolsData)==null?void 0:r.toolsType;if(!this.useTasksqueue&&this.workState===Tt.Pending&&s===nt.Selector&&Pt.isNumber(t[0])&&Pt.isNumber(t[1])&&this.hoverCursor(t,e),!this.currentToolsData||!this.isCanSentCursor)return;const a=(i=this.collector)==null?void 0:i.uid,l=this.viewContainerManager.getCurScenePath(e);switch((o=this.currentToolsData)==null?void 0:o.toolsType){case nt.Eraser:case nt.PencilEraser:case nt.BitMapEraser:{if(a&&!this.control.renderControl.isClearAble({uid:a,viewId:e,filterLocalSelf:!1,scenePath:l}))return;break}default:if(a&&!this.control.renderControl.isWritable||a&&!this.control.renderControl.isRenderAble({uid:a,viewId:e,filterLocalSelf:!1,scenePath:l}))return;break}let u=[void 0,void 0];this.currentToolsData&&this.isCanSentCursor&&!this.localPointsBatchData.size&&!this.getLockSentEventCursor()&&(u=t,this.control.cursor.sendEvent(u,e))}getBoundingRect(t){var e,r;if(!((e=this.boundingRectMap)!=null&&e.get(t))){const i=(r=this.collector)==null?void 0:r.getScenePathData(t);if(!i)return;if(Object.keys(i).forEach(o=>{var s;((s=this.collector)==null?void 0:s.getLocalId(o))===Xt&&delete i[o]}),Object.keys(i).length&&this.viewContainerManager.mainView&&this.viewContainerManager.mainView.cameraOpt){const o={msgType:pt.BoundingBox,dataType:kt.Local,scenePath:t,scenes:i,cameraOpt:{...this.viewContainerManager.mainView.cameraOpt},isRunSubWork:!0,viewId:this.viewContainerManager.mainView.id};return this.taskBatchData.add(o),this.runAnimation(),new Promise(s=>{this.boundingRectMap.set(t,s)}).then(s=>(this.boundingRectMap.delete(t),s))}}}getSnapshot(t,e,r,i){var o,s,a,l,u;if(!((o=this.snapshotMap)!=null&&o.get(t))){const p=(s=this.collector)==null?void 0:s.getViewIdBySecenPath(t);if(!p)return;const c=(a=this.collector)==null?void 0:a.getStorageData(p,t);if(!c)return;if(Object.keys(c).forEach(g=>{var v;((v=this.collector)==null?void 0:v.getLocalId(g))===Xt&&delete c[g]}),Object.keys(c).length){const g=this.viewContainerManager.mainView;if(!g)return;const v=e||((l=g.cameraOpt)==null?void 0:l.width),I=r||((u=g.cameraOpt)==null?void 0:u.height),w={msgType:pt.Snapshot,dataType:kt.Local,scenePath:t,scenes:c,w:v,h:I,cameraOpt:i&&{...i,width:v,height:I}||g.cameraOpt,isRunSubWork:!0,viewId:g.id};return this.taskBatchData.add(w),this.runAnimation(),new Promise(y=>{this.snapshotMap.set(t,y)}).then(y=>(this.snapshotMap.delete(t),y))}}}queryTaskBatchData(t){const e=[];if(t)for(const r of this.taskBatchData.values()){let i=!0;for(const[o,s]of Object.entries(t))if(r[o]!==s){i=!1;break}i&&e.push(r)}return e}insertIconify(t,e){var r;const i=this.viewContainerManager.getView(t);if(!i)throw new Error("insertIconify viewId is not exist");if(!e.src)throw new Error("iconify src must be required");if(!/^(http|https):\/\//.test(e.src))throw new Error("iconify src must be http or https");e.strokeColor||(e.strokeColor=(r=this.currentLocalWorkData.toolsOpt)==null?void 0:r.strokeColor);const o=i?.focusScenePath;if(t&&o){const s=this.now;We.InternalMsgEmitter.emit("addUndoTicker",s,t);const a={...e,type:ai.Iconify};this.zIndexNodeMethod&&(this.zIndexNodeMethod.addMaxLayer(t),a.zIndex=this.zIndexNodeMethod.getMaxZIndex(t)),this.taskBatchData.add({msgType:pt.FullWork,dataType:kt.Local,toolsType:nt.Image,workId:e.uuid,opt:a,viewId:t,willRefresh:!0,willSyncService:!0}),this.runAnimation()}}insertImage(t,e){const r=this.viewContainerManager.getView(t);if(!r)throw new Error("insertImage viewId is not exist");if(e.src&&!/^(http|https):\/\//.test(e.src))throw new Error("Image src must be http or https");const i=r?.focusScenePath;if(t&&i){const{src:o,uuid:s}=e;if(s&&!o){this.tmpImageConfigMap.set(s,e);return}const a=this.now;We.InternalMsgEmitter.emit("addUndoTicker",a,t);const l={...e,type:ai.Image};this.zIndexNodeMethod&&(this.zIndexNodeMethod.addMaxLayer(t),l.zIndex=this.zIndexNodeMethod.getMaxZIndex(t)),this.taskBatchData.add({msgType:pt.FullWork,dataType:kt.Local,toolsType:nt.Image,workId:e.uuid,opt:l,viewId:t,willRefresh:!0,willSyncService:!0}),this.runAnimation()}}lockImage(t,e,r){var i,o;const s=this.viewContainerManager.getView(t);if(!s)throw new Error("insertImage viewId is not exist");const a=s?.focusScenePath;if(t&&a&&this.collector){const l=this.collector.getStorageData(t,a);if(!l)return;for(const[u,p]of Object.entries(l))if(p&&p.toolsType===nt.Image&&p.opt.uuid===e){const c=this.now;We.InternalMsgEmitter.emit("addUndoTicker",c,t);const g=(i=this.collector)!=null&&i.isOwn(u)?(o=this.collector)==null?void 0:o.getLocalId(u):u,v={...p.opt,locked:r,type:ai.Image};this.taskBatchData.add({msgType:pt.FullWork,dataType:kt.Local,toolsType:nt.Image,workId:g,opt:v,viewId:t,willRefresh:!0,willSyncService:!0}),this.runAnimation();return}}}completeImageUpload(t,e,r){const i=this.viewContainerManager.getView(t);if(!i)throw new Error("insertImage viewId is not exist");const o=i?.focusScenePath;if(t&&o){const s=this.tmpImageConfigMap.get(e);s&&(s.src=r,this.insertImage(t,s),this.tmpImageConfigMap.delete(e));return}}getImagesInformation(t){const e=[];if(this.collector){const r=this.collector.getScenePathData(t);if(!r)return e;for(const i of Object.values(r))if(i&&i.toolsType===nt.Image){const o=i.opt;e.push({uuid:o.uuid,centerX:o.centerX,centerY:o.centerY,width:o.width,height:o.height,locked:o.locked,uniformScale:o.uniformScale,crossOrigin:o.crossOrigin})}}return e}setShapeSelectorByWorkId(t,e){this.taskBatchData.add({workId:Xt,selectIds:[t],msgType:pt.Select,dataType:kt.Local,viewId:e,willSyncService:!0}),this.runAnimation()}blurSelector(t,e,r){this.taskBatchData.add({workId:r||Xt,selectIds:[],msgType:pt.Select,dataType:kt.Service,viewId:t,scenePath:e}),this.runAnimation()}consoleWorkerInfo(){this.taskBatchData.add({msgType:pt.Console,dataType:kt.Local,isRunSubWork:!0,viewId:""}),this.consume()}setPriority(t){var e,r;const i=new Set,o=new Set;if(t==="cpu"&&((e=this.subMainThreadWorker)==null||e.destroy(),i.add({msgType:pt.PriorityWorker,viewId:Al,dataType:kt.Local,isRunSubWork:!0})),t==="ui"){i.add({msgType:pt.PriorityMainThreadWorker,viewId:Al,dataType:kt.Local,isRunSubWork:!0});const s=this.viewContainerManager.mainView;if(s){const l=this.viewContainerManager.getViewInitData(s.id);if(l){const{offscreenCanvasOpt:u,layerOpt:p,dpr:c,cameraOpt:g}=l;o.add({msgType:pt.Init,dataType:kt.Local,viewId:s.id,offscreenCanvasOpt:u,layerOpt:p,dpr:c,cameraOpt:g,isRunSubWork:!0,isSafari:navigator.userAgent.indexOf("Safari")!==-1&&navigator.userAgent.indexOf("Chrome")===-1})}}const a=this.viewContainerManager.appViews;for(const l of a.keys()){const u=this.viewContainerManager.getViewInitData(l);if(u){const{offscreenCanvasOpt:p,layerOpt:c,dpr:g,cameraOpt:v}=u;o.add({msgType:pt.Init,dataType:kt.Local,viewId:l,offscreenCanvasOpt:p,layerOpt:c,dpr:g,cameraOpt:v,isRunSubWork:!0,isSafari:navigator.userAgent.indexOf("Safari")!==-1&&navigator.userAgent.indexOf("Chrome")===-1})}}}i.size&&this.subWorker.postMessage(i),o.size&&((r=this.subMainThreadWorker)==null||r.consume(o))}sendClearUids(t,e){var r,i;const o=new Set;o.add({msgType:pt.AuthClear,dataType:kt.Local,viewId:t,clearUids:e,localUid:(r=this.collector)==null?void 0:r.uid}),this.control.hasOffscreenCanvas()?this.fullWorker.postMessage(o):(i=this.mainThread)==null||i.consume(o)}async getVNodeInfo(t,e,r){if(!this.getVNodeInfoResolveMap.has(t))return this.taskBatchData.add({msgType:pt.GetVNodeInfo,dataType:kt.Local,isRunSubWork:!0,viewId:e,workIds:r,workId:t}),this.consume(),await new Promise(i=>{const o=this.getVNodeInfoResolveMap.get(t)||{resolve:void 0,timer:void 0};o.timer&&clearTimeout(o.timer),o.resolve=i,o.timer=setTimeout(()=>{const s=this.getVNodeInfoResolveMap.get(t);s!=null&&s.resolve&&s.resolve({uuid:t})},this.maxLastSyncTime*5),this.getVNodeInfoResolveMap.set(t,o)}).then(i=>{const{uuid:o}=i;return this.getVNodeInfoResolveMap.delete(o),i})}}class pL{constructor(t){G(this,"internalMsgEmitter"),G(this,"control"),G(this,"roomHotkeyCheckers"),G(this,"tmpCopyStore",new Map),G(this,"tmpCopyCoordInfo");var e;const{control:r,internalMsgEmitter:i}=t;this.control=r,this.internalMsgEmitter=i,this.roomHotkeyCheckers=((e=this.control.room)==null?void 0:e.viewsParams.hotKeys.nodes)||[]}get isUseSelf(){var t;return((t=this.control)==null?void 0:t.disableDeviceInputs)||!1}get isSelector(){var t;return((t=this.control.worker.currentToolsData)==null?void 0:t.toolsType)===nt.Selector}get collector(){return this.control.collector}get mainEngine(){return this.control.worker}get keyboardKind(){return/^Mac/i.test(navigator.platform)?"mac":"windows"}getEventKey(t){switch(t.type){case"keydown":return"KeyDown"}return"KeyUp"}onActiveHotkey(t){var e,r,i;const o=this.control.viewContainerManager.focuedViewId,s=(e=this.control.viewContainerManager.focuedView)==null?void 0:e.focusScenePath;if(o&&s)switch(t){case"delete":this.isSelector&&(r=this.collector)!=null&&r.hasSelector(o,s)&&_t.emitMethod(Ht.MainEngine,zt.DeleteNode,{workIds:[Xt],viewId:o});break;case"copy":this.isSelector&&(i=this.collector)!=null&&i.hasSelector(o,s)&&this.copySelectorToTemp(o,s);break;case"paste":this.tmpCopyStore.size&&this.pasteTempToFocusView(o,s);break}(t==="changeToPencil"||t==="redo"||t==="undo")&&this.onSelfActiveHotkey(t)}colloctHotkey(t){if(this.isUseSelf){const e=this.checkHotkey(t);e&&this.onSelfActiveHotkey(e)}}onSelfActiveHotkey(t){switch(t){case"changeToPencil":this.setMemberState({currentApplianceName:Jt.pencil,useNewPencil:!0});break;case"changeToArrow":this.setMemberState({currentApplianceName:Jt.arrow});break;case"changeToClick":this.setMemberState({currentApplianceName:Jt.clicker});break;case"changeToEllipse":this.setMemberState({currentApplianceName:Jt.ellipse});break;case"changeToEraser":this.setMemberState({currentApplianceName:Jt.eraser,isLine:!0});break;case"changeToHand":this.setMemberState({currentApplianceName:Jt.hand});break;case"changeToLaserPointer":this.setMemberState({currentApplianceName:Jt.laserPointer});break;case"changeToSelector":this.setMemberState({currentApplianceName:Jt.selector});break;case"changeToRectangle":this.setMemberState({currentApplianceName:Jt.rectangle});break;case"changeToStraight":this.setMemberState({currentApplianceName:Jt.straight});break;case"redo":this.control.room&&!this.control.room.disableSerialization&&this.control.viewContainerManager.redo();break;case"undo":this.control.room&&!this.control.room.disableSerialization&&this.control.viewContainerManager.undo();break;case"changeToText":this.setMemberState({currentApplianceName:Jt.text});break}}checkHotkey(t){for(const e of this.roomHotkeyCheckers){const{kind:r,checker:i}=e;if(i({nativeEvent:t,kind:this.getEventKey(t),key:t.key,altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey},this.keyboardKind))return r}}copySelectorToTemp(t,e){var r,i;const o=this.control.viewContainerManager.getView(t),s=(i=(r=this.mainEngine)==null?void 0:r.methodBuilder)==null?void 0:i.getBuilder(zt.CopyNode);if(!o||!this.collector||!s)return;const a=this.collector.transformKey(Xt),l=this.collector.getStorageData(t,e);if(!l)return;const u=l[a],p=u&&s.copySelector({viewId:t,store:u});p&&(this.tmpCopyCoordInfo=p?.copyCoordInfo,this.tmpCopyStore=p?.copyStores)}pasteTempToFocusView(t,e){var r,i;const o=this.control.viewContainerManager.getView(t),s=(i=(r=this.mainEngine)==null?void 0:r.methodBuilder)==null?void 0:i.getBuilder(zt.CopyNode);if(!(!o||!this.tmpCopyCoordInfo||!this.tmpCopyStore.size||!this.collector||!s)&&o.viewData&&this.tmpCopyCoordInfo){const a=Pt.cloneDeep(this.tmpCopyCoordInfo.offset),l=this.tmpCopyCoordInfo.cameraOpt,u=o.viewData.camera;a.x=a.x+u.centerX-l.centerX,a.y=a.y+u.centerY-l.centerY;const p=this.control.worker.now;this.control.worker.internalMsgEmitter.emit("addUndoTicker",p,t),s.pasteSelector({viewId:t,scenePath:e,copyStores:Pt.cloneDeep(this.tmpCopyStore),copyCoordInfo:{offset:a,cameraOpt:u},undoTickerId:p})}}setMemberState(t){var e;(e=this.control.room)==null||e.setMemberState(t)}}class gL{constructor(t){G(this,"control"),G(this,"roomMemberManager"),G(this,"worker"),G(this,"publicMsgEmitter"),G(this,"renderUids",new Map),G(this,"pageAuth",new Map),G(this,"isLocalRender",!1),G(this,"isCurWritable",!1);var e;const{control:r,publicMsgEmitter:i}=t;this.control=r,this.publicMsgEmitter=i,this.roomMemberManager=r.roomMember,this.worker=r.worker,this.isCurWritable=((e=this.control.room)==null?void 0:e.isWritable)||!1}get isWritable(){return this.isCurWritable}onWritableChange(t){this.isCurWritable=t}addPage(t,e=!0){var r,i;const{viewId:o,render:s="localSelf",elementIds:a,pageId:l=(r=this.control.collector)==null?void 0:r.uid}=t,u=this.pageAuth.get(o)||new Map,p=this.control.viewContainerManager.getCurScenePath(o);if(p&&l){const c=u.get(p)||{render:"localSelf",pages:new Map};e&&(c.render=s);const g=a&&this.cloneElementIds(o,p,a,l)||new Set;c.pages.set(l,g),u.set(p,c),this.pageAuth.set(o,u),e&&this.pageAuthEffect(o),this.isLocalRender=!1,(i=this.control.collector)==null||i.dispatchPageAuth({operation:Ve.addPage,viewId:o,scenePath:p,pageId:l,pageData:{render:s,elementIds:g}},!0)}}delPage(t,e){var r,i;const o=this.pageAuth.get(e);if(!o)return;const s=[...o.keys()].find(l=>{const u=o.get(l);return!!(u&&u.pages.has(t))});if(!s)return;const a=o.get(s);if(a){const{render:l,pages:u}=a,p=l==="localSelf"?(r=this.control.collector)==null?void 0:r.uid:l,c=u.get(t);c!=null&&c.size&&this.delElementIds(e,s,c),u.delete(t),p===t&&this.pageAuthEffect(e)}(i=this.control.collector)==null||i.dispatchPageAuth({operation:Ve.deletePage,viewId:e,scenePath:s,pageId:t},!0)}delViewPage(t,e=!0){var r;this.pageAuth.get(t)&&(this.pageAuth.delete(t),e&&((r=this.control.collector)==null||r.dispatchPageAuth({operation:Ve.clearView,viewId:t},e)))}clearRenderPage(t,e,r=!0){var i,o;const s=this.pageAuth.get(t);if(!s)return;const a=s.get(e);let l;if(a){const{render:u,pages:p}=a,c=u==="localSelf"?(i=this.control.collector)==null?void 0:i.uid:u;if(c){if(r){const g=p.get(c);g&&this.delElementIds(t,e,g)}p.set(c,new Set),l=c}}r&&l&&((o=this.control.collector)==null||o.dispatchPageAuth({operation:Ve.clearPage,viewId:t,scenePath:e,pageId:l},r))}hasPage(t,e,r){const i=this.pageAuth.get(e);if(!i)return!1;const o=i.get(r);return o?o.pages.has(t):!1}getPageInfo(t,e,r){const i=this.pageAuth.get(e);if(!i)return;const o=i.get(r);if(o)return o.pages.get(t)}addRenderPageElementId(t,e=!0,r=!1){var i,o;const{viewId:s,elementId:a,scenePath:l}=t,u=this.pageAuth.get(s);if(!u)throw new Error(`no view info in viewId: ${s}`);const p=u.get(l);let c;if(p){const{render:g,pages:v}=p,I=g==="localSelf"?(i=this.control.collector)==null?void 0:i.uid:g;if(I&&v.has(I)){const w=v.get(I)||new Set;w.add(a),v.set(I,w),c=I}}r&&this.pageAuthEffect(s),e&&c&&((o=this.control.collector)==null||o.dispatchPageAuth({operation:Ve.addElement,viewId:s,scenePath:l,pageId:c,pageData:{elementId:a}},e))}delRenderPageElementId(t,e=!0,r=!1){var i,o;const{viewId:s,elementId:a,scenePath:l}=t,u=this.pageAuth.get(s);if(!u)throw new Error(`no view info in viewId: ${s}`);const p=u.get(l);let c;if(p){const{render:g,pages:v}=p,I=g==="localSelf"?(i=this.control.collector)==null?void 0:i.uid:g;if(I&&v.has(I)){const w=v.get(I);w&&(w.delete(a),v.set(I,w),c=I)}}r&&this.pageAuthEffect(s),e&&c&&((o=this.control.collector)==null||o.dispatchPageAuth({operation:Ve.deleteElement,viewId:s,scenePath:l,pageId:c,pageData:{elementId:a}},e))}setPageRender(t,e,r,i=!0){var o;const s=this.pageAuth.get(t);if(!s)throw new Error(`no view info in viewId: ${t}`);const a=s.get(e);a&&(a.render=r),e===this.control.viewContainerManager.getCurScenePath(t)&&this.pageAuthEffect(t),i||(this.isLocalRender=!0),i&&(this.isLocalRender=!1,(o=this.control.collector)==null||o.dispatchPageAuth({operation:Ve.renderPage,viewId:t,scenePath:e,pageData:{render:r}},i))}isRenderAble(t){var e,r;const{uid:i,viewId:o,filterLocalSelf:s=!0,scenePath:a}=t,l=this.renderUids.get(o);if(l){const{render:p,hide:c}=l;if(p===void 0&&c===void 0)return!0;if(Pt.isSet(p)){if(p.has(i)||s&&((e=this.control.collector)==null?void 0:e.uid)===i&&p.has("localSelf"))return!0}else if(p===!0&&(!c||Pt.isSet(c)&&!c.has(i)&&!(s&&c.has("localSelf")&&((r=this.control.collector)==null?void 0:r.uid)===i)))return!0;return!1}const u=this.pageAuth.get(o);if(u&&a){const p=u.get(a);if(p){const{render:c}=p;if(c)return!(c==="localSelf"&&!s)}}return!0}isClearAble(t){var e;const{uid:r,viewId:i,filterLocalSelf:o=!0,scenePath:s}=t,a=this.renderUids.get(i);if(a){const{clear:u}=a;return!!(u===void 0||u===!0||Pt.isSet(u)&&(u.has(r)||o&&((e=this.control.collector)==null?void 0:e.uid)===r&&u.has("localSelf")))}const l=this.pageAuth.get(i);if(l&&s){const u=l.get(s);if(u){const{render:p}=u;if(p)return!(p==="localSelf"&&!o)}}return!0}isFilterAble(t,e){var r,i,o,s;const{viewId:a,scenePath:l,elementId:u}=t,p=this.renderUids.get(a);if(p&&u){const{render:g,hide:v}=p;if(g===void 0&&v===void 0)return!0;const I=(r=this.control.collector)==null?void 0:r.getUidFromKey(u);return I?!!(Pt.isSet(g)&&(g.has(I)||g.has("localSelf")&&((i=this.control.collector)==null?void 0:i.uid)===I)||g===!0&&(!v||Pt.isSet(v)&&!v.has(I)&&!(v.has("localSelf")&&((o=this.control.collector)==null?void 0:o.uid)===I))):!1}const c=this.pageAuth.get(a);if(c&&l&&u){const g=c.get(l);if(g){const{render:v,pages:I}=g;if(!v)return!0;const w=(s=this.control.collector)==null?void 0:s.uid,y=v==="localSelf"?w:v,T=y&&I.get(y)||void 0;if(T)switch(e){case pt.RemoveNode:return!0;default:return T.has(u)}return!1}}return!0}isFilterCursor(t){if(this.isUsePageAuth(t)){const e=this.control.viewContainerManager.getCurScenePath(t),r=this.pageAuth.get(t);if(e&&r){const i=r.get(e);if(i){const{render:o}=i;return o!=="localSelf"}}}return!0}isUsePageAuth(t){var e;if(!this.pageAuth.has(t))return!1;const r=this.control.viewContainerManager.getCurScenePath(t);return r&&((e=this.pageAuth.get(t))==null?void 0:e.has(r))||!1}publishRender(t){var e;const{viewId:r,option:i,isSync:o=!0}=t,s={};if(i){const{render:a,hide:l,clear:u}=i;a&&(s.render=a===!0&&!0||new Set(a)),l&&(s.hide=l===!0&&!0||new Set(l)),u&&(s.clear=u===!0&&!0||new Set(u)),this.renderUids.set(r,s)}else this.renderUids.delete(r);o&&((e=this.control.collector)==null||e.dispatchRenderAuth({operation:Rn.setAuth,viewId:r,renderData:s},o)),this.renderEffect(r)}publishOneRender(t,e,r,i=!0){var o;const s=this.renderUids.get(t);let a;switch(r){case"show":s?(s.render||(s.render=new Set),Pt.isSet(s.render)&&s.render.add(e),Pt.isSet(s.hide)&&s.hide.delete(e)):this.renderUids.set(t,{render:new Set([e])}),a=Rn.setShow;break;case"hide":s?(s.hide||(s.hide=new Set),Pt.isSet(s.hide)&&s.hide.add(e),Pt.isSet(s.render)&&s.render.delete(e)):this.renderUids.set(t,{hide:new Set([e])}),a=Rn.setHide;break}s?this.renderUids.set(t,s):this.renderUids.delete(t),i&&a&&((o=this.control.collector)==null||o.dispatchRenderAuth({operation:a,viewId:t,uid:e},i)),this.renderEffect(t)}publishOneClear(t,e,r,i=!0){var o;const s=this.renderUids.get(t);r?s?(s.clear||(s.clear=new Set),Pt.isSet(s.clear)&&s.clear.add(e)):this.renderUids.set(t,{clear:new Set([e])}):s&&Pt.isSet(s.clear)&&s.clear.has(e)&&s.clear.delete(e),s?this.renderUids.set(t,s):this.renderUids.delete(t),i&&((o=this.control.collector)==null||o.dispatchRenderAuth({operation:Rn.setClear,viewId:t,uid:e,isClear:r},i)),this.renderEffect(t)}syncRenderUids(t,e,r,i){const o=e===!0?!0:e&&Object.keys(e)?new Set(Object.keys(e)):void 0,s=r===!0?!0:r&&Object.keys(r)?new Set(Object.keys(r)):void 0,a=i===!0?!0:i&&Object.keys(i)?new Set(Object.keys(i)):void 0;o||s||a?this.renderUids.set(t,{render:o,hide:s,clear:a}):this.renderUids.delete(t),this.renderEffect(t),this.publicMsgEmitter.emit("syncRenderUids",t,{render:o,hide:s,clear:a})}syncPageAuth(t,e,r=!1){let i=!1;if(!e)this.pageAuth.delete(t);else{const o=this.pageAuth.get(t)||new Map;for(const[s,a]of Object.entries(e)){const{render:l,pages:u}=a,p=o.get(s),c=this.isLocalRender?p?.render:l;if(c){c!==p?.render&&(i=!0);const g=new Map;for(const[I,w]of Object.entries(u))g.set(I,new Set(Object.keys(w)));const v={render:c,pages:g};g.size&&o.set(s,v)}}o.size&&(this.pageAuth.set(t,o),this.publicMsgEmitter.emit("syncPageAuth",t,o))}(r||i)&&this.pageAuthEffect(t)}destoryByViewId(t,e=!1){var r;this.renderUids.has(t)&&(this.renderUids.delete(t),e||(r=this.control.collector)==null||r.dispatchRenderAuth({operation:Rn.setAuth,viewId:t})),this.pageAuth.has(t)&&this.control.renderControl.delViewPage(t,!e)}renderEffect(t){var e;const r=(e=this.control.viewContainerManager.getView(t))==null?void 0:e.focusScenePath;r&&this.worker.clearViewScenePath(t,!0).then(()=>{var i;this.worker.pullServiceData(t,r,{isAsync:!0,useAnimation:!1}),this.worker.sendClearUids(t,(i=this.renderUids.get(t))==null?void 0:i.clear)})}pageAuthEffect(t){var e;const r=(e=this.control.viewContainerManager.getView(t))==null?void 0:e.focusScenePath;r&&this.worker.clearViewScenePath(t,!0).then(()=>{this.worker.pullServiceData(t,r,{isAsync:!0,useAnimation:!1}),this.worker.sendClearUids(t,!0)})}cloneElementIds(t,e,r,i){var o,s;const a=(o=this.control.collector)==null?void 0:o.getStorageData(t,e),l=new Set;if(a){for(const u of Object.keys(a))if(r.has(u)){const p=`${u}_${i}`;if(l.add(p),!Object.keys(a).includes(p)){const c=Pt.cloneDeep(a[u]);(s=this.control.collector)==null||s.updateValue(p,{type:pt.FullWork,...c,workId:p},{isSync:!0,viewId:t,scenePath:e})}}}return l}delElementIds(t,e,r){var i,o;const s=(i=this.control.collector)==null?void 0:i.getStorageData(t,e);if(s)for(const a of Object.keys(s))r.has(a)&&Object.keys(s).includes(a)&&((o=this.control.collector)==null||o.updateValue(a,void 0,{isSync:!0,viewId:t,scenePath:e}))}}class mL{constructor(t){G(this,"internalMsgEmitter"),G(this,"control"),G(this,"maps",new Map),G(this,"showId"),G(this,"color"),G(this,"timer"),G(this,"updateMiniMapCamera",Pt.debounce(async o=>{const s=this.maps.get(o);if(s){const a=await this.getMiniMapCamera(o);if(a){const l=a.width/a.scale,u=a.height/a.scale,p=s.miniMapCamera.width/s.miniMapCamera.scale,c=s.miniMapCamera.height/s.miniMapCamera.scale;(l>=p||u>=c)&&(s.miniMapCamera=a);const g=s.miniMapCanvas.current;if(g){const v=g.getContext("2d");if(v){const I=this.control.viewContainerManager.getView(o);if(!(I!=null&&I.focusScenePath))return;const{miniMapCamera:w,contianer:y}=s,{width:T,height:h}=y.getBoundingClientRect(),m=Math.min(T/w.width,h/w.height);v.clearRect(0,0,g.width,g.height),g.width=w.width,g.height=w.height,g.style.width=`${w.width*m}px`,g.style.height=`${w.height*m}px`,await this.control.screenshotToCanvas(v,I.focusScenePath,w.width,w.height,w),this.listener.emitAsync([o,"viewCameraUpate"],1)}}}}},2e3,{maxWait:5e3}));var e;const{control:r,internalMsgEmitter:i}=t;this.control=r,this.internalMsgEmitter=i,this.color=((e=this.control.worker.currentToolsData)==null?void 0:e.toolsOpt.strokeColor)||"#000"}get listener(){return this.internalMsgEmitter}get activeViewId(){return this.showId}get highlightColor(){return this.color}setHighlightColor(t){this.color=t}async createMiniMap(t,e,r){const i=this.control.viewContainerManager.getView(t);if(!i)throw new Error("view not found");const o=i.cameraOpt;if(!o)throw new Error("view camera not found");const{width:s,height:a}=e.getBoundingClientRect();if(!s||!a)throw new Error("contianer width or height is 0");const l=ut.createRef();this.maps.set(t,{contianer:e,miniMapCanvas:l,miniMapCamera:r,viewCamera:o}),this.showId=t,this.control.viewContainerManager.setActiveMiniMap(this.showId,!0);const u=Math.min(s/r.width,a/r.height),p=await new Promise(c=>{this.listener.once([t,"miniMapCreate"],()=>{const g=l.current;g&&(g.width=r.width,g.height=r.height,g.style.width=`${r.width*u}px`,g.style.height=`${r.height*u}px`),c(!0)}),this.timer=setTimeout(()=>{c(!1)},2e3)});return this.timer&&clearTimeout(this.timer),p}async getMiniMapCamera(t){const e=this.control.viewContainerManager.getView(t);if(!e)return;const{cameraOpt:r,focusScenePath:i}=e;if(!r||!i)return;const o={originX:r.centerX-r.width/r.scale/2,originY:r.centerY-r.height/r.scale/2,width:r.width/r.scale,height:r.height/r.scale};let s=await this.control.getBoundingRect(i)||o;s=uh(s,o)||o;let a=s.width,l=s.height,u=1;const p=a>r.width&&Math.min(r.width/a,u)||u,c=l>r.height&&Math.min(r.height/l,u)||u;return p<=c?(a=p<1&&r.width||a,l=Math.floor(l*p)+1,u=p):p>c&&(l=c<1&&r.height||l,a=Math.floor(a*c)+1,u=c),{scale:u,centerX:s.originX+s.width/2,centerY:s.originY+s.height/2,width:a,height:l}}getMiniMapCanvas(t){const e=this.maps.get(t);return e?.miniMapCanvas.current||null}updateViewCamera(t,e){const r=this.maps.get(t);r&&(r.viewCamera=e,this.listener.emitAsync([t,"viewCameraUpate"],1))}destroyMiniMap(t){const e=t||this.showId;e&&(this.maps.delete(e),this.control.viewContainerManager.setActiveMiniMap(e,!1))}}class vL{constructor(t){G(this,"control"),G(this,"worker"),G(this,"publicMsgEmitter"),G(this,"plugins",new Map);const{control:e,publicMsgEmitter:r}=t;this.control=e,this.publicMsgEmitter=r,this.worker=e.worker}use(t){this.plugins.set(t.kind,t),t._inject(this.control),t.onCreate()}destroy(){this.plugins.forEach(t=>{this.plugins.delete(t.kind),t.onDestroy()})}dispatchPluginEvent(t,...e){this.plugins.forEach(r=>{r._onEvent(t,e)})}}const Uu=class Ks{constructor(t){G(this,"version",Fm),G(this,"plugin"),G(this,"room"),G(this,"play"),G(this,"collector"),G(this,"hasSwitchToSelectorEffect"),G(this,"snapshootStateMap"),G(this,"_disableDeviceInputs"),G(this,"_disableEraseImage"),G(this,"_disableEraseText"),G(this,"_disableCameraTransform"),G(this,"_disableUseWorker",!1),G(this,"priority","cpu"),G(this,"effectResolve"),G(this,"hotkeyManager"),G(this,"pluginOptions"),G(this,"roomMember"),G(this,"cursor"),G(this,"textEditorManager"),G(this,"worker"),G(this,"renderControl"),G(this,"miniMapManager"),G(this,"pluginManager"),G(this,"_isPolyfill",{requestIdleCallback:!1,cancelIdleCallback:!1}),G(this,"onSceneChange",async(a,l)=>{var u;const p=this.viewContainerManager.getView(l);p!=null&&p.focusScenePath&&(u=this.collector)!=null&&u.hasSelector(l,p.focusScenePath)&&this.worker.blurSelector(l,p.focusScenePath),this.textEditorManager.checkEmptyTextBlur();const c=p?.displayer;c&&(c.setActive(!1),await c.stopEventHandler());const g=a;g&&this.viewContainerManager.setViewScenePath(l,g),c?.setActive(!0)}),G(this,"onRoomMembersChange",a=>{this.roomMember.setRoomMembers(Ft.toJS(a))}),G(this,"onMemberChange",Pt.throttle(a=>{var l;if(!this.room||!this.worker||!a||!this.room.isWritable)return;const u=this.getToolsKey(a),p=(l=this.worker.getCurrentToolsData())==null?void 0:l.toolsType,c=this.viewContainerManager.focuedViewId;c&&p===nt.Selector&&u!==nt.Selector&&this.worker.blurCursor(c);const g=this.getToolsOpt(u,a);this.worker.setCurrentToolsData(g),this.pluginManager.dispatchPluginEvent("setToolkey",u),this.effectViewContainer(u),this.effectResolve&&this.effectResolve(!0)},100,{leading:!1})),G(this,"internalSceneChange",(a,l)=>{var u;this.miniMapManager.activeViewId===a&&this.miniMapManager.destroyMiniMap(a),this.pluginManager.dispatchPluginEvent("sceneChange",a,l),(u=this.worker)==null||u.clearViewScenePath(a,!0).then(()=>{var p;(p=this.worker)==null||p.pullServiceData(a,l,{isAsync:!0,useAnimation:!1})})}),G(this,"internalCameraChange",(a,l)=>{var u;(u=this.worker)==null||u.updateCamera(a,l),this.miniMapManager.updateViewCamera(a,l)});var e;const{displayer:r,plugin:i,options:o}=t;this.plugin=i,this.room=Ft.isRoom(r)?r:void 0,this.play=Ft.isPlayer(r)?r:void 0,this.room&&(this._disableDeviceInputs=this.room.disableDeviceInputs,this._disableEraseImage=this.room.disableEraseImage,this._disableEraseText=!1),this.pluginOptions=o,((e=o.extras)==null?void 0:e.useWorker)==="mainThread"?this._disableUseWorker=!0:this._disableUseWorker=od!=="worker",this.roomMember=new HD;const s={control:this,internalMsgEmitter:Ks.InternalMsgEmitter,publicMsgEmitter:Ks.PublicMsgEmitter};this.cursor=new ZD(s),this.textEditorManager=new QD(s),this.worker=new dL(s),this.hotkeyManager=new pL(s),this.renderControl=new gL(s),this.miniMapManager=new mL(s),this.pluginManager=new vL(s)}hasPolyfillMethod(t){return this._isPolyfill[t]}registerPolyfillMethod(t){this._isPolyfill[t]=!0}get disableEraseText(){return this._disableEraseText||!1}set disableEraseText(t){this._disableEraseText=t}get disableEraseImage(){return this._disableEraseImage||!1}set disableEraseImage(t){this._disableEraseImage=t}get disableDeviceInputs(){return this._disableDeviceInputs||!1}set disableDeviceInputs(t){var e;this._disableDeviceInputs=t;const r=(e=this.worker.getCurrentToolsData())==null?void 0:e.toolsType;r&&this.effectViewContainer(r)}get disableCameraTransform(){return this._disableCameraTransform||!1}set disableCameraTransform(t){this._disableCameraTransform=t}get disableUseWorker(){return this._disableUseWorker||!1}set disableUseWorker(t){this._disableUseWorker=t}setPriority(t){var e;this.priority=t,this.hasOffscreenCanvas()&&((e=this.worker)==null||e.setPriority(t))}hasOffscreenCanvas(){return this._disableUseWorker?!1:od==="worker"}bindPlugin(t){this.plugin=t,this.collector&&(this.collector.removeStorageStateListener(),this.collector.removeAuthStateListener()),this.collector=new $D(this,t,this.pluginOptions.extras.syncOpt.interval),this.activePlugin()}destroy(){var t,e,r,i,o,s;this.roomMember.destroy(),(t=this.collector)==null||t.destroy(),(e=this.worker)==null||e.destroy(),(r=this.viewContainerManager)==null||r.destroy(),(i=this.cursor)==null||i.destroy(),(o=this.textEditorManager)==null||o.destory(),(s=this.pluginManager)==null||s.destroy()}cleanCurrentScene(){const t=this.worker.now,e=this.worker.getLocalWorkViewId()||this.viewContainerManager.focuedViewId;e&&(Ks.InternalMsgEmitter.emit("addUndoTicker",t,e),this.worker.clearViewScenePath(e,!1,!0))}async setWritable(t){var e,r;if(!t){(e=this.cursor)==null||e.unabled(),this.textEditorManager.checkEmptyTextBlur();const i=this.viewContainerManager.getAllViews();for(const o of i){o!=null&&o.focusScenePath&&(r=this.collector)!=null&&r.hasSelector(o.id,o.focusScenePath)&&this.worker.blurSelector(o.id,o.focusScenePath);const s=o?.displayer;s&&s.getActive()&&(s.setActive(!1),await s.stopEventHandler())}}await new Promise(i=>{setTimeout(()=>{i()},500)})}onWritableChange(t){var e;t?this.worker.abled():this.worker.unWritable(),((e=this.worker.getCurrentToolsData())==null?void 0:e.toolsType)===nt.Text&&this.viewContainerManager.focuedViewId&&(t?this.viewContainerManager.activeTextEditor(this.viewContainerManager.focuedViewId):this.viewContainerManager.unActiveTextEditor(this.viewContainerManager.focuedViewId)),this.renderControl.onWritableChange(t),this.viewContainerManager.getAllViews().forEach(r=>{const i=r?.displayer;i&&(i.bindToolsClass(),t?i.setActive(!0):i.setActive(!1))})}getToolsKey(t){const e=t.currentApplianceName;switch(this.hasSwitchToSelectorEffect=!1,e){case Jt.text:return t.textCompleteToSelector&&(this.hasSwitchToSelectorEffect=!0),nt.Text;case Jt.pencil:return t.useLaserPen?nt.LaserPen:nt.Pencil;case Jt.eraser:return nt.Eraser;case Jt.pencilEraser:return this.pluginOptions.extras.pencilEraser.useBitMap===!1?nt.PencilEraser:nt.BitMapEraser;case Jt.selector:return nt.Selector;case Jt.arrow:return t.arrowCompleteToSelector&&(this.hasSwitchToSelectorEffect=!0),nt.Arrow;case Jt.straight:return t.straightCompleteToSelector&&(this.hasSwitchToSelectorEffect=!0),nt.Straight;case Jt.ellipse:return t.ellipseCompleteToSelector&&(this.hasSwitchToSelectorEffect=!0),nt.Ellipse;case Jt.rectangle:return t.rectangleCompleteToSelector&&(this.hasSwitchToSelectorEffect=!0),nt.Rectangle;case Jt.shape:if(t.shapeCompleteToSelector&&(this.hasSwitchToSelectorEffect=!0),t.shapeType===Ln.Pentagram||t.shapeType===Ln.Star)return nt.Star;if(t.shapeType===Ln.Polygon||t.shapeType===Ln.Triangle||t.shapeType===Ln.Rhombus)return nt.Polygon;if(t.shapeType===Ln.SpeechBalloon)return nt.SpeechBalloon;break}return nt.Clicker}getToolsOpt(t,e){if(t===nt.Clicker)return{toolsType:t,toolsOpt:{}};const r={strokeColor:Qr(e.strokeColor[0],e.strokeColor[1],e.strokeColor[2],e.strokeOpacity||1),thickness:e.strokeWidth,isOpacity:e?.strokeOpacity&&e.strokeOpacity<1||e?.fillOpacity&&e.fillOpacity<1||e?.textOpacity&&e.textOpacity<1||e?.textBgOpacity&&e.textBgOpacity<1||!1};switch(t){case nt.Text:r.fontFamily=window.getComputedStyle(document.documentElement).getPropertyValue("font-family"),r.fontSize=e?.textSizeOverride||e?.textSize||Number(window.getComputedStyle(document.body).fontSize),r.textAlign=e?.textAlign||"left",r.verticalAlign=e?.verticalAlign||"middle",r.fontColor=e?.textColor&&Qr(e.textColor[0],e.textColor[1],e.textColor[2],e.textOpacity||1)||r.strokeColor||"rgba(0,0,0,1)",r.fontBgColor=Array.isArray(e?.textBgColor)&&Qr(e.textBgColor[0],e.textBgColor[1],e.textBgColor[2],e.textBgOpacity||1)||"transparent",r.bold=e?.bold&&"bold"||void 0,r.italic=e?.italic&&"italic"||void 0,r.underline=e?.underline||void 0,r.lineThrough=e?.lineThrough||void 0,r.text="",r.strokeColor=void 0;break;case nt.Pencil:r.strokeType=e?.strokeType||$t.Normal;break;case nt.PencilEraser:case nt.BitMapEraser:case nt.Eraser:r.thickness=Math.min(4,Math.max(1,Math.floor(e.pencilEraserSize||1)))-1;break;case nt.LaserPen:r.duration=e?.duration||1,e!=null&&e.strokeType&&e?.strokeType===$t.Stroke?r.strokeType=$t.Normal:r.strokeType=e?.strokeType||$t.Normal;break;case nt.Arrow:case nt.Straight:e!=null&&e.strokeType&&e?.strokeType===$t.Stroke?r.strokeType=$t.Normal:r.strokeType=e?.strokeType||$t.Normal;break;case nt.Ellipse:case nt.Rectangle:case nt.Star:case nt.Polygon:case nt.SpeechBalloon:e!=null&&e.strokeType&&e?.strokeType===$t.Stroke?r.strokeType=$t.Normal:r.strokeType=e?.strokeType||$t.Normal,t===nt.Star&&(e.shapeType===Ln.Pentagram?(r.vertices=10,r.innerVerticeStep=2,r.innerRatio=.4):e!=null&&e.vertices&&e!=null&&e.innerVerticeStep&&e!=null&&e.innerRatio&&(r.vertices=e.vertices,r.innerVerticeStep=e.innerVerticeStep,r.innerRatio=e.innerRatio)),t===nt.Polygon&&(e.shapeType===Ln.Triangle?r.vertices=3:e.shapeType===Ln.Rhombus?r.vertices=4:e.vertices&&(r.vertices=e.vertices)),r.fillColor=e?.fillColor&&Qr(e.fillColor[0],e.fillColor[1],e.fillColor[2],e?.fillOpacity)||"transparent",t===nt.SpeechBalloon&&(r.placement=e.placement||"bottomLeft");break}return{toolsType:t,toolsOpt:r}}effectViewContainer(t){var e,r,i,o,s;if(this.disableDeviceInputs===!0)this.room.disableDeviceInputs=!0,(e=this.worker)==null||e.unWritable(),(r=this.cursor)==null||r.unabled();else switch(t!==nt.Text&&this.viewContainerManager.focuedViewId&&this.viewContainerManager.unActiveTextEditor(this.viewContainerManager.focuedViewId),t){case nt.Text:case nt.Pencil:case nt.LaserPen:case nt.Arrow:case nt.Straight:case nt.Rectangle:case nt.Ellipse:case nt.Star:case nt.Polygon:case nt.SpeechBalloon:case nt.Triangle:case nt.Rhombus:case nt.Eraser:case nt.PencilEraser:case nt.BitMapEraser:case nt.Selector:this.room.disableDeviceInputs=!0,(i=this.worker)==null||i.abled(),t===nt.Text&&this.viewContainerManager.focuedViewId&&this.viewContainerManager.activeTextEditor(this.viewContainerManager.focuedViewId);break;default:this.room.disableDeviceInputs=!1,(o=this.worker)==null||o.unWritable(),(s=this.cursor)==null||s.unabled();break}setTimeout(()=>{this.viewContainerManager.getAllViews().forEach(a=>{a!=null&&a.displayer&&a.displayer.bindToolsClass()})},0)}async getBoundingRect(t){var e,r,i,o,s;const a=await((e=this.worker)==null?void 0:e.getBoundingRect(t));if(a){const l=((i=(r=this.viewContainerManager.mainView)==null?void 0:r.viewData)==null?void 0:i.convertToPointInWorld({x:a.x,y:a.y}))||{x:a.x,y:a.y},u=((s=(o=this.viewContainerManager.mainView)==null?void 0:o.viewData)==null?void 0:s.camera.scale)||1;return{width:Math.floor(a.w/u)+1,height:Math.floor(a.h/u)+1,originX:l.x,originY:l.y}}}async screenshotToCanvas(t,e,r,i,o,s,a){const l=await this.worker.getSnapshot(e,r,i,o);l&&(t.drawImage(l,s||0,a||0),l.close())}async scenePreview(t,e){var r,i,o,s;const a=(r=this.collector)==null?void 0:r.getViewIdBySecenPath(t);if(!a)return;const l=this.viewContainerManager.getView(a);if(!l||!((i=l.cameraOpt)!=null&&i.width)||!((o=l.cameraOpt)!=null&&o.height))return;const u=await((s=this.worker)==null?void 0:s.getSnapshot(t));if(u&&this.worker){const p=document.createElement("canvas"),c=p.getContext("2d"),{width:g,height:v}=l.cameraOpt;p.width=g,p.height=v,c&&(c.drawImage(u,0,0),e.crossOrigin="anonymous",e.src=p.toDataURL(),e.onload=()=>{p.remove()},e.onerror=()=>{p.remove(),e.remove()}),u.close()}}switchToText(){var t;(t=this.room)==null||t.setMemberState({currentApplianceName:Jt.text})}switchToSelector(){var t;(t=this.room)==null||t.setMemberState({currentApplianceName:Jt.selector})}async runEffectWork(t){if(this.hasSwitchToSelectorEffect){const e=await new Promise(r=>{this.switchToSelector(),this.effectResolve=r});this.effectResolve=void 0,e&&t&&t()}}setSnapshootData(){var t;this.room&&(this.snapshootStateMap=new Map,this.snapshootStateMap.set("memberState",(t=this.room)==null?void 0:t.state.memberState))}getSnapshootData(t){var e;return(e=this.snapshootStateMap)==null?void 0:e.get(t)}clearSnapshootData(){var t;(t=this.snapshootStateMap)==null||t.clear(),this.snapshootStateMap=void 0}useBitMapEraser(t){this.pluginOptions.extras.pencilEraser.useBitMap=t}consoleWorkerInfo(){var t;(t=this.worker)==null||t.consoleWorkerInfo()}filterRenderByUid(t,e,r=!0){var i;this.viewContainerManager.getView(t)&&((i=this.renderControl)==null||i.publishRender({viewId:t,option:e,isSync:r}))}cancelFilterRender(t,e=!0){var r;(r=this.renderControl)==null||r.publishRender({viewId:t,isSync:e})}async createMiniMap(t,e){const r=await this.miniMapManager.getMiniMapCamera(t);if(r&&await this.miniMapManager.createMiniMap(t,e,r)){const i=this.miniMapManager.getMiniMapCanvas(t);if(i){const o=i.getContext("2d");if(o){const s=this.viewContainerManager.getView(t);s!=null&&s.focusScenePath&&this.screenshotToCanvas(o,s.focusScenePath,r.width,r.height,r)}}}}async destroyMiniMap(t){this.miniMapManager.destroyMiniMap(t)}insertIconify(t,e){var r;if(this.viewContainerManager.getView(t)&&this.room){const i=this.room.state.memberState,o=Qr(i.strokeColor[0],i.strokeColor[1],i.strokeColor[2],i.strokeOpacity||1);(r=this.worker)==null||r.insertIconify(t,{...e,strokeColor:o})}}usePlugin(t){return this.pluginManager.use(t)}};G(Uu,"InternalMsgEmitter",new jl),G(Uu,"PublicMsgEmitter",new jl);let We=Uu;const Js=class Yu{constructor(t){G(this,"emitter",new jl),G(this,"undoStack"),G(this,"redoStack"),G(this,"worker"),G(this,"control"),G(this,"room"),G(this,"isTicking"),G(this,"undoTickerId"),G(this,"viewId"),G(this,"scenePath"),G(this,"tickStartStorerCache"),G(this,"excludeIds",new Set),G(this,"onChangeScene",Pt.debounce(()=>{const o=this.control.viewContainerManager.getCurScenePath(this.viewId);if(o){let s=this.undoStack.filter(l=>l.scenePath===o).length;const a=this.redoStack.filter(l=>l.scenePath===o).length;s===0&&a===0&&this.tickStartStorerCache&&this.scenePath===o&&(s=1),this.emitter.emit("onCanUndoStepsUpdate",s),this.emitter.emit("onCanRedoStepsUpdate",a)}},Yu.waitTime));const{control:e,internalMsgEmitter:r,viewId:i}=t;this.control=e,this.emitter=r,this.undoStack=[],this.redoStack=[],this.room=e.room,this.worker=e.worker,this.isTicking=!1,this.viewId=i}get collector(){return this.control.collector}addExcludeIds(t){if(this.isTicking)for(const e of t)this.excludeIds.add(e)}undoTickerStart(t,e){var r,i;if(this.collector&&(this.undoTickerId!==t||this.scenePath!==e)){!this.undoTickerId&&!this.tickStartStorerCache&&!this.scenePath&&this.emitter.emit("onCanUndoStepsUpdate",1),this.undoTickerId&&this.viewId&&this.scenePath&&this.undoTickerEndSync(this.undoTickerId,this.viewId,this.scenePath),this.isTicking=!0;const o=this.collector.transformKey(Xt);this.excludeIds.add(o),this.undoTickerId=t,this.scenePath=e;const s=((r=this.collector)==null?void 0:r.storage[this.viewId])&&((i=this.collector)==null?void 0:i.storage[this.viewId][this.scenePath])||{};this.tickStartStorerCache=new Map(Object.entries(Pt.cloneDeep(s)))}}undoTickerEndSync(t,e,r,i=!0){var o,s;if(t===this.undoTickerId&&r===this.scenePath&&e===this.viewId&&this.tickStartStorerCache){const a=((o=this.collector)==null?void 0:o.storage[e])&&((s=this.collector)==null?void 0:s.storage[e][r])||{},l=this.diffFun(this.tickStartStorerCache,new Map(Object.entries(a)));l.size&&(this.undoStack.push({id:t,type:2,data:Pt.cloneDeep(l),scenePath:r}),this.undoStack.length>Yu.MaxStackLength&&this.undoStack.shift(),i&&this.emitter.emit("onCanUndoStepsUpdate",this.undoStack.length+1)),this.redoStack.length&&(this.redoStack.length=0,this.emitter.emit("onCanRedoStepsUpdate",this.redoStack.length)),this.isTicking=!1,this.scenePath=void 0,this.tickStartStorerCache=void 0,this.undoTickerId=void 0,this.excludeIds.clear()}}undo(t){this.undoTickerId&&this.tickStartStorerCache&&this.scenePath&&this.undoTickerEndSync(this.undoTickerId,this.viewId,this.scenePath,!1);let e=this.undoStack.length-1;for(;e>=0;){if(this.undoStack[e].scenePath===t){const o=this.undoStack[e];o&&(this.redoStack.push(o),o.type===2&&o.data&&this.refreshPlugin(o)),this.undoStack.splice(e,1);break}e--}const r=this.undoStack.filter(o=>o.scenePath===t).length,i=this.redoStack.filter(o=>o.scenePath===t).length;return this.emitter.emit("onCanUndoStepsUpdate",r),this.emitter.emit("onCanRedoStepsUpdate",i),r}redo(t){let e=this.redoStack.length-1;for(;e>=0;){if(this.redoStack[e].scenePath===t){const o=this.redoStack[e];o&&(!this.undoTickerId&&o.tickStartStorerCache?(this.undoTickerId=o.id,this.tickStartStorerCache=o.tickStartStorerCache,this.scenePath=o.scenePath):this.undoStack.push(o),o.type===2&&o.data&&this.refreshPlugin(o,!0)),this.redoStack.splice(e,1);break}e--}const r=this.undoStack.filter(o=>o.scenePath===t).length,i=this.redoStack.filter(o=>o.scenePath===t).length;return this.emitter.emit("onCanUndoStepsUpdate",r),this.emitter.emit("onCanRedoStepsUpdate",i),i}clear(){this.clearUndo(),this.clearRedo()}clearUndo(){this.undoStack.length=0,this.emitter.emit("onCanUndoStepsUpdate",this.undoStack.length)}clearRedo(){this.redoStack.length=0,this.emitter.emit("onCanRedoStepsUpdate",this.redoStack.length)}canUndo(){return!!this.undoStack.length}canRedo(){return!!this.redoStack.length}onFocusView(){const t=this.control.viewContainerManager.getCurScenePath(this.viewId);if(t){let e=this.undoStack.filter(i=>i.scenePath===t).length;const r=this.redoStack.filter(i=>i.scenePath===t).length;e===0&&r===0&&this.tickStartStorerCache&&this.scenePath===t&&(e=1),this.emitter.emit("onCanUndoStepsUpdate",e),this.emitter.emit("onCanRedoStepsUpdate",r)}}diffFun(t,e){const r=new Set,i=t.keys(),o=e.keys();for(const s of i){if(this.excludeIds.has(s))continue;const a=t.get(s),l=e.get(s);if(a&&l){if(Pt.isEqual(l,a))continue;r.add({dataType:3,key:s,data:[a,l]});continue}a&&r.add({dataType:2,key:s,data:a})}for(const s of o){if(this.excludeIds.has(s))continue;const a=e.get(s);a&&!t.has(s)&&r.add({dataType:1,key:s,data:a})}return r}isDrawEffectiveScene(t,e){const{key:r}=t;return!e.includes(r)}isDeleteEffectiveScene(t,e,r){var i;const{key:o}=t;if(!e.includes(o))return!1;const s=e.filter(a=>{var l,u;return((l=this.collector)==null?void 0:l.getLocalId(a))===Xt&&!((u=this.collector)!=null&&u.isOwn(a))}).map(a=>{var l;return(l=this.collector)==null?void 0:l.storage[this.viewId][r][a]});for(const a of s)if((i=a?.selectIds)!=null&&i.includes(o))return!1;return!0}isOldEffectiveScene(t,e,r){var i;const{key:o}=t;if(!e.includes(o))return!1;const s=e.filter(a=>{var l,u;return((l=this.collector)==null?void 0:l.getLocalId(a))===Xt&&!((u=this.collector)!=null&&u.isOwn(a))}).map(a=>{var l;return(l=this.collector)==null?void 0:l.storage[this.viewId][r][a]});for(const a of s)if((i=a?.selectIds)!=null&&i.includes(o))return!1;return!0}isNewEffectiveScene(t,e){const{key:r}=t;return!!e.includes(r)}refreshPlugin(t,e=!1){var r,i,o,s,a,l,u,p,c,g,v,I,w,y,T,h,m,d,M,x,E;let P;const{scenePath:R}=t,N=t.data;if(!N||!this.collector)return;const b=Pt.cloneDeep(this.collector.storage);for(const j of N.values()){const{dataType:O,data:L,key:k}=j,H=this.collector.getStorageData(this.viewId,R),Q=H&&Object.keys(H)||[];switch(O){case 1:if(P=e?this.isDrawEffectiveScene(j,Q):this.isDeleteEffectiveScene(j,Q,R),P)if(e&&!Array.isArray(L)){if((r=L.updateNodeOpt)!=null&&r.useAnimation&&(L.updateNodeOpt.useAnimation=!1),((i=this.collector)==null?void 0:i.getLocalId(k))===Xt&&(o=this.collector)!=null&&o.isOwn(j.key)){const _=L.selectIds;if(_){const st=Q.filter(Z=>{var tt,ct;return((tt=this.collector)==null?void 0:tt.getLocalId(Z))===Xt&&!((ct=this.collector)!=null&&ct.isOwn(Z))}).map(Z=>{var tt;return(tt=this.collector)==null?void 0:tt.storage[this.viewId][R][Z]});let F=!1;for(const Z of st)for(let tt=0;tt<_.length;tt++)(s=Z?.selectIds)!=null&&s.includes(_[tt])&&(delete _[tt],F=!0);F&&(L.selectIds=_.filter(Z=>!!Z))}}(a=this.collector)==null||a.updateValue(j.key,L,{viewId:this.viewId,scenePath:R,isSync:!0,storage:b})}else!e&&!Array.isArray(j.data)&&((l=this.collector)==null||l.updateValue(j.key,void 0,{viewId:this.viewId,scenePath:R,isSync:!0,storage:b}));break;case 2:if(P=e?this.isDeleteEffectiveScene(j,Q,R):this.isDrawEffectiveScene(j,Q),P){if(e&&!Array.isArray(L))(u=this.collector)==null||u.updateValue(k,void 0,{viewId:this.viewId,scenePath:R,isSync:!0,storage:b});else if(!e&&!Array.isArray(L)){if((p=L.updateNodeOpt)!=null&&p.useAnimation&&(L.updateNodeOpt.useAnimation=!1),((c=this.collector)==null?void 0:c.getLocalId(j.key))===Xt&&(g=this.collector)!=null&&g.isOwn(j.key)){const _=L.selectIds;if(_){const st=Q.filter(Z=>{var tt,ct;return((tt=this.collector)==null?void 0:tt.getLocalId(Z))===Xt&&!((ct=this.collector)!=null&&ct.isOwn(Z))}).map(Z=>{var tt;return(tt=this.collector)==null?void 0:tt.storage[this.viewId][R][Z]});let F=!1;for(const Z of st)for(let tt=0;tt<_.length;tt++)(v=Z?.selectIds)!=null&&v.includes(_[tt])&&(delete _[tt],F=!0);F&&(L.selectIds=_.filter(Z=>!!Z))}}(I=this.collector)==null||I.updateValue(j.key,j.data,{viewId:this.viewId,scenePath:R,isSync:!0,storage:b})}}break;case 3:if(P=e?this.isNewEffectiveScene(j,Q):this.isOldEffectiveScene(j,Q,R),P){if(e&&Array.isArray(L)&&L.length===2){const _=L[1];if((w=_.updateNodeOpt)!=null&&w.useAnimation&&(_.updateNodeOpt.useAnimation=!1),((y=this.collector)==null?void 0:y.getLocalId(j.key))===Xt&&(T=this.collector)!=null&&T.isOwn(j.key)){const st=_.selectIds;if(st){const F=Q.filter(tt=>{var ct,at;return((ct=this.collector)==null?void 0:ct.getLocalId(tt))===Xt&&!((at=this.collector)!=null&&at.isOwn(tt))}).map(tt=>{var ct;return(ct=this.collector)==null?void 0:ct.storage[this.viewId][R][tt]});let Z=!1;for(const tt of F)for(let ct=0;ct<st.length;ct++)tt!=null&&tt.selectIds&&(h=tt.selectIds)!=null&&h.includes(st[ct])&&(delete st[ct],Z=!0);Z&&(_.selectIds=st.filter(tt=>!!tt))}}(m=this.collector)==null||m.updateValue(k,_,{viewId:this.viewId,scenePath:R,isSync:!0,storage:b})}else if(!e&&Array.isArray(L)&&L.length===2){const _=L[0];if((d=_.updateNodeOpt)!=null&&d.useAnimation&&(_.updateNodeOpt.useAnimation=!1),((M=this.collector)==null?void 0:M.getLocalId(j.key))===Xt&&(x=this.collector)!=null&&x.isOwn(j.key)){const st=_.selectIds;if(st){const F=Q.filter(tt=>{var ct,at;return((ct=this.collector)==null?void 0:ct.getLocalId(tt))===Xt&&!((at=this.collector)!=null&&at.isOwn(tt))}).map(tt=>{var ct;return(ct=this.collector)==null?void 0:ct.storage[this.viewId][R][tt]});let Z=!1;for(const tt of F)for(let ct=0;ct<st.length;ct++)tt!=null&&tt.selectIds&&tt.selectIds.includes(st[ct])&&(delete st[ct],Z=!0);Z&&(_.selectIds=st.filter(tt=>!!tt))}}(E=this.collector)==null||E.updateValue(j.key,_,{viewId:this.viewId,scenePath:R,isSync:!0,storage:b})}}break}}}};G(Js,"sdkCallBack"),G(Js,"MaxStackLength",20),G(Js,"waitTime",100);let Sv=Js;function yL(n){return n instanceof TouchEvent||n instanceof window.TouchEvent||n?.touches&&n?.touches.length||n?.changedTouches&&n?.changedTouches.length}function li(n){return yL(n)&&(n.touches&&n.touches.length===1||n.changedTouches&&n.changedTouches.length===1)}function fh(n){return n.touches&&n.touches.length?{x:n.touches[0].pageX,y:n.touches[0].pageY}:n.changedTouches&&n.changedTouches.length?{x:n.changedTouches[0].pageX,y:n.changedTouches[0].pageY}:{x:n.pageX,y:n.pageY}}class bo{constructor(t){G(this,"internalMsgEmitter"),G(this,"control"),G(this,"mainView"),G(this,"appViews",new Map),G(this,"undoTickerStart",(i,o)=>{const s=this.getView(o);s&&s.displayer&&s.focusScenePath&&s.displayer.commiter.undoTickerStart(i,s.focusScenePath)}),G(this,"addExcludeIds",(i,o)=>{const s=this.getView(o);s&&s.displayer&&s.focusScenePath&&s.displayer.commiter.addExcludeIds(i)});const{control:e,internalMsgEmitter:r}=t;this.control=e,this.internalMsgEmitter=r,this.internalMsgEmitter.on("addUndoTicker",this.undoTickerStart),this.internalMsgEmitter.on("excludeIds",this.addExcludeIds)}get worker(){return this.control.worker}undo(){const t=this.focuedView;let e=0;if(t){const r=t.focusScenePath;e=t.displayer.commiter.undo(r)||0}return e}redo(){const t=this.focuedView;let e=0;if(t){const r=t.focusScenePath;e=t.displayer.commiter.redo(r)||0}return e}validator(t,e,r){var i;const o=Pt.clone(t[e]),s=Pt.clone(r);e==="focusScenePath"&&r&&!Pt.isEqual(o,s)&&(this.control.internalSceneChange(t.id,s),(i=this.focuedView)==null||i.displayer.commiter.onChangeScene()),e==="cameraOpt"&&!Pt.isEqual(o,s)&&this.control.internalCameraChange(t.id,s)}destroyAppView(t,e=!1){const r=this.appViews.get(t);r&&(this.control.textEditorManager.clear(t,e),r.displayer.destroy(),this.appViews.delete(t))}createMianView(t){this.mainView=new Proxy(t,{set:(e,r,i)=>(this.worker.isActive&&this.validator(e,r,i),e[r]=i,!0)})}createAppView(t){const e=t.id,r=new Proxy(t,{set:(i,o,s)=>(this.worker.isActive&&this.validator(i,o,s),i[o]=s,!0)});this.appViews.set(e,r)}isAppView(t){return t!==ce&&this.appViews.has(t)}getView(t){var e;return t===ce?this.mainView:(e=this.appViews)==null?void 0:e.get(t)}getCurScenePath(t){const e=this.getView(t);if(e)return e.focusScenePath}getAllViews(){return[this.mainView,...this.appViews.values()]}setViewScenePath(t,e){var r;if(t===ce&&this.mainView)this.mainView.focusScenePath=e;else{const i=t&&((r=this.appViews)==null?void 0:r.get(t))||void 0;i&&(i.focusScenePath=e)}}setViewData(t,e){var r;if(t===ce&&this.mainView)this.mainView.viewData=e;else{const i=t&&((r=this.appViews)==null?void 0:r.get(t))||void 0;i&&(i.viewData=e)}}setFocuedViewId(t){var e;this.focuedViewId=t,t===ce?this.focuedView=this.mainView:this.focuedView=t&&((e=this.appViews)==null?void 0:e.get(t))||void 0,this.worker.currentToolsData&&this.worker.currentToolsData.toolsType===nt.Text&&this.activeTextEditor(t),this.control.cursor.onFocusViewChange(),this.focuedView&&this.focuedView.displayer.commiter.onFocusView()}setViewFocusScenePath(t,e){var r;let i;t===ce?i=this.mainView:i=(r=this.appViews)==null?void 0:r.get(t),i&&(i.focusScenePath=e)}destroy(){var t;this.internalMsgEmitter.off("addUndoTicker",this.undoTickerStart),this.internalMsgEmitter.off("excludeIds",this.addExcludeIds),(t=this.mainView)==null||t.displayer.destroy(),this.control.destroyMiniMap(ce),this.appViews.forEach(e=>{this.destroyAppView(e.id,!0),this.worker.destroyViewWorker(e.id),this.control.destroyMiniMap(e.id)})}setFocuedViewCameraOpt(t){if(this.focuedView){const e=this.focuedView.cameraOpt;Pt.isEqual(e,t)||(this.focuedView.cameraOpt=t)}}transformToOriginPoint(t,e){const r=this.getView(e);if(r!=null&&r.viewData){const i=r.viewData.convertToPointOnScreen(t[0],t[1]);return[i.x,i.y]}return t}transformToScenePoint(t,e){const r=this.getView(e);if(r!=null&&r.viewData){const i=r.viewData.convertToPointInWorld({x:t[0],y:t[1]});return[i.x,i.y]}return t}render(t){var e,r,i,o,s,a,l,u,p,c,g,v,I,w,y,T,h;for(const m of t){const{rect:d,imageBitmap:M,isClear:x,isUnClose:E,drawCanvas:P,clearCanvas:R,viewId:N}=m,b=(e=this.getView(N))==null?void 0:e.displayer;if(b&&d){const{dpr:j,canvasBgRef:O,canvasFloatRef:L,canvasServiceFloatRef:k,canvasTopRef:H}=b,Q=Math.floor(d.w*j),_=Math.floor(d.h*j),st=d.x*j,F=d.y*j;if(x){switch(R){case de.TopFloat:(i=(r=H.current)==null?void 0:r.getContext("2d"))==null||i.clearRect(st,F,Q,_);break;case de.Float:(s=(o=L.current)==null?void 0:o.getContext("2d"))==null||s.clearRect(st,F,Q,_);break;case de.ServiceFloat:(l=(a=k.current)==null?void 0:a.getContext("2d"))==null||l.clearRect(st,F,Q,_);break;case de.Bg:(p=(u=O.current)==null?void 0:u.getContext("2d"))==null||p.clearRect(st,F,Q,_);break}continue}if(P&&M)switch(P){case de.TopFloat:(g=(c=H.current)==null?void 0:c.getContext("2d"))==null||g.drawImage(M,0,0,Q,_,st,F,Q,_);break;case de.Float:{(I=(v=L.current)==null?void 0:v.getContext("2d"))==null||I.drawImage(M,0,0,Q,_,st,F,Q,_);break}case de.ServiceFloat:{(y=(w=k.current)==null?void 0:w.getContext("2d"))==null||y.drawImage(M,0,0,Q,_,st,F,Q,_);break}case de.Bg:{(h=(T=O.current)==null?void 0:T.getContext("2d"))==null||h.drawImage(M,0,0,Q,_,st,F,Q,_);break}}if(E)continue;M?.close()}}}showFloatBar(t,e,r){const i=this.getView(t),o=i?.displayer.vDom;o&&o.showFloatBar(e,r)}activeTextEditor(t){const e=this.getView(t),r=e?.displayer.vDom;r&&r.activeTextEditor()}unActiveTextEditor(t){const e=this.getView(t),r=e?.displayer.vDom;r&&r.unActiveTextEditor()}showFloatBarBtn(t,e){const r=this.getView(t),i=r?.displayer.vDom;i&&i.showFloatBarBtn(e)}updateTextEditorInfo(t,e){const r=this.getView(t),i=r?.displayer.vDom;i&&i.updateTextEditorInfo(e)}setActiveMiniMap(t,e){const r=this.getView(t),i=r?.displayer.vDom;i&&i.setActiveMiniMap(e&&t||void 0)}}G(bo,"defaultCameraOpt",{centerX:0,centerY:0,scale:1}),G(bo,"defaultScreenCanvasOpt",{autoRender:!1,contextType:"webgl2"}),G(bo,"defaultLayerOpt",{offscreen:!0,handleEvent:!1,depth:!1});class ML{constructor(t,e,r){G(this,"viewId"),G(this,"control"),G(this,"internalMsgEmitter"),G(this,"commiter"),G(this,"cachePoint"),G(this,"cacheCursorPoint"),G(this,"active",!0),G(this,"toolsKey"),G(this,"mousedown",o=>{var s;if(this.active&&o.button===0&&this.viewId){this.worker.checkDrawingWork(this.viewId),this.reflashContainerOffset(),this.toolsKey=(s=this.worker.getCurrentToolsData())==null?void 0:s.toolsType;const a=this.getPoint(o);this.cachePoint=a,a&&this.worker.originalEventLintener(Tt.Start,a,this.viewId),document.addEventListener("mousemove",this.mousemove,!1),document.addEventListener("mouseleave",this.mouseup,!1),document.addEventListener("mouseup",this.mouseup,!1)}}),G(this,"mousemove",o=>{if(this.active&&this.viewId){const s=this.getPoint(o);if(this.cachePoint=s,this.checkConsumeCount())return;s&&this.worker.originalEventLintener(Tt.Doing,s,this.viewId)}}),G(this,"mouseup",o=>{if(this.active&&o.button===0&&this.viewId){const s=this.getPoint(o)||this.cachePoint;s?(this.worker.originalEventLintener(Tt.Done,s,this.viewId).finally(()=>{document.removeEventListener("mouseleave",this.mouseup,!1),document.removeEventListener("mousemove",this.mousemove,!1),document.removeEventListener("mouseup",this.mouseup,!1)}),this.cachePoint=void 0):(document.removeEventListener("mouseleave",this.mouseup,!1),document.removeEventListener("mousemove",this.mousemove,!1),document.removeEventListener("mouseup",this.mouseup,!1))}}),G(this,"touchstart",o=>{var s;if(this.active){if(!li(o)){this.worker.unWritable(),this.viewId&&this.worker.removeDrawingWork(this.viewId);return}if(this.viewId){this.toolsKey=(s=this.worker.getCurrentToolsData())==null?void 0:s.toolsType,!this.worker.isAbled()&&this.toolsKey&&this.control.effectViewContainer(this.toolsKey),this.worker.checkDrawingWork(this.viewId),this.reflashContainerOffset();const a=this.getPoint(o);this.cachePoint=a,a&&(this.worker.originalEventLintener(Tt.Start,a,this.viewId),document.addEventListener("touchmove",this.touchmove,!1),document.addEventListener("touchend",this.touchend,!1))}}}),G(this,"touchmove",o=>{if(this.active){if(!li(o)){this.worker.unWritable(),this.worker.removeDrawingWork(this.viewId);return}if(this.viewId){const s=this.getPoint(o);if(this.cachePoint=s,this.checkConsumeCount())return;s&&this.worker.originalEventLintener(Tt.Doing,s,this.viewId)}}}),G(this,"touchend",o=>{if(this.active){if(!li(o)||!this.worker.isAbled()){this.worker.unWritable(),this.worker.removeDrawingWork(this.viewId);return}if(this.viewId){const s=this.getPoint(o)||this.cachePoint;s?(this.worker.originalEventLintener(Tt.Done,s,this.viewId).finally(()=>{document.removeEventListener("touchmove",this.touchmove,!1),document.removeEventListener("touchend",this.touchend,!1)}),this.cachePoint=void 0):(document.removeEventListener("touchmove",this.touchmove,!1),document.removeEventListener("touchend",this.touchend,!1))}}}),G(this,"cursorMouseMove",Pt.throttle(o=>{const s=this.getPoint(o);this.cacheCursorPoint&&Pt.isEqual(s,this.cacheCursorPoint)||!this.viewId||(this.cacheCursorPoint=s,s&&this.worker.sendCursorEvent(s,this.viewId))},30,{leading:!1})),G(this,"cursorMouseLeave",Pt.throttle(()=>{this.viewId&&(this.cacheCursorPoint=[void 0,void 0],this.worker.sendCursorEvent(this.cacheCursorPoint,this.viewId))},30,{leading:!1})),G(this,"keydown",o=>{this.control.hotkeyManager.colloctHotkey(o)}),this.viewId=t,this.control=e,this.internalMsgEmitter=r;const i={control:this.control,internalMsgEmitter:this.internalMsgEmitter,viewId:this.viewId};this.commiter=new Sv(i)}get worker(){return this.control.worker}bindToolsClass(){var t,e;const r=(e=(t=this.worker)==null?void 0:t.currentToolsData)==null?void 0:e.toolsType;switch(r){case nt.Text:case nt.Pencil:case nt.LaserPen:case nt.Arrow:case nt.Straight:case nt.Rectangle:case nt.Ellipse:case nt.Star:case nt.Polygon:case nt.SpeechBalloon:case nt.Eraser:case nt.PencilEraser:case nt.BitMapEraser:case nt.Selector:this.eventTragetElement&&(this.eventTragetElement.className=`netless-whiteboard ${r===nt.Selector?"cursor-selector":r===nt.Text?"cursor-text":r===nt.Eraser||r===nt.PencilEraser||r===nt.BitMapEraser?"cursor-eraser":r===nt.Pencil||r===nt.LaserPen?"cursor-pencil":"cursor-arrow"}`);break}}mountView(){this.setCanvassStyle(),this.control.viewContainerManager.mountView(this.viewId)}reflashContainerOffset(){this.eventTragetElement&&(this.containerOffset=this.getContainerOffset(this.eventTragetElement,{x:0,y:0}))}updateSize(){this.setCanvassStyle(),this.reflashContainerOffset()}setViewId(t){this.viewId=t}get parentElement(){var t;return(t=this.eventTragetElement)==null?void 0:t.parentElement}destroy(){this.eventTragetElement&&this.removeDisplayerEvent(this.eventTragetElement),this.vDom=void 0,this.control.cursor.clearViewCursor(this.viewId),this.internalMsgEmitter.removeAllListeners([Ht.Cursor,this.viewId])}getPoint(t){const e=fh(t);if(e&&Pt.isNumber(e.x)&&Pt.isNumber(e.y))return[e.x-this.containerOffset.x,e.y-this.containerOffset.y]}getActive(){this.active=!0}setActive(t){this.active=t}async stopEventHandler(){this.cachePoint&&(await this.worker.originalEventLintener(Tt.Done,this.cachePoint,this.viewId).finally(()=>{document.removeEventListener("mouseleave",this.mouseup,!1),document.removeEventListener("mousemove",this.mousemove,!1),document.removeEventListener("mouseup",this.mouseup,!1),document.removeEventListener("touchmove",this.touchmove,!1),document.removeEventListener("touchend",this.touchend,!1)}),this.cachePoint=void 0)}getTranslate(t){const e=(t.style.WebkitTransform||getComputedStyle(t,"").getPropertyValue("-webkit-transform")||t.style.transform||getComputedStyle(t,"").getPropertyValue("transform")).match(/-?[0-9]+\.?[0-9]*/g),r=e&&parseInt(e[0])||0,i=e&&parseInt(e[1])||0;return[r,i]}getContainerOffset(t,e){var r;const i=this.getTranslate(t);let o={x:e.x+t.offsetLeft-t.scrollLeft+i[0],y:e.y+t.offsetTop-t.scrollTop+i[1]};return(r=t.offsetParent)!=null&&r.nodeName&&t.offsetParent.nodeName!=="BODY"&&(o=this.getContainerOffset(t.offsetParent,o)),o}get isBezier(){return this.control.pluginOptions.extras.bezier.enable}get maxDrawCount(){return this.control.pluginOptions.extras.bezier.maxDrawCount||me.bezier.maxDrawCount}checkConsumeCount(){return this.cachePoint&&this.toolsKey&&this.toolsKey===nt.Pencil&&this.worker.getConsumeCount()>this.maxDrawCount?(this.stopEventHandler().finally(()=>{this.worker.publicMsgEmitter.emit("forceStop",Ja.longPencil,this.viewId)}),!0):!1}bindDisplayerEvent(t){t.addEventListener("mousedown",this.mousedown,!1),t.addEventListener("touchstart",this.touchstart,!1),this.control.pluginOptions.extras.cursor.enable&&(t.addEventListener("mousemove",this.cursorMouseMove,!1),t.addEventListener("mouseleave",this.cursorMouseLeave,!1)),t.addEventListener("keydown",this.keydown,!0)}removeDisplayerEvent(t){t.removeEventListener("mousedown",this.mousedown,!1),t.removeEventListener("touchstart",this.touchstart,!1),document.removeEventListener("mouseleave",this.mouseup,!1),document.removeEventListener("mousemove",this.mousemove,!1),document.removeEventListener("mouseup",this.mouseup,!1),document.removeEventListener("touchmove",this.touchmove,!1),document.removeEventListener("touchend",this.touchend,!1),this.control.pluginOptions.extras.cursor.enable&&(t.removeEventListener("mousemove",this.cursorMouseMove,!1),t.removeEventListener("mouseleave",this.cursorMouseLeave,!1)),t.removeEventListener("keydown",this.keydown,!0)}}class xv{constructor(t,e){G(this,"viewId",ce),G(this,"control"),G(this,"internalMsgEmitter"),G(this,"commiter"),G(this,"cachePoint"),G(this,"cacheCursorPoint"),G(this,"active",!0),G(this,"toolsKey"),G(this,"mousedown",i=>{var o;if(this.active&&i.button===0){this.worker.checkDrawingWork(this.viewId),this.reflashContainerOffset();const s=this.getPoint(i);this.cachePoint=s,this.toolsKey=(o=this.worker.getCurrentToolsData())==null?void 0:o.toolsType,s&&(this.worker.originalEventLintener(Tt.Start,s,this.viewId),document.addEventListener("mousemove",this.mousemove,!1),document.addEventListener("mouseleave",this.mouseup,!1),document.addEventListener("mouseup",this.mouseup,!1))}}),G(this,"mousemove",i=>{if(!this.active)return;const o=this.getPoint(i);this.cachePoint=o,!this.checkConsumeCount()&&o&&this.worker.originalEventLintener(Tt.Doing,o,this.viewId)}),G(this,"mouseup",i=>{if(this.active&&i.button===0){const o=this.getPoint(i)||this.cachePoint;o?(this.worker.originalEventLintener(Tt.Done,o,this.viewId).finally(()=>{document.removeEventListener("mouseleave",this.mouseup,!1),document.removeEventListener("mousemove",this.mousemove,!1),document.removeEventListener("mouseup",this.mouseup,!1)}),this.cachePoint=void 0):(document.removeEventListener("mouseleave",this.mouseup,!1),document.removeEventListener("mousemove",this.mousemove,!1),document.removeEventListener("mouseup",this.mouseup,!1))}}),G(this,"touchstart",i=>{var o;if(!this.active)return;if(!li(i)){this.worker.unWritable(),this.viewId&&this.worker.removeDrawingWork(this.viewId);return}this.toolsKey=(o=this.worker.getCurrentToolsData())==null?void 0:o.toolsType,!this.worker.isAbled()&&this.toolsKey&&this.control.effectViewContainer(this.toolsKey),this.worker.checkDrawingWork(this.viewId),this.reflashContainerOffset();const s=this.getPoint(i);this.cachePoint=s,s&&(this.worker.originalEventLintener(Tt.Start,s,this.viewId),document.addEventListener("touchmove",this.touchmove,!1),document.addEventListener("touchend",this.touchend,!1))}),G(this,"touchmove",i=>{if(!this.active)return;if(!li(i)){this.worker.unWritable(),this.viewId&&this.worker.removeDrawingWork(this.viewId);return}const o=this.getPoint(i);this.cachePoint=o,!this.checkConsumeCount()&&o&&this.worker.originalEventLintener(Tt.Doing,o,this.viewId)}),G(this,"touchend",i=>{if(!this.active)return;if(!li(i)||!this.worker.isAbled()){this.worker.unWritable(),this.worker.removeDrawingWork(this.viewId);return}const o=this.getPoint(i)||this.cachePoint;o?(this.worker.originalEventLintener(Tt.Done,o,this.viewId).finally(()=>{document.removeEventListener("touchmove",this.touchmove,!1),document.removeEventListener("touchend",this.touchend,!1)}),this.cachePoint=void 0):(document.removeEventListener("touchmove",this.touchmove,!1),document.removeEventListener("touchend",this.touchend,!1))}),G(this,"cursorMouseMove",Pt.throttle(i=>{const o=this.getPoint(i);this.cacheCursorPoint&&Pt.isEqual(o,this.cacheCursorPoint)||(this.cacheCursorPoint=o,o&&this.worker.sendCursorEvent(o,this.viewId))},30,{leading:!1})),G(this,"cursorMouseLeave",Pt.throttle(()=>{this.cacheCursorPoint=[void 0,void 0],this.worker.sendCursorEvent(this.cacheCursorPoint,this.viewId)},30,{leading:!1})),G(this,"keydown",i=>{this.control.hotkeyManager.colloctHotkey(i)}),this.control=t,this.internalMsgEmitter=e;const r={control:this.control,internalMsgEmitter:this.internalMsgEmitter,viewId:this.viewId};this.commiter=new Sv(r)}get worker(){return this.control.worker}bindToolsClass(){var t,e;const r=(e=(t=this.worker)==null?void 0:t.currentToolsData)==null?void 0:e.toolsType,i=this.control.renderControl.isWritable,o=this.worker.isAbled();switch(r){case nt.Text:case nt.Pencil:case nt.LaserPen:case nt.Arrow:case nt.Straight:case nt.Rectangle:case nt.Ellipse:case nt.Star:case nt.Polygon:case nt.SpeechBalloon:case nt.Eraser:case nt.PencilEraser:case nt.BitMapEraser:case nt.Selector:this.eventTragetElement&&(this.eventTragetElement.className=i&&o?`netless-whiteboard ${r===nt.Selector?"cursor-selector":r===nt.Text?"cursor-text":r===nt.Eraser||r===nt.PencilEraser||r===nt.BitMapEraser?"cursor-eraser":r===nt.Pencil||r===nt.LaserPen?"cursor-pencil":"cursor-arrow"}`:"netless-whiteboard");break}}mountView(){this.setCanvassStyle(),this.control.viewContainerManager.mountView(this.viewId)}updateSize(){this.setCanvassStyle()}reflashContainerOffset(){this.eventTragetElement&&(this.containerOffset=this.getContainerOffset(this.eventTragetElement,{x:0,y:0}))}get parentElement(){var t;return(t=this.eventTragetElement)==null?void 0:t.parentElement}destroy(){this.eventTragetElement&&this.removeDisplayerEvent(this.eventTragetElement),this.vDom=void 0,this.control.cursor.destroy(),this.internalMsgEmitter.removeAllListeners([Ht.Cursor,this.viewId])}getPoint(t){const e=fh(t);if(e&&Pt.isNumber(e.x)&&Pt.isNumber(e.y))return[e.x-this.containerOffset.x,e.y-this.containerOffset.y]}getActive(){return this.active}setActive(t){this.active=t}async stopEventHandler(){this.cachePoint&&(await this.worker.originalEventLintener(Tt.Done,this.cachePoint,this.viewId).finally(()=>{document.removeEventListener("mouseleave",this.mouseup,!1),document.removeEventListener("mousemove",this.mousemove,!1),document.removeEventListener("mouseup",this.mouseup,!1),document.removeEventListener("touchmove",this.touchmove,!1),document.removeEventListener("touchend",this.touchend,!1)}),this.cachePoint=void 0)}getTranslate(t){const e=(t.style.WebkitTransform||getComputedStyle(t,"").getPropertyValue("-webkit-transform")||t.style.transform||getComputedStyle(t,"").getPropertyValue("transform")).match(/-?[0-9]+\.?[0-9]*/g),r=e&&parseInt(e[0])||0,i=e&&parseInt(e[1])||0;return[r,i]}getContainerOffset(t,e){var r;const i=this.getTranslate(t);let o={x:e.x+t.offsetLeft-t.scrollLeft+i[0],y:e.y+t.offsetTop-t.scrollTop+i[1]};return(r=t.offsetParent)!=null&&r.nodeName&&t.offsetParent.nodeName!=="BODY"&&(o=this.getContainerOffset(t.offsetParent,o)),o}get isBezier(){return this.control.pluginOptions.extras.bezier.enable}get maxDrawCount(){return this.control.pluginOptions.extras.bezier.maxDrawCount||me.bezier.maxDrawCount}checkConsumeCount(){const t=this.worker.getConsumeCount();return this.cachePoint&&this.toolsKey&&this.toolsKey===nt.Pencil&&t>this.maxDrawCount?(this.stopEventHandler().finally(()=>{this.worker.publicMsgEmitter.emit("forceStop",Ja.longPencil,this.viewId)}),!0):!1}bindDisplayerEvent(t){t.addEventListener("mousedown",this.mousedown,!1),t.addEventListener("touchstart",this.touchstart,!1),this.control.pluginOptions.extras.cursor.enable&&(t.addEventListener("mousemove",this.cursorMouseMove,!1),t.addEventListener("mouseleave",this.cursorMouseLeave,!1)),t.addEventListener("keydown",this.keydown,!0)}removeDisplayerEvent(t){t.removeEventListener("mousedown",this.mousedown,!1),document.removeEventListener("mouseleave",this.mouseup,!1),document.removeEventListener("mousemove",this.mousemove,!1),document.removeEventListener("mouseup",this.mouseup,!1),t.removeEventListener("touchstart",this.touchstart,!1),document.removeEventListener("touchmove",this.touchmove,!1),document.removeEventListener("touchend",this.touchend,!1),this.control.pluginOptions.extras.cursor.enable&&(t.removeEventListener("mousemove",this.cursorMouseMove,!1),t.removeEventListener("mouseleave",this.cursorMouseLeave,!1)),t.removeEventListener("keydown",this.keydown,!0)}}const TL="index-module__Container__nLsM3",IL="index-module__CanvasBox__j2Xe-",wL="index-module__FloatCanvas__d1YR7",SL="index-module__TopFloatCanvas__7IaCw",xL="index-module__CanvasBoxSub__hcMeK",CL="index-module__SnapshotBox__--eeE",EL="index-module__FloatBar__cm-EL",PL="index-module__RotateBtn__HSSkf",NL="index-module__ResizeBtn__yjvda",AL="index-module__CursorBox__2UHvI",DL="index-module__TextEditorContainer__Qm8KC",LL="index-module__ResizeTowBox__HOllX",OL="index-module__FloatBarBtn__FJrOG",Fe={Container:TL,CanvasBox:IL,FloatCanvas:wL,TopFloatCanvas:SL,CanvasBoxSub:xL,SnapshotBox:CL,FloatBar:EL,RotateBtn:PL,ResizeBtn:NL,CursorBox:AL,TextEditorContainer:DL,ResizeTowBox:LL,FloatBarBtn:OL},bL={delete:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDZ2NmEyIDIgMCAwIDEtMiAySDZhMiAyIDAgMCAxLTItMlY2aDBtMS0yYTIgMiAwIDAgMSAyLTJoMmEyIDIgMCAwIDEgMiAyaDBNMyA0aDEwIiBzdHJva2U9IiM0NDRFNjAiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==",duplicate:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxwYXRoIGQ9Ik0xMSAySDZhMSAxIDAgMCAwLTEgMXY4YTEgMSAwIDAgMCAxIDFoNmExIDEgMCAwIDAgMS0xVjRoMGwtMi0yeiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+PHBhdGggZD0iTTExIDJ2MWExIDEgMCAwIDAgMSAxaDFsLTItMnoiLz48cGF0aCBkPSJNOSAxNEg0YTEgMSAwIDAgMS0xLTFWNWgwIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz48L2c+PC9zdmc+","layer-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTE2IDEwLTYgNCA2IDQgNi00em0tNiA4IDYgNCA2LTQiIHN0cm9rZT0iIzMzODFGRiIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+",layer:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTE2IDEwLTYgNCA2IDQgNi00em0tNiA4IDYgNCA2LTQiIHN0cm9rZT0iIzQ0NEU2MCIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+",rotate:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHBhdGggZD0iTTEzIDZhNiA2IDAgMSAxLTMuNzA5IDEuMjgzIi8+PHBhdGggZD0ibTEzIDYgMS40MTQgMi40NUwxMyA2bDIuNDUtMS40MTQiLz48L2c+PC9zdmc+","rotation-button":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iI0ZGRiIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBvcGFjaXR5PSIuMDEiIGQ9Ik0wIDI0VjBoMjR2MjR6Ii8+PHBhdGggZD0iTTUuNzI0IDUuNzI0QTguODQ3IDguODQ3IDAgMCAxIDEyIDMuMTI1YzIuMjcxIDAgNC41NDMuODY2IDYuMjc2IDIuNmE4Ljg0NiA4Ljg0NiAwIDAgMSAyLjU5OCA2LjE0IDguODQ5IDguODQ5IDAgMCAxLTIuNTU5IDYuMzdsLTEuNS0uOTgzQTcuMTA1IDcuMTA1IDAgMCAwIDE5LjEyNSAxMmE3LjEwMyA3LjEwMyAwIDAgMC0yLjA4Ny01LjAzOEE3LjEwMyA3LjEwMyAwIDAgMCAxMiA0Ljg3NWE3LjEwMyA3LjEwMyAwIDAgMC01LjAzOCAyLjA4NyA3LjEwMSA3LjEwMSAwIDAgMC0yLjA4NiA0LjkyIDcuMTAzIDcuMTAzIDAgMCAwIDEuNzY2IDQuODE1bDEuOTQ1LTEuNTg0IDIuMzk0IDcuMTgyLTcuMjIyLTIuNDA4IDEuNzkxLTEuNzlBOC44NDYgOC44NDYgMCAwIDEgMy4xMjUgMTJjMC0yLjI3MS44NjYtNC41NDMgMi42LTYuMjc2eiIgc3Ryb2tlPSIjRkZGIiBzdHJva2Utd2lkdGg9Ii41IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48L2c+PC9zdmc+",rotation:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBmaWxsPSIjRkZGIiBvcGFjaXR5PSIuMDEiIGQ9Ik0wIDI0VjBoMjR2MjR6Ii8+PHBhdGggZD0iTTUuNzI0IDUuNzI0QTguODQ3IDguODQ3IDAgMCAxIDEyIDMuMTI1YzIuMjcxIDAgNC41NDMuODY2IDYuMjc2IDIuNmE4Ljg0NiA4Ljg0NiAwIDAgMSAyLjU5OCA2LjE0IDguODQ5IDguODQ5IDAgMCAxLTIuNTU5IDYuMzdsLTEuNS0uOTgzQTcuMTA1IDcuMTA1IDAgMCAwIDE5LjEyNSAxMmE3LjEwMyA3LjEwMyAwIDAgMC0yLjA4Ny01LjAzOEE3LjEwMyA3LjEwMyAwIDAgMCAxMiA0Ljg3NWE3LjEwMyA3LjEwMyAwIDAgMC01LjAzOCAyLjA4NyA3LjEwMSA3LjEwMSAwIDAgMC0yLjA4NiA0LjkyIDcuMTAzIDcuMTAzIDAgMCAwIDEuNzY2IDQuODE1bDEuOTQ1LTEuNTg0IDIuMzk0IDcuMTgyLTcuMjIyLTIuNDA4IDEuNzkxLTEuNzlBOC44NDYgOC44NDYgMCAwIDEgMy4xMjUgMTJjMC0yLjI3MS44NjYtNC41NDMgMi42LTYuMjc2eiIgc3Ryb2tlPSIjRkZGIiBzdHJva2Utd2lkdGg9Ii41IiBmaWxsPSIjMDAwIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48L2c+PC9zdmc+","font-colors-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTQgMTEgNC05IDQgOU02IDdoNCIgc3Ryb2tlPSIjMzM4MUZGIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=","font-colors":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTQgMTEgNC05IDQgOU02IDdoNCIgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=","to-bottom":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDEwdjhtMCAwLTItMm0yIDIgMi0ybS00IDZoMTJtLTYtNGg2bS02LTRoNm0tNi00aDYiIHN0cm9rZT0iIzQ0NEU2MCIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","to-top":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDIydi04bTAgMC0yIDJtMi0yIDIgMm0tNC02aDEybS02IDRoNm0tNiA0aDZtLTYgNGg2IiBzdHJva2U9IiM0NDRFNjAiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==","bold-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQuNSAySDhhMi41IDIuNSAwIDAgMSAwIDVINS41aDBtLTEgMGg0YTMgMyAwIDAgMSAwIDZoLTQgMG0wIDFWMiIgc3Ryb2tlPSIjMzM4MUZGIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=",bold:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQuNSAySDhhMi41IDIuNSAwIDAgMSAwIDVINS41aDBtLTEgMGg0YTMgMyAwIDAgMSAwIDZoLTQgMG0wIDFWMiIgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=","underline-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDJ2NWE0IDQgMCAxIDEtOCAwVjJoME0zIDE0aDEwIiBzdHJva2U9IiMzMzgxRkYiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==",underline:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDJ2NWE0IDQgMCAxIDEtOCAwVjJoME0zIDE0aDEwIiBzdHJva2U9IiM0NDRFNjAiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==","line-through-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQgOGg4bS0xLTNhMyAzIDAgMCAwLTMtM2gtLjkzOEEyLjY0IDIuNjQgMCAwIDAgNC41IDRhMi41NyAyLjU3IDAgMCAwIDEuMzQ0IDIuOTIybDQuMzEyIDIuMTU2QTIuNTcgMi41NyAwIDAgMSAxMS41IDEyYTIuNjQgMi42NCAwIDAgMS0yLjU2MiAySDdhMyAzIDAgMCAxLTMtM2gwIiBzdHJva2U9IiMzMzgxRkYiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==","line-through":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQgOGg4bS0xLTNhMyAzIDAgMCAwLTMtM2gtLjkzOEEyLjY0IDIuNjQgMCAwIDAgNC41IDRhMi41NyAyLjU3IDAgMCAwIDEuMzQ0IDIuOTIybDQuMzEyIDIuMTU2QTIuNTcgMi41NyAwIDAgMSAxMS41IDEyYTIuNjQgMi42NCAwIDAgMS0yLjU2MiAySDdhMyAzIDAgMCAxLTMtM2gwIiBzdHJva2U9IiM0NDRFNjAiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==","italic-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTcgMTQgOSAyTTUgMTRoNE03IDJoNCIgc3Ryb2tlPSIjMzM4MUZGIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=",italic:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTcgMTQgOSAyTTUgMTRoNE03IDJoNCIgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=","unlock-new":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGZpbGw9IiMzMzgxRkYiIGN4PSIxNiIgY3k9IjE3IiByPSIxIi8+PHJlY3Qgc3Ryb2tlPSIjMzM4MUZGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHg9IjExIiB5PSIxNCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjgiIHJ4PSIyIi8+PHBhdGggZD0iTTEzIDE0di0xYTMgMyAwIDAgMSA2IDB2MWgwbS0zIDN2MyIgc3Ryb2tlPSIjMzM4MUZGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L2c+PC9zdmc+","lock-new":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGZpbGw9IiM0NDRFNjAiIGN4PSIxNiIgY3k9IjE3IiByPSIxIi8+PHJlY3Qgc3Ryb2tlPSIjNDQ0RTYwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHg9IjExIiB5PSIxNCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjgiIHJ4PSIyIi8+PHBhdGggZD0iTTEzIDE0di0zYTMgMyAwIDAgMSA2IDB2MWgwbS0zIDV2MyIgc3Ryb2tlPSIjNDQ0RTYwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L2c+PC9zdmc+",shapes:"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiI+PHBhdGggZD0iTTY4Mi42NjY2NjcgMTAyNEM2ODIuNjY2NjY3IDEwMjQgNjgyLjY2NjY2NyAxMDI0IDY4Mi42NjY2NjcgMTAyNEwxNzAuNjY2NjY3IDEwMjRjLTE3LjA2NjY2NyAwLTI5Ljg2NjY2Ny04LjUzMzMzMy0zOC40LTIxLjMzMzMzMy04LjUzMzMzMy0xMi44LTguNTMzMzMzLTI5Ljg2NjY2NyAwLTQyLjY2NjY2N2wyNTYtMzg0YzE3LjA2NjY2Ny0yNS42IDU1LjQ2NjY2Ny0yNS42IDcyLjUzMzMzMyAwbDI1MS43MzMzMzMgMzc5LjczMzMzM2M4LjUzMzMzMyA4LjUzMzMzMyAxMi44IDE3LjA2NjY2NyAxMi44IDI5Ljg2NjY2N0M3MjUuMzMzMzMzIDEwMDYuOTMzMzMzIDcwOC4yNjY2NjcgMTAyNCA2ODIuNjY2NjY3IDEwMjR6TTI1MS43MzMzMzMgOTM4LjY2NjY2N2wzNTQuMTMzMzMzIDBMNDI2LjY2NjY2NyA2NzQuMTMzMzMzIDI1MS43MzMzMzMgOTM4LjY2NjY2N3oiIGZpbGw9IiM0NDRFNjAiPjwvcGF0aD48cGF0aCBkPSJNOTgxLjMzMzMzMyA3MjUuMzMzMzMzbC0zNDEuMzMzMzMzIDBjLTI1LjYgMC00Mi42NjY2NjctMTcuMDY2NjY3LTQyLjY2NjY2Ny00Mi42NjY2NjdMNTk3LjMzMzMzMyAzNDEuMzMzMzMzYzAtMjUuNiAxNy4wNjY2NjctNDIuNjY2NjY3IDQyLjY2NjY2Ny00Mi42NjY2NjdsMzQxLjMzMzMzMyAwYzI1LjYgMCA0Mi42NjY2NjcgMTcuMDY2NjY3IDQyLjY2NjY2NyA0Mi42NjY2NjdsMCAzNDEuMzMzMzMzQzEwMjQgNzA4LjI2NjY2NyAxMDA2LjkzMzMzMyA3MjUuMzMzMzMzIDk4MS4zMzMzMzMgNzI1LjMzMzMzM3pNNjgyLjY2NjY2NyA2NDBsMjU2IDBMOTM4LjY2NjY2NyAzODRsLTI1NiAwTDY4Mi42NjY2NjcgNjQweiIgZmlsbD0iIzQ0NEU2MCI+PC9wYXRoPjxwYXRoIGQ9Ik0yNzcuMzMzMzMzIDU1NC42NjY2NjdDMTIzLjczMzMzMyA1NTQuNjY2NjY3IDAgNDMwLjkzMzMzMyAwIDI3Ny4zMzMzMzNTMTIzLjczMzMzMyAwIDI3Ny4zMzMzMzMgMCA1NTQuNjY2NjY3IDEyMy43MzMzMzMgNTU0LjY2NjY2NyAyNzcuMzMzMzMzIDQzMC45MzMzMzMgNTU0LjY2NjY2NyAyNzcuMzMzMzMzIDU1NC42NjY2Njd6TTI3Ny4zMzMzMzMgODUuMzMzMzMzQzE3MC42NjY2NjcgODUuMzMzMzMzIDg1LjMzMzMzMyAxNzAuNjY2NjY3IDg1LjMzMzMzMyAyNzcuMzMzMzMzUzE3MC42NjY2NjcgNDY5LjMzMzMzMyAyNzcuMzMzMzMzIDQ2OS4zMzMzMzMgNDY5LjMzMzMzMyAzODQgNDY5LjMzMzMzMyAyNzcuMzMzMzMzIDM4NCA4NS4zMzMzMzMgMjc3LjMzMzMzMyA4NS4zMzMzMzN6IiBmaWxsPSIjNDQ0RTYwIj48L3BhdGg+PC9zdmc+","shapes-active":"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiI+PHBhdGggZD0iTTY4Mi42NjY2NjcgMTAyNEM2ODIuNjY2NjY3IDEwMjQgNjgyLjY2NjY2NyAxMDI0IDY4Mi42NjY2NjcgMTAyNEwxNzAuNjY2NjY3IDEwMjRjLTE3LjA2NjY2NyAwLTI5Ljg2NjY2Ny04LjUzMzMzMy0zOC40LTIxLjMzMzMzMy04LjUzMzMzMy0xMi44LTguNTMzMzMzLTI5Ljg2NjY2NyAwLTQyLjY2NjY2N2wyNTYtMzg0YzE3LjA2NjY2Ny0yNS42IDU1LjQ2NjY2Ny0yNS42IDcyLjUzMzMzMyAwbDI1MS43MzMzMzMgMzc5LjczMzMzM2M4LjUzMzMzMyA4LjUzMzMzMyAxMi44IDE3LjA2NjY2NyAxMi44IDI5Ljg2NjY2N0M3MjUuMzMzMzMzIDEwMDYuOTMzMzMzIDcwOC4yNjY2NjcgMTAyNCA2ODIuNjY2NjY3IDEwMjR6TTI1MS43MzMzMzMgOTM4LjY2NjY2N2wzNTQuMTMzMzMzIDBMNDI2LjY2NjY2NyA2NzQuMTMzMzMzIDI1MS43MzMzMzMgOTM4LjY2NjY2N3oiIGZpbGw9IiMzMzgxRkYiPjwvcGF0aD48cGF0aCBkPSJNOTgxLjMzMzMzMyA3MjUuMzMzMzMzbC0zNDEuMzMzMzMzIDBjLTI1LjYgMC00Mi42NjY2NjctMTcuMDY2NjY3LTQyLjY2NjY2Ny00Mi42NjY2NjdMNTk3LjMzMzMzMyAzNDEuMzMzMzMzYzAtMjUuNiAxNy4wNjY2NjctNDIuNjY2NjY3IDQyLjY2NjY2Ny00Mi42NjY2NjdsMzQxLjMzMzMzMyAwYzI1LjYgMCA0Mi42NjY2NjcgMTcuMDY2NjY3IDQyLjY2NjY2NyA0Mi42NjY2NjdsMCAzNDEuMzMzMzMzQzEwMjQgNzA4LjI2NjY2NyAxMDA2LjkzMzMzMyA3MjUuMzMzMzMzIDk4MS4zMzMzMzMgNzI1LjMzMzMzM3pNNjgyLjY2NjY2NyA2NDBsMjU2IDBMOTM4LjY2NjY2NyAzODRsLTI1NiAwTDY4Mi42NjY2NjcgNjQweiIgZmlsbD0iIzMzODFGRiI+PC9wYXRoPjxwYXRoIGQ9Ik0yNzcuMzMzMzMzIDU1NC42NjY2NjdDMTIzLjczMzMzMyA1NTQuNjY2NjY3IDAgNDMwLjkzMzMzMyAwIDI3Ny4zMzMzMzNTMTIzLjczMzMzMyAwIDI3Ny4zMzMzMzMgMCA1NTQuNjY2NjY3IDEyMy43MzMzMzMgNTU0LjY2NjY2NyAyNzcuMzMzMzMzIDQzMC45MzMzMzMgNTU0LjY2NjY2NyAyNzcuMzMzMzMzIDU1NC42NjY2Njd6TTI3Ny4zMzMzMzMgODUuMzMzMzMzQzE3MC42NjY2NjcgODUuMzMzMzMzIDg1LjMzMzMzMyAxNzAuNjY2NjY3IDg1LjMzMzMzMyAyNzcuMzMzMzMzUzE3MC42NjY2NjcgNDY5LjMzMzMzMyAyNzcuMzMzMzMzIDQ2OS4zMzMzMzMgNDY5LjMzMzMzMyAzODQgNDY5LjMzMzMzMyAyNzcuMzMzMzMzIDM4NCA4NS4zMzMzMzMgMjc3LjMzMzMzMyA4NS4zMzMzMzN6IiBmaWxsPSIjMzM4MUZGIj48L3BhdGg+PC9zdmc+","font-style-active":"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiI+PHBhdGggZD0iTTM2MC4yMzQ2NjcgMjEzLjMzMzMzM0w1NTQuNjY2NjY3IDc3Ni4yNzczMzNoLTc2LjU0NGwtNTQuNjEzMzM0LTE3Mi4wMzJIMjE0LjE4NjY2N2wtNTUuNDY2NjY3IDE3Mi4wMzJIODUuMzMzMzMzTDI3OS43NjUzMzMgMjEzLjMzMzMzM2g4MC40NjkzMzR6IG00MTAuMDI2NjY2IDE3My44MjRjOTAuMTEyIDAgMTI4LjM0MTMzMyA2MC43NTczMzMgMTI4LjM0MTMzNCAxNTIuMjM0NjY3djIyOC4wMTA2NjdoLTUxLjJsLTUuNDYxMzM0LTQ0LjM3MzMzNGgtMi4wNDhjLTM1LjQ5ODY2NyAyOS4zNTQ2NjctNzcuMTQxMzMzIDUzLjI0OC0xMjIuODggNTMuMjQ4LTYyLjEyMjY2NyAwLTEwOC41NDQtMzguMjI5MzMzLTEwOC41NDQtMTA1LjEzMDY2NiAwLTgwLjU1NDY2NyA3MC4zMTQ2NjctMTIwLjgzMiAyMjguMDEwNjY3LTEzOC41ODEzMzQgMC00Ny43ODY2NjctMTUuNzAxMzMzLTkzLjUyNTMzMy03Ni40NTg2NjctOTMuNTI1MzMzLTQzLjAwOCAwLTgxLjkyIDE5Ljc5NzMzMy0xMTEuMjc0NjY2IDM5LjU5NDY2N2wtMjQuNTc2LTQzLjAwOGMzNC4xMzMzMzMtMjEuODQ1MzMzIDg2LjY5ODY2Ny00OC40NjkzMzMgMTQ2LjA5MDY2Ni00OC40NjkzMzR6IG02Ni4yMTg2NjcgMTg2LjM2OGMtMTI0LjkyOCAxNS4wMTg2NjctMTY3LjI1MzMzMyA0NS43Mzg2NjctMTY3LjI1MzMzMyA5My41MjUzMzQgMCA0Mi4zMjUzMzMgMjguNjcyIDU5LjM5MiA2NS41MzYgNTkuMzkyIDM2LjE4MTMzMyAwIDY1LjUzNi0xNy4wNjY2NjcgMTAxLjcxNzMzMy00OS4xNTJ6TTMyMC4zODQgMjcwLjkzMzMzM2gtMy4xMTQ2NjdjLTE3Ljk2MjY2NyA2Ni4wNDgtMzYuNjkzMzMzIDEyNi43Mi01Ny4wMDI2NjYgMTkwLjQ2NGwtMjguMTYgODYuMDE2aDE3My4zOTczMzNsLTI3LjMwNjY2Ny04Ni4wMTZBNDkxMy40OTMzMzMgNDkxMy40OTMzMzMgMCAwIDEgMzIwLjM4NCAyNzAuOTMzMzMzeiIgZmlsbD0iIzMzODFGRiI+PC9wYXRoPjwvc3ZnPg==","font-style":"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiI+PHBhdGggZD0iTTM2MC4yMzQ2NjcgMjEzLjMzMzMzM0w1NTQuNjY2NjY3IDc3Ni4yNzczMzNoLTc2LjU0NGwtNTQuNjEzMzM0LTE3Mi4wMzJIMjE0LjE4NjY2N2wtNTUuNDY2NjY3IDE3Mi4wMzJIODUuMzMzMzMzTDI3OS43NjUzMzMgMjEzLjMzMzMzM2g4MC40NjkzMzR6IG00MTAuMDI2NjY2IDE3My44MjRjOTAuMTEyIDAgMTI4LjM0MTMzMyA2MC43NTczMzMgMTI4LjM0MTMzNCAxNTIuMjM0NjY3djIyOC4wMTA2NjdoLTUxLjJsLTUuNDYxMzM0LTQ0LjM3MzMzNGgtMi4wNDhjLTM1LjQ5ODY2NyAyOS4zNTQ2NjctNzcuMTQxMzMzIDUzLjI0OC0xMjIuODggNTMuMjQ4LTYyLjEyMjY2NyAwLTEwOC41NDQtMzguMjI5MzMzLTEwOC41NDQtMTA1LjEzMDY2NiAwLTgwLjU1NDY2NyA3MC4zMTQ2NjctMTIwLjgzMiAyMjguMDEwNjY3LTEzOC41ODEzMzQgMC00Ny43ODY2NjctMTUuNzAxMzMzLTkzLjUyNTMzMy03Ni40NTg2NjctOTMuNTI1MzMzLTQzLjAwOCAwLTgxLjkyIDE5Ljc5NzMzMy0xMTEuMjc0NjY2IDM5LjU5NDY2N2wtMjQuNTc2LTQzLjAwOGMzNC4xMzMzMzMtMjEuODQ1MzMzIDg2LjY5ODY2Ny00OC40NjkzMzMgMTQ2LjA5MDY2Ni00OC40NjkzMzR6IG02Ni4yMTg2NjcgMTg2LjM2OGMtMTI0LjkyOCAxNS4wMTg2NjctMTY3LjI1MzMzMyA0NS43Mzg2NjctMTY3LjI1MzMzMyA5My41MjUzMzQgMCA0Mi4zMjUzMzMgMjguNjcyIDU5LjM5MiA2NS41MzYgNTkuMzkyIDM2LjE4MTMzMyAwIDY1LjUzNi0xNy4wNjY2NjcgMTAxLjcxNzMzMy00OS4xNTJ6TTMyMC4zODQgMjcwLjkzMzMzM2gtMy4xMTQ2NjdjLTE3Ljk2MjY2NyA2Ni4wNDgtMzYuNjkzMzMzIDEyNi43Mi01Ny4wMDI2NjYgMTkwLjQ2NGwtMjguMTYgODYuMDE2aDE3My4zOTczMzNsLTI3LjMwNjY2Ny04Ni4wMTZBNDkxMy40OTMzMzMgNDkxMy40OTMzMzMgMCAwIDEgMzIwLjM4NCAyNzAuOTMzMzMzeiIgZmlsbD0iIzQ0NEU2MCI+PC9wYXRoPjwvc3ZnPg==",polygon:"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiI+PHBhdGggZD0iTTkzMy4xMiA0OTAuNjY2NjY3bC0xOTItMzMyLjM3MzMzNGE0Mi42NjY2NjcgNDIuNjY2NjY3IDAgMCAwLTM3LjEyLTIxLjMzMzMzM2gtMzg0YTQyLjY2NjY2NyA0Mi42NjY2NjcgMCAwIDAtMzcuMTIgMjEuMzMzMzMzbC0xOTIgMzMyLjM3MzMzNGE0Mi42NjY2NjcgNDIuNjY2NjY3IDAgMCAwIDAgNDIuNjY2NjY2bDE5MiAzMzIuMzczMzM0YTQyLjY2NjY2NyA0Mi42NjY2NjcgMCAwIDAgMzcuMTIgMjEuMzMzMzMzaDM4NGE0Mi42NjY2NjcgNDIuNjY2NjY3IDAgMCAwIDM3LjEyLTIxLjMzMzMzM2wxOTItMzMyLjM3MzMzNGE0Mi42NjY2NjcgNDIuNjY2NjY3IDAgMCAwIDAtNDIuNjY2NjY2eiBtLTI1NiAzMTEuMDRIMzQ0Ljc0NjY2N0wxNzcuMDY2NjY3IDUxMmwxNjcuNjgtMjg5LjcwNjY2N2gzMzQuNTA2NjY2TDg0Ni45MzMzMzMgNTEyeiIgZmlsbD0iIzQ0NEU2MCI+PC9wYXRoPjwvc3ZnPg==","polygon-active":"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiI+PHBhdGggZD0iTTkzMy4xMiA0OTAuNjY2NjY3bC0xOTItMzMyLjM3MzMzNGE0Mi42NjY2NjcgNDIuNjY2NjY3IDAgMCAwLTM3LjEyLTIxLjMzMzMzM2gtMzg0YTQyLjY2NjY2NyA0Mi42NjY2NjcgMCAwIDAtMzcuMTIgMjEuMzMzMzMzbC0xOTIgMzMyLjM3MzMzNGE0Mi42NjY2NjcgNDIuNjY2NjY3IDAgMCAwIDAgNDIuNjY2NjY2bDE5MiAzMzIuMzczMzM0YTQyLjY2NjY2NyA0Mi42NjY2NjcgMCAwIDAgMzcuMTIgMjEuMzMzMzMzaDM4NGE0Mi42NjY2NjcgNDIuNjY2NjY3IDAgMCAwIDM3LjEyLTIxLjMzMzMzM2wxOTItMzMyLjM3MzMzNGE0Mi42NjY2NjcgNDIuNjY2NjY3IDAgMCAwIDAtNDIuNjY2NjY2eiBtLTI1NiAzMTEuMDRIMzQ0Ljc0NjY2N0wxNzcuMDY2NjY3IDUxMmwxNjcuNjgtMjg5LjcwNjY2N2gzMzQuNTA2NjY2TDg0Ni45MzMzMzMgNTEyeiIgZmlsbD0iIzMzODFGRiI+PC9wYXRoPjwvc3ZnPg==","polygon-vertex":"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTA3NyAxMDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiI+PHBhdGggZD0iTTU0My40NzQ1MjYgNDIuMzA3MzY4YTExOS4zNzY4NDIgMTE5LjM3Njg0MiAwIDAgMSAxMTAuODA3NTc5IDE2My44NGwxOTAuNTcxNzkgMTM4LjYxNzI2NGExMTkuMzc2ODQyIDExOS4zNzY4NDIgMCAxIDEgODMuMzc1MTU4IDIxOC43MDQ4NDJsLTc0LjMyMDg0MiAyMjguODM3MDUyYTExOS4zMjI5NDcgMTE5LjMyMjk0NyAwIDAgMS02MS4yNzgzMTYgMjIxLjg4NDYzMmMtNDYuNzgwNjMyIDAtODcuMzA5NDc0LTI2Ljk0NzM2OC0xMDYuODczMjYzLTY2LjEyODg0MmgtMjg5LjQxNDczN2ExMTkuMzc2ODQyIDExOS4zNzY4NDIgMCAxIDEtMTc5LjczODk0OC0xNDcuODMzMjYzbC03Mi4yNzI4NDItMjIyLjY5MzA1My0zLjM5NTM2OCAwLjEwNzc4OUExMTkuMzc2ODQyIDExOS4zNzY4NDIgMCAwIDEgMjEuODI3MzY4IDQ2Ni43Mjg0MjFMMjEuNTU3ODk1IDQ1OC4yMTMwNTNhMTE5LjM3Njg0MiAxMTkuMzc2ODQyIDAgMCAxIDE4My44MzQ5NDctMTAwLjUxMzY4NWwyMjMuNTAxNDc0LTE2Mi4zODQ4NDJhMTE5LjQzMDczNyAxMTkuNDMwNzM3IDAgMCAxIDExNC41ODAyMS0xNTMuMDYxMDUyek0yODkuNDE0NzM3IDg0MC4wNTcyNjNhNTQuNzAzMTU4IDU0LjcwMzE1OCAwIDEgMCAwIDEwOS40MDYzMTYgNTQuNzAzMTU4IDU0LjcwMzE1OCAwIDAgMCAwLTEwOS40MDYzMTZ6IG01MDMuMTYxMjYzIDBhNTQuNzAzMTU4IDU0LjcwMzE1OCAwIDEgMCAwIDEwOS40MDYzMTYgNTQuNzAzMTU4IDU0LjcwMzE1OCAwIDAgMCAwLTEwOS40MDYzMTZ6TTQ2Mi42ODYzMTYgMjQ5LjU4NjUyNkwyNDguMTMxMzY4IDQwNS41NTc4OTVhMTE5LjMyMjk0NyAxMTkuMzIyOTQ3IDAgMCAxLTQyLjg0NjMxNSAxNTMuMjIyNzM3bDcwLjcwOTg5NCAyMTcuMzU3NDczYTExOS40MzA3MzcgMTE5LjQzMDczNyAwIDAgMSAxMzIuNDE5MzY5IDEwOC4yMjA2MzJINjczLjY4NDIxMWExMTkuNDMwNzM3IDExOS40MzA3MzcgMCAwIDEgMTE5LjE2MTI2My0xMDguOTc1MTU4bDcxLjE0MTA1Mi0yMTguOTc0MzE2YTExOS40MzA3MzcgMTE5LjQzMDczNyAwIDAgMS02Mi4wODY3MzctMTY0LjIxNzI2M2wtMTg2LjM2OC0xMzUuMjc1Nzg5Yy0xOS45OTQ5NDcgMTUuMDkwNTI2LTQ1LjAwMjEwNSAyNC4xNDQ4NDItNzIuMDU3MjYzIDI0LjE0NDg0MmExMTguOTQ1Njg0IDExOC45NDU2ODQgMCAwIDEtODAuNzg4MjEtMzEuNDc0NTI3eiBtLTMyMS43NTE1NzkgMTUzLjkyMzM2OWE1NC43MDMxNTggNTQuNzAzMTU4IDAgMSAwIDAgMTA5LjQwNjMxNiA1NC43MDMxNTggNTQuNzAzMTU4IDAgMCAwIDAtMTA5LjQwNjMxNnogbTc2Ny43MzA1MjYtMTIuNTU3NDc0YTU0LjcwMzE1OCA1NC43MDMxNTggMCAxIDAgMCAxMDkuNDA2MzE2IDU0LjcwMzE1OCA1NC43MDMxNTggMCAwIDAgMC0xMDkuNDA2MzE2eiBtLTM2NS4xOTA3MzctMjg0LjAyNTI2M2E1NC43MDMxNTggNTQuNzAzMTU4IDAgMSAwIDAgMTA5LjQ2MDIxIDU0LjcwMzE1OCA1NC43MDMxNTggMCAwIDAgMC0xMDkuNDA2MzE1eiIgZmlsbD0iIzQ0NEU2MCI+PC9wYXRoPjwvc3ZnPg==",star:"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiI+PHBhdGggZD0iTTkwOC4xIDM1My4xbC0yNTMuOS0zNi45TDU0MC43IDg2LjFjLTMuMS02LjMtOC4yLTExLjQtMTQuNS0xNC41LTE1LjgtNy44LTM1LTEuMy00Mi45IDE0LjVMMzY5LjggMzE2LjJsLTI1My45IDM2LjljLTcgMS0xMy40IDQuMy0xOC4zIDkuMy0xMi4zIDEyLjctMTIuMSAzMi45IDAuNiA0NS4zbDE4My43IDE3OS4xLTQzLjQgMjUyLjljLTEuMiA2LjktMC4xIDE0LjEgMy4yIDIwLjMgOC4yIDE1LjYgMjcuNiAyMS43IDQzLjIgMTMuNEw1MTIgNzU0bDIyNy4xIDExOS40YzYuMiAzLjMgMTMuNCA0LjQgMjAuMyAzLjIgMTcuNC0zIDI5LjEtMTkuNSAyNi4xLTM2LjlsLTQzLjQtMjUyLjkgMTgzLjctMTc5LjFjNS00LjkgOC4zLTExLjMgOS4zLTE4LjMgMi43LTE3LjUtOS41LTMzLjctMjctMzYuM3pNNjY0LjggNTYxLjZsMzYuMSAyMTAuM0w1MTIgNjcyLjcgMzIzLjEgNzcybDM2LjEtMjEwLjMtMTUyLjgtMTQ5TDQxNy42IDM4MiA1MTIgMTkwLjcgNjA2LjQgMzgybDIxMS4yIDMwLjctMTUyLjggMTQ4Ljl6IiBmaWxsPSIjNDQ0RTYwIj48L3BhdGg+PC9zdmc+","star-active":"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiI+PHBhdGggZD0iTTkwOC4xIDM1My4xbC0yNTMuOS0zNi45TDU0MC43IDg2LjFjLTMuMS02LjMtOC4yLTExLjQtMTQuNS0xNC41LTE1LjgtNy44LTM1LTEuMy00Mi45IDE0LjVMMzY5LjggMzE2LjJsLTI1My45IDM2LjljLTcgMS0xMy40IDQuMy0xOC4zIDkuMy0xMi4zIDEyLjctMTIuMSAzMi45IDAuNiA0NS4zbDE4My43IDE3OS4xLTQzLjQgMjUyLjljLTEuMiA2LjktMC4xIDE0LjEgMy4yIDIwLjMgOC4yIDE1LjYgMjcuNiAyMS43IDQzLjIgMTMuNEw1MTIgNzU0bDIyNy4xIDExOS40YzYuMiAzLjMgMTMuNCA0LjQgMjAuMyAzLjIgMTcuNC0zIDI5LjEtMTkuNSAyNi4xLTM2LjlsLTQzLjQtMjUyLjkgMTgzLjctMTc5LjFjNS00LjkgOC4zLTExLjMgOS4zLTE4LjMgMi43LTE3LjUtOS41LTMzLjctMjctMzYuM3pNNjY0LjggNTYxLjZsMzYuMSAyMTAuM0w1MTIgNjcyLjcgMzIzLjEgNzcybDM2LjEtMjEwLjMtMTUyLjgtMTQ5TDQxNy42IDM4MiA1MTIgMTkwLjcgNjA2LjQgMzgybDIxMS4yIDMwLjctMTUyLjggMTQ4Ljl6IiBmaWxsPSIjMzM4MUZGIj48L3BhdGg+PC9zdmc+","star-innerVertex":"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiI+PHBhdGggZD0iTTg1LjMzMzMzMyAwYTg1LjMzMzMzMyA4NS4zMzMzMzMgMCAwIDEgODEuNDA4IDU5LjczMzMzM2g0OC4yMTMzMzR2ODUuMzMzMzM0TDE3MC42NjY2NjcgMTQ0Ljk4MTMzM1Y4NTMuMzMzMzMzaDY5My4zMzMzMzNsLTI2LjQ1MzMzMy02My40ODggNzguNzYyNjY2LTMyLjc2OCAzMi44NTMzMzQgNzguNzYyNjY3LTQyLjI0IDE3LjQ5MzMzM0g5MzguNjY2NjY3YTg1LjMzMzMzMyA4NS4zMzMzMzMgMCAwIDEgODQuNzM2IDc1LjM0OTMzNEwxMDI0IDkzOC42NjY2NjdhODUuMzMzMzMzIDg1LjMzMzMzMyAwIDAgMS0xNzAuNjY2NjY3IDBIMTcwLjY2NjY2N2E4NS4zMzMzMzMgODUuMzMzMzMzIDAgMSAxLTg1LjMzMzMzNC04NS4zMzMzMzRWMTcwLjY2NjY2N2E4NS4zMzMzMzMgODUuMzMzMzMzIDAgMSAxIDAtMTcwLjY2NjY2N3ogbTc2NS4zNTQ2NjcgNTk5LjQ2NjY2N2wzMi44NTMzMzMgNzguNzYyNjY2LTc4Ljg0OCAzMi44NTMzMzQtMzIuNzY4LTc4Ljc2MjY2NyA3OC43NjI2NjctMzIuODUzMzMzeiBtLTY1LjcwNjY2Ny0xNTcuNTI1MzM0bDMyLjg1MzMzNCA3OC43NjI2NjctNzguNzYyNjY3IDMyLjg1MzMzMy0zMi43NjgtNzguNzYyNjY2IDc4Ljc2MjY2Ny0zMi44NTMzMzR6TTcxOS4zNiAyODQuNDE2bDMyLjg1MzMzMyA3OC43NjI2NjctNzguNzYyNjY2IDMyLjg1MzMzMy0zMi44NTMzMzQtNzguNzYyNjY3IDc4Ljc2MjY2Ny0zMi44NTMzMzN6IG0tNjUuNjIxMzMzLTE1Ny41MjUzMzNsMzIuODUzMzMzIDc4Ljc2MjY2Ni03OC43NjI2NjcgMzIuODUzMzM0LTMyLjg1MzMzMy03OC43NjI2NjcgNzguNzYyNjY3LTMyLjg1MzMzM3pNMzg1LjcwNjY2NyA1OS43MzMzMzN2ODUuMzMzMzM0aC04NS4zMzMzMzR2LTg1LjMzMzMzNGg4NS4zMzMzMzR6IG0xNzAuNjY2NjY2IDB2ODUuMzMzMzM0aC04NS4zMzMzMzN2LTg1LjMzMzMzNGg4NS4zMzMzMzN6IiBmaWxsPSIjNDQ0RTYwIiA+PC9wYXRoPjwvc3ZnPg==","star-innerRatio":"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiI+PHBhdGggZD0iTTU2OS4zNDQgNDQ5LjUzNmwxNDYuOTQ0IDI4LjY3MiAxLjAyNC00LjYwOHY0LjYwOGgxLjAyNGM5LjcyOCAwIDE2Ljg5Ni03LjY4IDIwLjQ4LTE0Ljg0OGwxLjAyNC0yLjA0OHYtMi41NmMwLTUuNjMyIDAtMTEuMjY0LTUuMTItMTYuMzg0LTMuMDcyLTMuMDcyLTcuMTY4LTcuMTY4LTEyLjgtNy42OGwtMTI0LjkyOC0yNC4wNjRMNTQxLjY5NiAyODYuNzJjLTIuMDQ4LTQuNjA4LTYuNjU2LTguMTkyLTExLjc3Ni05LjcyOC01LjEyLTEuNTM2LTEwLjc1Mi0xLjUzNi0xNS4zNiAxLjAyNGwtMS41MzYgMC41MTItMS4wMjQgMS4wMjRjLTguMTkyIDguMTkyLTEwLjc1MiAxOS40NTYtNi42NTYgMjcuMTM2bDY0IDE0Mi44NDh6IiBmaWxsPSIjMzM4MUZGIj48L3BhdGg+PHBhdGggZD0iTTkzMS4zMjggNDAzLjQ1NmMtMTAuMjQtMzUuMzI4LTM4LjQtNjEuNDQtNzEuNjgtNjYuNTZsLTE4NC44MzItMzUuODQtODIuNDMyLTE4Mi43ODRjLTEyLjgtMzMuMjgtNDYuMDgtNTYuMzItODAuMzg0LTU2LjMyLTMzLjc5MiAwLTY0LjUxMiAyMC40OC03OS44NzIgNTMuNzZMMzQ5LjE4NCAyOTkuMDA4bC0xODQuMzIgMzUuMzI4Yy0zMy43OTIgNS4xMi02MS45NTIgMzEuMjMyLTcyLjE5MiA2Ni41Ni05LjcyOCAzNC4zMDQtMS4wMjQgNzIuMTkyIDIzLjA0IDk4LjgxNmwxMzEuNTg0IDEzMy42MzItMzUuODQgMTk2LjYwOGMtNS42MzIgMzQuODE2IDguNzA0IDcxLjY4IDM1Ljg0IDk0LjIwOCAxMy44MjQgMTEuMjY0IDM0LjMwNCAxOC40MzIgNTIuMjI0IDE4LjQzMiAxNi44OTYgMCAyOS42OTYtMy4wNzIgNDEuNDcyLTEwLjI0bDE2OC45Ni05MS4xMzYgMTY2LjkxMiA5MS4xMzYgMS4wMjQgMC41MTJjMTYuODk2IDYuNjU2IDI5LjY5NiA5LjcyOCA0MC40NDggOS43MjggMTQuMzM2IDAgMjcuNjQ4LTQuMDk2IDQwLjQ0OC03LjY4IDQuNjA4LTEuNTM2IDkuNzI4LTMuMDcyIDE0Ljg0OC00LjA5NmwyLjU2LTAuNTEyIDIuMDQ4LTEuNTM2YzI1LjA4OC0yMy4wNCAzNy44ODgtNTguODggMzIuNzY4LTkzLjY5NmwtMzMuMjgtMTk2LjYwOCAxMzEuNTg0LTEzNi4xOTJjMjQuMDY0LTI3LjY0OCAzMi4yNTYtNjIuOTc2IDIyLjAxNi05OC44MTZ6TTI3Ni45OTIgODM2LjA5Nmw0MS45ODQtMjMxLjkzNi0xNTcuMTg0LTE1OS4yMzJjLTUuNjMyLTUuNjMyLTguMTkyLTE3LjQwOC02LjY1Ni0yOS4xODQgMy41ODQtMTAuMjQgMTAuMjQtMTYuMzg0IDE5LjQ1Ni0xNy45MmwyMTguMTEyLTQxLjk4NCA5Ni4yNTYtMjE1LjU1MmMzLjA3Mi03LjE2OCAxMi44LTE0LjMzNiAyMC40OC0xNC4zMzZzMTcuNDA4IDcuMTY4IDIwLjQ4IDE0Ljg0OGw5OC4zMDQgMjE1LjA0IDIxOC4xMTIgNDEuOTg0YzcuMTY4IDEuNTM2IDE1LjM2IDcuMTY4IDE2Ljg5NiAxNi4zODR2My4wNzJjMi4wNDggMTEuNzc2LTAuNTEyIDIyLjUyOC02LjY1NiAzMC43Mkw2OTkuOTA0IDYwOS4yOGwzOS45MzYgMjMxLjQyNGMxLjUzNiAxMC43NTItMi4wNDggMjAuNDgtMTAuMjQgMjcuMTM2bC0xLjAyNCAwLjUxMmMtMi41NiAyLjU2LTYuNjU2IDQuMDk2LTExLjI2NCA0LjA5Ni0yLjA0OCAwLTcuMTY4LTEuNTM2LTExLjI2NC0zLjU4NGwtMTk3LjEyLTEwOC4wMzItMTk5LjE2OCAxMDIuOTEyYy00LjA5NiAyLjA0OC05LjIxNiAzLjU4NC0xMS43NzYgMy41ODQtNC42MDggMC04LjcwNC0xLjUzNi0xMS4yNjQtNC4wOTZsLTEuMDI0LTAuNTEyYy02LjY1Ni02LjE0NC0xMC43NTItMTYuMzg0LTguNzA0LTI2LjYyNHoiIGZpbGw9IiM0NDRFNjAiPjwvcGF0aD48L3N2Zz4=",speechBallon:"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiI+PHBhdGggZD0iTTgzMiA4MzJINDQ4bC0xMjggMTkyLTEyOC0xOTJjLTEwNi4wNDggMC0xOTItODYuMDE2LTE5Mi0xOTJWMTkyYTE5MiAxOTIgMCAwIDEgMTkyLTE5Mmg2NDBjMTA1Ljk4NCAwIDE5MiA4NS45NTIgMTkyIDE5MnY0NDhjMCAxMDUuOTg0LTg2LjAxNiAxOTItMTkyIDE5MnogbTY0LTY0MGE2NCA2NCAwIDAgMC02NC02NEgxOTJDMTU2LjY3MiAxMjggMTI4IDE1Ni42NzIgMTI4IDE5MnY0NDhhNjQgNjQgMCAwIDAgNjQgNjRoNDIuNjg4TDMyMCA4MzJsODUuMzEyLTEyOEg4MzJjMzUuMzkyIDAgNjQtMjguNjA4IDY0LTY0VjE5MnoiIGZpbGw9IiM0NDRFNjAiPjwvcGF0aD48L3N2Zz4=","speechBallon-active":"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiI+PHBhdGggZD0iTTgzMiA4MzJINDQ4bC0xMjggMTkyLTEyOC0xOTJjLTEwNi4wNDggMC0xOTItODYuMDE2LTE5Mi0xOTJWMTkyYTE5MiAxOTIgMCAwIDEgMTkyLTE5Mmg2NDBjMTA1Ljk4NCAwIDE5MiA4NS45NTIgMTkyIDE5MnY0NDhjMCAxMDUuOTg0LTg2LjAxNiAxOTItMTkyIDE5MnogbTY0LTY0MGE2NCA2NCAwIDAgMC02NC02NEgxOTJDMTU2LjY3MiAxMjggMTI4IDE1Ni42NzIgMTI4IDE5MnY0NDhhNjQgNjQgMCAwIDAgNjQgNjRoNDIuNjg4TDMyMCA4MzJsODUuMzEyLTEyOEg4MzJjMzUuMzkyIDAgNjQtMjguNjA4IDY0LTY0VjE5MnoiIGZpbGw9IiMzMzgxRkYiPjwvcGF0aD48L3N2Zz4=","speechBallon-placement":"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiI+PHBhdGggZD0iTTU3NiAyMTMuMzMzMzMzbDIyLjYxMzMzMyAyMi42MTMzMzRhMzIgMzIgMCAwIDAgMC00NS4yMjY2NjdMNTc2IDIxMy4zMzMzMzN6IG0tNjIuNzItMTA3Ljk0NjY2NmEzMiAzMiAwIDEgMC00NS4yMjY2NjcgNDUuMjI2NjY2bDQ1LjIyNjY2Ny00NS4yMjY2NjZ6IG0tNDUuMjI2NjY3IDE3MC42NjY2NjZhMzIgMzIgMCAwIDAgNDUuMjI2NjY3IDQ1LjIyNjY2N2wtNDUuMjI2NjY3LTQ1LjIyNjY2N3pNNDQ4IDgxMC42NjY2NjdsLTIyLjYxMzMzMy0yMi42MTMzMzRhMzIgMzIgMCAwIDAgMCA0NS4yMjY2NjdsMjIuNjEzMzMzLTIyLjYxMzMzM3ogbTEwNy45NDY2NjctNjIuNzJhMzIgMzIgMCAxIDAtNDUuMjI2NjY3LTQ1LjIyNjY2N2w0NS4yMjY2NjcgNDUuMjI2NjY3eiBtLTQ1LjIyNjY2NyAxNzAuNjY2NjY2YTMyIDMyIDAgMSAwIDQ1LjIyNjY2Ny00NS4yMjY2NjZsLTQ1LjIyNjY2NyA0NS4yMjY2NjZ6TTgxMC42NjY2NjcgNTc2bC0yMi42MTMzMzQgMjIuNjEzMzMzYTMyIDMyIDAgMCAwIDQ1LjIyNjY2NyAwTDgxMC42NjY2NjcgNTc2eiBtMTA3Ljk0NjY2Ni02Mi43MmEzMiAzMiAwIDEgMC00NS4yMjY2NjYtNDUuMjI2NjY3bDQ1LjIyNjY2NiA0NS4yMjY2Njd6IG0tMTcwLjY2NjY2Ni00NS4yMjY2NjdhMzIgMzIgMCAxIDAtNDUuMjI2NjY3IDQ1LjIyNjY2N2w0NS4yMjY2NjctNDUuMjI2NjY3ek0yMTMuMzMzMzMzIDQ0OGwyMi42MTMzMzQtMjIuNjEzMzMzYTMyIDMyIDAgMCAwLTQ1LjIyNjY2NyAwbDIyLjYxMzMzMyAyMi42MTMzMzN6IG02Mi43MiAxMDcuOTQ2NjY3YTMyIDMyIDAgMCAwIDQ1LjIyNjY2Ny00NS4yMjY2NjdsLTQ1LjIyNjY2NyA0NS4yMjY2Njd6IG0tMTcwLjY2NjY2Ni00NS4yMjY2NjdhMzIgMzIgMCAxIDAgNDUuMjI2NjY2IDQ1LjIyNjY2N2wtNDUuMjI2NjY2LTQ1LjIyNjY2N3pNMzA5LjMzMzMzMyAyMTMuMzMzMzMzQTc0LjY2NjY2NyA3NC42NjY2NjcgMCAwIDEgMjM0LjY2NjY2NyAyODh2NjRBMTM4LjY2NjY2NyAxMzguNjY2NjY3IDAgMCAwIDM3My4zMzMzMzMgMjEzLjMzMzMzM2gtNjR6TTIzNC42NjY2NjcgMjg4QTc0LjY2NjY2NyA3NC42NjY2NjcgMCAwIDEgMTYwIDIxMy4zMzMzMzNoLTY0QTEzOC42NjY2NjcgMTM4LjY2NjY2NyAwIDAgMCAyMzQuNjY2NjY3IDM1MnYtNjR6TTE2MCAyMTMuMzMzMzMzYzAtNDEuMjE2IDMzLjQ1MDY2Ny03NC42NjY2NjcgNzQuNjY2NjY3LTc0LjY2NjY2NnYtNjRBMTM4LjY2NjY2NyAxMzguNjY2NjY3IDAgMCAwIDk2IDIxMy4zMzMzMzNoNjR6TTIzNC42NjY2NjcgMTM4LjY2NjY2N2M0MS4yMTYgMCA3NC42NjY2NjcgMzMuNDUwNjY3IDc0LjY2NjY2NiA3NC42NjY2NjZoNjRBMTM4LjY2NjY2NyAxMzguNjY2NjY3IDAgMCAwIDIzNC42NjY2NjcgNzQuNjY2NjY3djY0ek0zNDEuMzMzMzMzIDI0NS4zMzMzMzNoMjM0LjY2NjY2N3YtNjRIMzQxLjMzMzMzM3Y2NHogbTI1Ny4yOC01NC42MTMzMzNsLTg1LjMzMzMzMy04NS4zMzMzMzMtNDUuMjI2NjY3IDQ1LjIyNjY2NiA4NS4zMzMzMzQgODUuMzMzMzM0IDQ1LjIyNjY2Ni00NS4yMjY2Njd6IG0tNDUuMjI2NjY2IDBsLTg1LjMzMzMzNCA4NS4zMzMzMzMgNDUuMjI2NjY3IDQ1LjIyNjY2NyA4NS4zMzMzMzMtODUuMzMzMzMzLTQ1LjIyNjY2Ni00NS4yMjY2Njd6TTY1MC42NjY2NjcgODEwLjY2NjY2N2ExMzguNjY2NjY3IDEzOC42NjY2NjcgMCAwIDAgMTM4LjY2NjY2NiAxMzguNjY2NjY2di02NEE3NC42NjY2NjcgNzQuNjY2NjY3IDAgMCAxIDcxNC42NjY2NjcgODEwLjY2NjY2N2gtNjR6IG0xMzguNjY2NjY2IDEzOC42NjY2NjZBMTM4LjY2NjY2NyAxMzguNjY2NjY3IDAgMCAwIDkyOCA4MTAuNjY2NjY3aC02NGE3NC42NjY2NjcgNzQuNjY2NjY3IDAgMCAxLTc0LjY2NjY2NyA3NC42NjY2NjZ2NjR6TTkyOCA4MTAuNjY2NjY3YTEzOC42NjY2NjcgMTM4LjY2NjY2NyAwIDAgMC0xMzguNjY2NjY3LTEzOC42NjY2Njd2NjRjNDEuMjE2IDAgNzQuNjY2NjY3IDMzLjQ1MDY2NyA3NC42NjY2NjcgNzQuNjY2NjY3aDY0eiBtLTEzOC42NjY2NjctMTM4LjY2NjY2N0ExMzguNjY2NjY3IDEzOC42NjY2NjcgMCAwIDAgNjUwLjY2NjY2NyA4MTAuNjY2NjY3aDY0YzAtNDEuMjE2IDMzLjQ1MDY2Ny03NC42NjY2NjcgNzQuNjY2NjY2LTc0LjY2NjY2N3YtNjR6IG0tMTA2LjY2NjY2NiAxMDYuNjY2NjY3aC0yMzQuNjY2NjY3djY0SDY4Mi42NjY2Njd2LTY0eiBtLTIxMi4wNTMzMzQgNTQuNjEzMzMzbDg1LjMzMzMzNC04NS4zMzMzMzMtNDUuMjI2NjY3LTQ1LjIyNjY2Ny04NS4zMzMzMzMgODUuMzMzMzMzIDQ1LjIyNjY2NiA0NS4yMjY2Njd6IG0tNDUuMjI2NjY2IDBsODUuMzMzMzMzIDg1LjMzMzMzMyA0NS4yMjY2NjctNDUuMjI2NjY2LTg1LjMzMzMzNC04NS4zMzMzMzQtNDUuMjI2NjY2IDQ1LjIyNjY2N3pNNjcyIDIzNC42NjY2NjdBMTM4LjY2NjY2NyAxMzguNjY2NjY3IDAgMCAwIDgxMC42NjY2NjcgMzczLjMzMzMzM3YtNjRhNzQuNjY2NjY3IDc0LjY2NjY2NyAwIDAgMS03NC42NjY2NjctNzQuNjY2NjY2aC02NHpNODEwLjY2NjY2NyAzNzMuMzMzMzMzYTEzOC42NjY2NjcgMTM4LjY2NjY2NyAwIDAgMCAxMzguNjY2NjY2LTEzOC42NjY2NjZoLTY0QTc0LjY2NjY2NyA3NC42NjY2NjcgMCAwIDEgODEwLjY2NjY2NyAzMDkuMzMzMzMzdjY0eiBtMTM4LjY2NjY2Ni0xMzguNjY2NjY2QTEzOC42NjY2NjcgMTM4LjY2NjY2NyAwIDAgMCA4MTAuNjY2NjY3IDk2djY0YzQxLjIxNiAwIDc0LjY2NjY2NyAzMy40NTA2NjcgNzQuNjY2NjY2IDc0LjY2NjY2N2g2NHpNODEwLjY2NjY2NyA5NmExMzguNjY2NjY3IDEzOC42NjY2NjcgMCAwIDAtMTM4LjY2NjY2NyAxMzguNjY2NjY3aDY0YzAtNDEuMjE2IDMzLjQ1MDY2Ny03NC42NjY2NjcgNzQuNjY2NjY3LTc0LjY2NjY2N3YtNjR6TTc3OC42NjY2NjcgMzQxLjMzMzMzM3YyMzQuNjY2NjY3aDY0VjM0MS4zMzMzMzNoLTY0eiBtNTQuNjEzMzMzIDI1Ny4yOGw4NS4zMzMzMzMtODUuMzMzMzMzLTQ1LjIyNjY2Ni00NS4yMjY2NjctODUuMzMzMzM0IDg1LjMzMzMzNCA0NS4yMjY2NjcgNDUuMjI2NjY2eiBtMC00NS4yMjY2NjZsLTg1LjMzMzMzMy04NS4zMzMzMzQtNDUuMjI2NjY3IDQ1LjIyNjY2NyA4NS4zMzMzMzMgODUuMzMzMzMzIDQ1LjIyNjY2Ny00NS4yMjY2NjZ6TTEzOC42NjY2NjcgNzg5LjMzMzMzM2MwLTQxLjIxNiAzMy40NTA2NjctNzQuNjY2NjY3IDc0LjY2NjY2Ni03NC42NjY2NjZ2LTY0YTEzOC42NjY2NjcgMTM4LjY2NjY2NyAwIDAgMC0xMzguNjY2NjY2IDEzOC42NjY2NjZoNjR6TTIxMy4zMzMzMzMgNzE0LjY2NjY2N2M0MS4yMTYgMCA3NC42NjY2NjcgMzMuNDUwNjY3IDc0LjY2NjY2NyA3NC42NjY2NjZoNjRBMTM4LjY2NjY2NyAxMzguNjY2NjY3IDAgMCAwIDIxMy4zMzMzMzMgNjUwLjY2NjY2N3Y2NHogbTc0LjY2NjY2NyA3NC42NjY2NjZBNzQuNjY2NjY3IDc0LjY2NjY2NyAwIDAgMSAyMTMuMzMzMzMzIDg2NHY2NGExMzguNjY2NjY3IDEzOC42NjY2NjcgMCAwIDAgMTM4LjY2NjY2Ny0xMzguNjY2NjY3aC02NHpNMjEzLjMzMzMzMyA4NjRhNzQuNjY2NjY3IDc0LjY2NjY2NyAwIDAgMS03NC42NjY2NjYtNzQuNjY2NjY3aC02NEExMzguNjY2NjY3IDEzOC42NjY2NjcgMCAwIDAgMjEzLjMzMzMzMyA5Mjh2LTY0ek0yNDUuMzMzMzMzIDY4Mi42NjY2Njd2LTIzNC42NjY2NjdoLTY0VjY4Mi42NjY2NjdoNjR6IG0tNTQuNjEzMzMzLTIxMi4wNTMzMzRsODUuMzMzMzMzIDg1LjMzMzMzNCA0NS4yMjY2NjctNDUuMjI2NjY3LTg1LjMzMzMzMy04NS4zMzMzMzMtNDUuMjI2NjY3IDQ1LjIyNjY2NnogbTAtNDUuMjI2NjY2bC04NS4zMzMzMzMgODUuMzMzMzMzIDQ1LjIyNjY2NiA0NS4yMjY2NjcgODUuMzMzMzM0LTg1LjMzMzMzNC00NS4yMjY2NjctNDUuMjI2NjY2eiIgIGZpbGw9IiM0NDRFNjAiPjwvcGF0aD48L3N2Zz4="};function Ue(n){return bL[n]}const RL=n=>{const{workIds:t,mananger:e}=n;return ut.createElement("div",{className:"button normal-button",style:{touchAction:"none"},onPointerUp:r=>{r.cancelable&&r.preventDefault(),r.stopPropagation(),r.nativeEvent.stopImmediatePropagation(),_t.emitMethod(Ht.MainEngine,zt.DeleteNode,{workIds:t||[Xt],viewId:e.viewId})}},ut.createElement("img",{alt:"icon",src:Ue("delete")}))},jL=n=>{const{workIds:t,viewId:e}=n;return ut.createElement("div",{className:"button normal-button",onPointerUp:r=>{r.stopPropagation(),_t.emitMethod(Ht.MainEngine,zt.CopyNode,{workIds:t||[Xt],viewId:e})}},ut.createElement("img",{alt:"icon",src:Ue("duplicate")}))},Sd=n=>{const{icon:t,onPointerUpHandler:e}=n;return ut.createElement("div",{className:"button normal-button",onPointerUp:e},ut.createElement("img",{src:Ue(t)}))},zL=n=>{const{open:t,setOpen:e,floatBarRef:r}=n,{floatBarData:i,mananger:o}=It.useContext(Me),[s,a]=It.useState([]),l=It.useMemo(()=>{if(r!=null&&r.current&&Pt.isNumber(i?.y)&&o!=null&&o.height){if(r.current.offsetTop&&r.current.offsetTop+i.y>180){const c={};return c.top="inherit",c.bottom=50,c}else if(!r.current.offsetTop&&o?.height-r.current.offsetTop-i.y<120){const c={};return c.top="inherit",c.bottom=50,c}}},[r?.current,i,o]),u=It.useMemo(()=>t?ut.createElement("div",{className:"image-layer-menu",style:l},ut.createElement(Sd,{icon:"to-top",onPointerUpHandler:c=>{c.stopPropagation(),_t.emitMethod(Ht.MainEngine,zt.ZIndexNode,{workIds:[Xt],layer:Xo.Top,viewId:o?.viewId})}}),ut.createElement(Sd,{icon:"to-bottom",onPointerUpHandler:c=>{c.stopPropagation(),_t.emitMethod(Ht.MainEngine,zt.ZIndexNode,{workIds:[Xt],layer:Xo.Bottom,viewId:o?.viewId})}})):null,[t,l]),p=c=>{c.stopPropagation(),c.nativeEvent.stopImmediatePropagation(),e(!t)};return It.useEffect(()=>{Pt.isEqual(i?.selectIds,s)||i!=null&&i.selectIds&&!Pt.isEqual(i?.selectIds,s)&&(a(i?.selectIds),e(!1))},[t,i,s,e]),ut.createElement("div",{className:`button normal-button ${t&&"active"}`,onPointerUp:p},u,ut.createElement("img",{alt:"icon",src:Ue(t?"layer-pressed":"layer")}))},os=n=>{n.stopPropagation(),n.nativeEvent.stopImmediatePropagation()},kL=()=>ut.createElement("svg",{style:{marginLeft:"2px"},viewBox:"0 0 1025 1024",width:"14",height:"14"},ut.createElement("path",{d:"M1016.5248 493.8752c-9.984-9.984-26.2144-9.984-36.1984 0l-183.6032 183.6032c-29.952 29.952-78.6944 29.952-108.5952 0l-239.2064-239.2064c-14.4384-14.4384-22.3744-33.6896-22.3744-54.3232s7.936-39.8848 22.3744-54.3232l183.6032-183.6032c9.984-9.984 9.984-26.2144 0-36.1984s-26.2144-9.984-36.1984 0l-183.6032 183.6032c-24.1152 24.1152-37.376 56.2176-37.376 90.5216 0 14.592 2.4576 28.8256 7.0656 42.1888l-374.8864 374.8864c-4.8128 4.8128-7.4752 11.3152-7.4752 18.1248l0 76.8c0 14.1312 11.4688 25.6 25.6 25.6l486.4 0c6.8096 0 13.312-2.7136 18.1248-7.4752l170.0864-170.0864c13.3632 4.6592 27.5968 7.0656 42.1888 7.0656 34.2528 0 66.4064-13.2608 90.5216-37.376l183.6032-183.6032c9.984-9.984 9.984-26.2144 0-36.1984zM501.4016 870.4l-450.2016 0 0-40.6016 358.5024-358.5024c1.024 1.0752 1.9968 2.1504 3.0208 3.1744l239.2064 239.2064c1.024 1.024 2.0992 2.048 3.1744 3.0208l-153.7024 153.7024z",fill:"#000000"})),Cv=n=>{const{activeColor:t,onPointerUpHandler:e}=n;return ut.createElement("div",{className:`font-color-button ${t==="transparent"?"active":""}`,onPointerUp:e},ut.createElement("div",{className:"circle none"}))},sl=n=>{const{color:t,activeColor:e,onPointerUpHandler:r}=n;return ut.createElement("div",{className:`font-color-button ${t===e?"active":""}`,onPointerUp:r},ut.createElement("div",{className:"circle",style:{backgroundColor:Re(t,1)}}))},al=n=>{const{opacity:t,activeColor:e,setCurOpacity:r}=n,[i,o]=It.useState({x:108,y:0}),s=It.useRef(0);if(It.useEffect(()=>{o({x:t*100+8,y:0})},[]),!e)return null;const a=(c,g)=>{const v=Math.min(Math.max(c-8,0),100)/100;(t!==v||g===Tt.Done)&&r(v,e,g)},l=(c,g)=>{g.x!==i?.x&&o({x:g.x,y:0}),!s.current&&(s.current=setTimeout(()=>{s.current=0,a(g.x,Tt.Doing)},100))},u=()=>{r(t,e,Tt.Start)},p=(c,g)=>{g.x!==i?.x&&o({x:g.x,y:0}),s.current&&(clearTimeout(s.current),s.current=0),a(g.x,Tt.Done)};return ut.createElement("div",{className:"font-color-opacity",style:{marginLeft:"10px"},onPointerUp:c=>{s.current&&(clearTimeout(s.current),s.current=0);const g=c.nativeEvent.offsetX,v=Math.min(Math.max(g-12,0),100)/100;o({x:v*100+8,y:0}),r(v,e,Tt.Done)}},ut.createElement("div",{className:"range-color",style:{background:`linear-gradient(to right, ${Re(e,0)}, ${Re(e,1)})`}}),ut.createElement("div",{className:"range-opacity"},ut.createElement(Ji,{bounds:"parent",axis:"x",position:i,onDrag:l,onStart:u,onStop:p},ut.createElement("div",{className:"circle",style:{backgroundColor:Re(e,t)},onPointerUp:os}))))},BL=n=>{const{min:t,max:e,activeNumber:r,setActiveNumber:i,color:o}=n,[s,a]=It.useState({x:108,y:0}),l=It.useRef(0);if(It.useEffect(()=>{const v=Math.ceil((r-t)/(e-t)*100)+8;a({x:v,y:0})},[]),!r)return null;const u=(v,I)=>{const w=Math.ceil(Math.max(v-8,0)/100*(e-t)+t);(r!==w||I===Tt.Done)&&i(w,I)},p=(v,I)=>{I.x!==s?.x&&a({x:I.x,y:0}),!l.current&&(l.current=setTimeout(()=>{l.current=0,u(I.x,Tt.Doing)},100))},c=()=>{i(r,Tt.Start)},g=(v,I)=>{I.x!==s?.x&&a({x:I.x,y:0}),l.current&&(clearTimeout(l.current),l.current=0),u(I.x,Tt.Done)};return ut.createElement("div",{className:"font-color-opacity",style:{marginLeft:"10px"},onPointerUp:v=>{l.current&&(clearTimeout(l.current),l.current=0);const I=v.nativeEvent.offsetX,w=Math.ceil(Math.max(I-12,0)/100*(e-t)+t),y=Math.ceil((w-t)/(e-t)*100)+8;a({x:y,y:0}),i(w,Tt.Done)}},ut.createElement("div",{className:"range-color",style:{backgroundColor:o}}),ut.createElement("div",{className:"range-opacity"},ut.createElement(Ji,{bounds:"parent",axis:"x",position:s,onDrag:p,onStart:c,onStop:g},ut.createElement("div",{className:"circle",style:{backgroundColor:o},onPointerUp:os},ut.createElement("div",{className:"range-opacity-data-icon"},r)))))},WL=n=>{const{useStroke:t,color:e,activeStrokeType:r,setStrokeType:i}=n;return ut.createElement("div",{className:"stroke-type-box"},!!t&&ut.createElement("div",{className:`stroke-type-box-item Stroke ${r===$t.Stroke&&"active"}`,style:{backgroundColor:e},onPointerUp:()=>{i($t.Stroke)}}),ut.createElement("div",{className:`stroke-type-box-item Normal ${r===$t.Normal&&"active"}`,style:{borderColor:e},onPointerUp:()=>{i($t.Normal)}}),ut.createElement("div",{className:`stroke-type-box-item Dotted ${r===$t.Dotted&&"active"}`,style:{borderColor:e},onPointerUp:()=>{i($t.Dotted)}}),ut.createElement("div",{className:`stroke-type-box-item LongDotted ${r===$t.LongDotted&&"active"}`,style:{borderColor:e},onPointerUp:()=>{i($t.LongDotted)}}))},UL=n=>{const{open:t,setOpen:e,floatBarRef:r}=n,{floatBarData:i,floatBarColors:o,mananger:s,setFloatBarData:a}=It.useContext(Me),[l,u]=It.useState(),[p,c]=It.useState(1);It.useEffect(()=>{if(i!=null&&i.strokeColor){const[h,m]=ol(i.strokeColor);u(h),c(m)}},[i]);const g=It.useMemo(()=>{if(r!=null&&r.current&&i&&Pt.isNumber(i?.y)&&s!=null&&s.height){if(r.current.offsetTop&&r.current.offsetTop+i.y>180){const h={};return h.top="inherit",h.bottom=50,h}else if(!r.current.offsetTop&&s?.height-r.current.offsetTop-i.y<120){const h={};return h.top="inherit",h.bottom=50,h}}},[i,r,s?.height]),v=It.useMemo(()=>ut.createElement(al,{key:"strokeColors",opacity:p,activeColor:l,setCurOpacity:(h,m,d)=>{c(h);const M=Re(m,h);i!=null&&i.strokeColor&&a({strokeColor:M}),_t.emitMethod(Ht.MainEngine,zt.SetColorNode,{workIds:[Xt],strokeColor:M,workState:d,viewId:s?.viewId})}}),[p,l,i?.strokeColor,s?.viewId,a]),I=It.useMemo(()=>l&&i&&i.thickness?ut.createElement(BL,{key:"strokeThickness",min:Math.min(i.thickness,s?.control.pluginOptions.extras.strokeWidth.min||me.strokeWidth.min),max:Math.max(i.thickness,s?.control.pluginOptions.extras.strokeWidth.max||me.strokeWidth.max),activeNumber:i.thickness,setActiveNumber:(h,m)=>{i!=null&&i.thickness&&a({thickness:h}),_t.emitMethod(Ht.MainEngine,zt.SetColorNode,{workIds:[Xt],thickness:h,workState:m,viewId:s?.viewId})},color:l}):null,[l,i,s?.control.pluginOptions.extras.strokeWidth.max,s?.control.pluginOptions.extras.strokeWidth.min,s?.viewId,a]),w=It.useMemo(()=>l&&i&&i!=null&&i.strokeType?ut.createElement(WL,{key:"strokeType",useStroke:i?.useStroke,activeStrokeType:i.strokeType,setStrokeType:h=>{i.strokeType&&a({strokeType:h}),_t.emitMethod(Ht.MainEngine,zt.SetColorNode,{workIds:[Xt],strokeType:h,workState:Tt.Done,viewId:s?.viewId})},color:l}):null,[l,i,s?.viewId,a]),y=It.useMemo(()=>t?ut.createElement("div",{className:"font-colors-menu",style:g,onPointerUp:h=>{h.stopPropagation(),h.nativeEvent.stopImmediatePropagation()}},w,I,ut.createElement("div",{className:"font-colors-line"}),o.concat().map((h,m)=>{const d=is(...h);return ut.createElement(sl,{key:m,color:d,activeColor:l,onPointerUpHandler:M=>{M.stopPropagation(),u(d);const x=Re(d,p);i!=null&&i.strokeColor&&(i.strokeColor=x,a({strokeColor:x})),_t.emitMethod(Ht.MainEngine,zt.SetColorNode,{workIds:[Xt],workState:Tt.Done,strokeColor:x,viewId:s?.viewId})}})}),v):null,[t,g,w,I,o,v,l,p,i,s?.viewId,a]),T=It.useMemo(()=>l?ut.createElement("div",{className:"color-bar-ring",style:{backgroundColor:Re(l,p)}},ut.createElement("div",{className:"circle"})):null,[l,p]);return ut.createElement("div",{className:`button normal-button font-colors-icon ${t&&"active"}`,onPointerUp:h=>{h.stopPropagation(),h.nativeEvent.stopImmediatePropagation(),e(!t)}},T,y)},YL=n=>{const{open:t,setOpen:e,floatBarRef:r}=n,{floatBarData:i,floatBarColors:o,mananger:s,setFloatBarData:a}=It.useContext(Me),[l,u]=It.useState(),[p,c]=It.useState(1);It.useEffect(()=>{if(i!=null&&i.fillColor){const[y,T]=i?.fillColor==="transparent"&&["transparent",1]||ol(i.fillColor);u(y),c(T)}},[i]);const g=It.useMemo(()=>{if(r!=null&&r.current&&Pt.isNumber(i?.y)&&s!=null&&s.height){if(r.current.offsetTop&&r.current.offsetTop+i.y>200){const y={};return y.top="inherit",y.bottom=50,y}else if(!r.current.offsetTop&&s?.height-r.current.offsetTop-i.y<140){const y={};return y.top="inherit",y.bottom=50,y}}},[r,i,s?.height]),v=It.useMemo(()=>l&&l!=="transparent"?ut.createElement(al,{key:"fillColors",opacity:p||0,activeColor:l,setCurOpacity:(y,T,h)=>{c(y);const m=Re(T,y);i!=null&&i.fillColor&&(i.fillColor=m,a({fillColor:m})),_t.emitMethod(Ht.MainEngine,zt.SetColorNode,{workIds:[Xt],fillColor:l&&Re(T,y),workState:h,viewId:s?.viewId})}}):null,[l,p,i,s?.viewId,a]),I=It.useMemo(()=>t?ut.createElement("div",{className:"font-colors-menu",style:g,onPointerUp:y=>{y.stopPropagation(),y.nativeEvent.stopImmediatePropagation()}},ut.createElement(Cv,{activeColor:l,onPointerUpHandler:y=>{y.stopPropagation(),u("transparent");const T="transparent";i!=null&&i.fillColor&&(i.fillColor=T,a({fillColor:T})),_t.emitMethod(Ht.MainEngine,zt.SetColorNode,{workIds:[Xt],workState:Tt.Done,fillColor:T,viewId:s?.viewId})}}),o.map((y,T)=>{const h=is(...y);return ut.createElement(sl,{key:T,color:h,activeColor:l,onPointerUpHandler:m=>{m.cancelable&&m.preventDefault(),m.stopPropagation(),u(h);const d=Re(h,p);i!=null&&i.fillColor&&(i.fillColor=d,a({fillColor:d})),_t.emitMethod(Ht.MainEngine,zt.SetColorNode,{workIds:[Xt],workState:Tt.Done,fillColor:d,viewId:s?.viewId})}})}),v):null,[t,g,l,o,v,i,s?.viewId,a,p]),w=It.useMemo(()=>{const y=l&&l!=="transparent"&&Re(l,p)||"transparent";return ut.createElement("div",{className:"color-bar-fill"},ut.createElement("div",{className:"circle",style:{backgroundColor:y}}))},[l,p]);return ut.createElement("div",{className:`button normal-button font-colors-icon ${t&&"active"}`,onPointerUp:y=>{y.stopPropagation(),y.nativeEvent.stopImmediatePropagation(),e(!t)}},w,I)},FL=n=>{const{open:t,setOpen:e,textOpt:r,workIds:i,floatBarRef:o}=n,{floatBarColors:s,mananger:a,setFloatBarData:l,floatBarData:u}=It.useContext(Me),[p,c]=It.useState(),[g,v]=It.useState(1);It.useEffect(()=>{if(r!=null&&r.fontColor){const[h,m]=r?.fontColor==="transparent"&&["transparent",0]||ol(r.fontColor);c(h),v(m)}},[r?.fontColor]);const I=It.useMemo(()=>{if(o!=null&&o.current&&u&&Pt.isNumber(u?.y)&&a!=null&&a.height){if(o.current.offsetTop&&o.current.offsetTop+u.y>180){const h={};return h.top="inherit",h.bottom=50,h}else if(!o.current.offsetTop&&a?.height-o.current.offsetTop-u.y<120){const h={};return h.top="inherit",h.bottom=50,h}}},[o,u,a?.height]),w=It.useMemo(()=>p&&p!=="transparent"?ut.createElement(al,{key:"fontColors",opacity:g,activeColor:p,setCurOpacity:(h,m,d)=>{v(h);const M=Re(m,h);u!=null&&u.textOpt&&(u.textOpt.fontColor=M,l({textOpt:u.textOpt})),_t.emitMethod(Ht.MainEngine,zt.SetColorNode,{workIds:i||[Xt],fontColor:p&&M,workState:d,viewId:a?.viewId})}}):null,[l,p,g,a?.control.room,a?.viewId,u?.textOpt,i]),y=It.useMemo(()=>t?ut.createElement("div",{className:"font-colors-menu",style:I,onPointerUp:h=>{h.stopPropagation(),h.nativeEvent.stopImmediatePropagation()}},s.map((h,m)=>{const d=is(...h);return ut.createElement(sl,{key:m,color:d,activeColor:p,onPointerUpHandler:M=>{M.stopPropagation(),c(d);const x=Re(d,g);u!=null&&u.textOpt&&(u.textOpt.fontColor=x,l({textOpt:u.textOpt})),_t.emitMethod(Ht.MainEngine,zt.SetColorNode,{workIds:i||[Xt],workState:Tt.Done,fontColor:x,viewId:a?.viewId})}})}),w):null,[l,t,s,w,p,g,u?.textOpt,i,a?.viewId,I]),T=It.useMemo(()=>{const h=p&&p!=="transparent"&&Re(p,g)||"transparent";return ut.createElement("div",{className:"color-bar"},ut.createElement("div",{className:"color-bar-color",style:{backgroundColor:h}}))},[p,g]);return ut.createElement("div",{className:`button normal-button font-colors-icon ${t&&"active"}`,onPointerUp:h=>{h.stopPropagation(),h.nativeEvent.stopImmediatePropagation(),e(!t)}},ut.createElement("img",{alt:"icon",src:Ue("font-colors")}),T,y)},VL=n=>{const{open:t,setOpen:e,textOpt:r,workIds:i,floatBarRef:o}=n,{floatBarColors:s,mananger:a,setFloatBarData:l,floatBarData:u}=It.useContext(Me),[p,c]=It.useState(),[g,v]=It.useState(1);It.useEffect(()=>{if(r!=null&&r.fontBgColor){const[h,m]=r?.fontBgColor==="transparent"&&["transparent",1]||ol(r.fontBgColor);c(h),v(m)}},[r?.fontBgColor]);const I=It.useMemo(()=>{if(o!=null&&o.current&&u&&Pt.isNumber(u?.y)&&a!=null&&a.height){if(o.current.offsetTop&&o.current.offsetTop+u.y>180){const h={};return h.top="inherit",h.bottom=50,h}else if(!o.current.offsetTop&&a?.height-o.current.offsetTop-u.y<120){const h={};return h.top="inherit",h.bottom=50,h}}},[o,u,a?.height]),w=It.useMemo(()=>p&&p!=="transparent"?ut.createElement(al,{key:"fontBgColor",opacity:g||0,activeColor:p,setCurOpacity:(h,m,d)=>{v(h);const M=Re(m,h);u!=null&&u.textOpt&&(u.textOpt.fontBgColor=M,l({textOpt:u.textOpt})),_t.emitMethod(Ht.MainEngine,zt.SetColorNode,{workIds:i||[Xt],fontBgColor:p&&Re(m,h),workState:d,viewId:a?.viewId})}}):null,[p,g,u?.textOpt,i,a?.viewId,l]),y=It.useMemo(()=>t?ut.createElement("div",{className:"font-colors-menu",style:I,onPointerUp:h=>{h.stopPropagation(),h.nativeEvent.stopImmediatePropagation()}},ut.createElement(Cv,{activeColor:p,onPointerUpHandler:h=>{h.stopPropagation();const m="transparent";c(m),u!=null&&u.textOpt&&(u.textOpt.fontBgColor=m,l({textOpt:u.textOpt})),_t.emitMethod(Ht.MainEngine,zt.SetColorNode,{workIds:i||[Xt],workState:Tt.Done,fontBgColor:m,viewId:a?.viewId})}}),s.map((h,m)=>{const d=is(...h);return ut.createElement(sl,{key:m,color:d,activeColor:p,onPointerUpHandler:M=>{M.stopPropagation(),c(d);const x=Re(d,g);u!=null&&u.textOpt&&(u.textOpt.fontBgColor=x,l({textOpt:u.textOpt})),_t.emitMethod(Ht.MainEngine,zt.SetColorNode,{workIds:i||[Xt],workState:Tt.Done,fontBgColor:Re(d,g),viewId:a?.viewId})}})}),w):null,[l,t,s,w,g,p,u?.textOpt,i,a?.viewId,I]),T=It.useMemo(()=>{const h=p&&p!=="transparent"&&Re(p,g)||"transparent";return ut.createElement("div",{className:"color-bar",style:{marginTop:0}},ut.createElement("div",{className:"color-bar-color",style:{backgroundColor:h}}))},[p,g]);return ut.createElement("div",{className:`button normal-button font-colors-icon ${t&&"active"}`,onPointerUp:h=>{h.stopPropagation(),h.nativeEvent.stopImmediatePropagation(),e(!t)}},ut.createElement(kL,null),T,y)},XL=n=>{const{bold:t,setBold:e,workIds:r,viewId:i}=n,o=s=>{const a=t==="bold"?"normal":"bold";s?.stopPropagation(),e(a),_t.emitMethod(Ht.MainEngine,zt.SetFontStyle,{workIds:r,viewId:i,bold:a})};return ut.createElement("div",{className:"font-style-button",onPointerUp:o},ut.createElement("img",{alt:"icon",src:Ue(t==="bold"?"bold-active":"bold")}))},GL=n=>{const{underline:t,setUnderline:e,workIds:r,viewId:i}=n,o=s=>{const a=!t;s?.stopPropagation(),e(a),_t.emitMethod(Ht.MainEngine,zt.SetFontStyle,{workIds:r,viewId:i,underline:a})};return ut.createElement("div",{className:"font-style-button",onPointerUp:o},ut.createElement("img",{alt:"icon",src:Ue(t?"underline-active":"underline")}))},$L=n=>{const{lineThrough:t,setLineThrough:e,workIds:r,viewId:i}=n,o=s=>{const a=!t;s?.stopPropagation(),e(a),_t.emitMethod(Ht.MainEngine,zt.SetFontStyle,{workIds:r,viewId:i,lineThrough:a})};return ut.createElement("div",{className:"font-style-button",onPointerUp:o},ut.createElement("img",{alt:"icon",src:Ue(t?"line-through-active":"line-through")}))},HL=n=>{const{italic:t,setItalic:e,workIds:r,viewId:i}=n,o=s=>{const a=t==="italic"?"normal":"italic";s?.stopPropagation(),e(a),_t.emitMethod(Ht.MainEngine,zt.SetFontStyle,{workIds:r,viewId:i,italic:a})};return ut.createElement("div",{className:"font-style-button",onPointerUp:o},ut.createElement("img",{alt:"icon",src:Ue(t==="italic"?"italic-active":"italic")}))},QL=n=>{const{open:t,setOpen:e,textOpt:r,workIds:i,style:o,floatBarRef:s}=n,{mananger:a,floatBarData:l}=It.useContext(Me),[u,p]=It.useState("normal"),[c,g]=It.useState("normal"),[v,I]=It.useState(!1),[w,y]=It.useState(!1);It.useEffect(()=>{r!=null&&r.bold&&p(r.bold),Pt.isBoolean(r?.underline)&&I(r.underline||!1),Pt.isBoolean(r?.lineThrough)&&y(r.lineThrough||!1),r!=null&&r.italic&&g(r.italic)},[r]);const T=It.useMemo(()=>{if(o&&s!=null&&s.current&&Pt.isNumber(l?.y)&&a!=null&&a.height){if(s.current.offsetTop&&s.current.offsetTop+l.y>180){const m={};return m.top="inherit",m.bottom=50,m}else if(!s.current.offsetTop&&a?.height-s.current.offsetTop-l.y<120){const m={};return m.top="inherit",m.bottom=50,m}}},[o,s?.current,l,a]),h=It.useMemo(()=>t?ut.createElement("div",{className:"font-style-menu",style:T,onPointerUp:m=>{m.stopPropagation(),m.nativeEvent.stopImmediatePropagation()}},ut.createElement(XL,{workIds:i||[Xt],bold:u,setBold:p,viewId:a?.viewId}),ut.createElement(GL,{workIds:i||[Xt],underline:v,setUnderline:I,viewId:a?.viewId}),ut.createElement($L,{workIds:i||[Xt],lineThrough:w,setLineThrough:y,viewId:a?.viewId}),ut.createElement(HL,{workIds:i||[Xt],italic:c,setItalic:g,viewId:a?.viewId})):null,[t,i,u,a?.viewId,v,w,c,T]);return ut.createElement("div",{className:`button normal-button ${t&&"active"}`,onPointerUp:m=>{m.stopPropagation(),m.nativeEvent.stopImmediatePropagation(),e(!t)}},ut.createElement("img",{alt:"icon",src:Ue(t?"font-style-active":"font-style")}),h)},Vn=Object.freeze([12,14,18,24,36,48,64,80,144,288]),xi=["top","topLeft","topRight","bottom","bottomLeft","bottomRight","left","leftTop","leftBottom","right","rightTop","rightBottom"],ZL=new Map([["selector","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAKeSURBVHgB3VTLi1JhFD86zlQ4ysxSXAy1GWYZzMxmYAhHagRB/QN8FLqPFq4FIQhXkS6kTQ4t2ilIKEWgSS0SmVpIm0BdaBJSaOP78XU+PXey6+saburAD+73uL/feX0H4H81GQdj7D7ilrCGFRonk3c6nXvhcJiFQiGWy+Xy/X7/WbPZ1K1KkBOsl0qlO36/n+3t7Q1hs9kYF+WC3W73MTpxc1lBmej7KuJaoVDInZ6eqsWXDw4OwGKxwPHx8Se1Wn1Wr9cjW1tbOTxi9D9bJCJHXEFslsvlR263+246nYZZptPpQK/Xg8lkSvZ6vbNGo5EgQRCLiSPhIqpoNHobo3keCARgkalUKjg5ORlGuL+/n8T6PVAqlefjYmKRdYQSsZ3P5z8aDAYVLGFarRbi8fhbhUKhx2VPEJGP3eEbfTrs4MUwr4EU49FYrVbweDy1SqXyipy95FaI7g8QXS6SyWReHx4e2ubVBc+HtTk6OjqvVqtvvF7vi0gkUiSByyyJ21BGwpswJ2Vmsxlw/0Kj0bxMJBJJl8vFPWkhGogLQoeyMhEJo2jGUzYRjcPh+Op0Oq2pVOoHkXE0SahF/w+E+3KYNEaX2pSyiSiKxeJTFPiGyyriO6FKEUgSESLp4ht4bzQaf4pFYrHYO/ysEXGNyJtjKRqM/zNNhFuf0B7vst3dXdjZ2Yn4fL4vRFwn8jaMGqYPU179LBEGf3bZcNNutwPOtScwKnCLPJ9KLMWEh7mNuIFdVsNXzbBNP+D6Ou1vwAqm8hqMWlmbzWYf4mz6HAwGzbjWwGgqrEklmucJT+UGCfG3wiPjueeNwGvB0zkAid7OMmF8CyOck/I6NJcR4KZYcM6J2vCbUGhvyQIA0gonzCEZkQud9Fcd9W/bL57cJu3lkjuNAAAAAElFTkSuQmCC"],["pencil","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAJ2SURBVHgB7ZXPqxJRFMfvjI4F+cqkTcrjge9B+B+0LJQ27lq4ijZprly6DaF1COKPjYRrVy0CF/aof6Baa6ChOPkLFcdMm1+dM93RafzxZuptgnfgC3ecO+dzz497JOTKNsZMp9OAoihvZFku4xp/I5dsbL/fP221Wl/D4bCKwnWn0znDd+SSDE/N6ZBgMKjJBNuKzC4dHTgQ5PF4bququn7R7XZJPB4/kSTpHcBOiQlmJ6cMpCvAcdz5ZDJhF4tF1u12v4jFYkc8z683+f1+Uq1W38K+x/AogVQ7ETF4SnB+Ho1GTxKJxDFC2u32q1KpJPh8vvVGjHK5XM4xahv+tYgRcranJrNarfay2WwKoVBIRTUajW42m70P390EOYmFrOEGdhfECEMIwur1Og+p5VOp1CP47piCOB3EXBBJAIuLRcZi7zKsSaVSEbxe70N4FEEL0AyE6VuBZEJD2wmyAkHDmoxGIwGW36ljBP2gUEXf5/wXCDZBsVjky+XyUwpCyBL0k0ai7gNp3WUVUigUvgHoWSaTaRoi2YJojk1r52q1eh2JRJ5YgUB3Pc/n83WyXRPV/A1rWrtgSAZsQL6Q3ynTI1F2QdCMqXNQEGsDMqMgrMt6ChwCaXcGYdBFjA3InELkQxBCtkcEI4riHyPFCMnlcnEKMbYzQhRi0TCKa6A76XT6wWAweD8ejz8Oh8PPcEc+9Xq9D8lkMgLv74Hugo5ALmJzlumG4+IG6BZ1dJ06wtPqN14gmza2FYljD1SljrCTsAaYpjnZFP7CmpADEel/ai4qffLiqSUKFSlEP8xfgYwwlmzyr1KYHoUtgBU4Y9D/Y78AxCeE/aWoyrkAAAAASUVORK5CYII="],["eraser","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANKSURBVHgB1VTdS5NhFD/7iuXa8KNw7SK/IjBYo13soqvEITENtj9AwZiCOCTvQrNWF9rFFPGLrC1iF10Oiy68mBSUF2KB4YabhKKyTfFCc+3Lzb2ds72LsfbxCkZ04Mf7Puc5z/k95+M5AP+R8OAvCW9nZ6cyHo8/SSaTc4RQKKQ+S0JyxFtbW6va39//ZjKZmMbGRkar1TJOp5MhYtwXwBkQkgMROnyXIcmGw+FgYrHY00JkQm4cqYPCaDQ6ZrFY7i4sLPxhMDg4SJ8hTOOWRCJ5jf8npyUiEgE6eGy1Wk12u72gIZHJZDLr4eHhVnl5+YdsslL5pH1+JBIx22y2h9PT01BKpFIpLC4ufhKJRFpcxhEM6fmlSMLh8P35+XlOJCTBYBC2t7dr8fdctv+iRHjI4HK5LAMDA8BVFAoFyOVyH/6KIKsxCtVIgC188+Dg4CV2GJxGpqamYHR09AHklEWQY5d6K/gg67HD3huNRrlKpYLNzU3gIsPDw8Dn84fa29s/4zIK6Rol8xIhSUMikXB2dXXV4AHo6en5KhaLFcvLy0VJent7QaPRzKrV6le4DCEi2UTCnGgE1dXVj3Q6XY1er08drKiosK2urnbjnrFQQxBJU1PTC3y4kyxJGHEMWe2dTUSNIcLZVXl0dAStra3BiYmJOTqgVCqfu91uull3LhlFjbZv6urqiCTIElHaEsC2dq4QqXRlZeUePsrUDFtfX/eZzebbqL+GuIFks1js32OHRtHu7u5H3FMiahFViPNQYuZRO8oQVzY2NibJocFgYAKBgLuzs/M66hsQKuzELx0dHak9rKe3paXlFurrERdZEiGUGARkcAFxmSJAJ/aRkRGGnOKwdPn9/rG9vT0HXaC5uZnxer3+vr4+HdpeRVxClBWLJFuZqhF7gAjL0PGz8fFxvcfjSY0WevVUv5mZmQDWyog1/I52PyBdlxgUqUu+qMSQznVtW1ubBlP3dmlpicnA5/N5+vv770C6bhS9lEu6eHnWFP45NioJS5xxRLdNsrenKH5CusNOWH1BEeTRMTnI6MgZpYYeYhhOmS5eEX0mMhELPktGoBd/zCWSUkTAOs4QZqZ8JsokS8Kp8KWICtlwdv5P5BchBHaEIRURoQAAAABJRU5ErkJggg=="],["text","data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iNDdweCIgaGVpZ2h0PSI0MHB4IiB2aWV3Qm94PSIwIDAgNDcgNDAiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYwLjEgKDg4MTMzKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT50ZXh0LWN1cnNvcjwvdGl0bGU+CiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4KICAgIDxkZWZzPgogICAgICAgIDxwYXRoIGQ9Ik0xNiwyNi41IEMxNS43MjM4NTc2LDI2LjUgMTUuNSwyNi4yNzYxNDI0IDE1LjUsMjYgQzE1LjUsMjUuNzU0NTQwMSAxNS42NzY4NzUyLDI1LjU1MDM5MTYgMTUuOTEwMTI0NCwyNS41MDgwNTU3IEwxNiwyNS41IEwxOS41LDI1LjUgTDE5LjUsMTQuNSBMMTYsMTQuNSBDMTUuNzIzODU3NiwxNC41IDE1LjUsMTQuMjc2MTQyNCAxNS41LDE0IEMxNS41LDEzLjc1NDU0MDEgMTUuNjc2ODc1MiwxMy41NTAzOTE2IDE1LjkxMDEyNDQsMTMuNTA4MDU1NyBMMTYsMTMuNSBMMjQsMTMuNSBDMjQuMjc2MTQyNCwxMy41IDI0LjUsMTMuNzIzODU3NiAyNC41LDE0IEMyNC41LDE0LjI0NTQ1OTkgMjQuMzIzMTI0OCwxNC40NDk2MDg0IDI0LjA4OTg3NTYsMTQuNDkxOTQ0MyBMMjQsMTQuNSBMMjAuNSwxNC41IEwyMC41LDI1LjUgTDI0LDI1LjUgQzI0LjI3NjE0MjQsMjUuNSAyNC41LDI1LjcyMzg1NzYgMjQuNSwyNiBDMjQuNSwyNi4yNDU0NTk5IDI0LjMyMzEyNDgsMjYuNDQ5NjA4NCAyNC4wODk4NzU2LDI2LjQ5MTk0NDMgTDI0LDI2LjUgTDE2LDI2LjUgWiIgaWQ9InBhdGgtMSI+PC9wYXRoPgogICAgICAgIDxmaWx0ZXIgeD0iLTI4NC4wJSIgeT0iLTgxLjUlIiB3aWR0aD0iNjY4LjElIiBoZWlnaHQ9IjI5My45JSIgZmlsdGVyVW5pdHM9Im9iamVjdEJvdW5kaW5nQm94IiBpZD0iZmlsdGVyLTIiPgogICAgICAgICAgICA8ZmVNb3JwaG9sb2d5IHJhZGl1cz0iMSIgb3BlcmF0b3I9ImRpbGF0ZSIgaW49IlNvdXJjZUFscGhhIiByZXN1bHQ9InNoYWRvd1NwcmVhZE91dGVyMSI+PC9mZU1vcnBob2xvZ3k+CiAgICAgICAgICAgIDxmZU9mZnNldCBkeD0iMCIgZHk9IjIiIGluPSJzaGFkb3dTcHJlYWRPdXRlcjEiIHJlc3VsdD0ic2hhZG93T2Zmc2V0T3V0ZXIxIj48L2ZlT2Zmc2V0PgogICAgICAgICAgICA8ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIzIiBpbj0ic2hhZG93T2Zmc2V0T3V0ZXIxIiByZXN1bHQ9InNoYWRvd0JsdXJPdXRlcjEiPjwvZmVHYXVzc2lhbkJsdXI+CiAgICAgICAgICAgIDxmZUNvbXBvc2l0ZSBpbj0ic2hhZG93Qmx1ck91dGVyMSIgaW4yPSJTb3VyY2VBbHBoYSIgb3BlcmF0b3I9Im91dCIgcmVzdWx0PSJzaGFkb3dCbHVyT3V0ZXIxIj48L2ZlQ29tcG9zaXRlPgogICAgICAgICAgICA8ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAgIDAgMCAwIDAgMCAgIDAgMCAwIDAgMCAgMCAwIDAgMC4xNiAwIiB0eXBlPSJtYXRyaXgiIGluPSJzaGFkb3dCbHVyT3V0ZXIxIj48L2ZlQ29sb3JNYXRyaXg+CiAgICAgICAgPC9maWx0ZXI+CiAgICA8L2RlZnM+CiAgICA8ZyBpZD0i6aG16Z2iLTQiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSJXaGl0ZWJvYXJkLUd1aWRlbGluZXMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0zODguMDAwMDAwLCAtNjcyLjAwMDAwMCkiPgogICAgICAgICAgICA8ZyBpZD0idGV4dC1jdXJzb3IiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDM5Mi4wMDAwMDAsIDY3Mi4wMDAwMDApIj4KICAgICAgICAgICAgICAgIDxyZWN0IGlkPSLnn6nlvaLlpIfku70tNDAiIGZpbGw9IiNGRkZGRkYiIG9wYWNpdHk9IjAuMDEiIHg9IjAiIHk9IjAiIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgcng9IjIiPjwvcmVjdD4KICAgICAgICAgICAgICAgIDxnIGlkPSLlvaLnirbnu5PlkIgiIGZpbGwtcnVsZT0ibm9uemVybyI+CiAgICAgICAgICAgICAgICAgICAgPHVzZSBmaWxsPSJibGFjayIgZmlsbC1vcGFjaXR5PSIxIiBmaWx0ZXI9InVybCgjZmlsdGVyLTIpIiB4bGluazpocmVmPSIjcGF0aC0xIj48L3VzZT4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBzdHJva2U9IiNGRkZGRkYiIHN0cm9rZS13aWR0aD0iMSIgZD0iTTE5LDI1IEwxOSwxNSBMMTYsMTUgQzE1LjQ0NzcxNTMsMTUgMTUsMTQuNTUyMjg0NyAxNSwxNCBDMTUsMTMuNTE0NTg5NyAxNS4zNDc5OTkzLDEzLjEwMTkxNSAxNS44NjU0ODc3LDEzLjAxMDA1MjEgTDE2LDEzIEwyNCwxMyBDMjQuNTUyMjg0NywxMyAyNSwxMy40NDc3MTUzIDI1LDE0IEMyNSwxNC40ODU0MTAzIDI0LjY1MjAwMDcsMTQuODk4MDg1IDI0LjEzNDUxMjMsMTQuOTg5OTQ3OSBMMjQsMTUgTDIxLDE1IEwyMSwyNSBMMjQsMjUgQzI0LjU1MjI4NDcsMjUgMjUsMjUuNDQ3NzE1MyAyNSwyNiBDMjUsMjYuNDg1NDEwMyAyNC42NTIwMDA3LDI2Ljg5ODA4NSAyNC4xMzQ1MTIzLDI2Ljk4OTk0NzkgTDI0LDI3IEwxNiwyNyBDMTUuNDQ3NzE1MywyNyAxNSwyNi41NTIyODQ3IDE1LDI2IEMxNSwyNS41MTQ1ODk3IDE1LjM0Nzk5OTMsMjUuMTAxOTE1IDE1Ljg2NTQ4NzcsMjUuMDEwMDUyMSBMMTYsMjUgTDE5LDI1IFoiIGZpbGw9IiMyMTIzMjQiIGZpbGwtcnVsZT0iZXZlbm9kZCI+PC9wYXRoPgogICAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICA8L2c+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4="],["shape","data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iNDBweCIgaGVpZ2h0PSI0MHB4IiB2aWV3Qm94PSIwIDAgNDAgNDAiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYwLjEgKDg4MTMzKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT5zaGFwZS1jdXJzb3I8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZGVmcz4KICAgICAgICA8cGF0aCBkPSJNMjAsMjEuNSBDMjAuMjQ1NDU5OSwyMS41IDIwLjQ0OTYwODQsMjEuNjc2ODc1MiAyMC40OTE5NDQzLDIxLjkxMDEyNDQgTDIwLjUsMjIgTDIwLjUsMjcgQzIwLjUsMjcuMjc2MTQyNCAyMC4yNzYxNDI0LDI3LjUgMjAsMjcuNSBDMTkuNzU0NTQwMSwyNy41IDE5LjU1MDM5MTYsMjcuMzIzMTI0OCAxOS41MDgwNTU3LDI3LjA4OTg3NTYgTDE5LjUsMjcgTDE5LjUsMjIgQzE5LjUsMjEuNzIzODU3NiAxOS43MjM4NTc2LDIxLjUgMjAsMjEuNSBaIE0yNywxOS41IEMyNy4yNzYxNDI0LDE5LjUgMjcuNSwxOS43MjM4NTc2IDI3LjUsMjAgQzI3LjUsMjAuMjQ1NDU5OSAyNy4zMjMxMjQ4LDIwLjQ0OTYwODQgMjcuMDg5ODc1NiwyMC40OTE5NDQzIEwyNywyMC41IEwyMiwyMC41IEMyMS43MjM4NTc2LDIwLjUgMjEuNSwyMC4yNzYxNDI0IDIxLjUsMjAgQzIxLjUsMTkuNzU0NTQwMSAyMS42NzY4NzUyLDE5LjU1MDM5MTYgMjEuOTEwMTI0NCwxOS41MDgwNTU3IEwyMiwxOS41IEwyNywxOS41IFogTTE4LDE5LjUgQzE4LjI3NjE0MjQsMTkuNSAxOC41LDE5LjcyMzg1NzYgMTguNSwyMCBDMTguNSwyMC4yNDU0NTk5IDE4LjMyMzEyNDgsMjAuNDQ5NjA4NCAxOC4wODk4NzU2LDIwLjQ5MTk0NDMgTDE4LDIwLjUgTDEzLDIwLjUgQzEyLjcyMzg1NzYsMjAuNSAxMi41LDIwLjI3NjE0MjQgMTIuNSwyMCBDMTIuNSwxOS43NTQ1NDAxIDEyLjY3Njg3NTIsMTkuNTUwMzkxNiAxMi45MTAxMjQ0LDE5LjUwODA1NTcgTDEzLDE5LjUgTDE4LDE5LjUgWiBNMjAsMTIuNSBDMjAuMjQ1NDU5OSwxMi41IDIwLjQ0OTYwODQsMTIuNjc2ODc1MiAyMC40OTE5NDQzLDEyLjkxMDEyNDQgTDIwLjUsMTMgTDIwLjUsMTggQzIwLjUsMTguMjc2MTQyNCAyMC4yNzYxNDI0LDE4LjUgMjAsMTguNSBDMTkuNzU0NTQwMSwxOC41IDE5LjU1MDM5MTYsMTguMzIzMTI0OCAxOS41MDgwNTU3LDE4LjA4OTg3NTYgTDE5LjUsMTggTDE5LjUsMTMgQzE5LjUsMTIuNzIzODU3NiAxOS43MjM4NTc2LDEyLjUgMjAsMTIuNSBaIiBpZD0icGF0aC0xIj48L3BhdGg+CiAgICAgICAgPGZpbHRlciB4PSItNjQuNiUiIHk9Ii01OS41JSIgd2lkdGg9IjIyOS4zJSIgaGVpZ2h0PSIyNDYuMSUiIGZpbHRlclVuaXRzPSJvYmplY3RCb3VuZGluZ0JveCIgaWQ9ImZpbHRlci0yIj4KICAgICAgICAgICAgPGZlTW9ycGhvbG9neSByYWRpdXM9IjEiIG9wZXJhdG9yPSJkaWxhdGUiIGluPSJTb3VyY2VBbHBoYSIgcmVzdWx0PSJzaGFkb3dTcHJlYWRPdXRlcjEiPjwvZmVNb3JwaG9sb2d5PgogICAgICAgICAgICA8ZmVPZmZzZXQgZHg9IjAiIGR5PSIyIiBpbj0ic2hhZG93U3ByZWFkT3V0ZXIxIiByZXN1bHQ9InNoYWRvd09mZnNldE91dGVyMSI+PC9mZU9mZnNldD4KICAgICAgICAgICAgPGZlR2F1c3NpYW5CbHVyIHN0ZERldmlhdGlvbj0iMyIgaW49InNoYWRvd09mZnNldE91dGVyMSIgcmVzdWx0PSJzaGFkb3dCbHVyT3V0ZXIxIj48L2ZlR2F1c3NpYW5CbHVyPgogICAgICAgICAgICA8ZmVDb21wb3NpdGUgaW49InNoYWRvd0JsdXJPdXRlcjEiIGluMj0iU291cmNlQWxwaGEiIG9wZXJhdG9yPSJvdXQiIHJlc3VsdD0ic2hhZG93Qmx1ck91dGVyMSI+PC9mZUNvbXBvc2l0ZT4KICAgICAgICAgICAgPGZlQ29sb3JNYXRyaXggdmFsdWVzPSIwIDAgMCAwIDAgICAwIDAgMCAwIDAgICAwIDAgMCAwIDAgIDAgMCAwIDAuMTYgMCIgdHlwZT0ibWF0cml4IiBpbj0ic2hhZG93Qmx1ck91dGVyMSI+PC9mZUNvbG9yTWF0cml4PgogICAgICAgIDwvZmlsdGVyPgogICAgPC9kZWZzPgogICAgPGcgaWQ9Iumhtemdoi00IiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iV2hpdGVib2FyZC1HdWlkZWxpbmVzIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMzQ0LjAwMDAwMCwgLTc1MS4wMDAwMDApIj4KICAgICAgICAgICAgPGcgaWQ9InNoYXBlLWN1cnNvciIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzQ0LjAwMDAwMCwgNzUxLjAwMDAwMCkiPgogICAgICAgICAgICAgICAgPHJlY3QgaWQ9IuefqeW9ouWkh+S7vS00NCIgZmlsbD0iI0ZGRkZGRiIgb3BhY2l0eT0iMC4wMSIgeD0iMCIgeT0iMCIgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMiI+PC9yZWN0PgogICAgICAgICAgICAgICAgPGcgaWQ9IuW9oueKtue7k+WQiCIgZmlsbC1ydWxlPSJub256ZXJvIj4KICAgICAgICAgICAgICAgICAgICA8dXNlIGZpbGw9ImJsYWNrIiBmaWxsLW9wYWNpdHk9IjEiIGZpbHRlcj0idXJsKCNmaWx0ZXItMikiIHhsaW5rOmhyZWY9IiNwYXRoLTEiPjwvdXNlPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIHN0cm9rZT0iI0ZGRkZGRiIgc3Ryb2tlLXdpZHRoPSIxIiBkPSJNMjAsMjEgQzIwLjQ4NTQxMDMsMjEgMjAuODk4MDg1LDIxLjM0Nzk5OTMgMjAuOTg5OTQ3OSwyMS44NjU0ODc3IEwyMSwyMiBMMjEsMjcgQzIxLDI3LjU1MjI4NDcgMjAuNTUyMjg0NywyOCAyMCwyOCBDMTkuNTE0NTg5NywyOCAxOS4xMDE5MTUsMjcuNjUyMDAwNyAxOS4wMTAwNTIxLDI3LjEzNDUxMjMgTDE5LDI3IEwxOSwyMiBDMTksMjEuNDQ3NzE1MyAxOS40NDc3MTUzLDIxIDIwLDIxIFogTTI3LDE5IEMyNy41NTIyODQ3LDE5IDI4LDE5LjQ0NzcxNTMgMjgsMjAgQzI4LDIwLjQ4NTQxMDMgMjcuNjUyMDAwNywyMC44OTgwODUgMjcuMTM0NTEyMywyMC45ODk5NDc5IEwyNywyMSBMMjIsMjEgQzIxLjQ0NzcxNTMsMjEgMjEsMjAuNTUyMjg0NyAyMSwyMCBDMjEsMTkuNTE0NTg5NyAyMS4zNDc5OTkzLDE5LjEwMTkxNSAyMS44NjU0ODc3LDE5LjAxMDA1MjEgTDIyLDE5IEwyNywxOSBaIE0xOCwxOSBDMTguNTUyMjg0NywxOSAxOSwxOS40NDc3MTUzIDE5LDIwIEMxOSwyMC40ODU0MTAzIDE4LjY1MjAwMDcsMjAuODk4MDg1IDE4LjEzNDUxMjMsMjAuOTg5OTQ3OSBMMTgsMjEgTDEzLDIxIEMxMi40NDc3MTUzLDIxIDEyLDIwLjU1MjI4NDcgMTIsMjAgQzEyLDE5LjUxNDU4OTcgMTIuMzQ3OTk5MywxOS4xMDE5MTUgMTIuODY1NDg3NywxOS4wMTAwNTIxIEwxMywxOSBMMTgsMTkgWiBNMjAsMTIgQzIwLjQ4NTQxMDMsMTIgMjAuODk4MDg1LDEyLjM0Nzk5OTMgMjAuOTg5OTQ3OSwxMi44NjU0ODc3IEwyMSwxMyBMMjEsMTggQzIxLDE4LjU1MjI4NDcgMjAuNTUyMjg0NywxOSAyMCwxOSBDMTkuNTE0NTg5NywxOSAxOS4xMDE5MTUsMTguNjUyMDAwNyAxOS4wMTAwNTIxLDE4LjEzNDUxMjMgTDE5LDE4IEwxOSwxMyBDMTksMTIuNDQ3NzE1MyAxOS40NDc3MTUzLDEyIDIwLDEyIFoiIGZpbGw9IiMyMTIzMjQiIGZpbGwtcnVsZT0iZXZlbm9kZCI+PC9wYXRoPgogICAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICAgICAgPHJlY3QgaWQ9IuefqeW9oiIgZmlsbD0iI0ZGRkZGRiIgeD0iMTguNSIgeT0iMTciIHdpZHRoPSIzIiBoZWlnaHQ9IjYiPjwvcmVjdD4KICAgICAgICAgICAgICAgIDxyZWN0IGlkPSLnn6nlvaIiIGZpbGw9IiNGRkZGRkYiIHg9IjE3IiB5PSIxOC41IiB3aWR0aD0iNiIgaGVpZ2h0PSIzIj48L3JlY3Q+CiAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMjAsMjEuNSBDMjAuMjQ1NDU5OSwyMS41IDIwLjQ0OTYwODQsMjEuNjc2ODc1MiAyMC40OTE5NDQzLDIxLjkxMDEyNDQgTDIwLjUsMjIgTDIwLjUsMjcgQzIwLjUsMjcuMjc2MTQyNCAyMC4yNzYxNDI0LDI3LjUgMjAsMjcuNSBDMTkuNzU0NTQwMSwyNy41IDE5LjU1MDM5MTYsMjcuMzIzMTI0OCAxOS41MDgwNTU3LDI3LjA4OTg3NTYgTDE5LjUsMjcgTDE5LjUsMjIgQzE5LjUsMjEuNzIzODU3NiAxOS43MjM4NTc2LDIxLjUgMjAsMjEuNSBaIE0yNywxOS41IEMyNy4yNzYxNDI0LDE5LjUgMjcuNSwxOS43MjM4NTc2IDI3LjUsMjAgQzI3LjUsMjAuMjQ1NDU5OSAyNy4zMjMxMjQ4LDIwLjQ0OTYwODQgMjcuMDg5ODc1NiwyMC40OTE5NDQzIEwyNywyMC41IEwyMiwyMC41IEMyMS43MjM4NTc2LDIwLjUgMjEuNSwyMC4yNzYxNDI0IDIxLjUsMjAgQzIxLjUsMTkuNzU0NTQwMSAyMS42NzY4NzUyLDE5LjU1MDM5MTYgMjEuOTEwMTI0NCwxOS41MDgwNTU3IEwyMiwxOS41IEwyNywxOS41IFogTTE4LDE5LjUgQzE4LjI3NjE0MjQsMTkuNSAxOC41LDE5LjcyMzg1NzYgMTguNSwyMCBDMTguNSwyMC4yNDU0NTk5IDE4LjMyMzEyNDgsMjAuNDQ5NjA4NCAxOC4wODk4NzU2LDIwLjQ5MTk0NDMgTDE4LDIwLjUgTDEzLDIwLjUgQzEyLjcyMzg1NzYsMjAuNSAxMi41LDIwLjI3NjE0MjQgMTIuNSwyMCBDMTIuNSwxOS43NTQ1NDAxIDEyLjY3Njg3NTIsMTkuNTUwMzkxNiAxMi45MTAxMjQ0LDE5LjUwODA1NTcgTDEzLDE5LjUgTDE4LDE5LjUgWiBNMjAsMTIuNSBDMjAuMjQ1NDU5OSwxMi41IDIwLjQ0OTYwODQsMTIuNjc2ODc1MiAyMC40OTE5NDQzLDEyLjkxMDEyNDQgTDIwLjUsMTMgTDIwLjUsMTggQzIwLjUsMTguMjc2MTQyNCAyMC4yNzYxNDI0LDE4LjUgMjAsMTguNSBDMTkuNzU0NTQwMSwxOC41IDE5LjU1MDM5MTYsMTguMzIzMTI0OCAxOS41MDgwNTU3LDE4LjA4OTg3NTYgTDE5LjUsMTggTDE5LjUsMTMgQzE5LjUsMTIuNzIzODU3NiAxOS43MjM4NTc2LDEyLjUgMjAsMTIuNSBaIiBpZD0i5b2i54q257uT5ZCIIiBmaWxsPSIjMjEyMzI0IiBmaWxsLXJ1bGU9Im5vbnplcm8iPjwvcGF0aD4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+"]]),KL=n=>{const{style:t,onClickHandler:e}=n;return ut.createElement("div",{className:"font-size-menu",style:t,onPointerUp:r=>{r.stopPropagation(),r.nativeEvent.stopImmediatePropagation()}},Vn.map(r=>ut.createElement("div",{className:"font-size-btn",key:r,onPointerUp:()=>{e(r)}},r)))},JL=n=>{const t=It.useRef(null),{open:e,setOpen:r,textOpt:i,workIds:o,floatBarRef:s}=n,{mananger:a,floatBarData:l}=It.useContext(Me),[u,p]=It.useState(0),c=Vn.length-1;It.useEffect(()=>{i!=null&&i.fontSize&&(p(i.fontSize),t.current&&(t.current.value=i.fontSize.toString()))},[i?.fontSize]);const g=It.useMemo(()=>{if(s!=null&&s.current&&Pt.isNumber(l?.y)&&a!=null&&a.height){if(s.current.offsetTop&&s.current.offsetTop+l.y>180){const T={};return T.top="inherit",T.bottom=35,T}else if(!s.current.offsetTop&&a?.height-s.current.offsetTop-l.y<120){const T={};return T.top="inherit",T.bottom=35,T}}},[s?.current,l,a]);function v(T){p(T),T&&T>=Vn[0]&&T<=Vn[c]&&_t.emitMethod(Ht.MainEngine,zt.SetFontStyle,{workIds:o||[Xt],fontSize:T,viewId:a?.viewId})}const I=T=>{var h;(h=t.current)==null||h.blur(),r(!1),y(T)},w=It.useMemo(()=>e?ut.createElement(KL,{onClickHandler:I,style:g}):null,[e,I,g]),y=T=>{T>Vn[c]&&(T=Vn[c]),T<Vn[0]&&(T=Vn[0]),v(T)};return ut.createElement("div",{className:"button normal-button font-size-barBtn",style:{width:50},onPointerUp:T=>{T.stopPropagation(),T.nativeEvent.stopImmediatePropagation()}},ut.createElement("input",{className:"font-size-input",ref:t,onTouchEnd:()=>{t.current&&t.current.focus()},onClick:()=>{r(!e),t.current&&t.current.focus()},onKeyDown:T=>{if(T.key==="Backspace"){const h=window.getSelection(),m=h?.getRangeAt(0);if(m!=null&&m.collapsed)return T.cancelable&&T.preventDefault(),document.execCommand("delete",!1),!1}return!1},onKeyUp:T=>{var h;if(t.current){const m=t.current.value,d=parseInt(m);isNaN(d)?t.current.value="0":t.current.value=d.toString(),d&&T.key==="Enter"&&(y(d),(h=t.current)==null||h.blur(),r(!1))}}}),ut.createElement("div",{className:"font-size-btns"},ut.createElement("div",{className:"font-size-add",onPointerUp:()=>{y(u+Vn[0])}}),ut.createElement("div",{className:"font-size-cut",onPointerUp:()=>{y(u-Vn[0])}})),w)},qL=n=>{const{workIds:t,mananger:e,islocked:r}=n;return ut.createElement("div",{className:"button normal-button",onPointerUp:i=>{i.stopPropagation(),_t.emitMethod(Ht.MainEngine,zt.SetLock,{workIds:t||[Xt],isLocked:!r,viewId:e?.viewId})}},ut.createElement("img",{alt:"icon",src:Ue(r?"unlock-new":"lock-new")}))},Fu=n=>{const{icon:t,min:e,max:r,step:i,value:o,onInputHandler:s}=n,[a,l]=It.useState(0),u=It.useRef(null),p=c=>{c>r&&(c=r),c<e&&(c=e),l(c),s(c),u.current&&(u.current.value=c.toString())};return It.useEffect(()=>{o&&(l(o),u.current&&(u.current.value=o.toString()))},[o]),ut.createElement("div",{className:"button input-button"},ut.createElement("img",{src:Ue(t)}),ut.createElement("input",{className:"input-number",type:"text",ref:u,onPointerUp:()=>{u.current&&u.current.focus()},onKeyDown:c=>{if(c.key==="Backspace"){const g=window.getSelection(),v=g?.getRangeAt(0);if(v!=null&&v.collapsed)return c.cancelable&&c.preventDefault(),document.execCommand("delete",!1),!1}},onKeyUp:()=>{if(u.current){const c=u.current.value,g=parseInt(c);isNaN(g)?u.current.value="0":u.current.value=g.toString()}},onChange:c=>{const g=c.target.value,v=parseInt(g);v&&v&&v>=e&&v<=r&&p(v)}}),ut.createElement("div",{className:"input-number-btns"},ut.createElement("div",{className:"input-number-add",onPointerUp:()=>{p(a+i)}}),ut.createElement("div",{className:"input-number-cut",onPointerUp:()=>{p(a-i)}})))},_L=n=>{const{icon:t,min:e,max:r,step:i,value:o,onInputHandler:s}=n;return ut.createElement("div",{className:"button input-button"},ut.createElement("img",{src:Ue(t)}),ut.createElement(tO,{min:e,max:r,step:i,value:o,onInputHandler:s}))},tO=n=>{const{value:t,min:e,max:r,onInputHandler:i}=n,[o,s]=It.useState({x:0,y:0});It.useEffect(()=>{s({x:t*100,y:0})},[]);const a=(p,c)=>{let g=Math.floor(Math.max(c.x,e*100));g=Math.floor(Math.min(g,r*100)),c.x!==o?.x&&s({x:g,y:0});const v=g/100;t!==v&&i(v)},l=()=>{},u=(p,c)=>{let g=Math.floor(Math.max(c.x,e*100));g=Math.floor(Math.min(g,r*100)),c.x!==o?.x&&s({x:g,y:0});const v=g/100;t!==v&&i(v)};return ut.createElement("div",{className:"range-number-container",onPointerUp:p=>{const c=p.nativeEvent.offsetX-6;let g=Math.floor(Math.max(c,e*100));g=Math.floor(Math.min(g,r*100)),s({x:g,y:0});const v=g/100;t!==v&&i(v)}},ut.createElement("div",{className:"range-number-color"}),ut.createElement("div",{className:"range-number"},ut.createElement(Ji,{bounds:"parent",axis:"x",position:o,onDrag:a,onStart:l,onStop:u},ut.createElement("div",{className:"circle",onPointerUp:os}))))},eO=n=>{const{icon:t,value:e,onChangeHandler:r,style:i}=n,[o,s]=It.useState(0),[a,l]=It.useState(),u=It.useRef(null),p=It.useCallback(v=>{v>=xi.length&&(v=0),v<0&&(v=xi.length-1),s(v),r(xi[v]),l(!1),u.current&&(u.current.value=xi[v])},[r]),c=It.useMemo(()=>{if(i&&i.bottom){const v={};return v.top="inherit",v.bottom=50,v}},[i]);It.useEffect(()=>{e&&(s(xi.indexOf(e)),u.current&&(u.current.value=e))},[e]);const g=It.useMemo(()=>a?ut.createElement(nO,{options:xi,onClickHandler:p,style:c}):null,[a,p,c]);return ut.createElement("div",{className:"button input-button"},ut.createElement("img",{src:Ue(t)}),ut.createElement("input",{readOnly:!0,className:"input-number",type:"text",ref:u,onPointerUp:()=>{u.current&&(u.current.focus(),l(!a))}}),ut.createElement("div",{className:"input-number-btns"},ut.createElement("div",{className:"input-number-add",onPointerUp:()=>{p(o+1)}}),ut.createElement("div",{className:"input-number-cut",onPointerUp:()=>{p(o-1)}})),g)},nO=n=>{const{options:t,style:e,onClickHandler:r}=n;return ut.createElement("div",{className:"select-option-menu",style:e},t.map((i,o)=>ut.createElement("div",{className:"select-option-btn",key:i,onPointerUp:()=>{r(o)}},i)))},rO=n=>{const{innerRatio:t,innerVerticeStep:e,vertices:r,mananger:i,setShapeOpt:o}=n,s=u=>{o({vertices:u}),_t.emitMethod(Ht.MainEngine,zt.SetShapeOpt,{workIds:[Xt],toolsType:nt.Star,viewId:i.viewId,vertices:u})},a=u=>{o({innerVerticeStep:u}),_t.emitMethod(Ht.MainEngine,zt.SetShapeOpt,{workIds:[Xt],toolsType:nt.Star,viewId:i.viewId,innerVerticeStep:u})},l=u=>{o({innerRatio:u}),_t.emitMethod(Ht.MainEngine,zt.SetShapeOpt,{workIds:[Xt],toolsType:nt.Star,viewId:i.viewId,innerRatio:u})};return ut.createElement(ut.Fragment,null,ut.createElement(Fu,{value:r,icon:"polygon-vertex",min:3,max:100,step:1,onInputHandler:s}),ut.createElement(Fu,{value:e,icon:"star-innerVertex",min:1,max:100,step:1,onInputHandler:a}),ut.createElement(_L,{value:t,icon:"star-innerRatio",min:.1,max:1,step:.1,onInputHandler:l}))},iO=n=>{const{mananger:t,vertices:e,setShapeOpt:r}=n,i=o=>{r({vertices:o}),_t.emitMethod(Ht.MainEngine,zt.SetShapeOpt,{workIds:[Xt],toolsType:nt.Polygon,viewId:t.viewId,vertices:o})};return ut.createElement(Fu,{value:e,icon:"polygon-vertex",min:3,max:100,step:1,onInputHandler:i})},oO=n=>{const{mananger:t,placement:e,setShapeOpt:r}=n,i=o=>{r({placement:o}),_t.emitMethod(Ht.MainEngine,zt.SetShapeOpt,{workIds:[Xt],toolsType:nt.SpeechBalloon,viewId:t.viewId,placement:o})};return ut.createElement(eO,{value:e,icon:"speechBallon-placement",onChangeHandler:i})},bl=n=>{const{icon:t,isActive:e,onPointerUpHandler:r}=n;return ut.createElement("div",{className:`button tab-button ${e?"active":""}`,onPointerUp:r},ut.createElement("img",{src:Ue(t)}))},sO=n=>{const{toolsTypes:t,style:e,mananger:r,shapeOpt:i,setShapeOpt:o}=n,[s,a]=It.useState();It.useEffect(()=>{t.includes(nt.Polygon)?a(nt.Polygon):t.includes(nt.Star)?a(nt.Star):a(nt.SpeechBalloon)},[t]);const l=g=>{a(g)},u=It.useMemo(()=>s===nt.Polygon&&r&&i.vertices?ut.createElement(iO,{vertices:i.vertices,mananger:r,setShapeOpt:o}):null,[r,s,i,o]),p=It.useMemo(()=>s===nt.Star&&r&&i.vertices&&i.innerVerticeStep&&i.innerRatio?ut.createElement(rO,{mananger:r,vertices:i.vertices,innerVerticeStep:i.innerVerticeStep,innerRatio:i.innerRatio,setShapeOpt:o}):null,[r,s,i,o]),c=It.useMemo(()=>s===nt.SpeechBalloon&&r&&i.placement?ut.createElement(oO,{mananger:r,placement:i.placement,setShapeOpt:o}):null,[s,r,i.placement,o]);return ut.createElement("div",{className:"shapeOpt-sub-menu",style:e,onPointerUp:os},ut.createElement("div",{className:"shapeOpt-sub-menu-tabs"},t.includes(nt.Polygon)&&ut.createElement(bl,{isActive:s===nt.Polygon,icon:s===nt.Polygon?"polygon-active":"polygon",onPointerUpHandler:l.bind(void 0,nt.Polygon)})||null,t.includes(nt.Star)&&ut.createElement(bl,{isActive:s===nt.Star,icon:s===nt.Star?"star-active":"star",onPointerUpHandler:l.bind(void 0,nt.Star)})||null,t.includes(nt.SpeechBalloon)&&ut.createElement(bl,{isActive:s===nt.SpeechBalloon,icon:s===nt.SpeechBalloon?"speechBallon-active":"speechBallon",onPointerUpHandler:l.bind(void 0,nt.SpeechBalloon)})||null),ut.createElement("div",{className:"shapeOpt-sub-menu-content"},u,p,c))},aO=n=>{const{open:t,setOpen:e,floatBarRef:r,toolsTypes:i,shapeOpt:o}=n,{floatBarData:s,mananger:a,setFloatBarData:l}=It.useContext(Me),u=It.useRef(null),p=It.useMemo(()=>{if(r!=null&&r.current&&Pt.isNumber(s?.x)&&Pt.isNumber(s?.y)&&a!=null&&a.height){if(r.current.offsetTop&&r.current.offsetTop+s.y>200){const I={};return I.top="inherit",I.bottom=50,I}else if(!r.current.offsetTop&&a?.height-r.current.offsetTop-s?.y<140){const I={};return I.top="inherit",I.bottom=50,I}}},[r,s?.x,s?.y,a?.height]),c=It.useCallback(I=>{l({shapeOpt:{...o,...I}})},[l,o]),g=It.useMemo(()=>t&&i&&a&&o?ut.createElement(sO,{shapeOpt:o,style:p,toolsTypes:i,mananger:a,setShapeOpt:c}):null,[t,p,i,a,o,c]),v=()=>{e(!t)};return ut.createElement("div",{ref:u,className:`button normal-button ${t&&"active"}`,onPointerUp:v},g,ut.createElement("img",{alt:"icon",src:Ue(t?"shapes-active":"shapes")}))},Ev=ut.memo(n=>{const{textOpt:t,workIds:e,noLayer:r,position:i,noDelete:o,noCopy:s}=n,{floatBarData:a,mananger:l}=It.useContext(Me),[u,p]=ut.useState(0),[c,g]=ut.useState(),v=It.useRef(null);It.useEffect(()=>{var E,P,R,N;const b={},j=a?.w||((E=t?.boxSize)==null?void 0:E[0])||0,O=a?.h||((P=t?.boxSize)==null?void 0:P[1])||0;if(i&&j&&O&&l!=null&&l.width&&l!=null&&l.height){if(i.y<60?i.y+O<l.height-60?b.bottom=-120:i.y+O<l.height?b.bottom=-58:i.y>0?b.top=62:b.top=-i.y+62:b.top=0,i.x<0)b.left=-i.x+3;else if(i.x+(((R=v.current)==null?void 0:R.offsetWidth)||j)>l.width){const L=l.width-(((N=v.current)==null?void 0:N.offsetWidth)||j)-i.x;b.left=L}g(b);return}g(void 0)},[v,i,a?.w,a?.h,l?.width,l?.height,t?.boxSize]);const I=It.useMemo(()=>a!=null&&a.fillColor?ut.createElement(YL,{floatBarRef:v,open:u===3,setOpen:E=>{p(E===!0?3:0)}}):null,[a?.fillColor,u,v]),w=It.useMemo(()=>a!=null&&a.strokeColor?ut.createElement(UL,{floatBarRef:v,open:u===2,setOpen:E=>{p(E===!0?2:0)}}):null,[a?.strokeColor,u,v]),y=It.useMemo(()=>t!=null&&t.fontColor&&l!=null&&l.viewId?ut.createElement(FL,{floatBarRef:v,open:u===4,setOpen:E=>{p(E===!0?4:0)},textOpt:t,workIds:e}):null,[t,u,e,l,v]),T=It.useMemo(()=>t!=null&&t.fontBgColor&&l!=null&&l.viewId?ut.createElement(VL,{floatBarRef:v,open:u===5,setOpen:E=>{p(E===!0?5:0)},textOpt:t,workIds:e}):null,[t,u,e,l,v]),h=It.useMemo(()=>t&&l!=null&&l.viewId?ut.createElement(QL,{floatBarRef:v,open:u===6,setOpen:E=>{p(E===!0?6:0)},textOpt:t,workIds:e,style:c}):null,[t,u,e,l,c,v]),m=It.useMemo(()=>t&&l!=null&&l.viewId?ut.createElement(JL,{open:u===7,setOpen:E=>{p(E===!0?7:0)},textOpt:t,workIds:e,floatBarRef:v}):null,[t,u,e,l,v]),d=It.useMemo(()=>r?null:ut.createElement(zL,{open:u===1,setOpen:E=>{p(E===!0?1:0)},floatBarRef:v}),[r,u,v]),M=It.useMemo(()=>a!=null&&a.canLock&&l?ut.createElement(qL,{workIds:e,mananger:l,islocked:a.isLocked}):null,[a,l,e]),x=It.useMemo(()=>l&&l!=null&&l.viewId&&c&&a!=null&&a.shapeOpt&&a!=null&&a.toolsTypes?ut.createElement(aO,{open:u===8,setOpen:E=>{p(E===!0?8:0)},floatBarRef:v,workIds:e,toolsTypes:a.toolsTypes,shapeOpt:a.shapeOpt}):null,[a,l,u,c,e,v]);return ut.createElement("div",{className:"appliance-plugin-floatbtns",style:c,ref:v},l&&!o&&ut.createElement(RL,{workIds:e,mananger:l}),d,M,!!(l!=null&&l.viewId)&&!s&&ut.createElement(jL,{workIds:e,viewId:l.viewId}),x,h,m,y,T,w,I)}),lO=n=>{const{data:t,workId:e,updateOptInfo:r,handlePointerDown:i,handlePointerUp:o}=n,{opt:s,scale:a,translate:l,x:u,y:p}=t,c=It.useRef(null),{floatBarData:g}=It.useContext(Me),v=It.useMemo(()=>{const{fontSize:y,fontFamily:T,underline:h,fontColor:m,lineThrough:d,textAlign:M,strokeColor:x,lineHeight:E,bold:P,italic:R}=s,N=E||y*1.2,b={fontSize:`${y}px`,lineHeight:`${N}px`,color:m,borderColor:x,minHeight:`${N}px`,pointerEvents:"none",paddingRight:`${R==="italic"?Math.round(y*.3):5}px`};return T&&(b.fontFamily=`${T}`),(d||h)&&(b.textDecoration=`${d&&"line-through"||""}${h&&" underline"||""}`),M&&(b.textAlign=`${M}`),P&&(b.fontWeight=`${P}`),R&&(b.fontStyle=`${R}`),b},[s]),I=It.useMemo(()=>{const y=[];if(s.text){const T=io(s.text);for(let h=0;h<T.length;h++){const m=T[h];m===""?y.push(ut.createElement("div",{key:h})):y.push(ut.createElement("div",{key:h},m))}}return y.length?y:ut.createElement("div",null)},[s.text]),w=It.useMemo(()=>{if(!g)return{};const y=`scale(${a||1}) ${l&&"translate("+l[0]+"px,"+l[1]+"px)"||""}`;return{left:`${u-g.x}px`,top:`${p-g.y}px`,zIndex:1,transform:y,transformOrigin:"left top",opacity:0,pointerEvents:"auto"}},[a,l,u,p,g]);return It.useEffect(()=>{var y,T;if((y=c.current)!=null&&y.offsetWidth&&(T=c.current)!=null&&T.offsetHeight){const h=s.boxSize;if(h?.[0]!==c.current.offsetWidth||h[1]!==c.current.offsetHeight||!h){const m=[c.current.offsetWidth,c.current.offsetHeight];r({activeTextId:e,update:{boxSize:m,workState:Tt.Done}})}}},[s.fontSize,s.italic,s.bold,s.boxSize,e,r]),ut.createElement("div",{className:"editor-box readonly",style:w,onPointerDown:()=>{i(e)},onPointerUp:()=>{o()}},ut.createElement("div",{className:"editor",ref:c,style:v},I))},uO=n=>{const{mananger:t}=It.useContext(Me),e=It.useMemo(()=>{var r;const i=o=>{var s,a;if(!t)return;const{activeTextId:l,update:u,syncData:p}=o,c=l&&Pt.cloneDeep(((s=t.control.textEditorManager)==null?void 0:s.get(l))||((a=n.editors)==null?void 0:a.get(l)));c&&c.opt&&(c.opt={...c.opt,...u},p&&(c.canSync=Object.keys(p).includes("canSync")&&p.canSync||c.canSync,c.canWorker=Object.keys(p).includes("canWorker")&&p.canWorker||c.canWorker),t.control.textEditorManager.updateForViewEdited(l,c))};if((r=n.editors)!=null&&r.size){const o=[];return n.editors.forEach((s,a)=>{if(n.selectIds&&n.selectIds.includes(a)){const l=ut.createElement(lO,{key:a,workId:a,data:s,updateOptInfo:i,handlePointerDown:n.handleTextEditorPointerDown,handlePointerUp:n.handleTextEditorPointerUp});o.push(l)}}),o}return null},[n.editors,n.selectIds,t,n.handleTextEditorPointerDown,n.handleTextEditorPointerUp]);return ut.createElement(ut.Fragment,null,e)},cO=n=>{const{position:t,textOpt:e,workIds:r,noLayer:i,noCopy:o,noDelete:s,style:a}=n,l=It.useRef(null);return ut.createElement("div",{className:Fe.FloatBarBtn,ref:l,style:a},ut.createElement(Ev,{position:t,textOpt:e,workIds:r,noLayer:i,noCopy:o,noDelete:s}))},hO=n=>{const{data:t,workId:e,showFloatBtns:r,handleKeyUp:i,handleFocus:o,runAnimation:s,updateSize:a,rightBoundBreak:l}=n,{activeTextEditor:u,activeTextId:p,mananger:c}=It.useContext(Me),{opt:g,scale:v,translate:I,x:w,y}=t,{fontSize:T,fontFamily:h,underline:m,fontColor:d,lineThrough:M,textAlign:x,lineHeight:E,bold:P,italic:R}=g,N=It.useRef(null),b=It.useMemo(()=>{const K=T,et=E||K*1.2,W={fontSize:`${K}px`,lineHeight:`${et}px`,color:d,minHeight:`${et}px`,paddingRight:`${R==="italic"?Math.round(K*.3):5}px`,borderWidth:`${Math.max(Math.round(1/(v||1)),1)}px`};return h&&(W.fontFamily=`${h}`),(M||m)&&(W.textDecoration=`${M&&"line-through"||""} ${m&&" underline"||""}`),x&&(W.textAlign=`${x}`),P&&(W.fontWeight=`${P}`),R&&(W.fontStyle=`${R}`),W},[P,d,h,T,R,E,M,v,x,m]),j=It.useRef(!1),O=It.useRef(6),L=It.useRef({fontSize:b.fontSize,lineHeight:b.lineHeight,fontStyle:b.fontStyle,fontWeight:b.fontWeight,fontFamily:b.fontFamily}),k=It.useMemo(()=>p===e?"hover":g.workState===Tt.Doing||g.workState===Tt.Start?"editing":u?"active":"none",[p,e,g.workState,u]);function H(K){if(N.current){const et=window?.getSelection(),W=N.current,$=(C,D)=>{var B;const X=document.createRange();if(D.childNodes.length>0){const q=D.lastChild;if(q){const rt=q.lastChild;rt&&rt.nodeType===Node.TEXT_NODE?X.setStart(rt,((B=rt.textContent)==null?void 0:B.length)||0):X.setStart(q,0)}else X.setStart(D,0)}else X.setStart(D,0);X.collapse(!0),C.removeAllRanges(),C.addRange(X)};if(et&&W)if(K&&li(K.nativeEvent)){const{x:C,y:D}=fh(K.nativeEvent);if(document.caretPositionFromPoint){const B=document.caretPositionFromPoint(C,D);if(B){const X=document.createRange();X.setStart(B.offsetNode,B.offset),X.collapse(!0),et.removeAllRanges(),et.addRange(X)}else $(et,W)}else if(document.caretRangeFromPoint){const B=document.caretRangeFromPoint(C,D);B?(et.removeAllRanges(),et.addRange(B)):$(et,W)}else $(et,W)}else $(et,W);N.current.focus()}}const Q=It.useMemo(()=>{const K=`scale(${v||1}) ${I&&"translate("+I[0]+"px,"+I[1]+"px)"||""}`;return{left:`${w}px`,top:`${y}px`,zIndex:2,transform:K,transformOrigin:"left top",borderColor:k==="editing"||k==="hover"?d:"transparent"}},[v,I,w,y,d,k]),_=It.useMemo(()=>{let K="";const et=`<div style="background-color:${g.fontBgColor};"></div>`;if(g.text){const W=io(g.text);for(let $=0;$<W.length;$++){const C=W[$];if(C==="")K=K+et;else{const D=C.replace(/[<>&]/g,B=>({"<":"&lt;",">":"&gt;","&":"&amp;"})[B]);K=K+`<div style="background-color:${g.fontBgColor}">${D}</div>`}}}else K=et;return K},[g.fontBgColor,g.text]),st=It.useMemo(()=>{var K,et;if(k==="hover"){if(v&&r&&Pt.isNumber(w)&&Pt.isNumber(y)&&g.boxSize&&Pt.isNumber((K=g.boxSize)==null?void 0:K[0])&&Pt.isNumber((et=g.boxSize)==null?void 0:et[1])){const W={x:w,y},$={left:w,top:y,width:g.boxSize[0]*v,height:g.boxSize[1]*v};return ut.createElement(cO,{position:W,style:$,textOpt:g,workIds:[e],noLayer:!0,noCopy:!0,noDelete:!0})}return null}return null},[g,r,e,w,y,v,k]);It.useEffect(()=>{p===e&&N.current&&(document.activeElement!==N.current&&H(),o(N.current))},[p,o,e]),It.useEffect(()=>{if(N.current){const K=parseInt(getComputedStyle(N.current).paddingRight,10)+parseInt(getComputedStyle(N.current).borderWidth,10);O.current=Number(K)}},[]),It.useEffect(()=>{if(N.current){const K={fontSize:b.fontSize,lineHeight:b.lineHeight,fontStyle:b.fontStyle,fontWeight:b.fontWeight,fontFamily:b.fontFamily};if(!Pt.isEqual(L.current,K)){L.current=K;const et=[N.current.offsetWidth,N.current.offsetHeight];a(e,et)}}},[b,e,a]);const F=It.useCallback(K=>{var et,W;const $=c?.parentElement;if(!$||!N.current||!l)return!1;const C=N.current.lastChild;if(!C)return!1;const D=C.getBoundingClientRect(),B=$.getBoundingClientRect();if(D.right+K>B.right){const X=C.lastChild;if(!(X instanceof Text))return!1;const q=X.length||0;let rt=0,lt=0,gt=q;for(;lt<gt;){const yt=Math.floor((lt+gt)/2),xt=document.createRange();xt.setStart(X,0),xt.setEnd(X,yt);const Et=xt.getBoundingClientRect(),St=B.right-Et.right;if(St<K){if(yt>0){const Mt=document.createRange();Mt.setStart(X,0),Mt.setEnd(X,yt-1);const Ct=Mt.getBoundingClientRect();if(B.right-Ct.right>=K){rt=yt-1;break}}gt=yt}else{const Mt=yt+1;if(Mt<q){const Ct=document.createRange();Ct.setStart(X,0),Ct.setEnd(X,Mt);const Ot=Ct.getBoundingClientRect();if(B.right-Ot.right<=K&&St>K){rt=yt;break}}lt=Mt}}if(!rt){const yt=document.createRange();yt.setStart(X,0),yt.setEnd(X,lt);const xt=yt.getBoundingClientRect();B.right-xt.right>K?rt=lt:lt>0&&(rt=lt-1)}if(rt>0){const yt=((et=X.textContent)==null?void 0:et.slice(0,rt))||"",xt=((W=X.textContent)==null?void 0:W.slice(rt))||"";X.textContent=yt;const Et=document.createElement("div");return g.fontBgColor&&(Et.style.backgroundColor=g.fontBgColor),xt&&(Et.textContent=xt),N.current.appendChild(Et),F(K),!0}}return!1},[c?.parentElement,g.fontBgColor,l]);function Z(K){if(K.key==="Backspace"){const et=window.getSelection(),W=et?.getRangeAt(0);if(W!=null&&W.collapsed)return K.cancelable&&K.preventDefault(),document.execCommand("delete",!1),!1}return!1}function tt(K,et){const W=window?.getSelection();if(W!=null&&W.rangeCount&&K&&W&&W.anchorNode){const $=W.anchorOffset,C=W.anchorNode.textContent||"",D=C.slice(0,$)||"",B=C.slice($)||"",X=D.concat(K)||"";ct(X,B,et)}}function ct(K,et,W){const $=window?.getSelection();if(!($!=null&&$.rangeCount)||!$.anchorNode)return;const C=K.split(/\n/);let D=$.anchorNode.parentNode;D===W&&(D=$.anchorNode);const B=[...W.childNodes],X=[];let q,rt=$.anchorOffset;for(;B.length;){const lt=B.pop();if(lt){if(lt===D){let gt=C[0];C.length===1&&(rt=C[0].length,gt=C[0].concat(et)),D.nodeName==="#text"?(D.textContent=gt,q=D):D.nodeName==="DIV"&&(D.innerText=gt,q=D.childNodes[0]);break}X.push(lt),W.removeChild(lt)}}if(C.length>1)for(let lt=1;lt<C.length;lt++){let gt=C[lt];const yt=document.createElement("div");g.fontBgColor&&(yt.style.backgroundColor=g.fontBgColor),lt===C.length-1&&(rt=gt.length,gt=gt.concat(et)),yt.innerText=gt,W.appendChild(yt),lt===C.length-1&&(q=yt.childNodes[0])}if(X.length){X.reverse();for(const lt of X)W.appendChild(lt)}if(q&&q.nodeName==="#text"){$.deleteFromDocument();const lt=document.createRange(),gt=Math.min(rt,q?.length||0);lt.setStart(q,gt),lt.collapse(!0),$.removeAllRanges(),$.addRange(lt)}}function at(K){if(K.cancelable&&K.preventDefault(),K.stopPropagation(),K.stopImmediatePropagation(),N.current){const et=(K.clipboardData||window.clipboardData).getData("text"),W=window?.getSelection();if(!(W!=null&&W.rangeCount))return;if(et&&W&&W.anchorNode){const $=Wl(et,{whiteList:{},stripIgnoreTag:!0,stripIgnoreTagBody:["script"]});tt($,N.current),i(N.current)}s()}}function dt(K){var et;const W=K.querySelector("div");if(W){const $=document.createTreeWalker(K,NodeFilter.SHOW_TEXT,null);let C;const D=[];for(;(C=$.nextNode())!==null;)C.parentNode===K&&D.push(C);if(D.length>0){for(const X of D)W.appendChild(X);const B=window.getSelection();if(B){const X=document.createRange(),q=W.lastChild;q&&q.nodeType===Node.TEXT_NODE&&(X.setStart(q,((et=q.textContent)==null?void 0:et.length)||0),X.collapse(!0),B.removeAllRanges(),B.addRange(X))}}}}const it=It.useCallback(()=>{const K=N.current;s(()=>{if(!j.current&&K){if(dt(K),F((v||1)*O.current)){const et=window.getSelection();if(!(et!=null&&et.rangeCount))return!1;const W=document.createRange(),$=N.current.lastChild;W.selectNodeContents($),W.collapse(!1),et.removeAllRanges(),et.addRange(W)}i(K)}})},[s,i,F,v]);function ft(){j.current=!0,s()}function wt(){j.current=!1,it()}const U=It.useCallback(()=>{if(k==="active"&&N.current&&N.current.parentElement){const K=N.current.parentElement;K.style.borderColor=d}},[k,d]),Y=It.useCallback(()=>{if(k==="active"&&N.current&&N.current.parentElement){const K=N.current.parentElement;K.style.borderColor="transparent"}},[k]);return ut.createElement(ut.Fragment,null,st,ut.createElement("div",{className:`editor-box ${k}`,style:Q,onPointerUp:()=>{var K;if(k==="editing"){s(()=>{var et;(et=document.activeElement)==null||et.blur(),c?.control.textEditorManager.checkEmptyTextBlur()});return}if(k==="active"&&c){if((K=c.control.collector)!=null&&K.hasIncludeSelector(e)){s(()=>{var et;(et=document.activeElement)==null||et.blur(),c?.control.textEditorManager.checkEmptyTextBlur()});return}if(c&&p!==e){c.control.textEditorManager.checkEmptyTextBlur(),c.control.textEditorManager.active(e);return}}},onMouseOver:U,onMouseLeave:Y},ut.createElement("div",{id:e,suppressContentEditableWarning:!0,contentEditable:!0,className:"editor",ref:N,style:b,onKeyDown:Z,onPaste:at,onTouchEnd:H,onInput:it,onCompositionStart:ft,onCompositionEnd:wt,dangerouslySetInnerHTML:{__html:_}})))},fO=n=>{const t=It.useRef(null),{mananger:e}=It.useContext(Me),r=It.useRef(),i=It.useCallback(s=>{var a,l;const{activeTextId:u,update:p,syncData:c}=s;if(!e)return;const g=u&&Pt.cloneDeep(((a=e.control.textEditorManager)==null?void 0:a.get(u))||((l=n.editors)==null?void 0:l.get(u)));g&&g.opt&&(g.opt={...g.opt,...p},c&&(g.canSync=Object.keys(c).includes("canSync")&&c.canSync||g.canSync,g.canWorker=Object.keys(c).includes("canWorker")&&c.canWorker||g.canWorker),e.control.textEditorManager.updateForViewEdited(u,g))},[e,n.editors]),o=It.useMemo(()=>{var s;const a=g=>{const v=[];for(let I=0;I<g.childNodes.length;I++){const w=g.childNodes[I];if(w.nodeName==="#text"&&I===0){const y=w.textContent.split(/\n/),T=y.pop();v.push(...y),T&&v.push(T)}else if(w.nodeName==="DIV"){const y=w.innerText.split(/\n/);if(y.length===2&&y[0]===""&&y[1]==="")v.push("");else{const T=y.shift();(T||T==="")&&v.push(T);const h=y.pop();v.push(...y),h&&v.push(h)}}}return v},l=g=>{if(!e)return;const v=g.id,I=e.control.textEditorManager.get(v),w=Tt.Doing,y=[g.offsetWidth,g.offsetHeight];(!I||I&&(!Pt.isEqual(I.opt.boxSize,y)||!Pt.isEqual(I.opt.workState,w)))&&i({activeTextId:v,update:{boxSize:y,workState:w},syncData:{canSync:!0,canWorker:!0}})},u=g=>{var v,I;if(!e)return;const w=a(g),y=g.id,T=e.control.textEditorManager.get(y),h=nn(w),m=Tt.Doing,d=[g.offsetWidth,g.offsetHeight];if(!T||T&&(T.opt.text!==h||!Pt.isEqual(T.opt.boxSize,d)||!Pt.isEqual(T.opt.workState,m))){const M=y&&Pt.cloneDeep(((v=e.control.textEditorManager)==null?void 0:v.get(y))||((I=n.editors)==null?void 0:I.get(y)));M&&M.opt&&(M.opt={...M.opt,text:h,boxSize:d,workState:m},M.canSync=!0,M.canWorker=!0,e.control.textEditorManager.updateForViewEdited(y,M)),e.control.textEditorManager.publicMsgEmitter.emit("textChange",y,g,w,M)}},p=(g,v)=>{if(!e)return;const I=g,w=e.control.textEditorManager.get(I);if(w&&!Pt.isEqual(w.opt.boxSize,v)){const y=Pt.cloneDeep(w);y.opt={...y.opt,boxSize:v},y.canSync=!1,y.canWorker=!1,e.control.textEditorManager.updateForViewEdited(I,y)}},c=g=>{r.current&&cancelAnimationFrame(r.current),r.current=requestAnimationFrame(()=>{t!=null&&t.current&&(t?.current.scrollTo({left:0,behavior:"instant"}),g&&g(),r.current=void 0)})};if((s=n.editors)!=null&&s.size){const g=[];return n.editors.forEach((v,I)=>{g.push(ut.createElement(hO,{key:I,workId:I,data:v,showFloatBtns:n.showFloatBtns||!1,handleFocus:l,handleKeyUp:u,updateSize:p,runAnimation:c,rightBoundBreak:n.rightBoundBreak||!1}))}),g}return null},[n.editors,n.showFloatBtns,n.rightBoundBreak,e,i]);return ut.createElement("div",{className:`${n.className}`,ref:t},o)},dO=()=>{const{floatBarData:n}=It.useContext(Me);return ut.createElement("div",{className:"appliance-plugin-hightlight-box",style:{borderColor:n?.selectorColor}},ut.createElement("div",{className:"point LT nwse-resize",style:{backgroundColor:n?.selectorColor}}),ut.createElement("div",{className:"point LC ew-resize",style:{backgroundColor:n?.selectorColor}}),ut.createElement("div",{className:"point LB nesw-resize",style:{backgroundColor:n?.selectorColor}}),ut.createElement("div",{className:"point TC ns-resize",style:{backgroundColor:n?.selectorColor}}),ut.createElement("div",{className:"point RT nesw-resize",style:{backgroundColor:n?.selectorColor}}),ut.createElement("div",{className:"point RC ew-resize",style:{backgroundColor:n?.selectorColor}}),ut.createElement("div",{className:"point RB nwse-resize",style:{backgroundColor:n?.selectorColor}}),ut.createElement("div",{className:"point BC ns-resize",style:{backgroundColor:n?.selectorColor}}))},pO=()=>{const{floatBarData:n,mananger:t}=It.useContext(Me),[e,r]=It.useState(),[i,o]=It.useState();It.useEffect(()=>{const l=[];if(t&&Pt.isNumber(n?.x)&&Pt.isNumber(n?.y)&&n!=null&&n.points){const u=t.viewId;if(t.control.viewContainerManager.getView(u))for(const p of n.points){const c=t.control.viewContainerManager.transformToOriginPoint(p,u);l.push(c)}l[0]&&r({x:l[0][0]-(n?.x||0),y:l[0][1]-(n?.y||0)}),l[1]&&o({x:l[1][0]-(n?.x||0),y:l[1][1]-(n?.y||0)})}},[t,n?.points,n?.x,n?.y]);const s=It.useMemo(()=>e?ut.createElement("div",{className:"point point-dot",style:{borderColor:n?.selectorColor,left:e.x,top:e.y}}):null,[n?.selectorColor,e]),a=It.useMemo(()=>i?ut.createElement("div",{className:"point point-dot",style:{borderColor:n?.selectorColor,left:i.x,top:i.y}}):null,[i,n?.selectorColor]);return ut.createElement("div",{className:"appliance-plugin-hightlight-box",style:{borderColor:n?.selectorColor}},s,a)},gO=()=>{const{floatBarData:n}=It.useContext(Me);return ut.createElement("div",{className:"appliance-plugin-hightlight-box",style:{borderColor:n?.selectorColor}},ut.createElement("div",{className:"point LT nwse-resize",style:{backgroundColor:n?.selectorColor}}),ut.createElement("div",{className:"point LB nesw-resize",style:{backgroundColor:n?.selectorColor}}),ut.createElement("div",{className:"point RT nesw-resize",style:{backgroundColor:n?.selectorColor}}),ut.createElement("div",{className:"point RB nwse-resize",style:{backgroundColor:n?.selectorColor}}))},mO=()=>{const{floatBarData:n}=It.useContext(Me);return ut.createElement("div",{className:"appliance-plugin-hightlight-box",style:{borderColor:n?.selectorColor}},ut.createElement("img",{className:"lock",alt:"lock",src:"https://sdk.netless.link/resource/icons/lock.svg"}))},vO=n=>{const{className:t}=n,{floatBarData:e,angle:r,setAngle:i,setOperationType:o,mananger:s}=It.useContext(Me),[a,l]=It.useState(Tt.Pending),[u,p]=It.useState(),[c,g]=It.useState(!1),[v,I]=It.useState(new Wt),[w,y]=It.useState(new Wt),[T,h]=It.useState(!1),m=It.useRef(0),d=It.useRef(null),M=N=>{if(!N){h(!0),g(!1),o(zt.None),l(Tt.Pending);return}h(!1)},x=(N,b)=>{m.current&&(clearTimeout(m.current),m.current=0),l(Tt.Done),g(!1);const j=Math.round(Wt.GetAngleByPoints(v,w,new Wt(b.x,b.y)))||0;i(j),o(zt.None),_t.emitMethod(Ht.MainEngine,zt.RotateNode,{workIds:[Xt],angle:j,workState:Tt.Done,viewId:s?.viewId})};It.useEffect(()=>(_t.activeListener(M),()=>{_t.unmountActiveListener(M)}),[]),It.useEffect(()=>{if(e&&(a===Tt.Pending||a===Tt.Done)){const N={x:e?.x-20,y:e?.y+e?.h},b={x:e?.x+e?.w/2,y:e?.y+e?.h/2};y(new Wt(b.x,b.y)),I(new Wt(N.x,N.y)),p({x:N.x,y:N.y})}},[e,a]);const E=(N,b)=>{if(s!=null&&s.control.worker.isBusy){h(!0),l(Tt.Pending);return}m.current&&(clearTimeout(m.current),m.current=0),l(Tt.Start),g(!0);const j=Math.round(Wt.GetAngleByPoints(v,w,new Wt(b.x,b.y)))||0;i(j),o(zt.RotateNode),_t.emitMethod(Ht.MainEngine,zt.RotateNode,{workIds:[Xt],angle:0,workState:Tt.Start,viewId:s?.viewId})},P=(N,b)=>{if(s!=null&&s.control.worker.isBusy){h(!0),x(N,b);return}x(N,b)},R=(N,b)=>{if(s!=null&&s.control.worker.isBusy){h(!0),x(N,b);return}m.current||(p({x:b.x,y:b.y}),g(!0),m.current=setTimeout(()=>{m.current=0;const j=Math.round(Wt.GetAngleByPoints(v,w,new Wt(b.x,b.y)))||0;i(j),o(zt.RotateNode),l(Tt.Doing),_t.emitMethod(Ht.MainEngine,zt.RotateNode,{workIds:[Xt],angle:j,workState:Tt.Doing,viewId:s?.viewId})},60))};return ut.createElement(Ji,{disabled:T,position:u,onStart:E,onDrag:R,onStop:P},ut.createElement("div",{className:`${t}`,style:e?{left:0,top:0,touchAction:"none"}:void 0},!c&&ut.createElement("div",{className:"appliance-plugin-rotate-btn",style:{backgroundColor:e?.selectorColor}},ut.createElement("img",{alt:"icon",src:Ue("rotation-button")})),ut.createElement("div",{ref:d,className:`appliance-plugin-rotate-mouse-pointer ${c?"active":""}`},ut.createElement("img",{alt:"icon",src:Ue("rotation")}),ut.createElement("div",{className:"angle-icon"},r,""))))},yO=n=>{const{editors:t,canSelectorSwitch:e}=n,{floatBarData:r,setOperationType:i,mananger:o,isNoPointerEvents:s}=It.useContext(Me),[a,l]=It.useState(),[u,p]=It.useState(!1),c=It.useRef(0),g=It.useRef(),v=It.useRef(Tt.Pending),I=It.useMemo(()=>!!(r?.scaleType===ee.none&&r!=null&&r.canLock),[r]),w=It.useMemo(()=>r&&r.w&&r.h?{position:"absolute",left:0,top:0,width:r.w,height:r.h,zIndex:2,pointerEvents:I||s?"none":"auto",touchAction:"none"}:{display:"none",pointerEvents:"none"},[r,I,s]),y=x=>{if(!x||r!=null&&r.isLocked){p(!0),v.current=Tt.Pending,i(zt.None);return}p(!1)},T=(x,E)=>{c.current&&(clearTimeout(c.current),c.current=0);const P={x:E.x,y:E.y};i(zt.None),v.current=Tt.Done,l(P),_t.emitMethod(Ht.MainEngine,zt.TranslateNode,{workIds:[Xt],position:P,workState:Tt.Done,viewId:o?.viewId})};It.useEffect(()=>(_t.activeListener(y),()=>{_t.unmountActiveListener(y)}),[]),It.useEffect(()=>{if(r&&r!=null&&r.isLocked||o!=null&&o.control.worker.isBusy){p(!0);return}p(!1)},[r,o?.control.worker.isBusy]),It.useEffect(()=>{(v.current===Tt.Pending||v.current===Tt.Done)&&Pt.isNumber(r?.x)&&Pt.isNumber(r?.y)&&l({x:r?.x,y:r?.y})},[r?.x,r?.y]);const h=()=>{if(o!=null&&o.control.worker.isBusy){p(!0);return}c.current&&(clearTimeout(c.current),c.current=0),Pt.isNumber(r?.x)&&Pt.isNumber(r?.y)&&(i(zt.TranslateNode),v.current=Tt.Start,_t.emitMethod(Ht.MainEngine,zt.TranslateNode,{workIds:[Xt],position:{x:r?.x,y:r?.y},workState:Tt.Start,viewId:o?.viewId}))},m=(x,E)=>{var P;o!=null&&o.control.worker.isBusy&&p(!0);const R=v.current,N=g.current;if(T(x,E),g.current&&(g.current=void 0),R===Tt.Start&&t!=null&&t.size&&N){const b=(P=o?.control.viewContainerManager.getView(o.viewId))==null?void 0:P.focusScenePath;b&&o?.control.worker.blurSelector(o.viewId,b)}},d=(x,E)=>{if(o!=null&&o.control.worker.isBusy){p(!0),T(x,E);return}if(c.current)return;const P={x:E.x,y:E.y};l(P),c.current=setTimeout(()=>{c.current=0,(P.x!==a?.x||P.y!==a?.y)&&(g.current&&(g.current=void 0),v.current=Tt.Doing,_t.emitMethod(Ht.MainEngine,zt.TranslateNode,{workIds:[Xt],position:P,workState:Tt.Doing,viewId:o?.viewId}))},60)},M=It.useMemo(()=>{if(t){const x=P=>{e&&(g.current=P)},E=()=>{o&&e&&v.current===Tt.Start&&g.current&&o.control.textEditorManager.active(g.current)};return ut.createElement(uO,{editors:t,selectIds:r?.selectIds||[],handleTextEditorPointerDown:x,handleTextEditorPointerUp:E})}return null},[t,r?.selectIds,o,e]);return ut.createElement(Ji,{disabled:u,position:a,onStart:h,onDrag:d,onStop:m},ut.createElement("div",{style:w},M))},MO=n=>{const{className:t}=n,[e,r]=It.useState({x:0,y:0,h:0,w:0}),[i,o]=It.useState(),[s,a]=It.useState(),[l,u]=It.useState(),{floatBarData:p,mananger:c,isNoPointerEvents:g,setOperationType:v}=It.useContext(Me),[I,w]=It.useState(),[y,T]=It.useState(!1),h=It.useRef(0);It.useEffect(()=>{if(p&&c){const b={x:p.x,y:p.y,w:p.w,h:p.h};r(b)}return _t.activeListener(d),()=>{_t.unmountActiveListener(d)}},[]),It.useEffect(()=>{if(c!=null&&c.control.worker.isBusy){T(!0);return}T(!1)},[c?.control.worker.isBusy]);const m=()=>{if(h.current&&(clearTimeout(h.current),h.current=0),I){const{scale:b,translate:j}=I;v(zt.None),_t.emitMethod(Ht.MainEngine,zt.ScaleNode,{workIds:[Xt],scale:b,dir:l,translate:j,originPoint:i,scenePoint:s,workState:Tt.Done,viewId:c?.viewId})}},d=b=>{if(!b){T(!0);return}T(!1)},M=b=>[[b.x,b.y],[b.x+b.w,b.y],[b.x+b.w,b.y+b.h],[b.x,b.y+b.h]],x=(b,j)=>{switch(j){case"top":case"topLeft":case"left":return b[2];case"topRight":return b[3];case"right":case"bottomRight":case"bottom":return b[0];case"bottomLeft":return b[1]}},E=(b,j,O,L)=>{let k=!1,H=!1;const Q={x:e.x,y:e.y,w:e.w,h:e.h},_=[1,1],st=[0,0];switch(b){case"top":{const tt=j.height+e.h;tt<0?(H=!0,Q.y=e.y+e.h,Q.h=Math.abs(tt)):(Q.y=e.y-j.height,Q.h=e.h+j.height);break}case"topLeft":{const tt=j.width+e.w;tt<0?(k=!0,Q.x=e.x+e.w,Q.w=Math.abs(tt)):(Q.x=e.x-j.width,Q.w=e.w+j.width);const ct=j.height+e.h;ct<0?(H=!0,Q.y=e.y+e.h,Q.h=Math.abs(ct)):(Q.y=e.y-j.height,Q.h=e.h+j.height);break}case"topRight":{const tt=j.width+e.w;tt<0?(k=!0,Q.x=e.x+tt,Q.w=Math.abs(tt)):Q.w=e.w+j.width;const ct=j.height+e.h;ct<0?(H=!0,Q.y=e.y+e.h,Q.h=Math.abs(ct)):(Q.y=e.y-j.height,Q.h=e.h+j.height);break}case"bottom":{const tt=j.height+e.h;tt<0?(H=!0,Q.y=e.y+tt,Q.h=Math.abs(tt)):Q.h=e.h+j.height;break}case"bottomLeft":{const tt=j.width+e.w;tt<0?(k=!0,Q.x=e.x+e.w,Q.w=Math.abs(tt)):(Q.x=e.x-j.width,Q.w=e.w+j.width);const ct=j.height+e.h;ct<0?(H=!0,Q.y=e.y+ct,Q.h=Math.abs(ct)):Q.h=e.h+j.height;break}case"left":{const tt=j.width+e.w;tt<0?(k=!0,Q.x=e.x+e.w,Q.w=Math.abs(tt)):(Q.x=e.x-j.width,Q.w=e.w+j.width);break}case"bottomRight":{const tt=j.width+e.w;tt<0?(k=!0,Q.x=e.x+tt,Q.w=Math.abs(tt)):Q.w=e.w+j.width;const ct=j.height+e.h;ct<0?(H=!0,Q.y=e.y+ct,Q.h=Math.abs(ct)):Q.h=e.h+j.height;break}case"right":{const tt=j.width+e.w;tt<0?(k=!0,Q.x=e.x+tt,Q.w=Math.abs(tt)):Q.w=e.w+j.width;break}}_[0]=Q.w/e.w,_[1]=Q.h/e.h;const F=M(Q).map(tt=>O.control.viewContainerManager.transformToScenePoint(tt,O.viewId)),Z=x(F,b);return H&&(st[1]=Z[1]-L[1]),k&&(st[0]=Z[0]-L[0]),{scale:_,translate:st}},P=(b,j)=>{if(h.current&&(clearTimeout(h.current),h.current=0),c!=null&&c.control.worker.isBusy){T(!0);return}if(p!=null&&p.w&&p!=null&&p.h&&c){const O={x:p.x,y:p.y,w:p.w,h:p.h},L=M(O),k=L.map(_=>c.control.viewContainerManager.transformToScenePoint(_,c.viewId)),H=x(L,j),Q=x(k,j);r(O),o(H),a(Q),u(j),v(zt.ScaleNode),_t.emitMethod(Ht.MainEngine,zt.ScaleNode,{workIds:[Xt],originPoint:H,scenePoint:Q,workState:Tt.Start,viewId:c.viewId})}},R=(b,j,O,L)=>{if(!(!c||!i||!s)){if(c!=null&&c.control.worker.isBusy){T(!0),m();return}h.current||(h.current=setTimeout(()=>{h.current=0;const{scale:k,translate:H}=E(j,L,c,s);(!Pt.isEqual(k,I?.scale)||!Pt.isEqual(H,I?.translate))&&(w({scale:k,translate:H}),v(zt.ScaleNode),_t.emitMethod(Ht.MainEngine,zt.ScaleNode,{workIds:[Xt],scale:k,dir:j,translate:H,originPoint:i,scenePoint:s,workState:Tt.Doing,viewId:c.viewId}))},60))}},N=()=>{c!=null&&c.control.worker.isBusy&&T(!0),m()};return ut.createElement(rT,{className:`${t}`,boundsByDirection:!0,minWidth:-((p?.x||0)+(p?.w||0)),minHeight:-((p?.y||0)+(p?.h||0)),size:{width:p?.w||0,height:p?.h||0},style:{position:"absolute",left:p?.x,top:p?.y,pointerEvents:g?"none":"auto"},enable:y?!1:{top:p?.scaleType===ee.all&&!0||!1,right:p?.scaleType===ee.all&&!0||!1,bottom:p?.scaleType===ee.all&&!0||!1,left:p?.scaleType===ee.all&&!0||!1,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0},lockAspectRatio:p?.scaleType===ee.proportional,onResizeStart:P,onResize:R,onResizeStop:N})},xd=n=>{const{id:t,pos:e,pointMap:r,type:i}=n,{setOperationType:o,mananger:s,floatBarData:a}=It.useContext(Me),[l,u]=It.useState({x:0,y:0}),[p,c]=It.useState(Tt.Pending),[g,v]=It.useState(!1),I=It.useRef(0),w=It.useMemo(()=>a?{left:0,top:0}:{},[a]),y=M=>{if(!M||a!=null&&a.isLocked){v(!0),c(Tt.Pending),o(zt.None);return}v(!1)};It.useEffect(()=>(_t.activeListener(y),()=>{_t.unmountActiveListener(y)}),[]),It.useEffect(()=>{Pt.isNumber(e.x)&&Pt.isNumber(e.y)&&(p===Tt.Pending||p===Tt.Done)&&u({x:e.x,y:e.y})},[e,p]),It.useEffect(()=>{if(a&&a!=null&&a.isLocked||s!=null&&s.control.worker.isBusy){v(!0);return}v(!1)},[a,s?.control.worker.isBusy]);const T=(M,x)=>{I.current&&(clearTimeout(I.current),I.current=0),o(zt.None),c(Tt.Done);const E={x:x.x,y:x.y};if(u(E),s!=null&&s.control.viewContainerManager){const P=s.control.viewContainerManager.transformToScenePoint([E.x,E.y],s.viewId),R=r.get(t);R&&i==="start"?R[0]=P:R&&i==="end"&&(R[1]=P),_t.emitMethod(Ht.MainEngine,zt.SetPoint,{workId:Xt,pointMap:r,workState:Tt.Done,viewId:s?.viewId})}},h=()=>{if(I.current&&(clearTimeout(I.current),I.current=0),s!=null&&s.control.worker.isBusy){v(!0);return}Pt.isNumber(e.x)&&Pt.isNumber(e.y)&&(o(zt.SetPoint),c(Tt.Start),_t.emitMethod(Ht.MainEngine,zt.SetPoint,{workId:Xt,pointMap:r,workState:Tt.Start,viewId:s?.viewId}))},m=(M,x)=>{if(s!=null&&s.control.worker.isBusy){v(!0),T(M,x);return}if(I.current)return;const E={x:x.x,y:x.y};u(E),I.current=setTimeout(()=>{if(I.current=0,(E.x!==x?.x||E.y!==x?.y)&&s!=null&&s.control.viewContainerManager){const P=s.control.viewContainerManager.transformToScenePoint([E.x,E.y],s.viewId),R=r.get(t);R&&i==="start"?R[0]=P:R&&i==="end"&&(R[1]=P),c(Tt.Doing),_t.emitMethod(Ht.MainEngine,zt.SetPoint,{workId:Xt,pointMap:r,workState:Tt.Doing,viewId:s?.viewId})}},60)},d=(M,x)=>{s!=null&&s.control.worker.isBusy&&v(!0),T(M,x)};return ut.createElement(Ji,{disabled:g,position:l,onStart:h,onDrag:m,onStop:d},ut.createElement("div",{className:"appliance-plugin-point-draggable-btn",style:w}))},TO=n=>{const{className:t}=n,{floatBarData:e,mananger:r}=It.useContext(Me),[i,o]=It.useState(),[s,a]=It.useState(),[l,u]=It.useState(new Map);It.useEffect(()=>{const g=[];if(r&&e!=null&&e.points){const v=r.viewId;if(r.control.viewContainerManager.getView(v))for(const I of e.points){const w=r.control.viewContainerManager.transformToOriginPoint(I,v);g.push(w)}e!=null&&e.selectIds&&e.selectIds.length===1&&(l.set(e.selectIds[0],e.points),u(l))}g[0]&&o({x:g[0][0],y:g[0][1]}),g[1]&&a({x:g[1][0],y:g[1][1]})},[r,e?.points,e?.selectIds,l]);const p=It.useMemo(()=>i&&e!=null&&e.selectIds?ut.createElement(xd,{pos:i,type:"start",id:e.selectIds[0],pointMap:l}):null,[i,e?.selectIds,l]),c=It.useMemo(()=>s&&e!=null&&e.selectIds?ut.createElement(xd,{pos:s,type:"end",id:e.selectIds[0],pointMap:l}):null,[s,e?.selectIds,l]);return ut.createElement("div",{className:`${t}`},p,c)},IO=ut.forwardRef((n,t)=>{const{floatBarData:e,operationType:r}=It.useContext(Me),i=It.useMemo(()=>e?.scaleType!==ee.all||r===zt.RotateNode?null:ut.createElement(dO,null),[e,r]),o=It.useMemo(()=>e?.scaleType!==ee.both||r===zt.RotateNode?null:ut.createElement(pO,null),[e,r]),s=It.useMemo(()=>e?.scaleType!==ee.proportional||r===zt.RotateNode?null:ut.createElement(gO,null),[e,r]),a=It.useMemo(()=>e?.scaleType===ee.none&&e!=null&&e.canLock?ut.createElement(mO,null):null,[e]);return ut.createElement("div",{ref:t,style:e?{transform:`translate(${e.x}px,${e.y}px)`,width:e.w,height:e.h,pointerEvents:"none"}:void 0},a,i,o,s,n.children)}),wO=ut.forwardRef((n,t)=>{const{floatBarData:e,operationType:r,mananger:i}=It.useContext(Me),{editors:o,isHide:s,canSelectorSwitch:a}=n,l=It.useMemo(()=>{var g;return e!=null&&e.canRotate&&((g=e?.selectIds)==null?void 0:g.length)===1&&(r===zt.None||r===zt.RotateNode)?ut.createElement(vO,{className:Fe.RotateBtn}):null},[e,r]),u=It.useMemo(()=>(e?.scaleType===ee.all||e?.scaleType===ee.proportional)&&(r===zt.None||r===zt.ScaleNode)&&Pt.isNumber(e?.x)&&Pt.isNumber(e?.y)?ut.createElement(MO,{className:Fe.ResizeBtn}):null,[e?.scaleType,r,e?.x,e?.y]),p=It.useMemo(()=>e?.scaleType===ee.both&&(r===zt.None||r===zt.SetPoint)?ut.createElement(TO,{className:Fe.ResizeTowBox}):null,[e?.scaleType,r]),c=It.useMemo(()=>s&&r===zt.None&&Pt.isNumber(e?.x)&&Pt.isNumber(e?.y)&&Pt.isNumber(e?.w)&&Pt.isNumber(e?.h)?ut.createElement("div",{className:Fe.FloatBarBtn,style:{left:e?.x,top:e?.y,width:e.w,height:e.h}},ut.createElement(Ev,{position:{x:e.x,y:e.y},textOpt:e?.textOpt,noLayer:e?.isLocked})):null,[e?.x,e?.y,e?.w,e?.h,e?.textOpt,e?.isLocked,r,s]);return ut.createElement("div",{className:Fe.FloatBar,onPointerOver:g=>(os(g),i?.control.worker.blurCursor(i.viewId),!1)},ut.createElement(IO,{ref:t}),ut.createElement(yO,{editors:o,canSelectorSwitch:a}),l,u,p,c)}),SO=ut.memo(wO,(n,t)=>!!Pt.isEqual(n,t));class xO extends ut.Component{constructor(t){super(t),G(this,"renderAvatar",e=>{var r;const i=`rgb(${e.memberState.strokeColor[0]}, ${e.memberState.strokeColor[1]}, ${e.memberState.strokeColor[2]})`;if(this.detectAvatar(e)){const o=this.getCursorName(e);return ut.createElement("img",{className:"cursor-selector-avatar",style:{width:o?19:28,height:o?19:28,position:o?"initial":"absolute",borderColor:o?"white":i,marginRight:o?4:0},src:(r=e.payload)==null?void 0:r.avatar,alt:"avatar"})}else return null}),G(this,"getOpacity",e=>{const r=this.getCursorName(e),i=this.detectAvatar(e);return r===void 0&&i===void 0?0:1}),G(this,"getCursorName",e=>{if(e.payload)return e.payload.nickName||e.payload.cursorName||e.payload.uid}),G(this,"getThemeClass",e=>e.payload&&e.payload.theme?"cursor-inner-mellow":"cursor-inner"),G(this,"getCursorBackgroundColor",e=>{const r=this.getCursorName(e);return e.payload&&e.payload.cursorBackgroundColor?e.payload.cursorBackgroundColor:r?`rgb(${e.memberState.strokeColor[0]}, ${e.memberState.strokeColor[1]}, ${e.memberState.strokeColor[2]})`:void 0}),G(this,"getCursorTextColor",e=>e.payload&&e.payload.cursorTextColor?e.payload.cursorTextColor:"#FFFFFF"),G(this,"getCursorTagBackgroundColor",e=>e.payload&&e.payload.cursorTagBackgroundColor?e.payload.cursorTagBackgroundColor:this.getCursorBackgroundColor(e)),G(this,"detectAvatar",e=>!!(e.payload&&e.payload.avatar)),G(this,"renderTag",e=>{if(e.payload&&e.payload.cursorTagName)return ut.createElement("span",{className:"cursor-tag-name",style:{backgroundColor:this.getCursorTagBackgroundColor(e)}},e.payload.cursorTagName)}),G(this,"renderCursor",e=>{const r=ZL.get(e);return r&&this.props.isEnableCursor?ut.createElement("img",{className:`cursor-${e}-image`,src:r,alt:`${e}Cursor`}):null})}render(){const{roomMember:t}=this.props,e=this.getCursorName(t);switch(t.memberState.currentApplianceName){case Jt.pencil:return ut.createElement("div",{className:"cursor-box"},ut.createElement("div",{className:"cursor-mid cursor-pencil-offset",style:{transform:"translate(-50%, -100%)",marginLeft:"5px",marginTop:"4px"}},ut.createElement("div",{className:"cursor-name"},ut.createElement("div",{style:{opacity:this.getOpacity(t),backgroundColor:this.getCursorBackgroundColor(t),color:this.getCursorTextColor(t)},className:this.getThemeClass(t)},this.renderAvatar(t),ut.createElement("span",{className:"cursor-name-text"},e),this.renderTag(t))),ut.createElement("div",null,this.renderCursor("pencil"))));case Jt.selector:return ut.createElement("div",{className:"cursor-box"},ut.createElement("div",{className:"cursor-mid cursor-selector-offset",style:{transform:"translate(-50%, -100%)",marginLeft:"3px",marginTop:"17px"}},ut.createElement("div",{className:"cursor-name"},ut.createElement("div",{style:{opacity:this.getOpacity(t),backgroundColor:this.getCursorBackgroundColor(t),color:this.getCursorTextColor(t)},className:this.getThemeClass(t)},this.renderAvatar(t),ut.createElement("span",{className:"cursor-name-text"},e),this.renderTag(t))),ut.createElement("div",null,this.renderCursor("selector"))));case Jt.eraser:case Jt.pencilEraser:return ut.createElement("div",{className:"cursor-box"},ut.createElement("div",{className:"cursor-mid cursor-eraser-offset",style:{transform:"translate(-50%, -100%)",marginLeft:"2px",marginTop:"8px"}},ut.createElement("div",{className:"cursor-name"},ut.createElement("div",{style:{opacity:this.getOpacity(t),backgroundColor:this.getCursorBackgroundColor(t),color:this.getCursorTextColor(t)},className:this.getThemeClass(t)},this.renderAvatar(t),ut.createElement("span",{className:"cursor-name-text"},e),this.renderTag(t))),ut.createElement("div",null,this.renderCursor("eraser"))));case Jt.text:return ut.createElement("div",{className:"cursor-box"},ut.createElement("div",{className:"cursor-mid cursor-text-offset",style:{transform:"translate(-50%, -100%)",marginLeft:"0px"}},ut.createElement("div",{className:"cursor-name"},ut.createElement("div",{style:{opacity:this.getOpacity(t),backgroundColor:this.getCursorBackgroundColor(t),color:this.getCursorTextColor(t)},className:this.getThemeClass(t)},this.renderAvatar(t),ut.createElement("span",{className:"cursor-name-text"},e),this.renderTag(t))),ut.createElement("div",null,this.renderCursor("text"))));case Jt.rectangle:case Jt.arrow:case Jt.straight:case Jt.shape:case Jt.ellipse:return ut.createElement("div",{className:"cursor-box"},ut.createElement("div",{className:"cursor-mid cursor-shape-offset",style:{transform:"translate(-50%, -100%)",marginLeft:"-3px",marginTop:"19px"}},ut.createElement("div",{className:"cursor-name"},ut.createElement("div",{style:{opacity:this.getOpacity(t),backgroundColor:this.getCursorBackgroundColor(t),color:this.getCursorTextColor(t)},className:this.getThemeClass(t)},this.renderAvatar(t),ut.createElement("span",{className:"cursor-name-text"},e),this.renderTag(t))),ut.createElement("div",null,this.renderCursor("shape"))));default:return null}}}const CO=n=>{var t;const{className:e,info:r,isEnableCursor:i}=n,{roomMember:o,...s}=r||{};return ut.createElement("div",{"data-cursor-uid":(t=o?.payload)==null?void 0:t.uid,className:`${e}`,style:s?{transform:`translate(${s.x}px, ${s.y}px)`}:{display:"none"}},o&&ut.createElement(xO,{roomMember:o,isEnableCursor:i}))},EO=n=>{const{className:t,manager:e}=n,[r,i]=It.useState();It.useEffect(()=>(e.internalMsgEmitter.on([Ht.Cursor,e.viewId],o),()=>{e.internalMsgEmitter.off([Ht.Cursor,e.viewId],o)}),[e]);function o(s){i(s)}return It.useMemo(()=>{if(r!=null&&r.length){const s=r.map(a=>{var l;return a.roomMember?ut.createElement(CO,{key:(l=a.roomMember)==null?void 0:l.memberId,className:t,info:a,isEnableCursor:e.control.cursor.isEnableCursor}):null});return ut.createElement(ut.Fragment,null,s)}return null},[r])},PO=n=>{const{viewId:t,miniMapCanvas:e,highlightColor:r,miniMapManager:i,contianer:o}=n,[s,a]=It.useState();It.useEffect(()=>(l(),i.listener.addListener([t,"viewCameraUpate"],l),i.listener.emitAsync([t,"miniMapCreate"],!0),()=>{i.listener.removeListener([t,"viewCameraUpate"],l)}),[]);const l=()=>{const c=i.maps.get(t);c&&u(c.miniMapCamera,c.viewCamera)},u=(c,g)=>{const{width:v,height:I}=o.getBoundingClientRect(),w=Math.min(v/c.width,I/c.height),y=g.width/g.scale,T=g.height/g.scale,h=[g.centerX,g.centerY],m=[c.centerX,c.centerY],d=[h[0]-m[0],h[1]-m[1]],M=Math.min(c.scale*w,c.scale*w),x=[d[0]*M,d[1]*M,y,T,M];a(x)},p=c=>{var g;if(i.control.renderControl.isWritable){const v=c.nativeEvent.target||c.nativeEvent.srcElement;if(v&&c.nativeEvent&&s){const{width:I,height:w}=v.getBoundingClientRect(),[y,T]=[I/2,w/2],[h,m]=[(c.nativeEvent.offsetX-y)/s[4],(c.nativeEvent.offsetY-T)/s[4]],d=i.maps.get(t);if(d!=null&&d.viewCamera){const[M,x]=[d.miniMapCamera.centerX+h,d.miniMapCamera.centerY+m];(g=i.control.room)==null||g.moveCamera({centerX:M,centerY:x,animationMode:"immediately"})}}}};return ut.createElement("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",pointerEvents:"auto"},onClick:p},ut.createElement("canvas",{style:{pointerEvents:"none"},ref:e}),s&&ut.createElement("div",{className:"minimap-highlightBox",style:{position:"absolute",top:"50%",left:"50%",width:s[2]*s[4],height:s[3]*s[4],boxSizing:"content-box",border:`2px solid ${r}`,transform:`translate(calc(-50% + ${s[0]}px), calc(-50% + ${s[1]}px))`,pointerEvents:"none"}}))},NO=n=>{const{miniMapManager:t,active:e,className:r}=n,i=It.useMemo(()=>{const o=t.maps;if(e){const s=o.get(e);if(s){const{miniMapCamera:a,viewCamera:l,...u}=s;if(u.contianer&&a&&l){const p=t.highlightColor;return im.createPortal(ut.createElement(PO,{viewId:e,...u,highlightColor:p,miniMapManager:t}),u.contianer)}}}return null},[e,t]);return ut.createElement("div",{className:r},i)},Me=ut.createContext({viewId:"",mananger:void 0,floatBarColors:[],floatBarData:void 0,dpr:1,angle:0,operationType:zt.None,scale:[1,1],isNoPointerEvents:!1,activeTextEditor:!1,activeTextId:void 0,setAngle:()=>{},setOperationType:()=>{},setFloatBarData:()=>{}});class dh extends ut.Component{constructor(t){var e,r;super(t),G(this,"showTextFloatBar"),G(this,"canSelectorSwitch"),G(this,"rightBoundBreak"),G(this,"setAngle",o=>{this.setState({angle:o})}),G(this,"setOperationType",o=>{this.setState({operationType:o})}),this.state={floatBarData:void 0,showFloatBar:!1,showFloatBarBtn:!0,dpr:1,angle:0,operationType:zt.None,scale:[1,1],editors:this.editors,activeTextId:(e=this.props.mananger.control.textEditorManager)==null?void 0:e.activeId,activeMiniMapViewId:(r=this.props.mananger.control.miniMapManager)==null?void 0:r.activeViewId};const i=this.props.mananger.control.pluginOptions.extras.textEditor;this.showTextFloatBar=Pt.isBoolean(i.showFloatBar)?i.showFloatBar:me.textEditor.showFloatBar,this.canSelectorSwitch=Pt.isBoolean(i?.canSelectorSwitch)?i.canSelectorSwitch:me.textEditor.canSelectorSwitch,this.rightBoundBreak=Pt.isBoolean(i?.rightBoundBreak)?i.rightBoundBreak:me.textEditor.rightBoundBreak}get editors(){return ze(this.props.mananger.control.textEditorManager.filterEditor(this.props.mananger.viewId))}componentDidMount(){this.props.mananger.vDom=this,this.props.mananger.mountView(),this.setState({dpr:this.props.mananger.dpr})}componentWillUnmount(){}setActiveMiniMap(t){this.setState({activeMiniMapViewId:t})}showFloatBarBtn(t){this.setState({showFloatBarBtn:t})}showFloatBar(t,e){const r=t&&e&&{...this.state.floatBarData,...e}||void 0;this.setState({showFloatBar:t,floatBarData:r,angle:0})}activeTextEditor(){this.setState({activeTextEditor:!0})}unActiveTextEditor(){this.setState({activeTextEditor:!1})}updateTextEditorInfo(t){this.setState({activeTextId:t,editors:this.editors})}setFloatBarData(t){this.state.floatBarData&&this.setState({floatBarData:{...this.state.floatBarData,...t}})}render(){var t,e,r,i,o,s;const a=!!((e=(t=this.props.mananger.control)==null?void 0:t.room)!=null&&e.floatBarOptions);return ut.createElement("div",{className:Fe.Container},!this.props.mananger.control.hasOffscreenCanvas()&&ut.createElement("div",{className:Fe.CanvasBox,ref:this.props.refs.canvasContainerRef})||ut.createElement("div",{className:Fe.CanvasBox},ut.createElement("canvas",{id:"bgCanvas",ref:this.props.refs.canvasBgRef,style:{width:"100%",height:"100%"}}),ut.createElement("canvas",{id:"serviceCanvas",className:Fe.FloatCanvas,ref:this.props.refs.canvasServiceFloatRef,style:{width:"100%",height:"100%"}}),ut.createElement("canvas",{id:"localCanvas",className:Fe.FloatCanvas,ref:this.props.refs.canvasFloatRef,style:{width:"100%",height:"100%"}}),ut.createElement("div",{id:"subLocalCanvas",className:Fe.CanvasBoxSub,ref:this.props.refs.subLocalCanvasContainerRef}),ut.createElement("canvas",{id:"topCanvas",className:Fe.TopFloatCanvas,ref:this.props.refs.canvasTopRef,style:{width:"100%",height:"100%"}})),!this.props.mananger.control.hasOffscreenCanvas()&&this.props.refs.snapshotContainerRef&&ut.createElement("div",{className:Fe.SnapshotBox,ref:this.props.refs.snapshotContainerRef})||null,ut.createElement(Me.Provider,{value:{viewId:this.props.viewId,mananger:this.props.mananger,floatBarColors:a&&((o=(i=(r=this.props.mananger.control)==null?void 0:r.room)==null?void 0:i.floatBarOptions)==null?void 0:o.colors)||[],isNoPointerEvents:!this.state.showFloatBarBtn,floatBarData:this.state.floatBarData,dpr:this.state.dpr,angle:this.state.angle,operationType:this.state.operationType,scale:this.state.scale,activeTextEditor:this.state.activeTextEditor,activeTextId:this.state.activeTextId,setAngle:this.setAngle.bind(this),setOperationType:this.setOperationType.bind(this),setFloatBarData:this.setFloatBarData.bind(this)}},this.state.showFloatBar&&ut.createElement(SO,{ref:this.props.refs.floatBarRef,editors:this.state.editors,isHide:a&&this.state.showFloatBarBtn,canSelectorSwitch:this.canSelectorSwitch})||null,((s=this.state.editors)==null?void 0:s.size)&&ut.createElement(fO,{className:Fe.TextEditorContainer,showFloatBtns:this.showTextFloatBar&&a&&this.state.showFloatBarBtn||!1,editors:this.state.editors,rightBoundBreak:this.rightBoundBreak})||null),ut.createElement(EO,{className:Fe.CursorBox,manager:this.props.mananger}),ut.createElement(NO,{className:Fe.MiniMapBox,active:this.state.activeMiniMapViewId,miniMapManager:this.props.mananger.control.miniMapManager}))}}class AO extends xv{constructor(t,e){super(t,e),G(this,"width",1e3),G(this,"height",1e3),G(this,"dpr",pr()),G(this,"vDom"),G(this,"eventTragetElement"),G(this,"snapshotContainerRef"),G(this,"canvasContainerRef",ut.createRef()),G(this,"subLocalCanvasContainerRef",ut.createRef()),G(this,"canvasTopRef",ut.createRef()),G(this,"canvasServiceFloatRef",ut.createRef()),G(this,"canvasFloatRef",ut.createRef()),G(this,"canvasBgRef",ut.createRef()),G(this,"floatBarRef",ut.createRef()),G(this,"containerOffset",{x:0,y:0}),this.control.hasOffscreenCanvas()||(this.snapshotContainerRef=ut.createRef())}setCanvassStyle(){if(this.eventTragetElement){const t=this.eventTragetElement.offsetWidth||this.width,e=this.eventTragetElement.offsetHeight||this.height;let r=pr();this.canvasBgRef.current&&(r=pr(this.canvasBgRef.current.getContext("2d"))),r!==this.dpr&&(this.dpr=r,this.control.worker.updateDpr(this.viewId,this.dpr)),t&&e&&this.canvasContainerRef.current&&(t!==this.width||e!==this.height)&&(this.width=t,this.height=e,this.canvasContainerRef.current.style.width=`${t}px`,this.canvasContainerRef.current.style.height=`${e}px`),t&&e&&this.snapshotContainerRef&&this.snapshotContainerRef.current&&(t!==this.width||e!==this.height)&&(this.width=t,this.height=e),t&&e&&this.canvasBgRef.current&&(t!==this.width||e!==this.height)&&(this.width=t,this.height=e,this.canvasBgRef.current.width=t*this.dpr,this.canvasBgRef.current.height=e*this.dpr,this.canvasFloatRef.current&&(this.canvasFloatRef.current.width=t*this.dpr,this.canvasFloatRef.current.height=e*this.dpr),this.canvasServiceFloatRef.current&&(this.canvasServiceFloatRef.current.width=t*this.dpr,this.canvasServiceFloatRef.current.height=e*this.dpr),this.canvasTopRef.current&&(this.canvasTopRef.current.width=t*this.dpr,this.canvasTopRef.current.height=e*this.dpr))}}destroy(){if(super.destroy(),this.eventTragetElement){const t=this.eventTragetElement.parentElement;if(t){const e=t.querySelectorAll(".appliance-plugin-main-view-displayer");for(const r of e)r.remove()}}}createMainViewDisplayer(t){const e=document.createElement("div");return e.className="appliance-plugin-main-view-displayer",t.appendChild(e),this.eventTragetElement=t.children[0],this.containerOffset=this.getContainerOffset(this.eventTragetElement,this.containerOffset),this.bindToolsClass(),Vc.render(ut.createElement(dh,{viewId:this.viewId,mananger:this,refs:{canvasServiceFloatRef:this.canvasServiceFloatRef,canvasFloatRef:this.canvasFloatRef,canvasBgRef:this.canvasBgRef,floatBarRef:this.floatBarRef,canvasTopRef:this.canvasTopRef,canvasContainerRef:this.canvasContainerRef,snapshotContainerRef:this.snapshotContainerRef,subLocalCanvasContainerRef:this.subLocalCanvasContainerRef}}),e),this.control.room&&this.bindDisplayerEvent(this.eventTragetElement),this}}class DO extends ML{constructor(t,e,r){super(t,e,r),G(this,"dpr",pr()),G(this,"width",1e3),G(this,"height",1e3),G(this,"vDom"),G(this,"eventTragetElement"),G(this,"canvasContainerRef",ut.createRef()),G(this,"subLocalCanvasContainerRef",ut.createRef()),G(this,"canvasTopRef",ut.createRef()),G(this,"canvasServiceFloatRef",ut.createRef()),G(this,"canvasFloatRef",ut.createRef()),G(this,"canvasBgRef",ut.createRef()),G(this,"floatBarRef",ut.createRef()),G(this,"containerOffset",{x:0,y:0})}setCanvassStyle(){if(this.eventTragetElement){let t=pr();if(this.canvasBgRef.current&&(t=pr(this.canvasBgRef.current.getContext("2d"))),t!==this.dpr&&(this.dpr=t,this.control.worker.updateDpr(this.viewId,this.dpr)),this.canvasContainerRef.current){const e=this.eventTragetElement.offsetWidth||this.width,r=this.eventTragetElement.offsetHeight||this.height;e&&r&&(e!==this.width||r!==this.height)&&(this.width=e,this.height=r,this.canvasContainerRef.current.style.width=`${e}px`,this.canvasContainerRef.current.style.height=`${r}px`)}if(this.canvasBgRef.current){const e=this.eventTragetElement.offsetWidth||this.width,r=this.eventTragetElement.offsetHeight||this.height;e&&r&&(e!==this.width||r!==this.height)&&(this.width=e,this.height=r,this.canvasBgRef.current.width=e*this.dpr,this.canvasBgRef.current.height=r*this.dpr,this.canvasFloatRef.current&&(this.canvasFloatRef.current.width=e*this.dpr,this.canvasFloatRef.current.height=r*this.dpr),this.canvasServiceFloatRef.current&&(this.canvasServiceFloatRef.current.width=e*this.dpr,this.canvasServiceFloatRef.current.height=r*this.dpr),this.canvasTopRef.current&&(this.canvasTopRef.current.width=e*this.dpr,this.canvasTopRef.current.height=r*this.dpr))}}}createAppViewDisplayer(t,e){const r=document.createElement("div");return r.className="appliance-plugin-app-view-displayer",e.appendChild(r),this.eventTragetElement=e.children[0],this.containerOffset=this.getContainerOffset(this.eventTragetElement,this.containerOffset),this.bindToolsClass(),Vc.render(ut.createElement(dh,{viewId:t,mananger:this,refs:{canvasServiceFloatRef:this.canvasServiceFloatRef,canvasFloatRef:this.canvasFloatRef,canvasBgRef:this.canvasBgRef,floatBarRef:this.floatBarRef,canvasTopRef:this.canvasTopRef,canvasContainerRef:this.canvasContainerRef,subLocalCanvasContainerRef:this.subLocalCanvasContainerRef}}),r),this.control.room&&this.bindDisplayerEvent(this.eventTragetElement),this}}class In extends bo{constructor(t){super(t),G(this,"focuedViewId"),G(this,"focuedView"),G(this,"control"),G(this,"tmpFocusedViewId"),G(this,"checkScaleTimer"),G(this,"onMainViewRelease",async e=>{this.control.textEditorManager.clear(ce,!0),this.mainViewDestroy(e),await new Promise(i=>{setTimeout(()=>{i(!0)},0)}),this.onMainViewMounted(e);const r=this.control.getSnapshootData("memberState");this.control.room&&this.control.onMemberChange(r),this.control.clearSnapshootData()}),G(this,"mainViewDestroy",e=>{var r;if(this.mainView&&this.mainView.displayer){this.mainView.displayer.destroy();const i=e.divElement;if(i){const o=i.getElementsByClassName("appliance-plugin-main-view-displayer");for(const s of o)s.remove()}if(this.mainView.container&&i!==this.mainView.container){const o=this.mainView.container.getElementsByClassName("appliance-plugin-main-view-displayer");for(const s of o)s.remove()}(r=this.control.worker)==null||r.destroyViewWorker(this.mainView.id,!0),this.mainView.displayer.destroy(),this.mainView=void 0}}),G(this,"onMainViewMounted",e=>{const r=e.divElement;if(!r||!e.focusScenePath||!(e.focusScenePath||e.scenePath))return;const i=new AO(this.control,We.InternalMsgEmitter),o=e.size.width||i.width,s=e.size.height||i.height,a={dpr:i.dpr,offscreenCanvasOpt:{...In.defaultScreenCanvasOpt},layerOpt:{...In.defaultLayerOpt},cameraOpt:{...In.defaultCameraOpt,width:o,height:s}},{scale:l,...u}=e.camera;a.cameraOpt={...a.cameraOpt,...u,scale:l===1/0?1:l},this.createMianView({id:ce,container:r,displayer:i,focusScenePath:e.focusScenePath,cameraOpt:a.cameraOpt,viewData:e}),this.setFocuedViewId(ce),i.createMainViewDisplayer(r),e.callbacks.on("onSizeUpdated",this.onMainViewSizeUpdated),e.callbacks.on("onCameraUpdated",this.onMainViewCameraUpdated),e.callbacks.on("onActiveHotkey",this.onActiveHotkeyChange.bind(this))}),G(this,"onMainViewSizeUpdated",async()=>{await new Promise(e=>{setTimeout(()=>{e(!0)},0)}),this.mainView&&this.mainView.viewData&&this.updateMainViewCamera()}),G(this,"onMainViewCameraUpdated",async()=>{await new Promise(e=>{setTimeout(()=>{e(!0)},0)}),this.updateMainViewCamera()}),G(this,"updateMainViewCamera",()=>{if(this.mainView&&this.mainView.viewData){const e=this.mainView.viewData.camera,r=this.mainView.cameraOpt;if(r){const i=r.width,o=r.height,{width:s,height:a}=this.mainView.viewData.size;(s!==i||a!==o)&&this.mainView.displayer.updateSize();const l=e.scale===1/0?1:e.scale,u=e.centerX||0,p=e.centerY||0,c={...r,scale:l,centerX:u,centerY:p,width:s,height:a};Pt.isEqual(r,c)||(this.mainView.cameraOpt=c),this.checkScaleTimer&&e.scale==1/0&&(clearTimeout(this.checkScaleTimer),this.checkScaleTimer=void 0),!this.checkScaleTimer&&e.scale===1/0&&this.mainView.viewData&&this.mainView.viewData.camera.scale===1/0&&(this.checkScaleTimer=setTimeout(()=>{var g,v;(v=(g=this.mainView)==null?void 0:g.viewData)==null||v.moveCamera({scale:l,centerX:u,centerY:p,animationMode:"immediately"}),this.checkScaleTimer=void 0},500))}}}),G(this,"onAppViewMounted",async e=>{var r;const{appId:i,view:o}=e,s=o.divElement;if(!s||!o.focusScenePath)return;const a=this.appViews.get(i);if(a&&a.displayer){let g=s.getElementsByClassName("appliance-plugin-app-view-displayer");for(const v of g)v.remove();if(a.container&&a.container!==s){g=a.container.getElementsByClassName("appliance-plugin-app-view-displayer");for(const v of g)v.remove()}this.destroyAppView(e.appId,!0),(r=this.control.worker)==null||r.destroyViewWorker(i,!0),await new Promise(v=>{setTimeout(()=>{v(!0)},0)})}const l=new DO(i,this.control,We.InternalMsgEmitter),u=o.size.width||l.width,p=o.size.height||l.height,c={dpr:l.dpr,offscreenCanvasOpt:{...In.defaultScreenCanvasOpt},layerOpt:{...In.defaultLayerOpt},cameraOpt:{...In.defaultCameraOpt,...o.camera,width:u,height:p}};if(this.createAppView({id:i,container:s,displayer:l,cameraOpt:c.cameraOpt,focusScenePath:o.focusScenePath,viewData:o}),l.createAppViewDisplayer(i,s),o.callbacks.on("onSizeUpdated",this.onAppViewSizeUpdated.bind(this,i)),o.callbacks.on("onCameraUpdated",this.onAppViewCameraUpdated.bind(this,i)),o.callbacks.on("onActiveHotkey",this.onActiveHotkeyChange.bind(this)),this.tmpFocusedViewId===i){const g=this.control.worker.getLocalWorkViewId();g&&g!==i?this.setFocuedViewId(g):this.setFocuedViewId(i),this.tmpFocusedViewId=void 0}setTimeout(()=>{this.onAppViewCameraUpdated(i)},0)}),G(this,"onAppViewSizeUpdated",async e=>{await new Promise(i=>{setTimeout(()=>{i(!0)},0)});const r=this.appViews.get(e);r&&r.viewData&&this.updateAppCamera(e)}),G(this,"onAppViewCameraUpdated",async e=>{await new Promise(r=>{setTimeout(()=>{r(!0)},0)}),this.updateAppCamera(e)}),G(this,"updateAppCamera",e=>{const r=this.appViews.get(e);if(r&&r.viewData){const i=r.viewData.camera,o=r.cameraOpt;if(o){const{width:s,height:a}=r.viewData.size,l=o.width,u=o.height;(s!==l||a!==u)&&r.displayer.updateSize();const p=i.scale===1/0?1:i.scale,c=i.centerX||0,g=i.centerY||0,v={...o,scale:p,centerX:c,centerY:g,width:s,height:a};Pt.isEqual(v,o)||(r.cameraOpt=v)}}}),this.control=t.control}getViewInitData(t){var e;const r=this.getView(t);if(r){const{width:i,height:o,dpr:s}=r.displayer;(e=this.control.pluginOptions.extras.canvasOpt)!=null&&e.contextType&&(In.defaultScreenCanvasOpt.contextType=this.control.pluginOptions.extras.canvasOpt.contextType);const a={dpr:s,originalPoint:[i/2,o/2],offscreenCanvasOpt:{...In.defaultScreenCanvasOpt,width:i,height:o},layerOpt:{...In.defaultLayerOpt,width:i,height:o},cameraOpt:{...In.defaultCameraOpt,width:i,height:o}};if(r.viewData){const{scale:l,...u}=r.viewData.camera;a.cameraOpt={...a.cameraOpt,...u,scale:l===1/0?1:l}}return a}}async mountView(t){var e,r;const i=this.getView(t);if(i){t===((e=this.mainView)==null?void 0:e.id)&&(this.control.cursor.activeCollector(),await this.control.activeWorker());const o=this.getViewInitData(t);if(o&&((r=this.control.worker)==null||r.createViewWorker(t,o)),i.focusScenePath&&this.control.collector){if(this.control.collector.authStorage){const{renderAuth:s,pageAuth:a}=this.control.collector.authStorage;if(s){const l=s[t];if(l){const{render:u,hide:p,clear:c}=l;this.control.renderControl.syncRenderUids(t,u,p,c);return}}if(a){const l=a[t];if(l){this.control.renderControl.syncPageAuth(t,l,!0);return}}}this.control.worker.pullServiceData(t,i.focusScenePath,{isAsync:!0,useAnimation:!1})}}}listenerWindowManager(t){t.emitter.on("focusedChange",e=>{const r=e||ce;if(this.focuedViewId!==r)if(this.getView(r)){const i=this.control.worker.getLocalWorkViewId();i&&i!==r?this.setFocuedViewId(i):this.setFocuedViewId(r)}else this.tmpFocusedViewId=r}),t.emitter.on("mainViewScenePathChange",e=>{this.control.onSceneChange(e,ce)}),t.emitter.on("onMainViewMounted",this.onMainViewMounted),t.emitter.on("onAppViewMounted",this.onAppViewMounted),t.emitter.on("onMainViewRebind",this.onMainViewRelease),t.emitter.on("onBoxClose",e=>{this.appViews.get(e.appId)&&(this.destroyAppView(e.appId),this.control.worker.destroyViewWorker(e.appId))}),t.emitter.on("onAppScenePathChange",e=>{const{appId:r,view:i}=e;this.control.onSceneChange(i.focusScenePath,r)}),t.emitter.on("appsChange",e=>{for(const r of this.appViews.keys())e.includes(r)||(this.destroyAppView(r),this.control.worker.destroyViewWorker(r,!0))})}onActiveHotkeyChange(t){this.control.hotkeyManager.onActiveHotkey(t)}}class Mr extends We{constructor(t){super(t),G(this,"windowManager"),G(this,"viewContainerManager");const e={control:this,internalMsgEmitter:We.InternalMsgEmitter,publicMsgEmitter:We.PublicMsgEmitter};this.viewContainerManager=new In(e)}init(){}activePlugin(){this.collector&&(this.collector.addAuthStateListener((t,e)=>{t&&Object.keys(t).forEach(r=>{var i;const o=(i=t[r])==null?void 0:i.newValue;this.renderControl.syncRenderUids(r,o?.render,o?.hide,o?.clear)}),e&&Object.keys(e).forEach(r=>{var i;const o=(i=e[r])==null?void 0:i.newValue;this.renderControl.syncPageAuth(r,o)})}),this.collector.addStorageStateListener(t=>{var e,r;if((e=this.collector)!=null&&e.storage&&Object.keys(this.collector.storage).length===0){(r=this.worker)==null||r.clearViewScenePath(ce,!0);return}const{diffView:i,diffScenePath:o,diffData:s}=t,a=new Map;if(i){let l;Object.keys(i).forEach(u=>{var p;const c=i[u];if(c&&!c.newValue)(p=this.worker)==null||p.clearViewScenePath(u,!0),c.oldValue&&(l=c.oldValue);else if(c&&c.newValue){for(const g of Object.keys(c.newValue))this.worker.pullServiceData(u,g,{isAsync:!1,useAnimation:!1});l=c.newValue}if(l)for(const g of Object.values(l)){const v=new Set;for(const I of Object.keys(g))I&&v.add(I);a.set(u,v)}})}if(o){let l;Object.keys(o).forEach(u=>{var p;const c=o[u];if(c&&c.viewId&&!c.newValue?((p=this.worker)==null||p.clearViewScenePath(c.viewId,!0),c.oldValue&&(l=c.oldValue)):c&&c.viewId&&c.newValue&&(this.worker.pullServiceData(c.viewId,u,{isAsync:!1,useAnimation:!1}),l=c.newValue),c!=null&&c.viewId&&l){const g=new Set;for(const v of Object.keys(l))v&&g.add(v),a.set(c.viewId,g)}})}s&&Object.keys(s).forEach(l=>{var u,p;const c=s[l];if(c){const{viewId:g}=c,v=a.get(g)||new Set;v.add(l),a.set(g,v),(u=this.worker)==null||u.onServiceDerive(l,c),(p=this.miniMapManager)==null||p.updateMiniMapCamera(g)}});for(const[l,u]of a.entries())We.InternalMsgEmitter.emit("excludeIds",[...u],l)}),this.worker.isActive&&this.viewContainerManager.getAllViews().forEach(t=>{t&&t.focusScenePath&&this.worker.pullServiceData(t.id,t.focusScenePath,{isAsync:!0,useAnimation:!1})}),this.room&&this.roomMember.onUidChangeHook(t=>{var e,r;(e=this.collector)!=null&&e.serviceStorage&&this.viewContainerManager.getAllViews().forEach(i=>{var o,s,a,l;if(i&&i.focusScenePath&&(o=this.collector)!=null&&o.serviceStorage[i.id]&&this.collector.serviceStorage[i.id][i.focusScenePath]){const u=Object.keys(this.collector.serviceStorage[i.id][i.focusScenePath]);for(const p of u){const c=(s=this.collector)==null?void 0:s.getUidFromKey(p);if(c&&!t.online.includes(c))if((a=this.collector)!=null&&a.isSelector(p))this.renderControl.isWritable&&((l=this.collector)==null||l.updateValue(p,void 0,{viewId:i.id,scenePath:i.focusScenePath,isSync:!0})),this.worker.blurSelector(i.id,i.focusScenePath,p);else{const g=this.textEditorManager.editors.get(p);g&&g.opt&&(g.opt.workState===Tt.Doing||g.opt.workState===Tt.Start)&&(g.opt.text&&g.opt.text.replace(/\s*,/g,"")?this.textEditorManager.unActive(p):this.textEditorManager.delete(p))}}}}),(r=this.cursor)==null||r.updateRoomMembers(t)}))}async activeWorker(){await this.worker.init()}setWindowManager(t){var e,r,i,o,s;this.windowManager=t,(r=(e=this.windowManager)==null?void 0:e.mainView)!=null&&r.divElement&&this.viewContainerManager.onMainViewMounted(this.windowManager.mainView),(s=(o=(i=this.windowManager.appManager)==null?void 0:i.viewManager)==null?void 0:o.views)!=null&&s.size&&this.windowManager.appManager.viewManager.views.forEach((a,l)=>{this.viewContainerManager.onAppViewMounted({appId:l,view:a})}),this.viewContainerManager.listenerWindowManager(this.windowManager)}}const ar=class Lt extends Ft.InvisiblePlugin{constructor(){super(...arguments),G(this,"onPhaseChanged",t=>{var e;t===Ft.RoomPhase.Reconnecting&&((e=Lt.currentManager)==null||e.setSnapshootData())}),G(this,"updateRoomWritable",()=>{var t;(t=Lt.currentManager)==null||t.onWritableChange(this.displayer.isWritable)}),G(this,"roomStateChangeListener",async t=>{var e,r;t!=null&&t.roomMembers&&((e=Lt.currentManager)==null||e.onRoomMembersChange(t.roomMembers)),!(Ft.isRoom(this.displayer)&&!this.displayer.isWritable)&&t.memberState&&((r=Lt.currentManager)==null||r.onMemberChange(t.memberState))})}static async getInstance(t,e){var r;e.options&&(((r=e.options.extras)==null?void 0:r.useWorker)==="mainThread"&&(e.options.cdn.fullWorkerUrl="",e.options.cdn.subWorkerUrl=""),(e.options.extras&&e.options.extras.useWorker!=="mainThread"||!e.options.extras)&&!e.options.cdn.fullWorkerUrl&&!e.options.cdn.subWorkerUrl&&Lt.logger.error("[ApplianceMultiPlugin] you must adaptor options cdn fullWorkerUrl and subWorkerUrl"));const i=t.displayer,o=i.callbacks.on,s=i.callbacks.off,a=i.callbacks.once,l=t.cleanCurrentScene,u=t.mainView.setMemberState;let p;Ft.isRoom(i)&&(p=i.setWritable),e!=null&&e.logger&&(Lt.logger=e.logger);let c=i.getInvisiblePlugin(Lt.kind);c||(c=await Lt.createApplianceMultiPlugin(i,Lt.kind)),i&&c&&Lt.createCurrentManager(t,{cdn:e.options.cdn,extras:{...me,...e.options.extras}},c),c&&Lt.currentManager&&(Lt.currentManager.bindPlugin(c),c.init(i));const g={displayer:i,windowManager:t,currentManager:Lt.currentManager,maxScreenshotWidth:10*1024,maxScreenshotHeight:10*1024,getBoundingRectAsync:async function(I){var w;Lt.logger.info("[ApplianceMultiPlugin] getBoundingRectAsync");const y=(t.mainView||i).getBoundingRect(I),T=await((w=Lt.currentManager)==null?void 0:w.getBoundingRect(I));return!y.width||!y.height?T:uh(y,T)},screenshotToCanvasAsync:async function(I,w,y,T,h,m){var d;Lt.logger.info("[ApplianceMultiPlugin] screenshotToCanvasAsync");let M=y,x=T,E=h.scale;M>this.maxScreenshotWidth&&(E=this.maxScreenshotWidth/M*E,M=this.maxScreenshotWidth),x>this.maxScreenshotHeight&&(E=Math.min(this.maxScreenshotHeight/x*E,E),x=this.maxScreenshotHeight),h.scale=E;const P=document.createElement("canvas"),R=P.getContext("2d");P.width=M*(m||1),P.height=x*(m||1),R&&((t.mainView||i).screenshotToCanvas(R,w,M,x,h,m),I.drawImage(P,Math.floor((y-M)/2),Math.floor((T-x)/2),M*(m||1),x*(m||1),0,0,M,x),P.remove()),Lt.currentManager&&await((d=Lt.currentManager)==null?void 0:d.screenshotToCanvas(I,w,M,x,h,Math.floor((y-M)/2),Math.floor((T-x)/2)))},scenePreviewAsync:async function(I,w,y,T,h){Lt.logger.info("[ApplianceMultiPlugin] scenePreviewAsync"),(t.mainView||i).scenePreview(I,w,y,T,h);const m=document.createElement("img");m.className="appliance-plugin-fill-scene-snapshot-img",w.append(m),getComputedStyle(w).position||(w.style.position="relative"),Lt.currentManager&&await Lt.currentManager.scenePreview(I,m)},fillSceneSnapshotAsync:async function(I,w,y,T,h){Lt.logger.info("[ApplianceMultiPlugin] fillSceneSnapshotAsync"),w.innerHTML="",(t.mainView||i).fillSceneSnapshot(I,w,y,T,h);const m=y||t.mainView.size.width,d=T||t.mainView.size.height;let M=await this.getBoundingRectAsync(I);M||(M={originX:0,originY:0,width:m,height:d});let x=Math.max(M?.width,m),E=Math.max(M?.height,d),P=1;const R=x>m&&Math.min(m/x,P)||P,N=E>d&&Math.min(d/E,P)||P;R<=N?(x=R<1&&m||x,E=Math.floor(E*R)+1,P=R):R>N&&(E=N<1&&d||E,x=Math.floor(x*N)+1,P=N);const b={scale:P,centerX:M.originX+M.width/2,centerY:M.originY+M.height/2},j=document.createElement("canvas"),O=j.getContext("2d");j.width=x,j.height=E,O&&await this.screenshotToCanvasAsync(O,I,x,E,b,devicePixelRatio);const L=document.createElement("img");L.className="appliance-plugin-fill-scene-snapshot-img",L.src=j.toDataURL(),L.onload=()=>{j.remove()},L.onerror=()=>{j.remove(),L.remove()},w.append(L),getComputedStyle(w).position||(w.style.position="relative")},_callbacksOn:function(I,w){Lt.logger.info(`[ApplianceMultiPlugin] callbacks ${I}`),(I==="onCanUndoStepsUpdate"||I==="onCanRedoStepsUpdate")&&Ft.isRoom(i)&&i.isWritable?Mr.InternalMsgEmitter.on(I,w):o.call(i.callbacks,I,w)},_callbacksOnce:function(I,w){Lt.logger.info(`[ApplianceMultiPlugin] callbacks ${I}`),(I==="onCanUndoStepsUpdate"||I==="onCanRedoStepsUpdate")&&Ft.isRoom(i)&&i.isWritable?Mr.InternalMsgEmitter.on(I,w):a.call(i.callbacks,I,w)},_callbacksOff:function(I,w){Lt.logger.info(`[ApplianceMultiPlugin] callbacks ${I}`),(I==="onCanUndoStepsUpdate"||I==="onCanRedoStepsUpdate")&&Ft.isRoom(i)&&i.isWritable?Mr.InternalMsgEmitter.off(I,w):s.call(i.callbacks,I,w)},canRedoSteps(){if(Lt.logger.info("[ApplianceMultiPlugin] canRedoSteps"),Lt.currentManager&&Ft.isRoom(i)&&!i.disableSerialization){const I=Lt.currentManager.viewContainerManager.focuedView,w=I?.focusScenePath;if(I&&w)return I.displayer.commiter.redoStack.filter(y=>y.scenePath===w).length}return 0},canUndoSteps(){if(Lt.logger.info("[ApplianceMultiPlugin] canUndoSteps"),Lt.currentManager&&Ft.isRoom(i)&&!i.disableSerialization){const I=Lt.currentManager.viewContainerManager.focuedView,w=I?.focusScenePath;if(I&&w)return I.displayer.commiter.undoStack.filter(y=>y.scenePath===w).length}return 0},undo:function(){return Lt.logger.info("[ApplianceMultiPlugin] undo"),Lt.currentManager&&Ft.isRoom(i)&&!i.disableSerialization?Lt.currentManager.viewContainerManager.undo():0},redo:function(){return Lt.logger.info("[ApplianceMultiPlugin] redo"),Lt.currentManager&&Ft.isRoom(i)&&!i.disableSerialization?Lt.currentManager.viewContainerManager.redo():0},cleanCurrentScene:function(){Lt.logger.info("[ApplianceMultiPlugin] cleanCurrentScene"),Lt.currentManager&&Ft.isRoom(i)&&i.isWritable&&(Lt.currentManager.cleanCurrentScene(),l.call(t))},insertImage:function(I){if(Lt.logger.info("[ApplianceMultiPlugin] insertImage"),Lt.currentManager&&Ft.isRoom(i)&&i.isWritable){const w=Lt.currentManager.viewContainerManager.focuedViewId||ce;Lt.currentManager.worker.insertImage(w,I)}},lockImage:function(I,w){if(Lt.logger.info("[ApplianceMultiPlugin] lockImage"),Lt.currentManager&&Ft.isRoom(i)&&i.isWritable){const y=Lt.currentManager.viewContainerManager.focuedViewId||ce;Lt.currentManager.worker.lockImage(y,I,w)}},completeImageUpload:function(I,w){if(Lt.logger.info("[ApplianceMultiPlugin] completeImageUpload"),Lt.currentManager&&Ft.isRoom(i)&&i.isWritable){const y=Lt.currentManager.viewContainerManager.focuedViewId||ce;Lt.currentManager.worker.completeImageUpload(y,I,w)}},getImagesInformation:function(I){return Lt.logger.info("[ApplianceMultiPlugin] completeImageUpload"),Lt.currentManager&&Ft.isRoom(i)&&i.isWritable?Lt.currentManager.worker.getImagesInformation(I):[]},insertText:function(I,w,y){if(Lt.logger.info("[ApplianceMultiPlugin] insertText"),Lt.currentManager&&Ft.isRoom(i)&&i.isWritable){const T=Lt.currentManager.viewContainerManager.focuedViewId||ce;return Lt.currentManager.textEditorManager.insertText(T,I,w,y)}},updateText:function(I,w){Lt.logger.info("[ApplianceMultiPlugin] updateText"),Lt.currentManager&&Ft.isRoom(i)&&i.isWritable&&Lt.currentManager.textEditorManager.updateText(I,w)},callbacks:()=>(Lt.logger.info("[ApplianceMultiPlugin] callbacks bind"),{...i.callbacks,on:g._callbacksOn.bind(g),once:g._callbacksOnce.bind(g),off:g._callbacksOff.bind(g)}),destroy(){Lt.currentManager&&(Lt.logger.info("[ApplianceMultiPlugin] destroy"),Lt.currentManager.destroy(),Lt.currentManager=void 0)},setMemberState(I){Lt.logger.info(`[ApplianceMultiPlugin] setMemberState ${JSON.stringify(I)}`);const w=Object.keys(I);if(Ft.isRoom(i)&&i.isWritable){w.includes("currentApplianceName")&&(I.currentApplianceName&&I.currentApplianceName===Jt.laserPen?(I.currentApplianceName=Jt.pencil,I.useLaserPen=!0):I.currentApplianceName&&I.currentApplianceName===Jt.pencil&&(I.useLaserPen=!1)),u.call(t.mainView,I);return}throw new Error("[ApplianceMultiPlugin] setMemberState must be called in writable room")},setPerformancePriority(I){Lt.logger.info("[ApplianceMultiPlugin] setPriority"),Lt.currentManager&&Lt.currentManager.setPriority(I)},createMiniMap:async function(I,w){if(Lt.logger.info("[ApplianceMultiPlugin] createMiniMap"),Lt.currentManager&&Ft.isRoom(i)&&i.isWritable)return Lt.currentManager.createMiniMap(I,w)},destroyMiniMap:async function(I){if(Lt.logger.info("[ApplianceMultiPlugin] destroyeMiniMap"),Lt.currentManager&&Ft.isRoom(i)&&i.isWritable)return Lt.currentManager.destroyMiniMap(I)},filterRenderByUid(I,w,y){if(Lt.logger.info("[ApplianceMultiPlugin] filterRenderByUid"),Lt.currentManager&&Ft.isRoom(i)&&i.isWritable)return Lt.currentManager.filterRenderByUid(I,w,y)},cancelFilterRender(I,w){if(Lt.logger.info("[ApplianceMultiPlugin] filterRenderByUid"),Lt.currentManager&&Ft.isRoom(i)&&i.isWritable)return Lt.currentManager.cancelFilterRender(I,w)},addListener:(I,w)=>{Lt.logger.info(`[ApplianceMultiPlugin] addListener ${I}`),Mr.PublicMsgEmitter.on(I,w)},removeListener:(I,w)=>{Lt.logger.info(`[ApplianceMultiPlugin] removeListener ${I}`),Mr.PublicMsgEmitter.off(I,w)},usePlugin:I=>{var w;Lt.logger.info("[ApplianceMultiPlugin] usePlugin",I.kind),(w=Lt.currentManager)==null||w.usePlugin(I)},getDisableDeviceInputs(){if(Lt.currentManager&&Ft.isRoom(i))return Lt.currentManager.disableDeviceInputs},setDisableDeviceInputs(I){Lt.logger.info(`[ApplianceMultiPlugin] setDisableDeviceInputs ${I}`),Lt.currentManager&&Ft.isRoom(i)&&(Lt.currentManager.disableDeviceInputs=I)},getDisableCameraTransform(){if(Lt.currentManager&&Ft.isRoom(i))return Lt.currentManager.disableCameraTransform},setDisableCameraTransform(I){Lt.logger.info(`[ApplianceMultiPlugin] setDisableCameraTransform ${I}`),Lt.currentManager&&Ft.isRoom(i)&&(Lt.currentManager.disableCameraTransform=I)},getDisableEraseImage(){if(Lt.currentManager&&Ft.isRoom(i))return Lt.currentManager.disableEraseImage},setDisableEraseImage(I){Lt.logger.info(`[ApplianceMultiPlugin] setDisableEraseImage ${I}`),Lt.currentManager&&Ft.isRoom(i)&&(Lt.currentManager.disableEraseImage=I)},setWritable:async function(I){var w;Lt.logger.info(`[ApplianceMultiPlugin] setWritable ${I}`),Ft.isRoom(i)&&p&&(await((w=Lt.currentManager)==null?void 0:w.setWritable(I)),await p.call(i,I))},requestIdleCallback:(I,w)=>{const y=w?.timeout||0,T=performance.now();let h;const m=new MessageChannel;let d;const M=x=>{try{I({didTimeout:x,timeRemaining:()=>{const E=performance.now()-T;return Math.max(0,y-E)}})}catch(E){Lt.logger.error("[ApplianceMultiPlugin] requestIdleCallback error:",E)}finally{m.port1.close(),m.port2.close(),h!==void 0&&cancelAnimationFrame(h),d!==void 0&&clearTimeout(d)}};return m.port1.onmessage=()=>{h=requestAnimationFrame(()=>{y>0&&performance.now()-T>=y?M(!0):M(!1)})},m.port2.postMessage(null),y>0&&(d=setTimeout(()=>{M(!0)},y)),d||h||0},cancelIdleCallback:I=>{try{clearTimeout(I),cancelAnimationFrame(I)}catch(w){Lt.logger.error("[ApplianceMultiPlugin] cancelIdleCallback error:",w)}},injectMethodToObject:(I,w)=>{if(Lt.logger.info(`[ApplianceMultiPlugin] injectMethodToObject ${w}`),typeof I[w]=="function"||typeof I[w]>"u"){(w==="requestIdleCallback"||w==="cancelIdleCallback")&&Lt.currentManager&&Lt.currentManager.registerPolyfillMethod(w),I[w]=g[w];return}w==="callbacks"&&(I.callbacks.on=g._callbacksOn.bind(g),I.callbacks.off=g._callbacksOff.bind(g),I.callbacks.once=g._callbacksOnce.bind(g))},blurText:()=>{Lt.logger.info("[ApplianceMultiPlugin] blurText"),Lt.currentManager&&Ft.isRoom(i)&&i.isWritable&&Lt.currentManager.textEditorManager.checkEmptyTextBlur()},hasElements:(I,w)=>{var y;if(Lt.logger.info(`[ApplianceMultiPlugin] hasElements ${I}`),Lt.currentManager&&Ft.isRoom(i)&&i.isWritable){let T=I;if(!T){const h=Lt.currentManager.viewContainerManager.focuedView;T=h?.focusScenePath}if(T){const h=(y=Lt.currentManager.collector)==null?void 0:y.getScenePathData(T);if(h){const m=Object.values(h);return m.length>0?w?m.some(d=>w(d.toolsType)):!0:!1}return!1}return!1}}};g.injectMethodToObject(t,"undo"),g.injectMethodToObject(t,"redo"),g.injectMethodToObject(t,"cleanCurrentScene"),g.injectMethodToObject(t,"insertImage"),g.injectMethodToObject(t,"completeImageUpload"),g.injectMethodToObject(t,"lockImage"),g.injectMethodToObject(t,"insertText"),g.injectMethodToObject(t,"updateText"),g.injectMethodToObject(i,"getImagesInformation"),g.injectMethodToObject(i,"callbacks"),g.injectMethodToObject(i,"screenshotToCanvasAsync"),g.injectMethodToObject(i,"getBoundingRectAsync"),g.injectMethodToObject(i,"scenePreviewAsync"),g.injectMethodToObject(i,"fillSceneSnapshotAsync"),g.injectMethodToObject(t.mainView,"setMemberState"),Ft.isRoom(i)&&g.injectMethodToObject(i,"setWritable"),Object.defineProperty(t,"canUndoSteps",{get(){return g.canUndoSteps()}}),Object.defineProperty(t,"canRedoSteps",{get(){return g.canRedoSteps()}}),Mr.InternalMsgEmitter.on("onCanUndoStepsUpdate",I=>{t.emitter.emit("canUndoStepsChange",I)}),Mr.InternalMsgEmitter.on("onCanRedoStepsUpdate",I=>{t.emitter.emit("canRedoStepsChange",I)});const v={...g,callbacks:g.callbacks()};return Object.defineProperty(v,"disableDeviceInputs",{set(I){g.setDisableDeviceInputs(I)},get(){return g.getDisableDeviceInputs()}}),Object.defineProperty(v,"disableCameraTransform",{set(I){g.setDisableCameraTransform(I)},get(){return g.getDisableCameraTransform()}}),Object.defineProperty(v,"disableEraseImage",{set(I){g.setDisableEraseImage(I)},get(){return g.getDisableEraseImage()}}),t._appliancePlugin=v,t._appliancePlugin}static onCreate(t){t&&Lt.currentManager&&(Lt.currentManager.bindPlugin(t),t.init(t.displayer))}static async createApplianceMultiPlugin(t,e){try{await t.createInvisiblePlugin(Lt,{})}catch(i){if(!t.isWritable){await t.setWritable(!0);const o=await this.createApplianceMultiPlugin(t,e);return await t.setWritable(!1),o}throw i}let r=t.getInvisiblePlugin(e);return r||(r=await Lt.createApplianceMultiPlugin(t,e)),r}get isReplay(){return Ft.isPlayer(this.displayer)}get callbackName(){return this.isReplay?"onPlayerStateChanged":"onRoomStateChanged"}init(t){var e,r;const i=t.state;(e=Lt.currentManager)==null||e.onRoomMembersChange(i.roomMembers),Ft.isRoom(t)&&((r=Lt.currentManager)==null||r.onMemberChange(i.memberState)),this.displayer.callbacks.on(this.callbackName,this.roomStateChangeListener),this.displayer.callbacks.on("onEnableWriteNowChanged",this.updateRoomWritable),this.displayer.callbacks.on("onPhaseChanged",this.onPhaseChanged)}destroy(){var t;Lt.logger.info("[ApplianceMultiPlugin] passive destroy"),(t=Lt.currentManager)==null||t.destroy(),Lt.currentManager=void 0}};G(ar,"kind","appliance-multi-plugin"),G(ar,"currentManager"),G(ar,"logger",{info:console.log,warn:console.warn,error:console.error}),G(ar,"createCurrentManager",(n,t,e)=>{ar.currentManager&&ar.currentManager.destroy();const r={plugin:e,displayer:n.displayer,options:t},i=new Mr(r);if(ar.logger.info("[ApplianceMultiPlugin] refresh ApplianceMultiManager object"),i.setWindowManager(n),ar.currentManager=i,n.room){const o=i.hasOffscreenCanvas();n.room.logger.info(`[ApplianceMultiPlugin] use ${o?"worker":"mainThread"}`)}});let LO=ar;var OO=Wn,bO=function(){return OO.Date.now()},RO=bO,jO=/\s/;function zO(n){for(var t=n.length;t--&&jO.test(n.charAt(t)););return t}var kO=zO,BO=kO,WO=/^\s+/;function UO(n){return n&&n.slice(0,BO(n)+1).replace(WO,"")}var YO=UO,FO=mi,VO=er,XO="[object Symbol]";function GO(n){return typeof n=="symbol"||VO(n)&&FO(n)==XO}var $O=GO,HO=YO,Cd=Yr,QO=$O,Ed=NaN,ZO=/^[-+]0x[0-9a-f]+$/i,KO=/^0b[01]+$/i,JO=/^0o[0-7]+$/i,qO=parseInt;function _O(n){if(typeof n=="number")return n;if(QO(n))return Ed;if(Cd(n)){var t=typeof n.valueOf=="function"?n.valueOf():n;n=Cd(t)?t+"":t}if(typeof n!="string")return n===0?n:+n;n=HO(n);var e=KO.test(n);return e||JO.test(n)?qO(n.slice(2),e?2:8):ZO.test(n)?Ed:+n}var tb=_O,eb=Yr,Rl=RO,Pd=tb,nb="Expected a function",rb=Math.max,ib=Math.min;function ob(n,t,e){var r,i,o,s,a,l,u=0,p=!1,c=!1,g=!0;if(typeof n!="function")throw new TypeError(nb);t=Pd(t)||0,eb(e)&&(p=!!e.leading,c="maxWait"in e,o=c?rb(Pd(e.maxWait)||0,t):o,g="trailing"in e?!!e.trailing:g);function v(x){var E=r,P=i;return r=i=void 0,u=x,s=n.apply(P,E),s}function I(x){return u=x,a=setTimeout(T,t),p?v(x):s}function w(x){var E=x-l,P=x-u,R=t-E;return c?ib(R,o-P):R}function y(x){var E=x-l,P=x-u;return l===void 0||E>=t||E<0||c&&P>=o}function T(){var x=Rl();if(y(x))return h(x);a=setTimeout(T,w(x))}function h(x){return a=void 0,g&&r?v(x):(r=i=void 0,s)}function m(){a!==void 0&&clearTimeout(a),u=0,r=l=i=a=void 0}function d(){return a===void 0?s:h(Rl())}function M(){var x=Rl(),E=y(x);if(r=arguments,i=this,l=x,E){if(a===void 0)return I(l);if(c)return clearTimeout(a),a=setTimeout(T,t),v(l)}return a===void 0&&(a=setTimeout(T,t)),s}return M.cancel=m,M.flush=d,M}var sb=ob,ab=sb,lb=Yr,ub="Expected a function";function cb(n,t,e){var r=!0,i=!0;if(typeof n!="function")throw new TypeError(ub);return lb(e)&&(r="leading"in e?!!e.leading:r,i="trailing"in e?!!e.trailing:i),ab(n,t,{leading:r,maxWait:t,trailing:i})}var hb=cb;const fb=qi(hb);class db extends xv{constructor(t,e){super(t,e),G(this,"width",1e3),G(this,"height",1e3),G(this,"dpr",pr()),G(this,"vDom"),G(this,"viewId",ce),G(this,"eventTragetElement"),G(this,"snapshotContainerRef"),G(this,"canvasContainerRef",ut.createRef()),G(this,"subLocalCanvasContainerRef",ut.createRef()),G(this,"canvasTopRef",ut.createRef()),G(this,"canvasServiceFloatRef",ut.createRef()),G(this,"canvasFloatRef",ut.createRef()),G(this,"canvasBgRef",ut.createRef()),G(this,"floatBarRef",ut.createRef()),G(this,"containerOffset",{x:0,y:0}),this.control.hasOffscreenCanvas()||(this.snapshotContainerRef=ut.createRef())}setCanvassStyle(){if(this.eventTragetElement){const t=this.eventTragetElement.offsetWidth,e=this.eventTragetElement.offsetHeight;let r=pr();this.canvasBgRef.current&&(r=pr(this.canvasBgRef.current.getContext("2d"))),r!==this.dpr&&(this.dpr=r,this.control.worker.updateDpr(this.viewId,this.dpr)),t&&e&&this.canvasContainerRef.current&&(t!==this.width||e!==this.height)&&(this.width=t,this.height=e),t&&e&&this.canvasBgRef.current&&(t!==this.width||e!==this.height)&&(this.width=t,this.height=e,this.canvasBgRef.current.width=t*this.dpr,this.canvasBgRef.current.height=e*this.dpr,this.canvasFloatRef.current&&(this.canvasFloatRef.current.width=t*this.dpr,this.canvasFloatRef.current.height=e*this.dpr),this.canvasServiceFloatRef.current&&(this.canvasServiceFloatRef.current.width=t*this.dpr,this.canvasServiceFloatRef.current.height=e*this.dpr),this.canvasTopRef.current&&(this.canvasTopRef.current.width=t*this.dpr,this.canvasTopRef.current.height=e*this.dpr))}}createMainViewDisplayer(t){return this.vDom||(this.containerOffset=this.getContainerOffset(t,this.containerOffset),this.eventTragetElement=t.parentElement.children[0],t.innerHTML="",Vc.render(ut.createElement(dh,{viewId:this.viewId,mananger:this,refs:{canvasServiceFloatRef:this.canvasServiceFloatRef,canvasFloatRef:this.canvasFloatRef,canvasBgRef:this.canvasBgRef,floatBarRef:this.floatBarRef,canvasTopRef:this.canvasTopRef,canvasContainerRef:this.canvasContainerRef,snapshotContainerRef:this.snapshotContainerRef,subLocalCanvasContainerRef:this.subLocalCanvasContainerRef}}),t),this.control.room&&this.bindDisplayerEvent(this.eventTragetElement)),this}}class lr extends bo{constructor(t){super(t),G(this,"focuedViewId"),G(this,"control"),G(this,"focuedView"),this.control=t.control}bindMainView(){if(!this.control.divMainView)return;const t=new db(this.control,We.InternalMsgEmitter),{width:e,height:r,dpr:i}=t,o={offscreenCanvasOpt:{...lr.defaultScreenCanvasOpt},layerOpt:{...lr.defaultLayerOpt},cameraOpt:{...lr.defaultCameraOpt,width:e,height:r}},s=this.control.room&&this.control.room.mainView||this.control.play&&this.control.play.mainView;if(s){const{scale:a,...l}=s.camera;o.cameraOpt={...o.cameraOpt,...l,scale:a===1/0?1:a},this.createMianView({id:ce,displayer:t,focusScenePath:s.focusScenePath||s.scenePath,cameraOpt:o.cameraOpt,viewData:s}),this.setFocuedViewId(ce),t.createMainViewDisplayer(this.control.divMainView)}}getViewInitData(t){var e;const r=this.getView(t);if(r){const{width:i,height:o,dpr:s}=r.displayer;(e=this.control.pluginOptions.extras.canvasOpt)!=null&&e.contextType&&(lr.defaultScreenCanvasOpt.contextType=this.control.pluginOptions.extras.canvasOpt.contextType);const a={dpr:s,originalPoint:[i/2,o/2],offscreenCanvasOpt:{...lr.defaultScreenCanvasOpt,width:i,height:o},layerOpt:{...lr.defaultLayerOpt,width:i,height:o},cameraOpt:{...lr.defaultCameraOpt,width:i,height:o}};if(r.viewData){const{scale:l,...u}=r.viewData.camera;a.cameraOpt={...a.cameraOpt,...u,scale:l===1/0?1:l}}return a}}async mountView(t){var e;const r=this.getView(t);if(r){this.control.worker.isActive||(this.control.cursor.activeCollector(),await this.control.activeWorker());const i=this.getViewInitData(t);i&&((e=this.control.worker)==null||e.createViewWorker(t,i)),r.focusScenePath&&this.control.collector&&this.control.worker.pullServiceData(t,r.focusScenePath,{isAsync:!0,useAnimation:!1})}}}class Sn extends We{constructor(t){super(t),G(this,"viewContainerManager"),G(this,"divMainView"),G(this,"onCameraChange",fb(r=>{var i;const o=this.viewContainerManager.mainView;o&&o.cameraOpt&&(o.cameraOpt.width!==r.width||o.cameraOpt.height!==r.height)&&((i=this.viewContainerManager.mainView)==null||i.displayer.updateSize()),this.viewContainerManager.setFocuedViewCameraOpt(r)},pv,{leading:!1}));const e={control:this,internalMsgEmitter:Sn.InternalMsgEmitter,publicMsgEmitter:Sn.PublicMsgEmitter};this.viewContainerManager=new lr(e)}init(){Sn.InternalMsgEmitter.on(Ht.BindMainView,t=>{this.divMainView=t,this.plugin&&!this.viewContainerManager.mainView&&this.viewContainerManager.bindMainView()})}activePlugin(){this.plugin&&this.divMainView&&!this.viewContainerManager.mainView&&this.viewContainerManager.bindMainView(),this.collector&&(this.collector.addStorageStateListener(t=>{var e,r;if((e=this.collector)!=null&&e.storage&&Object.keys(this.collector.storage).length===0){(r=this.worker)==null||r.clearViewScenePath(ce,!0);return}const{diffView:i,diffScenePath:o,diffData:s}=t,a=new Map;if(i){let l;Object.keys(i).forEach(u=>{var p;const c=i[u];if(c&&!c.newValue)(p=this.worker)==null||p.clearViewScenePath(u,!0),c.oldValue&&(l=c.oldValue);else if(c&&c.newValue){for(const g of Object.keys(c.newValue))this.worker.pullServiceData(u,g,{isAsync:!1,useAnimation:!0});l=c.newValue}if(l)for(const g of Object.values(l)){const v=new Set;for(const I of Object.keys(g))I&&v.add(I);a.set(u,v)}})}if(o){let l;Object.keys(o).forEach(u=>{var p;const c=o[u];if(c&&c.viewId&&!c.newValue?((p=this.worker)==null||p.clearViewScenePath(c.viewId,!0),c.oldValue&&(l=c.oldValue)):c&&c.viewId&&c.newValue&&(this.worker.pullServiceData(c.viewId,u,{isAsync:!1,useAnimation:!0}),l=c.newValue),c!=null&&c.viewId&&l){const g=new Set;for(const v of Object.keys(l))v&&g.add(v),a.set(c.viewId,g)}})}s&&Object.keys(s).forEach(l=>{var u,p;const c=s[l];if(c){const{viewId:g}=c,v=a.get(g)||new Set;v.add(l),a.set(g,v),(u=this.worker)==null||u.onServiceDerive(l,c),(p=this.miniMapManager)==null||p.updateMiniMapCamera(g)}});for(const[l,u]of a.entries())We.InternalMsgEmitter.emit("excludeIds",[...u],l)}),this.room&&(this.roomMember.onUidChangeHook(t=>{var e;(e=this.collector)!=null&&e.serviceStorage&&this.viewContainerManager.getAllViews().forEach(r=>{var i,o,s,a,l,u;if(r&&r.focusScenePath&&(i=this.collector)!=null&&i.serviceStorage[r.id]&&(o=this.collector)!=null&&o.serviceStorage[r.id][r.focusScenePath]){const p=Object.keys((s=this.collector)==null?void 0:s.serviceStorage[r.id][r.focusScenePath]);for(const c of p){const g=(a=this.collector)==null?void 0:a.getUidFromKey(c);if(g&&!t.online.includes(g))if((l=this.collector)!=null&&l.isSelector(c))this.renderControl.isWritable&&((u=this.collector)==null||u.updateValue(c,void 0,{viewId:r.id,scenePath:r.focusScenePath,isSync:!0})),this.worker.blurSelector(r.id,r.focusScenePath,c);else{const v=this.textEditorManager.editors.get(c);v&&v.opt&&(v.opt.workState===Tt.Doing||v.opt.workState===Tt.Start)&&(v.opt.text&&v.opt.text.replace(/\s*,/g,"")?this.textEditorManager.unActive(c):this.textEditorManager.delete(c))}}}})}),this.worker.isActive&&this.viewContainerManager.getAllViews().forEach(t=>{t&&t.focusScenePath&&this.worker.pullServiceData(t.id,t.focusScenePath,{isAsync:!0,useAnimation:!1})})))}async activeWorker(){await this.worker.init()}}const rr=class Dt extends Ft.InvisiblePlugin{constructor(){super(...arguments),G(this,"onPhaseChanged",t=>{var e;t===Ft.RoomPhase.Reconnecting&&((e=Dt.currentManager)==null||e.setSnapshootData())}),G(this,"updateRoomWritable",()=>{var t;(t=Dt.currentManager)==null||t.onWritableChange(this.displayer.isWritable)}),G(this,"roomStateChangeListener",async t=>{var e,r;Dt.currentManager instanceof Sn&&(t.cameraState&&Dt.currentManager.onCameraChange(t.cameraState),t.sceneState&&Dt.currentManager.onSceneChange(t.sceneState.scenePath,ce)),t!=null&&t.roomMembers&&((e=Dt.currentManager)==null||e.onRoomMembersChange(t.roomMembers)),!(Ft.isRoom(this.displayer)&&!this.displayer.isWritable)&&t.memberState&&((r=Dt.currentManager)==null||r.onMemberChange(t.memberState))})}static async getInstance(t,e){var r;e.options&&(((r=e.options.extras)==null?void 0:r.useWorker)==="mainThread"&&(e.options.cdn.fullWorkerUrl="",e.options.cdn.subWorkerUrl=""),(e.options.extras&&e.options.extras.useWorker!=="mainThread"||!e.options.extras)&&!e.options.cdn.fullWorkerUrl&&!e.options.cdn.subWorkerUrl&&Dt.logger.error("[ApplianceSinglePlugin] you must adaptor options cdn fullWorkerUrl and subWorkerUrl"));const i=t.callbacks.on,o=t.callbacks.off,s=t.callbacks.once,a=t.cleanCurrentScene.bind(t),l=t.setMemberState.bind(t);let u;Ft.isRoom(t)&&(u=t.setWritable),e!=null&&e.logger&&(Dt.logger=e.logger);let p=t.getInvisiblePlugin(Dt.kind);p||(p=await Dt.createAppliancePlugin(t,Dt.kind)),t&&p&&Dt.createCurrentManager(t,{cdn:e.options.cdn,extras:{...me,...e.options.extras}},p),p&&Dt.currentManager&&(Dt.currentManager.bindPlugin(p),p.init(t)),e!=null&&e.cursorAdapter&&(Dt.cursorAdapter=e.cursorAdapter),Dt.effectInstance();const c={displayer:t,currentManager:Dt.currentManager,maxScreenshotWidth:10*1024,maxScreenshotHeight:10*1024,_injectTargetObject:void 0,getBoundingRectAsync:async function(v){var I;Dt.logger.info("[ApplianceSinglePlugin] getBoundingRectAsync");const w=t.getBoundingRect(v),y=await((I=Dt.currentManager)==null?void 0:I.getBoundingRect(v));return!w.width||!w.height?y:uh(w,y)},screenshotToCanvasAsync:async function(v,I,w,y,T,h){var m;Dt.logger.info("[ApplianceSinglePlugin] screenshotToCanvasAsync");let d=w,M=y,x=T.scale;d>this.maxScreenshotWidth&&(x=this.maxScreenshotWidth/d*x,d=this.maxScreenshotWidth),M>this.maxScreenshotHeight&&(x=Math.min(this.maxScreenshotHeight/M*x,x),M=this.maxScreenshotHeight),T.scale=x;const E=document.createElement("canvas"),P=E.getContext("2d");E.width=d*(h||1),E.height=M*(h||1),P&&(t.screenshotToCanvas(P,I,d,M,T,h),v.drawImage(E,Math.floor((w-d)/2),Math.floor((y-M)/2),d*(h||1),M*(h||1),0,0,d,M),E.remove()),Dt.currentManager&&await((m=Dt.currentManager)==null?void 0:m.screenshotToCanvas(v,I,d,M,T,Math.floor((w-d)/2),Math.floor((y-M)/2)))},scenePreviewAsync:async function(v,I,w,y,T){Dt.logger.info("[ApplianceSinglePlugin] scenePreviewAsync"),t.scenePreview(v,I,w,y,T);const h=document.createElement("img");h.className="appliance-plugin-fill-scene-snapshot-img",I.append(h),getComputedStyle(I).position||(I.style.position="relative"),Dt.currentManager&&await Dt.currentManager.scenePreview(v,h)},fillSceneSnapshotAsync:async function(v,I,w,y,T){var h,m;Dt.logger.info("[ApplianceSinglePlugin] fillSceneSnapshotAsync"),I.innerHTML="",t.fillSceneSnapshot(v,I,w,y,T);const d=w||((h=t.state.cameraState)==null?void 0:h.width)||0,M=y||((m=t.state.cameraState)==null?void 0:m.height)||0;let x=await this.getBoundingRectAsync(v);x||(x={originX:0,originY:0,width:d,height:M});let E=Math.max(x?.width,d),P=Math.max(x?.height,M),R=1;const N=E>d&&Math.min(d/E,R)||R,b=P>M&&Math.min(M/P,R)||R;N<=b?(E=N<1&&d||E,P=Math.floor(P*N)+1,R=N):N>b&&(P=b<1&&M||P,E=Math.floor(E*b)+1,R=b);const j={scale:R,centerX:x.originX+x.width/2,centerY:x.originY+x.height/2},O=document.createElement("canvas"),L=O.getContext("2d");O.width=E,O.height=P,L&&await this.screenshotToCanvasAsync(L,v,E,P,j,devicePixelRatio);const k=document.createElement("img");k.className="appliance-plugin-fill-scene-snapshot-img",k.src=O.toDataURL(),k.onload=()=>{O.remove()},k.onerror=()=>{O.remove(),k.remove()},I.append(k),getComputedStyle(I).position||(I.style.position="relative")},_callbacksOn:function(v,I){Dt.logger.info(`[ApplianceSinglePlugin] callbacks ${v}`),(v==="onCanUndoStepsUpdate"||v==="onCanRedoStepsUpdate")&&Ft.isRoom(t)&&t.isWritable?Sn.InternalMsgEmitter.on(v,I):i.call(t.callbacks,v,I)},_callbacksOnce:function(v,I){Dt.logger.info(`[ApplianceSinglePlugin] callbacks ${v}`),(v==="onCanUndoStepsUpdate"||v==="onCanRedoStepsUpdate")&&Ft.isRoom(t)&&t.isWritable?Sn.InternalMsgEmitter.on(v,I):s.call(t.callbacks,v,I)},_callbacksOff:function(v,I){Dt.logger.info(`[ApplianceSinglePlugin] callbacks ${v}`),(v==="onCanUndoStepsUpdate"||v==="onCanRedoStepsUpdate")&&Ft.isRoom(t)&&t.isWritable?Sn.InternalMsgEmitter.off(v,I):o.call(t.callbacks,v,I)},canRedoSteps(){if(Dt.logger.info("[ApplianceSinglePlugin] canRedoSteps"),Dt.currentManager&&Ft.isRoom(t)&&!t.disableSerialization){const v=Dt.currentManager.viewContainerManager.focuedView,I=v?.focusScenePath;if(v&&I)return v.displayer.commiter.redoStack.filter(w=>w.scenePath===I).length}return 0},canUndoSteps(){if(Dt.logger.info("[ApplianceSinglePlugin] canUndoSteps"),Dt.currentManager&&Ft.isRoom(t)&&!t.disableSerialization){const v=Dt.currentManager.viewContainerManager.focuedView,I=v?.focusScenePath;if(v&&I)return v.displayer.commiter.undoStack.filter(w=>w.scenePath===I).length}return 0},undo:function(){return Dt.logger.info("[ApplianceSinglePlugin] undo"),Dt.currentManager&&Ft.isRoom(t)&&!t.disableSerialization?Dt.currentManager.viewContainerManager.undo():0},redo:function(){return Dt.logger.info("[ApplianceSinglePlugin] redo"),Dt.currentManager&&Ft.isRoom(t)&&!t.disableSerialization?Dt.currentManager.viewContainerManager.redo():0},cleanCurrentScene:function(v){Dt.logger.info("[ApplianceSinglePlugin] cleanCurrentScene"),Dt.currentManager&&Ft.isRoom(t)&&t.isWritable&&(Dt.currentManager.cleanCurrentScene(),a.call(t,v))},insertImage:function(v){Dt.logger.info("[ApplianceSinglePlugin] insertImage"),Dt.currentManager&&Ft.isRoom(t)&&t.isWritable&&Dt.currentManager.worker.insertImage(ce,v)},lockImage:function(v,I){Dt.logger.info("[ApplianceSinglePlugin] lockImage"),Dt.currentManager&&Ft.isRoom(t)&&t.isWritable&&Dt.currentManager.worker.lockImage(ce,v,I)},completeImageUpload:function(v,I){Dt.logger.info("[ApplianceSinglePlugin] completeImageUpload"),Dt.currentManager&&Ft.isRoom(t)&&t.isWritable&&Dt.currentManager.worker.completeImageUpload(ce,v,I)},getImagesInformation:function(v){return Dt.logger.info("[ApplianceSinglePlugin] completeImageUpload"),Dt.currentManager&&Ft.isRoom(t)&&t.isWritable?Dt.currentManager.worker.getImagesInformation(v):[]},insertText:function(v,I,w){if(Dt.logger.info("[ApplianceSinglePlugin] insertText"),Dt.currentManager&&Ft.isRoom(t)&&t.isWritable)return Dt.currentManager.textEditorManager.insertText(ce,v,I,w)},updateText:function(v,I){Dt.logger.info("[ApplianceMultiPlugin] updateText"),Dt.currentManager&&Ft.isRoom(t)&&t.isWritable&&Dt.currentManager.textEditorManager.updateText(v,I)},callbacks:()=>({...t.callbacks,on:c._callbacksOn.bind(c),once:c._callbacksOnce.bind(c),off:c._callbacksOff.bind(c)}),destroy(){Dt.currentManager&&(Dt.logger.info("[ApplianceSinglePlugin] destroy"),Dt.currentManager.destroy(),Dt.currentManager=void 0,Dt.cursorAdapter=void 0)},setMemberState(v){Dt.logger.info(`[ApplianceSinglePlugin] setMemberState ${JSON.stringify(v)}`);const I=Object.keys(v);if(Ft.isRoom(t)&&t.isWritable){I.includes("currentApplianceName")&&(v.currentApplianceName&&v.currentApplianceName===Jt.laserPen?(v.currentApplianceName=Jt.pencil,v.useLaserPen=!0):v.currentApplianceName&&v.currentApplianceName===Jt.pencil&&(v.useLaserPen=!1)),l(v);return}throw new Error("setMemberState must be called in writable room")},setPerformancePriority(v){Dt.logger.info("[ApplianceSinglePlugin] setPriority"),Dt.currentManager&&Dt.currentManager.setPriority(v)},createMiniMap:async function(v,I){if(Dt.logger.info("[ApplianceSinglePlugin] createMiniMap"),Dt.currentManager&&Ft.isRoom(t)&&t.isWritable)return Dt.currentManager.createMiniMap(v,I)},destroyMiniMap:async function(v){if(Dt.logger.info("[ApplianceMultiPlugin] destroyeMiniMap"),Dt.currentManager&&Ft.isRoom(t)&&t.isWritable)return Dt.currentManager.destroyMiniMap(v)},filterRenderByUid(v,I,w){if(Dt.logger.info("[ApplianceSinglePlugin] filterRenderByUid"),Dt.currentManager&&Ft.isRoom(t)&&t.isWritable)return Dt.currentManager.filterRenderByUid(v,I,w)},cancelFilterRender(v,I){if(Dt.logger.info("[ApplianceSinglePlugin] filterRenderByUid"),Dt.currentManager&&Ft.isRoom(t)&&t.isWritable)return Dt.currentManager.cancelFilterRender(v,I)},addListener:(v,I)=>{Dt.logger.info(`[ApplianceSinglePlugin] addListener ${v}`),Sn.PublicMsgEmitter.on(v,I)},removeListener:(v,I)=>{Dt.logger.info(`[ApplianceSinglePlugin] removeListener ${v}`),Sn.PublicMsgEmitter.off(v,I)},usePlugin:v=>{var I;Dt.logger.info("[ApplianceSinglePlugin] usePlugin",v.kind),(I=Dt.currentManager)==null||I.usePlugin(v)},getDisableDeviceInputs(){if(Dt.currentManager&&Ft.isRoom(t))return Dt.currentManager.disableDeviceInputs},setDisableDeviceInputs(v){Dt.logger.info(`[ApplianceSinglePlugin] setDisableDeviceInputs ${v}`),Dt.currentManager&&Ft.isRoom(t)&&(Dt.currentManager.disableDeviceInputs=v)},getDisableCameraTransform(){if(Dt.currentManager&&Ft.isRoom(t))return Dt.currentManager.disableCameraTransform},setDisableCameraTransform(v){Dt.logger.info(`[ApplianceSinglePlugin] setDisableCameraTransform ${v}`),Dt.currentManager&&Ft.isRoom(t)&&(Dt.currentManager.disableCameraTransform=v)},getDisableEraseImage(){if(Dt.currentManager&&Ft.isRoom(t))return Dt.currentManager.disableEraseImage},setDisableEraseImage(v){Dt.logger.info(`[ApplianceSinglePlugin] setDisableEraseImage ${v}`),Dt.currentManager&&Ft.isRoom(t)&&(Dt.currentManager.disableEraseImage=v)},setWritable:async function(v){var I;Dt.logger.info(`[ApplianceSinglePlugin] setWritable ${v}`),Ft.isRoom(t)&&u&&(await((I=Dt.currentManager)==null?void 0:I.setWritable(v)),await u.call(t,v))},requestIdleCallback:(v,I)=>{const w=I?.timeout||0,y=performance.now();let T;const h=new MessageChannel;let m;const d=M=>{try{v({didTimeout:M,timeRemaining:()=>{const x=performance.now()-y;return Math.max(0,w-x)}})}catch(x){Dt.logger.error("[ApplianceSinglePlugin] requestIdleCallback error:",x)}finally{h.port1.close(),h.port2.close(),T!==void 0&&cancelAnimationFrame(T),m!==void 0&&clearTimeout(m)}};return h.port1.onmessage=()=>{T=requestAnimationFrame(()=>{w>0&&performance.now()-y>=w?d(!0):d(!1)})},h.port2.postMessage(null),w>0&&(m=setTimeout(()=>{d(!0)},w)),m||T||0},cancelIdleCallback:v=>{try{clearTimeout(v),cancelAnimationFrame(v)}catch(I){Dt.logger.error("[ApplianceSinglePlugin] cancelIdleCallback error:",I)}},injectMethodToObject:(v,I)=>{if(Dt.logger.info(`[ApplianceSinglePlugin] injectMethodToObject ${I}`),typeof v[I]=="function"||typeof v[I]>"u"){v[I]=c[I];return}I==="callbacks"&&(v.callbacks.on=c._callbacksOn.bind(c),v.callbacks.off=c._callbacksOff.bind(c),v.callbacks.once=c._callbacksOnce.bind(c))},blurText:()=>{Dt.logger.info("[ApplianceSinglePlugin] blurText"),Dt.currentManager&&Ft.isRoom(t)&&t.isWritable&&Dt.currentManager.textEditorManager.checkEmptyTextBlur()},hasElements:(v,I)=>{var w;if(Dt.logger.info(`[ApplianceSinglePlugin] hasElements ${v}`),Dt.currentManager&&Ft.isRoom(t)&&t.isWritable){let y=v;if(!y){const T=Dt.currentManager.viewContainerManager.focuedView;y=T?.focusScenePath}if(y){const T=(w=Dt.currentManager.collector)==null?void 0:w.getScenePathData(y);if(T){const h=Object.values(T);return h.length>0?I?h.some(m=>I(m.toolsType)):!0:!1}return!1}return!1}}};c.injectMethodToObject(t,"undo"),c.injectMethodToObject(t,"redo"),c.injectMethodToObject(t,"cleanCurrentScene"),c.injectMethodToObject(t,"insertImage"),c.injectMethodToObject(t,"completeImageUpload"),c.injectMethodToObject(t,"lockImage"),c.injectMethodToObject(t,"getImagesInformation"),c.injectMethodToObject(t,"insertText"),c.injectMethodToObject(t,"updateText"),c.injectMethodToObject(t,"callbacks"),c.injectMethodToObject(t,"screenshotToCanvasAsync"),c.injectMethodToObject(t,"getBoundingRectAsync"),c.injectMethodToObject(t,"scenePreviewAsync"),c.injectMethodToObject(t,"fillSceneSnapshotAsync"),c.injectMethodToObject(t,"setMemberState"),Ft.isRoom(t)&&c.injectMethodToObject(t,"setWritable"),Object.defineProperty(t,"canUndoSteps",{get(){return c.canUndoSteps()}}),Object.defineProperty(t,"canRedoSteps",{get(){return c.canRedoSteps()}});const g={...c,callbacks:c.callbacks()};return Object.defineProperty(g,"disableDeviceInputs",{set(v){c.setDisableDeviceInputs(v)},get(){return c.getDisableDeviceInputs()}}),Object.defineProperty(g,"disableEraseImage",{set(v){c.setDisableEraseImage(v)},get(){return c.getDisableEraseImage()}}),Object.defineProperty(g,"disableCameraTransform",{set(v){c.setDisableCameraTransform(v)},get(){return c.getDisableCameraTransform()}}),t._appliancePlugin=g,t._appliancePlugin}static onCreate(t){t&&Dt.currentManager&&(Dt.currentManager.bindPlugin(t),t.init(t.displayer))}static async createAppliancePlugin(t,e){try{await t.createInvisiblePlugin(Dt,{})}catch(i){if(!t.isWritable){await t.setWritable(!0);const o=await this.createAppliancePlugin(t,e);return await t.setWritable(!1),o}throw i}let r=t.getInvisiblePlugin(e);return r||(r=await Dt.createAppliancePlugin(t,e)),r}static effectInstance(){if(Dt.cursorAdapter){const t=Dt.cursorAdapter.onAddedCursor;Dt.cursorAdapter.onAddedCursor=function(e){e.onCursorMemberChanged=r=>{try{r.appliance===Jt.pencil||r.appliance===Jt.shape||r.appliance===Jt.text||r.appliance===Jt.arrow||r.appliance===Jt.straight||r.appliance===Jt.rectangle||r.appliance===Jt.ellipse||r.appliance===Jt.eraser||r.appliance===Jt.selector?e!=null&&e.divElement&&(e.divElement.style.display="none"):e!=null&&e.divElement&&(e.divElement.style.display="block")}catch(i){throw i}},t.call(Dt.cursorAdapter,e)}}}get isReplay(){return Ft.isPlayer(this.displayer)}get callbackName(){return this.isReplay?"onPlayerStateChanged":"onRoomStateChanged"}init(t){var e,r;const i=t.state;(e=Dt.currentManager)==null||e.onRoomMembersChange(i.roomMembers),Ft.isRoom(t)&&i!=null&&i.memberState&&((r=Dt.currentManager)==null||r.onMemberChange(i.memberState)),this.displayer.callbacks.on(this.callbackName,this.roomStateChangeListener),this.displayer.callbacks.on("onEnableWriteNowChanged",this.updateRoomWritable),this.displayer.callbacks.on("onPhaseChanged",this.onPhaseChanged)}destroy(){var t;Dt.logger.info("[ApplianceSinglePlugin] passive destroy"),(t=Dt.currentManager)==null||t.destroy(),Dt.currentManager=void 0,Dt.cursorAdapter=void 0}};G(rr,"kind","appliance-single-plugin"),G(rr,"cursorAdapter"),G(rr,"currentManager"),G(rr,"logger",{info:console.log,warn:console.warn,error:console.error}),G(rr,"createCurrentManager",(n,t,e)=>{rr.currentManager&&rr.currentManager.destroy();const r={plugin:e,displayer:n,options:t},i=new Sn(r);if(i.init(),rr.logger.info("[ApplianceSinglePlugin] refresh ApplianceSingleManager object"),rr.currentManager=i,Ft.isRoom(n)){const o=i.hasOffscreenCanvas();n.logger.info(`[ApplianceSinglePlugin] use ${o?"worker":"mainThread"}`)}});const pb=class qs extends ut.Component{constructor(){super(...arguments),G(this,"mainViewRef",null)}componentDidMount(){qs.emiter||(qs.emiter=Sn.InternalMsgEmitter),qs.emiter.emit(Ht.BindMainView,this.mainViewRef)}render(){return ut.createElement(ut.Fragment,null,this.props.children,ut.createElement("div",{className:"appliance-plugin-main-view-displayer",ref:t=>this.mainViewRef=t}))}};G(pb,"emiter");const Tb=Object.freeze(Object.defineProperty({__proto__:null,ApplianceMultiPlugin:LO,ApplianceNames:Jt,ECanvasShowType:de,EDataType:kt,EForceStopReason:Ja,EImageType:ai,EMatrixrRelationType:si,EOperationType:Ve,EPostMessageType:pt,ERenderFilterType:Rn,EScaleType:ee,EStrokeType:$t,EToolsKey:nt,ElayerType:Xo,EmitEventType:zt,EventMessageType:Oo,EvevtWorkState:Tt,InternalMsgEmitterType:Ht,ShapeType:Ln},Symbol.toStringTag,{value:"Module"}));export{Xt as $,Tt as A,zt as B,me as C,$r as D,kt as F,tn as G,si as H,pv as L,Pr as N,nt as T,Al as V,wv as W,nn as X,Dd as _,Z2 as a,pt as b,ai as c,Ze as d,sn as e,oe as f,Mb as g,zD as h,io as i,Gn as j,de as k,Tb as l,ce as m,mn as o,bo as r,gn as s,lh as x};
