import{r,j as e,P as C,K as A,V as k,a3 as E,aY as M,M as q}from"./react-vendor-C2HUFn5N.js";import{a as _,s as N,B as f,C as j,c as z}from"./lazy-CreateActivityPage.jsx-DYBofU2F.js";import{e as U}from"./page-ActivitiesListPage.jsx-Cv5lq7oV.js";import{u as R}from"./vendor-react-router-B4Bn0PSh.js";import{c as P}from"./utils-vendor-DsQmHAQY.js";import{a as D}from"./utils-small-jbG8BFt3.js";import{A as H,a as L}from"./page-ClassroomsPage.jsx-CWEwUV_W.js";function T(){const{user:s}=_(),[l,i]=r.useState("teacher"),[a,o]=r.useState(!1);return r.useEffect(()=>{let d=!0;return(async()=>{if(s?.id){o(!0);try{const{data:m,error:u}=await N.from("user_roles").select("role").eq("user_id",s.id).maybeSingle();if(!d)return;!u&&m?.role?i(m.role==="student"?"student":"teacher"):i("teacher")}catch{d&&i("teacher")}finally{d&&o(!1)}}})(),()=>{d=!1}},[s?.id]),{role:l,isTeacher:l==="teacher",loading:a}}function O(){const{user:s}=_(),{isTeacher:l}=T(),i=R(),{data:a,loading:o,error:d}=U(s?.id),[m,u]=r.useState([]),[y,x]=r.useState(!0),[h,g]=r.useState(""),v=r.useCallback(async()=>{try{if(x(o),g(d),a){const t=a.map(n=>({id:n.id,title:n.title||"Reunião",class_id:n.class_id,start_time:n.start_time,end_time:n.end_time,description:n.description,status:n.status,created_by:n.created_by}));u(t)}else if(!o){const{data:t,error:n}=await N.from("meetings").select("id, title, class_id, start_time, end_time, description, status, created_by").order("start_time",{ascending:!1}).limit(50);if(n)throw n;u(t||[])}}catch(t){g(t.message||"Falha ao carregar reuniões")}},[a,o,d]);return r.useEffect(()=>{s?.id&&v()},[s?.id,v]),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Salas vinculadas às suas turmas"})}),l&&e.jsxs(f,{onClick:()=>i("/dashboard/calendar"),children:[e.jsx(C,{className:"w-4 h-4 mr-2"})," Agendar pela Agenda"]})]}),y?e.jsx("div",{children:"Carregando…"}):h?e.jsx("div",{className:"text-red-600 text-sm",children:h}):m.length===0?e.jsxs(j,{className:"p-8 text-center",children:[e.jsx(A,{className:"w-8 h-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"font-medium",children:"Nenhuma reunião encontrada"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use a Agenda para criar um novo evento de reunião"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(t=>e.jsxs(j,{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold",children:t.title||"Reunião"}),e.jsx(k,{className:"w-4 h-4 text-muted-foreground"})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.class_id?`Turma: ${t.class_id.slice(0,8)}…`:"Sem turma"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t.start_time?P(new Date(t.start_time),"dd/MM/yyyy HH:mm"):"—"}),e.jsx("div",{className:"pt-2 flex gap-2",children:e.jsxs(f,{size:"sm",variant:"outline",onClick:()=>i(`/meetings/${t.id}`),children:[e.jsx(E,{className:"w-4 h-4 mr-1"})," Entrar"]})})]},t.id))})]})}const Z=Object.freeze(Object.defineProperty({__proto__:null,default:O},Symbol.toStringTag,{value:"Module"})),V=D("animate-pulse rounded-md bg-muted",{variants:{variant:{default:"bg-muted",card:"rounded-lg bg-card",text:"h-4 rounded",circle:"rounded-full",rectangle:"rounded-md"}},defaultVariants:{variant:"default"}}),c=r.forwardRef(({className:s,variant:l,...i},a)=>e.jsx("div",{ref:a,className:z(V({variant:l}),s),...i}));c.displayName="Skeleton";const B=()=>e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"h-8 w-32"}),e.jsx(c,{className:"h-4 w-48"})]}),e.jsx(c,{className:"h-10 w-40"})]}),e.jsx(j,{className:"p-8",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx(c,{className:"w-8 h-8 mx-auto"}),e.jsx(c,{className:"h-6 w-48 mx-auto"}),e.jsx(c,{className:"h-4 w-64 mx-auto"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Array.from({length:6}).map((s,l)=>e.jsxs(j,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{className:"h-5 w-24"}),e.jsx(c,{className:"w-4 h-4"})]}),e.jsx(c,{className:"h-3 w-20"}),e.jsx(c,{className:"h-3 w-16"}),e.jsx("div",{className:"pt-2 flex gap-2",children:e.jsx(c,{className:"h-8 flex-1"})})]},l))})]}),F=()=>{const{user:s}=_(),{isTeacher:l}=T(),i=R(),[a,o]=r.useState([]),[d,m]=r.useState(!0),[u,y]=r.useState(null),x=r.useCallback(async()=>{if(s?.id){m(!0);try{const[{data:h,error:g},{data:v,error:t}]=await Promise.all([N.from("class_members").select("class_id").eq("user_id",s.id),N.from("classes").select("id").eq("created_by",s.id)]);if(g)throw g;if(t)throw t;const n=[...h?.map(w=>w.class_id)||[],...v?.map(w=>w.id)||[]],b=Array.from(new Set(n));let p=N.from("meetings").select(`
          id,
          title,
          class_id,
          start_time,
          end_time,
          description,
          status,
          created_by,
          classes (
            id,
            name
          )
        `).order("start_time",{ascending:!1}).limit(50);b.length>0?p=p.or(`created_by.eq.${s.id},class_id.in.(${b.join(",")})`):p=p.eq("created_by",s.id);const{data:$,error:S}=await p;if(S)throw S;o($||[])}catch(h){y(h.message||"Falha ao carregar reuniões")}finally{m(!1)}}},[s?.id]);return r.useEffect(()=>{x()},[x]),d?e.jsx(B,{}):u?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Reuniões"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Salas vinculadas às suas turmas"})]}),e.jsxs(f,{onClick:x,variant:"outline",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Tentar novamente"]})]}),e.jsxs(H,{variant:"destructive",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsxs(L,{className:"flex items-center justify-between",children:[e.jsx("span",{children:u}),e.jsxs(f,{variant:"outline",size:"sm",onClick:x,children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),"Tentar novamente"]})]})]})]}):e.jsx(I,{meetings:a,isTeacher:l,navigate:i})},I=({meetings:s=[],isTeacher:l,navigate:i})=>Array.isArray(s)?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Reuniões"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Salas vinculadas às suas turmas"})]}),l&&e.jsxs(f,{onClick:()=>i("/dashboard/calendar"),children:[e.jsx(C,{className:"w-4 h-4 mr-2"})," Agendar pela Agenda"]})]}),s.length===0?e.jsxs(j,{className:"p-8 text-center",children:[e.jsx(A,{className:"w-8 h-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"font-medium",children:"Nenhuma reunião encontrada"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use a Agenda para criar um novo evento de reunião"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(a=>e.jsxs(j,{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold",children:a.title||"Reunião"}),e.jsx(k,{className:"w-4 h-4 text-muted-foreground"})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.classes?.name?`Turma: ${a.classes.name}`:"Sem turma"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:a.start_time?P(new Date(a.start_time),"dd/MM/yyyy HH:mm"):"—"}),e.jsx("div",{className:"pt-2 flex gap-2",children:e.jsxs(f,{size:"sm",variant:"outline",onClick:()=>i(`/meetings/${a.id}`),children:[e.jsx(E,{className:"w-4 h-4 mr-1"})," Entrar"]})})]},a.id))})]}):null,ee=Object.freeze(Object.defineProperty({__proto__:null,default:F},Symbol.toStringTag,{value:"Module"}));export{Z as M,ee as a};
