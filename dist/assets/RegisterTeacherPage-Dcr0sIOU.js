import{g as T,v as V,r as l,w as s,s as c,j as e,x as v,y as j,D as k,F as C,H as S,I as E,i as _,m as z,J as u,K as h,e as U}from"./main-7VZoQpWp.js";import{G as A}from"./graduation-cap-B2Ev9e8_.js";import{S as B}from"./school-DfQSkp2Z.js";import{U as M}from"./user-8zap3yVI.js";import{M as O}from"./mail-D6lmW9dN.js";import{L as D}from"./lock-DjtzCIXt.js";const Q=()=>{const f=T(),[w]=V(),d=w.get("invite"),N=w.get("school"),[b,y]=l.useState(!1),[I,x]=l.useState(!0),[P,m]=l.useState(!1),[n,F]=l.useState(null),[a,i]=l.useState({fullName:"",email:"",password:"",confirmPassword:""});l.useEffect(()=>{L()},[d]);const L=async()=>{if(!d){s.error("Link de convite inválido"),x(!1);return}try{x(!0);const{data:r,error:t}=await c.from("teacher_invites").select("*, schools(id, name)").eq("invite_token",d).eq("status","pending").single();if(t||!r){s.error("Convite não encontrado ou já foi utilizado"),m(!1);return}if(new Date(r.expires_at)<new Date){s.error("Este convite expirou"),m(!1);return}F(r),m(!0),r.email&&i(o=>({...o,email:r.email})),r.teacher_name&&i(o=>({...o,fullName:r.teacher_name})),s.success(`Bem-vindo(a) à ${r.schools?.name||N}!`)}catch(r){console.error("Erro ao validar convite:",r),s.error("Erro ao validar convite"),m(!1)}finally{x(!1)}},q=async r=>{if(r.preventDefault(),!a.fullName||!a.email||!a.password){s.error("Preencha todos os campos obrigatórios");return}if(a.password!==a.confirmPassword){s.error("As senhas não coincidem");return}if(a.password.length<6){s.error("A senha deve ter pelo menos 6 caracteres");return}y(!0);try{const{data:t,error:o}=await c.auth.signUp({email:a.email,password:a.password,options:{data:{full_name:a.fullName,role:"teacher"}}});if(o)throw o;if(!t.user)throw new Error("Erro ao criar usuário");const{error:p}=await c.from("profiles").insert({id:t.user.id,full_name:a.fullName,email:a.email,role:"teacher",avatar_url:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(p&&p.code!=="23505"&&console.warn("Erro ao criar perfil:",p),n?.school_id){const{error:g}=await c.from("school_teachers").insert({school_id:n.school_id,user_id:t.user.id,status:"active",joined_at:new Date().toISOString()});g&&g.code!=="23505"&&console.warn("Erro ao vincular à escola:",g)}await c.from("teacher_invites").update({status:"accepted"}).eq("invite_token",d),s.success("Cadastro realizado com sucesso! Bem-vindo(a) ao TamanduAI!"),setTimeout(()=>{f("/login?registered=true&email="+encodeURIComponent(a.email))},2e3)}catch(t){console.error("Erro ao cadastrar:",t),t.message?.includes("already registered")?s.error("Este email já está cadastrado. Faça login."):s.error("Erro ao criar conta: "+(t.message||"Tente novamente"))}finally{y(!1)}};return I?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-indigo-50 to-blue-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 flex items-center justify-center p-4",children:e.jsx(v,{className:"w-full max-w-md",children:e.jsxs(j,{className:"pt-6 flex flex-col items-center gap-4",children:[e.jsx(k,{className:"w-12 h-12 animate-spin text-purple-600"}),e.jsx("p",{className:"text-center text-muted-foreground",children:"Validando convite..."})]})})}):P?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-indigo-50 to-blue-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 flex items-center justify-center p-4",children:e.jsx(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-md",children:e.jsxs(v,{className:"shadow-2xl border-0",children:[e.jsxs(C,{className:"space-y-4 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-t-lg",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-full flex items-center justify-center backdrop-blur",children:e.jsx(A,{className:"w-8 h-8"})})}),e.jsx(S,{className:"text-2xl font-bold text-center",children:"Cadastro de Professor"}),e.jsxs(E,{className:"text-center text-purple-100",children:["Você foi convidado para fazer parte da"," ",e.jsx("strong",{className:"text-white",children:n?.schools?.name||N})]})]}),e.jsxs(j,{className:"pt-6 space-y-4",children:[n?.schools?.name&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[e.jsx(B,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-green-900 dark:text-green-100",children:n.schools.name}),e.jsx("p",{className:"text-xs text-green-700 dark:text-green-300",children:"Você será vinculado automaticamente a esta escola"})]})]}),e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"fullName",children:"Nome Completo"}),e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(h,{id:"fullName",type:"text",placeholder:"Seu nome completo",value:a.fullName,onChange:r=>i({...a,fullName:r.target.value}),className:"pl-10 bg-white dark:bg-slate-900",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"email",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(h,{id:"email",type:"email",placeholder:"seu@email.com",value:a.email,onChange:r=>i({...a,email:r.target.value}),className:"pl-10 bg-white dark:bg-slate-900",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"password",children:"Senha"}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(h,{id:"password",type:"password",placeholder:"Mínimo 6 caracteres",value:a.password,onChange:r=>i({...a,password:r.target.value}),className:"pl-10 bg-white dark:bg-slate-900",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"confirmPassword",children:"Confirmar Senha"}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(h,{id:"confirmPassword",type:"password",placeholder:"Digite a senha novamente",value:a.confirmPassword,onChange:r=>i({...a,confirmPassword:r.target.value}),className:"pl-10 bg-white dark:bg-slate-900",required:!0})]})]}),e.jsx(_,{type:"submit",className:"w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white whitespace-nowrap inline-flex items-center justify-center gap-2",disabled:b,children:b?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-4 h-4 animate-spin"}),"Criando conta..."]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-4 h-4"}),"Criar Conta"]})})]}),e.jsx("div",{className:"text-center pt-4 border-t",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Já tem uma conta?"," ",e.jsx("button",{onClick:()=>f("/login"),className:"text-purple-600 hover:underline font-medium",children:"Fazer Login"})]})})]})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-indigo-50 to-blue-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 flex items-center justify-center p-4",children:e.jsxs(v,{className:"w-full max-w-md",children:[e.jsxs(C,{children:[e.jsx(S,{className:"text-center text-red-600",children:"Convite Inválido"}),e.jsx(E,{className:"text-center",children:"Este link de convite não é válido ou já expirou."})]}),e.jsx(j,{className:"flex justify-center",children:e.jsx(_,{onClick:()=>f("/login"),variant:"outline",children:"Ir para Login"})})]})})};export{Q as default};
