import{ak as _,u as N,r as a,j as e,M as c,s as d,aq as v}from"./main-NgjJy_CG.js";import{P as w}from"./PremiumCard-BGO_It48.js";import{P as E}from"./PremiumButton-DDGOGflQ.js";import{E as j}from"./EmptyState-Cb7n_MKP.js";import{S as P}from"./send-DtvIXJ49.js";const L=()=>{const{classId:k,discussionId:r}=_(),{user:l}=N(),[q,m]=a.useState(!0),[i,y]=a.useState(null),[u,x]=a.useState([]),[o,p]=a.useState(""),[g,f]=a.useState(!1);a.useEffect(()=>{(async()=>{m(!0);try{const{data:t,error:n}=await d.from("discussions").select("id, title, description, class_id, created_by, created_at").eq("id",r).maybeSingle();if(n)throw n;y(t);const{data:S,error:h}=await d.from("discussion_messages").select("id, content, user_id, created_at, is_deleted, is_edited").eq("discussion_id",r).order("created_at",{ascending:!0});if(h)throw h;x(S||[])}catch(t){console.error("Erro ao carregar discussão:",t)}finally{m(!1)}})()},[r]);const b=async()=>{if(!(!o.trim()||!l?.id)){f(!0);try{const{data:s,error:t}=await d.from("discussion_messages").insert({discussion_id:r,user_id:l.id,content:o.trim()}).select().maybeSingle();if(t)throw t;x(n=>[...n,s]),p(""),v.success?.("Mensagem enviada")}catch(s){console.error("Erro ao enviar mensagem:",s),v.error?.("Falha ao enviar mensagem")}finally{f(!1)}}};return i?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-sky-600 to-indigo-600 p-8 rounded-2xl text-white",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-3",children:[e.jsx(c,{className:"w-6 h-6"})," ",i.title]}),i.description&&e.jsx("p",{className:"text-slate-900 dark:text-white/90",children:i.description})]}),e.jsx(w,{variant:"elevated",children:e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-y-auto pr-2",children:u.length===0?e.jsx(j,{icon:c,title:"Sem mensagens",description:"Comece a conversa."}):u.map(s=>e.jsxs("div",{className:"p-3 rounded-lg border border-border",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:new Date(s.created_at).toLocaleString("pt-BR")}),e.jsx("div",{className:"mt-1",children:s.content})]},s.id))}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"text",placeholder:"Escreva uma mensagem",value:o,onChange:s=>p(s.target.value),className:"flex-1 px-3 py-2 rounded-lg border border-border bg-background"}),e.jsx(E,{onClick:b,disabled:g||!o.trim(),leftIcon:P,children:g?"Enviando...":"Enviar"})]})]})})]}):e.jsx(j,{icon:c,title:"Discussão não encontrada",description:"Verifique o link."})};export{L as default};
