import{s as N,u as z,g as Y,r as l,U as V,B as M,ah as X,C as ce,j as e,m as n,x as c,y as o,H as u,I as be,i as g,F as v,c as J,as as K,d as U,T as Ne,S as ve,A as ye,a1 as ae,k as we,G as Ce,at as Se,au as B}from"./main-Cv3DLBs1.js";import{A as te,a as ie}from"./alert-Bf0I8wAs.js";import{B as y}from"./badge-CS76XO47.js";import{B as Ae}from"./bell-DQXYVwvp.js";import{A as _}from"./arrow-right-ErUN0Gvu.js";import{P as H}from"./plus-CHwJ6wYR.js";import{B as ke}from"./bot-vLlYw4u7.js";import{T as _e}from"./triangle-alert-CBBn_PMG.js";import{f as L}from"./format-BmB7BMvl.js";import{T as O}from"./trophy-JDAK_dof.js";import{T as oe}from"./target-BazIADWF.js";import{F as re}from"./flame-BLe9Dg-q.js";import{B as De}from"./brain-DCid2MOH.js";import{C as G}from"./circle-check-big-Ca-JuLlv.js";import{M as Te}from"./message-circle-Bu-Y95O-.js";import{s as F}from"./schoolService-wSgqT6WY.js";import{G as Q}from"./graduation-cap-DKKAn8fv.js";import{S as Pe}from"./school-C35I8HUE.js";import{S as le}from"./shield-CrqxEPi9.js";import"./en-US-C1KUdeex.js";import"./toDate-B_SDEMqy.js";const W={maxClasses:5};async function de(r){try{const{count:a,error:x}=await N.from("classes").select("id",{count:"exact",head:!0}).eq("created_by",r);if(x)throw x;return a||0}catch{return 0}}async function Ee(r){try{return await de(r)<W.maxClasses}catch{return!0}}async function Re(r){const a=await de(r);return{plan:"free",limits:W,usage:{classes:a},available:{classes:Math.max(0,W.maxClasses-a)}}}const ne={checkCanCreateClass:Ee,getUsageStats:Re},Me=()=>{const{user:r}=z(),a=Y(),[x,w]=l.useState({classes:0,students:0,activities:0,pendingCorrections:0}),[m,D]=l.useState(null),[h,T]=l.useState(null),[C,j]=l.useState([]),[S,P]=l.useState([]),[f,E]=l.useState(!0),[R,t]=l.useState([]),[d,$]=l.useState([]),[q,I]=l.useState([]);l.useEffect(()=>{i()},[r]);const i=async()=>{if(r)try{E(!0);const{data:s}=await N.from("classes").select("*").eq("created_by",r.id),b=s?s.map(p=>p.id):[];w(p=>({...p,classes:s?.length||0}));const{count:me}=await N.from("class_members").select("id",{count:"exact",head:!1}).in("class_id",b).eq("role","student");await N.from("class_members").select("id").in("class_id",b).eq("role","student").limit(0),w(p=>({...p,students:me||0}));const{count:xe}=await N.from("activities").select("id",{count:"exact",head:!1}).eq("created_by",r.id).limit(0);w(p=>({...p,activities:xe||0}));const{count:he}=await N.from("submissions").select("id",{count:"exact",head:!1}).in("activities.activity_class_assignments.class_id",b).eq("status","submitted").limit(0);w(p=>({...p,pendingCorrections:he||0}));const{data:ge}=await N.from("classes").select("*").eq("teacher_id",r.id).order("created_at",{ascending:!1}).limit(6);j(ge||[]);const pe=await ne.getTeacherSubscription(r.id);D(pe);const je=await ne.getUsageStats(r.id);T(je),P([]);const Z=L(new Date,"yyyy-MM-dd"),{data:ue}=await N.from("events").select("*").eq("created_by",r.id).gte("date",Z).lte("date",Z).order("start_time",{ascending:!0});t(ue||[]),$([]);const{data:fe}=await N.from("activities").select("id").eq("created_by",r.id),ee=(fe||[]).map(p=>p.id);let se=[];if(ee.length>0){const{data:p}=await N.from("submissions").select("*, activities(*), profiles:student_id(*)").in("activity_id",ee).eq("status","submitted").order("submitted_at",{ascending:!1});se=p||[]}I(se||[])}catch(s){console.error("Erro ao carregar dados do dashboard:",s)}finally{E(!1)}},A=[{title:"Alunos",value:x.students,subtitle:"Total de alunos",icon:V,gradient:"from-blue-500 to-blue-700"},{title:"Turmas",value:x.classes,subtitle:"Turmas ativas",icon:M,gradient:"from-green-500 to-green-700"},{title:"Atividades",value:x.activities,subtitle:"Atividades criadas",icon:X,gradient:"from-purple-500 to-purple-700"},{title:"Pendentes",value:x.pendingCorrections,subtitle:"Aguardando correção",icon:ce,alert:x.pendingCorrections>0,gradient:"from-amber-500 to-amber-700"}],k=[{title:"Nova Turma",description:"Criar uma nova turma",icon:H,path:"/dashboard/classes/new",gradient:"from-blue-500 to-blue-700"},{title:"Nova Atividade",description:"Criar uma nova atividade",icon:X,path:"/dashboard/activities/new",gradient:"from-purple-500 to-purple-700"},{title:"Agendar",description:"Agendar um novo evento",icon:U,path:"/dashboard/calendar",gradient:"from-amber-500 to-amber-700"}];return f?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando seu dashboard..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6 space-y-6",children:[e.jsxs(n.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent",children:"Olá, Professor! 👋"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Bem-vindo ao seu painel de controle"})]}),m&&e.jsx(y,{className:"bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-3 py-1 text-sm",children:m.plan_name})]}),S.length>0&&e.jsx(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsx(c,{className:"border-l-4 border-l-amber-500",children:e.jsxs(o,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ae,{className:"h-5 w-5 text-amber-500 mr-2"}),e.jsxs(u,{className:"text-sm font-medium",children:["Você tem ",S.length," notificações"]})]}),e.jsx(be,{className:"mt-2",children:S[0].message}),e.jsx(g,{variant:"link",className:"p-0 mt-2 text-amber-600",onClick:()=>a("/dashboard/notifications"),children:"Ver todas"})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:A.map((s,b)=>e.jsx(n.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:b*.1},children:e.jsxs(c,{className:"relative overflow-hidden hover:shadow-xl transition-shadow duration-300",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 bg-gradient-to-br ${s.gradient} opacity-10 rounded-full -mr-16 -mt-16`}),e.jsxs(v,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(u,{className:"text-sm font-medium text-gray-600",children:s.title}),e.jsx("div",{className:`p-3 rounded-lg bg-gradient-to-br ${s.gradient} flex items-center justify-center`,children:e.jsx(s.icon,{className:"h-5 w-5 text-white"})})]}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-3xl font-bold text-gray-900",children:[s.value,s.alert&&e.jsx(J,{className:"inline ml-2 h-5 w-5 text-orange-500"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.subtitle}),s.progress!==void 0&&s.progress>0&&e.jsx(K,{value:s.progress,className:"mt-3 h-2"})]})]})},b))}),e.jsx("div",{className:"mt-2",children:e.jsx(c,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Atividades aguardando correção"}),e.jsx("p",{className:"text-4xl font-bold text-gray-900 mt-1",children:x.pendingCorrections})]}),e.jsxs(g,{variant:"ghost",onClick:()=>a("/dashboard/activities/pending"),className:"text-indigo-600 hover:text-indigo-700 flex items-center whitespace-nowrap shrink-0",children:["Ver pendentes",e.jsx(_,{className:"ml-2 h-4 w-4"})]})]})})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-900",children:"Ações Rápidas"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:k.map((s,b)=>e.jsx(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2+b*.1},whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(c,{className:"cursor-pointer h-full hover:shadow-lg transition-shadow duration-300",onClick:()=>a(s.path),children:e.jsx(o,{className:"p-6 pt-7",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:`p-3 inline-flex rounded-lg bg-gradient-to-br ${s.gradient} flex items-center justify-center shadow-sm`,children:e.jsx(s.icon,{className:"h-5 w-5 text-white"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.title}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s.description})]}),s.indicator&&e.jsx("div",{className:"mt-4 flex items-center",children:e.jsx(y,{variant:"outline",className:"bg-gray-100",children:s.indicator})})]})})})},b))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Turmas Recentes"}),e.jsxs(g,{variant:"ghost",onClick:()=>a("/dashboard/classes"),className:"text-indigo-600 hover:text-indigo-700 flex items-center whitespace-nowrap",children:[e.jsx("span",{children:"Ver todas"}),e.jsx(_,{className:"ml-2 h-4 w-4"})]})]}),C.length===0?e.jsx(c,{className:"border-dashed border-2 md:p-12 align-middle",children:e.jsxs(o,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(M,{className:"h-12 w-14 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Você ainda não tem turmas"}),e.jsxs(g,{className:"bg-gradient-to-r from-indigo-600 to-purple-600 text-white",onClick:()=>a("/dashboard/classes/new"),children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"Criar primeira turma"]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:C.map((s,b)=>e.jsx(n.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:b*.1},children:e.jsx(c,{className:"cursor-pointer hover:shadow-lg transition-shadow duration-300",onClick:()=>a(`/dashboard/classes/${s.id}`),children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-2 h-12 rounded-full ${s.color||"bg-indigo-500"} mr-4`}),e.jsxs("div",{children:[s.has_chatbot&&e.jsxs(y,{className:"bg-blue-100 text-blue-800 mb-1 flex items-center w-fit",children:[e.jsx(ke,{className:"h-3 w-3 mr-1"}),"Chatbot"]}),e.jsx("h3",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Criada em ",L(new Date(s.created_at),"dd/MM/yyyy")]})]})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("div",{className:"flex items-center text-gray-500 text-sm",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),s.student_count||0]}),e.jsx(_,{className:"h-4 w-4 text-gray-400 mt-2"})]})]})})})},s.id))})]}),e.jsxs("div",{className:"mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(c,{children:[e.jsx(v,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{className:"text-lg font-semibold",children:"Eventos de Hoje"}),e.jsxs(g,{variant:"ghost",onClick:()=>a("/dashboard/calendar"),className:"text-indigo-600 hover:text-indigo-700 flex items-center whitespace-nowrap shrink-0",children:[e.jsx("span",{children:"Ver calendário"}),e.jsx(_,{className:"ml-2 h-4 w-4"})]})]})}),e.jsx(o,{children:R.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(U,{className:"h-10 w-10 text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Nenhum evento programado para hoje"})]}):e.jsx("div",{className:"space-y-3",children:R.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(U,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium leading-5",children:s.title}),e.jsxs("p",{className:"text-xs text-gray-500",children:[L(new Date(`${s.date}T${s.start_time}`),"HH:mm")," - ",L(new Date(`${s.date}T${s.end_time}`),"HH:mm")]})]})]}),e.jsx(y,{variant:"outline",className:"bg-blue-50 shrink-0",children:s.type})]},s.id))})})]}),e.jsxs(c,{children:[e.jsx(v,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{className:"text-lg font-semibold",children:"Alunos que precisam de atenção"}),e.jsxs(g,{variant:"ghost",onClick:()=>a("/dashboard/analytics/students"),className:"text-indigo-600 hover:text-indigo-700 flex items-center whitespace-nowrap shrink-0",children:[e.jsx("span",{children:"Ver análise"}),e.jsx(_,{className:"ml-2 h-4 w-4"})]})]})}),e.jsx(o,{children:d.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(V,{className:"h-10 w-10 text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Todos os alunos estão com bom engajamento"})]}):e.jsx("div",{className:"space-y-3",children:d.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 rounded-lg bg-orange-100 flex items-center justify-center",children:e.jsx(_e,{className:"h-5 w-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium leading-5",children:s.profiles.full_name}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(K,{value:s.engagement_score,className:"h-2 w-24 mr-2"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[s.engagement_score,"% engajamento"]})]})]})]}),e.jsx(g,{size:"sm",variant:"outline",className:"shrink-0",onClick:()=>a(`/dashboard/students/${s.profiles.id}`),children:"Ver perfil"})]},s.id))})})]})]})]})},$e=()=>{const{user:r}=z(),a=Y(),[x,w]=l.useState(null),[m,D]=l.useState({classes:0,activities:0,pending:0,completed:0,avgGrade:0}),[h,T]=l.useState({xp:0,level:1,streak:0,badges:[],rankPosition:0}),[C,j]=l.useState([]),[S,P]=l.useState([]),[f,E]=l.useState(null),[R,t]=l.useState(!0);l.useEffect(()=>{d()},[r]);const d=async()=>{if(r)try{t(!0),D({classes:3,activities:12,pending:4,completed:8,avgGrade:8.5}),T({xp:1250,level:5,streak:7,badges:[],rankPosition:12}),j([{id:"1",title:"Exercícios de Matemática",due_date:new Date(Date.now()+2*24*60*60*1e3).toISOString(),class_name:"Matemática 9º Ano"},{id:"2",title:"Redação sobre Literatura",due_date:new Date(Date.now()+5*24*60*60*1e3).toISOString(),class_name:"Português"},{id:"3",title:"Projeto de Ciências",due_date:new Date(Date.now()+7*24*60*60*1e3).toISOString(),class_name:"Ciências"}]),P([{id:"1",grade:9.5,activities:{title:"Quiz de História"}},{id:"2",grade:8,activities:{title:"Trabalho de Geografia"}},{id:"3",grade:9,activities:{title:"Prova de Matemática"}}]),E({success:!0,prediction:{nextGrade:8.7,trend:"improving",approvalProbability:92},status:{isAtRisk:!1},confidence:85,recommendations:["Continue praticando exercícios de matemática","Revise os conceitos de literatura","Participe mais das discussões em sala"]})}catch(i){console.error("Erro ao carregar dashboard:",i)}finally{t(!1)}},$=h.level*100,q=h.xp%100/$*100,I=[{icon:O,title:"Nível",value:h.level,subtitle:`${h.xp} XP total`,gradient:"from-yellow-500 to-orange-500",progress:q},{icon:oe,title:"Média Geral",value:m.avgGrade.toFixed(1),subtitle:"de 10.0",gradient:"from-green-500 to-teal-500",trend:f?.prediction?.trend},{icon:M,title:"Atividades",value:m.pending,subtitle:"Pendentes",gradient:"from-blue-500 to-cyan-500",alert:m.pending>5},{icon:re,title:"Sequência",value:h.streak,subtitle:"Dias consecutivos",gradient:"from-red-500 to-pink-500"}];return R?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6 space-y-6",children:[e.jsxs(n.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent",children:"Olá, Estudante! 🎓"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Continue aprendendo e alcançando suas metas"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(y,{className:"bg-gradient-to-r from-yellow-500 to-orange-500 text-white px-4 py-2",children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),"Nível ",h.level]}),h.streak>0&&e.jsxs(y,{className:"bg-gradient-to-r from-red-500 to-pink-500 text-white px-4 py-2",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),h.streak," dias"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:I.map((i,A)=>e.jsx(n.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:A*.1},children:e.jsxs(c,{className:"relative overflow-hidden hover:shadow-xl transition-shadow duration-300",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 bg-gradient-to-br ${i.gradient} opacity-10 rounded-full -mr-16 -mt-16`}),e.jsxs(v,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(u,{className:"text-sm font-medium text-gray-600",children:i.title}),e.jsx("div",{className:`p-2 rounded-lg bg-gradient-to-br ${i.gradient}`,children:e.jsx(i.icon,{className:"h-4 w-4 text-white"})})]}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[i.value,i.trend==="improving"&&e.jsx(Ne,{className:"h-5 w-5 text-green-500"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:i.subtitle}),i.progress!==void 0&&i.progress>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx(K,{value:i.progress,className:"h-2"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[Math.round(i.progress),"% para o próximo nível"]})]})]})]})},A))}),f&&e.jsx(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:e.jsx(c,{className:"bg-gradient-to-r from-indigo-600 to-purple-600 text-white border-none",children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(De,{className:"h-6 w-6"}),e.jsx("h3",{className:"text-xl font-bold",children:"Previsão de IA"}),e.jsx(y,{className:"bg-white/20 text-white border-none",children:"Machine Learning"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-indigo-200 text-sm mb-1",children:"Próxima Nota"}),e.jsx("p",{className:"text-3xl font-bold",children:f.prediction.nextGrade})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-indigo-200 text-sm mb-1",children:"Tendência"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("p",{className:"text-2xl font-bold capitalize",children:f.prediction.trend==="improving"?"📈 Melhorando":f.prediction.trend==="declining"?"📉 Caindo":"➡️ Estável"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-indigo-200 text-sm mb-1",children:"Chance de Aprovação"}),e.jsxs("p",{className:"text-3xl font-bold",children:[f.prediction.approvalProbability,"%"]})]})]}),f.status.isAtRisk&&e.jsxs("div",{className:"mt-4 bg-red-500/20 border border-red-300 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"⚠️ Atenção: Você está em risco de reprovação"}),e.jsx("p",{className:"text-xs mt-1 text-indigo-100",children:"Recomendamos revisar os materiais e pedir ajuda ao professor"})]})]}),e.jsxs(g,{className:"bg-white text-indigo-600 hover:bg-gray-100",onClick:()=>a("/students/activities"),children:["Ver Detalhes",e.jsx(_,{className:"ml-2 h-4 w-4"})]})]})})})}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsx(n.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.5},children:e.jsxs(c,{children:[e.jsx(v,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5 text-indigo-600"}),"Próximas Atividades"]}),e.jsxs(g,{variant:"ghost",size:"sm",onClick:()=>a("/students/activities"),children:["Ver todas",e.jsx(_,{className:"ml-2 h-4 w-4"})]})]})}),e.jsx(o,{className:"space-y-3",children:C.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(G,{className:"h-12 w-12 mx-auto mb-2 text-green-500"}),e.jsx("p",{children:"Tudo em dia! 🎉"})]}):C.map((i,A)=>{const k=Math.ceil((new Date(i.due_date)-new Date)/864e5),s=k<=2;return e.jsx(n.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:A*.1},className:`p-4 rounded-lg border-2 cursor-pointer hover:shadow-md transition-all ${s?"border-red-300 bg-red-50":"border-gray-200 bg-gray-50"}`,onClick:()=>a(`/dashboard/activities/${i.id}`),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:i.title}),e.jsx("p",{className:"text-sm text-gray-600",children:i.classes.name})]}),e.jsxs(y,{className:s?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700",children:[e.jsx(ce,{className:"h-3 w-3 mr-1"}),k," ",k===1?"dia":"dias"]})]})},i.id)})})]})}),e.jsx(n.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.6},children:e.jsxs(c,{children:[e.jsx(v,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5 text-yellow-600"}),"Notas Recentes"]})}),e.jsx(o,{className:"space-y-3",children:S.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(X,{className:"h-12 w-12 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"Nenhuma nota ainda"})]}):S.map((i,A)=>{const k=parseFloat(i.grade),s=k>=9?"text-green-600 bg-green-100":k>=7?"text-blue-600 bg-blue-100":k>=5?"text-yellow-600 bg-yellow-100":"text-red-600 bg-red-100";return e.jsx(n.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:A*.1},className:"p-4 rounded-lg border-2 border-gray-200 bg-gray-50 hover:shadow-md transition-all cursor-pointer",onClick:()=>a(`/dashboard/activities/${i.activity_id}`),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:i.activities.title}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(i.submitted_at).toLocaleDateString("pt-BR")})]}),e.jsx("div",{className:`text-2xl font-bold px-4 py-2 rounded-lg ${s}`,children:k.toFixed(1)})]})},i.id)})})]})})]}),h.badges.length>0&&e.jsx(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},children:e.jsxs(c,{children:[e.jsx(v,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5 text-purple-600"}),"Suas Conquistas (",h.badges.length,")"]})}),e.jsx(o,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:h.badges.map((i,A)=>e.jsxs(n.div,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{delay:A*.05},className:"flex flex-col items-center p-4 bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl hover:shadow-lg transition-all cursor-pointer",children:[e.jsx("div",{className:"text-4xl mb-2",children:i.badges_catalog.icon||"🏆"}),e.jsx("p",{className:"text-xs font-semibold text-center text-gray-900",children:i.badges_catalog.name})]},i.badge_id))})})]})}),e.jsx(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8},children:e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsx(c,{className:"cursor-pointer hover:shadow-xl transition-all border-2 border-transparent hover:border-purple-200",onClick:()=>a("/dashboard/chatbot"),children:e.jsxs(o,{className:"p-6 text-center",children:[e.jsx(Te,{className:"h-12 w-12 mx-auto mb-3 text-purple-600"}),e.jsx("h3",{className:"font-bold text-lg mb-1",children:"Tirar Dúvidas"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Chatbot 24/7 com IA"})]})}),e.jsx(c,{className:"cursor-pointer hover:shadow-xl transition-all border-2 border-transparent hover:border-green-200",onClick:()=>a("/dashboard/calendar"),children:e.jsxs(o,{className:"p-6 text-center",children:[e.jsx(U,{className:"h-12 w-12 mx-auto mb-3 text-green-600"}),e.jsx("h3",{className:"font-bold text-lg mb-1",children:"Minha Agenda"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Ver prazos e eventos"})]})}),e.jsx(c,{className:"cursor-pointer hover:shadow-xl transition-all border-2 border-transparent hover:border-indigo-200",onClick:()=>a("/students/gamification"),children:e.jsxs(o,{className:"p-6 text-center",children:[e.jsx(O,{className:"h-12 w-12 mx-auto mb-3 text-yellow-600"}),e.jsx("h3",{className:"font-bold text-lg mb-1",children:"Rankings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Ver sua posição"})]})})]})})]})},Ge=()=>{const{user:r}=z(),a=Y(),[x,w]=l.useState(null),[m,D]=l.useState({teachers:0,students:0,classes:0,activities:0,avgPerformance:0}),[h,T]=l.useState([]),[C,j]=l.useState([]),[S,P]=l.useState(!0);l.useEffect(()=>{f()},[r]);const f=async()=>{if(r)try{P(!0);const t=await F.getUserSchool(r.id);if(!t){console.log("Nenhuma escola encontrada para o usuário"),P(!1);return}w(t);try{const d=await F.getDashboardStats(t.id);D({teachers:d.totalTeachers||0,students:d.totalStudents||0,classes:d.totalClasses||0,activities:d.submissionsLast30Days||0,avgPerformance:parseFloat(d.averageGrade)||0});const $=await F.getTeachers(t.id);T($.slice(0,5)||[]);const q=await F.getClasses(t.id);j(q.slice(0,5)||[])}catch(d){console.warn("Erro ao carregar estatísticas detalhadas:",d),D({teachers:0,students:0,classes:0,activities:0,avgPerformance:0}),T([]),j([])}}catch(t){console.error("Erro ao carregar dashboard:",t),w({id:"temp-school",name:"Minha Escola",logo_url:null,settings:null})}finally{P(!1)}},E=[{icon:Q,title:"Professores",value:m.teachers,subtitle:"Vinculados",gradient:"from-indigo-600 to-purple-600"},{icon:V,title:"Alunos",value:m.students,subtitle:"Total na rede",gradient:"from-blue-600 to-cyan-600"},{icon:M,title:"Turmas",value:m.classes,subtitle:"Ativas",gradient:"from-green-600 to-teal-600"},{icon:oe,title:"Desempenho",value:m.avgPerformance.toFixed(1),subtitle:"Média geral",gradient:"from-orange-600 to-amber-600"}],R=[{icon:H,title:"Convidar Professor",description:"Adicionar novo professor",action:()=>a("/school/teachers"),gradient:"from-indigo-600 to-purple-600"},{icon:we,title:"Relatórios",description:"Analytics consolidado",action:()=>a("/school/reports"),gradient:"from-green-600 to-teal-600"},{icon:ae,title:"Configurações",description:"Gerenciar escola",action:()=>a("/school/settings"),gradient:"from-orange-600 to-red-600"},{icon:Ce,title:"Comunicação",description:"Enviar avisos",action:()=>a("/school/comms"),gradient:"from-pink-600 to-rose-600"}];return S?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-600"})}):x?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6 space-y-6",children:[e.jsxs(n.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent",children:x.name}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Painel de Gestão Escolar"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(y,{className:"bg-gradient-to-r from-orange-600 to-red-600 text-white px-4 py-2",children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Enterprise"]}),e.jsxs(g,{variant:"outline",onClick:()=>a("/school/settings"),children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Configurações"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:E.map((t,d)=>e.jsx(n.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:d*.1},children:e.jsxs(c,{className:"relative overflow-hidden hover:shadow-xl transition-shadow duration-300",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 bg-gradient-to-br ${t.gradient} opacity-10 rounded-full -mr-16 -mt-16`}),e.jsxs(v,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(u,{className:"text-sm font-medium text-gray-600",children:t.title}),e.jsx("div",{className:`p-2 rounded-lg bg-gradient-to-br ${t.gradient}`,children:e.jsx(t.icon,{className:"h-4 w-4 text-white"})})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:t.value}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t.subtitle})]})]})},d))}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-900",children:"Ações Rápidas"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:R.map((t,d)=>e.jsx(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2+d*.1},whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(c,{className:"cursor-pointer hover:shadow-2xl transition-all duration-300 border-2 border-transparent hover:border-orange-200",onClick:t.action,children:e.jsxs(o,{className:"p-6",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl bg-gradient-to-r ${t.gradient} flex items-center justify-center mb-4`,children:e.jsx(t.icon,{className:"h-6 w-6 text-white"})}),e.jsx("h3",{className:"font-bold text-lg mb-1",children:t.title}),e.jsx("p",{className:"text-sm text-gray-600",children:t.description})]})})},d))})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsx(n.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},children:e.jsxs(c,{children:[e.jsx(v,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5 text-indigo-600"}),"Professores Recentes"]}),e.jsxs(g,{variant:"ghost",size:"sm",onClick:()=>a("/school/teachers"),children:["Ver todos",e.jsx(_,{className:"ml-2 h-4 w-4"})]})]})}),e.jsx(o,{className:"space-y-3",children:h.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Q,{className:"h-12 w-12 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"Nenhum professor vinculado ainda"})]}):h.map((t,d)=>e.jsx(n.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:d*.1},className:"p-4 rounded-lg border-2 border-gray-200 bg-gray-50 hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.name||"Sem nome"}),e.jsx("p",{className:"text-sm text-gray-600",children:t.email})]}),e.jsxs(y,{className:t.status==="active"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700",children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),t.status==="active"?"Ativo":"Inativo"]})]})},t.id))})]})}),e.jsx(n.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.5},children:e.jsxs(c,{children:[e.jsx(v,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5 text-green-600"}),"Turmas Mais Populares"]}),e.jsxs(g,{variant:"ghost",size:"sm",onClick:()=>a("/school/classes"),children:["Ver todas",e.jsx(_,{className:"ml-2 h-4 w-4"})]})]})}),e.jsx(o,{className:"space-y-3",children:C.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(M,{className:"h-12 w-12 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"Nenhuma turma criada ainda"})]}):C.map((t,d)=>e.jsx(n.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:d*.1},className:"p-4 rounded-lg border-2 border-gray-200 bg-gray-50 hover:shadow-md transition-all cursor-pointer",onClick:()=>a(`/dashboard/classes/${t.id}`),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(V,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[t.studentCount," alunos"]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["• ",t.teacherName]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx(y,{className:"bg-blue-100 text-blue-700",children:t.subject||"Geral"})})]})},t.id))})]})})]}),e.jsx(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},children:e.jsx(c,{className:"bg-gradient-to-r from-orange-600 to-red-600 text-white border-none",children:e.jsx(o,{className:"p-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold mb-2",children:"Resumo do Mês"}),e.jsx("p",{className:"text-orange-100 mb-4",children:"Sua escola está crescendo! Continue assim."}),e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-200 text-sm mb-1",children:"Novos Alunos"}),e.jsxs("p",{className:"text-3xl font-bold",children:["+",Math.floor(m.students*.1)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-200 text-sm mb-1",children:"Atividades"}),e.jsx("p",{className:"text-3xl font-bold",children:m.activities})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-200 text-sm mb-1",children:"Engajamento"}),e.jsx("p",{className:"text-3xl font-bold",children:m.avgPerformance>=7?"85%":"70%"})]})]})]}),e.jsxs(g,{className:"bg-white text-orange-600 hover:bg-gray-100",onClick:()=>a("/school/reports"),children:["Ver Relatório Completo",e.jsx(_,{className:"ml-2 h-4 w-4"})]})]})})})}),e.jsx(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},children:e.jsxs(c,{children:[e.jsx(v,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5 text-purple-600"}),"Recursos Enterprise Ativos"]})}),e.jsx(o,{children:e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-green-50 rounded-lg",children:[e.jsx(G,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Chatbot Ilimitado"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Sem limite de mensagens"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 rounded-lg",children:[e.jsx(G,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Analytics Avançado"}),e.jsx("p",{className:"text-xs text-gray-600",children:"ML e relatórios consolidados"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-purple-50 rounded-lg",children:[e.jsx(G,{className:"h-8 w-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Suporte Prioritário"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Atendimento 24/7"})]})]})]})})]})})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6",children:e.jsx(c,{className:"max-w-2xl mx-auto",children:e.jsxs(o,{className:"p-12 text-center",children:[e.jsx(Pe,{className:"h-16 w-16 mx-auto mb-4 text-gray-400"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Nenhuma escola encontrada"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Você ainda não possui uma escola cadastrada."}),e.jsxs(g,{className:"bg-gradient-to-r from-orange-600 to-red-600 text-white",onClick:()=>a("/school/settings"),children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"Cadastrar Escola"]})]})})})},rs=()=>{const{user:r}=z(),[a,x]=l.useState(null),[w,m]=l.useState(!0),[D,h]=l.useState(null);return l.useEffect(()=>{const T=async()=>{if(!r?.id){m(!1);return}try{if(m(!0),h(null),r.user_metadata?.role){x(r.user_metadata.role),B.info("User role from metadata:",r.user_metadata.role),m(!1);return}const{data:j,error:S}=await N.from("profiles").select("role").eq("id",r.id).maybeSingle();j&&!S?(x(j.role||"teacher"),B.info("User role from profiles:",j.role)):(x("teacher"),B.warn("Could not determine user role, defaulting to teacher"))}catch(j){B.error("Error in fetchUserRole:",j),h("Erro ao carregar as informações do usuário"),x("teacher")}finally{m(!1)}},C=setTimeout(()=>{T()},300);return()=>clearTimeout(C)},[r?.id]),w?e.jsx(n.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:e.jsx(Se,{})}):D?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs(te,{className:"max-w-md",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx(ie,{children:D})]})}):e.jsx(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:a==="teacher"?e.jsx(Me,{}):a==="student"?e.jsx($e,{}):a==="school"?e.jsx(Ge,{}):e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs(te,{className:"max-w-md",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx(ie,{children:"Role não reconhecido. Entre em contato com o administrador."})]})})})};export{rs as default};
