import{al as q,v as $,g as z,u as B,r as t,s as o,z as c,j as e,D as y,m as d,t as L,U as w,p as R,c as V}from"./main-7VZoQpWp.js";import{P as x}from"./PremiumCard-BlYsE6j7.js";import{P as p}from"./PremiumButton-BLQFs7s4.js";import{A as C}from"./arrow-right-D2SAYZ8g.js";function O(){const{code:k}=q(),[_]=$(),m=z(),{user:i,loading:u}=B(),[n,j]=t.useState(""),[s,E]=t.useState(null),[S,h]=t.useState(!0),[f,b]=t.useState(!1),[v,g]=t.useState(null),[P,A]=t.useState(!1),l=k||_.get("code")||n;t.useEffect(()=>{l&&!u?N(l):u||h(!1)},[l,u]);const N=async r=>{try{h(!0),g(null);const{data:a,error:T}=await o.from("classes").select(`
          *,
          profiles:created_by (
            id,
            full_name,
            email
          ),
          school_classes!inner (
            schools (
              id,
              name,
              description
            )
          )
        `).eq("invite_code",r.toUpperCase()).single();if(T)throw new Error("Código de convite inválido");const{count:U}=await o.from("class_members").select("*",{count:"exact",head:!0}).eq("class_id",a.id);E({...a,memberCount:U||0})}catch(a){console.error("Erro ao buscar turma:",a),g(a.message),c.error(a.message)}finally{h(!1)}},I=async()=>{if(!i){sessionStorage.setItem("pendingClassCode",l),c.error("Faça login para entrar na turma"),m(`/login?redirect=${encodeURIComponent(window.location.pathname)}`);return}try{b(!0);const{data:r}=await o.from("class_members").select("id").eq("class_id",s.id).eq("user_id",i.id).eq("role","student").single();if(r){c.error("Você já está nesta turma"),m(`/dashboard/classes/${s.id}`);return}const{error:a}=await o.from("class_members").insert({class_id:s.id,user_id:i.id,role:"student",joined_at:new Date().toISOString()});if(a)throw a;await o.from("notifications").insert({user_id:s.created_by,type:"new_student",title:"👋 Novo Aluno na Turma",message:`Um novo aluno entrou na turma ${s.name}`,data:{classId:s.id,studentId:i.id},read:!1}),A(!0),c.success("Você entrou na turma com sucesso!"),setTimeout(()=>{m(`/dashboard/classes/${s.id}`)},2e3)}catch(r){console.error("Erro ao entrar na turma:",r),c.error("Erro ao entrar na turma")}finally{b(!1)}};return u||S?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:e.jsxs("div",{className:"text-center",children:[e.jsx(y,{className:"w-12 h-12 animate-spin text-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Carregando..."})]})}):P?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 p-4",children:e.jsx(d.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},children:e.jsx(x,{variant:"elevated",className:"max-w-md",children:e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(d.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring"},className:"w-20 h-20 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(L,{className:"w-10 h-10 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Bem-vindo à Turma!"}),e.jsxs("p",{className:"text-muted-foreground mb-4",children:["Você foi adicionado à turma ",s?.name]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Redirecionando..."})]})})})}):l?v||!s?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 p-4",children:e.jsx(d.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},children:e.jsx(x,{variant:"elevated",className:"max-w-md",children:e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-destructive/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(V,{className:"w-8 h-8 text-destructive"})}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Código Inválido"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:v||"Não encontramos uma turma com este código de convite."}),e.jsx(p,{variant:"outline",onClick:()=>{g(null),j(""),m("/join-class")},children:"Tentar Novamente"})]})})})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 p-4",children:e.jsx(d.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},className:"w-full max-w-lg",children:e.jsx(x,{variant:"elevated",children:e.jsxs("div",{className:"p-8",children:[e.jsx("div",{className:`h-32 rounded-xl bg-gradient-to-br ${s.banner_color||"from-blue-500 to-purple-500"} mb-6 flex items-center justify-center`,children:e.jsx(w,{className:"w-16 h-16 text-white"})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:s.name}),e.jsx("p",{className:"text-lg text-muted-foreground mb-1",children:s.subject}),s.grade_level&&e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["📚 ",s.grade_level]}),s.school_classes?.[0]?.schools&&e.jsxs("div",{className:"mb-4 p-3 bg-primary/5 rounded-lg border border-primary/10",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx("span",{className:"text-xl",children:"🏫"}),e.jsx("span",{className:"font-semibold text-primary",children:s.school_classes[0].schools.name})]}),s.school_classes[0].schools.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.school_classes[0].schools.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx("span",{children:"👨‍🏫"}),e.jsx("span",{className:"font-medium",children:"Professor"})]}),e.jsx("p",{className:"text-muted-foreground",children:s.profiles?.full_name||s.profiles?.email||"N/A"})]}),e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx("span",{children:"👥"}),e.jsx("span",{className:"font-medium",children:"Alunos"})]}),e.jsxs("p",{className:"text-muted-foreground",children:[s.memberCount," matriculados"]})]})]})]}),s.description&&e.jsx("div",{className:"mb-6 p-4 bg-muted/50 rounded-lg",children:e.jsx("p",{className:"text-sm",children:s.description})}),s.schedule&&e.jsxs("div",{className:"mb-6 flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:"📅"}),e.jsx("span",{children:s.schedule})]}),e.jsx(p,{variant:"gradient",size:"lg",className:"w-full",onClick:I,disabled:f,rightIcon:f?y:C,children:f?"Entrando...":"Entrar na Turma"}),!i&&e.jsx("p",{className:"text-xs text-center text-muted-foreground mt-4",children:"Você será redirecionado para fazer login"})]})})})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 p-4",children:e.jsx(d.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},className:"w-full max-w-md",children:e.jsx(x,{variant:"elevated",children:e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(w,{className:"w-8 h-8 text-white"})}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Entrar em uma Turma"}),e.jsx("p",{className:"text-muted-foreground",children:"Digite o código de convite fornecido pelo professor"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(R,{label:"Código de Convite",value:n,onChange:r=>j(r.target.value.toUpperCase()),placeholder:"Ex: MAT-ABC123",maxLength:12,className:"text-center font-mono text-lg",autoFocus:!0}),e.jsx(p,{variant:"gradient",className:"w-full",onClick:()=>N(n),disabled:!n||n.length<6,rightIcon:C,children:"Buscar Turma"})]})]})})})})}export{O as default};
