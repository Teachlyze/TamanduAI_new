const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-wouSwBVw.js","assets/main-BBAlbGLj.js","assets/main-DjUI_5r2.css","assets/typeof-CPR7xHyo.js"])))=>i.map(i=>d[i]);
import{al as te,r as l,j as e,m as r,C as $,U as F,A as le,k as M,n as re,_ as O,T as ie}from"./main-BBAlbGLj.js";import{P as m}from"./PremiumCard-BClPpHrg.js";import{B as h}from"./badge-Dxkfeepr.js";import{a as o}from"./analyticsMLService-DrfB-v_N.js";import{B as H}from"./brain-DI03e7uS.js";import{T as S}from"./triangle-alert-BOfKVf7j.js";import{R as C,T as P}from"./CategoricalChart-DTJ2g2hZ.js";import{P as R,a as A,C as D}from"./PieChart-0f8a09xQ.js";import{L as de}from"./Legend-Ci6apA5A.js";import{C as G}from"./circle-check-big-9PMWtYp0.js";import{T as ce}from"./target-DlA9JK4k.js";import"./index-D_P3mdcN.js";function we(){const{classId:c}=te(),[ne,L]=l.useState(!0),[d,K]=l.useState(null),[b,U]=l.useState([]),[n,V]=l.useState(null),[N,z]=l.useState([]),[xe,W]=l.useState(null),[i,X]=l.useState(null),T=l.useRef(null),[v,I]=l.useState(null),[g,q]=l.useState({});l.useEffect(()=>{J()},[c]);const J=async()=>{L(!0);const[s,a,t,j]=await Promise.all([o.identifyAtRiskStudents(c),o.clusterStudents(c),o.predictChurn(c),o.analyzeClassPerformance(c)]);U(s||[]),V(a||null),z(t||[]),K(j||null),L(!1)},Q=async()=>{try{const[{default:s},a]=await Promise.all([O(()=>import("./html2canvas.esm-BgurttRc.js"),[]),O(()=>import("./jspdf.es.min-wouSwBVw.js"),__vite__mapDeps([0,1,2,3]))]),t=a.jsPDF||a.default||a,j=T.current;if(!j)return;const y=await s(j,{scale:2,useCORS:!0,backgroundColor:"#ffffff"}),E=y.toDataURL("image/png"),x=new t("p","mm","a4"),se=x.internal.pageSize.getWidth(),B=x.internal.pageSize.getHeight(),w=se,p=y.height*w/y.width;let k=0,u=p;for(x.addImage(E,"PNG",0,k,w,p),u-=B;u>0;)x.addPage(),k=-(p-u),x.addImage(E,"PNG",0,k,w,p),u-=B;const ae=`tamanduai-analytics-ml-turma-${c}-${new Date().toISOString().slice(0,10)}.pdf`;x.save(ae)}catch(s){console.error("Falha ao exportar PDF:",s),alert("Para exportar o PDF, instale as dependências: npm i jspdf html2canvas")}},Y=async s=>{if(v===s){I(null);return}if(I(s),!g[s]){const a=await o.getStudentGradeBuckets(s,c);q(t=>({...t,[s]:a}))}},Z=async s=>{const a=await o.predictPerformance(s,c);X(a),W(s)},_=s=>{const a={high:"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300",medium:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300",low:"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300"};return a[s]||a.low},ee=s=>s==="improving"?e.jsx(ie,{className:"w-5 h-5 text-green-600"}):s==="declining"?e.jsx(S,{className:"w-5 h-5 text-red-600"}):e.jsx(ce,{className:"w-5 h-5 text-blue-600"}),f={excelente:"#10b981",bom:"#3b82f6",regular:"#f59e0b",atencao:"#ef4444"};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900",children:[e.jsx(r.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-8 shadow-xl",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-4",children:[e.jsx("div",{className:"p-3 bg-white/10 rounded-xl backdrop-blur-sm",children:e.jsx(H,{className:"w-8 h-8"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Analytics com ML"}),e.jsx("p",{className:"text-blue-100",children:"Inteligência Artificial para insights educacionais"})]}),e.jsx("button",{onClick:Q,className:"px-4 py-2 rounded-lg bg-white text-indigo-700 hover:bg-indigo-50 font-semibold",children:"Exportar PDF"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[e.jsxs(r.div,{whileHover:{scale:1.05},className:"bg-white/10 backdrop-blur-sm rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(S,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm text-blue-100",children:"Em Risco"})]}),e.jsx("div",{className:"text-2xl font-bold",children:b.length})]}),e.jsxs(r.div,{whileHover:{scale:1.05},className:"bg-white/10 backdrop-blur-sm rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx($,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm text-blue-100",children:"Inatividade"})]}),e.jsx("div",{className:"text-2xl font-bold",children:N.length})]}),e.jsxs(r.div,{whileHover:{scale:1.05},className:"bg-white/10 backdrop-blur-sm rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(F,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm text-blue-100",children:"Clusters"})]}),e.jsx("div",{className:"text-2xl font-bold",children:n?.clusters?.length||0})]}),e.jsxs(r.div,{whileHover:{scale:1.05},className:"bg-gradient-to-br from-green-400 to-emerald-500 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(le,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm text-white",children:"Excelentes"})]}),e.jsx("div",{className:"text-2xl font-bold",children:n?.clusters?.find(s=>s.name==="Excelente")?.count||0})]})]})]})}),e.jsx("div",{ref:T,className:"max-w-7xl mx-auto p-6",children:e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[d&&e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05},className:"lg:col-span-2",children:e.jsx(m,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(M,{className:"w-6 h-6 text-emerald-600"}),e.jsx("h2",{className:"text-xl font-bold",children:"Resumo da Turma"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 items-center",children:[e.jsx(C,{width:"100%",height:240,children:e.jsxs(R,{children:[e.jsx(A,{data:Object.entries(d.gradeBuckets||{}).map(([s,a])=>({name:s,value:a})),dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:85,label:({name:s,percent:a})=>`${s}: ${(a*100).toFixed(0)}%`,children:Object.entries(d.gradeBuckets||{}).map((s,a)=>e.jsx(D,{fill:["#ef4444","#f59e0b","#3b82f6","#10b981"][a%4]},`sum-cell-${a}`))}),e.jsx(P,{}),e.jsx(de,{})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 p-3 text-center",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Média"}),e.jsx("p",{className:"text-lg font-semibold",children:d.avgGrade})]}),e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 p-3 text-center",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Média Ajustada"}),e.jsx("p",{className:"text-lg font-semibold",children:d.adjustedAvg})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 p-3 text-center",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Dias médios entre submissões"}),e.jsx("p",{className:"text-lg font-semibold",children:d.avgDaysBetweenSubmissions??"N/D"})]}),e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 p-3 text-center",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Submissões por aluno (média)"}),e.jsx("p",{className:"text-lg font-semibold",children:d.submissionsPerStudentAvg??"N/D"})]})]}),d.xpSources&&e.jsxs("div",{className:"pt-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Fontes de XP (top 3)"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(d.xpSources).sort((s,a)=>a[1]-s[1]).slice(0,3).map(([s,a])=>e.jsxs(h,{variant:"outline",className:"text-xs",children:[s,": ",a]},s))})]})]})]})]})})}),e.jsx(r.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1},children:e.jsx(m,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(S,{className:"w-6 h-6 text-red-600"}),e.jsx("h2",{className:"text-xl font-bold",children:"Alunos em Risco"})]}),b.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(G,{className:"w-12 h-12 text-green-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Nenhum aluno em risco identificado! 🎉"})]}):e.jsx("div",{className:"space-y-3",children:b.map(s=>e.jsxs(r.div,{whileHover:{scale:1.02},className:"p-4 rounded-xl bg-gradient-to-r from-slate-50 to-white dark:from-slate-800 dark:to-slate-700 border border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.email})]}),e.jsx(h,{className:_(s.riskLevel),children:s.riskLevel==="high"?"Alto":s.riskLevel==="medium"?"Médio":"Baixo"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Média Total"}),e.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:s.avgGrade})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Média Recente"}),e.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:s.avgRecent})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.reasons.map((a,t)=>e.jsx(h,{variant:"outline",className:"text-xs",children:a},t))}),e.jsxs("div",{className:"flex items-center gap-4 mt-3",children:[e.jsx("button",{onClick:()=>Z(s.studentId),className:"text-sm text-indigo-600 hover:text-indigo-700 font-medium",children:"Ver Previsão →"}),e.jsx("button",{onClick:()=>Y(s.studentId),className:"text-sm text-slate-700 hover:text-slate-900 dark:text-slate-300 dark:hover:text-white font-medium",children:v===s.studentId?"Fechar distribuição":"Ver distribuição de notas"})]}),v===s.studentId&&e.jsxs("div",{className:"mt-4 p-3 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Distribuição de Notas (Aluno)"}),g[s.studentId]?e.jsx("div",{className:"w-full md:w-1/2",children:e.jsx(C,{width:"100%",height:160,children:e.jsxs(R,{children:[e.jsx(A,{data:Object.entries(g[s.studentId]).map(([a,t])=>({name:a,value:t})),dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:60,label:({name:a,percent:t})=>`${a}: ${(t*100).toFixed(0)}%`,children:Object.entries(g[s.studentId]).map((a,t)=>e.jsx(D,{fill:["#ef4444","#f59e0b","#3b82f6","#10b981"][t%4]},`stud-cell-${s.studentId}-${t}`))}),e.jsx(P,{})]})})}):e.jsx("p",{className:"text-xs text-gray-500",children:"Carregando distribuição..."})]})]},s.studentId))})]})})}),e.jsx(r.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.2},children:e.jsx(m,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(F,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold",children:"Clustering de Desempenho"})]}),n&&n.clusters.length>0?e.jsxs(e.Fragment,{children:[e.jsx(C,{width:"100%",height:250,children:e.jsxs(R,{children:[e.jsx(A,{data:n.clusters,dataKey:"count",nameKey:"name",cx:"50%",cy:"50%",outerRadius:80,label:s=>`${s.name}: ${s.count}`,children:n.clusters.map((s,a)=>e.jsx(D,{fill:f[s.name.toLowerCase()]||"#8884d8"},`cell-${a}`))}),e.jsx(P,{})]})}),e.jsx("div",{className:"space-y-3 mt-6",children:n.clusters.map(s=>e.jsxs("div",{className:"p-4 rounded-xl border border-gray-200 dark:border-gray-600",style:{background:`linear-gradient(to right, ${f[s.name.toLowerCase()]}15, transparent)`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:s.name}),e.jsxs(h,{className:"text-white",style:{backgroundColor:f[s.name.toLowerCase()]},children:[s.count," alunos"]})]}),e.jsx("div",{className:"flex items-center gap-4 text-sm",children:e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Média:"}),e.jsx("span",{className:"ml-2 font-bold text-gray-900 dark:text-white",children:s.avgGrade})]})})]},s.name))})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(M,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Dados insuficientes para clustering"})]})]})})}),e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsx(m,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx($,{className:"w-6 h-6 text-orange-600"}),e.jsx("h2",{className:"text-xl font-bold",children:"Risco de Inatividade"})]}),N.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(G,{className:"w-12 h-12 text-green-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Todos os alunos ativos! 👏"})]}):e.jsx("div",{className:"space-y-3",children:N.slice(0,5).map(s=>e.jsxs("div",{className:"p-4 rounded-xl bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.reason})]}),e.jsx(h,{className:_(s.riskLevel),children:s.riskLevel==="high"?"Crítico":"Atenção"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.daysSinceActivity," dias sem atividade"]})]},s.studentId))})]})})}),i&&e.jsx(r.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.4},children:e.jsx(m,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(H,{className:"w-6 h-6 text-purple-600"}),e.jsx("h2",{className:"text-xl font-bold",children:"Previsão de Desempenho"})]}),i.prediction===null?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(re,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:i.message})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center p-6 rounded-2xl bg-gradient-to-br from-purple-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm uppercase tracking-wider mb-2",children:"Próxima Nota Prevista"}),e.jsx("p",{className:"text-5xl font-bold mb-2",children:i.prediction}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[ee(i.trend),e.jsx("p",{className:"text-sm",children:i.message})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 rounded-xl bg-gray-50 dark:bg-slate-800",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Confiança"}),e.jsxs("p",{className:"text-2xl font-bold",children:[i.confidence,"%"]})]}),e.jsxs("div",{className:"text-center p-4 rounded-xl bg-gray-50 dark:bg-slate-800",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Média Recente"}),e.jsx("p",{className:"text-2xl font-bold",children:i.avgRecent})]}),e.jsxs("div",{className:"text-center p-4 rounded-xl bg-gray-50 dark:bg-slate-800",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Média Total"}),e.jsx("p",{className:"text-2xl font-bold",children:i.avgTotal})]})]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.jsxs("p",{children:["Baseado em ",i.totalSubmissions," submissões"]})})]})]})})})]})})]})}export{we as default};
