import{u as M,al as F,g as U,r as d,s as N,z as o,j as e,o as $,a2 as K,m as p,ah as X,K as m,aO as q,aP as _,aQ as D,aR as E,aS as c,aM as y,bs as C,B as H,bI as J,U as W,C as Y}from"./main-BTTCSkdE.js";import{P as b}from"./PremiumCard-CV5gJlVo.js";import{P as u}from"./PremiumButton-TaG2j_oH.js";import{B as Z}from"./badge-BTDSVm_c.js";import{A as ee}from"./arrow-left-CostCvAH.js";import{S as se}from"./save-DBFYKH5W.js";import{C as B}from"./circle-check-big-BC3uqdYk.js";import{T as ae}from"./trash-2-BWX-Vf9e.js";import{P as te}from"./plus-oG5N7bqt.js";const xe=()=>{const{user:x,loading:w}=M(),{classId:k}=F(),f=U(),[I,P]=d.useState(!0),[T,A]=d.useState(!1),[S,Q]=d.useState([]),[a,h]=d.useState({title:"",description:"",instructions:"",dueDate:"",maxGrade:100,type:"assignment",isPublished:!1,selectedClasses:k?[k]:[],questions:[],enablePlagiarismCheck:!1,allowBatchGrading:!1}),[i,j]=d.useState({type:"multiple_choice",question:"",options:["","","",""],correctAnswer:0,points:1});d.useEffect(()=>{!w&&x&&z()},[w,x]);const z=async()=>{try{P(!0);const{data:s,error:t}=await N.from("classes").select("id, name, subject").eq("created_by",x.id).eq("is_active",!0);if(t)throw t;Q(s||[])}catch(s){console.error("Erro ao carregar turmas:",s),o.error("Erro ao carregar turmas")}finally{P(!1)}},l=(s,t)=>{h(r=>({...r,[s]:t}))},G=s=>{h(t=>({...t,selectedClasses:t.selectedClasses.includes(s)?t.selectedClasses.filter(r=>r!==s):[...t.selectedClasses,s]}))},g=(s,t)=>{j(r=>({...r,[s]:t}))},V=(s,t)=>{j(r=>({...r,options:r.options.map((n,v)=>v===s?t:n)}))},L=()=>{if(!i.question.trim()){o.error("Digite a pergunta");return}if(i.type==="multiple_choice"&&i.options.some(s=>!s.trim())){o.error("Preencha todas as opções");return}h(s=>({...s,questions:[...s.questions,{...i,id:Date.now()}]})),j({type:"multiple_choice",question:"",options:["","","",""],correctAnswer:0,points:1})},O=s=>{h(t=>({...t,questions:t.questions.filter(r=>r.id!==s)}))},R=async()=>{if(!a.title.trim()){o.error("Título é obrigatório");return}if(a.selectedClasses.length===0){o.error("Selecione pelo menos uma turma");return}A(!0);try{const{data:s,error:t}=await N.from("activities").insert({title:a.title,description:a.description,content:{instructions:a.instructions,questions:a.questions,enablePlagiarismCheck:a.enablePlagiarismCheck,allowBatchGrading:a.allowBatchGrading},type:a.type,max_grade:a.maxGrade,due_date:a.dueDate||null,created_by:x.id,is_published:a.isPublished}).select().single();if(t)throw t;const r=a.selectedClasses.map(v=>({activity_id:s.id,class_id:v})),{error:n}=await N.from("activity_class_assignments").insert(r);if(n)throw n;o.success("Atividade criada com sucesso!"),f("/dashboard/activities")}catch(s){console.error("Erro ao criar atividade:",s),o.error("Erro ao criar atividade")}finally{A(!1)}};return I?e.jsx($,{message:"Carregando turmas..."}):e.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(u,{variant:"outline",size:"sm",leftIcon:ee,onClick:()=>f("/dashboard/activities"),children:"Voltar"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Nova Atividade"}),e.jsx("p",{className:"text-muted-foreground",children:"Crie uma nova atividade para seus alunos"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(u,{variant:"outline",leftIcon:K,onClick:()=>f("/dashboard/activities"),children:"Cancelar"}),e.jsx(u,{leftIcon:se,onClick:R,loading:T,className:"bg-gradient-to-r from-blue-600 to-purple-600",children:"Criar Atividade"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs(b,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-xl flex items-center justify-center",children:e.jsx(X,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-foreground",children:"Informações Básicas"}),e.jsx("p",{className:"text-muted-foreground",children:"Configure os detalhes principais da atividade"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Título da Atividade *"}),e.jsx(m,{value:a.title,onChange:s=>l("title",s.target.value),placeholder:"Ex: Exercícios de Matemática - Capítulo 5",className:"w-full bg-background text-foreground"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Tipo de Atividade"}),e.jsxs(q,{value:a.type,onValueChange:s=>l("type",s),children:[e.jsx(_,{className:"bg-background text-foreground",children:e.jsx(D,{})}),e.jsxs(E,{children:[e.jsx(c,{value:"assignment",children:"Tarefa"}),e.jsx(c,{value:"quiz",children:"Quiz"}),e.jsx(c,{value:"project",children:"Projeto"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Descrição"}),e.jsx(y,{value:a.description,onChange:s=>l("description",s.target.value),placeholder:"Descreva brevemente o objetivo da atividade...",className:"w-full min-h-[100px] bg-background text-foreground"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Instruções Detalhadas"}),e.jsx(y,{value:a.instructions,onChange:s=>l("instructions",s.target.value),placeholder:"Instruções detalhadas para os alunos...",className:"w-full min-h-[120px] bg-background text-foreground"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Data de Entrega"}),e.jsx(m,{type:"datetime-local",value:a.dueDate,onChange:s=>l("dueDate",s.target.value),className:"w-full bg-background text-foreground"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Pontuação Máxima"}),e.jsx(m,{type:"number",min:"1",max:"1000",value:a.maxGrade,onChange:s=>l("maxGrade",parseInt(s.target.value)||100),className:"w-full bg-background text-foreground"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border border-border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Publicar Imediatamente"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"A atividade ficará visível para os alunos"})]}),e.jsx(C,{checked:a.isPublished,onCheckedChange:s=>l("isPublished",s)})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border border-border rounded-lg bg-blue-50 dark:bg-blue-950/20",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground flex items-center gap-2",children:"🔍 Verificação de Plágio"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ativar detecção automática de plágio nas submissões"})]}),e.jsx(C,{checked:a.enablePlagiarismCheck,onCheckedChange:s=>l("enablePlagiarismCheck",s)})]}),a.type==="quiz"&&a.questions.length>0&&e.jsxs("div",{className:"flex items-center justify-between p-4 border border-border rounded-lg bg-purple-50 dark:bg-purple-950/20",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground flex items-center gap-2",children:"⚡ Correção Automática"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Permitir correção em lote com base no gabarito"})]}),e.jsx(C,{checked:a.allowBatchGrading,onCheckedChange:s=>l("allowBatchGrading",s)})]})]})]})}),a.type==="quiz"&&e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs(b,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-teal-500 rounded-xl flex items-center justify-center",children:e.jsx(H,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-foreground",children:"Questões do Quiz"}),e.jsx("p",{className:"text-muted-foreground",children:"Adicione questões para o quiz"})]})]}),a.questions.length>0&&e.jsx("div",{className:"space-y-4 mb-6",children:a.questions.map((s,t)=>e.jsx("div",{className:"p-4 border border-border rounded-lg bg-muted/50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-medium text-foreground",children:[t+1,". ",s.question]}),s.type==="multiple_choice"&&e.jsx("div",{className:"mt-2 space-y-1",children:s.options.map((r,n)=>e.jsxs("div",{className:"flex items-center gap-2",children:[n===s.correctAnswer?e.jsx(B,{className:"w-4 h-4 text-green-500"}):e.jsx(J,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-foreground",children:r})]},n))}),e.jsxs(Z,{variant:"secondary",className:"mt-2",children:[s.points," ponto",s.points!==1?"s":""]})]}),e.jsx(u,{variant:"outline",size:"sm",leftIcon:ae,onClick:()=>O(s.id),className:"text-red-500 hover:text-red-600",children:"Remover"})]})},s.id))}),e.jsxs("div",{className:"space-y-4 p-4 border border-dashed border-border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Tipo de Questão"}),e.jsxs(q,{value:i.type,onValueChange:s=>g("type",s),children:[e.jsx(_,{className:"bg-background text-foreground",children:e.jsx(D,{})}),e.jsxs(E,{children:[e.jsx(c,{value:"multiple_choice",children:"Múltipla Escolha"}),e.jsx(c,{value:"open",children:"Questão Aberta"}),e.jsx(c,{value:"true_false",children:"Verdadeiro/Falso"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Pergunta"}),e.jsx(y,{value:i.question,onChange:s=>g("question",s.target.value),placeholder:"Digite a pergunta...",className:"w-full bg-background text-foreground"})]}),i.type==="multiple_choice"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Opções de Resposta"}),e.jsx("div",{className:"space-y-2",children:i.options.map((s,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"correctAnswer",checked:i.correctAnswer===t,onChange:()=>g("correctAnswer",t),className:"text-blue-600"}),e.jsx(m,{value:s,onChange:r=>V(t,r.target.value),placeholder:`Opção ${t+1}`,className:"flex-1 bg-background text-foreground"})]},t))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Selecione a opção correta marcando o círculo"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Pontos"}),e.jsx(m,{type:"number",min:"1",max:"10",value:i.points,onChange:s=>g("points",parseInt(s.target.value)||1),className:"w-20 bg-background text-foreground"})]}),e.jsx(u,{leftIcon:te,onClick:L,className:"bg-gradient-to-r from-green-500 to-teal-500",children:"Adicionar Questão"})]})]})]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(p.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.2},children:e.jsxs(b,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(W,{className:"w-5 h-5 text-blue-500"}),e.jsx("h3",{className:"font-bold text-foreground",children:"Turmas"})]}),S.length===0?e.jsx("p",{className:"text-muted-foreground text-sm",children:"Nenhuma turma encontrada"}):e.jsx("div",{className:"space-y-2",children:S.map(s=>e.jsx("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${a.selectedClasses.includes(s.id)?"border-blue-500 bg-blue-50 dark:bg-blue-950":"border-border hover:border-blue-300"}`,onClick:()=>G(s.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.subject})]}),a.selectedClasses.includes(s.id)&&e.jsx(B,{className:"w-5 h-5 text-blue-500"})]})},s.id))})]})}),e.jsx(p.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.3},children:e.jsxs(b,{className:"p-6",children:[e.jsx("h3",{className:"font-bold mb-4 text-foreground",children:"Preview"}),e.jsxs("div",{className:"border border-border rounded-lg p-4 bg-muted/30",children:[e.jsx("h4",{className:"font-bold text-lg mb-2 text-foreground",children:a.title||"Título da Atividade"}),a.description&&e.jsx("p",{className:"text-muted-foreground mb-3",children:a.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Y,{className:"w-4 h-4"}),a.dueDate?new Date(a.dueDate).toLocaleString("pt-BR"):"Sem prazo"]}),e.jsxs("span",{children:["🎯 ",a.maxGrade," pts"]})]}),a.questions.length>0&&e.jsx("div",{className:"mt-3 pt-3 border-t border-border",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a.questions.length," questão",a.questions.length!==1?"ões":""]})})]})]})})]})]})]})};export{xe as default};
