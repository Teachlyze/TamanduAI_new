import{u as F,r as i,s as m,ar as n,j as e,o as V,aO as N,aP as _,aQ as y,aR as k,aS as g,K as v,aM as I,bs as L,T as M,A as O}from"./main-BrBEgNdp.js";import{B as R}from"./badge-visb3evj.js";import{P as p}from"./PremiumCard-CQ6HrYyP.js";import{P as o}from"./PremiumButton-C1Ncun4G.js";import{E as G}from"./EmptyState-DQg0NHXl.js";import{G as S}from"./gift-DsBmrrcP.js";import{P as C}from"./plus-BUy7xDK2.js";import{S as U}from"./square-pen-BGpuol__.js";import{T as K}from"./trash-2-Bj3zLS8o.js";const ae=()=>{const{user:x}=F(),[E,P]=i.useState(!0),[T,f]=i.useState(!1),[h,D]=i.useState([]),[q,l]=i.useState(!1),[d,b]=i.useState(null),[a,t]=i.useState({reward_type:"top_rank_bonus",reward_name:"",reward_description:"",reward_value:0,reward_xp:0,scope:"school",is_active:!0,conditions:{}});i.useEffect(()=>{u()},[x?.id]);const u=async()=>{try{const{data:s,error:r}=await m.from("reward_settings").select("*").eq("created_by",x.id).order("created_at",{ascending:!1});if(r)throw r;D(s||[])}catch(s){console.error("Erro ao carregar recompensas:",s),n({title:"Erro",description:"Não foi possível carregar as recompensas.",variant:"destructive"})}finally{P(!1)}},z=async s=>{if(s.preventDefault(),!a.reward_name.trim()){n({title:"Erro",description:"Nome da recompensa é obrigatório.",variant:"destructive"});return}f(!0);try{const r={...a,created_by:x.id,scope_id:null};if(d){const{error:c}=await m.from("reward_settings").update(r).eq("id",d.id);if(c)throw c;n({title:"Sucesso",description:"Recompensa atualizada!"})}else{const{error:c}=await m.from("reward_settings").insert(r);if(c)throw c;n({title:"Sucesso",description:"Recompensa criada!"})}j(),u()}catch(r){console.error("Erro ao salvar recompensa:",r),n({title:"Erro",description:"Não foi possível salvar a recompensa.",variant:"destructive"})}finally{f(!1)}},B=async s=>{if(confirm("Tem certeza que deseja excluir esta recompensa?"))try{const{error:r}=await m.from("reward_settings").delete().eq("id",s);if(r)throw r;n({title:"Sucesso",description:"Recompensa excluída!"}),u()}catch(r){console.error("Erro ao excluir:",r),n({title:"Erro",description:"Não foi possível excluir.",variant:"destructive"})}},A=s=>{b(s),t({reward_type:s.reward_type,reward_name:s.reward_name,reward_description:s.reward_description||"",reward_value:s.reward_value||0,reward_xp:s.reward_xp||0,scope:s.scope,is_active:s.is_active,conditions:s.conditions||{}}),l(!0)},j=()=>{t({reward_type:"top_rank_bonus",reward_name:"",reward_description:"",reward_value:0,reward_xp:0,scope:"school",is_active:!0,conditions:{}}),b(null),l(!1)},w={top_rank_bonus:"🏆 Bônus Top Ranking",streak_bonus:"🔥 Bônus de Sequência",perfect_score:"⭐ Nota Perfeita",mission_complete:"✅ Missão Completa",custom:"🎁 Personalizado"},X={top_rank_bonus:"Recompensa para alunos no top do ranking",streak_bonus:"Recompensa por dias consecutivos de atividade",perfect_score:"Recompensa por nota 10 em atividades",mission_complete:"Recompensa ao completar missões",custom:"Recompensa personalizada com critérios próprios"};return E?e.jsx(V,{message:"Carregando recompensas..."}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-yellow-600 to-orange-600 p-8 rounded-2xl text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-full flex items-center justify-center backdrop-blur",children:e.jsx(S,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Configurações de Recompensas"}),e.jsx("p",{className:"text-white/90 mt-1",children:"Crie incentivos personalizados para seus alunos"})]})]}),e.jsxs(o,{onClick:()=>l(!0),className:"bg-white text-orange-600 hover:bg-white/90 whitespace-nowrap inline-flex items-center gap-2 shadow-lg font-semibold border-2 border-white/20",children:[e.jsx(C,{className:"w-4 h-4"}),e.jsx("span",{children:"Nova Recompensa"})]})]})}),e.jsx(p,{variant:"elevated",children:e.jsxs("div",{className:"p-6 bg-gradient-to-r from-blue-500/10 to-purple-500/10",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"💡 Sugestões de Recompensas"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-white dark:bg-black/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl mb-2",children:"🏆"}),e.jsx("h4",{className:"font-semibold mb-1",children:"Top 10 no Ranking"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Alunos no top 10 ganham +1 ponto na média final"})]}),e.jsxs("div",{className:"p-4 bg-white dark:bg-black/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl mb-2",children:"🔥"}),e.jsx("h4",{className:"font-semibold mb-1",children:"7 Dias de Sequência"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Estudar 7 dias seguidos garante 100 XP de bônus"})]}),e.jsxs("div",{className:"p-4 bg-white dark:bg-black/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl mb-2",children:"⭐"}),e.jsx("h4",{className:"font-semibold mb-1",children:"Nota 10 Perfeita"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Tirar 10 em uma atividade ganha 50 XP extra"})]})]})]})}),q&&e.jsx(p,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:d?"Editar Recompensa":"Nova Recompensa"}),e.jsx(o,{variant:"ghost",size:"sm",onClick:j,className:"whitespace-nowrap inline-flex items-center gap-2 text-black dark:text-white",children:e.jsx("span",{children:"Cancelar"})})]}),e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Tipo de Recompensa *"}),e.jsxs(N,{value:a.reward_type,onValueChange:s=>t({...a,reward_type:s}),children:[e.jsx(_,{children:e.jsx(y,{})}),e.jsx(k,{children:Object.entries(w).map(([s,r])=>e.jsx(g,{value:s,children:r},s))})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:X[a.reward_type]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Nome da Recompensa *"}),e.jsx(v,{value:a.reward_name,onChange:s=>t({...a,reward_name:s.target.value}),placeholder:"Ex: Bônus Top 10",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Escopo"}),e.jsxs(N,{value:a.scope,onValueChange:s=>t({...a,scope:s}),children:[e.jsx(_,{children:e.jsx(y,{})}),e.jsxs(k,{children:[e.jsx(g,{value:"school",children:"🏫 Toda a Escola"}),e.jsx(g,{value:"class",children:"📚 Por Turma"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Descrição"}),e.jsx(I,{value:a.reward_description,onChange:s=>t({...a,reward_description:s.target.value}),placeholder:"Descreva como os alunos podem ganhar esta recompensa...",className:"min-h-[80px]"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valor da Recompensa (pontos na média)"}),e.jsx(v,{type:"number",step:"0.1",value:a.reward_value,onChange:s=>t({...a,reward_value:parseFloat(s.target.value)||0}),placeholder:"0.5"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Pontos adicionados na média final"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"XP de Bônus"}),e.jsx(v,{type:"number",value:a.reward_xp,onChange:s=>t({...a,reward_xp:parseInt(s.target.value)||0}),placeholder:"50"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"XP extra concedido"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border border-border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Recompensa Ativa"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Os alunos podem ganhar esta recompensa agora"})]}),e.jsx(L,{checked:a.is_active,onCheckedChange:s=>t({...a,is_active:s})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(o,{type:"submit",className:"flex-1 bg-gradient-to-r from-yellow-600 to-orange-600 whitespace-nowrap inline-flex items-center justify-center gap-2",loading:T,children:e.jsxs("span",{children:[d?"Atualizar":"Criar"," Recompensa"]})}),e.jsx(o,{type:"button",variant:"outline",onClick:j,className:"whitespace-nowrap inline-flex items-center gap-2",children:e.jsx("span",{children:"Cancelar"})})]})]})]})}),e.jsx(p,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:["Recompensas Criadas (",h.length,")"]}),h.length===0?e.jsx(G,{icon:S,title:"Nenhuma recompensa criada",description:"Crie recompensas para motivar e incentivar seus alunos!",action:e.jsxs(o,{onClick:()=>l(!0),className:"whitespace-nowrap inline-flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4"}),e.jsx("span",{children:"Criar Primeira Recompensa"})]})}):e.jsx("div",{className:"space-y-3",children:h.map(s=>e.jsx("div",{className:"p-4 border border-border rounded-lg hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.reward_name}),e.jsx(R,{variant:s.is_active?"default":"secondary",children:s.is_active?"Ativa":"Inativa"}),e.jsx(R,{variant:"outline",children:w[s.reward_type]})]}),s.reward_description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.reward_description}),e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[s.reward_value>0&&e.jsxs("span",{className:"flex items-center gap-1 text-blue-600",children:[e.jsx(M,{className:"w-4 h-4"}),"+",s.reward_value," pontos na média"]}),s.reward_xp>0&&e.jsxs("span",{className:"flex items-center gap-1 text-yellow-600",children:[e.jsx(O,{className:"w-4 h-4"}),"+",s.reward_xp," XP"]}),e.jsxs("span",{className:"text-muted-foreground",children:["Escopo: ",s.scope==="school"?"🏫 Escola":"📚 Turma"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>A(s),children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>B(s.id),children:e.jsx(K,{className:"w-4 h-4 text-red-500"})})]})]})},s.id))})]})}),e.jsx(p,{variant:"elevated",children:e.jsxs("div",{className:"p-6 bg-gradient-to-r from-purple-500/10 to-pink-500/10",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"ℹ️ Como as Recompensas Funcionam?"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Pontos na Média:"})," São adicionados automaticamente à média final do aluno quando ele atinge o critério."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"XP de Bônus:"})," XP extra concedido imediatamente ao atingir o objetivo."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Escopo Escola:"})," Válido para todos os alunos da escola."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Escopo Turma:"})," Válido apenas para alunos de uma turma específica."]}),e.jsxs("p",{className:"text-yellow-700 dark:text-yellow-400",children:[e.jsx("strong",{children:"💡 Dica:"})," Use recompensas para incentivar comportamentos positivos como pontualidade, participação e dedicação!"]})]})]})})]})};export{ae as default};
