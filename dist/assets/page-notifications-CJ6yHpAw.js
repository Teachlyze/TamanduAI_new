import{r as m,j as e,H as Z,b1 as O,b2 as ee,b3 as K,T as ae,b4 as se,X as te,f as ie,as as re,K as oe,M as ce,N as le}from"./react-vendor-C2HUFn5N.js";import{a as X,u as J,I as F,B as g,c as U,C as B,b as P,d as q,k as V,e as H,j as L,S as ne,f as de,g as me,h as fe,i as ue}from"./lazy-CreateActivityPage.jsx-DYBofU2F.js";import{T as xe,a as he,b as I,c as M,L as ge}from"./page-MeetingDetailsPage.jsx-CRXx7amB.js";import{C as w}from"./page-ActivityPage.jsx-DC3PjPXz.js";import{N as f,S as ve}from"./lazy-Dashboard.jsx-BoWvKiDK.js";import{P as pe}from"./page-EmailConfirmationPage.jsx-BIOACglB.js";import{u as Ne}from"./vendor-react-router-B4Bn0PSh.js";import{f as je,o as Q,c as be,p as G}from"./utils-vendor-DsQmHAQY.js";const ye=()=>{const{user:h}=X();Ne();const{toast:c}=J(),[u,x]=m.useState([]),[n,b]=m.useState([]),[v,r]=m.useState(!0),[o,p]=m.useState(new Set),[y,E]=m.useState(""),[k,l]=m.useState("all"),[N,R]=m.useState({info:!0,reminder:!0,alert:!0,event:!0}),T=m.useCallback(async()=>{if(h)try{r(!0);const{data:a}=await f.getNotifications({limit:100,orderBy:"created_at",orderDir:"desc"});x(a||[]),b(a||[])}catch(a){console.error("Error fetching notifications:",a),c({variant:"destructive",title:"Erro ao carregar notificações",description:"Não foi possível carregar as notificações. Tente novamente mais tarde."})}finally{r(!1)}},[c,h]);m.useEffect(()=>{let a=[...u];k==="unread"?a=a.filter(t=>!t.is_read):k==="read"&&(a=a.filter(t=>t.is_read));const s=Object.entries(N).filter(([t,j])=>j).map(([t])=>t);if(s.length>0&&(a=a.filter(t=>s.includes(t.type))),y.trim()){const t=y.toLowerCase();a=a.filter(j=>j.title.toLowerCase().includes(t)||j.message.toLowerCase().includes(t))}b(a)},[u,k,N,y]);const S=a=>{const s=new Set(o);s.has(a)?s.delete(a):s.add(a),p(s)},i=a=>{p(a?new Set(n.map(s=>s.id)):new Set)},d=async()=>{if(o.size!==0)try{await f.markAsRead(Array.from(o),{userId:h?.id}),x(a=>a.map(s=>o.has(s.id)?{...s,read_at:new Date().toISOString()}:s)),p(new Set),c({title:"Notificações marcadas como lidas",description:`${o.size} notificação(s) marcada(s) como lida(s)`})}catch(a){console.error("Error marking notifications as read:",a),c({title:"Erro",description:"Não foi possível marcar as notificações como lidas",variant:"destructive"})}},C=async()=>{if(o.size!==0)try{await f.deleteNotification(Array.from(o),{userId:h?.id}),x(a=>a.filter(s=>!o.has(s.id))),p(new Set),c({title:"Notificações excluídas",description:`${o.size} notificação(s) excluída(s) com sucesso`})}catch(a){console.error("Error deleting notifications:",a),c({title:"Erro",description:"Não foi possível excluir as notificações selecionadas",variant:"destructive"})}},W=async()=>{try{const a=u.filter(s=>!s.read_at);a.length>0&&await f.markAsRead(a.map(s=>s.id),{userId:h?.id}),x(s=>s.map(t=>({...t,read_at:t.read_at||new Date().toISOString()}))),p(new Set),c({title:"Todas as notificações marcadas como lidas",description:"Suas notificações foram marcadas como lidas"})}catch(a){console.error("Error marking all as read:",a),c({title:"Erro",description:"Não foi possível marcar todas as notificações como lidas",variant:"destructive"})}},_=a=>{R(s=>({...s,[a]:!s[a]}))},z=a=>{switch(a){case"reminder":return e.jsx(le,{className:"h-4 w-4 text-amber-500"});case"alert":return e.jsx(ce,{className:"h-4 w-4 text-red-500"});case"event":return e.jsx(oe,{className:"h-4 w-4 text-blue-500"});default:return e.jsx(re,{className:"h-4 w-4 text-green-500"})}};m.useEffect(()=>{if(!h)return;const a=f.subscribeToNotifications(s=>{console.log("Notification update received:",s),T()});return T(),()=>{a&&typeof a.unsubscribe=="function"&&a.unsubscribe()}},[T]);const A=u.filter(a=>!a.is_read).length,D=n.length>0&&n.every(a=>o.has(a.id)),Y=n.some(a=>o.has(a.id));return e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsx(pe,{title:"Central de Notificações",description:"Gerencie suas notificações",icon:Z}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx("div",{className:"flex-1 w-full sm:w-auto",children:e.jsxs("div",{className:"relative",children:[e.jsx(F,{placeholder:"Buscar notificações...",value:y,onChange:a=>E(a.target.value),className:"pl-10 w-full sm:w-80"}),e.jsx(O,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"})]})}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto justify-between sm:justify-end",children:[e.jsxs(g,{variant:"outline",size:"sm",onClick:W,disabled:A===0,children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Marcar todas como lidas"]}),e.jsxs("div",{className:"relative group",children:[e.jsxs(g,{variant:"outline",size:"sm",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Filtrar"]}),e.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 p-2 z-10 hidden group-hover:block",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:[e.jsx(w,{id:"filter-info",checked:N.info,onCheckedChange:()=>_("info")}),e.jsx("label",{htmlFor:"filter-info",className:"text-sm font-medium leading-none",children:"Informações"})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:[e.jsx(w,{id:"filter-reminder",checked:N.reminder,onCheckedChange:()=>_("reminder")}),e.jsx("label",{htmlFor:"filter-reminder",className:"text-sm font-medium leading-none",children:"Lembretes"})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:[e.jsx(w,{id:"filter-alert",checked:N.alert,onCheckedChange:()=>_("alert")}),e.jsx("label",{htmlFor:"filter-alert",className:"text-sm font-medium leading-none",children:"Alertas"})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:[e.jsx(w,{id:"filter-event",checked:N.event,onCheckedChange:()=>_("event")}),e.jsx("label",{htmlFor:"filter-event",className:"text-sm font-medium leading-none",children:"Eventos"})]})]})})]})]})]}),e.jsxs(xe,{defaultValue:"all",className:"w-full",onValueChange:l,children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsxs(he,{className:"bg-transparent p-0 h-auto rounded-none w-full justify-start",children:[e.jsx(I,{value:"all",className:"relative py-3 px-4 data-[state=active]:shadow-none",children:"Todas"}),e.jsxs(I,{value:"unread",className:"relative py-3 px-4 data-[state=active]:shadow-none",children:[e.jsx("span",{children:"Não lidas"}),A>0&&e.jsx("span",{className:"ml-2 bg-blue-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:A>9?"9+":A})]}),e.jsx(I,{value:"read",className:"relative py-3 px-4 data-[state=active]:shadow-none",children:"Lidas"})]})}),e.jsx("div",{className:U("px-4 py-2 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 transition-all duration-200 overflow-hidden",o.size===0?"max-h-0 p-0 border-0":"max-h-16"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{id:"select-all",checked:D,onCheckedChange:i,ref:a=>{a&&(a.indeterminate=Y&&!D)}}),e.jsxs("label",{htmlFor:"select-all",className:"text-sm font-medium leading-none",children:[o.size," selecionada(s)"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(g,{variant:"ghost",size:"sm",className:"text-sm",onClick:d,disabled:o.size===0,children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Marcar como lida(s)"]}),e.jsxs(g,{variant:"ghost",size:"sm",className:"text-red-600 hover:bg-red-50 hover:text-red-700 dark:text-red-400 dark:hover:bg-red-900/30 dark:hover:text-red-300",onClick:C,disabled:o.size===0,children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Excluir"]})]})]})}),e.jsx(M,{value:"all",className:"m-0",children:e.jsx($,{notifications:n,isLoading:v,selectedNotifications:o,onToggleSelect:S,onMarkAsRead:a=>{const s=u.find(t=>t.id===a);s&&!s.is_read&&(f.markAsRead(a),x(t=>t.map(j=>j.id===a?{...j,is_read:!0}:j)))},onDelete:a=>{window.confirm("Tem certeza que deseja excluir esta notificação?")&&(f.deleteNotifications([a]),x(s=>s.filter(t=>t.id!==a)))},getNotificationIcon:z})}),e.jsx(M,{value:"unread",className:"m-0",children:e.jsx($,{notifications:n,isLoading:v,selectedNotifications:o,onToggleSelect:S,onMarkAsRead:a=>{f.markAsRead(a),x(s=>s.map(t=>t.id===a?{...t,is_read:!0}:t))},onDelete:a=>{window.confirm("Tem certeza que deseja excluir esta notificação?")&&(f.deleteNotifications([a]),x(s=>s.filter(t=>t.id!==a)))},getNotificationIcon:z})}),e.jsx(M,{value:"read",className:"m-0",children:e.jsx($,{notifications:n,isLoading:v,selectedNotifications:o,onToggleSelect:S,onMarkAsRead:null,onDelete:a=>{window.confirm("Tem certeza que deseja excluir esta notificação?")&&(f.deleteNotifications([a]),x(s=>s.filter(t=>t.id!==a)))},getNotificationIcon:z})})]})]})]})},$=({notifications:h,isLoading:c,selectedNotifications:u,onToggleSelect:x,onMarkAsRead:n,onDelete:b,getNotificationIcon:v})=>c?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8",children:[e.jsx(ge,{className:"h-8 w-8 text-blue-500"}),e.jsx("p",{className:"mt-4 text-sm text-gray-500",children:"Carregando notificações..."})]}):h.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(se,{className:"h-12 w-12 text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Nenhuma notificação encontrada"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Quando você tiver notificações, elas aparecerão aqui."})]}):e.jsx(ve,{className:"h-[calc(100vh-320px)]",children:e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:h.map(r=>e.jsx("div",{className:U("p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",!r.is_read&&"bg-blue-50 dark:bg-blue-900/10",u.has(r.id)&&"bg-blue-100 dark:bg-blue-900/30"),children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 pt-1",children:e.jsx(w,{id:`select-${r.id}`,checked:u.has(r.id),onCheckedChange:()=>x(r.id),className:"mt-1"})}),e.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[v(r.type),e.jsx("h3",{className:"ml-2 text-sm font-medium text-gray-900 dark:text-white",children:r.title})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs text-gray-400",children:je(Q(r.created_at),{addSuffix:!0,locale:G})}),e.jsxs("div",{className:"flex items-center space-x-1",children:[n&&!r.is_read&&e.jsx("button",{onClick:()=>n(r.id),className:"p-1 text-gray-400 hover:text-blue-500 dark:text-gray-500 dark:hover:text-blue-400",title:"Marcar como lida",children:e.jsx(K,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>b(r.id),className:"p-1 text-gray-400 hover:text-red-500 dark:text-gray-500 dark:hover:text-red-400",title:"Excluir notificação",children:e.jsx(te,{className:"h-4 w-4"})})]})]})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-300",children:r.message}),r.link&&e.jsx("div",{className:"mt-2",children:e.jsx(g,{variant:"link",size:"sm",className:"h-auto p-0 text-sm",onClick:()=>window.location.href=r.link,children:"Ver detalhes"})}),e.jsxs("div",{className:"mt-2 flex items-center text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"inline-flex items-center",children:r.is_read?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"h-3 w-3 text-green-500 mr-1"}),"Lida"]}):e.jsx("span",{className:"h-2 w-2 rounded-full bg-blue-500 mr-1"})}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsx("span",{children:be(Q(r.created_at),"PPpp",{locale:G})})]})]})]})},r.id))})}),ze=Object.freeze(Object.defineProperty({__proto__:null,default:ye},Symbol.toStringTag,{value:"Module"})),we=()=>{const{user:h}=X(),{toast:c}=J(),[u,x]=m.useState(!1),[n,b]=m.useState("info"),[v,r]=m.useState(""),[o,p]=m.useState(""),[y,E]=m.useState(""),k=[{value:"info",label:"Informação"},{value:"success",label:"Sucesso"},{value:"warning",label:"Aviso"},{value:"error",label:"Erro"},{value:"event",label:"Evento"},{value:"reminder",label:"Lembrete"}],l=i=>{const d=new Date().toLocaleTimeString();E(C=>`[${d}] ${i}
${C}`)},N=async i=>{if(i.preventDefault(),!v.trim()||!o.trim()){c({variant:"destructive",title:"Erro",description:"Por favor, preencha o título e a mensagem da notificação."});return}x(!0),l(`Enviando notificação de teste do tipo: ${n}...`);try{const d={title:v||`Notificação de teste (${n})`,message:o||"Esta é uma notificação de teste",type:n,action_url:"/dashboard"},C=await f.scheduleNotification(d);l(`✅ Notificação enviada com sucesso! ID: ${C.id}`),c({title:"Notificação de teste enviada",description:"Verifique a campainha de notificações no cabeçalho."}),r(""),p("")}catch(d){console.error("Erro ao enviar notificação de teste:",d),l(`❌ Erro ao enviar notificação: ${d.message}`),c({variant:"destructive",title:"Erro ao enviar notificação",description:d.message||"Ocorreu um erro ao enviar a notificação de teste."})}finally{x(!1)}},R=async()=>{try{l("Buscando notificações não lidas...");const i=await f.getNotifications({unreadOnly:!0,limit:1});if(i.length===0){l("❌ Nenhuma notificação não lida encontrada para teste.");return}const d=i[0];l(`Marcando notificação como lida: ${d.id}...`),await f.markAsRead(d.id),l("✅ Notificação marcada como lida com sucesso!"),c({title:"Teste de marcação como lida",description:"A notificação foi marcada como lida com sucesso."})}catch(i){console.error("Erro ao testar marcação como lida:",i),l(`❌ Erro ao marcar notificação como lida: ${i.message}`)}},T=async()=>{try{l("Buscando notificações para exclusão...");const i=await f.getNotifications({limit:1});if(i.length===0){l("❌ Nenhuma notificação encontrada para teste de exclusão.");return}const d=i[0];l(`Excluindo notificação: ${d.id}...`),await f.deleteNotification(d.id),l("✅ Notificação excluída com sucesso!"),c({title:"Teste de exclusão",description:"A notificação foi excluída com sucesso."})}catch(i){console.error("Erro ao testar exclusão:",i),l(`❌ Erro ao excluir notificação: ${i.message}`)}},S=()=>{l("Iniciando teste de notificações em tempo real..."),c({title:"Teste de notificação em tempo real",description:"Verifique a campainha de notificações em alguns segundos."}),setTimeout(()=>{const i=new CustomEvent("notification:test",{detail:{eventType:"INSERT",new:{id:`test-${Date.now()}`,title:"Notificação em Tempo Real",message:"Esta é uma notificação de teste em tempo real!",type:"info",is_read:!1,created_at:new Date().toISOString(),user_id:h?.id}}});window.dispatchEvent(i),l("✅ Evento de notificação em tempo real disparado!")},3e3)};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Teste de Notificações"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(B,{children:[e.jsxs(P,{children:[e.jsx(q,{children:"Enviar Notificação de Teste"}),e.jsx(V,{children:"Envie uma notificação de teste para o painel de notificações"})]}),e.jsx(H,{children:e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"notificationType",children:"Tipo de Notificação"}),e.jsxs(ne,{value:n,onValueChange:b,children:[e.jsx(de,{children:e.jsx(me,{placeholder:"Selecione um tipo"})}),e.jsx(fe,{children:k.map(i=>e.jsx(ue,{value:i.value,children:i.label},i.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"title",children:"Título"}),e.jsx(F,{id:"title",placeholder:"Título da notificação",value:v,onChange:i=>r(i.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"message",children:"Mensagem"}),e.jsx(F,{id:"message",placeholder:"Mensagem da notificação",value:o,onChange:i=>p(i.target.value)})]}),e.jsx(g,{type:"submit",disabled:u,className:"w-full",children:u?"Enviando...":"Enviar Notificação de Teste"})]})})]}),e.jsxs(B,{children:[e.jsxs(P,{children:[e.jsx(q,{children:"Testes de Funcionalidade"}),e.jsx(V,{children:"Teste as funcionalidades do sistema de notificações"})]}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-medium",children:"Testes de API"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(g,{variant:"outline",onClick:R,disabled:u,children:"Testar Marcar como Lida"}),e.jsx(g,{variant:"outline",onClick:T,disabled:u,children:"Testar Exclusão"}),e.jsx(g,{variant:"outline",onClick:S,disabled:u,children:"Testar Tempo Real"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-medium",children:"Registro de Testes"}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-3 rounded-md h-48 overflow-y-auto font-mono text-sm",children:y||"Nenhum teste executado ainda."}),e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>E(""),className:"text-xs",children:"Limpar Registros"})]})]})]})]})]})},Le=Object.freeze(Object.defineProperty({__proto__:null,default:we},Symbol.toStringTag,{value:"Module"}));export{ze as N,Le as a};
