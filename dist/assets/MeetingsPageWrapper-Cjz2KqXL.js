import{j as e,b2 as a,x as d,u as S,g as k,r as l,s as u,i as m,aT as w,d as E,U as M,V as R}from"./main-BTTCSkdE.js";import{u as T}from"./useUserRole-g8lN0RLK.js";import{A as q,a as P}from"./alert-hdKuCvUB.js";import{T as U}from"./triangle-alert-h67Np2YJ.js";import{P as $}from"./plus-oG5N7bqt.js";import{f as z}from"./format-BmB7BMvl.js";import"./en-US-C1KUdeex.js";import"./toDate-B_SDEMqy.js";const D=()=>e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{className:"h-8 w-32"}),e.jsx(a,{className:"h-4 w-48"})]}),e.jsx(a,{className:"h-10 w-40"})]}),e.jsx(d,{className:"p-8",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx(a,{className:"w-8 h-8 mx-auto"}),e.jsx(a,{className:"h-6 w-48 mx-auto"}),e.jsx(a,{className:"h-4 w-64 mx-auto"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Array.from({length:6}).map((s,t)=>e.jsxs(d,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(a,{className:"h-5 w-24"}),e.jsx(a,{className:"w-4 h-4"})]}),e.jsx(a,{className:"h-3 w-20"}),e.jsx(a,{className:"h-3 w-16"}),e.jsx("div",{className:"pt-2 flex gap-2",children:e.jsx(a,{className:"h-8 flex-1"})})]},t))})]}),J=()=>{const{user:s}=S(),{isTeacher:t}=T(),n=k(),[r,v]=l.useState([]),[y,h]=l.useState(!0),[j,b]=l.useState(null),c=l.useCallback(async()=>{if(s?.id){h(!0);try{const[{data:o,error:f},{data:_,error:N}]=await Promise.all([u.from("class_members").select("class_id").eq("user_id",s.id),u.from("classes").select("id").eq("created_by",s.id)]);if(f)throw f;if(N)throw N;const A=[...o?.map(x=>x.class_id)||[],..._?.map(x=>x.id)||[]],p=Array.from(new Set(A));let i=u.from("meetings").select(`
          id,
          title,
          class_id,
          start_time,
          end_time,
          description,
          status,
          created_by,
          classes (
            id,
            name
          )
        `).order("start_time",{ascending:!1}).limit(50);p.length>0?i=i.or(`created_by.eq.${s.id},class_id.in.(${p.join(",")})`):i=i.eq("created_by",s.id);const{data:C,error:g}=await i;if(g)throw g;v(C||[])}catch(o){b(o.message||"Falha ao carregar reuniões")}finally{h(!1)}}},[s?.id]);return l.useEffect(()=>{c()},[c]),y?e.jsx(D,{}):j?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Reuniões"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Salas vinculadas às suas turmas"})]}),e.jsxs(m,{onClick:c,variant:"outline",children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Tentar novamente"]})]}),e.jsxs(q,{variant:"destructive",children:[e.jsx(U,{className:"h-4 w-4"}),e.jsxs(P,{className:"flex items-center justify-between",children:[e.jsx("span",{children:j}),e.jsxs(m,{variant:"outline",size:"sm",onClick:c,children:[e.jsx(w,{className:"h-3 w-3 mr-1"}),"Tentar novamente"]})]})]})]}):e.jsx(H,{meetings:r,isTeacher:t,navigate:n})},H=({meetings:s=[],isTeacher:t,navigate:n})=>Array.isArray(s)?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Reuniões"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Salas vinculadas às suas turmas"})]}),t&&e.jsxs(m,{onClick:()=>n("/dashboard/calendar"),children:[e.jsx($,{className:"w-4 h-4 mr-2"})," Agendar pela Agenda"]})]}),s.length===0?e.jsxs(d,{className:"p-8 text-center",children:[e.jsx(E,{className:"w-8 h-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"font-medium",children:"Nenhuma reunião encontrada"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use a Agenda para criar um novo evento de reunião"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(r=>e.jsxs(d,{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold",children:r.title||"Reunião"}),e.jsx(M,{className:"w-4 h-4 text-muted-foreground"})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:r.classes?.name?`Turma: ${r.classes.name}`:"Sem turma"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:r.start_time?z(new Date(r.start_time),"dd/MM/yyyy HH:mm"):"—"}),e.jsx("div",{className:"pt-2 flex gap-2",children:e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>n(`/meetings/${r.id}`),children:[e.jsx(R,{className:"w-4 h-4 mr-1"})," Entrar"]})})]},r.id))})]}):null;export{J as default};
