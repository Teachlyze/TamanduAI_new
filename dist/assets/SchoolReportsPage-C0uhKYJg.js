import{u as D,r as m,s as x,j as e,U as R,A as E,C as I,k as M,T as U}from"./main-Bujpyeg-.js";import{s as N}from"./schoolService-DcalQc3H.js";import{T as P}from"./trending-down-DPq5oMKG.js";const j=({icon:l,label:o,value:c,trend:s,color:n="blue"})=>e.jsx("div",{className:`rounded-xl border border-border/50 bg-gradient-to-br from-${n}-50 to-${n}-100/50 p-4`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`rounded-lg bg-${n}-500/10 p-2`,children:e.jsx(l,{className:`h-5 w-5 text-${n}-600`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:o}),e.jsx("div",{className:"mt-1 text-2xl font-bold",children:c}),s&&e.jsxs("div",{className:`mt-1 flex items-center gap-1 text-xs ${s>0?"text-green-600":"text-red-600"}`,children:[s>0?e.jsx(U,{className:"h-3 w-3"}):e.jsx(P,{className:"h-3 w-3"}),Math.abs(s),"% vs mÃªs anterior"]})]})]})}),k=({subject:l,avgGrade:o,submissions:c,studentCount:s})=>{const n=d=>d>=9?"text-green-600 bg-green-100":d>=7?"text-yellow-600 bg-yellow-100":d>=5?"text-orange-600 bg-orange-100":"text-red-600 bg-red-100";return e.jsxs("div",{className:"flex items-center gap-4 rounded-lg border border-border/50 bg-card p-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:l||"Sem disciplina"}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:[s," alunos â€¢ ",c," entregas"]})]}),e.jsx("div",{className:`rounded-full px-3 py-1.5 text-sm font-bold ${n(o)}`,children:o?.toFixed(1)||"-"})]})},z=()=>{const{user:l}=D(),[o,c]=m.useState(null),[s,n]=m.useState(null),[d,y]=m.useState([]),[S,f]=m.useState(!0);m.useEffect(()=>{w()},[l?.id]);const w=async()=>{if(l?.id)try{f(!0);const r=await N.getUserSchool(l.id);if(c(r),r?.id){const i=await N.getDashboardStats(r.id);n(i),await C(r.id,i.classIds)}}catch(r){console.error("Error loading reports:",r)}finally{f(!1)}},C=async(r,i)=>{if(!(!i||i.length===0))try{const{data:h}=await x.from("classes").select("id, subject").in("id",i),u=new Map;for(const a of h||[]){const t=a.subject||"Sem disciplina";u.has(t)||u.set(t,{subject:t,classIds:[],studentCount:0,submissions:0,totalGrade:0,gradeCount:0}),u.get(t).classIds.push(a.id)}for(const[a,t]of u.entries()){const{count:T}=await x.from("class_members").select("user_id",{count:"exact",head:!0}).in("class_id",t.classIds).eq("role","student");t.studentCount=T||0;const{data:$}=await x.from("activity_class_assignments").select("activity_id").in("class_id",t.classIds),b=$?.map(p=>p.activity_id)||[];if(b.length>0){const{count:p}=await x.from("submissions").select("id",{count:"exact",head:!0}).in("activity_id",b).eq("status","submitted");t.submissions=p||0;const{data:g}=await x.from("submissions").select("grade").in("activity_id",b).not("grade","is",null);if(g&&g.length>0){const G=g.reduce((_,A)=>_+(A.grade||0),0);t.totalGrade=G,t.gradeCount=g.length}}}const v=Array.from(u.values()).map(a=>({subject:a.subject,avgGrade:a.gradeCount>0?a.totalGrade/a.gradeCount:null,submissions:a.submissions,studentCount:a.studentCount}));v.sort((a,t)=>(t.avgGrade||0)-(a.avgGrade||0)),y(v)}catch(h){console.error("Error loading subject stats:",h)}};return S?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(r=>e.jsx("div",{className:"h-32 animate-pulse rounded-lg bg-muted"},r))}):o?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"RelatÃ³rios e Analytics"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["AnÃ¡lise detalhada do desempenho de ",o.name]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsx(j,{icon:R,label:"Total de Alunos",value:s?.totalStudents||0,color:"blue"}),e.jsx(j,{icon:E,label:"MÃ©dia Geral",value:s?.averageGrade||"-",color:"green"}),e.jsx(j,{icon:I,label:"Taxa de Pontualidade",value:`${s?.onTimeRate||0}%`,color:"purple"})]}),e.jsxs("div",{className:"rounded-2xl border border-border/50 bg-card p-6",children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Desempenho por Disciplina"})]}),d.length===0?e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:"Nenhum dado disponÃ­vel ainda."}):e.jsx("div",{className:"space-y-3",children:d.map((r,i)=>e.jsx(k,{...r},i))})]}),e.jsxs("div",{className:"rounded-2xl border border-border/50 bg-gradient-to-r from-blue-50 to-purple-50 p-6",children:[e.jsx("h3",{className:"mb-3 text-lg font-semibold",children:"ğŸ’¡ Insights"}),e.jsxs("ul",{className:"space-y-2 text-sm",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-600",children:"âœ“"}),e.jsx("span",{children:s?.onTimeRate>=70?`Taxa de pontualidade de ${s.onTimeRate}% estÃ¡ acima da meta (70%).`:`Taxa de pontualidade de ${s?.onTimeRate||0}% estÃ¡ abaixo da meta. Considere incentivar entregas antecipadas.`})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600",children:"â„¹"}),e.jsx("span",{children:d.length>0&&d[0].avgGrade?`Melhor desempenho em ${d[0].subject} (mÃ©dia ${d[0].avgGrade.toFixed(1)}).`:"Ainda nÃ£o hÃ¡ dados suficientes para anÃ¡lise por disciplina."})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-purple-600",children:"ğŸ“Š"}),e.jsxs("span",{children:["Total de ",s?.submissionsLast30Days||0," entregas nos Ãºltimos 30 dias."]})]})]})]})]}):e.jsx("div",{className:"rounded-2xl border border-border/50 bg-card p-8 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Escola nÃ£o encontrada."})})};export{z as default};
