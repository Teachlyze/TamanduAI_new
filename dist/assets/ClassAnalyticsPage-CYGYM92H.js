import{f as ee,s as v,ak as te,r as d,z as k,j as e,o as se,m as ae,U as re,A as R,M as ne,c as ie,e as oe,k as le,T as ce,b1 as de}from"./main-NgjJy_CG.js";import{P as g}from"./PremiumCard-BGO_It48.js";import{P as me}from"./PremiumButton-DDGOGflQ.js";import{D as xe}from"./download-BtFddqD_.js";import{a as ge,C as he}from"./chart-pie-CdtH70FP.js";import{R as C,T as E}from"./CategoricalChart-CdGB3_qT.js";import{L as pe,a as M}from"./LineChart-eca73oX5.js";import{C as L,X as F,Y as I}from"./CartesianChart-DTVEiWNB.js";import{L as O}from"./Legend-Bzn9_M0A.js";import{P as ue,a as be,C as ve}from"./PieChart-CZsaPU4p.js";import{B as je,a as G}from"./BarChart-Dt144RhT.js";import{T as fe}from"./trending-down-BrWkQQvc.js";import{f as B}from"./format-CtnHAw15.js";import{p as K}from"./pt-BR-D7au_PjL.js";import"./index-D_P3mdcN.js";import"./en-US-DmzJuP_Q.js";import"./toDate-M29M8iGB.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],ye=ee("clipboard-list",_e),S=async r=>{try{const{data:t,error:s}=await v.from("class_performance_overview").select("*").eq("class_id",r).single();if(s)throw s;return t}catch(t){throw console.error("Error getting class overview:",t),t}},V=async r=>{try{const{data:t,error:s}=await v.from("class_daily_activity").select("*").eq("class_id",r).order("activity_date",{ascending:!0});if(s)throw s;return t||[]}catch(t){throw console.error("Error getting daily activity:",t),t}},D=async(r,t=null)=>{try{let s=v.from("class_student_ranking").select("*").eq("class_id",r).order("rank_position",{ascending:!0});t&&(s=s.limit(t));const{data:i,error:a}=await s;if(a)throw a;return i||[]}catch(s){throw console.error("Error getting student ranking:",s),s}},$=async r=>{try{const{data:t,error:s}=await v.from("class_activity_performance").select("*").eq("class_id",r).order("due_date",{ascending:!1});if(s)throw s;return t||[]}catch(t){throw console.error("Error getting activity performance:",t),t}},we=async r=>{try{const{data:t,error:s}=await v.rpc("get_class_insights",{p_class_id:r});if(s)throw s;return t}catch(t){throw console.error("Error getting class insights:",t),t}},Ne=async r=>{try{const{data:t,error:s}=await v.rpc("compare_classes",{p_teacher_id:r});if(s)throw s;return t||[]}catch(t){throw console.error("Error comparing classes:",t),t}},Ae=async r=>{try{const t=await V(r);if(!t||t.length===0)return{submissions_trend:0,grading_trend:0,engagement_trend:0};const s=t.slice(-7),i=t.slice(-14,-7),a=(u,l)=>u.reduce((b,w)=>b+(w[l]||0),0)/u.length||0,o=a(s,"submissions_count"),h=a(i,"submissions_count"),f=a(s,"graded_count"),_=a(i,"graded_count"),j=a(s,"posts_count")+a(s,"comments_count"),y=a(i,"posts_count")+a(i,"comments_count"),p=(u,l)=>l===0?u>0?100:0:(u-l)/l*100;return{submissions_trend:p(o,h),grading_trend:p(f,_),engagement_trend:p(j,y),last_7_days:{submissions:o,graded:f,engagement:j},previous_7_days:{submissions:h,graded:_,engagement:y}}}catch(t){throw console.error("Error getting performance trend:",t),t}},ke=async r=>{try{const t=await $(r),s={excellent:0,good:0,average:0,below:0};t.forEach(a=>{s.excellent+=a.excellent_count||0,s.good+=a.good_count||0,s.average+=a.average_count||0,s.below+=a.below_average_count||0});const i=s.excellent+s.good+s.average+s.below;return{...s,total:i,percentages:{excellent:i>0?s.excellent/i*100:0,good:i>0?s.good/i*100:0,average:i>0?s.average/i*100:0,below:i>0?s.below/i*100:0}}}catch(t){throw console.error("Error getting grade distribution:",t),t}},Ce=async r=>{try{const t=await S(r),i=(await D(r)).filter(h=>(h.posts_created||0)+(h.comments_made||0)>0).length,a=t.total_students||1,o=i/a*100;return{total_posts:t.total_posts||0,total_comments:t.total_comments||0,active_students:i,total_students:a,participation_rate:o,avg_posts_per_student:(t.total_posts||0)/a,avg_comments_per_student:(t.total_comments||0)/a}}catch(t){throw console.error("Error getting engagement metrics:",t),t}},U=async r=>{try{const[t,s,i]=await Promise.all([S(r),D(r),$(r)]);let a=`ANALYTICS DA TURMA

`;return a+=`VIS√ÉO GERAL
`,a+=`Turma,${t.class_name}
`,a+=`Alunos,${t.total_students}
`,a+=`Atividades,${t.total_activities}
`,a+=`M√©dia Geral,${t.average_grade}
`,a+=`Taxa de Entrega,${t.submission_rate}%
`,a+=`Taxa de Corre√ß√£o,${t.grading_rate}%

`,a+=`RANKING DE ALUNOS
`,a+=`Posi√ß√£o,Nome,M√©dia,Percentual,Entregas,Coment√°rios
`,s.forEach(o=>{a+=`${o.rank_position},${o.student_name},${o.average_grade||"N/A"},${o.average_percentage||"N/A"}%,${o.total_submissions},${o.comments_made}
`}),a+=`
`,a+=`PERFORMANCE POR ATIVIDADE
`,a+=`Atividade,Tipo,M√©dia,Taxa de Entrega,Excelentes,Bons,Regulares,Abaixo
`,i.forEach(o=>{a+=`${o.activity_title},${o.activity_type},${o.average_grade||"N/A"},${o.submission_rate||0}%,${o.excellent_count||0},${o.good_count||0},${o.average_count||0},${o.below_average_count||0}
`}),a}catch(t){throw console.error("Error exporting analytics:",t),t}},Ee=async(r,t)=>{try{const s=await U(r),i=new Blob([s],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),o=URL.createObjectURL(i);a.setAttribute("href",o),a.setAttribute("download",`analytics_${t}_${new Date().toISOString().split("T")[0]}.csv`),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(s){throw console.error("Error downloading CSV:",s),s}},m={getClassOverview:S,getDailyActivity:V,getStudentRanking:D,getActivityPerformance:$,getClassInsights:we,compareClasses:Ne,getPerformanceTrend:Ae,getGradeDistribution:ke,getEngagementMetrics:Ce,exportAnalyticsToCSV:U,downloadAnalyticsCSV:Ee},ze=()=>{const{classId:r}=te(),[t,s]=d.useState(!0),[i,a]=d.useState(null),[o,h]=d.useState([]),[f,_]=d.useState([]),[j,y]=d.useState([]),[p,u]=d.useState(null),[l,P]=d.useState(null),[b,w]=d.useState(null),[T,q]=d.useState(null);d.useEffect(()=>{r&&z()},[r]);const z=async()=>{try{s(!0);const[n,c,W,X,H,J,Q,Z]=await Promise.all([m.getClassOverview(r),m.getDailyActivity(r),m.getStudentRanking(r,10),m.getActivityPerformance(r),m.getClassInsights(r),m.getPerformanceTrend(r),m.getGradeDistribution(r),m.getEngagementMetrics(r)]);a(n),h(c),_(W),y(X),u(H),P(J),w(Q),q(Z)}catch(n){console.error("Erro ao carregar analytics:",n),k.error("Erro ao carregar dados")}finally{s(!1)}},Y=async()=>{try{await m.downloadAnalyticsCSV(r,i.class_name),k.success("Relat√≥rio exportado!")}catch{k.error("Erro ao exportar relat√≥rio")}},N=n=>n>0?e.jsx(ce,{className:"w-4 h-4 text-green-600"}):n<0?e.jsx(fe,{className:"w-4 h-4 text-red-600"}):e.jsx(de,{className:"w-4 h-4 text-gray-400"}),A=n=>n>0?"text-green-600":n<0?"text-red-600":"text-gray-600",x={excellent:"#10b981",good:"#3b82f6",average:"#f59e0b",below:"#ef4444"};return t?e.jsx(se,{message:"Carregando analytics..."}):i?e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs(ae.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative overflow-hidden bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 rounded-3xl p-8 text-white",children:[e.jsx("div",{className:"absolute inset-0 opacity-10",children:e.jsx("div",{className:"absolute inset-0",style:{backgroundImage:"radial-gradient(circle at 1px 1px, white 1px, transparent 0)",backgroundSize:"40px 40px"}})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:"üìä Analytics da Turma"}),e.jsx("p",{className:"text-white/90 text-lg",children:i.class_name})]}),e.jsx(me,{variant:"white",leftIcon:xe,onClick:Y,className:"whitespace-nowrap inline-flex items-center gap-2 bg-white text-indigo-600 hover:bg-white/90",children:e.jsx("span",{children:"Exportar Relat√≥rio"})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(re,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white/70",children:"Alunos"}),e.jsx("p",{className:"text-2xl font-bold",children:i.total_students})]})]})}),e.jsx("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(ye,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white/70",children:"Atividades"}),e.jsx("p",{className:"text-2xl font-bold",children:i.total_activities})]})]})}),e.jsx("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(R,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white/70",children:"M√©dia Geral"}),e.jsx("p",{className:"text-2xl font-bold",children:i.average_grade?.toFixed(1)||"N/A"})]})]})}),e.jsx("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(ne,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white/70",children:"Engajamento"}),e.jsx("p",{className:"text-2xl font-bold",children:T?`${T.participation_rate.toFixed(0)}%`:"N/A"})]})]})})]})]})]}),p&&p.recommendations&&e.jsx(g,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(ie,{className:"w-6 h-6 text-primary"}),"Insights Autom√°ticos"]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:p.recommendations.map((n,c)=>e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg bg-muted/30",children:[e.jsx(oe,{className:"w-5 h-5 text-primary flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm",children:n.rec})]},c))})]})}),l&&e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsx(g,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-sm text-muted-foreground",children:"Submiss√µes"}),N(l.submissions_trend)]}),e.jsx("p",{className:"text-3xl font-bold mb-1",children:l.last_7_days.submissions.toFixed(1)}),e.jsxs("p",{className:`text-sm ${A(l.submissions_trend)}`,children:[l.submissions_trend>0?"+":"",l.submissions_trend.toFixed(1),"% vs semana anterior"]})]})}),e.jsx(g,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-sm text-muted-foreground",children:"Corre√ß√µes"}),N(l.grading_trend)]}),e.jsx("p",{className:"text-3xl font-bold mb-1",children:l.last_7_days.graded.toFixed(1)}),e.jsxs("p",{className:`text-sm ${A(l.grading_trend)}`,children:[l.grading_trend>0?"+":"",l.grading_trend.toFixed(1),"% vs semana anterior"]})]})}),e.jsx(g,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-sm text-muted-foreground",children:"Engajamento"}),N(l.engagement_trend)]}),e.jsx("p",{className:"text-3xl font-bold mb-1",children:l.last_7_days.engagement.toFixed(1)}),e.jsxs("p",{className:`text-sm ${A(l.engagement_trend)}`,children:[l.engagement_trend>0?"+":"",l.engagement_trend.toFixed(1),"% vs semana anterior"]})]})})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsx(g,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(ge,{className:"w-6 h-6 text-primary"}),"Atividade Di√°ria (30 dias)"]}),e.jsx(C,{width:"100%",height:300,children:e.jsxs(pe,{data:o,children:[e.jsx(L,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(F,{dataKey:"activity_date",tickFormatter:n=>B(new Date(n),"dd/MM",{locale:K}),className:"text-xs"}),e.jsx(I,{className:"text-xs"}),e.jsx(E,{contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"8px"},labelFormatter:n=>B(new Date(n),"dd 'de' MMM",{locale:K})}),e.jsx(O,{}),e.jsx(M,{type:"monotone",dataKey:"submissions_count",stroke:"#3b82f6",name:"Submiss√µes",strokeWidth:2}),e.jsx(M,{type:"monotone",dataKey:"graded_count",stroke:"#10b981",name:"Corrigidas",strokeWidth:2})]})})]})}),b&&e.jsx(g,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(he,{className:"w-6 h-6 text-primary"}),"Distribui√ß√£o de Notas"]}),e.jsx(C,{width:"100%",height:300,children:e.jsxs(ue,{children:[e.jsx(be,{data:[{name:"Excelente (90-100%)",value:b.excellent,fill:x.excellent},{name:"Bom (70-89%)",value:b.good,fill:x.good},{name:"Regular (50-69%)",value:b.average,fill:x.average},{name:"Abaixo (< 50%)",value:b.below,fill:x.below}],cx:"50%",cy:"50%",labelLine:!1,label:({name:n,percent:c})=>`${n}: ${(c*100).toFixed(0)}%`,outerRadius:80,dataKey:"value",children:[x.excellent,x.good,x.average,x.below].map((n,c)=>e.jsx(ve,{fill:n},`cell-${c}`))}),e.jsx(E,{})]})})]})})]}),e.jsx(g,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(R,{className:"w-6 h-6 text-primary"}),"Top 10 Alunos"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-slate-800 dark:to-slate-800 border-b-2 border-primary/20",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold",children:"#"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-bold",children:"Aluno"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-bold",children:"M√©dia"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-bold",children:"Percentual"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-bold",children:"Entregas"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-bold",children:"Participa√ß√£o"})]})}),e.jsx("tbody",{children:f.map((n,c)=>e.jsxs("tr",{className:"border-b border-border hover:bg-muted/30",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center justify-center w-8 h-8 rounded-full font-bold ${c===0?"bg-yellow-100 text-yellow-800":c===1?"bg-gray-100 text-gray-800":c===2?"bg-orange-100 text-orange-800":"bg-muted text-muted-foreground"}`,children:n.rank_position})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[n.avatar_url?e.jsx("img",{src:n.avatar_url,alt:n.student_name,className:"w-8 h-8 rounded-full"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center text-primary font-bold",children:n.student_name[0]}),e.jsx("span",{className:"font-medium",children:n.student_name})]})}),e.jsx("td",{className:"px-4 py-3 text-center font-bold",children:n.average_grade?.toFixed(1)||"N/A"}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-semibold ${n.average_percentage>=90?"bg-green-100 text-green-800":n.average_percentage>=70?"bg-blue-100 text-blue-800":n.average_percentage>=50?"bg-amber-100 text-amber-800":"bg-red-100 text-red-800"}`,children:[n.average_percentage?.toFixed(0)||0,"%"]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:n.total_submissions||0}),e.jsxs("td",{className:"px-4 py-3 text-center",children:[(n.posts_created||0)+(n.comments_made||0)," intera√ß√µes"]})]},n.student_id))})]})})]})}),j.length>0&&e.jsx(g,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(le,{className:"w-6 h-6 text-primary"}),"Performance por Atividade"]}),e.jsx(C,{width:"100%",height:400,children:e.jsxs(je,{data:j.slice(0,10),children:[e.jsx(L,{strokeDasharray:"3 3"}),e.jsx(F,{dataKey:"activity_title",angle:-45,textAnchor:"end",height:100,className:"text-xs"}),e.jsx(I,{}),e.jsx(E,{}),e.jsx(O,{}),e.jsx(G,{dataKey:"average_grade",fill:"#3b82f6",name:"M√©dia"}),e.jsx(G,{dataKey:"submission_rate",fill:"#10b981",name:"Taxa de Entrega (%)"})]})})]})})]}):e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("p",{className:"text-muted-foreground",children:"Nenhum dado dispon√≠vel"})})};export{ze as default};
