import{al as S,g as z,u as k,r as a,j as e,x as h,y as f,F as E,H as P,i as _,s as d}from"./main-7VZoQpWp.js";const A=()=>{const{quizId:l}=S(),b=z(),{user:u}=k(),[o,g]=a.useState([]),[j,y]=a.useState(""),[v,m]=a.useState(!0),[n,N]=a.useState({}),[q,p]=a.useState(!1);a.useEffect(()=>{(async()=>{try{m(!0);const[{data:i,error:t},{data:r,error:c}]=await Promise.all([d.from("quizzes").select("title").eq("id",l).eq("is_public",!0).single(),d.from("quiz_questions").select("question, position").eq("quiz_id",l).order("position")]);if(t)throw t;if(c)throw c;y(i?.title||"Quiz"),g(r||[])}catch{}finally{m(!1)}})()},[l]);const x=a.useMemo(()=>{let s=0;for(const i of o){const r=((i.question||{}).correta||"").toString().toUpperCase(),c=(n[i.position]||"").toString().toUpperCase();r&&c&&r===c&&(s+=1)}return s},[o,n]),w=(s,i)=>{N(t=>({...t,[s]:i}))},C=async()=>{try{if(!u)return;p(!0);const s=o.map(t=>({qid:t.question?.id,position:t.position,marked:n[t.position]||null,correct:t.question?.correta?t.question.correta.toString().toUpperCase()===(n[t.position]||"").toString().toUpperCase():null})),{error:i}=await d.from("quiz_attempts").insert({quiz_id:l,user_id:u.id,answers:s,score:x});if(i)throw i;b("/students/activities")}catch{}finally{p(!1)}};return v?e.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:j}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Pontuação: ",x]})]}),o.length===0?e.jsx(h,{children:e.jsx(f,{className:"py-10 text-center text-muted-foreground",children:"Nenhuma questão encontrada"})}):e.jsxs("div",{className:"space-y-4",children:[o.map(s=>{const i=s.question||{},t=i.alternativas||{};return e.jsxs(h,{children:[e.jsx(E,{children:e.jsxs(P,{className:"text-base",children:[s.position,". ",i.enunciado||"Pergunta"]})}),e.jsx(f,{children:e.jsx("div",{className:"grid gap-2",children:["A","B","C","D"].map(r=>e.jsxs("button",{onClick:()=>w(s.position,r),className:`text-left p-3 border rounded-lg transition-all ${n[s.position]===r?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-border bg-white dark:bg-slate-900 hover:bg-slate-50 dark:hover:bg-slate-800"}`,children:[e.jsxs("span",{className:"font-semibold mr-2",children:[r,")"]}),e.jsx("span",{children:t[r]||"—"})]},r))})})]},s.position)}),e.jsx("div",{className:"flex justify-end",children:e.jsx(_,{onClick:C,disabled:q,className:"whitespace-nowrap inline-flex items-center gap-2 rounded-lg bg-gradient-to-r from-blue-600 to-cyan-600 text-white shadow-lg px-8 py-2",children:"Enviar"})})]})]})};export{A as default};
