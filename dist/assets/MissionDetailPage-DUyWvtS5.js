import{al as I,u as q,g as z,r as d,s as j,ar as h,j as e,o as K,A as X,U as _,e as F,C as U,n as O,T as Y,ai as G,K as V}from"./main-BBAlbGLj.js";import{B as y}from"./badge-Dxkfeepr.js";import{P as o}from"./PremiumCard-BClPpHrg.js";import{P as g}from"./PremiumButton-CWdhOUBt.js";import{E as C}from"./EmptyState-Del568bV.js";import{u as f,w as H}from"./xlsx-BHh6c6ND.js";import{T as J}from"./target-DlA9JK4k.js";import{A as Q}from"./arrow-left-D8R0xudv.js";import{D as W}from"./download-CI4QKKyw.js";import{S as Z}from"./square-pen-S3N4newM.js";import{R as P,T as S}from"./CategoricalChart-DTJ2g2hZ.js";import{P as ee,a as se,C as te}from"./PieChart-0f8a09xQ.js";import{L as D}from"./Legend-Ci6apA5A.js";import{B as ae,a as re}from"./BarChart-B2AT-Z1K.js";import{C as ie,X as ne,Y as oe}from"./CartesianChart-Bdpru1KD.js";import"./index-D_P3mdcN.js";const ye=()=>{const{missionId:x}=I(),{user:v}=q(),N=z(),[E,k]=d.useState(!0),[t,A]=d.useState(null),[n,M]=d.useState([]),[u,L]=d.useState("");d.useEffect(()=>{b()},[x,v?.id]);const b=async()=>{try{const{data:s,error:a}=await j.from("missions").select("*, classes(name, subject)").eq("id",x).eq("created_by",v.id).single();if(a)throw a;A(s);const{data:r,error:i}=await j.from("user_missions").select("*, profiles(full_name, email)").eq("mission_id",x);if(i)throw i;M(r||[])}catch(s){console.error("Erro ao carregar missão:",s),h({title:"Erro",description:"Não foi possível carregar a missão.",variant:"destructive"})}finally{k(!1)}},B=async(s,a)=>{const r=a==="completed"?"in_progress":"completed",i=r==="completed"?100:50;try{const{error:m}=await j.from("user_missions").update({status:r,progress:i,completed_at:r==="completed"?new Date().toISOString():null}).eq("id",s);if(m)throw m;h({title:"Sucesso",description:`Status atualizado para ${r==="completed"?"concluída":"em andamento"}!`}),b()}catch(m){console.error("Erro ao atualizar status:",m),h({title:"Erro",description:"Não foi possível atualizar o status.",variant:"destructive"})}},p=d.useMemo(()=>{if(!u)return n;const s=u.toLowerCase();return n.filter(a=>a.profiles?.full_name?.toLowerCase().includes(s)||a.profiles?.email?.toLowerCase().includes(s))},[n,u]),l=d.useMemo(()=>{const s=n.length,a=n.filter(c=>c.status==="completed").length,r=n.filter(c=>c.status==="in_progress").length,i=n.filter(c=>c.status==="pending").length,m=s>0?n.reduce((c,$)=>c+($.progress||0),0)/s:0;return{total:s,completed:a,inProgress:r,pending:i,avgProgress:m.toFixed(1)}},[n]),w=d.useMemo(()=>[{name:"Concluídas",value:l.completed,color:"#10b981"},{name:"Em Andamento",value:l.inProgress,color:"#f59e0b"},{name:"Pendentes",value:l.pending,color:"#6b7280"}],[l]),T=d.useMemo(()=>{const s=[{name:"0-25%",count:0},{name:"26-50%",count:0},{name:"51-75%",count:0},{name:"76-100%",count:0}];return n.forEach(a=>{const r=a.progress||0;r<=25?s[0].count++:r<=50?s[1].count++:r<=75?s[2].count++:s[3].count++}),s},[n]),R=()=>{const s=n.map(i=>({Nome:i.profiles?.full_name||"N/A",Email:i.profiles?.email||"N/A",Status:i.status==="completed"?"Concluída":i.status==="in_progress"?"Em Andamento":"Pendente",Progresso:`${i.progress||0}%`,"Data Conclusão":i.completed_at?new Date(i.completed_at).toLocaleDateString("pt-BR"):"-"})),a=f.json_to_sheet(s),r=f.book_new();f.book_append_sheet(r,a,"Progresso Missão"),H(r,`missao_${t?.title?.replace(/\s/g,"_")}_progresso.xlsx`),h({title:"Sucesso",description:"Relatório exportado em Excel!"})};return E?e.jsx(K,{message:"Carregando missão..."}):t?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>N("/dashboard/missions"),className:"whitespace-nowrap inline-flex items-center gap-2 bg-white dark:bg-slate-900 text-foreground border-border rounded-lg",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{children:"Voltar"})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent",children:t.title}),e.jsx("p",{className:"text-muted-foreground",children:t.classes?.name})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(g,{onClick:R,variant:"outline",className:"whitespace-nowrap inline-flex items-center gap-2 bg-white dark:bg-slate-900 text-foreground border-border rounded-lg",children:[e.jsx(W,{className:"w-4 h-4"}),e.jsx("span",{children:"Exportar Excel"})]}),e.jsxs(g,{onClick:()=>N(`/dashboard/missions/edit/${x}`),variant:"outline",className:"whitespace-nowrap inline-flex items-center gap-2 bg-white dark:bg-slate-900 text-foreground border-border rounded-lg",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"Editar Missão"})]})]})]}),e.jsx(o,{variant:"elevated",children:e.jsx("div",{className:"p-6 bg-gradient-to-br from-orange-500/10 to-red-500/10",children:e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[t.description&&e.jsx("p",{className:"text-muted-foreground mb-4",children:t.description}),t.objective&&e.jsxs("div",{className:"bg-white/50 dark:bg-black/20 p-3 rounded-lg mb-4",children:[e.jsx("div",{className:"text-sm font-medium",children:"🎯 Objetivo:"}),e.jsx("div",{className:"text-sm mt-1",children:t.objective})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[t.start_date&&e.jsxs("span",{children:[e.jsx("strong",{children:"Início:"})," ",new Date(t.start_date).toLocaleDateString("pt-BR")]}),t.end_date&&e.jsxs("span",{children:[e.jsx("strong",{children:"Fim:"})," ",new Date(t.end_date).toLocaleDateString("pt-BR")]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-yellow-500"}),e.jsxs("strong",{children:[t.xp_reward," XP"]})]}),e.jsx(y,{variant:t.is_active?"default":"secondary",children:t.is_active?"Ativa":"Inativa"})]})]})})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(o,{variant:"elevated",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-lg flex items-center justify-center",children:e.jsx(_,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Alunos"}),e.jsx("div",{className:"text-2xl font-bold",children:l.total})]})]})})}),e.jsx(o,{variant:"elevated",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-500 rounded-lg flex items-center justify-center",children:e.jsx(F,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Concluídas"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:l.completed})]})]})})}),e.jsx(o,{variant:"elevated",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-orange-500 to-red-500 rounded-lg flex items-center justify-center",children:e.jsx(U,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Em Andamento"}),e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:l.inProgress})]})]})})}),e.jsx(o,{variant:"elevated",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-gray-500 to-slate-500 rounded-lg flex items-center justify-center",children:e.jsx(O,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Pendentes"}),e.jsx("div",{className:"text-2xl font-bold",children:l.pending})]})]})})}),e.jsx(o,{variant:"elevated",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg flex items-center justify-center",children:e.jsx(Y,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Progresso Médio"}),e.jsxs("div",{className:"text-2xl font-bold",children:[l.avgProgress,"%"]})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(o,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Distribuição de Status"}),e.jsx(P,{width:"100%",height:250,children:e.jsxs(ee,{children:[e.jsx(se,{data:w,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:80,label:!0,children:w.map((s,a)=>e.jsx(te,{fill:s.color},`cell-${a}`))}),e.jsx(S,{}),e.jsx(D,{})]})})]})}),e.jsx(o,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Distribuição de Progresso"}),e.jsx(P,{width:"100%",height:250,children:e.jsxs(ae,{data:T,children:[e.jsx(ie,{strokeDasharray:"3 3"}),e.jsx(ne,{dataKey:"name"}),e.jsx(oe,{}),e.jsx(S,{}),e.jsx(D,{}),e.jsx(re,{dataKey:"count",fill:"#f59e0b",name:"Alunos"})]})})]})})]}),e.jsx(o,{variant:"elevated",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(V,{value:u,onChange:s=>L(s.target.value),placeholder:"Buscar aluno por nome ou email...",className:"pl-10"})]})})}),e.jsx(o,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:["Progresso Individual (",p.length," alunos)"]}),p.length===0?e.jsx(C,{icon:_,title:"Nenhum aluno encontrado"}):e.jsx("div",{className:"space-y-3",children:p.map(s=>e.jsxs("div",{className:"p-4 border border-border rounded-lg hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("h3",{className:"font-semibold",children:s.profiles?.full_name||"Nome não disponível"}),e.jsx(y,{variant:s.status==="completed"?"default":s.status==="in_progress"?"secondary":"outline",className:s.status==="completed"?"bg-green-500/20 text-green-700":s.status==="in_progress"?"bg-orange-500/20 text-orange-700":"",children:s.status==="completed"?"✅ Concluída":s.status==="in_progress"?"🔥 Em Andamento":"⏳ Pendente"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.profiles?.email}),s.completed_at&&e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["Concluída em ",new Date(s.completed_at).toLocaleDateString("pt-BR")]})]}),e.jsx(g,{size:"sm",onClick:()=>B(s.id,s.status),variant:s.status==="completed"?"outline":"default",className:`whitespace-nowrap inline-flex items-center gap-2 rounded-lg ${s.status==="completed"?"bg-white dark:bg-slate-900 text-foreground border-border":"bg-gradient-to-r from-green-600 to-emerald-600 text-white shadow-lg"}`,children:s.status==="completed"?"Desmarcar":"Marcar como Concluída"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progresso"}),e.jsxs("span",{className:"font-semibold",children:[s.progress||0,"%"]})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-orange-500 to-red-500 transition-all",style:{width:`${s.progress||0}%`}})})]})]},s.id))})]})})]}):e.jsx(C,{icon:J,title:"Missão não encontrada"})};export{ye as default};
