import{u as C,r as c,s as x,ar as k,j as e,o as E,A as j,m as o,e as f,Z as M,T as S,d as A,C as T}from"./main-BTTCSkdE.js";import{B as h}from"./badge-BTDSVm_c.js";import{P as d}from"./PremiumCard-CV5gJlVo.js";import{E as X}from"./EmptyState-j91SMhTI.js";import{T as p}from"./target-DeybGG3h.js";import{F as D}from"./flame-l8HYhXOR.js";import{T as u}from"./trophy-B0eWu0Hq.js";import"./PremiumButton-TaG2j_oH.js";const G=()=>{const{user:m}=C(),[v,N]=c.useState(!0),[g,b]=c.useState([]),[l,w]=c.useState([]);c.useEffect(()=>{y()},[m?.id]);const y=async()=>{try{const{data:s,error:r}=await x.from("user_missions").select("*").eq("user_id",m.id);if(r)throw r;w(s||[]);const{data:a}=await x.from("class_members").select("class_id").eq("user_id",m.id).eq("role","student");if(a&&a.length>0){const i=a.map(P=>P.class_id),{data:n}=await x.from("missions").select("*, classes(name, subject)").in("class_id",i).eq("is_active",!0);b(n||[])}}catch(s){console.error("Erro ao carregar missões:",s),k({title:"Erro",description:"Não foi possível carregar as missões.",variant:"destructive"})}finally{N(!1)}},_=s=>l.find(r=>r.mission_id===s),t={total:l.length,completed:l.filter(s=>s.status==="completed").length,inProgress:l.filter(s=>s.status==="in_progress").length,totalXp:l.filter(s=>s.status==="completed").reduce((s,r)=>s+(r.missions?.xp_reward||0),0)};return v?e.jsx(E,{message:"Carregando missões..."}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-red-600 p-8 rounded-2xl text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(p,{className:"w-8 h-8"}),"Missões"]}),e.jsx("p",{className:"text-white/90 mt-1",children:"Complete desafios e ganhe XP para subir de nível!"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center px-6 py-3 bg-white/20 rounded-xl backdrop-blur",children:[e.jsx("div",{className:"text-3xl font-bold",children:t.completed}),e.jsx("div",{className:"text-sm text-white/80",children:"Concluídas"})]}),e.jsxs("div",{className:"text-center px-6 py-3 bg-white/20 rounded-xl backdrop-blur",children:[e.jsxs("div",{className:"text-3xl font-bold flex items-center gap-1",children:[e.jsx(j,{className:"w-6 h-6 text-yellow-300"}),t.totalXp]}),e.jsx("div",{className:"text-sm text-white/80",children:"XP Ganho"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsx(d,{variant:"elevated",children:e.jsx("div",{className:"p-4 bg-gradient-to-br from-orange-500/10 to-red-500/10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-orange-500 to-red-500 rounded-xl flex items-center justify-center",children:e.jsx(D,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Missões Ativas"}),e.jsx("div",{className:"text-2xl font-bold",children:t.inProgress})]})]})})})}),e.jsx(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsx(d,{variant:"elevated",children:e.jsx("div",{className:"p-4 bg-gradient-to-br from-green-500/10 to-emerald-500/10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-500 rounded-xl flex items-center justify-center",children:e.jsx(f,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Taxa de Conclusão"}),e.jsxs("div",{className:"text-2xl font-bold",children:[t.total>0?(t.completed/t.total*100).toFixed(0):0,"%"]})]})]})})})}),e.jsx(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsx(d,{variant:"elevated",children:e.jsx("div",{className:"p-4 bg-gradient-to-br from-purple-500/10 to-pink-500/10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center",children:e.jsx(u,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Rank"}),e.jsx("div",{className:"text-2xl font-bold",children:t.completed>=10?"Mestre":t.completed>=5?"Avançado":t.completed>=1?"Iniciante":"Novato"})]})]})})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(M,{className:"w-6 h-6 text-yellow-500"}),"Missões Disponíveis"]}),g.length===0?e.jsx(X,{icon:p,title:"Nenhuma missão disponível",description:"Aguarde seu professor criar desafios para você!"}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:g.map((s,r)=>{const a=_(s.id),i=a?.status==="completed",n=a?.status==="in_progress";return e.jsx(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:r*.1},children:e.jsx(d,{variant:"elevated",className:`overflow-hidden ${i?"border-2 border-green-500":""}`,children:e.jsxs("div",{className:`p-6 ${i?"bg-gradient-to-br from-green-500/10 to-emerald-500/10":n?"bg-gradient-to-br from-orange-500/10 to-red-500/10":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold",children:s.title}),i&&e.jsx(f,{className:"w-5 h-5 text-green-600"})]}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-yellow-500/20 rounded-lg",children:[e.jsx(j,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("span",{className:"font-bold text-yellow-600",children:[s.xp_reward," XP"]})]})]}),s.objective&&e.jsxs("div",{className:"bg-white/50 dark:bg-black/20 p-3 rounded-lg mb-4",children:[e.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4"}),"Objetivo:"]}),e.jsx("div",{className:"text-sm mt-1",children:s.objective})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-4",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(S,{className:"w-4 h-4"}),s.classes?.name]}),s.end_date&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"w-4 h-4"}),new Date(s.end_date).toLocaleDateString("pt-BR")]})]}),a&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progresso"}),e.jsxs("span",{className:"font-semibold",children:[a.progress,"%"]})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-orange-500 to-red-500 transition-all",style:{width:`${a.progress}%`}})})]}),e.jsx("div",{className:"mt-4",children:i?e.jsx(h,{className:"bg-green-500/20 text-green-700 w-full justify-center py-2",children:"✅ Concluída"}):n?e.jsx(h,{className:"bg-orange-500/20 text-orange-700 w-full justify-center py-2",children:"🔥 Em Andamento"}):e.jsxs(h,{variant:"secondary",className:"w-full justify-center py-2",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Pendente"]})})]})})},s.id)})})]}),t.completed>0&&e.jsx(d,{variant:"elevated",children:e.jsxs("div",{className:"p-6 bg-gradient-to-r from-purple-500/10 to-pink-500/10 text-center",children:[e.jsx(u,{className:"w-12 h-12 mx-auto mb-3 text-yellow-500"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Parabéns! 🎉"}),e.jsxs("p",{className:"text-muted-foreground",children:["Você já completou ",e.jsx("strong",{className:"text-green-600",children:t.completed})," ",t.completed===1?"missão":"missões"," e ganhou"," ",e.jsxs("strong",{className:"text-yellow-600",children:[t.totalXp," XP"]}),"! Continue assim para subir de nível!"]})]})})]})};export{G as default};
