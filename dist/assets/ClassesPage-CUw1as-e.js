import{r,u as xe,g as he,j as e,m as p,i,B as T,U as G,T as ue,ai as pe,K as F,S as ge,av as je,aw as ve,ax as fe,ay as k,O as J,az as be,C as we,aA as Ne,aB as ye,aC as Ce,aD as ke,aE as De,aF as Ee,aG as Se,aH as Ae,aI as H,aJ as V,aK as _,aL as K,J as M,aM as Te,aN as X,D as Q}from"./main-Bq8SWujy.js";import{t}from"./use-toast-B3A6Uz-E.js";import{e as Fe}from"./apiSupabase-DXB0AX6J.js";import{u as Me}from"./useRedisCache-rmpCT-4z.js";import{u as Le}from"./useUserRole-BmoQCIJ4.js";import{P as W}from"./plus-Bhf7V8rC.js";import{F as Pe}from"./funnel-BPRqr_Mx.js";import{E as Ue}from"./ellipsis-vertical-CqiwQ7pf.js";import{S as Be}from"./square-pen--qGm0uc2.js";import{U as Y}from"./user-plus-HVxnXTZL.js";import{T as Oe}from"./trash-2-hZ-NBhcz.js";const Ye=()=>{const[g,Z]=r.useState(""),[I,b]=r.useState(!1),[m,D]=r.useState(null),[ze,ee]=r.useState(!0),[$e,L]=r.useState(null),[d,E]=r.useState([]),[se,w]=r.useState(!1),[ae,N]=r.useState(!1),[x,P]=r.useState(null),[j,U]=r.useState(""),[B,O]=r.useState(""),[h,S]=r.useState(null),[o,u]=r.useState(!1),{user:v}=xe(),y=he(),{isTeacher:c}=Le(),{data:A,loading:z,error:$,invalidateCache:te}=Me(v?.id,c?"teacher":"student"),R=["from-blue-500 to-blue-600","from-green-500 to-green-600","from-purple-500 to-purple-600","from-orange-500 to-orange-600","from-pink-500 to-pink-600","from-indigo-500 to-indigo-600","from-teal-500 to-teal-600","from-amber-500 to-amber-600"];r.useEffect(()=>{(async()=>{if(v)try{if(ee(z),L($),A){const a=A.map((n,C)=>({...n,color:R[C%R.length],students:n.students_count||0,activities:n.activities_count||0,nextClass:n.next_class||null}));E(a)}}catch(a){console.error("Error processing classes:",a),L(`Falha ao processar as turmas: ${a.message}`),t({title:"Erro",description:"Não foi possível processar as turmas.",variant:"destructive"})}})()},[v,A,z,$]);const l=async(s,a=null)=>{try{if(!a&&s!=="create"){console.error("No class provided for action:",s);return}switch(s){case"create":y("/dashboard/classes/new");break;case"view":a?.id&&y(`/classes/${a.id}`);break;case"edit":t({title:"Editar turma",description:`Editando turma: ${a?.name||"Sem nome"}`});break;case"inviteStudent":P(a),w(!0);break;case"delete":D(a),b(!0);break;case"export":oe(a);break;case"uploadMaterial":P(a),N(!0);break;case"students":a?y("/dashboard/students",{state:{classId:a.id}}):y("/dashboard/students");break;case"filter":t({title:"Filtros",description:"Use os campos de busca e seleção para filtrar as turmas."});break;default:t({title:"Ação não implementada",description:`A ação ${s} ainda não foi implementada.`}),console.warn("Ação não implementada:",s);break}}catch(n){t({variant:"destructive",title:"Erro",description:n.message})}},re=s=>{D(s),b(!0)},ie=async()=>{if(m)try{await te(),E(d.filter(s=>s.id!==m.id)),t({title:"Turma removida!",description:`A turma "${m.name}" foi removida com sucesso.`})}catch(s){console.error("Error invalidating cache:",s),E(d.filter(a=>a.id!==m.id)),t({title:"Turma removida!",description:`A turma "${m.name}" foi removida com sucesso.`})}b(!1),D(null)},le=async()=>{if(!x||!j){t({title:"Erro",description:"Por favor, preencha o email do aluno.",variant:"destructive"});return}u(!0);try{console.log("Convidando aluno:",{email:j,classId:x.id,className:x.name,message:B,invitedBy:v.id}),t({title:"Convite enviado!",description:`Um convite foi enviado para ${j}.`}),w(!1),U(""),O("")}catch(s){console.error("Error inviting student:",s),t({title:"Erro",description:"Não foi possível enviar o convite. Tente novamente.",variant:"destructive"})}finally{u(!1)}},oe=async s=>{if(s){u(!0);try{const a=await Fe(s.id),n=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),C=window.URL.createObjectURL(n),f=document.createElement("a");f.href=C,f.download=`dados-turma-${s.name}.json`,document.body.appendChild(f),f.click(),window.URL.revokeObjectURL(C),document.body.removeChild(f),t({title:"Exportação concluída!",description:"Os dados da turma foram baixados com sucesso."})}catch(a){console.error("Error exporting class data:",a),t({title:"Erro",description:"Não foi possível exportar os dados da turma.",variant:"destructive"})}finally{u(!1)}}},ne=async()=>{if(!x||!h){t({title:"Erro",description:"Por favor, selecione um arquivo para enviar.",variant:"destructive"});return}u(!0);try{const s=new FormData;s.append("file",h),s.append("classId",x.id),s.append("uploadedBy",v.id),await new Promise(a=>setTimeout(a,1500)),t({title:"Material enviado!",description:`O arquivo foi enviado com sucesso para a turma ${x.name}.`}),N(!1),S(null)}catch(s){console.error("Error uploading material:",s),t({title:"Erro",description:"Não foi possível enviar o material. Tente novamente.",variant:"destructive"})}finally{u(!1)}},de=s=>{const a=s.target.files[0];if(a){if(a.size>10*1024*1024){t({title:"Arquivo muito grande",description:"O tamanho máximo permitido é 10MB.",variant:"destructive"});return}S(a)}},q=d.filter(s=>s.name.toLowerCase().includes(g.toLowerCase())||s.subject.toLowerCase().includes(g.toLowerCase())),ce=d.reduce((s,a)=>s+a.students,0),me=Math.round(d.reduce((s,a)=>s+a.performance,0)/d.length);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100",children:[e.jsxs("div",{className:"w-full space-y-8 p-6",children:[e.jsxs(p.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"relative overflow-hidden bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 rounded-3xl p-8 text-white",children:[e.jsx("div",{className:"absolute inset-0 bg-black/10"}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-4xl font-bold",children:"Turmas"}),e.jsx("p",{className:"text-blue-100 text-lg",children:"Gerencie suas turmas e acompanhe o desempenho dos alunos"})]}),c&&e.jsxs(i,{className:"bg-white/20 backdrop-blur-sm hover:bg-white/30 text-white border border-white/30 transition-all duration-300",onClick:()=>l("create"),children:[e.jsx(W,{className:"mr-2 w-5 h-5"}),"Nova Turma"]})]})}),e.jsx("div",{className:"absolute -top-4 -right-4 w-24 h-24 bg-white/10 rounded-full blur-xl"}),e.jsx("div",{className:"absolute -bottom-8 -left-8 w-32 h-32 bg-white/5 rounded-full blur-2xl"})]}),e.jsxs(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl p-6 border border-white/50 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Total de Turmas"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:d.length})]}),e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl flex items-center justify-center",children:e.jsx(T,{className:"w-6 h-6 text-white"})})]})}),e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl p-6 border border-white/50 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Total de Alunos"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:ce})]}),e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-green-500 to-green-600 rounded-xl flex items-center justify-center",children:e.jsx(G,{className:"w-6 h-6 text-white"})})]})}),e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl p-6 border border-white/50 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Performance Média"}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:[me,"%"]})]}),e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl flex items-center justify-center",children:e.jsx(ue,{className:"w-6 h-6 text-white"})})]})})]}),e.jsxs(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(pe,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),e.jsx(F,{placeholder:"Buscar turmas...",value:g,onChange:s=>Z(s.target.value),className:"pl-12 h-12 bg-white/70 backdrop-blur-sm border-white/50 rounded-xl"})]}),e.jsxs(i,{variant:"outline",className:"h-12 bg-white/70 backdrop-blur-sm border-white/50",onClick:()=>l("filter"),children:[e.jsx(Pe,{className:"mr-2 w-5 h-5"}),"Filtros"]}),c&&e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"outline",className:"h-12 bg-white/70 backdrop-blur-sm border-white/50",onClick:()=>l("export"),children:"Exportar"}),e.jsx(i,{variant:"outline",className:"h-12 bg-white/70 backdrop-blur-sm border-white/50",onClick:()=>l("uploadMaterial"),children:"Carregar Material"})]})]}),q.length>0?e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:q.map((s,a)=>e.jsxs(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*a},className:"group bg-white/70 backdrop-blur-sm rounded-2xl border border-white/50 shadow-lg overflow-hidden hover:shadow-xl hover:scale-105 transition-all duration-300",children:[e.jsxs("div",{className:`bg-gradient-to-r ${s.color} p-6 text-white relative overflow-hidden`,children:[e.jsx("div",{className:"absolute inset-0 bg-black/10"}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-bold text-xl",children:s.name}),e.jsx("p",{className:"text-white/90",children:s.subject}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(ge,{className:"w-4 h-4 text-yellow-300"}),e.jsxs("span",{className:"text-sm font-medium",children:[s.performance,"% performance"]})]})]}),e.jsxs(je,{children:[e.jsx(ve,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8 text-white hover:bg-white/20",children:e.jsx(Ue,{className:"h-4 w-4"})})}),e.jsxs(fe,{align:"end",className:"bg-white/95 backdrop-blur-sm",children:[e.jsxs(k,{onClick:()=>l("view",s),children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Visualizar"})]}),c&&e.jsxs(k,{onClick:()=>l("edit",s),children:[e.jsx(Be,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Editar"})]}),c&&e.jsxs(k,{onClick:()=>l("inviteStudent",s),children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Convidar Aluno"})]}),e.jsx(be,{}),c&&e.jsxs(k,{className:"text-red-600 focus:text-red-600 focus:bg-red-50",onClick:()=>re(s),children:[e.jsx(Oe,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Excluir"})]})]})]})]})}),e.jsx("div",{className:"absolute -top-4 -right-4 w-16 h-16 bg-white/10 rounded-full blur-xl"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(G,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Alunos"}),e.jsx("p",{className:"font-semibold text-gray-900",children:s.students})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(T,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Atividades"}),e.jsx("p",{className:"font-semibold text-gray-900",children:s.activities})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center",children:e.jsx(we,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Próxima Aula"}),e.jsx("p",{className:"font-semibold text-gray-900",children:new Date(s.nextClass).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})]})]})]}),e.jsx("div",{className:"p-6 pt-0",children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(i,{variant:"outline",size:"sm",className:"flex-1 bg-white/50 hover:bg-white/80 transition-all duration-300",onClick:()=>l("view",s),children:[e.jsx(J,{className:"mr-2 w-4 h-4"}),"Visualizar"]}),e.jsxs(i,{variant:"outline",size:"sm",className:"flex-1 bg-white/50 hover:bg-white/80 transition-all duration-300",onClick:()=>l("students",s),children:[e.jsx(Y,{className:"mr-2 w-4 h-4"}),"Alunos"]})]})})]},s.id))}):e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-16 bg-white/70 backdrop-blur-sm rounded-2xl border border-white/50",children:[e.jsx(T,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Nenhuma turma encontrada"}),e.jsx("p",{className:"text-gray-500 mb-6",children:g?"Tente ajustar sua busca":"Comece criando sua primeira turma"}),!g&&c&&e.jsxs(i,{className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white",onClick:()=>l("create"),children:[e.jsx(W,{className:"mr-2 w-5 h-5"}),"Nova Turma"]})]}),e.jsx(Ne,{open:I,onOpenChange:b,children:e.jsxs(ye,{className:"bg-white/95 backdrop-blur-sm",children:[e.jsxs(Ce,{children:[e.jsx(ke,{children:"Confirmar exclusão"}),e.jsxs(De,{children:['Tem certeza que deseja excluir a turma "',m?.name,'"? Esta ação não pode ser desfeita.']})]}),e.jsxs(Ee,{children:[e.jsx(Se,{children:"Cancelar"}),e.jsx(Ae,{onClick:ie,className:"bg-red-600 hover:bg-red-700",children:"Sim, excluir"})]})]})})]}),e.jsx(H,{open:se,onOpenChange:w,children:e.jsxs(V,{className:"sm:max-w-[425px]",children:[e.jsx(_,{children:e.jsx(K,{children:"Convidar Aluno"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"email",children:"Email do Aluno"}),e.jsx(F,{id:"email",type:"email",placeholder:"email@exemplo.com",value:j,onChange:s=>U(s.target.value),disabled:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"message",children:"Mensagem (opcional)"}),e.jsx(Te,{id:"message",placeholder:"Adicione uma mensagem pessoal...",value:B,onChange:s=>O(s.target.value),disabled:o,rows:3})]})]}),e.jsxs(X,{children:[e.jsx(i,{variant:"outline",onClick:()=>w(!1),disabled:o,children:"Cancelar"}),e.jsx(i,{onClick:le,disabled:!j||o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}),"Enviando..."]}):"Enviar Convite"})]})]})}),e.jsx(H,{open:ae,onOpenChange:N,children:e.jsxs(V,{className:"sm:max-w-[425px]",children:[e.jsx(_,{children:e.jsx(K,{children:"Enviar Material"})}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"file",children:"Selecione um arquivo"}),e.jsx(F,{id:"file",type:"file",onChange:de,disabled:o,accept:".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.jpg,.jpeg,.png"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Formatos suportados: PDF, DOC, XLS, PPT, JPG, PNG (até 10MB)"}),h&&e.jsxs("div",{className:"mt-2 p-3 bg-muted/50 rounded-md",children:[e.jsx("p",{className:"text-sm font-medium",children:h.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(h.size/1024/1024).toFixed(2)," MB"]})]})]})}),e.jsxs(X,{children:[e.jsx(i,{variant:"outline",onClick:()=>{N(!1),S(null)},disabled:o,children:"Cancelar"}),e.jsx(i,{onClick:ne,disabled:!h||o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}),"Enviando..."]}):"Enviar Material"})]})]})})]})};export{Ye as default};
