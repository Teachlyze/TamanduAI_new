import{f as $,r as c,j as e,x as f,F as C,H as D,d as T,I as W,y as v,J as y,i as p,K as _,$ as X,m as N,a1 as J,s as K,z as k,D as Q,V as b,C as z,c as Y,ak as M,u as Z,g as ee,U as ae,Q as se,W as te,X as A,a0 as L,Y as E}from"./main-NgjJy_CG.js";import{C as B}from"./classService-CTxchFmi.js";import{B as re}from"./badge-DS8upoqS.js";import{A as F,a as P}from"./alert-CGDDrWKl.js";import{t as j}from"./use-toast-GUBWlXfL.js";import{T as le}from"./trash-2-Bhwmq7t6.js";import{T as ie}from"./triangle-alert-P0wVQhy1.js";import{P as ne}from"./plus-BItzgCLM.js";import{S as ce}from"./save-CY3ziv22.js";import{P as V}from"./play-CPutuHnO.js";import{D as de}from"./download-BtFddqD_.js";import{A as oe}from"./arrow-left-MOSQdYvL.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]],xe=$("hard-drive",me),he=({classId:o,initialData:d})=>{const[t,n]=c.useState(""),[i,h]=c.useState(""),[r,u]=c.useState([]),[l,w]=c.useState(""),[a,m]=c.useState(!1),[G,g]=c.useState(!1);c.useEffect(()=>{d&&(n(d.vacation_start||""),h(d.vacation_end||""),u(d.cancelled_dates||[]))},[d]);const H=()=>{if(!l){j({variant:"destructive",title:"Data não selecionada",description:"Selecione uma data para cancelar."});return}if(r.includes(l)){j({variant:"destructive",title:"Data já cancelada",description:"Esta data já está na lista de cancelamentos."});return}u([...r,l].sort()),w(""),g(!0)},R=s=>{u(r.filter(x=>x!==s)),g(!0)},q=()=>{n(""),h(""),g(!0)},I=async()=>{try{if(m(!0),t&&i){const x=new Date(t);if(new Date(i)<x){j({variant:"destructive",title:"Período inválido",description:"A data de fim deve ser posterior à data de início."});return}}const s={vacation_start:t||null,vacation_end:i||null,cancelled_dates:r.length>0?r:null};await B.updateClassSchedule(o,s),j({title:"✅ Horários atualizados!",description:"As alterações de férias e cancelamentos foram salvas."}),g(!1)}catch(s){console.error("Error updating schedule:",s),j({variant:"destructive",title:"Erro ao salvar",description:s.message||"Não foi possível atualizar os horários."})}finally{m(!1)}},S=s=>new Date(s+"T00:00:00").toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric"}),O=()=>{if(!t||!i)return null;const s=new Date(t),x=new Date(i);return Math.ceil((x-s)/(1e3*60*60*24))+1};return e.jsxs(f,{className:"bg-white/80 backdrop-blur-sm shadow-lg",children:[e.jsxs(C,{children:[e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-orange-500 to-red-600 rounded-lg flex items-center justify-center text-white hover:opacity-90",children:e.jsx(T,{className:"w-4 h-4 text-white"})}),"Cancelamentos e Férias"]}),e.jsx(W,{children:"Gerencie quando a turma não terá aula"})]}),e.jsxs(v,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{className:"text-base font-semibold",children:"Período de Férias"}),(t||i)&&e.jsxs(p,{variant:"ghost",size:"sm",onClick:q,className:"whitespace-nowrap inline-flex items-center gap-1 text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(le,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs",children:"Limpar"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"vacation-start",className:"text-sm",children:"Data de Início"}),e.jsx(_,{id:"vacation-start",type:"date",value:t,onChange:s=>{n(s.target.value),g(!0)},className:"mt-1 bg-white dark:bg-slate-900"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"vacation-end",className:"text-sm",children:"Data de Término"}),e.jsx(_,{id:"vacation-end",type:"date",value:i,onChange:s=>{h(s.target.value),g(!0)},min:t,className:"mt-1 bg-white dark:bg-slate-900"})]})]}),t&&i&&e.jsxs(F,{className:"bg-orange-50 dark:bg-orange-950 border-orange-200 dark:border-orange-800",children:[e.jsx(ie,{className:"h-4 w-4 text-orange-600"}),e.jsxs(P,{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Férias programadas:"})," ",O()," dias (",S(t)," a ",S(i),"). As aulas não aparecerão para os alunos durante este período."]})]})]}),e.jsx("div",{className:"border-t pt-6"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(y,{className:"text-base font-semibold",children:"Cancelar Aulas em Datas Específicas"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Selecione dias específicos em que a aula não acontecerá (ex: feriados)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{type:"date",value:l,onChange:s=>w(s.target.value),className:"flex-1 bg-white dark:bg-slate-900",placeholder:"Selecione uma data"}),e.jsxs(p,{onClick:H,disabled:!l,className:"whitespace-nowrap inline-flex items-center gap-2 min-w-fit bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"Adicionar"})]})]}),e.jsx("div",{className:"min-h-[60px] p-3 border rounded-lg bg-slate-50 dark:bg-slate-900",children:e.jsx(X,{mode:"popLayout",children:r.length===0?e.jsx(N.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-muted-foreground text-center py-2",children:"Nenhuma data cancelada"}):e.jsx("div",{className:"flex flex-wrap gap-2",children:r.map((s,x)=>e.jsx(N.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{delay:x*.05},children:e.jsxs(re,{variant:"secondary",className:"whitespace-nowrap inline-flex items-center gap-2 min-w-fit px-3 py-1 hover:bg-red-100 dark:hover:bg-red-950 transition-colors",children:[e.jsx("span",{children:S(s)}),e.jsx(J,{className:"w-3 h-3 cursor-pointer text-red-600 hover:text-red-700",onClick:()=>R(s)})]})},s))})})}),r.length>0&&e.jsxs(F,{children:[e.jsx(T,{className:"h-4 w-4"}),e.jsxs(P,{className:"text-sm",children:[r.length," ",r.length===1?"aula cancelada":"aulas canceladas",". Os alunos não verão essas datas na agenda."]})]})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsx(p,{onClick:I,disabled:!G||a,className:"w-full whitespace-nowrap inline-flex items-center gap-2 min-w-fit bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white disabled:opacity-50 hover:opacity-90",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Salvando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsx("span",{children:"Salvar Alterações"})]})})})]})]})},ue=({classId:o})=>{const[d,t]=c.useState([]),[n,i]=c.useState(!0);c.useEffect(()=>{o&&h()},[o]);const h=async()=>{try{i(!0);const{data:a,error:m}=await K.from("class_recordings").select("*").eq("class_id",o).eq("status","ready").order("recorded_date",{ascending:!1});if(m)throw m;t(a||[])}catch(a){console.error("Error loading recordings:",a),k.error("Erro ao carregar gravações")}finally{i(!1)}},r=a=>{a.recording_url?window.open(a.recording_url,"_blank"):k.error("URL da gravação não disponível")},u=a=>{a.recording_url?(window.open(a.recording_url,"_blank"),k.success("Download iniciado")):k.error("Download não disponível")},l=a=>new Date(a).toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric"}),w=a=>a?a>=1024?`${(a/1024).toFixed(2)} GB`:`${a.toFixed(2)} MB`:"N/A";return n?e.jsx(f,{className:"bg-white/80 backdrop-blur-sm shadow-lg",children:e.jsx(v,{className:"p-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[e.jsx(Q,{className:"w-12 h-12 text-emerald-600 animate-spin mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Carregando gravações..."})]})})}):!d||d.length===0?e.jsxs(f,{className:"bg-white/80 backdrop-blur-sm shadow-lg",children:[e.jsx(C,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5 text-emerald-600"}),"Gravações das Aulas"]})}),e.jsx(v,{className:"p-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center mb-4",children:e.jsx(b,{className:"w-10 h-10 text-slate-400"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nenhuma gravação disponível"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md",children:"As gravações das aulas aparecerão aqui após serem processadas e publicadas."})]})})]}):e.jsxs(f,{className:"bg-white/80 backdrop-blur-sm shadow-lg",children:[e.jsx(C,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5 text-emerald-600"}),"Gravações das Aulas",e.jsxs("span",{className:"ml-auto text-sm font-normal text-muted-foreground",children:[d.length," ",d.length===1?"gravação":"gravações"]})]})}),e.jsxs(v,{className:"space-y-4",children:[d.map((a,m)=>e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:m*.1},className:"group relative overflow-hidden border-2 border-border rounded-xl p-4 hover:border-emerald-500 hover:shadow-lg transition-all duration-300",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-emerald-500 via-teal-500 to-cyan-500"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-16 h-16 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-500 flex items-center justify-center text-white shadow-lg group-hover:scale-110 transition-transform",children:e.jsx(V,{className:"w-8 h-8"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-lg mb-1",children:["Aula do dia ",l(a.recorded_date)]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-muted-foreground",children:[a.duration_minutes&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsxs("span",{children:[a.duration_minutes," min"]})]}),a.file_size_mb&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"w-4 h-4"}),e.jsx("span",{children:w(a.file_size_mb)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsxs("span",{children:["Publicado ",l(a.created_at)]})]})]})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-3 py-1 rounded-full bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium",children:"Disponível"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(p,{onClick:()=>r(a),className:"whitespace-nowrap inline-flex items-center gap-2 bg-gradient-to-r from-emerald-600 to-teal-600 text-white hover:from-emerald-700 hover:to-teal-700",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsx("span",{children:"Assistir"})]}),e.jsxs(p,{onClick:()=>u(a),variant:"outline",className:"whitespace-nowrap inline-flex items-center gap-2 bg-white dark:bg-slate-900 text-foreground border-border",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:"Download"})]})]})]})]}),a.google_drive_id&&e.jsx("div",{className:"mt-3 pt-3 border-t border-border",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-blue-500 flex items-center justify-center text-slate-900 dark:text-white text-[8px] font-bold",children:"G"}),e.jsx("span",{children:"Armazenado no Google Drive"})]})})]},a.id)),e.jsx("div",{className:"mt-6 p-4 rounded-lg bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Y,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-900 dark:text-blue-100",children:[e.jsx("p",{className:"font-medium mb-1",children:"Sobre as gravações"}),e.jsx("p",{className:"text-blue-700 dark:text-blue-300",children:"As gravações ficam disponíveis para todos os alunos da turma. Elas são processadas automaticamente após cada aula online."})]})]})})]})]})},Se=()=>{const{classId:o}=M(),{user:d}=Z(),t=ee(),[n,i]=c.useState(null),[h,r]=c.useState(!0);c.useEffect(()=>{o&&u()},[o]);const u=async()=>{try{r(!0);const l=await B.getClassById(o);i(l)}catch(l){console.error("Error loading class:",l),j({variant:"destructive",title:"Erro ao carregar turma",description:l.message})}finally{r(!1)}};return h?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-emerald-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Carregando turma..."})]})}):n?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-emerald-50 to-teal-100 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs(N.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"relative overflow-hidden bg-gradient-to-r from-emerald-600 via-teal-600 to-cyan-600 rounded-3xl p-8 text-white shadow-2xl",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsxs(p,{variant:"ghost",onClick:()=>t("/dashboard/classes"),className:"whitespace-nowrap inline-flex items-center gap-2 text-white hover:bg-white/20 mb-4",children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsx("span",{children:"Voltar"})]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:n.name}),e.jsxs("p",{className:"text-emerald-100 text-lg",children:[n.subject," • ",n.academic_year]}),n.is_online&&e.jsxs("div",{className:"flex items-center gap-2 mt-3 bg-white/10 backdrop-blur-sm px-4 py-2 rounded-lg w-fit",children:[e.jsx(b,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Aula Online Configurada"})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"text-center bg-white/10 backdrop-blur-sm px-6 py-3 rounded-xl",children:[e.jsx(ae,{className:"w-5 h-5 mx-auto mb-1"}),e.jsx("p",{className:"text-sm opacity-90",children:"Alunos"}),e.jsx("p",{className:"text-2xl font-bold",children:n.members?.filter(l=>l.role==="student").length||0})]})})]})]}),e.jsx("div",{className:"absolute -top-4 -right-4 w-24 h-24 bg-white/10 rounded-full blur-xl"}),e.jsx("div",{className:"absolute -bottom-8 -left-8 w-32 h-32 bg-white/5 rounded-full blur-2xl"})]}),e.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs(se,{defaultValue:"schedule",className:"space-y-6",children:[e.jsxs(te,{className:"grid w-full grid-cols-3 bg-white/80 backdrop-blur-sm p-1 rounded-xl shadow-lg",children:[e.jsxs(A,{value:"schedule",className:"whitespace-nowrap inline-flex items-center gap-2 data-[state=active]:bg-emerald-600 data-[state=active]:text-white",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{children:"Horários"})]}),e.jsxs(A,{value:"recordings",className:"whitespace-nowrap inline-flex items-center gap-2 data-[state=active]:bg-emerald-600 data-[state=active]:text-white",children:[e.jsx(b,{className:"w-4 h-4"}),e.jsx("span",{children:"Gravações"})]}),e.jsxs(A,{value:"settings",className:"whitespace-nowrap inline-flex items-center gap-2 data-[state=active]:bg-emerald-600 data-[state=active]:text-white",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{children:"Configurações"})]})]}),e.jsx(E,{value:"schedule",className:"space-y-6",children:e.jsx(he,{classId:o,initialData:n})}),e.jsx(E,{value:"recordings",className:"space-y-6",children:e.jsx(ue,{classId:o})}),e.jsx(E,{value:"settings",className:"space-y-6",children:e.jsxs(f,{className:"bg-white/80 backdrop-blur-sm shadow-lg",children:[e.jsx(C,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-emerald-600"}),"Configurações da Turma"]})}),e.jsx(v,{children:e.jsx("p",{className:"text-muted-foreground",children:"Outras configurações da turma aparecerão aqui."})})]})})]})})]})}):e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-semibold mb-2",children:"Turma não encontrada"}),e.jsx(p,{onClick:()=>t("/dashboard/classes"),children:"Voltar para turmas"})]})})};export{Se as default};
