import{r as j,j as g,R as Os,C as gi,f as Wo,g as $o,o as Uo,h as Jo,L as qo,x as Vo,i as Ho,k as Yo,l as Go,s as Qo,m as Xo,n as Zo,G as ea,F as mn,p as ar,S as ta,q as na,I as sa,T as lr,P as ls,W as ra,t as cr,u as cs,v as sn,w as ia,y as us,A as pi,z as oa,B as aa}from"./react-vendor-C2HUFn5N.js";import{c as la}from"./supabase-vendor-DDsnGwAF.js";import{q as qn,S as ca,_ as ua,W as da,P as fa,l as ha,n as ga,E as pa,$ as ma,Z as _a,A as ya,R as xa,a as va}from"./vendor-lexical-BwIB3SdY.js";import{u as ba,a as Sa,o as ur,b as dr,s as Me,c as Na,n as Ca}from"./form-vendor-DOeDnMZv.js";import{c as wa}from"./utils-small-jbG8BFt3.js";import{S as ka,R as Ta,V as Ea,T as mi,I as Oa,P as Aa,C as _i,a as ja,b as yi,c as Ma,d as Da,e as xi,f as vi,L as bi,g as Si,h as Ni,i as Pa}from"./ui-vendor-Dv2DrOQv.js";import{u as Ci,a as La,b as Ia}from"./vendor-react-router-B4Bn0PSh.js";import{m as se,A as Fa}from"./motion-vendor-Crtv24Dn.js";const Lt={DEBUG:0,INFO:1,WARN:2,ERROR:3,CRITICAL:4},Ra=()=>Lt["WARN".toUpperCase()]??Lt.INFO,Ba=n=>n>=Ra(),za=()=>{try{return{userId:null,userEmail:null,sessionId:sessionStorage.getItem("session_id")||Ka()}}catch{return{userId:null,userEmail:null,sessionId:"unknown"}}},Ka=()=>{const n=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return sessionStorage.setItem("session_id",n),n},Wa=(n,e,t=null)=>{const s=new Date().toISOString(),r=za();return{timestamp:s,level:Lt[n],levelName:n,message:e,data:t?JSON.stringify(t):null,userId:r.userId,userEmail:r.userEmail,sessionId:r.sessionId,userAgent:navigator.userAgent,url:window.location.href,environment:"production"}},$a=async n=>{try{if(!(n.level>=Lt.ERROR))return;const{error:t}=await V.from("application_logs").insert([{timestamp:n.timestamp,level:n.level,level_name:n.levelName,message:n.message,data:n.data,user_id:n.userId,user_email:n.userEmail,session_id:n.sessionId,user_agent:n.userAgent,url:n.url,environment:n.environment}]);t&&console.error("[Logger] Failed to save log to database:",t)}catch(e){console.error("[Logger] Error saving log:",e)}},Ua=(n,e,t=null)=>{const s={DEBUG:"color: #6b7280; font-weight: normal;",INFO:"color: #3b82f6; font-weight: normal;",WARN:"color: #f59e0b; font-weight: bold;",ERROR:"color: #ef4444; font-weight: bold;",CRITICAL:"color: #dc2626; font-weight: bold; background: #fee2e2; padding: 2px 4px; border-radius: 2px;"},r=new Date().toLocaleTimeString();(n==="ERROR"||n==="CRITICAL")&&(t?console.log(`%c[${r}] ${n}: ${e}`,s[n],t):console.log(`%c[${r}] ${n}: ${e}`,s[n]))},kt=async(n,e,t=null)=>{if(!Ba(Lt[n]))return;const s=Wa(n,e,t);Ua(n,e,t),await $a(s),n==="CRITICAL"&&window.Sentry&&window.Sentry.captureException(new Error(e),{extra:{data:t,logEntry:s}})},au={debug:(n,e)=>kt("DEBUG",n,e),info:(n,e)=>kt("INFO",n,e),warn:(n,e)=>kt("WARN",n,e),error:(n,e)=>kt("ERROR",n,e),critical:(n,e)=>kt("CRITICAL",n,e),setUserContext:(n,e)=>{try{typeof window<"u"&&(sessionStorage.setItem("user_id",n),sessionStorage.setItem("user_email",e))}catch(t){console.error("[Logger] Error setting user context:",t)}},clearUserContext:()=>{try{typeof window<"u"&&(sessionStorage.removeItem("user_id"),sessionStorage.removeItem("user_email"))}catch(n){console.error("[Logger] Error clearing user context:",n)}}},wi="https://your-project.supabase.co",ki="sb_publishable_i8D_YZFYtLHYtjYBCBwHkw_ARu1MIyi",Ja=async(n,e={})=>{let s,r;const o=n.startsWith("http")?n:`${wi}${n.startsWith("/")?"":"/"}${n}`,a=new Headers(e.headers);!a.has("Content-Type")&&!(e.body instanceof FormData)&&a.set("Content-Type","application/json"),a.set("apikey",ki);for(let c=0;c<3;c++)try{const u=await fetch(o,{...e,headers:a,credentials:"omit"});if(r=u,u.ok)return u;const p=await u.text();let d=`HTTP error! status: ${u.status}`;try{const f=p?JSON.parse(p):{};d=f.error?.message||f.message||d}catch{d=p||d}if(u.status===401)try{const{data:{session:f},error:m}=await lt.auth.refreshSession();if(!m&&f?.access_token){a.set("Authorization",`Bearer ${f.access_token}`);continue}}catch{}if(u.status>=400&&u.status<500&&u.status!==429)throw new Error(d);const h=Math.min(1e3*Math.pow(2,c),1e4);c<2&&await new Promise(f=>setTimeout(f,h))}catch(u){if(s=u,c===2){const h=new Error(u.message||"Unknown network error");throw h.status=r?.status,h.response=r,h}const p=Math.random()*1e3,d=Math.min(1e3*Math.pow(2,c)+p,1e4);await new Promise(h=>setTimeout(h,d))}const l=new Error(s?.message||"Unknown network error");throw l.status=r?.status,l.response=r,l};let lt=null;function qa(){if(lt)return lt;const n={auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storage:window.localStorage},global:{fetch:Ja}};return lt=la(wi,ki,n),lt.auth.onAuthStateChange(e=>{}),lt}const V=(()=>{try{return qa()}catch(n){throw console.error("Failed to initialize Supabase:",n),n}})(),Ti=j.createContext(null),lu=({children:n})=>{const[e,t]=j.useState(null),[s,r]=j.useState(!0),[i,o]=j.useState(null),a=j.useRef(null);j.useEffect(()=>{(async()=>{try{const{data:{session:m}}=await V.auth.getSession(),_=m?.access_token;if(!_){t(null);return}const{data:x,error:y}=await V.functions.invoke("auth-me",{method:"POST",headers:{Authorization:`Bearer ${_}`}});if(y)throw y;t(x?.user??null)}catch(m){console.error("Bootstrap auth error:",m),o(m?.message||String(m)),t(null)}finally{r(!1)}})();const{data:{subscription:f}}=V.auth.onAuthStateChange(async(m,_)=>{try{const x=_?.access_token;if(!x){t(null);return}const{data:y,error:v}=await V.functions.invoke("auth-me",{method:"POST",headers:{Authorization:`Bearer ${x}`}});if(v)throw v;t(y?.user??null)}catch(x){console.error("Auth state refresh error:",x),t(null)}});return()=>{f?.unsubscribe()}},[]);const l=async(h,f,m)=>{try{r(!0),o(null);try{await V.functions.invoke("auth-guard-login",{method:"POST",body:{email:h,hcaptchaToken:m}})}catch(E){throw new Error(E?.message||"Security check failed")}const{data:_,error:x}=await V.auth.signInWithPassword({email:h,password:f});if(x)throw x;try{await V.functions.invoke("auth-login-success",{method:"POST",body:{email:h}})}catch{}const y=_.session?.access_token;if(!y)return{user:null};const{data:v,error:b}=await V.functions.invoke("auth-me",{method:"POST",headers:{Authorization:`Bearer ${y}`}});if(b)throw b;const S=v?.user??null;t(S);const N=!(S?.role&&S?.terms_accepted&&S?.privacy_accepted);return{user:S,needsOnboarding:N}}catch(_){return o(_.message),{error:_}}finally{r(!1)}},c=async(h,f)=>{try{r(!0),o(null);try{await V.functions.invoke("auth-guard-register",{method:"POST",body:{email:h.email,hcaptchaToken:f}})}catch(x){throw new Error(x?.message||"Security check failed")}const{data:m,error:_}=await V.auth.signUp({email:h.email,password:h.password,options:{data:{full_name:h.name,cpf:h.cpf,role:h.role||"student"}}});if(_)throw _;try{await V.functions.invoke("auth-register-success",{method:"POST",body:{email:h.email}})}catch{}return{user:m.user,success:!0}}catch(m){return o(m.message),{error:m}}finally{r(!1)}},u=async(h=!0)=>{try{r(!0);const{data:{session:f}}=await V.auth.getSession(),m=f?.access_token;if(!m)throw new Error("Sem sessÃ£o ativa");const{data:_,error:x}=await V.functions.invoke("user-onboarding",{method:"POST",body:{concluded:h},headers:{Authorization:`Bearer ${m}`}});if(x)throw x;return t(_?.user??e),{user:_?.user??e}}catch(f){return o(f?.message||String(f)),{error:f}}finally{r(!1)}},p=j.useCallback(async()=>{try{r(!0);const{error:h}=await V.auth.signOut();if(h)throw h;a.current?a.current("/login"):window.location.href="/login"}catch(h){o(h.message)}finally{r(!1)}},[a]),d={user:e,loading:s,error:i,signIn:l,signUp:c,signOut:p,completeOnboarding:u,setNavigate:h=>{a.current=h}};return g.jsx(Ti.Provider,{value:d,children:n})},Va=()=>{const n=j.useContext(Ti);if(!n)throw new Error("useAuth must be used within an AuthProvider");return n},q=(...n)=>wa(n),fr={default:"btn btn-primary",secondary:"btn btn-secondary",outline:"btn btn-outline",ghost:"btn btn-ghost",destructive:"btn btn-error",link:"btn btn-link text-primary no-underline hover:underline",soft:"btn bg-primary/10 text-primary hover:bg-primary/20 border border-primary/20"},hr={default:"btn-md",sm:"btn-sm",lg:"btn-lg",icon:"btn-square"},Ha="btn inline-flex items-center justify-center gap-2 font-medium transition-all duration-200 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary disabled:opacity-60 disabled:cursor-not-allowed active:translate-y-px",ye=Os.forwardRef(({className:n,variant:e="default",size:t="default",asChild:s=!1,...r},i)=>{const o=s?ka:"button";return g.jsx(o,{className:q(Ha,fr[e]||fr.default,hr[t]||hr.default,n),ref:i,...r})});ye.displayName="Button";const Ya=Va,Ga=1;let Vn=0;function Qa(){return Vn=(Vn+1)%Number.MAX_VALUE,Vn.toString()}const re={state:{toasts:[]},listeners:[],getState:()=>re.state,setState:n=>{typeof n=="function"?re.state=n(re.state):re.state={...re.state,...n},re.listeners.forEach(e=>e(re.state))},subscribe:n=>(re.listeners.push(n),()=>{re.listeners=re.listeners.filter(e=>e!==n)})},Xa=({...n})=>{const e=Qa(),t=r=>re.setState(i=>({...i,toasts:i.toasts.map(o=>o.id===e?{...o,...r}:o)})),s=()=>re.setState(r=>({...r,toasts:r.toasts.filter(i=>i.id!==e)}));return re.setState(r=>({...r,toasts:[{...n,id:e,dismiss:s},...r.toasts].slice(0,Ga)})),{id:e,dismiss:s,update:t}};function Ei(){const[n,e]=j.useState(re.getState());return j.useEffect(()=>re.subscribe(s=>{e(s)}),[]),j.useEffect(()=>{const t=[];return n.toasts.forEach(s=>{if(s.duration===1/0)return;const r=setTimeout(()=>{s.dismiss()},s.duration||5e3);t.push(r)}),()=>{t.forEach(s=>clearTimeout(s))}},[n.toasts]),{toast:Xa,toasts:n.toasts}}const Je=Os.forwardRef(({className:n,type:e="text",...t},s)=>g.jsx("input",{type:e,className:q("input input-bordered w-full h-10 file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-slate-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary disabled:cursor-not-allowed disabled:opacity-50",n),ref:s,...t}));Je.displayName="Input";const de=Os.forwardRef(({className:n,...e},t)=>g.jsx("label",{ref:t,className:q("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",n),...e}));de.displayName="Label";const It=j.forwardRef(({className:n,...e},t)=>g.jsx("div",{ref:t,className:q("rounded-lg border bg-card text-card-foreground shadow-sm",n),...e}));It.displayName="Card";const _n=j.forwardRef(({className:n,...e},t)=>g.jsx("div",{ref:t,className:q("flex flex-col space-y-1.5 p-6",n),...e}));_n.displayName="CardHeader";const yn=j.forwardRef(({className:n,...e},t)=>g.jsx("h3",{ref:t,className:q("text-2xl font-semibold leading-none tracking-tight",n),...e}));yn.displayName="CardTitle";const Za=j.forwardRef(({className:n,...e},t)=>g.jsx("p",{ref:t,className:q("text-sm text-muted-foreground",n),...e}));Za.displayName="CardDescription";const Ft=j.forwardRef(({className:n,...e},t)=>g.jsx("div",{ref:t,className:q("p-6 pt-0",n),...e}));Ft.displayName="CardContent";const el=j.forwardRef(({className:n,...e},t)=>g.jsx("div",{ref:t,className:q("flex items-center p-6 pt-0",n),...e}));el.displayName="CardFooter";const tl=Ta,nl=Ea,Oi=j.forwardRef(({className:n,children:e,...t},s)=>g.jsxs(mi,{ref:s,className:q("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",n),...t,children:[e,g.jsx(Oa,{asChild:!0,children:g.jsx(gi,{className:"h-4 w-4 opacity-50"})})]}));Oi.displayName=mi.displayName;const Ai=j.forwardRef(({className:n,...e},t)=>g.jsx(xi,{ref:t,className:q("flex cursor-default items-center justify-center py-1",n),...e,children:g.jsx($o,{className:"h-4 w-4"})}));Ai.displayName=xi.displayName;const ji=j.forwardRef(({className:n,...e},t)=>g.jsx(vi,{ref:t,className:q("flex cursor-default items-center justify-center py-1",n),...e,children:g.jsx(gi,{className:"h-4 w-4"})}));ji.displayName=vi.displayName;const Mi=j.forwardRef(({className:n,children:e,position:t="popper",...s},r)=>g.jsx(Aa,{children:g.jsxs(_i,{ref:r,className:q("relative z-50 max-h-96 min-w-[12rem] overflow-hidden rounded-md border-2 border-gray-200 bg-white text-gray-900 shadow-lg shadow-black/10 dark:border-gray-700 dark:bg-gray-800 dark:text-white data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",n),position:t,...s,children:[g.jsx(Ai,{className:"bg-white dark:bg-gray-800"}),g.jsx(ja,{className:q("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:e}),g.jsx(ji,{className:"bg-white dark:bg-gray-800"})]})}));Mi.displayName=_i.displayName;const sl=j.forwardRef(({className:n,...e},t)=>g.jsx(bi,{ref:t,className:q("px-3 py-2 text-sm font-bold text-gray-700 dark:text-gray-300",n),...e}));sl.displayName=bi.displayName;const Di=j.forwardRef(({className:n,children:e,...t},s)=>g.jsxs(yi,{ref:s,className:q("relative flex w-full cursor-default select-none items-center rounded-md py-2.5 pl-8 pr-2 text-base outline-none transition-colors hover:bg-blue-50 hover:text-blue-900 focus:bg-blue-50 focus:text-blue-900 dark:hover:bg-gray-700 dark:hover:text-white dark:focus:bg-gray-700 dark:focus:text-white data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...t,children:[g.jsx("span",{className:"absolute left-2 flex h-4 w-4 items-center justify-center",children:g.jsx(Ma,{children:g.jsx(Wo,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"})})}),g.jsx(Da,{className:"font-medium",children:e})]}));Di.displayName=yi.displayName;const rl=j.forwardRef(({className:n,...e},t)=>g.jsx(Si,{ref:t,className:q("mx-2 my-1 h-px bg-gray-200 dark:bg-gray-700",n),...e}));rl.displayName=Si.displayName;const il=j.forwardRef(({className:n,...e},t)=>g.jsx("textarea",{className:q("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...e}));il.displayName="Textarea";function T(n,...e){const t=new URL("https://lexical.dev/docs/error"),s=new URLSearchParams;s.append("code",n);for(const r of e)s.append("v",r);throw t.search=s.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}function Pi(n,...e){const t=new URL("https://lexical.dev/docs/error"),s=new URLSearchParams;s.append("code",n);for(const r of e)s.append("v",r);t.search=s.toString(),console.warn(`Minified Lexical warning #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}const pe=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,ol=pe&&"documentMode"in document?document.documentMode:null,he=pe&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),Ye=pe&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent),xn=!(!pe||!("InputEvent"in window)||ol)&&"getTargetRanges"in new window.InputEvent("input"),Rt=pe&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),pt=pe&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,al=pe&&/Android/.test(navigator.userAgent),Li=pe&&/^(?=.*Chrome).*/i.test(navigator.userAgent),gr=pe&&al&&Li,Bt=pe&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&he&&!Li;function Ii(...n){const e=[];for(const t of n)if(t&&typeof t=="string")for(const[s]of t.matchAll(/\S+/g))e.push(s);return e}const ll=1,cl=3,ul=9,dl=11,Ge=0,Fi=1,mt=2,fl=0,hl=1,gl=2,vn=4,bn=8,As=128,pl=1792|(112|(3|vn|bn)|As),js=1,Ms=2,Ds=3,Ps=4,Ls=5,Is=6,Pn=Rt||pt||Bt?"Â ":"â",Ee=`

`,ml=Ye?"Â ":Pn,Qe={bold:1,capitalize:1024,code:16,highlight:As,italic:2,lowercase:256,strikethrough:vn,subscript:32,superscript:64,underline:bn,uppercase:512},_l={directionless:1,unmergeable:2},pr={center:Ms,end:Is,justify:Ps,left:js,right:Ds,start:Ls},yl={[Ms]:"center",[Is]:"end",[Ps]:"justify",[js]:"left",[Ds]:"right",[Ls]:"start"},xl={normal:0,segmented:2,token:1},vl={[fl]:"normal",[gl]:"segmented",[hl]:"token"},mr="$config";function Ri(n,e,t,s,r,i){let o=n.getFirstChild();for(;o!==null;){const a=o.__key;o.__parent===e&&(k(o)&&Ri(o,a,t,s,r,i),t.has(a)||i.delete(a),r.push(a)),o=o.getNextSibling()}}const bl=100;let ds=!1,Fs=0;function Sl(n){Fs=n.timeStamp}function Hn(n,e,t){const s=n.nodeName==="BR",r=e.__lexicalLineBreak;return r&&(n===r||s&&n.previousSibling===r)||s&&zn(n,t)!==void 0}function Nl(n,e,t){const s=Oe(fe(t));let r=null,i=null;s!==null&&s.anchorNode===n&&(r=s.anchorOffset,i=s.focusOffset);const o=n.nodeValue;o!==null&&Gs(e,o,r,i,!1)}function Cl(n,e,t){if(P(n)){const s=n.anchor.getNode();if(s.is(t)&&n.format!==s.getFormat())return!1}return Ae(e)&&t.isAttached()}function wl(n,e,t,s){for(let r=n;r&&!Mc(r);r=Xt(r)){const i=zn(r,e);if(i!==void 0){const o=G(i,t);if(o)return W(o)||!ae(r)?void 0:[r,o]}else if(r===s)return[s,Oo(t)]}}function Bi(n,e,t){ds=!0;const s=performance.now()-Fs>bl;try{ce(n,(()=>{const r=B()||(function(d){return d.getEditorState().read((()=>{const h=B();return h!==null?h.clone():null}))})(n),i=new Map,o=n.getRootElement(),a=n._editorState,l=n._blockCursorElement;let c=!1,u="";for(let d=0;d<e.length;d++){const h=e[d],f=h.type,m=h.target,_=wl(m,n,a,o);if(!_)continue;const[x,y]=_;if(f==="characterData")s&&M(y)&&Ae(m)&&Cl(r,m,y)&&Nl(m,y,n);else if(f==="childList"){c=!0;const v=h.addedNodes;for(let N=0;N<v.length;N++){const E=v[N],w=To(E),C=E.parentNode;if(C!=null&&E!==l&&w===null&&!Hn(E,C,n)){if(Ye){const D=(ae(E)?E.innerText:null)||E.nodeValue;D&&(u+=D)}C.removeChild(E)}}const b=h.removedNodes,S=b.length;if(S>0){let N=0;for(let E=0;E<S;E++){const w=b[E];(Hn(w,m,n)||l===w)&&(m.appendChild(w),N++)}S!==N&&i.set(x,y)}}}if(i.size>0)for(const[d,h]of i)h.reconcileObservedMutation(d,n);const p=t.takeRecords();if(p.length>0){for(let d=0;d<p.length;d++){const h=p[d],f=h.addedNodes,m=h.target;for(let _=0;_<f.length;_++){const x=f[_],y=x.parentNode;y==null||x.nodeName!=="BR"||Hn(x,m,n)||y.removeChild(x)}}t.takeRecords()}r!==null&&(c&&ue(r),Ye&&Do(n)&&r.insertRawText(u))}))}finally{ds=!1}}function zi(n){const e=n._observer;e!==null&&Bi(n,e.takeRecords(),e)}function Ki(n){(function(e){Fs===0&&fe(e).addEventListener("textInput",Sl,!0)})(n),n._observer=new MutationObserver(((e,t)=>{Bi(n,e,t)}))}function kl(n){const e=new Map,t=new Set;for(let s=typeof n=="function"?n:n.replace;s.prototype&&s.prototype.getType!==void 0;s=Object.getPrototypeOf(s)){const{ownNodeConfig:r}=Zs(s);if(r&&r.stateConfigs)for(const i of r.stateConfigs){let o;"stateConfig"in i?(o=i.stateConfig,i.flat&&t.add(o.key)):o=i,e.set(o.key,o)}}return{flatKeys:t,sharedConfigMap:e}}class Rs{node;knownState;unknownState;sharedNodeState;size;constructor(e,t,s=void 0,r=new Map,i=void 0){this.node=e,this.sharedNodeState=t,this.unknownState=s,this.knownState=r;const{sharedConfigMap:o}=this.sharedNodeState,a=i!==void 0?i:(function(l,c,u){let p=u.size;if(c)for(const d in c){const h=l.get(d);h&&u.has(h)||p++}return p})(o,s,r);this.size=a}getValue(e){const t=this.knownState.get(e);if(t!==void 0)return t;this.sharedNodeState.sharedConfigMap.set(e.key,e);let s=e.defaultValue;if(this.unknownState&&e.key in this.unknownState){const r=this.unknownState[e.key];r!==void 0&&(s=e.parse(r)),this.updateFromKnown(e,s)}return s}getInternalState(){return[this.unknownState,this.knownState]}toJSON(){const e={...this.unknownState},t={};for(const[s,r]of this.knownState)s.isEqual(r,s.defaultValue)?delete e[s.key]:e[s.key]=s.unparse(r);for(const s of this.sharedNodeState.flatKeys)s in e&&(t[s]=e[s],delete e[s]);return _r(e)&&(t.$=e),t}getWritable(e){if(this.node===e)return this;const{sharedNodeState:t,unknownState:s}=this,r=new Map(this.knownState);return new Rs(e,t,(function(i,o,a){let l;if(a)for(const[c,u]of Object.entries(a)){const p=i.get(c);p?o.has(p)||o.set(p,p.parse(u)):(l=l||{},l[c]=u)}return l})(t.sharedConfigMap,r,s),r,this.size)}updateFromKnown(e,t){const s=e.key;this.sharedNodeState.sharedConfigMap.set(s,e);const{knownState:r,unknownState:i}=this;r.has(e)||i&&s in i||(i&&(delete i[s],this.unknownState=_r(i)),this.size++),r.set(e,t)}updateFromUnknown(e,t){const s=this.sharedNodeState.sharedConfigMap.get(e);s?this.updateFromKnown(s,s.parse(t)):(this.unknownState=this.unknownState||{},e in this.unknownState||this.size++,this.unknownState[e]=t)}updateFromJSON(e){const{knownState:t}=this;for(const s of t.keys())t.set(s,s.defaultValue);if(this.size=t.size,this.unknownState=void 0,e)for(const[s,r]of Object.entries(e))this.updateFromUnknown(s,r)}}function Tl(n){const e=n.getWritable(),t=e.__state?e.__state.getWritable(e):new Rs(e,Wi(e));return e.__state=t,t}function Wi(n){return n.__state?n.__state.sharedNodeState:No(Lo(),n.getType()).sharedNodeState}function _r(n){if(n)for(const e in n)return n}function yr(n,e,t){for(const[s,r]of e.knownState){if(n.has(s.key))continue;n.add(s.key);const i=t?t.getValue(s):s.defaultValue;if(i!==r&&!s.isEqual(i,r))return!0}return!1}function xr(n,e,t){const{unknownState:s}=e,r=t?t.unknownState:void 0;if(s){for(const[i,o]of Object.entries(s))if(!n.has(i)&&(n.add(i),o!==(r?r[i]:void 0)))return!0}return!1}function vr(n,e){const t=n.__state;return t&&t.node===n?t.getWritable(e):t}function br(n,e){const t=n.__mode,s=n.__format,r=n.__style,i=e.__mode,o=e.__format,a=e.__style,l=n.__state,c=e.__state;return(t===null||t===i)&&(s===null||s===o)&&(r===null||r===a)&&(n.__state===null||l===c||(function(u,p){if(u===p)return!0;if(u&&p&&u.size!==p.size)return!1;const d=new Set;return!(u&&yr(d,u,p)||p&&yr(d,p,u)||u&&xr(d,u,p)||p&&xr(d,p,u))})(l,c))}function Sr(n,e){const t=n.mergeWithSibling(e),s=$()._normalizedNodes;return s.add(n.__key),s.add(e.__key),t}function Nr(n){let e,t,s=n;if(s.__text!==""||!s.isSimpleText()||s.isUnmergeable()){for(;(e=s.getPreviousSibling())!==null&&M(e)&&e.isSimpleText()&&!e.isUnmergeable();){if(e.__text!==""){if(br(e,s)){s=Sr(e,s);break}break}e.remove()}for(;(t=s.getNextSibling())!==null&&M(t)&&t.isSimpleText()&&!t.isUnmergeable();){if(t.__text!==""){if(br(s,t)){s=Sr(s,t);break}break}t.remove()}}else s.remove()}function fs(n){return Cr(n.anchor),Cr(n.focus),n}function Cr(n){for(;n.type==="element";){const e=n.getNode(),t=n.offset;let s,r;if(t===e.getChildrenSize()?(s=e.getChildAtIndex(t-1),r=!0):(s=e.getChildAtIndex(t),r=!1),M(s)){n.set(s.__key,r?s.getTextContentSize():0,"text",!0);break}if(!k(s))break;n.set(s.__key,r?s.getChildrenSize():0,"element",!0)}}let Xe,te,zt,Ln,hs,gs,Ze,ge,ps,Kt,J="",me=null,_e="",we="",ct=!1,Sn=!1;function Nn(n,e){const t=Ze.get(n);if(e!==null){const s=xs(n);s.parentNode===e&&e.removeChild(s)}if(ge.has(n)||te._keyToDOMMap.delete(n),k(t)){const s=wn(t,Ze);ms(s,0,s.length-1,null)}t!==void 0&&Qs(Kt,zt,Ln,t,"destroyed")}function ms(n,e,t,s){let r=e;for(;r<=t;++r){const i=n[r];i!==void 0&&Nn(i,s)}}function We(n,e){n.setProperty("text-align",e)}const El="40px";function $i(n,e){const t=Xe.theme.indent;if(typeof t=="string"){const r=n.classList.contains(t);e>0&&!r?n.classList.add(t):e<1&&r&&n.classList.remove(t)}const s=getComputedStyle(n).getPropertyValue("--lexical-indent-base-value")||El;n.style.setProperty("padding-inline-start",e===0?"":`calc(${e} * ${s})`)}function Ui(n,e){const t=n.style;e===0?We(t,""):e===js?We(t,"left"):e===Ms?We(t,"center"):e===Ds?We(t,"right"):e===Ps?We(t,"justify"):e===Ls?We(t,"start"):e===Is&&We(t,"end")}function _s(n,e){const t=(function(s){const r=s.__dir;if(r!==null)return r;if(ee(s))return null;const i=s.getParentOrThrow();return ee(i)&&i.__dir===null?"auto":null})(e);t!==null?n.dir=t:n.removeAttribute("dir")}function Cn(n,e){const t=ge.get(n);t===void 0&&T(60);const s=t.createDOM(Xe,te);if((function(r,i,o){const a=o._keyToDOMMap;(function(l,c,u){const p=`__lexicalKey_${c._key}`;l[p]=u})(i,o,r),a.set(r,i)})(n,s,te),M(t)?s.setAttribute("data-lexical-text","true"):W(t)&&s.setAttribute("data-lexical-decorator","true"),k(t)){const r=t.__indent,i=t.__size;if(_s(s,t),r!==0&&$i(s,r),i!==0){const a=i-1;ys(wn(t,ge),t,0,a,t.getDOMSlot(s))}const o=t.__format;o!==0&&Ui(s,o),t.isInline()||Ji(null,t,s),Kn(t)&&(J+=Ee,we+=Ee)}else{const r=t.getTextContent();if(W(t)){const i=t.decorate(te,Xe);i!==null&&qi(n,i),s.contentEditable="false"}J+=r,we+=r}return e!==null&&e.insertChild(s),Qs(Kt,zt,Ln,t,"created"),s}function ys(n,e,t,s,r){const i=J;J="";let o=t;for(;o<=s;++o){Cn(n[o],r);const a=ge.get(n[o]);a!==null&&M(a)&&(me===null&&(me=a.getFormat()),_e===""&&(_e=a.getStyle()))}Kn(e)&&(J+=Ee),r.element.__lexicalTextContent=J,J=i+J}function wr(n,e){if(n){const t=n.__last;if(t){const s=e.get(t);if(s)return ht(s)?"line-break":W(s)&&s.isInline()?"decorator":null}return"empty"}return null}function Ji(n,e,t){const s=wr(n,Ze),r=wr(e,ge);s!==r&&e.getDOMSlot(t).setManagedLineBreak(r)}function Ol(n,e,t){var s;me=null,_e="",(function(r,i,o){const a=J,l=r.__size,c=i.__size;J="";const u=o.element;if(l===1&&c===1){const p=r.__first,d=i.__first;if(p===d)Ot(p,u);else{const f=xs(p),m=Cn(d,null);try{u.replaceChild(m,f)}catch(_){if(typeof _=="object"&&_!=null){const x=`${_.toString()} Parent: ${u.tagName}, new child: {tag: ${m.tagName} key: ${d}}, old child: {tag: ${f.tagName}, key: ${p}}.`;throw new Error(x)}throw _}Nn(p,null)}const h=ge.get(d);M(h)&&(me===null&&(me=h.getFormat()),_e===""&&(_e=h.getStyle()))}else{const p=wn(r,Ze),d=wn(i,ge);if(p.length!==l&&T(227),d.length!==c&&T(228),l===0)c!==0&&ys(d,i,0,c-1,o);else if(c===0){if(l!==0){const h=o.after==null&&o.before==null&&o.element.__lexicalLineBreak==null;ms(p,0,l-1,h?null:u),h&&(u.textContent="")}}else(function(h,f,m,_,x,y){const v=_-1,b=x-1;let S,N,E=y.getFirstChild(),w=0,C=0;for(;w<=v&&C<=b;){const L=f[w],A=m[C];if(L===A)E=Yn(Ot(A,y.element)),w++,C++;else{S===void 0&&(S=new Set(f)),N===void 0&&(N=new Set(m));const K=N.has(L),U=S.has(A);if(K)if(U){const le=et(te,A);le===E?E=Yn(Ot(A,y.element)):(y.withBefore(E).insertChild(le),Ot(A,y.element)),w++,C++}else Cn(A,y.withBefore(E)),C++;else E=Yn(xs(L)),Nn(L,y.element),w++}const R=ge.get(A);R!==null&&M(R)&&(me===null&&(me=R.getFormat()),_e===""&&(_e=R.getStyle()))}const D=w>v,F=C>b;if(D&&!F){const L=m[b+1],A=L===void 0?null:te.getElementByKey(L);ys(m,h,C,b,y.withBefore(A))}else F&&!D&&ms(f,w,v,y.element)})(i,p,d,l,c,o)}Kn(i)&&(J+=Ee),u.__lexicalTextContent=J,J=a+J})(n,e,e.getDOMSlot(t)),s=e,me==null||me===s.__textFormat||Sn||s.setTextFormat(me),(function(r){_e===""||_e===r.__textStyle||Sn||r.setTextStyle(_e)})(e)}function wn(n,e){const t=[];let s=n.__first;for(;s!==null;){const r=e.get(s);r===void 0&&T(101),t.push(s),s=r.__next}return t}function Ot(n,e){const t=Ze.get(n);let s=ge.get(n);t!==void 0&&s!==void 0||T(61);const r=ct||gs.has(n)||hs.has(n),i=et(te,n);if(t===s&&!r){if(k(t)){const o=i.__lexicalTextContent;o!==void 0&&(J+=o,we+=o)}else{const o=t.getTextContent();we+=o,J+=o}return i}if(t!==s&&r&&Qs(Kt,zt,Ln,s,"updated"),s.updateDOM(t,i,Xe)){const o=Cn(n,null);return e===null&&T(62),e.replaceChild(o,i),Nn(n,null),o}if(k(t)&&k(s)){const o=s.__indent;(ct||o!==t.__indent)&&$i(i,o);const a=s.__format;if((ct||a!==t.__format)&&Ui(i,a),r&&(Ol(t,s,i),ee(s)||s.isInline()||Ji(t,s,i)),Kn(s)&&(J+=Ee,we+=Ee),(ct||s.__dir!==t.__dir)&&(_s(i,s),ee(s)&&!ct))for(const l of s.getChildren())k(l)&&_s(et(te,l.getKey()),l)}else{const o=s.getTextContent();if(W(s)){const a=s.decorate(te,Xe);a!==null&&qi(n,a)}J+=o,we+=o}if(!Sn&&ee(s)&&s.__cachedText!==we){const o=s.getWritable();o.__cachedText=we,s=o}return i}function qi(n,e){let t=te._pendingDecorators;const s=te._decorators;if(t===null){if(s[n]===e)return;t=Eo(te)}t[n]=e}function Yn(n){let e=n.nextSibling;return e!==null&&e===te._blockCursorElement&&(e=e.nextSibling),e}function Al(n,e,t,s,r,i){J="",we="",ct=s===mt,te=t,Xe=t._config,zt=t._nodes,Ln=te._listeners.mutation,hs=r,gs=i,Ze=n._nodeMap,ge=e._nodeMap,Sn=e._readOnly,ps=new Map(t._keyToDOMMap);const o=new Map;return Kt=o,Ot("root",null),te=void 0,zt=void 0,hs=void 0,gs=void 0,Ze=void 0,ge=void 0,Xe=void 0,ps=void 0,Kt=void 0,o}function xs(n){const e=ps.get(n);return e===void 0&&T(75,n),e}function I(n){return{type:n}}const Vi=I("SELECTION_CHANGE_COMMAND"),cu=I("SELECTION_INSERT_CLIPBOARD_NODES_COMMAND"),jl=I("CLICK_COMMAND"),kn=I("DELETE_CHARACTER_COMMAND"),un=I("INSERT_LINE_BREAK_COMMAND"),kr=I("INSERT_PARAGRAPH_COMMAND"),At=I("CONTROLLED_TEXT_INSERTION_COMMAND"),Hi=I("PASTE_COMMAND"),Tr=I("REMOVE_TEXT_COMMAND"),Tn=I("DELETE_WORD_COMMAND"),En=I("DELETE_LINE_COMMAND"),Ue=I("FORMAT_TEXT_COMMAND"),Yi=I("UNDO_COMMAND"),Gi=I("REDO_COMMAND"),Ml=I("KEYDOWN_COMMAND"),Dl=I("KEY_ARROW_RIGHT_COMMAND"),Pl=I("MOVE_TO_END"),Ll=I("KEY_ARROW_LEFT_COMMAND"),Il=I("MOVE_TO_START"),Fl=I("KEY_ARROW_UP_COMMAND"),Rl=I("KEY_ARROW_DOWN_COMMAND"),vs=I("KEY_ENTER_COMMAND"),Bl=I("KEY_SPACE_COMMAND"),zl=I("KEY_BACKSPACE_COMMAND"),Kl=I("KEY_ESCAPE_COMMAND"),Wl=I("KEY_DELETE_COMMAND"),$l=I("KEY_TAB_COMMAND"),uu=I("INSERT_TAB_COMMAND"),du=I("INDENT_CONTENT_COMMAND"),fu=I("OUTDENT_CONTENT_COMMAND"),Ul=I("DROP_COMMAND"),hu=I("FORMAT_ELEMENT_COMMAND"),Jl=I("DRAGSTART_COMMAND"),ql=I("DRAGOVER_COMMAND"),Vl=I("DRAGEND_COMMAND"),Qi=I("COPY_COMMAND"),Xi=I("CUT_COMMAND"),Er=I("SELECT_ALL_COMMAND"),gu=I("CLEAR_EDITOR_COMMAND"),pu=I("CLEAR_HISTORY_COMMAND"),mu=I("CAN_REDO_COMMAND"),_u=I("CAN_UNDO_COMMAND"),Hl=I("FOCUS_COMMAND"),Yl=I("BLUR_COMMAND"),Gl=I("KEY_MODIFIER_COMMAND"),Se=Object.freeze({}),bs=30,Ss=[["keydown",function(n,e){if(jt=n.timeStamp,Zi=n.key,!e.isComposing()&&!O(e,Ml,n)&&n.key!=null){if(Gn&&si(n))return ce(e,(()=>{rn(e,Qn)})),Gn=!1,void(Qn="");if((function(t){return z(t,"ArrowRight",{shiftKey:"any"})})(n))O(e,Dl,n);else if((function(t){return z(t,"ArrowRight",Ce)})(n))O(e,Pl,n);else if((function(t){return z(t,"ArrowLeft",{shiftKey:"any"})})(n))O(e,Ll,n);else if((function(t){return z(t,"ArrowLeft",Ce)})(n))O(e,Il,n);else if((function(t){return z(t,"ArrowUp",{altKey:"any",shiftKey:"any"})})(n))O(e,Fl,n);else if((function(t){return z(t,"ArrowDown",{altKey:"any",shiftKey:"any"})})(n))O(e,Rl,n);else if((function(t){return z(t,"Enter",{altKey:"any",ctrlKey:"any",metaKey:"any",shiftKey:!0})})(n))Mt=!0,O(e,vs,n);else if((function(t){return t.key===" "})(n))O(e,Bl,n);else if((function(t){return he&&z(t,"o",{ctrlKey:!0})})(n))n.preventDefault(),Mt=!0,O(e,un,!0);else if((function(t){return z(t,"Enter",{altKey:"any",ctrlKey:"any",metaKey:"any"})})(n))Mt=!1,O(e,vs,n);else if((function(t){return z(t,"Backspace",{shiftKey:"any"})||he&&z(t,"h",{ctrlKey:!0})})(n))si(n)?O(e,zl,n):(n.preventDefault(),O(e,kn,!0));else if((function(t){return t.key==="Escape"})(n))O(e,Kl,n);else if((function(t){return z(t,"Delete",{})||he&&z(t,"d",{ctrlKey:!0})})(n))(function(t){return t.key==="Delete"})(n)?O(e,Wl,n):(n.preventDefault(),O(e,kn,!1));else if((function(t){return z(t,"Backspace",ni)})(n))n.preventDefault(),O(e,Tn,!0);else if((function(t){return z(t,"Delete",ni)})(n))n.preventDefault(),O(e,Tn,!1);else if((function(t){return he&&z(t,"Backspace",{metaKey:!0})})(n))n.preventDefault(),O(e,En,!0);else if((function(t){return he&&(z(t,"Delete",{metaKey:!0})||z(t,"k",{ctrlKey:!0}))})(n))n.preventDefault(),O(e,En,!1);else if((function(t){return z(t,"b",Ce)})(n))n.preventDefault(),O(e,Ue,"bold");else if((function(t){return z(t,"u",Ce)})(n))n.preventDefault(),O(e,Ue,"underline");else if((function(t){return z(t,"i",Ce)})(n))n.preventDefault(),O(e,Ue,"italic");else if((function(t){return z(t,"Tab",{shiftKey:"any"})})(n))O(e,$l,n);else if((function(t){return z(t,"z",Ce)})(n))n.preventDefault(),O(e,Yi,void 0);else if((function(t){return he?z(t,"z",{metaKey:!0,shiftKey:!0}):z(t,"y",{ctrlKey:!0})||z(t,"z",{ctrlKey:!0,shiftKey:!0})})(n))n.preventDefault(),O(e,Gi,void 0);else{const t=e._editorState._selection;t===null||P(t)?ri(n)&&(n.preventDefault(),O(e,Er,n)):(function(s){return z(s,"c",Ce)})(n)?(n.preventDefault(),O(e,Qi,n)):(function(s){return z(s,"x",Ce)})(n)?(n.preventDefault(),O(e,Xi,n)):ri(n)&&(n.preventDefault(),O(e,Er,n))}(function(t){return t.ctrlKey||t.shiftKey||t.altKey||t.metaKey})(n)&&O(e,Gl,n)}}],["pointerdown",function(n,e){const t=n.target,s=n.pointerType;Zt(t)&&s!=="touch"&&s!=="pen"&&n.button===0&&ce(e,(()=>{Zr(t)||(Cs=!0)}))}],["compositionstart",function(n,e){ce(e,(()=>{const t=B();if(P(t)&&!e.isComposing()){const s=t.anchor,r=t.anchor.getNode();Z(s.key),(n.timeStamp<jt+bs||s.type==="element"||!t.isCollapsed()||r.getFormat()!==t.format||M(r)&&r.getStyle()!==t.style)&&O(e,At,ml)}}))}],["compositionend",function(n,e){Ye?Tt=!0:pt||!Rt&&!Bt?ce(e,(()=>{rn(e,n.data)})):(Gn=!0,Qn=n.data)}],["input",function(n,e){n.stopPropagation(),ce(e,(()=>{if(ae(n.target)&&Zr(n.target))return;const t=B(),s=n.data,r=ro(n);if(s!=null&&P(t)&&no(t,r,s,n.timeStamp,!1)){Tt&&(rn(e,s),Tt=!1);const i=t.anchor.getNode(),o=Oe(fe(e));if(o===null)return;const a=t.isBackward(),l=a?t.anchor.offset:t.focus.offset,c=a?t.focus.offset:t.anchor.offset;xn&&!t.isCollapsed()&&M(i)&&o.anchorNode!==null&&i.getTextContent().slice(0,l)+s+i.getTextContent().slice(l+c)===Mo(o.anchorNode)||O(e,At,s);const u=s.length;Ye&&u>1&&n.inputType==="insertCompositionText"&&!e.isComposing()&&(t.anchor.offset-=u),Rt||pt||Bt||!e.isComposing()||(jt=0,Z(null))}else Ys(!1,e,s!==null?s:void 0),Tt&&(rn(e,s||void 0),Tt=!1);(function(){X();const i=$();zi(i)})()}),{event:n}),ut=null}],["click",function(n,e){ce(e,(()=>{const t=B(),s=Oe(fe(e)),r=St();if(s){if(P(t)){const i=t.anchor,o=i.getNode();if(i.type==="element"&&i.offset===0&&t.isCollapsed()&&!ee(o)&&oe().getChildrenSize()===1&&o.getTopLevelElementOrThrow().isEmpty()&&r!==null&&t.is(r))s.removeAllRanges(),t.dirty=!0;else if(n.detail===3&&!t.isCollapsed()&&o!==t.focus.getNode()){const a=hn(o,(l=>k(l)&&!l.isInline()));k(a)&&a.select(0)}}else if(n.pointerType==="touch"||n.pointerType==="pen"){const i=s.anchorNode;(ae(i)||Ae(i))&&ue(Ws(r,s,e,n))}}O(e,jl,n)}))}],["cut",Se],["copy",Se],["dragstart",Se],["dragover",Se],["dragend",Se],["paste",Se],["focus",Se],["blur",Se],["drop",Se]];xn&&Ss.push(["beforeinput",(n,e)=>(function(t,s){const r=t.inputType,i=ro(t);r==="deleteCompositionText"||Ye&&Do(s)||r!=="insertCompositionText"&&ce(s,(()=>{const o=B();if(r==="deleteContentBackward"){if(o===null){const h=St();if(!P(h))return;ue(h.clone())}if(P(o)){const h=o.anchor.key===o.focus.key;if(a=t.timeStamp,Zi==="MediaLast"&&a<jt+bs&&s.isComposing()&&h){if(Z(null),jt=0,setTimeout((()=>{ce(s,(()=>{Z(null)}))}),bs),P(o)){const f=o.anchor.getNode();f.markDirty(),M(f)||T(142),so(o,f)}}else{Z(null),t.preventDefault();const f=o.anchor.getNode(),m=f.getTextContent(),_=f.canInsertTextAfter(),x=o.anchor.offset===0&&o.focus.offset===m.length;let y=gr&&h&&!x&&_;if(y&&o.isCollapsed()&&(y=!W(bc(o.anchor,!0))),!y){O(s,kn,!0);const v=B();gr&&P(v)&&v.isCollapsed()&&($e=v,setTimeout((()=>$e=null)))}}return}}var a;if(!P(o))return;const l=t.data;ut!==null&&Ys(!1,s,ut),o.dirty&&ut===null||!o.isCollapsed()||ee(o.anchor.getNode())||i===null||o.applyDOMRange(i),ut=null;const c=o.anchor,u=o.focus,p=c.getNode(),d=u.getNode();if(r!=="insertText"&&r!=="insertTranspose")switch(t.preventDefault(),r){case"insertFromYank":case"insertFromDrop":case"insertReplacementText":O(s,At,t);break;case"insertFromComposition":Z(null),O(s,At,t);break;case"insertLineBreak":Z(null),O(s,un,!1);break;case"insertParagraph":Z(null),Mt&&!pt?(Mt=!1,O(s,un,!1)):O(s,kr,void 0);break;case"insertFromPaste":case"insertFromPasteAsQuotation":O(s,Hi,t);break;case"deleteByComposition":(function(h,f){return h!==f||k(h)||k(f)||!qe(h)||!qe(f)})(p,d)&&O(s,Tr,t);break;case"deleteByDrag":case"deleteByCut":O(s,Tr,t);break;case"deleteContent":O(s,kn,!1);break;case"deleteWordBackward":O(s,Tn,!0);break;case"deleteWordForward":O(s,Tn,!1);break;case"deleteHardLineBackward":case"deleteSoftLineBackward":O(s,En,!0);break;case"deleteContentForward":case"deleteHardLineForward":case"deleteSoftLineForward":O(s,En,!1);break;case"formatStrikeThrough":O(s,Ue,"strikethrough");break;case"formatBold":O(s,Ue,"bold");break;case"formatItalic":O(s,Ue,"italic");break;case"formatUnderline":O(s,Ue,"underline");break;case"historyUndo":O(s,Yi,void 0);break;case"historyRedo":O(s,Gi,void 0)}else{if(l===`
`)t.preventDefault(),O(s,un,!1);else if(l===Ee)t.preventDefault(),O(s,kr,void 0);else if(l==null&&t.dataTransfer){const h=t.dataTransfer.getData("text/plain");t.preventDefault(),o.insertRawText(h)}else l!=null&&no(o,i,l,t.timeStamp,!0)?(t.preventDefault(),O(s,At,l)):ut=l;eo=t.timeStamp}}))})(n,e)]);let jt=0,Zi=null,eo=0,ut=null;const On=new WeakMap;let Ns=!1,Cs=!1,Mt=!1,Tt=!1,Gn=!1,Qn="",$e=null,to=[0,"",0,"root",0];function no(n,e,t,s,r){const i=n.anchor,o=n.focus,a=i.getNode(),l=$(),c=Oe(fe(l)),u=c!==null?c.anchorNode:null,p=i.key,d=l.getElementByKey(p),h=t.length;return p!==o.key||!M(a)||(!r&&(!xn||eo<s+50)||a.isDirty()&&h<2||Ao(t))&&i.offset!==o.offset&&!a.isComposing()||De(a)||a.isDirty()&&h>1||(r||!xn)&&d!==null&&!a.isComposing()&&u!==yt(d)||c!==null&&e!==null&&(!e.collapsed||e.startContainer!==c.anchorNode||e.startOffset!==c.anchorOffset)||a.getFormat()!==n.format||a.getStyle()!==n.style||(function(f,m){if(m.isSegmented())return!0;if(!f.isCollapsed())return!1;const _=f.anchor.offset,x=m.getParentOrThrow(),y=qe(m);return _===0?!m.canInsertTextBefore()||!x.canInsertTextBefore()&&!m.isComposing()||y||(function(v){const b=v.getPreviousSibling();return(M(b)||k(b)&&b.isInline())&&!b.canInsertTextAfter()})(m):_===m.getTextContentSize()&&(!m.canInsertTextAfter()||!x.canInsertTextAfter()&&!m.isComposing()||y)})(n,a)}function Or(n,e){return Ae(n)&&n.nodeValue!==null&&e!==0&&e!==n.nodeValue.length}function Ar(n,e,t){const{anchorNode:s,anchorOffset:r,focusNode:i,focusOffset:o}=n;Ns&&(Ns=!1,Or(s,r)&&Or(i,o)&&!$e)||ce(e,(()=>{if(!t)return void ue(null);if(!Rn(e,s,i))return;let a=B();if($e&&P(a)&&a.isCollapsed()){const l=a.anchor,c=$e.anchor;(l.key===c.key&&l.offset===c.offset+1||l.offset===1&&c.getNode().is(l.getNode().getPreviousSibling()))&&(a=$e.clone(),ue(a))}if($e=null,P(a)){const l=a.anchor,c=l.getNode();if(a.isCollapsed()){n.type==="Range"&&n.anchorNode===n.focusNode&&(a.dirty=!0);const u=fe(e).event,p=u?u.timeStamp:performance.now(),[d,h,f,m,_]=to,x=oe(),y=e.isComposing()===!1&&x.getTextContent()==="";if(p<_+200&&l.offset===f&&l.key===m)dn(a,d,h);else if(l.type==="text")M(c)||T(141),so(a,c);else if(l.type==="element"&&!y){k(c)||T(259);const v=l.getNode();v.isEmpty()?(function(b,S){const N=S.getTextFormat(),E=S.getTextStyle();dn(b,N,E)})(a,v):dn(a,0,"")}}else{const u=l.key,p=a.focus.key,d=a.getNodes(),h=d.length,f=a.isBackward(),m=f?o:r,_=f?r:o,x=f?p:u,y=f?u:p;let v=pl,b=!1;for(let S=0;S<h;S++){const N=d[S],E=N.getTextContentSize();if(M(N)&&E!==0&&!(S===0&&N.__key===x&&m===E||S===h-1&&N.__key===y&&_===0)&&(b=!0,v&=N.getFormat(),v===0))break}a.format=b?v:0}}O(e,Vi,void 0)}))}function dn(n,e,t){n.format===e&&n.style===t||(n.format=e,n.style=t,n.dirty=!0)}function so(n,e){dn(n,e.getFormat(),e.getStyle())}function ro(n){if(!n.getTargetRanges)return null;const e=n.getTargetRanges();return e.length===0?null:e[0]}function rn(n,e){const t=n._compositionKey;if(Z(null),t!==null&&e!=null){if(e===""){const s=G(t),r=yt(n.getElementByKey(t));return void(r!==null&&r.nodeValue!==null&&M(s)&&Gs(s,r.nodeValue,null,null,!0))}if(e[e.length-1]===`
`){const s=B();if(P(s)){const r=s.focus;return s.anchor.set(r.key,r.offset,r.type),void O(n,vs,null)}}}Ys(!0,n,e)}function io(n){let e=n.__lexicalEventHandles;return e===void 0&&(e=[],n.__lexicalEventHandles=e),e}const ft=new Map;function oo(n){const e=kc(n.target);if(e===null)return;const t=ko(e.anchorNode);if(t===null)return;Cs&&(Cs=!1,ce(t,(()=>{const l=St(),c=e.anchorNode;(ae(c)||Ae(c))&&ue(Ws(l,e,t,n))})));const s=Hs(t),r=s[s.length-1],i=r._key,o=ft.get(i),a=o||r;a!==t&&Ar(e,a,!1),Ar(e,t,!0),t!==r?ft.set(i,t):o&&ft.delete(i)}function jr(n){n._lexicalHandled=!0}function Mr(n){return n._lexicalHandled===!0}function Ql(n){const e=n.ownerDocument,t=On.get(e);if(t===void 0)return;const s=t-1;s>=0||T(164),On.set(e,s),s===0&&e.removeEventListener("selectionchange",oo);const r=Bn(n);qs(r)?((function(o){if(o._parentEditor!==null){const a=Hs(o),l=a[a.length-1]._key;ft.get(l)===o&&ft.delete(l)}else ft.delete(o._key)})(r),n.__lexicalEditor=null):r&&T(198);const i=io(n);for(let o=0;o<i.length;o++)i[o]();n.__lexicalEventHandles=[]}function ws(n,e,t){X();const s=n.__key,r=n.getParent();if(r===null)return;const i=(function(a){const l=B();if(!P(l)||!k(a))return l;const{anchor:c,focus:u}=l,p=c.getNode(),d=u.getNode();return Ts(p,a)&&c.set(a.__key,0,"element"),Ts(d,a)&&u.set(a.__key,0,"element"),l})(n);let o=!1;if(P(i)&&e){const a=i.anchor,l=i.focus;a.key===s&&(jn(a,n,r,n.getPreviousSibling(),n.getNextSibling()),o=!0),l.key===s&&(jn(l,n,r,n.getPreviousSibling(),n.getNextSibling()),o=!0)}else Ks(i)&&e&&n.isSelected()&&n.selectPrevious();if(P(i)&&e&&!o){const a=n.getIndexWithinParent();Ve(n),An(i,r,a,-1)}else Ve(n);t||Ke(r)||r.canBeEmpty()||!r.isEmpty()||ws(r,e),e&&i&&ee(r)&&r.isEmpty()&&r.selectEnd()}function yu(n){return n}class Ie{__type;__key;__parent;__prev;__next;__state;static getType(){const{ownNodeType:e}=Zs(this);return e===void 0&&T(64,this.name),e}static clone(e){T(65,this.name)}$config(){return{}}config(e,t){const s=t.extends||Object.getPrototypeOf(this.constructor);return Object.assign(t,{extends:s,type:e}),{[e]:t}}afterCloneFrom(e){this.__key===e.__key?(this.__parent=e.__parent,this.__next=e.__next,this.__prev=e.__prev,this.__state=e.__state):e.__state&&(this.__state=e.__state.getWritable(this))}static importDOM;constructor(e){this.__type=this.constructor.getType(),this.__parent=null,this.__prev=null,this.__next=null,Object.defineProperty(this,"__state",{configurable:!0,enumerable:!1,value:void 0,writable:!0}),xc(this,e)}getType(){return this.__type}isInline(){T(137,this.constructor.name)}isAttached(){let e=this.__key;for(;e!==null;){if(e==="root")return!0;const t=G(e);if(t===null)break;e=t.__parent}return!1}isSelected(e){const t=e||B();if(t==null)return!1;const s=t.getNodes().some((r=>r.__key===this.__key));if(M(this))return s;if(P(t)&&t.anchor.type==="element"&&t.focus.type==="element"){if(t.isCollapsed())return!1;const r=this.getParent();if(W(this)&&this.isInline()&&r){const i=t.isBackward()?t.focus:t.anchor;if(r.is(i.getNode())&&i.offset===r.getChildrenSize()&&this.is(r.getLastChild()))return!1}}return s}getKey(){return this.__key}getIndexWithinParent(){const e=this.getParent();if(e===null)return-1;let t=e.getFirstChild(),s=0;for(;t!==null;){if(this.is(t))return s;s++,t=t.getNextSibling()}return-1}getParent(){const e=this.getLatest().__parent;return e===null?null:G(e)}getParentOrThrow(){const e=this.getParent();return e===null&&T(66,this.__key),e}getTopLevelElement(){let e=this;for(;e!==null;){const t=e.getParent();if(Ke(t))return k(e)||e===this&&W(e)||T(194),e;e=t}return null}getTopLevelElementOrThrow(){const e=this.getTopLevelElement();return e===null&&T(67,this.__key),e}getParents(){const e=[];let t=this.getParent();for(;t!==null;)e.push(t),t=t.getParent();return e}getParentKeys(){const e=[];let t=this.getParent();for(;t!==null;)e.push(t.__key),t=t.getParent();return e}getPreviousSibling(){const e=this.getLatest().__prev;return e===null?null:G(e)}getPreviousSiblings(){const e=[],t=this.getParent();if(t===null)return e;let s=t.getFirstChild();for(;s!==null&&!s.is(this);)e.push(s),s=s.getNextSibling();return e}getNextSibling(){const e=this.getLatest().__next;return e===null?null:G(e)}getNextSiblings(){const e=[];let t=this.getNextSibling();for(;t!==null;)e.push(t),t=t.getNextSibling();return e}getCommonAncestor(e){const t=k(this)?this:this.getParent(),s=k(e)?e:e.getParent(),r=t&&s?gn(t,s):null;return r?r.commonAncestor:null}is(e){return e!=null&&this.__key===e.__key}isBefore(e){const t=gn(this,e);return t!==null&&(t.type==="descendant"||(t.type==="branch"?Bo(t)===-1:(t.type!=="same"&&t.type!=="ancestor"&&T(279),!1)))}isParentOf(e){const t=gn(this,e);return t!==null&&t.type==="ancestor"}getNodesBetween(e){const t=this.isBefore(e),s=[],r=new Set;let i=this;for(;i!==null;){const o=i.__key;if(r.has(o)||(r.add(o),s.push(i)),i===e)break;const a=k(i)?t?i.getFirstChild():i.getLastChild():null;if(a!==null){i=a;continue}const l=t?i.getNextSibling():i.getPreviousSibling();if(l!==null){i=l;continue}const c=i.getParentOrThrow();if(r.has(c.__key)||s.push(c),c===e)break;let u=null,p=c;do{if(p===null&&T(68),u=t?p.getNextSibling():p.getPreviousSibling(),p=p.getParent(),p===null)break;u!==null||r.has(p.__key)||s.push(p)}while(u===null);i=u}return t||s.reverse(),s}isDirty(){const e=$()._dirtyLeaves;return e!==null&&e.has(this.__key)}getLatest(){const e=G(this.__key);return e===null&&T(113),e}getWritable(){X();const e=ze(),t=$(),s=e._nodeMap,r=this.__key,i=this.getLatest(),o=t._cloneNotNeeded,a=B();if(a!==null&&a.setCachedNodes(null),o.has(r))return Dn(i),i;const l=Ac(i);return o.add(r),Dn(l),s.set(r,l),l}getTextContent(){return""}getTextContentSize(){return this.getTextContent().length}createDOM(e,t){T(70)}updateDOM(e,t,s){T(71)}exportDOM(e){return{element:this.createDOM(e._config,e)}}exportJSON(){const e=this.__state?this.__state.toJSON():void 0;return{type:this.__type,version:1,...e}}static importJSON(e){T(18,this.name)}updateFromJSON(e){return(function(t,s){const r=t.getWritable(),i=s.$;let o=i;for(const a of Wi(r).flatKeys)a in s&&(o!==void 0&&o!==i||(o={...i}),o[a]=s[a]);return(r.__state||o)&&Tl(t).updateFromJSON(o),r})(this,e)}static transform(){return null}remove(e){ws(this,!0,e)}replace(e,t){X();let s=B();s!==null&&(s=s.clone()),rs(this,e);const r=this.getLatest(),i=this.__key,o=e.__key,a=e.getWritable(),l=this.getParentOrThrow().getWritable(),c=l.__size;Ve(a);const u=r.getPreviousSibling(),p=r.getNextSibling(),d=r.__prev,h=r.__next,f=r.__parent;if(ws(r,!1,!0),u===null?l.__first=o:u.getWritable().__next=o,a.__prev=d,p===null?l.__last=o:p.getWritable().__prev=o,a.__next=h,a.__parent=f,l.__size=c,t&&(k(this)&&k(a)||T(139),this.getChildren().forEach((m=>{a.append(m)}))),P(s)){ue(s);const m=s.anchor,_=s.focus;m.key===i&&Ir(m,a),_.key===i&&Ir(_,a)}return Le()===i&&Z(o),a}insertAfter(e,t=!0){X(),rs(this,e);const s=this.getWritable(),r=e.getWritable(),i=r.getParent(),o=B();let a=!1,l=!1;if(i!==null){const h=e.getIndexWithinParent();if(Ve(r),P(o)){const f=i.__key,m=o.anchor,_=o.focus;a=m.type==="element"&&m.key===f&&m.offset===h+1,l=_.type==="element"&&_.key===f&&_.offset===h+1}}const c=this.getNextSibling(),u=this.getParentOrThrow().getWritable(),p=r.__key,d=s.__next;if(c===null?u.__last=p:c.getWritable().__prev=p,u.__size++,s.__next=p,r.__next=d,r.__prev=s.__key,r.__parent=s.__parent,t&&P(o)){const h=this.getIndexWithinParent();An(o,u,h+1);const f=u.__key;a&&o.anchor.set(f,h+2,"element"),l&&o.focus.set(f,h+2,"element")}return e}insertBefore(e,t=!0){X(),rs(this,e);const s=this.getWritable(),r=e.getWritable(),i=r.__key;Ve(r);const o=this.getPreviousSibling(),a=this.getParentOrThrow().getWritable(),l=s.__prev,c=this.getIndexWithinParent();o===null?a.__first=i:o.getWritable().__next=i,a.__size++,s.__prev=i,r.__prev=l,r.__next=s.__key,r.__parent=s.__parent;const u=B();return t&&P(u)&&An(u,this.getParentOrThrow(),c),e}isParentRequired(){return!1}createParentElementNode(){return Fe()}selectStart(){return this.selectPrevious()}selectEnd(){return this.selectNext(0,0)}selectPrevious(e,t){X();const s=this.getPreviousSibling(),r=this.getParentOrThrow();if(s===null)return r.select(0,0);if(k(s))return s.select();if(!M(s)){const i=s.getIndexWithinParent()+1;return r.select(i,i)}return s.select(e,t)}selectNext(e,t){X();const s=this.getNextSibling(),r=this.getParentOrThrow();if(s===null)return r.select();if(k(s))return s.select(0,0);if(!M(s)){const i=s.getIndexWithinParent();return r.select(i,i)}return s.select(e,t)}markDirty(){this.getWritable()}reconcileObservedMutation(e,t){this.markDirty()}}class Jt extends Ie{static getType(){return"linebreak"}static clone(e){return new Jt(e.__key)}constructor(e){super(e)}getTextContent(){return`
`}createDOM(){return document.createElement("br")}updateDOM(){return!1}isInline(){return!0}static importDOM(){return{br:e=>(function(t){const s=t.parentElement;if(s!==null&&oi(s)){const r=s.firstChild;if(r===t||r.nextSibling===t&&on(r)){const i=s.lastChild;if(i===t||i.previousSibling===t&&on(i))return!0}}return!1})(e)||(function(t){const s=t.parentElement;if(s!==null&&oi(s)){const r=s.firstChild;if(r===t||r.nextSibling===t&&on(r))return!1;const i=s.lastChild;if(i===t||i.previousSibling===t&&on(i))return!0}return!1})(e)?null:{conversion:Xl,priority:0}}}static importJSON(e){return Wt().updateFromJSON(e)}}function Xl(n){return{node:Wt()}}function Wt(){return Wn(new Jt)}function ht(n){return n instanceof Jt}function on(n){return Ae(n)&&/^( |\t|\r?\n)+$/.test(n.textContent||"")}function Xn(n,e){return 16&e?"code":e&As?"mark":32&e?"sub":64&e?"sup":null}function Zn(n,e){return 1&e?"strong":2&e?"em":"span"}function ao(n,e,t,s,r){const i=s.classList;let o=gt(r,"base");o!==void 0&&i.add(...o),o=gt(r,"underlineStrikethrough");let a=!1;const l=e&bn&&e&vn;o!==void 0&&(t&bn&&t&vn?(a=!0,l||i.add(...o)):l&&i.remove(...o));for(const c in Qe){const u=Qe[c];if(o=gt(r,c),o!==void 0)if(t&u){if(a&&(c==="underline"||c==="strikethrough")){e&u&&i.remove(...o);continue}e&u&&(!l||c!=="underline")&&c!=="strikethrough"||i.add(...o)}else e&u&&i.remove(...o)}}function lo(n,e,t){const s=e.firstChild,r=t.isComposing(),i=n+(r?Pn:"");if(s==null)e.textContent=i;else{const o=s.nodeValue;if(o!==i)if(r||Ye){const[a,l,c]=(function(u,p){const d=u.length,h=p.length;let f=0,m=0;for(;f<d&&f<h&&u[f]===p[f];)f++;for(;m+f<d&&m+f<h&&u[d-m-1]===p[h-m-1];)m++;return[f,d-f-m,p.slice(f,h-m)]})(o,i);l!==0&&s.deleteData(a,l),s.insertData(a,c)}else s.nodeValue=i}}function Dr(n,e,t,s,r,i){lo(r,n,e);const o=i.theme.text;o!==void 0&&ao(0,0,s,n,o)}function an(n,e){const t=document.createElement(e);return t.appendChild(n),t}class bt extends Ie{__text;__format;__style;__mode;__detail;static getType(){return"text"}static clone(e){return new bt(e.__text,e.__key)}afterCloneFrom(e){super.afterCloneFrom(e),this.__text=e.__text,this.__format=e.__format,this.__style=e.__style,this.__mode=e.__mode,this.__detail=e.__detail}constructor(e="",t){super(t),this.__text=e,this.__format=0,this.__style="",this.__mode=0,this.__detail=0}getFormat(){return this.getLatest().__format}getDetail(){return this.getLatest().__detail}getMode(){const e=this.getLatest();return vl[e.__mode]}getStyle(){return this.getLatest().__style}isToken(){return this.getLatest().__mode===1}isComposing(){return this.__key===Le()}isSegmented(){return this.getLatest().__mode===2}isDirectionless(){return!!(1&this.getLatest().__detail)}isUnmergeable(){return!!(2&this.getLatest().__detail)}hasFormat(e){const t=Qe[e];return!!(this.getFormat()&t)}isSimpleText(){return this.__type==="text"&&this.__mode===0}getTextContent(){return this.getLatest().__text}getFormatFlags(e,t){return Mn(this.getLatest().__format,e,t)}canHaveFormat(){return!0}isInline(){return!0}createDOM(e,t){const s=this.__format,r=Xn(0,s),i=Zn(0,s),o=r===null?i:r,a=document.createElement(o);let l=a;this.hasFormat("code")&&a.setAttribute("spellcheck","false"),r!==null&&(l=document.createElement(i),a.appendChild(l)),Dr(l,this,0,s,this.__text,e);const c=this.__style;return c!==""&&(a.style.cssText=c),a}updateDOM(e,t,s){const r=this.__text,i=e.__format,o=this.__format,a=Xn(0,i),l=Xn(0,o),c=Zn(0,i),u=Zn(0,o);if((a===null?c:a)!==(l===null?u:l))return!0;if(a===l&&c!==u){const m=t.firstChild;m==null&&T(48);const _=document.createElement(u);return Dr(_,this,0,o,r,s),t.replaceChild(_,m),!1}let p=t;l!==null&&a!==null&&(p=t.firstChild,p==null&&T(49)),lo(r,p,this);const d=s.theme.text;d!==void 0&&i!==o&&ao(0,i,o,p,d);const h=e.__style,f=this.__style;return h!==f&&(t.style.cssText=f),!1}static importDOM(){return{"#text":()=>({conversion:nc,priority:0}),b:()=>({conversion:ec,priority:0}),code:()=>({conversion:Ne,priority:0}),em:()=>({conversion:Ne,priority:0}),i:()=>({conversion:Ne,priority:0}),mark:()=>({conversion:Ne,priority:0}),s:()=>({conversion:Ne,priority:0}),span:()=>({conversion:Zl,priority:0}),strong:()=>({conversion:Ne,priority:0}),sub:()=>({conversion:Ne,priority:0}),sup:()=>({conversion:Ne,priority:0}),u:()=>({conversion:Ne,priority:0})}}static importJSON(e){return Q().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTextContent(e.text).setFormat(e.format).setDetail(e.detail).setMode(e.mode).setStyle(e.style)}exportDOM(e){let{element:t}=super.exportDOM(e);return ae(t)||T(132),t.style.whiteSpace="pre-wrap",this.hasFormat("lowercase")?t.style.textTransform="lowercase":this.hasFormat("uppercase")?t.style.textTransform="uppercase":this.hasFormat("capitalize")&&(t.style.textTransform="capitalize"),this.hasFormat("bold")&&(t=an(t,"b")),this.hasFormat("italic")&&(t=an(t,"i")),this.hasFormat("strikethrough")&&(t=an(t,"s")),this.hasFormat("underline")&&(t=an(t,"u")),{element:t}}exportJSON(){return{detail:this.getDetail(),format:this.getFormat(),mode:this.getMode(),style:this.getStyle(),text:this.getTextContent(),...super.exportJSON()}}selectionTransform(e,t){}setFormat(e){const t=this.getWritable();return t.__format=typeof e=="string"?Qe[e]:e,t}setDetail(e){const t=this.getWritable();return t.__detail=typeof e=="string"?_l[e]:e,t}setStyle(e){const t=this.getWritable();return t.__style=e,t}toggleFormat(e){const t=Mn(this.getFormat(),e,null);return this.setFormat(t)}toggleDirectionless(){const e=this.getWritable();return e.__detail^=1,e}toggleUnmergeable(){const e=this.getWritable();return e.__detail^=2,e}setMode(e){const t=xl[e];if(this.__mode===t)return this;const s=this.getWritable();return s.__mode=t,s}setTextContent(e){if(this.__text===e)return this;const t=this.getWritable();return t.__text=e,t}select(e,t){X();let s=e,r=t;const i=B(),o=this.getTextContent(),a=this.__key;if(typeof o=="string"){const l=o.length;s===void 0&&(s=l),r===void 0&&(r=l)}else s=0,r=0;if(!P(i))return ho(a,s,a,r,"text","text");{const l=Le();l!==i.anchor.key&&l!==i.focus.key||Z(a),i.setTextNodeRange(this,s,this,r)}return i}selectStart(){return this.select(0,0)}selectEnd(){const e=this.getTextContentSize();return this.select(e,e)}spliceText(e,t,s,r){const i=this.getWritable(),o=i.__text,a=s.length;let l=e;l<0&&(l=a+l,l<0&&(l=0));const c=B();if(r&&P(c)){const p=e+a;c.setTextNodeRange(i,p,i,p)}const u=o.slice(0,l)+s+o.slice(l+t);return i.__text=u,i}canInsertTextBefore(){return!0}canInsertTextAfter(){return!0}splitText(...e){X();const t=this.getLatest(),s=t.getTextContent();if(s==="")return[];const r=t.__key,i=Le(),o=s.length;e.sort(((w,C)=>w-C)),e.push(o);const a=[],l=e.length;for(let w=0,C=0;w<o&&C<=l;C++){const D=e[C];D>w&&(a.push(s.slice(w,D)),w=D)}const c=a.length;if(c===1)return[t];const u=a[0],p=t.getParent();let d;const h=t.getFormat(),f=t.getStyle(),m=t.__detail;let _=!1,x=null,y=null;const v=B();if(P(v)){const[w,C]=v.isBackward()?[v.focus,v.anchor]:[v.anchor,v.focus];w.type==="text"&&w.key===r&&(x=w),C.type==="text"&&C.key===r&&(y=C)}t.isSegmented()?(d=Q(u),d.__format=h,d.__style=f,d.__detail=m,d.__state=vr(t,d),_=!0):d=t.setTextContent(u);const b=[d];for(let w=1;w<c;w++){const C=Q(a[w]);C.__format=h,C.__style=f,C.__detail=m,C.__state=vr(t,C);const D=C.__key;i===r&&Z(D),b.push(C)}const S=x?x.offset:null,N=y?y.offset:null;let E=0;for(const w of b){if(!x&&!y)break;const C=E+w.getTextContentSize();if(x!==null&&S!==null&&S<=C&&S>=E&&(x.set(w.getKey(),S-E,"text"),S<C&&(x=null)),y!==null&&N!==null&&N<=C&&N>=E){y.set(w.getKey(),N-E,"text");break}E=C}if(p!==null){(function(D){const F=D.getPreviousSibling(),L=D.getNextSibling();F!==null&&Dn(F),L!==null&&Dn(L)})(this);const w=p.getWritable(),C=this.getIndexWithinParent();_?(w.splice(C,0,b),this.remove()):w.splice(C,1,b),P(v)&&An(v,p,C,c-1)}return b}mergeWithSibling(e){const t=e===this.getPreviousSibling();t||e===this.getNextSibling()||T(50);const s=this.__key,r=e.__key,i=this.__text,o=i.length;Le()===r&&Z(s);const a=B();if(P(a)){const p=a.anchor,d=a.focus;p!==null&&p.key===r&&Ur(p,t,s,e,o),d!==null&&d.key===r&&Ur(d,t,s,e,o)}const l=e.__text,c=t?l+i:i+l;this.setTextContent(c);const u=this.getWritable();return e.remove(),u}isTextEntity(){return!1}}function Zl(n){return{forChild:Bs(n.style),node:null}}function ec(n){const e=n,t=e.style.fontWeight==="normal";return{forChild:Bs(e.style,t?void 0:"bold"),node:null}}const Pr=new WeakMap;function tc(n){if(!ae(n))return!1;if(n.nodeName==="PRE")return!0;const e=n.style.whiteSpace;return typeof e=="string"&&e.startsWith("pre")}function nc(n){const e=n;n.parentElement===null&&T(129);let t=e.textContent||"";if((function(s){let r,i=s.parentNode;const o=[s];for(;i!==null&&(r=Pr.get(i))===void 0&&!tc(i);)o.push(i),i=i.parentNode;const a=r===void 0?i:r;for(let l=0;l<o.length;l++)Pr.set(o[l],a);return a})(e)!==null){const s=t.split(/(\r?\n|\t)/),r=[],i=s.length;for(let o=0;o<i;o++){const a=s[o];a===`
`||a===`\r
`?r.push(Wt()):a==="	"?r.push(zs()):a!==""&&r.push(Q(a))}return{node:r}}if(t=t.replace(/\r/g,"").replace(/[ \t\n]+/g," "),t==="")return{node:null};if(t[0]===" "){let s=e,r=!0;for(;s!==null&&(s=Lr(s,!1))!==null;){const i=s.textContent||"";if(i.length>0){/[ \t\n]$/.test(i)&&(t=t.slice(1)),r=!1;break}}r&&(t=t.slice(1))}if(t[t.length-1]===" "){let s=e,r=!0;for(;s!==null&&(s=Lr(s,!0))!==null;)if((s.textContent||"").replace(/^( |\t|\r?\n)+/,"").length>0){r=!1;break}r&&(t=t.slice(0,t.length-1))}return t===""?{node:null}:{node:Q(t)}}function Lr(n,e){let t=n;for(;;){let s;for(;(s=e?t.nextSibling:t.previousSibling)===null;){const i=t.parentElement;if(i===null)return null;t=i}if(t=s,ae(t)){const i=t.style.display;if(i===""&&!Ec(t)||i!==""&&!i.startsWith("inline"))return null}let r=t;for(;(r=e?t.firstChild:t.lastChild)!==null;)t=r;if(Ae(t))return t;if(t.nodeName==="BR")return null}}const sc={code:"code",em:"italic",i:"italic",mark:"highlight",s:"strikethrough",strong:"bold",sub:"subscript",sup:"superscript",u:"underline"};function Ne(n){const e=sc[n.nodeName.toLowerCase()];return e===void 0?{node:null}:{forChild:Bs(n.style,e),node:null}}function Q(n=""){return Wn(new bt(n))}function M(n){return n instanceof bt}function Bs(n,e){const t=n.fontWeight,s=n.textDecoration.split(" "),r=t==="700"||t==="bold",i=s.includes("line-through"),o=n.fontStyle==="italic",a=s.includes("underline"),l=n.verticalAlign;return c=>(M(c)&&(r&&!c.hasFormat("bold")&&c.toggleFormat("bold"),i&&!c.hasFormat("strikethrough")&&c.toggleFormat("strikethrough"),o&&!c.hasFormat("italic")&&c.toggleFormat("italic"),a&&!c.hasFormat("underline")&&c.toggleFormat("underline"),l!=="sub"||c.hasFormat("subscript")||c.toggleFormat("subscript"),l!=="super"||c.hasFormat("superscript")||c.toggleFormat("superscript"),e&&!c.hasFormat(e)&&c.toggleFormat(e)),c)}class qt extends bt{static getType(){return"tab"}static clone(e){return new qt(e.__key)}constructor(e){super("	",e),this.__detail=2}static importDOM(){return null}createDOM(e){const t=super.createDOM(e),s=gt(e.theme,"tab");return s!==void 0&&t.classList.add(...s),t}static importJSON(e){return zs().updateFromJSON(e)}setTextContent(e){return e!=="	"&&e!==""&&Pi(126),super.setTextContent("	")}spliceText(e,t,s,r){return s===""&&t===0||s==="	"&&t===1||T(286),this}setDetail(e){return e!==2&&T(127),this}setMode(e){return e!=="normal"&&T(128),this}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}}function zs(){return Wn(new qt)}function co(n){return n instanceof qt}class rc{key;offset;type;_selection;constructor(e,t,s){this._selection=null,this.key=e,this.offset=t,this.type=s}is(e){return this.key===e.key&&this.offset===e.offset&&this.type===e.type}isBefore(e){return this.key===e.key?this.offset<e.offset:Ro(xe(it(this,"next")),xe(it(e,"next")))<0}getNode(){const e=G(this.key);return e===null&&T(20),e}set(e,t,s,r){const i=this._selection,o=this.key;r&&this.key===e&&this.offset===t&&this.type===s||(this.key=e,this.offset=t,this.type=s,Vt()||(Le()===o&&Z(e),i!==null&&(i.setCachedNodes(null),i.dirty=!0)))}}function ve(n,e,t){return new rc(n,e,t)}function es(n,e){let t=e.__key,s=n.offset,r="element";if(M(e)){r="text";const i=e.getTextContentSize();s>i&&(s=i)}else if(!k(e)){const i=e.getNextSibling();if(M(i))t=i.__key,s=0,r="text";else{const o=e.getParent();o&&(t=o.__key,s=e.getIndexWithinParent()+1)}}n.set(t,s,r)}function Ir(n,e){if(k(e)){const t=e.getLastDescendant();k(t)||M(t)?es(n,t):es(n,e)}else es(n,e)}class In{_nodes;_cachedNodes;dirty;constructor(e){this._cachedNodes=null,this._nodes=e,this.dirty=!1}getCachedNodes(){return this._cachedNodes}setCachedNodes(e){this._cachedNodes=e}is(e){if(!Ks(e))return!1;const t=this._nodes,s=e._nodes;return t.size===s.size&&Array.from(t).every((r=>s.has(r)))}isCollapsed(){return!1}isBackward(){return!1}getStartEndPoints(){return null}add(e){this.dirty=!0,this._nodes.add(e),this._cachedNodes=null}delete(e){this.dirty=!0,this._nodes.delete(e),this._cachedNodes=null}clear(){this.dirty=!0,this._nodes.clear(),this._cachedNodes=null}has(e){return this._nodes.has(e)}clone(){return new In(new Set(this._nodes))}extract(){return this.getNodes()}insertRawText(e){}insertText(){}insertNodes(e){const t=this.getNodes(),s=t.length,r=t[s-1];let i;if(M(r))i=r.select();else{const o=r.getIndexWithinParent()+1;i=r.getParentOrThrow().select(o,o)}i.insertNodes(e);for(let o=0;o<s;o++)t[o].remove()}getNodes(){const e=this._cachedNodes;if(e!==null)return e;const t=this._nodes,s=[];for(const r of t){const i=G(r);i!==null&&s.push(i)}return Vt()||(this._cachedNodes=s),s}getTextContent(){const e=this.getNodes();let t="";for(let s=0;s<e.length;s++)t+=e[s].getTextContent();return t}deleteNodes(){const e=this.getNodes();if((B()||St())===this&&e[0]){const t=ne(e[0],"next");Kc(rt(t,t))}for(const t of e)t.remove()}}function P(n){return n instanceof ot}class ot{format;style;anchor;focus;_cachedNodes;dirty;constructor(e,t,s,r){this.anchor=e,this.focus=t,e._selection=this,t._selection=this,this._cachedNodes=null,this.format=s,this.style=r,this.dirty=!1}getCachedNodes(){return this._cachedNodes}setCachedNodes(e){this._cachedNodes=e}is(e){return!!P(e)&&this.anchor.is(e.anchor)&&this.focus.is(e.focus)&&this.format===e.format&&this.style===e.style}isCollapsed(){return this.anchor.is(this.focus)}getNodes(){const e=this._cachedNodes;if(e!==null)return e;const t=(function(s){const r=[],[i,o]=s.getTextSlices();i&&r.push(i.caret.origin);const a=new Set,l=new Set;for(const c of s)if(Te(c)){const{origin:u}=c;r.length===0?a.add(u):(l.add(u),r.push(u))}else{const{origin:u}=c;k(u)&&l.has(u)||r.push(u)}if(o&&r.push(o.caret.origin),xt(s.focus)&&k(s.focus.origin)&&s.focus.getNodeAtCaret()===null)for(let c=Be(s.focus.origin,"previous");Te(c)&&a.has(c.origin)&&!c.origin.isEmpty()&&c.origin.is(r[r.length-1]);c=nr(c))a.delete(c.origin),r.pop();for(;r.length>1;){const c=r[r.length-1];if(!k(c)||l.has(c)||c.isEmpty()||a.has(c))break;r.pop()}if(r.length===0&&s.isCollapsed()){const c=xe(s.anchor),u=xe(s.anchor.getFlipped()),p=h=>He(h)?h.origin:h.getNodeAtCaret(),d=p(c)||p(u)||(s.anchor.getNodeAtCaret()?c.origin:u.origin);r.push(d)}return r})(zo(di(this),"next"));return Vt()||(this._cachedNodes=t),t}setTextNodeRange(e,t,s,r){this.anchor.set(e.__key,t,"text"),this.focus.set(s.__key,r,"text")}getTextContent(){const e=this.getNodes();if(e.length===0)return"";const t=e[0],s=e[e.length-1],r=this.anchor,i=this.focus,o=r.isBefore(i),[a,l]=Rr(this);let c="",u=!0;for(let p=0;p<e.length;p++){const d=e[p];if(k(d)&&!d.isInline())u||(c+=`
`),u=!d.isEmpty();else if(u=!1,M(d)){let h=d.getTextContent();d===t?d===s?r.type==="element"&&i.type==="element"&&i.offset!==r.offset||(h=a<l?h.slice(a,l):h.slice(l,a)):h=o?h.slice(a):h.slice(l):d===s&&(h=o?h.slice(0,l):h.slice(0,a)),c+=h}else!W(d)&&!ht(d)||d===s&&this.isCollapsed()||(c+=d.getTextContent())}return c}applyDOMRange(e){const t=$(),s=t.getEditorState()._selection,r=fo(e.startContainer,e.startOffset,e.endContainer,e.endOffset,t,s);if(r===null)return;const[i,o]=r;this.anchor.set(i.key,i.offset,i.type,!0),this.focus.set(o.key,o.offset,o.type,!0),fs(this)}clone(){const e=this.anchor,t=this.focus;return new ot(ve(e.key,e.offset,e.type),ve(t.key,t.offset,t.type),this.format,this.style)}toggleFormat(e){this.format=Mn(this.format,e,null),this.dirty=!0}setFormat(e){this.format=e,this.dirty=!0}setStyle(e){this.style=e,this.dirty=!0}hasFormat(e){const t=Qe[e];return!!(this.format&t)}insertRawText(e){const t=e.split(/(\r?\n|\t)/),s=[],r=t.length;for(let i=0;i<r;i++){const o=t[i];o===`
`||o===`\r
`?s.push(Wt()):o==="	"?s.push(zs()):s.push(Q(o))}this.insertNodes(s)}insertText(e){const t=this.anchor,s=this.focus,r=this.format,i=this.style;let o=t,a=s;!this.isCollapsed()&&s.isBefore(t)&&(o=s,a=t),o.type==="element"&&(function(_,x,y,v){const b=_.getNode(),S=b.getChildAtIndex(_.offset),N=Q();if(N.setFormat(y),N.setStyle(v),pc(S))S.splice(0,0,[N]);else{const E=ee(b)?Fe().append(N):N;S===null?b.append(E):S.insertBefore(E)}_.is(x)&&x.set(N.__key,0,"text"),_.set(N.__key,0,"text")})(o,a,r,i),a.type==="element"&&Ut(a,xe(it(a,"next")));const l=o.offset;let c=a.offset;const u=this.getNodes(),p=u.length;let d=u[0];M(d)||T(26);const h=d.getTextContent().length,f=d.getParentOrThrow();let m=u[p-1];if(p===1&&a.type==="element"&&(c=h,a.set(o.key,c,"text")),this.isCollapsed()&&l===h&&(De(d)||!d.canInsertTextAfter()||!f.canInsertTextAfter()&&d.getNextSibling()===null)){let _=d.getNextSibling();if(M(_)&&_.canInsertTextBefore()&&!De(_)||(_=Q(),_.setFormat(r),_.setStyle(i),f.canInsertTextAfter()?d.insertAfter(_):f.insertAfter(_)),_.select(0,0),d=_,e!=="")return void this.insertText(e)}else if(this.isCollapsed()&&l===0&&(De(d)||!d.canInsertTextBefore()||!f.canInsertTextBefore()&&d.getPreviousSibling()===null)){let _=d.getPreviousSibling();if(M(_)&&!De(_)||(_=Q(),_.setFormat(r),f.canInsertTextBefore()?d.insertBefore(_):f.insertBefore(_)),_.select(),d=_,e!=="")return void this.insertText(e)}else if(d.isSegmented()&&l!==h){const _=Q(d.getTextContent());_.setFormat(r),d.replace(_),d=_}else if(!this.isCollapsed()&&e!==""){const _=m.getParent();if(!f.canInsertTextBefore()||!f.canInsertTextAfter()||k(_)&&(!_.canInsertTextBefore()||!_.canInsertTextAfter()))return this.insertText(""),uo(this.anchor,this.focus,null),void this.insertText(e)}if(p===1){if(qe(d)){const v=Q(e);return v.select(),void d.replace(v)}const _=d.getFormat(),x=d.getStyle();if(l!==c||_===r&&x===i){if(co(d)){const v=Q(e);return v.setFormat(r),v.setStyle(i),v.select(),void d.replace(v)}}else{if(d.getTextContent()!==""){const v=Q(e);if(v.setFormat(r),v.setStyle(i),v.select(),l===0)d.insertBefore(v,!1);else{const[b]=d.splitText(l);b.insertAfter(v,!1)}return void(v.isComposing()&&this.anchor.type==="text"&&(this.anchor.offset-=e.length))}d.setFormat(r),d.setStyle(i)}const y=c-l;d=d.spliceText(l,y,e,!0),d.getTextContent()===""?d.remove():this.anchor.type==="text"&&(d.isComposing()?this.anchor.offset-=e.length:(this.format=_,this.style=x))}else{const _=new Set([...d.getParentKeys(),...m.getParentKeys()]),x=k(d)?d:d.getParentOrThrow();let y=k(m)?m:m.getParentOrThrow(),v=m;if(!x.is(y)&&y.isInline())do v=y,y=y.getParentOrThrow();while(y.isInline());if(a.type==="text"&&(c!==0||m.getTextContent()==="")||a.type==="element"&&m.getIndexWithinParent()<c)if(M(m)&&!qe(m)&&c!==m.getTextContentSize()){if(m.isSegmented()){const w=Q(m.getTextContent());m.replace(w),m=w}ee(a.getNode())||a.type!=="text"||(m=m.spliceText(0,c,"")),_.add(m.__key)}else{const w=m.getParentOrThrow();w.canBeEmpty()||w.getChildrenSize()!==1?m.remove():w.remove()}else _.add(m.__key);const b=y.getChildren(),S=new Set(u),N=x.is(y),E=x.isInline()&&d.getNextSibling()===null?x:d;for(let w=b.length-1;w>=0;w--){const C=b[w];if(C.is(d)||k(C)&&C.isParentOf(d))break;C.isAttached()&&(!S.has(C)||C.is(v)?N||E.insertAfter(C,!1):C.remove())}if(!N){let w=y,C=null;for(;w!==null;){const D=w.getChildren(),F=D.length;(F===0||D[F-1].is(C))&&(_.delete(w.__key),C=w),w=w.getParent()}}if(qe(d))if(l===h)d.select();else{const w=Q(e);w.select(),d.replace(w)}else d=d.spliceText(l,h-l,e,!0),d.getTextContent()===""?d.remove():d.isComposing()&&this.anchor.type==="text"&&(this.anchor.offset-=e.length);for(let w=1;w<p;w++){const C=u[w],D=C.__key;_.has(D)||C.remove()}}}removeText(){const e=B()===this;pn(this,Wc(di(this))),e&&B()!==this&&ue(this)}formatText(e,t=null){if(this.isCollapsed())return this.toggleFormat(e),void Z(null);const s=this.getNodes(),r=[];for(const b of s)M(b)&&r.push(b);const i=b=>{s.forEach((S=>{if(k(S)){const N=S.getFormatFlags(e,b);S.setTextFormat(N)}}))},o=r.length;if(o===0)return this.toggleFormat(e),Z(null),void i(t);const a=this.anchor,l=this.focus,c=this.isBackward(),u=c?l:a,p=c?a:l;let d=0,h=r[0],f=u.type==="element"?0:u.offset;if(u.type==="text"&&f===h.getTextContentSize()&&(d=1,h=r[1],f=0),h==null)return;const m=h.getFormatFlags(e,t);i(m);const _=o-1;let x=r[_];const y=p.type==="text"?p.offset:x.getTextContentSize();if(h.is(x)){if(f===y)return;if(De(h)||f===0&&y===h.getTextContentSize())h.setFormat(m);else{const b=h.splitText(f,y),S=f===0?b[0]:b[1];S.setFormat(m),u.type==="text"&&u.set(S.__key,0,"text"),p.type==="text"&&p.set(S.__key,y-f,"text")}return void(this.format=m)}f===0||De(h)||([,h]=h.splitText(f),f=0),h.setFormat(m);const v=x.getFormatFlags(e,m);y>0&&(y===x.getTextContentSize()||De(x)||([x]=x.splitText(y)),x.setFormat(v));for(let b=d+1;b<_;b++){const S=r[b],N=S.getFormatFlags(e,v);S.setFormat(N)}u.type==="text"&&u.set(h.__key,f,"text"),p.type==="text"&&p.set(x.__key,y,"text"),this.format=m|v}insertNodes(e){if(e.length===0)return;if(this.isCollapsed()||this.removeText(),this.anchor.key==="root"){this.insertParagraph();const f=B();return P(f)||T(134),f.insertNodes(e)}const t=(this.isBackward()?this.focus:this.anchor).getNode(),s=hn(t,Pe),r=e[e.length-1];if(k(s)&&"__language"in s){if("__language"in e[0])this.insertText(e[0].getTextContent());else{const f=ts(this);s.splice(f,0,e),r.selectEnd()}return}if(!e.some((f=>(k(f)||W(f))&&!f.isInline()))){k(s)||T(211,t.constructor.name,t.getType());const f=ts(this);return s.splice(f,0,e),void r.selectEnd()}const i=(function(f){const m=Fe();let _=null;for(let x=0;x<f.length;x++){const y=f[x],v=ht(y);if(v||W(y)&&y.isInline()||k(y)&&y.isInline()||M(y)||y.isParentRequired()){if(_===null&&(_=y.createParentElementNode(),m.append(_),v))continue;_!==null&&_.append(y)}else m.append(y),_=null}return m})(e),o=i.getLastDescendant(),a=i.getChildren(),l=!k(s)||!s.isEmpty()?this.insertParagraph():null,c=a[a.length-1];let u=a[0];var p;k(p=u)&&Pe(p)&&!p.isEmpty()&&k(s)&&(!s.isEmpty()||s.canMergeWhenEmpty())&&(k(s)||T(211,t.constructor.name,t.getType()),s.append(...u.getChildren()),u=a[1]),u&&(s===null&&T(212,t.constructor.name,t.getType()),(function(f,m,_){const x=m.getParentOrThrow().getLastChild();let y=m;const v=[m];for(;y!==x;)y.getNextSibling()||T(140),y=y.getNextSibling(),v.push(y);let b=f;for(const S of v)b=b.insertAfter(S)})(s,u));const d=hn(o,Pe);l&&k(d)&&(l.canMergeWhenEmpty()||Pe(c))&&(d.append(...l.getChildren()),l.remove()),k(s)&&s.isEmpty()&&s.remove(),o.selectEnd();const h=k(s)?s.getLastChild():null;ht(h)&&d!==s&&h.remove()}insertParagraph(){if(this.anchor.key==="root"){const o=Fe();return oe().splice(this.anchor.offset,0,[o]),o.select(),o}const e=ts(this),t=hn(this.anchor.getNode(),Pe);k(t)||T(213);const s=t.getChildAtIndex(e),r=s?[s,...s.getNextSiblings()]:[],i=t.insertNewAfter(this,!1);return i?(i.append(...r),i.selectStart(),i):null}insertLineBreak(e){const t=Wt();if(this.insertNodes([t]),e){const s=t.getParentOrThrow(),r=t.getIndexWithinParent();s.select(r,r)}}extract(){const e=[...this.getNodes()],t=e.length;let s=e[0],r=e[t-1];const[i,o]=Rr(this),a=this.isBackward(),[l,c]=a?[this.focus,this.anchor]:[this.anchor,this.focus],[u,p]=a?[o,i]:[i,o];if(t===0)return[];if(t===1){if(M(s)&&!this.isCollapsed()){const d=s.splitText(u,p),h=u===0?d[0]:d[1];return h?(l.set(h.getKey(),0,"text"),c.set(h.getKey(),h.getTextContentSize(),"text"),[h]):[]}return[s]}if(M(s)&&(u===s.getTextContentSize()?e.shift():u!==0&&([,s]=s.splitText(u),e[0]=s,l.set(s.getKey(),0,"text"))),M(r)){const d=r.getTextContent().length;p===0?e.pop():p!==d&&([r]=r.splitText(p),e[e.length-1]=r,c.set(r.getKey(),r.getTextContentSize(),"text"))}return e}modify(e,t,s){if(Jr(this,e,t,s))return;const r=e==="move",i=$(),o=Oe(fe(i));if(!o)return;const a=i._blockCursorElement,l=i._rootElement,c=this.focus.getNode();if(l===null||a===null||!k(c)||c.isInline()||c.canBeEmpty()||Es(a,i,l),this.dirty){let u=et(i,this.anchor.key),p=et(i,this.focus.key);this.anchor.type==="text"&&(u=yt(u)),this.focus.type==="text"&&(p=yt(p)),u&&p&&po(o,u,this.anchor.offset,p,this.focus.offset)}if((function(u,p,d,h){u.modify(p,d,h)})(o,e,t?"backward":"forward",s),o.rangeCount>0){const u=o.getRangeAt(0),p=this.anchor.getNode(),d=ee(p)?p:Cc(p);if(this.applyDOMRange(u),this.dirty=!0,!r){const h=this.getNodes(),f=[];let m=!1;for(let _=0;_<h.length;_++){const x=h[_];Ts(x,d)?f.push(x):m=!0}if(m&&f.length>0)if(t){const _=f[0];k(_)?_.selectStart():_.getParentOrThrow().selectStart()}else{const _=f[f.length-1];k(_)?_.selectEnd():_.getParentOrThrow().selectEnd()}o.anchorNode===u.startContainer&&o.anchorOffset===u.startOffset||(function(_){const x=_.focus,y=_.anchor,v=y.key,b=y.offset,S=y.type;y.set(x.key,x.offset,x.type,!0),x.set(v,b,S,!0)})(this)}}s==="lineboundary"&&Jr(this,e,t,s,"decorators")}forwardDeletion(e,t,s){if(!s&&(e.type==="element"&&k(t)&&e.offset===t.getChildrenSize()||e.type==="text"&&e.offset===t.getTextContentSize())){const r=t.getParent(),i=t.getNextSibling()||(r===null?null:r.getNextSibling());if(k(i)&&i.isShadowRoot())return!0}return!1}deleteCharacter(e){const t=this.isCollapsed();if(this.isCollapsed()){const s=this.anchor;let r=s.getNode();if(this.forwardDeletion(s,r,e))return;const i=Io(it(s,e?"previous":"next"));if(i.getTextSlices().every((a=>a===null||a.distance===0))){let a={type:"initial"};for(const l of i.iterNodeCarets("shadowRoot"))if(Te(l)){if(!l.origin.isInline()){if(l.origin.isShadowRoot()){if(a.type==="merge-block")break;if(k(i.anchor.origin)&&i.anchor.origin.isEmpty()){const c=xe(l);pn(this,rt(c,c)),i.anchor.origin.remove()}return}a.type!=="merge-next-block"&&a.type!=="merge-block"||(a={block:a.block,caret:l,type:"merge-block"})}}else{if(a.type==="merge-block")break;if(xt(l)){if(k(l.origin)){if(l.origin.isInline()){if(!l.origin.isParentOf(i.anchor.origin))break}else a={block:l.origin,type:"merge-next-block"};continue}if(W(l.origin)){if(!l.origin.isIsolated())if(a.type==="merge-next-block"&&(l.origin.isKeyboardSelectable()||!l.origin.isInline())&&k(i.anchor.origin)&&i.anchor.origin.isEmpty()){i.anchor.origin.remove();const c=go();c.add(l.origin.getKey()),ue(c)}else l.origin.remove();return}break}}if(a.type==="merge-block"){const{caret:l,block:c}=a;return pn(this,rt(!l.origin.isEmpty()&&c.isEmpty()?rr(ne(c,l.direction)):i.anchor,l)),this.removeText()}}const o=this.focus;if(this.modify("extend",e,"character"),this.isCollapsed()){if(e&&s.offset===0&&Br(this,s.getNode()))return}else{const a=o.type==="text"?o.getNode():null;if(r=s.type==="text"?s.getNode():null,a!==null&&a.isSegmented()){const l=o.offset,c=a.getTextContentSize();if(a.is(r)||e&&l!==c||!e&&l!==0)return void zr(a,e,l)}else if(r!==null&&r.isSegmented()){const l=s.offset,c=r.getTextContentSize();if(r.is(a)||e&&l!==0||!e&&l!==c)return void zr(r,e,l)}(function(l,c){const u=l.anchor,p=l.focus,d=u.getNode(),h=p.getNode();if(d===h&&u.type==="text"&&p.type==="text"){const f=u.offset,m=p.offset,_=f<m,x=_?f:m,y=_?m:f,v=y-1;x!==v&&(function(b){return!(Ao(b)||ic(b))})(d.getTextContent().slice(x,y))&&(c?p.set(p.key,v,p.type):u.set(u.key,v,u.type))}})(this,e)}}if(this.removeText(),e&&!t&&this.isCollapsed()&&this.anchor.type==="element"&&this.anchor.offset===0){const s=this.anchor.getNode();s.isEmpty()&&ee(s.getParent())&&s.getPreviousSibling()===null&&Br(this,s)}}deleteLine(e){this.isCollapsed()&&this.modify("extend",e,"lineboundary"),this.isCollapsed()?this.deleteCharacter(e):this.removeText()}deleteWord(e){if(this.isCollapsed()){const t=this.anchor,s=t.getNode();if(this.forwardDeletion(t,s,e))return;this.modify("extend",e,"word")}this.removeText()}isBackward(){return this.focus.isBefore(this.anchor)}getStartEndPoints(){return[this.anchor,this.focus]}}function Ks(n){return n instanceof In}function Fr(n){const e=n.offset;if(n.type==="text")return e;const t=n.getNode();return e===t.getChildrenSize()?t.getTextContent().length:0}function Rr(n){const e=n.getStartEndPoints();if(e===null)return[0,0];const[t,s]=e;return t.type==="element"&&s.type==="element"&&t.key===s.key&&t.offset===s.offset?[0,0]:[Fr(t),Fr(s)]}function Br(n,e){for(let t=e;t;t=t.getParent()){if(k(t)){if(t.collapseAtStart(n))return!0;if(Ke(t))break}if(t.getPreviousSibling())break}return!1}const ic=(()=>{try{const n=new RegExp("\\p{Emoji}","u"),e=n.test.bind(n);if(e("â¤ï¸")&&e("#ï¸â£")&&e("ð"))return e}catch{}return()=>!1})();function zr(n,e,t){const s=n,r=s.getTextContent().split(/(?=\s)/g),i=r.length;let o=0,a=0;for(let c=0;c<i;c++){const u=c===i-1;if(a=o,o+=r[c].length,e&&o===t||o>t||u){r.splice(c,1),u&&(a=void 0);break}}const l=r.join("").trim();l===""?s.remove():(s.setTextContent(l),s.select(a,a))}function Kr(n,e,t,s){let r,i=e;if(ae(n)){let o=!1;const a=n.childNodes,l=a.length,c=s._blockCursorElement;i===l&&(o=!0,i=l-1);let u=a[i],p=!1;if(u===c)u=a[i+1],p=!0;else if(c!==null){const d=c.parentNode;n===d&&e>Array.prototype.indexOf.call(d.children,c)&&i--}if(r=dt(u),M(r))i=Re(r,o?"next":"previous");else{let d=dt(n);if(d===null)return null;if(k(d)){const h=s.getElementByKey(d.getKey());h===null&&T(214),[d,i]=d.getDOMSlot(h).resolveChildIndex(d,h,n,e),k(d)||T(215),o&&i>=d.getChildrenSize()&&(i=Math.max(0,d.getChildrenSize()-1));let m=d.getChildAtIndex(i);if(k(m)&&(function(_,x,y){const v=_.getParent();return y===null||v===null||!v.canBeEmpty()||v!==y.getNode()})(m,0,t)){const _=o?m.getLastDescendant():m.getFirstDescendant();_===null?d=m:(m=_,d=k(m)?m:m.getParentOrThrow()),i=0}M(m)?(r=m,d=null,i=Re(m,o?"next":"previous")):m!==d&&o&&!p&&(k(d)||T(216),i=Math.min(d.getChildrenSize(),i+1))}else{const h=d.getIndexWithinParent();i=e===0&&W(d)&&dt(n)===d?h:h+1,d=d.getParentOrThrow()}if(k(d))return ve(d.__key,i,"element")}}else r=dt(n);return M(r)?ve(r.__key,Re(r,i,"clamp"),"text"):null}function Wr(n,e,t){const s=n.offset,r=n.getNode();if(s===0){const i=r.getPreviousSibling(),o=r.getParent();if(e){if((t||!e)&&i===null&&k(o)&&o.isInline()){const a=o.getPreviousSibling();M(a)&&n.set(a.__key,a.getTextContent().length,"text")}}else k(i)&&!t&&i.isInline()?n.set(i.__key,i.getChildrenSize(),"element"):M(i)&&n.set(i.__key,i.getTextContent().length,"text")}else if(s===r.getTextContent().length){const i=r.getNextSibling(),o=r.getParent();if(e&&k(i)&&i.isInline())n.set(i.__key,0,"element");else if((t||e)&&i===null&&k(o)&&o.isInline()&&!o.canInsertTextAfter()){const a=o.getNextSibling();M(a)&&n.set(a.__key,0,"text")}}}function uo(n,e,t){if(n.type==="text"&&e.type==="text"){const s=n.isBefore(e),r=n.is(e);Wr(n,s,r),Wr(e,!s,r),r&&e.set(n.key,n.offset,n.type);const i=$();if(i.isComposing()&&i._compositionKey!==n.key&&P(t)){const o=t.anchor,a=t.focus;n.set(o.key,o.offset,o.type,!0),e.set(a.key,a.offset,a.type,!0)}}}function fo(n,e,t,s,r,i){if(n===null||t===null||!Rn(r,n,t))return null;const o=Kr(n,e,P(i)?i.anchor:null,r);if(o===null)return null;const a=Kr(t,s,P(i)?i.focus:null,r);if(a===null)return null;if(o.type==="element"&&a.type==="element"){const l=dt(n),c=dt(t);if(W(l)&&W(c))return null}return uo(o,a,i),[o,a]}function xu(n){return k(n)&&!n.isInline()}function ho(n,e,t,s,r,i){const o=ze(),a=new ot(ve(n,e,r),ve(t,s,i),0,"");return a.dirty=!0,o._selection=a,a}function oc(){const n=ve("root",0,"element"),e=ve("root",0,"element");return new ot(n,e,0,"")}function go(){return new In(new Set)}function Ws(n,e,t,s){const r=t._window;if(r===null)return null;const i=s||r.event,o=i?i.type:void 0,a=o==="selectionchange",l=!ds&&(a||o==="beforeinput"||o==="compositionstart"||o==="compositionend"||o==="click"&&i&&i.detail===3||o==="drop"||o===void 0);let c,u,p,d;if(P(n)&&!l)return n.clone();if(e===null)return null;if(c=e.anchorNode,u=e.focusNode,p=e.anchorOffset,d=e.focusOffset,a&&P(n)&&!Rn(t,c,u))return n.clone();const h=fo(c,p,u,d,t,n);if(h===null)return null;const[f,m]=h;return new ot(f,m,P(n)?n.format:0,P(n)?n.style:"")}function B(){return ze()._selection}function St(){return $()._editorState._selection}function An(n,e,t,s=1){const r=n.anchor,i=n.focus,o=r.getNode(),a=i.getNode();if(!e.is(o)&&!e.is(a))return;const l=e.__key;if(n.isCollapsed()){const c=r.offset;if(t<=c&&s>0||t<c&&s<0){const u=Math.max(0,c+s);r.set(l,u,"element"),i.set(l,u,"element"),$r(n)}}else{const c=n.isBackward(),u=c?i:r,p=u.getNode(),d=c?r:i,h=d.getNode();if(e.is(p)){const f=u.offset;(t<=f&&s>0||t<f&&s<0)&&u.set(l,Math.max(0,f+s),"element")}if(e.is(h)){const f=d.offset;(t<=f&&s>0||t<f&&s<0)&&d.set(l,Math.max(0,f+s),"element")}}$r(n)}function $r(n){const e=n.anchor,t=e.offset,s=n.focus,r=s.offset,i=e.getNode(),o=s.getNode();if(n.isCollapsed()){if(!k(i))return;const a=i.getChildrenSize(),l=t>=a,c=l?i.getChildAtIndex(a-1):i.getChildAtIndex(t);if(M(c)){let u=0;l&&(u=c.getTextContentSize()),e.set(c.__key,u,"text"),s.set(c.__key,u,"text")}}else{if(k(i)){const a=i.getChildrenSize(),l=t>=a,c=l?i.getChildAtIndex(a-1):i.getChildAtIndex(t);if(M(c)){let u=0;l&&(u=c.getTextContentSize()),e.set(c.__key,u,"text")}}if(k(o)){const a=o.getChildrenSize(),l=r>=a,c=l?o.getChildAtIndex(a-1):o.getChildAtIndex(r);if(M(c)){let u=0;l&&(u=c.getTextContentSize()),s.set(c.__key,u,"text")}}}}function jn(n,e,t,s,r){let i=null,o=0,a=null;s!==null?(i=s.__key,M(s)?(o=s.getTextContentSize(),a="text"):k(s)&&(o=s.getChildrenSize(),a="element")):r!==null&&(i=r.__key,M(r)?a="text":k(r)&&(a="element")),i!==null&&a!==null?n.set(i,o,a):(o=e.getIndexWithinParent(),o===-1&&(o=t.getChildrenSize()),n.set(t.__key,o,"element"))}function Ur(n,e,t,s,r){n.type==="text"?n.set(t,n.offset+(e?0:r),"text"):n.offset>s.getIndexWithinParent()&&n.set(n.key,n.offset-1,"element")}function po(n,e,t,s,r){try{n.setBaseAndExtent(e,t,s,r)}catch{}}function ac(n,e,t,s,r,i,o){const a=s.anchorNode,l=s.focusNode,c=s.anchorOffset,u=s.focusOffset,p=document.activeElement;if(r.has(uc)&&p!==i||p!==null&&wo(p))return;if(!P(e))return void(n!==null&&Rn(t,a,l)&&s.removeAllRanges());const d=e.anchor,h=e.focus,f=d.key,m=h.key,_=et(t,f),x=et(t,m),y=d.offset,v=h.offset,b=e.format,S=e.style,N=e.isCollapsed();let E=_,w=x,C=!1;if(d.type==="text"){E=yt(_);const K=d.getNode();C=K.getFormat()!==b||K.getStyle()!==S}else P(n)&&n.anchor.type==="text"&&(C=!0);var D,F,L,A,R;if(h.type==="text"&&(w=yt(x)),E!==null&&w!==null&&(N&&(n===null||C||P(n)&&(n.format!==b||n.style!==S))&&(D=b,F=S,L=y,A=f,R=performance.now(),to=[D,F,L,A,R]),c!==y||u!==v||a!==E||l!==w||s.type==="Range"&&N||(p!==null&&i.contains(p)||i.focus({preventScroll:!0}),d.type==="element"))){if(po(s,E,y,w,v),!r.has(dc)&&e.isCollapsed()&&i!==null&&i===document.activeElement){const K=P(e)&&e.anchor.type==="element"?E.childNodes[y]||null:s.rangeCount>0?s.getRangeAt(0):null;if(K!==null){let U;if(K instanceof Text){const le=document.createRange();le.selectNode(K),U=le.getBoundingClientRect()}else U=K.getBoundingClientRect();(function(le,at,be){const Ct=Po(be),ir=Xs(Ct);if(Ct===null||ir===null)return;let{top:$n,bottom:Un}=at,en=0,tn=0,je=be;for(;je!==null;){const Jn=je===Ct.body;if(Jn)en=0,tn=fe(le).innerHeight;else{const nn=je.getBoundingClientRect();en=nn.top,tn=nn.bottom}let wt=0;if($n<en?wt=-(en-$n):Un>tn&&(wt=Un-tn),wt!==0)if(Jn)ir.scrollBy(0,wt);else{const nn=je.scrollTop;je.scrollTop+=wt;const or=je.scrollTop-nn;$n-=or,Un-=or}if(Jn)break;je=Xt(je)}})(t,U,i)}}Ns=!0}}function vu(n){let e=B()||St();e===null&&(e=oe().selectEnd()),e.insertNodes(n)}function ts(n){let e=n;n.isCollapsed()||e.removeText();const t=B();P(t)&&(e=t),P(e)||T(161);const s=e.anchor;let r=s.getNode(),i=s.offset;for(;!Pe(r);){const o=r;if([r,i]=lc(r,i),o.is(r))break}return i}function lc(n,e){const t=n.getParent();if(!t){const r=Fe();return oe().append(r),r.select(),[oe(),0]}if(M(n)){const r=n.splitText(e);if(r.length===0)return[t,n.getIndexWithinParent()];const i=e===0?0:1;return[t,r[0].getIndexWithinParent()+i]}if(!k(n)||e===0)return[t,n.getIndexWithinParent()];const s=n.getChildAtIndex(e);if(s){const r=new ot(ve(n.__key,e,"element"),ve(n.__key,e,"element"),0,""),i=n.insertNewAfter(r);i&&i.append(s,...s.getNextSiblings())}return[t,n.getIndexWithinParent()+1]}function Jr(n,e,t,s,r="decorators-and-blocks"){if(e==="move"&&s==="character"&&!n.isCollapsed()){const[u,p]=t===n.isBackward()?[n.focus,n.anchor]:[n.anchor,n.focus];return p.set(u.key,u.offset,u.type),!0}const i=it(n.focus,t?"previous":"next"),o=s==="lineboundary",a=e==="move";let l=i,c=r==="decorators-and-blocks";if(!$c(l)){for(const u of l){c=!1;const{origin:p}=u;if(!W(p)||p.isIsolated()||(l=u,!o||!p.isInline()))break}if(c)for(const u of Io(i).iterNodeCarets(e==="extend"?"shadowRoot":"root")){if(Te(u))u.origin.isInline()||(l=u);else{if(k(u.origin))continue;W(u.origin)&&!u.origin.isInline()&&(l=u)}break}}if(l===i)return!1;if(a&&!o&&W(l.origin)&&l.origin.isKeyboardSelectable()){const u=go();return u.add(l.origin.getKey()),ue(u),!0}return l=xe(l),a&&Ut(n.anchor,l),Ut(n.focus,l),c||!o}let H=null,Y=null,ie=!1,ns=!1,fn=0;const qr={characterData:!0,childList:!0,subtree:!0};function Vt(){return ie||H!==null&&H._readOnly}function X(){ie&&T(13)}function mo(){fn>99&&T(14)}function ze(){return H===null&&T(195,_o()),H}function $(){return Y===null&&T(196,_o()),Y}function _o(){let n=0;const e=new Set,t=_t.version;if(typeof window<"u")for(const r of document.querySelectorAll("[contenteditable]")){const i=Bn(r);if(qs(i))n++;else if(i){let o=String(i.constructor.version||"<0.17.1");o===t&&(o+=" (separately built, likely a bundler configuration issue)"),e.add(o)}}let s=` Detected on the page: ${n} compatible editor(s) with version ${t}`;return e.size&&(s+=` and incompatible editors with versions ${Array.from(e).join(", ")}`),s}function cc(){return Y}function Vr(n,e,t){const s=e.__type,r=No(n,s);let i=t.get(s);i===void 0&&(i=Array.from(r.transforms),t.set(s,i));const o=i.length;for(let a=0;a<o&&(i[a](e),e.isAttached());a++);}function Hr(n,e){return n!==void 0&&n.__key!==e&&n.isAttached()}function yo(n,e){if(!e)return;const t=n._updateTags;let s=e;Array.isArray(e)||(s=[e]);for(const r of s)t.add(r)}function bu(n){return $s(n,$()._nodes)}function $s(n,e){const t=n.type,s=e.get(t);s===void 0&&T(17,t);const r=s.klass;n.type!==r.getType()&&T(18,r.name);const i=r.importJSON(n),o=n.children;if(k(i)&&Array.isArray(o))for(let a=0;a<o.length;a++){const l=$s(o[a],e);i.append(l)}return i}function Yr(n,e,t){const s=H,r=ie,i=Y;H=e,ie=!0,Y=n;try{return t()}finally{H=s,ie=r,Y=i}}function ke(n,e){const t=n._pendingEditorState,s=n._rootElement,r=n._headless||s===null;if(t===null)return;const i=n._editorState,o=i._selection,a=t._selection,l=n._dirtyType!==Ge,c=H,u=ie,p=Y,d=n._updating,h=n._observer;let f=null;if(n._pendingEditorState=null,n._editorState=t,!r&&l&&h!==null){Y=n,H=t,ie=!1,n._updating=!0;try{const N=n._dirtyType,E=n._dirtyElements,w=n._dirtyLeaves;h.disconnect(),f=Al(i,t,n,N,E,w)}catch(N){if(N instanceof Error&&n._onError(N),ns)throw N;return So(n,null,s,t),Ki(n),n._dirtyType=mt,ns=!0,ke(n,i),void(ns=!1)}finally{h.observe(s,qr),n._updating=d,H=c,ie=u,Y=p}}t._readOnly||(t._readOnly=!0);const m=n._dirtyLeaves,_=n._dirtyElements,x=n._normalizedNodes,y=n._updateTags,v=n._deferred;l&&(n._dirtyType=Ge,n._cloneNotNeeded.clear(),n._dirtyLeaves=new Set,n._dirtyElements=new Map,n._normalizedNodes=new Set,n._updateTags=new Set),(function(N,E){const w=N._decorators;let C=N._pendingDecorators||w;const D=E._nodeMap;let F;for(F in C)D.has(F)||(C===w&&(C=Eo(N)),delete C[F])})(n,t);const b=r?null:Oe(fe(n));if(n._editable&&b!==null&&(l||a===null||a.dirty)&&s!==null&&!y.has(fc)){Y=n,H=t;try{if(h!==null&&h.disconnect(),l||a===null||a.dirty){const N=n._blockCursorElement;N!==null&&Es(N,n,s),ac(o,a,n,b,y,s)}(function(N,E,w){let C=N._blockCursorElement;if(P(w)&&w.isCollapsed()&&w.anchor.type==="element"&&E.contains(document.activeElement)){const D=w.anchor,F=D.getNode(),L=D.offset;let A=!1,R=null;if(L===F.getChildrenSize())is(F.getChildAtIndex(L-1))&&(A=!0);else{const K=F.getChildAtIndex(L);if(K!==null&&is(K)){const U=K.getPreviousSibling();(U===null||is(U))&&(A=!0,R=N.getElementByKey(K.__key))}}if(A){const K=N.getElementByKey(F.__key);return C===null&&(N._blockCursorElement=C=(function(U){const le=U.theme,at=document.createElement("div");at.contentEditable="false",at.setAttribute("data-lexical-cursor","true");let be=le.blockCursor;if(be!==void 0){if(typeof be=="string"){const Ct=Ii(be);be=le.blockCursor=Ct}be!==void 0&&at.classList.add(...be)}return at})(N._config)),E.style.caretColor="transparent",void(R===null?K.appendChild(C):K.insertBefore(C,R))}}C!==null&&Es(C,N,E)})(n,s,a)}finally{h!==null&&h.observe(s,qr),Y=p,H=c}}f!==null&&(function(N,E,w,C,D){const F=Array.from(N._listeners.mutation),L=F.length;for(let A=0;A<L;A++){const[R,K]=F[A];for(const U of K){const le=E.get(U);le!==void 0&&R(le,{dirtyLeaves:C,prevEditorState:D,updateTags:w})}}})(n,f,y,m,i),P(a)||a===null||o!==null&&o.is(a)||n.dispatchCommand(Vi,void 0);const S=n._pendingDecorators;S!==null&&(n._decorators=S,n._pendingDecorators=null,Dt("decorator",n,!0,S)),(function(N,E,w){const C=ei(E),D=ei(w);C!==D&&Dt("textcontent",N,!0,D)})(n,e||i,t),Dt("update",n,!0,{dirtyElements:_,dirtyLeaves:m,editorState:t,mutatedNodes:f,normalizedNodes:x,prevEditorState:e||i,tags:y}),(function(N,E){if(N._deferred=[],E.length!==0){const w=N._updating;N._updating=!0;try{for(let C=0;C<E.length;C++)E[C]()}finally{N._updating=w}}})(n,v),(function(N){const E=N._updates;if(E.length!==0){const w=E.shift();if(w){const[C,D]=w;Fn(N,C,D)}}})(n)}function Dt(n,e,t,...s){const r=e._updating;e._updating=t;try{const i=Array.from(e._listeners[n]);for(let o=0;o<i.length;o++)i[o].apply(null,s)}finally{e._updating=r}}function Gr(n,e){const t=n._updates;let s=e||!1;for(;t.length!==0;){const r=t.shift();if(r){const[i,o]=r,a=n._pendingEditorState;let l;o!==void 0&&(l=o.onUpdate,o.skipTransforms&&(s=!0),o.discrete&&(a===null&&T(191),a._flushSync=!0),l&&n._deferred.push(l),yo(n,o.tag)),a==null?Fn(n,i,o):i()}}return s}function Fn(n,e,t){const s=n._updateTags;let r,i=!1,o=!1;t!==void 0&&(r=t.onUpdate,yo(n,t.tag),i=t.skipTransforms||!1,o=t.discrete||!1),r&&n._deferred.push(r);const a=n._editorState;let l=n._pendingEditorState,c=!1;(l===null||l._readOnly)&&(l=n._pendingEditorState=vo(l||a),c=!0),l._flushSync=o;const u=H,p=ie,d=Y,h=n._updating;H=l,ie=!1,n._updating=!0,Y=n;const f=n._headless||n.getRootElement()===null;Js(null);try{c&&(f?a._selection!==null&&(l._selection=a._selection.clone()):l._selection=(function(y,v){const b=y.getEditorState()._selection,S=Oe(fe(y));return P(b)||b==null?Ws(b,S,y,v):b.clone()})(n,t&&t.event||null));const _=n._compositionKey;e(),i=Gr(n,i),(function(y,v){const b=v.getEditorState()._selection,S=y._selection;if(P(S)){const N=S.anchor,E=S.focus;let w;if(N.type==="text"&&(w=N.getNode(),w.selectionTransform(b,S)),E.type==="text"){const C=E.getNode();w!==C&&C.selectionTransform(b,S)}}})(l,n),n._dirtyType!==Ge&&(i?(function(y,v){const b=v._dirtyLeaves,S=y._nodeMap;for(const N of b){const E=S.get(N);M(E)&&E.isAttached()&&E.isSimpleText()&&!E.isUnmergeable()&&Nr(E)}})(l,n):(function(y,v){const b=v._dirtyLeaves,S=v._dirtyElements,N=y._nodeMap,E=Le(),w=new Map;let C=b,D=C.size,F=S,L=F.size;for(;D>0||L>0;){if(D>0){v._dirtyLeaves=new Set;for(const A of C){const R=N.get(A);M(R)&&R.isAttached()&&R.isSimpleText()&&!R.isUnmergeable()&&Nr(R),R!==void 0&&Hr(R,E)&&Vr(v,R,w),b.add(A)}if(C=v._dirtyLeaves,D=C.size,D>0){fn++;continue}}v._dirtyLeaves=new Set,v._dirtyElements=new Map,F.delete("root")&&F.set("root",!0);for(const A of F){const R=A[0],K=A[1];if(S.set(R,K),!K)continue;const U=N.get(R);U!==void 0&&Hr(U,E)&&Vr(v,U,w)}C=v._dirtyLeaves,D=C.size,F=v._dirtyElements,L=F.size,fn++}v._dirtyLeaves=b,v._dirtyElements=S})(l,n),Gr(n),(function(y,v,b,S){const N=y._nodeMap,E=v._nodeMap,w=[];for(const[C]of S){const D=E.get(C);D!==void 0&&(D.isAttached()||(k(D)&&Ri(D,C,N,E,w,S),N.has(C)||S.delete(C),w.push(C)))}for(const C of w)E.delete(C);for(const C of b){const D=E.get(C);D===void 0||D.isAttached()||(N.has(C)||b.delete(C),E.delete(C))}})(a,l,n._dirtyLeaves,n._dirtyElements)),_!==n._compositionKey&&(l._flushSync=!0);const x=l._selection;if(P(x)){const y=l._nodeMap,v=x.anchor.key,b=x.focus.key;y.get(v)!==void 0&&y.get(b)!==void 0||T(19)}else Ks(x)&&x._nodes.size===0&&(l._selection=null)}catch(_){return _ instanceof Error&&n._onError(_),n._pendingEditorState=a,n._dirtyType=mt,n._cloneNotNeeded.clear(),n._dirtyLeaves=new Set,n._dirtyElements.clear(),void ke(n)}finally{H=u,ie=p,Y=d,n._updating=h,fn=0}n._dirtyType!==Ge||n._deferred.length>0||(function(_,x){const y=x.getEditorState()._selection,v=_._selection;if(v!==null){if(v.dirty||!v.is(y))return!0}else if(y!==null)return!0;return!1})(l,n)?l._flushSync?(l._flushSync=!1,ke(n)):c&&_c((()=>{ke(n)})):(l._flushSync=!1,c&&(s.clear(),n._deferred=[],n._pendingEditorState=null))}function ce(n,e,t){Y===n&&t===void 0?e():Fn(n,e,t)}class Pt{element;before;after;constructor(e,t,s){this.element=e,this.before=t||null,this.after=s||null}withBefore(e){return new Pt(this.element,e,this.after)}withAfter(e){return new Pt(this.element,this.before,e)}withElement(e){return this.element===e?this:new Pt(e,this.before,this.after)}insertChild(e){const t=this.before||this.getManagedLineBreak();return t!==null&&t.parentElement!==this.element&&T(222),this.element.insertBefore(e,t),this}removeChild(e){return e.parentElement!==this.element&&T(223),this.element.removeChild(e),this}replaceChild(e,t){return t.parentElement!==this.element&&T(224),this.element.replaceChild(e,t),this}getFirstChild(){const e=this.after?this.after.nextSibling:this.element.firstChild;return e===this.before||e===this.getManagedLineBreak()?null:e}getManagedLineBreak(){return this.element.__lexicalLineBreak||null}setManagedLineBreak(e){if(e===null)this.removeManagedLineBreak();else{const t=e==="decorator"&&(Bt||pt||Rt);this.insertManagedLineBreak(t)}}removeManagedLineBreak(){const e=this.getManagedLineBreak();if(e){const t=this.element,s=e.nodeName==="IMG"?e.nextSibling:null;s&&t.removeChild(s),t.removeChild(e),t.__lexicalLineBreak=void 0}}insertManagedLineBreak(e){const t=this.getManagedLineBreak();if(t){if(e===(t.nodeName==="IMG"))return;this.removeManagedLineBreak()}const s=this.element,r=this.before,i=document.createElement("br");if(s.insertBefore(i,r),e){const o=document.createElement("img");o.setAttribute("data-lexical-linebreak","true"),o.style.cssText="display: inline !important; border: 0px !important; margin: 0px !important;",o.alt="",s.insertBefore(o,i),s.__lexicalLineBreak=o}else s.__lexicalLineBreak=i}getFirstChildOffset(){let e=0;for(let t=this.after;t!==null;t=t.previousSibling)e++;return e}resolveChildIndex(e,t,s,r){if(s===this.element){const l=this.getFirstChildOffset();return[e,Math.min(l+e.getChildrenSize(),Math.max(l,r))]}const i=Qr(t,s);i.push(r);const o=Qr(t,this.element);let a=e.getIndexWithinParent();for(let l=0;l<o.length;l++){const c=i[l],u=o[l];if(c===void 0||c<u)break;if(c>u){a+=1;break}}return[e.getParentOrThrow(),a]}}function Qr(n,e){const t=[];let s=e;for(;s!==n&&s!==null;s=s.parentNode){let r=0;for(let i=s.previousSibling;i!==null;i=i.previousSibling)r++;t.push(r)}return s!==n&&T(225),t.reverse()}class Ht extends Ie{__first;__last;__size;__format;__style;__indent;__dir;__textFormat;__textStyle;constructor(e){super(e),this.__first=null,this.__last=null,this.__size=0,this.__format=0,this.__style="",this.__indent=0,this.__dir=null,this.__textFormat=0,this.__textStyle=""}afterCloneFrom(e){super.afterCloneFrom(e),this.__key===e.__key&&(this.__first=e.__first,this.__last=e.__last,this.__size=e.__size),this.__indent=e.__indent,this.__format=e.__format,this.__style=e.__style,this.__dir=e.__dir,this.__textFormat=e.__textFormat,this.__textStyle=e.__textStyle}getFormat(){return this.getLatest().__format}getFormatType(){const e=this.getFormat();return yl[e]||""}getStyle(){return this.getLatest().__style}getIndent(){return this.getLatest().__indent}getChildren(){const e=[];let t=this.getFirstChild();for(;t!==null;)e.push(t),t=t.getNextSibling();return e}getChildrenKeys(){const e=[];let t=this.getFirstChild();for(;t!==null;)e.push(t.__key),t=t.getNextSibling();return e}getChildrenSize(){return this.getLatest().__size}isEmpty(){return this.getChildrenSize()===0}isDirty(){const e=$()._dirtyElements;return e!==null&&e.has(this.__key)}isLastChild(){const e=this.getLatest(),t=this.getParentOrThrow().getLastChild();return t!==null&&t.is(e)}getAllTextNodes(){const e=[];let t=this.getFirstChild();for(;t!==null;){if(M(t)&&e.push(t),k(t)){const s=t.getAllTextNodes();e.push(...s)}t=t.getNextSibling()}return e}getFirstDescendant(){let e=this.getFirstChild();for(;k(e);){const t=e.getFirstChild();if(t===null)break;e=t}return e}getLastDescendant(){let e=this.getLastChild();for(;k(e);){const t=e.getLastChild();if(t===null)break;e=t}return e}getDescendantByIndex(e){const t=this.getChildren(),s=t.length;if(e>=s){const i=t[s-1];return k(i)&&i.getLastDescendant()||i||null}const r=t[e];return k(r)&&r.getFirstDescendant()||r||null}getFirstChild(){const e=this.getLatest().__first;return e===null?null:G(e)}getFirstChildOrThrow(){const e=this.getFirstChild();return e===null&&T(45,this.__key),e}getLastChild(){const e=this.getLatest().__last;return e===null?null:G(e)}getLastChildOrThrow(){const e=this.getLastChild();return e===null&&T(96,this.__key),e}getChildAtIndex(e){const t=this.getChildrenSize();let s,r;if(e<t/2){for(s=this.getFirstChild(),r=0;s!==null&&r<=e;){if(r===e)return s;s=s.getNextSibling(),r++}return null}for(s=this.getLastChild(),r=t-1;s!==null&&r>=e;){if(r===e)return s;s=s.getPreviousSibling(),r--}return null}getTextContent(){let e="";const t=this.getChildren(),s=t.length;for(let r=0;r<s;r++){const i=t[r];e+=i.getTextContent(),k(i)&&r!==s-1&&!i.isInline()&&(e+=Ee)}return e}getTextContentSize(){let e=0;const t=this.getChildren(),s=t.length;for(let r=0;r<s;r++){const i=t[r];e+=i.getTextContentSize(),k(i)&&r!==s-1&&!i.isInline()&&(e+=Ee.length)}return e}getDirection(){return this.getLatest().__dir}getTextFormat(){return this.getLatest().__textFormat}hasFormat(e){if(e!==""){const t=pr[e];return!!(this.getFormat()&t)}return!1}hasTextFormat(e){const t=Qe[e];return!!(this.getTextFormat()&t)}getFormatFlags(e,t){return Mn(this.getLatest().__textFormat,e,t)}getTextStyle(){return this.getLatest().__textStyle}select(e,t){X();const s=B();let r=e,i=t;const o=this.getChildrenSize();if(!this.canBeEmpty()){if(e===0&&t===0){const l=this.getFirstChild();if(M(l)||k(l))return l.select(0,0)}else if(!(e!==void 0&&e!==o||t!==void 0&&t!==o)){const l=this.getLastChild();if(M(l)||k(l))return l.select()}}r===void 0&&(r=o),i===void 0&&(i=o);const a=this.__key;return P(s)?(s.anchor.set(a,r,"element"),s.focus.set(a,i,"element"),s.dirty=!0,s):ho(a,r,a,i,"element","element")}selectStart(){const e=this.getFirstDescendant();return e?e.selectStart():this.select()}selectEnd(){const e=this.getLastDescendant();return e?e.selectEnd():this.select()}clear(){const e=this.getWritable();return this.getChildren().forEach((t=>t.remove())),e}append(...e){return this.splice(this.getChildrenSize(),0,e)}setDirection(e){const t=this.getWritable();return t.__dir=e,t}setFormat(e){return this.getWritable().__format=e!==""?pr[e]:0,this}setStyle(e){return this.getWritable().__style=e||"",this}setTextFormat(e){const t=this.getWritable();return t.__textFormat=e,t}setTextStyle(e){const t=this.getWritable();return t.__textStyle=e,t}setIndent(e){return this.getWritable().__indent=e,this}splice(e,t,s){const r=s.length,i=this.getChildrenSize(),o=this.getWritable();e+t<=i||T(226,String(e),String(t),String(i));const a=o.__key,l=[],c=[],u=this.getChildAtIndex(e+t);let p=null,d=i-t+r;if(e!==0)if(e===i)p=this.getLastChild();else{const f=this.getChildAtIndex(e);f!==null&&(p=f.getPreviousSibling())}if(t>0){let f=p===null?this.getFirstChild():p.getNextSibling();for(let m=0;m<t;m++){f===null&&T(100);const _=f.getNextSibling(),x=f.__key;Ve(f.getWritable()),c.push(x),f=_}}let h=p;for(let f=0;f<r;f++){const m=s[f];h!==null&&m.is(h)&&(p=h=h.getPreviousSibling());const _=m.getWritable();_.__parent===a&&d--,Ve(_);const x=m.__key;if(h===null)o.__first=x,_.__prev=null;else{const y=h.getWritable();y.__next=x,_.__prev=y.__key}m.__key===a&&T(76),_.__parent=a,l.push(x),h=m}if(e+t===i)h!==null&&(h.getWritable().__next=null,o.__last=h.__key);else if(u!==null){const f=u.getWritable();if(h!==null){const m=h.getWritable();f.__prev=h.__key,m.__next=u.__key}else f.__prev=null}if(o.__size=d,c.length){const f=B();if(P(f)){const m=new Set(c),_=new Set(l),{anchor:x,focus:y}=f;Xr(x,m,_)&&jn(x,x.getNode(),this,p,u),Xr(y,m,_)&&jn(y,y.getNode(),this,p,u),d!==0||this.canBeEmpty()||Ke(this)||this.remove()}}return o}getDOMSlot(e){return new Pt(e)}exportDOM(e){const{element:t}=super.exportDOM(e);if(ae(t)){const s=this.getIndent();s>0&&(t.style.paddingInlineStart=40*s+"px");const r=this.getDirection();r&&(t.dir=r)}return{element:t}}exportJSON(){const e={children:[],direction:this.getDirection(),format:this.getFormatType(),indent:this.getIndent(),...super.exportJSON()},t=this.getTextFormat(),s=this.getTextStyle();return t!==0&&(e.textFormat=t),s!==""&&(e.textStyle=s),e}updateFromJSON(e){return super.updateFromJSON(e).setFormat(e.format).setIndent(e.indent).setDirection(e.direction).setTextFormat(e.textFormat||0).setTextStyle(e.textStyle||"")}insertNewAfter(e,t){return null}canIndent(){return!0}collapseAtStart(e){return!1}excludeFromCopy(e){return!1}canReplaceWith(e){return!0}canInsertAfter(e){return!0}canBeEmpty(){return!0}canInsertTextBefore(){return!0}canInsertTextAfter(){return!0}isInline(){return!1}isShadowRoot(){return!1}canMergeWith(e){return!1}extractWithChild(e,t,s){return!1}canMergeWhenEmpty(){return!1}reconcileObservedMutation(e,t){const s=this.getDOMSlot(e);let r=s.getFirstChild();for(let i=this.getFirstChild();i;i=i.getNextSibling()){const o=t.getElementByKey(i.getKey());o!==null&&(r==null?(s.insertChild(o),r=o):r!==o&&s.replaceChild(o,r),r=r.nextSibling)}}}function k(n){return n instanceof Ht}function Xr(n,e,t){let s=n.getNode();for(;s;){const r=s.__key;if(e.has(r)&&!t.has(r))return!0;s=s.getParent()}return!1}class xo extends Ie{decorate(e,t){return null}isIsolated(){return!1}isInline(){return!0}isKeyboardSelectable(){return!0}}function W(n){return n instanceof xo}class Yt extends Ht{__cachedText;static getType(){return"root"}static clone(){return new Yt}constructor(){super("root"),this.__cachedText=null}getTopLevelElementOrThrow(){T(51)}getTextContent(){const e=this.__cachedText;return!Vt()&&$()._dirtyType!==Ge||e===null?super.getTextContent():e}remove(){T(52)}replace(e){T(53)}insertBefore(e){T(54)}insertAfter(e){T(55)}updateDOM(e,t){return!1}splice(e,t,s){for(const r of s)k(r)||W(r)||T(282);return super.splice(e,t,s)}static importJSON(e){return oe().updateFromJSON(e)}collapseAtStart(){return!0}}function ee(n){return n instanceof Yt}function vo(n){return new Gt(new Map(n._nodeMap))}function Us(){return new Gt(new Map([["root",new Yt]]))}function bo(n){const e=n.exportJSON(),t=n.constructor;if(e.type!==t.getType()&&T(130,t.name),k(n)){const s=e.children;Array.isArray(s)||T(59,t.name);const r=n.getChildren();for(let i=0;i<r.length;i++){const o=bo(r[i]);s.push(o)}}return e}function Su(n){return n instanceof Gt}class Gt{_nodeMap;_selection;_flushSync;_readOnly;constructor(e,t){this._nodeMap=e,this._selection=t||null,this._flushSync=!1,this._readOnly=!1}isEmpty(){return this._nodeMap.size===1&&this._selection===null}read(e,t){return Yr(t&&t.editor||null,this,e)}clone(e){const t=new Gt(this._nodeMap,e===void 0?this._selection:e);return t._readOnly=!0,t}toJSON(){return Yr(null,this,(()=>({root:bo(oe())})))}}const Nu="historic",Cu="history-push",ss="history-merge",wu="paste",uc="collaboration",dc="skip-scroll-into-view",fc="skip-dom-selection";class hc extends Ht{static getType(){return"artificial"}createDOM(e){return document.createElement("div")}}class Qt extends Ht{static getType(){return"paragraph"}static clone(e){return new Qt(e.__key)}createDOM(e){const t=document.createElement("p"),s=gt(e.theme,"paragraph");return s!==void 0&&t.classList.add(...s),t}updateDOM(e,t,s){return!1}static importDOM(){return{p:e=>({conversion:gc,priority:0})}}exportDOM(e){const{element:t}=super.exportDOM(e);if(ae(t)){this.isEmpty()&&t.append(document.createElement("br"));const s=this.getFormatType();s&&(t.style.textAlign=s)}return{element:t}}static importJSON(e){return Fe().updateFromJSON(e)}exportJSON(){return{...super.exportJSON(),textFormat:this.getTextFormat(),textStyle:this.getTextStyle()}}insertNewAfter(e,t){const s=Fe();s.setTextFormat(e.format),s.setTextStyle(e.style);const r=this.getDirection();return s.setDirection(r),s.setFormat(this.getFormatType()),s.setStyle(this.getStyle()),this.insertAfter(s,t),s}collapseAtStart(){const e=this.getChildren();if(e.length===0||M(e[0])&&e[0].getTextContent().trim()===""){if(this.getNextSibling()!==null)return this.selectNext(),this.remove(),!0;if(this.getPreviousSibling()!==null)return this.selectPrevious(),this.remove(),!0}return!1}}function gc(n){const e=Fe();return n.style&&(e.setFormat(n.style.textAlign),jc(n,e)),{node:e}}function Fe(){return Wn(new Qt)}function pc(n){return n instanceof Qt}const ku=0,Tu=1,Eu=4;function So(n,e,t,s){const r=n._keyToDOMMap;r.clear(),n._editorState=Us(),n._pendingEditorState=s,n._compositionKey=null,n._dirtyType=Ge,n._cloneNotNeeded.clear(),n._dirtyLeaves=new Set,n._dirtyElements.clear(),n._normalizedNodes=new Set,n._updateTags=new Set,n._updates=[],n._blockCursorElement=null;const i=n._observer;i!==null&&(i.disconnect(),n._observer=null),e!==null&&(e.textContent=""),t!==null&&(t.textContent="",r.set("root",t))}function Ou(n){const e=n||{},t=cc(),s=e.theme||{},r=n===void 0?t:e.parentEditor||null,i=e.disableEvents||!1,o=Us(),a=e.namespace||(r!==null?r._config.namespace:jo()),l=e.editorState,c=[Yt,bt,Jt,qt,Qt,hc,...e.nodes||[]],{onError:u,html:p}=e,d=e.editable===void 0||e.editable;let h;if(n===void 0&&t!==null)h=t._nodes;else{h=new Map;for(let m=0;m<c.length;m++){let _=c[m],x=null,y=null;if(typeof _!="function"){const E=_;_=E.replace,x=E.with,y=E.withKlass||null}const{ownNodeConfig:v}=Zs(_),b=_.getType(),S=_.transform(),N=new Set;v&&v.$transform&&N.add(v.$transform),S!==null&&N.add(S),h.set(b,{exportDOM:p&&p.export?p.export.get(_):void 0,klass:_,replace:x,replaceWithKlass:y,sharedNodeState:kl(c[m]),transforms:N})}}const f=new _t(o,r,h,{disableEvents:i,namespace:a,theme:s},u||console.error,(function(m,_){const x=new Map,y=new Set,v=b=>{Object.keys(b).forEach((S=>{let N=x.get(S);N===void 0&&(N=[],x.set(S,N)),N.push(b[S])}))};return m.forEach((b=>{const S=b.klass.importDOM;if(S==null||y.has(S))return;y.add(S);const N=S.call(b.klass);N!==null&&v(N)})),_&&v(_),x})(h,p?p.import:void 0),d,n);return l!==void 0&&(f._pendingEditorState=l,f._dirtyType=mt),f}class _t{static version;_headless;_parentEditor;_rootElement;_editorState;_pendingEditorState;_compositionKey;_deferred;_keyToDOMMap;_updates;_updating;_listeners;_commands;_nodes;_decorators;_pendingDecorators;_config;_dirtyType;_cloneNotNeeded;_dirtyLeaves;_dirtyElements;_normalizedNodes;_updateTags;_observer;_key;_onError;_htmlConversions;_window;_editable;_blockCursorElement;_createEditorArgs;constructor(e,t,s,r,i,o,a,l){this._createEditorArgs=l,this._parentEditor=t,this._rootElement=null,this._editorState=e,this._pendingEditorState=null,this._compositionKey=null,this._deferred=[],this._keyToDOMMap=new Map,this._updates=[],this._updating=!1,this._listeners={decorator:new Set,editable:new Set,mutation:new Map,root:new Set,textcontent:new Set,update:new Set},this._commands=new Map,this._config=r,this._nodes=s,this._decorators={},this._pendingDecorators=null,this._dirtyType=Ge,this._cloneNotNeeded=new Set,this._dirtyLeaves=new Set,this._dirtyElements=new Map,this._normalizedNodes=new Set,this._updateTags=new Set,this._observer=null,this._key=jo(),this._onError=i,this._htmlConversions=o,this._editable=a,this._headless=t!==null&&t._headless,this._window=null,this._blockCursorElement=null}isComposing(){return this._compositionKey!=null}registerUpdateListener(e){const t=this._listeners.update;return t.add(e),()=>{t.delete(e)}}registerEditableListener(e){const t=this._listeners.editable;return t.add(e),()=>{t.delete(e)}}registerDecoratorListener(e){const t=this._listeners.decorator;return t.add(e),()=>{t.delete(e)}}registerTextContentListener(e){const t=this._listeners.textcontent;return t.add(e),()=>{t.delete(e)}}registerRootListener(e){const t=this._listeners.root;return e(this._rootElement,null),t.add(e),()=>{e(null,this._rootElement),t.delete(e)}}registerCommand(e,t,s){s===void 0&&T(35);const r=this._commands;r.has(e)||r.set(e,[new Set,new Set,new Set,new Set,new Set]);const i=r.get(e);i===void 0&&T(36,String(e));const o=i[s];return o.add(t),()=>{o.delete(t),i.every((a=>a.size===0))&&r.delete(e)}}registerMutationListener(e,t,s){const r=this.resolveRegisteredNodeAfterReplacements(this.getRegisteredNode(e)).klass,i=this._listeners.mutation;let o=i.get(t);o===void 0&&(o=new Set,i.set(t,o)),o.add(r);const a=s&&s.skipInitialization;return a!==void 0&&a||this.initializeMutationListener(t,r),()=>{o.delete(r),o.size===0&&i.delete(t)}}getRegisteredNode(e){const t=this._nodes.get(e.getType());return t===void 0&&T(37,e.name),t}resolveRegisteredNodeAfterReplacements(e){for(;e.replaceWithKlass;)e=this.getRegisteredNode(e.replaceWithKlass);return e}initializeMutationListener(e,t){const s=this._editorState,r=li(s).get(t.getType());if(!r)return;const i=new Map;for(const o of r.keys())i.set(o,"created");i.size>0&&e(i,{dirtyLeaves:new Set,prevEditorState:s,updateTags:new Set(["registerMutationListener"])})}registerNodeTransformToKlass(e,t){const s=this.getRegisteredNode(e);return s.transforms.add(t),s}registerNodeTransform(e,t){const s=this.registerNodeTransformToKlass(e,t),r=[s],i=s.replaceWithKlass;if(i!=null){const o=this.registerNodeTransformToKlass(i,t);r.push(o)}return(function(o,a){const l=li(o.getEditorState()),c=[];for(const u of a){const p=l.get(u);p&&c.push(p)}c.length!==0&&o.update((()=>{for(const u of c)for(const p of u.keys()){const d=G(p);d&&d.markDirty()}}),o._pendingEditorState===null?{tag:ss}:void 0)})(this,r.map((o=>o.klass.getType()))),()=>{r.forEach((o=>o.transforms.delete(t)))}}hasNode(e){return this._nodes.has(e.getType())}hasNodes(e){return e.every(this.hasNode.bind(this))}dispatchCommand(e,t){return O(this,e,t)}getDecorators(){return this._decorators}getRootElement(){return this._rootElement}getKey(){return this._key}setRootElement(e){const t=this._rootElement;if(e!==t){const s=gt(this._config.theme,"root"),r=this._pendingEditorState||this._editorState;if(this._rootElement=e,So(this,t,e,r),t!==null&&(this._config.disableEvents||Ql(t),s!=null&&t.classList.remove(...s)),e!==null){const i=Xs(e),o=e.style;o.userSelect="text",o.whiteSpace="pre-wrap",o.wordBreak="break-word",e.setAttribute("data-lexical-editor","true"),this._window=i,this._dirtyType=mt,Ki(this),this._updateTags.add(ss),ke(this),this._config.disableEvents||(function(a,l){const c=a.ownerDocument,u=On.get(c);(u===void 0||u<1)&&c.addEventListener("selectionchange",oo),On.set(c,(u||0)+1),a.__lexicalEditor=l;const p=io(a);for(let d=0;d<Ss.length;d++){const[h,f]=Ss[d],m=typeof f=="function"?_=>{Mr(_)||(jr(_),(l.isEditable()||h==="click")&&f(_,l))}:_=>{if(Mr(_))return;jr(_);const x=l.isEditable();switch(h){case"cut":return x&&O(l,Xi,_);case"copy":return O(l,Qi,_);case"paste":return x&&O(l,Hi,_);case"dragstart":return x&&O(l,Jl,_);case"dragover":return x&&O(l,ql,_);case"dragend":return x&&O(l,Vl,_);case"focus":return x&&O(l,Hl,_);case"blur":return x&&O(l,Yl,_);case"drop":return x&&O(l,Ul,_)}};a.addEventListener(h,m),p.push((()=>{a.removeEventListener(h,m)}))}})(e,this),s!=null&&e.classList.add(...s)}else this._window=null,this._updateTags.add(ss),ke(this);Dt("root",this,!1,e,t)}}getElementByKey(e){return this._keyToDOMMap.get(e)||null}getEditorState(){return this._editorState}setEditorState(e,t){e.isEmpty()&&T(38);let s=e;s._readOnly&&(s=vo(e),s._selection=e._selection?e._selection.clone():null),zi(this);const r=this._pendingEditorState,i=this._updateTags,o=t!==void 0?t.tag:null;r===null||r.isEmpty()||(o!=null&&i.add(o),ke(this)),this._pendingEditorState=s,this._dirtyType=mt,this._dirtyElements.set("root",!1),this._compositionKey=null,o!=null&&i.add(o),this._updating||ke(this)}parseEditorState(e,t){return(function(s,r,i){const o=Us(),a=H,l=ie,c=Y,u=r._dirtyElements,p=r._dirtyLeaves,d=r._cloneNotNeeded,h=r._dirtyType;r._dirtyElements=new Map,r._dirtyLeaves=new Set,r._cloneNotNeeded=new Set,r._dirtyType=0,H=o,ie=!1,Y=r,Js(null);try{const f=r._nodes;$s(s.root,f),i&&i(),o._readOnly=!0}catch(f){f instanceof Error&&r._onError(f)}finally{r._dirtyElements=u,r._dirtyLeaves=p,r._cloneNotNeeded=d,r._dirtyType=h,H=a,ie=l,Y=c}return o})(typeof e=="string"?JSON.parse(e):e,this,t)}read(e){return ke(this),this.getEditorState().read(e,{editor:this})}update(e,t){(function(s,r,i){s._updating?s._updates.push([r,i]):Fn(s,r,i)})(this,e,t)}focus(e,t={}){const s=this._rootElement;s!==null&&(s.setAttribute("autocapitalize","off"),ce(this,(()=>{const r=B(),i=oe();r!==null?r.dirty||ue(r.clone()):i.getChildrenSize()!==0&&(t.defaultSelection==="rootStart"?i.selectStart():i.selectEnd()),Sc("focus"),Nc((()=>{s.removeAttribute("autocapitalize"),e&&e()}))})),this._pendingEditorState===null&&s.removeAttribute("autocapitalize"))}blur(){const e=this._rootElement;e!==null&&e.blur();const t=Oe(this._window);t!==null&&t.removeAllRanges()}isEditable(){return this._editable}setEditable(e){this._editable!==e&&(this._editable=e,Dt("editable",this,!0,e))}toJSON(){return{editorState:this._editorState.toJSON()}}}_t.version="0.36.1+prod.esm";let ks=null;function Js(n){ks=n}let mc=1;function No(n,e){const t=Co(n,e);return t===void 0&&T(30,e),t}function Co(n,e){return n._nodes.get(e)}const _c=typeof queueMicrotask=="function"?queueMicrotask:n=>{Promise.resolve().then(n)};function Zr(n){return W(Vs(n))}function wo(n){const e=document.activeElement;if(!ae(e))return!1;const t=e.nodeName;return W(Vs(n))&&(t==="INPUT"||t==="TEXTAREA"||e.contentEditable==="true"&&Bn(e)==null)}function Rn(n,e,t){const s=n.getRootElement();try{return s!==null&&s.contains(e)&&s.contains(t)&&e!==null&&!wo(e)&&ko(e)===n}catch{return!1}}function qs(n){return n instanceof _t}function ko(n){let e=n;for(;e!=null;){const t=Bn(e);if(qs(t))return t;e=Xt(e)}return null}function Bn(n){return n?n.__lexicalEditor:null}function qe(n){return co(n)||n.isToken()}function De(n){return qe(n)||n.isSegmented()}function Ae(n){return Zt(n)&&n.nodeType===cl}function yc(n){return Zt(n)&&n.nodeType===ul}function yt(n){let e=n;for(;e!=null;){if(Ae(e))return e;e=e.firstChild}return null}function Mn(n,e,t){const s=Qe[e];if(t!==null&&(n&s)==(t&s))return n;let r=n^s;return e==="subscript"?r&=-65:e==="superscript"?r&=-33:e==="lowercase"?(r&=-513,r&=-1025):e==="uppercase"?(r&=-257,r&=-1025):e==="capitalize"&&(r&=-257,r&=-513),r}function Au(n){return M(n)||ht(n)||W(n)}function xc(n,e){const t=(function(){const o=ks;return ks=null,o})();if((e=e||t&&t.__key)!=null)return void(n.__key=e);X(),mo();const s=$(),r=ze(),i=""+mc++;r._nodeMap.set(i,n),k(n)?s._dirtyElements.set(i,!0):s._dirtyLeaves.add(i),s._cloneNotNeeded.add(i),s._dirtyType=Fi,n.__key=i}function Ve(n){const e=n.getParent();if(e!==null){const t=n.getWritable(),s=e.getWritable(),r=n.getPreviousSibling(),i=n.getNextSibling(),o=i!==null?i.__key:null,a=r!==null?r.__key:null,l=r!==null?r.getWritable():null,c=i!==null?i.getWritable():null;r===null&&(s.__first=o),i===null&&(s.__last=a),l!==null&&(l.__next=o),c!==null&&(c.__prev=a),t.__prev=null,t.__next=null,t.__parent=null,s.__size--}}function Dn(n){mo();const e=n.getLatest(),t=e.__parent,s=ze(),r=$(),i=s._nodeMap,o=r._dirtyElements;t!==null&&(function(l,c,u){let p=l;for(;p!==null;){if(u.has(p))return;const d=c.get(p);if(d===void 0)break;u.set(p,!1),p=d.__parent}})(t,i,o);const a=e.__key;r._dirtyType=Fi,k(n)?o.set(a,!0):r._dirtyLeaves.add(a)}function Z(n){X();const e=$(),t=e._compositionKey;if(n!==t){if(e._compositionKey=n,t!==null){const s=G(t);s!==null&&s.getWritable()}if(n!==null){const s=G(n);s!==null&&s.getWritable()}}}function Le(){return Vt()?null:$()._compositionKey}function G(n,e){const t=(e||ze())._nodeMap.get(n);return t===void 0?null:t}function To(n,e){const t=zn(n,$());return t!==void 0?G(t,e):null}function zn(n,e){return n[`__lexicalKey_${e._key}`]}function Vs(n,e){let t=n;for(;t!=null;){const s=To(t,e);if(s!==null)return s;t=Xt(t)}return null}function Eo(n){const e=n._decorators,t=Object.assign({},e);return n._pendingDecorators=t,t}function ei(n){return n.read((()=>oe().getTextContent()))}function oe(){return Oo(ze())}function Oo(n){return n._nodeMap.get("root")}function ue(n){X();const e=ze();n!==null&&(n.dirty=!0,n.setCachedNodes(null)),e._selection=n}function dt(n){const e=$(),t=(function(s,r){let i=s;for(;i!=null;){const o=zn(i,r);if(o!==void 0)return o;i=Xt(i)}return null})(n,e);return t===null?n===e.getRootElement()?G("root"):null:G(t)}function Ao(n){return/[\uD800-\uDBFF][\uDC00-\uDFFF]/g.test(n)}function Hs(n){const e=[];let t=n;for(;t!==null;)e.push(t),t=t._parentEditor;return e}function jo(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substring(0,5)}function Mo(n){return Ae(n)?n.nodeValue:null}function Ys(n,e,t){const s=Oe(fe(e));if(s===null)return;const r=s.anchorNode;let{anchorOffset:i,focusOffset:o}=s;if(r!==null){let a=Mo(r);const l=Vs(r);if(a!==null&&M(l)){if(a===Pn&&t){const c=t.length;a=t,i=c,o=c}a!==null&&Gs(l,a,i,o,n)}}}function Gs(n,e,t,s,r){let i=n;if(i.isAttached()&&(r||!i.isDirty())){const o=i.isComposing();let a=e;(o||r)&&e[e.length-1]===Pn&&(a=e.slice(0,-1));const l=i.getTextContent();if(r||a!==l){if(a===""){if(Z(null),Rt||pt||Bt)i.remove();else{const m=$();setTimeout((()=>{m.update((()=>{i.isAttached()&&i.remove()}))}),20)}return}const c=i.getParent(),u=St(),p=i.getTextContentSize(),d=Le(),h=i.getKey();if(i.isToken()||d!==null&&h===d&&!o||P(u)&&(c!==null&&!c.canInsertTextBefore()&&u.anchor.offset===0||u.anchor.key===n.__key&&u.anchor.offset===0&&!i.canInsertTextBefore()&&!o||u.focus.key===n.__key&&u.focus.offset===p&&!i.canInsertTextAfter()&&!o))return void i.markDirty();const f=B();if(!P(f)||t===null||s===null)return void ti(i,a,f);if(f.setTextNodeRange(i,t,i,s),i.isSegmented()){const m=Q(i.getTextContent());i.replace(m),i=m}ti(i,a,f)}}}function ti(n,e,t){if(n.setTextContent(e),P(t)){const s=n.getKey();for(const r of["anchor","focus"]){const i=t[r];i.type==="text"&&i.key===s&&(i.offset=Re(n,i.offset,"clamp"))}}}function ln(n,e,t){const s=e[t]||!1;return s==="any"||s===n[t]}function vc(n,e){return ln(n,e,"altKey")&&ln(n,e,"ctrlKey")&&ln(n,e,"shiftKey")&&ln(n,e,"metaKey")}function z(n,e,t){return vc(n,t)&&n.key.toLowerCase()===e.toLowerCase()}const Ce={ctrlKey:!he,metaKey:he},ni={altKey:he,ctrlKey:!he};function si(n){return n.key==="Backspace"}function ri(n){return z(n,"a",Ce)}function ju(n){const e=oe();if(P(n)){const t=n.anchor,s=n.focus,r=t.getNode().getTopLevelElementOrThrow().getParentOrThrow();return t.set(r.getKey(),0,"element"),s.set(r.getKey(),r.getChildrenSize(),"element"),fs(n),n}{const t=e.select(0,e.getChildrenSize());return ue(fs(t)),t}}function gt(n,e){n.__lexicalClassNameCache===void 0&&(n.__lexicalClassNameCache={});const t=n.__lexicalClassNameCache,s=t[e];if(s!==void 0)return s;const r=n[e];if(typeof r=="string"){const i=Ii(r);return t[e]=i,i}return r}function Qs(n,e,t,s,r){if(t.size===0)return;const i=s.__type,o=s.__key,a=e.get(i);a===void 0&&T(33,i);const l=a.klass;let c=n.get(l);c===void 0&&(c=new Map,n.set(l,c));const u=c.get(o),p=u==="destroyed"&&r==="created";(u===void 0||p)&&c.set(o,p?"updated":r)}function ii(n,e,t){const s=n.getParent();let r=t,i=n;return s!==null&&(e&&t===0?(r=i.getIndexWithinParent(),i=s):e||t!==i.getChildrenSize()||(r=i.getIndexWithinParent()+1,i=s)),i.getChildAtIndex(e?r-1:r)}function bc(n,e){const t=n.offset;if(n.type==="element")return ii(n.getNode(),e,t);{const s=n.getNode();if(e&&t===0||!e&&t===s.getTextContentSize()){const r=e?s.getPreviousSibling():s.getNextSibling();return r===null?ii(s.getParentOrThrow(),e,s.getIndexWithinParent()+(e?0:1)):r}}return null}function Do(n){const e=fe(n).event,t=e&&e.inputType;return t==="insertFromPaste"||t==="insertFromPasteAsQuotation"}function O(n,e,t){return(function(s,r,i){const o=Hs(s);for(let a=4;a>=0;a--)for(let l=0;l<o.length;l++){const c=o[l],u=c._commands.get(r);if(u!==void 0){const p=u[a];if(p!==void 0){const d=Array.from(p),h=d.length;let f=!1;if(ce(c,(()=>{for(let m=0;m<h;m++)if(d[m](i,s))return void(f=!0)})),f)return f}}}return!1})(n,e,t)}function Kn(n){return!ee(n)&&!n.isLastChild()&&!n.isInline()}function et(n,e){const t=n._keyToDOMMap.get(e);return t===void 0&&T(75,e),t}function Xt(n){const e=n.assignedSlot||n.parentElement;return Tc(e)?e.host:e}function Po(n){return yc(n)?n:ae(n)?n.ownerDocument:null}function Sc(n){X(),$()._updateTags.add(n)}function Nc(n){X(),$()._deferred.push(n)}function Ts(n,e){let t=n.getParent();for(;t!==null;){if(t.is(e))return!0;t=t.getParent()}return!1}function Xs(n){const e=Po(n);return e?e.defaultView:null}function fe(n){const e=n._window;return e===null&&T(78),e}function Cc(n){let e=n.getParentOrThrow();for(;e!==null;){if(Ke(e))return e;e=e.getParentOrThrow()}return e}function Ke(n){return ee(n)||k(n)&&n.isShadowRoot()}function Wn(n){const e=$(),t=n.getType(),s=Co(e,t);s===void 0&&T(200,n.constructor.name,t);const{replace:r,replaceWithKlass:i}=s;if(r!==null){const o=r(n),a=o.constructor;return i!==null?o instanceof i||T(201,i.name,i.getType(),a.name,a.getType(),n.constructor.name,t):o instanceof n.constructor&&a!==n.constructor||T(202,a.name,a.getType(),n.constructor.name,t),o.__key===n.__key&&T(203,n.constructor.name,t,a.name,a.getType()),o}return n}function rs(n,e){!ee(n.getParent())||k(e)||W(e)||T(99)}function wc(n){const e=G(n);return e===null&&T(63,n),e}function is(n){return(W(n)||k(n)&&!n.canBeEmpty())&&!n.isInline()}function Es(n,e,t){t.style.removeProperty("caret-color"),e._blockCursorElement=null;const s=n.parentElement;s!==null&&s.removeChild(n)}function Oe(n){return pe?(n||window).getSelection():null}function kc(n){const e=Xs(n);return e?e.getSelection():null}function Mu(n){return ae(n)&&n.tagName==="A"}function ae(n){return Zt(n)&&n.nodeType===ll}function Zt(n){return typeof n=="object"&&n!==null&&"nodeType"in n&&typeof n.nodeType=="number"}function Tc(n){return Zt(n)&&n.nodeType===dl}function Ec(n){const e=new RegExp(/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|mark|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var|#text)$/,"i");return n.nodeName.match(e)!==null}function oi(n){const e=new RegExp(/^(address|article|aside|blockquote|canvas|dd|div|dl|dt|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hr|li|main|nav|noscript|ol|p|pre|section|table|td|tfoot|ul|video)$/,"i");return n.nodeName.match(e)!==null}function Pe(n){if(W(n)&&!n.isInline())return!0;if(!k(n)||Ke(n))return!1;const e=n.getFirstChild(),t=e===null||ht(e)||M(e)||e.isInline();return!n.isInline()&&n.canBeEmpty()!==!1&&t}function Lo(){return $()}const ai=new WeakMap,Oc=new Map;function li(n){if(!n._readOnly&&n.isEmpty())return Oc;n._readOnly||T(192);let e=ai.get(n);return e||(e=(function(t){const s=new Map;for(const[r,i]of t._nodeMap){const o=i.__type;let a=s.get(o);a||(a=new Map,s.set(o,a)),a.set(r,i)}return s})(n),ai.set(n,e)),e}function Ac(n){const e=n.constructor.clone(n);return e.afterCloneFrom(n),e}function jc(n,e){const t=parseInt(n.style.paddingInlineStart,10)||0,s=Math.round(t/40);e.setIndent(s)}function Mc(n){return n.__lexicalUnmanaged===!0}function Et(n,e){return(function(t,s){return Object.prototype.hasOwnProperty.call(t,s)})(n,e)&&n[e]!==Ie[e]}function Zs(n){const e=mr in n.prototype?n.prototype[mr]():void 0,t=(function(o){if(!(o===Ie||o.prototype instanceof Ie)){let a="<unknown>",l="<unknown>";try{a=o.getType()}catch{}try{_t.version&&(l=JSON.parse(_t.version))}catch{}T(290,o.name,a,l)}return o===xo||o===Ht||o===Ie})(n),s=!t&&Et(n,"getType")?n.getType():void 0;let r,i=s;if(e)if(s)r=e[s];else for(const[o,a]of Object.entries(e))i=o,r=a;if(!t&&i&&(Et(n,"getType")||(n.getType=()=>i),Et(n,"clone")||(n.clone=o=>(Js(o),new n)),Et(n,"importJSON")||(n.importJSON=r&&r.$importJSON||(o=>new n().updateFromJSON(o))),!Et(n,"importDOM")&&r)){const{importDOM:o}=r;o&&(n.importDOM=()=>o)}return{ownNodeConfig:r,ownNodeType:i}}function Du(n){const e=Lo();return X(),new(e.resolveRegisteredNodeAfterReplacements(e.getRegisteredNode(n))).klass}const hn=(n,e)=>{let t=n;for(;t!=null&&!ee(t);){if(e(t))return t;t=t.getParent()}return null},Dc={next:"previous",previous:"next"};class er{origin;constructor(e){this.origin=e}[Symbol.iterator](){return Fo({hasNext:xt,initial:this.getAdjacentCaret(),map:e=>e,step:e=>e.getAdjacentCaret()})}getAdjacentCaret(){return ne(this.getNodeAtCaret(),this.direction)}getSiblingCaret(){return ne(this.origin,this.direction)}remove(){const e=this.getNodeAtCaret();return e&&e.remove(),this}replaceOrInsert(e,t){const s=this.getNodeAtCaret();return e.is(this.origin)||e.is(s)||(s===null?this.insert(e):s.replace(e,t)),this}splice(e,t,s="next"){const r=s===this.direction?t:Array.from(t).reverse();let i=this;const o=this.getParentAtCaret(),a=new Map;for(let l=i.getAdjacentCaret();l!==null&&a.size<e;l=l.getAdjacentCaret()){const c=l.origin.getWritable();a.set(c.getKey(),c)}for(const l of r){if(a.size>0){const c=i.getNodeAtCaret();if(c){if(a.delete(c.getKey()),a.delete(l.getKey()),!(c.is(l)||i.origin.is(l))){const u=l.getParent();u&&u.is(o)&&l.remove(),c.replace(l)}}else c===null&&T(263,Array.from(a).join(" "))}else i.insert(l);i=ne(l,this.direction)}for(const l of a.values())l.remove();return this}}class $t extends er{type="child";getLatest(){const e=this.origin.getLatest();return e===this.origin?this:Be(e,this.direction)}getParentCaret(e="root"){return ne(tr(this.getParentAtCaret(),e),this.direction)}getFlipped(){const e=Nt(this.direction);return ne(this.getNodeAtCaret(),e)||Be(this.origin,e)}getParentAtCaret(){return this.origin}getChildCaret(){return this}isSameNodeCaret(e){return e instanceof $t&&this.direction===e.direction&&this.origin.is(e.origin)}isSamePointCaret(e){return this.isSameNodeCaret(e)}}const Pc={root:ee,shadowRoot:Ke};function Nt(n){return Dc[n]}function tr(n,e="root"){return Pc[e](n)?null:n}class tt extends er{type="sibling";getLatest(){const e=this.origin.getLatest();return e===this.origin?this:ne(e,this.direction)}getSiblingCaret(){return this}getParentAtCaret(){return this.origin.getParent()}getChildCaret(){return k(this.origin)?Be(this.origin,this.direction):null}getParentCaret(e="root"){return ne(tr(this.getParentAtCaret(),e),this.direction)}getFlipped(){const e=Nt(this.direction);return ne(this.getNodeAtCaret(),e)||Be(this.origin.getParentOrThrow(),e)}isSamePointCaret(e){return e instanceof tt&&this.direction===e.direction&&this.origin.is(e.origin)}isSameNodeCaret(e){return(e instanceof tt||e instanceof nt)&&this.direction===e.direction&&this.origin.is(e.origin)}}class nt extends er{type="text";offset;constructor(e,t){super(e),this.offset=t}getLatest(){const e=this.origin.getLatest();return e===this.origin?this:st(e,this.direction,this.offset)}getParentAtCaret(){return this.origin.getParent()}getChildCaret(){return null}getParentCaret(e="root"){return ne(tr(this.getParentAtCaret(),e),this.direction)}getFlipped(){return st(this.origin,Nt(this.direction),this.offset)}isSamePointCaret(e){return e instanceof nt&&this.direction===e.direction&&this.origin.is(e.origin)&&this.offset===e.offset}isSameNodeCaret(e){return(e instanceof tt||e instanceof nt)&&this.direction===e.direction&&this.origin.is(e.origin)}getSiblingCaret(){return ne(this.origin,this.direction)}}function He(n){return n instanceof nt}function xt(n){return n instanceof tt}function Te(n){return n instanceof $t}const Lc={next:class extends nt{direction="next";getNodeAtCaret(){return this.origin.getNextSibling()}insert(n){return this.origin.insertAfter(n),this}},previous:class extends nt{direction="previous";getNodeAtCaret(){return this.origin.getPreviousSibling()}insert(n){return this.origin.insertBefore(n),this}}},Ic={next:class extends tt{direction="next";getNodeAtCaret(){return this.origin.getNextSibling()}insert(n){return this.origin.insertAfter(n),this}},previous:class extends tt{direction="previous";getNodeAtCaret(){return this.origin.getPreviousSibling()}insert(n){return this.origin.insertBefore(n),this}}},Fc={next:class extends $t{direction="next";getNodeAtCaret(){return this.origin.getFirstChild()}insert(n){return this.origin.splice(0,0,[n]),this}},previous:class extends $t{direction="previous";getNodeAtCaret(){return this.origin.getLastChild()}insert(n){return this.origin.splice(this.origin.getChildrenSize(),0,[n]),this}}};function ne(n,e){return n?new Ic[e](n):null}function st(n,e,t){return n?new Lc[e](n,Re(n,t)):null}function Re(n,e,t="error"){const s=n.getTextContentSize();let r=e==="next"?s:e==="previous"?0:e;return(r<0||r>s)&&(t!=="clamp"&&Pi(284,String(e),String(s),n.getKey()),r=r<0?0:s),r}function ci(n,e){return new Bc(n,e)}function Be(n,e){return k(n)?new Fc[e](n):null}function Rc(n){return n&&n.getChildCaret()||n}function nr(n){return n&&Rc(n.getAdjacentCaret())}class sr{type="node-caret-range";direction;anchor;focus;constructor(e,t,s){this.anchor=e,this.focus=t,this.direction=s}getLatest(){const e=this.anchor.getLatest(),t=this.focus.getLatest();return e===this.anchor&&t===this.focus?this:new sr(e,t,this.direction)}isCollapsed(){return this.anchor.isSamePointCaret(this.focus)}getTextSlices(){const e=r=>{const i=this[r].getLatest();return He(i)?(function(o,a){const{direction:l,origin:c}=o,u=Re(c,a==="focus"?Nt(l):l);return ci(o,u-o.offset)})(i,r):null},t=e("anchor"),s=e("focus");if(t&&s){const{caret:r}=t,{caret:i}=s;if(r.isSameNodeCaret(i))return[ci(r,i.offset-r.offset),null]}return[t,s]}iterNodeCarets(e="root"){const t=He(this.anchor)?this.anchor.getSiblingCaret():this.anchor.getLatest(),s=this.focus.getLatest(),r=He(s),i=o=>o.isSameNodeCaret(s)?null:nr(o)||o.getParentCaret(e);return Fo({hasNext:o=>o!==null&&!(r&&s.isSameNodeCaret(o)),initial:t.isSameNodeCaret(s)?null:i(t),map:o=>o,step:i})}[Symbol.iterator](){return this.iterNodeCarets("root")}}class Bc{type="slice";caret;distance;constructor(e,t){this.caret=e,this.distance=t}getSliceIndices(){const{distance:e,caret:{offset:t}}=this,s=t+e;return s<t?[s,t]:[t,s]}getTextContent(){const[e,t]=this.getSliceIndices();return this.caret.origin.getTextContent().slice(e,t)}getTextContentSize(){return Math.abs(this.distance)}removeTextSlice(){const{caret:{origin:e,direction:t}}=this,[s,r]=this.getSliceIndices(),i=e.getTextContent();return st(e.setTextContent(i.slice(0,s)+i.slice(r)),t,s)}}function Io(n){return rt(n,ne(oe(),n.direction))}function zc(n){return rt(n,n)}function rt(n,e){return n.direction!==e.direction&&T(265),new sr(n,e,n.direction)}function Fo(n){const{initial:e,hasNext:t,step:s,map:r}=n;let i=e;return{[Symbol.iterator](){return this},next(){if(!t(i))return{done:!0,value:void 0};const o={done:!1,value:r(i)};return i=s(i),o}}}function Ro(n,e){const t=gn(n.origin,e.origin);switch(t===null&&T(275,n.origin.getKey(),e.origin.getKey()),t.type){case"same":{const s=n.type==="text",r=e.type==="text";return s&&r?(function(i,o){return Math.sign(i-o)})(n.offset,e.offset):n.type===e.type?0:s?-1:r?1:n.type==="child"?-1:1}case"ancestor":return n.type==="child"?-1:1;case"descendant":return e.type==="child"?1:-1;case"branch":return Bo(t)}}function Bo(n){const{a:e,b:t}=n,s=e.__key,r=t.__key;let i=e,o=t;for(;i&&o;i=i.getNextSibling(),o=o.getNextSibling()){if(i.__key===r)return-1;if(o.__key===s)return 1}return i===null?1:-1}function cn(n,e){return e.is(n)}function ui(n){return k(n)?[n.getLatest(),null]:[n.getParent(),n.getLatest()]}function gn(n,e){if(n.is(e))return{commonAncestor:n,type:"same"};const t=new Map;for(let[s,r]=ui(n);s;r=s,s=s.getParent())t.set(s,r);for(let[s,r]=ui(e);s;r=s,s=s.getParent()){const i=t.get(s);if(i!==void 0)return i===null?(cn(n,s)||T(276),{commonAncestor:s,type:"ancestor"}):r===null?(cn(e,s)||T(277),{commonAncestor:s,type:"descendant"}):((k(i)||cn(n,i))&&(k(r)||cn(e,r))&&s.is(i.getParent())&&s.is(r.getParent())||T(278),{a:i,b:r,commonAncestor:s,type:"branch"})}return null}function it(n,e){const{type:t,key:s,offset:r}=n,i=wc(n.key);return t==="text"?(M(i)||T(266,i.getType(),s),st(i,e,r)):(k(i)||T(267,i.getType(),s),Uc(i,n.offset,e))}function Ut(n,e){const{origin:t,direction:s}=e,r=s==="next";He(e)?n.set(t.getKey(),e.offset,"text"):xt(e)?M(t)?n.set(t.getKey(),Re(t,s),"text"):n.set(t.getParentOrThrow().getKey(),t.getIndexWithinParent()+(r?1:0),"element"):(Te(e)&&k(t)||T(268),n.set(t.getKey(),r?0:t.getChildrenSize(),"element"))}function Kc(n){const e=B(),t=P(e)?e:oc();return pn(t,n),ue(t),t}function pn(n,e){Ut(n.anchor,e.anchor),Ut(n.focus,e.focus)}function di(n){const{anchor:e,focus:t}=n,s=it(e,"next"),r=it(t,"next"),i=Ro(s,r)<=0?"next":"previous";return rt(vt(s,i),vt(r,i))}function rr(n){const{direction:e,origin:t}=n,s=ne(t,Nt(e)).getNodeAtCaret();return s?ne(s,e):Be(t.getParentOrThrow(),e)}function fi(n,e="root"){const t=[n];for(let s=Te(n)?n.getParentCaret(e):n.getSiblingCaret();s!==null;s=s.getParentCaret(e))t.push(rr(s));return t}function os(n){return!!n&&n.origin.isAttached()}function Wc(n,e="removeEmptySlices"){if(n.isCollapsed())return n;const t="root",s="next";let r=e;const i=zo(n,s),o=fi(i.anchor,t),a=fi(i.focus.getFlipped(),t),l=new Set,c=[];for(const f of i.iterNodeCarets(t))if(Te(f))l.add(f.origin.getKey());else if(xt(f)){const{origin:m}=f;k(m)&&!l.has(m.getKey())||c.push(m)}for(const f of c)f.remove();for(const f of i.getTextSlices()){if(!f)continue;const{origin:m}=f.caret,_=m.getTextContentSize(),x=rr(ne(m,s)),y=m.getMode();if(Math.abs(f.distance)===_&&r==="removeEmptySlices"||y==="token"&&f.distance!==0)x.remove();else if(f.distance!==0){r="removeEmptySlices";let v=f.removeTextSlice();const b=f.caret.origin;if(y==="segmented"){const S=v.origin,N=Q(S.getTextContent()).setStyle(S.getStyle()).setFormat(S.getFormat());x.replaceOrInsert(N),v=st(N,s,v.offset)}b.is(o[0].origin)&&(o[0]=v),b.is(a[0].origin)&&(a[0]=v.getFlipped())}}let u,p;for(const f of o)if(os(f)){u=xe(f);break}for(const f of a)if(os(f)){p=xe(f);break}const d=(function(f,m,_){if(!f||!m)return null;const x=f.getParentAtCaret(),y=m.getParentAtCaret();if(!x||!y)return null;const v=x.getParents().reverse();v.push(x);const b=y.getParents().reverse();b.push(y);const S=Math.min(v.length,b.length);let N;for(N=0;N<S&&v[N]===b[N];N++);const E=(D,F)=>{let L;for(let A=N;A<D.length;A++){const R=D[A];if(Ke(R))return;!L&&F(R)&&(L=R)}return L},w=E(v,Pe),C=w&&E(b,(D=>_.has(D.getKey())&&Pe(D)));return w&&C?[w,C]:null})(u,p,l);if(d){const[f,m]=d;Be(f,"previous").splice(0,m.getChildren()),m.remove()}const h=[u,p,...o,...a].find(os);if(h)return zc(vt(xe(h),n.direction));T(269,JSON.stringify(o.map((f=>f.origin.__key))))}function xe(n){const e=(function(r){let i=r;for(;Te(i);){const o=nr(i);if(!Te(o))break;i=o}return i})(n.getLatest()),{direction:t}=e;if(M(e.origin))return He(e)?e:st(e.origin,t,t);const s=e.getAdjacentCaret();return xt(s)&&M(s.origin)?st(s.origin,t,Nt(t)):e}function $c(n){return He(n)&&n.offset!==Re(n.origin,n.direction)}function vt(n,e){return n.direction===e?n:n.getFlipped()}function zo(n,e){return n.direction===e?n:rt(vt(n.focus,e),vt(n.anchor,e))}function Uc(n,e,t){let s=Be(n,"next");for(let r=0;r<e;r++){const i=s.getAdjacentCaret();if(i===null)break;s=i}return vt(s,t)}function Pu(n){return n}function Lu(n){return n}function Iu(n,e){if(!e||n===e)return n;for(const t in e)if(n[t]!==e[t])return{...n,...e};return n}const Jc=()=>{const[n]=Uo(),e=r=>{n.update(()=>{const i=B();P(i)&&qn(i,()=>ca(`h${r}`))})},t=()=>{n.update(()=>{const r=B();P(r)&&qn(r,()=>ua())})},s=()=>{n.update(()=>{const r=B();P(r)&&qn(r,()=>da())})};return g.jsxs("div",{className:"flex flex-wrap gap-2 p-2 border-b bg-white/70",children:[g.jsx("button",{onClick:()=>e(1),className:"p-2 rounded hover:bg-gray-100",title:"TÃ­tulo 1",children:"H1"}),g.jsx("button",{onClick:()=>e(2),className:"p-2 rounded hover:bg-gray-100",title:"TÃ­tulo 2",children:"H2"}),g.jsx("button",{onClick:t,className:"p-2 rounded hover:bg-gray-100",title:"CitaÃ§Ã£o",children:"ââ"}),g.jsx("button",{onClick:s,className:"p-2 rounded hover:bg-gray-100",title:"CÃ³digo",children:"</>"})]})},qc={namespace:"AdvancedEditor",theme:{text:{bold:"font-bold",italic:"italic",underline:"underline",strikethrough:"line-through"},link:"text-blue-500 hover:underline",heading:{h1:"text-3xl font-bold",h2:"text-2xl font-bold",h3:"text-xl font-bold"},paragraph:"mb-4",quote:"border-l-4 border-gray-300 pl-4 italic",code:"bg-gray-100 p-1 rounded font-mono text-sm"},onError(n){console.error(n)},nodes:[fa,ha,ga,pa,ma,_a,ya,xa]};function hi({onChange:n,initialValue:e=""}){return g.jsx("div",{className:"border rounded-lg overflow-hidden",children:g.jsx(Jo,{initialConfig:{...qc,editorState:e},children:g.jsxs("div",{className:"editor-container",children:[g.jsx(Jc,{}),g.jsxs("div",{className:"editor-inner relative",children:[g.jsx(qo,{contentEditable:g.jsx(Vo,{className:"min-h-[200px] p-4 focus:outline-none"}),placeholder:g.jsx("div",{className:"absolute top-4 left-4 text-gray-400 pointer-events-none",children:"Comece a digitar..."})}),g.jsx(Ho,{}),g.jsx(Yo,{}),g.jsx(Go,{}),g.jsx(Qo,{}),g.jsx(Xo,{transformers:va}),typeof n=="function"&&g.jsx(Zo,{onChange:(t,s)=>{try{n(t,s)}catch(r){console.warn("Editor onChange handler error:",r)}}})]})]})})})}const Ko=j.forwardRef(({className:n,value:e,...t},s)=>g.jsx(Ni,{ref:s,className:q("relative h-2 w-full overflow-hidden rounded-full bg-muted",n),...t,children:g.jsx(Pa,{className:"h-full w-full flex-1 bg-primary transition-all duration-300",style:{transform:`translateX(-${100-(e||0)}%)`}})}));Ko.displayName=Ni.displayName;const Vc=()=>{const n=Ci(),e=La();return{navigate:n,location:e,goTo:(l,{replace:c=!1,state:u=null}={})=>{n(l,{replace:c,state:u})},goBack:()=>{n(-1)},goToLogin:(l=null)=>{const c=l||e.pathname+e.search;n("/login",{state:{from:c}})},goToDashboard:()=>{n("/dashboard")},handleSignOut:async(l="/login")=>{try{const{error:c}=await V.auth.signOut();if(c)throw c;n(l)}catch(c){console.error("Error signing out:",c)}},isActive:(l,c=!1)=>c?e.pathname===l:e.pathname.startsWith(l)}},as=[{value:"text",label:"Resposta Curta",icon:mn,placeholder:"Digite sua resposta aqui..."},{value:"paragraph",label:"ParÃ¡grafo",icon:mn,placeholder:"Digite sua resposta detalhada aqui..."},{value:"multiple_choice",label:"MÃºltipla Escolha",icon:ar,placeholder:"Selecione uma opÃ§Ã£o"},{value:"checkbox",label:"Caixas de SeleÃ§Ã£o",icon:ta,placeholder:"Selecione uma ou mais opÃ§Ãµes"},{value:"dropdown",label:"Lista Suspensa",icon:ar,placeholder:"Selecione uma opÃ§Ã£o"},{value:"code",label:"CÃ³digo",icon:na,placeholder:"Digite seu cÃ³digo aqui..."},{value:"image",label:"Upload de Imagem",icon:sa,placeholder:"Envie uma imagem como resposta"}],Hc=({question:n,index:e,onUpdate:t,onDelete:s,isDragging:r=!1})=>{const[i,o]=j.useState(n),a=(d,h)=>{const f={...i,[d]:h};o(f),t(e,f)},l=()=>{const d=i.options||[];a("options",[...d,`OpÃ§Ã£o ${d.length+1}`])},c=(d,h)=>{const m=[...i.options||[]];m[d]=h,a("options",m)},u=d=>{const f=(i.options||[]).filter((m,_)=>_!==d);a("options",f)},p=as.find(d=>d.value===i.type)||as[0];return g.jsx(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:`relative group ${r?"opacity-50":""}`,children:g.jsxs(It,{className:"border-l-4 border-l-blue-500 hover:shadow-lg transition-shadow",children:[g.jsx(_n,{className:"pb-3",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("div",{className:"cursor-move text-gray-400 hover:text-gray-600",children:g.jsx(ea,{className:"w-4 h-4"})}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(p.icon,{className:"w-5 h-5 text-blue-500"}),g.jsxs(yn,{className:"text-lg",children:["Pergunta ",e+1]})]})]}),g.jsx(ye,{type:"button",variant:"ghost",size:"sm",onClick:()=>s(e),className:"text-red-500 hover:text-red-700 hover:bg-red-50",children:g.jsx(lr,{className:"w-4 h-4"})})]})}),g.jsxs(Ft,{className:"space-y-4",children:[g.jsxs("div",{className:"space-y-2",children:[g.jsx(de,{children:"Enunciado da Pergunta *"}),g.jsx(Je,{value:i.title||"",onChange:d=>a("title",d.target.value),placeholder:"Digite o enunciado da pergunta...",className:"font-medium"})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsx(de,{children:"Tipo de Resposta"}),g.jsxs(tl,{value:i.type||"text",onValueChange:d=>a("type",d),children:[g.jsx(Oi,{children:g.jsx(nl,{})}),g.jsx(Mi,{children:as.map(d=>g.jsx(Di,{value:d.value,children:g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(d.icon,{className:"w-4 h-4"}),d.label]})},d.value))})]})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsx(de,{children:"Texto de Ajuda (opcional)"}),g.jsx(Je,{value:i.helpText||"",onChange:d=>a("helpText",d.target.value),placeholder:"Digite instruÃ§Ãµes adicionais para os alunos..."})]}),(i.type==="multiple_choice"||i.type==="checkbox"||i.type==="dropdown")&&g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx(de,{children:"OpÃ§Ãµes de Resposta"}),g.jsxs(ye,{type:"button",variant:"outline",size:"sm",onClick:l,children:[g.jsx(ls,{className:"w-4 h-4 mr-1"}),"Adicionar OpÃ§Ã£o"]})]}),g.jsx("div",{className:"space-y-2",children:(i.options||[]).map((d,h)=>g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(Je,{value:d,onChange:f=>c(h,f.target.value),placeholder:`OpÃ§Ã£o ${h+1}`}),g.jsx(ye,{type:"button",variant:"ghost",size:"sm",onClick:()=>u(h),className:"text-red-500 hover:text-red-700",children:g.jsx(lr,{className:"w-4 h-4"})})]},h))})]}),g.jsxs("div",{className:"flex items-center space-x-2",children:[g.jsx("input",{type:"checkbox",id:`required-${e}`,checked:i.required!==!1,onChange:d=>a("required",d.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),g.jsx(de,{htmlFor:`required-${e}`,className:"text-sm font-normal",children:"Pergunta obrigatÃ³ria"})]})]})]})})},Yc=ur({title:Me().min(5,"O tÃ­tulo deve ter pelo menos 5 caracteres"),description:Me().min(10,"A descriÃ§Ã£o deve ter pelo menos 10 caracteres"),instructions:Me().optional(),dueDate:Me().refine(n=>!n||new Date(n)>new Date,{message:"A data de entrega deve ser futura"}),points:Ca().min(0,"A pontuaÃ§Ã£o deve ser um nÃºmero positivo"),questions:dr(ur({title:Me().min(1,"O enunciado da pergunta Ã© obrigatÃ³rio"),type:Me().min(1,"O tipo da pergunta Ã© obrigatÃ³rio"),required:Na().default(!0),helpText:Me().optional(),options:dr(Me()).optional()})).optional()}),Gc=({initialData:n,onSubmit:e,isSubmitting:t=!1})=>{const{toast:s}=Ei(),{goBack:r}=Vc(),[i,o]=j.useState(navigator.onLine),[a,l]=j.useState("checking"),[c,u]=j.useState([]),[p,d]=j.useState(!1),[h,f]=j.useState(!1);j.useEffect(()=>{const L=()=>{o(!0),l("online")},A=()=>{o(!1),l("offline")};return window.addEventListener("online",L),window.addEventListener("offline",A),navigator.onLine?l("online"):l("offline"),()=>{window.removeEventListener("online",L),window.removeEventListener("offline",A)}},[]);const{handleSubmit:m,register:_,formState:{errors:x},setValue:y,watch:v,reset:b}=ba({resolver:Sa(Yc),defaultValues:{title:"",description:"",instructions:"",dueDate:"",points:10,questions:[],...n}});j.useEffect(()=>{y("questions",c)},[c,y]);const S=j.useCallback(async L=>{try{if(f(!0),!L.title?.trim())throw new Error("TÃ­tulo Ã© obrigatÃ³rio");if(!L.description?.trim())throw new Error("DescriÃ§Ã£o Ã© obrigatÃ³ria");await e(L)}catch(A){f(!1),console.error("[ActivityForm] Form submission error:",A),s({title:"â Erro ao salvar atividade",description:A.message||"Ocorreu um erro ao tentar salvar a atividade. Verifique os dados e tente novamente.",variant:"destructive",duration:5e3})}},[e,s]),N=j.useCallback(async L=>{const A=L.target.files?.[0];if(!A)return;const R=["image/jpeg","image/png","image/gif","image/webp"],K=5*1024*1024;if(!R.includes(A.type)){s({title:"Tipo de arquivo nÃ£o suportado",description:"Por favor, envie uma imagem no formato JPG, PNG, GIF ou WebP.",variant:"destructive"});return}if(A.size>K){s({title:"Arquivo muito grande",description:"O tamanho mÃ¡ximo permitido Ã© 5MB.",variant:"destructive"});return}const U=URL.createObjectURL(A);y("image",{file:A,previewUrl:U})},[y,s]),E=j.useCallback(()=>{const L={title:"",type:"text",required:!0,helpText:"",options:[]};u(A=>[...A,L])},[]),w=j.useCallback((L,A)=>{u(R=>R.map((K,U)=>U===L?A:K))},[]),C=j.useCallback(L=>{u(A=>A.filter((R,K)=>K!==L))},[]);j.useEffect(()=>(d(!0),()=>{const L=v("image");L?.previewUrl&&URL.revokeObjectURL(L.previewUrl)}),[v]);const D=v("image");if(j.useEffect(()=>{n&&(b(n),u(n.questions||[]))},[n,b]),!p)return g.jsx("div",{className:"flex justify-center items-center h-64",children:g.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})});const F=c.length>0?Math.min(c.length/10*100,100):0;return g.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[g.jsx(se.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:`rounded-lg p-3 border ${a==="online"?"bg-green-50 border-green-200 text-green-800":a==="offline"?"bg-red-50 border-red-200 text-red-800":"bg-yellow-50 border-yellow-200 text-yellow-800"}`,children:g.jsxs("div",{className:"flex items-center gap-2",children:[a==="online"?g.jsx(ra,{className:"w-4 h-4"}):a==="offline"?g.jsx(cr,{className:"w-4 h-4"}):g.jsx(cs,{className:"w-4 h-4 animate-spin"}),g.jsx("span",{className:"text-sm font-medium",children:a==="online"?"Conectado Ã  internet":a==="offline"?"Sem conexÃ£o com a internet":"Verificando conexÃ£o..."}),!i&&g.jsx("span",{className:"text-xs opacity-75",children:"- As alteraÃ§Ãµes serÃ£o salvas quando a conexÃ£o for restaurada"})]})}),c.length>0&&g.jsxs(se.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-white rounded-lg p-4 shadow-sm border",children:[g.jsxs("div",{className:"flex items-center justify-between mb-2",children:[g.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Progresso da Atividade"}),g.jsxs("span",{className:"text-sm text-gray-500",children:[c.length," pergunta",c.length!==1?"s":""]})]}),g.jsx(Ko,{value:F,className:"h-2"})]}),g.jsxs("form",{onSubmit:m(S),className:"space-y-6",children:[g.jsx(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:g.jsxs(It,{className:"border-l-4 border-l-blue-500",children:[g.jsx(_n,{className:"bg-gradient-to-r from-blue-50 to-indigo-50",children:g.jsxs(yn,{className:"flex items-center gap-2",children:[g.jsx(mn,{className:"w-5 h-5 text-blue-600"}),"InformaÃ§Ãµes BÃ¡sicas da Atividade"]})}),g.jsxs(Ft,{className:"p-6 space-y-4",children:[g.jsxs("div",{className:"space-y-2",children:[g.jsx(de,{htmlFor:"title",className:"text-sm font-medium",children:"TÃ­tulo da Atividade *"}),g.jsx(Je,{id:"title",..._("title"),placeholder:"Digite um tÃ­tulo descritivo para sua atividade...",className:"text-base",error:x.title?.message}),x.title&&g.jsxs(se.p,{initial:{opacity:0},animate:{opacity:1},className:"text-sm text-red-500 flex items-center gap-1",children:[g.jsx(sn,{className:"w-4 h-4"}),x.title.message]})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsx(de,{htmlFor:"description",className:"text-sm font-medium",children:"DescriÃ§Ã£o *"}),g.jsx("div",{className:"border rounded-md",children:g.jsx(hi,{initialValue:v("description")||"",onChange:L=>{try{L.read(()=>{const A=oe().getTextContent();y("description",A,{shouldValidate:!0,shouldDirty:!0})})}catch(A){console.warn("Lexical description onChange error:",A)}}})}),x.description&&g.jsxs(se.p,{initial:{opacity:0},animate:{opacity:1},className:"text-sm text-red-500 flex items-center gap-1",children:[g.jsx(sn,{className:"w-4 h-4"}),x.description.message]})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsx(de,{htmlFor:"instructions",className:"text-sm font-medium",children:"InstruÃ§Ãµes Detalhadas (opcional)"}),g.jsx("div",{className:"border rounded-md",children:g.jsx(hi,{initialValue:v("instructions")||"",onChange:L=>{try{L.read(()=>{const A=oe().getTextContent();y("instructions",A,{shouldValidate:!0,shouldDirty:!0})})}catch(A){console.warn("Lexical instructions onChange error:",A)}}})})]}),g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[g.jsxs("div",{className:"space-y-2",children:[g.jsx(de,{htmlFor:"dueDate",className:"text-sm font-medium",children:"Data de Entrega"}),g.jsx(Je,{id:"dueDate",type:"datetime-local",..._("dueDate"),min:new Date().toISOString().slice(0,16),error:x.dueDate?.message}),x.dueDate&&g.jsxs("p",{className:"text-sm text-red-500 flex items-center gap-1",children:[g.jsx(sn,{className:"w-4 h-4"}),x.dueDate.message]})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsx(de,{htmlFor:"points",className:"text-sm font-medium",children:"PontuaÃ§Ã£o Total"}),g.jsx(Je,{id:"points",type:"number",min:"0",step:"0.5",..._("points",{valueAsNumber:!0}),error:x.points?.message}),x.points&&g.jsxs("p",{className:"text-sm text-red-500 flex items-center gap-1",children:[g.jsx(sn,{className:"w-4 h-4"}),x.points.message]})]})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsx(de,{className:"text-sm font-medium",children:"Imagem de Capa (opcional)"}),D?.previewUrl?g.jsxs(se.div,{initial:{opacity:0},animate:{opacity:1},className:"relative group",children:[g.jsx("img",{src:D.previewUrl,alt:"Preview",className:"rounded-lg border border-gray-200 w-full max-h-64 object-cover shadow-sm"}),g.jsx(ye,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity shadow-lg",onClick:()=>y("image",null),children:"Remover"})]}):g.jsx(se.div,{whileHover:{scale:1.01},whileTap:{scale:.99},children:g.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors",children:[g.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[g.jsx(ia,{className:"w-8 h-8 mb-2 text-gray-400"}),g.jsxs("p",{className:"text-sm text-gray-500 text-center",children:[g.jsx("span",{className:"font-semibold",children:"Clique para enviar"})," ou arraste uma imagem"]}),g.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"PNG, JPG, GIF atÃ© 5MB"})]}),g.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:N})]})})]})]})]})}),g.jsx(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:g.jsxs(It,{className:"border-l-4 border-l-green-500",children:[g.jsx(_n,{className:"bg-gradient-to-r from-green-50 to-emerald-50",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs(yn,{className:"flex items-center gap-2",children:[g.jsx(us,{className:"w-5 h-5 text-green-600"}),"Perguntas da Atividade",c.length>0&&g.jsx("span",{className:"bg-green-100 text-green-800 text-xs font-medium px-2 py-1 rounded-full",children:c.length})]}),g.jsxs(ye,{type:"button",onClick:E,className:"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:[g.jsx(ls,{className:"w-4 h-4 mr-2"}),"Adicionar Pergunta"]})]})}),g.jsx(Ft,{className:"p-6",children:c.length===0?g.jsxs(se.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-12",children:[g.jsx("div",{className:"bg-gray-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4",children:g.jsx(mn,{className:"w-8 h-8 text-gray-400"})}),g.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhuma pergunta adicionada"}),g.jsx("p",{className:"text-gray-500 mb-6",children:"Comece adicionando perguntas para criar uma atividade interativa."}),g.jsxs(ye,{type:"button",onClick:E,variant:"outline",className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200 hover:from-blue-100 hover:to-indigo-100",children:[g.jsx(ls,{className:"w-4 h-4 mr-2"}),"Criar Primeira Pergunta"]})]}):g.jsx("div",{className:"space-y-4",children:g.jsx(Fa,{children:c.map((L,A)=>g.jsx(Hc,{question:L,index:A,onUpdate:w,onDelete:C},A))})})})]})}),g.jsxs(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"flex flex-col sm:flex-row gap-4 justify-between items-center bg-white rounded-lg p-6 shadow-sm border",children:[g.jsxs(ye,{type:"button",variant:"outline",onClick:r,className:"flex items-center gap-2",children:[g.jsx(pi,{className:"w-4 h-4"}),"Cancelar"]}),g.jsxs("div",{className:"flex items-center gap-4",children:[c.length>0&&g.jsxs("span",{className:"text-sm text-gray-500",children:[c.length," pergunta",c.length!==1?"s":""," configurada",c.length!==1?"s":""]}),g.jsx(ye,{type:"submit",disabled:t||h||!i,className:`shadow-lg hover:shadow-xl transition-all duration-300 ${t?"bg-gray-400 cursor-not-allowed":h?"bg-green-500 hover:bg-green-600":i?"bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600":"bg-gray-300 cursor-not-allowed"} text-white`,children:t?g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(cs,{className:"w-4 h-4 animate-spin"}),g.jsx("span",{children:"Salvando atividade..."})]}):h?g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(us,{className:"w-4 h-4"}),g.jsx("span",{children:"Atividade salva!"})]}):i?g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(oa,{className:"w-4 h-4"}),g.jsx("span",{children:"Salvar Atividade"})]}):g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(cr,{className:"w-4 h-4"}),g.jsx("span",{children:"Sem conexÃ£o"})]})})]})]})]})]})},Qc=n=>{const[e,t]=j.useState([]),[s,r]=j.useState(!0),[i,o]=j.useState(null),a=`user:drafts:${n}`,l=j.useCallback(async()=>{if(n)try{r(!0),o(null),t([])}catch(h){console.error("Error loading drafts:",h),o(h.message)}finally{r(!1)}},[n]),c=j.useCallback(async h=>{if(n)try{const f=[...e],m=f.findIndex(x=>x.id===h.id);m>=0?f[m]={...h,updatedAt:new Date().toISOString()}:f.push({...h,id:h.id||`draft_${Date.now()}`,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});const _={userId:n,drafts:f,lastUpdated:new Date().toISOString()};return localStorage.setItem(a,JSON.stringify(_)),t(f),f}catch(f){throw console.error("Error saving draft:",f),f}},[n,e,a]),u=j.useCallback(async h=>{if(n)try{const f=e.filter(_=>_.id!==h),m={userId:n,drafts:f,lastUpdated:new Date().toISOString()};return localStorage.setItem(a,JSON.stringify(m)),t(f),f}catch(f){throw console.error("Error deleting draft:",f),f}},[n,e,a]),p=j.useCallback(h=>e.find(f=>f.id===h),[e]),d=j.useCallback(async()=>{if(n)try{localStorage.removeItem(a),t([])}catch(h){throw console.error("Error clearing drafts:",h),h}},[n,a]);return j.useEffect(()=>{if(n)try{const h=localStorage.getItem(a);if(h){const f=JSON.parse(h);f.userId===n&&t(f.drafts||[])}}catch(h){console.error("Error loading drafts from localStorage:",h)}finally{r(!1)}},[n,a]),{drafts:e,loading:s,error:i,saveDraft:c,deleteDraft:u,getDraft:p,clearAllDrafts:d,refetch:l}},Xc=()=>{const{toast:n}=Ei(),{user:e,loading:t}=Ya(),{classId:s}=Ia(),r=Ci(),[i,o]=j.useState(!1),[a,l]=j.useState(!1),{drafts:c,saveDraft:u,loading:p}=Qc(e?.id),[d,h]=j.useState(null),[f,m]=j.useState(null),[_,x]=j.useState({title:"",description:"",instructions:"",dueDate:"",points:10,questions:[],image:null});j.useEffect(()=>{d&&clearTimeout(d);const v=setTimeout(async()=>{if(_.title||_.description||_.questions.length>0)try{await u({id:`draft_${e?.id}_${Date.now()}`,..._,classId:s||null,lastModified:new Date().toISOString()}),m(new Date)}catch(b){console.error("Auto-save failed:",b)}},3e4);return h(v),()=>{v&&clearTimeout(v)}},[_,s,e?.id,u,d]),j.useEffect(()=>{const v=async()=>{if(c.length>0){const b=c.sort((S,N)=>new Date(N.updatedAt)-new Date(S.updatedAt))[0];b&&x({title:b.title||"",description:b.description||"",instructions:b.instructions||"",dueDate:b.dueDate||"",points:b.points||10,questions:b.questions||[],image:b.image||null})}};!p&&e?.id&&v()},[c,p,e?.id]),j.useEffect(()=>{if(!t){if(e)s||console.log("Creating activity without specific class");else return;o(!0)}},[e,t,s]);const y=j.useCallback(async v=>{l(!0);try{const{image:b,...S}=v;b?.file&&await new Promise(C=>setTimeout(C,1e3));const N={title:S.title||"Nova Atividade",description:S.description||null,instructions:S.instructions||null,schema:S.questions?JSON.stringify({title:S.title||"Nova Atividade",type:"object",properties:{},required:[]}):null,ui_schema:S.questions?JSON.stringify({}):null,created_by:e.id,is_public:!1,tags:[]},{data:E,error:w}=await V.from("activity_templates").insert([N]).select().single();if(w)throw w;if(s){const{error:C}=await V.rpc("publish_activity_template",{template_id_param:E.id,class_ids:[s],custom_title:S.title||null,custom_description:S.description||null,custom_instructions:S.instructions||null,custom_due_date:S.dueDate||null,custom_max_points:S.points||100});C&&console.warn("Error publishing to class:",C)}n({title:"â Atividade criada com sucesso!",description:"Sua atividade foi salva e estÃ¡ disponÃ­vel para os alunos."}),r("/dashboard/activities")}catch(b){console.error("[CreateActivityPage] Error creating activity:",b);let S="Ocorreu um erro ao tentar salvar a atividade.";b.message.includes("Database error")?S="Erro no banco de dados. Verifique sua conexÃ£o com a internet e tente novamente.":b.message.includes("User not authenticated")?S="VocÃª precisa estar logado para criar uma atividade.":b.message.includes("network")&&(S="Problema de conexÃ£o. Verifique sua internet e tente novamente."),n({title:"â Erro ao criar atividade",description:S,variant:"destructive",duration:5e3})}finally{l(!1)}},[s,n,r,e]);return t||!i?g.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 flex justify-center items-center",children:g.jsxs(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center space-y-4",children:[g.jsxs("div",{className:"relative",children:[g.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/20 to-purple-500/20 rounded-full blur-xl"}),g.jsx(cs,{className:"relative h-16 w-16 text-blue-500 animate-spin mx-auto"})]}),g.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-lg font-medium",children:t?"Verificando autenticaÃ§Ã£o...":"Preparando ambiente..."})]})}):g.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:g.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[g.jsx(se.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:g.jsxs("div",{className:"relative",children:[g.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600/10 to-purple-600/10 rounded-2xl blur-xl"}),g.jsx("div",{className:"relative bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl p-6 border border-white/20 dark:border-gray-700/20 shadow-xl",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-4",children:[g.jsx("div",{className:"p-3 bg-gradient-to-r from-blue-500 to-purple-500 rounded-xl",children:g.jsx(aa,{className:"h-8 w-8 text-white"})}),g.jsxs("div",{children:[g.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Criar Nova Atividade"}),g.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:s?"Crie uma atividade interativa para seus alunos":"Crie uma atividade geral ou selecione uma turma especÃ­fica"})]})]}),g.jsxs(ye,{variant:"outline",onClick:()=>r("/dashboard/activities"),className:"flex items-center gap-2",children:[g.jsx(pi,{className:"w-4 h-4"}),"Voltar"]})]})})]})}),g.jsx(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"mb-6",children:g.jsx(It,{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-green-200",children:g.jsx(Ft,{className:"p-4",children:g.jsxs("div",{className:"flex items-start gap-3",children:[g.jsx(us,{className:"w-5 h-5 text-green-600 mt-0.5"}),g.jsxs("div",{children:[g.jsx("h3",{className:"font-semibold text-green-800 mb-1",children:"Dicas para uma boa atividade"}),g.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[g.jsx("li",{children:"â¢ Use tÃ­tulos claros e descritivos"}),g.jsx("li",{children:"â¢ Adicione perguntas variadas para engajar os alunos"}),g.jsx("li",{children:"â¢ Defina uma data de entrega realista"}),g.jsx("li",{children:"â¢ Inclua instruÃ§Ãµes detalhadas quando necessÃ¡rio"})]})]})]})})})}),g.jsx(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:g.jsx(Gc,{initialData:_,onSubmit:y,isSubmitting:a})})]})})},Fu=Object.freeze(Object.defineProperty({__proto__:null,default:Xc},Symbol.toStringTag,{value:"Module"}));export{Iu as $,Tu as A,ye as B,It as C,Ke as D,B as E,Ts as F,it as G,$c as H,Je as I,Io as J,Te as K,au as L,k as M,go as N,W as O,Ko as P,Au as Q,St as R,tl as S,il as T,P as U,ee as V,Lo as W,De as X,Rr as Y,hn as Z,xo as _,Ya as a,vu as a$,Du as a0,Yt as a1,bt as a2,Jt as a3,qt as a4,Qt as a5,Lu as a6,Su as a7,pc as a8,M as a9,Zt as aA,wo as aB,wu as aC,Xi as aD,Er as aE,ju as aF,ql as aG,Vs as aH,Jl as aI,Ul as aJ,oc as aK,fs as aL,Kl as aM,vs as aN,un as aO,kr as aP,Wl as aQ,kn as aR,zl as aS,fu as aT,Dl as aU,Ll as aV,Rl as aW,bc as aX,Fl as aY,du as aZ,uu as a_,hc as aa,Wt as ab,xu as ac,oi as ad,Ec as ae,Ac as af,Co as ag,ae as ah,Tc as ai,zs as aj,Oe as ak,Qi as al,Eu as am,cu as an,He as ao,rt as ap,Be as aq,bu as ar,Rn as as,Ht as at,jc as au,$l as av,ku as aw,Bl as ax,Hi as ay,I as az,_n as b,hu as b0,Ue as b1,Tr as b2,At as b3,En as b4,Tn as b5,mu as b6,_u as b7,pu as b8,gu as b9,Gi as ba,Nu as bb,Yi as bc,Cu as bd,Mu as be,yu as bf,Q as bg,Ut as bh,xe as bi,co as bj,ne as bk,uc as bl,ht as bm,lu as bn,Fu as bo,q as c,yn as d,Ft as e,Oi as f,nl as g,Mi as h,Di as i,de as j,Za as k,Va as l,el as m,Ou as n,oe as o,Fe as p,Pu as q,Ks as r,V as s,Xa as t,Ei as u,ue as v,ss as w,G as x,Wn as y,jl as z};
