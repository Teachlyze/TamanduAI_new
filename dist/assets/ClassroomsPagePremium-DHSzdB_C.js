import{j as e,a0 as Z,m as A,a2 as ee,g as ae,u as se,r as i,s as k,z as c,U as E,B as U,T as te,bF as re,p as b,ai as B,d as T}from"./main-7VZoQpWp.js";import{S as ie,P as ne}from"./PremiumCard-BlYsE6j7.js";import{P as N,I as le,F as oe}from"./PremiumButton-BLQFs7s4.js";import{N as ce,E as de}from"./EmptyState-DVyZdeJX.js";import{C as _}from"./classInviteService-CchMwy0B.js";import{P as V}from"./plus-DZCtRGwr.js";import{E as me}from"./ellipsis-vertical-Vfdo4yhB.js";import{U as ue}from"./user-plus-nqldkkyw.js";import{S as xe}from"./share-2-Dq_i0uRy.js";import{C as pe}from"./copy-DKty2evo.js";import{M as O}from"./mail-D6lmW9dN.js";const Q=({isOpen:y,onClose:n,title:x,description:p,children:l,footer:h,size:g="md",variant:d="default",showCloseButton:v=!0,closeOnBackdrop:m=!0,className:I=""})=>{const w={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl",full:"max-w-7xl"},j={hidden:{opacity:0,scale:d==="slideUp"?1:.95,y:d==="slideUp"?100:0},visible:{opacity:1,scale:1,y:0,transition:{type:"spring",damping:25,stiffness:300}},exit:{opacity:0,scale:d==="slideUp"?1:.95,y:d==="slideUp"?100:0,transition:{duration:.2}}},R={hidden:{opacity:0},visible:{opacity:1},exit:{opacity:0}};return e.jsx(Z,{children:y&&e.jsxs(e.Fragment,{children:[e.jsx(A.div,{variants:R,initial:"hidden",animate:"visible",exit:"exit",onClick:m?n:void 0,className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50"}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none",children:e.jsx(A.div,{variants:j,initial:"hidden",animate:"visible",exit:"exit",className:`relative w-full ${w[g]} pointer-events-auto`,children:e.jsxs("div",{className:`bg-card rounded-2xl shadow-themed-lg border border-border overflow-hidden ${I}`,children:[(x||v)&&e.jsxs("div",{className:"flex items-start justify-between p-6 border-b border-border",children:[e.jsxs("div",{children:[x&&e.jsx("h3",{className:"text-xl font-bold text-foreground mb-1",children:x}),p&&e.jsx("p",{className:"text-sm text-muted-foreground",children:p})]}),v&&e.jsx("button",{onClick:n,className:"p-2 rounded-lg hover:bg-muted transition-colors","aria-label":"Fechar",children:e.jsx(ee,{className:"w-5 h-5 text-muted-foreground"})})]}),e.jsx("div",{className:"p-6",children:l}),h&&e.jsx("div",{className:"p-6 border-t border-border bg-muted/30",children:h})]})})})]})})},he=({isOpen:y,onClose:n,onSubmit:x,title:p,description:l,children:h,submitLabel:g="Salvar",cancelLabel:d="Cancelar",loading:v=!1,size:m="md"})=>e.jsx(Q,{isOpen:y,onClose:n,title:p,description:l,size:m,footer:e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(N,{variant:"outline",onClick:n,disabled:v,children:d}),e.jsx(N,{variant:"primary",onClick:x,loading:v,children:g})]}),children:h}),Ee=()=>{const y=ae(),{user:n}=se(),[x,p]=i.useState(!0),[l,h]=i.useState([]),[g,d]=i.useState(""),[v,m]=i.useState(!1),[I,w]=i.useState(!1),[j,R]=i.useState(null),[S,P]=i.useState(""),[t,H]=i.useState({totalStudents:0,activeActivities:0,participationRate:0}),[s,u]=i.useState({name:"",subject:"",schedule:"",room:"",capacity:"",description:"",bannerColor:"from-blue-500 to-purple-500"}),[W,z]=i.useState(!1),G=[{name:"Azul-Roxo",value:"from-blue-500 to-purple-500"},{name:"Verde-Azul",value:"from-emerald-500 to-cyan-500"},{name:"Roxo-Rosa",value:"from-purple-500 to-pink-500"},{name:"Laranja-Vermelho",value:"from-orange-500 to-red-500"},{name:"Amarelo-Laranja",value:"from-yellow-500 to-orange-500"},{name:"Verde-Limão",value:"from-green-500 to-lime-500"}];i.useEffect(()=>{n&&M()},[n]);const M=async()=>{try{p(!0),console.log("🔄 Carregando turmas do professor...");const{data:a,error:r}=await k.from("classes").select("*").eq("created_by",n.id).order("created_at",{ascending:!1});if(r)throw console.error("❌ Erro na query de turmas:",r),r;const o=await Promise.all((a||[]).map(async f=>{const[C,Y]=await Promise.all([k.from("class_members").select("id",{count:"exact",head:!0}).eq("class_id",f.id).eq("role","student"),k.from("activities").select("id",{count:"exact",head:!0}).eq("class_id",f.id)]);return{...f,students:C.count||0,activities:Y.count||0}}));h(o),console.log(`✅ ${o.length} turmas carregadas`);const $=o.reduce((f,C)=>f+C.students,0),F=o.reduce((f,C)=>f+C.activities,0);H({totalStudents:$,activeActivities:F,participationRate:$>0?Math.round(F/$*100):0})}catch(a){console.error("❌ Erro ao carregar turmas:",a),c.error(`Erro ao carregar turmas: ${a.message}`),h([])}finally{p(!1)}},K=async()=>{if(!s.name.trim()){c.error("Digite um nome para a turma");return}if(!s.subject.trim()){c.error("Digite a disciplina");return}z(!0);try{const{data:a,error:r}=await k.from("classes").insert([{name:s.name,subject:s.subject,description:s.description||null,created_by:n.id,room_number:s.room||null,student_capacity:s.capacity?parseInt(s.capacity):null}]).select().single();if(r)throw r;c.success("Turma criada com sucesso!"),m(!1),u({name:"",subject:"",schedule:"",room:"",capacity:"",description:"",bannerColor:"from-blue-500 to-purple-500"}),M()}catch(a){console.error("Erro ao criar turma:",a),c.error("Erro ao criar turma")}finally{z(!1)}},L=async a=>{try{const r=await _.createInvite(a.id,{maxUses:50,expiresInHours:168}),o=_.getInviteLink(r.invitation_code);await navigator.clipboard.writeText(o),c.success("Link de convite copiado!")}catch(r){console.error("Erro ao gerar convite:",r),c.error("Erro ao gerar link de convite")}},X=async()=>{j&&(await L(j),w(!1))},q=async()=>{if(!S.trim()){c.warning("Digite um email válido","Campo obrigatório");return}try{await new Promise(a=>setTimeout(a,1e3)),c.success(`Convite enviado para ${S}!`,"Sucesso"),P("")}catch{c.error("Erro ao enviar convite","Erro")}},J=[{title:"Total de Turmas",value:l.length.toString(),change:`${l.length} turma${l.length!==1?"s":""}`,trend:l.length>0?"up":"neutral",icon:E},{title:"Total de Alunos",value:t.totalStudents.toString(),change:`${t.totalStudents} aluno${t.totalStudents!==1?"s":""}`,trend:t.totalStudents>0?"up":"neutral",icon:E},{title:"Atividades Ativas",value:t.activeActivities.toString(),change:`${t.activeActivities} criada${t.activeActivities!==1?"s":""}`,trend:t.activeActivities>0?"up":"neutral",icon:U},{title:"Taxa de Participação",value:`${t.participationRate}%`,change:t.participationRate>70?"Excelente":t.participationRate>40?"Bom":"Melhorar",trend:t.participationRate>70?"up":t.participationRate>40?"neutral":"down",icon:te}],D=l.filter(a=>a.name.toLowerCase().includes(g.toLowerCase()));return x?e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsx("div",{className:"skeleton h-32 w-full rounded-2xl"}),e.jsx("div",{className:"grid grid-cols-4 gap-6",children:[1,2,3,4].map(a=>e.jsx("div",{className:"skeleton h-32 rounded-xl"},a))}),e.jsx(re,{type:"card"})]}):e.jsxs(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-8",children:[e.jsxs("div",{className:"bg-gradient-primary p-8 rounded-2xl text-white relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-10",children:e.jsx("div",{className:"absolute inset-0",style:{backgroundImage:"radial-gradient(circle at 1px 1px, white 1px, transparent 0)",backgroundSize:"40px 40px"}})}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Minhas Turmas"}),e.jsx("p",{className:"text-white/90",children:"Gerencie suas turmas e acompanhe o progresso dos alunos"})]})]}),e.jsx("div",{className:"stagger-children grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:J.map(a=>e.jsx(ie,{...a},a.title))}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsx(b,{placeholder:"Buscar turmas...",value:g,onChange:a=>d(a.target.value),leftIcon:B,clearable:!0})}),e.jsx(N,{variant:"gradient",leftIcon:V,onClick:()=>m(!0),children:"Nova Turma"})]}),D.length===0?l.length===0?e.jsx(ce,{onCreate:()=>m(!0)}):e.jsx(de,{variant:"search",icon:B,title:"Nenhuma turma encontrada",description:`Não encontramos turmas com "${g}"`,actionLabel:"Limpar busca",onAction:()=>d("")}):e.jsx("div",{className:"stagger-children grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:D.map((a,r)=>e.jsx(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:r*.05},children:e.jsx(ne,{variant:"elevated",hover:!0,onClick:()=>y(`/dashboard/classes/${a.id}`),className:"cursor-pointer",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`w-12 h-12 bg-gradient-to-br ${a.bannerColor||"from-blue-500 to-purple-500"} rounded-xl flex items-center justify-center`,children:e.jsx(E,{className:"w-6 h-6 text-white"})}),e.jsx(le,{icon:me,variant:"ghost",size:"sm",onClick:o=>{o.stopPropagation()}})]}),e.jsx("h3",{className:"text-xl font-bold text-foreground mb-2",children:a.name}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-foreground",children:a.students}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Alunos"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-foreground",children:a.activities}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Atividades"})]})]}),a.nextClass?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-4",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsxs("span",{children:["Próxima aula: ",a.nextClass]})]}):e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-4",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsx("span",{children:"Nenhuma aula agendada"})]}),e.jsx(N,{variant:"outline",size:"sm",leftIcon:ue,onClick:o=>{o.stopPropagation(),L(a)},className:"w-full",children:"Convidar Alunos"})]})})},a.id))}),e.jsx(he,{isOpen:v,onClose:()=>m(!1),onSubmit:K,title:"Criar Nova Turma",description:"Preencha os dados da nova turma",submitLabel:"Criar Turma",loading:W,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(b,{label:"Nome da Turma",value:s.name,onChange:a=>u({...s,name:a.target.value}),placeholder:"Ex: Turma A",leftIcon:E,required:!0,autoFocus:!0}),e.jsx(b,{label:"Disciplina",value:s.subject,onChange:a=>u({...s,subject:a.target.value}),placeholder:"Ex: Matemática",leftIcon:U,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(b,{label:"Horário",value:s.schedule,onChange:a=>u({...s,schedule:a.target.value}),placeholder:"Ex: Seg/Qua 14:00-16:00",leftIcon:T}),e.jsx(b,{label:"Sala",value:s.room,onChange:a=>u({...s,room:a.target.value}),placeholder:"Ex: Sala 12"})]}),e.jsx(b,{label:"Capacidade",type:"number",value:s.capacity,onChange:a=>u({...s,capacity:a.target.value}),placeholder:"Ex: 30"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Descrição (opcional)"}),e.jsx("textarea",{className:"w-full px-4 py-2 rounded-lg border border-input bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-ring resize-none",rows:3,value:s.description,onChange:a=>u({...s,description:a.target.value}),placeholder:"Descrição da turma..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-3",children:"Cor do Banner"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:G.map(a=>e.jsxs("button",{type:"button",onClick:()=>u({...s,bannerColor:a.value}),className:`relative h-16 rounded-lg bg-gradient-to-br ${a.value} transition-all ${s.bannerColor===a.value?"ring-2 ring-primary ring-offset-2 scale-105":"hover:scale-105"}`,children:[s.bannerColor===a.value&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-6 h-6 bg-white rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-primary",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})}),e.jsx("span",{className:"sr-only",children:a.name})]},a.value))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Escolha uma cor para o ícone da turma"})]})]})}),e.jsx(Q,{isOpen:I,onClose:()=>{w(!1),P("")},title:`Convidar Alunos - ${j?.name}`,description:"Convide alunos por email ou compartilhe o código da turma",hideActions:!0,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-lg border-2 border-primary/20",children:[e.jsxs("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4"}),"Código de Convite"]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("code",{className:"flex-1 px-4 py-3 bg-white dark:bg-gray-800 rounded-lg font-mono text-lg font-bold text-primary border-2 border-primary/30",children:j?.inviteCode||"MAT-ABC123"}),e.jsx(N,{variant:"outline",size:"sm",leftIcon:pe,onClick:X,children:"Copiar"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"💡 Compartilhe este código com seus alunos para que eles possam entrar na turma"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-border"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"ou"})})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),"Enviar Convite por Email"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{placeholder:"email@exemplo.com",type:"email",value:S,onChange:a=>P(a.target.value),leftIcon:O,className:"flex-1",onKeyPress:a=>a.key==="Enter"&&q()}),e.jsx(N,{variant:"gradient",onClick:q,disabled:!S.trim(),children:"Enviar"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"O aluno receberá um email com o link e código de acesso à turma"})]}),e.jsx("div",{className:"p-3 bg-info/10 border border-info/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-info dark:text-info-foreground",children:[e.jsx("strong",{children:"Dica:"})," Você também pode compartilhar o código via WhatsApp, Telegram ou qualquer outro app de mensagens!"]})})]})}),e.jsx("div",{className:"lg:hidden",children:e.jsx(oe,{icon:V,onClick:()=>m(!0)})})]})};export{Ee as default};
