import{f as R,u as $,r as s,s as h,aq as w,j as e,C as I,A as T,bo as q,ak as B,bO as X,ag as L}from"./main-NgjJy_CG.js";import{P as F}from"./PremiumCard-BGO_It48.js";import{P as C}from"./PremiumButton-DDGOGflQ.js";import{E as M}from"./EmptyState-Cb7n_MKP.js";import{C as U}from"./ChatbotWidget-qVonXUzu.js";import{P as A}from"./play-CPutuHnO.js";import{U as W}from"./upload-B6TEbMs0.js";import"./bot-C1f7hJe0.js";import"./send-DtvIXJ49.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],D=R("pause",z),H=({variant:i="full",onComplete:n})=>{const{user:f}=$(),[o,c]=s.useState(25),[a,m]=s.useState(0),[t,u]=s.useState(!1),[r,g]=s.useState(!1),[v,S]=s.useState(0),k=s.useRef(null);s.useRef(null),s.useEffect(()=>(t?k.current=setInterval(()=>{a===0?o===0?_():(c(o-1),m(59)):m(a-1)},1e3):clearInterval(k.current),()=>clearInterval(k.current)),[t,o,a]);const _=async()=>{if(u(!1),P(),r)w({title:"‚è∞ Intervalo Completo!",description:"Hora de voltar ao trabalho!",variant:"default"}),g(!1),c(25),m(0);else{S(b=>b+1);const p=o===25?10:o===50?20:5;if(f&&f.user_metadata?.role==="student")try{await h.from("xp_log").insert({user_id:f.id,xp:p,reason:`Pomodoro completo (${o+1} min)`,source:"pomodoro"}),w({title:"üéâ Sess√£o Completa!",description:`Parab√©ns! Voc√™ ganhou ${p} XP!`,variant:"success"})}catch(b){console.error("Erro ao registrar XP:",b)}else w({title:"‚úÖ Sess√£o Completa!",description:"√ìtimo trabalho! Hora de uma pausa.",variant:"success"});g(!0),c(5),m(0)}n&&n()},P=()=>{try{new Audio("/notification.mp3").play().catch(()=>{window.navigator.vibrate&&window.navigator.vibrate([200,100,200])})}catch{}},l=()=>{u(!t)},x=()=>{u(!1),g(!1),c(25),m(0)},d=p=>{u(!1),g(!1),c(p),m(0)},j=(((r?5:25)-o)*60+(60-a))/((r?5:25)*60)*100;return i==="compact"?e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-lg border border-purple-200 dark:border-purple-800 text-white hover:opacity-90",children:[e.jsx(I,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-2xl font-bold font-mono",children:[String(o).padStart(2,"0"),":",String(a).padStart(2,"0")]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:r?"Intervalo":"Foco"})]}),e.jsx(C,{size:"sm",onClick:l,variant:t?"destructive":"default",children:t?e.jsx(D,{className:"w-4 h-4"}):e.jsx(A,{className:"w-4 h-4"})})]}):e.jsx(F,{variant:"elevated",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center",children:e.jsx(I,{className:"w-6 h-6 text-slate-900 dark:text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold",children:"Pomodoro Timer"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r?"Tempo de Intervalo":"Tempo de Foco"})]})]}),f?.user_metadata?.role==="student"&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-yellow-500/10 rounded-lg",children:[e.jsx(T,{className:"w-4 h-4 text-yellow-600"}),e.jsxs("span",{className:"text-sm font-semibold text-yellow-600",children:[v*10," XP hoje"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("svg",{className:"w-full h-64",viewBox:"0 0 200 200",children:[e.jsx("circle",{cx:"100",cy:"100",r:"90",fill:"none",stroke:"currentColor",strokeWidth:"4",className:"text-muted"}),e.jsx("circle",{cx:"100",cy:"100",r:"90",fill:"none",stroke:"url(#gradient)",strokeWidth:"8",strokeLinecap:"round",strokeDasharray:`${2*Math.PI*90}`,strokeDashoffset:`${2*Math.PI*90*(1-j/100)}`,transform:"rotate(-90 100 100)",className:"transition-all duration-1000"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"gradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#a855f7"}),e.jsx("stop",{offset:"100%",stopColor:"#ec4899"})]})})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"text-6xl font-bold font-mono bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent text-white hover:opacity-90",children:[String(o).padStart(2,"0"),":",String(a).padStart(2,"0")]}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-2",children:[Math.round(j),"% completo"]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(C,{onClick:l,className:"flex-1",size:"lg",variant:t?"destructive":"default",children:t?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-5 h-5 mr-2"}),"Pausar"]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-5 h-5 mr-2"}),"Iniciar"]})}),e.jsx(C,{onClick:x,variant:"outline",size:"lg",children:e.jsx(q,{className:"w-5 h-5"})})]}),!t&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>d(25),className:"flex-1 px-3 py-2 text-sm bg-muted hover:bg-muted/80 rounded-lg transition-colors",children:"25 min"}),e.jsx("button",{onClick:()=>d(50),className:"flex-1 px-3 py-2 text-sm bg-muted hover:bg-muted/80 rounded-lg transition-colors",children:"50 min"}),e.jsx("button",{onClick:()=>d(5),className:"flex-1 px-3 py-2 text-sm bg-muted hover:bg-muted/80 rounded-lg transition-colors",children:"5 min"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-border",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:v}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Sess√µes Hoje"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-pink-600",children:v*25}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Minutos de Foco"})]})]}),f?.user_metadata?.role==="student"&&e.jsx("div",{className:"bg-gradient-to-r from-purple-500/10 to-pink-500/10 p-3 rounded-lg text-center text-white hover:opacity-90",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["‚ú® Complete sess√µes e ganhe ",e.jsx("strong",{className:"text-purple-600",children:"10 XP"})," por sess√£o de 25min!"]})})]})})},te=()=>{const{activityId:i}=B(),{user:n}=$(),{addXP:f}=X(),[o,c]=s.useState(!0),[a,m]=s.useState(null),[t,u]=s.useState(null),[r,g]=s.useState(null),[v,S]=s.useState(!1),[k,_]=s.useState("");s.useEffect(()=>{(async()=>{if(i){c(!0),_("");try{const{data:x,error:d}=await h.from("activities").select("*").eq("id",i).maybeSingle();if(d)throw d;if(m(x),n?.id){const{data:j}=await h.from("submissions").select("*").eq("activity_id",i).eq("student_id",n.id).maybeSingle();u(j||null)}}catch(x){console.error("Erro ao carregar atividade:",x),_("N√£o foi poss√≠vel carregar a atividade.")}finally{c(!1)}}})()},[i,n?.id]);const P=async()=>{if(!(!r||!n?.id)){S(!0);try{const l=r.name.split(".").pop(),x=`${n.id}/${i}/${Date.now()}.${l}`,{error:d}=await h.storage.from("submissions").upload(x,r,{upsert:!0});if(d)throw d;const{data:j}=h.storage.from("submissions").getPublicUrl(x),p=j?.publicUrl||null,b={activity_id:i,student_id:n.id,content:{file_url:p,file_name:r.name},status:"submitted",submitted_at:new Date().toISOString(),updated_at:new Date().toISOString()};let E;if(t?.id){const{data:N,error:y}=await h.from("submissions").update(b).eq("id",t.id).select().maybeSingle();if(y)throw y;E=N,u(N)}else{const{data:N,error:y}=await h.from("submissions").insert(b).select().maybeSingle();if(y)throw y;E=N,u(N),await f(20,"Atividade submetida",{activity_id:i,submission_id:E.id,activity_title:a.title})}w.success?.("Atividade enviada com sucesso!")}catch(l){console.error("Erro ao enviar atividade:",l),w.error?.("Erro ao enviar atividade")}finally{S(!1)}}};return a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-indigo-600 to-purple-600 p-8 rounded-2xl text-white",children:[e.jsx("h1",{className:"text-2xl font-bold",children:a.title}),a.due_date&&e.jsxs("p",{className:"text-slate-900 dark:text-white/90",children:["Entrega at√© ",new Date(a.due_date).toLocaleString("pt-BR")]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsx(F,{variant:"elevated",children:e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold mb-1",children:"Descri√ß√£o"}),e.jsx("p",{className:"text-muted-foreground",children:a.description||"Sem descri√ß√£o"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold mb-2",children:"Enviar minha resposta"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"file",onChange:l=>g(l.target.files?.[0]||null)}),e.jsx(C,{onClick:P,disabled:!r||v,leftIcon:W,children:v?"Enviando...":"Enviar"})]}),t&&e.jsxs("div",{className:"mt-3 text-sm text-muted-foreground",children:["√öltimo envio: ",new Date(t.submitted_at||t.updated_at).toLocaleString("pt-BR")," ",t.content?.file_name?`- ${t.content.file_name}`:""]})]})]})})}),e.jsx("div",{className:"space-y-6",children:e.jsx(H,{variant:"full"})})]}),e.jsx(U,{context:{activityId:i,classId:a?.class_id}})]}):e.jsx(M,{title:"Atividade n√£o encontrada",description:"Verifique o link e tente novamente.",icon:L})};export{te as default};
