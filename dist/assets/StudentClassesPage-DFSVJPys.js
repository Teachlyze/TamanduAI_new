import{u as k,r as d,j as e,o as q,U as y,s as c,ar as j}from"./main-Cv3DLBs1.js";import{P as E}from"./PremiumCard-C8PJt07T.js";import{P as S}from"./PremiumButton-DEtqLbhG.js";import{E as P}from"./EmptyState-BvWI2uN2.js";const L=()=>{const{user:t}=k(),[C,v]=d.useState(!0),[b,p]=d.useState([]),[_,x]=d.useState(""),[w,g]=d.useState(!1),[f,N]=d.useState("");return d.useEffect(()=>{if(!t?.id)return;(async()=>{v(!0),x("");try{const{data:i,error:o}=await c.from("class_members").select("class_id, joined_at").eq("user_id",t.id).eq("role","student").order("joined_at",{ascending:!1});if(o)throw o;const l=(i||[]).map(a=>a.class_id);if(l.length===0){p([]);return}const{data:m,error:n}=await c.from("classes").select("id, name, subject, color, created_by, is_active").in("id",l);if(n)throw n;const u=new Map(l.map((a,r)=>[a,r])),h=(m||[]).sort((a,r)=>(u.get(a.id)??0)-(u.get(r.id)??0));p(h)}catch(i){console.error("Erro ao carregar turmas do aluno:",i),x("Não foi possível carregar suas turmas.")}finally{v(!1)}})()},[t?.id]),C?e.jsx(q,{message:"Carregando suas turmas..."}):e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"bg-gradient-to-br from-emerald-600 to-teal-600 p-8 rounded-2xl text-white",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-3",children:[e.jsx(y,{className:"w-6 h-6"})," Minhas Turmas"]}),e.jsx("p",{className:"text-white/90",children:"Veja as turmas das quais você participa"})]}),e.jsx(E,{variant:"elevated",children:e.jsxs("div",{className:"p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Entrar em uma turma com código"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("input",{type:"text",placeholder:"Código da turma",value:f,onChange:s=>N(s.target.value.trim()),className:"flex-1 px-3 py-2 rounded-lg border border-border bg-background"}),e.jsx(S,{variant:"gradient",disabled:!f||w,onClick:async()=>{if(!(!t?.id||!f)){g(!0),x("");try{const{data:s,error:i}=await c.from("classes").select("id, name").eq("invite_code",f).maybeSingle();if(i)throw i;if(!s){j.error?.("Código inválido."),g(!1);return}const{error:o}=await c.from("class_members").insert({class_id:s.id,user_id:t.id,role:"student",joined_at:new Date().toISOString()});if(o&&o.code!=="23505")throw o;j.success?.(`Você entrou na turma ${s.name}.`),N("");const{data:l}=await c.from("class_members").select("class_id, joined_at").eq("user_id",t.id).eq("role","student").order("joined_at",{ascending:!1}),m=(l||[]).map(n=>n.class_id);if(m.length===0)p([]);else{const{data:n}=await c.from("classes").select("id, name, subject, color, created_by, is_active").in("id",m),u=new Map(m.map((a,r)=>[a,r])),h=(n||[]).sort((a,r)=>(u.get(a.id)??0)-(u.get(r.id)??0));p(h)}}catch(s){console.error("Erro ao entrar na turma:",s),x("Não foi possível entrar na turma."),j.error?.("Não foi possível entrar na turma.")}finally{g(!1)}}},children:w?"Entrando...":"Entrar"})]})]})}),_&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md text-sm",children:_}),b.length===0?e.jsx(P,{icon:y,title:"Você ainda não participa de nenhuma turma",description:"Peça ao seu professor um código de convite para entrar em uma turma.",action:e.jsx(S,{variant:"gradient",size:"sm",onClick:()=>window.location.assign("/join/"),children:"Entrar em uma turma"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:b.map(s=>e.jsx(E,{variant:"elevated",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-bold",children:s.name}),e.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-emerald-100 text-emerald-700",children:s.is_active?"Ativa":"Inativa"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.subject||"Sem disciplina"})]})},s.id))})]})};export{L as default};
