const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/exceljs.min-C9KHanwI.js","assets/main-NgjJy_CG.js","assets/main-Cl0sLNFQ.css"])))=>i.map(i=>d[i]);
import{f as ye,_ as we,u as je,r as c,s as S,T as H,k as F,U as J,B as Ne,b1 as ke,j as e,m as C,aO as Y,aP as Q,aQ as W,aR as X,aS as Z,i as K,O as Se,ae as _e,ag as Ee,x as ee,y as te,Q as Re,W as De,X as Ce,Y as Ae,F as Te,H as Fe}from"./main-NgjJy_CG.js";import{t as h}from"./use-toast-GUBWlXfL.js";import{u as Oe}from"./useUserRole-QdKsLtvX.js";import{F as Me}from"./funnel-CchVKkoO.js";import{D as Le}from"./download-BtFddqD_.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],Pe=ye("file-spreadsheet",$e),qe=async()=>{try{const m=await we(()=>import("./exceljs.min-C9KHanwI.js").then(u=>u.e),__vite__mapDeps([0,1,2]));return m.default||m}catch(m){throw console.error("Failed to load ExcelJS:",m),m}},He=()=>{const{isTeacher:m}=Oe(),{user:u}=je(),[_,ae]=c.useState("month"),[g,re]=c.useState("all"),[se,ie]=c.useState("overview"),[f,A]=c.useState(!1),[Ue,T]=c.useState(!0),[O,oe]=c.useState([]),[v,M]=c.useState({totalStudents:0,totalActivities:0,averageGrade:0,completionRate:0,topStudents:[],activityStats:[],classPerformance:[]});c.useEffect(()=>{const t=r=>{f&&!r.target.closest(".export-menu-container")&&A(!1)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[f]);const ne=()=>{A(!f)},L=t=>{A(!1),$(`export:${t}`)};c.useEffect(()=>{u&&(async()=>{try{const{data:t,error:r}=await S.from("classes").select("id, name").eq("created_by",u.id).eq("is_active",!0).order("name");if(r)throw r;oe([{id:"all",name:"Todas as Turmas"},...t||[]])}catch(t){console.error("Erro ao carregar turmas:",t)}})()},[u]);const de=()=>{const t=new Date,r=new Date(t);switch(_){case"week":return r.setDate(t.getDate()-7),r;case"quarter":return r.setMonth(t.getMonth()-3),r;case"year":return r.setFullYear(t.getFullYear()-1),r;case"month":default:return r.setMonth(t.getMonth()-1),r}};c.useEffect(()=>{u&&(async()=>{try{T(!0);const t=de();let r=S.from("classes").select("id, name").eq("created_by",u.id).eq("is_active",!0);g!=="all"&&(r=r.eq("id",g));const{data:p,error:i}=await r;if(i)throw i;const n=(p||[]).map(a=>a.id);if(n.length===0){M({totalStudents:0,totalActivities:0,averageGrade:0,completionRate:0,topStudents:[],activityStats:[],classPerformance:[]}),T(!1);return}const{data:s,error:w}=await S.from("class_members").select("user_id, class_id, profiles:user_id(id, full_name, avatar_url)").in("class_id",n).eq("role","student");if(w)throw w;const b=[...new Set((s||[]).map(a=>a.user_id))],{data:d,error:G}=await S.from("activity_class_assignments").select(`
            activity_id,
            class_id,
            activities!inner(
              id,
              title,
              due_date,
              max_score,
              created_by,
              created_at
            )
          `).in("class_id",n).eq("activities.created_by",u.id).gte("activities.created_at",t.toISOString());if(G)throw G;const E=(d||[]).map(a=>({id:a.activities.id,title:a.activities.title,due_date:a.activities.due_date,max_score:a.activities.max_score,class_id:a.class_id})),me=E.map(a=>a.id),{data:R,error:I}=await S.from("submissions").select("id, activity_id, student_id, grade, submitted_at, status").in("activity_id",me).in("student_id",b);if(I)throw I;const B=b.length,V=E.length,D=(R||[]).filter(a=>a.grade!==null),ue=D.length>0?D.reduce((a,o)=>a+Number(o.grade||0),0)/D.length:0,z=B*V,xe=(R||[]).filter(a=>a.status==="graded"||a.status==="submitted").length,he=z>0?xe/z*100:0,j={};for(const a of D)j[a.student_id]||(j[a.student_id]={total:0,count:0}),j[a.student_id].total+=Number(a.grade||0),j[a.student_id].count+=1;const ge=Object.entries(j).map(([a,o])=>{const x=(s||[]).find(N=>N.user_id===a)?.profiles;return{id:a,name:x?.full_name||"Aluno",avatar:x?.avatar_url,average:o.total/o.count,activities:o.count}}).sort((a,o)=>o.average-a.average).slice(0,10),pe=E.map(a=>{const o=(R||[]).filter(y=>y.activity_id===a.id),x=o.filter(y=>y.grade!==null),N=x.length>0?x.reduce((y,k)=>y+Number(k.grade||0),0)/x.length:0;return{id:a.id,title:a.title,submissions:o.length,avgScore:N.toFixed(1),dueDate:a.due_date}}),fe=(p||[]).map(a=>{const o=(s||[]).filter(l=>l.class_id===a.id),x=E.filter(l=>l.class_id===a.id),N=x.map(l=>l.id),k=(R||[]).filter(l=>N.includes(l.activity_id)).filter(l=>l.grade!==null),ve=k.length>0?k.reduce((l,be)=>l+Number(be.grade||0),0)/k.length:0;return{id:a.id,name:a.name,students:o.length,activities:x.length,avgGrade:ve.toFixed(1)}});M({totalStudents:B,totalActivities:V,averageGrade:Number(ue.toFixed(1)),completionRate:Number(he.toFixed(1)),topStudents:ge,activityStats:pe,classPerformance:fe})}catch(t){console.error("Erro ao carregar relatórios (teacher dashboard):",t),h({variant:"destructive",title:"Erro",description:"Falha ao carregar relatórios"})}finally{T(!1)}})()},[u,g,_]);const le=async()=>{try{const t=await qe(),r=v.activityStats.map(d=>({data:d.dueDate?new Date(d.dueDate).toLocaleDateString("pt-BR"):"-",atividade:d.title,concluido:d.submissions>0?"Sim":"Não",nota:d.avgScore})),p=new t.Workbook,i=p.addWorksheet("Relatório");i.columns=[{header:"Data",key:"data",width:15},{header:"Atividade",key:"atividade",width:30},{header:"Concluído",key:"concluido",width:15},{header:"Nota",key:"nota",width:10}],i.addRows(r),i.getRow(1).font={bold:!0},i.getRow(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF1E88E5"}},i.getRow(1).alignment={vertical:"middle",horizontal:"center"},i.columns.forEach(d=>{d.width=d.header.length<12?12:d.header.length});const n=await p.xlsx.writeBuffer(),s=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),w=window.URL.createObjectURL(s),b=document.createElement("a");b.href=w,b.download=`relatorio-${new Date().toISOString().split("T")[0]}.xlsx`,b.click(),window.URL.revokeObjectURL(w),h({title:"Relatório exportado!",description:"O relatório em Excel foi baixado com sucesso."})}catch(t){console.error("Erro ao exportar para Excel:",t),h({variant:"destructive",title:"Erro ao exportar para Excel",description:t.message||"Ocorreu um erro ao exportar para Excel."})}},ce=()=>{try{const r=`
        <!DOCTYPE html>
        <html>
          <head>
            <title>Relatório de Atividades</title>
            <style>
              body { font-family: Arial, sans-serif; margin: 20px; }
              table { width: 100%; border-collapse: collapse; margin-top: 20px; }
              th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
              th { background-color: #2980b9; color: white; }
              tr:nth-child(even) { background-color: #f2f2f2; }
              h1 { color: #2980b9; }
            </style>
          </head>
          <body>
            <h1>Relatório de Atividades</h1>
            <table>
              <thead>
                <tr>
                  <th>Data</th>
                  <th>Atividade</th>
                  <th>Concluído</th>
                  <th>Nota</th>
                </tr>
              </thead>
              <tbody>
                ${v.activityStats.map(s=>({data:s.dueDate?new Date(s.dueDate).toLocaleDateString("pt-BR"):"-",atividade:s.title,concluido:s.submissions>0?"Sim":"Não",nota:s.avgScore})).map(s=>`
                  <tr>
                    <td>${s.data}</td>
                    <td>${s.atividade}</td>
                    <td>${s.concluido}</td>
                    <td>${s.nota}</td>
                  </tr>
                `).join("")}
              </tbody>
            </table>
          </body>
        </html>
      `,p=new Blob([r],{type:"text/html"}),i=window.URL.createObjectURL(p),n=document.createElement("a");n.href=i,n.download=`relatorio-${new Date().toISOString().split("T")[0]}.html`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(i),h({title:"Relatório exportado!",description:"O relatório foi baixado como HTML."})}catch(t){console.error("Erro ao exportar para PDF:",t),h({variant:"destructive",title:"Erro ao exportar relatório",description:t.message||"Ocorreu um erro ao exportar o relatório."})}},$=async t=>{try{switch(t){case"export:excel":le();break;case"export:pdf":ce();break;case"filter":h({title:"Filtros aplicados",description:`Período: ${q.find(r=>r.id===_)?.name}, Turma: ${g==="all"?"Todas":O.find(r=>r.id===g)?.name||g}`});break;default:h({title:"Ação não implementada",description:`A ação ${t} ainda não foi implementada.`})}}catch(r){h({variant:"destructive",title:"Erro",description:r.message||"Ocorreu um erro ao processar sua solicitação."})}},P=[{name:"Taxa de Conclusão",value:`${v.completionRate}%`,icon:H,gradient:"from-green-500 to-emerald-500"},{name:"Média Geral",value:`${v.averageGrade}`,icon:F,gradient:"from-blue-500 to-cyan-500"},{name:"Alunos",value:`${v.totalStudents}`,icon:J,gradient:"from-purple-500 to-pink-500"},{name:"Atividades",value:`${v.totalActivities}`,icon:Ne,gradient:"from-orange-500 to-red-500"}],q=[{id:"week",name:"Semana"},{id:"month",name:"Mês"},{id:"quarter",name:"Trimestre"},{id:"year",name:"Ano"}],U=c.useMemo(()=>[{id:"overview",name:"Visão Geral",icon:ke},{id:"performance",name:"Desempenho",icon:F},...m?[{id:"engagement",name:"Engajamento",icon:H},{id:"attendance",name:"Frequência",icon:J}]:[]],[m]);return e.jsxs("div",{className:"w-full space-y-8",children:[e.jsxs(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"relative overflow-hidden bg-gradient-to-br from-blue-600 via-purple-600 to-indigo-600 rounded-3xl p-8 text-white",children:[e.jsx("div",{className:"relative z-10",children:e.jsx("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl lg:text-4xl font-bold mb-3",children:"📊 Relatórios & Analytics"}),e.jsx("p",{className:"text-blue-100 text-lg max-w-2xl",children:"Acompanhe métricas detalhadas e insights sobre o desempenho das suas turmas e atividades educacionais."})]})})}),e.jsx("div",{className:"absolute top-0 right-0 w-96 h-96 bg-gradient-to-br from-white/10 to-transparent rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-64 h-64 bg-gradient-to-tr from-white/5 to-transparent rounded-full blur-2xl"}),e.jsx("div",{className:"hidden lg:block absolute top-8 right-8",children:e.jsx("div",{className:"w-24 h-24 bg-white/10 rounded-2xl flex items-center justify-center backdrop-blur-sm",children:e.jsx(F,{className:"w-12 h-12 text-white"})})})]}),e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},className:"bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 p-6 shadow-lg",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-start lg:items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:"Filtros:"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 flex-1",children:[e.jsxs(Y,{value:g,onValueChange:re,children:[e.jsx(Q,{className:"w-full sm:w-64 rounded-xl",children:e.jsx(W,{placeholder:"Selecionar turma"})}),e.jsx(X,{children:O.map(t=>e.jsx(Z,{value:t.id,children:t.name},t.id))})]}),e.jsxs(Y,{value:_,onValueChange:ae,children:[e.jsx(Q,{className:"w-full sm:w-48 rounded-xl",children:e.jsx(W,{placeholder:"Selecionar período"})}),e.jsx(X,{children:q.map(t=>e.jsx(Z,{value:t.id,children:t.name},t.id))})]}),e.jsxs(K,{variant:"outline",onClick:()=>$("filter"),className:"whitespace-nowrap inline-flex items-center gap-2 rounded-xl hover:bg-blue-50 dark:hover:bg-muted/30",children:[e.jsx(Se,{className:"w-4 h-4"}),e.jsx("span",{children:"Aplicar Filtros"})]}),m&&e.jsxs("div",{className:"relative export-menu-container ml-auto",children:[e.jsxs(K,{variant:"outline",className:"whitespace-nowrap inline-flex items-center gap-2 rounded-xl",onClick:ne,"aria-expanded":f,"aria-haspopup":"true",children:[e.jsx(Le,{className:"w-4 h-4"}),e.jsx("span",{children:"Exportar"}),e.jsx(_e,{className:"w-4 h-4 transition-transform",style:{transform:f?"rotate(180deg)":"none"}})]}),f&&e.jsx("div",{className:"absolute right-0 mt-2 w-56 rounded-xl shadow-xl bg-white dark:bg-gray-800 ring-1 ring-black/5 dark:ring-gray-700 z-50 backdrop-blur-xl",children:e.jsxs("div",{className:"py-2",children:[e.jsxs("button",{onClick:()=>L("excel"),className:"w-full text-left px-4 py-3 text-sm text-gray-800 dark:text-gray-200 hover:bg-green-50 dark:hover:bg-green-900/20 hover:text-green-700 dark:hover:text-green-300 flex items-center gap-3 transition-all duration-200 rounded-lg mx-2",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center",children:e.jsx(Pe,{className:"w-4 h-4 text-green-600 dark:text-green-500"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Exportar para Excel"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Planilha .xlsx"})]})]}),e.jsxs("button",{onClick:()=>L("pdf"),className:"w-full text-left px-4 py-3 text-sm text-gray-800 dark:text-gray-200 hover:bg-red-50 dark:hover:bg-red-900/20 hover:text-red-700 dark:hover:text-red-300 flex items-center gap-3 transition-all duration-200 rounded-lg mx-2",children:[e.jsx("div",{className:"w-8 h-8 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center",children:e.jsx(Ee,{className:"w-4 h-4 text-red-600 dark:text-red-500"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Exportar para HTML"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Relatório formatado"})]})]})]})})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:P.map((t,r)=>e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:r*.1+.2},className:"group",children:e.jsx(ee,{className:"relative p-6 bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2",children:e.jsxs(te,{className:"p-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:`w-14 h-14 bg-gradient-to-r ${t.gradient} rounded-2xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform`,children:e.jsx(t.icon,{className:"w-7 h-7 text-white"})}),e.jsx("div",{className:"px-3 py-1 rounded-full text-sm font-medium bg-slate-100 dark:bg-slate-900/30 text-slate-600 dark:text-slate-300",children:"Atual"})]}),e.jsx("h3",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:t.value}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 font-medium",children:t.name})]})})},t.name))}),e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},children:e.jsxs(Re,{value:se,onValueChange:ie,className:"space-y-6",children:[e.jsx(De,{className:"grid w-full grid-cols-2 lg:grid-cols-4 bg-gray-100 dark:bg-gray-800 rounded-2xl p-2",children:U.map(t=>e.jsxs(Ce,{value:t.id,className:"whitespace-nowrap inline-flex items-center gap-2 rounded-xl data-[state=active]:bg-white dark:data-[state=active]:bg-gray-700 data-[state=active]:shadow-sm transition-all",children:[e.jsx(t.icon,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:t.name})]},t.id))}),U.map(t=>e.jsx(Ae,{value:t.id,children:e.jsxs(ee,{className:"rounded-2xl border border-gray-200 dark:border-gray-700 shadow-lg",children:[e.jsx(Te,{className:"pb-4",children:e.jsxs(Fe,{className:"flex items-center gap-3 text-xl",children:[e.jsx("div",{className:`w-10 h-10 bg-gradient-to-r ${P[0].gradient} rounded-xl flex items-center justify-center`,children:e.jsx(t.icon,{className:"w-5 h-5 text-white"})}),t.name]})}),e.jsx(te,{children:e.jsx("div",{className:"h-80 bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-2xl flex items-center justify-center border-2 border-dashed border-gray-300 dark:border-gray-600",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 dark:bg-gray-700 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(t.icon,{className:"w-8 h-8 text-gray-400"})}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 font-medium",children:["Gráfico de ",t.name]}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-2",children:"Dados serão exibidos aqui em breve"})]})})})]})},t.id))]})})]})};export{He as default};
