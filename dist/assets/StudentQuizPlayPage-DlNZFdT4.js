import{a6 as z,g as w,u as E,r as o,j as s,J as f,Q as h,K as P,N as _,i as k,s as u}from"./main-Bujpyeg-.js";const U=()=>{const{quizId:d}=z(),j=w(),{user:l}=E(),[a,b]=o.useState([]),[g,y]=o.useState(""),[N,m]=o.useState(!0),[n,q]=o.useState({}),[v,p]=o.useState(!1);o.useEffect(()=>{(async()=>{try{m(!0);const[{data:i,error:t},{data:r,error:c}]=await Promise.all([u.from("quizzes").select("title").eq("id",d).eq("is_public",!0).single(),u.from("quiz_questions").select("question, position").eq("quiz_id",d).order("position")]);if(t)throw t;if(c)throw c;y(i?.title||"Quiz"),b(r||[])}catch{}finally{m(!1)}})()},[d]);const x=o.useMemo(()=>{let e=0;for(const i of a){const r=((i.question||{}).correta||"").toString().toUpperCase(),c=(n[i.position]||"").toString().toUpperCase();r&&c&&r===c&&(e+=1)}return e},[a,n]),C=(e,i)=>{q(t=>({...t,[e]:i}))},S=async()=>{try{if(!l)return;p(!0);const e=a.map(t=>({qid:t.question?.id,position:t.position,marked:n[t.position]||null,correct:t.question?.correta?t.question.correta.toString().toUpperCase()===(n[t.position]||"").toString().toUpperCase():null})),{error:i}=await u.from("quiz_attempts").insert({quiz_id:d,user_id:l.id,answers:e,score:x});if(i)throw i;j("/students/activities")}catch{}finally{p(!1)}};return N?s.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-primary"})}):s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h1",{className:"text-2xl font-bold",children:g}),s.jsxs("div",{className:"text-sm text-muted-foreground",children:["Pontuação: ",x]})]}),a.length===0?s.jsx(f,{children:s.jsx(h,{className:"py-10 text-center text-muted-foreground",children:"Nenhuma questão encontrada"})}):s.jsxs("div",{className:"space-y-4",children:[a.map(e=>{const i=e.question||{},t=i.alternativas||{};return s.jsxs(f,{children:[s.jsx(P,{children:s.jsxs(_,{className:"text-base",children:[e.position,". ",i.enunciado||"Pergunta"]})}),s.jsx(h,{children:s.jsx("div",{className:"grid gap-2",children:["A","B","C","D"].map(r=>s.jsxs("button",{onClick:()=>C(e.position,r),className:`text-left p-3 border rounded ${n[e.position]===r?"border-primary bg-primary/5":"border-border hover:bg-muted/50"}`,children:[s.jsxs("span",{className:"font-semibold mr-2",children:[r,")"]}),s.jsx("span",{children:t[r]||"—"})]},r))})})]},e.position)}),s.jsx("div",{className:"flex justify-end",children:s.jsx(k,{onClick:S,disabled:v,children:"Enviar"})})]})]})};export{U as default};
