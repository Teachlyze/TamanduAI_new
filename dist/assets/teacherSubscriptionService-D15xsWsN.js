import{s as a}from"./main-Bujpyeg-.js";const u={async getSubscription(s){try{const{data:e,error:t}=await a.from("teacher_subscriptions").select("*").eq("user_id",s).eq("status","active").maybeSingle();if(t&&t.code!=="PGRST116")throw t;return e||{user_id:s,plan_type:"free",status:"active",max_classes:1,max_students_per_class:15,monthly_cost:0}}catch(e){throw console.error("Erro ao buscar assinatura:",e),e}},async createOrUpdateSubscription(s,e){try{const o={free:{max_classes:1,max_students:15,monthly_cost:0},basic:{max_classes:3,max_students:30,monthly_cost:19},pro:{max_classes:10,max_students:50,monthly_cost:49},enterprise:{max_classes:999,max_students:100,monthly_cost:99}}[e];if(!o)throw new Error("Plano inválido");const r=new Date;r.setMonth(r.getMonth()+1);const{data:n,error:c}=await a.from("teacher_subscriptions").upsert({user_id:s,plan_type:e,status:"active",max_classes:o.max_classes,max_students_per_class:o.max_students,monthly_cost:o.monthly_cost,started_at:new Date().toISOString(),expires_at:r.toISOString(),updated_at:new Date().toISOString()},{onConflict:"user_id",returning:"representation"}).select().single();if(c)throw c;return n}catch(t){throw console.error("Erro ao criar/atualizar assinatura:",t),t}},async checkCanCreateClass(s){try{const{data:e,error:t}=await a.rpc("can_teacher_create_class",{teacher_id:s});if(t)throw t;return e}catch(e){return console.error("Erro ao verificar limite de turmas:",e),!0}},async getUsageStats(s){try{const{count:e}=await a.from("classes").select("id",{count:"exact",head:!0}).eq("created_by",s),{count:t}=await a.from("school_teachers").select("school_id",{count:"exact",head:!0}).eq("user_id",s).eq("status","active"),{count:o}=await a.from("class_members").select("user_id",{count:"exact",head:!0}).eq("role","student").in("class_id",a.from("classes").select("id").eq("created_by",s)),r=await this.getSubscription(s);return{currentClasses:e||0,maxClasses:r.max_classes||1,linkedSchools:t||0,totalStudents:o||0,plan:r.plan_type||"free",canCreateMore:(e||0)<(r.max_classes||1),isSchoolLinked:(t||0)>0}}catch(e){throw console.error("Erro ao buscar estatísticas:",e),e}},async cancelSubscription(s){try{const{data:e,error:t}=await a.from("teacher_subscriptions").update({status:"cancelled",updated_at:new Date().toISOString()}).eq("user_id",s).eq("status","active").select().single();if(t)throw t;return e}catch(e){throw console.error("Erro ao cancelar assinatura:",e),e}},getAvailablePlans(){return[{id:"free",name:"Free",price:0,maxClasses:1,maxStudents:15,features:["Até 1 turma","Até 15 alunos por turma","Correção manual","Analytics básico","Suporte por email"]},{id:"basic",name:"Basic",price:19,maxClasses:3,maxStudents:30,features:["Até 3 turmas","Até 30 alunos por turma","Correção manual e automática","Analytics completo","Exportação de relatórios","Suporte prioritário"],recommended:!1},{id:"pro",name:"Pro",price:49,maxClasses:10,maxStudents:50,features:["Até 10 turmas","Até 50 alunos por turma","Correção automática com IA","Detecção de plágio (Winston AI)","Chatbot IA com RAG","Analytics avançado com ML","API de integração","Suporte prioritário"],recommended:!0},{id:"enterprise",name:"Enterprise",price:99,maxClasses:999,maxStudents:100,features:["Turmas ilimitadas","Até 100 alunos por turma","Todos os recursos do Pro","White-label (em breve)","SSO (Single Sign-On)","Suporte dedicado 24/7","SLA garantido","Treinamento personalizado"],recommended:!1}]}};export{u as t};
