import{al as N,u as w,r as a,j as e,o as E,M as c,s as d,ar as v}from"./main-BTTCSkdE.js";import{P}from"./PremiumCard-CV5gJlVo.js";import{P as C}from"./PremiumButton-TaG2j_oH.js";import{E as j}from"./EmptyState-j91SMhTI.js";import{S as M}from"./send-vuN82Ny2.js";const R=()=>{const{classId:k,discussionId:r}=N(),{user:l}=w(),[y,m]=a.useState(!0),[i,b]=a.useState(null),[u,g]=a.useState([]),[o,x]=a.useState(""),[p,f]=a.useState(!1);a.useEffect(()=>{(async()=>{m(!0);try{const{data:t,error:n}=await d.from("discussions").select("id, title, description, class_id, created_by, created_at").eq("id",r).maybeSingle();if(n)throw n;b(t);const{data:_,error:h}=await d.from("discussion_messages").select("id, content, user_id, created_at, is_deleted, is_edited").eq("discussion_id",r).order("created_at",{ascending:!0});if(h)throw h;g(_||[])}catch(t){console.error("Erro ao carregar discuss達o:",t)}finally{m(!1)}})()},[r]);const S=async()=>{if(!(!o.trim()||!l?.id)){f(!0);try{const{data:s,error:t}=await d.from("discussion_messages").insert({discussion_id:r,user_id:l.id,content:o.trim()}).select().maybeSingle();if(t)throw t;g(n=>[...n,s]),x(""),v.success?.("Mensagem enviada")}catch(s){console.error("Erro ao enviar mensagem:",s),v.error?.("Falha ao enviar mensagem")}finally{f(!1)}}};return y?e.jsx(E,{message:"Carregando discuss達o..."}):i?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-sky-600 to-indigo-600 p-8 rounded-2xl text-white",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-3",children:[e.jsx(c,{className:"w-6 h-6"})," ",i.title]}),i.description&&e.jsx("p",{className:"text-white/90",children:i.description})]}),e.jsx(P,{variant:"elevated",children:e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-y-auto pr-2",children:u.length===0?e.jsx(j,{icon:c,title:"Sem mensagens",description:"Comece a conversa."}):u.map(s=>e.jsxs("div",{className:"p-3 rounded-lg border border-border",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:new Date(s.created_at).toLocaleString("pt-BR")}),e.jsx("div",{className:"mt-1",children:s.content})]},s.id))}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"text",placeholder:"Escreva uma mensagem",value:o,onChange:s=>x(s.target.value),className:"flex-1 px-3 py-2 rounded-lg border border-border bg-background"}),e.jsx(C,{onClick:S,disabled:p||!o.trim(),leftIcon:M,children:p?"Enviando...":"Enviar"})]})]})})]}):e.jsx(j,{icon:c,title:"Discuss達o n達o encontrada",description:"Verifique o link."})};export{R as default};
