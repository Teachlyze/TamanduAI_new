import{f as U,u as $,g as G,r as o,s as x,af as O,B as z,T as F,ag as Q,j as e,m as s,$ as y,l as V,au as J,av as K,ae as W,aw as X,ax as S,a0 as Y,C as Z,bm as ee,bl as te,bP as se,aj as ae,bQ as re}from"./main-NgjJy_CG.js";import{B as oe}from"./badge-DS8upoqS.js";import{s as le}from"./schoolService-0kUg_1__.js";import{U as ie}from"./user-check-C-AAn5f8.js";import{M as ne}from"./mail-DQtjMnR0.js";import{G as ce}from"./graduation-cap-AfoLybfB.js";import{B as de}from"./brain-CMAFDraD.js";import{G as he}from"./gift-BHlYueon.js";import{B as me}from"./building-2-ghkqX3Zj.js";import{C as xe}from"./chevron-left-CCTbow4A.js";import{U as I}from"./user-CtDOwJP2.js";import{B as ue}from"./bell-CBDdgVV_.js";import{S as ge}from"./shield-BRvvQAmP.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],pe=U("briefcase",fe),be=({collapsed:a,setCollapsed:u})=>{const{user:l,signOut:C}=$(),d=G(),[i,b]=o.useState({teachers:0,students:0,classes:0}),[g,w]=o.useState(0),[T,_]=o.useState(new Date),[f,E]=o.useState(()=>typeof window<"u"?document.documentElement.classList.contains("dark"):!1);o.useEffect(()=>{l&&(D(),B())},[l]),o.useEffect(()=>{const t=setInterval(()=>{_(new Date)},6e4);return()=>clearInterval(t)},[]);const P=()=>{const t=!f;E(t),t?(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light"))},M=t=>new Intl.DateTimeFormat("pt-BR",{hour:"2-digit",minute:"2-digit",day:"2-digit",month:"2-digit"}).format(t).replace(","," •"),D=async()=>{try{const t=new Promise((r,n)=>setTimeout(()=>n(new Error("Timeout")),5e3)),h=(async()=>{const n=(await le.getUserSchool(l.id))?.id;if(!n)return console.warn("[SchoolSidebar] School ID não encontrado"),{teachers:0,students:0,classes:0};const[m,v]=await Promise.allSettled([x.from("school_teachers").select("*",{count:"exact",head:!0}).eq("school_id",n).eq("status","active"),x.from("school_classes").select("class_id").eq("school_id",n)]),R=m.status==="fulfilled"&&m.value.count||0,j=v.status==="fulfilled"?v.value.data||[]:[],N=j.length;let k=0;if(N>0)try{const p=j.map(q=>q.class_id),{count:H}=await x.from("class_members").select("*",{count:"exact",head:!0}).in("class_id",p).eq("role","student");k=H||0}catch(p){console.warn("[SchoolSidebar] Erro ao contar alunos:",p)}return{teachers:R,students:k,classes:N}})(),c=await Promise.race([h,t]);b(c)}catch(t){console.error("[SchoolSidebar] Erro ao carregar stats (usando valores padrão):",t.message),b({teachers:0,students:0,classes:0})}},B=async()=>{try{const t=new Promise((n,m)=>setTimeout(()=>m(new Error("Timeout")),3e3)),h=x.from("notifications").select("id").eq("user_id",l.id).eq("is_read",!1).range(0,499),{data:c,error:r}=await Promise.race([h,t]);if(r)throw r;w(c?.length||0)}catch(t){console.error("[SchoolSidebar] Erro ao carregar notificações (ignorando):",t.message),w(0)}},L=[{label:"Dashboard",icon:O,path:"/school",tourId:"nav-school-dashboard",gradient:"from-slate-600 to-gray-700"},{label:"Professores",icon:ie,path:"/school/teachers",tourId:"nav-school-teachers",gradient:"from-blue-600 to-indigo-700",badge:i.teachers},{label:"Convidar Professor",icon:ne,path:"/school/invite-teacher",tourId:"nav-school-invite",gradient:"from-indigo-600 to-purple-600"},{label:"Turmas",icon:z,path:"/school/classes",tourId:"nav-school-classes",gradient:"from-purple-600 to-pink-700",badge:i.classes},{label:"Alunos",icon:ce,path:"/school/students",tourId:"nav-school-students",gradient:"from-green-600 to-teal-700",badge:i.students},{label:"Ranking",icon:F,path:"/school/ranking",tourId:"nav-school-ranking",gradient:"from-yellow-600 to-amber-700"},{label:"Analytics ML",icon:de,path:"/school/analytics-ml",tourId:"nav-school-analytics-ml",gradient:"from-rose-600 to-red-700",badge:"IA"},{label:"Relatórios",icon:Q,path:"/school/reports",tourId:"nav-school-reports",gradient:"from-cyan-600 to-blue-700"},{label:"Recompensas",icon:he,path:"/school/rewards",tourId:"nav-school-rewards",gradient:"from-orange-600 to-yellow-600"},{label:"Comunicações",icon:pe,path:"/school/comms",tourId:"nav-school-comms",gradient:"from-violet-600 to-purple-700"}],A=async()=>{await C(),d("/login")};return e.jsx(s.aside,{initial:{x:-300},animate:{x:0,width:a?80:280},transition:{type:"spring",damping:20},className:"fixed left-0 top-0 h-screen bg-white dark:bg-gradient-to-br dark:from-slate-950 dark:via-gray-950 dark:to-black border-r border-slate-200 dark:border-slate-700/50 backdrop-blur-xl z-40 shadow-2xl",children:e.jsxs("div",{className:"flex flex-col h-full p-4",children:[e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{mode:"wait",children:!a&&e.jsxs(s.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-500 via-orange-500 to-red-500 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(me,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-slate-900 dark:text-white",children:"TamanduAI"}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-gray-300",children:"Administração Escolar"})]})]})}),e.jsx(s.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>u(!a),className:"p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors text-slate-700 dark:text-slate-300",children:a?e.jsx(V,{className:"w-5 h-5"}):e.jsx(xe,{className:"w-5 h-5"})})]}),!a&&e.jsxs(s.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"flex items-center justify-between gap-2 px-2",children:[e.jsxs(J,{children:[e.jsx(K,{asChild:!0,children:e.jsxs(s.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors text-sm",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-gradient-to-br from-amber-500 to-red-500 flex items-center justify-center",children:e.jsx(I,{className:"w-3 h-3 text-white"})}),e.jsx("span",{className:"text-xs truncate max-w-[80px] text-slate-900 dark:text-white",children:l?.user_metadata?.school_name?.split(" ")[0]||"Escola"}),e.jsx(W,{className:"w-3 h-3"})]})}),e.jsxs(X,{align:"start",className:"w-48",children:[e.jsxs(S,{onClick:()=>d("/profile/edit"),children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Editar Perfil"]}),e.jsxs(S,{onClick:()=>d("/school/settings"),children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Configurações"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-lg bg-slate-100 dark:bg-slate-800 text-xs text-slate-600 dark:text-gray-300",children:[e.jsx(Z,{className:"w-3 h-3"}),e.jsx("span",{children:M(T)})]}),e.jsx(s.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:P,className:"p-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors text-slate-700 dark:text-slate-300",title:f?"Modo claro":"Modo escuro",children:f?e.jsx(ee,{className:"w-4 h-4"}):e.jsx(te,{className:"w-4 h-4"})}),e.jsxs(s.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>d("/dashboard/notifications"),className:"p-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors relative text-slate-700 dark:text-slate-300",title:"Notificações",children:[e.jsx(ue,{className:"w-4 h-4"}),g>0&&e.jsx(s.div,{initial:{scale:0},animate:{scale:1},className:"absolute -top-0.5 -right-0.5 w-4 h-4 bg-red-500 rounded-full flex items-center justify-center text-white text-[10px] font-bold",children:g>9?"9+":g})]})]})]})]}),!a&&e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-6 p-4 rounded-2xl bg-gradient-to-br from-amber-100 via-orange-100 to-red-100 dark:from-amber-600/20 dark:via-orange-600/20 dark:to-red-600/20 border border-amber-300 dark:border-amber-500/30 text-slate-900 dark:text-white relative overflow-hidden backdrop-blur-sm",children:[e.jsx("div",{className:"absolute inset-0 opacity-10",children:e.jsx("div",{className:"absolute inset-0",style:{backgroundImage:"radial-gradient(circle at 2px 2px, white 1px, transparent 0)",backgroundSize:"24px 24px"}})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center",children:e.jsx(ge,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm truncate",children:l?.user_metadata?.school_name||"Escola"}),e.jsx("p",{className:"text-xs text-slate-700 dark:text-white/80 truncate",children:"Administrador"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-slate-900 dark:text-white",children:i.teachers}),e.jsx("div",{className:"text-xs text-slate-700 dark:text-white/80",children:"Profs"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-slate-900 dark:text-white",children:i.classes}),e.jsx("div",{className:"text-xs text-slate-700 dark:text-white/80",children:"Turmas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-slate-900 dark:text-white",children:i.students}),e.jsx("div",{className:"text-xs text-slate-700 dark:text-white/80",children:"Alunos"})]})]})]})]}),e.jsx("nav",{className:"flex-1 space-y-0.5 overflow-y-auto overflow-x-hidden scrollbar-thin scrollbar-thumb-slate-300 dark:scrollbar-thumb-slate-700 scrollbar-track-transparent",children:L.map((t,h)=>{const c=t.icon;return e.jsx(se,{to:t.path,"data-tour-id":t.tourId||void 0,className:({isActive:r})=>`group flex items-center gap-3 px-3 py-2 rounded-xl transition-all duration-200 ${r?"bg-gradient-to-r "+t.gradient+" text-white shadow-lg scale-105":"hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-700 dark:text-slate-300 hover:text-slate-900 dark:hover:text-white"}`,children:({isActive:r})=>e.jsxs(e.Fragment,{children:[e.jsx(s.div,{whileHover:{scale:1.1,rotate:5},whileTap:{scale:.95},className:`p-2 rounded-lg ${r?"bg-white/20":"bg-slate-200 dark:bg-slate-700"}`,children:e.jsx(c,{className:"w-5 h-5"})}),e.jsx(y,{mode:"wait",children:!a&&e.jsxs(s.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},className:"flex-1 flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-sm",children:t.label}),t.badge&&e.jsx(oe,{className:`${r?"bg-white/20 text-white":"bg-primary/10 text-primary"} text-xs`,children:t.badge})]})})]})},t.path)})}),e.jsx("div",{className:"pt-3 border-t border-slate-200 dark:border-slate-700",children:e.jsxs(s.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:A,className:`w-full flex items-center gap-3 px-3 py-3 rounded-xl hover:bg-red-50 dark:hover:bg-red-900/20 text-slate-700 dark:text-slate-300 hover:text-red-600 transition-all ${a?"justify-center":""}`,children:[e.jsx("div",{className:"p-2 rounded-lg bg-slate-200 dark:bg-slate-700",children:e.jsx(ae,{className:"w-5 h-5"})}),!a&&e.jsx("span",{className:"font-medium text-sm",children:"Sair"})]})})]})})},Me=()=>{const[a,u]=o.useState(!1);return e.jsxs("div",{className:"flex h-screen overflow-hidden bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-950",children:[e.jsx(be,{collapsed:a,setCollapsed:u}),e.jsx(s.main,{animate:{marginLeft:a?80:280},transition:{type:"spring",damping:20},className:"flex-1 overflow-y-auto overflow-x-hidden",children:e.jsx("div",{className:"min-h-full p-6 max-w-full",children:e.jsx(re,{})})})]})};export{Me as default};
