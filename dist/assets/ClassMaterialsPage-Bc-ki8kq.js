import{f as P,r as d,s as h,j as e,aO as H,aP as J,aQ as Y,aR as ee,aS as L,K as te,$ as G,m as D,a1 as A,ag as E,V as q,c as se,z as j,O as B,ak as ae,o as re,k as le}from"./main-NgjJy_CG.js";import{P as T}from"./PremiumCard-BGO_It48.js";import{P as F}from"./PremiumButton-DDGOGflQ.js";import{E as ie}from"./EmptyState-Cb7n_MKP.js";import{B as oe}from"./badge-DS8upoqS.js";import{o as ne,b as ce}from"./index-DF0QVnwI.js";import{U as I}from"./upload-B6TEbMs0.js";import{I as $}from"./image-nh9CRARA.js";import{E as de}from"./ellipsis-vertical-CZUUuaw-.js";import{D as K}from"./download-BtFddqD_.js";import{T as Q}from"./trash-2-Bhwmq7t6.js";import{f as X}from"./format-CtnHAw15.js";import{p as Z}from"./pt-BR-D7au_PjL.js";import{P as me}from"./plus-BItzgCLM.js";import{F as O}from"./folder-open-DTn8n3pv.js";import{G as R}from"./grid-3x3-lItUO4Hb.js";import{L as ue}from"./list-CKRPLVFM.js";import"./en-US-DmzJuP_Q.js";import"./toDate-M29M8iGB.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],U=P("archive",xe);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],M=P("file",he);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]],W=P("music",pe),ge=({classId:t,onFilterChange:a})=>{const[r,l]=d.useState([]),[i,o]=d.useState("all"),[c,u]=d.useState([]),[p,m]=d.useState(""),[g,z]=d.useState([]);d.useEffect(()=>{t&&b()},[t]),d.useEffect(()=>{a&&a({category:i!=="all"?i:null,tags:c,search:p},[])},[i,c,p]);const b=async()=>{try{const{data:n}=await h.from("class_materials").select("category, tags").eq("class_id",t);if(n){const v=[...new Set(n.map(N=>N.category).filter(Boolean))];l(v);const _=new Set;n.forEach(N=>{N.tags&&Array.isArray(N.tags)&&N.tags.forEach(S=>_.add(S))}),z([..._])}}catch(n){console.error("Error loading categories and tags:",n)}},f=n=>{u(v=>v.includes(n)?v.filter(_=>_!==n):[...v,n])},k=()=>{o("all"),u([]),m("")},y=i!=="all"||c.length>0||p.length>0;return e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4 text-gray-800 dark:text-gray-300"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filtros"})]}),y&&e.jsxs("button",{onClick:k,className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[e.jsx(ce,{className:"h-3 w-3"}),"Limpar"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"Categoria"}),e.jsxs(H,{value:i,onValueChange:o,children:[e.jsx(J,{children:e.jsx(Y,{placeholder:"Todas as categorias"})}),e.jsxs(ee,{children:[e.jsx(L,{value:"all",children:"Todas as categorias"}),r.map(n=>e.jsx(L,{value:n,children:n},n))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"Buscar"}),e.jsx(te,{placeholder:"Buscar por tÃ­tulo...",value:p,onChange:n=>m(n.target.value)})]})]}),g.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-2 block",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:g.map(n=>e.jsx(oe,{variant:c.includes(n)?"default":"outline",className:"cursor-pointer",onClick:()=>f(n),children:n},n))})]})]})},fe=async(t,a={})=>{try{let r=h.from("class_materials").select(`
        *,
        uploader:uploaded_by(id, full_name, avatar_url)
      `).eq("class_id",t).order("created_at",{ascending:!1});a.category&&(r=r.eq("category",a.category)),a.tags&&a.tags.length>0&&(r=r.contains("tags",a.tags)),a.search&&(r=r.or(`title.ilike.%${a.search}%,description.ilike.%${a.search}%`));const{data:l,error:i}=await r;if(i)throw i;return l||[]}catch(r){throw console.error("Error getting materials:",r),r}},V=async t=>{try{const{data:a,error:r}=await h.from("class_materials").select(`
        *,
        uploader:uploaded_by(id, full_name, avatar_url),
        class:class_id(id, name)
      `).eq("id",t).single();if(r)throw r;return a}catch(a){throw console.error("Error getting material:",a),a}},be=async(t,a,r)=>{try{const l=(await h.auth.getUser()).data.user?.id;if(!l)throw new Error("User not authenticated");const i=a.name.split(".").pop(),o=`${t}/${Date.now()}_${Math.random().toString(36).substring(7)}.${i}`,{data:c,error:u}=await h.storage.from("class-materials").upload(o,a,{cacheControl:"3600",upsert:!1});if(u)throw u;const{data:{publicUrl:p}}=h.storage.from("class-materials").getPublicUrl(o),{data:m,error:g}=await h.from("class_materials").insert({class_id:t,title:r.title||a.name,description:r.description||null,file_url:p,file_type:a.type,file_size:a.size,category:r.category||"outros",tags:r.tags||[],uploaded_by:l,created_by:l,is_public:r.is_public||!1}).select(`
        *,
        uploader:uploaded_by(id, full_name, avatar_url)
      `).single();if(g)throw g;return m}catch(l){throw console.error("Error uploading material:",l),l}},je=async(t,a)=>{try{const{data:r,error:l}=await h.from("class_materials").update({...a,updated_at:new Date().toISOString()}).eq("id",t).select(`
        *,
        uploader:uploaded_by(id, full_name, avatar_url)
      `).single();if(l)throw l;return r}catch(r){throw console.error("Error updating material:",r),r}},ye=async t=>{try{const a=await V(t);if(!a)throw new Error("Material not found");const r=a.file_url.split("/class-materials/")[1];if(r){const{error:i}=await h.storage.from("class-materials").remove([r]);i&&console.warn("Error deleting file from storage:",i)}const{error:l}=await h.from("class_materials").delete().eq("id",t);if(l)throw l}catch(a){throw console.error("Error deleting material:",a),a}},ve=async t=>{try{const{data:a,error:r}=await h.from("class_materials").select("id, file_size, category, file_type").eq("class_id",t);if(r)throw r;const l={total_materials:a.length,total_size:a.reduce((i,o)=>i+(o.file_size||0),0),by_category:{},by_type:{}};return a.forEach(i=>{const o=i.category||"outros";l.by_category[o]=(l.by_category[o]||0)+1;const c=i.file_type?.split("/")[0]||"other";l.by_type[c]=(l.by_type[c]||0)+1}),l}catch(a){throw console.error("Error getting material stats:",a),a}},Ne=async t=>{try{const{data:a,error:r}=await h.from("class_materials").select("category").eq("class_id",t);if(r)throw r;return[...new Set(a.map(i=>i.category).filter(Boolean))]}catch(a){throw console.error("Error getting categories:",a),a}},we=async t=>{try{const{data:a,error:r}=await h.from("class_materials").select("tags").eq("class_id",t);if(r)throw r;const l=new Set;return a.forEach(i=>{i.tags&&Array.isArray(i.tags)&&i.tags.forEach(o=>l.add(o))}),[...l]}catch(a){throw console.error("Error getting tags:",a),a}},_e=async(t,a)=>{try{const r=(await h.auth.getUser()).data.user?.id;if(!r)throw new Error("User not authenticated");const l=await V(t);if(!l)throw new Error("Material not found");const{data:i,error:o}=await h.from("class_materials").insert({class_id:a,title:`${l.title} (cÃ³pia)`,description:l.description,file_url:l.file_url,file_type:l.file_type,file_size:l.file_size,category:l.category,tags:l.tags,uploaded_by:r,created_by:r,is_public:l.is_public}).select(`
        *,
        uploader:uploaded_by(id, full_name, avatar_url)
      `).single();if(o)throw o;return i}catch(r){throw console.error("Error duplicating material:",r),r}},ke=(t,a)=>{const r=document.createElement("a");r.href=t,r.download=a,r.target="_blank",document.body.appendChild(r),r.click(),document.body.removeChild(r)},Ce=t=>{if(!t)return"0 B";const a=1024,r=["B","KB","MB","GB"],l=Math.floor(Math.log(t)/Math.log(a));return`${(t/Math.pow(a,l)).toFixed(2)} ${r[l]}`},Me=t=>t?t.startsWith("image/")?"image":t.startsWith("video/")?"video":t.startsWith("audio/")?"music":t==="application/pdf"||t.includes("word")||t.includes("document")?"file-text":t.includes("sheet")||t.includes("excel")?"table":t.includes("presentation")||t.includes("powerpoint")?"presentation":t.includes("zip")||t.includes("rar")?"archive":"file":"file",w={getMaterials:fe,getMaterial:V,uploadMaterial:be,updateMaterial:je,deleteMaterial:ye,getMaterialStats:ve,getCategories:Ne,getTags:we,duplicateMaterial:_e,downloadMaterial:ke,formatFileSize:Ce,getFileIcon:Me},Se=[{value:"apostilas",label:"Apostilas",icon:E},{value:"slides",label:"Slides",icon:E},{value:"videos",label:"VÃ­deos",icon:q},{value:"exercicios",label:"ExercÃ­cios",icon:M},{value:"provas",label:"Provas",icon:M},{value:"referencias",label:"ReferÃªncias",icon:E},{value:"outros",label:"Outros",icon:M}],Ee=100*1024*1024,ze=({classId:t,onClose:a,onSuccess:r})=>{const[l,i]=d.useState(null),[o,c]=d.useState({title:"",description:"",category:"outros",tags:[],is_public:!1}),[u,p]=d.useState(""),[m,g]=d.useState(!1),[z,b]=d.useState(!1),f=s=>{if(s){if(s.size>Ee){j.error("Arquivo muito grande! MÃ¡ximo: 100MB");return}i(s),o.title||c(x=>({...x,title:s.name.replace(/\.[^/.]+$/,"")}))}},k=s=>{s.preventDefault(),s.stopPropagation(),s.type==="dragenter"||s.type==="dragover"?b(!0):s.type==="dragleave"&&b(!1)},y=s=>{s.preventDefault(),s.stopPropagation(),b(!1),s.dataTransfer.files&&s.dataTransfer.files[0]&&f(s.dataTransfer.files[0])},n=()=>{if(u.trim()){if(o.tags.includes(u.trim())){j.error("Tag jÃ¡ adicionada");return}c(s=>({...s,tags:[...s.tags,u.trim()]})),p("")}},v=s=>{c(x=>({...x,tags:x.tags.filter(C=>C!==s)}))},_=async()=>{if(!l){j.error("Selecione um arquivo");return}if(!o.title.trim()){j.error("TÃ­tulo Ã© obrigatÃ³rio");return}try{g(!0),await w.uploadMaterial(t,l,o),r()}catch(s){console.error("Erro ao enviar material:",s),j.error("Erro ao enviar material")}finally{g(!1)}},S=l?l.type.startsWith("image/")?$:l.type.startsWith("video/")?q:l.type.startsWith("audio/")?W:l.type==="application/pdf"?E:l.type.includes("zip")||l.type.includes("rar")?U:M:M;return e.jsx(G,{children:e.jsx(D.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:a,children:e.jsxs(D.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:s=>s.stopPropagation(),className:"bg-white dark:bg-slate-900 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-2xl font-bold",children:"ðŸ“¤ Enviar Material"}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-muted rounded-lg transition-colors",children:e.jsx(A,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Arquivo"}),l?e.jsxs("div",{className:"border border-border rounded-xl p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-lg",children:e.jsx(S,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:l.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:w.formatFileSize(l.size)})]})]}),e.jsx("button",{onClick:()=>i(null),className:"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 text-red-600 rounded-lg transition-colors",children:e.jsx(A,{className:"w-5 h-5"})})]}):e.jsxs("div",{onDragEnter:k,onDragLeave:k,onDragOver:k,onDrop:y,className:`border-2 border-dashed rounded-xl p-8 text-center transition-all cursor-pointer ${z?"border-primary bg-primary/5":"border-border hover:border-primary/50 hover:bg-muted/30"}`,onClick:()=>document.getElementById("file-input").click(),children:[e.jsx(I,{className:"w-12 h-12 mx-auto mb-3 text-muted-foreground"}),e.jsx("p",{className:"text-sm font-medium mb-1",children:"Arraste e solte ou clique para selecionar"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"MÃ¡ximo: 100MB"}),e.jsx("input",{id:"file-input",type:"file",className:"hidden",onChange:s=>f(s.target.files[0])})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"TÃ­tulo *"}),e.jsx("input",{type:"text",value:o.title,onChange:s=>c({...o,title:s.target.value}),className:"w-full px-4 py-2 rounded-lg border border-border bg-white dark:bg-slate-900 text-foreground",placeholder:"Nome do material"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:o.description,onChange:s=>c({...o,description:s.target.value}),rows:3,className:"w-full px-4 py-2 rounded-lg border border-border bg-white dark:bg-slate-900 text-foreground resize-none",placeholder:"Descreva o conteÃºdo do material..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Categoria"}),e.jsx("select",{value:o.category,onChange:s=>c({...o,category:s.target.value}),className:"w-full px-4 py-2 rounded-lg border border-border bg-white dark:bg-slate-900 text-foreground",children:Se.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Tags"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",value:u,onChange:s=>p(s.target.value),onKeyPress:s=>s.key==="Enter"&&n(),className:"flex-1 px-4 py-2 rounded-lg border border-border bg-white dark:bg-slate-900 text-foreground",placeholder:"Adicionar tag..."}),e.jsx("button",{onClick:n,className:"px-4 py-2 bg-primary text-slate-900 dark:text-white rounded-lg hover:opacity-90",children:"Adicionar"})]}),o.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:o.tags.map((s,x)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full bg-muted text-sm",children:[s,e.jsx("button",{onClick:()=>v(s),className:"hover:text-red-600",children:e.jsx(A,{className:"w-3 h-3"})})]},x))})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-muted/50 rounded-lg",children:[e.jsx("input",{type:"checkbox",id:"is_public",checked:o.is_public,onChange:s=>c({...o,is_public:s.target.checked}),className:"w-4 h-4 rounded"}),e.jsxs("label",{htmlFor:"is_public",className:"text-sm cursor-pointer",children:[e.jsx("span",{className:"font-medium",children:"Material pÃºblico"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Permitir que alunos visualizem este material"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:[e.jsx(se,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[e.jsx("p",{className:"font-medium mb-1",children:"AtenÃ§Ã£o"}),e.jsx("p",{className:"text-xs",children:"Certifique-se de que o material nÃ£o contÃ©m informaÃ§Ãµes confidenciais antes de enviar."})]})]})]}),e.jsxs("div",{className:"p-6 border-t border-border flex items-center justify-end gap-3",children:[e.jsx(F,{variant:"outline",onClick:a,disabled:m,className:"whitespace-nowrap inline-flex items-center gap-2",children:e.jsx("span",{children:"Cancelar"})}),e.jsx(F,{variant:"gradient",leftIcon:I,onClick:_,disabled:!l||m,className:"whitespace-nowrap inline-flex items-center gap-2",children:e.jsx("span",{children:m?"Enviando...":"Enviar Material"})})]})]})})})},De=({material:t,index:a,onDelete:r,onDownload:l,onUpdate:i})=>{const[o,c]=d.useState(!1),u=()=>{const m="w-8 h-8";return t.file_type?.startsWith("image/")?e.jsx($,{className:m}):t.file_type?.startsWith("video/")?e.jsx(q,{className:m}):t.file_type?.startsWith("audio/")?e.jsx(W,{className:m}):t.file_type==="application/pdf"?e.jsx(E,{className:m}):t.file_type?.includes("zip")||t.file_type?.includes("rar")?e.jsx(U,{className:m}):e.jsx(M,{className:m})},p=()=>t.file_type?.startsWith("image/")?"from-blue-500 to-cyan-500":t.file_type?.startsWith("video/")?"from-purple-500 to-pink-500":t.file_type?.startsWith("audio/")?"from-green-500 to-emerald-500":t.file_type==="application/pdf"?"from-red-500 to-orange-500":t.file_type?.includes("zip")||t.file_type?.includes("rar")?"from-yellow-500 to-amber-500":"from-gray-500 to-slate-500";return e.jsx(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:a*.05},children:e.jsx(T,{variant:"elevated",className:"h-full hover:shadow-xl transition-all group",children:e.jsxs("div",{className:"p-6 flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-xl bg-gradient-to-br ${p()} text-white`,children:u()}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>c(!o),className:"p-2 hover:bg-muted rounded-lg transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(de,{className:"w-4 h-4"})}),o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>c(!1)}),e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-slate-800 rounded-lg shadow-lg border border-border z-20",children:[e.jsxs("button",{onClick:()=>{l(t),c(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-muted flex items-center gap-2 rounded-t-lg",children:[e.jsx(K,{className:"w-4 h-4"}),"Baixar"]}),e.jsxs("button",{onClick:()=>{window.open(t.file_url,"_blank"),c(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-muted flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"}),"Visualizar"]}),e.jsxs("button",{onClick:()=>{r(t.id),c(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-red-50 dark:hover:bg-red-900/20 text-red-600 flex items-center gap-2 rounded-b-lg",children:[e.jsx(Q,{className:"w-4 h-4"}),"Excluir"]})]})]})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold mb-2 line-clamp-2",children:t.title}),t.description&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2 mb-3",children:t.description}),t.category&&e.jsx("span",{className:"inline-block text-xs px-2 py-1 rounded-full bg-primary/10 text-primary font-medium mb-3",children:t.category}),t.tags&&t.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mb-3",children:[t.tags.slice(0,3).map((m,g)=>e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-muted text-muted-foreground",children:m},g)),t.tags.length>3&&e.jsxs("span",{className:"text-xs px-2 py-0.5 rounded bg-muted text-muted-foreground",children:["+",t.tags.length-3]})]})]}),e.jsxs("div",{className:"pt-3 border-t border-border mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[t.uploader?.avatar_url?e.jsx("img",{src:t.uploader.avatar_url,alt:t.uploader.full_name,className:"w-5 h-5 rounded-full"}):e.jsx("div",{className:"w-5 h-5 rounded-full bg-primary/20 flex items-center justify-center text-primary text-xs font-bold",children:t.uploader?.full_name?.[0]||"?"}),e.jsx("span",{children:t.uploader?.full_name||"Desconhecido"})]}),e.jsx("span",{children:w.formatFileSize(t.file_size)})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:X(new Date(t.created_at),"d 'de' MMMM, yyyy",{locale:Z})})]})]})})})},Fe=({materials:t,onDelete:a,onDownload:r})=>{const l=i=>{const o="w-5 h-5";return i?.startsWith("image/")?e.jsx($,{className:o}):i?.startsWith("video/")?e.jsx(q,{className:o}):i?.startsWith("audio/")?e.jsx(W,{className:o}):i==="application/pdf"?e.jsx(E,{className:o}):i?.includes("zip")||i?.includes("rar")?e.jsx(U,{className:o}):e.jsx(M,{className:o})};return e.jsxs(T,{variant:"elevated",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gradient-to-r from-purple-50 to-pink-50 dark:from-slate-800 dark:to-slate-800 border-b-2 border-primary/20",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left font-bold text-sm",children:"Arquivo"}),e.jsx("th",{className:"px-4 py-4 text-left font-bold text-sm",children:"Categoria"}),e.jsx("th",{className:"px-4 py-4 text-left font-bold text-sm",children:"Tamanho"}),e.jsx("th",{className:"px-4 py-4 text-left font-bold text-sm",children:"Enviado por"}),e.jsx("th",{className:"px-4 py-4 text-left font-bold text-sm",children:"Data"}),e.jsx("th",{className:"px-4 py-4 text-center font-bold text-sm",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{children:t.map((i,o)=>e.jsxs(D.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:o*.03},className:"border-b border-border hover:bg-muted/30 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg text-primary",children:l(i.file_type)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:i.title}),i.description&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-1 max-w-md",children:i.description}),i.tags&&i.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[i.tags.slice(0,2).map((c,u)=>e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-muted text-muted-foreground",children:c},u)),i.tags.length>2&&e.jsxs("span",{className:"text-xs px-1.5 py-0.5 rounded bg-muted text-muted-foreground",children:["+",i.tags.length-2]})]})]})]})}),e.jsx("td",{className:"px-4 py-3",children:i.category&&e.jsx("span",{className:"inline-block text-xs px-2 py-1 rounded-full bg-primary/10 text-primary font-medium",children:i.category})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:w.formatFileSize(i.file_size)}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[i.uploader?.avatar_url?e.jsx("img",{src:i.uploader.avatar_url,alt:i.uploader.full_name,className:"w-6 h-6 rounded-full"}):e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary/20 flex items-center justify-center text-primary text-xs font-bold",children:i.uploader?.full_name?.[0]||"?"}),e.jsx("span",{className:"text-sm",children:i.uploader?.full_name||"Desconhecido"})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-muted-foreground",children:X(new Date(i.created_at),"dd/MM/yyyy",{locale:Z})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:()=>window.open(i.file_url,"_blank"),className:"p-2 hover:bg-muted rounded-lg transition-colors",title:"Visualizar",children:e.jsx(B,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>r(i),className:"p-2 hover:bg-muted rounded-lg transition-colors",title:"Baixar",children:e.jsx(K,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>a(i.id),className:"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 text-red-600 rounded-lg transition-colors",title:"Excluir",children:e.jsx(Q,{className:"w-4 h-4"})})]})})]},i.id))})]})}),e.jsx("div",{className:"p-4 border-t border-border bg-muted/30",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Total de ",t.length," material(is)"]})})]})},Je=()=>{const{classId:t}=ae(),[a,r]=d.useState(!0),[l,i]=d.useState([]),[o,c]=d.useState([]),[u,p]=d.useState(null),[m,g]=d.useState("grid"),[z,b]=d.useState(!1),[f,k]=d.useState({});d.useEffect(()=>{t&&(y(),n())},[t]),d.useEffect(()=>{v()},[l,f]);const y=async()=>{try{r(!0);const s=await w.getMaterials(t);i(s)}catch(s){console.error("Erro ao carregar materiais:",s),j.error("Erro ao carregar materiais")}finally{r(!1)}},n=async()=>{try{const s=await w.getMaterialStats(t);p(s)}catch(s){console.error("Erro ao carregar estatÃ­sticas:",s)}},v=()=>{let s=[...l];if(f.category&&(s=s.filter(x=>x.category===f.category)),f.tags&&f.tags.length>0&&(s=s.filter(x=>x.tags&&f.tags.some(C=>x.tags.includes(C)))),f.search){const x=f.search.toLowerCase();s=s.filter(C=>C.title.toLowerCase().includes(x)||C.description&&C.description.toLowerCase().includes(x))}c(s)},_=()=>{b(!1),y(),n(),j.success("Material enviado com sucesso!")},N=async s=>{if(confirm("Tem certeza que deseja excluir este material?"))try{await w.deleteMaterial(s),j.success("Material excluÃ­do"),y(),n()}catch{j.error("Erro ao excluir material")}},S=s=>{w.downloadMaterial(s.file_url,s.title),j.success("Download iniciado")};return a?e.jsx(re,{message:"Carregando materiais..."}):e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative overflow-hidden bg-gradient-to-br from-purple-600 via-pink-600 to-rose-600 rounded-3xl p-8 text-white",children:[e.jsx("div",{className:"absolute inset-0 opacity-10",children:e.jsx("div",{className:"absolute inset-0",style:{backgroundImage:"radial-gradient(circle at 1px 1px, white 1px, transparent 0)",backgroundSize:"40px 40px"}})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:"ðŸ“š Materiais da Turma"}),e.jsx("p",{className:"text-white/90 text-lg",children:"Organize e compartilhe recursos de aprendizagem"})]}),e.jsx(F,{variant:"white",leftIcon:me,onClick:()=>b(!0),className:"whitespace-nowrap inline-flex items-center gap-2 bg-white text-purple-600 hover:bg-white/90",children:e.jsx("span",{children:"Enviar Material"})})]}),u&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(O,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white/70",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold",children:u.total_materials})]})]})}),e.jsx("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(le,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white/70",children:"Tamanho"}),e.jsx("p",{className:"text-2xl font-bold",children:w.formatFileSize(u.total_size)})]})]})}),e.jsx("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(R,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white/70",children:"Categorias"}),e.jsx("p",{className:"text-2xl font-bold",children:Object.keys(u.by_category).length})]})]})}),e.jsx("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(B,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white/70",children:"Tipos"}),e.jsx("p",{className:"text-2xl font-bold",children:Object.keys(u.by_type).length})]})]})})]})]})]}),e.jsx(ge,{classId:t,onFilterChange:k}),e.jsx(T,{variant:"elevated",children:e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[o.length," material(is) encontrado(s)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>g("grid"),className:`p-2 rounded-lg transition-colors ${m==="grid"?"bg-primary text-white":"bg-muted text-muted-foreground hover:bg-muted/80"}`,children:e.jsx(R,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>g("list"),className:`p-2 rounded-lg transition-colors ${m==="list"?"bg-primary text-white":"bg-muted text-muted-foreground hover:bg-muted/80"}`,children:e.jsx(ue,{className:"w-4 h-4"})})]})]})}),o.length===0?e.jsx(ie,{icon:O,title:l.length===0?"Nenhum material cadastrado":"Nenhum material encontrado",description:l.length===0?"Comece enviando seu primeiro material para a turma":"Tente ajustar os filtros de busca",action:l.length===0&&e.jsx(F,{variant:"gradient",leftIcon:I,onClick:()=>b(!0),children:"Enviar Primeiro Material"})}):e.jsx(G,{mode:"wait",children:m==="grid"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map((s,x)=>e.jsx(De,{material:s,index:x,onDelete:N,onDownload:S,onUpdate:y},s.id))}):e.jsx(Fe,{materials:o,onDelete:N,onDownload:S,onUpdate:y})}),z&&e.jsx(ze,{classId:t,onClose:()=>b(!1),onSuccess:_})]})};export{Je as default};
