import{a6 as D,g as T,a7 as z,r as o,j as e,s as F,J as m,K as x,Y as L,N as u,O as h,Q as f,i as l,t as $,a4 as v,a8 as O,a9 as G,aa as H,U as J,c as M,ab as w}from"./main-Bujpyeg-.js";import{u as q}from"./use-toast-9Xc4qRbM.js";import{n as g}from"./roleNavigation-mm4rSh2G.js";import{A as I,a as b}from"./alert-mM_jJWFf.js";import{C as A}from"./classInviteService-BwUfjvbb.js";import{G as k}from"./graduation-cap-Ch-mLRIV.js";import{U as B}from"./user-plus-B5t61OuG.js";function se(){const{invitationCode:c}=D(),t=T(),p=z(),{toast:N}=q(),[d,i]=o.useState("loading"),[a,P]=o.useState(null),[S,j]=o.useState(""),[n,U]=o.useState(null),[C,y]=o.useState(!1);o.useEffect(()=>{(async()=>{const{data:{user:r}}=await F.auth.getUser();U(r),!r&&c&&localStorage.setItem("pendingInvitation",c)})()},[c]),o.useEffect(()=>{c&&(async()=>{if(!c){i("error"),j("Código de convite inválido");return}try{i("loading");const r=await A.getInviteDetails(c);P(r),i(n?"preview":"not_authenticated")}catch(r){console.error("Error loading invite details:",r),i("error"),j(r.message||"Convite inválido ou expirado.")}})()},[c,n]);const _=async()=>{if(!n){t(`/login?redirect=${encodeURIComponent(p.pathname)}`);return}y(!0),i("confirming");try{const s=await A.acceptInvite(c,n.id);s.success&&(i("success"),localStorage.removeItem("pendingInvitation"),N({title:s.alreadyMember?"Você já está na turma!":"Inscrição realizada!",description:s.alreadyMember?"Você já é membro desta turma.":"Você foi adicionado à turma com sucesso!"}),setTimeout(()=>{if(s.classId)t(`/classes/${s.classId}`);else{const r=n.user_metadata?.role||"student";g(t,r)}},2e3))}catch(s){console.error("Error accepting invite:",s),i("error"),j(s.message||"Não foi possível aceitar o convite."),N({variant:"destructive",title:"Erro ao aceitar convite",description:s.message||"Ocorreu um erro. Tente novamente."})}finally{y(!1)}},E=()=>{t(`/login?redirect=${encodeURIComponent(p.pathname)}`)},R=()=>{t(`/register?redirect=${encodeURIComponent(p.pathname)}`)},V=()=>{switch(d){case"loading":return e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsx(v,{className:"h-12 w-12 animate-spin text-primary"}),e.jsx("p",{className:"text-lg font-medium",children:"Processando seu convite..."})]});case"not_authenticated":return e.jsxs(m,{className:"max-w-2xl mx-auto",children:[e.jsxs(x,{children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("div",{className:"p-3 rounded-full bg-primary/10",children:e.jsx(B,{className:"h-8 w-8 text-primary"})})}),e.jsx(u,{className:"text-center",children:"Você foi convidado para uma turma!"}),e.jsx(h,{className:"text-center",children:"Para aceitar o convite, você precisa fazer login ou criar uma conta."})]}),a&&e.jsx(f,{className:"space-y-4",children:e.jsxs(I,{children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"font-medium",children:["Turma: ",a.class?.name]}),a.class?.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:a.class.description}),e.jsxs("p",{className:"text-sm",children:["Professor: ",a.class?.teacher?.full_name||"Professor"]})]})})]})}),e.jsxs(w,{className:"flex flex-col gap-3",children:[e.jsx(l,{onClick:E,className:"w-full",size:"lg",children:"Fazer Login"}),e.jsx(l,{onClick:R,variant:"outline",className:"w-full",size:"lg",children:"Criar Conta"})]})]});case"preview":return e.jsxs(m,{className:"max-w-2xl mx-auto",children:[e.jsxs(x,{children:[e.jsx(u,{className:"text-center text-2xl",children:"Você foi convidado para esta turma"}),e.jsx(h,{className:"text-center",children:"Revise as informações abaixo e confirme se deseja entrar"})]}),e.jsxs(f,{className:"space-y-6",children:[e.jsxs("div",{className:"border rounded-lg p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-primary/10",children:e.jsx(k,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("h3",{className:"text-xl font-semibold",children:a?.class?.name}),a?.class?.description&&e.jsx("p",{className:"text-muted-foreground",children:a.class.description})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t",children:[e.jsxs(O,{children:[e.jsx(G,{src:a?.class?.teacher?.avatar_url}),e.jsx(H,{children:a?.class?.teacher?.full_name?.charAt(0)||"P"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Professor"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a?.class?.teacher?.full_name||"Professor"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(J,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Você entrará como: ",e.jsx("strong",{children:a?.role==="student"?"Aluno":"Professor"})]})]})]}),e.jsxs(I,{children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx(b,{children:"Ao confirmar, você será adicionado à turma e terá acesso a todos os materiais e atividades."})]})]}),e.jsxs(w,{className:"flex gap-3",children:[e.jsx(l,{variant:"outline",onClick:()=>t("/"),className:"flex-1",children:"Cancelar"}),e.jsx(l,{onClick:_,disabled:C,className:"flex-1",children:C?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"mr-2 h-4 w-4 animate-spin"}),"Confirmando..."]}):"Confirmar e Entrar"})]})]});case"confirming":return e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsx(v,{className:"h-12 w-12 animate-spin text-primary"}),e.jsx("p",{className:"text-lg font-medium",children:"Adicionando você à turma..."})]});case"success":return e.jsxs(m,{className:"max-w-md mx-auto",children:[e.jsxs(x,{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-green-100",children:e.jsx($,{className:"h-6 w-6 text-green-600"})}),e.jsx(u,{className:"mt-4",children:"Inscrição realizada com sucesso!"}),e.jsx(h,{children:"Você foi adicionado à turma. Redirecionando..."})]}),e.jsx(f,{className:"flex justify-center",children:e.jsx(l,{onClick:()=>{const s=n?.user_metadata?.role||"student";g(t,s)},children:"Ir para o painel agora"})})]});case"error":return e.jsxs(m,{className:"max-w-md mx-auto",children:[e.jsxs(x,{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-red-100",children:e.jsx(L,{className:"h-6 w-6 text-red-600"})}),e.jsx(u,{className:"mt-4",children:"Não foi possível processar o convite"}),e.jsx(h,{className:"text-red-600",children:S||"O link de convite é inválido ou expirou."})]}),e.jsxs(f,{className:"flex flex-col items-center space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Verifique se o link está correto ou peça um novo convite ao professor."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>t("/"),children:"Página inicial"}),e.jsx(l,{onClick:()=>{const s=n?.user_metadata?.role||"student";g(t,s)},children:"Ir para o painel"})]})]})]});default:return null}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-background to-muted/20",children:e.jsxs("div",{className:"container max-w-4xl py-12 px-4",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold tracking-tight",children:"Convite para Turma"}),e.jsx("p",{className:"text-muted-foreground mt-2 text-lg",children:d==="loading"?"Carregando informações do convite...":d==="not_authenticated"?"Faça login para aceitar o convite":d==="preview"?"Revise as informações da turma":d==="confirming"?"Processando sua inscrição...":d==="success"?"Você foi adicionado à turma com sucesso!":"Não foi possível processar o convite"})]}),e.jsx("div",{className:"flex justify-center",children:V()})]})})}export{se as default};
