import{u as k,r,s as u,z as U,j as e,o as q,U as N,ah as S,K as A}from"./main-NgjJy_CG.js";import{P as E}from"./PremiumCard-BGO_It48.js";import{P as I}from"./PremiumButton-DDGOGflQ.js";import{E as _}from"./EmptyState-Cb7n_MKP.js";import{s as T}from"./schoolService-0kUg_1__.js";import{D as z}from"./download-BtFddqD_.js";const H=()=>{const{user:c}=k(),[y,h]=r.useState(!0),[i,n]=r.useState([]),[x,a]=r.useState([]),[o,P]=r.useState("");r.useEffect(()=>{c&&C()},[c]),r.useEffect(()=>{if(o){const s=i.filter(l=>l.name?.toLowerCase().includes(o.toLowerCase())||l.email?.toLowerCase().includes(o.toLowerCase()));a(s)}else a(i)},[o,i]);const C=async()=>{try{h(!0);const s=new Promise((d,m)=>setTimeout(()=>m(new Error("Timeout ao carregar dados")),1e4)),l=(async()=>{const d=await T.getUserSchool(c.id);if(!d?.id)throw new Error("Escola não encontrada");const{data:m,error:p}=await u.from("school_classes").select("class_id").eq("school_id",d.id);if(p)throw p;const g=(m||[]).map(t=>t.class_id);if(g.length===0){n([]),a([]);return}const{data:j,error:w}=await u.from("class_members").select("user_id, joined_at").in("class_id",g).eq("role","student");if(w)throw w;const b=[...new Set((j||[]).map(t=>t.user_id))];if(b.length===0){n([]),a([]);return}const{data:L,error:v}=await u.from("profiles").select("id, name, email, avatar_url").in("id",b);if(v)throw v;return(L||[]).map(t=>({...t,joined_at:j.find(D=>D.user_id===t.id)?.joined_at}))})(),f=await Promise.race([l,s]);n(f),a(f)}catch(s){console.error("[SchoolStudentsPage] Erro ao carregar alunos:",s),U.error(s.message||"Erro ao carregar alunos"),n([]),a([])}finally{h(!1)}};return y?e.jsx(q,{message:"Carregando alunos..."}):e.jsxs("div",{className:"space-y-6 pb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-600 via-indigo-600 to-purple-700 p-8 rounded-2xl text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(N,{className:"w-8 h-8"}),e.jsx("h1",{className:"text-3xl font-bold",children:"Alunos"})]}),e.jsx("p",{className:"text-white/90",children:"Gerencie todos os alunos da instituição"})]}),e.jsx(E,{variant:"elevated",children:e.jsxs("div",{className:"p-4 flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(S,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-700 dark:text-slate-300"}),e.jsx(A,{placeholder:"Buscar alunos por nome ou email...",value:o,onChange:s=>P(s.target.value),className:"pl-10 bg-white dark:bg-slate-900 text-foreground border-border"})]}),e.jsxs(I,{variant:"outline",className:"whitespace-nowrap inline-flex items-center gap-2 bg-white dark:bg-slate-900 text-foreground border-border",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{children:"Exportar"})]})]})}),x.length===0?i.length===0?e.jsx(_,{icon:N,title:"Nenhum aluno encontrado",description:"Os alunos aparecerão aqui"}):e.jsx(_,{icon:S,title:"Nenhum aluno encontrado",description:"Tente ajustar sua busca"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:x.map(s=>e.jsx(E,{variant:"elevated",className:"hover:scale-105 transition-transform",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-600 to-indigo-600 flex items-center justify-center text-white font-bold text-lg",children:s.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-lg truncate",children:s.name}),e.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300 truncate",children:s.email})]})]})})},s.id))})]})};export{H as default};
