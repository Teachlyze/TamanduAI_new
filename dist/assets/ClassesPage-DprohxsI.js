import{r,u as I,g as ee,j as e,m as h,i as l,B as S,U as P,T as se,ah as ae,K as U,S as te,au as re,av as ie,aw as le,ax as N,O as z,ay as oe,C as ne,az as de,aA as ce,aB as me,aC as xe,aD as he,aE as ue,aF as pe,aG as ge,aH as fe,aI as je,aJ as be,aK as ve,J as we,aL as Ne,D as ye}from"./main-NgjJy_CG.js";import{t}from"./use-toast-GUBWlXfL.js";import{e as Ce}from"./apiSupabase-Del1_BNn.js";import{C as ke}from"./classService-CTxchFmi.js";import{u as De}from"./useRedisCache-BLMjH1Ih.js";import{u as Ee}from"./useUserRole-QdKsLtvX.js";import{g as Se,f as Te}from"./classScheduleUtils-BvY1sQIC.js";import{P as B}from"./plus-BItzgCLM.js";import{F as Ae}from"./funnel-CchVKkoO.js";import{E as Fe}from"./ellipsis-vertical-CZUUuaw-.js";import{S as Le}from"./square-pen-eBdyYMhc.js";import{U as O}from"./user-plus-DbpNqADK.js";import{T as Me}from"./trash-2-Bhwmq7t6.js";const Qe=()=>{const[u,$]=r.useState(""),[R,p]=r.useState(!1),[d,y]=r.useState(null),[Pe,q]=r.useState(!0),[Ue,T]=r.useState(null),[c,C]=r.useState([]),[G,g]=r.useState(!1),[k,J]=r.useState(null),[x,D]=r.useState(null),[f,j]=r.useState(!1),{user:b}=I(),v=ee(),{isTeacher:m}=Ee(),{data:E,loading:A,error:F,invalidate:H}=De(b?.id,m?"teacher":"student"),L=["from-blue-500 to-blue-600","from-green-500 to-green-600","from-purple-500 to-purple-600","from-orange-500 to-orange-600","from-pink-500 to-pink-600","from-indigo-500 to-indigo-600","from-teal-500 to-teal-600","from-amber-500 to-amber-600"];r.useEffect(()=>{(async()=>{if(b)try{if(q(A),T(F),E){const a=E.map((o,w)=>{const n=Se(o),Z=Te(n);return{...o,color:L[w%L.length],students:o.students_count||0,activities:o.activities_count||0,nextClass:Z,nextClassDate:n}});C(a)}}catch(a){console.error("Error processing classes:",a),T(`Falha ao processar as turmas: ${a.message}`),t({title:"Erro",description:"Não foi possível processar as turmas.",variant:"destructive"})}})()},[b,E,A,F]);const i=async(s,a=null)=>{try{if(!a&&s!=="create"){console.error("No class provided for action:",s);return}switch(s){case"create":v("/dashboard/classes/new");break;case"view":a?.id&&v(`/dashboard/classes/${a.id}`);break;case"edit":t({title:"Editar turma",description:`Editando turma: ${a?.name||"Sem nome"}`});break;case"inviteStudent":a?.id&&v(`/dashboard/classes/${a.id}?tab=invites`);break;case"delete":y(a),p(!0);break;case"export":_(a);break;case"uploadMaterial":J(a),g(!0);break;case"students":a?.id&&v(`/dashboard/classes/${a.id}?tab=students`);break;case"filter":t({title:"Filtros",description:"Use os campos de busca e seleção para filtrar as turmas."});break;default:t({title:"Ação não implementada",description:`A ação ${s} ainda não foi implementada.`}),console.warn("Ação não implementada:",s);break}}catch(o){t({variant:"destructive",title:"Erro",description:o.message})}},V=s=>{y(s),p(!0)},K=async()=>{if(d)try{await ke.deleteClass(d.id),await H(),C(c.filter(s=>s.id!==d.id)),t({title:"Turma removida!",description:`A turma "${d.name}" foi removida com sucesso.`})}catch(s){console.error("Error invalidating cache:",s),C(c.filter(a=>a.id!==d.id)),t({title:"Turma removida!",description:`A turma "${d.name}" foi removida com sucesso.`})}p(!1),y(null)},_=async s=>{if(s){j(!0);try{const a=await Ce(s.id),o=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),w=window.URL.createObjectURL(o),n=document.createElement("a");n.href=w,n.download=`dados-turma-${s.name}.json`,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(w),document.body.removeChild(n),t({title:"Exportação concluída!",description:"Os dados da turma foram baixados com sucesso."})}catch(a){console.error("Error exporting class data:",a),t({title:"Erro",description:"Não foi possível exportar os dados da turma.",variant:"destructive"})}finally{j(!1)}}},X=async()=>{if(!k||!x){t({title:"Erro",description:"Por favor, selecione um arquivo para enviar.",variant:"destructive"});return}j(!0);try{const s=new FormData;s.append("file",x),s.append("classId",k.id),s.append("uploadedBy",b.id),await new Promise(a=>setTimeout(a,1500)),t({title:"Material enviado!",description:`O arquivo foi enviado com sucesso para a turma ${k.name}.`}),g(!1),D(null)}catch(s){console.error("Error uploading material:",s),t({title:"Erro",description:"Não foi possível enviar o material. Tente novamente.",variant:"destructive"})}finally{j(!1)}},Q=s=>{const a=s.target.files[0];if(a){if(a.size>10*1024*1024){t({title:"Arquivo muito grande",description:"O tamanho máximo permitido é 10MB.",variant:"destructive"});return}D(a)}},M=c.filter(s=>s.name.toLowerCase().includes(u.toLowerCase())||s.subject.toLowerCase().includes(u.toLowerCase())),W=c.reduce((s,a)=>s+a.students,0),Y=Math.round(c.reduce((s,a)=>s+a.performance,0)/c.length);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100",children:[e.jsxs("div",{className:"w-full space-y-8 p-6",children:[e.jsxs(h.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"relative overflow-hidden bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 rounded-3xl p-8 text-white",children:[e.jsx("div",{className:"absolute inset-0 bg-black/10"}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-4xl font-bold",children:"Turmas"}),e.jsx("p",{className:"text-blue-100 text-lg",children:"Gerencie suas turmas e acompanhe o desempenho dos alunos"})]}),m&&e.jsxs(l,{className:"bg-white/20 backdrop-blur-sm hover:bg-white/30 text-white border border-white/30 transition-all duration-300",onClick:()=>i("create"),children:[e.jsx(B,{className:"mr-2 w-5 h-5"}),"Nova Turma"]})]})}),e.jsx("div",{className:"absolute -top-4 -right-4 w-24 h-24 bg-white/10 rounded-full blur-xl"}),e.jsx("div",{className:"absolute -bottom-8 -left-8 w-32 h-32 bg-white/5 rounded-full blur-2xl"})]}),e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl p-6 border border-white/50 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Total de Turmas"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:c.length})]}),e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl flex items-center justify-center",children:e.jsx(S,{className:"w-6 h-6 text-white"})})]})}),e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl p-6 border border-white/50 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Total de Alunos"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:W})]}),e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-green-500 to-green-600 rounded-xl flex items-center justify-center",children:e.jsx(P,{className:"w-6 h-6 text-white"})})]})}),e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl p-6 border border-white/50 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Performance Média"}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:[Y,"%"]})]}),e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-white"})})]})})]}),e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ae,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),e.jsx(U,{placeholder:"Buscar turmas...",value:u,onChange:s=>$(s.target.value),className:"pl-12 h-12 bg-white/70 backdrop-blur-sm border-white/50 rounded-xl"})]}),e.jsxs(l,{variant:"outline",className:"h-12 bg-white/70 backdrop-blur-sm border-white/50",onClick:()=>i("filter"),children:[e.jsx(Ae,{className:"mr-2 w-5 h-5"}),"Filtros"]}),m&&e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"outline",className:"h-12 bg-white/70 backdrop-blur-sm border-white/50",onClick:()=>i("export"),children:"Exportar"}),e.jsx(l,{variant:"outline",className:"h-12 bg-white/70 backdrop-blur-sm border-white/50",onClick:()=>i("uploadMaterial"),children:"Carregar Material"})]})]}),M.length>0?e.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:M.map((s,a)=>e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*a},className:"group bg-white/70 backdrop-blur-sm rounded-2xl border border-white/50 shadow-lg overflow-hidden hover:shadow-xl hover:scale-105 transition-all duration-300",children:[e.jsxs("div",{className:`bg-gradient-to-r ${s.color} p-6 text-white relative overflow-hidden`,children:[e.jsx("div",{className:"absolute inset-0 bg-black/10"}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-bold text-xl",children:s.name}),e.jsx("p",{className:"text-white/90",children:s.subject}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(te,{className:"w-4 h-4 text-yellow-300"}),e.jsxs("span",{className:"text-sm font-medium",children:[s.performance,"% performance"]})]})]}),e.jsxs(re,{children:[e.jsx(ie,{asChild:!0,children:e.jsx(l,{variant:"ghost",size:"icon",className:"h-8 w-8 text-white hover:bg-white/20",children:e.jsx(Fe,{className:"h-4 w-4"})})}),e.jsxs(le,{align:"end",className:"bg-white/95 backdrop-blur-sm",children:[e.jsxs(N,{onClick:()=>i("view",s),children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Visualizar"})]}),m&&e.jsxs(N,{onClick:()=>i("edit",s),children:[e.jsx(Le,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Editar"})]}),m&&e.jsxs(N,{onClick:()=>i("inviteStudent",s),children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Convidar Aluno"})]}),e.jsx(oe,{}),m&&e.jsxs(N,{className:"text-red-600 focus:text-red-600 focus:bg-red-50",onClick:()=>V(s),children:[e.jsx(Me,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Excluir"})]})]})]})]})}),e.jsx("div",{className:"absolute -top-4 -right-4 w-16 h-16 bg-white/10 rounded-full blur-xl"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(P,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Alunos"}),e.jsx("p",{className:"font-semibold text-gray-900",children:s.students})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(S,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Atividades"}),e.jsx("p",{className:"font-semibold text-gray-900",children:s.activities})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center",children:e.jsx(ne,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Próxima Aula"}),e.jsx("p",{className:"font-semibold text-gray-900",children:new Date(s.nextClass).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})]})]})]}),e.jsx("div",{className:"p-6 pt-0",children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(l,{variant:"outline",size:"sm",className:"flex-1 bg-white/50 hover:bg-white/80 transition-all duration-300",onClick:()=>i("view",s),children:[e.jsx(z,{className:"mr-2 w-4 h-4"}),"Visualizar"]}),e.jsxs(l,{variant:"outline",size:"sm",className:"flex-1 bg-white/50 hover:bg-white/80 transition-all duration-300",onClick:()=>i("students",s),children:[e.jsx(O,{className:"mr-2 w-4 h-4"}),"Alunos"]})]})})]},s.id))}):e.jsxs(h.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-16 bg-white/70 backdrop-blur-sm rounded-2xl border border-white/50",children:[e.jsx(S,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Nenhuma turma encontrada"}),e.jsx("p",{className:"text-gray-500 mb-6",children:u?"Tente ajustar sua busca":"Comece criando sua primeira turma"}),!u&&m&&e.jsxs(l,{className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white",onClick:()=>i("create"),children:[e.jsx(B,{className:"mr-2 w-5 h-5"}),"Nova Turma"]})]}),e.jsx(de,{open:R,onOpenChange:p,children:e.jsxs(ce,{className:"bg-white/95 backdrop-blur-sm",children:[e.jsxs(me,{children:[e.jsx(xe,{children:"Confirmar exclusão"}),e.jsxs(he,{children:['Tem certeza que deseja excluir a turma "',d?.name,'"? Esta ação não pode ser desfeita.']})]}),e.jsxs(ue,{children:[e.jsx(pe,{children:"Cancelar"}),e.jsx(ge,{onClick:K,className:"bg-red-600 hover:bg-red-700",children:"Sim, excluir"})]})]})})]}),e.jsx(fe,{open:G,onOpenChange:g,children:e.jsxs(je,{className:"sm:max-w-[425px]",children:[e.jsx(be,{children:e.jsx(ve,{children:"Enviar Material"})}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(we,{htmlFor:"file",children:"Selecione um arquivo"}),e.jsx(U,{id:"file",type:"file",onChange:Q,disabled:f,accept:".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.jpg,.jpeg,.png"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Formatos suportados: PDF, DOC, XLS, PPT, JPG, PNG (até 10MB)"}),x&&e.jsxs("div",{className:"mt-2 p-3 bg-muted/50 rounded-md",children:[e.jsx("p",{className:"text-sm font-medium",children:x.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(x.size/1024/1024).toFixed(2)," MB"]})]})]})}),e.jsxs(Ne,{children:[e.jsx(l,{variant:"outline",onClick:()=>{g(!1),D(null)},disabled:f,children:"Cancelar"}),e.jsx(l,{onClick:X,disabled:!x||f,children:f?e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"mr-2 h-4 w-4 animate-spin"}),"Enviando..."]}):"Enviar Material"})]})]})})]})};export{Qe as default};
