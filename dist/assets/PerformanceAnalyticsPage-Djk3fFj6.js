import{al as L,r as h,j as e,s as m}from"./main-Bq8SWujy.js";import{B as i,C as w,T as s}from"./Box-DOgmli8Q.js";import{T as P,a as v}from"./Tabs-CKgMSKzh.js";import{G as o,C as c,a as l}from"./Grid-C-Qdfsqa.js";import{R as p,T as u}from"./CategoricalChart-Bk8lXI1V.js";import{B as k,a as E}from"./BarChart-C5wT97kD.js";import{C as b,X as C,Y as _}from"./CartesianChart-6MqY9mZ1.js";import{L as g}from"./Legend-5XAyelAB.js";import{P as I,a as K,C as M}from"./PieChart-DrTwfOEW.js";import{L as N,a as V}from"./LineChart-Csy3caxV.js";import"./assertThisInitialized-b-KHx1rs.js";import"./extends-CF3RwP-h.js";import"./inheritsLoose-CMRHYPv0.js";import"./index-D_P3mdcN.js";import"./useThemeProps-DH66GmWk.js";const T=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8"],se=()=>{const{studentId:n}=L(),[B,y]=h.useState(!0),[x,D]=h.useState(0),[r,R]=h.useState({gradesBySubject:[],completionRate:0,averageGrade:0,activityTypes:[],performanceTrend:[]});return h.useEffect(()=>{(async()=>{try{y(!0);const[{data:a},{data:F},{data:A},{data:f}]=await Promise.all([m.rpc("get_grades_by_subject",{student_id:n}),m.rpc("get_completion_rate",{student_id:n}),m.rpc("get_activity_type_distribution",{student_id:n}),m.from("performance_metrics").select("*").eq("student_id",n).order("metric_date",{ascending:!0})]),j=f?.filter(d=>d.metric_type==="grade")||[],S=j.length>0?(j.reduce((d,G)=>d+G.value,0)/j.length).toFixed(2):0,$=F?.[0]?.completion_rate||0;R({gradesBySubject:a||[],completionRate:$,averageGrade:S,activityTypes:A||[],performanceTrend:f?.filter(d=>d.metric_type==="grade")||[]})}catch(a){console.error("Error fetching analytics:",a)}finally{y(!1)}})()},[n]),B?e.jsx(i,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"300px",children:e.jsx(w,{})}):e.jsxs(i,{sx:{p:3},children:[e.jsx(s,{variant:"h4",gutterBottom:!0,children:"Análise de Desempenho"}),e.jsxs(P,{value:x,onChange:(t,a)=>D(a),sx:{mb:3},children:[e.jsx(v,{label:"Visão Geral"}),e.jsx(v,{label:"Análise Detalhada"})]}),x===0&&e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{item:!0,xs:12,md:6,children:e.jsx(c,{children:e.jsxs(l,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Notas por Disciplina"}),e.jsx("div",{style:{height:300},children:e.jsx(p,{width:"100%",height:"100%",children:e.jsxs(k,{data:r.gradesBySubject,children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(C,{dataKey:"subject"}),e.jsx(_,{domain:[0,100]}),e.jsx(u,{formatter:t=>[`${t}%`,"Média"]}),e.jsx(g,{}),e.jsx(E,{dataKey:"average_grade",fill:"#8884d8",name:"Média"})]})})})]})})}),e.jsx(o,{item:!0,xs:12,md:6,children:e.jsx(c,{children:e.jsxs(l,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Distribuição de Atividades"}),e.jsx("div",{style:{height:300},children:e.jsx(p,{width:"100%",height:"100%",children:e.jsxs(I,{children:[e.jsx(K,{data:r.activityTypes,cx:"50%",cy:"50%",labelLine:!1,outerRadius:80,fill:"#8884d8",dataKey:"count",nameKey:"type",label:({name:t,percent:a})=>`${t}: ${(a*100).toFixed(0)}%`,children:r.activityTypes.map((t,a)=>e.jsx(M,{fill:T[a%T.length]},`cell-${a}`))}),e.jsx(u,{formatter:(t,a)=>[`${t} atividades`,a]}),e.jsx(g,{})]})})})]})})}),e.jsx(o,{item:!0,xs:12,md:6,children:e.jsx(c,{children:e.jsxs(l,{children:[e.jsx(s,{variant:"h6",children:"Taxa de Conclusão"}),e.jsxs(i,{display:"flex",alignItems:"center",mt:2,children:[e.jsx(i,{sx:{width:100,height:100,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",background:`conic-gradient(#4CAF50 ${r.completionRate}%, #e0e0e0 ${r.completionRate}% 100%)`,mr:3},children:e.jsxs(s,{variant:"h5",children:[r.completionRate,"%"]})}),e.jsx(s,{children:"das atividades foram concluídas"})]})]})})}),e.jsx(o,{item:!0,xs:12,md:6,children:e.jsx(c,{children:e.jsxs(l,{children:[e.jsx(s,{variant:"h6",children:"Média Geral"}),e.jsxs(i,{display:"flex",alignItems:"center",mt:2,children:[e.jsx(i,{sx:{width:100,height:100,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",background:`conic-gradient(#2196F3 ${r.averageGrade}%, #e0e0e0 ${r.averageGrade}% 100%)`,mr:3},children:e.jsxs(s,{variant:"h5",children:[r.averageGrade,"%"]})}),e.jsx(s,{children:"é a sua média geral"})]})]})})})]}),x===1&&e.jsx(c,{sx:{mt:3},children:e.jsxs(l,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Evolução do Desempenho"}),e.jsx("div",{style:{height:400},children:e.jsx(p,{width:"100%",height:"100%",children:e.jsxs(N,{data:r.performanceTrend,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(C,{dataKey:"metric_date",tickFormatter:t=>new Date(t).toLocaleDateString("pt-BR")}),e.jsx(_,{domain:[0,100]}),e.jsx(u,{labelFormatter:t=>`Data: ${new Date(t).toLocaleDateString("pt-BR")}`,formatter:t=>[`${t}%`,"Nota"]}),e.jsx(g,{}),e.jsx(V,{type:"monotone",dataKey:"value",name:"Sua Nota",stroke:"#8884d8",activeDot:{r:8}})]})})})]})})]})};export{se as default};
