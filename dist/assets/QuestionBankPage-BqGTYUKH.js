import{f as T,s as o,g as Q,u as A,r as m,j as e,m as d,a0 as S,C as b,w as j,A as P,a1 as B,a2 as F,Z as U,B as v,W as H,T as R,U as I}from"./main-Bujpyeg-.js";import{P as p}from"./PremiumCard-BaDWg06v.js";import{P as f}from"./PremiumButton-skKgx_xy.js";import{B as g}from"./badge-BFkPUQ-P.js";import{P as y}from"./plus-C0dvgUSL.js";import{C as w}from"./circle-check-big-CPiXxACV.js";import{T as z}from"./target-BbDyQUob.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],V=T("tag",L),O=async t=>{try{const{data:{user:s}}=await o.auth.getUser();if(!s)throw new Error("Usu√°rio n√£o autenticado");const{data:a,error:i}=await o.from("question_bank").insert({author_id:s.id,title:t.title,question_text:t.question_text,question_type:t.question_type,options:t.options||null,correct_answer:t.correct_answer,explanation:t.explanation,difficulty:t.difficulty,subject:t.subject,topic:t.topic,tags:t.tags||[],reference:t.reference,visibility:t.visibility||"public",school_id:t.school_id||null,status:"pending",points:t.points||10}).select().single();if(i)throw i;return{success:!0,data:a}}catch(s){return console.error("Erro ao criar quest√£o:",s),{success:!1,error:s.message}}},Z=async(t={})=>{try{let s=o.from("question_bank").select(`
        *,
        profiles:author_id(name),
        schools:school_id(name)
      `);t.subject&&(s=s.eq("subject",t.subject)),t.topic&&(s=s.ilike("topic",`%${t.topic}%`)),t.difficulty&&(s=s.eq("difficulty",t.difficulty)),t.questionType&&(s=s.eq("question_type",t.questionType)),t.status&&(s=s.eq("status",t.status)),t.visibility&&(s=s.eq("visibility",t.visibility)),t.tags&&t.tags.length>0&&(s=s.contains("tags",t.tags)),t.authorId&&(s=s.eq("author_id",t.authorId)),t.schoolId&&(s=s.eq("school_id",t.schoolId)),t.status||(s=s.eq("status","approved"));const{data:a,error:i}=await s.order("created_at",{ascending:!1});if(i)throw i;return{success:!0,data:a||[]}}catch(s){return console.error("Erro ao buscar quest√µes:",s),{success:!1,error:s.message,data:[]}}},$=async(t,s=null)=>{try{const{data:a,error:i}=await o.from("question_bank").update({status:"approved",approved_at:new Date().toISOString(),moderator_notes:s}).eq("id",t).select().single();if(i)throw i;return await G(a.author_id),{success:!0,data:a}}catch(a){return console.error("Erro ao aprovar quest√£o:",a),{success:!1,error:a.message}}},D=async(t,s)=>{try{const{data:a,error:i}=await o.from("question_bank").update({status:"rejected",moderator_notes:s}).eq("id",t).select().single();if(i)throw i;return{success:!0,data:a}}catch(a){return console.error("Erro ao rejeitar quest√£o:",a),{success:!1,error:a.message}}},G=async t=>{try{const{count:s}=await o.from("question_bank").select("*",{count:"exact",head:!0}).eq("author_id",t).eq("status","approved"),a=Math.min(25,Math.floor(s/50)*2);return await o.from("profiles").update({questions_contributed:s,discount_percentage:a}).eq("id",t),s}catch(s){return console.error("Erro ao incrementar contribui√ß√µes:",s),0}},W=async t=>{try{const{data:s}=await o.from("question_bank").select("status, uses_count").eq("author_id",t);return s?{total:s.length,approved:s.filter(i=>i.status==="approved").length,pending:s.filter(i=>i.status==="pending").length,rejected:s.filter(i=>i.status==="rejected").length,totalUses:s.reduce((i,n)=>i+(n.uses_count||0),0),discountEarned:Math.min(25,Math.floor(s.filter(i=>i.status==="approved").length/50)*2)}:null}catch(s){return console.error("Erro ao buscar stats do autor:",s),null}},J=async t=>{try{const{error:s}=await o.rpc("increment_question_uses",{question_id:t});if(s){const{data:a}=await o.from("question_bank").select("uses_count").eq("id",t).single();await o.from("question_bank").update({uses_count:(a?.uses_count||0)+1}).eq("id",t)}return{success:!0}}catch(s){return console.error("Erro ao registrar uso:",s),{success:!1}}},K=async(t,s)=>{try{const{data:{user:a}}=await o.auth.getUser();if(!a)throw new Error("Usu√°rio n√£o autenticado");const{data:i,error:n}=await o.from("question_feedback").insert({question_id:t,user_id:a.id,rating:s.rating,comment:s.comment,issue_type:s.issueType}).select().single();if(n)throw n;return{success:!0,data:i}}catch(a){return console.error("Erro ao enviar feedback:",a),{success:!1,error:a.message}}},X=async t=>{try{const{data:s}=await o.from("question_bank").select("uses_count, correct_rate").eq("id",t).single(),{data:a}=await o.from("question_feedback").select("rating").eq("question_id",t),i=a&&a.length>0?a.reduce((n,l)=>n+l.rating,0)/a.length:0;return{usesCount:s?.uses_count||0,correctRate:s?.correct_rate||0,avgRating:Math.round(i*10)/10,totalFeedbacks:a?.length||0}}catch(s){return console.error("Erro ao buscar stats da quest√£o:",s),null}},Y=async(t,s={})=>{try{const{data:a}=await o.from("user_question_attempts").select("question_id, is_correct, difficulty").eq("user_id",t).order("attempted_at",{ascending:!1}).limit(20);let i=3;if(a&&a.length>5){const l=a.slice(0,5).filter(u=>u.is_correct).length;l>=4?i=Math.min(5,(a[0]?.difficulty||3)+1):l<=1&&(i=Math.max(1,(a[0]?.difficulty||3)-1))}const{data:n}=await o.from("question_bank").select("*").eq("status","approved").eq("difficulty",i).eq("subject",s.subject||"").not("id","in",a?.map(l=>l.question_id)||[]).limit(10);return{success:!0,questions:n||[],targetDifficulty:i,recommendation:i>3?"Desafiante":i<3?"Revis√£o":"Adequado"}}catch(a){return console.error("Erro ao buscar quest√µes adaptativas:",a),{success:!1,questions:[]}}},ee=async t=>{try{let s=o.from("question_bank").select("*").eq("status","approved");t.subject&&(s=s.eq("subject",t.subject)),t.difficulty&&(s=s.eq("difficulty",t.difficulty)),t.questionType&&(s=s.eq("question_type",t.questionType));const{data:a}=await s;if(!a||a.length===0)return{success:!1,message:"Nenhuma quest√£o encontrada"};const i=Math.min(t.count||10,a.length);return{success:!0,questions:a.sort(()=>.5-Math.random()).slice(0,i),totalAvailable:a.length}}catch(s){return console.error("Erro ao gerar quiz:",s),{success:!1,message:"Erro ao gerar quiz"}}},N={createQuestion:O,searchQuestions:Z,approveQuestion:$,rejectQuestion:D,getAuthorStats:W,recordQuestionUse:J,submitQuestionFeedback:K,getQuestionStats:X,getAdaptiveQuestions:Y,generateRandomQuiz:ee};function de(){const t=Q(),{user:s}=A(),[a,i]=m.useState(!0),[n,l]=m.useState([]),[u,_]=m.useState(null),[c,x]=m.useState({subject:"",difficulty:null,questionType:"",status:"approved",search:""}),[se,te]=m.useState("browse");m.useEffect(()=>{k(),s&&q()},[c.subject,c.difficulty,c.questionType,c.status]);const k=async()=>{i(!0);const r=await N.searchQuestions(c);r.success&&l(r.data),i(!1)},q=async()=>{const r=await N.getAuthorStats(s.id);_(r)},C=r=>{const h={1:"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300",2:"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300",3:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300",4:"bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300",5:"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300"};return h[r]||h[3]},E=r=>({1:"Muito F√°cil",2:"F√°cil",3:"M√©dio",4:"Dif√≠cil",5:"Muito Dif√≠cil"})[r]||"M√©dio",M=r=>({multiple_choice:"M√∫ltipla Escolha",true_false:"Verdadeiro/Falso",open:"Dissertativa"})[r]||r;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900",children:[e.jsx(d.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-8 shadow-xl",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"üè¶ Banco de Quest√µes"}),e.jsx("p",{className:"text-blue-100",children:"Milhares de quest√µes curadas | Contribua e ganhe desconto"})]}),e.jsxs(f,{onClick:()=>t("/dashboard/question-bank/create"),className:"bg-white text-purple-600 hover:bg-blue-50",children:[e.jsx(y,{className:"w-5 h-5 mr-2"}),"Nova Quest√£o"]})]}),u&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs(d.div,{whileHover:{scale:1.05},className:"bg-white/10 backdrop-blur-sm rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(S,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm text-blue-100",children:"Total"})]}),e.jsx("div",{className:"text-2xl font-bold",children:u.total})]}),e.jsxs(d.div,{whileHover:{scale:1.05},className:"bg-white/10 backdrop-blur-sm rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(w,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm text-blue-100",children:"Aprovadas"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-300",children:u.approved})]}),e.jsxs(d.div,{whileHover:{scale:1.05},className:"bg-white/10 backdrop-blur-sm rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(b,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm text-blue-100",children:"Pendentes"})]}),e.jsx("div",{className:"text-2xl font-bold text-yellow-300",children:u.pending})]}),e.jsxs(d.div,{whileHover:{scale:1.05},className:"bg-white/10 backdrop-blur-sm rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(j,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm text-blue-100",children:"Usos"})]}),e.jsx("div",{className:"text-2xl font-bold",children:u.totalUses})]}),e.jsxs(d.div,{whileHover:{scale:1.05},className:"bg-gradient-to-br from-yellow-400 to-orange-500 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(P,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm text-white",children:"Desconto"})]}),e.jsxs("div",{className:"text-2xl font-bold",children:[u.discountEarned,"%"]})]})]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsx(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsx(p,{variant:"elevated",className:"mb-6",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"md:col-span-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(F,{type:"text",placeholder:"Buscar quest√µes...",value:c.search,onChange:r=>x({...c,search:r.target.value}),className:"pl-10"})]})}),e.jsxs("select",{value:c.subject,onChange:r=>x({...c,subject:r.target.value}),className:"px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-slate-800",children:[e.jsx("option",{value:"",children:"Todas Mat√©rias"}),e.jsx("option",{value:"matematica",children:"Matem√°tica"}),e.jsx("option",{value:"portugues",children:"Portugu√™s"}),e.jsx("option",{value:"fisica",children:"F√≠sica"}),e.jsx("option",{value:"quimica",children:"Qu√≠mica"}),e.jsx("option",{value:"biologia",children:"Biologia"}),e.jsx("option",{value:"historia",children:"Hist√≥ria"}),e.jsx("option",{value:"geografia",children:"Geografia"}),e.jsx("option",{value:"ingles",children:"Ingl√™s"})]}),e.jsxs("select",{value:c.difficulty||"",onChange:r=>x({...c,difficulty:r.target.value?parseInt(r.target.value):null}),className:"px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-slate-800",children:[e.jsx("option",{value:"",children:"Todas Dificuldades"}),e.jsx("option",{value:"1",children:"Muito F√°cil"}),e.jsx("option",{value:"2",children:"F√°cil"}),e.jsx("option",{value:"3",children:"M√©dio"}),e.jsx("option",{value:"4",children:"Dif√≠cil"}),e.jsx("option",{value:"5",children:"Muito Dif√≠cil"})]}),e.jsxs("select",{value:c.questionType,onChange:r=>x({...c,questionType:r.target.value}),className:"px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-slate-800",children:[e.jsx("option",{value:"",children:"Todos Tipos"}),e.jsx("option",{value:"multiple_choice",children:"M√∫ltipla Escolha"}),e.jsx("option",{value:"true_false",children:"Verdadeiro/Falso"}),e.jsx("option",{value:"open",children:"Dissertativa"})]}),e.jsxs("select",{value:c.status,onChange:r=>x({...c,status:r.target.value}),className:"px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-slate-800",children:[e.jsx("option",{value:"",children:"Todos Status"}),e.jsx("option",{value:"approved",children:"Aprovadas"}),e.jsx("option",{value:"pending",children:"Pendentes"}),e.jsx("option",{value:"rejected",children:"Rejeitadas"})]})]})})})}),a?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(d.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"inline-block",children:e.jsx(U,{className:"w-12 h-12 text-purple-600"})}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando quest√µes..."})]}):n.length===0?e.jsx(p,{variant:"elevated",children:e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(v,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Nenhuma quest√£o encontrada"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Ajuste os filtros ou seja o primeiro a contribuir!"}),e.jsxs(f,{onClick:()=>t("/dashboard/question-bank/create"),children:[e.jsx(y,{className:"w-5 h-5 mr-2"}),"Criar Primeira Quest√£o"]})]})}):e.jsx("div",{className:"grid gap-4",children:e.jsx(H,{children:n.map((r,h)=>e.jsx(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},transition:{delay:h*.05},children:e.jsx(p,{variant:"elevated",className:"hover:shadow-xl transition-shadow",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(g,{className:C(r.difficulty),children:[e.jsx(z,{className:"w-3 h-3 mr-1"}),E(r.difficulty)]}),e.jsx(g,{variant:"outline",children:M(r.question_type)}),r.status==="approved"&&e.jsxs(g,{className:"bg-green-100 text-green-700",children:[e.jsx(w,{className:"w-3 h-3 mr-1"}),"Aprovada"]}),r.status==="pending"&&e.jsxs(g,{className:"bg-yellow-100 text-yellow-700",children:[e.jsx(b,{className:"w-3 h-3 mr-1"}),"Pendente"]})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:r.title}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 line-clamp-2",children:r.question_text})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2 ml-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(j,{className:"w-4 h-4"}),r.uses_count||0]}),r.correct_rate&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(R,{className:"w-4 h-4"}),r.correct_rate,"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400",children:[r.subject&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(v,{className:"w-4 h-4"}),r.subject]}),r.reference&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"w-4 h-4"}),r.reference]}),r.profiles&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{className:"w-4 h-4"}),r.profiles.name]})]}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>t(`/dashboard/question-bank/${r.id}`),children:"Ver Detalhes"})]})]})})},r.id))})})]})]})}export{de as default};
