import{u as P,r as t,s as E,j as e,M as R,U,d as B}from"./main-Bujpyeg-.js";import{s as D}from"./schoolService-DcalQc3H.js";import{S as L}from"./send-D6bioMOQ.js";const $=({announcement:r})=>{const o=()=>{const l=r.audience||{};return l.all?"Todos":l.teachers?"Professores":l.classes&&l.classes.length>0?`${l.classes.length} turma${l.classes.length>1?"s":""}`:"Não especificado"};return e.jsxs("div",{className:"rounded-lg border border-border/50 bg-card p-4",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:r.title}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:r.body})]})}),e.jsxs("div",{className:"mt-3 flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"h-3 w-3"}),o()]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"h-3 w-3"}),new Date(r.created_at).toLocaleDateString("pt-BR")]})]})]})},G=()=>{const{user:r}=P(),[o,l]=t.useState(null),[h,k]=t.useState([]),[p,T]=t.useState([]),[_,g]=t.useState(!0),[d,f]=t.useState(!1),[b,x]=t.useState(null),[j,N]=t.useState(null),[i,v]=t.useState(""),[m,y]=t.useState(""),[n,u]=t.useState("all"),[S,C]=t.useState([]);t.useEffect(()=>{w()},[r?.id]);const w=async()=>{if(r?.id)try{g(!0);const s=await D.getUserSchool(r.id);if(l(s),s?.id){const{data:a,error:c}=await E.from("school_announcements").select("*").eq("school_id",s.id).order("created_at",{ascending:!1});if(c)throw c;k(a||[]);const M=await D.getClasses(s.id);T(M)}}catch(s){console.error("Error loading data:",s),x("Erro ao carregar dados")}finally{g(!1)}},A=async s=>{if(s.preventDefault(),!(!o?.id||!i.trim()||!m.trim()))try{f(!0),x(null),N(null);const a={};n==="all"?a.all=!0:n==="teachers"?a.teachers=!0:n==="classes"&&(a.classes=S);const{error:c}=await E.from("school_announcements").insert({school_id:o.id,title:i.trim(),body:m.trim(),audience:a,created_by:r.id});if(c)throw c;N("Comunicado enviado com sucesso!"),v(""),y(""),u("all"),C([]),await w()}catch(a){x(a.message||"Erro ao enviar comunicado")}finally{f(!1)}},q=s=>{C(a=>a.includes(s)?a.filter(c=>c!==s):[...a,s])};return _?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-32 animate-pulse rounded-lg bg-muted"},s))}):o?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Comunicados"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Envie comunicados para professores e turmas de ",o.name]})]}),e.jsxs("div",{className:"rounded-2xl border border-border/50 bg-card p-6 shadow-sm",children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Novo Comunicado"})]}),e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Título"}),e.jsx("input",{type:"text",value:i,onChange:s=>v(s.target.value),placeholder:"Ex: Reunião de Pais",className:"w-full rounded-lg border border-border px-4 py-2",disabled:d,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Mensagem"}),e.jsx("textarea",{value:m,onChange:s=>y(s.target.value),placeholder:"Digite a mensagem do comunicado...",rows:4,className:"w-full rounded-lg border border-border px-4 py-2",disabled:d,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium",children:"Destinatários"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"audience",value:"all",checked:n==="all",onChange:s=>u(s.target.value),disabled:d}),e.jsx("span",{className:"text-sm",children:"Todos (professores e alunos)"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"audience",value:"teachers",checked:n==="teachers",onChange:s=>u(s.target.value),disabled:d}),e.jsx("span",{className:"text-sm",children:"Apenas professores"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"audience",value:"classes",checked:n==="classes",onChange:s=>u(s.target.value),disabled:d}),e.jsx("span",{className:"text-sm",children:"Turmas específicas"})]})]}),n==="classes"&&e.jsxs("div",{className:"mt-3 space-y-2 rounded-lg border border-border p-3",children:[e.jsx("div",{className:"text-sm font-medium",children:"Selecione as turmas:"}),p.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhuma turma vinculada."}):p.map(s=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:S.includes(s.id),onChange:()=>q(s.id),disabled:d}),e.jsx("span",{className:"text-sm",children:s.name})]},s.id))]})]}),b&&e.jsx("div",{className:"rounded-lg bg-red-50 p-3 text-sm text-red-600",children:b}),j&&e.jsx("div",{className:"rounded-lg bg-green-50 p-3 text-sm text-green-600",children:j}),e.jsx("button",{type:"submit",disabled:d||!i.trim()||!m.trim(),className:"w-full rounded-lg bg-primary px-6 py-3 font-medium text-primary-foreground hover:bg-primary/90 disabled:opacity-50",children:d?"Enviando...":"Enviar Comunicado"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Histórico de Comunicados"})]}),h.length===0?e.jsx("div",{className:"rounded-lg border border-border/50 bg-card p-8 text-center text-muted-foreground",children:"Nenhum comunicado enviado ainda."}):h.map(s=>e.jsx($,{announcement:s},s.id))]})]}):e.jsx("div",{className:"rounded-2xl border border-border/50 bg-card p-8 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Escola não encontrada."})})};export{G as default};
