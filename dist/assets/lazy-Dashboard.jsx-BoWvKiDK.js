const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RoleBasedDashboard-BCPIY5gb.js","assets/react-vendor-C2HUFn5N.js","assets/agora-vendor-BaKsgygX.js","assets/vendor-floating-ui-Cp6DLeIx.js","assets/lazy-CreateActivityPage.jsx-DYBofU2F.js","assets/supabase-vendor-DDsnGwAF.js","assets/vendor-lexical-BwIB3SdY.js","assets/form-vendor-DOeDnMZv.js","assets/vendor-hookform-DNVM_saV.js","assets/utils-small-jbG8BFt3.js","assets/ui-vendor-Dv2DrOQv.js","assets/vendor-react-remove-scroll-DsvUfOu-.js","assets/vendor-react-dropzone-JpbzFaVP.js","assets/mui-vendor-B2ef-T1O.js","assets/vendor-popperjs-DC5wud4b.js","assets/vendor-react-transition-group-B8LyvIk9.js","assets/vendor-babel-D_NiFZCp.js","assets/vendor-emotion-Db_OsA79.js","assets/vendor-react-is-BPJnJB5S.js","assets/vendor-react-remove-scroll-bar-CSW8oGnL.js","assets/vendor-react-style-singleton-Dz4UYqcM.js","assets/chart-vendor-BrjVtL_H.js","assets/utils-vendor-DsQmHAQY.js","assets/vendor-d3-shape-UAiSD6R2.js","assets/vendor-d3-path-CimkQT29.js","assets/vendor-reduxjs-DqzUYP_Z.js","assets/vendor-react-redux-BMfEIblb.js","assets/vendor-d3-scale-5MC2RT3O.js","assets/vendor-d3-array-LGjaf_JI.js","assets/vendor-d3-time-format-ULTh4mXe.js","assets/vendor-d3-time-1W6MP4Cc.js","assets/vendor-d3-interpolate-BPXZzoDY.js","assets/vendor-d3-color-9lF95FHy.js","assets/vendor-d3-format-CzD4bSOQ.js","assets/vendor-react-router-B4Bn0PSh.js","assets/motion-vendor-Crtv24Dn.js","assets/lazy-CreateActivityPage-C3MSjcZ1.css","assets/page-ClassroomsPage.jsx-CWEwUV_W.js","assets/page-ActivityManagementPage.jsx-C56hp2jB.js","assets/antd-vendor-K_53YjeB.js","assets/vendor-ant-design-DUMbFEki.js","assets/vendor-rc-component-C-WFx14O.js","assets/page-ActivitiesListPage.jsx-Cv5lq7oV.js","assets/vendor-react-toastify-Czf6rXFv.js"])))=>i.map(i=>d[i]);
import{R as N,j as e,r as m,D as de,f as q,E as ce,H as ue,J as me,K as v,M as he,N as fe,O as xe,Q as O,Z as pe,X as ge,U as T,V as _,B as E,Y as be,_ as ye,$ as Ne,a0 as we,a1 as ve,u as je,v as Se}from"./react-vendor-C2HUFn5N.js";import{j as B,F as $,k as F,l as ke,m as _e,n as Y,o as V,p as H,q as Q,r as W,s as G,t as J,u as Z,v as K,w as X,x as ee,y as Ee,z as Ce,A as re,B as De}from"./ui-vendor-Dv2DrOQv.js";import{s as u,c as g,u as Re,B as y,a as ae,I as Ae}from"./lazy-CreateActivityPage.jsx-DYBofU2F.js";import{f as Me,p as Oe}from"./utils-vendor-DsQmHAQY.js";import{m as te,A as Te}from"./motion-vendor-Crtv24Dn.js";import{u as Ie,a as se,L as I}from"./vendor-react-router-B4Bn0PSh.js";const ze="modulepreload",Le=function(a){return"/"+a},z={},Ue=function(r,t,s){let c=Promise.resolve();if(t&&t.length>0){let f=function(o){return Promise.all(o.map(d=>Promise.resolve(d).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),h=i?.nonce||i?.getAttribute("nonce");c=f(t.map(o=>{if(o=Le(o),o in z)return;z[o]=!0;const d=o.endsWith(".css"),p=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${p}`))return;const x=document.createElement("link");if(x.rel=d?"stylesheet":ze,d||(x.as="script"),x.crossOrigin="",x.href=o,h&&x.setAttribute("nonce",h),document.head.appendChild(x),d)return new Promise((S,k)=>{x.addEventListener("load",S),x.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${o}`)))})}))}function n(i){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=i,window.dispatchEvent(h),!h.defaultPrevented)throw i}return c.then(i=>{for(const h of i||[])h.status==="rejected"&&n(h.reason);return r().catch(n)})};class Pe extends N.Component{constructor(r){super(r),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(r){return{hasError:!0}}componentDidCatch(r,t){console.error("ErrorBoundary caught an error:",r,t),this.setState({error:r,errorInfo:t}),this.props.onError&&this.props.onError(r,t)}handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?e.jsx("div",{className:"rounded-md bg-red-50 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:this.props.errorTitle||"Algo deu errado"}),e.jsxs("div",{className:"mt-2 text-sm text-red-700",children:[e.jsx("p",{children:this.props.errorMessage||"Ocorreu um erro ao carregar este conteúdo. Por favor, tente novamente."}),!1]}),e.jsx("div",{className:"mt-4",children:e.jsxs("button",{className:"inline-flex items-center px-3 py-2 border border-red-300 text-sm leading-4 font-medium rounded-md text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",onClick:this.handleRetry,children:[e.jsx("svg",{className:"mr-2 h-4 w-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})}),"Tentar novamente"]})})]})]})}):this.props.children}}const L={SYSTEM:"system"},U={SYSTEM:"system"},P={NORMAL:"normal"},C={async getNotifications({types:a,categories:r,priorities:t,unreadOnly:s,limit:c=50,offset:n=0,orderBy:i="created_at",orderDir:h="desc"}={}){try{const{data:{user:f}}=await u.auth.getUser();if(!f)return{data:[],count:0};let o=u.from("notifications").select("*",{count:"exact"}).eq("user_id",f.id);a?.length&&(o=o.in("type",a)),r?.length&&(o=o.in("category",r)),t?.length&&(o=o.in("priority",t)),s&&(o=o.is("read_at",null)),o=o.order(i,{ascending:h==="asc"}).range(n,n+c-1);const{data:d,error:p,count:x}=await o;if(p)throw p;return{data:d,count:x}}catch(f){throw console.error("Error fetching notifications:",f),f}},async markAsRead(a,{userId:r}={}){try{if(Array.isArray(a)||(a=[a]),!a.length)return{success:!1,message:"No notification IDs provided"};const t=a.map(c=>({id:c,read_at:new Date().toISOString(),updated_at:new Date().toISOString(),...r&&{user_id:r}})),{error:s}=await u.rpc("update_notifications",{updates:JSON.stringify(t)});if(s)throw s;return{success:!0,message:"Notifications marked as read",affected:t.length}}catch(t){throw console.error("Error marking notifications as read:",t),t}},async scheduleReminder({type:a,eventId:r,dueAt:t,notification:s,remindBeforeMinutes:c=15,userId:n=null}){try{if(!n){const{data:o,error:d}=await u.auth.getUser();if(d)throw d;if(n=o.user?.id,!n)throw new Error("No user is currently signed in")}const i=typeof t=="string"?new Date(t):t,h=new Date(i.getTime()-c*60*1e3);if(h<new Date)return console.log("Reminder time is in the past, not scheduling"),null;const f={...s,metadata:{...s.metadata||{},isReminder:!0,eventType:a,eventId:r,originalDueAt:i.toISOString(),remindBeforeMinutes:c}};return await this.scheduleNotification(f,h,n)}catch(i){throw console.error("Error scheduling reminder:",i),i}},async cancelScheduledNotification(a,r=null){try{let t=u.from("scheduled_notifications").delete().eq("id",a);r&&(t=t.eq("user_id",r));const{error:s}=await t;if(s)throw s;return!0}catch(t){throw console.error("Error cancelling scheduled notification:",t),t}},async getScheduledNotifications({includeExecuted:a=!1,referenceId:r,referenceType:t}={}){try{const{data:s,error:c}=await u.auth.getUser();if(c)throw c;const n=s.user?.id;if(!n)throw new Error("No user is currently signed in");let i=u.from("scheduled_notifications").select("*").eq("user_id",n);a||(i=i.is("executed_at",null)),r&&(i=i.eq("reference_id",r)),t&&(i=i.eq("reference_type",t)),i=i.order("scheduled_for",{ascending:!0});const{data:h,error:f}=await i;if(f)throw f;return h.map(o=>({...o,scheduled_for:new Date(o.scheduled_for),created_at:new Date(o.created_at),executed_at:o.executed_at?new Date(o.executed_at):null}))}catch(s){throw console.error("Error fetching scheduled notifications:",s),s}},async sendNotification(a,r=null){try{if(!r){const{data:c,error:n}=await u.auth.getUser();if(n)throw n;if(r=c.user?.id,!r)throw new Error("No user is currently signed in")}const{data:t,error:s}=await u.from("notifications").insert([{user_id:r,title:a.title,message:a.message,type:a.type||L.SYSTEM,category:a.category||U.SYSTEM,priority:a.priority||P.NORMAL,reference_id:a.referenceId||null,reference_type:a.referenceType||null,action_url:a.actionUrl||null,metadata:a.metadata||{},created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select();if(s)throw s;return{success:!0,data:t?.[0]}}catch(t){throw console.error("Error sending notification:",t),t}},async scheduleNotification(a,r,t=null){try{if(!t){const{data:n,error:i}=await u.auth.getUser();if(i)throw i;if(t=n.user?.id,!t)throw new Error("No user is currently signed in")}const{data:s,error:c}=await u.from("scheduled_notifications").insert([{user_id:t,title:a.title,message:a.message,type:a.type||L.SYSTEM,category:a.category||U.SYSTEM,priority:a.priority||P.NORMAL,reference_id:a.referenceId||null,reference_type:a.referenceType||null,action_url:a.actionUrl||null,metadata:a.metadata||{},scheduled_for:r.toISOString(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select();if(c)throw c;return{success:!0,data:s?.[0]}}catch(s){throw console.error("Error scheduling notification:",s),s}},async processDueNotifications(){try{const a=new Date().toISOString(),{data:r,error:t}=await u.from("scheduled_notifications").select("*").lte("scheduled_for",a).is("executed_at",null);if(t)throw t;if(!r||r.length===0)return{sent:0,failed:0,total:0};let s=0,c=0;for(const n of r)try{await this.sendNotification({title:n.title,message:n.message,type:n.type,category:n.category,priority:n.priority,referenceId:n.reference_id,referenceType:n.reference_type,actionUrl:n.action_url,metadata:n.metadata},n.user_id);const{error:i}=await u.from("scheduled_notifications").update({executed_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",n.id);if(i)throw i;s++}catch(i){console.error(`Failed to process notification ${n.id}:`,i),c++,await u.from("scheduled_notifications").update({error_count:(n.error_count||0)+1,last_error:i.message,updated_at:new Date().toISOString()}).eq("id",n.id)}return{sent:s,failed:c,total:r.length}}catch(a){throw console.error("Error processing due notifications:",a),a}},async cleanupOldNotifications({daysToKeep:a=30}={}){const r=new Date;return r.setDate(r.getDate()-a),u.from("notifications").delete().lt("created_at",r.toISOString()).then(({error:t})=>{if(t)throw console.error("Error cleaning up old notifications:",t),t;return{success:!0}})},subscribeToNotifications(a){const{data:r}=u.auth.onAuthStateChange((t,s)=>{t==="SIGNED_IN"&&s?.user?.id?this.setupRealtimeSubscription(s.user.id,a):t==="SIGNED_OUT"&&u.removeAllChannels()});return u.auth.getSession().then(({data:{session:t}})=>{t?.user?.id&&this.setupRealtimeSubscription(t.user.id,a)}),()=>{r?.unsubscribe&&r.unsubscribe(),u.removeAllChannels()}},async setupRealtimeSubscription(a,r){return u.removeAllChannels(),u.channel("notifications").on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:`user_id=eq.${a}`},s=>{console.log("Notification update:",s),typeof r=="function"&&r(s)}).subscribe(()=>{})}},D=N.forwardRef(({className:a,...r},t)=>e.jsx(B,{ref:t,className:g("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...r})),R=N.forwardRef(({className:a,...r},t)=>e.jsx(F,{ref:t,className:g("aspect-square h-full w-full",a),...r})),A=N.forwardRef(({className:a,...r},t)=>e.jsx($,{ref:t,className:g("flex h-full w-full items-center justify-center rounded-full bg-slate-100 text-slate-600 font-medium",a),...r}));D.displayName=B.displayName;R.displayName=F.displayName;A.displayName=$.displayName;const qe=ke,Be=_e,$e=m.forwardRef(({className:a,inset:r,children:t,...s},c)=>e.jsxs(G,{ref:c,className:g("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",r&&"pl-8",a),...s,children:[t,e.jsx(de,{className:"ml-auto h-4 w-4"})]}));$e.displayName=G.displayName;const Fe=m.forwardRef(({className:a,...r},t)=>e.jsx(Y,{children:e.jsx(J,{ref:t,className:g("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})}));Fe.displayName=J.displayName;const oe=m.forwardRef(({className:a,sideOffset:r=4,...t},s)=>e.jsx(Y,{children:e.jsx(V,{ref:s,sideOffset:r,className:g("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...t})}));oe.displayName=V.displayName;const j=m.forwardRef(({className:a,inset:r,...t},s)=>e.jsx(W,{ref:s,className:g("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r&&"pl-8",a),...t}));j.displayName=W.displayName;const Ye=m.forwardRef(({className:a,children:r,checked:t,...s},c)=>e.jsxs(Z,{ref:c,className:g("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:t,...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(K,{children:e.jsx(q,{className:"h-4 w-4"})})}),r]}));Ye.displayName=Z.displayName;const Ve=m.forwardRef(({className:a,children:r,...t},s)=>e.jsxs(X,{ref:s,className:g("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(K,{children:e.jsx(ce,{className:"h-2 w-2 fill-current"})})}),r]}));Ve.displayName=X.displayName;const ne=m.forwardRef(({className:a,inset:r,...t},s)=>e.jsx(H,{ref:s,className:g("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",a),...t}));ne.displayName=H.displayName;const M=m.forwardRef(({className:a,...r},t)=>e.jsx(Q,{ref:t,className:g("-mx-1 my-1 h-px bg-muted",a),...r}));M.displayName=Q.displayName;const ie=m.forwardRef(({className:a,children:r,...t},s)=>e.jsxs(ee,{ref:s,className:g("relative overflow-hidden",a),...t,children:[e.jsx(Ee,{className:"h-full w-full rounded-[inherit]",children:r}),e.jsx(le,{}),e.jsx(Ce,{})]}));ie.displayName=ee.displayName;const le=m.forwardRef(({className:a,orientation:r="vertical",...t},s)=>e.jsx(re,{ref:s,orientation:r,className:g("flex touch-none select-none transition-colors",r==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",r==="horizontal"&&"h-2.5 border-t border-t-transparent p-[1px]",a),...t,children:e.jsx(De,{className:"relative flex-1 rounded-full bg-border"})}));le.displayName=re.displayName;const He=()=>{const[a,r]=m.useState([]),[t,s]=m.useState(!1),[c,n]=m.useState(!0),[i,h]=m.useState(!1),f=m.useRef(null),{toast:o}=Re(),d=m.useCallback(async()=>{if(!i)try{h(!0);const{data:l}=await C.getNotifications({limit:10,unreadOnly:!0,orderBy:"created_at",orderDir:"desc"});r(l||[])}catch(l){console.error("Error fetching notifications:",l),o({variant:"destructive",title:"Erro ao carregar notificações",description:"Não foi possível carregar as notificações. Tente novamente mais tarde."})}finally{n(!1),h(!1)}},[i,o]),p=async l=>{try{await C.markAsRead(l,{userId:(await u.auth.getUser()).data.user?.id}),r(b=>b.map(w=>w.id===l?{...w,is_read:!0}:w))}catch(b){console.error("Error marking notification as read:",b),o({variant:"destructive",title:"Erro ao marcar notificação",description:"Não foi possível marcar a notificação como lida."})}},x=async()=>{try{await C.markAsRead(a.map(l=>l.id),{userId:(await u.auth.getUser()).data.user?.id}),r(l=>l.map(b=>({...b,is_read:!0})))}catch(l){console.error("Error marking all notifications as read:",l),o({variant:"destructive",title:"Erro ao marcar notificações",description:"Não foi possível marcar todas as notificações como lidas."})}},S=async()=>{s(!t),t||await x()};m.useEffect(()=>{const l=b=>{f.current&&!f.current.contains(b.target)&&s(!1)};return document.addEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)}},[]),m.useEffect(()=>{let l=!0;return(async()=>{if(l)try{console.log("[NotificationDropdown] Temporarily disabled to reduce spam")}catch(w){console.error("Error setting up notification subscription:",w)}})(),()=>{l=!1}},[d,o]);const k=l=>{switch(l){case"reminder":return e.jsx(fe,{className:"h-4 w-4 text-amber-500"});case"alert":return e.jsx(he,{className:"h-4 w-4 text-red-500"});case"event":return e.jsx(v,{className:"h-4 w-4 text-blue-500"});default:return e.jsx(me,{className:"h-4 w-4 text-gray-500"})}};return a.filter(l=>!l.is_read).length,e.jsxs("div",{className:"relative",ref:f,children:[e.jsx(y,{variant:"ghost",size:"icon",className:"relative rounded-full",onClick:S,"aria-label":"Notificações",children:e.jsxs("div",{className:"relative",children:[e.jsx(ue,{className:"h-5 w-5"}),a.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 h-4 w-4 rounded-full bg-primary text-[10px] font-medium text-primary-foreground flex items-center justify-center",children:a.length>9?"9+":a.length})]})}),t&&e.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-md shadow-lg overflow-hidden z-50 border border-gray-200 dark:border-gray-700 dark:bg-gray-800",children:[e.jsxs("div",{className:"p-3 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100",children:"Notificações"}),e.jsxs("div",{className:"flex space-x-2",children:[a.some(l=>!l.is_read)&&e.jsx(y,{variant:"ghost",size:"sm",className:"text-xs h-7 px-2",onClick:x,children:"Marcar todas como lidas"}),e.jsx(y,{variant:"ghost",size:"sm",className:"text-xs h-7 px-2",onClick:()=>window.location.href="/notifications",children:"Ver todas"})]})]}),e.jsx(ie,{className:"max-h-96 overflow-y-auto",children:c?e.jsx("div",{className:"p-4 text-center text-sm text-gray-500",children:"Carregando notificações..."}):a.length===0?e.jsx("div",{className:"p-4 text-center text-sm text-gray-500",children:"Nenhuma notificação não lida"}):e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:a.map(l=>e.jsx("div",{className:g("p-3 hover:bg-gray-50 dark:hover:bg-gray-700/50 cursor-pointer transition-colors",!l.is_read&&"bg-blue-50 dark:bg-blue-900/20"),onClick:()=>{l.link&&(window.location.href=l.link),l.is_read||p(l.id)},children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 pt-0.5",children:k(l.type)}),e.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:l.title}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:l.message}),e.jsxs("div",{className:"mt-1 flex items-center justify-between text-xs text-gray-400",children:[e.jsx("span",{children:Me(new Date(l.created_at),{addSuffix:!0,locale:Oe})}),!l.is_read&&e.jsx("button",{onClick:b=>{b.stopPropagation(),p(l.id)},className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",title:"Marcar como lida",children:e.jsx(q,{className:"h-3.5 w-3.5"})})]})]})]})},l.id))})}),e.jsx("div",{className:"p-2 border-t border-gray-200 dark:border-gray-700 text-center",children:e.jsx(y,{variant:"ghost",size:"sm",className:"w-full text-sm",onClick:()=>window.location.href="/notifications",children:"Ver todas as notificações"})})]})]})},Qe=({setSidebarOpen:a})=>{const{user:r,logout:t}=ae(),s=Ie(),[c,n]=m.useState(!1),[i,h]=m.useState(""),f=async()=>{try{await t(),s("/login")}catch(o){console.error("Erro ao fazer logout:",o)}};return e.jsx(te.header,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl border-b border-gray-200/50 dark:border-gray-700/50 px-4 sm:px-6 py-4 sticky top-0 z-30 shadow-sm h-16 flex items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(y,{variant:"ghost",size:"icon",className:"lg:hidden hover:bg-blue-50 dark:hover:bg-gray-800 transition-colors",onClick:()=>a(o=>!o),"aria-label":"Abrir menu",children:e.jsx(xe,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"})}),e.jsx("div",{className:"hidden md:flex relative",children:e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Ae,{type:"text",placeholder:"Buscar alunos, turmas, atividades...",value:i,onChange:o=>h(o.target.value),className:"pl-10 pr-4 py-2 w-80 bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700 focus:border-blue-500 focus:ring-blue-500 rounded-xl"})]})})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(y,{variant:"ghost",size:"icon",className:"md:hidden hover:bg-blue-50 dark:hover:bg-gray-800 transition-colors","aria-label":"Buscar",children:e.jsx(O,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"})}),e.jsx(He,{}),e.jsxs(qe,{open:c,onOpenChange:n,children:[e.jsx(Be,{asChild:!0,children:e.jsx(y,{variant:"ghost",className:`h-10 w-10 p-0 rounded-full transition-all hover:ring-2 hover:ring-blue-500 hover:ring-offset-2 ${c?"ring-2 ring-blue-500 ring-offset-2":""}`,"aria-label":"Menu do usuário",children:e.jsxs(D,{className:"h-10 w-10 border-2 border-gray-200 dark:border-gray-700",children:[e.jsx(R,{src:r?.avatar_url||r?.avatar,alt:r?.name||r?.email,className:"object-cover"}),e.jsx(A,{className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white font-medium",children:(r?.name||r?.email)?.charAt(0)?.toUpperCase()||"U"})]})})}),e.jsxs(oe,{className:"w-64 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 bg-white/95 dark:bg-gray-900/95 backdrop-blur-xl",sideOffset:10,children:[e.jsx(ne,{className:"font-normal p-4",children:e.jsx("div",{className:"flex flex-col space-y-2",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(D,{className:"h-12 w-12 border-2 border-gray-200 dark:border-gray-700",children:[e.jsx(R,{src:r?.avatar_url||r?.avatar,alt:r?.name||r?.email,className:"object-cover"}),e.jsx(A,{className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white font-medium",children:(r?.name||r?.email)?.charAt(0)?.toUpperCase()||"U"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:r?.name||r?.email||"Usuário"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r?.email||"email@exemplo.com"}),e.jsx("div",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300 mt-1",children:"Plano Premium"})]})]})})}),e.jsx(M,{className:"bg-gray-200 dark:bg-gray-700"}),e.jsx(j,{className:"cursor-pointer focus:bg-blue-50 dark:focus:bg-blue-900/20 rounded-lg mx-2 my-1",onClick:()=>s("/profile"),children:e.jsx("span",{children:"Meu Perfil"})}),e.jsx(j,{className:"cursor-pointer focus:bg-blue-50 dark:focus:bg-blue-900/20 rounded-lg mx-2 my-1",onClick:()=>s("/dashboard/settings"),children:e.jsx("span",{children:"Configurações"})}),e.jsx(j,{className:"cursor-pointer focus:bg-blue-50 dark:focus:bg-blue-900/20 rounded-lg mx-2 my-1",onClick:()=>s("/docs"),children:e.jsx("span",{children:"Ajuda & Suporte"})}),e.jsx(M,{className:"bg-gray-200 dark:bg-gray-700"}),e.jsx(j,{className:"cursor-pointer text-red-600 dark:text-red-400 focus:bg-red-50 dark:focus:bg-red-900/20 rounded-lg mx-2 my-1",onClick:f,children:e.jsx("span",{children:"Sair da Conta"})})]})]})]})]})})},We=({open:a,setOpen:r})=>{const t=se(),{user:s}=ae(),[c,n]=m.useState("student");m.useEffect(()=>{let d=!0;return(async()=>{if(s?.id)try{const{data:p,error:x}=await u.from("user_roles").select("role").eq("user_id",s.id).maybeSingle();if(!d)return;if(x){n("teacher");return}n(p?.role||"teacher")}catch{d&&n("teacher")}})(),()=>{d=!1}},[s?.id]);const f=c==="teacher"?[{name:"Dashboard",icon:T,path:"/dashboard"},{name:"Turmas",icon:_,path:"/dashboard/classes"},{name:"Reuniões",icon:v,path:"/dashboard/meetings",disabled:!0,tooltip:"em construção"},{name:"Alunos",icon:_,path:"/dashboard/students"},{name:"Agenda",icon:v,path:"/dashboard/calendar"},{name:"Atividades",icon:E,path:"/dashboard/activities"},{name:"Rascunhos",icon:E,path:"/dashboard/activities/drafts"},{name:"Relatórios",icon:be,path:"/dashboard/reports"},{name:"Chatbot",icon:ye,path:"/dashboard/chatbot"}]:[{name:"Dashboard",icon:T,path:"/dashboard"},{name:"Reuniões",icon:v,path:"/dashboard/meetings",disabled:!0,tooltip:"em construção"},{name:"Agenda",icon:v,path:"/dashboard/calendar"},{name:"Turmas",icon:_,path:"/dashboard/classes"},{name:"Minhas Atividades",icon:E,path:"/dashboard/student/activities"}],o=[{name:"Ajuda",icon:Ne,path:"/docs"},{name:"Configurações",icon:we,path:"/dashboard/settings"},{name:"Sair",icon:ve,path:"/logout"}];return e.jsxs(e.Fragment,{children:[a&&e.jsx("div",{className:"fixed inset-0 z-30 bg-black bg-opacity-50 lg:hidden",onClick:()=>r(!1)}),e.jsxs("div",{className:`bg-card border-r border-border/50 shadow-lg h-screen z-40 flex flex-col w-64 fixed lg:static lg:translate-x-0 transform transition-transform duration-300 ease-in-out ${a?"translate-x-0":"-translate-x-full"}`,children:[e.jsxs("div",{className:"p-4 flex items-center justify-between border-b border-border/50",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-lg flex items-center justify-center mr-2",children:e.jsx(pe,{className:"w-5 h-5 text-white"})}),e.jsx("span",{className:"text-xl font-bold bg-gradient-to-r from-primary to-primary/80 bg-clip-text text-transparent",children:"TamanduAI"})]}),e.jsx("button",{className:"lg:hidden p-1 rounded-md hover:bg-muted transition-colors",onClick:()=>r(!1),children:e.jsx(ge,{className:"w-5 h-5 text-muted-foreground"})})]}),e.jsx("nav",{className:"mt-5 flex-1",children:e.jsx("ul",{children:f.map(d=>e.jsx("li",{children:d.disabled?e.jsxs("div",{className:"flex items-center px-4 py-3 text-sm font-medium text-muted-foreground/50 cursor-not-allowed rounded-md mx-2 my-1",title:d.tooltip,children:[e.jsx(d.icon,{className:"w-5 h-5 mr-3 text-muted-foreground/30"}),d.name]}):e.jsxs(I,{to:d.path,className:`flex items-center px-4 py-3 text-sm font-medium transition-colors rounded-md mx-2 my-1
              ${t.pathname===d.path?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-muted/50 hover:text-foreground"}`,onClick:()=>{window.innerWidth<1024&&r(!1)},children:[e.jsx(d.icon,{className:"w-5 h-5 mr-3"}),d.name]})},d.name))})}),e.jsx("div",{className:"p-2 border-t border-border/50 mt-auto",children:e.jsx("ul",{children:o.map(d=>e.jsx("li",{children:e.jsxs(I,{to:d.path,className:`flex items-center px-4 py-3 text-sm font-medium transition-colors rounded-md mx-2 my-1
            ${t.pathname===d.path?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-muted/50 hover:text-foreground"}`,onClick:()=>{window.innerWidth<1024&&r(!1)},children:[e.jsx(d.icon,{className:"w-5 h-5 mr-3"}),d.name]})},d.name))})})]})]})},Ge=N.lazy(()=>Ue(()=>import("./RoleBasedDashboard-BCPIY5gb.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43])).catch(a=>(console.error("Failed to load RoleBasedDashboard:",a),{default:()=>e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(Se,{className:"h-12 w-12 text-red-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Erro ao carregar o dashboard"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Não foi possível carregar o componente do dashboard. Por favor, tente novamente."}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors",children:"Tentar novamente"})]})}))),Je=()=>{const a=se(),[r,t]=m.useState(!0);return N.useEffect(()=>()=>{},[a]),e.jsxs("div",{className:"flex h-full min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(We,{isOpen:r,setOpen:t}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden h-full",children:[e.jsx(Qe,{onMenuClick:()=>t(!r)}),e.jsx("main",{className:"flex-1 overflow-x-hidden overflow-y-auto bg-gray-50 dark:bg-gray-900 p-4 md:p-6 h-[calc(100vh-64px)]",children:e.jsx(Pe,{errorTitle:"Erro no Dashboard",errorMessage:"Não foi possível carregar o dashboard. Tente recarregar a página.",children:e.jsx(m.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(je,{className:"h-8 w-8 animate-spin text-blue-500"})}),children:e.jsx(Te,{mode:"wait",children:e.jsx(te.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"h-full",children:e.jsx(Ge,{})},a.pathname)})})})})]})]})},tr=Object.freeze(Object.defineProperty({__proto__:null,default:Je},Symbol.toStringTag,{value:"Module"}));export{D as A,qe as D,Pe as E,C as N,ie as S,Ue as _,Be as a,oe as b,ne as c,M as d,j as e,R as f,A as g,tr as h};
