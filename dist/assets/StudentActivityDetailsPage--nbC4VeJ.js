import{f as $,u as A,r as t,s as j,ac as w,j as e,C as P,A as F,bd as R,a6 as T,o as B,a0 as L}from"./main-Bujpyeg-.js";import{P as D}from"./PremiumCard-BaDWg06v.js";import{P as k}from"./PremiumButton-skKgx_xy.js";import{E as q}from"./EmptyState-CpVlA95H.js";import{C as M}from"./ChatbotWidget-0y0SpJPK.js";import{P as E}from"./play-BfbdGAVR.js";import{U}from"./upload-C29ldkTX.js";import"./bot-W1aPrpb0.js";import"./send-D6bioMOQ.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],I=$("pause",W),X=({variant:n="full",onComplete:l})=>{const{user:x}=A(),[a,r]=t.useState(25),[m,s]=t.useState(0),[i,o]=t.useState(!1),[p,f]=t.useState(!1),[b,_]=t.useState(0),N=t.useRef(null);t.useRef(null),t.useEffect(()=>(i?N.current=setInterval(()=>{m===0?a===0?C():(r(a-1),s(59)):s(m-1)},1e3):clearInterval(N.current),()=>clearInterval(N.current)),[i,a,m]);const C=async()=>{if(o(!1),u(),p)w({title:"‚è∞ Intervalo Completo!",description:"Hora de voltar ao trabalho!",variant:"default"}),f(!1),r(25),s(0);else{_(v=>v+1);const c=a===25?10:a===50?20:5;if(x&&x.user_metadata?.role==="student")try{await j.from("xp_log").insert({user_id:x.id,xp:c,reason:`Pomodoro completo (${a+1} min)`,source:"pomodoro"}),w({title:"üéâ Sess√£o Completa!",description:`Parab√©ns! Voc√™ ganhou ${c} XP!`,variant:"success"})}catch(v){console.error("Erro ao registrar XP:",v)}else w({title:"‚úÖ Sess√£o Completa!",description:"√ìtimo trabalho! Hora de uma pausa.",variant:"success"});f(!0),r(5),s(0)}l&&l()},u=()=>{try{new Audio("/notification.mp3").play().catch(()=>{window.navigator.vibrate&&window.navigator.vibrate([200,100,200])})}catch{}},d=()=>{o(!i)},h=()=>{o(!1),f(!1),r(25),s(0)},g=c=>{o(!1),f(!1),r(c),s(0)},S=(((p?5:25)-a)*60+(60-m))/((p?5:25)*60)*100;return n==="compact"?e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-lg border border-purple-200 dark:border-purple-800",children:[e.jsx(P,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-2xl font-bold font-mono",children:[String(a).padStart(2,"0"),":",String(m).padStart(2,"0")]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:p?"Intervalo":"Foco"})]}),e.jsx(k,{size:"sm",onClick:d,variant:i?"destructive":"default",children:i?e.jsx(I,{className:"w-4 h-4"}):e.jsx(E,{className:"w-4 h-4"})})]}):e.jsx(D,{variant:"elevated",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center",children:e.jsx(P,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold",children:"Pomodoro Timer"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:p?"Tempo de Intervalo":"Tempo de Foco"})]})]}),x?.user_metadata?.role==="student"&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-yellow-500/10 rounded-lg",children:[e.jsx(F,{className:"w-4 h-4 text-yellow-600"}),e.jsxs("span",{className:"text-sm font-semibold text-yellow-600",children:[b*10," XP hoje"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("svg",{className:"w-full h-64",viewBox:"0 0 200 200",children:[e.jsx("circle",{cx:"100",cy:"100",r:"90",fill:"none",stroke:"currentColor",strokeWidth:"4",className:"text-muted"}),e.jsx("circle",{cx:"100",cy:"100",r:"90",fill:"none",stroke:"url(#gradient)",strokeWidth:"8",strokeLinecap:"round",strokeDasharray:`${2*Math.PI*90}`,strokeDashoffset:`${2*Math.PI*90*(1-S/100)}`,transform:"rotate(-90 100 100)",className:"transition-all duration-1000"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"gradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#a855f7"}),e.jsx("stop",{offset:"100%",stopColor:"#ec4899"})]})})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"text-6xl font-bold font-mono bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:[String(a).padStart(2,"0"),":",String(m).padStart(2,"0")]}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-2",children:[Math.round(S),"% completo"]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(k,{onClick:d,className:"flex-1",size:"lg",variant:i?"destructive":"default",children:i?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-5 h-5 mr-2"}),"Pausar"]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-5 h-5 mr-2"}),"Iniciar"]})}),e.jsx(k,{onClick:h,variant:"outline",size:"lg",children:e.jsx(R,{className:"w-5 h-5"})})]}),!i&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>g(25),className:"flex-1 px-3 py-2 text-sm bg-muted hover:bg-muted/80 rounded-lg transition-colors",children:"25 min"}),e.jsx("button",{onClick:()=>g(50),className:"flex-1 px-3 py-2 text-sm bg-muted hover:bg-muted/80 rounded-lg transition-colors",children:"50 min"}),e.jsx("button",{onClick:()=>g(5),className:"flex-1 px-3 py-2 text-sm bg-muted hover:bg-muted/80 rounded-lg transition-colors",children:"5 min"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-border",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:b}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Sess√µes Hoje"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-pink-600",children:b*25}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Minutos de Foco"})]})]}),x?.user_metadata?.role==="student"&&e.jsx("div",{className:"bg-gradient-to-r from-purple-500/10 to-pink-500/10 p-3 rounded-lg text-center",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["‚ú® Complete sess√µes e ganhe ",e.jsx("strong",{className:"text-purple-600",children:"10 XP"})," por sess√£o de 25min!"]})})]})})},Z=()=>{const{activityId:n}=T(),{user:l}=A(),[x,a]=t.useState(!0),[r,m]=t.useState(null),[s,i]=t.useState(null),[o,p]=t.useState(null),[f,b]=t.useState(!1),[_,N]=t.useState("");t.useEffect(()=>{(async()=>{if(n){a(!0),N("");try{const{data:d,error:h}=await j.from("activities").select("*").eq("id",n).maybeSingle();if(h)throw h;if(m(d),l?.id){const{data:g}=await j.from("submissions").select("*").eq("activity_id",n).eq("student_id",l.id).maybeSingle();i(g||null)}}catch(d){console.error("Erro ao carregar atividade:",d),N("N√£o foi poss√≠vel carregar a atividade.")}finally{a(!1)}}})()},[n,l?.id]);const C=async()=>{if(!(!o||!l?.id)){b(!0);try{const u=o.name.split(".").pop(),d=`${l.id}/${n}/${Date.now()}.${u}`,{error:h}=await j.storage.from("submissions").upload(d,o,{upsert:!0});if(h)throw h;const{data:g}=j.storage.from("submissions").getPublicUrl(d),S=g?.publicUrl||null,c={activity_id:n,student_id:l.id,content:{file_url:S,file_name:o.name},status:"submitted",submitted_at:new Date().toISOString(),updated_at:new Date().toISOString()};if(s?.id){const{data:v,error:y}=await j.from("submissions").update(c).eq("id",s.id).select().maybeSingle();if(y)throw y;i(v)}else{const{data:v,error:y}=await j.from("submissions").insert(c).select().maybeSingle();if(y)throw y;i(v)}w.success?.("Atividade enviada com sucesso!")}catch(u){console.error("Erro ao enviar atividade:",u),w.error?.("Erro ao enviar atividade")}finally{b(!1)}}};return x?e.jsx(B,{message:"Carregando atividade..."}):r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-indigo-600 to-purple-600 p-8 rounded-2xl text-white",children:[e.jsx("h1",{className:"text-2xl font-bold",children:r.title}),r.due_date&&e.jsxs("p",{className:"text-white/90",children:["Entrega at√© ",new Date(r.due_date).toLocaleString("pt-BR")]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsx(D,{variant:"elevated",children:e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold mb-1",children:"Descri√ß√£o"}),e.jsx("p",{className:"text-muted-foreground",children:r.description||"Sem descri√ß√£o"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold mb-2",children:"Enviar minha resposta"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"file",onChange:u=>p(u.target.files?.[0]||null)}),e.jsx(k,{onClick:C,disabled:!o||f,leftIcon:U,children:f?"Enviando...":"Enviar"})]}),s&&e.jsxs("div",{className:"mt-3 text-sm text-muted-foreground",children:["√öltimo envio: ",new Date(s.submitted_at||s.updated_at).toLocaleString("pt-BR")," ",s.content?.file_name?`- ${s.content.file_name}`:""]})]})]})})}),e.jsx("div",{className:"space-y-6",children:e.jsx(X,{variant:"full"})})]}),e.jsx(M,{context:{activityId:n,classId:r?.class_id}})]}):e.jsx(q,{title:"Atividade n√£o encontrada",description:"Verifique o link e tente novamente.",icon:L})};export{Z as default};
